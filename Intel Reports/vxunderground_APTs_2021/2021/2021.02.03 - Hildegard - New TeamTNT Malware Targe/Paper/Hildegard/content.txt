2/6/2021
Hildegard: New TeamTNT Malware Targeting Kubernetes
https://unit42.paloaltonetworks.com/hildegard-malware-teamtnt/
1/16
Hildegard: New TeamTNT Malware Targeƭng
Kubernetes
7,352 people reacted
14
10 min. read
This post is also available in: ⽇本語 (Japanese)

By Jay Chen, Aviv Sasson and Ariel Zelivansky
February 3, 2021 at 6:00 AM
Category: Unit 42
Tags: Cloud, containers, cryptojacking, Docker, Kubernetes, public cloud, TeamTnT

Menu
SHARE 
This site uses cookies essential to its operation, for analytics, and for
personalized content and ads. By continuing to browse this site, you
acknowledge the use of cookies. Privacy statement
Cookie Settings
›
2/6/2021
Hildegard: New TeamTNT Malware Targeting Kubernetes
https://unit42.paloaltonetworks.com/hildegard-malware-teamtnt/
2/16
Execuƭve Summary
In January 2021, Unit 42 researchers detected a new malware campaign targeƭng Kubernetes clusters.
The azackers gained iniƭal access via a misconﬁgured kubelet that allowed anonymous access. Once
geƵng a foothold into a Kubernetes cluster, the malware azempted to spread over as many containers
as possible and eventually launched cryptojacking operaƭons. Based on the tacƭcs, techniques and
procedures (TTP) that the azackers used, we believe this is a new campaign from TeamTNT. We refer to
this new malware as Hildegard, the username of the tmate account that the malware used.
TeamTNT is known for exploiƭng unsecured Docker daemons and deploying malicious container
images, as documented in previous research (Cetus, Black-T and TeamTNT DDoS). However, this is the
ﬁrst ƭme we found TeamTNT targeƭng Kubernetes environments. In addiƭon to the same tools and
domains idenƭﬁed in TeamTNT’s previous campaigns, this new malware carries mulƭple new
capabiliƭes that make it more stealthy and persistent. In parƭcular, we found that TeamTNT’s Hildegard
malware:
Uses two ways to establish command and control (C2) connecƭons: a tmate reverse shell and an
Internet Relay Chat (IRC) channel.
Uses a known Linux process name (bioset) to disguise the malicious process.
Uses a library injecƭon technique based on LD_PRELOAD to hide the malicious processes.
Encrypts the malicious payload inside a binary to make automated staƭc analysis more diﬃcult.
We believe that this new malware campaign is sƭll under development due to its seemingly incomplete
codebase and infrastructure. At the ƭme of wriƭng, most of Hildegard’s infrastructure has been online
for only a month. The C2 domain borg[.]ww was registered on Dec. 24, 2020, the IRC server went
online on Jan. 9, 2021, and some malicious scripts have been updated frequently. The malware
campaign has ~25.05 KH/s hashing power, and there is 11 XMR (~$1,500) in the wallet.
There has not been any acƭvity since our iniƭal detecƭon, which indicates the threat campaign may
sƭll be in the reconnaissance and weaponizaƭon stage. However, knowing this malware’s capabiliƭes
and target environments, we have good reason to believe that the group will soon launch a larger-scale
azack. The malware can leverage the abundant compuƭng resources in Kubernetes environments for
cryptojacking and potenƭally exﬁltrate sensiƭve data from tens to thousands of applicaƭons running in
the clusters.
Palo Alto Networks customers running Prisma Cloud are protected from this threat by the Runƭme
Protecƭon feature, Cryptominer Detecƭon feature and the Prisma Cloud Compute Kubernetes
Compliance Protecƭon, which alerts on an insuﬃcient Kubernetes conﬁguraƭon and provides secure
alternaƭves.
This site uses cookies essential to its operation, for analytics, and for
personalized content and ads. By continuing to browse this site, you
acknowledge the use of cookies. Privacy statement
Cookie Settings
›
2/6/2021
Hildegard: New TeamTNT Malware Targeting Kubernetes
https://unit42.paloaltonetworks.com/hildegard-malware-teamtnt/
3/16
Figure 1. Azacker and malware’s movement.
Tacƭcs, Techniques and Procedures
Figure 1 illustrates how the azacker entered, moved laterally and eventually performed cryptojacking in
mulƭple containers.
1. The azacker started by exploiƭng an unsecured Kubelet on the internet and searched for containers
running inside the Kubernetes nodes. AWer ﬁnding container 1 in Node A, the azacker azempted to
perform remote code execuƭon (RCE) in container 1.
2. The azacker downloaded tmate and issued a command to run it and establish a reverse shell to
tmate.io from container 1. The azacker then conƭnued the azack with this tmate session.
3. From container 1, the azacker used masscan to scan Kubernetes’s internal network and found
unsecured Kubelets in Node B and Node C. The azacker then azempted to deploy a malicious crypto
mining script (xmr.sh) to containers managed by these Kubelets (containers 2-7).
4. Containers that ran xmr.sh started an xmrig process and established an IRC channel back to the IRC
C2.
This site uses cookies essential to its operation, for analytics, and for
personalized content and ads. By continuing to browse this site, you
acknowledge the use of cookies. Privacy statement
Cookie Settings
›
2/6/2021
Hildegard: New TeamTNT Malware Targeting Kubernetes
https://unit42.paloaltonetworks.com/hildegard-malware-teamtnt/
4/16
5. The azacker could also create another tmate session from one of the containers (container 4). With
the reverse shell, the azacker could perform more manual reconnaissance and operaƭons.
The indicators of compromise (IOCs) found in each container are listed below. These ﬁles are either
shell script or Executable Linkable Format (ELF). The IOC secƭon at the end of the blog contains the
hash and details of each ﬁle.
Container 1: TDGG was dropped and executed via Kubelet. TDGG then subsequently downloaded
and executed tt.sh, api.key and tmate. The azacker used the established tmate connecƭon to
drop and run sGAU.sh, kshell, install_monerod.bash, setup_moneroocean_miner.sh
and xmrig (MoneroOcean).
Container 2-7: xmr.sh was dropped and executed via Kubelet.
Container 4: The azacker also established a tmate session in this container. The azacker then
dropped and executed pei.sh, pei64/32, xmr3.assi, aws2.sh, t.sh,
tmate,x86_64.so, xmrig and xmrig.so.
Figure 2 maps the malware campaign’s TTP to MITRE ATT&CK tacƭcs. The following secƭons will
detail the techniques used in each stage.
Figure 2. Azacker’s tacƪcs, techniques and procedures.
Iniƭal Access
kubelet is an agent running on each Kubernetes node. It takes RESTful requests from various
components (mainly kube-apiserver) and performs pod-level operaƭons. Depending on the
conﬁguraƭon, kubelet may or may not accept unauthenƭcated requests. Standard Kubernetes
deployments come with anonymous access to kubelet by default. However, most managed Kubernetes
services such as Azure Kubernetes Service (AKS), Google Kubernetes Engine (GKE) and Kubernetes
operaƭons (Kops) all enforce proper authenƭcaƭon by default.
We discovered that TeamTNT gained iniƭal access with the Hildegard malware by execuƭng commands
on kubelets that allow anonymous access. This was achieved by accessing the kubelet’s run command
This site uses cookies essential to its operation, for analytics, and for
personalized content and ads. By continuing to browse this site, you
acknowledge the use of cookies. Privacy statement
Cookie Settings
›
2/6/2021
Hildegard: New TeamTNT Malware Targeting Kubernetes
https://unit42.paloaltonetworks.com/hildegard-malware-teamtnt/
5/16
API and execuƭng commands on running containers.
Execuƭon
Hildegard uses kubelet’s API to execute commands inside containers. The iniƭal commands create a
tmate reverse shell that allows the azacker to carry out the subsequent operaƭon. Unlike the
techniques that TeamTNT used in the past, this malware campaign did not pull or run any new
container image.
Privilege Escalaƭon
Although Unit 42 researchers have not observed an azempt to perform privilege escalaƭon, the
malware dropped two adversarial tools, Peirates and BOtB, which are capable of breaking out of
containers via known vulnerabiliƭes or accessing cloud resources via exposed cloud credenƭals.
Container Breakout
BOtB can perform a container breakout using a known vulnerability such as CVE-2019-5736. It can
also escape from privileged containers that have enabled CAPS and SYSCALLS.
Access to Cloud Resources
Peirates can gather mulƭple infrastructures and cloud credenƭals. It looks for idenƭty and access
management (IAM) credenƭals from cloud metadata services and service account tokens from the
Kubernetes clusters. With the idenƭﬁed credenƭals, it then further azempts to move laterally or gain
control of the cluster. While we observed Peirates in use, the container it was executed in had no
credenƭals.
Defense Evasion
Library Injecƭon
Hildegard uses LD_PRELOAD to hide the malicious process launched inside the containers. The
malware modiﬁed the /etc/ld.so.preload ﬁle to intercept shared libraries’ imported funcƭons. In
parƭcular, the malware overwrites two funcƭons: readdir() and readdir64(), which are
responsible for returning the directory entries in the ﬁle system. The overwrizen funcƭons ﬁlter out
queries made to directory entries under /proc. The funcƭons then drop queries with keywords such
as tmate, xmrig and ziggy. This way, when applicaƭons try to idenƭfy the running processes (by reading
ﬁles under /proc) in the containers, tmate, xmrig and ziggy will not be found. Linux tools such as ps, top
and many other container monitoring tools will be blinded from these malicious processes.
This site uses cookies essential to its operation, for analytics, and for
personalized content and ads. By continuing to browse this site, you
acknowledge the use of cookies. Privacy statement
Cookie Settings
›
2/6/2021
Hildegard: New TeamTNT Malware Targeting Kubernetes
https://unit42.paloaltonetworks.com/hildegard-malware-teamtnt/
6/16
Figure 3. Funcƪon that overwrites readdir64() in X86_64.so.
Encrypted ELF Binary
Hildegard deploys an IRC agent built from the open-source project ziggystartux. To avoid being
detected by automated staƭc analysis tools, the ziggystartux ELF is encrypted and packed in another
binary (ziggy). When the binary is executed, the ziggystartux ELF is decrypted by a hardcoded
Advanced Encrypƭon Standard (AES) key and executed in memory.
Figure 4. Unpacking and execuƪng the payload.
This site uses cookies essential to its operation, for analytics, and for
personalized content and ads. By continuing to browse this site, you
acknowledge the use of cookies. Privacy statement
Cookie Settings
›
2/6/2021
Hildegard: New TeamTNT Malware Targeting Kubernetes
https://unit42.paloaltonetworks.com/hildegard-malware-teamtnt/
7/16
Disguised Process Name
The malware names the IRC process “bioset”, which is the name of a well-known Linux kernel process
bioset. If one is only looking at the names of the running processes on a host, one can easily overlook
this disguised process.
DNS Monitoring Bypass 
The malware modiﬁes the system DNS resolvers and uses Google’s public DNS servers to avoid being
detected by DNS monitoring tools.
Figure 5. DNS resolver modiﬁcaƪon.
Delete Files and Clear Shell History
All the scripts are deleted immediately aWer being executed. TeamTNT also uses the “history -c”
command to clear the shell log in every script.
Figure 6. The script clears the history and deletes itself.
Credenƭal Access
Hildegard searches for credenƭal ﬁles on the host, as well as queries metadata for cloud-speciﬁc
credenƭals. The idenƭﬁed credenƭals are sent back to the C2.
The searched credenƭals include:
Cloud access keys.
Cloud access tokens.
This site uses cookies essential to its operation, for analytics, and for
personalized content and ads. By continuing to browse this site, you
acknowledge the use of cookies. Privacy statement
Cookie Settings
›
2/6/2021
Hildegard: New TeamTNT Malware Targeting Kubernetes
https://unit42.paloaltonetworks.com/hildegard-malware-teamtnt/
8/16
SSH keys.
Docker credenƭals.
Kubernetes service tokens.
The metadata servers searched:
169.254.169.254
169.254.170.2
Figure 7. The script looks for credenƪals.
Discovery
Hildegard performs several reconnaissance operaƭons to explore the environment.
It gathers and sends back the host’s OS, CPU and memory informaƭon.
It uses masscan to search for kubelets in Kubernetes’ internal network.
It uses kubelet’s API to search for running containers in a parƭcular node.
This site uses cookies essential to its operation, for analytics, and for
personalized content and ads. By continuing to browse this site, you
acknowledge the use of cookies. Privacy statement
Cookie Settings
›
2/6/2021
Hildegard: New TeamTNT Malware Targeting Kubernetes
https://unit42.paloaltonetworks.com/hildegard-malware-teamtnt/
9/16
Figure 8. The script looks for system and network informaƪon.
Lateral Movement
Hildegard mainly uses the unsecured kubelet to move laterally inside a Kubernetes cluster. During the
discovery stage, the malware ﬁnds the exploitable kubelets and the containers these kubelets manage.
The malware then creates C2 channels (tmate or IRC) and deploys malicious crypto miners in these
containers. Although not observed by Unit 42 researchers, the azacker may also move laterally with
the stolen credenƭals.
Command and Control
Once gaining the iniƭal foothold into a container, Hildegard establishes either a tmate session or an IRC
channel back to the C2. It is unclear how TeamTNT chooses and tasks between these two C2 channels,
as both can serve the same purpose. At the ƭme of wriƭng, tmate sessions are the only way the
azacker interacts with the compromised containers. Unit 42 researchers have not observed any
commands in the IRC channel. However, the IRC server’s metadata indicates that the server was
deployed on Jan. 9, 2021, and there are around 220 clients currently connected to the server.
Figure 9. Tmate named session created by the malware.
Figure 10. The IRC servers are hardcoded in the ziggy binary.
This site uses cookies essential to its operation, for analytics, and for
personalized content and ads. By continuing to browse this site, you
acknowledge the use of cookies. Privacy statement
Cookie Settings
›
2/6/2021
Hildegard: New TeamTNT Malware Targeting Kubernetes
https://unit42.paloaltonetworks.com/hildegard-malware-teamtnt/
10/16
Figure 11.The IRC traﬃc captured at the IRC client.
Impact
The most signiﬁcant impact of the malware is resource hijacking and denial of service (DoS). The
cryptojacking operaƭon can quickly drain the enƭre system’s resources and disrupt every applicaƭon in
the cluster. The xmrig mining process joins the supportxmr mining pool using the wallet address
428uyvSqdpVZL7HHgpj2T5SpasCcoHZNTTzE3Lz2H5ZkiMzqayy19sYDcBGDCjoWbTfLBnc3tc9
rG4Y8gXQ8fJiP5tqeBda. At the ƭme of wriƭng, the malware campaign has ~25.05 KH/s hashing
power and there is 11 XMR (~$1,500) in the wallet.
Figure 12. Mining acƪvity on supportxmr.
Conclusion
This site uses cookies essential to its operation, for analytics, and for
personalized content and ads. By continuing to browse this site, you
acknowledge the use of cookies. Privacy statement
Cookie Settings
›
2/6/2021
Hildegard: New TeamTNT Malware Targeting Kubernetes
https://unit42.paloaltonetworks.com/hildegard-malware-teamtnt/
11/16
Unlike a Docker engine that runs on a single host, a Kubernetes cluster typically contains more than
one host and every host can run mulƭple containers. Given the abundant resources in a Kubernetes
infrastructure, a hijacked Kubernetes cluster can be more proﬁtable than a hijacked Docker host. This
new TeamTNT malware campaign is one of the most complicated azacks targeƭng Kubernetes. This is
also the most feature-rich malware we have seen from TeamTNT so far. In parƭcular, the threat actor
has developed more sophisƭcated tacƭcs for iniƭal access, execuƭon, defense evasion and C2. These
eﬀorts make the malware more stealthy and persistent. Although the malware is sƭll under
development and the campaign is not yet widely spread, we believe the azacker will soon mature the
tools and start a large-scale deployment.
Palo Alto Networks customers running Prisma Cloud are protected from this threat by the Runƭme
Protecƭon features, Cryptominer Detecƭon and by the Prisma Cloud Compute Kubernetes Compliance
Protecƭon, which alerts on an insuﬃcient Kubernetes conﬁguraƭon and provides secure alternaƭves.
Figure 13. Prisma Cloud Compute Kubernetes compliance protecƪons.
Figure 14. Prisma Cloud Compute alerƪng on crypto mining incident.
Indicators of Compromise
Domains/IPs:
Domain/IP
Descripƭon
The.borg[.]ww
This machine hosts malicious ﬁles used in the campaign and receives the
collected data to this C2.
This site uses cookies essential to its operation, for analytics, and for
personalized content and ads. By continuing to browse this site, you
acknowledge the use of cookies. Privacy statement
Cookie Settings
›
2/6/2021
Hildegard: New TeamTNT Malware Targeting Kubernetes
https://unit42.paloaltonetworks.com/hildegard-malware-teamtnt/
12/16
(45.9.150[.]36
)
Hosted ﬁles: TDGG, api.key, tmate, z.sh, sGAU.sh, t.sh, x86_64.so, xmr.sh,
xmrig, xmrig.so, ziggy, xmr3.assi
147.75.47[.]1
99
The malware connects to this IP to obtain the vicƭm host’s public IP.
teamtnt[.]red 
(45.9.148[.]10
8)
This host hosts malicious scripts and binaries. 
Hosted ﬁles: pei.sh, pei64.
Borg[.]ww 
(45.9.148[.]10
8)
This host hosts malicious scripts and binaries. 
Hosted ﬁles: aws2.sh
irc.borg[.]ww 
(123.245.9[.]1
47)
This host is one of the C2s. It runs an IRC server on port 6667.
sampwn.anon
dns[.]net
(13.245.9[.]14
7)
This host is one of the C2s. It runs an IRC server on port 6667.
164.68.106[.]
96
This host is one of the C2s. It runs an IRC server on port 6667.
62.234.121[.]
105
This host is one of the C2s. It runs an IRC server on port 6667.
Files:
SHA256
File Name
Typ
e
Descripƭon
2c1528253656ac09c747391
1b24b243f083e60b98a19ba1
bbb050979a1f38a0f
TDGG
scrip
t
This script downloads and executes
z.sh.
2cde98579162ab165623241
719b2ab33ac40f0b5d0a8ba7
e7067c7aebc530172
z.sh
scrip
t
This script downloads and runs
tmate. It collects system
informaƭon from the vicƭm’s host
and sends the collected data to
C2(45.9.150[.]36)
b34df4b273b3bedaab531be4
6a0780d97b87588e93c1818
api.key
text
The API key is used for creaƭng a
named tmate session from the
This site uses cookies essential to its operation, for analytics, and for
personalized content and ads. By continuing to browse this site, you
acknowledge the use of cookies. Privacy statement
Cookie Settings
›
2/6/2021
Hildegard: New TeamTNT Malware Targeting Kubernetes
https://unit42.paloaltonetworks.com/hildegard-malware-teamtnt/
13/16
158a47f7add8c7204
compromised containers.
d2ﬀf992e40ce18ﬀ81b9a92fa
1cb93a56:5a82c1cc428204
552d8dfa1bc04f
tmate
ELF
tmate v2.4.0
74e3ccaea4df277e1a9c458a6
71db74aa47630928a7825f75
994756512b09d64
sGAU.sh
scrip
t
This script downloads and installs
masscan. It scans Kubernetes’
internal IP Kubelets running on port
10250. If masscan ﬁnds an
exploitable Kubelet, it azempts to
download and execute a
cryptojacking script in all the
containers.
8e33496ea00218c07145396
c6bcf3e25f4e38a1061f807d2
d3653497a291348c
kshell
scrip
t
The script performs remote code
execuƭon in containers via
Kubelet’s API. It also downloads
and executes xmr.sh in a target
container.
518a19aa2c3c9f895efa0d130
e6355af5b5d7edf28e2a2d9b
944aa358c23d887
install_moner
od.bash
scrip
t
The script is hosted in this Github
repo. It pulls and builds the oﬃcial
monero project. It then creates a
user named “monerodaemon” and
starts the monero service.
5923f20010cb7c1d59aab36b
a41c84cd20c25c6e64aace65
dc8243ea827b537b
setup_moner
oocean_mine
r.sh
scrip
t
The script is hosted in this Github
repo. It pulls and runs the
MoneroOcean advanced version of
xmrig.
a22c2a6c2fdc5f5b962d2534a
aae10d4de0379c9872f07aa1
0c77210ca652fa9
xmrig
(oneroocean)
ELF
xmrig 6.7.2-mo3. This binary is
hosted in MoneroOcean/xmrig
Github repo.
ee6dbbf85a3bb301a2e448c7f
ddaa4c1c6f234a8c75597ee7
66c66f52540d015
pei.sh
scrip
t
This script downloads and executes
pei64 or pei32, depending on the
host’s architecture.
937842811b9e2eb87c4c193
54a1a790315f2669eea58b63
264f751de4da5438d
pei64
ELF
This is a Kubernetes penetraƭon
tool from the peirates project. The
tool is capable of escalaƭng
privilege and pivoƭng through the
Kubernetes cluster.
72cﬀ62d801c5bcb185aa299e
b26f417aad843e617cf9c39c6
pei32
ELF
Same as pei64, but for i686
architecture.
This site uses cookies essential to its operation, for analytics, and for
personalized content and ads. By continuing to browse this site, you
acknowledge the use of cookies. Privacy statement
Cookie Settings
›
2/6/2021
Hildegard: New TeamTNT Malware Targeting Kubernetes
https://unit42.paloaltonetworks.com/hildegard-malware-teamtnt/
14/16
9f9dde6eb82742
12c5c5d556394aa107a43314
4c185a686aba3bb44389b724
1d84bea766e2aea3
xmr3.assi
scrip
t
The script downloads and runs
aws2.sh, t.sh and xmrig.
053318adb15cf23075f737da
a153b81ab8bd0f2958fa81cd
85336ecdf3d7de4e
aws2.sh
scrip
t
The script searches for cloud
credenƭals and sends the idenƭﬁed
credenƭals to C2 (the.borg[.]ww).
e6422d97d381f255cd9e9f91
f06e5e4921f070b23e4e35ed
d539a589b1d6aea7
t.sh
scrip
t
The script downloads x86_64.so
and tmate from C2. It modiﬁes
ld.so.preload and starts a tmate
named session. It then sends back
the vicƭm’s system info and tmate
session to C2.
77456c099facd775238086e8
f9420308be432d461e55e49e
1b24d96a8ea585e8
x86_64.so
ELF
This shared object replaces the
exisƭng /etc/ld.so.preload ﬁle. It
uses the LD_PRELOAD trick to hide
the tmate process.
78f92857e18107872526feb1
ae834edb9b7189df4a2129a4
125a3dd8917f9983
xmrig
ELF
xmrig v6.7.0
3de32f315fd01b7b741c:b7
dfee22c30bf7b9a5a01d7ab66
90fcb42759a3e9f
xmrig.so
ELF
This shared object replaces the
exisƭng /etc/ld.so.preload.
It uses the LD_PRELOAD trick to
hide the xmrig process.
fe0f5fef4d78db808b9dc4e63
eeda9f8626f8ea21b9d03cbd
884e37cde9018ee
xmr.sh
scrip
t
The script downloads and executes
xmrig and ziggy.
74f122:0059977167c5ed34
a7e217d9dfe8e8199020e3fe
19532be108a7d607
ziggy
ELF
ziggy is a binary that packs an
encrypted ELF. The binary decrypts
the ELF at runƭme and runs it in the
memory. The encrypted ELF is built
from ZiggyStarTux, an IRC client for
embedded devices.
 
This site uses cookies essential to its operation, for analytics, and for
personalized content and ads. By continuing to browse this site, you
acknowledge the use of cookies. Privacy statement
Cookie Settings
›
2/6/2021
Hildegard: New TeamTNT Malware Targeting Kubernetes
https://unit42.paloaltonetworks.com/hildegard-malware-teamtnt/
15/16
Get updates from  
Palo Alto 
Networks!
Sign up to receive the latest news, cyber threat intelligence and research from us
Email address
Subscribe
reCAPTCHA
I'm not a robot
Privacy - Terms
By submiƵng this form, you agree to our Terms of Use and acknowledge our Privacy Statement.

Popular Resources
Resource Center
Blog
Communiƭes
Tech Docs
Unit 42
Sitemap
Legal Notices
Privacy
Terms of Use
Documents
Account
Manage Subscripƭons
This site uses cookies essential to its operation, for analytics, and for
personalized content and ads. By continuing to browse this site, you
acknowledge the use of cookies. Privacy statement
Cookie Settings
›
2/6/2021
Hildegard: New TeamTNT Malware Targeting Kubernetes
https://unit42.paloaltonetworks.com/hildegard-malware-teamtnt/
16/16
© 2021 Palo Alto Networks, Inc. All rights reserved.
Manage Subscripƭons
Report a Vulnerability
This site uses cookies essential to its operation, for analytics, and for
personalized content and ads. By continuing to browse this site, you
acknowledge the use of cookies. Privacy statement
Cookie Settings
›
