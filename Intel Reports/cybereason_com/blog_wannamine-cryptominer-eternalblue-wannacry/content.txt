<!doctype html><!--[if lt IE 7]> <html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en" > <![endif]--><!--[if IE 7]>    <html class="no-js lt-ie9 lt-ie8" lang="en" >        <![endif]--><!--[if IE 8]>    <html class="no-js lt-ie9" lang="en" >               <![endif]--><!--[if gt IE 8]><!--><html class="no-js" lang="en"><!--<![endif]--><head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="author" content="Cybereason Nocturnus">
    <meta name="description" content="The WannaMine Cryptominer, which uses the EternalBlue exploits, is still active although a patch that fixes these well-known vulnerabilities was released last March. ">
    <meta name="generator" content="HubSpot">
    <title>WannaMine Cryptominer that uses EternalBlue still active</title>
    <link rel="shortcut icon" href="https://www.cybereason.com/hubfs/cr-favicon-1.png">
    
<meta name="viewport" content="width=device-width, initial-scale=1">

    
    <meta property="og:description" content="The WannaMine Cryptominer, which uses the EternalBlue exploits, is still active although a patch that fixes these well-known vulnerabilities was released last March. ">
    <meta property="og:title" content="WannaMine Cryptominer that uses EternalBlue still active">
    <meta name="twitter:description" content="The WannaMine Cryptominer, which uses the EternalBlue exploits, is still active although a patch that fixes these well-known vulnerabilities was released last March. ">
    <meta name="twitter:title" content="WannaMine Cryptominer that uses EternalBlue still active">

    

    
    <style>
a.cta_button{-moz-box-sizing:content-box !important;-webkit-box-sizing:content-box !important;box-sizing:content-box !important;vertical-align:middle}.hs-breadcrumb-menu{list-style-type:none;margin:0px 0px 0px 0px;padding:0px 0px 0px 0px}.hs-breadcrumb-menu-item{float:left;padding:10px 0px 10px 10px}.hs-breadcrumb-menu-divider:before{content:'›';padding-left:10px}.hs-featured-image-link{border:0}.hs-featured-image{float:right;margin:0 0 20px 20px;max-width:50%}@media (max-width: 568px){.hs-featured-image{float:none;margin:0;width:100%;max-width:100%}}.hs-screen-reader-text{clip:rect(1px, 1px, 1px, 1px);height:1px;overflow:hidden;position:absolute !important;width:1px}
</style>

<link rel="stylesheet" href="https://www.cybereason.com/hs-fs/hubfs/hub_generated/module_assets/1/41681847227/1741488491170/module_CR_-_Malicious_Life_Network_--_Tier_One_Header.min.css">
<link rel="stylesheet" href="https://www.cybereason.com/hs-fs/hubfs/hub_generated/module_assets/1/41682410610/1741488492472/module_CR_-_Malicious_Life_Network_--_Main_Hero.min.css">
<link rel="stylesheet" href="https://www.cybereason.com/hs-fs/hubfs/hub_generated/module_assets/1/43300360745/1741488505140/module_CR_-_Malicious_Life_Network_--_Related_Posts.min.css">
<link rel="stylesheet" href="https://www.cybereason.com/hs-fs/hubfs/hub_generated/module_assets/1/86933076631/1741488758324/module_CR_-_Sticky_CTA_Bar.min.css">
<link rel="stylesheet" href="https://www.cybereason.com/hs-fs/hubfs/hub_generated/module_assets/1/34473990280/1740999337265/module_CR_-_Footer_Full__en_US.min.css">
    

    
<!--  Added by GoogleTagManager integration -->
<script>
var _hsp = window._hsp = window._hsp || [];
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}

var useGoogleConsentModeV2 = true;
var waitForUpdateMillis = 1000;



var hsLoadGtm = function loadGtm() {
    if(window._hsGtmLoadOnce) {
      return;
    }

    if (useGoogleConsentModeV2) {

      gtag('set','developer_id.dZTQ1Zm',true);

      gtag('consent', 'default', {
      'ad_storage': 'denied',
      'analytics_storage': 'denied',
      'ad_user_data': 'denied',
      'ad_personalization': 'denied',
      'wait_for_update': waitForUpdateMillis
      });

      _hsp.push(['useGoogleConsentModeV2'])
    }

    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-TJVVB7C');

    window._hsGtmLoadOnce = true;
};

_hsp.push(['addPrivacyConsentListener', function(consent){
  if(consent.allowed || (consent.categories && consent.categories.analytics)){
    hsLoadGtm();
  }
}]);

</script>

<!-- /Added by GoogleTagManager integration -->


<script src="https://use.typekit.net/vyv2ljd.js"></script>
<script>try{Typekit.load({ async: false });}catch(e){}</script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<link rel="preload" href="/hubfs/__dam/fonts/ionicons.eot" as="font" type="font/otf" crossorigin>
<link rel="preload" href="/hubfs/dam/fonts/criteria/Criteria-CF-Regular.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/hubfs/dam/fonts/criteria/Criteria-CF-Medium.woff2" as="font" type="font/woff2" crossorigin>
<link rel="preload" href="/hubfs/dam/fonts/peristyle/Peristyle-Black.woff2" as="font" type="font/woff2" crossorigin>
<link rel="amphtml" href="https://www.cybereason.com/blog/research/wannamine-cryptominer-eternalblue-wannacry?hs_amp=true">

<meta property="og:image" content="https://www.cybereason.com/hubfs/dam/images/images-web/featured-images/cr-featured-image.png">
<meta property="og:image:width" content="1200">
<meta property="og:image:height" content="628">

<meta name="twitter:image" content="https://www.cybereason.com/hubfs/dam/images/images-web/featured-images/cr-featured-image.png">


<meta property="og:url" content="https://www.cybereason.com/blog/research/wannamine-cryptominer-eternalblue-wannacry">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:creator" content="@cr_nocturnus">

<link rel="canonical" href="https://www.cybereason.com/blog/research/wannamine-cryptominer-eternalblue-wannacry">

<meta property="og:type" content="article">
<link rel="alternate" type="application/rss+xml" href="https://www.cybereason.com/blog/rss.xml">
<meta name="twitter:domain" content="www.cybereason.com">
<script src="//platform.linkedin.com/in.js" type="text/javascript">
    lang: en_US
</script>

<meta http-equiv="content-language" content="en">
<link rel="stylesheet" href="//7052064.fs1.hubspotusercontent-na1.net/hubfs/7052064/hub_generated/template_assets/DEFAULT_ASSET/1741880806594/template_layout.min.css">


<link rel="stylesheet" href="https://www.cybereason.com/hs-fs/hubfs/hub_generated/template_assets/1/34470223313/1741528336747/template_cr-master__cta.min.css">
<link rel="stylesheet" href="https://www.cybereason.com/hs-fs/hubfs/hub_generated/template_assets/1/34470477360/1736810313166/template_cr-master__main.min.css">
<link rel="stylesheet" href="https://www.cybereason.com/hs-fs/hubfs/hub_generated/template_assets/1/35275979682/1741528339661/template_ionicons.min.css">
<link rel="stylesheet" href="https://www.cybereason.com/hs-fs/hubfs/hub_generated/template_assets/1/42760289143/1741528346957/template_cr-mln__build.min.css">
<link rel="stylesheet" href="https://www.cybereason.com/hs-fs/hubfs/hub_generated/template_assets/1/34470224480/1741528337131/template_cr-framework__bulma-columns.min.css">
<link rel="stylesheet" href="https://www.cybereason.com/hs-fs/hubfs/hub_generated/template_assets/1/35291999472/1741528340159/template_cr-framework__bulma.min.css">
<link rel="stylesheet" href="https://www.cybereason.com/hs-fs/hubfs/hub_generated/template_assets/1/42363645447/1741528345735/template_hamburger-animation.min.css">
<link rel="stylesheet" href="https://www.cybereason.com/hs-fs/hubfs/hub_generated/template_assets/1/42507091846/1741528346726/template_animate.min.css">


    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;500;600;700;800;900&amp;display=swap" rel="stylesheet">
<script src="/hubfs/dam/plugins/marker-animation.js"></script>
<script>
$(document).ready(function() {
  $('.highlight').markerAnimation({
    "color":'var(--cr-yellow)',
    "font_weight":'normal',
    "background-size": '200% 1.2em'
  });
});
</script>

    <style>
.cr-mln__blog-post .container-is-blog.cr-mln__blog-post--body .column:nth-of-type(2) img {
    background: #FFFFFF;
    border: 1px solid #CCCCCC;
    border-radius: 5px 5px 5px 5px;
    padding: 10px;
} 
</style>

</head>
<body class="   hs-content-id-6180187469 hs-blog-post hs-blog-id-5272851739" style="">
<!--  Added by GoogleTagManager integration -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TJVVB7C" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

<!-- /Added by GoogleTagManager integration -->

    <div class="header-container-wrapper">
    <div class="header-container container-fluid">

<div class="row-fluid-wrapper row-depth-1 row-number-1 ">
<div class="row-fluid ">
<div class="span12 widget-span widget-type-custom_widget " style="" data-widget-type="custom_widget" data-x="0" data-w="12">
<div id="hs_cos_wrapper_module_1615433790649568" class="hs_cos_wrapper hs_cos_wrapper_widget hs_cos_wrapper_type_module" style="" data-hs-cos-general-type="widget" data-hs-cos-type="module"><section id="cr-malicious-life-network__tier-one-header" class="position-flex">
  <div class="#">
    <div id="logo"><a href="https://www.cybereason.com"><img src="https://www.cybereason.com/hubfs/dam/images/images-web/logos/cr-brand/cr-logo-inline--primary-black.png"></a></div>
    <div id="back-to">
      <a href="https://www.cybereason.com">Back to <span>Cybereason.com</span></a>
    </div>
    <!-- Hamburger Menu -->
    <button class="hamburger hamburger--collapse" type="button">
      <span class="hamburger-box">
        <span class="hamburger-inner"></span>
      </span>
    </button>
    <div class="cr-mln__hamburger-menu--overlay">
      <ul>
        <li><a href="https://www.cybereason.com/blog/all"><span class="underline">All Posts</span></a></li>
        <li><a href="/blog/category/research"><span class="underline">Research</span></a></li>
        <li><a href="/blog/category/podcasts"><span class="underline">Podcasts</span></a></li>
        <li><a href="/blog/category/webinars"><span class="underline">Webinars</span></a></li>
        <li><a href="/blog/category/resources"><span class="underline">Resources</span></a></li>
        <li><a href="/blog/category/videos"><span class="underline">Videos</span></a></li>
        <li><a href="/blog/category/news"><span class="underline">News</span></a></li>
      </ul>
      <div class="subscribe">
        <a href="#blog-subscribe">Subscribe</a>
      </div>
    </div>
    <!-- -->
  </div>
</section></div>

</div><!--end widget-span -->
</div><!--end row-->
</div><!--end row-wrapper -->

<div class="row-fluid-wrapper row-depth-1 row-number-2 ">
<div class="row-fluid ">
<div class="span12 widget-span widget-type-custom_widget mln-homepage" style="" data-widget-type="custom_widget" data-x="0" data-w="12">
<div id="hs_cos_wrapper_module_1615433785464566" class="hs_cos_wrapper hs_cos_wrapper_widget hs_cos_wrapper_type_module" style="" data-hs-cos-general-type="widget" data-hs-cos-type="module"><section class="cr-malicious-life-network__hero-main base">
  <div class="container-is-blog columns hero-content page-center">
    <div class="column is-5-fullhd is-5-desktop is-12-touch">
      <a href="/blog"><img class="cr-mln-logo" src="https://www.cybereason.com/hubfs/dam/images/images-web/logos/cr-brand/cr-malicious-life-logo-v2.png"></a>
    </div>
    <div class="column is-7-fullhd is-7-desktop is-hidden-mobile is-hidden-tablet-only">
      <div class="cr-mln__search-subscribe">
        <div class="cr-mln__search">
          <a href="#cr-search-modal" class="search-btn"><img src="https://www.cybereason.com/hubfs/dam/images/images-web/blog-images/template-images/cr-blog-icon--search-dark-gray.png" alt="Search"></a>
        </div>
        <div class="cr-mln__subscribe">
          <a class="btn-subscribe" href="#blog-subscribe">Subscribe</a>
        </div>
      </div>
      <div class="cr-mln__category-nav">
        <ul>
          <li><a href="/blog/category/all"><span class="underline">All</span></a></li>
          <li><a href="/blog/category/research"><span class="underline">Research</span></a></li>
          <li><a href="/blog/category/podcasts"><span class="underline">Podcasts</span></a></li>
          <li><a href="/blog/category/webinars"><span class="underline">Webinars</span></a></li>
          <li><a href="/blog/category/resources"><span class="underline">Resources</span></a></li>
          <li><a href="/blog/category/videos"><span class="underline">Videos</span></a></li>
          <li><a href="/blog/category/news"><span class="underline">News</span></a></li>
        </ul>
      </div>
    </div>
  </div>
      <!-- MOBILE Search and Subscribe -->
      <div class="container-is-blog columns is-gapless is-hidden-desktop cr-mln__search-subscribe--mobile">
        <div class="column">
          <a class="search-btn">Search</a>
        </div>
        <div class="column">
          <a class="#" href="#blog-subscribe">Subscribe</a>
        </div>
      </div>

      <!-- END MOBILE Search and Subscribe -->
  
  <!-- SEARCH Modal Wrap -->

  <div id="cr-search-modal">
        <!--THIS IS IMPORTANT! to close the modal, the class name has to match the name given on the ID -->
        <div id="btn-close-modal" class="close-cr-search-modal"> 
            X
        </div>

        <div class="modal-content">
            <div class="container columns">
              <div class="column">
                <div class="cr-search-modal__search-bar">
                  <h3>Search</h3>
                  <form action="/hs-search-results">
                    <input type="search" class="hs-search-field__input" name="term" autocomplete="on" placeholder="Search...">
                    <input type="hidden" name="type" value="BLOG_POST">
                    <input type="hidden" name="type" value="LISTING_PAGE">
                    <button type="submit" class="arrow"></button>
                  </form>
                  
                </div>

              </div>
          </div>
        </div>
    </div>
  <!-- END Search Modal Wrap -->

</section></div>

</div><!--end widget-span -->
</div><!--end row-->
</div><!--end row-wrapper -->

    </div><!--end header -->
</div><!--end header wrapper -->

<div class="body-container-wrapper">
    <div class="body-container container-fluid">

<div class="row-fluid-wrapper row-depth-1 row-number-1 ">
<div class="row-fluid ">
<div class="span12 widget-span widget-type-blog_content " style="" data-widget-type="blog_content" data-x="0" data-w="12">







<div class="cr-mln__blog-post">
  <div class="container-is-blog columns is-multiline page-center">

    <div class="column is-8-fullhd is-8-desktop is-offset-2-fullhd is-offset-2-desktop is-10-tablet is-offset-1-tablet">
      <div class="featured-image"><img src="https://www.cybereason.com/hubfs/dam/images/images-web/featured-images/cr-featured-image.png" alt=""></div>
      <h1><span id="hs_cos_wrapper_name" class="hs_cos_wrapper hs_cos_wrapper_meta_field hs_cos_wrapper_type_text" style="" data-hs-cos-general-type="meta_field" data-hs-cos-type="text">WannaMine Cryptominer that uses EternalBlue still active</span></h1>
      <div class="cr-mln__post-author-share">
      <div id="hubspot-author_data" class="hubspot-editable cr-mln__post-meta" data-hubspot-form-id="author_data" data-hubspot-name="Blog Author">
        
          <span class="descriptor">Written By</span>
          <p><span class="author">Cybereason Nocturnus</span></p>
         
      </div>
    </div>
     
    </div>
    
    <!-- Sticky Author and Social Box -->
    
    <!-- END Sticky Author and Social Box -->
      <div class="container-is-blog columns is-multiline page-center cr-mln__blog-post--body">
        
        <div class="column is-7-fullhd is-7-desktop is-10-tablet is-10-mobile is-offset-1-fullhd is-offset-1-desktop is-offset-1-tablet is-offset-1-mobile">
          <span id="hs_cos_wrapper_post_body" class="hs_cos_wrapper hs_cos_wrapper_meta_field hs_cos_wrapper_type_rich_text" style="" data-hs-cos-general-type="meta_field" data-hs-cos-type="rich_text"><h2>Research by Amit Serper</h2>
<p><span>A few days ago the Nocturnus team investigated a new outbreak of Wannamine. Wannamine is an attack based on the EternalBlue exploits that were leaked from the NSA last year. You probably remember those exploits since they were used in last year’s </span><a href="/blog/blog-what-is-the-wannacry-ransomware-attack-and-how-to-defend-against-it" rel="noopener" target="_blank"><span>WannaCry</span></a><span> and </span><a href="/blog/notpetya-costs-companies-1.2-billion-in-revenue" rel="noopener" target="_blank"><span>NotPetya</span></a><span> attacks.</span></p>
<p><span>Learn about our most recent cutting-edge research: <!--HubSpot Call-to-Action Code --><span class="hs-cta-wrapper" id="hs-cta-wrapper-5d884927-a051-4ae7-b129-94438da0638b"><span class="hs-cta-node hs-cta-5d884927-a051-4ae7-b129-94438da0638b" id="hs-cta-5d884927-a051-4ae7-b129-94438da0638b"><!--[if lte IE 8]><div id="hs-cta-ie-element"></div><![endif]--><a href="https://cta-redirect.hubspot.com/cta/redirect/3354902/5d884927-a051-4ae7-b129-94438da0638b" target="_blank" rel="noopener"><img class="hs-cta-img" id="hs-cta-img-5d884927-a051-4ae7-b129-94438da0638b" style="border-width:0px;" src="https://no-cache.hubspot.com/cta/default/3354902/5d884927-a051-4ae7-b129-94438da0638b.png" alt="Sign up for the Operation Soft Cell webinar"></a></span><script charset="utf-8" src="/hs/cta/cta/current.js"></script><script type="text/javascript"> hbspt.cta._relativeUrls=true;hbspt.cta.load(3354902, '5d884927-a051-4ae7-b129-94438da0638b', {"useNewLoader":"true","region":"na1"}); </script></span><!-- end HubSpot Call-to-Action Code --></span></p>
<!--more-->
<p><span style="font-weight: 400;">Wannamine penetrates computer systems through an unpatched SMB service and gains code execution with high privileges to then propagate across the network, gaining persistence and arbitrary code execution abilities on as many machines possible.</span></p>
<p><span style="font-weight: 400;">First off, WannaMine isn’t a </span><a href="https://news.google.com/search?q=wannamine&amp;hl=en-US&amp;gl=US&amp;ceid=US%3Aen" rel="noopener" target="_blank"><span style="font-weight: 400;">new attack</span></a><span style="font-weight: 400;">. Other </span><a href="https://www.pandasecurity.com/mediacenter/pandalabs/threat-hunting-fileless-attacks/" rel="noopener" target="_blank"><span style="font-weight: 400;">researchers have written about it</span></a><span style="font-weight: 400;"> and tech reporters have </span><a href="https://threatpost.com/cryptomining-gold-rush-one-gang-rakes-in-7m-over-6-months/130232/" rel="noopener" target="_blank"><span style="font-weight: 400;">news articles</span></a><span style="font-weight: 400;"> have covered it. </span><span style="font-weight: 400;">And that’s part of the problem (and why I’m publishing this research): the </span><span style="font-weight: 400;">EternalBlue exploits are well known. And how to prevent attacks that use these exploits is also well known: apply </span><a href="https://docs.microsoft.com/en-us/security-updates/securitybulletins/2017/ms17-010" rel="noopener" target="_blank"><span style="font-weight: 400;">a patch</span></a><span style="font-weight: 400;"> that Microsoft issued in March 2017. Yet </span><span style="font-weight: 400;">companies are still facing threats that use the </span><span style="font-weight: 400;">EternalBlue exploits. And until organizations patch and update their computers, they’ll continue to see attackers use these exploits for a simple reason: they lead to successful campaigns. Part of giving the defenders an advantage means making the attacker’s job more difficult by taking steps to boost an organization’s security. Patching vulnerabilities, especially the ones associated with EternalBlue, falls into this category.</span></p>
<p><span style="font-weight: 400;">Now that I’ve made the case for patching, let’s look into the technical details of this latest Wannamine outbreak.</span></p>
<p><span style="font-weight: 400;">The initial attack vector was exploitation of EternalBlue via an unpatched SMB server, like we saw with the WannaCry attack last May. Once code execution was gained, a PowerShell instance was spawned:</span></p>
<p><a rel="noopener" target="_blank" href="https://www.cybereason.com/hs-fs/hubfs/image8-9.png?"><span style="font-weight: 400;"><img src="https://www.cybereason.com/hubfs/image8-9.png" alt="Interface" style="width: 600px; display: block; margin: 0px auto;"></span></a></p>
<p><span style="font-weight: 400;"><img src="https://www.cybereason.com/hs-fs/hubfs/image6-6.png?width=655&amp;name=image6-6.png" alt="image6-6" width="655" style="width: 655px; display: block; margin: 0px auto;" srcset="https://www.cybereason.com/hs-fs/hubfs/image6-6.png?width=328&amp;name=image6-6.png 328w, https://www.cybereason.com/hs-fs/hubfs/image6-6.png?width=655&amp;name=image6-6.png 655w, https://www.cybereason.com/hs-fs/hubfs/image6-6.png?width=983&amp;name=image6-6.png 983w, https://www.cybereason.com/hs-fs/hubfs/image6-6.png?width=1310&amp;name=image6-6.png 1310w, https://www.cybereason.com/hs-fs/hubfs/image6-6.png?width=1638&amp;name=image6-6.png 1638w, https://www.cybereason.com/hs-fs/hubfs/image6-6.png?width=1965&amp;name=image6-6.png 1965w" sizes="(max-width: 655px) 100vw, 655px"><span>Notice the </span><i><span>Get-WmiObject</span></i><span> cmdlet: The attackers are using WMI to enumerate the bitness of the victim machine - 32bit or 64bit. Once the bitness is enumerated, the correct payload will be downloaded and executed - in3.ps1 for 32 bit machines and in6.ps1 for 64bit machines.</span></span></p>
<p><span style="font-weight: 400;">The downloaded payload is a very large text file. Most of it is base64 encoded along with some other text encoding and obfuscation tricks. In fact, the downloaded payload is so large (thanks to all of the obfuscation) that it makes most of the text editors hang and it’s quite impossible to load the entire base64’d string into an interactive ipython session.</span></p>
<p><span style="font-weight: 400;">Once deobfuscated we can see more PowerShell code. Reading through the PowerShell code, it is very easy to understand its purpose: WannaMine uses WMI and PowerShell extensively to move laterally across a network. In addition to the PowerShell code, which is written in plain ASCII strings, there are also other unidentified strings and some binary blobs inside that huge heap of text (since I simply de-base64’d everything in that file).</span></p>
<p><span style="font-weight: 400;">That binary blob, along with some more obfuscated text, is actually more code and a command to run the .NET compiler in order to compile a .NET DLL file.</span></p>
<p><strong>Important note:</strong><span style="font-weight: 400;"> the DLL will be compiled to a different, random, file name each time.</span></p>
<a rel="noopener" target="_blank" href="https://www.cybereason.com/hs-fs/hubfs/image5-9.png?t=1536871809061&amp;name=image5-9.png"><img src="https://www.cybereason.com/hubfs/image5-9.png" alt=".NET disassembler" style="width: 600px; display: block; margin: 0px auto;"></a><br>
<p><span style="font-weight: 400;">When we load that DLL into a .NET disassembler, we can clearly see that this is the </span><a href="https://www.pingcastle.com/" rel="noopener" target="_blank"><span style="font-weight: 400;">PingCastle scanner</span></a><span style="font-weight: 400;">, which was also mentioned in </span><a href="https://www.acalvio.com/wannmine-lateral-movement-techniques/" rel="noopener" target="_blank"><span style="font-weight: 400;">past reports</span></a><span style="font-weight: 400;"> about WannaMine. PingCastle’s job is to map the network and find the shortest path to the next exploitable machine by grabbing SMB information through the response packets sent by the SMB servers.</span></p>
<p><span style="font-weight: 400;">While PingCastle is running, there are other parts from the main PowerShell script still in motion, including a PowerShell implementation of Mimikatz. The interesting thing is that this made me realize that most of the code in that PowerShell script was copied verbatim from various GitHub repositories. For example, the PowerShell Mimikatz implementation is straight from the </span><a href="https://github.com/clymb3r/PowerShell/blob/master/Invoke-Mimikatz/Invoke-Mimikatz.ps1" rel="noopener" target="_blank"><span style="font-weight: 400;">invoke-mimikatz</span></a><span style="font-weight: 400;"> repository:</span></p>
<p style="text-align: center;"><span style="font-weight: 400;"><a rel="noopener" href="https://www.cybereason.com/hs-fs/hubfs/image10-6.png?t=1536871809061&amp;name=image10-6.png" target="_blank"><img src="https://www.cybereason.com/hs-fs/hubfs/image10-6.png?width=738&amp;name=image10-6.png" width="738" style="width: 738px; display: block; margin: 0px auto;" alt="powershell mimikatz code from the dropped powershell script" srcset="https://www.cybereason.com/hs-fs/hubfs/image10-6.png?width=369&amp;name=image10-6.png 369w, https://www.cybereason.com/hs-fs/hubfs/image10-6.png?width=738&amp;name=image10-6.png 738w, https://www.cybereason.com/hs-fs/hubfs/image10-6.png?width=1107&amp;name=image10-6.png 1107w, https://www.cybereason.com/hs-fs/hubfs/image10-6.png?width=1476&amp;name=image10-6.png 1476w, https://www.cybereason.com/hs-fs/hubfs/image10-6.png?width=1845&amp;name=image10-6.png 1845w, https://www.cybereason.com/hs-fs/hubfs/image10-6.png?width=2214&amp;name=image10-6.png 2214w" sizes="(max-width: 738px) 100vw, 738px"></a><span>PowerShell Mimikatz code from the dropped PowerShell script</span></span></p>
<p style="text-align: center;"><span style="font-weight: 400;"><a rel="noopener" href="https://www.cybereason.com/hs-fs/hubfs/image4-7.png?t=1536871809061&amp;name=image4-7.png" target="_blank"><img src="https://www.cybereason.com/hs-fs/hubfs/image4-7.png?width=600&amp;name=image4-7.png" alt="powershell mimikatz code from the original github repository" width="600" style="width: 600px; display: block; margin: 0px auto;" srcset="https://www.cybereason.com/hs-fs/hubfs/image4-7.png?width=300&amp;name=image4-7.png 300w, https://www.cybereason.com/hs-fs/hubfs/image4-7.png?width=600&amp;name=image4-7.png 600w, https://www.cybereason.com/hs-fs/hubfs/image4-7.png?width=900&amp;name=image4-7.png 900w, https://www.cybereason.com/hs-fs/hubfs/image4-7.png?width=1200&amp;name=image4-7.png 1200w, https://www.cybereason.com/hs-fs/hubfs/image4-7.png?width=1500&amp;name=image4-7.png 1500w, https://www.cybereason.com/hs-fs/hubfs/image4-7.png?width=1800&amp;name=image4-7.png 1800w" sizes="(max-width: 600px) 100vw, 600px"></a><span>PowerShell Mimikatz code from the original GitHub repository</span></span></p>
<p style="text-align: center;"><span style="font-weight: 400;"><a rel="noopener" href="https://www.cybereason.com/hs-fs/hubfs/image9-6.png?t=1536871809061&amp;name=image9-6.png" target="_blank"><img src="https://www.cybereason.com/hs-fs/hubfs/image9-6.png?width=979&amp;name=image9-6.png" alt="powershell mimikatz code from the dropped powershell script" width="979" style="width: 979px; display: block; margin: 0px auto;" srcset="https://www.cybereason.com/hs-fs/hubfs/image9-6.png?width=490&amp;name=image9-6.png 490w, https://www.cybereason.com/hs-fs/hubfs/image9-6.png?width=979&amp;name=image9-6.png 979w, https://www.cybereason.com/hs-fs/hubfs/image9-6.png?width=1469&amp;name=image9-6.png 1469w, https://www.cybereason.com/hs-fs/hubfs/image9-6.png?width=1958&amp;name=image9-6.png 1958w, https://www.cybereason.com/hs-fs/hubfs/image9-6.png?width=2448&amp;name=image9-6.png 2448w, https://www.cybereason.com/hs-fs/hubfs/image9-6.png?width=2937&amp;name=image9-6.png 2937w" sizes="(max-width: 979px) 100vw, 979px"></a><span>PowerShell Mimikatz code from the dropped PowerShell script</span></span></p>
<p style="text-align: center;"><span style="font-weight: 400;"><a rel="noopener" href="https://www.cybereason.com/hs-fs/hubfs/image3-10.png?t=1536871809061&amp;name=image3-10.png" target="_blank"><img src="https://www.cybereason.com/hs-fs/hubfs/image3-10.png?width=712&amp;name=image3-10.png" alt="powershell mimikatz code from the original github repository" width="712" style="width: 712px; display: block; margin: 0px auto;" srcset="https://www.cybereason.com/hs-fs/hubfs/image3-10.png?width=356&amp;name=image3-10.png 356w, https://www.cybereason.com/hs-fs/hubfs/image3-10.png?width=712&amp;name=image3-10.png 712w, https://www.cybereason.com/hs-fs/hubfs/image3-10.png?width=1068&amp;name=image3-10.png 1068w, https://www.cybereason.com/hs-fs/hubfs/image3-10.png?width=1424&amp;name=image3-10.png 1424w, https://www.cybereason.com/hs-fs/hubfs/image3-10.png?width=1780&amp;name=image3-10.png 1780w, https://www.cybereason.com/hs-fs/hubfs/image3-10.png?width=2136&amp;name=image3-10.png 2136w" sizes="(max-width: 712px) 100vw, 712px"></a><span>PowerShell Mimikatz code from the original GitHub repository</span></span></p>
<p><span style="font-weight: 400;">The PowerShell script will also change the power management settings on the infected machine just before the miners are dropped to prevent the machine from going to sleep and maximize mining power availability:</span></p>
<img src="https://www.cybereason.com/hs-fs/hubfs/image11-5.png?width=1041&amp;name=image11-5.png" alt="image11-5" width="1041" style="width: 1041px; display: block; margin: 0px auto;" srcset="https://www.cybereason.com/hs-fs/hubfs/image11-5.png?width=521&amp;name=image11-5.png 521w, https://www.cybereason.com/hs-fs/hubfs/image11-5.png?width=1041&amp;name=image11-5.png 1041w, https://www.cybereason.com/hs-fs/hubfs/image11-5.png?width=1562&amp;name=image11-5.png 1562w, https://www.cybereason.com/hs-fs/hubfs/image11-5.png?width=2082&amp;name=image11-5.png 2082w, https://www.cybereason.com/hs-fs/hubfs/image11-5.png?width=2603&amp;name=image11-5.png 2603w, https://www.cybereason.com/hs-fs/hubfs/image11-5.png?width=3123&amp;name=image11-5.png 3123w" sizes="(max-width: 1041px) 100vw, 1041px"><br>
<p><span style="font-weight: 400;">After the power settings on the machine was reconfigured, we started seeing hundreds of powershell.exe processes using a lot of CPU cycles and connecting to mining pool servers:</span></p>
<p><a rel="noopener" href="https://www.cybereason.com/hs-fs/hubfs/image1-17.png?t=1536871809061&amp;name=image1-17.png" target="_blank"><span style="font-weight: 400;"><img src="https://www.cybereason.com/hs-fs/hubfs/image1-17.png?width=682&amp;name=image1-17.png" alt="interface" width="682" style="width: 682px; display: block; margin: 0px auto;" srcset="https://www.cybereason.com/hs-fs/hubfs/image1-17.png?width=341&amp;name=image1-17.png 341w, https://www.cybereason.com/hs-fs/hubfs/image1-17.png?width=682&amp;name=image1-17.png 682w, https://www.cybereason.com/hs-fs/hubfs/image1-17.png?width=1023&amp;name=image1-17.png 1023w, https://www.cybereason.com/hs-fs/hubfs/image1-17.png?width=1364&amp;name=image1-17.png 1364w, https://www.cybereason.com/hs-fs/hubfs/image1-17.png?width=1705&amp;name=image1-17.png 1705w, https://www.cybereason.com/hs-fs/hubfs/image1-17.png?width=2046&amp;name=image1-17.png 2046w" sizes="(max-width: 682px) 100vw, 682px"></span></a></p>
<p><span style="font-weight: 400;">That tells us that the cryptominers are actually running within PowerShell. However, when looking at the command line in these PowerShell executions, we don’t really see anything indicative of that behavior.</span></p>
<a rel="noopener" href="https://www.cybereason.com/hs-fs/hubfs/image7-7.png?t=1536871809061&amp;name=image7-7.png" target="_blank"><img src="https://www.cybereason.com/hs-fs/hubfs/image7-7.png?width=670&amp;name=image7-7.png" alt="interface" width="670" style="width: 670px; display: block; margin: 0px auto;" srcset="https://www.cybereason.com/hs-fs/hubfs/image7-7.png?width=335&amp;name=image7-7.png 335w, https://www.cybereason.com/hs-fs/hubfs/image7-7.png?width=670&amp;name=image7-7.png 670w, https://www.cybereason.com/hs-fs/hubfs/image7-7.png?width=1005&amp;name=image7-7.png 1005w, https://www.cybereason.com/hs-fs/hubfs/image7-7.png?width=1340&amp;name=image7-7.png 1340w, https://www.cybereason.com/hs-fs/hubfs/image7-7.png?width=1675&amp;name=image7-7.png 1675w, https://www.cybereason.com/hs-fs/hubfs/image7-7.png?width=2010&amp;name=image7-7.png 2010w" sizes="(max-width: 670px) 100vw, 670px"></a><br>
<table>
<tbody>
<tr>
<td>
<p><span style="font-weight: 400;">"C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe" -NoP -NonI -W Hidden "$mon = ([WmiClass] 'root\default:systemcore_Updater').Properties['mon'].Value;$funs = ([WmiClass] 'root\default:systemcore_Updater').Properties['funs'].Value ;iex ([System.Text.Encoding]::ASCII.GetString([System.Convert]::FromBase64String($funs)));Invoke-Command -ScriptBlock $RemoteScriptBlock -ArgumentList @($mon, $mon, 'Void', 0, '', '')"</span></p>
<br><br></td>
</tr>
</tbody>
</table>
<p><span style="font-weight: 400;">When examining the command line, we can see that a WMI class, </span><i><span style="font-weight: 400;">root\default:systemcore_Updater</span></i><span style="font-weight: 400;">,</span> <span style="font-weight: 400;">is being accessed. This class holds the version of the currently installed version of the Wannamine malware.</span></p>
<p><span style="font-weight: 400;">As for persistence, we can see that the malware installed a WMI filter, consumer and binder to gain persistent execution through WMI intrinsic events.</span></p>
<p><a rel="noopener" href="https://www.cybereason.com/hs-fs/hubfs/image12-6.png?t=1536871809061&amp;name=image12-6.png" target="_blank"><span style="font-weight: 400;"><img src="https://www.cybereason.com/hs-fs/hubfs/image12-6.png?width=702&amp;name=image12-6.png" alt="Querying for WMI persistent objects across the entire organization" width="702" style="width: 702px; display: block; margin: 0px auto;" srcset="https://www.cybereason.com/hs-fs/hubfs/image12-6.png?width=351&amp;name=image12-6.png 351w, https://www.cybereason.com/hs-fs/hubfs/image12-6.png?width=702&amp;name=image12-6.png 702w, https://www.cybereason.com/hs-fs/hubfs/image12-6.png?width=1053&amp;name=image12-6.png 1053w, https://www.cybereason.com/hs-fs/hubfs/image12-6.png?width=1404&amp;name=image12-6.png 1404w, https://www.cybereason.com/hs-fs/hubfs/image12-6.png?width=1755&amp;name=image12-6.png 1755w, https://www.cybereason.com/hs-fs/hubfs/image12-6.png?width=2106&amp;name=image12-6.png 2106w" sizes="(max-width: 702px) 100vw, 702px"></span></a></p>
<p style="text-align: center;"><span style="font-weight: 400;"><span>Querying for WMI persistent objects across the entire organization</span></span></p>
<p><span style="font-weight: 400;">When looking at WMI persistent objects across the entire organization, we can see that many machines have a WMI autorun associated with them. When we look at the </span><i><span style="font-weight: 400;">consumer action</span></i><span style="font-weight: 400;"> (which defines which action to take once the intrinsic WMI event is consumed and handled) we &nbsp;see, yet again, a blob of base64 encoded data.</span></p>
<p><span style="font-weight: 400;">When decoded, we get about 120 lines of PowerShell code. Here are some of its highlights:</span></p>
<p><a rel="noopener" href="https://www.cybereason.com/hs-fs/hubfs/image13-7.png?t=1536871809061&amp;name=image13-7.png" target="_blank"><span style="font-weight: 400;"><img src="https://www.cybereason.com/hs-fs/hubfs/image13-7.png?width=753&amp;name=image13-7.png" alt="code blurb decoded" width="753" style="width: 753px; display: block; margin: 0px auto;" srcset="https://www.cybereason.com/hs-fs/hubfs/image13-7.png?width=377&amp;name=image13-7.png 377w, https://www.cybereason.com/hs-fs/hubfs/image13-7.png?width=753&amp;name=image13-7.png 753w, https://www.cybereason.com/hs-fs/hubfs/image13-7.png?width=1130&amp;name=image13-7.png 1130w, https://www.cybereason.com/hs-fs/hubfs/image13-7.png?width=1506&amp;name=image13-7.png 1506w, https://www.cybereason.com/hs-fs/hubfs/image13-7.png?width=1883&amp;name=image13-7.png 1883w, https://www.cybereason.com/hs-fs/hubfs/image13-7.png?width=2259&amp;name=image13-7.png 2259w" sizes="(max-width: 753px) 100vw, 753px"></span></a></p>
<p><span style="font-weight: 400;">This block extracts the functions from the </span><i><span style="font-weight: 400;">root\default:Office_Updater</span></i><span style="font-weight: 400;"> WMI class in their base64 and then decodes them. Once decoded, the script will execute those commands by invoking them (</span><i><span style="font-weight: 400;">iex $defun</span></i><i><span style="font-weight: 400;">)</span></i><span style="font-weight: 400;">. </span></p>
<p><span style="font-weight: 400;">The script then looks for other </span><i><span style="font-weight: 400;">FilterToConsumerBinders </span></i><span style="font-weight: 400;">and removes them.</span></p>
<a rel="noopener" href="https://www.cybereason.com/hs-fs/hubfs/image15-6.png?t=1536871809061&amp;name=image15-6.png" target="_blank"><img src="https://www.cybereason.com/hs-fs/hubfs/image15-6.png?width=661&amp;name=image15-6.png" alt="FilterToConsumerBinders removed" width="661" style="width: 661px; display: block; margin: 0px auto;" srcset="https://www.cybereason.com/hs-fs/hubfs/image15-6.png?width=331&amp;name=image15-6.png 331w, https://www.cybereason.com/hs-fs/hubfs/image15-6.png?width=661&amp;name=image15-6.png 661w, https://www.cybereason.com/hs-fs/hubfs/image15-6.png?width=992&amp;name=image15-6.png 992w, https://www.cybereason.com/hs-fs/hubfs/image15-6.png?width=1322&amp;name=image15-6.png 1322w, https://www.cybereason.com/hs-fs/hubfs/image15-6.png?width=1653&amp;name=image15-6.png 1653w, https://www.cybereason.com/hs-fs/hubfs/image15-6.png?width=1983&amp;name=image15-6.png 1983w" sizes="(max-width: 661px) 100vw, 661px"></a>
<p><strong>Important note: The script will then try to list all the processes that are connecting to IP address ports 3333, 5555 and 7777 and, if there are any active processes, the script will terminate them. This Wannamine variant connects to mining pools on port 14444 while other variants of this attack are connecting to mining pools on more standardized ports like 3333, 5555 and 7777. If any other processes on this machine are connected to mining pools on the standard ports, </strong><strong>they will be terminated.</strong></p>
<p><span style="font-weight: 400;">Once that process is finished, it’s time to extract more values from the data that is stored within the WMI classes:</span></p>
<a rel="noopener" href="https://www.cybereason.com/hs-fs/hubfs/image2-13.png?t=1536871809061&amp;name=image2-13.png" target="_blank"><img src="https://www.cybereason.com/hs-fs/hubfs/image2-13.png?width=730&amp;name=image2-13.png" alt="extracted values from the data that is stored" width="730" style="width: 730px; display: block; margin: 0px auto;" srcset="https://www.cybereason.com/hs-fs/hubfs/image2-13.png?width=365&amp;name=image2-13.png 365w, https://www.cybereason.com/hs-fs/hubfs/image2-13.png?width=730&amp;name=image2-13.png 730w, https://www.cybereason.com/hs-fs/hubfs/image2-13.png?width=1095&amp;name=image2-13.png 1095w, https://www.cybereason.com/hs-fs/hubfs/image2-13.png?width=1460&amp;name=image2-13.png 1460w, https://www.cybereason.com/hs-fs/hubfs/image2-13.png?width=1825&amp;name=image2-13.png 1825w, https://www.cybereason.com/hs-fs/hubfs/image2-13.png?width=2190&amp;name=image2-13.png 2190w" sizes="(max-width: 730px) 100vw, 730px"></a><br>
<p><span style="font-weight: 400;">The long (and truncated since it’s too big to fit in that screenshot) command will execute the cryptominer by invoking all of the commands that are stored in the </span><i><span style="font-weight: 400;">$funs </span></i><span style="font-weight: 400;">variable. Then, additional functionality will be extracted from other values in the </span><i><span style="font-weight: 400;">Office_Updater</span></i><span style="font-weight: 400;"> class.</span></p>
<p><span style="font-weight: 400;">These are the most notable variables:</span></p>
<ul>
<li style="font-weight: 400;"><i><span style="font-weight: 400;">$mimi</span></i><span style="font-weight: 400;"> = PowerShell Mimikatz</span></li>
<li style="font-weight: 400;"><i><span style="font-weight: 400;">$NTLM</span></i><span style="font-weight: 400;"> &nbsp;= Extracted NTLM hashes for lateral movement</span></li>
<li style="font-weight: 400;"><i><span style="font-weight: 400;">$scba</span></i><span style="font-weight: 400;"> = Scheduled task information for persistence</span></li>
<li style="font-weight: 400;"><i><span style="font-weight: 400;">$i17</span></i><span style="font-weight: 400;"> = A list of IP addresses to be targeted. The IP addresses in $i17 are vulnerable to EternalBlue as gathered by the PingCastle scanner:</span></li>
</ul>
<p><img src="https://www.cybereason.com/hs-fs/hubfs/image14-7.png?width=544&amp;name=image14-7.png" alt="PingCastle scanner" width="544" style="width: 544px; display: block; margin: 0px auto;" srcset="https://www.cybereason.com/hs-fs/hubfs/image14-7.png?width=272&amp;name=image14-7.png 272w, https://www.cybereason.com/hs-fs/hubfs/image14-7.png?width=544&amp;name=image14-7.png 544w, https://www.cybereason.com/hs-fs/hubfs/image14-7.png?width=816&amp;name=image14-7.png 816w, https://www.cybereason.com/hs-fs/hubfs/image14-7.png?width=1088&amp;name=image14-7.png 1088w, https://www.cybereason.com/hs-fs/hubfs/image14-7.png?width=1360&amp;name=image14-7.png 1360w, https://www.cybereason.com/hs-fs/hubfs/image14-7.png?width=1632&amp;name=image14-7.png 1632w" sizes="(max-width: 544px) 100vw, 544px"></p>
<p><span style="font-weight: 400;">As I mentioned earlier, Wannamine isn’t a new attack. It leverages the EternalBlue vulnerabilities that were used to wreak havoc around the world almost </span><strong>a year and a half ago. </strong><span style="font-weight: 400;">But more than a year later, we’re still seeing organizations severely impacted by attacks based on these exploits. There’s no reason for security analysts to still be handling incidents that involve attackers leveraging EternalBlue. And there’s no reason why these exploits should remain unpatched. Organizations need to install security patches and update machines. </span></p>
<p><span style="font-weight: 400;">But that’s not all. Some of the IP addresses associated with Wannamine servers are still active although they were disclosed in security reports more than a year ago. We emailed the providers hosting those servers and haven’t heard back yet. In the meantime, we strongly recommend blocking these IPs:</span></p>
<p><span style="font-weight: 400;">118.184.48.95</span><span style="font-weight: 400;"><br></span><span style="font-weight: 400;">104.148.42.153</span><span style="font-weight: 400;"><br></span><span style="font-weight: 400;">107.179.67.243</span><span style="font-weight: 400;"><br></span><span style="font-weight: 400;">172.247.116.8</span><span style="font-weight: 400;"><br></span><span style="font-weight: 400;">172.247.116.87</span><span style="font-weight: 400;"><br></span><span style="font-weight: 400;">45.199.154.141</span><span style="font-weight: 400;"><br></span></p>
<p><span style="font-weight: 400;">The code and mechanisms behind the Wannamine attack aren’t sophisticated: they are the product of hacking third party code (like the PingCastle scanner) and copying and pasting massive amounts of code, sometimes verbatim, from a Github repositories.<br></span></p>
<p><span style="font-weight: 400;">Protect your team with a strong defense.</span></p>
<p><span style="font-weight: 400;"><!--HubSpot Call-to-Action Code --><span class="hs-cta-wrapper" id="hs-cta-wrapper-db7ec7b0-6c73-4af6-86ce-58fe37cec1e0"><span class="hs-cta-node hs-cta-db7ec7b0-6c73-4af6-86ce-58fe37cec1e0" id="hs-cta-db7ec7b0-6c73-4af6-86ce-58fe37cec1e0"><!--[if lte IE 8]><div id="hs-cta-ie-element"></div><![endif]--><a href="https://cta-redirect.hubspot.com/cta/redirect/3354902/db7ec7b0-6c73-4af6-86ce-58fe37cec1e0" target="_blank" rel="noopener"><img class="hs-cta-img" id="hs-cta-img-db7ec7b0-6c73-4af6-86ce-58fe37cec1e0" style="border-width:0px;" src="https://no-cache.hubspot.com/cta/default/3354902/db7ec7b0-6c73-4af6-86ce-58fe37cec1e0.png" alt="Read how to create a closed-loop security process with MITRE ATT&amp;CK."></a></span><script charset="utf-8" src="/hs/cta/cta/current.js"></script><script type="text/javascript"> hbspt.cta._relativeUrls=true;hbspt.cta.load(3354902, 'db7ec7b0-6c73-4af6-86ce-58fe37cec1e0', {"useNewLoader":"true","region":"na1"}); </script></span><!-- end HubSpot Call-to-Action Code --></span></p></span>
          
          <!-- IOC PopUp Modal -->
          
          
          
          <!-- -->
          
          <!-- Social Share -->
          <div class="cr-blog-post__social-sharing">
            <span>Share</span>
            <div id="hs_cos_wrapper_module_161724375084957" class="hs_cos_wrapper hs_cos_wrapper_widget hs_cos_wrapper_type_module widget-type-social_sharing" style="" data-hs-cos-general-type="widget" data-hs-cos-type="module">






<div class="hs_cos_wrapper hs_cos_wrapper_widget hs_cos_wrapper_type_social_sharing" data-hs-cos-general-type="widget" data-hs-cos-type="social_sharing">
  
	
  
    
    
    
			
		

    <a href="https://twitter.com/intent/tweet?original_referer=https://www.cybereason.com/blog/research/wannamine-cryptominer-eternalblue-wannacry&amp;utm_medium=social&amp;utm_source=twitter&amp;url=https://www.cybereason.com/blog/research/wannamine-cryptominer-eternalblue-wannacry&amp;utm_medium=social&amp;utm_source=twitter&amp;source=tweetbutton&amp;text=" target="_blank" rel="noopener" style="width:16px;">
      <img src="https://www.cybereason.com/hubfs/dam/images/images-web/blog-images/template-images/twitter-gray.svg" class="hs-image-widget hs-image-social-sharing-24" style="height:16px;width:16px;" width="16" hspace="0" alt="Share on twitter">
    </a>
	

  
	
  
    
    
    
			
		

    <a href="http://www.facebook.com/share.php?u=https://www.cybereason.com/blog/research/wannamine-cryptominer-eternalblue-wannacry&amp;utm_medium=social&amp;utm_source=facebook" target="_blank" rel="noopener" style="width:16px;">
      <img src="https://www.cybereason.com/hubfs/dam/images/images-web/blog-images/template-images/facebook-gray.svg" class="hs-image-widget hs-image-social-sharing-24" style="height:16px;width:16px;" width="16" hspace="0" alt="Share on facebook">
    </a>
	

  
	
  
    
    
    
			
		

    <a href="http://www.linkedin.com/shareArticle?mini=true&amp;url=https://www.cybereason.com/blog/research/wannamine-cryptominer-eternalblue-wannacry&amp;utm_medium=social&amp;utm_source=linkedin" target="_blank" rel="noopener" style="width:16px;">
      <img src="https://www.cybereason.com/hubfs/dam/images/images-web/blog-images/template-images/linkedin-gray.svg" class="hs-image-widget hs-image-social-sharing-24" style="height:16px;width:16px;" width="16" hspace="0" alt="Share on linkedin">
    </a>
	

</div></div>
          </div> 
          
          
          <!-- CONDITIONAL Author Box Display -->
            <div class="container columns cr-mln__author-listing-single">
              
                <div class="column headshot is-3-full-hd is-3-desktop is-3-tablet is-12-mobile">
                  <img class="cr-speaker-headshot" src="https://www.cybereason.com/hubfs/CR_Owl_Web_Mono@3x%202.png" alt="Cybereason Nocturnus">
                </div>
              
              <div class="column is-9-full-hd is-9-desktop is-12-mobile">
                <span class="descriptor">About the Author</span>
                <h4>Cybereason Nocturnus</h4>
                
                  <a class="social" href="https://www.linkedin.com/company/cybereason" target="_blank">
                    <img src="https://www.cybereason.com/hubfs/dam/images/images-web/blog-images/template-images/icon-social-gray-linkedin.png">
                  </a>
                
                
                  <a class="social" href="https://twitter.com/cr_nocturnus" target="_blank">
                    <img src="https://www.cybereason.com/hubfs/dam/images/images-web/blog-images/template-images/icon-social-gray-twitter.svg">
                  </a>
                
                
                  <p>The Cybereason Nocturnus Team has brought the world’s brightest minds from the military, government intelligence, and enterprise security to uncover emerging threats across the globe. They specialize in analyzing new attack methodologies, reverse-engineering malware, and exposing unknown system vulnerabilities. The Cybereason Nocturnus Team was the first to release a vaccination for the 2017 NotPetya and Bad Rabbit cyberattacks.</p>
                
                
                  <a class="cr-button cr-button__min" href="https://www.cybereason.com/blog/authors/cybereason-nocturnus">All Posts by Cybereason Nocturnus</a>
                
              </div>            
            </div>
          
        <!-- CONDITIONAL Post Type Choices -->
        
        <!-- Malicious Life Post -->
        
        
        <!-- CISO Stories -->
        
        <!-- Webinar -->
        
          
        <!-- CONDITIONAL Transcript -->
          
        
         <!-- Related Posts -->
        <div id="hs_cos_wrapper_module_1649342860525315" class="hs_cos_wrapper hs_cos_wrapper_widget hs_cos_wrapper_type_module" style="" data-hs-cos-general-type="widget" data-hs-cos-type="module">
<section class="cr-section related-posts__wrapper">
  <div class="container container-is-blog page-center">
     <h3>Related Posts</h3>
     <div class="columns is-multiline">
       
  
 <div class="column is-6-fullhd is-6-desktop is-full-mobile blog-listing__single-post">
  <div class="text-content-bundle">
    <a href="https://www.cybereason.com/blog/research/powerless-trojan-iranian-apt-phosphorus-adds-new-powershell-backdoor-for-espionage"><img src="https://www.cybereason.com/hubfs/powerless.png" alt="PowerLess Trojan: Iranian APT Phosphorus Adds New PowerShell Backdoor for Espionage"></a>
    <h4><a href="https://www.cybereason.com/blog/research/powerless-trojan-iranian-apt-phosphorus-adds-new-powershell-backdoor-for-espionage"><span class="underline">PowerLess Trojan: Iranian APT Phosphorus Adds New PowerShell Backdoor for Espionage</span></a></h4>
     <p>Cybereason discovered a new toolset developed by Iranian APT Phosphorus which revealed a connection to Memento ransomware and includes the newly discovered PowerLess Backdoor that evades detection by running PowerShell in a .NET context...</p>
   </div>
 </div>


  
 <div class="column is-6-fullhd is-6-desktop is-full-mobile blog-listing__single-post">
  <div class="text-content-bundle">
    <a href="https://www.cybereason.com/blog/threat-analysis-report-all-paths-lead-to-cobalt-strike-icedid-emotet-and-qbot"><img src="https://www.cybereason.com/hubfs/Threat%20Alert%20template%20%284%29%20%281%29.png" alt="THREAT ANALYSIS: Cobalt Strike - IcedID, Emotet and QBot"></a>
    <h4><a href="https://www.cybereason.com/blog/threat-analysis-report-all-paths-lead-to-cobalt-strike-icedid-emotet-and-qbot"><span class="underline">THREAT ANALYSIS: Cobalt Strike - IcedID, Emotet and QBot</span></a></h4>
     <p>The Cybereason GSOC delivers details on three recently observed attack scenarios where fast-moving malicious actors used the malware loaders IcedID, QBot and Emotet to deploy the Cobalt Strike framework on the compromised systems...</p>
   </div>
 </div>



    </div>
  </div>
</section></div>
          
          
      </div>
        
        <!-- Sidebar -->

      <div class="column is-3-fullhd is-3-desktop is-12-mobile cr-malicious-life-network__sidebar">
        <div class="cr-ml-sidebar--group">
        <div class="top-stripe"></div>
        <div class="sidebar-block search-section">
          <form action="/hs-search-results">
            <input type="search" class="hs-search-field__input" name="term" autocomplete="on" placeholder="Search">
            <input type="hidden" name="type" value="BLOG_POST">
            <input type="hidden" name="type" value="LISTING_PAGE">
            <button type="submit" class="arrow"></button>
          </form>
        </div>
        <div class="sidebar-block subscribe">
          <a href="#blog-subscribe">
            <h4>Subscribe</h4>
            <span>Never miss a blog.</span>
          </a>
        </div>

        <div class="sidebar-block recent-posts">
          <h4>Recent Posts</h4>
          
            
                <div class="recent-posts__single-post">
                    <div class="text-content-bundle">
                        <a href="https://www.cybereason.com/blog/identifying-and-preventing-bin-attacks" class="post-name"><span class="underline">Cracking the Code: How to Identify, Mitigate, and Prevent BIN Attacks</span></a>
                       
                    </div>
                </div>
            
                <div class="recent-posts__single-post">
                    <div class="text-content-bundle">
                        <a href="https://www.cybereason.com/blog/zero-day-vulnerabilities-vmware" class="post-name"><span class="underline">Three Zero-Day Vulnerabilities Discovered in VMware Products</span></a>
                       
                    </div>
                </div>
            
                <div class="recent-posts__single-post">
                    <div class="text-content-bundle">
                        <a href="https://www.cybereason.com/blog/bec-email-signature-technique" class="post-name"><span class="underline">Deceptive Signatures: Advanced Techniques in BEC Attacks</span></a>
                       
                    </div>
                </div>
            
        </div>

        <div class="sidebar-block category-listing">
          <h4>Categories</h4>
          <ul>
            <li><a href="https://www.cybereason.com/blog/category/research">Research</a></li>
            <li><a href="https://www.cybereason.com/blog/category/podcasts">Podcasts</a></li>
            <li><a href="https://www.cybereason.com/blog/category/webinars">Webinars</a></li>
            <li><a href="https://www.cybereason.com/blog/category/resources">Resources</a></li>
            <li><a href="https://www.cybereason.com/blog/category/videos">Videos</a></li>
            <li><a href="https://www.cybereason.com/blog/category/news">News</a></li>
          </ul>

          <a class="rec-category__single--view-all" href="/blog/category/research">All Posts</a>
        </div>

        
      </div><!-- END .rec-categories__all -->
      
      
      
    </div>
       
    </div>
  </div>
</div></div>

</div><!--end row-->
</div><!--end row-wrapper -->

<div class="row-fluid-wrapper row-depth-1 row-number-2 ">
<div class="row-fluid ">
<div class="span12 widget-span widget-type-custom_widget " style="display: none;" data-widget-type="custom_widget" data-x="0" data-w="12">
<div id="hs_cos_wrapper_module_1616011887658867" class="hs_cos_wrapper hs_cos_wrapper_widget hs_cos_wrapper_type_module" style="" data-hs-cos-general-type="widget" data-hs-cos-type="module">
<section class="cr-section related-posts__wrapper">
  <div class="container container-is-blog page-center">
     <h3>Related Posts</h3>
     <div class="columns is-multiline">
       
  
 <div class="column is-6-fullhd is-6-desktop is-full-mobile blog-listing__single-post">
  <div class="text-content-bundle">
    <a href="https://www.cybereason.com/blog/research/powerless-trojan-iranian-apt-phosphorus-adds-new-powershell-backdoor-for-espionage"><img src="https://www.cybereason.com/hubfs/powerless.png" alt="PowerLess Trojan: Iranian APT Phosphorus Adds New PowerShell Backdoor for Espionage"></a>
    <h4><a href="https://www.cybereason.com/blog/research/powerless-trojan-iranian-apt-phosphorus-adds-new-powershell-backdoor-for-espionage"><span class="underline">PowerLess Trojan: Iranian APT Phosphorus Adds New PowerShell Backdoor for Espionage</span></a></h4>
     <p>Cybereason discovered a new toolset developed by Iranian APT Phosphorus which revealed a connection to Memento ransomware and includes the newly discovered PowerLess Backdoor that evades detection by running PowerShell in a .NET context...</p>
   </div>
 </div>


  
 <div class="column is-6-fullhd is-6-desktop is-full-mobile blog-listing__single-post">
  <div class="text-content-bundle">
    <a href="https://www.cybereason.com/blog/threat-analysis-report-all-paths-lead-to-cobalt-strike-icedid-emotet-and-qbot"><img src="https://www.cybereason.com/hubfs/Threat%20Alert%20template%20%284%29%20%281%29.png" alt="THREAT ANALYSIS: Cobalt Strike - IcedID, Emotet and QBot"></a>
    <h4><a href="https://www.cybereason.com/blog/threat-analysis-report-all-paths-lead-to-cobalt-strike-icedid-emotet-and-qbot"><span class="underline">THREAT ANALYSIS: Cobalt Strike - IcedID, Emotet and QBot</span></a></h4>
     <p>The Cybereason GSOC delivers details on three recently observed attack scenarios where fast-moving malicious actors used the malware loaders IcedID, QBot and Emotet to deploy the Cobalt Strike framework on the compromised systems...</p>
   </div>
 </div>



    </div>
  </div>
</section></div>

</div><!--end widget-span -->
</div><!--end row-->
</div><!--end row-wrapper -->

<div class="row-fluid-wrapper row-depth-1 row-number-3 ">
<div class="row-fluid ">
<div class="span12 widget-span widget-type-custom_widget " style="" data-widget-type="custom_widget" data-x="0" data-w="12">
<div id="hs_cos_wrapper_module_161767462015235" class="hs_cos_wrapper hs_cos_wrapper_widget hs_cos_wrapper_type_module widget-type-blog_subscribe" style="" data-hs-cos-general-type="widget" data-hs-cos-type="module"><div class="cr-mln__blog-listing-page__subscribe-footer">
  <div class="container container-is-blog columns page-center">
    <div class="column is-8-fullhd is-8-desktop is-10-tablet is-12-mobile">
      <span class="tag">NEWSLETTER</span>
      <h3>Never miss a blog</h3>
      <p>Get the latest research, expert insights, and security industry news.</p>
      <a class="cr-button cr-mln__subscribe" href="#blog-subscribe">Subscribe</a>
    </div>
    <!--<div class="column is-5-fullhd is-5-desktop is-half-tablet is-12-mobile is-offset-1-fullhd is-offset-1-desktop">
      <div class="inputs-wrapper">
        
        
      </div>
    </div>-->
  </div>
</div></div>

</div><!--end widget-span -->
</div><!--end row-->
</div><!--end row-wrapper -->

<div class="row-fluid-wrapper row-depth-1 row-number-4 ">
<div class="row-fluid ">
<div class="span12 widget-span widget-type-custom_widget " style="" data-widget-type="custom_widget" data-x="0" data-w="12">
<div id="hs_cos_wrapper_module_166508001252918" class="hs_cos_wrapper hs_cos_wrapper_widget hs_cos_wrapper_type_module" style="" data-hs-cos-general-type="widget" data-hs-cos-type="module"><div class="cr-sticky-cta-bar bg-black" id="sticky-bar">
  <div class="content">
    <span>Want to see the Cybereason Defense Platform in action?</span>
    <a class="cr-button cr-button__fill-yellow" href="https://www.cybereason.com/request-a-demo" target="_blank">Schedule a Demo</a>
  </div>
  <div class="close">X</div>
</div></div>

</div><!--end widget-span -->
</div><!--end row-->
</div><!--end row-wrapper -->

    </div><!--end body -->
</div><!--end body wrapper -->

<div class="footer-container-wrapper">
    <div class="footer-container container-fluid">

<div class="row-fluid-wrapper row-depth-1 row-number-1 ">
<div class="row-fluid ">
<div class="span12 widget-span widget-type-custom_widget " style="" data-widget-type="custom_widget" data-x="0" data-w="12">
<div id="hs_cos_wrapper_module_16036762394194314" class="hs_cos_wrapper hs_cos_wrapper_widget hs_cos_wrapper_type_module" style="" data-hs-cos-general-type="widget" data-hs-cos-type="module"><!-- FOOTER -->

<footer class="cr-section cr-footer cr-footer__full">
    <div class="container page-center">
      <div class="columns">
          <div class="column is-6-fullhd is-5-desktop cr-footer__col cr-footer__left">
            <div class="cr-footer__Left-logo">
              
                <a href="https://www.cybereason.com">
                  
                <img src="https://www.cybereason.com/hubfs/dam/images/images-web/logos/cr-brand/cr-logo-inline--primary-white.png">
              </a>
            </div>
          </div>
          <div class="columns column is-6-fullhd is-6-desktop cr-footer__col cr-footer__right">
            <div class="cr-footer__links-list column">
              <h4>About</h4>
              <ul>
                <li><a href="https://www.cybereason.com/company/who-we-are">Who We Are</a>
                </li><li><a href="https://www.cybereason.com/company/careers">Careers</a>
          <!-- </li><li><a href="https://www.cybereason.com/company/leadership">Leadership</a> --->
                </li><li><a href="https://www.cybereason.com/company/contact-us">Contact</a>
              </li></ul>
            </div>
            <div class="cr-footer__links-list column">
              <h4>Resources</h4>
              <ul>
                <li><a href="https://www.cybereason.com/blog">Blog</a></li>
                <li><a href="https://www.cybereason.com/resources/tag/case-study">Case Studies</a></li>
                <li><a href="https://www.cybereason.com/resources/tag/webinars">Webinars</a></li>
                <li><a href="https://www.cybereason.com/resources/tag/white-papers">White Papers</a></li>
             </ul>
            </div>
            <div class="cr-footer__links-list column">
              <h4>Platform</h4>
              <ul>
                
                <li><a href="https://www.cybereason.com/platform">Overview</a></li>
                <li><a href="https://www.cybereason.com/platform/endpoint-prevention">Endpoint Protection</a></li>
                <li><a href="https://www.cybereason.com/platform/endpoint-detection-response-edr">EDR</a></li>
                <li><a href="https://www.cybereason.com/platform/managed-detection-response-mdr">MDR</a></li>
              </ul>
            </div>
          </div>
      </div>
    </div>
  
    <div class="container page-center">
      <div class="columns cr-footer__bottom-bar">
        <div class="column">
          <p>©Cybereason 2025. All Rights Reserved.</p>
        </div>
        <div class="column bottom-bar__links">
          <ul>
            <li><a href="https://www.cybereason.com/terms-of-use">Terms of Use</a></li>
            <li><a href="https://www.cybereason.com/privacy-notice">Privacy Notice</a></li>
            <li><a href="https://www.cybereason.com/ccpa-privacy-request">Do Not Sell</a></li>
            <li><a href="https://www.cybereason.com/security">Security</a></li>
            <!--<li><a href="#">Cookie Policy</a></li>-->
          </ul>
        </div>

        <div class="column bottom-bar__social">
          <ul>
            <li><a class="facebook" href="https://www.facebook.com/Cybereason/"></a></li>
            <li><a class="twitter" href="https://twitter.com/cybereason"></a></li>
            <li><a class="youtube" href="https://www.youtube.com/channel/UCOm7AaB0HiNH4Phe66sK0Ew"></a></li>
            <li><a class="linkedin" href="https://www.linkedin.com/company/cybereason"></a></li>
            <li><a class="instagram" href="https://www.instagram.com/cybereason"></a></li>
          </ul>
        </div>
    </div>
  </div>

</footer></div>

</div><!--end widget-span -->
</div><!--end row-->
</div><!--end row-wrapper -->

    </div><!--end footer -->
</div><!--end footer wrapper -->

    
<!-- HubSpot performance collection script -->
<script defer src="/hs/hsstatic/content-cwv-embed/static-1.1293/embed.js"></script>
<script src="https://www.cybereason.com/hs-fs/hubfs/hub_generated/template_assets/1/42507089303/1741528346196/template_animatedModal.min.js"></script>
<script>
var hsVars = hsVars || {}; hsVars['language'] = 'en';
</script>

<script src="/hs/hsstatic/cos-i18n/static-1.53/bundles/project.js"></script>
<script src="https://www.cybereason.com/hs-fs/hubfs/hub_generated/module_assets/1/41681847227/1741488491170/module_CR_-_Malicious_Life_Network_--_Tier_One_Header.min.js"></script>
<script src="https://www.cybereason.com/hs-fs/hubfs/hub_generated/module_assets/1/41682410610/1741488492472/module_CR_-_Malicious_Life_Network_--_Main_Hero.min.js"></script>
<script src="https://www.cybereason.com/hs-fs/hubfs/hub_generated/module_assets/1/43300360745/1741488505140/module_CR_-_Malicious_Life_Network_--_Related_Posts.min.js"></script>
<script src="https://www.cybereason.com/hs-fs/hubfs/hub_generated/module_assets/1/86933076631/1741488758324/module_CR_-_Sticky_CTA_Bar.min.js"></script>

<!-- Start of HubSpot Analytics Code -->
<script type="text/javascript">
var _hsq = _hsq || [];
_hsq.push(["setContentType", "blog-post"]);
_hsq.push(["setCanonicalUrl", "https:\/\/www.cybereason.com\/blog\/research\/wannamine-cryptominer-eternalblue-wannacry"]);
_hsq.push(["setPageId", "6180187469"]);
_hsq.push(["setContentMetadata", {
    "contentPageId": 6180187469,
    "legacyPageId": "6180187469",
    "contentFolderId": null,
    "contentGroupId": 5272851739,
    "abTestId": null,
    "languageVariantId": 6180187469,
    "languageCode": "en",
    
    
}]);
</script>

<script type="text/javascript" id="hs-script-loader" async defer src="/hs/scriptloader/3354902.js"></script>
<!-- End of HubSpot Analytics Code -->


<script type="text/javascript">
var hsVars = {
    render_id: "c376956b-e8e1-48df-8d77-11dec90b1e89",
    ticks: 1741892809099,
    page_id: 6180187469,
    
    content_group_id: 5272851739,
    portal_id: 3354902,
    app_hs_base_url: "https://app.hubspot.com",
    cp_hs_base_url: "https://cp.hubspot.com",
    language: "en",
    analytics_page_type: "blog-post",
    scp_content_type: "",
    
    analytics_page_id: "6180187469",
    category_id: 3,
    folder_id: 0,
    is_hubspot_user: false
}
</script>


<script defer src="/hs/hsstatic/HubspotToolsMenu/static-1.432/js/index.js"></script>

<script>if ($('[id^="hs_form"]').length > 0) {
  var myInterval = setInterval(
  function() {
    var myFields = document.getElementsByClassName('hs-input');
    if (myFields.length > 0) {
      clearInterval(myInterval);
      for (var i = 0; i < myFields.length; i++) {
        var myField = myFields[i];
		var myTagName = myField.tagName.toLowerCase();
        if (myTagName == 'input' || myTagName == 'textarea') {
          if (myField.placeholder != null) {
            myField.placeholder = myField.placeholder.replace('*', '');
          }
        } else if (myTagName == 'select') {
          myField.options[0].innerHTML = myField.options[0].innerHTML.replace('*', '');
        }
      }
    }
  }, 100);
}
</script>

<div id="fb-root"></div>
  <script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_GB/sdk.js#xfbml=1&version=v3.0";
  fjs.parentNode.insertBefore(js, fjs);
 }(document, 'script', 'facebook-jssdk'));</script> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
 


    <script>
function sticky_relocate() {
  var window_top = $(window).scrollTop();
  var div_top = $('#sticky-anchor').offset().top;
  if (window_top > div_top) {
    $('#sticky').addClass('stick');
  } else {
    $('#sticky').removeClass('stick');
  }
}

$(function() {
  $(window).scroll(sticky_relocate);
  sticky_relocate();
});
</script>
    <!-- Generated by the HubSpot Template Builder - template version 1.03 -->

<script type="text/javascript" src="/_Incapsula_Resource?SWJIYLWA=719d34d31c8e3a6e6fffd425f7e032f3&ns=2&cb=385788470" async></script></body></html>