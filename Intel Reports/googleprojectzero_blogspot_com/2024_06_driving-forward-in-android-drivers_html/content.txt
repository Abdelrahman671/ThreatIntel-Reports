<!DOCTYPE html>
<html class='v2' dir='ltr' lang='en' xmlns='http://www.w3.org/1999/xhtml' xmlns:b='http://www.google.com/2005/gml/b' xmlns:data='http://www.google.com/2005/gml/data' xmlns:expr='http://www.google.com/2005/gml/expr'>
<head>
<link href='https://www.blogger.com/static/v1/widgets/3566091532-css_bundle_v2.css' rel='stylesheet' type='text/css'/>
<meta content='width=1100' name='viewport'/>
<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'/>
<meta content='blogger' name='generator'/>
<link href='https://googleprojectzero.blogspot.com/favicon.ico' rel='icon' type='image/x-icon'/>
<link href='https://googleprojectzero.blogspot.com/2024/06/driving-forward-in-android-drivers.html' rel='canonical'/>
<link rel="alternate" type="application/atom+xml" title="Project Zero - Atom" href="https://googleprojectzero.blogspot.com/feeds/posts/default" />
<link rel="alternate" type="application/rss+xml" title="Project Zero - RSS" href="https://googleprojectzero.blogspot.com/feeds/posts/default?alt=rss" />
<link rel="service.post" type="application/atom+xml" title="Project Zero - Atom" href="https://www.blogger.com/feeds/4838136820032157985/posts/default" />

<link rel="alternate" type="application/atom+xml" title="Project Zero - Atom" href="https://googleprojectzero.blogspot.com/feeds/3663024175311920488/comments/default" />
<!--Can't find substitution for tag [blog.ieCssRetrofitLinks]-->
<link href='https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEioT3h0f4HwgQDI_0LTWJU6KJU3MwVqZ8zuQYgPhF0SXHNCeaw1ut_-WkpVwwqcqLytAsgahAjKshk8ugcbaCZyk8-Us3i8ZfRihE-EA3n8tRFIi0oPUntubw1dJ7y9l1LjTe4Zot7iFd-WJRQ0I1DPdsFA_sULQ5vLIQ8xgQerrz1hyphenhyphenwLj_2J8oC2VD0M/s790/image2.png' rel='image_src'/>
<meta content='https://googleprojectzero.blogspot.com/2024/06/driving-forward-in-android-drivers.html' property='og:url'/>
<meta content='Driving forward in Android drivers' property='og:title'/>
<meta content='  Posted by Seth Jenkins, Google Project Zero Introduction   Android&#39;s open-source ecosystem has led to an incredible diversity of manufactu...' property='og:description'/>
<meta content='https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEioT3h0f4HwgQDI_0LTWJU6KJU3MwVqZ8zuQYgPhF0SXHNCeaw1ut_-WkpVwwqcqLytAsgahAjKshk8ugcbaCZyk8-Us3i8ZfRihE-EA3n8tRFIi0oPUntubw1dJ7y9l1LjTe4Zot7iFd-WJRQ0I1DPdsFA_sULQ5vLIQ8xgQerrz1hyphenhyphenwLj_2J8oC2VD0M/w1200-h630-p-k-no-nu/image2.png' property='og:image'/>
<title>Project Zero: Driving forward in Android drivers</title>
<style type='text/css'>@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;font-stretch:100%;font-display:swap;src:url(//fonts.gstatic.com/s/opensans/v40/memSYaGs126MiZpBA-UvWbX2vVnXBbObj2OVZyOOSr4dVJWUgsjZ0B4taVIGxA.woff2)format('woff2');unicode-range:U+0460-052F,U+1C80-1C8A,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F;}@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;font-stretch:100%;font-display:swap;src:url(//fonts.gstatic.com/s/opensans/v40/memSYaGs126MiZpBA-UvWbX2vVnXBbObj2OVZyOOSr4dVJWUgsjZ0B4kaVIGxA.woff2)format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116;}@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;font-stretch:100%;font-display:swap;src:url(//fonts.gstatic.com/s/opensans/v40/memSYaGs126MiZpBA-UvWbX2vVnXBbObj2OVZyOOSr4dVJWUgsjZ0B4saVIGxA.woff2)format('woff2');unicode-range:U+1F00-1FFF;}@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;font-stretch:100%;font-display:swap;src:url(//fonts.gstatic.com/s/opensans/v40/memSYaGs126MiZpBA-UvWbX2vVnXBbObj2OVZyOOSr4dVJWUgsjZ0B4jaVIGxA.woff2)format('woff2');unicode-range:U+0370-0377,U+037A-037F,U+0384-038A,U+038C,U+038E-03A1,U+03A3-03FF;}@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;font-stretch:100%;font-display:swap;src:url(//fonts.gstatic.com/s/opensans/v40/memSYaGs126MiZpBA-UvWbX2vVnXBbObj2OVZyOOSr4dVJWUgsjZ0B4iaVIGxA.woff2)format('woff2');unicode-range:U+0307-0308,U+0590-05FF,U+200C-2010,U+20AA,U+25CC,U+FB1D-FB4F;}@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;font-stretch:100%;font-display:swap;src:url(//fonts.gstatic.com/s/opensans/v40/memSYaGs126MiZpBA-UvWbX2vVnXBbObj2OVZyOOSr4dVJWUgsjZ0B5caVIGxA.woff2)format('woff2');unicode-range:U+0302-0303,U+0305,U+0307-0308,U+0310,U+0312,U+0315,U+031A,U+0326-0327,U+032C,U+032F-0330,U+0332-0333,U+0338,U+033A,U+0346,U+034D,U+0391-03A1,U+03A3-03A9,U+03B1-03C9,U+03D1,U+03D5-03D6,U+03F0-03F1,U+03F4-03F5,U+2016-2017,U+2034-2038,U+203C,U+2040,U+2043,U+2047,U+2050,U+2057,U+205F,U+2070-2071,U+2074-208E,U+2090-209C,U+20D0-20DC,U+20E1,U+20E5-20EF,U+2100-2112,U+2114-2115,U+2117-2121,U+2123-214F,U+2190,U+2192,U+2194-21AE,U+21B0-21E5,U+21F1-21F2,U+21F4-2211,U+2213-2214,U+2216-22FF,U+2308-230B,U+2310,U+2319,U+231C-2321,U+2336-237A,U+237C,U+2395,U+239B-23B7,U+23D0,U+23DC-23E1,U+2474-2475,U+25AF,U+25B3,U+25B7,U+25BD,U+25C1,U+25CA,U+25CC,U+25FB,U+266D-266F,U+27C0-27FF,U+2900-2AFF,U+2B0E-2B11,U+2B30-2B4C,U+2BFE,U+3030,U+FF5B,U+FF5D,U+1D400-1D7FF,U+1EE00-1EEFF;}@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;font-stretch:100%;font-display:swap;src:url(//fonts.gstatic.com/s/opensans/v40/memSYaGs126MiZpBA-UvWbX2vVnXBbObj2OVZyOOSr4dVJWUgsjZ0B5OaVIGxA.woff2)format('woff2');unicode-range:U+0001-000C,U+000E-001F,U+007F-009F,U+20DD-20E0,U+20E2-20E4,U+2150-218F,U+2190,U+2192,U+2194-2199,U+21AF,U+21E6-21F0,U+21F3,U+2218-2219,U+2299,U+22C4-22C6,U+2300-243F,U+2440-244A,U+2460-24FF,U+25A0-27BF,U+2800-28FF,U+2921-2922,U+2981,U+29BF,U+29EB,U+2B00-2BFF,U+4DC0-4DFF,U+FFF9-FFFB,U+10140-1018E,U+10190-1019C,U+101A0,U+101D0-101FD,U+102E0-102FB,U+10E60-10E7E,U+1D2C0-1D2D3,U+1D2E0-1D37F,U+1F000-1F0FF,U+1F100-1F1AD,U+1F1E6-1F1FF,U+1F30D-1F30F,U+1F315,U+1F31C,U+1F31E,U+1F320-1F32C,U+1F336,U+1F378,U+1F37D,U+1F382,U+1F393-1F39F,U+1F3A7-1F3A8,U+1F3AC-1F3AF,U+1F3C2,U+1F3C4-1F3C6,U+1F3CA-1F3CE,U+1F3D4-1F3E0,U+1F3ED,U+1F3F1-1F3F3,U+1F3F5-1F3F7,U+1F408,U+1F415,U+1F41F,U+1F426,U+1F43F,U+1F441-1F442,U+1F444,U+1F446-1F449,U+1F44C-1F44E,U+1F453,U+1F46A,U+1F47D,U+1F4A3,U+1F4B0,U+1F4B3,U+1F4B9,U+1F4BB,U+1F4BF,U+1F4C8-1F4CB,U+1F4D6,U+1F4DA,U+1F4DF,U+1F4E3-1F4E6,U+1F4EA-1F4ED,U+1F4F7,U+1F4F9-1F4FB,U+1F4FD-1F4FE,U+1F503,U+1F507-1F50B,U+1F50D,U+1F512-1F513,U+1F53E-1F54A,U+1F54F-1F5FA,U+1F610,U+1F650-1F67F,U+1F687,U+1F68D,U+1F691,U+1F694,U+1F698,U+1F6AD,U+1F6B2,U+1F6B9-1F6BA,U+1F6BC,U+1F6C6-1F6CF,U+1F6D3-1F6D7,U+1F6E0-1F6EA,U+1F6F0-1F6F3,U+1F6F7-1F6FC,U+1F700-1F7FF,U+1F800-1F80B,U+1F810-1F847,U+1F850-1F859,U+1F860-1F887,U+1F890-1F8AD,U+1F8B0-1F8BB,U+1F8C0-1F8C1,U+1F900-1F90B,U+1F93B,U+1F946,U+1F984,U+1F996,U+1F9E9,U+1FA00-1FA6F,U+1FA70-1FA7C,U+1FA80-1FA89,U+1FA8F-1FAC6,U+1FACE-1FADC,U+1FADF-1FAE9,U+1FAF0-1FAF8,U+1FB00-1FBFF;}@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;font-stretch:100%;font-display:swap;src:url(//fonts.gstatic.com/s/opensans/v40/memSYaGs126MiZpBA-UvWbX2vVnXBbObj2OVZyOOSr4dVJWUgsjZ0B4vaVIGxA.woff2)format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB;}@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;font-stretch:100%;font-display:swap;src:url(//fonts.gstatic.com/s/opensans/v40/memSYaGs126MiZpBA-UvWbX2vVnXBbObj2OVZyOOSr4dVJWUgsjZ0B4uaVIGxA.woff2)format('woff2');unicode-range:U+0100-02BA,U+02BD-02C5,U+02C7-02CC,U+02CE-02D7,U+02DD-02FF,U+0304,U+0308,U+0329,U+1D00-1DBF,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF;}@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;font-stretch:100%;font-display:swap;src:url(//fonts.gstatic.com/s/opensans/v40/memSYaGs126MiZpBA-UvWbX2vVnXBbObj2OVZyOOSr4dVJWUgsjZ0B4gaVI.woff2)format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD;}</style>
<style id='page-skin-1' type='text/css'><!--
/*
-----------------------------------------------
Blogger Template Style
Name:     Simple
Designer: Blogger
URL:      www.blogger.com
----------------------------------------------- */
/* Variable definitions
====================
<Variable name="keycolor" description="Main Color" type="color" default="#66bbdd"/>
<Group description="Page Text" selector="body">
<Variable name="body.font" description="Font" type="font"
default="normal normal 12px Arial, Tahoma, Helvetica, FreeSans, sans-serif"/>
<Variable name="body.text.color" description="Text Color" type="color" default="#222222"/>
</Group>
<Group description="Backgrounds" selector=".body-fauxcolumns-outer">
<Variable name="body.background.color" description="Outer Background" type="color" default="#66bbdd"/>
<Variable name="content.background.color" description="Main Background" type="color" default="#ffffff"/>
<Variable name="header.background.color" description="Header Background" type="color" default="transparent"/>
</Group>
<Group description="Links" selector=".main-outer">
<Variable name="link.color" description="Link Color" type="color" default="#2288bb"/>
<Variable name="link.visited.color" description="Visited Color" type="color" default="#888888"/>
<Variable name="link.hover.color" description="Hover Color" type="color" default="#33aaff"/>
</Group>
<Group description="Blog Title" selector=".header h1">
<Variable name="header.font" description="Font" type="font"
default="normal normal 60px Arial, Tahoma, Helvetica, FreeSans, sans-serif"/>
<Variable name="header.text.color" description="Title Color" type="color" default="#3399bb" />
</Group>
<Group description="Blog Description" selector=".header .description">
<Variable name="description.text.color" description="Description Color" type="color"
default="#777777" />
</Group>
<Group description="Tabs Text" selector=".tabs-inner .widget li a">
<Variable name="tabs.font" description="Font" type="font"
default="normal normal 14px Arial, Tahoma, Helvetica, FreeSans, sans-serif"/>
<Variable name="tabs.text.color" description="Text Color" type="color" default="#999999"/>
<Variable name="tabs.selected.text.color" description="Selected Color" type="color" default="#000000"/>
</Group>
<Group description="Tabs Background" selector=".tabs-outer .PageList">
<Variable name="tabs.background.color" description="Background Color" type="color" default="#f5f5f5"/>
<Variable name="tabs.selected.background.color" description="Selected Color" type="color" default="#eeeeee"/>
</Group>
<Group description="Post Title" selector="h3.post-title, .comments h4">
<Variable name="post.title.font" description="Font" type="font"
default="normal normal 22px Arial, Tahoma, Helvetica, FreeSans, sans-serif"/>
</Group>
<Group description="Date Header" selector=".date-header">
<Variable name="date.header.color" description="Text Color" type="color"
default="#000000"/>
<Variable name="date.header.background.color" description="Background Color" type="color"
default="transparent"/>
<Variable name="date.header.font" description="Text Font" type="font"
default="normal bold 11px Arial, Tahoma, Helvetica, FreeSans, sans-serif"/>
<Variable name="date.header.padding" description="Date Header Padding" type="string" default="inherit"/>
<Variable name="date.header.letterspacing" description="Date Header Letter Spacing" type="string" default="inherit"/>
<Variable name="date.header.margin" description="Date Header Margin" type="string" default="inherit"/>
</Group>
<Group description="Post Footer" selector=".post-footer">
<Variable name="post.footer.text.color" description="Text Color" type="color" default="#666666"/>
<Variable name="post.footer.background.color" description="Background Color" type="color"
default="#f9f9f9"/>
<Variable name="post.footer.border.color" description="Shadow Color" type="color" default="#eeeeee"/>
</Group>
<Group description="Gadgets" selector="h2">
<Variable name="widget.title.font" description="Title Font" type="font"
default="normal bold 11px Arial, Tahoma, Helvetica, FreeSans, sans-serif"/>
<Variable name="widget.title.text.color" description="Title Color" type="color" default="#000000"/>
<Variable name="widget.alternate.text.color" description="Alternate Color" type="color" default="#999999"/>
</Group>
<Group description="Images" selector=".main-inner">
<Variable name="image.background.color" description="Background Color" type="color" default="#ffffff"/>
<Variable name="image.border.color" description="Border Color" type="color" default="#eeeeee"/>
<Variable name="image.text.color" description="Caption Text Color" type="color" default="#000000"/>
</Group>
<Group description="Accents" selector=".content-inner">
<Variable name="body.rule.color" description="Separator Line Color" type="color" default="#eeeeee"/>
<Variable name="tabs.border.color" description="Tabs Border Color" type="color" default="transparent"/>
</Group>
<Variable name="body.background" description="Body Background" type="background"
color="#eeeeee" default="$(color) none repeat scroll top left"/>
<Variable name="body.background.override" description="Body Background Override" type="string" default=""/>
<Variable name="body.background.gradient.cap" description="Body Gradient Cap" type="url"
default="url(https://resources.blogblog.com/blogblog/data/1kt/simple/gradients_light.png)"/>
<Variable name="body.background.gradient.tile" description="Body Gradient Tile" type="url"
default="url(https://resources.blogblog.com/blogblog/data/1kt/simple/body_gradient_tile_light.png)"/>
<Variable name="content.background.color.selector" description="Content Background Color Selector" type="string" default=".content-inner"/>
<Variable name="content.padding" description="Content Padding" type="length" default="10px" min="0" max="100px"/>
<Variable name="content.padding.horizontal" description="Content Horizontal Padding" type="length" default="10px" min="0" max="100px"/>
<Variable name="content.shadow.spread" description="Content Shadow Spread" type="length" default="40px" min="0" max="100px"/>
<Variable name="content.shadow.spread.webkit" description="Content Shadow Spread (WebKit)" type="length" default="5px" min="0" max="100px"/>
<Variable name="content.shadow.spread.ie" description="Content Shadow Spread (IE)" type="length" default="10px" min="0" max="100px"/>
<Variable name="main.border.width" description="Main Border Width" type="length" default="0" min="0" max="10px"/>
<Variable name="header.background.gradient" description="Header Gradient" type="url" default="none"/>
<Variable name="header.shadow.offset.left" description="Header Shadow Offset Left" type="length" default="-1px" min="-50px" max="50px"/>
<Variable name="header.shadow.offset.top" description="Header Shadow Offset Top" type="length" default="-1px" min="-50px" max="50px"/>
<Variable name="header.shadow.spread" description="Header Shadow Spread" type="length" default="1px" min="0" max="100px"/>
<Variable name="header.padding" description="Header Padding" type="length" default="30px" min="0" max="100px"/>
<Variable name="header.border.size" description="Header Border Size" type="length" default="1px" min="0" max="10px"/>
<Variable name="header.bottom.border.size" description="Header Bottom Border Size" type="length" default="1px" min="0" max="10px"/>
<Variable name="header.border.horizontalsize" description="Header Horizontal Border Size" type="length" default="0" min="0" max="10px"/>
<Variable name="description.text.size" description="Description Text Size" type="string" default="140%"/>
<Variable name="tabs.margin.top" description="Tabs Margin Top" type="length" default="0" min="0" max="100px"/>
<Variable name="tabs.margin.side" description="Tabs Side Margin" type="length" default="30px" min="0" max="100px"/>
<Variable name="tabs.background.gradient" description="Tabs Background Gradient" type="url"
default="url(https://resources.blogblog.com/blogblog/data/1kt/simple/gradients_light.png)"/>
<Variable name="tabs.border.width" description="Tabs Border Width" type="length" default="1px" min="0" max="10px"/>
<Variable name="tabs.bevel.border.width" description="Tabs Bevel Border Width" type="length" default="1px" min="0" max="10px"/>
<Variable name="post.margin.bottom" description="Post Bottom Margin" type="length" default="25px" min="0" max="100px"/>
<Variable name="image.border.small.size" description="Image Border Small Size" type="length" default="2px" min="0" max="10px"/>
<Variable name="image.border.large.size" description="Image Border Large Size" type="length" default="5px" min="0" max="10px"/>
<Variable name="page.width.selector" description="Page Width Selector" type="string" default=".region-inner"/>
<Variable name="page.width" description="Page Width" type="string" default="auto"/>
<Variable name="main.section.margin" description="Main Section Margin" type="length" default="15px" min="0" max="100px"/>
<Variable name="main.padding" description="Main Padding" type="length" default="15px" min="0" max="100px"/>
<Variable name="main.padding.top" description="Main Padding Top" type="length" default="30px" min="0" max="100px"/>
<Variable name="main.padding.bottom" description="Main Padding Bottom" type="length" default="30px" min="0" max="100px"/>
<Variable name="paging.background"
color="#ffffff"
description="Background of blog paging area" type="background"
default="transparent none no-repeat scroll top center"/>
<Variable name="footer.bevel" description="Bevel border length of footer" type="length" default="0" min="0" max="10px"/>
<Variable name="mobile.background.overlay" description="Mobile Background Overlay" type="string"
default="transparent none repeat scroll top left"/>
<Variable name="mobile.background.size" description="Mobile Background Size" type="string" default="auto"/>
<Variable name="mobile.button.color" description="Mobile Button Color" type="color" default="#ffffff" />
<Variable name="startSide" description="Side where text starts in blog language" type="automatic" default="left"/>
<Variable name="endSide" description="Side where text ends in blog language" type="automatic" default="right"/>
*/
/* Content
----------------------------------------------- */
body {
font: normal normal 12px Open Sans;
color: #000000;
background: #eeeeee none repeat scroll top left;
padding: 0 0 0 0;
}
html body .region-inner {
min-width: 0;
max-width: 100%;
width: auto;
}
h2 {
font-size: 22px;
}
a:link {
text-decoration:none;
color: #2288bb;
}
a:visited {
text-decoration:none;
color: #888888;
}
a:hover {
text-decoration:underline;
color: #33aaff;
}
.body-fauxcolumn-outer .fauxcolumn-inner {
background: transparent none repeat scroll top left;
_background-image: none;
}
.body-fauxcolumn-outer .cap-top {
position: absolute;
z-index: 1;
height: 400px;
width: 100%;
}
.body-fauxcolumn-outer .cap-top .cap-left {
width: 100%;
background: transparent none repeat-x scroll top left;
_background-image: none;
}
.content-outer {
-moz-box-shadow: 0 0 0 rgba(0, 0, 0, .15);
-webkit-box-shadow: 0 0 0 rgba(0, 0, 0, .15);
-goog-ms-box-shadow: 0 0 0 #333333;
box-shadow: 0 0 0 rgba(0, 0, 0, .15);
margin-bottom: 1px;
}
.content-inner {
padding: 10px 40px;
}
.content-inner {
background-color: #ffffff;
}
/* Header
----------------------------------------------- */
.header-outer {
background: transparent none repeat-x scroll 0 -400px;
_background-image: none;
}
.Header h1 {
font: normal normal 40px Open Sans;
color: #000000;
text-shadow: 0 0 0 rgba(0, 0, 0, .2);
}
.Header h1 a {
color: #000000;
}
.Header .description {
font-size: 18px;
color: #000000;
}
.header-inner .Header .titlewrapper {
padding: 22px 0;
}
.header-inner .Header .descriptionwrapper {
padding: 0 0;
}
/* Tabs
----------------------------------------------- */
.tabs-inner .section:first-child {
border-top: 0 solid #dddddd;
}
.tabs-inner .section:first-child ul {
margin-top: -1px;
border-top: 1px solid #dddddd;
border-left: 1px solid #dddddd;
border-right: 1px solid #dddddd;
}
.tabs-inner .widget ul {
background: transparent none repeat-x scroll 0 -800px;
_background-image: none;
border-bottom: 1px solid #dddddd;
margin-top: 0;
margin-left: -30px;
margin-right: -30px;
}
.tabs-inner .widget li a {
display: inline-block;
padding: .6em 1em;
font: normal normal 12px Open Sans;
color: #000000;
border-left: 1px solid #ffffff;
border-right: 1px solid #dddddd;
}
.tabs-inner .widget li:first-child a {
border-left: none;
}
.tabs-inner .widget li.selected a, .tabs-inner .widget li a:hover {
color: #000000;
background-color: #eeeeee;
text-decoration: none;
}
/* Columns
----------------------------------------------- */
.main-outer {
border-top: 0 solid transparent;
}
.fauxcolumn-left-outer .fauxcolumn-inner {
border-right: 1px solid transparent;
}
.fauxcolumn-right-outer .fauxcolumn-inner {
border-left: 1px solid transparent;
}
/* Headings
----------------------------------------------- */
div.widget > h2,
div.widget h2.title {
margin: 0 0 1em 0;
font: normal bold 11px 'Trebuchet MS',Trebuchet,Verdana,sans-serif;
color: #000000;
}
/* Widgets
----------------------------------------------- */
.widget .zippy {
color: #999999;
text-shadow: 2px 2px 1px rgba(0, 0, 0, .1);
}
.widget .popular-posts ul {
list-style: none;
}
/* Posts
----------------------------------------------- */
h2.date-header {
font: normal bold 11px Arial, Tahoma, Helvetica, FreeSans, sans-serif;
}
.date-header span {
background-color: #bbbbbb;
color: #ffffff;
padding: 0.4em;
letter-spacing: 3px;
margin: inherit;
}
.main-inner {
padding-top: 35px;
padding-bottom: 65px;
}
.main-inner .column-center-inner {
padding: 0 0;
}
.main-inner .column-center-inner .section {
margin: 0 1em;
}
.post {
margin: 0 0 45px 0;
}
h3.post-title, .comments h4 {
font: normal normal 22px Open Sans;
margin: .75em 0 0;
}
.post-body {
font-size: 110%;
line-height: 1.4;
position: relative;
}
.post-body img, .post-body .tr-caption-container, .Profile img, .Image img,
.BlogList .item-thumbnail img {
padding: 2px;
background: #ffffff;
border: 1px solid #eeeeee;
-moz-box-shadow: 1px 1px 5px rgba(0, 0, 0, .1);
-webkit-box-shadow: 1px 1px 5px rgba(0, 0, 0, .1);
box-shadow: 1px 1px 5px rgba(0, 0, 0, .1);
}
.post-body img, .post-body .tr-caption-container {
padding: 5px;
}
.post-body .tr-caption-container {
color: #666666;
}
.post-body .tr-caption-container img {
padding: 0;
background: transparent;
border: none;
-moz-box-shadow: 0 0 0 rgba(0, 0, 0, .1);
-webkit-box-shadow: 0 0 0 rgba(0, 0, 0, .1);
box-shadow: 0 0 0 rgba(0, 0, 0, .1);
}
.post-header {
margin: 0 0 1.5em;
line-height: 1.6;
font-size: 90%;
}
.post-footer {
margin: 20px -2px 0;
padding: 5px 10px;
color: #666666;
background-color: #eeeeee;
border-bottom: 1px solid #eeeeee;
line-height: 1.6;
font-size: 90%;
}
#comments .comment-author {
padding-top: 1.5em;
border-top: 1px solid transparent;
background-position: 0 1.5em;
}
#comments .comment-author:first-child {
padding-top: 0;
border-top: none;
}
.avatar-image-container {
margin: .2em 0 0;
}
#comments .avatar-image-container img {
border: 1px solid #eeeeee;
}
/* Comments
----------------------------------------------- */
.comments .comments-content .icon.blog-author {
background-repeat: no-repeat;
background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEgAACxIB0t1+/AAAAAd0SU1FB9sLFwMeCjjhcOMAAAD+SURBVDjLtZSvTgNBEIe/WRRnm3U8RC1neQdsm1zSBIU9VVF1FkUguQQsD9ITmD7ECZIJSE4OZo9stoVjC/zc7ky+zH9hXwVwDpTAWWLrgS3QAe8AZgaAJI5zYAmc8r0G4AHYHQKVwII8PZrZFsBFkeRCABYiMh9BRUhnSkPTNCtVXYXURi1FpBDgArj8QU1eVXUzfnjv7yP7kwu1mYrkWlU33vs1QNu2qU8pwN0UpKoqokjWwCztrMuBhEhmh8bD5UDqur75asbcX0BGUB9/HAMB+r32hznJgXy2v0sGLBcyAJ1EK3LFcbo1s91JeLwAbwGYu7TP/3ZGfnXYPgAVNngtqatUNgAAAABJRU5ErkJggg==);
}
.comments .comments-content .loadmore a {
border-top: 1px solid #999999;
border-bottom: 1px solid #999999;
}
.comments .comment-thread.inline-thread {
background-color: #eeeeee;
}
.comments .continue {
border-top: 2px solid #999999;
}
/* Accents
---------------------------------------------- */
.section-columns td.columns-cell {
border-left: 1px solid transparent;
}
.blog-pager {
background: transparent url(//www.blogblog.com/1kt/simple/paging_dot.png) repeat-x scroll top center;
}
.blog-pager-older-link, .home-link,
.blog-pager-newer-link {
background-color: #ffffff;
padding: 5px;
}
.footer-outer {
border-top: 1px dashed #bbbbbb;
}
/* Mobile
----------------------------------------------- */
body.mobile  {
background-size: auto;
}
.mobile .body-fauxcolumn-outer {
background: transparent none repeat scroll top left;
}
.mobile .body-fauxcolumn-outer .cap-top {
background-size: 100% auto;
}
.mobile .content-outer {
-webkit-box-shadow: 0 0 3px rgba(0, 0, 0, .15);
box-shadow: 0 0 3px rgba(0, 0, 0, .15);
}
.mobile .tabs-inner .widget ul {
margin-left: 0;
margin-right: 0;
}
.mobile .post {
margin: 0;
}
.mobile .main-inner .column-center-inner .section {
margin: 0;
}
.mobile .date-header span {
padding: 0.1em 10px;
margin: 0 -10px;
}
.mobile h3.post-title {
margin: 0;
}
.mobile .blog-pager {
background: transparent none no-repeat scroll top center;
}
.mobile .footer-outer {
border-top: none;
}
.mobile .main-inner, .mobile .footer-inner {
background-color: #ffffff;
}
.mobile-index-contents {
color: #000000;
}
.mobile-link-button {
background-color: #2288bb;
}
.mobile-link-button a:link, .mobile-link-button a:visited {
color: #ffffff;
}
.mobile .tabs-inner .section:first-child {
border-top: none;
}
.mobile .tabs-inner .PageList .widget-content {
background-color: #eeeeee;
color: #000000;
border-top: 1px solid #dddddd;
border-bottom: 1px solid #dddddd;
}
.mobile .tabs-inner .PageList .widget-content .pagelist-arrow {
border-left: 1px solid #dddddd;
}

--></style>
<style id='template-skin-1' type='text/css'><!--
body {
min-width: 1120px;
}
.content-outer, .content-fauxcolumn-outer, .region-inner {
min-width: 1120px;
max-width: 1120px;
_width: 1120px;
}
.main-inner .columns {
padding-left: 0;
padding-right: 310px;
}
.main-inner .fauxcolumn-center-outer {
left: 0;
right: 310px;
/* IE6 does not respect left and right together */
_width: expression(this.parentNode.offsetWidth -
parseInt("0") -
parseInt("310px") + 'px');
}
.main-inner .fauxcolumn-left-outer {
width: 0;
}
.main-inner .fauxcolumn-right-outer {
width: 310px;
}
.main-inner .column-left-outer {
width: 0;
right: 100%;
margin-left: -0;
}
.main-inner .column-right-outer {
width: 310px;
margin-right: -310px;
}
#layout {
min-width: 0;
}
#layout .content-outer {
min-width: 0;
width: 800px;
}
#layout .region-inner {
min-width: 0;
width: auto;
}
body#layout div.add_widget {
padding: 8px;
}
body#layout div.add_widget a {
margin-left: 32px;
}
--></style>
<script type='text/javascript'>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-240546891-1', 'auto', 'blogger');
        ga('blogger.send', 'pageview');
      </script>
<link href='https://www.blogger.com/dyn-css/authorization.css?targetBlogID=4838136820032157985&amp;zx=4b6deb10-59a2-4d3b-8b32-4b523c19fa3c' media='none' onload='if(media!=&#39;all&#39;)media=&#39;all&#39;' rel='stylesheet'/><noscript><link href='https://www.blogger.com/dyn-css/authorization.css?targetBlogID=4838136820032157985&amp;zx=4b6deb10-59a2-4d3b-8b32-4b523c19fa3c' rel='stylesheet'/></noscript>
<meta name='google-adsense-platform-account' content='ca-host-pub-1556223355139109'/>
<meta name='google-adsense-platform-domain' content='blogspot.com'/>

</head>
<body class='loading'>
<div class='navbar section' id='navbar' name='Navbar'><div class='widget Navbar' data-version='1' id='Navbar1'><script type="text/javascript">
    function setAttributeOnload(object, attribute, val) {
      if(window.addEventListener) {
        window.addEventListener('load',
          function(){ object[attribute] = val; }, false);
      } else {
        window.attachEvent('onload', function(){ object[attribute] = val; });
      }
    }
  </script>
<div id="navbar-iframe-container"></div>
<script type="text/javascript" src="https://apis.google.com/js/platform.js"></script>
<script type="text/javascript">
      gapi.load("gapi.iframes:gapi.iframes.style.bubble", function() {
        if (gapi.iframes && gapi.iframes.getContext) {
          gapi.iframes.getContext().openChild({
              url: 'https://www.blogger.com/navbar.g?targetBlogID\x3d4838136820032157985\x26blogName\x3dProject+Zero\x26publishMode\x3dPUBLISH_MODE_BLOGSPOT\x26navbarType\x3dLIGHT\x26layoutType\x3dLAYOUTS\x26searchRoot\x3dhttps://googleprojectzero.blogspot.com/search\x26blogLocale\x3den\x26v\x3d2\x26homepageUrl\x3dhttps://googleprojectzero.blogspot.com/\x26targetPostID\x3d3663024175311920488\x26blogPostOrPageUrl\x3dhttps://googleprojectzero.blogspot.com/2024/06/driving-forward-in-android-drivers.html\x26vt\x3d5212026860288871502',
              where: document.getElementById("navbar-iframe-container"),
              id: "navbar-iframe"
          });
        }
      });
    </script><script type="text/javascript">
(function() {
var script = document.createElement('script');
script.type = 'text/javascript';
script.src = '//pagead2.googlesyndication.com/pagead/js/google_top_exp.js';
var head = document.getElementsByTagName('head')[0];
if (head) {
head.appendChild(script);
}})();
</script>
</div></div>
<div class='body-fauxcolumns'>
<div class='fauxcolumn-outer body-fauxcolumn-outer'>
<div class='cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left'>
<div class='fauxborder-right'></div>
<div class='fauxcolumn-inner'>
</div>
</div>
<div class='cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
</div>
<div class='content'>
<div class='content-fauxcolumns'>
<div class='fauxcolumn-outer content-fauxcolumn-outer'>
<div class='cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left'>
<div class='fauxborder-right'></div>
<div class='fauxcolumn-inner'>
</div>
</div>
<div class='cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
</div>
<div class='content-outer'>
<div class='content-cap-top cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left content-fauxborder-left'>
<div class='fauxborder-right content-fauxborder-right'></div>
<div class='content-inner'>
<header>
<div class='header-outer'>
<div class='header-cap-top cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left header-fauxborder-left'>
<div class='fauxborder-right header-fauxborder-right'></div>
<div class='region-inner header-inner'>
<div class='header section' id='header' name='Header'><div class='widget Header' data-version='1' id='Header1'>
<div id='header-inner'>
<div class='titlewrapper'>
<h1 class='title'>
<a href='https://googleprojectzero.blogspot.com/'>
Project Zero
</a>
</h1>
</div>
<div class='descriptionwrapper'>
<p class='description'><span>News and updates from the Project Zero team at Google</span></p>
</div>
</div>
</div></div>
</div>
</div>
<div class='header-cap-bottom cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
</header>
<div class='tabs-outer'>
<div class='tabs-cap-top cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left tabs-fauxborder-left'>
<div class='fauxborder-right tabs-fauxborder-right'></div>
<div class='region-inner tabs-inner'>
<div class='tabs no-items section' id='crosscol' name='Cross-Column'></div>
<div class='tabs no-items section' id='crosscol-overflow' name='Cross-Column 2'></div>
</div>
</div>
<div class='tabs-cap-bottom cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
<div class='main-outer'>
<div class='main-cap-top cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left main-fauxborder-left'>
<div class='fauxborder-right main-fauxborder-right'></div>
<div class='region-inner main-inner'>
<div class='columns fauxcolumns'>
<div class='fauxcolumn-outer fauxcolumn-center-outer'>
<div class='cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left'>
<div class='fauxborder-right'></div>
<div class='fauxcolumn-inner'>
</div>
</div>
<div class='cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
<div class='fauxcolumn-outer fauxcolumn-left-outer'>
<div class='cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left'>
<div class='fauxborder-right'></div>
<div class='fauxcolumn-inner'>
</div>
</div>
<div class='cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
<div class='fauxcolumn-outer fauxcolumn-right-outer'>
<div class='cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left'>
<div class='fauxborder-right'></div>
<div class='fauxcolumn-inner'>
</div>
</div>
<div class='cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
<!-- corrects IE6 width calculation -->
<div class='columns-inner'>
<div class='column-center-outer'>
<div class='column-center-inner'>
<div class='main section' id='main' name='Main'><div class='widget Blog' data-version='1' id='Blog1'>
<div class='blog-posts hfeed'>

          <div class="date-outer">
        
<h2 class='date-header'><span>Thursday, June 13, 2024</span></h2>

          <div class="date-posts">
        
<div class='post-outer'>
<div class='post hentry uncustomized-post-template' itemprop='blogPost' itemscope='itemscope' itemtype='http://schema.org/BlogPosting'>
<meta content='https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEioT3h0f4HwgQDI_0LTWJU6KJU3MwVqZ8zuQYgPhF0SXHNCeaw1ut_-WkpVwwqcqLytAsgahAjKshk8ugcbaCZyk8-Us3i8ZfRihE-EA3n8tRFIi0oPUntubw1dJ7y9l1LjTe4Zot7iFd-WJRQ0I1DPdsFA_sULQ5vLIQ8xgQerrz1hyphenhyphenwLj_2J8oC2VD0M/s790/image2.png' itemprop='image_url'/>
<meta content='4838136820032157985' itemprop='blogId'/>
<meta content='3663024175311920488' itemprop='postId'/>
<a name='3663024175311920488'></a>
<h3 class='post-title entry-title' itemprop='name'>
Driving forward in Android drivers
</h3>
<div class='post-header'>
<div class='post-header-line-1'></div>
</div>
<div class='post-body entry-content' id='post-body-3663024175311920488' itemprop='description articleBody'>
<style type="text/css">@import url(https://themes.googleusercontent.com/fonts/css?kit=MXVwpSGzOOhqOc5hUWJbBLizfYjsfH9XaeDpmRKYJN5bV0WvE1cEyAoIq5yYZlSc);.lst-kix_3dxxrae9diso-3>li:before{content:"\0025cf   "}.lst-kix_m966q2gfyys4-7>li:before{content:"" counter(lst-ctn-kix_m966q2gfyys4-7,lower-latin) ". "}.lst-kix_3dxxrae9diso-2>li:before{content:"\0025a0   "}.lst-kix_3dxxrae9diso-4>li:before{content:"\0025cb   "}.lst-kix_m966q2gfyys4-6>li:before{content:"" counter(lst-ctn-kix_m966q2gfyys4-6,decimal) ". "}.lst-kix_m966q2gfyys4-8>li:before{content:"" counter(lst-ctn-kix_m966q2gfyys4-8,lower-roman) ". "}.lst-kix_kbd3zqh16g9u-4>li{counter-increment:lst-ctn-kix_kbd3zqh16g9u-4}.lst-kix_3dxxrae9diso-1>li:before{content:"\0025cb   "}.lst-kix_3dxxrae9diso-5>li:before{content:"\0025a0   "}ol.lst-kix_m966q2gfyys4-3.start{counter-reset:lst-ctn-kix_m966q2gfyys4-3 0}ol.lst-kix_ogq86rcrhsr-6.start{counter-reset:lst-ctn-kix_ogq86rcrhsr-6 0}ol.lst-kix_kbd3zqh16g9u-0.start{counter-reset:lst-ctn-kix_kbd3zqh16g9u-0 0}.lst-kix_m966q2gfyys4-2>li:before{content:"" counter(lst-ctn-kix_m966q2gfyys4-2,lower-roman) ". "}ul.lst-kix_vfea8tfkncrm-1{list-style-type:none}.lst-kix_m966q2gfyys4-1>li:before{content:"" counter(lst-ctn-kix_m966q2gfyys4-1,lower-latin) ". "}ul.lst-kix_vfea8tfkncrm-0{list-style-type:none}ul.lst-kix_vfea8tfkncrm-3{list-style-type:none}ul.lst-kix_vfea8tfkncrm-2{list-style-type:none}.lst-kix_vfea8tfkncrm-4>li:before{content:"\0025cb   "}.lst-kix_vfea8tfkncrm-5>li:before{content:"\0025a0   "}.lst-kix_m966q2gfyys4-0>li:before{content:"" counter(lst-ctn-kix_m966q2gfyys4-0,decimal) ". "}.lst-kix_vfea8tfkncrm-6>li:before{content:"\0025cf   "}.lst-kix_3dxxrae9diso-7>li:before{content:"\0025cb   "}.lst-kix_vfea8tfkncrm-8>li:before{content:"\0025a0   "}.lst-kix_3dxxrae9diso-6>li:before{content:"\0025cf   "}.lst-kix_3dxxrae9diso-8>li:before{content:"\0025a0   "}ol.lst-kix_ogq86rcrhsr-3.start{counter-reset:lst-ctn-kix_ogq86rcrhsr-3 0}.lst-kix_vfea8tfkncrm-7>li:before{content:"\0025cb   "}.lst-kix_ogq86rcrhsr-8>li{counter-increment:lst-ctn-kix_ogq86rcrhsr-8}.lst-kix_m966q2gfyys4-0>li{counter-increment:lst-ctn-kix_m966q2gfyys4-0}.lst-kix_kbd3zqh16g9u-6>li{counter-increment:lst-ctn-kix_kbd3zqh16g9u-6}.lst-kix_vfea8tfkncrm-3>li:before{content:"\0025cf   "}.lst-kix_kbd3zqh16g9u-3>li{counter-increment:lst-ctn-kix_kbd3zqh16g9u-3}ul.lst-kix_vfea8tfkncrm-5{list-style-type:none}ul.lst-kix_vfea8tfkncrm-4{list-style-type:none}ul.lst-kix_vfea8tfkncrm-7{list-style-type:none}ol.lst-kix_ogq86rcrhsr-1.start{counter-reset:lst-ctn-kix_ogq86rcrhsr-1 0}ol.lst-kix_kbd3zqh16g9u-8.start{counter-reset:lst-ctn-kix_kbd3zqh16g9u-8 0}ul.lst-kix_vfea8tfkncrm-6{list-style-type:none}.lst-kix_vfea8tfkncrm-2>li:before{content:"\0025a0   "}ul.lst-kix_vfea8tfkncrm-8{list-style-type:none}ol.lst-kix_m966q2gfyys4-8.start{counter-reset:lst-ctn-kix_m966q2gfyys4-8 0}.lst-kix_m966q2gfyys4-3>li:before{content:"" counter(lst-ctn-kix_m966q2gfyys4-3,decimal) ". "}.lst-kix_vfea8tfkncrm-0>li:before{content:"\0025cf   "}.lst-kix_vfea8tfkncrm-1>li:before{content:"\0025cb   "}.lst-kix_m966q2gfyys4-4>li:before{content:"" counter(lst-ctn-kix_m966q2gfyys4-4,lower-latin) ". "}.lst-kix_m966q2gfyys4-5>li:before{content:"" counter(lst-ctn-kix_m966q2gfyys4-5,lower-roman) ". "}ul.lst-kix_3dxxrae9diso-1{list-style-type:none}ul.lst-kix_3dxxrae9diso-0{list-style-type:none}ul.lst-kix_3dxxrae9diso-3{list-style-type:none}ol.lst-kix_ogq86rcrhsr-4.start{counter-reset:lst-ctn-kix_ogq86rcrhsr-4 0}ul.lst-kix_3dxxrae9diso-2{list-style-type:none}ul.lst-kix_3dxxrae9diso-8{list-style-type:none}ul.lst-kix_3dxxrae9diso-5{list-style-type:none}ul.lst-kix_3dxxrae9diso-4{list-style-type:none}ol.lst-kix_kbd3zqh16g9u-5.start{counter-reset:lst-ctn-kix_kbd3zqh16g9u-5 0}ul.lst-kix_3dxxrae9diso-7{list-style-type:none}ul.lst-kix_3dxxrae9diso-6{list-style-type:none}ul.lst-kix_o90s8x6qoynp-6{list-style-type:none}ul.lst-kix_o90s8x6qoynp-5{list-style-type:none}ul.lst-kix_o90s8x6qoynp-8{list-style-type:none}ul.lst-kix_o90s8x6qoynp-7{list-style-type:none}.lst-kix_m966q2gfyys4-1>li{counter-increment:lst-ctn-kix_m966q2gfyys4-1}ul.lst-kix_o90s8x6qoynp-2{list-style-type:none}ul.lst-kix_o90s8x6qoynp-1{list-style-type:none}ol.lst-kix_ogq86rcrhsr-0.start{counter-reset:lst-ctn-kix_ogq86rcrhsr-0 0}ul.lst-kix_o90s8x6qoynp-4{list-style-type:none}ul.lst-kix_o90s8x6qoynp-3{list-style-type:none}.lst-kix_m966q2gfyys4-7>li{counter-increment:lst-ctn-kix_m966q2gfyys4-7}ul.lst-kix_o90s8x6qoynp-0{list-style-type:none}ol.lst-kix_ogq86rcrhsr-8{list-style-type:none}ol.lst-kix_ogq86rcrhsr-7{list-style-type:none}ol.lst-kix_ogq86rcrhsr-6{list-style-type:none}ol.lst-kix_m966q2gfyys4-4.start{counter-reset:lst-ctn-kix_m966q2gfyys4-4 0}ol.lst-kix_ogq86rcrhsr-5.start{counter-reset:lst-ctn-kix_ogq86rcrhsr-5 0}ol.lst-kix_kbd3zqh16g9u-6.start{counter-reset:lst-ctn-kix_kbd3zqh16g9u-6 0}.lst-kix_ogq86rcrhsr-0>li{counter-increment:lst-ctn-kix_ogq86rcrhsr-0}.lst-kix_kbd3zqh16g9u-8>li{counter-increment:lst-ctn-kix_kbd3zqh16g9u-8}.lst-kix_ogq86rcrhsr-3>li{counter-increment:lst-ctn-kix_ogq86rcrhsr-3}.lst-kix_kbd3zqh16g9u-5>li{counter-increment:lst-ctn-kix_kbd3zqh16g9u-5}ol.lst-kix_ogq86rcrhsr-1{list-style-type:none}ol.lst-kix_ogq86rcrhsr-0{list-style-type:none}.lst-kix_ogq86rcrhsr-6>li{counter-increment:lst-ctn-kix_ogq86rcrhsr-6}ol.lst-kix_ogq86rcrhsr-5{list-style-type:none}.lst-kix_kbd3zqh16g9u-2>li{counter-increment:lst-ctn-kix_kbd3zqh16g9u-2}ol.lst-kix_ogq86rcrhsr-4{list-style-type:none}ol.lst-kix_ogq86rcrhsr-3{list-style-type:none}ol.lst-kix_ogq86rcrhsr-2{list-style-type:none}.lst-kix_ogq86rcrhsr-4>li{counter-increment:lst-ctn-kix_ogq86rcrhsr-4}ol.lst-kix_kbd3zqh16g9u-7{list-style-type:none}ol.lst-kix_kbd3zqh16g9u-6{list-style-type:none}ol.lst-kix_kbd3zqh16g9u-5{list-style-type:none}.lst-kix_o90s8x6qoynp-0>li:before{content:"\0025cf   "}ol.lst-kix_kbd3zqh16g9u-4{list-style-type:none}ol.lst-kix_m966q2gfyys4-7.start{counter-reset:lst-ctn-kix_m966q2gfyys4-7 0}ol.lst-kix_kbd3zqh16g9u-8{list-style-type:none}.lst-kix_ogq86rcrhsr-0>li:before{content:"" counter(lst-ctn-kix_ogq86rcrhsr-0,decimal) ". "}.lst-kix_ogq86rcrhsr-1>li:before{content:"" counter(lst-ctn-kix_ogq86rcrhsr-1,lower-latin) ". "}.lst-kix_o90s8x6qoynp-2>li:before{content:"\0025a0   "}.lst-kix_o90s8x6qoynp-4>li:before{content:"\0025cb   "}.lst-kix_m966q2gfyys4-4>li{counter-increment:lst-ctn-kix_m966q2gfyys4-4}ol.lst-kix_kbd3zqh16g9u-7.start{counter-reset:lst-ctn-kix_kbd3zqh16g9u-7 0}.lst-kix_ogq86rcrhsr-2>li:before{content:"" counter(lst-ctn-kix_ogq86rcrhsr-2,lower-roman) ". "}ol.lst-kix_kbd3zqh16g9u-3{list-style-type:none}ol.lst-kix_kbd3zqh16g9u-2{list-style-type:none}ol.lst-kix_kbd3zqh16g9u-1{list-style-type:none}.lst-kix_o90s8x6qoynp-1>li:before{content:"\0025cb   "}.lst-kix_o90s8x6qoynp-5>li:before{content:"\0025a0   "}ol.lst-kix_kbd3zqh16g9u-0{list-style-type:none}.lst-kix_o90s8x6qoynp-3>li:before{content:"\0025cf   "}ol.lst-kix_m966q2gfyys4-0{list-style-type:none}.lst-kix_ogq86rcrhsr-8>li:before{content:"" counter(lst-ctn-kix_ogq86rcrhsr-8,lower-roman) ". "}ol.lst-kix_m966q2gfyys4-1{list-style-type:none}.lst-kix_ogq86rcrhsr-7>li:before{content:"" counter(lst-ctn-kix_ogq86rcrhsr-7,lower-latin) ". "}.lst-kix_m966q2gfyys4-6>li{counter-increment:lst-ctn-kix_m966q2gfyys4-6}.lst-kix_ogq86rcrhsr-6>li:before{content:"" counter(lst-ctn-kix_ogq86rcrhsr-6,decimal) ". "}ol.lst-kix_kbd3zqh16g9u-4.start{counter-reset:lst-ctn-kix_kbd3zqh16g9u-4 0}ol.lst-kix_m966q2gfyys4-8{list-style-type:none}.lst-kix_ogq86rcrhsr-4>li:before{content:"" counter(lst-ctn-kix_ogq86rcrhsr-4,lower-latin) ". "}.lst-kix_kbd3zqh16g9u-0>li{counter-increment:lst-ctn-kix_kbd3zqh16g9u-0}ol.lst-kix_m966q2gfyys4-6{list-style-type:none}.lst-kix_ogq86rcrhsr-3>li:before{content:"" counter(lst-ctn-kix_ogq86rcrhsr-3,decimal) ". "}.lst-kix_ogq86rcrhsr-5>li:before{content:"" counter(lst-ctn-kix_ogq86rcrhsr-5,lower-roman) ". "}.lst-kix_o90s8x6qoynp-6>li:before{content:"\0025cf   "}.lst-kix_o90s8x6qoynp-8>li:before{content:"\0025a0   "}ol.lst-kix_m966q2gfyys4-7{list-style-type:none}ol.lst-kix_m966q2gfyys4-4{list-style-type:none}ol.lst-kix_m966q2gfyys4-5{list-style-type:none}ol.lst-kix_m966q2gfyys4-2{list-style-type:none}ol.lst-kix_kbd3zqh16g9u-1.start{counter-reset:lst-ctn-kix_kbd3zqh16g9u-1 0}.lst-kix_o90s8x6qoynp-7>li:before{content:"\0025cb   "}ol.lst-kix_m966q2gfyys4-3{list-style-type:none}.lst-kix_m966q2gfyys4-3>li{counter-increment:lst-ctn-kix_m966q2gfyys4-3}.lst-kix_ogq86rcrhsr-5>li{counter-increment:lst-ctn-kix_ogq86rcrhsr-5}ol.lst-kix_m966q2gfyys4-2.start{counter-reset:lst-ctn-kix_m966q2gfyys4-2 0}.lst-kix_ogq86rcrhsr-2>li{counter-increment:lst-ctn-kix_ogq86rcrhsr-2}ol.lst-kix_ogq86rcrhsr-7.start{counter-reset:lst-ctn-kix_ogq86rcrhsr-7 0}ol.lst-kix_m966q2gfyys4-5.start{counter-reset:lst-ctn-kix_m966q2gfyys4-5 0}.lst-kix_ogq86rcrhsr-7>li{counter-increment:lst-ctn-kix_ogq86rcrhsr-7}.lst-kix_kbd3zqh16g9u-1>li{counter-increment:lst-ctn-kix_kbd3zqh16g9u-1}.lst-kix_m966q2gfyys4-8>li{counter-increment:lst-ctn-kix_m966q2gfyys4-8}.lst-kix_kbd3zqh16g9u-8>li:before{content:"" counter(lst-ctn-kix_kbd3zqh16g9u-8,lower-roman) ". "}ol.lst-kix_m966q2gfyys4-1.start{counter-reset:lst-ctn-kix_m966q2gfyys4-1 0}ol.lst-kix_kbd3zqh16g9u-2.start{counter-reset:lst-ctn-kix_kbd3zqh16g9u-2 0}.lst-kix_ogq86rcrhsr-1>li{counter-increment:lst-ctn-kix_ogq86rcrhsr-1}ol.lst-kix_ogq86rcrhsr-8.start{counter-reset:lst-ctn-kix_ogq86rcrhsr-8 0}.lst-kix_kbd3zqh16g9u-7>li{counter-increment:lst-ctn-kix_kbd3zqh16g9u-7}ol.lst-kix_m966q2gfyys4-6.start{counter-reset:lst-ctn-kix_m966q2gfyys4-6 0}.lst-kix_kbd3zqh16g9u-1>li:before{content:"" counter(lst-ctn-kix_kbd3zqh16g9u-1,lower-latin) ". "}.lst-kix_kbd3zqh16g9u-0>li:before{content:"" counter(lst-ctn-kix_kbd3zqh16g9u-0,decimal) ". "}.lst-kix_kbd3zqh16g9u-2>li:before{content:"" counter(lst-ctn-kix_kbd3zqh16g9u-2,lower-roman) ". "}li.li-bullet-0:before{margin-left:-18pt;white-space:nowrap;display:inline-block;min-width:18pt}.lst-kix_kbd3zqh16g9u-5>li:before{content:"" counter(lst-ctn-kix_kbd3zqh16g9u-5,lower-roman) ". "}.lst-kix_kbd3zqh16g9u-4>li:before{content:"" counter(lst-ctn-kix_kbd3zqh16g9u-4,lower-latin) ". "}.lst-kix_kbd3zqh16g9u-6>li:before{content:"" counter(lst-ctn-kix_kbd3zqh16g9u-6,decimal) ". "}ol.lst-kix_ogq86rcrhsr-2.start{counter-reset:lst-ctn-kix_ogq86rcrhsr-2 0}.lst-kix_kbd3zqh16g9u-3>li:before{content:"" counter(lst-ctn-kix_kbd3zqh16g9u-3,decimal) ". "}.lst-kix_kbd3zqh16g9u-7>li:before{content:"" counter(lst-ctn-kix_kbd3zqh16g9u-7,lower-latin) ". "}.lst-kix_m966q2gfyys4-5>li{counter-increment:lst-ctn-kix_m966q2gfyys4-5}ol.lst-kix_m966q2gfyys4-0.start{counter-reset:lst-ctn-kix_m966q2gfyys4-0 0}ol.lst-kix_kbd3zqh16g9u-3.start{counter-reset:lst-ctn-kix_kbd3zqh16g9u-3 0}.lst-kix_3dxxrae9diso-0>li:before{content:"\0025cf   "}.lst-kix_m966q2gfyys4-2>li{counter-increment:lst-ctn-kix_m966q2gfyys4-2}ol{margin:0;padding:0}table td,table th{padding:0}.wuNJCVYdSe-c3{color:#37474f;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:9pt;font-family:"Roboto Mono";font-style:normal}.wuNJCVYdSe-c38{padding-top:0pt;padding-bottom:3pt;line-height:1.5;page-break-after:avoid;orphans:2;widows:2;text-align:left}.wuNJCVYdSe-c2{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial";font-style:normal}.wuNJCVYdSe-c36{padding-top:18pt;padding-bottom:6pt;line-height:1.5;page-break-after:avoid;orphans:2;widows:2;text-align:left}.wuNJCVYdSe-c4{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:9pt;font-family:"Arial";font-style:normal}.wuNJCVYdSe-c40{padding-top:16pt;padding-bottom:4pt;line-height:1.5;page-break-after:avoid;orphans:2;widows:2;text-align:left}.wuNJCVYdSe-c47{-webkit-text-decoration-skip:none;font-weight:400;text-decoration:line-through;vertical-align:baseline;text-decoration-skip-ink:none;font-style:normal}.wuNJCVYdSe-c7{padding-top:0pt;padding-bottom:0pt;line-height:1.5;orphans:2;widows:2;text-align:left}.wuNJCVYdSe-c35{color:#000000;font-weight:400;font-size:16pt;font-family:"Arial"}.wuNJCVYdSe-c0{font-size:9pt;font-family:"Roboto Mono";color:#1967d2;font-weight:400}.wuNJCVYdSe-c34{text-decoration-skip-ink:none;-webkit-text-decoration-skip:none;color:#1155cc;text-decoration:underline}.wuNJCVYdSe-c30{color:#000000;font-weight:400;font-size:26pt;font-family:"Arial"}.wuNJCVYdSe-c33{color:#434343;font-weight:400;font-size:14pt;font-family:"Arial"}.wuNJCVYdSe-c6{background-color:#b4a7d6;text-decoration:none;vertical-align:baseline;font-style:normal}.wuNJCVYdSe-c48{background-color:#ffffff;max-width:468pt;padding:72pt 72pt 72pt 72pt}.wuNJCVYdSe-c12{text-decoration:none;vertical-align:baseline;font-style:normal}.wuNJCVYdSe-c44{color:#999999;font-weight:400;font-size:11pt}.wuNJCVYdSe-c9{font-family:"Roboto Mono";color:#9334e6;font-weight:400}.wuNJCVYdSe-c13{color:#000000;font-weight:400;font-family:"Roboto Mono"}.wuNJCVYdSe-c8{font-family:"Roboto Mono";color:#37474f;font-weight:400}.wuNJCVYdSe-c11{font-family:"Roboto Mono";color:#c5221f;font-weight:400}.wuNJCVYdSe-c18{color:inherit;text-decoration:inherit}.wuNJCVYdSe-c24{padding:0;margin:0}.wuNJCVYdSe-c21{font-family:"Roboto Mono";color:#37474f}.wuNJCVYdSe-c14{font-family:"Roboto Mono";font-weight:400}.wuNJCVYdSe-c17{margin-left:36pt;padding-left:0pt}.wuNJCVYdSe-c1{font-weight:400;font-family:"Courier New"}.wuNJCVYdSe-c26{color:#000000;font-size:11pt}.wuNJCVYdSe-c10{height:11pt}.wuNJCVYdSe-c43{text-indent:36pt}.wuNJCVYdSe-c19{font-weight:700}.wuNJCVYdSe-c20{background-color:#6d9eeb}.wuNJCVYdSe-c46{font-family:"Roboto Mono"}.wuNJCVYdSe-c23{background-color:#b4a7d6}.wuNJCVYdSe-c45{font-style:italic}.wuNJCVYdSe-c41{font-family:"Arial"}.wuNJCVYdSe-c42{background-color:#f9cb9c}.wuNJCVYdSe-c31{background-color:#fff2cc}.wuNJCVYdSe-c39{background-color:#f1c232}.wuNJCVYdSe-c28{color:#188038}.wuNJCVYdSe-c25{background-color:#e6b8af}.wuNJCVYdSe-c22{background-color:#dd7e6b}.wuNJCVYdSe-c27{color:#b80672}.wuNJCVYdSe-c32{background-color:#d5a6bd}.wuNJCVYdSe-c15{background-color:#6aa84f}.wuNJCVYdSe-c5{font-size:9pt}.wuNJCVYdSe-c29{background-color:#e69138}.wuNJCVYdSe-c37{background-color:#a2c4c9}.wuNJCVYdSe-c16{background-color:#c9daf8}.title{padding-top:0pt;color:#000000;font-size:26pt;padding-bottom:3pt;font-family:"Arial";line-height:1.5;page-break-after:avoid;orphans:2;widows:2;text-align:left}.subtitle{padding-top:0pt;color:#666666;font-size:15pt;padding-bottom:16pt;font-family:"Arial";line-height:1.5;page-break-after:avoid;orphans:2;widows:2;text-align:left}li{color:#000000;font-size:11pt;font-family:"Arial"}p{margin:0;color:#000000;font-size:11pt;font-family:"Arial"}h1{padding-top:20pt;color:#000000;font-size:20pt;padding-bottom:6pt;font-family:"Arial";line-height:1.5;page-break-after:avoid;orphans:2;widows:2;text-align:left}h2{padding-top:18pt;color:#000000;font-size:16pt;padding-bottom:6pt;font-family:"Arial";line-height:1.5;page-break-after:avoid;orphans:2;widows:2;text-align:left}h3{padding-top:16pt;color:#434343;font-size:14pt;padding-bottom:4pt;font-family:"Arial";line-height:1.5;page-break-after:avoid;orphans:2;widows:2;text-align:left}h4{padding-top:14pt;color:#666666;font-size:12pt;padding-bottom:4pt;font-family:"Arial";line-height:1.5;page-break-after:avoid;orphans:2;widows:2;text-align:left}h5{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.5;page-break-after:avoid;orphans:2;widows:2;text-align:left}h6{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.5;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:left}</style></head><body class="c48 doc-content">
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c12 wuNJCVYdSe-c41 wuNJCVYdSe-c44">Posted by Seth Jenkins, Google Project Zero</span></p><h2 class="wuNJCVYdSe-c36" id="h.czz0un3ls851"><span class="wuNJCVYdSe-c35 wuNJCVYdSe-c12">Introduction</span></h2>
 <p class="wuNJCVYdSe-c7"><span>Android&#39;s open-source ecosystem has led to an incredible diversity of manufacturers and vendors developing software that runs on a broad variety of hardware. This hardware requires supporting drivers, meaning that many different codebases carry the potential to compromise a significant segment of Android phones. </span><span class="wuNJCVYdSe-c34"><a class="wuNJCVYdSe-c181" href="https://googleprojectzero.blogspot.com/2023/09/analyzing-modern-in-wild-android-exploit.html">There are recent public examples</a></span><span>&nbsp;of third-party drivers containing serious vulnerabilities that are exploited on Android. While there exists a well-established body of public (</span><span class="wuNJCVYdSe-c34"><a class="wuNJCVYdSe-c181" href="https://storage.googleapis.com/gweb-uniblog-publish-prod/documents/Year_in_Review_of_ZeroDays.pdf">and In-the-Wild</a></span><span>) security research</span><span>&nbsp;on Android GPU drivers</span><span>,</span><span>&nbsp;other chipset components may not be as frequently audited</span><span class="wuNJCVYdSe-c2">&nbsp;so this research sought to explore those drivers in greater detail.</span></p><h2 class="wuNJCVYdSe-c36" id="h.pc76xm98zfq3"><span class="wuNJCVYdSe-c35 wuNJCVYdSe-c12">Driver Enumeration: Not as Easy as it Looks</span></h2>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c2">This research focused on three Android devices (chipset manufacturers in parentheses): </span></p>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c2"></span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c2">- Google Pixel 7 (Tensor)</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c2">- Xiaomi 11T (MediaTek)</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c2">- Asus ROG 6D (MediaTek)</span></p>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c2"></span></p>
 <p class="wuNJCVYdSe-c7"><span>In order to perform driver research on these devices I first had to find all of the kernel drivers that were accessible from an unprivileged context on each device; </span><span>a task complicated by the non-uniformity of kernel drivers (and their permissions structures) across different devices even within the same chipset manufacturer.</span><span>&nbsp;There are several different methodologies for discovering these drivers. The most straightforward technique is to search the associated filesystems looking for exposed driver device files. These files serve as the primary method by which userland can interact with the driver. Normally the &ldquo;file&rdquo; is </span><span class="wuNJCVYdSe-c1">open</span><span>&rsquo;d by a userland process, which then uses a combination of </span><span class="wuNJCVYdSe-c1">read</span><span>, </span><span class="wuNJCVYdSe-c1">write</span><span>, </span><span class="wuNJCVYdSe-c1">ioctl</span><span>, or even </span><span class="wuNJCVYdSe-c1">mmap</span><span>&nbsp;to interact with the driver. The driver then &ldquo;translates&rdquo; those interactions into manipulations of the underlying hardware device sending the output of that device back to userland as warranted. Effectively all drivers expose their interfaces through the ProcFS or DevFS filesystems, so I focused on the </span><span class="wuNJCVYdSe-c1">/proc</span><span>&nbsp;and </span><span class="wuNJCVYdSe-c1">/dev</span><span>&nbsp;directories while searching for viable attack surfaces. Theoretically, evaluating all the userland accessible drivers should be as simple as calling </span><span class="wuNJCVYdSe-c1">find /dev</span><span>&nbsp;or </span><span class="wuNJCVYdSe-c1">find /proc</span><span>, attempting to </span><span class="wuNJCVYdSe-c1">open</span><span>&nbsp;every file discovered, and logging which </span><span class="wuNJCVYdSe-c1">open</span><span class="wuNJCVYdSe-c2">&nbsp;attempts were successful.</span></p>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c2"></span></p>
 <p class="wuNJCVYdSe-c7"><span>However, there is one major roadblock that prevents this approach from being comprehensive - permissions! SELinux and traditional Linux Discretionary Access Control policies can prevent simple filesystem enumeration from discovering all of the accessible device drivers associated on the filesystem. For example, the </span><span class="wuNJCVYdSe-c1">untrusted_app</span><span>&nbsp;SELinux context has </span><span class="wuNJCVYdSe-c1">search</span><span>&nbsp;permissions on the </span><span class="wuNJCVYdSe-c1">device</span><span class="wuNJCVYdSe-c2">&nbsp;SELinux context for directories, but is not allowed to directly open the directory itself:</span></p>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c2"></span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c2"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEioT3h0f4HwgQDI_0LTWJU6KJU3MwVqZ8zuQYgPhF0SXHNCeaw1ut_-WkpVwwqcqLytAsgahAjKshk8ugcbaCZyk8-Us3i8ZfRihE-EA3n8tRFIi0oPUntubw1dJ7y9l1LjTe4Zot7iFd-WJRQ0I1DPdsFA_sULQ5vLIQ8xgQerrz1hyphenhyphenwLj_2J8oC2VD0M/s790/image2.png" style="display: block; padding: 1em 0;text-align: center;"><img alt="sepolicy shows search permission on the &quot;device&quot; SELinux context" border="0" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEioT3h0f4HwgQDI_0LTWJU6KJU3MwVqZ8zuQYgPhF0SXHNCeaw1ut_-WkpVwwqcqLytAsgahAjKshk8ugcbaCZyk8-Us3i8ZfRihE-EA3n8tRFIi0oPUntubw1dJ7y9l1LjTe4Zot7iFd-WJRQ0I1DPdsFA_sULQ5vLIQ8xgQerrz1hyphenhyphenwLj_2J8oC2VD0M/s790/image2.png" style="max-height: 750px; max-width: 600px;" title="sepolicy shows search permission on the &quot;device&quot; SELinux context" /></a></span></p>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c2"></span></p>
 <p class="wuNJCVYdSe-c7"><span>This </span><span class="wuNJCVYdSe-c1">search</span><span>&nbsp;permission (rather counterintuitively) does </span><span class="wuNJCVYdSe-c45">not</span><span>&nbsp;allow the source context to list the contents of directories that have this SELinux target context. Instead, it simply allows such a directory to be in the ancestor directories of the file path that the source context attempts to </span><span class="wuNJCVYdSe-c1">open</span><span>. In practice, this means that untrusted_app is allowed to open e.g. </span><span class="wuNJCVYdSe-c1">/dev/mali0</span><span>&nbsp;but is usually </span><span class="wuNJCVYdSe-c19">not </span><span>allowed to open </span><span class="wuNJCVYdSe-c1">/dev</span><span class="wuNJCVYdSe-c2">&nbsp;itself:</span></p>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c2"></span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c2"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjbJAsOOwnE0RJ9O7yET8vhuVE-UmrzcyoUVoRP4z4kL7wYGXHHJob-ir9s2pgEDQFaxPmAT14n0hu81XpDrl6BaO7ltXE2jZJ-zIBoPa4hH9PYSSIc2KLk0ulZ_0xLjjaO4_VvhG69zIuqmtoGu1a7s_xn3Ru7_QZnjjLZS2sc8oL-yrwFR6LWUBm1EqA/s624/image6.png" style="display: block; padding: 1em 0;text-align: center;"><img alt="untrusted_app is unable to list /dev but can open files within it like /dev/mali0" border="0" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjbJAsOOwnE0RJ9O7yET8vhuVE-UmrzcyoUVoRP4z4kL7wYGXHHJob-ir9s2pgEDQFaxPmAT14n0hu81XpDrl6BaO7ltXE2jZJ-zIBoPa4hH9PYSSIc2KLk0ulZ_0xLjjaO4_VvhG69zIuqmtoGu1a7s_xn3Ru7_QZnjjLZS2sc8oL-yrwFR6LWUBm1EqA/s624/image6.png" style="max-height: 750px; max-width: 600px;" title="untrusted_app is unable to list /dev but can open files within it like /dev/mali0" /></a></span></p>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c2"></span></p>
 <p class="wuNJCVYdSe-c7"><span>In the case of </span><span class="wuNJCVYdSe-c1">/dev</span><span>, the </span><span class="wuNJCVYdSe-c1">shell</span><span>&nbsp;context </span><span class="wuNJCVYdSe-c19">is </span><span>allowed to open and list the contents of </span><span class="wuNJCVYdSe-c1">/dev</span><span>. That means that by first enumerating the </span><span class="wuNJCVYdSe-c1">/dev</span><span>&nbsp;directory from the </span><span class="wuNJCVYdSe-c1">shell</span><span>&nbsp;context, then attempting to open all discovered files from the </span><span class="wuNJCVYdSe-c1">untrusted_app</span><span>&nbsp;context, a security researcher can understand what drivers are and are not </span><span>accessible</span><span>&nbsp;from an app context in the </span><span class="wuNJCVYdSe-c1">/dev</span><span>&nbsp;directory. However, there are cases where certain directories are simply not listable from a debugging-accessible non-root context, particularly in </span><span class="wuNJCVYdSe-c1">/proc</span><span class="wuNJCVYdSe-c2">. One option to enumerate all these directories would be to root the phone, however, this is not always easily achievable.</span></p>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c2"></span></p>
 <p class="wuNJCVYdSe-c7"><span>A strategy I found helpful in this regard was to examine publicly released kernel source code for the phone model or for similar phone models.</span><span>&nbsp;The location of this source code varies significantly from manufacturer to manufacturer, but the source code is </span><span>usually either hosted on Github or via the manufacturer website</span><span>. Device drivers create f</span><span>iles in </span><span class="wuNJCVYdSe-c1">/proc</span><span>&nbsp;primarily</span><span>&nbsp;via the </span><span class="wuNJCVYdSe-c1">proc_create()</span><span>&nbsp;</span><span>and </span><span class="wuNJCVYdSe-c1">proc_mkdir()</span><span class="wuNJCVYdSe-c2">&nbsp;function calls. A real-world example of this would be:</span></p>

 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c2"></span></p>

 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">parent</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">=</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">proc_mkdir(</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c28 wuNJCVYdSe-c5">&quot;perfmgr&quot;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">,</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c0">NULL</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">);</span></p>

 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">perfmgr_root</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">=</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">parent;</span></p>

 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c4"></span></p>

 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">pe</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">=</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">proc_create(</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c28 wuNJCVYdSe-c5">&quot;perf_ioctl&quot;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">,</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c11 wuNJCVYdSe-c5">0664</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">,</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">parent,</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">&amp;Fops);</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">...</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">pe</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">=</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">proc_create(</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c28 wuNJCVYdSe-c5">&quot;eara_ioctl&quot;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">,</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c11 wuNJCVYdSe-c5">0664</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">,</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">parent,</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">&amp;eara_Fops);</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">...</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">pe</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">=</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">proc_create(</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c28 wuNJCVYdSe-c5">&quot;eas_ioctl&quot;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">,</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c11 wuNJCVYdSe-c5">0664</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">,</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">parent,</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">&amp;eas_Fops);</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">...</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">pe</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">=</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">proc_create(</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c28 wuNJCVYdSe-c5">&quot;xgff_ioctl&quot;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">,</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c11 wuNJCVYdSe-c5">0664</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">,</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">parent,</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">&amp;xgff_Fops);</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">...</span></p>
 <p class="wuNJCVYdSe-c7"><span> </span></p>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c2"></span></p>
 <p class="wuNJCVYdSe-c7"><span>Although these files cannot be directly enumerated, they </span><span class="wuNJCVYdSe-c19">do</span><span class="wuNJCVYdSe-c2">&nbsp;exist and are accessible from an untrusted context.</span></p>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c2"></span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c2"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgyj_BhXcb7qJCBlmypX0tZzSn75nUpANd16viDRspDEgRhdbE_l6t8p2XK1bHVC9NI6vPYIrV4o_sylWf4WaqrOc4sLVFKVTQRCKKz-BxvagFmwO0GBziHvTJUXBYbfb4c1YmgmcpM5Rt-bT2Ld8z15J2s8sxoi_Ed830F3wZnA3dL5uy-3yf4HNBrz4c/s497/image5.png" style="display: block; padding: 1em 0;text-align: center;"><img alt="/proc/perfmgr directory contents cannot be listed with ls, but can be open&#39;d" border="0" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgyj_BhXcb7qJCBlmypX0tZzSn75nUpANd16viDRspDEgRhdbE_l6t8p2XK1bHVC9NI6vPYIrV4o_sylWf4WaqrOc4sLVFKVTQRCKKz-BxvagFmwO0GBziHvTJUXBYbfb4c1YmgmcpM5Rt-bT2Ld8z15J2s8sxoi_Ed830F3wZnA3dL5uy-3yf4HNBrz4c/s497/image5.png" style="max-height: 750px; max-width: 600px;" title="/proc/perfmgr directory contents cannot be listed with ls, but can be open&#39;d" /></a></span></p>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c2"></span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c2">It would have otherwise required rooting the phone to discover this driver without analyzing the kernel source code.</span></p>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c2"></span></p>
 <p class="wuNJCVYdSe-c7"><span>Another useful resource is the SELinux policy itself. Userland interacts with the drivers via a fairly typical set of VFS operations. This means that the SELinux policy </span><span class="wuNJCVYdSe-c19">must</span><span>&nbsp;encapsulate the necessary permissions to perform those operations. This means that the SELinux policy generally reflects what the developers intend to be accessible from an untrusted context. Analysis of the policy can lead to the discovery of certain oddities and idiosyncrasies in the accessibility of certain drivers. For example, occasionally a file may not be directly openable via the filesystem, but there may be some alternative method by which an app can ask another more privileged process to open the file on its behalf and hand the associated </span><span class="wuNJCVYdSe-c1">fd</span><span>&nbsp;back, after which the app </span><span class="wuNJCVYdSe-c19">is </span><span>allowed to </span><span class="wuNJCVYdSe-c1">read</span><span>/</span><span class="wuNJCVYdSe-c1">write</span><span>/</span><span class="wuNJCVYdSe-c1">ioctl</span><span>&nbsp;to the </span><span class="wuNJCVYdSe-c1">fd</span><span class="wuNJCVYdSe-c2">&nbsp;itself. One example of this behavior would be the EdgeTPU device on the Pixel 7:<br></span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c2"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjD4s4ms0da-AJFNNkpiEVi9yew1XcUIY852C3-WuI8Tqidiyl7Zy2rNdNDvyD0MI8RGPsuF6Y9DGo4js9o4r4iI9JHP25Ygrv2cYIiRjkhH8DI9rg0oe-nnxrXCtn23ROy3f3k8Sqp22Nz21TcfjQhyphenhyphenbg1Hj4FU4W7WnMCOPOFYMmksu5uYi-VZeFD8I8/s740/image9.png" style="display: block; padding: 1em 0;text-align: center;"><img alt="" border="0" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjD4s4ms0da-AJFNNkpiEVi9yew1XcUIY852C3-WuI8Tqidiyl7Zy2rNdNDvyD0MI8RGPsuF6Y9DGo4js9o4r4iI9JHP25Ygrv2cYIiRjkhH8DI9rg0oe-nnxrXCtn23ROy3f3k8Sqp22Nz21TcfjQhyphenhyphenbg1Hj4FU4W7WnMCOPOFYMmksu5uYi-VZeFD8I8/s740/image9.png" style="max-height: 750px; max-width: 600px;" title="" /></a></span></p>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c2"></span></p>
 <p class="wuNJCVYdSe-c7"><span>Additional research suggests that </span><span class="wuNJCVYdSe-c1">untrusted_app</span><span>&nbsp;can ask a privileged process for access to the EdgeTPU </span><span>driver </span><span class="wuNJCVYdSe-c1">fd</span><span>&nbsp;itself </span><span class="wuNJCVYdSe-c2">if it lands on an allowlist of certain applications.</span></p>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c2"></span></p>
 <p class="wuNJCVYdSe-c7"><span>The performed surveys strongly imply that the GPU driver is the most consistently accessible driver from an untrusted application, which is expected. On the Google Pixel 7, I did not find much else that was accessible from an entirely unprivileged context. Nevertheless, inspired by </span><span class="wuNJCVYdSe-c34"><a class="wuNJCVYdSe-c181" href="https://googleprojectzero.github.io/0days-in-the-wild//0day-RCAs/2022/CVE-2022-22265.html">previous similar efforts on hardware like Samsung&rsquo;s NPU</a></span><span>, I performed research on the EdgeTPU driver - Google&rsquo;s tensor processing unit for doing ML related tasks on the Pixel series of devices. </span><span>This resulted</span><span>&nbsp;in the discovery of one significant </span><span class="wuNJCVYdSe-c34"><a class="wuNJCVYdSe-c181" href="https://bugs.chromium.org/p/project-zero/issues/detail?id=2455">issue</a></span><span>&nbsp;- a race condition when registering memory with the EdgeTPU memory while vma&rsquo;s are concurrently getting modified.</span></p>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c2"></span></p>
 <p class="wuNJCVYdSe-c7"><span>Unlike the Pixel 7, the </span><span>MediaTek chipset phones </span><span class="wuNJCVYdSe-c2">(Asus ROG 6D and Xiaomi 11T) contained several different drivers that could be accessed from unprivileged userland:</span></p>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c2"></span></p><ul style="padding: 0;" class="c24 lst-kix_o90s8x6qoynp-0 start"><li style="margin-left: 46pt;" class="c7 c17 li-bullet-0"><span class="wuNJCVYdSe-c12 wuNJCVYdSe-c1 wuNJCVYdSe-c26">/proc/ged</span></li><li style="margin-left: 46pt;" class="c7 c17 li-bullet-0"><span class="wuNJCVYdSe-c12 wuNJCVYdSe-c1 wuNJCVYdSe-c26">/proc/mtk_jpeg</span></li><li style="margin-left: 46pt;" class="c7 c17 li-bullet-0"><span class="wuNJCVYdSe-c12 wuNJCVYdSe-c1 wuNJCVYdSe-c26">/proc/perfmgr/[eara_ioctl,eas_ioctl,perf_ioctl,xgff_ioctl]</span></li></ul>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c2"></span></p>
 <p class="wuNJCVYdSe-c7"><span>These drivers represent significantly more interesting and complex attack surfaces than what was available on the Pixel 7 device. The ged driver contained numerous interesting and valuable exploitation primitives that we&rsquo;ll discuss in detail a bit later. While the perfmgr driver presented several attack surfaces, I wasn&rsquo;t able to find any security-relevant bugs. The mtk_jpeg driver however, yielded significant fruit that deserves a closer look.</span></p><h2 class="wuNJCVYdSe-c36" id="h.4bjr0190h2xa"><span class="wuNJCVYdSe-c35 wuNJCVYdSe-c12">MediaTek JPEG Decoding Accelerator</span></h2>
 <p class="wuNJCVYdSe-c7"><span>The mtk_jpeg driver manages specialized hardware on MediaTek devices to perform jpeg decoding acceleration. </span><span class="wuNJCVYdSe-c34"><a class="wuNJCVYdSe-c181" href="https://github.com/torvalds/linux/blob/8f2c057754b25075aa3da132cd4fd4478cdab854/Documentation/devicetree/bindings/media/mediatek-jpeg-decoder.yaml#L12">Linux kernel documentation</a></span><span>&nbsp;notes that &ldquo;Mediatek JPEG Decoder is the JPEG decode hardware present in Mediatek SoCs&rdquo;.</span><span>&nbsp;More relevantly, from an attacker&#39;s point of view, this driver can be accessed (at least on the phones assessed) from the </span><span class="wuNJCVYdSe-c1">untrusted_app</span><span>&nbsp;context (although curiously, it </span><span class="wuNJCVYdSe-c19">cannot</span><span class="wuNJCVYdSe-c2">&nbsp;be accessed from an unprivileged adb debugging context). This JPEG decoding accelerator and its associated driver is present on both the Xiaomi 11T and the Asus ROG 6D. However, based on open-source codebases for these different devices&#39; kernels, it appears MediaTek is actively maintaining several different trees for this driver, likely based on the associated kernel version, and these two devices use separate trees. </span></p>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c2"></span></p>
 <p class="wuNJCVYdSe-c7"><span>I found two vulnerabilities in this driver. </span><span class="wuNJCVYdSe-c34"><a class="wuNJCVYdSe-c181" href="https://bugs.chromium.org/p/project-zero/issues/detail?id=2471">CVE-2023-32837</a></span><span>&nbsp;was a textbook OOB read/write in an array of structs. Various different members of the struct were accessed and modified, creating several different possibilities for exploitation, but also making them significantly more challenging. Interestingly, MediaTek </span><span class="wuNJCVYdSe-c34"><a class="wuNJCVYdSe-c181" href="https://github.com/OnePlusOSS/android_kernel_5.10_oneplus_mt6983/commit/725e99c941caf985b25ef5595b2b4f632320d235">partially fixed</a></span><span>&nbsp;this bug in July 2021, although the exact date this patch went out to OEMs is unclear. From the commit message, it&rsquo;s clear that MediaTek detected this issue with the Coverity static analysis tool, but</span><span>&nbsp;it appears unlikely that </span><span>the security impact was identified. Regardless, while the issue was fixed in some of the MediaTek kernel trees, it went unpatched in other versions of that same driver. This meant that while the Asus ROG 6D (running kernel 5.10) had received the patch for this vulnerability,</span><span>&nbsp;the </span><span>(otherwise fully patched and security supported) Xiaomi 11T </span><span>(running 4.14)</span><span class="wuNJCVYdSe-c2">&nbsp;had not.</span></p>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c2"></span></p>
 <p class="wuNJCVYdSe-c7"><span>Some background knowledge on how the jpeg driver works eases discussion of the other issue, </span><span class="wuNJCVYdSe-c34"><a class="wuNJCVYdSe-c181" href="https://bugs.chromium.org/p/project-zero/issues/detail?id=2470">CVE-2023-32832</a></span><span>. The accelerator hardware has two separate &ldquo;cores&rdquo; that can perform JPEG decoding. When a process requests JPEG decoding work to be performed, it calls the ioctl </span><span class="wuNJCVYdSe-c1">JPEG_DEC_IOCTL_HYBRID_START</span><span>, and the kernel decides which decoding core will perform that work inside of </span><span class="wuNJCVYdSe-c1">jpeg_drv_hybrid_dec_lock()</span><span class="wuNJCVYdSe-c2">(output has been colorized to ease following along):</span></p>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c2"></span></p>
 <p class="wuNJCVYdSe-c7"><span> </span><span class="wuNJCVYdSe-c0">static</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c9 wuNJCVYdSe-c5">int</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">jpeg_drv_hybrid_dec_lock(</span><span class="wuNJCVYdSe-c9 wuNJCVYdSe-c5">int</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">*hwid)</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">{</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c9 wuNJCVYdSe-c5">int</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">retValue</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">=</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c11 wuNJCVYdSe-c5">0</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">;</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c9 wuNJCVYdSe-c5">int</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">id</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">=</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c11 wuNJCVYdSe-c5">0</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">;</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">...</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">mutex_lock(&amp;jpeg_hybrid_dec_lock);</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c0">for</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">(id</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">=</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c11 wuNJCVYdSe-c5">0</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">;</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">id</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">&lt;</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">HW_CORE_NUMBER;</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">id++)</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">{</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c0">if</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">(dec_hwlocked[id])</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">{</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">JPEG_LOG(</span><span class="wuNJCVYdSe-c11 wuNJCVYdSe-c5">1</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">,</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c28 wuNJCVYdSe-c5">&quot;jpeg dec HW core %d is busy&quot;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">,</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">id);</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c0">continue</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">;</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">}</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c0">else</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">{</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">*hwid</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">=</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">id;</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5 wuNJCVYdSe-c31">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c31 wuNJCVYdSe-c5">dec_hwlocked[id]</span><span class="wuNJCVYdSe-c31 wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c31 wuNJCVYdSe-c5">=</span><span class="wuNJCVYdSe-c31 wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c31 wuNJCVYdSe-c5">true;</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">JPEG_LOG(</span><span class="wuNJCVYdSe-c11 wuNJCVYdSe-c5">1</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">,</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c5 wuNJCVYdSe-c28">&quot;jpeg dec get %d HW core&quot;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">,</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">id);</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">_jpeg_hybrid_dec_int_status[id]</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">=</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c11 wuNJCVYdSe-c5">0</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">;</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">jpeg_drv_hybrid_dec_power_on(id);</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">enable_irq(gJpegqDev.hybriddecIrqId[id]);</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c0">break</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">;</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">}</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">}</span></p>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c4"></span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">mutex_unlock(&amp;jpeg_hybrid_dec_lock);</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c0">if</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">(id</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">==</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">HW_CORE_NUMBER)</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">{</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">JPEG_LOG(</span><span class="wuNJCVYdSe-c11 wuNJCVYdSe-c5">1</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">,</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c28 wuNJCVYdSe-c5">&quot;jpeg dec HW core all busy&quot;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">);</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">*hwid</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">=</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">-1;</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">retValue</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">=</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">-EBUSY;</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">}</span></p>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c4"></span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c0">return</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">retValue;</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">}</span></p>
 <p class="wuNJCVYdSe-c7"><span>The array </span><span class="wuNJCVYdSe-c1">dec_hwlocked</span><span>&nbsp;contains a boolean element for each core, with that element being set to </span><span class="wuNJCVYdSe-c1">true</span><span>&nbsp;for locked cores, and </span><span class="wuNJCVYdSe-c1">false</span><span>&nbsp;for unlocked cores. This array is also protected with a mutex to try and prevent concurrent calls to </span><span class="wuNJCVYdSe-c1">jpeg_drv_hybrid_dec_lock</span><span>, or </span><span class="wuNJCVYdSe-c1">jpeg_drv_hybrid_dec_unlock</span><span>&nbsp;from racing with each other. After locking the core, </span><span class="wuNJCVYdSe-c1">jpeg_drv_hybrid_dec_start</span><span class="wuNJCVYdSe-c2">&nbsp;sets up the data-structures to be utilized for the decoding operation:</span></p>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c2"></span></p>
 <p class="wuNJCVYdSe-c7"><span> </span><span class="wuNJCVYdSe-c0">switch </span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">(cmd)</span><span class="wuNJCVYdSe-c0">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">{</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c0 wuNJCVYdSe-c25">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;case </span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c25 wuNJCVYdSe-c5">JPEG_DEC_IOCTL_HYBRID_START:</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if </span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">(copy_from_user(</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">&amp;taskParams,</span><span class="wuNJCVYdSe-c0">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">(</span><span class="wuNJCVYdSe-c0">void </span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">*)arg,</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sizeof</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">(</span><span class="wuNJCVYdSe-c0">struct </span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">JPEG_DEC_DRV_HYBRID_TASK)))</span><span class="wuNJCVYdSe-c0">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">{</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return </span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">-EFAULT;</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">}</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">...</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if </span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">(</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5 wuNJCVYdSe-c42">jpeg_drv_hybrid_dec_lock</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">(&amp;hwid)</span><span class="wuNJCVYdSe-c0">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">==</span><span class="wuNJCVYdSe-c0">&nbsp;</span><span class="wuNJCVYdSe-c11 wuNJCVYdSe-c5">0</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">)</span><span class="wuNJCVYdSe-c0">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">{</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">*pStatus</span><span class="wuNJCVYdSe-c0">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">=</span><span class="wuNJCVYdSe-c0">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">JPEG_DEC_PROCESS;</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">}</span><span class="wuNJCVYdSe-c0">&nbsp;else </span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">{</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">JPEG_LOG(</span><span class="wuNJCVYdSe-c11 wuNJCVYdSe-c5">1</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">,</span><span class="wuNJCVYdSe-c0">&nbsp;</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c28 wuNJCVYdSe-c5">&quot;jpeg_drv_hybrid_dec_lock failed (hw busy)&quot;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">);</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return </span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">-EBUSY;</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">}</span></p>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c0 wuNJCVYdSe-c12"></span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if </span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">(</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5 wuNJCVYdSe-c16">jpeg_drv_hybrid_dec_start</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">(taskParams.data,</span><span class="wuNJCVYdSe-c0">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">hwid,</span><span class="wuNJCVYdSe-c0">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">&amp;index_buf_fd)</span><span class="wuNJCVYdSe-c0">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">==</span><span class="wuNJCVYdSe-c0">&nbsp;</span><span class="wuNJCVYdSe-c11 wuNJCVYdSe-c5">0</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">)</span><span class="wuNJCVYdSe-c0">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">{</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">...</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">}</span><span class="wuNJCVYdSe-c0">&nbsp;else </span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">{</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">JPEG_LOG(</span><span class="wuNJCVYdSe-c11 wuNJCVYdSe-c5">0</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">,</span><span class="wuNJCVYdSe-c0">&nbsp;</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c28 wuNJCVYdSe-c5">&quot;jpeg_drv_dec_hybrid_start failed&quot;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">);</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5 wuNJCVYdSe-c39">jpeg_drv_hybrid_dec_unlock(hwid);</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return </span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">-EFAULT;</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">}</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">;</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c3">...</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c3">}</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c0">static</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c9 wuNJCVYdSe-c5">int</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">jpeg_drv_hybrid_dec_start(</span><span class="wuNJCVYdSe-c5 wuNJCVYdSe-c9">unsigned</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c9 wuNJCVYdSe-c5">int</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">data[],</span><span class="wuNJCVYdSe-c9 wuNJCVYdSe-c5">unsigned</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c9 wuNJCVYdSe-c5">int</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">id,</span><span class="wuNJCVYdSe-c9 wuNJCVYdSe-c5">int</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">*index_buf_fd)</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">{</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">u64</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">ibuf_iova,</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">obuf_iova;</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c9 wuNJCVYdSe-c5">int</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">ret;</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c0">void</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">*ptr;</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c9 wuNJCVYdSe-c5">unsigned</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c9 wuNJCVYdSe-c5">int</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">node_id;</span></p>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c4"></span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">JPEG_LOG(</span><span class="wuNJCVYdSe-c11 wuNJCVYdSe-c5">1</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">,</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c28 wuNJCVYdSe-c5">&quot;+ id:%d&quot;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">,</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">id);</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">ret</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">=</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c11 wuNJCVYdSe-c5">0</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">;</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">ibuf_iova</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">=</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c11 wuNJCVYdSe-c5">0</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">;</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">obuf_iova</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">=</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c11 wuNJCVYdSe-c5">0</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">;</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">node_id</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">=</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">id</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">/</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c11 wuNJCVYdSe-c5">2</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">;</span></p>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c4"></span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">bufInfo[id].o_dbuf</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">=</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">jpg_dmabuf_alloc(data[</span><span class="wuNJCVYdSe-c11 wuNJCVYdSe-c5">20</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">],</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c11 wuNJCVYdSe-c5">128</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">,</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c11 wuNJCVYdSe-c5">0</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">);</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">bufInfo[id].o_attach</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">=</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c0">NULL</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">;</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">bufInfo[id].o_sgt</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">=</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c0">NULL</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">;</span></p>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c4"></span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c20 wuNJCVYdSe-c5">bufInfo[id].i_dbuf</span><span class="wuNJCVYdSe-c20 wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5 wuNJCVYdSe-c20">=</span><span class="wuNJCVYdSe-c20 wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c20 wuNJCVYdSe-c5">jpg_dmabuf_get(data[</span><span class="wuNJCVYdSe-c11 wuNJCVYdSe-c20 wuNJCVYdSe-c5">7</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c20 wuNJCVYdSe-c5">]);</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">bufInfo[id].i_attach</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">=</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c0">NULL</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">;</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">bufInfo[id].i_sgt</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">=</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c0">NULL</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">;</span></p>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c4"></span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c0 wuNJCVYdSe-c32">if</span><span class="wuNJCVYdSe-c5 wuNJCVYdSe-c32">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c32 wuNJCVYdSe-c5">(!bufInfo[id].o_dbuf)</span><span class="wuNJCVYdSe-c32 wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c32 wuNJCVYdSe-c5">{</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c32 wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; </span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c32 wuNJCVYdSe-c5">JPEG_LOG(</span><span class="wuNJCVYdSe-c11 wuNJCVYdSe-c32 wuNJCVYdSe-c5">0</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c32 wuNJCVYdSe-c5">,</span><span class="wuNJCVYdSe-c32 wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c28 wuNJCVYdSe-c32 wuNJCVYdSe-c5">&quot;o_dbuf alloc failed&quot;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c32 wuNJCVYdSe-c5">);</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c32 wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c0 wuNJCVYdSe-c32">return</span><span class="wuNJCVYdSe-c32 wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c32 wuNJCVYdSe-c5">-1;</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c32 wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c32 wuNJCVYdSe-c5">}</span></p>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c4"></span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c0">if</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">(!bufInfo[id].i_dbuf)</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">{</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &nbsp; </span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">JPEG_LOG(</span><span class="wuNJCVYdSe-c11 wuNJCVYdSe-c5">0</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">,</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c28 wuNJCVYdSe-c5">&quot;i_dbuf null error&quot;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">);</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c0">return</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">-1;</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">}</span></p>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c4"></span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">ret</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">=</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">jpg_dmabuf_get_iova(bufInfo[id].o_dbuf,</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">&amp;obuf_iova,</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">gJpegqDev.pDev[node_id],</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">&amp;bufInfo[id].o_attach,</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">&amp;bufInfo[id].o_sgt);</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">JPEG_LOG(</span><span class="wuNJCVYdSe-c11 wuNJCVYdSe-c5">1</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">,</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c28 wuNJCVYdSe-c5">&quot;obuf_iova:0x%llx lsb:0x%lx msb:0x%lx&quot;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">,</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">obuf_iova,</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">(</span><span class="wuNJCVYdSe-c9 wuNJCVYdSe-c5">unsigned</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c9 wuNJCVYdSe-c5">long</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">)(</span><span class="wuNJCVYdSe-c9 wuNJCVYdSe-c5">unsigned</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c9 wuNJCVYdSe-c5">char</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">*)obuf_iova,</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">(</span><span class="wuNJCVYdSe-c9 wuNJCVYdSe-c5">unsigned</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c9 wuNJCVYdSe-c5">long</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">)(</span><span class="wuNJCVYdSe-c9 wuNJCVYdSe-c5">unsigned</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c9 wuNJCVYdSe-c5">char</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">*)(obuf_iova&gt;&gt;</span><span class="wuNJCVYdSe-c11 wuNJCVYdSe-c5">32</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">));</span></p>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c4"></span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">ptr</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">=</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">jpg_dmabuf_vmap(bufInfo[id].o_dbuf);</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c0">if</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">(ptr</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">!=</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c0">NULL</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">&amp;&amp;</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">data[</span><span class="wuNJCVYdSe-c11 wuNJCVYdSe-c5">20</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">]</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">&gt;</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c11 wuNJCVYdSe-c5">0</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">)</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">memset(ptr,</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c11 wuNJCVYdSe-c5">0</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">,</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">data[</span><span class="wuNJCVYdSe-c11 wuNJCVYdSe-c5">20</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">]);</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">jpg_dmabuf_vunmap(bufInfo[id].o_dbuf,</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">ptr);</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">jpg_get_dmabuf(bufInfo[id].o_dbuf);</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c12 wuNJCVYdSe-c14 wuNJCVYdSe-c27 wuNJCVYdSe-c5">// get obuf for adding reference count, avoid early release in userspace.</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">*index_buf_fd</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">=</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">jpg_dmabuf_fd(bufInfo[id].o_dbuf);</span></p>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c4"></span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">ret</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">=</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">jpg_dmabuf_get_iova(bufInfo[id].i_dbuf,</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">&amp;ibuf_iova,</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">gJpegqDev.pDev[node_id],</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">&amp;bufInfo[id].i_attach,</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">&amp;bufInfo[id].i_sgt);</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">JPEG_LOG(</span><span class="wuNJCVYdSe-c11 wuNJCVYdSe-c5">1</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">,</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c28 wuNJCVYdSe-c5">&quot;ibuf_iova 0x%llx lsb:0x%lx msb:0x%lx&quot;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">,</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">ibuf_iova,</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">(</span><span class="wuNJCVYdSe-c9 wuNJCVYdSe-c5">unsigned</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c9 wuNJCVYdSe-c5">long</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">)(</span><span class="wuNJCVYdSe-c9 wuNJCVYdSe-c5">unsigned</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c9 wuNJCVYdSe-c5">char</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">*)ibuf_iova,</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">(</span><span class="wuNJCVYdSe-c9 wuNJCVYdSe-c5">unsigned</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c9 wuNJCVYdSe-c5">long</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">)(</span><span class="wuNJCVYdSe-c9 wuNJCVYdSe-c5">unsigned</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c9 wuNJCVYdSe-c5">char</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">*)(ibuf_iova&gt;&gt;</span><span class="wuNJCVYdSe-c11 wuNJCVYdSe-c5">32</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">));</span></p>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c4"></span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c0">if</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">(ret</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">!=</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c11 wuNJCVYdSe-c5">0</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">)</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">{</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">JPEG_LOG(</span><span class="wuNJCVYdSe-c11 wuNJCVYdSe-c5">0</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">,</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c28 wuNJCVYdSe-c5">&quot;get iova fail i:0x%llx o:0x%llx&quot;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">,</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">ibuf_iova,</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">obuf_iova);</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c0">return</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">ret;</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">}</span></p>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c4"></span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">...</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c0">return</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">ret;</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">}</span></p>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c4"></span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c2"> </span></p>
 <p class="wuNJCVYdSe-c7"><span>Finally, utilizing an ioctl call to </span><span class="wuNJCVYdSe-c1">JPEG_DEC_IOCTL_HYBRID_WAIT</span><span>&nbsp;(which calls </span><span class="wuNJCVYdSe-c1">jpeg_drv_hybrid_dec_unlock</span><span>)</span><span class="wuNJCVYdSe-c2">, resources associated with the core are freed, and the core is released back to be used in future operations.</span></p>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c2"></span></p>
 <p class="wuNJCVYdSe-c7"><span> </span><span class="wuNJCVYdSe-c0">case </span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5 wuNJCVYdSe-c37">JPEG_DEC_IOCTL_HYBRID_WAIT</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">:</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">...</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if </span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">(copy_from_user(</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">&amp;pnsParmas,</span><span class="wuNJCVYdSe-c0">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">(</span><span class="wuNJCVYdSe-c0">void </span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">*)arg,</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sizeof</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">(</span><span class="wuNJCVYdSe-c0">struct </span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">JPEG_DEC_DRV_HYBRID_P_N_S)))</span><span class="wuNJCVYdSe-c0">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">{</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">JPEG_LOG(</span><span class="wuNJCVYdSe-c11 wuNJCVYdSe-c5">0</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">,</span><span class="wuNJCVYdSe-c0">&nbsp;</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c28 wuNJCVYdSe-c5">&quot;Copy from user error&quot;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">);</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return </span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">-EFAULT;</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">}</span></p>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c0 wuNJCVYdSe-c12"></span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">/*</span><span class="wuNJCVYdSe-c0">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">set</span><span class="wuNJCVYdSe-c0">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">timeout</span><span class="wuNJCVYdSe-c0">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">*/</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">timeout_jiff</span><span class="wuNJCVYdSe-c0">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">=</span><span class="wuNJCVYdSe-c0">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">msecs_to_jiffies(</span><span class="wuNJCVYdSe-c11 wuNJCVYdSe-c5">3000</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">);</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">JPEG_LOG(</span><span class="wuNJCVYdSe-c11 wuNJCVYdSe-c5">1</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">,</span><span class="wuNJCVYdSe-c0">&nbsp;</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c28 wuNJCVYdSe-c5">&quot;JPEG Hybrid Decoder Wait Resume Time: %ld&quot;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">,</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">timeout_jiff);</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">hwid</span><span class="wuNJCVYdSe-c0">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">=</span><span class="wuNJCVYdSe-c0">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">pnsParmas.hwid;</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if </span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">(hwid</span><span class="wuNJCVYdSe-c0">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">&lt;</span><span class="wuNJCVYdSe-c0">&nbsp;</span><span class="wuNJCVYdSe-c11 wuNJCVYdSe-c5">0</span><span class="wuNJCVYdSe-c0">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">||</span><span class="wuNJCVYdSe-c0">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">hwid</span><span class="wuNJCVYdSe-c0">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">&gt;=</span><span class="wuNJCVYdSe-c0">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">HW_CORE_NUMBER)</span><span class="wuNJCVYdSe-c0">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">{ </span><span class="wuNJCVYdSe-c12 wuNJCVYdSe-c14 wuNJCVYdSe-c27 wuNJCVYdSe-c5">//In other versions of the driver, this &gt;= check was omitted, which led to several different OOB accesses later aka CVE-2023-32837</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">JPEG_LOG(</span><span class="wuNJCVYdSe-c11 wuNJCVYdSe-c5">0</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">,</span><span class="wuNJCVYdSe-c0">&nbsp;</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c28 wuNJCVYdSe-c5">&quot;get hybrid dec id failed&quot;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">);</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return </span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">-EFAULT;</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">}</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c0 wuNJCVYdSe-c23">if </span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c23 wuNJCVYdSe-c5">(!dec_hwlocked[hwid])</span><span class="wuNJCVYdSe-c0 wuNJCVYdSe-c23">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c23 wuNJCVYdSe-c5">{</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">JPEG_LOG(</span><span class="wuNJCVYdSe-c11 wuNJCVYdSe-c5">0</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">,</span><span class="wuNJCVYdSe-c0">&nbsp;</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c28 wuNJCVYdSe-c5">&quot;wait on unlock core %d\n&quot;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">,</span><span class="wuNJCVYdSe-c0">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">hwid);</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return </span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">-EFAULT;</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">}</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if </span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">(jpeg_isr_hybrid_dec_lisr(hwid)</span><span class="wuNJCVYdSe-c0">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">&lt;</span><span class="wuNJCVYdSe-c0">&nbsp;</span><span class="wuNJCVYdSe-c11 wuNJCVYdSe-c5">0</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">)</span><span class="wuNJCVYdSe-c0">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">{</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c9 wuNJCVYdSe-c5">long</span><span class="wuNJCVYdSe-c0">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">ret</span><span class="wuNJCVYdSe-c0">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">=</span><span class="wuNJCVYdSe-c0">&nbsp;</span><span class="wuNJCVYdSe-c11 wuNJCVYdSe-c5">0</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">;</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c9 wuNJCVYdSe-c5">int</span><span class="wuNJCVYdSe-c0">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">waitfailcnt</span><span class="wuNJCVYdSe-c0">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">=</span><span class="wuNJCVYdSe-c0">&nbsp;</span><span class="wuNJCVYdSe-c11 wuNJCVYdSe-c5">0</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">;</span></p>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c0 wuNJCVYdSe-c12"></span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;do </span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">{</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">ret</span><span class="wuNJCVYdSe-c0">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">=</span><span class="wuNJCVYdSe-c0">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c15 wuNJCVYdSe-c5">wait_event_interruptible_timeout(</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c0 wuNJCVYdSe-c15">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c15 wuNJCVYdSe-c5">hybrid_dec_wait_queue[hwid],</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c0 wuNJCVYdSe-c15">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c15 wuNJCVYdSe-c5">_jpeg_hybrid_dec_int_status[hwid],</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c0 wuNJCVYdSe-c15">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c15 wuNJCVYdSe-c5">timeout_jiff);</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">...</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if </span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">(ret</span><span class="wuNJCVYdSe-c0">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">&lt;</span><span class="wuNJCVYdSe-c0">&nbsp;</span><span class="wuNJCVYdSe-c11 wuNJCVYdSe-c5">0</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">)</span><span class="wuNJCVYdSe-c0">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">{</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">waitfailcnt++;</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">usleep_range(</span><span class="wuNJCVYdSe-c5 wuNJCVYdSe-c11">10000</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">,</span><span class="wuNJCVYdSe-c0">&nbsp;</span><span class="wuNJCVYdSe-c11 wuNJCVYdSe-c5">20000</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">);</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">}</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">}</span><span class="wuNJCVYdSe-c0">&nbsp;while </span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">(ret</span><span class="wuNJCVYdSe-c0">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">&lt;</span><span class="wuNJCVYdSe-c0">&nbsp;</span><span class="wuNJCVYdSe-c11 wuNJCVYdSe-c5">0</span><span class="wuNJCVYdSe-c0">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">&amp;&amp;</span><span class="wuNJCVYdSe-c0">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">waitfailcnt</span><span class="wuNJCVYdSe-c0">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">&lt;</span><span class="wuNJCVYdSe-c0">&nbsp;</span><span class="wuNJCVYdSe-c11 wuNJCVYdSe-c5">500</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">);</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">}</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if </span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">(copy_to_user(pnsParmas.progress_n_status,</span><span class="wuNJCVYdSe-c0">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">&amp;progress_n_status,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sizeof</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">(</span><span class="wuNJCVYdSe-c9 wuNJCVYdSe-c5">int</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">)))</span><span class="wuNJCVYdSe-c0">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">{</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return </span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">-EFAULT;</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">}</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">...</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c0">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c3 wuNJCVYdSe-c29">jpeg_drv_hybrid_dec_unlock(hwid);</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c0">break</span><span class="wuNJCVYdSe-c3">;</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c3">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;...</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c3">}</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">...</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c0">static</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c0">void</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">jpeg_drv_hybrid_dec_unlock(</span><span class="wuNJCVYdSe-c9 wuNJCVYdSe-c5">unsigned</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c9 wuNJCVYdSe-c5">int</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">hwid)</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">{</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">mutex_lock(&amp;jpeg_hybrid_dec_lock);</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c0">if</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">(!dec_hwlocked[hwid])</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">{</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">JPEG_LOG(</span><span class="wuNJCVYdSe-c11 wuNJCVYdSe-c5">0</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">,</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c28 wuNJCVYdSe-c5">&quot;try to unlock a free core %d&quot;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">,</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">hwid);</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">}</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c0">else</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">{</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">dec_hwlocked[hwid]</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">=</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">false;</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">JPEG_LOG(</span><span class="wuNJCVYdSe-c11 wuNJCVYdSe-c5">1</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">,</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c28 wuNJCVYdSe-c5">&quot;jpeg dec HW core %d is unlocked&quot;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">,</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">hwid);</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">jpeg_drv_hybrid_dec_power_off(hwid);</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">disable_irq(gJpegqDev.hybriddecIrqId[hwid]);</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c22 wuNJCVYdSe-c5">jpg_dmabuf_free_iova(bufInfo[hwid].i_dbuf,</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c22 wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c22 wuNJCVYdSe-c5">bufInfo[hwid].i_attach,</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c22 wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c22 wuNJCVYdSe-c5">bufInfo[hwid].i_sgt);</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c22 wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c22 wuNJCVYdSe-c5">jpg_dmabuf_free_iova(bufInfo[hwid].o_dbuf,</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5 wuNJCVYdSe-c22">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c22 wuNJCVYdSe-c5">bufInfo[hwid].o_attach,</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c22 wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c22 wuNJCVYdSe-c5">bufInfo[hwid].o_sgt);</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c22 wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c22 wuNJCVYdSe-c5">jpg_dmabuf_put(bufInfo[hwid].i_dbuf);</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c22 wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c22 wuNJCVYdSe-c5">jpg_dmabuf_put(bufInfo[hwid].o_dbuf);</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c12 wuNJCVYdSe-c14 wuNJCVYdSe-c27 wuNJCVYdSe-c5">// we manually add 1 ref count, need to put it.</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">}</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">mutex_unlock(&amp;jpeg_hybrid_dec_lock);</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">}</span></p>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c4"></span></p>
 <p class="wuNJCVYdSe-c7"><span> </span><span class="wuNJCVYdSe-c1">jpeg_drv_hybrid_dec_unlock</span><span>&nbsp;is also called in the event that </span><span class="wuNJCVYdSe-c1">jpeg_drv_hybrid_dec_start</span><span class="wuNJCVYdSe-c2">&nbsp;fails.</span></p>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c2"></span></p>
 <p class="wuNJCVYdSe-c7"><span>While the </span><span class="wuNJCVYdSe-c1">jpeg_hybrid_dec_lock</span><span>&nbsp;mutex protects the direct core locking and unlocking, it does </span><span class="wuNJCVYdSe-c19">not </span><span>protect the body of the </span><span class="wuNJCVYdSe-c1">jpeg_drv_hybrid_dec_start</span><span>&nbsp;function. This means that while there cannot be concurrent calls to both </span><span class="wuNJCVYdSe-c1">jpeg_drv_hybrid_dec_lock</span><span>&nbsp;and </span><span class="wuNJCVYdSe-c1">jpeg_drv_hybrid_dec_unlock</span><span>, there </span><span class="wuNJCVYdSe-c19">can</span><span>&nbsp;be concurrent calls to </span><span class="wuNJCVYdSe-c1">jpeg_drv_hybrid_dec_start</span><span>&nbsp;and </span><span class="wuNJCVYdSe-c1">jpeg_drv_hybrid_dec_unlock</span><span>&nbsp;which in practice is just as bad, as these two functions racily access the same global data structure </span><span class="wuNJCVYdSe-c1">bufInfo</span><span class="wuNJCVYdSe-c2">.</span></p>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c2"></span></p>
 <p class="wuNJCVYdSe-c7"><span>One small added complication for this bug is that in order to reach the </span><span class="wuNJCVYdSe-c1">jpeg_drv_hybrid_dec_unlock</span><span>&nbsp;in the </span><span class="wuNJCVYdSe-c1">JPEG_DEC_IOCTL_HYBRID_WAIT</span><span>&nbsp;call, the core </span><span>must be locked before the timeout due to </span><span class="wuNJCVYdSe-c2 wuNJCVYdSe-c23">a check to ensure that the core is locked before attempting to wait on the core.</span></p>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c2"></span></p>
 <p class="wuNJCVYdSe-c7"><span>An example of this race in practice with two processes A and B would be (colorized respective to the above code):</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c12 wuNJCVYdSe-c26 wuNJCVYdSe-c19 wuNJCVYdSe-c41">Process A:</span></p>
 <p class="wuNJCVYdSe-c7"><span>Calls ioctl </span><span class="wuNJCVYdSe-c1 wuNJCVYdSe-c25">JPEG_DEC_IOCTL_HYBRID_START</span><span>, which </span><span class="wuNJCVYdSe-c31">locks core 0</span><span>&nbsp;with </span><span class="wuNJCVYdSe-c1 wuNJCVYdSe-c42">jpeg_drv_hybrid_dec_lock</span><span>&nbsp;and enters </span><span class="wuNJCVYdSe-c12 wuNJCVYdSe-c1 wuNJCVYdSe-c26 wuNJCVYdSe-c16">jpeg_drv_hybrid_dec_start</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c12 wuNJCVYdSe-c26 wuNJCVYdSe-c19 wuNJCVYdSe-c41">Process B:</span></p>
 <p class="wuNJCVYdSe-c7"><span>Calls ioctl </span><span class="wuNJCVYdSe-c1 wuNJCVYdSe-c37">JPEG_DEC_IOCTL_HYBRID_WAIT</span><span>, which </span><span class="wuNJCVYdSe-c23">confirms that core 0 is locked</span><span>&nbsp;then </span><span class="wuNJCVYdSe-c15">begins a 3 second wait</span><span class="wuNJCVYdSe-c2">&nbsp;for the core to send an interrupt denoting completion of the decoding request.</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c12 wuNJCVYdSe-c26 wuNJCVYdSe-c19 wuNJCVYdSe-c41">Process A:</span></p>
 <p class="wuNJCVYdSe-c7"><span>Fails </span><span class="wuNJCVYdSe-c1 wuNJCVYdSe-c32">jpeg_drv_hybrid_dec_start</span><span>, (</span><span class="wuNJCVYdSe-c20">after initializing some of the data structures</span><span>), </span><span class="wuNJCVYdSe-c39">calls jpeg_drv_hybrid_dec_unlock on core 0</span><span>&nbsp;</span><span class="wuNJCVYdSe-c22">freeing any allocated resources</span><span class="wuNJCVYdSe-c2">, and returns to userland.</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c2">[wait ~3 seconds]</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c12 wuNJCVYdSe-c26 wuNJCVYdSe-c19 wuNJCVYdSe-c41">Process A:</span></p>
 <p class="wuNJCVYdSe-c7"><span>Calls ioctl </span><span class="wuNJCVYdSe-c1 wuNJCVYdSe-c25">JPEG_DEC_IOCTL_HYBRID_START</span><span>, which </span><span class="wuNJCVYdSe-c31">locks core 0</span><span>&nbsp;with </span><span class="wuNJCVYdSe-c1 wuNJCVYdSe-c42">jpeg_drv_hybrid_dec_lock</span><span>&nbsp;and enters </span><span class="wuNJCVYdSe-c12 wuNJCVYdSe-c1 wuNJCVYdSe-c26 wuNJCVYdSe-c16">jpeg_drv_hybrid_dec_start</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c19">Process B:<br></span><span>3 second wait times out, and the </span><span class="wuNJCVYdSe-c1">JPEG_DEC_IOCTL_HYBRID_WAIT</span><span>&nbsp;ioctl call unlocks core 0 with </span><span class="wuNJCVYdSe-c1 wuNJCVYdSe-c29">jpeg_drv_hybrid_dec_unlock</span><span class="wuNJCVYdSe-c2">.</span></p>
 <p class="wuNJCVYdSe-c7"><span>[Process A and B are now concurrently </span><span class="wuNJCVYdSe-c20">initializing</span><span>&nbsp;and </span><span class="wuNJCVYdSe-c22">freeing</span><span>&nbsp;the same data-structures]</span></p>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c2"></span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c2">This can lead to a variety of use-after-free or double free conditions, depending on how process A and B race.</span></p>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c2"></span></p><h2 class="wuNJCVYdSe-c36" id="h.84nl0o7e1rz3"><span class="wuNJCVYdSe-c35 wuNJCVYdSe-c12">The Journey to root</span></h2>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c2">The next step was to try to exploit these issues. My first attempt targeted the OOB write issue, CVE-2023-32837. I was able to develop the primitive from an uncontrolled OOB read/write in the kernel .data region into a racy write of null bytes at a predetermined offset in a kernel task stack used by an attacker-controlled process. At this point it was possible to overwrite a kernel stack entry with nulls during any syscall which felt to me like enough flexibility to create a full exploit. However, despite my best efforts (including the creation of a tool to find where in an arbitrary backtrace the write would occur), I was unable to discover a technique to create a better primitive from this write.</span></p>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c2"></span></p>
 <p class="wuNJCVYdSe-c7"><span>Failing that effort, I decided to take a look at the other issue in the same driver CVE-2023-32832. During the freeing step that races with </span><span class="wuNJCVYdSe-c1">jpeg_drv_hybrid_dec_start</span><span>, </span><span class="wuNJCVYdSe-c1">jpeg_drv_hybrid_dec_unlock</span><span class="wuNJCVYdSe-c2">&nbsp;drops access to four separate resources:</span></p>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c2"></span></p>
 <p class="wuNJCVYdSe-c7"><span> </span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">jpg_dmabuf_free_iova(bufInfo[hwid].i_dbuf, bufInfo[hwid].i_attach,</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">bufInfo[hwid].i_sgt); </span><span class="wuNJCVYdSe-c12 wuNJCVYdSe-c14 wuNJCVYdSe-c27 wuNJCVYdSe-c5">//The input buffer virtual address mapping in the core</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">jpg_dmabuf_free_iova(bufInfo[hwid].o_dbuf, bufInfo[hwid].o_attach,</span><span class="wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">bufInfo[hwid].o_sgt); </span><span class="wuNJCVYdSe-c12 wuNJCVYdSe-c14 wuNJCVYdSe-c27 wuNJCVYdSe-c5">//The output buffer virtual address mapping in the core</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">jpg_dmabuf_put(bufInfo[hwid].i_dbuf); </span><span class="wuNJCVYdSe-c12 wuNJCVYdSe-c14 wuNJCVYdSe-c5 wuNJCVYdSe-c27">//The input buffer file&#39;s refcount is decremented. This buffer was previously allocated by the attacker and is associated with a file descriptor.</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">jpg_dmabuf_put(bufInfo[hwid].o_dbuf); </span><span class="wuNJCVYdSe-c12 wuNJCVYdSe-c14 wuNJCVYdSe-c27 wuNJCVYdSe-c5">//The output buffer file&#39;s refcount is decremented. This buffer was previously allocated during jpeg_drv_hybrid_dec_start.</span></p>
 <p class="wuNJCVYdSe-c7"><span> </span><span>One critical behavior of the driver that enhanced exploitability was that although </span><span class="wuNJCVYdSe-c1">jpeg_drv_hybrid_dec_unlock</span><span>&nbsp;properly drops the refcounts of </span><span class="wuNJCVYdSe-c1">i_dbuf</span><span>&nbsp;and </span><span class="wuNJCVYdSe-c1">o_dbuf</span><span>, it does </span><span class="wuNJCVYdSe-c19">not</span><span>&nbsp;reinitialize those entries in the </span><span class="wuNJCVYdSe-c1">bufInfo</span><span>&nbsp;global array to </span><span class="wuNJCVYdSe-c1">NULL</span><span>. As it relates to the race, this means that if Process B&rsquo;s racy </span><span class="wuNJCVYdSe-c1">jpeg_drv_hybrid_dec_unlock</span><span>&nbsp;occurs before Process A&rsquo;s second </span><span class="wuNJCVYdSe-c1">jpeg_drv_hybrid_dec_start</span><span>&nbsp;reinitializes </span><span class="wuNJCVYdSe-c1">i_dbuf</span><span>&nbsp;and </span><span class="wuNJCVYdSe-c1">o_dbuf</span><span>, an extra refcount of </span><span class="wuNJCVYdSe-c1">i_dbuf</span><span>&nbsp;and </span><span class="wuNJCVYdSe-c1">o_dbuf</span><span>&nbsp;will be released. Since </span><span class="wuNJCVYdSe-c1">i_dbuf</span><span>&nbsp;and </span><span class="wuNJCVYdSe-c1">o_dbuf</span><span>&nbsp;are </span><span class="wuNJCVYdSe-c1">struct file*</span><span>&rsquo;s, this can lead directly to a </span><span class="wuNJCVYdSe-c1">struct file</span><span>&nbsp;UAF. As the </span><span class="wuNJCVYdSe-c1">i_dbuf</span><span>&nbsp;</span><span class="wuNJCVYdSe-c1">struct</span><span>&nbsp;</span><span class="wuNJCVYdSe-c1">file</span><span>&nbsp;comes directly from a </span><span class="wuNJCVYdSe-c1">dmabuf</span><span>&nbsp;file descriptor passed into </span><span class="wuNJCVYdSe-c1">jpeg_drv_hybrid_dec_start</span><span>, this leads to a </span><span class="wuNJCVYdSe-c19">dangling file descriptor</span><span>&nbsp;with the </span><span class="wuNJCVYdSe-c1">struct file</span><span class="wuNJCVYdSe-c2">&nbsp;freed from underneath it. This is undoubtedly an exploitable bug.</span></p>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c2"></span></p>
 <p class="wuNJCVYdSe-c7"><span>There are several different techniques for exploiting a dangling file descriptor. One widely used strategy is causing the backing slab page of the struct file to be freed and returned back to the page allocator, then reallocating that page </span><span>with pipe buffer</span><span>&nbsp;data pages in order to gain attacker control over the memory used for the struct file. Another well-known strategy would be to utilize the cross-cache technique to reallocate the memory as a different kind of kmalloc slab/object. However, in the future both of these techniques may be remediated if the </span><span class="wuNJCVYdSe-c34"><a class="wuNJCVYdSe-c181" href="https://www.google.com/url?q=https://lore.kernel.org/all/20230915105933.495735-15-matteorizzo@google.com/&sa=D&source=docs&ust=1712947244908914&usg=AOvVaw0WRxCpYz3NaM3wsC8DKyOp">SLAB_VIRTUAL mitigation</a></span><span class="wuNJCVYdSe-c34"><a class="wuNJCVYdSe-c181" href="https://www.google.com/url?q=https://lore.kernel.org/all/20230915105933.495735-15-matteorizzo@google.com/&sa=D&source=docs&ust=1712947244908914&usg=AOvVaw0WRxCpYz3NaM3wsC8DKyOp">&nbsp;</a></span><span class="wuNJCVYdSe-c2">comes into effect in the mainline Linux kernel. In the interest of exploring the future of Android kernel hacking, I sought a novel exploitation technique which did not involve cross-cache or slab-cache-&gt;page allocator heap shaping techniques.</span></p>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c2"></span></p><h3 class="wuNJCVYdSe-c40" id="h.5itga4usq4ih"><span class="wuNJCVYdSe-c33 wuNJCVYdSe-c12">Some Other Novel Exploitation Technique</span></h3>
 <p class="wuNJCVYdSe-c7"><span>One of the most common UAF exploit techniques involves reallocating the first-order freed object with a new object of a different type, creating a type-confusion condition which leads to an improved memory corruption primitive. However the only type of object that can be allocated in a page designated for the </span><span class="wuNJCVYdSe-c1">struct file</span><span>&nbsp;cache is the </span><span class="wuNJCVYdSe-c1">struct file</span><span>&nbsp;type, so the options for creating a type confusion memory corruption condition using first-order object reclamation are limited. However, just because an object is freed does not preclude it from being usable under limited circumstances. When the kernel inserts an object onto a freelist, this </span><span>clobbers</span><span>&nbsp;</span><span class="wuNJCVYdSe-c34"><a class="wuNJCVYdSe-c181" href="https://lore.kernel.org/linux-mm/202003051624.AAAC9AECC@keescook/t/">the middle</a></span><span>&nbsp;of the object. The rest of the object however, remains in whatever state it was in at the moment it was freed, including pointers and any other member variables. Those stale pointers can (and in practice often do) point to other freed objects which may be allocated from a different slab cache entirely, potentially including the generic kmalloc slab-caches. </span><span>Note that under the </span><span class="wuNJCVYdSe-c34"><a class="wuNJCVYdSe-c181" href="https://wiki.sei.cmu.edu/confluence/pages/viewpage.action?pageId=87152148">C-ism</a></span><span class="wuNJCVYdSe-c34"><a class="wuNJCVYdSe-c181" href="https://wiki.sei.cmu.edu/confluence/pages/viewpage.action?pageId=87152148">&nbsp;where pointers are set to </a></span><span class="wuNJCVYdSe-c34 wuNJCVYdSe-c1"><a class="wuNJCVYdSe-c181" href="https://wiki.sei.cmu.edu/confluence/pages/viewpage.action?pageId=87152148">NULL</a></span><span class="wuNJCVYdSe-c34"><a class="wuNJCVYdSe-c181" href="https://wiki.sei.cmu.edu/confluence/pages/viewpage.action?pageId=87152148">&nbsp;after freeing</a></span><span>, these stale pointers wouldn&rsquo;t exist.</span><span>&nbsp;However as the memory containing the pointer is getting freed anyway, setting these pointers to </span><span class="wuNJCVYdSe-c1">NULL</span><span>&nbsp;is often seen as unnecessarily conservative (and in fact, </span><span class="wuNJCVYdSe-c34"><a class="wuNJCVYdSe-c181" href="https://www.cryptologie.net/article/419/zeroing-memory-compiler-optimizations-and-memset_s/">C compilers often throw away writes to objects that are about to be freed</a></span><span class="wuNJCVYdSe-c2">).</span></p>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c2"></span></p>
 <p class="wuNJCVYdSe-c7"><span>By continuing to use this freed </span><span class="wuNJCVYdSe-c19">first-order</span><span>&nbsp;object, we can implicitly access freed </span><span class="wuNJCVYdSe-c19">second-order</span><span>&nbsp;child objects. By reclaiming </span><span class="wuNJCVYdSe-c19">those</span><span class="wuNJCVYdSe-c2">&nbsp;objects, we can recreate a type-confusion memory corruption primitive, taking advantage of how the methods called on the first-order freed object implicitly access the second-order child object. Let&rsquo;s see how we can apply this to our specific scenario.</span></p>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c2"></span></p>
 <p class="wuNJCVYdSe-c7"><span>Linux kernel </span><span class="wuNJCVYdSe-c1">struct file</span><span>s may represent many different types of files depending on the kind of opened file </span><span>such as ext4 files, procfs files, or even MediaTek JPEG decoding driver files. In order to represent all of these different types while also maintaining some commonality of structure for the universally needed members of an opened file, </span><span class="wuNJCVYdSe-c1">struct file</span><span>&nbsp;contains a </span><span class="wuNJCVYdSe-c1">private_data</span><span>&nbsp;member which references any type-specific data needed.</span></p>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c2"></span></p>
 <p class="wuNJCVYdSe-c7"><span>As mentioned previously, the UAF&rsquo;d </span><span class="wuNJCVYdSe-c1">struct file</span><span>&nbsp;in this case is a </span><span class="wuNJCVYdSe-c1">dmabuf</span><span>&nbsp;file. This means the </span><span class="wuNJCVYdSe-c1">private_data</span><span>&nbsp;pointer points to a </span><span class="wuNJCVYdSe-c1">struct dma_buf</span><span>&nbsp;object. The </span><span class="wuNJCVYdSe-c1">dma_buf</span><span>&nbsp;object lifetime is implicitly tied to the lifetime of the associated </span><span class="wuNJCVYdSe-c1">dmabuf</span><span>&nbsp;file struct. When the </span><span class="wuNJCVYdSe-c1">dmabuf struct file</span><span>&nbsp;is freed, the </span><span class="wuNJCVYdSe-c1">dma_buf</span><span>&nbsp;object is freed too. However </span><span class="wuNJCVYdSe-c19">unlike</span><span>&nbsp;the </span><span class="wuNJCVYdSe-c1">struct file</span><span>, </span><span class="wuNJCVYdSe-c1">dma_buf</span><span>&nbsp;objects are allocated from the generic kmalloc slab caches</span><span>. This means that the </span><span class="wuNJCVYdSe-c1">dma_buf</span><span>&nbsp;</span><span class="wuNJCVYdSe-c19">can </span><span class="wuNJCVYdSe-c2">be reclaimed with a different type object that comes from the same generic kmalloc slab cache.</span></p>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c2"></span></p>
 <p class="wuNJCVYdSe-c7"><span>After a hypothetical reclamation by a new object, this new object can still be UAF referenced </span><span class="wuNJCVYdSe-c19">as</span><span>&nbsp;a </span><span class="wuNJCVYdSe-c1">dma_buf</span><span>&nbsp;through the freed but still very usable </span><span class="wuNJCVYdSe-c1">dmabuf struct file</span><span>&nbsp;that </span><span class="wuNJCVYdSe-c19">itself </span><span class="wuNJCVYdSe-c2">is referenced via the dangling file descriptor! Thus we arrive at the following strategy:</span></p><ol class="c24 lst-kix_ogq86rcrhsr-0 start" start="1"><li style="margin-left: 46pt;" class="c7 c17 li-bullet-0"><span>Free the file by using our race condition bug to drop an extra reference on </span><span class="wuNJCVYdSe-c1">i_dbuf</span><span>&nbsp;(which also frees the </span><span class="wuNJCVYdSe-c1">dma_buf</span><span>), leaving a dangling </span><span class="wuNJCVYdSe-c1">fd</span><span>&nbsp;pointing to a freed </span><span class="wuNJCVYdSe-c1">struct file</span><span>&nbsp;which still has a stale pointer to a freed </span><span class="wuNJCVYdSe-c12 wuNJCVYdSe-c1 wuNJCVYdSe-c26">dma_buf</span></li><li style="margin-left: 46pt;" class="c7 c17 li-bullet-0"><span>Reclaim the </span><span class="wuNJCVYdSe-c1">dma_buf</span><span>&nbsp;WITHOUT reclaiming the </span><span class="wuNJCVYdSe-c12 wuNJCVYdSe-c1 wuNJCVYdSe-c26">struct file</span></li><li style="margin-left: 46pt;" class="c7 c17 li-bullet-0"><span>Call </span><span class="wuNJCVYdSe-c1">dma_buf</span><span>&nbsp;operations on the dangling </span><span class="wuNJCVYdSe-c12 wuNJCVYdSe-c1 wuNJCVYdSe-c26">fd</span></li></ol>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c2"></span></p>
 <p class="wuNJCVYdSe-c7"><span>You may have astutely noted by this point that this strategy relies on a freed object (that is, the </span><span class="wuNJCVYdSe-c1">struct file</span><span>) not being reclaimed as another object by the heap allocator. This is absolutely correct, and one would expect that in an exploit where exceptional reliability is a priority, it may be necessary to perform some heap shaping in order to bury this freed </span><span class="wuNJCVYdSe-c1">struct file</span><span>&nbsp;deeply in the allocator freelists. In practice (and in my exploit), the freed </span><span class="wuNJCVYdSe-c1">struct file</span><span class="wuNJCVYdSe-c2">&nbsp;will rarely be on the percpu active slab so it&rsquo;s unlikely to get reclaimed immediately, and my exploit generally runs fast enough that it doesn&rsquo;t matter.</span></p>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c2"></span></p>
 <p class="wuNJCVYdSe-c7"><span>At this point we now need to determine what object to use in order to reclaim the freed </span><span class="wuNJCVYdSe-c1">dma_buf</span><span>, as well as what operation to call on the freed </span><span class="wuNJCVYdSe-c1">dma_buf</span><span class="wuNJCVYdSe-c2">&nbsp;file/object to develop a stronger primitive. I ended up finding the solutions to both of these problems in the GED driver.</span></p><h3 class="wuNJCVYdSe-c40" id="h.5y999iuz9knd"><span class="wuNJCVYdSe-c33 wuNJCVYdSe-c12">The GED driver</span></h3>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c2">The GED (GPU Extension Device) driver is a MediaTek-specific interface that provides userland with several supplementary GPU features, primarily for tuning purposes. Two of its &ldquo;features&rdquo; appeared particularly valuable. Feature number one, GED GE Buffers, presented a truly remarkable heap spray and reclamation primitive. This feature provides several requisite characteristics of a suitable heap spray primitive:</span></p><ul style="padding: 0;" class="c24 lst-kix_3dxxrae9diso-0 start"><li style="margin-left: 46pt;" class="c7 c17 li-bullet-0"><span class="wuNJCVYdSe-c2">Allocates buffers of a controlled size without causing undue noise for the rest of the heap.</span></li><li style="margin-left: 46pt;" class="c7 c17 li-bullet-0"><span class="wuNJCVYdSe-c2">Buffer data is fully attacker controlled, with no uncontrolled header at the beginning</span></li><li style="margin-left: 46pt;" class="c7 c17 li-bullet-0"><span class="wuNJCVYdSe-c2">Buffers can be freed at any time.</span></li></ul>
 <p class="wuNJCVYdSe-c7"><span>One standout characteristic that elevates this heap spray primitive above many of its peers however, is that even once allocated, the attacker can read and write to these buffers at will </span><span class="wuNJCVYdSe-c19">while keeping the buffer allocated.</span><span>&nbsp;This is about as powerful a heap spray primitive as one could imagine. By reclaiming the UAF&rsquo;d </span><span class="wuNJCVYdSe-c1">dma_buf</span><span>&nbsp;struct with a GED GE buffer, we gain fully deterministic read/write over the </span><span class="wuNJCVYdSe-c1">dma_buf</span><span class="wuNJCVYdSe-c2">&nbsp;struct, including any pointers contained therein.</span></p>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c2"></span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c2"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjc09kF7Yn0WI8PNuSGP9V1mXoszwnxS_FSdSUgDBVeFuZJ4l_CNTFrqrmCBrCnrrQ43x_jrQEloAj5hHz8mIPLUW7KNWZC4TP39vBNgZHDNAT1gMjxYsCNXzGb0qU6aO8J4g4QrsvYBgnClQlm-I__4IWSCgZbWULq-zMZvBQPXlAU7qS83gj4fQPNrAk/s721/image7.png" style="display: block; padding: 1em 0;text-align: center;"><img alt="Graph showing the overlapping object hierarchy of a UAF&#39;d dma buffer struct file and a GE file" border="0" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjc09kF7Yn0WI8PNuSGP9V1mXoszwnxS_FSdSUgDBVeFuZJ4l_CNTFrqrmCBrCnrrQ43x_jrQEloAj5hHz8mIPLUW7KNWZC4TP39vBNgZHDNAT1gMjxYsCNXzGb0qU6aO8J4g4QrsvYBgnClQlm-I__4IWSCgZbWULq-zMZvBQPXlAU7qS83gj4fQPNrAk/s721/image7.png" style="max-height: 750px; max-width: 600px;" title="Graph showing the overlapping object hierarchy of a UAF&#39;d dma buffer struct file and a GE file" /></a></span></p>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c2"></span></p>
 <p class="wuNJCVYdSe-c7"><span>Feature number two is an alternate codepath to the same functionality as the </span><span class="wuNJCVYdSe-c1">DMA_BUF_SET_NAME</span><span>&nbsp;ioctl, which is (very sensibly) used to set the name of a </span><span class="wuNJCVYdSe-c1">dma_buf</span><span>. The biggest difference between these paths is the GED codepath&rsquo;s lack of SELinux inode checks on the underlying </span><span class="wuNJCVYdSe-c1">dma_buf</span><span>&nbsp;</span><span class="wuNJCVYdSe-c1">fd</span><span>. These inode checks would normally crash the kernel when they run on a freed </span><span class="wuNJCVYdSe-c1">struct file</span><span>&nbsp;- however because of the GED codepath, we can skip this inode check, and change the </span><span class="wuNJCVYdSe-c1">dma_buf</span><span>&rsquo;s name despite running on a freed </span><span class="wuNJCVYdSe-c1">dma_buf</span><span>&nbsp;file! Normally, this code would free the pointer to the previous name within the </span><span class="wuNJCVYdSe-c1">dma_buf</span><span>&nbsp;struct and allocate a new buffer for the name string. However, because of GED GE buffers we are able to control the entirety of the </span><span class="wuNJCVYdSe-c1">dma_buf</span><span>&nbsp;struct. By combining these primitives, we can </span><span class="wuNJCVYdSe-c1">kfree</span><span>&nbsp;an </span><span class="wuNJCVYdSe-c19">arbitrary pointer</span><span class="wuNJCVYdSe-c2">&nbsp;before setting a new name string.</span></p>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c2"></span></p>
 <p class="wuNJCVYdSe-c7"><span> </span><span class="wuNJCVYdSe-c9 wuNJCVYdSe-c5">long</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">mtk_dma_buf_set_name(</span><span class="wuNJCVYdSe-c0">struct</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">dma_buf</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">*dmabuf,</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">const</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c9 wuNJCVYdSe-c5">char</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">*buf)</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">{</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c9 wuNJCVYdSe-c5">char</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">*name</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">=</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">kstrndup(buf,</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">DMA_BUF_NAME_LEN,</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">GFP_KERNEL);</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">...</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">kfree(dmabuf-&gt;name); </span><span class="wuNJCVYdSe-c12 wuNJCVYdSe-c14 wuNJCVYdSe-c27 wuNJCVYdSe-c5">//dmabuf is attacker controlled</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">dmabuf-&gt;name</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">=</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">name; </span><span class="wuNJCVYdSe-c12 wuNJCVYdSe-c14 wuNJCVYdSe-c27 wuNJCVYdSe-c5">//the name pointer is written to attacker controlled memory</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">...</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">}</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c2"> </span></p><h3 class="wuNJCVYdSe-c40" id="h.l1p8heskmxsz"><span class="wuNJCVYdSe-c12 wuNJCVYdSe-c33">Achieving arbitrary read</span></h3>
 <p class="wuNJCVYdSe-c7"><span>Innocuous </span><span class="wuNJCVYdSe-c1">dmabuf</span><span>&nbsp;file operations become potent primitives now that we have precise control of the </span><span class="wuNJCVYdSe-c1">dma_buf</span><span>&nbsp;struct. For example, this is the code backing /</span><span class="wuNJCVYdSe-c1">proc/pid/fdinfo/n</span><span>&nbsp;for </span><span class="wuNJCVYdSe-c1">dmabuf</span><span class="wuNJCVYdSe-c2">&nbsp;files:</span></p>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c2"></span></p>
 <p class="wuNJCVYdSe-c7"><span> </span><span class="wuNJCVYdSe-c0">static</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c0">void</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">dma_buf_show_fdinfo(</span><span class="wuNJCVYdSe-c0">struct</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">seq_file</span><span class="wuNJCVYdSe-c5 wuNJCVYdSe-c14">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">*m,</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c0">struct</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">file</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">*file)</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">{</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c0">struct</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">dma_buf</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">*</span><span class="wuNJCVYdSe-c21 wuNJCVYdSe-c19 wuNJCVYdSe-c5">dmabuf</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">=</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">file-&gt;private_data;</span></p>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c12 wuNJCVYdSe-c13 wuNJCVYdSe-c5"></span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">seq_printf(m,</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c28 wuNJCVYdSe-c5">&quot;size:\t%zu\n&quot;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">,</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c21 wuNJCVYdSe-c19 wuNJCVYdSe-c5">dmabuf</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">-&gt;size);</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">/*</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">Don</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c28 wuNJCVYdSe-c5">&#39;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">t</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">count</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">the</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">temporary</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">reference</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">taken</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">inside</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">procfs</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">seq_show</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">*/</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c5 wuNJCVYdSe-c8">seq_printf(m,</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c28 wuNJCVYdSe-c5">&quot;count:\t%ld\n&quot;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">,</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">file_count(</span><span class="wuNJCVYdSe-c21 wuNJCVYdSe-c19 wuNJCVYdSe-c5">dmabuf</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">-&gt;file)</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">-</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c11 wuNJCVYdSe-c5">1</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">);</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">seq_printf(m,</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c28 wuNJCVYdSe-c5">&quot;exp_name:\t%s\n&quot;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">,</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c21 wuNJCVYdSe-c19 wuNJCVYdSe-c5">dmabuf</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">-&gt;exp_name);</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">spin_lock(&amp;</span><span class="wuNJCVYdSe-c21 wuNJCVYdSe-c19 wuNJCVYdSe-c5">dmabuf</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">-&gt;name_lock);</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c0">if</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">(</span><span class="wuNJCVYdSe-c21 wuNJCVYdSe-c19 wuNJCVYdSe-c5">dmabuf</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">-&gt;name)</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">seq_printf(m,</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c28 wuNJCVYdSe-c5">&quot;name:\t%s\n&quot;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">,</span><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c5">&nbsp;</span><span class="wuNJCVYdSe-c21 wuNJCVYdSe-c19 wuNJCVYdSe-c5">dmabuf</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">-&gt;name);</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c14 wuNJCVYdSe-c5">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">spin_unlock(&amp;</span><span class="wuNJCVYdSe-c19 wuNJCVYdSe-c5 wuNJCVYdSe-c21">dmabuf</span><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">-&gt;name_lock);</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c8 wuNJCVYdSe-c5">}</span></p>
 <p class="wuNJCVYdSe-c7"><span>There are several opportunities in this function for achieving arbitrary read, but the cleanest one is the </span><span class="wuNJCVYdSe-c1">file_count()</span><span>&nbsp;call, which will dereference the passed pointer + a hardcoded offset, and print the read 8 byte value as a signed long. Normally in the context of this C function, </span><span class="wuNJCVYdSe-c1">file == ((struct dma_buf*) file-&gt;private_data)-&gt;file</span><span>&nbsp;, but since we control the </span><span class="wuNJCVYdSe-c1">dma_buf</span><span class="wuNJCVYdSe-c2">&nbsp;struct that isn&rsquo;t necessarily the case.</span></p>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c2"></span></p><h3 class="wuNJCVYdSe-c40" id="h.m3a0br51kkz"><span class="wuNJCVYdSe-c33 wuNJCVYdSe-c12">Achieving arbitrary write</span></h3>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c2">At this point we have three powerful primitives:</span></p><ul style="padding: 0;" class="c24 lst-kix_vfea8tfkncrm-0 start"><li style="margin-left: 46pt;" class="c7 c17 li-bullet-0"><span>Read/write UAF&rsquo;d </span><span class="wuNJCVYdSe-c1">dma_buf</span><span class="wuNJCVYdSe-c2">&nbsp;struct memory (via GED GE buffers)</span></li><li style="margin-left: 46pt;" class="c7 c17 li-bullet-0"><span>Arbitrary read (via </span><span class="wuNJCVYdSe-c1">dma_buf_show_fdinfo</span><span class="wuNJCVYdSe-c2">)</span></li><li style="margin-left: 46pt;" class="c7 c17 li-bullet-0"><span>Arbitrary free (via </span><span class="wuNJCVYdSe-c1">ged_dmabuf_set_name</span><span class="wuNJCVYdSe-c2">)</span></li></ul>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c2"></span></p>

<p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c2"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEilzJmXjC5MwoGnxuUe6-rqIyG5EXRaE_B0V8VCgMLkIqXExr7_70KBjmSunxcHwktChFADLZAzByhKhUZVFaps-ZvoyWrMCUCK2eEmbQdVLhQrtiJbSB4kW_WkPxjv_9xNWfj5VgBFOPxfIixfDAzf4OXZS58tY7GgSSWGZ8pf11uf1Z0KThjgxutlz_o/s721/image8.png" style="display: block; padding: 1em 0;text-align: center;"><img alt="Graph showing our arbitrary read and arbitrary free primitives via the UAF&#39;d dma buffer" border="0" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEilzJmXjC5MwoGnxuUe6-rqIyG5EXRaE_B0V8VCgMLkIqXExr7_70KBjmSunxcHwktChFADLZAzByhKhUZVFaps-ZvoyWrMCUCK2eEmbQdVLhQrtiJbSB4kW_WkPxjv_9xNWfj5VgBFOPxfIixfDAzf4OXZS58tY7GgSSWGZ8pf11uf1Z0KThjgxutlz_o/s721/image8.png" style="max-height: 750px; max-width: 600px;" title="Graph showing our arbitrary read and arbitrary free primitives via the UAF&#39;d dma buffer" /></a></span></p>
 
<p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c2"></span></p>
 <p class="wuNJCVYdSe-c7"><span>There are many potential strategies that use these primitives to achieve an arbitrary write primitive. The technique I chose was to type-confuse a GE buffer with a GE buffer </span><span class="wuNJCVYdSe-c19">array</span><span>. GED GE Buffers are tracked through a hierarchy of structs and arrays. A GE file&rsquo;s </span><span class="wuNJCVYdSe-c1">private_data</span><span class="wuNJCVYdSe-c2">&nbsp;member points to an array of GE buffer pointers like so:</span></p>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c2"></span></p>

<p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c2"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgSqvGA83iM6fq-D7sAnG4OCM6T_OdDGD5LpYKJBvE6xFxCciy51nIE4MBa3jERVONt_0tArpFf2YMFuxHE-LmT49UdX6fMgGlZ2kEPCc0sTKKeFE0F5BEphWMyZ9jWUF07vlEomRoxBgP9at8zPODEIPqTfPFlYzBTgShwo7TrlrNlEkieeDjxlWlRvWk/s611/image4.png" style="display: block; padding: 1em 0;text-align: center;"><img alt="Graph showing the object hierarchy of GE files within an fdtable down to GE buffers" border="0" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgSqvGA83iM6fq-D7sAnG4OCM6T_OdDGD5LpYKJBvE6xFxCciy51nIE4MBa3jERVONt_0tArpFf2YMFuxHE-LmT49UdX6fMgGlZ2kEPCc0sTKKeFE0F5BEphWMyZ9jWUF07vlEomRoxBgP9at8zPODEIPqTfPFlYzBTgShwo7TrlrNlEkieeDjxlWlRvWk/s611/image4.png" style="max-height: 750px; max-width: 600px;" title="Graph showing the object hierarchy of GE files within an fdtable down to GE buffers" /></a></span></p>

 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c2"></span></p>
 <p class="wuNJCVYdSe-c7"><span>I achieve this type-confusion by using the arbitrary-free primitive developed previously to free a GE buffer array, then reclaiming that array with a GE buffer from a second GE file. Since the GE buffer array (and GE buffers as well) come from generic kmalloc caches, the only requirement for this reclamation is allocating GE buffers that are the same size as a GE buffer array. If two GE files are referencing the same memory, one (GE file A) as a GE buffer, and one (GE file B) as a GE buffer </span><span class="wuNJCVYdSe-c19">array, </span><span class="wuNJCVYdSe-c2">I can modify the contents of a GE buffer array at will.</span></p>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c2"></span></p>

 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c2"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEioaW3vdBverVpVB95IW7_vsrH8JdiB52ly8zRn5A0QYG9LF5XCNdmhK07LRTlACDxxvOII82zFoHHGnA15VjkDJiKVZXqyykk2KI3pzr1-LXJaYTF2igmf4l7zfs__LrnJ0BcTpRjMXOjS6cJNAR3bJAZ6O4nRG1kfHCQs1QySE689IW-iha9dxoOz28o/s731/image1.png" style="display: block; padding: 1em 0;text-align: center;"><img alt="Graph showing the overlapping object hierarchy of two GE files where one file&#39;s GE buffer is another file&#39;s GE buffer array" border="0" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEioaW3vdBverVpVB95IW7_vsrH8JdiB52ly8zRn5A0QYG9LF5XCNdmhK07LRTlACDxxvOII82zFoHHGnA15VjkDJiKVZXqyykk2KI3pzr1-LXJaYTF2igmf4l7zfs__LrnJ0BcTpRjMXOjS6cJNAR3bJAZ6O4nRG1kfHCQs1QySE689IW-iha9dxoOz28o/s731/image1.png" style="max-height: 750px; max-width: 600px;" title="Graph showing the overlapping object hierarchy of two GE files where one file&#39;s GE buffer is another file&#39;s GE buffer array" /></a></span></p>

 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c2"></span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c2">Then performing an arbitrary write to a virtual address X will be as simple as using GE file A&rsquo;s GE buffer to change the contents of the array to point to the virtual address X, then writing to that address using GE file B which now thinks virtual address X is a GE buffer!</span></p>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c2"></span></p>
 <p class="wuNJCVYdSe-c7"><span>This technique hinges on being able to use the arbitrary free primitive to free a GE buffer array. To do that, it&rsquo;s necessary to find the </span><span class="wuNJCVYdSe-c19">virtual address</span><span>&nbsp;of a GE buffer array first. Since we have an arbitrary read primitive already, </span><span class="wuNJCVYdSe-c19">any</span><span class="wuNJCVYdSe-c2">&nbsp;parent struct/object/array of a GE buffer array will be enough to find the virtual address of a GE buffer array itself. The hierarchy is as follows:</span></p><ol class="c24 lst-kix_kbd3zqh16g9u-0 start" start="1"><li style="margin-left: 46pt;" class="c7 c17 li-bullet-0"><span class="wuNJCVYdSe-c2">GE arrays are referenced by a GE file</span></li><li style="margin-left: 46pt;" class="c7 c17 li-bullet-0"><span>GE files are referenced by an </span><span class="wuNJCVYdSe-c1">fdtable</span><span class="wuNJCVYdSe-c2">&nbsp;as a file descriptor</span></li><li style="margin-left: 46pt;" class="c7 c17 li-bullet-0"><span>An </span><span class="wuNJCVYdSe-c1">fdtable</span><span>&nbsp;is referenced by a </span><span class="wuNJCVYdSe-c12 wuNJCVYdSe-c1 wuNJCVYdSe-c26">task struct</span></li><li style="margin-left: 46pt;" class="c7 c17 li-bullet-0"><span class="wuNJCVYdSe-c1">Task structs</span><span>&nbsp;are referenced as part of the task list with the root node being the </span><span class="wuNJCVYdSe-c1">init</span><span class="wuNJCVYdSe-c2">&nbsp;task in the kernel image</span></li></ol>
 <p class="wuNJCVYdSe-c7"><span>The </span><span class="wuNJCVYdSe-c1">fdtable</span><span>&nbsp;represents an attractive object to find, as it comes out of the same generic kmalloc cache as </span><span class="wuNJCVYdSe-c1">dma_buf</span><span>&nbsp;name strings. We can find a </span><span class="wuNJCVYdSe-c1">dma_buf</span><span>&nbsp;name string&rsquo;s virtual address by using </span><span class="wuNJCVYdSe-c1">dma_buf_set_name</span><span>&nbsp;(which we also use as our arbitrary free primitive) to insert a pointer to a </span><span class="wuNJCVYdSe-c1">dma_buf</span><span>&nbsp;name string into the reclaimed UAF&rsquo;d </span><span class="wuNJCVYdSe-c1">dma_buf</span><span>&nbsp;object that is now a GE buffer. We then simply read it out of our GE buffer, free that </span><span class="wuNJCVYdSe-c1">dma_buf</span><span>&nbsp;name string (again using </span><span class="wuNJCVYdSe-c1">dma_buf_set_name</span><span>), and reclaim it with an </span><span class="wuNJCVYdSe-c1">fdtable</span><span>. Creating </span><span class="wuNJCVYdSe-c1">fdtable</span><span>s is fairly easy - we simply </span><span class="wuNJCVYdSe-c1">fork</span><span>&nbsp;many processes ahead of time that share an </span><span class="wuNJCVYdSe-c1">fdtable</span><span>, then </span><span class="wuNJCVYdSe-c1">unshare(2)</span><span>&nbsp;the </span><span class="wuNJCVYdSe-c1">fdtable</span><span>&nbsp;at the appropriate time to allocate new </span><span class="wuNJCVYdSe-c1">fdtable</span><span class="wuNJCVYdSe-c2">s. The full exploit strategy is as follows:</span></p><ol class="c24 lst-kix_m966q2gfyys4-0 start" start="1"><li style="margin-left: 46pt;" class="c7 c17 li-bullet-0"><span>Trigger a </span><span class="wuNJCVYdSe-c19">dangling fd</span><span>&nbsp;of a </span><span class="wuNJCVYdSe-c1">dmabuf</span><span>&nbsp;file</span><span class="wuNJCVYdSe-c2">&nbsp;using our mtk-jpeg race condition bug</span></li><li style="margin-left: 46pt;" class="c7 c17 li-bullet-0"><span class="wuNJCVYdSe-c19">Reclaim</span><span>&nbsp;the underlying </span><span class="wuNJCVYdSe-c1">dma_buf</span><span>&nbsp;leaving the parent </span><span class="wuNJCVYdSe-c1">dmabuf</span><span>&nbsp;file </span><span class="wuNJCVYdSe-c19">free</span><span class="wuNJCVYdSe-c2">&nbsp;(but still referenced by a dangling file descriptor)</span></li><li style="margin-left: 46pt;" class="c7 c17 li-bullet-0"><span>Use </span><span class="wuNJCVYdSe-c1">ged_dmabuf_set_name</span><span>&nbsp;on our dangling file to place a new name pointer in the fake </span><span class="wuNJCVYdSe-c1">dma_buf</span><span class="wuNJCVYdSe-c2">&nbsp;struct</span></li><li style="margin-left: 46pt;" class="c7 c17 li-bullet-0"><span class="wuNJCVYdSe-c19">Read</span><span>&nbsp;the fake </span><span class="wuNJCVYdSe-c1">dma_buf</span><span>&nbsp;struct (which is really a GE buffer) to get the </span><span class="wuNJCVYdSe-c12 wuNJCVYdSe-c26 wuNJCVYdSe-c19 wuNJCVYdSe-c41">name pointer</span></li><li style="margin-left: 46pt;" class="c7 c17 li-bullet-0"><span class="wuNJCVYdSe-c19">Free</span><span>&nbsp;the </span><span class="wuNJCVYdSe-c19">name pointer</span><span>&nbsp;by calling </span><span class="wuNJCVYdSe-c1">ged_dmabuf_set_name</span><span class="wuNJCVYdSe-c2">&nbsp;again</span></li><li style="margin-left: 46pt;" class="c7 c17 li-bullet-0"><span class="wuNJCVYdSe-c19">Reclaim</span><span>&nbsp;the name pointer as an </span><span class="wuNJCVYdSe-c1">fdtable</span><span class="wuNJCVYdSe-c2">&nbsp;with references to a GE fd with an array of GE buffers</span></li><li style="margin-left: 46pt;" class="c7 c17 li-bullet-0"><span>Use the </span><span class="wuNJCVYdSe-c19">arbitrary read</span><span>&nbsp;to find the GE buffer </span><span class="wuNJCVYdSe-c19">array</span></li><li style="margin-left: 46pt;" class="c7 c17 li-bullet-0"><span>Use the </span><span class="wuNJCVYdSe-c19">arbitrary free</span><span>&nbsp;to free the GE buffer </span><span class="wuNJCVYdSe-c19">array</span></li><li style="margin-left: 46pt;" class="c7 c17 li-bullet-0"><span class="wuNJCVYdSe-c19">Reclaim</span><span>&nbsp;the GE buffer </span><span class="wuNJCVYdSe-c19">array</span><span class="wuNJCVYdSe-c2">&nbsp;with another GE buffer</span></li></ol>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c2"></span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c2">At the end of this process we&rsquo;ll have a reliable arbitrary read/write!</span></p>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c2"></span></p><h3 class="wuNJCVYdSe-c40" id="h.2dekzwa3x6g5"><span class="wuNJCVYdSe-c33 wuNJCVYdSe-c12">Getting a root shell</span></h3>
 <p class="wuNJCVYdSe-c7"><span>As a fun exercise, I decided to see how easy it was to disable SELinux and get root after achieving arbitrary read/write. Various manufacturers may implement certain tripping hazards to slow down exploit development efforts, but in my case (Asus ROG 6D), there were no hoops I needed to jump through at all. It was enough to simply write 0 to the </span><span class="wuNJCVYdSe-c1">uid</span><span>/</span><span class="wuNJCVYdSe-c1">gid</span><span>&nbsp;of my process&rsquo;s </span><span class="wuNJCVYdSe-c1">cred</span><span>&nbsp;struct to achieve root, and write 0 to the </span><span class="wuNJCVYdSe-c1">selinux_enforcing</span><span>&nbsp;bit to turn off SELinux. After this I just </span><span class="wuNJCVYdSe-c1">execlp(&ldquo;/system/bin/sh&rdquo;,...) </span><span class="wuNJCVYdSe-c2">and out pops a root shell!</span></p>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c2"></span></p>
 <p class="wuNJCVYdSe-c7"><span><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgAy_jgDPyEiAmxQxmtSQXC1Q4eQ2alAYsJFiGXLUAFRi-OrljxWON-M1NBxe8LfwO9PWGBRdq-feWA8J3mKl5TTfhlHpAPVuFaH5WSSjCXVUKoj5840vfXf-iGNe1Q9QlFmOENGbYHZHwGqIPbLvAhbpATKcJ6VxhrXaAH3zsh7k_t3pH2so7Zs-QU8ro/s1422/image3.gif" style="display: block; padding: 1em 0;text-align: center;"><img alt="Getting root on an Android device with the exploit" border="0" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgAy_jgDPyEiAmxQxmtSQXC1Q4eQ2alAYsJFiGXLUAFRi-OrljxWON-M1NBxe8LfwO9PWGBRdq-feWA8J3mKl5TTfhlHpAPVuFaH5WSSjCXVUKoj5840vfXf-iGNe1Q9QlFmOENGbYHZHwGqIPbLvAhbpATKcJ6VxhrXaAH3zsh7k_t3pH2so7Zs-QU8ro/s1200/image3.gif" style="max-height: 750px; max-width: 600px;" title="Getting root on an Android device with the exploit" /></a></span></p><h2 class="wuNJCVYdSe-c36" id="h.tb4jn1vwpqsi"><span class="wuNJCVYdSe-c35 wuNJCVYdSe-c12">Conclusion</span></h2>
 <p class="wuNJCVYdSe-c7"><span>I discovered significant security vulnerabilities across all 3 of the evaluated devices. It is highly likely that reviewing more devices comprising a greater spread of chipset manufacturers would lead to the discovery of additional vulnerabilities. </span><span>Android regularly uses higher-privileged processes to liaise between applications and kernel drivers, meaning that most kernel drivers cannot be seen from an unprivileged app context (the GPU being the most obvious exception to this rule). Nevertheless, a determined attacker could use vulnerabilities in other more privileged processes to pivot into contexts from which the attack surface of these kernel drivers become reachable.</span><span class="wuNJCVYdSe-c2">&nbsp;This pivot strategy could widen the attack surface beyond the scope of this research.</span></p>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c2"></span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c2">As it becomes more difficult to find 0-days in core Android, third-party Linux kernel drivers continue to become a more and more attractive target for attackers. While the bulk of present-day detected ITW Android exploitation targets GPU drivers, it&rsquo;s equally important that other third-party drivers are encouraged towards the same security standards.</span></p>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c2"></span></p>
 <p class="wuNJCVYdSe-c7"><span>There is room for improvement in the patching process across all 3 of the bugs discovered. None of the patches for these bugs met Project Zero&#39;s 90-day deadline for patches reaching end-users. This appears to largely be a result of the propagation delay from when third-party driver developers issue patches to when downstream manufacturers can incorporate those patches into Android security updates. Shortening this propagation delay </span><span>(e.g. using </span><span class="wuNJCVYdSe-c34"><a class="wuNJCVYdSe-c181" href="https://source.android.com/docs/core/ota/apex">Android APEX</a></span><span>&nbsp;to ship updated kernel drivers)</span><span>&nbsp;would go a long way to minimizing the Android driver patch gap. In addition, one of these bugs was only partially patched and remained exploitable on some devices for an additional 2 years before the security impact of the bug was assessed and publicly reported.</span><span>&nbsp;</span><span>Developers should regularly consider the security impacts of bugs, especially those reported by static analysis tools designed to detect security-relevant issues.</span></p>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c2"></span></p>
 <p class="wuNJCVYdSe-c7"><span>Finally, while cross-cache heap shaping mitigations significantly impede exploit development strategies, they don&rsquo;t entirely prevent a determined attacker from exploiting kernel UAF vulnerabilities, even if the UAF&rsquo;d object comes out of a dedicated slab cache. In this particular case, second-order allocations in a UAF&rsquo;d object lead to powerful and exploitable primitives. </span><span>Developers may be able to mitigate this technique by setting pointers to NULL, even if the parent object is about to get freed anyway.</span><span class="wuNJCVYdSe-c2">&nbsp;However, this exploit technique demonstrates that even well-designed mitigations (such as SLAB_VIRTUAL) come with limitations in an era where an attacker can achieve undetected memory corruption. It will take more fundamental mitigations that address the root issue of memory corruption, like MTE, in order to dramatically raise the bar for attackers.</span></p>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c2"></span></p><h2 class="wuNJCVYdSe-c36" id="h.ds4ya8k4hu83"><span class="wuNJCVYdSe-c12 wuNJCVYdSe-c35">Resources</span></h2>
 <p class="wuNJCVYdSe-c7"><span>This research was presented at ShmooCon, a video is available here </span><span class="wuNJCVYdSe-c34"><a class="wuNJCVYdSe-c181" href="https://archive.org/details/shmoocon2024/Shmoocon2024-SethJenkins-Driving_Forward_in_Android_Drivers.mp4">https://archive.org/details/shmoocon2024/Shmoocon2024-SethJenkins-Driving_Forward_in_Android_Drivers.mp4</a></span></p>
 <p class="wuNJCVYdSe-c7 wuNJCVYdSe-c10"><span class="wuNJCVYdSe-c2"></span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c2">The proof of concept exploit code developed and presented in this research is available at:</span></p>
 <p class="wuNJCVYdSe-c7"><span class="wuNJCVYdSe-c34"><a class="wuNJCVYdSe-c181" href="https://bugs.chromium.org/p/project-zero/issues/detail?id=2470#c4">https://bugs.chromium.org/p/project-zero/issues/detail?id=2470#c4</a></span></p>
<div style='clear: both;'></div>
</div>
<div class='post-footer'>
<div class='post-footer-line post-footer-line-1'>
<span class='post-author vcard'>
Posted by
<span class='fn' itemprop='author' itemscope='itemscope' itemtype='http://schema.org/Person'>
<meta content='https://www.blogger.com/profile/08975904405228580347' itemprop='url'/>
<a class='g-profile' href='https://www.blogger.com/profile/08975904405228580347' rel='author' title='author profile'>
<span itemprop='name'>Google Project Zero</span>
</a>
</span>
</span>
<span class='post-timestamp'>
at
<meta content='https://googleprojectzero.blogspot.com/2024/06/driving-forward-in-android-drivers.html' itemprop='url'/>
<a class='timestamp-link' href='https://googleprojectzero.blogspot.com/2024/06/driving-forward-in-android-drivers.html' rel='bookmark' title='permanent link'><abbr class='published' itemprop='datePublished' title='2024-06-13T11:03:00-07:00'>11:03&#8239;AM</abbr></a>
</span>
<span class='post-comment-link'>
</span>
<span class='post-icons'>
<span class='item-control blog-admin pid-1053444070'>
<a href='https://www.blogger.com/post-edit.g?blogID=4838136820032157985&postID=3663024175311920488&from=pencil' title='Edit Post'>
<img alt='' class='icon-action' height='18' src='https://resources.blogblog.com/img/icon18_edit_allbkg.gif' width='18'/>
</a>
</span>
</span>
<div class='post-share-buttons goog-inline-block'>
<a class='goog-inline-block share-button sb-email' href='https://www.blogger.com/share-post.g?blogID=4838136820032157985&postID=3663024175311920488&target=email' target='_blank' title='Email This'><span class='share-button-link-text'>Email This</span></a><a class='goog-inline-block share-button sb-blog' href='https://www.blogger.com/share-post.g?blogID=4838136820032157985&postID=3663024175311920488&target=blog' onclick='window.open(this.href, "_blank", "height=270,width=475"); return false;' target='_blank' title='BlogThis!'><span class='share-button-link-text'>BlogThis!</span></a><a class='goog-inline-block share-button sb-twitter' href='https://www.blogger.com/share-post.g?blogID=4838136820032157985&postID=3663024175311920488&target=twitter' target='_blank' title='Share to Twitter'><span class='share-button-link-text'>Share to Twitter</span></a><a class='goog-inline-block share-button sb-facebook' href='https://www.blogger.com/share-post.g?blogID=4838136820032157985&postID=3663024175311920488&target=facebook' onclick='window.open(this.href, "_blank", "height=430,width=640"); return false;' target='_blank' title='Share to Facebook'><span class='share-button-link-text'>Share to Facebook</span></a><a class='goog-inline-block share-button sb-pinterest' href='https://www.blogger.com/share-post.g?blogID=4838136820032157985&postID=3663024175311920488&target=pinterest' target='_blank' title='Share to Pinterest'><span class='share-button-link-text'>Share to Pinterest</span></a>
</div>
</div>
<div class='post-footer-line post-footer-line-2'>
<span class='post-labels'>
</span>
</div>
<div class='post-footer-line post-footer-line-3'>
<span class='post-location'>
</span>
</div>
</div>
</div>
<div class='comments' id='comments'>
<a name='comments'></a>
<h4>No comments:</h4>
<div id='Blog1_comments-block-wrapper'>
<dl class='avatar-comment-indent' id='comments-block'>
</dl>
</div>
<p class='comment-footer'>
<div class='comment-form'>
<a name='comment-form'></a>
<h4 id='comment-post-message'>Post a Comment</h4>
<p>
</p>
<a href='https://www.blogger.com/comment/frame/4838136820032157985?po=3663024175311920488&hl=en' id='comment-editor-src'></a>
<iframe allowtransparency='true' class='blogger-iframe-colorize blogger-comment-from-post' frameborder='0' height='410px' id='comment-editor' name='comment-editor' src='' width='100%'></iframe>
<script src='https://www.blogger.com/static/v1/jsbin/2315299244-comment_from_post_iframe.js' type='text/javascript'></script>
<script type='text/java                   '>
      BLOG_CMT_createIframe('https://www.blogger.com/rpc_relay.html');
    </script>
</div>
</p>
</div>
</div>

        </div></div>
      
</div>
<div class='blog-pager' id='blog-pager'>
<span id='blog-pager-newer-link'>
<a class='blog-pager-newer-link' href='https://googleprojectzero.blogspot.com/2024/06/project-naptime.html' id='Blog1_blog-pager-newer-link' title='Newer Post'>Newer Post</a>
</span>
<span id='blog-pager-older-link'>
<a class='blog-pager-older-link' href='https://googleprojectzero.blogspot.com/2024/04/the-windows-registry-adventure-2.html' id='Blog1_blog-pager-older-link' title='Older Post'>Older Post</a>
</span>
<a class='home-link' href='https://googleprojectzero.blogspot.com/'>Home</a>
</div>
<div class='clear'></div>
<div class='post-feeds'>
<div class='feed-links'>
Subscribe to:
<a class='feed-link' href='https://googleprojectzero.blogspot.com/feeds/3663024175311920488/comments/default' target='_blank' type='application/atom+xml'>Post Comments (Atom)</a>
</div>
</div>
</div></div>
</div>
</div>
<div class='column-left-outer'>
<div class='column-left-inner'>
<aside>
</aside>
</div>
</div>
<div class='column-right-outer'>
<div class='column-right-inner'>
<aside>
<div class='sidebar section' id='sidebar-right-1'><div class='widget BlogSearch' data-version='1' id='BlogSearch1'>
<h2 class='title'>Search This Blog</h2>
<div class='widget-content'>
<div id='BlogSearch1_form'>
<form action='https://googleprojectzero.blogspot.com/search' class='gsc-search-box' target='_top'>
<table cellpadding='0' cellspacing='0' class='gsc-search-box'>
<tbody>
<tr>
<td class='gsc-input'>
<input autocomplete='off' class='gsc-input' name='q' size='10' title='search' type='text' value=''/>
</td>
<td class='gsc-search-button'>
<input class='gsc-search-button' title='search' type='submit' value='Search'/>
</td>
</tr>
</tbody>
</table>
</form>
</div>
</div>
<div class='clear'></div>
</div><div class='widget PageList' data-version='1' id='PageList1'>
<h2>Pages</h2>
<div class='widget-content'>
<ul>
<li>
<a href='https://googleprojectzero.blogspot.com/p/about-project-zero.html'>About Project Zero</a>
</li>
<li>
<a href='https://googleprojectzero.blogspot.com/p/working-at-project-zero.html'>Working at Project Zero</a>
</li>
<li>
<a href='https://googleprojectzero.blogspot.com/p/0day.html'>0day "In the Wild"</a>
</li>
<li>
<a href='https://googleprojectzero.github.io/0days-in-the-wild/rca.html'>0day Exploit Root Cause Analyses</a>
</li>
<li>
<a href='https://googleprojectzero.blogspot.com/p/vulnerability-disclosure-faq.html'>Vulnerability Disclosure FAQ</a>
</li>
</ul>
<div class='clear'></div>
</div>
</div><div class='widget BlogArchive' data-version='1' id='BlogArchive1'>
<h2>Archives</h2>
<div class='widget-content'>
<div id='ArchiveList'>
<div id='BlogArchive1_ArchiveList'>
<ul class='hierarchy'>
<li class='archivedate expanded'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy toggle-open'>

        &#9660;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2024/'>
2024
</a>
<span class='post-count' dir='ltr'>(8)</span>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2024/11/'>
November
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2024/10/'>
October
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate expanded'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy toggle-open'>

        &#9660;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2024/06/'>
June
</a>
<span class='post-count' dir='ltr'>(3)</span>
<ul class='posts'>
<li><a href='https://googleprojectzero.blogspot.com/2024/06/the-windows-registry-adventure-3.html'>The Windows Registry Adventure #3: Learning resources</a></li>
<li><a href='https://googleprojectzero.blogspot.com/2024/06/project-naptime.html'>Project Naptime: Evaluating Offensive Security Cap...</a></li>
<li><a href='https://googleprojectzero.blogspot.com/2024/06/driving-forward-in-android-drivers.html'>Driving forward in Android drivers</a></li>
</ul>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2024/04/'>
April
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2023/'>
2023
</a>
<span class='post-count' dir='ltr'>(11)</span>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2023/11/'>
November
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2023/10/'>
October
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2023/09/'>
September
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2023/08/'>
August
</a>
<span class='post-count' dir='ltr'>(4)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2023/04/'>
April
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2023/03/'>
March
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2023/01/'>
January
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2022/'>
2022
</a>
<span class='post-count' dir='ltr'>(17)</span>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2022/12/'>
December
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2022/11/'>
November
</a>
<span class='post-count' dir='ltr'>(3)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2022/10/'>
October
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2022/08/'>
August
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2022/06/'>
June
</a>
<span class='post-count' dir='ltr'>(3)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2022/05/'>
May
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2022/04/'>
April
</a>
<span class='post-count' dir='ltr'>(3)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2022/03/'>
March
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2022/02/'>
February
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2022/01/'>
January
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2021/'>
2021
</a>
<span class='post-count' dir='ltr'>(24)</span>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2021/12/'>
December
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2021/10/'>
October
</a>
<span class='post-count' dir='ltr'>(3)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2021/09/'>
September
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2021/08/'>
August
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2021/06/'>
June
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2021/05/'>
May
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2021/04/'>
April
</a>
<span class='post-count' dir='ltr'>(3)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2021/03/'>
March
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2021/02/'>
February
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2021/01/'>
January
</a>
<span class='post-count' dir='ltr'>(10)</span>
</li>
</ul>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2020/'>
2020
</a>
<span class='post-count' dir='ltr'>(36)</span>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2020/12/'>
December
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2020/11/'>
November
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2020/10/'>
October
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2020/09/'>
September
</a>
<span class='post-count' dir='ltr'>(4)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2020/08/'>
August
</a>
<span class='post-count' dir='ltr'>(5)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2020/07/'>
July
</a>
<span class='post-count' dir='ltr'>(8)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2020/06/'>
June
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2020/04/'>
April
</a>
<span class='post-count' dir='ltr'>(3)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2020/02/'>
February
</a>
<span class='post-count' dir='ltr'>(4)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2020/01/'>
January
</a>
<span class='post-count' dir='ltr'>(5)</span>
</li>
</ul>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2019/'>
2019
</a>
<span class='post-count' dir='ltr'>(27)</span>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2019/12/'>
December
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2019/11/'>
November
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2019/10/'>
October
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2019/09/'>
September
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2019/08/'>
August
</a>
<span class='post-count' dir='ltr'>(11)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2019/05/'>
May
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2019/04/'>
April
</a>
<span class='post-count' dir='ltr'>(3)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2019/03/'>
March
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2019/02/'>
February
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2019/01/'>
January
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2018/'>
2018
</a>
<span class='post-count' dir='ltr'>(22)</span>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2018/12/'>
December
</a>
<span class='post-count' dir='ltr'>(7)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2018/11/'>
November
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2018/10/'>
October
</a>
<span class='post-count' dir='ltr'>(4)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2018/09/'>
September
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2018/08/'>
August
</a>
<span class='post-count' dir='ltr'>(3)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2018/07/'>
July
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2018/06/'>
June
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2018/05/'>
May
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2018/04/'>
April
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2018/01/'>
January
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2017/'>
2017
</a>
<span class='post-count' dir='ltr'>(19)</span>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2017/12/'>
December
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2017/10/'>
October
</a>
<span class='post-count' dir='ltr'>(3)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2017/09/'>
September
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2017/08/'>
August
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2017/07/'>
July
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2017/05/'>
May
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2017/04/'>
April
</a>
<span class='post-count' dir='ltr'>(6)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2017/03/'>
March
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2017/02/'>
February
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2016/'>
2016
</a>
<span class='post-count' dir='ltr'>(17)</span>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2016/12/'>
December
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2016/11/'>
November
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2016/10/'>
October
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2016/09/'>
September
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2016/08/'>
August
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2016/07/'>
July
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2016/06/'>
June
</a>
<span class='post-count' dir='ltr'>(3)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2016/03/'>
March
</a>
<span class='post-count' dir='ltr'>(3)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2016/02/'>
February
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2016/01/'>
January
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2015/'>
2015
</a>
<span class='post-count' dir='ltr'>(33)</span>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2015/12/'>
December
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2015/11/'>
November
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2015/10/'>
October
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2015/09/'>
September
</a>
<span class='post-count' dir='ltr'>(4)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2015/08/'>
August
</a>
<span class='post-count' dir='ltr'>(6)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2015/07/'>
July
</a>
<span class='post-count' dir='ltr'>(5)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2015/06/'>
June
</a>
<span class='post-count' dir='ltr'>(4)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2015/05/'>
May
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2015/04/'>
April
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2015/03/'>
March
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2015/02/'>
February
</a>
<span class='post-count' dir='ltr'>(3)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2015/01/'>
January
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2014/'>
2014
</a>
<span class='post-count' dir='ltr'>(11)</span>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2014/12/'>
December
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2014/11/'>
November
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2014/10/'>
October
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2014/09/'>
September
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2014/08/'>
August
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2014/07/'>
July
</a>
<span class='post-count' dir='ltr'>(3)</span>
</li>
</ul>
</li>
</ul>
</div>
</div>
<script type='text/javascript'>
//<![CDATA[
(function(){
  let archive_list = document.getElementById('ArchiveList');
  if (archive_list == null) return;
  let cur_year = archive_list.querySelector('.post-count-link').innerText.trim() - 0;
  let last_year = 2014;
  let elements = [];
  const MONTHS = ',Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec'.split(',');

  let parent = document.getElementById('ArchiveList');
  while (parent.childNodes.length) parent.removeChild(parent.childNodes[0]);

  function fetch_next_year() {
    let url = 'https://googleprojectzero.blogspot.com/?action=getTitles&widgetId=BlogArchive1&widgetType=BlogArchive&responseType=js&path=https%3A%2F%2Fgoogleprojectzero.blogspot.com%2F'+cur_year;
    fetch(url).then(resp => {
      if (!resp.ok) {
        console.log('http error');
        return;
      }
      resp.text().then(text => {
        let scope = {
          _WidgetManager: {
            _HandleControllerResult: (name, method, results) => {
              elements.push(document.createElement('hr'));
              let year_header = document.createElement('div');
              year_header.appendChild(document.createTextNode(cur_year));
              year_header.style.fontSize = 'large';
              elements.push(year_header);

              let list = document.createElement('ul');
              elements.push(list);

              for (let obj of results.posts) {
                let link_parts = obj.url.split('/');
                let year = link_parts[3];
                let month = link_parts[4];

                let el = document.createElement(/*'div'*/'li');
                el.style.listStyleType = 'square';
                el.style.listStylePosition = 'inside';
                let link = document.createElement('a');
                el.appendChild(link);
                link.appendChild(document.createTextNode(obj.title));
                link.href = obj.url;
                let date_trailer = document.createElement('span');
                el.appendChild(date_trailer);
                //date_trailer.appendChild(document.createTextNode(' ('+year+'-'+month+')'));
                date_trailer.appendChild(document.createTextNode(' ('+MONTHS[parseInt(month, 10)]+')'));
                //date_trailer.style.textAlign = 'right';
                //elements.push(el);
                list.appendChild(el);
              }
            }
          }
        };
        with (scope) { eval(text); }
        if (cur_year == last_year) {
          finish();
        } else {
          cur_year--;
          fetch_next_year();
        }
      });
    });
  }
  fetch_next_year();
  function finish() {
    for (let obj of elements) {
      parent.appendChild(obj);
    }
    console.log(elements);
  }
})();
//]]>
</script>
<div class='clear'></div>
</div>
</div></div>
<table border='0' cellpadding='0' cellspacing='0' class='section-columns columns-2'>
<tbody>
<tr>
<td class='first columns-cell'>
<div class='sidebar no-items section' id='sidebar-right-2-1'></div>
</td>
<td class='columns-cell'>
<div class='sidebar no-items section' id='sidebar-right-2-2'></div>
</td>
</tr>
</tbody>
</table>
<div class='sidebar no-items section' id='sidebar-right-3'></div>
</aside>
</div>
</div>
</div>
<div style='clear: both'></div>
<!-- columns -->
</div>
<!-- main -->
</div>
</div>
<div class='main-cap-bottom cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
<footer>
<div class='footer-outer'>
<div class='footer-cap-top cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left footer-fauxborder-left'>
<div class='fauxborder-right footer-fauxborder-right'></div>
<div class='region-inner footer-inner'>
<div class='foot no-items section' id='footer-1'></div>
<table border='0' cellpadding='0' cellspacing='0' class='section-columns columns-2'>
<tbody>
<tr>
<td class='first columns-cell'>
<div class='foot no-items section' id='footer-2-1'></div>
</td>
<td class='columns-cell'>
<div class='foot no-items section' id='footer-2-2'></div>
</td>
</tr>
</tbody>
</table>
<!-- outside of the include in order to lock Attribution widget -->
<div class='foot section' id='footer-3' name='Footer'><div class='widget Attribution' data-version='1' id='Attribution1'>
<div class='widget-content' style='text-align: center;'>
Powered by <a href='https://www.blogger.com' target='_blank'>Blogger</a>.
</div>
<div class='clear'></div>
</div></div>
</div>
</div>
<div class='footer-cap-bottom cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
</footer>
<!-- content -->
</div>
</div>
<div class='content-cap-bottom cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
</div>
<script type='text/javascript'>
    window.setTimeout(function() {
        document.body.className = document.body.className.replace('loading', '');
      }, 10);
  </script>

<script type="text/javascript" src="https://www.blogger.com/static/v1/widgets/2591855913-widgets.js"></script>
<script type='text/javascript'>
window['__wavt'] = 'AOuZoY7Yjzo1yreiFB5Pi-YVtDjDU2wxGw:1730592967936';_WidgetManager._Init('//www.blogger.com/rearrange?blogID\x3d4838136820032157985','//googleprojectzero.blogspot.com/2024/06/driving-forward-in-android-drivers.html','4838136820032157985');
_WidgetManager._SetDataContext([{'name': 'blog', 'data': {'blogId': '4838136820032157985', 'title': 'Project Zero', 'url': 'https://googleprojectzero.blogspot.com/2024/06/driving-forward-in-android-drivers.html', 'canonicalUrl': 'https://googleprojectzero.blogspot.com/2024/06/driving-forward-in-android-drivers.html', 'homepageUrl': 'https://googleprojectzero.blogspot.com/', 'searchUrl': 'https://googleprojectzero.blogspot.com/search', 'canonicalHomepageUrl': 'https://googleprojectzero.blogspot.com/', 'blogspotFaviconUrl': 'https://googleprojectzero.blogspot.com/favicon.ico', 'bloggerUrl': 'https://www.blogger.com', 'hasCustomDomain': false, 'httpsEnabled': true, 'enabledCommentProfileImages': true, 'gPlusViewType': 'FILTERED_POSTMOD', 'adultContent': false, 'analyticsAccountNumber': 'UA-240546891-1', 'encoding': 'UTF-8', 'locale': 'en', 'localeUnderscoreDelimited': 'en', 'languageDirection': 'ltr', 'isPrivate': false, 'isMobile': false, 'isMobileRequest': false, 'mobileClass': '', 'isPrivateBlog': false, 'isDynamicViewsAvailable': true, 'feedLinks': '\x3clink rel\x3d\x22alternate\x22 type\x3d\x22application/atom+xml\x22 title\x3d\x22Project Zero - Atom\x22 href\x3d\x22https://googleprojectzero.blogspot.com/feeds/posts/default\x22 /\x3e\n\x3clink rel\x3d\x22alternate\x22 type\x3d\x22application/rss+xml\x22 title\x3d\x22Project Zero - RSS\x22 href\x3d\x22https://googleprojectzero.blogspot.com/feeds/posts/default?alt\x3drss\x22 /\x3e\n\x3clink rel\x3d\x22service.post\x22 type\x3d\x22application/atom+xml\x22 title\x3d\x22Project Zero - Atom\x22 href\x3d\x22https://www.blogger.com/feeds/4838136820032157985/posts/default\x22 /\x3e\n\n\x3clink rel\x3d\x22alternate\x22 type\x3d\x22application/atom+xml\x22 title\x3d\x22Project Zero - Atom\x22 href\x3d\x22https://googleprojectzero.blogspot.com/feeds/3663024175311920488/comments/default\x22 /\x3e\n', 'meTag': '', 'adsenseHostId': 'ca-host-pub-1556223355139109', 'adsenseHasAds': false, 'adsenseAutoAds': false, 'boqCommentIframeForm': true, 'loginRedirectParam': '', 'view': '', 'dynamicViewsCommentsSrc': '//www.blogblog.com/dynamicviews/4224c15c4e7c9321/js/comments.js', 'dynamicViewsScriptSrc': '//www.blogblog.com/dynamicviews/6eb7ce967db05cf0', 'plusOneApiSrc': 'https://apis.google.com/js/platform.js', 'disableGComments': true, 'interstitialAccepted': false, 'sharing': {'platforms': [{'name': 'Get link', 'key': 'link', 'shareMessage': 'Get link', 'target': ''}, {'name': 'Facebook', 'key': 'facebook', 'shareMessage': 'Share to Facebook', 'target': 'facebook'}, {'name': 'BlogThis!', 'key': 'blogThis', 'shareMessage': 'BlogThis!', 'target': 'blog'}, {'name': 'Twitter', 'key': 'twitter', 'shareMessage': 'Share to Twitter', 'target': 'twitter'}, {'name': 'Pinterest', 'key': 'pinterest', 'shareMessage': 'Share to Pinterest', 'target': 'pinterest'}, {'name': 'Email', 'key': 'email', 'shareMessage': 'Email', 'target': 'email'}], 'disableGooglePlus': true, 'googlePlusShareButtonWidth': 0, 'googlePlusBootstrap': '\x3cscript type\x3d\x22text/javascript\x22\x3ewindow.___gcfg \x3d {\x27lang\x27: \x27en\x27};\x3c/script\x3e'}, 'hasCustomJumpLinkMessage': false, 'jumpLinkMessage': 'Read more', 'pageType': 'item', 'postId': '3663024175311920488', 'postImageThumbnailUrl': 'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEioT3h0f4HwgQDI_0LTWJU6KJU3MwVqZ8zuQYgPhF0SXHNCeaw1ut_-WkpVwwqcqLytAsgahAjKshk8ugcbaCZyk8-Us3i8ZfRihE-EA3n8tRFIi0oPUntubw1dJ7y9l1LjTe4Zot7iFd-WJRQ0I1DPdsFA_sULQ5vLIQ8xgQerrz1hyphenhyphenwLj_2J8oC2VD0M/s72-c/image2.png', 'postImageUrl': 'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEioT3h0f4HwgQDI_0LTWJU6KJU3MwVqZ8zuQYgPhF0SXHNCeaw1ut_-WkpVwwqcqLytAsgahAjKshk8ugcbaCZyk8-Us3i8ZfRihE-EA3n8tRFIi0oPUntubw1dJ7y9l1LjTe4Zot7iFd-WJRQ0I1DPdsFA_sULQ5vLIQ8xgQerrz1hyphenhyphenwLj_2J8oC2VD0M/s790/image2.png', 'pageName': 'Driving forward in Android drivers', 'pageTitle': 'Project Zero: Driving forward in Android drivers'}}, {'name': 'features', 'data': {}}, {'name': 'messages', 'data': {'edit': 'Edit', 'linkCopiedToClipboard': 'Link copied to clipboard!', 'ok': 'Ok', 'postLink': 'Post Link'}}, {'name': 'template', 'data': {'name': 'custom', 'localizedName': 'Custom', 'isResponsive': false, 'isAlternateRendering': false, 'isCustom': true}}, {'name': 'view', 'data': {'classic': {'name': 'classic', 'url': '?view\x3dclassic'}, 'flipcard': {'name': 'flipcard', 'url': '?view\x3dflipcard'}, 'magazine': {'name': 'magazine', 'url': '?view\x3dmagazine'}, 'mosaic': {'name': 'mosaic', 'url': '?view\x3dmosaic'}, 'sidebar': {'name': 'sidebar', 'url': '?view\x3dsidebar'}, 'snapshot': {'name': 'snapshot', 'url': '?view\x3dsnapshot'}, 'timeslide': {'name': 'timeslide', 'url': '?view\x3dtimeslide'}, 'isMobile': false, 'title': 'Driving forward in Android drivers', 'description': '  Posted by Seth Jenkins, Google Project Zero Introduction   Android\x27s open-source ecosystem has led to an incredible diversity of manufactu...', 'featuredImage': 'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEioT3h0f4HwgQDI_0LTWJU6KJU3MwVqZ8zuQYgPhF0SXHNCeaw1ut_-WkpVwwqcqLytAsgahAjKshk8ugcbaCZyk8-Us3i8ZfRihE-EA3n8tRFIi0oPUntubw1dJ7y9l1LjTe4Zot7iFd-WJRQ0I1DPdsFA_sULQ5vLIQ8xgQerrz1hyphenhyphenwLj_2J8oC2VD0M/s790/image2.png', 'url': 'https://googleprojectzero.blogspot.com/2024/06/driving-forward-in-android-drivers.html', 'type': 'item', 'isSingleItem': true, 'isMultipleItems': false, 'isError': false, 'isPage': false, 'isPost': true, 'isHomepage': false, 'isArchive': false, 'isLabelSearch': false, 'postId': 3663024175311920488}}]);
_WidgetManager._RegisterWidget('_NavbarView', new _WidgetInfo('Navbar1', 'navbar', document.getElementById('Navbar1'), {}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_HeaderView', new _WidgetInfo('Header1', 'header', document.getElementById('Header1'), {}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_BlogView', new _WidgetInfo('Blog1', 'main', document.getElementById('Blog1'), {'cmtInteractionsEnabled': false, 'lightboxEnabled': true, 'lightboxModuleUrl': 'https://www.blogger.com/static/v1/jsbin/3386964323-lbx.js', 'lightboxCssUrl': 'https://www.blogger.com/static/v1/v-css/13464135-lightbox_bundle.css'}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_BlogSearchView', new _WidgetInfo('BlogSearch1', 'sidebar-right-1', document.getElementById('BlogSearch1'), {}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_PageListView', new _WidgetInfo('PageList1', 'sidebar-right-1', document.getElementById('PageList1'), {'title': 'Pages', 'links': [{'isCurrentPage': false, 'href': 'https://googleprojectzero.blogspot.com/p/about-project-zero.html', 'id': '4384467920505278144', 'title': 'About Project Zero'}, {'isCurrentPage': false, 'href': 'https://googleprojectzero.blogspot.com/p/working-at-project-zero.html', 'id': '2459334498880008057', 'title': 'Working at Project Zero'}, {'isCurrentPage': false, 'href': 'https://googleprojectzero.blogspot.com/p/0day.html', 'id': '3414239791814532209', 'title': '0day \x22In the Wild\x22'}, {'isCurrentPage': false, 'href': 'https://googleprojectzero.github.io/0days-in-the-wild/rca.html', 'title': '0day Exploit Root Cause Analyses'}, {'isCurrentPage': false, 'href': 'https://googleprojectzero.blogspot.com/p/vulnerability-disclosure-faq.html', 'id': '2935252455704572784', 'title': 'Vulnerability Disclosure FAQ'}], 'mobile': false, 'showPlaceholder': true, 'hasCurrentPage': false}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_BlogArchiveView', new _WidgetInfo('BlogArchive1', 'sidebar-right-1', document.getElementById('BlogArchive1'), {'languageDirection': 'ltr', 'loadingMessage': 'Loading\x26hellip;'}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_AttributionView', new _WidgetInfo('Attribution1', 'footer-3', document.getElementById('Attribution1'), {}, 'displayModeFull'));
</script>
</body>
</html>