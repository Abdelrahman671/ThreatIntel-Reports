<!doctype html>
<html lang="en-US">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link class="user" href="https://www.vmware.com/content/dam/vmwaredesigns/scrapercontent/responsive.css" rel="stylesheet" type="text/css">
  <link rel="shortcut icon" type="image/x-icon" href="https://blogs.vmware.com/security/wp-content/themes/vmware-security-0.2.2/favicon.ico" />
  <meta name='robots' content='index, follow, max-image-preview:large, max-snippet:-1, max-video-preview:-1' />

	<!-- This site is optimized with the Yoast SEO Premium plugin v20.8 (Yoast SEO v21.5) - https://yoast.com/wordpress/plugins/seo/ -->
	<title>VMware Carbon Black TAU Threat Analysis: Shlayer (macOS) - VMware Security Blog - VMware</title>
	<link rel="canonical" href="https://blogs.vmware.com/security/2020/02/vmware-carbon-black-tau-threat-analysis-shlayer-macos.html" />
	<meta property="og:locale" content="en_US" />
	<meta property="og:type" content="article" />
	<meta property="og:title" content="VMware Carbon Black TAU Threat Analysis: Shlayer (macOS)" />
	<meta property="og:description" content="Following our initial reporting of this threat, Carbon Black’s Threat Analysis Unit (TAU) has continued following the Shlayer family of malware and monitoring changes adopted by this campaign. Although detection by antivirus vendors has improved over the past year, the malware authors continue to release new samples on a daily basis. Despite minor differences in the variants discovered, the overall behavior &hellip; Continued" />
	<meta property="og:url" content="https://blogs.vmware.com/security/2020/02/vmware-carbon-black-tau-threat-analysis-shlayer-macos.html" />
	<meta property="og:site_name" content="VMware Security Blog" />
	<meta property="article:published_time" content="2020-02-12T05:00:00+00:00" />
	<meta property="article:modified_time" content="2022-03-17T03:21:16+00:00" />
	<meta property="og:image" content="https://blogs.vmware.com/security/files/2020/05/Shlayer.jpg" />
	<meta property="og:image:width" content="800" />
	<meta property="og:image:height" content="535" />
	<meta property="og:image:type" content="image/jpeg" />
	<meta name="twitter:card" content="summary_large_image" />
	<meta name="twitter:creator" content="@vspheresecurity" />
	<meta name="twitter:site" content="@vspheresecurity" />
	<meta name="twitter:label1" content="Written by" />
	<meta name="twitter:data1" content="" />
	<meta name="twitter:label2" content="Est. reading time" />
	<meta name="twitter:data2" content="13 minutes" />
	<script type="application/ld+json" class="yoast-schema-graph">{"@context":"https://schema.org","@graph":[{"@type":"WebPage","@id":"https://blogs.vmware.com/security/2020/02/vmware-carbon-black-tau-threat-analysis-shlayer-macos.html","url":"https://blogs.vmware.com/security/2020/02/vmware-carbon-black-tau-threat-analysis-shlayer-macos.html","name":"VMware Carbon Black TAU Threat Analysis: Shlayer (macOS) - VMware Security Blog - VMware","isPartOf":{"@id":"https://blogs.vmware.com/security/#website"},"primaryImageOfPage":{"@id":"https://blogs.vmware.com/security/2020/02/vmware-carbon-black-tau-threat-analysis-shlayer-macos.html#primaryimage"},"image":{"@id":"https://blogs.vmware.com/security/2020/02/vmware-carbon-black-tau-threat-analysis-shlayer-macos.html#primaryimage"},"thumbnailUrl":"https://blogs.vmware.com/security/files/2020/05/Shlayer.jpg","datePublished":"2020-02-12T05:00:00+00:00","dateModified":"2022-03-17T03:21:16+00:00","author":{"@id":""},"breadcrumb":{"@id":"https://blogs.vmware.com/security/2020/02/vmware-carbon-black-tau-threat-analysis-shlayer-macos.html#breadcrumb"},"inLanguage":"en-US","potentialAction":[{"@type":"ReadAction","target":["https://blogs.vmware.com/security/2020/02/vmware-carbon-black-tau-threat-analysis-shlayer-macos.html"]}]},{"@type":"ImageObject","inLanguage":"en-US","@id":"https://blogs.vmware.com/security/2020/02/vmware-carbon-black-tau-threat-analysis-shlayer-macos.html#primaryimage","url":"https://blogs.vmware.com/security/files/2020/05/Shlayer.jpg","contentUrl":"https://blogs.vmware.com/security/files/2020/05/Shlayer.jpg","width":800,"height":535},{"@type":"BreadcrumbList","@id":"https://blogs.vmware.com/security/2020/02/vmware-carbon-black-tau-threat-analysis-shlayer-macos.html#breadcrumb","itemListElement":[{"@type":"ListItem","position":1,"name":"Home","item":"https://blogs.vmware.com/security/"},{"@type":"ListItem","position":2,"name":"VMware Carbon Black TAU Threat Analysis: Shlayer (macOS)"}]},{"@type":"WebSite","@id":"https://blogs.vmware.com/security/#website","url":"https://blogs.vmware.com/security/","name":"VMware Security Blog","description":"","potentialAction":[{"@type":"SearchAction","target":{"@type":"EntryPoint","urlTemplate":"https://blogs.vmware.com/security/?s={search_term_string}"},"query-input":"required name=search_term_string"}],"inLanguage":"en-US"},{"@type":"Person","@id":"","url":"https://blogs.vmware.com/security/author"}]}</script>
	<!-- / Yoast SEO Premium plugin. -->


<script type="text/javascript">
window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/14.0.0\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/14.0.0\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/blogs.vmware.com\/security\/wp-includes\/js\/wp-emoji-release.min.js?ver=6.2.2"}};
/*! This file is auto-generated */
!function(e,a,t){var n,r,o,i=a.createElement("canvas"),p=i.getContext&&i.getContext("2d");function s(e,t){p.clearRect(0,0,i.width,i.height),p.fillText(e,0,0);e=i.toDataURL();return p.clearRect(0,0,i.width,i.height),p.fillText(t,0,0),e===i.toDataURL()}function c(e){var t=a.createElement("script");t.src=e,t.defer=t.type="text/javascript",a.getElementsByTagName("head")[0].appendChild(t)}for(o=Array("flag","emoji"),t.supports={everything:!0,everythingExceptFlag:!0},r=0;r<o.length;r++)t.supports[o[r]]=function(e){if(p&&p.fillText)switch(p.textBaseline="top",p.font="600 32px Arial",e){case"flag":return s("\ud83c\udff3\ufe0f\u200d\u26a7\ufe0f","\ud83c\udff3\ufe0f\u200b\u26a7\ufe0f")?!1:!s("\ud83c\uddfa\ud83c\uddf3","\ud83c\uddfa\u200b\ud83c\uddf3")&&!s("\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc65\udb40\udc6e\udb40\udc67\udb40\udc7f","\ud83c\udff4\u200b\udb40\udc67\u200b\udb40\udc62\u200b\udb40\udc65\u200b\udb40\udc6e\u200b\udb40\udc67\u200b\udb40\udc7f");case"emoji":return!s("\ud83e\udef1\ud83c\udffb\u200d\ud83e\udef2\ud83c\udfff","\ud83e\udef1\ud83c\udffb\u200b\ud83e\udef2\ud83c\udfff")}return!1}(o[r]),t.supports.everything=t.supports.everything&&t.supports[o[r]],"flag"!==o[r]&&(t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&t.supports[o[r]]);t.supports.everythingExceptFlag=t.supports.everythingExceptFlag&&!t.supports.flag,t.DOMReady=!1,t.readyCallback=function(){t.DOMReady=!0},t.supports.everything||(n=function(){t.readyCallback()},a.addEventListener?(a.addEventListener("DOMContentLoaded",n,!1),e.addEventListener("load",n,!1)):(e.attachEvent("onload",n),a.attachEvent("onreadystatechange",function(){"complete"===a.readyState&&t.readyCallback()})),(e=t.source||{}).concatemoji?c(e.concatemoji):e.wpemoji&&e.twemoji&&(c(e.twemoji),c(e.wpemoji)))}(window,document,window._wpemojiSettings);
</script>
<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 0.07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
	<link rel='stylesheet' id='wp-block-library-css' href='https://blogs.vmware.com/security/wp-includes/css/dist/block-library/style.min.css?ver=6.2.2' type='text/css' media='all' />
<link rel='stylesheet' id='classic-theme-styles-css' href='https://blogs.vmware.com/security/wp-includes/css/classic-themes.min.css?ver=6.2.2' type='text/css' media='all' />
<style id='global-styles-inline-css' type='text/css'>
body{--wp--preset--color--black: #000000;--wp--preset--color--cyan-bluish-gray: #abb8c3;--wp--preset--color--white: #ffffff;--wp--preset--color--pale-pink: #f78da7;--wp--preset--color--vivid-red: #cf2e2e;--wp--preset--color--luminous-vivid-orange: #ff6900;--wp--preset--color--luminous-vivid-amber: #fcb900;--wp--preset--color--light-green-cyan: #7bdcb5;--wp--preset--color--vivid-green-cyan: #00d084;--wp--preset--color--pale-cyan-blue: #8ed1fc;--wp--preset--color--vivid-cyan-blue: #0693e3;--wp--preset--color--vivid-purple: #9b51e0;--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple: linear-gradient(135deg,rgba(6,147,227,1) 0%,rgb(155,81,224) 100%);--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan: linear-gradient(135deg,rgb(122,220,180) 0%,rgb(0,208,130) 100%);--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange: linear-gradient(135deg,rgba(252,185,0,1) 0%,rgba(255,105,0,1) 100%);--wp--preset--gradient--luminous-vivid-orange-to-vivid-red: linear-gradient(135deg,rgba(255,105,0,1) 0%,rgb(207,46,46) 100%);--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray: linear-gradient(135deg,rgb(238,238,238) 0%,rgb(169,184,195) 100%);--wp--preset--gradient--cool-to-warm-spectrum: linear-gradient(135deg,rgb(74,234,220) 0%,rgb(151,120,209) 20%,rgb(207,42,186) 40%,rgb(238,44,130) 60%,rgb(251,105,98) 80%,rgb(254,248,76) 100%);--wp--preset--gradient--blush-light-purple: linear-gradient(135deg,rgb(255,206,236) 0%,rgb(152,150,240) 100%);--wp--preset--gradient--blush-bordeaux: linear-gradient(135deg,rgb(254,205,165) 0%,rgb(254,45,45) 50%,rgb(107,0,62) 100%);--wp--preset--gradient--luminous-dusk: linear-gradient(135deg,rgb(255,203,112) 0%,rgb(199,81,192) 50%,rgb(65,88,208) 100%);--wp--preset--gradient--pale-ocean: linear-gradient(135deg,rgb(255,245,203) 0%,rgb(182,227,212) 50%,rgb(51,167,181) 100%);--wp--preset--gradient--electric-grass: linear-gradient(135deg,rgb(202,248,128) 0%,rgb(113,206,126) 100%);--wp--preset--gradient--midnight: linear-gradient(135deg,rgb(2,3,129) 0%,rgb(40,116,252) 100%);--wp--preset--duotone--dark-grayscale: url('#wp-duotone-dark-grayscale');--wp--preset--duotone--grayscale: url('#wp-duotone-grayscale');--wp--preset--duotone--purple-yellow: url('#wp-duotone-purple-yellow');--wp--preset--duotone--blue-red: url('#wp-duotone-blue-red');--wp--preset--duotone--midnight: url('#wp-duotone-midnight');--wp--preset--duotone--magenta-yellow: url('#wp-duotone-magenta-yellow');--wp--preset--duotone--purple-green: url('#wp-duotone-purple-green');--wp--preset--duotone--blue-orange: url('#wp-duotone-blue-orange');--wp--preset--font-size--small: 13px;--wp--preset--font-size--medium: 20px;--wp--preset--font-size--large: 36px;--wp--preset--font-size--x-large: 42px;--wp--preset--spacing--20: 0.44rem;--wp--preset--spacing--30: 0.67rem;--wp--preset--spacing--40: 1rem;--wp--preset--spacing--50: 1.5rem;--wp--preset--spacing--60: 2.25rem;--wp--preset--spacing--70: 3.38rem;--wp--preset--spacing--80: 5.06rem;--wp--preset--shadow--natural: 6px 6px 9px rgba(0, 0, 0, 0.2);--wp--preset--shadow--deep: 12px 12px 50px rgba(0, 0, 0, 0.4);--wp--preset--shadow--sharp: 6px 6px 0px rgba(0, 0, 0, 0.2);--wp--preset--shadow--outlined: 6px 6px 0px -3px rgba(255, 255, 255, 1), 6px 6px rgba(0, 0, 0, 1);--wp--preset--shadow--crisp: 6px 6px 0px rgba(0, 0, 0, 1);}:where(.is-layout-flex){gap: 0.5em;}body .is-layout-flow > .alignleft{float: left;margin-inline-start: 0;margin-inline-end: 2em;}body .is-layout-flow > .alignright{float: right;margin-inline-start: 2em;margin-inline-end: 0;}body .is-layout-flow > .aligncenter{margin-left: auto !important;margin-right: auto !important;}body .is-layout-constrained > .alignleft{float: left;margin-inline-start: 0;margin-inline-end: 2em;}body .is-layout-constrained > .alignright{float: right;margin-inline-start: 2em;margin-inline-end: 0;}body .is-layout-constrained > .aligncenter{margin-left: auto !important;margin-right: auto !important;}body .is-layout-constrained > :where(:not(.alignleft):not(.alignright):not(.alignfull)){max-width: var(--wp--style--global--content-size);margin-left: auto !important;margin-right: auto !important;}body .is-layout-constrained > .alignwide{max-width: var(--wp--style--global--wide-size);}body .is-layout-flex{display: flex;}body .is-layout-flex{flex-wrap: wrap;align-items: center;}body .is-layout-flex > *{margin: 0;}:where(.wp-block-columns.is-layout-flex){gap: 2em;}.has-black-color{color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-color{color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-color{color: var(--wp--preset--color--white) !important;}.has-pale-pink-color{color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-color{color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-color{color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-color{color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-color{color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-color{color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-color{color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-color{color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-color{color: var(--wp--preset--color--vivid-purple) !important;}.has-black-background-color{background-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-background-color{background-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-background-color{background-color: var(--wp--preset--color--white) !important;}.has-pale-pink-background-color{background-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-background-color{background-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-background-color{background-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-background-color{background-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-background-color{background-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-background-color{background-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-background-color{background-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-background-color{background-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-background-color{background-color: var(--wp--preset--color--vivid-purple) !important;}.has-black-border-color{border-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-border-color{border-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-border-color{border-color: var(--wp--preset--color--white) !important;}.has-pale-pink-border-color{border-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-border-color{border-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-border-color{border-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-border-color{border-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-border-color{border-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-border-color{border-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-border-color{border-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-border-color{border-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-border-color{border-color: var(--wp--preset--color--vivid-purple) !important;}.has-vivid-cyan-blue-to-vivid-purple-gradient-background{background: var(--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple) !important;}.has-light-green-cyan-to-vivid-green-cyan-gradient-background{background: var(--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan) !important;}.has-luminous-vivid-amber-to-luminous-vivid-orange-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange) !important;}.has-luminous-vivid-orange-to-vivid-red-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-orange-to-vivid-red) !important;}.has-very-light-gray-to-cyan-bluish-gray-gradient-background{background: var(--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray) !important;}.has-cool-to-warm-spectrum-gradient-background{background: var(--wp--preset--gradient--cool-to-warm-spectrum) !important;}.has-blush-light-purple-gradient-background{background: var(--wp--preset--gradient--blush-light-purple) !important;}.has-blush-bordeaux-gradient-background{background: var(--wp--preset--gradient--blush-bordeaux) !important;}.has-luminous-dusk-gradient-background{background: var(--wp--preset--gradient--luminous-dusk) !important;}.has-pale-ocean-gradient-background{background: var(--wp--preset--gradient--pale-ocean) !important;}.has-electric-grass-gradient-background{background: var(--wp--preset--gradient--electric-grass) !important;}.has-midnight-gradient-background{background: var(--wp--preset--gradient--midnight) !important;}.has-small-font-size{font-size: var(--wp--preset--font-size--small) !important;}.has-medium-font-size{font-size: var(--wp--preset--font-size--medium) !important;}.has-large-font-size{font-size: var(--wp--preset--font-size--large) !important;}.has-x-large-font-size{font-size: var(--wp--preset--font-size--x-large) !important;}
.wp-block-navigation a:where(:not(.wp-element-button)){color: inherit;}
:where(.wp-block-columns.is-layout-flex){gap: 2em;}
.wp-block-pullquote{font-size: 1.5em;line-height: 1.6;}
</style>
<link rel='stylesheet' id='bcct_style-css' href='https://blogs.vmware.com/security/wp-content/plugins/better-click-to-tweet/assets/css/styles.css?ver=3.0' type='text/css' media='all' />
<link rel='stylesheet' id='g-onetrust-style-css' href='https://blogs.vmware.com/security/wp-content/plugins/onetrust-vmware-mu/css/g_onetrust.css?ver=6.2.2' type='text/css' media='all' />
<link rel='stylesheet' id='crp-style-rounded-thumbs-css' href='https://blogs.vmware.com/security/wp-content/plugins/contextual-related-posts/css/rounded-thumbs.min.css?ver=3.3.3' type='text/css' media='all' />
<style id='crp-style-rounded-thumbs-inline-css' type='text/css'>

			.crp_related.crp-rounded-thumbs a {
			  width: 150px;
			  height: 150px;
			  text-decoration: none;
			}
			.crp_related.crp-rounded-thumbs img {
			  max-width: 150px;
			  margin: auto;
			}
			.crp_related.crp-rounded-thumbs .crp_title {
			  width: 100%;
			}
			
</style>
<link rel='stylesheet' id='meks-author-widget-css' href='https://blogs.vmware.com/security/wp-content/plugins/meks-smart-author-widget/css/style.css?ver=1.1.1' type='text/css' media='all' />
<link rel='stylesheet' id='sage/css-css' href='https://blogs.vmware.com/security/wp-content/themes/vmware-security-0.2.2/dist/styles/main-3089d13a45.css' type='text/css' media='all' />
<link rel='stylesheet' id='wp-add-custom-css-css' href='https://blogs.vmware.com/security?display_custom_css=css&#038;ver=6.2.2' type='text/css' media='all' />
<script type='text/javascript' src='https://blogs.vmware.com/security/wp-content/plugins/onetrust-vmware-mu/js/g_onetrust.js?ver=6.2.2' id='g-onetrust-javascript-js'></script>
<script type='text/javascript' src='https://blogs.vmware.com/security/wp-includes/js/jquery/jquery.min.js?ver=3.6.4' id='jquery-core-js'></script>
<script type='text/javascript' src='https://blogs.vmware.com/security/wp-includes/js/jquery/jquery-migrate.min.js?ver=3.4.0' id='jquery-migrate-js'></script>
<script type='text/javascript' src='https://blogs.vmware.com/security/wp-content/themes/vmware-security-0.2.2/inc/wp-scripts/marker-animation.js?ver=6.2.2' id='jquery.marker-animation-js'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://blogs.vmware.com/security/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="https://blogs.vmware.com/security/wp-includes/wlwmanifest.xml" />
<meta name="generator" content="WordPress 6.2.2" />
<link rel='shortlink' href='https://blogs.vmware.com/security/?p=59050' />
<link rel="alternate" type="application/json+oembed" href="https://blogs.vmware.com/security/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fblogs.vmware.com%2Fsecurity%2F2020%2F02%2Fvmware-carbon-black-tau-threat-analysis-shlayer-macos.html" />
<link rel="alternate" type="text/xml+oembed" href="https://blogs.vmware.com/security/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fblogs.vmware.com%2Fsecurity%2F2020%2F02%2Fvmware-carbon-black-tau-threat-analysis-shlayer-macos.html&#038;format=xml" />
<script src=" https://cdn.cookielaw.org/scripttemplates/otSDKStub.js" type="text/javascript" charset="UTF-8" data-domain-script="8f4d3580-4337-499c-b909-13704811568b"></script>
<script type="text/javascript">
function OptanonWrapper() { }
</script>

<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-KFH48ZHP');</script>
<!-- End Google Tag Manager -->  </head>
  <body class="post-template-default single single-post postid-59050 single-format-standard vmware-carbon-black-tau-threat-analysis-shlayer-macos.html sidebar-primary">
    <!--[if IE]>
      <div class="alert alert-warning">
        You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.      </div>
    <![endif]-->
    <header class="banner">
  <nav class="global-nav">
  <div class="container">
    <div class="row">
      <div class="col-12 col-md-10 col-lg-7">
        <div class="brand-links">
                      <button class="hamburger mobile-trigger" type="button" aria-controls="primaryNavigation" aria-expanded="false" aria-label="Toggle menu">
              <span></span>
              <span></span>
              <span></span>
              <span></span>
              <span class="label">Menu</span>
            </button>
                    <a href="https://www.vmware.com/"><img src="//blogs.vmware.com/security/wp-content/themes/vmware-security-0.2.2/dist/images/VMware-by-Broadcom-Logo_color.svg" alt="VMware" /></a>
          <a class="name" href="https://blogs.vmware.com/security/">VMware Security Blog</a>
        </div>
      </div>
      <div class="col-md-2 col-lg-5 text-right right-nav">
        <div class="search-wrap">
          <form class="search-form" method="get" action="https://blogs.vmware.com/security/">
  <label class="sr-only" for="s">Search</label>
  <input class="search-field" placeholder="Search" name="s" />
  <input type="submit" value="Submit Search" class="search-submit btn">
</form>
<button class="search-btn mobile-trigger" type="button" aria-expanded="false" aria-label="Toggle search">
    <span class="sr-only">Search</span>
</button>        </div>
        <button class="dots mobile-trigger" type="button" aria-controls="globalNavigation" aria-expanded="false" aria-label="Toggle menu">
          <span></span>
          <span></span>
          <span></span>
        </button>
        <div class="links-wrap" id="globalNavigation">
          <ul class="links">
            <li><a href="https://blogs.vmware.com/">VMware Blogs</a></li>
            <li><a href="https://communities.vmware.com/">Communities</a></li>
            <li><a href="https://carbonblack.vmware.com/">Tech Zone</a></li>
          </ul>
                      <ul class="social-links d-lg-none">
                              <li class="icon icon-rss">
                  <a href="https://blogs.vmware.com/security/feed" target="_rss" rel="noopener noreferrer">
                    <span class="sr-only">RSS</span>
                  </a>
                </li>
                          </ul>
                  </div>
      </div>
    </div>
  </div>
</nav>  <nav class="primary-nav" role="navigation">
    <div class="container">
        <div class="row">
            <div id="primaryNavigation" class="col-12 col-lg-9 main-nav" aria-label="Main Menu">
                <div class="gradient-mask-wrap">
                    <div class="gradient-menu-wrap">
                        <ul id="menu-main-nav" class="menu-top-nav" role="menubar"><li id="menu-item-81358" class="nav-featured menu-item menu-item-type-custom menu-item-object-custom menu-item-81358"><a href="https://blogs.vmware.com/security/tag/featured" role="menuitem">Featured</a><div class="gradient-mask"><div class="arrow"></div></div></li>
<li id="menu-item-81367" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-has-children menu-item-81367"><a href="#" role="menuitem" aria-haspopup="true" aria-expanded="false">Categories</a><button aria-expanded="false" aria-controls="submenu-81367" ><span class="sr-only">Toggle submenu</span></button><div class="gradient-mask"><div class="arrow"></div></div>
<ul role="menu" class="sub-menu" id="submenu-81367">
	<li id="menu-item-81361" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-81361"><a href="https://blogs.vmware.com/security/announcements" role="menuitem">Announcements</a></li>
	<li id="menu-item-81363" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-81363"><a href="https://blogs.vmware.com/security/executive-viewpoint" role="menuitem">Executive Viewpoint</a></li>
	<li id="menu-item-81366" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-81366"><a href="https://blogs.vmware.com/security/multi-cloud-security" role="menuitem">Multi-Cloud Security</a></li>
	<li id="menu-item-81365" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-81365"><a href="https://blogs.vmware.com/security/modern-apps-security" role="menuitem">Modern Apps Security</a></li>
	<li id="menu-item-81364" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-81364"><a href="https://blogs.vmware.com/security/workload-security" role="menuitem">Workload Security</a></li>
	<li id="menu-item-81359" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-81359"><a href="https://blogs.vmware.com/security/endpoint-security" role="menuitem">Endpoint Security</a></li>
	<li id="menu-item-81362" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-81362"><a href="https://blogs.vmware.com/security/network-security" role="menuitem">Network Security</a></li>
	<li id="menu-item-81360" class="menu-item menu-item-type-taxonomy menu-item-object-category current-post-ancestor current-menu-parent current-post-parent menu-item-81360"><a href="https://blogs.vmware.com/security/threat-analysis-unit" role="menuitem">Threat Analysis Unit</a></li>
	<li id="menu-item-82317" class="menu-item menu-item-type-taxonomy menu-item-object-category menu-item-82317"><a href="https://blogs.vmware.com/security/vmware-security-response-center" role="menuitem">VMware Security Response Center</a></li>
</ul>
</li>
<li id="menu-item-81368" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-81368"><a target="_blank" href="https://www.vmware.com/security.html" role="menuitem">VMware Security</a><div class="gradient-mask"><div class="arrow"></div></div></li>
</ul>                    </div>
                    <div class="gradient-menu-mask"></div>
                </div>
            </div>
            <div class="col-12 col-lg-3">
                                <ul class="social-links">
                                        <li class="icon icon-rss">
                        <a href="https://blogs.vmware.com/security/feed" target="_rss" rel="noopener noreferrer">
                            <span class="sr-only">RSS</span>
                        </a>
                    </li>
                                    </ul>
                            </div>
        </div>
    </div>
    <div class="gradient-bar">
        <div class="container">
            <div class="row">
                <div class="col-9">
                    <div class="gradient-mask"></div>
                </div>
            </div>
        </div>
    </div>
</nav>
  
<div class="featured-tags">
    <div class="container">
        <div class="row background-dark-gray">
                            <div class="col-3 stacked-posts category-curl">
                    
<article class="card post-82457 post type-post status-publish format-standard has-post-thumbnail hentry category-announcements category-multi-cloud-security category-threat-intelligence tag-featured tag-incident-response tag-ransomware">
  <div class="image-wrap">
    <a href="https://blogs.vmware.com/security/2022/06/cisos-lateral-cybersecurity-threats-contexa.html" title="Why CISOs Should Invest More Inside Their Infrastructure">
      <img src="https://blogs.vmware.com/security/files/2022/06/Tom-Gillis_VMware-Security_Contexa-Threat-Intelligence-410x222.jpg" alt="Why CISOs Should Invest More Inside Their Infrastructure" class="" />
    </a>
      </div>
  <div class="content-wrap">
    <div class="content-inner">
                        <a href="https://blogs.vmware.com/security/announcements" class="category-label">Announcements</a>
                    <h2 class="title"><a href="https://blogs.vmware.com/security/2022/06/cisos-lateral-cybersecurity-threats-contexa.html">Why CISOs Should Invest More Inside Their Infrastructure</a></h2>
      <div class="entry-meta">
            <span class="author-list">
                                    <a href="https://blogs.vmware.com/security/author/tomgillis" rel="author" class="author">Tom Gillis</a>
                            </span>
                <time class="updated" datetime="2022-06-02" pubdate>June 2, 2022</time>
        <span class="read-time">5 min read</span>
    </div>    </div>
  </div>
</article>
                </div>
                            <div class="col-3 stacked-posts category-curl">
                    
<article class="card post-82276 post type-post status-publish format-standard has-post-thumbnail hentry category-threat-analysis-unit tag-featured">
  <div class="image-wrap">
    <a href="https://blogs.vmware.com/security/2022/04/serpent-the-backdoor-that-hides-in-plain-sight.html" title="Serpent - The Backdoor that Hides in Plain Sight">
      <img src="https://blogs.vmware.com/security/files/2022/03/Threat-Research_Featured-410x222.png" alt="Serpent - The Backdoor that Hides in Plain Sight" class="" />
    </a>
      </div>
  <div class="content-wrap">
    <div class="content-inner">
                        <a href="https://blogs.vmware.com/security/threat-analysis-unit" class="category-label">Threat Analysis Unit</a>
                    <h2 class="title"><a href="https://blogs.vmware.com/security/2022/04/serpent-the-backdoor-that-hides-in-plain-sight.html">Serpent - The Backdoor that Hides in Plain Sight</a></h2>
      <div class="entry-meta">
            <span class="author-list">
                                    <a href="https://blogs.vmware.com/security/author/tau" rel="author" class="author">Threat Analysis Unit</a>
                            </span>
                <time class="updated" datetime="2022-04-25" pubdate>April 25, 2022</time>
        <span class="read-time">11 min read</span>
    </div>    </div>
  </div>
</article>
                </div>
                            <div class="col-3 stacked-posts category-curl">
                    
<article class="card post-82261 post type-post status-publish format-standard has-post-thumbnail hentry category-executive-viewpoint tag-featured">
  <div class="image-wrap   image-grayscale">
    <a href="https://blogs.vmware.com/security/2022/04/how-not-to-build-a-soc.html" title="How Not to Build a SOC">
      <img src="https://blogs.vmware.com/security/files/2022/03/photo_security9_screens-410x222.jpg" alt="How Not to Build a SOC" class="" />
    </a>
      </div>
  <div class="content-wrap">
    <div class="content-inner">
                        <a href="https://blogs.vmware.com/security/executive-viewpoint" class="category-label">Executive Viewpoint</a>
                    <h2 class="title"><a href="https://blogs.vmware.com/security/2022/04/how-not-to-build-a-soc.html">How Not to Build a SOC</a></h2>
      <div class="entry-meta">
            <span class="author-list">
                                    <a href="https://blogs.vmware.com/security/author/mholzworth" rel="author" class="author">Martin Holzworth</a>
                            </span>
                <time class="updated" datetime="2022-04-18" pubdate>April 18, 2022</time>
        <span class="read-time">14 min read</span>
    </div>    </div>
  </div>
</article>
                </div>
                            <div class="col-3 stacked-posts category-curl">
                    
<article class="card post-82220 post type-post status-publish format-audio has-post-thumbnail hentry category-executive-viewpoint tag-featured post_format-post-format-audio">
  <div class="image-wrap   image-grayscale">
    <a href="https://blogs.vmware.com/security/2022/04/cybersecurity-podcast-tom-kellermann-global-threats.html" title="Podcast: Discussing the latest security threats and threat actors - Tom Kellermann (Virtually Speaking)">
      <img src="https://blogs.vmware.com/security/files/2022/02/globecyberattack-e1647877118160-410x222.jpg" alt="Podcast: Discussing the latest security threats and threat actors - Tom Kellermann (Virtually Speaking)" class="" />
    </a>
      </div>
  <div class="content-wrap">
    <div class="content-inner">
                        <a href="https://blogs.vmware.com/security/executive-viewpoint" class="category-label">Executive Viewpoint</a>
                    <h2 class="title"><a href="https://blogs.vmware.com/security/2022/04/cybersecurity-podcast-tom-kellermann-global-threats.html">Podcast: Discussing the latest security threats and threat actors - Tom Kellermann (Virtually Speaking)</a></h2>
      <div class="entry-meta">
            <span class="author-list">
                                    <a href="https://blogs.vmware.com/security/author/blog-editor" rel="author" class="author">Editorial Staff</a>
                            </span>
                <time class="updated" datetime="2022-04-13" pubdate>April 13, 2022</time>
        <span class="read-time">1 min read</span>
    </div>    </div>
  </div>
</article>
                </div>
                    </div>
    </div>
</div>

</header>
    <div class="wrap" role="document">
      <div class="content">
        <main>
          
  <article class="background-off-white">
    <div class="container background-white mb-4">
      <div class="row">
        <div class="col-12">
          <header class="post-header">
    <div class="post-header-inner">
                    <div class="post-featured-image">
                <div class="image-wrap">
                    <img src="https://blogs.vmware.com/security/files/2020/05/Shlayer-410x222.jpg" alt="" class="img-fluid" />
                                    </div>
            </div>
                <div class="post-headline">
                            <a href="https://blogs.vmware.com/security/threat-analysis-unit" class="category-label">Threat Analysis Unit</a>
                        <h1 class="entry-title">VMware Carbon Black TAU Threat Analysis: Shlayer (macOS)</h1>
            <div class="entry-meta">
                <time class="updated" datetime="2020-02-12" pubdate>February 12, 2020</time>
        <span class="read-time">25 min read</span>
    </div>                    </div>
    </div>
</header>        </div>
      </div>
      <div class="read-progress-wrap position-relative z-index-1">
        <div class="read-progress">
          <div class="sr-only aria-progress" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100"></div>
          <div class="recede"></div>
        </div>
        <div class="row">
          <div class="col-md-4 col-lg-2">
            <aside class="sharing d-none d-md-block">
              <strong>Share on:</strong>
              <ul class="social-links">
    <li class="icon icon-twitter">
        <a href="https://twitter.com/intent/tweet?url=https://blogs.vmware.com/security/2020/02/vmware-carbon-black-tau-threat-analysis-shlayer-macos.html&text=VMware+Carbon+Black+TAU+Threat+Analysis%3A+Shlayer+%28macOS%29" 
    target="_blank" rel="noopener noreferrer" title="Twitter">
            <span class="sr-only">Share on Twitter</span>
        </a>
    </li>
    <li class="icon icon-linkedin">
        <a href="#" role="button" title="LinkedIn" onclick="window.open('http://www.linkedin.com/shareArticle?mini=true&amp;url=https://blogs.vmware.com/security/2020/02/vmware-carbon-black-tau-threat-analysis-shlayer-macos.html','', '_blank, width=500, height=600, resizable=yes, scrollbars=yes'); return false;">
            <span class="sr-only">Share on LinkedIn</span>
        </a>
    </li>
    <li class="icon icon-fb">
        <a href="#" role="button" title="Facebook" onclick="window.open('https://www.facebook.com/sharer/sharer.php?u=https://blogs.vmware.com/security/2020/02/vmware-carbon-black-tau-threat-analysis-shlayer-macos.html','', '_blank, width=500, height=600, resizable=yes, scrollbars=yes'); return false;">
            <span class="sr-only">Share on Facebook</span>
        </a>
    </li>
    <li class="icon icon-reddit">
        <a href="https://www.reddit.com/submit?url=https://blogs.vmware.com/security/2020/02/vmware-carbon-black-tau-threat-analysis-shlayer-macos.html&title=VMware+Carbon+Black+TAU+Threat+Analysis%3A+Shlayer+%28macOS%29"
        target="_blank" title="Reddit">
            <span class="sr-only">Share on Reddit</span>
        </a>
    </li>
    <li class="icon icon-mail">
        <a href="/cdn-cgi/l/email-protection#013e7274636b6462753c574c766073642a426073636e6f2a436d60626a2a5540542a5569736460752a406f606d787268722432402a52696d607864732a2433396c60624e5224333827636e65783c69757571723b2e2e636d6e66722f776c766073642f626e6c2e72646274736875782e333133312e31332e776c766073642c626073636e6f2c636d60626a2c7560742c7569736460752c606f606d787268722c72696d607864732c6c60626e722f69756c6d" target="_blank" title="Email">
            <span class="sr-only">Email this post</span>
        </a>
    </li>
    <li class="icon icon-copy-link">
        <a role="button" href="https://blogs.vmware.com/security/2020/02/vmware-carbon-black-tau-threat-analysis-shlayer-macos.html" id="copyUrl" title="Copy Link"><span class="sr-only">Copy Link</span></a>
    </li>
</ul>            </aside>
          </div>
          <div class="col-md-8">
            <div class="entry-content">
              <p><span data-contrast="none">Following our </span><a href="https://www.carbonblack.com/2019/02/12/tau-threat-intelligence-notification-new-macos-malware-variant-of-shlayer-osx-discovered/"><span data-contrast="none">initial reporting</span></a><span data-contrast="none"> of this threat, Carbon Black’s Threat Analysis Unit (TAU) has continued following the Shlayer family of malware and monitoring changes adopted by this campaign. Although detection by antivirus vendors has improved over the past </span><span data-contrast="none">year</span><span data-contrast="none">, the malware authors continue to release new samples on a daily basis. Despite minor differences in the variants discovered, the overall behavior of this family of malware has remained the same. For more information on how VMware Carbon Black’s products protect from these threats, please see the </span><a href="https://community.carbonblack.com/t5/Threat-Research-Docs/TAU-TIN-Shlayer-OSX/ta-p/66839"><span data-contrast="none">TAU-TIN</span></a><span data-contrast="none"> on our user exchange.</span><span data-ccp-props="{&quot;335551550&quot;:6,&quot;335551620&quot;:6}"> </span></p>
<p><strong>Background </strong></p>
<p><span data-contrast="none">Shlayer is a family of macOS malware which was first </span><a href="https://www.intego.com/mac-security-blog/osxshlayer-new-mac-malware-comes-out-of-its-shell/"><span data-contrast="none">reported</span></a><span data-contrast="none"> in February of 2018 by researchers from Intego. In November of 2018, VMware Carbon Black’s Threat Analysis Unit (TAU) obtained new samples of this malware and observed downloads of the malware from multiple sites, primarily disguised as an Adobe Flash software update. Many of the sites that we have found to redirect to these fake updates have been those masquerading as legitimate sites, or hijacked domains formerly hosting legitimate sites, and some appear to be redirected from malvertisements on legitimate sites. These tactics are often used by adware and malware to trick the user into installing their software.     </span><span data-ccp-props="{&quot;335551550&quot;:6,&quot;335551620&quot;:6}"> </span></p>
<p><span data-contrast="none">We have continued to see a steady number of infections and samples of Shlayer in the wild over the past year. In the past </span><span data-contrast="none">six</span><span data-contrast="none"> months, there is still a large number of samples being uploaded publicly. The chart below shows uploads from the past </span><span data-contrast="none">six months</span><span data-contrast="none">, both original variants detected using behavioral identifiers and all samples identified by at least one antivirus agent as Shlayer:</span><span data-ccp-props="{}"> </p>
<p><a href="http://blogs.vmware.com/security/wp-content/blogs.dir/26/files/2020/05/shlayer1.png"><img decoding="async" class="wp-image-51040 size-full" src="http://blogs.vmware.com/security/wp-content/blogs.dir/26/files/2020/05/shlayer1.png" alt="" width="922" height="664" /></a><br />
</span></p>
<p><i><span data-contrast="none">Figure </span></i><i><span data-contrast="none">1</span></i><i><span data-contrast="none">: Known Shlayer uploads, past six months</span></i><span data-ccp-props="{&quot;335551550&quot;:2,&quot;335551620&quot;:2,&quot;335559739&quot;:200}"> </span></p>
<p><span data-contrast="none">Although Shlayer samples are continually being generated and uploaded, and we continue to see active infections in the wild, the basic behavioral indicators have not varied much since the initial samples seen in early 2018. </span><span data-contrast="none">Researchers at Kaspersky </span><span data-contrast="none">recently </span><a href="https://securelist.com/shlayer-for-macos/95724/"><span data-contrast="none">posted</span></a><span data-contrast="none"> </span><span data-contrast="none">about a set of samples that were found to exhibit very</span><span data-contrast="none"> </span><span data-contrast="none">similar behavioral patterns </span><span data-contrast="none">to known Shlayer </span><span data-contrast="none">samples.</span><span data-ccp-props="{}"> </span></p>
<p><span data-contrast="none">However,</span><span data-contrast="none"> given the post-infection behavior of these samples, it is unclear whether the same actor set is behind </span><span data-contrast="none">the campaign. Although the basic behavioral</span><span data-contrast="none"> infection chain is the same, the </span><span data-contrast="none">refactoring </span><span data-contrast="none">of infection </span><span data-contrast="none">code with added complexity and use of python rather than basic shell scripts </span><span data-contrast="none">implies the</span><span data-contrast="none"> </span><span data-contrast="none">possibility that a different actor has mimicked the functionality of </span><span data-contrast="none">Shlayer in order to divert attention or attribution.</span><span data-ccp-props="{}"> </span></p>
<p><span data-contrast="none">As with versions </span><span data-contrast="none">of the original variant of Shlayer, many samples </span><a href="https://www.sentinelone.com/blog/scripting-macs-with-malice-how-shlayer-and-other-malware-installers-infect-macos/"><span data-contrast="none">make use of script</span><span data-contrast="none">ing</span></a><span data-contrast="none"> (typically bash or AppleScript) </span><span data-contrast="none">rather than traditional installer packages. </span><span data-contrast="none">These variants </span><span data-contrast="none">still mimic </span><span data-contrast="none">the appearance of traditional </span><span data-contrast="none">application installers</span><span data-contrast="none">, but rather than launching </span><span data-contrast="none">an executable they execute a </span><span data-contrast="none">script that performs the </span><span data-contrast="none">infection. </span><span data-contrast="none">However, as discussed in the Execution section </span><span data-contrast="none">later in this post, these scripts are still subject to the same Gatekeeper and notarization checks </span><span data-contrast="none">performed by macOS </span><span data-contrast="none">as </span><span data-contrast="none">with any </span><span data-contrast="none">other </span><span data-contrast="none">software executed on the machine.</span><span data-ccp-props="{}"> </span></p>
<p><strong>Details </strong></p>
<p><strong>Delivery </strong></p>
<p><span data-contrast="none">As with much of the currently distributed adware, this malware is typically delivered via drive-by advertisements, posing as a fake Adobe Flash or related software updates. Whether you receive the malware or a generic advertisement from the compromised domain depends on your browser’s user-agent string, IP address, and relative last visit. Given this determination, TAU developed a script to rotate through proxies, visit the main advertisement domain (in this example case, dubbeldachs[.]com), follow through all redirects, detect if the site is malicious or not, capture a screenshot + page source + malware payload, and categorize the data. Below is a sample screenshot of this script in action:</span><span data-ccp-props="{&quot;335551550&quot;:6,&quot;335551620&quot;:6}"> </p>
<p><a href="http://blogs.vmware.com/security/wp-content/blogs.dir/26/files/2020/05/shlayer2.png"><img decoding="async" loading="lazy" class="alignnone  wp-image-51042" src="http://blogs.vmware.com/security/wp-content/blogs.dir/26/files/2020/05/shlayer2.png" alt="" width="681" height="677" /></a><br />
</span></p>
<p><i><span data-contrast="none">Figure 2</span></i><i><span data-contrast="none">: Shlayer sample collection script</span></i><span data-ccp-props="{&quot;335551550&quot;:2,&quot;335551620&quot;:2,&quot;335559739&quot;:200}"> </span></p>
<p><span data-contrast="none">Running this script across multiple systems, we were able to capture over 50 unique samples in a matter of hours, all targeted towards macOS. In total at that time, there were well over 5,000 unique hashes confirmed, meaning that banning via hash would be ineffective due to the rate at which binaries are re-compiled or otherwise modified. The following screenshot illustrates a sample delivery site typical of Shlayer (and other adware):</span><span data-ccp-props="{&quot;335551550&quot;:6,&quot;335551620&quot;:6}"> </p>
<p><a href="http://blogs.vmware.com/security/wp-content/blogs.dir/26/files/2020/05/shlayer3.png"><img decoding="async" loading="lazy" class="alignnone size-full wp-image-51044" src="http://blogs.vmware.com/security/wp-content/blogs.dir/26/files/2020/05/shlayer3.png" alt="" width="974" height="550" /></a><br />
</span></p>
<p><i><span data-contrast="none">Figure 3</span></i><i><span data-contrast="none">: Sample Fake Flash Update Site</span></i><span data-ccp-props="{&quot;335551550&quot;:2,&quot;335551620&quot;:2,&quot;335559739&quot;:200}"> </span></p>
<p><span data-contrast="none">In addition to malicious DMG / ISO / PKG downloaders, various redirects contained browser extensions. All infection vectors required user interaction at some level in order to compromise the host, including installation of software packages and authentication.</span><span data-ccp-props="{&quot;335551550&quot;:6,&quot;335551620&quot;:6}"> </p>
<p><a href="http://blogs.vmware.com/security/wp-content/blogs.dir/26/files/2020/05/shlayer4.png"><img decoding="async" loading="lazy" class="alignnone size-full wp-image-51046" src="http://blogs.vmware.com/security/wp-content/blogs.dir/26/files/2020/05/shlayer4.png" alt="" width="974" height="525" /></a><br />
</span></p>
<p><i><span data-contrast="none">Figure 4</span></i><i><span data-contrast="none">: Sample Web Extension Download Site</span></i><span data-ccp-props="{&quot;335551550&quot;:2,&quot;335551620&quot;:2,&quot;335559739&quot;:200}"> </span></p>
<p><span data-contrast="none">Although the distribution sites vary in theme and delivery method, we observed the resulting payload ultimately installed a variant of Shlayer.</span><span data-ccp-props="{&quot;335551550&quot;:6,&quot;335551620&quot;:6}"> </span></p>
<p><strong>Execution  </strong></p>
<p><span data-contrast="none">Samples discovered by TAU have been </span><span data-contrast="none">seen</span><span data-contrast="none"> to affect versions of macOS from 10.10.5 to 10.14.3</span><span data-contrast="none"> as of December 2019</span><span data-contrast="none">. To this point, all discovered samples of this malware have targeted only macOS. The malware employs multiple levels of obfuscation and is capable of privilege escalation. Many of the initial DMGs are signed with a legitimate Apple developer ID and use legitimate system applications via </span><b><span data-contrast="none">bash</span></b><span data-contrast="none"> to conduct all installation activities. Although most samples were DMG files, we also discovered .pkg, .iso, and .zip payloads. The following analysis results reflect execution of a DMG-based payload.</span><span data-ccp-props="{&quot;335551550&quot;:6,&quot;335551620&quot;:6}"> </span></p>
<p><b><span data-contrast="none">Note: </span></b><span data-contrast="none">There are many other samples found by TAU that appear to be variations of this malware, masquerading as pirated software &#8211; these variations </span><span data-contrast="none">may</span><span data-contrast="none"> have different application paths. The paths noted below represent only those </span><span data-contrast="none">of the original variants </span><span data-contrast="none">directly observed and verified by TAU via binary analysis or across our customer base. </span><span data-contrast="none">The samples collected</span><span data-contrast="none"> and analyzed</span><span data-contrast="none"> by TAU </span><span data-contrast="none">that were </span><span data-contrast="none">derived from pirated software </span><span data-contrast="none">have a nearly identical execution chain as </span><span data-contrast="none">the traditional samples described below, with the exception of the command-line arguments to the </span><b><span data-contrast="none">curl </span></b><span data-contrast="none">command</span><span data-contrast="none">: </span><span data-contrast="none">curl -f0L</span><span data-contrast="none"> versus </span><span data-contrast="none">curl -fsL</span><span data-contrast="none">. This is an important distinction for detection, as the </span><span data-contrast="none">&#8211;</span><span data-contrast="none">0</span><span data-contrast="none"> </span><span data-contrast="none">(force http 1.0) </span><span data-contrast="none">argument is not </span><span data-contrast="none">generally</span><span data-contrast="none"> used legitimately, whereas</span><span data-contrast="none"> usage of</span><span data-contrast="none"> </span><span data-contrast="none">&#8211;</span><span data-contrast="none">s</span><span data-contrast="none"> (silent) and </span><span data-contrast="none">&#8211;</span><span data-contrast="none">S</span><span data-contrast="none"> (show</span><span data-contrast="none"> </span><span data-contrast="none">error</span><span data-contrast="none">s</span><span data-contrast="none">)</span><span data-contrast="none"> </span><span data-contrast="none">is</span><span data-contrast="none"> </span><span data-contrast="none">more common. </span><span data-ccp-props="{}"> </span></p>
<p><span data-contrast="none">The following represents a high-level overview of the process execution and infection chain for a typical Shlayer installation:</span><span data-ccp-props="{}"> </p>
<p><a href="http://blogs.vmware.com/security/wp-content/blogs.dir/26/files/2020/05/shlayer5.png"><img decoding="async" loading="lazy" class="alignnone size-full wp-image-51048" src="http://blogs.vmware.com/security/wp-content/blogs.dir/26/files/2020/05/shlayer5.png" alt="" width="974" height="435" /></a><br />
</span></p>
<p><i><span data-contrast="none">Figure 5</span></i><i><span data-contrast="none">: Shlayer Infection Chain</span></i><span data-ccp-props="{&quot;335551550&quot;:2,&quot;335551620&quot;:2,&quot;335559739&quot;:200}"> </span></p>
<p><span data-contrast="none">As referenced in the Delivery section above, many Shlayer infections are distributed as fake Adobe Flash Player updates from a compromised site, often packaged as a DMG file. The downloaded installer is designed to look like a legitimate installation to trick the user into authenticating with their password to continue the second stage infection such as the screenshot below:</span><span data-ccp-props="{&quot;335551550&quot;:6,&quot;335551620&quot;:6}"> </p>
<p><a href="http://blogs.vmware.com/security/wp-content/blogs.dir/26/files/2020/05/shlayer6.png"><img decoding="async" loading="lazy" class="alignnone size-full wp-image-51050" src="http://blogs.vmware.com/security/wp-content/blogs.dir/26/files/2020/05/shlayer6.png" alt="" width="727" height="554" /></a><br />
</span></p>
<p><i><span data-contrast="none">Figure 6</span></i><i><span data-contrast="none">: Fake Flash Update Installer</span></i><span data-ccp-props="{&quot;335551550&quot;:2,&quot;335551620&quot;:2,&quot;335559739&quot;:200}"> </span></p>
<p><span data-contrast="none">When </span><span data-contrast="none">this</span><span data-contrast="none"> DMG is mounted and the installer executed, a </span><b><span data-contrast="none">.command</span></b><span data-contrast="none"> script is executed from a hidden directory in the mounted volume. This script base64 decodes and AES decrypts a second script containing an additional encoded script that is subsequently executed. A sample </span><b><span data-contrast="none">.command</span></b><span data-contrast="none"> script is shown in Figure 2 below, along with the two subsequent decoded/decrypted scripts. </span><span data-contrast="none">Although the format and </span><span data-contrast="none">sequence of these scripts vary among samples, the basic overall</span><span data-contrast="none"> </span><span data-contrast="none"> execution chain remains the same.</span><span data-ccp-props="{&quot;335551550&quot;:6,&quot;335551620&quot;:6}"> </p>
<p><a href="http://blogs.vmware.com/security/wp-content/blogs.dir/26/files/2020/05/shlayer7.png"><img decoding="async" loading="lazy" class="alignnone size-full wp-image-51052" src="http://blogs.vmware.com/security/wp-content/blogs.dir/26/files/2020/05/shlayer7.png" alt="" width="974" height="287" /></a><br />
</span></p>
<p><i><span data-contrast="none">Figure 7</span></i><i><span data-contrast="none">: </span></i><i><span data-contrast="none">Installer .command script (truncated)</span></i><span data-ccp-props="{&quot;335551550&quot;:2,&quot;335551620&quot;:2,&quot;335559739&quot;:200}"> </span></p>
<p><span data-contrast="none">The second script below uses the system utilities </span><b><span data-contrast="none">xxd </span></b><span data-contrast="none">and </span><b><span data-contrast="none">base64</span></b><span data-contrast="none"> to decode a third script which ultimately performs the download of the second stage payload and initializes the final installation activity.</span><span data-ccp-props="{&quot;335551550&quot;:6,&quot;335551620&quot;:6}"> </span></p>
<p><a href="http://blogs.vmware.com/security/wp-content/blogs.dir/26/files/2020/05/shlayer8.png"><img decoding="async" loading="lazy" class="alignnone size-full wp-image-51054" src="http://blogs.vmware.com/security/wp-content/blogs.dir/26/files/2020/05/shlayer8.png" alt="" width="974" height="829" /></a></p>
<p><i><span data-contrast="none">Figure 8</span></i><i><span data-contrast="none">: </span></i><i><span data-contrast="none">Decoded/Decrypted script from initial .command script</span></i><span data-ccp-props="{&quot;335551550&quot;:2,&quot;335551620&quot;:2,&quot;335559739&quot;:200}"> </span></p>
<p><a href="http://blogs.vmware.com/security/wp-content/blogs.dir/26/files/2020/05/shlayer9.png"><img decoding="async" loading="lazy" class="alignnone size-full wp-image-51056" src="http://blogs.vmware.com/security/wp-content/blogs.dir/26/files/2020/05/shlayer9.png" alt="" width="974" height="668" /></a></p>
<p><i><span data-contrast="none">Figure 9</span></i><i><span data-contrast="none">: </span></i><i><span data-contrast="none">Final decoded script in first stage infection</span></i><span data-ccp-props="{&quot;335551550&quot;:2,&quot;335551620&quot;:2,&quot;335559739&quot;:200}"> </span></p>
<p><span data-contrast="none">The decoded script in Figure 4 above represents the final steps of the first stage of this infection, performing the following after identifying the script location (e.g. /Volumes/Player/.hidden) and performing a verification check:</span><span data-ccp-props="{&quot;335551550&quot;:6,&quot;335551620&quot;:6}"> </span></p>
<ol>
<li><span data-contrast="none">Collects system information such as the macOS version and IOPlatformUUID (a unique identifier for the system)
<p></span></li>
<li>Generates a “Session GUID” using <b><span data-contrast="none">uuidgen
<p></span></b></li>
<li>Creates a custom URL using the information generated in the previous two steps and downloads the second stage payload. For example: <span data-ccp-props="{&quot;335551550&quot;:6,&quot;335551620&quot;:6}"> </span></li>
</ol>
<table border="1" cellspacing="7" cellpadding="7" data-tablestyle="MsoNormalTable" data-tablelook="1184">
<tbody>
<tr>
<td colspan="3" data-celllook="69905">
<p><strong>Sample URL: </strong></p>
</td>
</tr>
<tr>
<td colspan="3" data-celllook="4369">
<p><span data-contrast="none">hxxp://api.resultsformat[.]com/sd/?</span><span data-contrast="none">c=</span><span data-contrast="none">C2NybQ</span><span data-contrast="none">==&amp;</span><span data-contrast="none">u=</span><span data-contrast="none">$machine_id</span><span data-contrast="none">&amp;</span><span data-contrast="none">s=</span><span data-contrast="none">$session_guid</span><span data-contrast="none">&amp;</span><span data-contrast="none">o=</span><span data-contrast="none">$os_version</span><span data-contrast="none">&amp;</span><span data-contrast="none">b=</span><span data-contrast="none">5831030393</span><span data-ccp-props="{}"> </span></p>
</td>
</tr>
<tr>
<td data-celllook="69905">
<p><span data-contrast="none">Identifier</span><span data-ccp-props="{}"> </span></p>
</td>
<td data-celllook="69905">
<p><span data-contrast="none">Sample Data</span><span data-ccp-props="{}"> </span></p>
</td>
<td data-celllook="69905">
<p><span data-contrast="none">Description</span><span data-ccp-props="{}"> </span></p>
</td>
</tr>
<tr>
<td data-celllook="4369">
<p><span data-contrast="none">c=</span><span data-ccp-props="{}"> </span></p>
</td>
<td data-celllook="4369">
<p><span data-contrast="none">C2NybQ</span><span data-ccp-props="{}"> </span></p>
</td>
<td data-celllook="4369">
<p><span data-contrast="none">Possible Campaign Identifier</span><span data-ccp-props="{}"> </span></p>
</td>
</tr>
<tr>
<td data-celllook="4369">
<p><span data-contrast="none">u=</span><span data-ccp-props="{}"> </span></p>
</td>
<td data-celllook="4369">
<p><span data-contrast="none">564DB6C2-671E-6AE7-E4D2-D7C3B281EF34</span><span data-ccp-props="{}"> </span></p>
</td>
<td data-celllook="4369">
<p><span data-contrast="none">Unique ID for victim system based on IOPlatformUUID</span><span data-ccp-props="{}"> </span></p>
</td>
</tr>
<tr>
<td data-celllook="4369">
<p><span data-contrast="none">s=</span><span data-ccp-props="{}"> </span></p>
</td>
<td data-celllook="4369">
<p><span data-contrast="none">E7B274DC-2E66-45B1-A57B-29865A3DE435</span><span data-ccp-props="{}"> </span></p>
</td>
<td data-celllook="4369">
<p><span data-contrast="none">Session ID from </span><b><span data-contrast="none">uuidgen</span></b><span data-ccp-props="{}"> </span></p>
</td>
</tr>
<tr>
<td data-celllook="4369">
<p><span data-contrast="none">o=</span><span data-ccp-props="{}"> </span></p>
</td>
<td data-celllook="4369">
<p><span data-contrast="none">10.12.5</span><span data-ccp-props="{}"> </span></p>
</td>
<td data-celllook="4369">
<p><span data-contrast="none">macOS version</span><span data-ccp-props="{}"> </span></p>
</td>
</tr>
<tr>
<td data-celllook="4369">
<p><span data-contrast="none">b=</span><span data-ccp-props="{}"> </span></p>
</td>
<td data-celllook="4369">
<p><span data-contrast="none">5831030393</span><span data-ccp-props="{}"> </span></p>
</td>
<td data-celllook="4369">
<p><span data-contrast="none">Unknown identifier, hardcoded per sample</span><span data-ccp-props="{}"> </span></p>
</td>
</tr>
</tbody>
</table>
<p><span data-contrast="none">4.  Attempts to download the zip file payload using </span><b><span data-contrast="none">curl</span></b><b><span data-contrast="none"> </span></b><span data-contrast="none">(</span><span data-contrast="none">with arguments of </span><span data-contrast="none">either </span><span data-contrast="none">“</span><span data-contrast="none">-f0L</span><span data-contrast="none">”</span><span data-contrast="none"> or</span><span data-contrast="none"> </span><span data-contrast="none">“</span><span data-contrast="none">&#8211;</span><span data-contrast="none">fs</span><span data-contrast="none">L</span><span data-contrast="none">”</span><span data-contrast="none"> as mentioned above)</span></p>
<p><span data-contrast="none">5. </span>Creates a directory in <b><span data-contrast="none">/tmp</span></b><span data-contrast="none"> to store the payload and unzips the password-protected payload (note: the zip password is hardcoded in the script per sample)</span></p>
<p><span data-contrast="none">6. </span><span data-contrast="none">Makes the binary within the unzipped </span><b><span data-contrast="none">.app </span></b><span data-contrast="none">executable using </span><b><span data-contrast="none">chmod +x</p>
<p></span></b><span data-contrast="none">7. Executes the payload using </span><b><span data-contrast="none">open </span></b><span data-contrast="none">with the passed arguments &#8220;s&#8221; &#8220;$session_guid&#8221; and &#8220;$volume_name&#8221; as in the example below:</span><span data-ccp-props="{&quot;134233279&quot;:true,&quot;335551550&quot;:6,&quot;335551620&quot;:6}"> </span></p>
<table style="width: 100%;border-collapse: collapse" border="1" cellspacing="7" cellpadding="7">
<tbody>
<tr>
<td style="width: 100%"><span data-contrast="none">open -a /tmp/dTpyJRei/Player.app &#8211;args s 141CE8F5-BA78-4EA8-A941-933A076BA0EN /Volumes/Player/</span><span data-ccp-props="{}"> </span></td>
</tr>
</tbody>
</table>
<p><span data-contrast="none">8. Performs a </span><b><span data-contrast="none">killall Terminal </span></b><span data-contrast="none">to kill the running script’s terminal window</span><span data-ccp-props="{&quot;335551550&quot;:6,&quot;335551620&quot;:6}"> </span></p>
<p><span data-contrast="none">After the second stage payload is downloaded and executed, it attempts to escalate privileges with </span><b><span data-contrast="none">sudo </span></b><span data-contrast="none">using a technique invoking </span><b><span data-contrast="none">/usr/libexec/security_authtrampoline</span></b><span data-contrast="none"> as discussed in Patrick Wardle’s DEFCON 2017 talk “</span><a href="https://speakerdeck.com/patrickwardle/defcon-2017-death-by-1000-installers-its-all-broken?slide=8"><span data-contrast="none">Death by 1000 Installers</span></a><span data-contrast="none">” and now documented under </span><a href="https://attack.mitre.org/techniques/T1514/"><span data-contrast="none">MITRE ATT&amp;CK TID 1514</span></a><span data-contrast="none"> (Elevated Execution with Prompt)</span><span data-contrast="none">1</span><span data-contrast="none">. Once the malware has elevated to root privileges, it attempts to download additional software (observed to be adware in the analyzed samples) and bypasses Gatekeeper for the downloaded software. This allows the allowlisted software to run without user intervention even if the system is set to disallow unknown applications downloaded from the internet. Furthermore, many of the payloads contained within the second stage download are signed with a valid developer ID as seen in red in the screenshot below:</span><span data-ccp-props="{&quot;335551550&quot;:6,&quot;335551620&quot;:6}"> </span></p>
<p><a href="http://blogs.vmware.com/security/wp-content/blogs.dir/26/files/2020/05/shlayer10.png"><img decoding="async" loading="lazy" class="alignnone size-full wp-image-51058" src="http://blogs.vmware.com/security/wp-content/blogs.dir/26/files/2020/05/shlayer10.png" alt="" width="974" height="79" /></a></p>
<p><i><span data-contrast="none">Figure </span></i><i><span data-contrast="none">10</span></i><i><span data-contrast="none">: </span></i><i><span data-contrast="none">Sample Shlayer Developer ID</span></i><span data-ccp-props="{&quot;335551550&quot;:2,&quot;335551620&quot;:2,&quot;335559739&quot;:200}"> </span></p>
<p><span data-contrast="none">Apple </span><a href="https://developer.apple.com/developer-id/"><span data-contrast="none">Developer IDs</span></a><span data-contrast="none"> are used to digitally sign applications with a certificate which is used by </span><a href="https://support.apple.com/en-us/HT202491"><span data-contrast="none">Gatekeeper</span></a><span data-contrast="none"> on macOS as a first step in validation of a binary for safety. When a program is downloaded from the internet, Gatekeeper runs a check to see if the if the package or application is signed, and if it is signed with a known and trusted developer ID. Although some of this process has changed with the introduction of </span><a href="https://developer.apple.com/documentation/security/notarizing_your_app_before_distribution"><span data-contrast="none">notarization</span></a><span data-contrast="none"> in macOS Mojave version 10.14.5, in previous versions a dialog such as the following would be displayed when opening an application that was not installed from the App Store:</span><span data-ccp-props="{&quot;335551550&quot;:6,&quot;335551620&quot;:6}"> </span></p>
<p><a href="http://blogs.vmware.com/security/wp-content/blogs.dir/26/files/2020/05/shlayer11.png"><img decoding="async" loading="lazy" class="alignnone  wp-image-51060" src="http://blogs.vmware.com/security/wp-content/blogs.dir/26/files/2020/05/shlayer11.png" alt="" width="690" height="323" /></a></p>
<p><i><span data-contrast="none">Figure </span></i><i><span data-contrast="none">11</span></i><i><span data-contrast="none">: Sample Gatekeeper warning dialog</span></i><span data-ccp-props="{&quot;335551550&quot;:2,&quot;335551620&quot;:2,&quot;335559739&quot;:200}"> </span></p>
<p><span data-contrast="none">If we examine one of the first stage Shlayer DMG packages, we can see that the initial executable that is launched by the installer is signed by a valid Apple Developer ID (in the case illustrated below, </span><b><span data-contrast="none">Brianna Sanchez</span></b><span data-contrast="none">). Because this is a valid developer certificate issued by Apple, Gatekeeper will allow this software to run without prompt. As Apple Developer accounts have previously been fairly easy to register (just requiring an Apple ID and $99 yearly fee), almost anyone could create an application with a valid certificate. Since the time of our first reporting earlier </span><span data-contrast="none">last</span><span data-contrast="none"> year however, Apple introduced additional security measures to both the registration of developer IDs as well as the execution of kernel extensions. As of February 27th 2019, two-factor authentication (2FA) is required for the main holder of a team’s Apple Developer account to sign in with their Apple ID, creating an additional layer of security for the creation of certificates. This is significant as Apple’s form of two-factor authentication varies from typical 2FA systems which just require a verification code from an email or SMS message. Validity of an application&#8217;s certificate can be verified using the </span><b><span data-contrast="none">spctl </span></b><span data-contrast="none">or </span><b><span data-contrast="none">codesign </span></b><span data-contrast="none">commands as seen below:</span><span data-ccp-props="{&quot;335551550&quot;:6,&quot;335551620&quot;:6}"> </p>
<p><a href="http://blogs.vmware.com/security/wp-content/blogs.dir/26/files/2020/05/13-2.jpg"><img decoding="async" loading="lazy" class="alignnone size-full wp-image-51073" src="http://blogs.vmware.com/security/wp-content/blogs.dir/26/files/2020/05/13-2.jpg" alt="" width="780" height="590" /></a><br />
</span></p>
<p>&nbsp;</p>
<p><i><span data-contrast="none">Figure </span></i><i><span data-contrast="none">12</span></i><i><span data-contrast="none">: Command line certificate validation</span></i><span data-ccp-props="{&quot;335551550&quot;:2,&quot;335551620&quot;:2,&quot;335559739&quot;:200}"> </span></p>
<p><span data-contrast="none">During our initial tracking of Shlayer, we started to run down all the “fake” developer IDs but soon realized that they were clearly being randomly generated and at a surprising rate &#8211; below is a very small sample out of many of the initial IDs we collected:</span><span data-ccp-props="{&quot;335551550&quot;:6,&quot;335551620&quot;:6}"> </span></p>
<table border="1" cellspacing="7" cellpadding="7" data-tablestyle="MsoNormalTable" data-tablelook="1184">
<tbody>
<tr>
<td data-celllook="4369">
<p><span data-contrast="none">Sanchez Scarlett</span><span data-ccp-props="{}"> </span></p>
<p><span data-contrast="none">Nichols Carson</span><span data-ccp-props="{}"> </span></p>
<p><span data-contrast="none">Clement Dana</span><span data-ccp-props="{}"> </span></p>
<p><span data-contrast="none">Jasper Osmund</span><span data-ccp-props="{}"> </span></p>
<p><span data-contrast="none">Rios Becky</span><span data-ccp-props="{}"> </span></p>
<p><span data-contrast="none">Simmons Brianna</span><span data-ccp-props="{}"> </span></p>
<p><span data-contrast="none">Fergus Basil</span><span data-ccp-props="{}"> </span></p>
<p><span data-contrast="none">Beatrix Hilary</span><span data-ccp-props="{}"> </span></p>
</td>
<td data-celllook="4369">
<p><span data-contrast="none">Andrews Declan</span><span data-ccp-props="{}"> </span></p>
<p><span data-contrast="none">Raymond Amanda</span><span data-ccp-props="{}"> </span></p>
<p><span data-contrast="none">Arnold Eleanor</span><span data-ccp-props="{}"> </span></p>
<p><span data-contrast="none">Blanche Augusta</span><span data-ccp-props="{}"> </span></p>
<p><span data-contrast="none">Bennett Marvin</span><span data-ccp-props="{}"> </span></p>
<p><span data-contrast="none">Janson Chase</span><span data-ccp-props="{}"> </span></p>
<p><span data-contrast="none">Leighton Ganesa</span><span data-ccp-props="{}"> </span></p>
<p><span data-contrast="none">Mendez Melody</span><span data-ccp-props="{}"> </span></p>
</td>
</tr>
</tbody>
</table>
<p><i><span data-contrast="none">Figure </span></i><i><span data-contrast="none">13</span></i><i><span data-contrast="none">: Sample Shlayer Developer IDs</span></i><span data-ccp-props="{&quot;335551550&quot;:2,&quot;335551620&quot;:2,&quot;335559739&quot;:200}"> </span></p>
<p><span data-contrast="none">However, unlike files downloaded from a web browser, when a file is downloaded via the command line utility </span><b><span data-contrast="none">curl</span></b><span data-contrast="none">, the quarantine attribute flag required for Gatekeeper’s check is not added to the file. This allows the script above to download, unzip, and execute the Shlayer application without warning, bypassing Gatekeeper. This means that if the first stage is able to execute, the second stage script is likely to run without further prompt to the user after initial authentication. </span><span data-ccp-props="{&quot;335551550&quot;:6,&quot;335551620&quot;:6}"> </span></p>
<p><span data-contrast="none">Newer samples of Shlayer have been observed to perform a check for the validity of the Apple signature using </span><b><span data-contrast="none">spctl</span></b><span data-contrast="none"> before execution of the final payload. If the signature has been revoked, the software will exit regardless of whether Gatekeeper has been successfully bypassed. </span><span data-ccp-props="{&quot;335551550&quot;:6,&quot;335551620&quot;:6}"> </span></p>
<p><a href="http://blogs.vmware.com/security/wp-content/blogs.dir/26/files/2020/05/shlayer12.png"><img decoding="async" loading="lazy" class="alignnone size-full wp-image-51062" src="http://blogs.vmware.com/security/wp-content/blogs.dir/26/files/2020/05/shlayer12.png" alt="" width="974" height="150" /></a></p>
<p><i><span data-contrast="none">Figure </span></i><i><span data-contrast="none">14</span></i><i><span data-contrast="none">: Gatekeeper check via spctl</span></i><span data-ccp-props="{&quot;335551550&quot;:2,&quot;335551620&quot;:2,&quot;335559739&quot;:200}"> </span></p>
<p><span data-contrast="none">Apple has been revoking these falsely created certificates for Shlayer and other common malware quickly, cutting their effective time in the wild as legitimate applications very short. Furthermore, there have been several changes to the security of the Apple Developer program with the introduction of notarization in macOS 10.14.5. As of this writing, TAU has not discovered any samples of Shlayer that have been notarized, and it is highly unlikely we will</span><span data-contrast="none"> be</span><span data-contrast="none"> given the stringent build requirements under the new system. We continue to monitor this threat however and will provide updates should anything change. The status of a notarized application can be verified using the XCode command line tool </span><b><span data-contrast="none">stapler </span></b><span data-contrast="none">with the </span><b><span data-contrast="none">validate </span></b><span data-contrast="none">parameter as seen below &#8211; this command will return &#8220;The validate action worked!&#8221; for a valid notarized app, but will return nothing if the app has not been notarized.</span><span data-ccp-props="{&quot;335551550&quot;:6,&quot;335551620&quot;:6}"> </span></p>
<p><a href="http://blogs.vmware.com/security/wp-content/blogs.dir/26/files/2020/05/14-1.jpg"><img decoding="async" loading="lazy" class="alignnone size-full wp-image-51075" src="http://blogs.vmware.com/security/wp-content/blogs.dir/26/files/2020/05/14-1.jpg" alt="" width="787" height="71" /></a></p>
<p><span data-contrast="none">Due to the number of known IOCs for this malware, hash-based prevention is extremely ineffective for this campaign as executables are being frequently modified and recompiled. As of today, there are thousands of unique known samples and the list continues to grow. Because of this, we recommend detection and monitoring strategies based around behavioral indicators rather than hash- or other IOC-based indicators. For example, the execution of system utilities </span><b><span data-contrast="none">xxd</span></b><span data-contrast="none">, </span><b><span data-contrast="none">base64</span></b><span data-contrast="none">, </span><b><span data-contrast="none">openssl</span></b><span data-contrast="none">, </span><b><span data-contrast="none">curl</span></b><span data-contrast="none">, and </span><b><span data-contrast="none">unzip</span></b><span data-contrast="none"> may be common in a typical development environment in isolation, but when seen in succession indicate Shlayer installation activity with high fidelity in our observation. This succession of activity can be seen in the sequence of screenshots below which show the execution of the final script in the first stage, using </span><b><span data-contrast="none">bash </span></b><span data-contrast="none">along with the system utilities described above to download and execute the second stage payload.</span><b><span data-contrast="none"> </span></b><span data-ccp-props="{&quot;335551550&quot;:6,&quot;335551620&quot;:6}"> </p>
<p><a href="http://blogs.vmware.com/security/wp-content/blogs.dir/26/files/2020/05/shlayer13.png"><img decoding="async" loading="lazy" class="alignnone size-full wp-image-51064" src="http://blogs.vmware.com/security/wp-content/blogs.dir/26/files/2020/05/shlayer13.png" alt="" width="974" height="375" /></a><br />
</span></p>
<p><i><span data-contrast="none">Figure </span></i><i><span data-contrast="none">15</span></i><i><span data-contrast="none">:</span></i><i><span data-contrast="none"> Sample Shlayer first stage installation</span></i><span data-ccp-props="{&quot;335551550&quot;:2,&quot;335551620&quot;:2,&quot;335559739&quot;:200}"> </p>
<p><a href="http://blogs.vmware.com/security/wp-content/blogs.dir/26/files/2020/05/shlayer14.png"><img decoding="async" loading="lazy" class="alignnone size-full wp-image-51066" src="http://blogs.vmware.com/security/wp-content/blogs.dir/26/files/2020/05/shlayer14.png" alt="" width="974" height="360" /></a><br />
</span></p>
<p><i><span data-contrast="none">Figure </span></i><i><span data-contrast="none">16</span></i><i><span data-contrast="none">: </span></i><i><span data-contrast="none">Process tree &#8211; initial Shlayer infection</span></i><span data-ccp-props="{&quot;335551550&quot;:2,&quot;335551620&quot;:2,&quot;335559739&quot;:200}"> </p>
<p><a href="http://blogs.vmware.com/security/wp-content/blogs.dir/26/files/2020/05/shlayer15.png"><img decoding="async" loading="lazy" class="alignnone size-full wp-image-51068" src="http://blogs.vmware.com/security/wp-content/blogs.dir/26/files/2020/05/shlayer15.png" alt="" width="974" height="293" /></a><br />
</span></p>
<p><i><span data-contrast="none">Figure </span></i><i><span data-contrast="none">17</span></i><i><span data-contrast="none">: </span></i><i><span data-contrast="none">Child Processes of bash indicative of Shlayer infection</span></i><span data-ccp-props="{&quot;335551550&quot;:2,&quot;335551620&quot;:2,&quot;335559739&quot;:200}"> </span></p>
<p><span data-contrast="none">After the second stage malware downloaded by </span><b><span data-contrast="none">curl </span></b><span data-contrast="none">has been entrenched and gained root access, it is able to then download and install additional software as seen in the process tree below:</span><span data-ccp-props="{}"> </p>
<p><a href="http://blogs.vmware.com/security/wp-content/blogs.dir/26/files/2020/05/shlayer16.png"><img decoding="async" loading="lazy" class="alignnone size-full wp-image-51070" src="http://blogs.vmware.com/security/wp-content/blogs.dir/26/files/2020/05/shlayer16.png" alt="" width="974" height="675" /></a><br />
</span></p>
<p><i><span data-contrast="none">Figure </span></i><i><span data-contrast="none">18</span></i><i><span data-contrast="none">: </span></i><i><span data-contrast="none">Sample Process tree for adware installed by Shlayer</span></i><span data-ccp-props="{&quot;335551550&quot;:2,&quot;335551620&quot;:2,&quot;335559739&quot;:200}"> </span></p>
<p><span data-contrast="none">This illustrates the true danger of Shlayer: although it is considered Adware, and therefore often dismissed as a lower threat, successful infections of this malware result in the entrenchment of a backdoor that allows for the installation of any software as the root user. Even though we know of no known cases of Shlayer installing any software more nefarious than additional adware or cryptominers, it has the ability to install rootkits or other more serious threats once entrenched. Furthermore, while the analyzed samples above do not attempt to conceal their network activity, newer samples have been </span><a href="https://blog.confiant.com/osx-shlayer-new-shurprise-unveiling-osx-tarmac-f965a32de887"><span data-contrast="none">reported</span></a><span data-contrast="none"> to use further obfuscation of payloads and encryption of network traffic. Despite these changes however, the ability to detect the early-stage behavioral indicators of this malware can easily prevent infection and protect the organization. </span><span data-ccp-props="{}"> </span></p>
<p><span data-contrast="none">For more information on how Carbon Black’s products protect from these threats, please see the Shlayer </span><a href="https://community.carbonblack.com/t5/Threat-Research-Docs/TAU-TIN-Shlayer-OSX/ta-p/66839"><span data-contrast="none">TAU-TIN</span></a><span data-contrast="none"> on our user exchange.</span><span data-ccp-props="{}"> </span></p>
<p><span data-contrast="none">MITRE ATT&amp;CK TIDs</span><span data-ccp-props="{&quot;335559738&quot;:360,&quot;335559739&quot;:120}"> </span></p>
<table border="1" cellspacing="7" cellpadding="7" data-tablestyle="MsoNormalTable" data-tablelook="1184">
<tbody>
<tr>
<td data-celllook="69905">
<p><span data-contrast="none">TID</span><span data-ccp-props="{}"> </span></p>
</td>
<td data-celllook="69905">
<p><span data-contrast="none">Tactic</span><span data-ccp-props="{}"> </span></p>
</td>
<td data-celllook="69905">
<p><span data-contrast="none">Description</span><span data-ccp-props="{}"> </span></p>
</td>
</tr>
<tr>
<td data-celllook="4369">
<p><a href="https://attack.mitre.org/techniques/T1204"><span data-contrast="none">T1204</span></a><span data-ccp-props="{}"> </span></p>
</td>
<td data-celllook="4369">
<p><span data-contrast="none">Execution</span><span data-ccp-props="{}"> </span></p>
</td>
<td data-celllook="4369">
<p><span data-contrast="none">User Execution &#8211; first stage payload execution</span><span data-ccp-props="{}"> </span></p>
</td>
</tr>
<tr>
<td data-celllook="4369">
<p><a href="https://attack.mitre.org/techniques/T1514/"><span data-contrast="none">T1514</span></a><span data-ccp-props="{}"> </span></p>
</td>
<td data-celllook="4369">
<p><span data-contrast="none">Privilege Escalation</span><span data-ccp-props="{}"> </span></p>
</td>
<td data-celllook="4369">
<p><span data-contrast="none">Elevated Execution with Prompt</span><span data-ccp-props="{}"> </span></p>
</td>
</tr>
<tr>
<td data-celllook="4369">
<p><a href="https://attack.mitre.org/techniques/T1158"><span data-contrast="none">T1158</span></a><span data-ccp-props="{}"> </span></p>
</td>
<td data-celllook="4369">
<p><span data-contrast="none">Defense Evasion</span><span data-ccp-props="{}"> </span></p>
</td>
<td data-celllook="4369">
<p><span data-contrast="none">Hidden Directory &#8211; first stage payload execution</span><span data-ccp-props="{}"> </span></p>
</td>
</tr>
<tr>
<td data-celllook="4369">
<p><a href="https://attack.mitre.org/techniques/T1140/"><span data-contrast="none">T1140</span></a><span data-contrast="none"> / </span><a href="https://attack.mitre.org/techniques/T1027/"><span data-contrast="none">T1027</span></a><span data-ccp-props="{}"> </span></p>
</td>
<td data-celllook="4369">
<p><span data-contrast="none">Defense Evasion</span><span data-ccp-props="{}"> </span></p>
</td>
<td data-celllook="4369">
<p><span data-contrast="none">Data Deobfuscation</span><span data-ccp-props="{}"> </span></p>
</td>
</tr>
<tr>
<td data-celllook="4369">
<p><a href="https://attack.mitre.org/techniques/T1142/"><span data-contrast="none">T1142</span></a><span data-ccp-props="{}"> </span></p>
</td>
<td data-celllook="4369">
<p><span data-contrast="none">Credential Access</span><span data-ccp-props="{}"> </span></p>
</td>
<td data-celllook="4369">
<p><span data-contrast="none">Keychain access </span><span data-ccp-props="{}"> </span></p>
</td>
</tr>
<tr>
<td data-celllook="4369">
<p><a href="https://attack.mitre.org/techniques/T1082/"><span data-contrast="none">T1082</span></a><span data-ccp-props="{}"> </span></p>
</td>
<td data-celllook="4369">
<p><span data-contrast="none">Discovery</span><span data-ccp-props="{}"> </span></p>
</td>
<td data-celllook="4369">
<p><span data-contrast="none">System Profiling (OS version, UUID)</span><span data-ccp-props="{}"> </span></p>
</td>
</tr>
</tbody>
</table>
<p>&nbsp;</p>            </div>
            <footer class="entry-footer">
                      </footer>
          </div>
        </div>
      </div>
    </div>
      <div class="container related-posts">
    <div class="row">
      <div class="col-12">
        <h2 class="mt-4 mb-3">Related Articles</h2>
      </div>
    </div>
    <div class="row">
       
        <div class="col-12 col-md-4 stacked-posts category-curl">
        
<article class="card post-59050 post type-post status-publish format-standard has-post-thumbnail hentry category-threat-analysis-unit tag-shlayer tag-threat-research tag-vmware tag-vmware-carbon-black">
  <div class="image-wrap">
    <a href="https://blogs.vmware.com/security/2023/11/netsupport-rat-the-rat-king-returns.html" title="NetSupport RAT: The RAT King Returns">
      <img src="https://blogs.vmware.com/security/files/2022/03/Malware_Featured-410x222.png" alt="NetSupport RAT: The RAT King Returns" class="" />
    </a>
              </div>
  <div class="content-wrap">
    <div class="content-inner">
                        <a href="https://blogs.vmware.com/security/misc" class="category-label">Misc</a>
                    <h2 class="title"><a href="https://blogs.vmware.com/security/2023/11/netsupport-rat-the-rat-king-returns.html">NetSupport RAT: The RAT King Returns</a></h2>
      <div class="entry-meta">
            <span class="author-list">
                                            <a href="https://blogs.vmware.com/security/author/ango" rel="author" class="author">Alan Ngo</a>,                         <a href="https://blogs.vmware.com/security/author/aschneider" rel="author" class="author">Abe Schneider</a>,                         <a href="https://blogs.vmware.com/security/author/fcarlisle1" rel="author" class="author">Fae Carlisle</a>                                        </span>
                <time class="updated" datetime="2023-11-20" pubdate>November 20, 2023</time>
        <span class="read-time">18 min read</span>
    </div>    </div>
  </div>
</article>
        </div>
       
        <div class="col-12 col-md-4 stacked-posts category-curl">
        
<article class="card post-59050 post type-post status-publish format-standard has-post-thumbnail hentry category-threat-analysis-unit tag-shlayer tag-threat-research tag-vmware tag-vmware-carbon-black">
  <div class="image-wrap">
    <a href="https://blogs.vmware.com/security/2023/11/jupyter-rising-an-update-on-jupyter-infostealer.html" title="Jupyter Rising: An Update on Jupyter Infostealer">
      <img src="https://blogs.vmware.com/security/files/2022/03/Malware_Featured-410x222.png" alt="Jupyter Rising: An Update on Jupyter Infostealer" class="" />
    </a>
              </div>
  <div class="content-wrap">
    <div class="content-inner">
                        <a href="https://blogs.vmware.com/security/misc" class="category-label">Misc</a>
                    <h2 class="title"><a href="https://blogs.vmware.com/security/2023/11/jupyter-rising-an-update-on-jupyter-infostealer.html">Jupyter Rising: An Update on Jupyter Infostealer</a></h2>
      <div class="entry-meta">
            <span class="author-list">
                                            <a href="https://blogs.vmware.com/security/author/swee-lai-lee" rel="author" class="author">Swee Lai Lee</a>,                         <a href="https://blogs.vmware.com/security/author/bbeathley" rel="author" class="author">Bria Beathley</a>,                         <a href="https://blogs.vmware.com/security/author/aschneider" rel="author" class="author">Abe Schneider</a>,                         <a href="https://blogs.vmware.com/security/author/ango" rel="author" class="author">Alan N</a>                        <a href="https://blogs.vmware.com/security/author/smcknight" rel="author" class="author"></a>                                        <span class="tooltip-trigger">...
                    <span class="tooltip">Swee Lai Lee, Bria Beathley, Abe Schneider, Alan Ngo, Sean McKnight</span>
                </span>
                            </span>
                <time class="updated" datetime="2023-11-06" pubdate>November 6, 2023</time>
        <span class="read-time">18 min read</span>
    </div>    </div>
  </div>
</article>
        </div>
       
        <div class="col-12 col-md-4 stacked-posts category-curl">
        
<article class="card post-59050 post type-post status-publish format-standard has-post-thumbnail hentry category-threat-analysis-unit tag-shlayer tag-threat-research tag-vmware tag-vmware-carbon-black">
  <div class="image-wrap">
    <a href="https://blogs.vmware.com/security/2023/10/hunting-vulnerable-kernel-drivers.html" title="Hunting Vulnerable Kernel Drivers">
      <img src="https://blogs.vmware.com/security/files/2022/05/Threat-Analysis-Unit_410x222.png" alt="Hunting Vulnerable Kernel Drivers" class="" />
    </a>
              </div>
  <div class="content-wrap">
    <div class="content-inner">
                        <a href="https://blogs.vmware.com/security/misc" class="category-label">Misc</a>
                    <h2 class="title"><a href="https://blogs.vmware.com/security/2023/10/hunting-vulnerable-kernel-drivers.html">Hunting Vulnerable Kernel Drivers</a></h2>
      <div class="entry-meta">
            <span class="author-list">
                                    <a href="https://blogs.vmware.com/security/author/takahiro-haruyama" rel="author" class="author">Takahiro Haruyama</a>
                            </span>
                <time class="updated" datetime="2023-10-31" pubdate>October 31, 2023</time>
        <span class="read-time">34 min read</span>
    </div>    </div>
  </div>
</article>
        </div>
          </div>
  </div>
  </article>

<!-- MODAL PLACEHOLDER FOR VIDEO -->
<div class="modal fade" id="videoModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h2 id="title"></h2>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <div class="embed-responsive embed-responsive-16by9">
          <iframe id="featuredVideo" class="embed-responsive-item" src="" frameborder="0" allowfullscreen></iframe>
        </div>
        <div id="brightcove"></div>
      </div>
    </div>
  </div>
</div>
        </main><!-- /.main -->
      </div><!-- /.content -->
    </div><!-- /.wrap -->
    <footer class="content-info">
  <div id="page-footer"></div>
</footer>
<div class="personalization_div_1" style="min-height: 1px;"></div><div class="personalization_div_2" style="min-height: 1px;"></div><script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script type='text/javascript' src='https://blogs.vmware.com/security/wp-content/themes/vmware-security-0.2.2/dist/scripts/main-77d5692421.js?ver=1656457644' id='sage/js-js'></script>

    <script src="https://www.vmware.com/bin/vmware/template/scrapercontent.us.js" type="text/javascript" charset="UTF-8"></script>
    <script src="https://www.vmware.com/content/dam/vmwaredesigns/scrapercontent/responsive.js" type="text/javascript" charset="UTF-8"></script>
  </body>
</html>
<!-- Dynamic page generated in 0.899 seconds. -->
<!-- Cached page generated by WP-Super-Cache on 2024-10-22 22:55:13 -->

<!-- Compression = gzip -->