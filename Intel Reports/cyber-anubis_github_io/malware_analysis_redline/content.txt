<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.19.2 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>RedLine Infostealer - Cyber-Anubis</title>
<meta name="description" content="Reverse Engineering RedLine Infostealer. RedLine exfiltrates almost every valuable assests &amp; it’s able to load additional threats to… ">


  <meta name="author" content="Nidal Fikri">


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Cyber-Anubis">
<meta property="og:title" content="RedLine Infostealer">
<meta property="og:url" content="https://cyber-anubis.github.io/malware%20analysis/redline/">


  <meta property="og:description" content="Reverse Engineering RedLine Infostealer. RedLine exfiltrates almost every valuable assests &amp; it’s able to load additional threats to… ">



  <meta property="og:image" content="https://cyber-anubis.github.io/assets/images/malware-analysis/Redline/thumbnail.png">





  <meta property="article:published_time" content="2021-09-27T00:00:00+00:00">





  

  


<link rel="canonical" href="https://cyber-anubis.github.io/malware%20analysis/redline/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Nidal Fikri",
      "url": "https://cyber-anubis.github.io/"
    
  }
</script>


  <meta name="google-site-verification" content="J3MnMF94zaZhTUoNtUiRt9cKsr7hiMyTxEdAvQ3GfmY" />





<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Cyber-Anubis Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

<!-- favicon -->
<link rel="icon" type="image/png" sizes="32x32" href="/assets/images/site_data/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/images/site_data/favicon-16x16.png">
<meta name="theme-color" content="#ffffff">

  </head>

  <body class="layout--single wide">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/images/site_data/logo.png" alt=""></a>
        
        <a class="site-title" href="/">
          Cyber-Anubis
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/categories/#malware-analysis">Malware Analysis</a>
            </li><li class="masthead__menu-item">
              <a href="">Tutorials</a>
            </li><li class="masthead__menu-item">
              <a href="/categories">All Categories</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/assets/images/site_data/avatar.jpg" alt="Nidal Fikri" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Nidal Fikri</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>Hatching Triage Malware Research Analyst. Ex-Trend Micro Intern.</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Egypt</span>
        </li>
      

      
        
          
            <li><a href="https://cyber-anubis.github.io/aboutme/" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-link" aria-hidden="true"></i><span class="label">About Me</span></a></li>
          
        
          
            <li><a href="mailto:nidalfikrikamil@gmail.com" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i><span class="label">Email</span></a></li>
          
        
          
            <li><a href="https://twitter.com/cyber_anubis" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i><span class="label">Twitter</span></a></li>
          
        
          
        
          
            <li><a href="https://www.linkedin.com/in/nidal-fikri-kamil/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span class="label">LinkedIn</span></a></li>
          
        
          
            <li><a href="https://github.com/cyber-anubis" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="RedLine Infostealer">
    <meta itemprop="description" content="RedLine in a Nutshell">
    <meta itemprop="datePublished" content="2021-09-27T00:00:00+00:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">RedLine Infostealer
</h1>
          
            <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  16 minute read

</p>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right ">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> On this page</h4></header>
              <ul class="toc__menu">
  <li><a href="#redline-in-a-nutshell">RedLine in a Nutshell</a></li>
  <li><a href="#redline-infection-vector">RedLine Infection Vector</a></li>
  <li><a href="#technical-summary">Technical Summary</a></li>
  <li><a href="#technical-analysis">Technical Analysis</a>
    <ul>
      <li><a href="#first-look--unpacking">First look &amp; Unpacking</a></li>
      <li><a href="#configuration-extraction">Configuration Extraction</a></li>
      <li><a href="#c2-communication">C2 Communication</a></li>
      <li><a href="#information-stealing">Information Stealing</a></li>
      <li><a href="#remote-execution">Remote Execution</a></li>
    </ul>
  </li>
  <li><a href="#conclusion">Conclusion</a></li>
  <li><a href="#iocs">IoCs</a></li>
  <li><a href="#yara-rule">YARA Rule</a></li>
  <li><a href="#references">References</a></li>
</ul>

            </nav>
          </aside>
        
        <h1 id="redline-in-a-nutshell">RedLine in a Nutshell</h1>

<p>RedLine is a newly emerging infostealer. An <em>infostealer malware</em> is designed to gather information, and steal valuable assets from an infected system. The most common form of infostealer is to gather login information, like usernames and passwords. RedLine was first being noticed at 2020 via COVID-19 phishing emails, and has been active in 2021. RedLine is almost everywhere, and has appeared variously as trojanized services, games, and cracks. RedLine is used for extensive information stealing operations, like: credit card credentials, Crypto wallets, sensitive files, etc. Furthermore, RedLine also can be used as malware loader or dropper for extended malicious impact. For instance, it can be used to infect the victim with additional malwares like ransomwares. The RedLine malware family has been distributed and sold mostly via underground malware forums. Many samples of RedLine also appear with legit-looking digital certificates. RedLine is considered as one of the most serious threats that are currently in the wild, therefore it is a must to know how it works, how to detect it, and how to protect your organization.</p>

<h1 id="redline-infection-vector">RedLine Infection Vector</h1>

<p>RedLine is extremely versatile, and has been noted being delivered by numerous mechanisms. It is used in multiple smaller campaigns by individuals who have purchased the malware from the underground malware forums. Due to this, there are a wide range of known infection vectors. Only few of them are stated below:</p>

<ul>
  <li>Trojanized as popular services: Telegram, Signal, Discord (i.e. legit-looking installers).</li>
  <li>Email phishing campaigns.</li>
  <li>Abusing Google Ads while hosting Trojanized or fake websites.</li>
  <li>Social engineering campaigns to attack digital artists using Non-Fungible Tokens.</li>
  <li>Downloaded by malware loaders.</li>
</ul>

<h1 id="technical-summary">Technical Summary</h1>

<ol>
  <li><strong>Configuration Extraction:</strong> RedLine comes with embedded configuration, in this variant, the configuration is <u>Base64</u> encoded plus an additional layer of <u>XOR</u> encryption with hard-coded key. These configuration contains the C&amp;C server and the malware Botnet ID , which it will communicate with to exfiltrate gathered information, and also for further remote commands.</li>
  <li><strong>C2 Communication:</strong> After extracting the C&amp;C and before doing anything, RedLine will check if there is a possibility to reach its C&amp;C server. If there is an available connection, RedLine will then try to obtain the malicious <u>Scan Settings</u>. These scan arguments contain flags that will be used to determine which information to be stolen. Moreover, the obtained scan arguments contain tuning parameters, to specify desired data assets. For instance, search patterns to specify certain files to be exfiltrated, etc.</li>
  <li><strong>Host Profiling:</strong> RedLine will gather information about the infected host, in order to decide further actions. Mostly relying on <u>Windows Management Instrumentation (WMI)</u>, it harvests and generates the following information: Hardware ID, Usernames, OS version, Installed languages, Installed programs, Current running processes, Anti-malware products, Graphics card info, Victim’s Location, IP address, etc. In addition to all these, RedLine contains functions to exclude <u>Blacklisted</u> countries as well as <u>Blocked</u> IPs from infection.</li>
  <li><strong>Information Stealing:</strong> Here lies the bulk of its functionality. As being an information stealer, based on the obtained scan arguments, RedLine can exfiltrates the following information:
    <ul>
      <li><u>Files:</u> Any specified files in the following directories: <code class="language-plaintext highlighter-rouge">ProgramData, Program Files, Program Files (x86)</code>.</li>
      <li><u>Browsers:</u> Login credentials, Cookies, Auto-fill fields used by websites, and Credit card details.</li>
      <li><u>Crypto Wallets:</u> Credentials of: Armory, Exodus, Ethereum, Monero, Atomic, BinanceChain, and a lot more.</li>
      <li><u>VPN Clients:</u> Credentials of the following VPN clients: NordVPN, ProtonVPN, and OpenVPN.</li>
      <li><u>Gaming Clients:</u> It’s targeting the credentials of the famous Valve’s Steam gaming platform.</li>
      <li><u>Instant Messengers:</u> Currently it’s targeting Telegram session data and Discord tokens.</li>
      <li><u>FTP Clients:</u> Credentials of FileZilla FTP client.</li>
    </ul>
  </li>
  <li><strong>Remote Execution:</strong> After successful data exfiltration, RedLine will try to obtain additional remote commands to execute within the infected machine. Going beyond information stealing, RedLine is able to perform the following remote actions:
    <ul>
      <li>Download additional files.</li>
      <li>Download and execute PE files (i.e. additional malware like ransomware).</li>
      <li>Open desired links (i.e. malicious websites).</li>
      <li>Execute remote commands via <code class="language-plaintext highlighter-rouge">CMD.exe</code> .</li>
    </ul>
  </li>
</ol>

<h1 id="technical-analysis">Technical Analysis</h1>

<h2 id="first-look--unpacking">First look &amp; Unpacking</h2>

<p><a href="/assets/images/malware-analysis/Redline/virus_total.png"><img src="/assets/images/malware-analysis/Redline/virus_total.png" alt="" /></a></p>
<center><font size="3"> <u>Figure</u>(1): <u>Results are at 2021-09-20 18:03:15 UTC. Different results may appear. </u> </font></center>
<p><br />
This sample comes -in disguise- as packed C/C++ file, which will be responsible to unpack and expose the real RedLine malware. However, the initial packed file as you can see in the last figure is flagged malicious by 20 security vendors according to <a href="https://www.virustotal.com/gui/file/1d91ab82e01d7682deecbeef7b441f26e405c0053e0354e92fdb5cfe61b097b0/detection/f-1d91ab82e01d7682deecbeef7b441f26e405c0053e0354e92fdb5cfe61b097b0-1632160995">VirusTotal</a>.
For simplicity sake, I’ve decided to use <a href="https://www.unpac.me/results/159ed23f-5cdf-4183-8131-d95e61932a9d#/">UnpacMe</a> to do the unpacking process. The final unpacked file is found to a .NET application, which is the real RedLine malware that I will analyze in details. I’ve decided to focus on RedLine data structures, to properly understand which &amp; how data is being exfiltrated.</p>

<h2 id="configuration-extraction">Configuration Extraction</h2>

<p><a href="/assets/images/malware-analysis/Redline/entrypoint.png"><img src="/assets/images/malware-analysis/Redline/entrypoint.png" alt="" /></a></p>
<center><font size="3"> <u>Figure</u>(2): <u>RedLine code entry point.</u> </font></center>
<p><br />
RedLine begins with hiding its UI from the infected user. It dynamically resolves <code class="language-plaintext highlighter-rouge">GetConsoleWindow()</code> and <code class="language-plaintext highlighter-rouge">ShowWindow()</code> APIs do that. RedLine calls <code class="language-plaintext highlighter-rouge">ShowWindow()</code> with the parameter <code class="language-plaintext highlighter-rouge">SW_HIDE=0</code> to effectively hide its window.</p>

<p><a href="/assets/images/malware-analysis/Redline/decrypt.png"><img src="/assets/images/malware-analysis/Redline/decrypt.png" alt="" /></a></p>
<center><font size="3"> <u>Figure</u>(3): <u>The function used for decrypting the embedded configuration.</u> </font></center>
<p><br />
Then, it uses the <code class="language-plaintext highlighter-rouge">Decrypt()</code> function to extract the embedded encrypted configuration. For this particular sample, the decrypted <u>C&amp;C</u> is <code class="language-plaintext highlighter-rouge">"188.124.36.242:25802"</code> and the decrypted <u>Botnet</u> ID is <code class="language-plaintext highlighter-rouge">"paladin"</code>. The Botent ID is being used to track the malware and to better identify the infected machines.</p>

<h2 id="c2-communication">C2 Communication</h2>

<p>After successfully extracting the C&amp;C IP address, RedLine will check if it can reach the C&amp;C server using the functions <code class="language-plaintext highlighter-rouge">RequestConnection()</code> and <code class="language-plaintext highlighter-rouge">TryGetConnection()</code>. If there is an available connection, RedLine will then try to obtain the malicious <u>Scan Settings</u> using the function <code class="language-plaintext highlighter-rouge">TryGetArgs()</code>. These settings simply represents the full arsenal of RedLine, and what capabilities it possess. The available scan settings are below:</p>

<p><a href="/assets/images/malware-analysis/Redline/scan_args_class.png"><img src="/assets/images/malware-analysis/Redline/scan_args_class.png" alt="" /></a></p>
<center><font size="3"> <u>Figure</u>(4): <u>For simplicity sake , this screenshot is taken using Sublime and not dnSpy in order to show only the useful code.</u> </font></center>
<p><br />
These scan arguments contain flags that will be used to determine which information to be stolen. Each flag is used in certain functions to decide whether to perform the scanning functionality or not -I will show examples in a moment. Moreover, the obtained scan arguments contain tuning parameters, to specify desired data assets. For instance, they contain search patterns to specify files to be exfiltrated, paths for locating certain browsers, or a list of Blacklisted countries to exclude from infection, etc. After getting the scanning arguments (settings), RedLine proceeds to preform its main purpose, which is information stealing.</p>

<h2 id="information-stealing">Information Stealing</h2>

<p><a href="/assets/images/malware-analysis/Redline/part_sender_class.png"><img src="/assets/images/malware-analysis/Redline/part_sender_class.png" alt="" /></a></p>
<center><font size="3"> <u>Figure</u>(5): <u>The functions names &amp; lots of code were obfuscated to make reverse engineering harder.</u> </font></center>
<p><br />
RedLine contains many functions to collect and harvest almost every valuable asset in the infected machine. Some of these functions are very simple, regarding the purpose and the implementation. For instance, <code class="language-plaintext highlighter-rouge">Enumerate_username()</code>, <code class="language-plaintext highlighter-rouge">Get_Malware_Path()</code>, <code class="language-plaintext highlighter-rouge">Enumerate_OS_Version()</code>,etc.</p>

<p>Yet, before proceeding to the scanning functionality once again, RedLine instantiates very important data structures, which will be populated with the stolen assets and the gathered host profile. Below are the two important classes <code class="language-plaintext highlighter-rouge">ScanResult</code> and <code class="language-plaintext highlighter-rouge">ScanDetails</code> :</p>

<p><a href="/assets/images/malware-analysis/Redline/scan_results1.png"><img src="/assets/images/malware-analysis/Redline/scan_results1.png" alt="" /></a></p>
<center><font size="3"> <u>Figure</u>(6): <u>The rest of the customized classes will be discussed in the coming sections.</u> </font></center>
<p><br />
For instance, Specified files by the scanning arguments will be populated into <code class="language-plaintext highlighter-rouge">ScannedFile</code> class in order to be exfiltrated and so on. The <code class="language-plaintext highlighter-rouge">scannedFile</code> class is included in the bigger <code class="language-plaintext highlighter-rouge">ScanDetails</code> class, which is also included in the bigger <code class="language-plaintext highlighter-rouge">ScanResult</code> class. It’s very important to understand the hierarchy of these nested classes, to draw a map of how the precious data assets are being organized and stolen from the infected machine.</p>

<h3 id="host-profiling">Host Profiling</h3>

<p>RedLine contains more than 20 functions to perform almost full sweeping of the infected machine. Some of them are fairly simple, they just perform windows registry querying or they use documented APIs. For instance, since Microsoft Edge is the default browser, the <code class="language-plaintext highlighter-rouge">Enumerate_Browsers()</code> function searches the registry keys <code class="language-plaintext highlighter-rouge">HKEY_LOCAL_MACHINE\Software\Clients\StartMenuInternet</code>  and its <code class="language-plaintext highlighter-rouge">WoW6432</code> twin to find the installed browsers, in order to harvest their credentials later on. The <code class="language-plaintext highlighter-rouge">Enumerate_Installed_Software()</code> function uses the registry key <code class="language-plaintext highlighter-rouge">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall</code> to list every installed software in the system.  Also, RedLine uses the <code class="language-plaintext highlighter-rouge">Take_Screenshots()</code> functions to take live screenshots of the infected system.</p>

<p><a href="/assets/images/malware-analysis/Redline/get_VS.png"><img src="/assets/images/malware-analysis/Redline/get_VS.png" alt="" /></a></p>
<center><font size="3"> <u>Figure</u>(7): <u>Concatinating the WMI query for the ManagementObjectSearcher class instance.</u> </font></center>
<p><br />
Moreover, the <code class="language-plaintext highlighter-rouge">Enumerate_Security_Defenders()</code> function uses the WMI to enumerate any installed security solution. It allows it to get the installed Antivirus, AntiSpyware and Firewall (third party) software using the <code class="language-plaintext highlighter-rouge">root\SecurityCenter</code> or the <code class="language-plaintext highlighter-rouge">root\SecurityCenter2</code> namespaces.</p>

<p>Not to forget, the <code class="language-plaintext highlighter-rouge">Enumerate_Running_Processess()</code> function which also uses the <code class="language-plaintext highlighter-rouge">Win32_Process</code> WMI class that represents a process on an operating system. It gets the process name + PID + command line arguemtns in order to build a live full view of the infected machine. I think the attacker uses these information to decide further malicious actions i.e. certain exploits.</p>

<p><a href="/assets/images/malware-analysis/Redline/gelocation.png"><img src="/assets/images/malware-analysis/Redline/gelocation.png" alt="" /></a></p>
<center><font size="3"> <u>Figure</u>(8): <u>The if-statements control wether to stop the infection or not.</u> </font></center>
<p><br />
Lastly, one more interesting function is the <code class="language-plaintext highlighter-rouge">Send()</code> function which contains the above method. It uses the following remote API <code class="language-plaintext highlighter-rouge">https://api.ip.sb/geoip</code> to gather very detailed geographical information about the victim. The remote API returns XML data specifying many detailed information:</p>

<div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="err">"organization":"XXXXXXXX","longitude":XXXXXXX,"city":"XXXXXX","timezone":"XXXXXX","isp":"XXXXXXX","offset":XXXXX,"region":"XXXXX","asn":XXXXX,"asn_organization":"XXXXX","country":"XXXXX","ip":"XXXXXXX","latitude":XXXXXXX,"continent_code":"XXXX","country_code":"XXXX","region_code":"XXXXX"</span><span class="p">}</span>
</code></pre></div></div>

<h3 id="exfiltrating-files">Exfiltrating Files</h3>

<p><a href="/assets/images/malware-analysis/Redline/scanned_file_class.png"><img src="/assets/images/malware-analysis/Redline/scanned_file_class.png" alt="" /></a></p>
<center><font size="3"> <u>Figure</u>(9): <u>The contents of the file is being automatically read when the constructor is called with the filename string parameter.</u> </font></center>
<p><br />
It’s important to know the inner structures of the <code class="language-plaintext highlighter-rouge">ScannedFile</code> class which is used to populate the exfiltrated files. As you can see in the above screenshot, once a file is being instantiated, nearly all of its important contents is stolen.</p>

<p><a href="/assets/images/malware-analysis/Redline/exfil_files.png"><img src="/assets/images/malware-analysis/Redline/exfil_files.png" alt="" /></a></p>
<center><font size="3"> <u>Figure</u>(10): <u>The function shows the concatination of the searching paths.</u> </font></center>
<p><br />
Based on the <u>obtained scan arguments (settings)</u> during the previous C2 communication, they contain search patterns to specify desired files to be stolen. RedLine currently use the search patterns to locate files in the following directories only: <code class="language-plaintext highlighter-rouge">Program Files (X86)/</code>, <code class="language-plaintext highlighter-rouge">Program Files/</code>, and <code class="language-plaintext highlighter-rouge">Program Data/</code>. The directory <code class="language-plaintext highlighter-rouge">ProgramData/</code> is for user-agnostic data generated during execution such as shared cache, shared databases, shared settings, shared preferences, etc.</p>

<p><a href="/assets/images/malware-analysis/Redline/exfil_files2.png"><img src="/assets/images/malware-analysis/Redline/exfil_files2.png" alt="" /></a></p>
<center><font size="3"> <u>Figure</u>(11): <u>Once a ScannedFile instance is instantiated with a filename, all of the file contents is read.</u> </font></center>
<p><br />
RedLine only needs to locate the specified files based on the search patterns then create a <code class="language-plaintext highlighter-rouge">ScannedFile</code> instance of the filtered filename. Once instantiated with the filename, almost all of the file contents is stolen because of the <code class="language-plaintext highlighter-rouge">ScannedFile</code> constructor code.</p>

<h3 id="harvesting-browsers">Harvesting Browsers</h3>

<p><a href="/assets/images/malware-analysis/Redline/browser_class.png"><img src="/assets/images/malware-analysis/Redline/browser_class.png" alt="" /></a></p>
<center><font size="3"> <u>Figure</u>(12): <u>The collected data about the targeted browser.</u> </font></center>
<p><br />
Also, It’s very important to know the inner structures of the <code class="language-plaintext highlighter-rouge">Browser</code> class, which is used to populate the harvested browser credentials. Once a browser is targeted, RedLine steals its accounts credentials, credit card credentials, cookies, and auto-fill data. RedLine targets <u>Chromium</u> based browsers as well as <u>Gecko</u> based browsers, which makes RedLine nearly targets most used browsers.</p>

<p><a href="/assets/images/malware-analysis/Redline/harvest_browser.png"><img src="/assets/images/malware-analysis/Redline/harvest_browser.png" alt="" /></a></p>
<center><font size="3"> <u>Figure</u>(13): <u>Notice the passed scanning settings which were obtained by the C2 communication.</u> </font></center>
<p><br /></p>

<p><a href="/assets/images/malware-analysis/Redline/harvest_browser2.png"><img src="/assets/images/malware-analysis/Redline/harvest_browser2.png" alt="" /></a></p>
<center><font size="3"> <u>Figure</u>(14): <u>Populating the Browser class.</u> </font></center>
<p><br />
RedLine also uses more methods like <code class="language-plaintext highlighter-rouge">DecryptChromium()</code> in order to effectively harvest the targeted credentials. It’s also being noticed that for <u>Gecko</u> based browsers, this sample <u>only steals the cookies</u> unlike the targeted <u>Chromium</u> based browsers.</p>

<h3 id="stealing-crypto-wallets">Stealing Crypto Wallets</h3>

<p>A crypto wallet is an application used to both cold store and retrieve digital cryptocurrency assets. RedLine of course targets these valuable assets because of the rise of people’s interest in cryptocurrency during the past few years.</p>

<p><a href="/assets/images/malware-analysis/Redline/crypto1.png"><img src="/assets/images/malware-analysis/Redline/crypto1.png" alt="" /></a></p>
<center><font size="3"> <u>Figure</u>(15): <u>The AllWallets class is used for generic crypto wallets.</u> </font></center>

<p><br />
RedLine comes with many classes targeting many crypto wallets like: Armory, Exodus, Ethereum, Monero, Atomic, BinanceChain, Jaxx, Electrum, Guarda, etc. RedLine uses pre-defined search patterns and scan arguments to populate the wallets into <code class="language-plaintext highlighter-rouge">ScannedFile</code> instances. Each class in the previous figure is just used to initialize defined search patterns to be passed to the regular <code class="language-plaintext highlighter-rouge">Search()</code> function which is used in files exfiltration.</p>

<p><a href="/assets/images/malware-analysis/Redline/crypto2.png"><img src="/assets/images/malware-analysis/Redline/crypto2.png" alt="" /></a></p>
<center><font size="3"> <u>Figure</u>(16): <u>Overriding the GetScanArgs function with new search patterns.</u> </font></center>
<p><br />
These search patterns specify the credentials files which is being used for the specific wallet type. For every wallet class, it is used to override the <code class="language-plaintext highlighter-rouge">GetScanArgs()</code> function which is used internally in the <code class="language-plaintext highlighter-rouge">Search()</code> function in order to filter for the appropriate wallet files. These filtered files will be exfiltrated.</p>

<h3 id="harvesting-instant-messenger-clients">Harvesting Instant Messenger Clients</h3>

<p>Instant Messenger (IM) clients like Discord and Telegram have seen a recent rise in popularity, with Discord boasting over 100 million active users. For Telegram, RedLine looks used the <code class="language-plaintext highlighter-rouge">GetProcessesByName()</code> function to get the <code class="language-plaintext highlighter-rouge">ExecutablePath</code> for Telegram running process. Then, it looks for the folder <code class="language-plaintext highlighter-rouge">tdata</code>. This is where the Instant Messenger stores its session data, including images and conversations:</p>

<p><a href="/assets/images/malware-analysis/Redline/telegram1.png"><img src="/assets/images/malware-analysis/Redline/telegram1.png" alt="" /></a></p>
<center><font size="3"> <u>Figure</u>(17): <u>The function is passed the Telegram process name.</u> </font></center>
<p><br />
It’s also used  to override the <code class="language-plaintext highlighter-rouge">GetScanArgs()</code> function which is used internally in the <code class="language-plaintext highlighter-rouge">Search()</code> function in order to filter for the targeted files.</p>

<p>For Discord, RedLine is stealing its tokens using the <code class="language-plaintext highlighter-rouge">Discord.GetTokens()</code> function. A Discord token is a phrase of letters and numbers that acts as an authorization code to access Discord’s servers. It effectively acts as an encryption of your username and password.</p>

<h3 id="snatching-vpn-clients-credentials">Snatching VPN Clients Credentials</h3>

<p>With the rise in popularity in VPN services, RedLine doesn’t have any plans to miss this chance. RedLine targets the VPN clients of the following services: NordVPN, OpenVPN, and ProtonVPN. For NordVPN client, RedLine uses obfuscated strings to locate the targeted XML files which contain the VPN credentials:</p>

<p><a href="/assets/images/malware-analysis/Redline/nord1.png"><img src="/assets/images/malware-analysis/Redline/nord1.png" alt="" /></a></p>
<center><font size="3"> <u>Figure</u>(18): <u>This method of strings obfuscation is almost used everywhere in RedLine classes.</u> </font></center>
<p><br />
Then, it uses decrypting functions to decipher the wanted credentials:</p>

<p><a href="/assets/images/malware-analysis/Redline/nord2.png"><img src="/assets/images/malware-analysis/Redline/nord2.png" alt="" /></a></p>
<center><font size="3"> <u>Figure</u>(19): <u>The CryptoHelper class is used for various decryption and encryption operations within RedLine.</u> </font></center>
<p><br />
Yet, for <u>OpenVPN</u> and <u>ProtonVPN</u>, RedLine uses the same old method of overriding the <code class="language-plaintext highlighter-rouge">GetScanArgs()</code> function which is used internally in the <code class="language-plaintext highlighter-rouge">Search()</code> function in order to filter for the targeted files. Then, it exfiltrates the filtered files as <code class="language-plaintext highlighter-rouge">ScannedFile</code> instances which contains the VPN credentials.</p>

<h3 id="harvesting-gaming-clients">Harvesting Gaming Clients</h3>

<p>Steam is a video game digital distribution service by <a href="https://en.wikipedia.org/wiki/Valve_Corporation">Valve</a>. By 2019, the service had over 34,000 games with over 95 million monthly active users. Steam is regarded as one of the best gaming platforms in the industry. Steam has an in-built store with a lot of ‘Steam accounts’ having various other services and banking details related to it. RedLine attempts to go after the <u>Steam Sentry File</u> which is used to store credentials:</p>

<p><a href="/assets/images/malware-analysis/Redline/steam1.png"><img src="/assets/images/malware-analysis/Redline/steam1.png" alt="" /></a></p>
<center><font size="3"> <u>Figure</u>(20): <u>RedLine overrides the GetScanArgs() function with defined search patterns. Then, exfiltrate the targeted files.</u> </font></center>
<p><br />
A VDF file is a data file format used by Valve’s Source game engine. It contains various kinds of game metadata, including data for resources, installation scripts, configuration scripts, and visualization elements.</p>

<h3 id="stealing-ftp-credentials">Stealing FTP Credentials</h3>

<p>A File Transfer Protocol client (FTP client) is a software utility that establishes a connection between a host computer and a remote server, typically an FTP server. An FTP client provides the dual-direction transfer of data and files between two computers over a TCP network or an Internet connection.</p>

<p><a href="/assets/images/malware-analysis/Redline/ftp1.png"><img src="/assets/images/malware-analysis/Redline/ftp1.png" alt="" /></a></p>
<center><font size="3"> <u>Figure</u>(21): <u>RedLine checks the existance of two different paths to locate the targeted credentials.</u> </font></center>
<p><br />
RedLine targets the free, open-source FileZilla application. RedLine uses the <code class="language-plaintext highlighter-rouge">ScanCredentials()</code> function to extract the required credentials and to populate them in <code class="language-plaintext highlighter-rouge">Account</code> class which will contain the URL + username + password.</p>

<h2 id="remote-execution">Remote Execution</h2>

<p>RedLine extends its functionality beyond information stealing. Here, RedLine takes the role of a malware loader. A malware <strong><em>loader</em></strong> is the software which drops the actual malicious content on the system, then executes the first stage of the attack. Hence, RedLine is capable of delivering some additional serious threats to the infected machine, like ransomwares for example. After successfully performing the information stealing operations, RedLine uses the <code class="language-plaintext highlighter-rouge">TryGetTasks()</code> function to obtain a list of <code class="language-plaintext highlighter-rouge">UpdateTask</code> class, which contains the required arguments to successfully perform remote execution actions:</p>

<p><a href="/assets/images/malware-analysis/Redline/task1.png"><img src="/assets/images/malware-analysis/Redline/task1.png" alt="" /></a></p>
<center><font size="3"> <u>Figure</u>(22): <u>The availabe remote actions aka update tasks.</u> </font></center>
<p><br />
Once a connection with its C&amp;C server has been established, RedLine can remotely perform the operations described in the above figure. Below are the inner details of the <code class="language-plaintext highlighter-rouge">DownloadAndExecuteUpdate</code> class which is used -as the name suggests- to download a PE file and executes it in the infected machine:</p>

<p><a href="/assets/images/malware-analysis/Redline/task2.png"><img src="/assets/images/malware-analysis/Redline/task2.png" alt="" /></a></p>
<center><font size="3"> <u>Figure</u>(23): <u>The passed argument consists of the malicious URL + the filename.</u> </font></center>
<p><br />
RedLine can be used effectively as malware loader or dropper for further wanted malicious activities. Moreover, it can be used to open desired links for various malicious or non-malicious purposes.</p>

<h1 id="conclusion">Conclusion</h1>

<p>RedLine is regarded as a true security threat to any machine. The capabilities of being able to steal almost every valuable asset, and being able to load additional serious malwares or exploits are regarded most fatal. This threat has been sold as individual packages with several pricing options, or as Malware-as-a-Service (MaaS) on a subscription-based pricing package. With the rise of Maas underground forums, RedLine threats will not fade away in the very near future. Therefore, it is a must to know how it works, how to detect it, and how to protect your organization.</p>

<p><br /></p>
<h1 id="iocs">IoCs</h1>

<table>
  <thead>
    <tr>
      <th>No.</th>
      <th>Description</th>
      <th>Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td>Initial packed file</td>
      <td>1d91ab82e01d7682deecbeef7b441f26e405c0053e0354e92fdb5cfe61b097b0</td>
    </tr>
    <tr>
      <td>2</td>
      <td>Unpacked RedLine</td>
      <td>e9905446c858326e8f0fe12f6df777542180608381f1ccae4bda9a8356b04abc</td>
    </tr>
    <tr>
      <td>3</td>
      <td>RedLine C&amp;C server</td>
      <td>188.124.36.242:25802</td>
    </tr>
  </tbody>
</table>

<p><br /></p>
<h1 id="yara-rule">YARA Rule</h1>

<div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">rule</span> <span class="nt">redline</span> <span class="o">:</span> <span class="nt">infostealer</span>
<span class="p">{</span>
	<span class="py">meta</span><span class="p">:</span>
		<span class="n">description</span> <span class="err">=</span> <span class="s1">"This is a noob rule for detecting unpacked RedLine"</span>
		<span class="n">author</span> <span class="err">=</span> <span class="s1">"Nidal Fikri @cyber_anubis"</span>
		
	<span class="n">strings</span><span class="p">:</span>
		<span class="err">$</span><span class="n">mz</span> <span class="err">=</span> <span class="err">{</span><span class="m">4</span><span class="n">D</span> <span class="m">5</span><span class="n">A</span><span class="p">}</span>			<span class="o">//</span><span class="nt">PE</span> <span class="nt">File</span>
		
		<span class="err">$</span><span class="nt">s1</span> <span class="o">=</span> <span class="s1">"IRemoteEndpoint"</span>
		<span class="err">$</span><span class="nt">s2</span> <span class="o">=</span> <span class="s1">"ITaskProcessor"</span>
	
		<span class="err">$</span><span class="nt">s3</span> <span class="o">=</span> <span class="s1">"ScannedFile"</span>
		<span class="err">$</span><span class="nt">s4</span> <span class="o">=</span> <span class="s1">"ScanningArgs"</span>
		<span class="err">$</span><span class="nt">s5</span> <span class="o">=</span> <span class="s1">"ScanResult"</span>
	
		<span class="err">$</span><span class="nt">s6</span> <span class="o">=</span> <span class="s1">"DownloadAndExecuteUpdate"</span>
		<span class="err">$</span><span class="nt">s7</span> <span class="o">=</span> <span class="s1">"OpenUpdate"</span>
		<span class="err">$</span><span class="nt">s8</span> <span class="o">=</span> <span class="s1">"CommandLineUpdate"</span>
  
		<span class="err">$</span><span class="nt">s9</span> <span class="o">=</span> <span class="s1">"TryCompleteTask"</span>
		<span class="err">$</span><span class="nt">s10</span> <span class="o">=</span> <span class="s1">"TryGetTasks"</span>
		<span class="err">$</span><span class="nt">s11</span> <span class="o">=</span> <span class="s1">"TryInitBrowsers"</span>
		<span class="err">$</span><span class="nt">s12</span> <span class="o">=</span> <span class="s1">"InstalledBrowsers"</span>
		<span class="err">$</span><span class="nt">s13</span> <span class="o">=</span> <span class="s1">"TryInitInstalledBrowsers"</span>
		<span class="err">$</span><span class="nt">s14</span> <span class="o">=</span> <span class="s1">"TryInitInstalledSoftwares"</span>
		<span class="err">$</span><span class="nt">s15</span> <span class="o">=</span> <span class="s1">"TryGetConnection"</span>

	<span class="nt">condition</span><span class="o">:</span>
	<span class="o">(</span><span class="err">$</span><span class="nt">mz</span> <span class="nt">at</span> <span class="err">0</span><span class="o">)</span> <span class="nt">and</span> <span class="o">(</span><span class="err">10</span> <span class="nt">of</span> <span class="o">(</span><span class="err">$</span><span class="nt">s</span><span class="o">*))</span>
<span class="err">}</span>
</code></pre></div></div>

<p><br /></p>
<h1 id="references">References</h1>

<ul>
  <li><a href="https://blogs.blackberry.com/en/2021/07/threat-thursday-redline-infostealer">https://blogs.blackberry.com/en/2021/07/threat-thursday-redline-infostealer</a></li>
</ul>

        
      </section>

      <footer class="page__meta">
        
        


  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/#malware-analysis" class="page__taxonomy-item" rel="tag">Malware Analysis</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2021-09-27T00:00:00+00:00">September 27, 2021</time></p>
        
      </footer>

      

      
  <nav class="pagination">
    
      <a href="/malware%20analysis/hancitor/" class="pagination--pager" title="Hancitor Loader
">Previous</a>
    
    
      <a href="/malware%20analysis/dridex/" class="pagination--pager" title="Dridex Trojan
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
      
        
      
        
      
        
      
        
      
        
      
    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2021 Nidal Fikri. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script src="https://kit.fontawesome.com/4eee35f757.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>




  <script>
  window.ga=function(){ga.q.push(arguments)};ga.q=[];ga.l=+new Date;
  ga('create','UA-207369386-2','auto');
  ga('set', 'anonymizeIp', false);
  ga('send','pageview')
</script>
<script src="https://www.google-analytics.com/analytics.js" async></script>









  </body>
</html>
