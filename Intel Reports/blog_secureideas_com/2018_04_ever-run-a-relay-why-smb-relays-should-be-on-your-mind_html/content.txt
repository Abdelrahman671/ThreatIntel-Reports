<!doctype html><html lang="en"><head>
    <meta charset="utf-8">
    <title>Ever Run a Relay? Why SMB Relays Should Be On Your Mind</title>
    <link rel="shortcut icon" href="https://www.secureideas.com/hubfs/favicon-1.ico">
    <meta name="description" content="Time is never on your side when you’re onsite with a client and trying to get the first good foothold, with admin privileges, can seem impossible. ">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    
    
    
    
    
    
    
    
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    <meta property="og:description" content="Time is never on your side when you’re onsite with a client and trying to get the first good foothold, with admin privileges, can seem impossible. ">
    <meta property="og:title" content="Ever Run a Relay? Why SMB Relays Should Be On Your Mind">
    <meta name="twitter:description" content="Time is never on your side when you’re onsite with a client and trying to get the first good foothold, with admin privileges, can seem impossible. ">
    <meta name="twitter:title" content="Ever Run a Relay? Why SMB Relays Should Be On Your Mind">

    

    
    <style>
a.cta_button{-moz-box-sizing:content-box !important;-webkit-box-sizing:content-box !important;box-sizing:content-box !important;vertical-align:middle}.hs-breadcrumb-menu{list-style-type:none;margin:0px 0px 0px 0px;padding:0px 0px 0px 0px}.hs-breadcrumb-menu-item{float:left;padding:10px 0px 10px 10px}.hs-breadcrumb-menu-divider:before{content:'›';padding-left:10px}.hs-featured-image-link{border:0}.hs-featured-image{float:right;margin:0 0 20px 20px;max-width:50%}@media (max-width: 568px){.hs-featured-image{float:none;margin:0;width:100%;max-width:100%}}.hs-screen-reader-text{clip:rect(1px, 1px, 1px, 1px);height:1px;overflow:hidden;position:absolute !important;width:1px}
</style>

<link rel="stylesheet" href="https://www.secureideas.com/hs-fs/hub/19799800/hub_generated/template_assets/88149991980/1729107544133/SecureIdeas-2022/assets/css/vendors.min.css">
<link rel="stylesheet" href="https://www.secureideas.com/hs-fs/hub/19799800/hub_generated/template_assets/88150009442/1729106081490/SecureIdeas-2022/assets/css/buttons/buttons.min.css">
<link rel="stylesheet" href="https://www.secureideas.com/hs-fs/hub/19799800/hub_generated/template_assets/88150003863/1679964699589/SecureIdeas-2022/assets/css/typography/typography.min.css">
<link rel="stylesheet" href="https://www.secureideas.com/hs-fs/hub/19799800/hub_generated/template_assets/88141376922/1685021805893/SecureIdeas-2022/assets/css/blog/blog.css">
<link rel="stylesheet" href="https://www.secureideas.com/hs-fs/hub/19799800/hub_generated/template_assets/88141375912/1679964705492/SecureIdeas-2022/assets/css/form/form.min.css">
<link rel="stylesheet" href="https://www.secureideas.com/hs-fs/hub/19799800/hub_generated/template_assets/88152269730/1729106024064/SecureIdeas-2022/assets/css/app.min.css">
<link rel="stylesheet" href="https://www.secureideas.com/hs-fs/hub/19799800/hub_generated/template_assets/88149991979/1729105876418/SecureIdeas-2022/assets/css/theme-override.min.css">
<link rel="stylesheet" href="https://www.secureideas.com/hs-fs/hub/19799800/hub_generated/module_assets/88149166411/1721658345166/module_88149166411_Navigation.min.css">
<link rel="stylesheet" href="https://www.secureideas.com/hs-fs/hub/19799800/hub_generated/module_assets/88149690372/1697554304951/module_88149690372_Footer.min.css">
    <script type="application/ld+json">
{
  "mainEntityOfPage" : {
    "@type" : "WebPage",
    "@id" : "https://www.secureideas.com/blog/2018/04/ever-run-a-relay-why-smb-relays-should-be-on-your-mind.html"
  },
  "author" : {
    "name" : "Eric Kuehn",
    "url" : "https://www.secureideas.com/blog/author/eric-kuehn",
    "@type" : "Person"
  },
  "headline" : "Ever Run a Relay? Why SMB Relays Should Be On Your Mind",
  "datePublished" : "2018-04-11T13:45:00.000Z",
  "dateModified" : "2023-04-25T19:13:35.243Z",
  "publisher" : {
    "name" : "Secure Ideas, LLC",
    "logo" : {
      "url" : "https://f.hubspotusercontent00.net/hubfs/19799800/si-logo-small.png",
      "@type" : "ImageObject"
    },
    "@type" : "Organization"
  },
  "@context" : "https://schema.org",
  "@type" : "BlogPosting",
  "image" : [ "https://secureideas.com/hubfs/NTLMauth-1.webp" ]
}
</script>


    
<!--  Added by GoogleAnalytics integration -->
<script>
var _hsp = window._hsp = window._hsp || [];
_hsp.push(['addPrivacyConsentListener', function(consent) { if (consent.allowed || (consent.categories && consent.categories.analytics)) {
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create','UA-958843-1','auto');
  ga('send','pageview');
}}]);
</script>

<!-- /Added by GoogleAnalytics integration -->

<!--  Added by GoogleAnalytics4 integration -->
<script>
var _hsp = window._hsp = window._hsp || [];
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}

var useGoogleConsentModeV2 = true;
var waitForUpdateMillis = 1000;


if (!window._hsGoogleConsentRunOnce) {
  window._hsGoogleConsentRunOnce = true;

  gtag('consent', 'default', {
    'ad_storage': 'denied',
    'analytics_storage': 'denied',
    'ad_user_data': 'denied',
    'ad_personalization': 'denied',
    'wait_for_update': waitForUpdateMillis
  });

  if (useGoogleConsentModeV2) {
    _hsp.push(['useGoogleConsentModeV2'])
  } else {
    _hsp.push(['addPrivacyConsentListener', function(consent){
      var hasAnalyticsConsent = consent && (consent.allowed || (consent.categories && consent.categories.analytics));
      var hasAdsConsent = consent && (consent.allowed || (consent.categories && consent.categories.advertisement));

      gtag('consent', 'update', {
        'ad_storage': hasAdsConsent ? 'granted' : 'denied',
        'analytics_storage': hasAnalyticsConsent ? 'granted' : 'denied',
        'ad_user_data': hasAdsConsent ? 'granted' : 'denied',
        'ad_personalization': hasAdsConsent ? 'granted' : 'denied'
      });
    }]);
  }
}

gtag('js', new Date());
gtag('set', 'developer_id.dZTQ1Zm', true);
gtag('config', 'G-263536655');
</script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-263536655"></script>

<!-- /Added by GoogleAnalytics4 integration -->

<!--  Added by GoogleTagManager integration -->
<script>
var _hsp = window._hsp = window._hsp || [];
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}

var useGoogleConsentModeV2 = true;
var waitForUpdateMillis = 1000;



var hsLoadGtm = function loadGtm() {
    if(window._hsGtmLoadOnce) {
      return;
    }

    if (useGoogleConsentModeV2) {

      gtag('set','developer_id.dZTQ1Zm',true);

      gtag('consent', 'default', {
      'ad_storage': 'denied',
      'analytics_storage': 'denied',
      'ad_user_data': 'denied',
      'ad_personalization': 'denied',
      'wait_for_update': waitForUpdateMillis
      });

      _hsp.push(['useGoogleConsentModeV2'])
    }

    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-5WKZTLL');

    window._hsGtmLoadOnce = true;
};

_hsp.push(['addPrivacyConsentListener', function(consent){
  if(consent.allowed || (consent.categories && consent.categories.analytics)){
    hsLoadGtm();
  }
}]);

</script>

<!-- /Added by GoogleTagManager integration -->



<meta property="og:image" content="https://www.secureideas.com/hubfs/NTLMauth-1.webp">

<meta name="twitter:image" content="https://www.secureideas.com/hubfs/NTLMauth-1.webp">


<meta property="og:url" content="https://www.secureideas.com/blog/2018/04/ever-run-a-relay-why-smb-relays-should-be-on-your-mind.html">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://www.secureideas.com/blog/2018/04/ever-run-a-relay-why-smb-relays-should-be-on-your-mind.html">
 
<meta property="og:type" content="article">
<link rel="alternate" type="application/rss+xml" href="https://www.secureideas.com/blog/rss.xml">
<meta name="twitter:domain" content="www.secureideas.com">

<meta http-equiv="content-language" content="en">






    
    
  <meta name="generator" content="HubSpot"></head>
  <body class="antialiased">
<!--  Added by GoogleTagManager integration -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-5WKZTLL" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

<!-- /Added by GoogleTagManager integration -->

    <div class="body-wrapper   hs-content-id-56060043388 hs-blog-post hs-blog-id-48279235194">
      
        <div data-global-resource-path="SecureIdeas-2022/templates/partials/header.html"><div id="hs_cos_wrapper_module_166186815647519" class="hs_cos_wrapper hs_cos_wrapper_widget hs_cos_wrapper_type_module" style="" data-hs-cos-general-type="widget" data-hs-cos-type="module"><header class="p-5 header-shadow relative">
  <div class="container">
    <div class="flex items-center justify-between">
      <div class="flex items-center lg:flex-grow lg:space-x-4 xl:space-x-10">
        <div class="flex items-center header-logo">
          <button class="bg-transparent mr-4 lg:mr-6 border-0 text-dark block lg:hidden toggle-menu">
            <svg class="stroke-current w-6 h-6" viewbox="0 0 24 24" stroke-width="3" stroke="#fff" fill="none" stroke-linecap="round" stroke-linejoin="round"><path d="M0 0h24v24H0z" stroke="none" /><path d="M4 6h16M4 12h16M4 18h16" /></svg>
          </button>
          
          <span id="hs_cos_wrapper_module_166186815647519_" class="hs_cos_wrapper hs_cos_wrapper_widget hs_cos_wrapper_type_logo" style="" data-hs-cos-general-type="widget" data-hs-cos-type="logo"><a href="https://www.secureideas.com" id="hs-link-module_166186815647519_" style="border-width:0px;border:0px;"><img src="https://www.secureideas.com/hubfs/2024_Full_Logo_Full_Color_SVG%20(1).svg" class="hs-image-widget " height="1930" style="height: auto;width:4167px;border-width:0px;border:0px;" width="4167" alt="2024_Full_Logo_Full_Color_SVG (1)" title="2024_Full_Logo_Full_Color_SVG (1)" loading=""></a></span>
        </div>
        <div class="navigation-menu font-primary">
          <span id="hs_cos_wrapper_module_166186815647519_" class="hs_cos_wrapper hs_cos_wrapper_widget hs_cos_wrapper_type_menu" style="" data-hs-cos-general-type="widget" data-hs-cos-type="menu"><div id="hs_menu_wrapper_module_166186815647519_" class="hs-menu-wrapper active-branch no-flyouts hs-menu-flow-horizontal" role="navigation" data-sitemap-name="default" data-menu-id="86453802605" aria-label="Navigation Menu">
 <ul role="menu">
  <li class="hs-menu-item hs-menu-depth-1 hs-item-has-children" role="none"><a href="javascript:;" aria-haspopup="true" aria-expanded="false" role="menuitem">Services</a>
   <ul role="menu" class="hs-menu-children-wrapper">
    <li class="hs-menu-item hs-menu-depth-2" role="none"><a href="https://www.secureideas.com/penetration-test" role="menuitem">Penetration Testing</a></li>
    <li class="hs-menu-item hs-menu-depth-2" role="none"><a href="https://www.secureideas.com/consulting-advisory" role="menuitem">Consulting &amp; Advisory Services</a></li>
    <li class="hs-menu-item hs-menu-depth-2" role="none"><a href="https://www.secureideas.com/expert-witness-services" role="menuitem">Expert Witness Services</a></li>
    <li class="hs-menu-item hs-menu-depth-2" role="none"><a href="https://www.secureideas.com/security-assessment" role="menuitem">Security Assessments</a></li>
    <li class="hs-menu-item hs-menu-depth-2" role="none"><a href="https://www.secureideas.com/vulnerability-management" role="menuitem">Vulnerability Management</a></li>
    <li class="hs-menu-item hs-menu-depth-2" role="none"><a href="https://www.secureideas.com/training" role="menuitem">Training</a></li>
   </ul></li>
  <li class="hs-menu-item hs-menu-depth-1 hs-item-has-children" role="none"><a href="javascript:;" aria-haspopup="true" aria-expanded="false" role="menuitem">Products</a>
   <ul role="menu" class="hs-menu-children-wrapper">
    <li class="hs-menu-item hs-menu-depth-2" role="none"><a href="https://www.secureideas.com/professionally-evil-testing-as-a-service" role="menuitem">Testing as a Service</a></li>
    <li class="hs-menu-item hs-menu-depth-2" role="none"><a href="https://www.secureideas.com/dark-web-monitoring" role="menuitem">Threat Exposure Management</a></li>
    <li class="hs-menu-item hs-menu-depth-2" role="none"><a href="https://www.secureideas.com/cloudscout" role="menuitem">CloudScout</a></li>
    <li class="hs-menu-item hs-menu-depth-2" role="none"><a href="https://www.secureideas.com/networkscout" role="menuitem">NetworkScout</a></li>
    <li class="hs-menu-item hs-menu-depth-2" role="none"><a href="https://www.secureideas.com/webscout" role="menuitem">WebScout</a></li>
   </ul></li>
  <li class="hs-menu-item hs-menu-depth-1 hs-item-has-children" role="none"><a href="javascript:;" aria-haspopup="true" aria-expanded="false" role="menuitem">Resources</a>
   <ul role="menu" class="hs-menu-children-wrapper">
    <li class="hs-menu-item hs-menu-depth-2" role="none"><a href="https://www.secureideas.com/blog" role="menuitem">Blog</a></li>
    <li class="hs-menu-item hs-menu-depth-2" role="none"><a href="https://www.secureideas.com/knowledge" role="menuitem">Knowledge Center</a></li>
    <li class="hs-menu-item hs-menu-depth-2" role="none"><a href="https://www.secureideas.com/what-is-penetration-testing" role="menuitem">What is Penetration Testing</a></li>
    <li class="hs-menu-item hs-menu-depth-2" role="none"><a href="https://www.secureideas.com/podcasts" role="menuitem">Podcasts</a></li>
    <li class="hs-menu-item hs-menu-depth-2" role="none"><a href="https://www.secureideas.com/webcast" role="menuitem">Webcast</a></li>
   </ul></li>
  <li class="hs-menu-item hs-menu-depth-1" role="none"><a href="https://www.secureideas.com/pricing" role="menuitem">Pricing</a></li>
  <li class="hs-menu-item hs-menu-depth-1" role="none"><a href="https://www.secureideas.com/events" role="menuitem">Events</a></li>
  <li class="hs-menu-item hs-menu-depth-1" role="none"><a href="https://www.secureideas.com/our-team" role="menuitem">Our Team</a></li>
 </ul>
</div></span>
          
          
          
          <a href="https://portal.secureideas.com/" class="flex font-primary text-purple-dark font-semibold lg:hidden items-center space-x-2 hover:underline" target="_blank" rel="noopener">
            <span>Client Portal</span>
            <span>
              <svg class="stroke-current w-5 h-5" viewbox="0 0 24 24" stroke-width="3" stroke="#fff" fill="none" stroke-linecap="round" stroke-linejoin="round"><path d="M0 0h24v24H0z" stroke="none" /><path d="M11 7H6a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h9a2 2 0 0 0 2-2v-5M10 14 20 4M15 4h5v5" /></svg>
            </span>
          </a>
          
          
        </div>
      </div>
      <div class="flex-shrink-0 flex items-center space-x-3 xl:space-x-6">
        
        
        
        <a href="https://portal.secureideas.com/" class="hidden font-primary text-purple-dark font-semibold lg:flex items-center space-x-2 hover:underline" target="_blank" rel="noopener">
          <span>Client Portal</span>
          <span>
            <svg class="stroke-current w-5 h-5" viewbox="0 0 24 24" stroke-width="3" stroke="#fff" fill="none" stroke-linecap="round" stroke-linejoin="round"><path d="M0 0h24v24H0z" stroke="none" /><path d="M11 7H6a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h9a2 2 0 0 0 2-2v-5M10 14 20 4M15 4h5v5" /></svg>
          </span>
        </a>
        
        
        
        <div class="btn btn-primary">
          
          
          
          <a href="https://www.secureideas.com/contact" target="_blank" rel="noopener">
            Contact us
          </a>

          
        </div>
        
        
      </div>
    </div>
  </div>
</header>
<style>
  .navigation-menu .hs-menu-wrapper > ul li ul li:before{
    background-image:url(https://www.secureideas.com/hubfs/raw_assets/public/SecureIdeas-2022/assets/images/right-arrow-nav.svg);
  }
</style></div></div>
      

      <main id="main-content" class="body-container-wrapper">
        
<div>
  <div id="hs_cos_wrapper_module_16621475137391" class="hs_cos_wrapper hs_cos_wrapper_widget hs_cos_wrapper_type_module" style="" data-hs-cos-general-type="widget" data-hs-cos-type="module"><div class="bg-no-repeat bg-top bg-blog-shape">
  <div class="max-w-2xl mx-auto pt-8 md:pt-16 pb-10 px-5">
    <div class="mb-3 text-sm font-bold md:flex items-center text-white">
      <span class="pr-4 block">
        11
        April,
        2018
      </span>
      
    </div>
    <h1 class="text-2xl md:text-3xl lg:text-4xl font-bold mb-5 text-white">
      <span id="hs_cos_wrapper_name" class="hs_cos_wrapper hs_cos_wrapper_meta_field hs_cos_wrapper_type_text" style="" data-hs-cos-general-type="meta_field" data-hs-cos-type="text">Ever Run a Relay? Why SMB Relays Should Be On Your Mind</span>
    </h1>
    
    <div class="aspect-w-16 aspect-h-9">
      <img class="w-full h-full object-center object-cover" src="https://www.secureideas.com/hubfs/NTLMauth-1.webp" alt="Ever Run a Relay? Why SMB Relays Should Be On Your Mind">
    </div>
    
    <div class="py-5 border-b border-dark flex items-center justify-between space-x-2">
      <div class="flex items-center space-x-2">
        <div class="w-12 h-12 rounded-full overflow-hidden">
          <img src="https://www.secureideas.com/hubfs/eric.webp" alt="Eric Kuehn" class="w-full h-full object-center object-cover">
        </div>
        <span>
          <span class="block text-slate-light font-bold">Author:</span>
          <span class="block md:text-lg lg:text-xl text-teal font-black"><a href="https://www.secureideas.com/blog/author/eric-kuehn">Eric Kuehn</a></span>
        </span>
      </div>
      <div>
        <span class="block text-slate-light font-bold mb-2">Share:</span>
        <ul class="flex items-center space-x-3">
        <li>
          <a href="http://www.facebook.com/sharer.php?u=https://www.secureideas.com/blog/2018/04/ever-run-a-relay-why-smb-relays-should-be-on-your-mind.html" target="_blank" rel="noopener">
            <svg class="fill-current text-teal w-5 h-5" viewbox="0 0 24 24"><path d="M9 8h-3v4h3v12h5v-12h3.642l.358-4h-4v-1.667c0-.955.192-1.333 1.115-1.333h2.885v-5h-3.808c-3.596 0-5.192 1.583-5.192 4.615v3.385z" /></svg>
          </a>
        </li>
        <li>
          <a href="http://www.linkedin.com/shareArticle?mini=true&amp;url=https://www.secureideas.com/blog/2018/04/ever-run-a-relay-why-smb-relays-should-be-on-your-mind.html" target="_blank" rel="noopener">
            <svg class="fill-current text-teal w-5 h-5" viewbox="0 0 24 24"><path d="M4.98 3.5c0 1.381-1.11 2.5-2.48 2.5s-2.48-1.119-2.48-2.5c0-1.38 1.11-2.5 2.48-2.5s2.48 1.12 2.48 2.5zm.02 4.5h-5v16h5v-16zm7.982 0h-4.968v16h4.969v-8.399c0-4.67 6.029-5.052 6.029 0v8.399h4.988v-10.131c0-7.88-8.922-7.593-11.018-3.714v-2.155z" /></svg>
          </a>
        </li>
        <li>
          <a href="https://twitter.com/share?url=https://www.secureideas.com/blog/2018/04/ever-run-a-relay-why-smb-relays-should-be-on-your-mind.html" target="_blank" rel="noopener">
            <svg class="fill-current text-teal w-5 h-5" viewbox="0 0 24 24"><path d="M24 4.557c-.883.392-1.832.656-2.828.775 1.017-.609 1.798-1.574 2.165-2.724-.951.564-2.005.974-3.127 1.195-.897-.957-2.178-1.555-3.594-1.555-3.179 0-5.515 2.966-4.797 6.045-4.091-.205-7.719-2.165-10.148-5.144-1.29 2.213-.669 5.108 1.523 6.574-.806-.026-1.566-.247-2.229-.616-.054 2.281 1.581 4.415 3.949 4.89-.693.188-1.452.232-2.224.084.626 1.956 2.444 3.379 4.6 3.419-2.07 1.623-4.678 2.348-7.29 2.04 2.179 1.397 4.768 2.212 7.548 2.212 9.142 0 14.307-7.721 13.995-14.646.962-.695 1.797-1.562 2.457-2.549z" /></svg>
          </a>
        </li>
      </ul>
      </div>
    </div>
    <div class="py-5 text-slate-light blog-post-body leading-relaxed">
      <span id="hs_cos_wrapper_post_body" class="hs_cos_wrapper hs_cos_wrapper_meta_field hs_cos_wrapper_type_rich_text" style="" data-hs-cos-general-type="meta_field" data-hs-cos-type="rich_text"><div class="ast-post-format- ast-no-thumb single-layout-1"><header class="entry-header ast-no-thumbnail">
<div class="ast-single-post-order">&nbsp;</div>
</header>
<div class="entry-content clear" itemprop="text">
<p><span style="font-weight: 400;">Time is never on your side when you’re onsite with a client and trying to get the first good foothold, with admin privileges, can seem impossible. &nbsp;However, some things seem to work more often than others. One of my current, favorite methods to jump start my access in a network is to use an SMB relay. &nbsp;SMB relays can help attackers move through a network as they escalate their privileges at the same time. What’s not to like about gaining admin access to a server when all you have is a normal user account? &nbsp;Technically, you don’t need to even have an account yet, just your attack host connected to the network.</span></p>
<p><span style="font-weight: 400;">This attack vector isn’t new, but it is still so very effective; mainly because very few organizations have implemented any methods to protect against it. &nbsp;Admittedly, some of these protections tend to be impractical in most Windows environments. In addition, there are multiple tools and utilities out there that can be used to initiate this attack. &nbsp;Examples include Kevin Robertson’s Inveigh-Relay (</span><a href="https://github.com/Kevin-Robertson/Inveigh"><span style="font-weight: 400;">https://github.com/Kevin-Robertson/Inveigh</span></a><span style="font-weight: 400;">), Laurent Gaffie’s MultiRelay (</span><a href="https://github.com/lgandx/Responder"><span style="font-weight: 400;">https://github.com/lgandx/Responder</span></a><span style="font-weight: 400;">), and Core Security’s Impacket (</span><a href="https://github.com/CoreSecurity/impacket"><span style="font-weight: 400;">https://github.com/CoreSecurity/impacket</span></a><span style="font-weight: 400;">).</span></p>
<p><span style="font-weight: 400;">So let’s dig into the SMB relay: see how it works, what can be done to protect against it, and how to detect if it has been used against you.</span></p>
<h3><span style="font-weight: 400;">How Does It Work?</span></h3>
<p><span style="font-weight: 400;">Similar to a Pass-the-Hash attack, the SMB relay exploits the challenge/response methodology of NTLM based authentication. &nbsp;Unlike most PTH attacks, where an attacker gathers the password hash of an account and tries to use it later, the SMB relay does its work as the authentication process is occuring. &nbsp;This is the real beauty, because it means that these attacks bypass multi-factor authentication requirements and will work with NTLMv2.</span></p>
<p><span style="font-weight: 400;">Here’s a quick high-level description of how NTLM authentication works.</span></p>
<p><a href="https://f.hubspotusercontent00.net/hubfs/19799800/Imported_Blog_Media/NTLMauth-1.png" rel="noopener"><img loading="lazy" class="wp-image-1133 aligncenter" src="https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/NTLMauth-1.png?width=567&amp;height=285&amp;name=NTLMauth-1.png" alt="example 1" width="567" height="285" srcset="https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/NTLMauth-1.png?width=284&amp;height=143&amp;name=NTLMauth-1.png 284w, https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/NTLMauth-1.png?width=567&amp;height=285&amp;name=NTLMauth-1.png 567w, https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/NTLMauth-1.png?width=851&amp;height=428&amp;name=NTLMauth-1.png 851w, https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/NTLMauth-1.png?width=1134&amp;height=570&amp;name=NTLMauth-1.png 1134w, https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/NTLMauth-1.png?width=1418&amp;height=713&amp;name=NTLMauth-1.png 1418w, https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/NTLMauth-1.png?width=1701&amp;height=855&amp;name=NTLMauth-1.png 1701w" sizes="(max-width: 567px) 100vw, 567px"></a></p>
<p><span style="font-weight: 400;">A user requests access to a resource on a different device. &nbsp;The remote device asks for a verification of the user’s identity by sending a random, 8-byte number to the client. &nbsp;The client takes this number, takes the user’s password hash, performs a calculation on the number, and then sends that computed result back to the remote device. &nbsp;The remote device checks that the result matches what it expects. If it gets a valid response, it allows the user access to the resource. </span></p>
<p><span style="font-weight: 400;">SMB relays are inserted in this authentication path, forwarding the requests and responses between the user’s client and a device the attacker actually wants access to. &nbsp;An attacker selects the target and waits for something to authenticate to their attacking device (i.e. an already compromised client workstation). When something tries to access the attacking device with NTLM authentication, the attacking device forwards the authentication attempt to the target. &nbsp;The target generates the challenge request and sends it to the attacker. The attacker forwards that challenge back to the original device trying to authenticate to the attacking device. The original system encrypts the challenge with the correct hash and sends that to the attacking device. The attacking device then forwards the correctly encrypted response to the target and successfully authenticates, just as if the original device was authenticating to the target and not the attacking device. &nbsp;</span></p>
<p><span style="font-weight: 400;">What good does this do? &nbsp;The attacker gets password hashes (which may or may not be usable in other PTH attacks, depending on the version of NTLM being used) and gets the chance to run a command against the remote device using the same permissions of the user who connected to the attacker’s device. &nbsp;If those credentials have administrative rights on the target, the attacker could do almost anything they wanted to do. This could be establishing a Meterpreter session with Metasploit, connecting it to PSEmpire, running Mimikatz, or simply creating a new administrative user account on the remote device.</span></p>
<p><span style="font-weight: 400;">This process may seem hit or miss, because it needs someone or something to try to authenticate to the malicious device. &nbsp;However, in most networks, some process periodically comes along and checks devices for configurations or patch levels, or something. &nbsp;If those processes are credential based, the SMB relay will forward them on. Real attackers may have time to wait for that weekly or monthly process to come along. &nbsp;Since I use this in pen tests that typically only have a week-long timeframe, I like to use an LLMNR Poisoner to gather hashes as they move through the network. &nbsp;Each time one of these tools finds a hash, it sends it to the SMB relay which tries them on the target. </span></p>
<p><span style="font-weight: 400;">In my example, below, I am using Inveigh and Inveigh-Relay to try to add a user account, </span><i><span style="font-weight: 400;">lab\user1</span></i><span style="font-weight: 400;">, to the administrators group on a Windows 2012 R2 server, </span><i><span style="font-weight: 400;">192.168.100.2</span></i><span style="font-weight: 400;">.</span></p>
<p><a href="https://f.hubspotusercontent00.net/hubfs/19799800/Imported_Blog_Media/SMBRelay-Start-1.png" rel="noopener"><img loading="lazy" class=" wp-image-1134 aligncenter" src="https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/SMBRelay-Start-1.png?width=699&amp;height=377&amp;name=SMBRelay-Start-1.png" alt="example 2" width="699" height="377" srcset="https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/SMBRelay-Start-1.png?width=350&amp;height=189&amp;name=SMBRelay-Start-1.png 350w, https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/SMBRelay-Start-1.png?width=699&amp;height=377&amp;name=SMBRelay-Start-1.png 699w, https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/SMBRelay-Start-1.png?width=1049&amp;height=566&amp;name=SMBRelay-Start-1.png 1049w, https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/SMBRelay-Start-1.png?width=1398&amp;height=754&amp;name=SMBRelay-Start-1.png 1398w, https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/SMBRelay-Start-1.png?width=1748&amp;height=943&amp;name=SMBRelay-Start-1.png 1748w, https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/SMBRelay-Start-1.png?width=2097&amp;height=1131&amp;name=SMBRelay-Start-1.png 2097w" sizes="(max-width: 699px) 100vw, 699px"></a></p>
<p><span style="font-weight: 400;">When Inveigh got a hit, it gathered an NTLMv2 hash and sent it on to the target. &nbsp;Since the user was an administrator, the relay ran the command and then stopped. &nbsp;Even if the user had not been an administrator, the relay still captured the hash. &nbsp;I could take it and try to crack it off line.</span></p>
<p><a href="https://f.hubspotusercontent00.net/hubfs/19799800/Imported_Blog_Media/SMBRelay-Success-1.png" rel="noopener"><img loading="lazy" class=" wp-image-1136 aligncenter" src="https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/SMBRelay-Success-1.png?width=700&amp;height=277&amp;name=SMBRelay-Success-1.png" alt="example 3" width="700" height="277" srcset="https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/SMBRelay-Success-1.png?width=350&amp;height=139&amp;name=SMBRelay-Success-1.png 350w, https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/SMBRelay-Success-1.png?width=700&amp;height=277&amp;name=SMBRelay-Success-1.png 700w, https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/SMBRelay-Success-1.png?width=1050&amp;height=416&amp;name=SMBRelay-Success-1.png 1050w, https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/SMBRelay-Success-1.png?width=1400&amp;height=554&amp;name=SMBRelay-Success-1.png 1400w, https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/SMBRelay-Success-1.png?width=1750&amp;height=693&amp;name=SMBRelay-Success-1.png 1750w, https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/SMBRelay-Success-1.png?width=2100&amp;height=831&amp;name=SMBRelay-Success-1.png 2100w" sizes="(max-width: 700px) 100vw, 700px"></a></p>
<p><span style="font-weight: 400;">Looking at the membership of the group, we see the lab\user1 account is now a member. &nbsp;Let the fun begin!</span></p>
<p><a href="https://f.hubspotusercontent00.net/hubfs/19799800/Imported_Blog_Media/AdministratorsMembers-1.png" rel="noopener"><img loading="lazy" class="size-full wp-image-1137 aligncenter" src="https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/AdministratorsMembers-1.png?width=412&amp;height=461&amp;name=AdministratorsMembers-1.png" alt="example 4" width="412" height="461" srcset="https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/AdministratorsMembers-1.png?width=206&amp;height=231&amp;name=AdministratorsMembers-1.png 206w, https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/AdministratorsMembers-1.png?width=412&amp;height=461&amp;name=AdministratorsMembers-1.png 412w, https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/AdministratorsMembers-1.png?width=618&amp;height=692&amp;name=AdministratorsMembers-1.png 618w, https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/AdministratorsMembers-1.png?width=824&amp;height=922&amp;name=AdministratorsMembers-1.png 824w, https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/AdministratorsMembers-1.png?width=1030&amp;height=1153&amp;name=AdministratorsMembers-1.png 1030w, https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/AdministratorsMembers-1.png?width=1236&amp;height=1383&amp;name=AdministratorsMembers-1.png 1236w" sizes="(max-width: 412px) 100vw, 412px"></a></p>
<h3><span style="font-weight: 400;">Protecting Against It</span></h3>
<p><span style="font-weight: 400;">One core method of protecting against SMB relays is to not allow any NTLM authentication to occur on the network. &nbsp;This is easier than it sounds. Sure, Windows devices attempt to use Kerberos as their primary method for authentication but unless NTLM has been completely disabled, Windows devices will drop down to NTLM if anything prevents Kerberos from working (such as not having valid SPNs for the host or application). &nbsp;Not to mention, there are still applications and services that don’t use Kerberos; making disabling it all but impossible. I have yet to hear of anyone who has completely disabled NTLM on all devices in their network.</span></p>
<p><span style="font-weight: 400;">Another option is to enable SMB signing on all devices. &nbsp;SMB signing allows the devices to conform the point of origin and authenticity of each SMB packet. &nbsp;If the packet doesn’t check out, it is dropped. This prevents the man in the middle scenario exploited by SMB relays. &nbsp;However, it can cause rather significant performance issues with file copies, especially large files. Microsoft states a 15% increase in time (<a href="https://technet.microsoft.com/en-us/library/cc731957(v=ws.11).aspx">https://technet.microsoft.com/en-us/library/cc731957(v=ws.11).aspx</a>) but there have been reports of huge delays in the time copies take.</span></p>
<p><span style="font-weight: 400;">As shown by my Inveigh-Relay test, if it detects the target is using SMB signing, Inveigh just stops trying.</span></p>
<p><a href="https://f.hubspotusercontent00.net/hubfs/19799800/Imported_Blog_Media/SMBRelay-Failure_Signing-1.png" rel="noopener"><img loading="lazy" class=" wp-image-1138 aligncenter" src="https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/SMBRelay-Failure_Signing-1.png?width=689&amp;height=141&amp;name=SMBRelay-Failure_Signing-1.png" alt="example 5" width="689" height="141" srcset="https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/SMBRelay-Failure_Signing-1.png?width=345&amp;height=71&amp;name=SMBRelay-Failure_Signing-1.png 345w, https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/SMBRelay-Failure_Signing-1.png?width=689&amp;height=141&amp;name=SMBRelay-Failure_Signing-1.png 689w, https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/SMBRelay-Failure_Signing-1.png?width=1034&amp;height=212&amp;name=SMBRelay-Failure_Signing-1.png 1034w, https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/SMBRelay-Failure_Signing-1.png?width=1378&amp;height=282&amp;name=SMBRelay-Failure_Signing-1.png 1378w, https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/SMBRelay-Failure_Signing-1.png?width=1723&amp;height=353&amp;name=SMBRelay-Failure_Signing-1.png 1723w, https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/SMBRelay-Failure_Signing-1.png?width=2067&amp;height=423&amp;name=SMBRelay-Failure_Signing-1.png 2067w" sizes="(max-width: 689px) 100vw, 689px"></a></p>
<p><span style="font-weight: 400;">By default, all Domain Controllers are configured to require SMB signing but all other devices are not. So, pen testers should avoid using DCs as targets unless you know the organization has disabled that setting.</span></p>
<p><span style="font-weight: 400;">Next up for potential protection options is having a strict account tiering/restriction policy. &nbsp;This takes planning and ongoing maintenance of multiple accounts for services and administrators. &nbsp;Really, this is a whole discussion on its own, but I’ll try to do a quick summary. Gone are the days of adding accounts to Domain Admins so that the accounts can have administrative access to all devices on the network. &nbsp;The more security focused approach is to minimize an attacker’s ability to escalate privileges or move laterally through the network. For example, Domain Admins should only be used for functions that require that level of access (i.e. adding new DCs to the Domain) and should only logon to Domain Controllers (or other devices dedicated to Domain Admin functions). &nbsp;Similarly, there should not be accounts that have administrative access to workstations and servers. In the case of the SMB relay, an attacker can’t gain access to their target if the accounts connecting to their device don’t have administrative rights on the target.</span></p>
<p><span style="font-weight: 400;">The last option I am going to discuss is the use of Protect Users group membership. &nbsp;The Protected Users group was introduced with Server 2012 R2. Depending on what versions of Windows OSes you have deployed in your environment and your domain’s Functional Level, IDs in this group gain a slew of security enhancements (and restrictions). &nbsp;I’m going to write about one of these protections. If your Domain is running at 2012 R2 DFL or higher (if you’ve managed to upgrade all of your DCs to Server 2016 already), any members of the Protected Users group can no longer use NTLM for authentication. &nbsp;This is both good and bad. It will prevent all PTH and SMB relay attacks, but it also means that the accounts may not work with all applications in your environment.</span></p>
<p><span style="font-weight: 400;">As shown below, when Inveigh-Relay tries to use credentials from a user in the Protected Users group, the authentication fails. &nbsp;Therefore, the SMB relay continues running, waiting for another connection. The relay did capture the hash but, it is unusable unless it can be cracked.</span></p>
<p><a href="https://f.hubspotusercontent00.net/hubfs/19799800/Imported_Blog_Media/SMBRelay-Failure_Protected-1.png" rel="noopener"><img loading="lazy" class=" wp-image-1139 aligncenter" src="https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/SMBRelay-Failure_Protected-1.png?width=703&amp;height=211&amp;name=SMBRelay-Failure_Protected-1.png" alt="example 6" width="703" height="211" srcset="https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/SMBRelay-Failure_Protected-1.png?width=352&amp;height=106&amp;name=SMBRelay-Failure_Protected-1.png 352w, https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/SMBRelay-Failure_Protected-1.png?width=703&amp;height=211&amp;name=SMBRelay-Failure_Protected-1.png 703w, https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/SMBRelay-Failure_Protected-1.png?width=1055&amp;height=317&amp;name=SMBRelay-Failure_Protected-1.png 1055w, https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/SMBRelay-Failure_Protected-1.png?width=1406&amp;height=422&amp;name=SMBRelay-Failure_Protected-1.png 1406w, https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/SMBRelay-Failure_Protected-1.png?width=1758&amp;height=528&amp;name=SMBRelay-Failure_Protected-1.png 1758w, https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/SMBRelay-Failure_Protected-1.png?width=2109&amp;height=633&amp;name=SMBRelay-Failure_Protected-1.png 2109w" sizes="(max-width: 703px) 100vw, 703px"></a></p>
<p><span style="font-weight: 400;">It is important to note that this was a failed logon attempt for the account. &nbsp;This is true for any NTLM authentication requests for users in the Protected Users group. &nbsp;They are all considered bad or failed attempts. Too many of these and the account will get locked out. &nbsp;Beyond this behavior, there are a couple of other caveats to take into account before using the group. This article, </span><a href="https://docs.microsoft.com/en-us/windows-server/security/credentials-protection-and-management/protected-users-security-group"><span style="font-weight: 400;">https://docs.microsoft.com/en-us/windows-server/security/credentials-protection-and-management/protected-users-security-group</span></a><span style="font-weight: 400;">, provides some more information on the group, its benefits, and things to do before adding a user to it.</span></p>
<h3><span style="font-weight: 400;">Detecting an SMB Relay Attack</span></h3>
<p><span style="font-weight: 400;">One important note about detecting the SMB Relay through Windows events: if you detect it, it means it was successful. &nbsp;Therefore, you have a very short period of time to react. In addition, the events being searched for could also be generated during normal maintenance where applications are being installed or updated on a Windows device.</span></p>
<p><span style="font-weight: 400;">In order to have your device log all of the events, you must enable the Security System Extension audit policy under the System category. &nbsp;</span></p>
<p><a href="https://f.hubspotusercontent00.net/hubfs/19799800/Imported_Blog_Media/AuditNewServicesSetting-1.png" rel="noopener"><img loading="lazy" class=" wp-image-1140 aligncenter" src="https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/AuditNewServicesSetting-1.png?width=626&amp;height=435&amp;name=AuditNewServicesSetting-1.png" alt="example 7" width="626" height="435" srcset="https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/AuditNewServicesSetting-1.png?width=313&amp;height=218&amp;name=AuditNewServicesSetting-1.png 313w, https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/AuditNewServicesSetting-1.png?width=626&amp;height=435&amp;name=AuditNewServicesSetting-1.png 626w, https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/AuditNewServicesSetting-1.png?width=939&amp;height=653&amp;name=AuditNewServicesSetting-1.png 939w, https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/AuditNewServicesSetting-1.png?width=1252&amp;height=870&amp;name=AuditNewServicesSetting-1.png 1252w, https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/AuditNewServicesSetting-1.png?width=1565&amp;height=1088&amp;name=AuditNewServicesSetting-1.png 1565w, https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/AuditNewServicesSetting-1.png?width=1878&amp;height=1305&amp;name=AuditNewServicesSetting-1.png 1878w" sizes="(max-width: 626px) 100vw, 626px"></a></p>
<p><span style="font-weight: 400;">This will allow the system to generate events when new services are installed on it. &nbsp;Look for events 4697 in the Security event log and 7045 in the System event log. The official documented event from Microsoft is 4697. &nbsp;However, in all of my tests, my Windows 2012 R2 server only generated the 7045 events.</span></p>
<p><span style="font-weight: 400;">From my successful SMB relay attack example against 192.168.100.2, the relay created a service named </span><i><span style="font-weight: 400;">SBEJYKICJUYFGUATKRRO</span></i><span style="font-weight: 400;">. &nbsp;This name was randomly generated and other tools use different methods for the names they assign to the services.</span></p>
<p><a href="https://f.hubspotusercontent00.net/hubfs/19799800/Imported_Blog_Media/SMBRelay-ServiceName-1.png" rel="noopener"><img loading="lazy" class="size-full wp-image-1141 aligncenter" src="https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/SMBRelay-ServiceName-1.png?width=579&amp;height=125&amp;name=SMBRelay-ServiceName-1.png" alt="example 8" width="579" height="125" srcset="https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/SMBRelay-ServiceName-1.png?width=290&amp;height=63&amp;name=SMBRelay-ServiceName-1.png 290w, https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/SMBRelay-ServiceName-1.png?width=579&amp;height=125&amp;name=SMBRelay-ServiceName-1.png 579w, https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/SMBRelay-ServiceName-1.png?width=869&amp;height=188&amp;name=SMBRelay-ServiceName-1.png 869w, https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/SMBRelay-ServiceName-1.png?width=1158&amp;height=250&amp;name=SMBRelay-ServiceName-1.png 1158w, https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/SMBRelay-ServiceName-1.png?width=1448&amp;height=313&amp;name=SMBRelay-ServiceName-1.png 1448w, https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/SMBRelay-ServiceName-1.png?width=1737&amp;height=375&amp;name=SMBRelay-ServiceName-1.png 1737w" sizes="(max-width: 579px) 100vw, 579px"></a></p>
<p><span style="font-weight: 400;">Looking at the event log on the server, we see a 7045 event has been generated in the System event log. &nbsp;It not only shows the name of the service but also what the service was trying to run at startup.</span></p>
<p style="text-align: center;"><a href="https://f.hubspotusercontent00.net/hubfs/19799800/Imported_Blog_Media/Event7045-1.png" rel="noopener"><img loading="lazy" class="alignnone wp-image-1142" src="https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/Event7045-1.png?width=550&amp;height=356&amp;name=Event7045-1.png" alt="example 9" width="550" height="356" srcset="https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/Event7045-1.png?width=275&amp;height=178&amp;name=Event7045-1.png 275w, https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/Event7045-1.png?width=550&amp;height=356&amp;name=Event7045-1.png 550w, https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/Event7045-1.png?width=825&amp;height=534&amp;name=Event7045-1.png 825w, https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/Event7045-1.png?width=1100&amp;height=712&amp;name=Event7045-1.png 1100w, https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/Event7045-1.png?width=1375&amp;height=890&amp;name=Event7045-1.png 1375w, https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/Event7045-1.png?width=1650&amp;height=1068&amp;name=Event7045-1.png 1650w" sizes="(max-width: 550px) 100vw, 550px"></a></p>
<p><span style="font-weight: 400;">Since this was not a true service, a 7009 event was also generated, stating that it timed out trying to start.</span></p>
<p style="text-align: center;"><a href="https://f.hubspotusercontent00.net/hubfs/19799800/Imported_Blog_Media/Event7009-1.png" rel="noopener"><img loading="lazy" class="alignnone wp-image-1143" src="https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/Event7009-1.png?width=551&amp;height=289&amp;name=Event7009-1.png" alt="example 10" width="551" height="289" srcset="https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/Event7009-1.png?width=276&amp;height=145&amp;name=Event7009-1.png 276w, https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/Event7009-1.png?width=551&amp;height=289&amp;name=Event7009-1.png 551w, https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/Event7009-1.png?width=827&amp;height=434&amp;name=Event7009-1.png 827w, https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/Event7009-1.png?width=1102&amp;height=578&amp;name=Event7009-1.png 1102w, https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/Event7009-1.png?width=1378&amp;height=723&amp;name=Event7009-1.png 1378w, https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/Event7009-1.png?width=1653&amp;height=867&amp;name=Event7009-1.png 1653w" sizes="(max-width: 551px) 100vw, 551px"></a></p>
<p><span style="font-weight: 400;">Depending on what the attacker is having the SMB relay execute, the 7009 event may not always be generated.</span></p>
<p><span style="font-weight: 400;">Since the 7045 event gives us the time of the attack, assuming you are logging successful logons (also a best practice), we can also see where the attack came from by finding the corresponding 4624 event in the Security event log.</span></p>
<p><a href="https://f.hubspotusercontent00.net/hubfs/19799800/Imported_Blog_Media/Event4624-1.png" rel="noopener"><img loading="lazy" class=" wp-image-1144 aligncenter" src="https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/Event4624-1.png?width=552&amp;height=501&amp;name=Event4624-1.png" alt="example 11" width="552" height="501" srcset="https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/Event4624-1.png?width=276&amp;height=251&amp;name=Event4624-1.png 276w, https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/Event4624-1.png?width=552&amp;height=501&amp;name=Event4624-1.png 552w, https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/Event4624-1.png?width=828&amp;height=752&amp;name=Event4624-1.png 828w, https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/Event4624-1.png?width=1104&amp;height=1002&amp;name=Event4624-1.png 1104w, https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/Event4624-1.png?width=1380&amp;height=1253&amp;name=Event4624-1.png 1380w, https://www.secureideas.com/hs-fs/hubfs/Imported_Blog_Media/Event4624-1.png?width=1656&amp;height=1503&amp;name=Event4624-1.png 1656w" sizes="(max-width: 552px) 100vw, 552px"></a></p>
<p><span style="font-weight: 400;">As a 7045 event is generated any time a new service is installed on a Windows device, it may not something you wish to get alerts on, especially since there isn’t much else you can filter on to guarantee the service is malicious versus a valid install. Even if you don’t want automated alerting, the auditing settings should still be enabled so that the events can be reviewed as part of an Incident Response investigation. &nbsp;However, if your organization has a mature monitoring process, where devices are placed into maintenance mode (suppressing alerts) during scheduled work, the number of false positives on servers should be remarkably low. Client laptops and desktops may still be a little noisy.</span></p>
<h3><span style="font-weight: 400;">Conclusion</span></h3>
<p><span style="font-weight: 400;">The SMB relay remains one of my go to attacks when I’m on site, performing a pen test. &nbsp;Rarely does it fail and, in most of those cases, it is because I was unable to get the right type of credentials to connect to my attacking device.&nbsp;</span></p>
<p><span style="font-weight: 400;">If you’re a pen tester who hasn’t used a SMB relay in the past, add it to your repertoire. &nbsp;I expect you’ll find it just as effective as me. </span></p>
<p><span style="font-weight: 400;">If you’re an architect or engineer who hasn’t seen this attack vector, please look at your environment and see how you can protect against it as well as detect it. &nbsp;While an attacker needs to gain a foothold on your network to use the SMB relay, you don’t want to leave an easy method for them to escalate and pivot through the network.</span></p>
</div>
<!-- .entry-content .clear --></div></span>
    </div>
  </div>
</div></div>
</div>
<div class="pb-10">
  <div id="hs_cos_wrapper_module_166343187524133" class="hs_cos_wrapper hs_cos_wrapper_widget hs_cos_wrapper_type_module" style="" data-hs-cos-general-type="widget" data-hs-cos-type="module"><section class="px-5">
  <div class="max-w-4xl mx-auto">
    <div class="bg-purple-dark text-white text-center p-6 sm:p-8 md:p-12 lg:p-16 theme-shadow rounded-md">
      <div class="mx-auto block lg:flex items-center space-x-0 lg:space-x-7 space-y-5 lg:space-y-0" style="max-width:px">
        
        <h2 class="flex-grow block font-secondary text-2xl md:text-3xl lg:text-4xl text-inherit font-bold text-center lg:text-left">
          Join the Professionally Evil newsletter
        </h2>
        
        <div class="font-primary text-center btn flex-shrink-0 btn btn-white">
          
          
          <a href="https://www.secureideas.com/newsletter">
            Sign Up
          </a>
        </div>
      </div>
    </div>
  </div>
</section></div>
</div>
<div class="pb-36">
  <div id="hs_cos_wrapper_module_166343317555350" class="hs_cos_wrapper hs_cos_wrapper_widget hs_cos_wrapper_type_module" style="" data-hs-cos-general-type="widget" data-hs-cos-type="module">

<div class="px-5">
  <div class="container">
    
    <h2 class="text-center mb-8">
      Related Resources
    </h2>
    
    <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-x-6 gap-y-10">
      
    </div>
  </div>
</div></div>
</div>

      </main>

      
      <div data-global-resource-path="SecureIdeas-2022/templates/partials/footer.html"><footer class="footer relative">
  <div class="cta-section absolute w-full left-0 -top-28">
    <div id="hs_cos_wrapper_module_1661671984042166" class="hs_cos_wrapper hs_cos_wrapper_widget hs_cos_wrapper_type_module" style="" data-hs-cos-general-type="widget" data-hs-cos-type="module"><section class="px-5">
  <div class="container global-cta bg-light-gray text-dark py-10 md:py-14 lg:py-20 px-7 rounded">
    <div class="max-w-5xl mx-auto block lg:flex items-center space-x-0 lg:space-x-7 space-y-5 lg:space-y-0">
      
      <h2 class="flex-grow block font-secondary text-2xl md:text-3xl lg:text-4xl text-inherit font-bold text-center lg:text-left">
        Curious if your business needs Security Consulting?
      </h2>
      
      
        <div class="font-primary text-center btn flex-shrink-0 btn-primary">
        

        
        
        <a href="https://www.secureideas.com/contact" class="w-full sm:w-auto">
          Contact Us	
        </a>

        
      </div>
      
    </div>
  </div>
</section></div>
  </div>
  <div class="footer-section px-5 py-44 md:py-48 lg:py-44">
    <div id="hs_cos_wrapper_module_1661671971903165" class="hs_cos_wrapper hs_cos_wrapper_widget hs_cos_wrapper_type_module" style="" data-hs-cos-general-type="widget" data-hs-cos-type="module"><section class="container">
  <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-6 md:gap-12 lg:gap-16 font-primary">
    <!-- Footer Column 1 -->
    <div>
      <span class="h-20 block mb-6">
        
        <img class="footer-logo w-auto h-full object-contain object-center" src="https://www.secureideas.com/hs-fs/hubfs/37838_Crest%20icons_2022_4_PT-.png?width=962&amp;height=786&amp;name=37838_Crest%20icons_2022_4_PT-.png" alt="37838_Crest icons_2022_4_PT-" loading="lazy" width="962" height="786" srcset="https://www.secureideas.com/hs-fs/hubfs/37838_Crest%20icons_2022_4_PT-.png?width=481&amp;height=393&amp;name=37838_Crest%20icons_2022_4_PT-.png 481w, https://www.secureideas.com/hs-fs/hubfs/37838_Crest%20icons_2022_4_PT-.png?width=962&amp;height=786&amp;name=37838_Crest%20icons_2022_4_PT-.png 962w, https://www.secureideas.com/hs-fs/hubfs/37838_Crest%20icons_2022_4_PT-.png?width=1443&amp;height=1179&amp;name=37838_Crest%20icons_2022_4_PT-.png 1443w, https://www.secureideas.com/hs-fs/hubfs/37838_Crest%20icons_2022_4_PT-.png?width=1924&amp;height=1572&amp;name=37838_Crest%20icons_2022_4_PT-.png 1924w, https://www.secureideas.com/hs-fs/hubfs/37838_Crest%20icons_2022_4_PT-.png?width=2405&amp;height=1965&amp;name=37838_Crest%20icons_2022_4_PT-.png 2405w, https://www.secureideas.com/hs-fs/hubfs/37838_Crest%20icons_2022_4_PT-.png?width=2886&amp;height=2358&amp;name=37838_Crest%20icons_2022_4_PT-.png 2886w" sizes="(max-width: 962px) 100vw, 962px">
        
      </span>
      
      <div class="richtext leading-relaxed">
        <p><strong>Main Office<br></strong> <span style="color: #000000;"><a href="https://maps.app.goo.gl/s9RTByxaP2aPW96N7" rel="noopener" style="color: #000000;">3412 Kori Rd.</a></span><br><span style="color: #000000;"><a href="https://maps.app.goo.gl/s9RTByxaP2aPW96N7" rel="noopener" id="__hsNewLink" style="color: #000000;">Jacksonville, Florida 32257, USA</a></span><span style="color: #000000;"></span></p>
      </div>
      
      
      <div class="mt-4 md:mt-7 flex items-center space-x-6 footer-social-media">
        
        
        
        <a href="https://www.facebook.com/SecureIdeasLLC" class="social-media-link">
          <span id="hs_cos_wrapper_module_1661671971903165_" class="hs_cos_wrapper hs_cos_wrapper_widget hs_cos_wrapper_type_icon" style="" data-hs-cos-general-type="widget" data-hs-cos-type="icon"><svg version="1.0" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 320 512" aria-hidden="true"><g id="Facebook F1_layer"><path d="M279.14 288l14.22-92.66h-88.91v-60.13c0-25.35 12.42-50.06 52.24-50.06h40.42V6.26S260.43 0 225.36 0c-73.22 0-121.08 44.38-121.08 124.72v70.62H22.89V288h81.39v224h100.17V288z" /></g></svg></span>
        </a>
        
        
        
        <a href="https://www.instagram.com/professionally_evil/" class="social-media-link">
          <span id="hs_cos_wrapper_module_1661671971903165_" class="hs_cos_wrapper hs_cos_wrapper_widget hs_cos_wrapper_type_icon" style="" data-hs-cos-general-type="widget" data-hs-cos-type="icon"><svg version="1.0" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 448 512" aria-hidden="true"><g id="Instagram2_layer"><path d="M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z" /></g></svg></span>
        </a>
        
        
        
        <a href="https://www.linkedin.com/company/secure-ideas/" class="social-media-link">
          <span id="hs_cos_wrapper_module_1661671971903165_" class="hs_cos_wrapper hs_cos_wrapper_widget hs_cos_wrapper_type_icon" style="" data-hs-cos-general-type="widget" data-hs-cos-type="icon"><svg version="1.0" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 448 512" aria-hidden="true"><g id="LinkedIn3_layer"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z" /></g></svg></span>
        </a>
        
        
        
        <a href="https://www.youtube.com/user/secureideas" class="social-media-link">
          <span id="hs_cos_wrapper_module_1661671971903165_" class="hs_cos_wrapper hs_cos_wrapper_widget hs_cos_wrapper_type_icon" style="" data-hs-cos-general-type="widget" data-hs-cos-type="icon"><svg version="1.0" xmlns="http://www.w3.org/2000/svg" viewbox="0 0 576 512" aria-hidden="true"><g id="YouTube4_layer"><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z" /></g></svg></span>
        </a>
        
      </div>
      
    </div>
    <!-- Footer Column 2 -->
    <div>
      
      <label class="block mb-4 font-bold">Services</label>
      
      <div class="simple-links-menu mb-4">
        <span id="hs_cos_wrapper_module_1661671971903165_" class="hs_cos_wrapper hs_cos_wrapper_widget hs_cos_wrapper_type_simple_menu" style="" data-hs-cos-general-type="widget" data-hs-cos-type="simple_menu"><div id="hs_menu_wrapper_module_1661671971903165_" class="hs-menu-wrapper active-branch flyouts hs-menu-flow-horizontal" role="navigation" data-sitemap-name="" data-menu-id="" aria-label="Navigation Menu">
 <ul role="menu">
  <li class="hs-menu-item hs-menu-depth-1" role="none"><a href="https://www.secureideas.com/penetration-test" role="menuitem" target="_self">Penetration Testing</a></li>
  <li class="hs-menu-item hs-menu-depth-1" role="none"><a href="https://www.secureideas.com/consulting-advisory" role="menuitem" target="_self">Consulting &amp; Advisory Services</a></li>
  <li class="hs-menu-item hs-menu-depth-1" role="none"><a href="https://www.secureideas.com/expert-witness-services" role="menuitem" target="_self">Expert Witness Services</a></li>
  <li class="hs-menu-item hs-menu-depth-1" role="none"><a href="https://www.secureideas.com/security-assessment" role="menuitem" target="_self">Security Assessments</a></li>
  <li class="hs-menu-item hs-menu-depth-1" role="none"><a href="https://www.secureideas.com/vulnerability-management" role="menuitem" target="_self">Vulnerability Management</a></li>
  <li class="hs-menu-item hs-menu-depth-1" role="none"><a href="https://www.secureideas.com/training" role="menuitem" target="_self">Classes &amp; Training</a></li>
 </ul>
</div></span>
      </div>
    </div>
    <!-- Footer Column 3 -->
    <div>
      
      <label class="block mb-4 font-bold">Resources</label>
      
      <div class="simple-links-menu mb-4">
        <span id="hs_cos_wrapper_module_1661671971903165_" class="hs_cos_wrapper hs_cos_wrapper_widget hs_cos_wrapper_type_simple_menu" style="" data-hs-cos-general-type="widget" data-hs-cos-type="simple_menu"><div id="hs_menu_wrapper_module_1661671971903165_" class="hs-menu-wrapper active-branch flyouts hs-menu-flow-horizontal" role="navigation" data-sitemap-name="" data-menu-id="" aria-label="Navigation Menu">
 <ul role="menu">
  <li class="hs-menu-item hs-menu-depth-1" role="none"><a href="https://www.secureideas.com/knowledge" role="menuitem" target="_self">Knowledge Center</a></li>
  <li class="hs-menu-item hs-menu-depth-1" role="none"><a href="https://www.secureideas.com/blog" role="menuitem" target="_self">Blog</a></li>
  <li class="hs-menu-item hs-menu-depth-1" role="none"><a href="https://www.secureideas.com/webcast" role="menuitem" target="_self">Webcasts</a></li>
  <li class="hs-menu-item hs-menu-depth-1" role="none"><a href="https://www.secureideas.com/podcasts" role="menuitem" target="_self">Podcasts</a></li>
  <li class="hs-menu-item hs-menu-depth-1" role="none"><a href="https://www.secureideas.com/events" role="menuitem" target="_self">Events</a></li>
  <li class="hs-menu-item hs-menu-depth-1" role="none"><a href="https://www.secureideas.com/pricing" role="menuitem" target="_self">Pricing Calculator</a></li>
 </ul>
</div></span>
      </div>
    </div>
    <!-- Footer Column 4 -->
    <div>
      
      <label class="block mb-4 font-bold">Company</label>
      
      <div class="simple-links-menu">
        <span id="hs_cos_wrapper_module_1661671971903165_" class="hs_cos_wrapper hs_cos_wrapper_widget hs_cos_wrapper_type_simple_menu" style="" data-hs-cos-general-type="widget" data-hs-cos-type="simple_menu"><div id="hs_menu_wrapper_module_1661671971903165_" class="hs-menu-wrapper active-branch flyouts hs-menu-flow-horizontal" role="navigation" data-sitemap-name="" data-menu-id="" aria-label="Navigation Menu">
 <ul role="menu">
  <li class="hs-menu-item hs-menu-depth-1" role="none"><a href="https://portal.secureideas.com/" role="menuitem" target="_self">Client Portal</a></li>
  <li class="hs-menu-item hs-menu-depth-1" role="none"><a href="https://www.secureideas.com/contact" role="menuitem" target="_self">Contact Us</a></li>
  <li class="hs-menu-item hs-menu-depth-1" role="none"><a href="https://www.secureideas.com/privacy-policy" role="menuitem" target="_self">Privacy Policy </a></li>
  <li class="hs-menu-item hs-menu-depth-1" role="none"><a href="https://www.secureideas.com/our-team" role="menuitem" target="_self">Our Team</a></li>
  <li class="hs-menu-item hs-menu-depth-1" role="none"><a href="https://www.secureideas.com/partner-program" role="menuitem" target="_self">Partner Program</a></li>
  <li class="hs-menu-item hs-menu-depth-1" role="none"><a href="https://secureideas.axomo.com/" role="menuitem" target="_self">Our Store</a></li>
  <li class="hs-menu-item hs-menu-depth-1" role="none"><a href="https://www.secureideas.com/newsletter" role="menuitem" target="_self">Newsletter Sign-up</a></li>
 </ul>
</div></span>
      </div>
    </div>
  </div>
</section></div>
  </div>
</footer></div>
      
    </div>
    
    
    
<!-- HubSpot performance collection script -->
<script defer src="https://static.hsappstatic.net/content-cwv-embed/static-1.1293/embed.js"></script>
<script src="https://www.secureideas.com/hs-fs/hub/19799800/hub_generated/template_assets/88150008408/1684768610835/SecureIdeas-2022/assets/js/vendors.min.js"></script>
<script src="https://www.secureideas.com/hs-fs/hub/19799800/hub_generated/template_assets/88150009441/1679964703702/SecureIdeas-2022/assets/js/app.min.js"></script>
<script>
var hsVars = hsVars || {}; hsVars['language'] = 'en';
</script>

<script src="/hs/hsstatic/cos-i18n/static-1.53/bundles/project.js"></script>
<script src="https://www.secureideas.com/hs-fs/hub/19799800/hub_generated/module_assets/88149166411/1721658344534/module_88149166411_Navigation.min.js"></script>

<!-- Start of HubSpot Analytics Code -->
<script type="text/javascript">
var _hsq = _hsq || [];
_hsq.push(["setContentType", "blog-post"]);
_hsq.push(["setCanonicalUrl", "https:\/\/www.secureideas.com\/blog\/2018\/04\/ever-run-a-relay-why-smb-relays-should-be-on-your-mind.html"]);
_hsq.push(["setPageId", "56060043388"]);
_hsq.push(["setContentMetadata", {
    "contentPageId": 56060043388,
    "legacyPageId": "56060043388",
    "contentFolderId": null,
    "contentGroupId": 48279235194,
    "abTestId": null,
    "languageVariantId": 56060043388,
    "languageCode": "en",
    
    
}]);
</script>

<script type="text/javascript" id="hs-script-loader" async defer src="/hs/scriptloader/19799800.js"></script>
<!-- End of HubSpot Analytics Code -->


<script type="text/javascript">
var hsVars = {
    render_id: "769e17fc-09d0-4373-a36d-824f378f49cd",
    ticks: 1729730195073,
    page_id: 56060043388,
    
    content_group_id: 48279235194,
    portal_id: 19799800,
    app_hs_base_url: "https://app.hubspot.com",
    cp_hs_base_url: "https://cp.hubspot.com",
    language: "en",
    analytics_page_type: "blog-post",
    scp_content_type: "",
    analytics_page_id: "56060043388",
    category_id: 3,
    folder_id: 0,
    is_hubspot_user: false
}
</script>


<script defer src="/hs/hsstatic/HubspotToolsMenu/static-1.354/js/index.js"></script>






  
</body></html>