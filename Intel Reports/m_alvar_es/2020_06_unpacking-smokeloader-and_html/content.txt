<!DOCTYPE html>
<html class='v2' dir='ltr' lang='en-GB'>
<head>
<link href='https://www.blogger.com/static/v1/widgets/3566091532-css_bundle_v2.css' rel='stylesheet' type='text/css'/>
<meta content='width=1100' name='viewport'/>
<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'/>
<meta content='blogger' name='generator'/>
<link href='https://m.alvar.es/favicon.ico' rel='icon' type='image/x-icon'/>
<link href='https://m.alvar.es/2020/06/unpacking-smokeloader-and.html' rel='canonical'/>
<link rel="alternate" type="application/atom+xml" title="# Malware Research Notes - Atom" href="https://m.alvar.es/feeds/posts/default" />
<link rel="alternate" type="application/rss+xml" title="# Malware Research Notes - RSS" href="https://m.alvar.es/feeds/posts/default?alt=rss" />
<link rel="service.post" type="application/atom+xml" title="# Malware Research Notes - Atom" href="https://www.blogger.com/feeds/2832371727794363441/posts/default" />

<link rel="alternate" type="application/atom+xml" title="# Malware Research Notes - Atom" href="https://m.alvar.es/feeds/2841135887918700348/comments/default" />
<!--Can't find substitution for tag [blog.ieCssRetrofitLinks]-->
<link href='https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEglPVKy2GCb904fH5-8sclD8KyetJI737L5QIQhwIXrTykMxBPFZWNhApE4-RRmThQJIDRMwD3lpe4Xuhw_FJ1-y_Bw1R8z2khiFLOqmPS2RCWPZsrH7f4udY3BDzwZqhbuJwGAHUy5J2s/w400-h275/Screenshot+2020-06-08+at+00.43.13.png' rel='image_src'/>
<meta content='https://m.alvar.es/2020/06/unpacking-smokeloader-and.html' property='og:url'/>
<meta content='Unpacking Smokeloader and Reconstructing PE Programatically using LIEF' property='og:title'/>
<meta content='This article holds notes on my experience unpacking a Smokeloader  2020 sample. The unpacked payload is further used for composing a valid P...' property='og:description'/>
<meta content='https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEglPVKy2GCb904fH5-8sclD8KyetJI737L5QIQhwIXrTykMxBPFZWNhApE4-RRmThQJIDRMwD3lpe4Xuhw_FJ1-y_Bw1R8z2khiFLOqmPS2RCWPZsrH7f4udY3BDzwZqhbuJwGAHUy5J2s/w1200-h630-p-k-no-nu/Screenshot+2020-06-08+at+00.43.13.png' property='og:image'/>
<title># Malware Research Notes: Unpacking Smokeloader and Reconstructing PE Programatically using LIEF</title>
<style id='page-skin-1' type='text/css'><!--
/*
-----------------------------------------------
Blogger Template Style
Name:     Simple
Designer: Blogger
URL:      www.blogger.com
----------------------------------------------- */
/* Content
----------------------------------------------- */
body {
font: normal normal 14px 'Times New Roman', Times, FreeSerif, serif;
color: #cccccc;
background: #292929 none repeat scroll top left;
padding: 0 40px 40px 40px;
}
html body .region-inner {
min-width: 0;
max-width: 100%;
width: auto;
}
h2 {
font-size: 22px;
}
a:link {
text-decoration:none;
color: #dd7700;
}
a:visited {
text-decoration:none;
color: #cc6600;
}
a:hover {
text-decoration:underline;
color: #cc6600;
}
.body-fauxcolumn-outer .fauxcolumn-inner {
background: transparent none repeat scroll top left;
_background-image: none;
}
.body-fauxcolumn-outer .cap-top {
position: absolute;
z-index: 1;
height: 400px;
width: 100%;
}
.body-fauxcolumn-outer .cap-top .cap-left {
width: 100%;
background: transparent none repeat-x scroll top left;
_background-image: none;
}
.content-outer {
-moz-box-shadow: 0 0 40px rgba(0, 0, 0, .15);
-webkit-box-shadow: 0 0 5px rgba(0, 0, 0, .15);
-goog-ms-box-shadow: 0 0 10px #333333;
box-shadow: 0 0 40px rgba(0, 0, 0, .15);
margin-bottom: 1px;
}
.content-inner {
padding: 10px 10px;
}
.content-inner {
background-color: #333333;
}
/* Header
----------------------------------------------- */
.header-outer {
background: transparent none repeat-x scroll 0 -400px;
_background-image: none;
}
.Header h1 {
font: normal normal 60px 'Times New Roman', Times, FreeSerif, serif;
color: #ffffff;
text-shadow: -1px -1px 1px rgba(0, 0, 0, .2);
}
.Header h1 a {
color: #ffffff;
}
.Header .description {
font-size: 140%;
color: #aaaaaa;
}
.header-inner .Header .titlewrapper {
padding: 22px 30px;
}
.header-inner .Header .descriptionwrapper {
padding: 0 30px;
}
/* Tabs
----------------------------------------------- */
.tabs-inner .section:first-child {
border-top: 1px solid #404040;
}
.tabs-inner .section:first-child ul {
margin-top: -1px;
border-top: 1px solid #404040;
border-left: 0 solid #404040;
border-right: 0 solid #404040;
}
.tabs-inner .widget ul {
background: #222222 none repeat-x scroll 0 -800px;
_background-image: none;
border-bottom: 1px solid #404040;
margin-top: 0;
margin-left: -30px;
margin-right: -30px;
}
.tabs-inner .widget li a {
display: inline-block;
padding: .6em 1em;
font: normal normal 14px Arial, Tahoma, Helvetica, FreeSans, sans-serif;
color: #999999;
border-left: 1px solid #333333;
border-right: 0 solid #404040;
}
.tabs-inner .widget li:first-child a {
border-left: none;
}
.tabs-inner .widget li.selected a, .tabs-inner .widget li a:hover {
color: #ffffff;
background-color: #000000;
text-decoration: none;
}
/* Columns
----------------------------------------------- */
.main-outer {
border-top: 0 solid #404040;
}
.fauxcolumn-left-outer .fauxcolumn-inner {
border-right: 1px solid #404040;
}
.fauxcolumn-right-outer .fauxcolumn-inner {
border-left: 1px solid #404040;
}
/* Headings
----------------------------------------------- */
div.widget > h2,
div.widget h2.title {
margin: 0 0 1em 0;
font: normal bold 11px Arial, Tahoma, Helvetica, FreeSans, sans-serif;
color: #ffffff;
}
/* Widgets
----------------------------------------------- */
.widget .zippy {
color: #999999;
text-shadow: 2px 2px 1px rgba(0, 0, 0, .1);
}
.widget .popular-posts ul {
list-style: none;
}
/* Posts
----------------------------------------------- */
h2.date-header {
font: normal bold 11px Arial, Tahoma, Helvetica, FreeSans, sans-serif;
}
.date-header span {
background-color: transparent;
color: #cccccc;
padding: inherit;
letter-spacing: inherit;
margin: inherit;
}
.main-inner {
padding-top: 30px;
padding-bottom: 30px;
}
.main-inner .column-center-inner {
padding: 0 15px;
}
.main-inner .column-center-inner .section {
margin: 0 15px;
}
.post {
margin: 0 0 25px 0;
}
h3.post-title, .comments h4 {
font: normal normal 22px Arial, Tahoma, Helvetica, FreeSans, sans-serif;
margin: .75em 0 0;
}
.post-body {
font-size: 110%;
line-height: 1.4;
position: relative;
}
.post-body img, .post-body .tr-caption-container, .Profile img, .Image img,
.BlogList .item-thumbnail img {
padding: 0;
background: #111111;
border: 1px solid #111111;
-moz-box-shadow: 1px 1px 5px rgba(0, 0, 0, .1);
-webkit-box-shadow: 1px 1px 5px rgba(0, 0, 0, .1);
box-shadow: 1px 1px 5px rgba(0, 0, 0, .1);
}
.post-body img, .post-body .tr-caption-container {
padding: 1px;
}
.post-body .tr-caption-container {
color: #cccccc;
}
.post-body .tr-caption-container img {
padding: 0;
background: transparent;
border: none;
-moz-box-shadow: 0 0 0 rgba(0, 0, 0, .1);
-webkit-box-shadow: 0 0 0 rgba(0, 0, 0, .1);
box-shadow: 0 0 0 rgba(0, 0, 0, .1);
}
.post-header {
margin: 0 0 1.5em;
line-height: 1.6;
font-size: 90%;
}
.post-footer {
margin: 20px -2px 0;
padding: 5px 10px;
color: #888888;
background-color: #303030;
border-bottom: 1px solid #444444;
line-height: 1.6;
font-size: 90%;
}
#comments .comment-author {
padding-top: 1.5em;
border-top: 1px solid #404040;
background-position: 0 1.5em;
}
#comments .comment-author:first-child {
padding-top: 0;
border-top: none;
}
.avatar-image-container {
margin: .2em 0 0;
}
#comments .avatar-image-container img {
border: 1px solid #111111;
}
/* Comments
----------------------------------------------- */
.comments .comments-content .icon.blog-author {
background-repeat: no-repeat;
background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEgAACxIB0t1+/AAAAAd0SU1FB9sLFwMeCjjhcOMAAAD+SURBVDjLtZSvTgNBEIe/WRRnm3U8RC1neQdsm1zSBIU9VVF1FkUguQQsD9ITmD7ECZIJSE4OZo9stoVjC/zc7ky+zH9hXwVwDpTAWWLrgS3QAe8AZgaAJI5zYAmc8r0G4AHYHQKVwII8PZrZFsBFkeRCABYiMh9BRUhnSkPTNCtVXYXURi1FpBDgArj8QU1eVXUzfnjv7yP7kwu1mYrkWlU33vs1QNu2qU8pwN0UpKoqokjWwCztrMuBhEhmh8bD5UDqur75asbcX0BGUB9/HAMB+r32hznJgXy2v0sGLBcyAJ1EK3LFcbo1s91JeLwAbwGYu7TP/3ZGfnXYPgAVNngtqatUNgAAAABJRU5ErkJggg==);
}
.comments .comments-content .loadmore a {
border-top: 1px solid #999999;
border-bottom: 1px solid #999999;
}
.comments .comment-thread.inline-thread {
background-color: #303030;
}
.comments .continue {
border-top: 2px solid #999999;
}
/* Accents
---------------------------------------------- */
.section-columns td.columns-cell {
border-left: 1px solid #404040;
}
.blog-pager {
background: transparent none no-repeat scroll top center;
}
.blog-pager-older-link, .home-link,
.blog-pager-newer-link {
background-color: #333333;
padding: 5px;
}
.footer-outer {
border-top: 0 dashed #bbbbbb;
}
/* Mobile
----------------------------------------------- */
body.mobile  {
background-size: auto;
}
.mobile .body-fauxcolumn-outer {
background: transparent none repeat scroll top left;
}
.mobile .body-fauxcolumn-outer .cap-top {
background-size: 100% auto;
}
.mobile .content-outer {
-webkit-box-shadow: 0 0 3px rgba(0, 0, 0, .15);
box-shadow: 0 0 3px rgba(0, 0, 0, .15);
}
.mobile .tabs-inner .widget ul {
margin-left: 0;
margin-right: 0;
}
.mobile .post {
margin: 0;
}
.mobile .main-inner .column-center-inner .section {
margin: 0;
}
.mobile .date-header span {
padding: 0.1em 10px;
margin: 0 -10px;
}
.mobile h3.post-title {
margin: 0;
}
.mobile .blog-pager {
background: transparent none no-repeat scroll top center;
}
.mobile .footer-outer {
border-top: none;
}
.mobile .main-inner, .mobile .footer-inner {
background-color: #333333;
}
.mobile-index-contents {
color: #cccccc;
}
.mobile-link-button {
background-color: #dd7700;
}
.mobile-link-button a:link, .mobile-link-button a:visited {
color: #ffffff;
}
.mobile .tabs-inner .section:first-child {
border-top: none;
}
.mobile .tabs-inner .PageList .widget-content {
background-color: #000000;
color: #ffffff;
border-top: 1px solid #404040;
border-bottom: 1px solid #404040;
}
.mobile .tabs-inner .PageList .widget-content .pagelist-arrow {
border-left: 1px solid #404040;
}

--></style>
<style id='template-skin-1' type='text/css'><!--
body {
min-width: 1200px;
}
.content-outer, .content-fauxcolumn-outer, .region-inner {
min-width: 1200px;
max-width: 1200px;
_width: 1200px;
}
.main-inner .columns {
padding-left: 0px;
padding-right: 210px;
}
.main-inner .fauxcolumn-center-outer {
left: 0px;
right: 210px;
/* IE6 does not respect left and right together */
_width: expression(this.parentNode.offsetWidth -
parseInt("0px") -
parseInt("210px") + 'px');
}
.main-inner .fauxcolumn-left-outer {
width: 0px;
}
.main-inner .fauxcolumn-right-outer {
width: 210px;
}
.main-inner .column-left-outer {
width: 0px;
right: 100%;
margin-left: -0px;
}
.main-inner .column-right-outer {
width: 210px;
margin-right: -210px;
}
#layout {
min-width: 0;
}
#layout .content-outer {
min-width: 0;
width: 800px;
}
#layout .region-inner {
min-width: 0;
width: auto;
}
body#layout div.add_widget {
padding: 8px;
}
body#layout div.add_widget a {
margin-left: 32px;
}
--></style>
<link href='https://www.blogger.com/dyn-css/authorization.css?targetBlogID=2832371727794363441&amp;zx=769d96a4-bc47-4ff1-a530-898ac7c2afc0' media='none' onload='if(media!=&#39;all&#39;)media=&#39;all&#39;' rel='stylesheet'/><noscript><link href='https://www.blogger.com/dyn-css/authorization.css?targetBlogID=2832371727794363441&amp;zx=769d96a4-bc47-4ff1-a530-898ac7c2afc0' rel='stylesheet'/></noscript>
<meta name='google-adsense-platform-account' content='ca-host-pub-1556223355139109'/>
<meta name='google-adsense-platform-domain' content='blogspot.com'/>

<script type="text/javascript" language="javascript">
  // Supply ads personalization default for EEA readers
  // See https://www.blogger.com/go/adspersonalization
  adsbygoogle = window.adsbygoogle || [];
  if (typeof adsbygoogle.requestNonPersonalizedAds === 'undefined') {
    adsbygoogle.requestNonPersonalizedAds = 1;
  }
</script>


</head>
<body class='loading variant-dark'>
<div class='navbar no-items section' id='navbar' name='Navbar'>
</div>
<div class='body-fauxcolumns'>
<div class='fauxcolumn-outer body-fauxcolumn-outer'>
<div class='cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left'>
<div class='fauxborder-right'></div>
<div class='fauxcolumn-inner'>
</div>
</div>
<div class='cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
</div>
<div class='content'>
<div class='content-fauxcolumns'>
<div class='fauxcolumn-outer content-fauxcolumn-outer'>
<div class='cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left'>
<div class='fauxborder-right'></div>
<div class='fauxcolumn-inner'>
</div>
</div>
<div class='cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
</div>
<div class='content-outer'>
<div class='content-cap-top cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left content-fauxborder-left'>
<div class='fauxborder-right content-fauxborder-right'></div>
<div class='content-inner'>
<header>
<div class='header-outer'>
<div class='header-cap-top cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left header-fauxborder-left'>
<div class='fauxborder-right header-fauxborder-right'></div>
<div class='region-inner header-inner'>
<div class='header section' id='header' name='Header'><div class='widget Header' data-version='1' id='Header1'>
<div id='header-inner'>
<div class='titlewrapper'>
<h1 class='title'>
<a href='https://m.alvar.es/'>
<a href="http://m.alvar.es/"># Malware Research Notes</a>
</a>
</h1>
</div>
<div class='descriptionwrapper'>
<p class='description'><span>
</span></p>
</div>
</div>
</div></div>
</div>
</div>
<div class='header-cap-bottom cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
</header>
<div class='tabs-outer'>
<div class='tabs-cap-top cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left tabs-fauxborder-left'>
<div class='fauxborder-right tabs-fauxborder-right'></div>
<div class='region-inner tabs-inner'>
<div class='tabs no-items section' id='crosscol' name='Cross-column'></div>
<div class='tabs no-items section' id='crosscol-overflow' name='Cross-Column 2'></div>
</div>
</div>
<div class='tabs-cap-bottom cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
<div class='main-outer'>
<div class='main-cap-top cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left main-fauxborder-left'>
<div class='fauxborder-right main-fauxborder-right'></div>
<div class='region-inner main-inner'>
<div class='columns fauxcolumns'>
<div class='fauxcolumn-outer fauxcolumn-center-outer'>
<div class='cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left'>
<div class='fauxborder-right'></div>
<div class='fauxcolumn-inner'>
</div>
</div>
<div class='cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
<div class='fauxcolumn-outer fauxcolumn-left-outer'>
<div class='cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left'>
<div class='fauxborder-right'></div>
<div class='fauxcolumn-inner'>
</div>
</div>
<div class='cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
<div class='fauxcolumn-outer fauxcolumn-right-outer'>
<div class='cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left'>
<div class='fauxborder-right'></div>
<div class='fauxcolumn-inner'>
</div>
</div>
<div class='cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
<!-- corrects IE6 width calculation -->
<div class='columns-inner'>
<div class='column-center-outer'>
<div class='column-center-inner'>
<div class='main section' id='main' name='Main'><div class='widget Blog' data-version='1' id='Blog1'>
<div class='blog-posts hfeed'>

          <div class="date-outer">
        
<h2 class='date-header'><span>Wednesday, 10 June 2020</span></h2>

          <div class="date-posts">
        
<div class='post-outer'>
<div class='post hentry uncustomized-post-template' itemprop='blogPost' itemscope='itemscope' itemtype='http://schema.org/BlogPosting'>
<meta content='https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEglPVKy2GCb904fH5-8sclD8KyetJI737L5QIQhwIXrTykMxBPFZWNhApE4-RRmThQJIDRMwD3lpe4Xuhw_FJ1-y_Bw1R8z2khiFLOqmPS2RCWPZsrH7f4udY3BDzwZqhbuJwGAHUy5J2s/w400-h275/Screenshot+2020-06-08+at+00.43.13.png' itemprop='image_url'/>
<meta content='2832371727794363441' itemprop='blogId'/>
<meta content='2841135887918700348' itemprop='postId'/>
<a name='2841135887918700348'></a>
<h3 class='post-title entry-title' itemprop='name'>
Unpacking Smokeloader and Reconstructing PE Programatically using LIEF
</h3>
<div class='post-header'>
<div class='post-header-line-1'></div>
</div>
<div class='post-body entry-content' id='post-body-2841135887918700348' itemprop='description articleBody'>
<div style="text-align: justify;">This article holds notes on my experience unpacking a <i>Smokeloader</i> 2020 sample. The unpacked payload is further used for composing a valid <i>PE</i> file. The outcome is a <i>PE32</i> executable containing clean code ready for reversing.&nbsp;</div><div style="text-align: justify;"><br /></div><div style="text-align: justify;">First things first, here is the sample used in this research:</div><div style="text-align: center;"><div><br /></div><div><table border="1" bordercolor="#888" cellspacing="0" style="border-collapse: collapse; border-color: rgb(136, 136, 136); border-width: 1px; text-align: justify;"><tbody><tr><td>&nbsp;Size</td><td style="text-align: right;"><i>308.17</i> KB (<i>315568</i> bytes)&nbsp;</td></tr><tr><td style="min-width: 60px;">&nbsp;Type</td><td style="min-width: 60px; text-align: right;">PE32 executable for MS Windows (GUI) Intel 80386 32-bit&nbsp;</td></tr><tr><td>&nbsp;First seen&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</td><td style="text-align: right;">2020-03-06 21:45:11&nbsp;</td></tr><tr><td>&nbsp;md5</td><td style="text-align: right;">&nbsp;c067e0a2d7fc6092bb77abc7f7156b60</td></tr><tr><td>&nbsp;sha1</td><td style="text-align: right;">52f68073caec0fd424c7cbaaed5f5221d7103d20&nbsp;</td></tr><tr><td style="min-width: 60px;">&nbsp;sha256</td><td style="min-width: 60px; text-align: right;">&nbsp; &nbsp;25959cfe4619126ab554d3111b875218f1dbfadd79eed1ed0f6a8c1900fa36e0&nbsp;</td></tr></tbody></table></div><div style="text-align: justify;"><br /></div></div><div style="text-align: justify;">You can find it in VirusTotal&nbsp;[<a href="https://www.virustotal.com/gui/file/25959cfe4619126ab554d3111b875218f1dbfadd79eed1ed0f6a8c1900fa36e0/details" target="_blank">1</a>].&nbsp;</div><div style="text-align: justify;"><br /></div><div style="text-align: justify;">This sample does regular already documented <i>Smokeloader</i> checks before unpacking the main payload, such as:&nbsp;</div><div style="text-align: justify;"><ul><li style="text-align: justify;">checks if the process is running in the context of a debugger using "<i>kernel32.isDebuggerPresent</i>" function [<a href="https://docs.microsoft.com/en-us/windows/win32/api/debugapi/nf-debugapi-isdebuggerpresent" target="_blank">2</a>];</li><li style="text-align: justify;">makes a copy of <i>ntdll.dll</i>, loads it and uses it instead. This technique helps to evade some sandboxes and has been described already in this article here&nbsp;[<a href="https://malwareandstuff.com/examining-smokeloaders-anti-hooking-technique/" target="_blank">3</a>];</li><li style="text-align: justify;">looks for specific patterns in registry keys to check if the sample is running under a virtualised environment.</li></ul><div style="text-align: justify;">It also performs a small profiling of the hosting machine in order to decide which payload to inject. <i>Smokeloader</i> has specific code for both main architectures x86 and x64. In this article, we gonna unpack the x86 payload of the above mentioned sample.&nbsp;</div><div style="text-align: justify;"><br /></div><div style="text-align: justify;"><i>Smokeloader</i> has been using various techniques to inject its final payload into the user file management process "<i>explorer.exe</i>". The sample analysed uses Rtl<i>CreateUserThread</i> approach in order to copy the final payload to the targeted process. This injection method is better described in this Endgame/Elastic article&nbsp;[<a href="https://www.elastic.co/blog/ten-process-injection-techniques-technical-survey-common-and-trending-process" target="_blank">4</a>].</div><span></span><div style="text-align: justify;"><br /></div><div style="text-align: justify;">So our game plan is:&nbsp;</div><div><ol><li style="text-align: justify;">pause execution before the unpacked payload is executed by "<i>explorer.exe</i>";</li><li style="text-align: justify;">transplant this code to a dummy PE shell;</li><li style="text-align: justify;">fix PE header values and section boundaries;</li><li style="text-align: justify;">patching <i>Smokeloader</i> code preamble;</li><li style="text-align: justify;">test unpacked <i>Smokeloader</i> PE;</li><li style="text-align: justify;">how to do all this programatically using LIEF&nbsp;[<a href="https://github.com/lief-project/LIEF" target="_blank">5</a>].</li></ol><div><b><font size="4"><a href="#" id="01_fetching_payload">1.0 - FETCHING MAIN PAYLOAD</a></font></b></div></div><div><br /></div><div style="text-align: justify;"><i>Smokeloader</i> 1st stage decompresses its payload using <i>ntdll.RtlDecompressBuffer</i>&nbsp;[<a href="https://docs.microsoft.com/en-us/windows-hardware/drivers/ddi/ntifs/nf-ntifs-rtldecompressbuffer" target="_blank">6</a>] after few anti-analysis checks described above. It does not call this function from the initially loaded <i>ntdll.dll</i> but from a copy of it loaded afterwards. So breakpoints should be set after the binary loads the copy of <i>ntdll.dll</i>. Figure 01 presents a screenshot of this specific code&nbsp;<i>IDA</i>.</div><div style="text-align: justify;"><br /></div><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto;"><tbody><tr><td style="text-align: center;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEglPVKy2GCb904fH5-8sclD8KyetJI737L5QIQhwIXrTykMxBPFZWNhApE4-RRmThQJIDRMwD3lpe4Xuhw_FJ1-y_Bw1R8z2khiFLOqmPS2RCWPZsrH7f4udY3BDzwZqhbuJwGAHUy5J2s/s777/Screenshot+2020-06-08+at+00.43.13.png" style="margin-left: auto; margin-right: auto;"><img border="0" data-original-height="533" data-original-width="777" height="275" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEglPVKy2GCb904fH5-8sclD8KyetJI737L5QIQhwIXrTykMxBPFZWNhApE4-RRmThQJIDRMwD3lpe4Xuhw_FJ1-y_Bw1R8z2khiFLOqmPS2RCWPZsrH7f4udY3BDzwZqhbuJwGAHUy5J2s/w400-h275/Screenshot+2020-06-08+at+00.43.13.png" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Figure 01: <i>Smokeloader</i> first stage decompression code<br /></td></tr></tbody></table><span><a name='more'></a></span><div style="text-align: justify;"><br /></div><div style="text-align: justify;">This code allocates a buffer with&nbsp;<i>0x2D000</i>&nbsp;bytes using <i>ZwAllocateVirtualMemory</i>&nbsp;which stores the main decompressed payload [<a href="https://www.virustotal.com/gui/file/756dd799c8195b98f295baa210ac1807f7d1d86de2736f559c76ce1c7816d0ee/detection" target="_blank">7</a>]. This code is still transformed before being injected into "<i>explorer.exe</i>". The following steps are performed during injection:</div><div><ul><li style="text-align: left;">fetches <i>explorer.exe</i>&nbsp;PID by calling <i>GetShellWindow</i> and <i>GetWindowThreadProcessId</i>;</li><li style="text-align: left;">sections and maps are created in the current and remote processes using <i>ZwCreateSection</i> and <i>ZwMapViewOfSection</i>;</li><li style="text-align: left;">main payload is copied to local section and reflected in the remote section;</li><li style="text-align: left;">data section is created in the remote process for holding parameters and dynamically created Import Table;</li><li style="text-align: left;">A new thread is created in the remote process by invoking <i>RtlCreateUserThread</i>.</li></ul></div><div style="text-align: justify;">So, at this point, you could ask me: what is the relevance of describing all these call names to the final goal of this article? the answer is: so you can reproduce exactly what I'm describing in here. :D</div><div style="text-align: justify;"><br /></div><div style="text-align: justify;">Next step is setting up a break point in <i>RtlCreateUserThread</i> (from the copy of <i>ntdll.dll</i>) and dump the final payload. It is also necessary to take note of few important addresses: (<i>i</i>) entry point of the thread created in the remote processes and (<i>ii</i>) base addresses for injected code in virtual process.</div><div><br /></div><div>Figure 02 shows a screenshot of <i>IDApro</i> showing the call to <i>RtlCreateUserThread</i> (where we should pause the execution).</div><div><br /></div><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto;"><tbody><tr><td style="text-align: center;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhylum07vEaaAyzwc_abru-WkZzyQkWWdtRoC76SlHDs6zBET2zGFLM6rwXuHAG-7rMbL5e9NbnhR2pATmkwn3swv4jjpOqDHBuW_JHyxyWYZ9_dwBmBNQfggytXsosDr7ilbUgb1Ed3TE/s722/Screenshot+2020-06-09+at+15.43.41.png" style="margin-left: auto; margin-right: auto;"><img border="0" data-original-height="374" data-original-width="722" height="208" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhylum07vEaaAyzwc_abru-WkZzyQkWWdtRoC76SlHDs6zBET2zGFLM6rwXuHAG-7rMbL5e9NbnhR2pATmkwn3swv4jjpOqDHBuW_JHyxyWYZ9_dwBmBNQfggytXsosDr7ilbUgb1Ed3TE/w400-h208/Screenshot+2020-06-09+at+15.43.41.png" title="Figure 02: Call to RtlCreateUserThread" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Figure 02: Call to RtlCreateUserThread after injecting code into remote process<br /></td></tr></tbody></table><div><br /></div><div>By stoping the execution on this call we can collect all data we need to move on to the next step:</div><div><br /></div><div><table border="1" bordercolor="#888" cellspacing="0" style="border-collapse: collapse; border-color: rgb(136, 136, 136); border-width: 1px;"><tbody><tr><td style="min-width: 60px;"><b>&nbsp;Base address code&nbsp;</b><span>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</span><span></span></td><td style="min-width: 60px;"><i>&nbsp;0x02060000</i></td></tr><tr><td style="min-width: 60px;"><b>&nbsp;Base address data&nbsp;</b></td><td style="min-width: 60px;"><i>&nbsp;0x00B60000&nbsp;</i></td></tr><tr><td><b>&nbsp;Data payload&nbsp;</b></td><td><i>&nbsp;a01751fb6eb3f19d9b010818bbecc23c&nbsp;&nbsp;</i>[<a href="https://www.virustotal.com/gui/file/787c762f7384dc8f427f76fb313e3bc248b09516a917426a533ed295bf1b593b/detection" target="_blank">8</a>]</td></tr><tr><td><b>&nbsp;Code payload&nbsp;</b></td><td><i>&nbsp;2547231b4ae82ea9e395fb0c8a308982 </i>[<a href="https://www.virustotal.com/gui/file/3cae0d6a80a716b1c823e1f4011b3d07c4b3475a894751006874729d2145bbcf/detection" target="_blank">9</a>]<i>&nbsp;</i></td></tr><tr><td><b>&nbsp;Code entry point&nbsp;</b></td><td><i>&nbsp;0x02061734&nbsp;</i></td></tr></tbody></table><br /></div><div>Code payload is the final unpacked <i>Smokeloader</i> code adjusted to run on Virtual Address with base equal to <i>0x02060000</i>. The created thread receives the base address of the data segment (<i>0x00B60000</i>) as parameter ("<i>StartParameter"</i>&nbsp;parameter of "<i>RtlCreateUserThread</i>" call).&nbsp;</div><div><br /></div><div><a href="#" id="3.0_transplanting"><b><font size="4">2.0 - TRANSPLANTING PAYLOAD TO PE</font></b></a></div><div><br /></div><div><i>Smokeloader</i> loads all resources necessary to its execution dynamically. This article <a href="http://security.neurolabs.club/2019/10/dynamic-imports-and-working-around.html" target="_blank">here</a>&nbsp;[<a href="http://security.neurolabs.club/2019/10/dynamic-imports-and-working-around.html" target="_blank">10</a>] describes how <i>Smokeloader</i> builds up its import table and how to prepare patch an IDB to overcome this technique before starting reversing. So&nbsp;this main payload does not need any specific setup of <i>imports</i>.&nbsp;</div><div><br /></div><div>In this section we will use 010 Hex Editor [<a href="https://www.sweetscape.com/010editor/" target="_blank">11</a>] to transplant a PE header from a random executable. 010 Hex Editor has a PE format template [<a href="https://www.sweetscape.com/010editor/repository/templates/file_info.php?file=EXE.bt" target="_blank">12</a>]. Although any other valid PE32 binary could be used in this experiment, we used a PE header extracted from an executable listed in this Sotirov's blog post [<a href="http://www.phreedom.org/research/tinype/" target="_blank">13</a>][<a href="https://www.virustotal.com/gui/file/718b03e878080c34f4a51c7243bb60024c7734f23d5715d6b97a5a4d54d7a630/detection" target="_blank">14</a>].&nbsp;</div><div><br /></div><div><i>Smokeloader</i>&nbsp;code payload has <i>0x1000</i> null bytes at offset zero, so we copied the first <i>0x1000</i> bytes containing the PE header from <i>tinype.exe</i> to this region.&nbsp;</div><div><br /></div><div>Coincidently, <i>.text</i>&nbsp;section will be already pointing to the beginning of the our payload at offset <i>0x1000</i>. Probably the malware author just wiped out the PE header before creating the payload and left the null bytes there. Next step is to paste all <i>20480</i> bytes (<i>0x5000</i>) of our data payload in the offset <i>0x4400</i>.</div><div><i><br /></i></div><div>Figure 03 shows the new layout of our binary containing the PE header in the beginning followed by <i>0x3400</i> bytes of code payload (at offset <i>0x1000</i>) and finally <i>0x5000</i> bytes of data from our data payload (at offset <i>0x4400</i>).</div><div><br /></div><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto;"><tbody><tr><td style="text-align: center;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEg-ssnWrorgWoAjB_azPLYYc8QDAXhCOPHlje_3lQUK6X3fos7NmjfT9NJe017BaV-fK674UibTNbQoIygGONVfQa308o26N6G3M9grJpiXOzolzJDcpgnZSh8Jr7CuUa925XvjwdFmnzY/s248/Untitled+Diagram.png" style="margin-left: auto; margin-right: auto;"><img border="0" data-original-height="248" data-original-width="236" height="200" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEg-ssnWrorgWoAjB_azPLYYc8QDAXhCOPHlje_3lQUK6X3fos7NmjfT9NJe017BaV-fK674UibTNbQoIygGONVfQa308o26N6G3M9grJpiXOzolzJDcpgnZSh8Jr7CuUa925XvjwdFmnzY/w191-h200/Untitled+Diagram.png" width="191" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Figure 03: Initial layout of new handcrafted PE binary<br /></td></tr></tbody></table><div><br /></div><div><a href="#" id="0.4_fixing_pe"><b><font size="4">3.0 - FIXING PE HEADERS</font></b></a></div><div><br /></div><div><div>It is time to adjust our implanted PE header manually using&nbsp;<i>010 Hex Editor</i>. At this point, all fields in this header are still set up according "<i>tinype.exe</i>". From now on, we gonna use this schematic as reference to PE header internal structures [<a href="https://upload.wikimedia.org/wikipedia/commons/1/1b/Portable_Executable_32_bit_Structure_in_SVG_fixed.svg" target="_blank">15</a>].</div><div><br /></div><div>The first adjustment is to change the number of sections to <i>2</i>&nbsp;for holding code and data. This field is located in the "<i>COFFHeader.NumberOfSections</i>". Now our binary will list only <i>2</i> sections named "<i>.text</i>" and "<i>.rdata</i>" we can rename this second one to "<i>.data</i>" by changing "<i>SectionHeaders[1].Name</i>".&nbsp;</div><div><br /></div></div><div>Next step is make sure that both sections have correct permissions. "<i>SectionHeaders[0].Characteristics</i>" ("<i>.text</i>") should have&nbsp;<i>CODE</i>, <i>EXECUTE</i> and <i>READ</i> flags active and "<i>SectionHeaders[1].Characteristics</i>" ("<i>.data</i>") should have the <i>INITIALIZED_DATA</i>, <i>READ</i> and <i>WRITE</i> flags active. Still on SectionHeaders, we can setup the bounds and virtual addresses. "<i>SectionHeaders[0].SizeOfRawData</i>" should be set to&nbsp;<i>0x3400</i>&nbsp;(<i>13312</i> Bytes), "<i>SectionHeaders[0].PointerToRawData</i>" should be set to "<i>0x1000</i>" and finally&nbsp; "<i>SectionHeaders[0].VirtualAddress</i>" should be set to <i>0x1000</i>. For "<i>SectionHeaders[1]"</i> ("<i>.data</i>") we gonna set "<i>SizeOfRawData"</i> to <i>0x5000</i>, "<i>PointerToRawData"</i> to <i>0x4400</i> and "<i>VirtualAddress"</i> to <i>0x5000</i>. These changes means that these sections will be mapped in memory in base_address (defined in the <i>OptionalHeader</i>) shifted by each section Virtual Addresses offset. There is an Union inside these section headers called "<i>PhysicalAddress</i>" and "<i>VirtualSize</i>", these fields should hold the same value as "<i>SizeofRawData</i>".</div><div><br /></div><div>Figure 04 shows a diagram of a Section header. Each section in the binary has an instance of this header associated to it.&nbsp;</div><div><br /></div><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto;"><tbody><tr><td style="text-align: center;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiYEm2yoTwtn9uj3JUjeNmlzyG16bGlPEGTeZ9IkHEQn7ohBrS6AdYIhc8OET4WLTMRr93B9gDekRtgLYyEls9MgGAUETK0k9-6snh5FjEM7bebvfegSWA3y4t8ljr7EH8qqbXCnHwxasg/s1714/Screenshot+2020-06-10+at+03.20.36.png" style="margin-left: auto; margin-right: auto;"><img border="0" data-original-height="466" data-original-width="1714" height="109" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiYEm2yoTwtn9uj3JUjeNmlzyG16bGlPEGTeZ9IkHEQn7ohBrS6AdYIhc8OET4WLTMRr93B9gDekRtgLYyEls9MgGAUETK0k9-6snh5FjEM7bebvfegSWA3y4t8ljr7EH8qqbXCnHwxasg/w400-h109/Screenshot+2020-06-10+at+03.20.36.png" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Figure 04: PE Section Header<br /></td></tr></tbody></table><div><br /></div><div>Now we need to adjust few fields in the Optional Header. In this header we will need to change the following fields:&nbsp;</div><div><br /></div><div><table border="1" bordercolor="#888" cellspacing="0" style="border-collapse: collapse; border-color: rgb(136, 136, 136); border-width: 1px;"><tbody><tr><td>&nbsp;ImageBase</td><td>&nbsp;Virtual Address where binary will be mapped</td><td>&nbsp;0x02060000</td></tr><tr><td style="min-width: 60px;">&nbsp;SizeOfCode&nbsp;</td><td style="min-width: 60px;">&nbsp;size of .text section&nbsp;</td><td style="min-width: 60px;">&nbsp;0x3400 bytes</td></tr><tr><td style="min-width: 60px;">&nbsp;SizeOfInitializedData&nbsp;</td><td style="min-width: 60px;">&nbsp;size of .text and .data sections together&nbsp;</td><td style="min-width: 60px;">&nbsp;0x8400 bytes&nbsp;</td></tr><tr><td>&nbsp;AddressOfEntryPoint</td><td>&nbsp;offset of the entry point code</td><td>&nbsp;0x1734</td></tr><tr><td>&nbsp;BaseOfCode</td><td>&nbsp;.text section Virtual Address</td><td>&nbsp;0x1000</td></tr><tr><td>&nbsp;BaseOfData</td><td>&nbsp;.data section Virtual Address</td><td>&nbsp;0x5000</td></tr><tr><td>&nbsp;SectionAlignment</td><td>&nbsp;Virtual Addresses have to be multiple of this value&nbsp;</td><td>&nbsp;0x1000</td></tr><tr><td>&nbsp;FileAlignment</td><td>&nbsp;file offsets have to be multiple of this value</td><td>&nbsp;0x200</td></tr><tr><td>&nbsp;SizeOfImage</td><td>&nbsp;total size of binary headers + sections</td><td>&nbsp;0x9400</td></tr><tr><td>&nbsp;Checksum&nbsp;</td><td>&nbsp;PE file checksum - use PE Explorer [<a href="http://www.heaventools.com/" target="_blank">16</a>] or Hiew [<a href="http://www.hiew.ru/" target="_blank">17</a>] to calculate this value&nbsp;&nbsp;</td><td>&nbsp;--------</td></tr></tbody></table><br /></div><div>"<i>ImageBase</i>" has to match the base of the code section we dumped from "<i>explorer.exe</i>" (<i>0x02060000</i>). As we will not export or import anything all "<i>Data Directories</i>" inside the Optional Header can be <i>zeroed</i> as well.</div><div><br /></div><div>Summarising the whole process:&nbsp;</div><div><ol><li>Transplanting PE header from a dummy PE;</li><li>Fix sections sizes, boundaries, permissions and Virtual Addresses in <i>SectionHeaders</i>;</li><li>Setup section contents;</li><li>Setup Optional Header fields;</li><li>Setup PE checksum;</li></ol></div><div>Here is the version of our binary after following up all steps described above [<a href="https://www.virustotal.com/gui/file/3e474e495e11716f6eab40ee3c353602da2683dbefd900f6d90dfcedff2fa93d" target="_blank">18</a>]. This binary is a valid executable and we can load it in any debugger or disassembly but we still need to change one last thing before call it a valid unpacked <i>Smokeloader</i> sample.&nbsp;</div><div><br /></div><div><a href="#" id="5.0_import_table"><b><font size="4">4.0 - PATCHING BINARY</font></b></a></div><div><br /></div><div>Figure 05 shows our reconstructed PE loaded in <i>IDApro</i> paused on the correct Entry Point.&nbsp;</div><div><br /></div><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto;"><tbody><tr><td style="text-align: center;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiNwHUBOfe6IjeYVQUN7FQszOYRZdiz-vO-UwDHxSYW4XvFxgBpcodygrFvxZ3GzwAz5qQoNIDRkfd-gAwLkA-Y5nfCyIZvBEQkDmaPUDzJrZMCOxCiqzTyhv0QYRowgTBe5uaooUjM95c/s847/Screenshot+2020-06-10+at+12.35.53.png" style="margin-left: auto; margin-right: auto;"><img border="0" data-original-height="379" data-original-width="847" height="286" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiNwHUBOfe6IjeYVQUN7FQszOYRZdiz-vO-UwDHxSYW4XvFxgBpcodygrFvxZ3GzwAz5qQoNIDRkfd-gAwLkA-Y5nfCyIZvBEQkDmaPUDzJrZMCOxCiqzTyhv0QYRowgTBe5uaooUjM95c/w640-h286/Screenshot+2020-06-10+at+12.35.53.png" width="640" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Figure 05 - Reconstructed PE paused on Entry Point<br /></td></tr></tbody></table><div><br /></div><div>We can notice that the entry point function receives an argument (<i>0x02061737</i>) and loads it into <i>ECX </i>and then calls another function located in <i>0x02061743</i> which is just below the current function. This argument is the address of the data segment. This data segment will be used for various tasks during <i>Smokeloader</i> execution including holding the dynamically created import table.&nbsp;</div><div><br /></div><div>If we execute this file without a valid value in <i>ECX</i> it will break when the main payload tries to write into the data segment (invalid address in <i>ECX</i>). Figure 06 shows what happens when we try to execute our binary the way it is right now.&nbsp;</div><div><br /></div><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto;"><tbody><tr><td style="text-align: center;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiJtlFCCahSZVsghOGt7v4fiSA0K8a_6rI8oU2Fh9Iut9liUobh-XLEJXt1OyXoAbOzFEVPD9iFBTaT2BVd23hTyoAaQYTs30NrAVplJmSsvqOCVw58Mkd6nVVm7HgZhANO7QrF55ewIc8/s803/Screenshot+2020-06-10+at+13.33.02.png" style="margin-left: auto; margin-right: auto;"><img border="0" data-original-height="524" data-original-width="803" height="261" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiJtlFCCahSZVsghOGt7v4fiSA0K8a_6rI8oU2Fh9Iut9liUobh-XLEJXt1OyXoAbOzFEVPD9iFBTaT2BVd23hTyoAaQYTs30NrAVplJmSsvqOCVw58Mkd6nVVm7HgZhANO7QrF55ewIc8/w400-h261/Screenshot+2020-06-10+at+13.33.02.png" width="400" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Figure 06 - Access Violation exception when executing unpatched reconstructed binary<br /></td></tr></tbody></table><div><br />The plan now is to patch this binary to load the correct address of the data segment into <i>ECX</i> before calling "<i>sub_2061743</i>". Since both functions are consecutive and the function on top does not do much - we gonna replace all <i>15</i> bytes of this function (<i>0x02061743</i> - <i>0x02061734</i>). Figure 07 shows the new patched code.&nbsp;</div><div><br /></div><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto;"><tbody><tr><td style="text-align: center;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjgCvZ37HjcTmoUCeHJlyJksTDsy2UdFm-3WYE2icO5y-pW6mFG9WNeknHQwrd-HEw2L-Wmk2ldXM3W01fd3TRtd11MCEdPBp6BFgCsIBMu3XowA4sMBMJ03T91u9CpykWPliAjkP6Wtkw/s846/Screenshot+2020-06-10+at+13.49.10.png" style="margin-left: auto; margin-right: auto;"><img border="0" data-original-height="291" data-original-width="846" height="220" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjgCvZ37HjcTmoUCeHJlyJksTDsy2UdFm-3WYE2icO5y-pW6mFG9WNeknHQwrd-HEw2L-Wmk2ldXM3W01fd3TRtd11MCEdPBp6BFgCsIBMu3XowA4sMBMJ03T91u9CpykWPliAjkP6Wtkw/w640-h220/Screenshot+2020-06-10+at+13.49.10.png" width="640" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Figure 07 - Code after patching<br /></td></tr></tbody></table><div><br /></div><div>In this new code the entry point remains the same. We can see that we loaded <i>ECX</i> with the address of the data segment by using the push and pop instructions and then we filled the rest of the remaining bytes with <i>NOP</i> (<i>0x90</i>). We can see the beginning of the second function at the same address as before (<i>0x02061743</i>). Of course there are many ways to achieve this same result but this was the simplest approach we could think of.&nbsp;</div><div><br /></div><div>The final step is to update the PE checksum field inside the <i>Optional Heade</i>r again and we will have a fully unpacked <i>Smokeloader</i> sample. Here are the last version of our reconstructed binary [<a href="https://www.virustotal.com/gui/file/cd42f017913034d527d90a84feebcde015e714baa03714c83f80608555e52386/detection" target="_blank">19</a>]:</div><div><br /></div><div><table border="1" bordercolor="#888" cellspacing="0" style="border-collapse: collapse; border-color: rgb(136, 136, 136); border-width: 1px;"><tbody><tr><td style="min-width: 60px;">&nbsp;File name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</td><td style="min-width: 60px;">&nbsp;new_pe_patched.bin</td></tr><tr><td style="min-width: 60px;">&nbsp;File type&nbsp;</td><td style="min-width: 60px;">&nbsp;PE32 executable for MS Windows (console) Intel 80386 32-bit</td></tr><tr><td>&nbsp;Size&nbsp;</td><td>&nbsp;37888 bytes</td></tr><tr><td>&nbsp;md5&nbsp;</td><td>&nbsp;f401109ae24aaf47dce75266ffc049f8</td></tr><tr><td>&nbsp;sha1&nbsp;</td><td>&nbsp;49e7ed68b9569e0e987da71b3c678974d8ed7c81</td></tr><tr><td>&nbsp;sha256&nbsp;</td><td>&nbsp;cd42f017913034d527d90a84feebcde015e714baa03714c83f80608555e52386&nbsp;</td></tr></tbody></table></div><div><br /></div><div><font size="4"><b><a href="#" id="6.0_programatically">5.0 - TESTING RECONSTRUCTED PE</a></b></font></div><div><br /></div><div>For testing our branding new reconstructed PE we ran it into Cuckoo sandbox [<a href="https://www.capesandbox.com/" target="_blank">20</a>] to analyse its behaviour [<a href="https://www.capesandbox.com/analysis/7521/#behavior" target="_blank">21</a>]. As we can see in figure 08 and 09, the binary was executed properly and we got it checking in and contacting its controllers.&nbsp;</div><div><br /></div><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto;"><tbody><tr><td style="text-align: center;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgyzAg-TXwApfkPp_Vnp2zyHaNcoS95lBAHnlNvbWsDFN8R9zsULNgB8WRMrzj9vhSpEhIdJOeGoVha5Ah2y9Nn9ziVKFjXOVOTr7a4FJYPeiEU5mtCkAtMWsktREoUwzxTUkScmhyphenhyphenR-s8/s1160/Screenshot+2020-06-10+at+14.38.52.png" style="margin-left: auto; margin-right: auto;"><img border="0" data-original-height="1134" data-original-width="1160" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgyzAg-TXwApfkPp_Vnp2zyHaNcoS95lBAHnlNvbWsDFN8R9zsULNgB8WRMrzj9vhSpEhIdJOeGoVha5Ah2y9Nn9ziVKFjXOVOTr7a4FJYPeiEU5mtCkAtMWsktREoUwzxTUkScmhyphenhyphenR-s8/s320/Screenshot+2020-06-10+at+14.38.52.png" width="320" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Figure 08 - Reconstructed sample connecting back to Controllers<br /></td></tr></tbody></table><div><br /></div><table align="center" cellpadding="0" cellspacing="0" class="tr-caption-container" style="margin-left: auto; margin-right: auto;"><tbody><tr><td style="text-align: center;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiEvyhQWV04iDFFvS77qGzqAj9hNp0_iSY7A7jybmc8Xd8fCflTddIEP2J695NwPew1FEPgOnwHe3u1vU8ri0T6HVPDQm7Uo25A7H0Q0K5cHtlaNBs1gGjjw2vJEVuv2mkK2CkJkmduw5s/s1300/Screenshot+2020-06-10+at+14.39.46.png" style="margin-left: auto; margin-right: auto;"><img border="0" data-original-height="1300" data-original-width="1072" height="400" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiEvyhQWV04iDFFvS77qGzqAj9hNp0_iSY7A7jybmc8Xd8fCflTddIEP2J695NwPew1FEPgOnwHe3u1vU8ri0T6HVPDQm7Uo25A7H0Q0K5cHtlaNBs1gGjjw2vJEVuv2mkK2CkJkmduw5s/w330-h400/Screenshot+2020-06-10+at+14.39.46.png" width="330" /></a></td></tr><tr><td class="tr-caption" style="text-align: center;">Figure 09 - List of API calls intercepted by Cuckoo<br /></td></tr></tbody></table><div><br />As we can see we got the sample connecting back to three controller <i>URLs</i> and many pages of intercepted <i>API</i> calls in the behavioural analysis. This is an indication that our unpacked and reconstructed <i>Smokeloader</i> sample is functional.&nbsp;</div><div><br /></div><div><b><a href="#" id="programatically"><font size="4">6.0 - DOING IT ALL PROGRAMATICALLY</font></a></b></div><div><br /></div><div>So far we described how to unpack <i>Smokeloader</i> main payload and how to manually reconstruct a valid PE file out of this. Now we will automate what we did manually by transplanting a PE header from a dummy binary ("<i>tinype.exe</i>"). The Python library used in this experiment is <i>LIEF</i> [<a href="https://github.com/lief-project/LIEF" target="_blank">5</a>]. We extended this example called "Create a PE from scratch" they have in their official documentation [<a href="https://lief.quarkslab.com/doc/latest/tutorials/02_pe_from_scratch.html" target="_blank">22</a>].</div><div><br /></div><div>The following code does exactly the same as the manual approach but using <i>LIEF</i>.</div><div><br /></div><div><script src="https://gist.github.com/mabj/64a545a3cff6166e0ab6ffa5f81d5d9c.js"></script></div><div><br /></div><div>The final binary generated by <i>LIEF</i> is:</div><div><div><br class="Apple-interchange-newline" /><table border="1" bordercolor="#888" cellspacing="0" style="border-collapse: collapse; border-color: rgb(136, 136, 136); border-width: 1px;"><tbody><tr><td style="min-width: 60px;">&nbsp;File name&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;</td><td style="min-width: 60px;">&nbsp;unpacked_smokeloader.exe</td></tr><tr><td style="min-width: 60px;">&nbsp;File type&nbsp;</td><td style="min-width: 60px;">&nbsp;PE32 executable for MS Windows (console) Intel 80386 32-bit</td></tr><tr><td>&nbsp;Size&nbsp;</td><td>&nbsp;<i>34816</i> bytes</td></tr><tr><td>&nbsp;md5&nbsp;</td><td>&nbsp;a0aebc61bc89208be0585eca4d1ed00c</td></tr><tr><td>&nbsp;sha1&nbsp;</td><td>&nbsp;ea2f3c914dec6bb36832abc313b3fce826cdecb0</td></tr><tr><td>&nbsp;sha256&nbsp;</td><td>&nbsp;0247de510507792fcbf425fab9dbbc2f067c25dc7e4e80a958d1ebfb0505f6e6&nbsp;</td></tr></tbody></table></div><div><br /></div></div><div>We uploaded it for testing to Virustotal [<a href="https://www.virustotal.com/gui/file/0247de510507792fcbf425fab9dbbc2f067c25dc7e4e80a958d1ebfb0505f6e6" target="_blank">23</a>] and CAPE sandbox [<a href="https://www.capesandbox.com/analysis/7643/" target="_blank">24</a>] and is a valid unpacked <i>Smokeloader</i> PE32 executable.</div><div><br /><br /></div><div><b><a href="#" id="07_references"><font size="4">REFERENCES:</font></a></b></div><div><br /></div>[1] https://www.virustotal.com/gui/file/25959cfe4619126ab554d3111b875218f1dbfadd79eed1ed0f6a8c1900fa36e0/details<br />[2] https://docs.microsoft.com/en-us/windows/win32/api/debugapi/nf-debugapi-isdebuggerpresent<br />[3]&nbsp;https://malwareandstuff.com/examining-smokeloaders-anti-hooking-technique/<br />[4] https://www.elastic.co/blog/ten-process-injection-techniques-technical-survey-common-and-trending-process<br />[5] https://github.com/lief-project/LIEF</div><div style="text-align: justify;">[6] https://docs.microsoft.com/en-us/windows-hardware/drivers/ddi/ntifs/nf-ntifs-rtldecompressbuffer</div><div style="text-align: justify;">[7]&nbsp;https://www.virustotal.com/gui/file/756dd799c8195b98f295baa210ac1807f7d1d86de2736f559c76ce1c7816d0ee/detection</div><div style="text-align: justify;">[8]&nbsp;https://www.virustotal.com/gui/file/787c762f7384dc8f427f76fb313e3bc248b09516a917426a533ed295bf1b593b/detection</div><div style="text-align: justify;">[9]&nbsp;https://www.virustotal.com/gui/file/3cae0d6a80a716b1c823e1f4011b3d07c4b3475a894751006874729d2145bbcf/detection</div><div style="text-align: justify;">[10]&nbsp;http://security.neurolabs.club/2019/10/dynamic-imports-and-working-around.html</div><div style="text-align: justify;">[11]&nbsp;https://www.sweetscape.com/010editor/</div><div style="text-align: justify;">[12] https://www.sweetscape.com/010editor/repository/templates/file_info.php?file=EXE.bt</div><div style="text-align: justify;">[13]&nbsp;http://www.phreedom.org/research/tinype/</div><div style="text-align: justify;">[14] https://www.virustotal.com/gui/file/718b03e878080c34f4a51c7243bb60024c7734f23d5715d6b97a5a4d54d7a630/detection</div><div style="text-align: justify;">[15]&nbsp;https://upload.wikimedia.org/wikipedia/commons/1/1b/Portable_Executable_32_bit_Structure_in_SVG_fixed.svg<br />[16]&nbsp;http://www.heaventools.com/<br />[17]&nbsp;http://www.hiew.ru/</div><div style="text-align: justify;">[18] https://www.virustotal.com/gui/file/3e474e495e11716f6eab40ee3c353602da2683dbefd900f6d90dfcedff2fa93d</div><div style="text-align: justify;">[19]&nbsp;https://www.virustotal.com/gui/file/cd42f017913034d527d90a84feebcde015e714baa03714c83f80608555e52386/detection</div><div style="text-align: justify;">[20]&nbsp;https://www.capesandbox.com/</div><div style="text-align: justify;">[21]&nbsp;https://www.capesandbox.com/analysis/7521/#behavior</div><div style="text-align: justify;">[22]&nbsp;https://lief.quarkslab.com/doc/latest/tutorials/02_pe_from_scratch.html</div><div style="text-align: justify;">[23]&nbsp;https://www.virustotal.com/gui/file/0247de510507792fcbf425fab9dbbc2f067c25dc7e4e80a958d1ebfb0505f6e6</div><div style="text-align: justify;">[24]&nbsp;https://www.capesandbox.com/analysis/7643/</div><div style="text-align: justify;"><br /></div>
<div style='clear: both;'></div>
</div>
<div class='post-footer'>
<div class='post-footer-line post-footer-line-1'>
<span class='post-author vcard'>
</span>
<span class='post-timestamp'>
at
<meta content='https://m.alvar.es/2020/06/unpacking-smokeloader-and.html' itemprop='url'/>
<a class='timestamp-link' href='https://m.alvar.es/2020/06/unpacking-smokeloader-and.html' rel='bookmark' title='permanent link'><abbr class='published' itemprop='datePublished' title='2020-06-10T10:30:00-07:00'>June 10, 2020</abbr></a>
</span>
<span class='post-comment-link'>
</span>
<span class='post-icons'>
<span class='item-control blog-admin pid-363379351'>
<a href='https://www.blogger.com/post-edit.g?blogID=2832371727794363441&postID=2841135887918700348&from=pencil' title='Edit Post'>
<img alt='' class='icon-action' height='18' src='https://resources.blogblog.com/img/icon18_edit_allbkg.gif' width='18'/>
</a>
</span>
</span>
<div class='post-share-buttons goog-inline-block'>
<a class='goog-inline-block share-button sb-email' href='https://www.blogger.com/share-post.g?blogID=2832371727794363441&postID=2841135887918700348&target=email' target='_blank' title='Email This'><span class='share-button-link-text'>Email This</span></a><a class='goog-inline-block share-button sb-blog' href='https://www.blogger.com/share-post.g?blogID=2832371727794363441&postID=2841135887918700348&target=blog' onclick='window.open(this.href, "_blank", "height=270,width=475"); return false;' target='_blank' title='BlogThis!'><span class='share-button-link-text'>BlogThis!</span></a><a class='goog-inline-block share-button sb-twitter' href='https://www.blogger.com/share-post.g?blogID=2832371727794363441&postID=2841135887918700348&target=twitter' target='_blank' title='Share to X'><span class='share-button-link-text'>Share to X</span></a><a class='goog-inline-block share-button sb-facebook' href='https://www.blogger.com/share-post.g?blogID=2832371727794363441&postID=2841135887918700348&target=facebook' onclick='window.open(this.href, "_blank", "height=430,width=640"); return false;' target='_blank' title='Share to Facebook'><span class='share-button-link-text'>Share to Facebook</span></a><a class='goog-inline-block share-button sb-pinterest' href='https://www.blogger.com/share-post.g?blogID=2832371727794363441&postID=2841135887918700348&target=pinterest' target='_blank' title='Share to Pinterest'><span class='share-button-link-text'>Share to Pinterest</span></a>
</div>
</div>
<div class='post-footer-line post-footer-line-2'>
<span class='post-labels'>
Labels:
<a href='https://m.alvar.es/search/label/malware' rel='tag'>malware</a>,
<a href='https://m.alvar.es/search/label/Research' rel='tag'>Research</a>,
<a href='https://m.alvar.es/search/label/reverse%20engineering' rel='tag'>reverse engineering</a>,
<a href='https://m.alvar.es/search/label/reversing' rel='tag'>reversing</a>,
<a href='https://m.alvar.es/search/label/smokeloader' rel='tag'>smokeloader</a>
</span>
</div>
<div class='post-footer-line post-footer-line-3'>
<span class='post-location'>
</span>
</div>
</div>
</div>
<div class='comments' id='comments'>
<a name='comments'></a>
<h4>5 comments:</h4>
<div class='comments-content'>
<script async='async' src='' type='text/javascript'></script>
<script type='text/javascript'>
    (function() {
      var items = null;
      var msgs = null;
      var config = {};

// <![CDATA[
      var cursor = null;
      if (items && items.length > 0) {
        cursor = parseInt(items[items.length - 1].timestamp) + 1;
      }

      var bodyFromEntry = function(entry) {
        var text = (entry &&
                    ((entry.content && entry.content.$t) ||
                     (entry.summary && entry.summary.$t))) ||
            '';
        if (entry && entry.gd$extendedProperty) {
          for (var k in entry.gd$extendedProperty) {
            if (entry.gd$extendedProperty[k].name == 'blogger.contentRemoved') {
              return '<span class="deleted-comment">' + text + '</span>';
            }
          }
        }
        return text;
      }

      var parse = function(data) {
        cursor = null;
        var comments = [];
        if (data && data.feed && data.feed.entry) {
          for (var i = 0, entry; entry = data.feed.entry[i]; i++) {
            var comment = {};
            // comment ID, parsed out of the original id format
            var id = /blog-(\d+).post-(\d+)/.exec(entry.id.$t);
            comment.id = id ? id[2] : null;
            comment.body = bodyFromEntry(entry);
            comment.timestamp = Date.parse(entry.published.$t) + '';
            if (entry.author && entry.author.constructor === Array) {
              var auth = entry.author[0];
              if (auth) {
                comment.author = {
                  name: (auth.name ? auth.name.$t : undefined),
                  profileUrl: (auth.uri ? auth.uri.$t : undefined),
                  avatarUrl: (auth.gd$image ? auth.gd$image.src : undefined)
                };
              }
            }
            if (entry.link) {
              if (entry.link[2]) {
                comment.link = comment.permalink = entry.link[2].href;
              }
              if (entry.link[3]) {
                var pid = /.*comments\/default\/(\d+)\?.*/.exec(entry.link[3].href);
                if (pid && pid[1]) {
                  comment.parentId = pid[1];
                }
              }
            }
            comment.deleteclass = 'item-control blog-admin';
            if (entry.gd$extendedProperty) {
              for (var k in entry.gd$extendedProperty) {
                if (entry.gd$extendedProperty[k].name == 'blogger.itemClass') {
                  comment.deleteclass += ' ' + entry.gd$extendedProperty[k].value;
                } else if (entry.gd$extendedProperty[k].name == 'blogger.displayTime') {
                  comment.displayTime = entry.gd$extendedProperty[k].value;
                }
              }
            }
            comments.push(comment);
          }
        }
        return comments;
      };

      var paginator = function(callback) {
        if (hasMore()) {
          var url = config.feed + '?alt=json&v=2&orderby=published&reverse=false&max-results=50';
          if (cursor) {
            url += '&published-min=' + new Date(cursor).toISOString();
          }
          window.bloggercomments = function(data) {
            var parsed = parse(data);
            cursor = parsed.length < 50 ? null
                : parseInt(parsed[parsed.length - 1].timestamp) + 1
            callback(parsed);
            window.bloggercomments = null;
          }
          url += '&callback=bloggercomments';
          var script = document.createElement('script');
          script.type = 'text/javascript';
          script.src = url;
          document.getElementsByTagName('head')[0].appendChild(script);
        }
      };
      var hasMore = function() {
        return !!cursor;
      };
      var getMeta = function(key, comment) {
        if ('iswriter' == key) {
          var matches = !!comment.author
              && comment.author.name == config.authorName
              && comment.author.profileUrl == config.authorUrl;
          return matches ? 'true' : '';
        } else if ('deletelink' == key) {
          return config.baseUri + '/delete-comment.g?blogID='
               + config.blogId + '&postID=' + comment.id;
        } else if ('deleteclass' == key) {
          return comment.deleteclass;
        }
        return '';
      };

      var replybox = null;
      var replyUrlParts = null;
      var replyParent = undefined;

      var onReply = function(commentId, domId) {
        if (replybox == null) {
          // lazily cache replybox, and adjust to suit this style:
          replybox = document.getElementById('comment-editor');
          if (replybox != null) {
            replybox.height = '250px';
            replybox.style.display = 'block';
            replyUrlParts = replybox.src.split('#');
          }
        }
        if (replybox && (commentId !== replyParent)) {
          replybox.src = '';
          document.getElementById(domId).insertBefore(replybox, null);
          replybox.src = replyUrlParts[0]
              + (commentId ? '&parentID=' + commentId : '')
              + '#' + replyUrlParts[1];
          replyParent = commentId;
        }
      };

      var hash = (window.location.hash || '#').substring(1);
      var startThread, targetComment;
      if (/^comment-form_/.test(hash)) {
        startThread = hash.substring('comment-form_'.length);
      } else if (/^c[0-9]+$/.test(hash)) {
        targetComment = hash.substring(1);
      }

      // Configure commenting API:
      var configJso = {
        'maxDepth': config.maxThreadDepth
      };
      var provider = {
        'id': config.postId,
        'data': items,
        'loadNext': paginator,
        'hasMore': hasMore,
        'getMeta': getMeta,
        'onReply': onReply,
        'rendered': true,
        'initComment': targetComment,
        'initReplyThread': startThread,
        'config': configJso,
        'messages': msgs
      };

      var render = function() {
        if (window.goog && window.goog.comments) {
          var holder = document.getElementById('comment-holder');
          window.goog.comments.render(holder, provider);
        }
      };

      // render now, or queue to render when library loads:
      if (window.goog && window.goog.comments) {
        render();
      } else {
        window.goog = window.goog || {};
        window.goog.comments = window.goog.comments || {};
        window.goog.comments.loadQueue = window.goog.comments.loadQueue || [];
        window.goog.comments.loadQueue.push(render);
      }
    })();
// ]]>
  </script>
<div id='comment-holder'>
<div class="comment-thread toplevel-thread"><ol id="top-ra"><li class="comment" id="c3348473549680661213"><div class="avatar-image-container"><img src="//resources.blogblog.com/img/blank.gif" alt=""/></div><div class="comment-block"><div class="comment-header"><cite class="user"><a href="https://www.blogger.com/profile/16481695054607914822" rel="nofollow">https://thecrackfiles.com/</a></cite><span class="icon user "></span><span class="datetime secondary-text"><a rel="nofollow" href="https://m.alvar.es/2020/06/unpacking-smokeloader-and.html?showComment=1633590327569#c3348473549680661213">7 October 2021 at 00:05</a></span></div><p class="comment-content">This site have particular software articles which emits an impression of being a significant and significant for you individual, able software installation.This is the spot you can get helps for any software installation, usage and cracked.<br><a href="https://thecrackfiles.com/hard-disk-sentinel-pro-crack/" rel="nofollow">hard-disk-sentinel-pro-crack</a><br><a href="https://thecrackfiles.com/wiztree-crack/" rel="nofollow">wiztree-crac</a><br><a href="https://thecrackfiles.com/easyworship-pro-crack/" rel="nofollow">easyworship-pro-crack</a><br><a href="https://thecrackfiles.com/idm-crack-2/" rel="nofollow"> idm-crack-2 </a><br><a href="https://thecrackfiles.com/sweetscape-010-editor-crack/" rel="nofollow">sweetscape-010-editor-crack</a><br><a href="https://thecrackfiles.com/minitool-power-data-recovery-crack/" rel="nofollow"> minitool-power-data-recovery-crack-cracke</a><br><a href="https://thecrackfiles.com/nero-burning-rom-crack/" rel="nofollow">pgware-gamegain-crack</a></p><span class="comment-actions secondary-text"><a class="comment-reply" target="_self" data-comment-id="3348473549680661213">Reply</a><span class="item-control blog-admin blog-admin pid-16725144"><a target="_self" href="https://www.blogger.com/delete-comment.g?blogID=2832371727794363441&amp;postID=3348473549680661213">Delete</a></span></span></div><div class="comment-replies"><div id="c3348473549680661213-rt" class="comment-thread inline-thread hidden"><span class="thread-toggle thread-expanded"><span class="thread-arrow"></span><span class="thread-count"><a target="_self">Replies</a></span></span><ol id="c3348473549680661213-ra" class="thread-chrome thread-expanded"><div></div><div id="c3348473549680661213-continue" class="continue"><a class="comment-reply" target="_self" data-comment-id="3348473549680661213">Reply</a></div></ol></div></div><div class="comment-replybox-single" id="c3348473549680661213-ce"></div></li><li class="comment" id="c2803623786786357055"><div class="avatar-image-container"><img src="//resources.blogblog.com/img/blank.gif" alt=""/></div><div class="comment-block"><div class="comment-header"><cite class="user"><a href="https://www.blogger.com/profile/12821415313945299877" rel="nofollow">Dailycracks</a></cite><span class="icon user "></span><span class="datetime secondary-text"><a rel="nofollow" href="https://m.alvar.es/2020/06/unpacking-smokeloader-and.html?showComment=1633653443111#c2803623786786357055">7 October 2021 at 17:37</a></span></div><p class="comment-content">This site have particular software articles which emits an impression of being a significant and significant for you individual, able software installation.This is the spot you can get helps for any software installation, usage and cracked.<br><a href="https://dailycracks.com/disk-savvy-ultimate-enterprise-crack/" rel="nofollow">disk-savvy-ultimate-enterprise-crack</a><br><a href="https://dailycracks.com/sweetscape-010-editor-crack/" rel="nofollow">sweetscape-010-editor-crack</a></p><span class="comment-actions secondary-text"><a class="comment-reply" target="_self" data-comment-id="2803623786786357055">Reply</a><span class="item-control blog-admin blog-admin pid-16725144"><a target="_self" href="https://www.blogger.com/delete-comment.g?blogID=2832371727794363441&amp;postID=2803623786786357055">Delete</a></span></span></div><div class="comment-replies"><div id="c2803623786786357055-rt" class="comment-thread inline-thread hidden"><span class="thread-toggle thread-expanded"><span class="thread-arrow"></span><span class="thread-count"><a target="_self">Replies</a></span></span><ol id="c2803623786786357055-ra" class="thread-chrome thread-expanded"><div></div><div id="c2803623786786357055-continue" class="continue"><a class="comment-reply" target="_self" data-comment-id="2803623786786357055">Reply</a></div></ol></div></div><div class="comment-replybox-single" id="c2803623786786357055-ce"></div></li><li class="comment" id="c8634510575649657044"><div class="avatar-image-container"><img src="//resources.blogblog.com/img/blank.gif" alt=""/></div><div class="comment-block"><div class="comment-header"><cite class="user"><a href="https://www.blogger.com/profile/16640322136443841635" rel="nofollow">Ramzan Kanju</a></cite><span class="icon user "></span><span class="datetime secondary-text"><a rel="nofollow" href="https://m.alvar.es/2020/06/unpacking-smokeloader-and.html?showComment=1633730767401#c8634510575649657044">8 October 2021 at 15:06</a></span></div><p class="comment-content">This site have particular software articles which emits an impression of being a significant and significant for you individual, able software installation.This is the spot you can get helps for any software installation, usage and cracked.<br><a href="https://gotocracks.com/sweetscape-010-editor-crack/" rel="nofollow">sweetscape-010-editor-crack</a></p><span class="comment-actions secondary-text"><a class="comment-reply" target="_self" data-comment-id="8634510575649657044">Reply</a><span class="item-control blog-admin blog-admin pid-16725144"><a target="_self" href="https://www.blogger.com/delete-comment.g?blogID=2832371727794363441&amp;postID=8634510575649657044">Delete</a></span></span></div><div class="comment-replies"><div id="c8634510575649657044-rt" class="comment-thread inline-thread hidden"><span class="thread-toggle thread-expanded"><span class="thread-arrow"></span><span class="thread-count"><a target="_self">Replies</a></span></span><ol id="c8634510575649657044-ra" class="thread-chrome thread-expanded"><div></div><div id="c8634510575649657044-continue" class="continue"><a class="comment-reply" target="_self" data-comment-id="8634510575649657044">Reply</a></div></ol></div></div><div class="comment-replybox-single" id="c8634510575649657044-ce"></div></li><li class="comment" id="c3672838930666147876"><div class="avatar-image-container"><img src="//www.blogger.com/img/blogger_logo_round_35.png" alt=""/></div><div class="comment-block"><div class="comment-header"><cite class="user"><a href="https://www.blogger.com/profile/16640322136443841635" rel="nofollow">Ramzan Kanju</a></cite><span class="icon user "></span><span class="datetime secondary-text"><a rel="nofollow" href="https://m.alvar.es/2020/06/unpacking-smokeloader-and.html?showComment=1645149799540#c3672838930666147876">17 February 2022 at 18:03</a></span></div><p class="comment-content">Such a Nice post. Thanks for Awesome tips Keep it up <br><a href="https://gotocracks.com/disk-savvy-ultimate-enterprise-crack/" rel="nofollow">disk-savvy-ultimate-enterprise-crack</a><br><a href="https://gotocracks.com/tweak-ssd-version-crack/" rel="nofollow">tweak-ssd-version-crack</a><br><a href="https://gotocracks.com/atto-disk-benchmark-crack/" rel="nofollow">atto-disk-benchmark-crack</a><br><a href="https://gotocracks.com/tweak-ssd-version-crack-2/" rel="nofollow"> tweak-ssd-version-crack</a><br><a href="https://gotocracks.com/3dyd-youtube-source-crack/" rel="nofollow"> 3dyd-youtube-source-crack </a></p><span class="comment-actions secondary-text"><a class="comment-reply" target="_self" data-comment-id="3672838930666147876">Reply</a><span class="item-control blog-admin blog-admin pid-1081172196"><a target="_self" href="https://www.blogger.com/delete-comment.g?blogID=2832371727794363441&amp;postID=3672838930666147876">Delete</a></span></span></div><div class="comment-replies"><div id="c3672838930666147876-rt" class="comment-thread inline-thread hidden"><span class="thread-toggle thread-expanded"><span class="thread-arrow"></span><span class="thread-count"><a target="_self">Replies</a></span></span><ol id="c3672838930666147876-ra" class="thread-chrome thread-expanded"><div></div><div id="c3672838930666147876-continue" class="continue"><a class="comment-reply" target="_self" data-comment-id="3672838930666147876">Reply</a></div></ol></div></div><div class="comment-replybox-single" id="c3672838930666147876-ce"></div></li><li class="comment" id="c7129900009765051122"><div class="avatar-image-container"><img src="//resources.blogblog.com/img/blank.gif" alt=""/></div><div class="comment-block"><div class="comment-header"><cite class="user">Anonymous</cite><span class="icon user "></span><span class="datetime secondary-text"><a rel="nofollow" href="https://m.alvar.es/2020/06/unpacking-smokeloader-and.html?showComment=1670520689183#c7129900009765051122">8 December 2022 at 09:31</a></span></div><p class="comment-content">If the supplier busts and the participant does not, the participant wins. In latest years, the company demand for lowering worker bills has led to another increase in table shift time. In many gaming operations throughout North  America, sellers are required to <a href="https://%EB%A1%9C%EC%8A%A4%ED%8A%B8%EC%95%84%ED%81%AC.com/1xbet-korea.html" rel="nofollow">1xbet korea</a> deal for 80 minutes, and it appears that|it appears  that} that is changing into extra of the gaming trade norm.</p><span class="comment-actions secondary-text"><a class="comment-reply" target="_self" data-comment-id="7129900009765051122">Reply</a><span class="item-control blog-admin blog-admin pid-16725144"><a target="_self" href="https://www.blogger.com/delete-comment.g?blogID=2832371727794363441&amp;postID=7129900009765051122">Delete</a></span></span></div><div class="comment-replies"><div id="c7129900009765051122-rt" class="comment-thread inline-thread hidden"><span class="thread-toggle thread-expanded"><span class="thread-arrow"></span><span class="thread-count"><a target="_self">Replies</a></span></span><ol id="c7129900009765051122-ra" class="thread-chrome thread-expanded"><div></div><div id="c7129900009765051122-continue" class="continue"><a class="comment-reply" target="_self" data-comment-id="7129900009765051122">Reply</a></div></ol></div></div><div class="comment-replybox-single" id="c7129900009765051122-ce"></div></li></ol><div id="top-continue" class="continue"><a class="comment-reply" target="_self">Add comment</a></div><div class="comment-replybox-thread" id="top-ce"></div><div class="loadmore hidden" data-post-id="2841135887918700348"><a target="_self">Load more...</a></div></div>
</div>
</div>
<p class='comment-footer'>
<div class='comment-form'>
<a name='comment-form'></a>
<p>
</p>
<a href='https://www.blogger.com/comment/frame/2832371727794363441?po=2841135887918700348&hl=en-GB' id='comment-editor-src'></a>
<iframe allowtransparency='true' class='blogger-iframe-colorize blogger-comment-from-post' frameborder='0' height='410px' id='comment-editor' name='comment-editor' src='' width='100%'></iframe>
<script src='https://www.blogger.com/static/v1/jsbin/2315299244-comment_from_post_iframe.js' type='text/javascript'></script>
<script type='text/javascript'>
      BLOG_CMT_createIframe('https://www.blogger.com/rpc_relay.html');
    </script>
</div>
</p>
<div id='backlinks-container'>
<div id='Blog1_backlinks-container'>
</div>
</div>
</div>
</div>
<div class='inline-ad'>
<!--Can't find substitution for tag [adCode]-->
</div>

        </div></div>
      
</div>
<div class='blog-pager' id='blog-pager'>
<span id='blog-pager-newer-link'>
<a class='blog-pager-newer-link' href='https://m.alvar.es/2020/06/comparative-analysis-between-bindiff.html' id='Blog1_blog-pager-newer-link' title='Newer Post'>Newer Post</a>
</span>
<span id='blog-pager-older-link'>
<a class='blog-pager-older-link' href='https://m.alvar.es/2019/12/inline-loop-detection-for-compressing.html' id='Blog1_blog-pager-older-link' title='Older Post'>Older Post</a>
</span>
<a class='home-link' href='https://m.alvar.es/'>Home</a>
</div>
<div class='clear'></div>
<div class='post-feeds'>
<div class='feed-links'>
Subscribe to:
<a class='feed-link' href='https://m.alvar.es/feeds/2841135887918700348/comments/default' target='_blank' type='application/atom+xml'>Post Comments (Atom)</a>
</div>
</div>
</div></div>
</div>
</div>
<div class='column-left-outer'>
<div class='column-left-inner'>
<aside>
</aside>
</div>
</div>
<div class='column-right-outer'>
<div class='column-right-inner'>
<aside>
<div class='sidebar section' id='sidebar-right-1'><div class='widget BlogArchive' data-version='1' id='BlogArchive2'>
<h2>Blog Archive</h2>
<div class='widget-content'>
<div id='ArchiveList'>
<div id='BlogArchive2_ArchiveList'>
<ul class='hierarchy'>
<li class='archivedate expanded'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy toggle-open'>

        &#9660;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://m.alvar.es/2020/'>
2020
</a>
<span class='post-count' dir='ltr'>(2)</span>
<ul class='hierarchy'>
<li class='archivedate expanded'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy toggle-open'>

        &#9660;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://m.alvar.es/2020/06/'>
June
</a>
<span class='post-count' dir='ltr'>(2)</span>
<ul class='posts'>
<li><a href='https://m.alvar.es/2020/06/comparative-analysis-between-bindiff.html'>Comparative analysis between Bindiff and Diaphora ...</a></li>
<li><a href='https://m.alvar.es/2020/06/unpacking-smokeloader-and.html'>Unpacking Smokeloader and Reconstructing PE Progra...</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://m.alvar.es/2019/'>
2019
</a>
<span class='post-count' dir='ltr'>(3)</span>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://m.alvar.es/2019/12/'>
December
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://m.alvar.es/2019/10/'>
October
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://m.alvar.es/2019/08/'>
August
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://m.alvar.es/2015/'>
2015
</a>
<span class='post-count' dir='ltr'>(5)</span>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://m.alvar.es/2015/11/'>
November
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://m.alvar.es/2015/10/'>
October
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://m.alvar.es/2015/09/'>
September
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div class='clear'></div>
</div>
</div></div>
</aside>
</div>
</div>
</div>
<div style='clear: both'></div>
<!-- columns -->
</div>
<!-- main -->
</div>
</div>
<div class='main-cap-bottom cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
<footer>
<div class='footer-outer'>
<div class='footer-cap-top cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left footer-fauxborder-left'>
<div class='fauxborder-right footer-fauxborder-right'></div>
<div class='region-inner footer-inner'>
<div class='foot no-items section' id='footer-1'></div>
<!-- outside of the include in order to lock Attribution widget -->
<div class='foot section' id='footer-3' name='Footer'><div class='widget Attribution' data-version='1' id='Attribution1'>
<div class='widget-content' style='text-align: center;'>
Simple theme. Powered by <a href='https://www.blogger.com' target='_blank'>Blogger</a>.
</div>
<div class='clear'></div>
</div></div>
</div>
</div>
<div class='footer-cap-bottom cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
</footer>
<!-- content -->
</div>
</div>
<div class='content-cap-bottom cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
</div>
<script type='text/javascript'>
    window.setTimeout(function() {
        document.body.className = document.body.className.replace('loading', '');
      }, 10);
  </script>
<!--Voc\xea \xe9 respons\xe1vel por notificar os visitantes sobre os cookies usados e os dados coletados no seu blog. O Blogger disponibiliza uma notifica\xe7\xe3o padr\xe3o para usar no blog que voc\xea pode personalizar ou substituir pela sua pr\xf3pria notifica\xe7\xe3o. Veja mais detalhes em http://www.blogger.com/go/cookiechoices.-->
<script defer='' src='/js/cookienotice.js'></script>
<script>
    document.addEventListener('DOMContentLoaded', function(event) {
      window.cookieChoices && cookieChoices.showCookieConsentBar && cookieChoices.showCookieConsentBar(
          (window.cookieOptions && cookieOptions.msg) || 'Este site usa os cookies do Google para fornecer servi\xe7os e analisar o tr\xe1fego. Seu endere\xe7o IP e user agent s\xe3o compartilhados com o Google, al\xe9m das m\xe9tricas de seguran\xe7a e desempenho, para garantir a qualidade de servi\xe7o, gerar estat\xedsticas de uso e detectar e eliminar abusos.',
          (window.cookieOptions && cookieOptions.close) || 'Entendi',
          (window.cookieOptions && cookieOptions.learn) || 'Saiba mais',
          (window.cookieOptions && cookieOptions.link) || 'https://www.blogger.com/go/blogspot-cookies');
    });
  </script>

<script type="text/javascript" src="https://www.blogger.com/static/v1/widgets/3704019819-widgets.js"></script>
<script type='text/javascript'>
window['__wavt'] = 'AOuZoY5qskpXwUnZyaTXv9p3uzwbTk6SaA:1734494202750';_WidgetManager._Init('//www.blogger.com/rearrange?blogID\x3d2832371727794363441','//m.alvar.es/2020/06/unpacking-smokeloader-and.html','2832371727794363441');
_WidgetManager._SetDataContext([{'name': 'blog', 'data': {'blogId': '2832371727794363441', 'title': '\x3ca href\x3d\x22http://m.alvar.es/\x22\x3e# Malware Research Notes\x3c/a\x3e', 'url': 'https://m.alvar.es/2020/06/unpacking-smokeloader-and.html', 'canonicalUrl': 'https://m.alvar.es/2020/06/unpacking-smokeloader-and.html', 'homepageUrl': 'https://m.alvar.es/', 'searchUrl': 'https://m.alvar.es/search', 'canonicalHomepageUrl': 'https://m.alvar.es/', 'blogspotFaviconUrl': 'https://m.alvar.es/favicon.ico', 'bloggerUrl': 'https://www.blogger.com', 'hasCustomDomain': true, 'httpsEnabled': true, 'enabledCommentProfileImages': true, 'gPlusViewType': 'FILTERED_POSTMOD', 'adultContent': false, 'analyticsAccountNumber': '', 'encoding': 'UTF-8', 'locale': 'en-GB', 'localeUnderscoreDelimited': 'en_gb', 'languageDirection': 'ltr', 'isPrivate': false, 'isMobile': false, 'isMobileRequest': false, 'mobileClass': '', 'isPrivateBlog': false, 'isDynamicViewsAvailable': true, 'feedLinks': '\x3clink rel\x3d\x22alternate\x22 type\x3d\x22application/atom+xml\x22 title\x3d\x22# Malware Research Notes - Atom\x22 href\x3d\x22https://m.alvar.es/feeds/posts/default\x22 /\x3e\n\x3clink rel\x3d\x22alternate\x22 type\x3d\x22application/rss+xml\x22 title\x3d\x22# Malware Research Notes - RSS\x22 href\x3d\x22https://m.alvar.es/feeds/posts/default?alt\x3drss\x22 /\x3e\n\x3clink rel\x3d\x22service.post\x22 type\x3d\x22application/atom+xml\x22 title\x3d\x22# Malware Research Notes - Atom\x22 href\x3d\x22https://www.blogger.com/feeds/2832371727794363441/posts/default\x22 /\x3e\n\n\x3clink rel\x3d\x22alternate\x22 type\x3d\x22application/atom+xml\x22 title\x3d\x22# Malware Research Notes - Atom\x22 href\x3d\x22https://m.alvar.es/feeds/2841135887918700348/comments/default\x22 /\x3e\n', 'meTag': '', 'adsenseHostId': 'ca-host-pub-1556223355139109', 'adsenseHasAds': false, 'adsenseAutoAds': false, 'boqCommentIframeForm': true, 'loginRedirectParam': '', 'view': '', 'dynamicViewsCommentsSrc': '//www.blogblog.com/dynamicviews/4224c15c4e7c9321/js/comments.js', 'dynamicViewsScriptSrc': '//www.blogblog.com/dynamicviews/2dbf2ee4cef330c7', 'plusOneApiSrc': 'https://apis.google.com/js/platform.js', 'disableGComments': true, 'interstitialAccepted': false, 'sharing': {'platforms': [{'name': 'Get link', 'key': 'link', 'shareMessage': 'Get link', 'target': ''}, {'name': 'Facebook', 'key': 'facebook', 'shareMessage': 'Share to Facebook', 'target': 'facebook'}, {'name': 'BlogThis!', 'key': 'blogThis', 'shareMessage': 'BlogThis!', 'target': 'blog'}, {'name': 'X', 'key': 'twitter', 'shareMessage': 'Share to X', 'target': 'twitter'}, {'name': 'Pinterest', 'key': 'pinterest', 'shareMessage': 'Share to Pinterest', 'target': 'pinterest'}, {'name': 'Email', 'key': 'email', 'shareMessage': 'Email', 'target': 'email'}], 'disableGooglePlus': true, 'googlePlusShareButtonWidth': 0, 'googlePlusBootstrap': '\x3cscript type\x3d\x22text/javascript\x22\x3ewindow.___gcfg \x3d {\x27lang\x27: \x27en_GB\x27};\x3c/script\x3e'}, 'hasCustomJumpLinkMessage': false, 'jumpLinkMessage': 'Read more', 'pageType': 'item', 'postId': '2841135887918700348', 'postImageThumbnailUrl': 'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEglPVKy2GCb904fH5-8sclD8KyetJI737L5QIQhwIXrTykMxBPFZWNhApE4-RRmThQJIDRMwD3lpe4Xuhw_FJ1-y_Bw1R8z2khiFLOqmPS2RCWPZsrH7f4udY3BDzwZqhbuJwGAHUy5J2s/s72-w400-c-h275/Screenshot+2020-06-08+at+00.43.13.png', 'postImageUrl': 'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEglPVKy2GCb904fH5-8sclD8KyetJI737L5QIQhwIXrTykMxBPFZWNhApE4-RRmThQJIDRMwD3lpe4Xuhw_FJ1-y_Bw1R8z2khiFLOqmPS2RCWPZsrH7f4udY3BDzwZqhbuJwGAHUy5J2s/w400-h275/Screenshot+2020-06-08+at+00.43.13.png', 'pageName': 'Unpacking Smokeloader and Reconstructing PE Programatically using LIEF', 'pageTitle': '# Malware Research Notes: Unpacking Smokeloader and Reconstructing PE Programatically using LIEF'}}, {'name': 'features', 'data': {}}, {'name': 'messages', 'data': {'edit': 'Edit', 'linkCopiedToClipboard': 'Link copied to clipboard', 'ok': 'Ok', 'postLink': 'Post link'}}, {'name': 'template', 'data': {'name': 'Simple', 'localizedName': 'Simple', 'isResponsive': false, 'isAlternateRendering': false, 'isCustom': false, 'variant': 'dark', 'variantId': 'dark'}}, {'name': 'view', 'data': {'classic': {'name': 'classic', 'url': '?view\x3dclassic'}, 'flipcard': {'name': 'flipcard', 'url': '?view\x3dflipcard'}, 'magazine': {'name': 'magazine', 'url': '?view\x3dmagazine'}, 'mosaic': {'name': 'mosaic', 'url': '?view\x3dmosaic'}, 'sidebar': {'name': 'sidebar', 'url': '?view\x3dsidebar'}, 'snapshot': {'name': 'snapshot', 'url': '?view\x3dsnapshot'}, 'timeslide': {'name': 'timeslide', 'url': '?view\x3dtimeslide'}, 'isMobile': false, 'title': 'Unpacking Smokeloader and Reconstructing PE Programatically using LIEF', 'description': 'This article holds notes on my experience unpacking a Smokeloader  2020 sample. The unpacked payload is further used for composing a valid P...', 'featuredImage': 'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEglPVKy2GCb904fH5-8sclD8KyetJI737L5QIQhwIXrTykMxBPFZWNhApE4-RRmThQJIDRMwD3lpe4Xuhw_FJ1-y_Bw1R8z2khiFLOqmPS2RCWPZsrH7f4udY3BDzwZqhbuJwGAHUy5J2s/w400-h275/Screenshot+2020-06-08+at+00.43.13.png', 'url': 'https://m.alvar.es/2020/06/unpacking-smokeloader-and.html', 'type': 'item', 'isSingleItem': true, 'isMultipleItems': false, 'isError': false, 'isPage': false, 'isPost': true, 'isHomepage': false, 'isArchive': false, 'isLabelSearch': false, 'postId': 2841135887918700348}}]);
_WidgetManager._RegisterWidget('_HeaderView', new _WidgetInfo('Header1', 'header', document.getElementById('Header1'), {}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_BlogView', new _WidgetInfo('Blog1', 'main', document.getElementById('Blog1'), {'cmtInteractionsEnabled': false, 'lightboxEnabled': true, 'lightboxModuleUrl': 'https://www.blogger.com/static/v1/jsbin/126001200-lbx__en_gb.js', 'lightboxCssUrl': 'https://www.blogger.com/static/v1/v-css/1964470060-lightbox_bundle.css'}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_BlogArchiveView', new _WidgetInfo('BlogArchive2', 'sidebar-right-1', document.getElementById('BlogArchive2'), {'languageDirection': 'ltr', 'loadingMessage': 'Loading\x26hellip;'}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_AttributionView', new _WidgetInfo('Attribution1', 'footer-3', document.getElementById('Attribution1'), {}, 'displayModeFull'));
</script>
</body>
</html>