<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><title>TrickBot and Zeus - Kryptos Logic</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=title content="TrickBot and Zeus"><meta name=description content="Overview TrickBot is an established and widespread multi-purpose trojan. Active since 2016 and modular in nature, it can accomplish a variety of goals ranging from credential theft to lateral movement. Many of the malware&rsquo;s capabilities come as self-contained modules, which the malware is instructed to download from the C2. Initially, TrickBot&rsquo;s main focus was bank fraud, but this later shifted toward corporate targetted ransomware attacks, eventually resulting in the discontinuation of their fraud operation."><meta name=twitter:card content="summary_large_image"><meta name=twitter:site content="@kryptoslogic"><meta name=twitter:title content="TrickBot and Zeus"><meta name=twitter:description content="Overview TrickBot is an established and widespread multi-purpose trojan. Active since 2016 and modular in nature, it can accomplish a variety of goals ranging from credential theft to lateral movement. Many of the malware&rsquo;s capabilities come as self-contained modules, which the malware is instructed to download from the C2. Initially, TrickBot&rsquo;s main focus was bank fraud, but this later shifted toward corporate targetted ransomware attacks, eventually resulting in the discontinuation of their fraud operation."><meta property="og:url" content="https://www.kryptoslogic.com/blog/2021/07/trickbot-and-zeus/"><meta property="og:title" content="TrickBot and Zeus"><meta property="og:description" content="Overview TrickBot is an established and widespread multi-purpose trojan. Active since 2016 and modular in nature, it can accomplish a variety of goals ranging from credential theft to lateral movement. Many of the malware&rsquo;s capabilities come as self-contained modules, which the malware is instructed to download from the C2. Initially, TrickBot&rsquo;s main focus was bank fraud, but this later shifted toward corporate targetted ransomware attacks, eventually resulting in the discontinuation of their fraud operation."><meta property="og:image" content="https://www.kryptoslogic.com/blog/2021/07/trickbot-and-zeus/images/header_hu1a63ea3df7b0433ebb68aeac839ed1b0_39564_800x418_fit_box_2.png"><meta name=twitter:image content="https://www.kryptoslogic.com/blog/2021/07/trickbot-and-zeus/images/header_hu1a63ea3df7b0433ebb68aeac839ed1b0_39564_800x418_fit_box_2.png"><link rel=icon href=https://www.kryptoslogic.com/favicon.png><link rel=stylesheet href=/css/style.min.80c1a32b0bec38fbdc5370e02ca3f5e64b5f44111ffd26fa3419f2f4f89fe914.css></head><body class=page><div class=wrapper><header class="kl-navbar kl-navbar--fixed kl-navbar-expand-lg"><div class=container><a class=kl-navbar-logo href=https://www.kryptoslogic.com/><img alt="Kryptos Logic" src=https://www.kryptoslogic.com/images/logo.svg></a>
<button class=kl-navbar-toggler type=button data-toggle=collapse data-target=#kl-navbar-dropdown aria-controls=kl-navbar-dropdown aria-expanded=false aria-label=Menu>
<span class=kl-navbar-toggler-icon></span><span class=kl-navbar-toggler-text>Menu</span></button><div class="collapse kl-navbar-collapse" id=kl-navbar-dropdown><ul class="kl-navbar-nav ml-auto"><li class="kl-nav-item kl-nav-item--products dropdown"><a class="kl-nav-link dropdown-toggle" href=# role=button data-toggle=dropdown>Products</a><div class=dropdown-menu><a class=dropdown-item href=/products/telltale/>Telltale</a></div></li><li class="kl-nav-item kl-nav-item--blog"><a class=kl-nav-link href=/blog/>Blog</a></li><li class="kl-nav-item kl-nav-item--jobs"><a class=kl-nav-link href=/jobs/>Jobs</a></li><li class="kl-nav-item kl-nav-item--contact us"><a class=kl-nav-link href=/contact/>Contact Us</a></li></ul></div></div></header><div class=main><div class="container pt-6"><div class="row justify-content-start"><div class=col-lg-9><div class=blog-post><header class=blog-post-header><h2 class=blog-post-title><a href=https://www.kryptoslogic.com/blog/2021/07/trickbot-and-zeus/>TrickBot and Zeus</a></h2><span class=blog-post-author>Authored by:
<a target=_blank href=https://twitter.com/kryptoslogic>Kryptos Logic Vantage Team</a>
on</span>
<time class=blog-post-date datetime="2021-07-01 23:00:00 +0000 UTC">Thursday, July 1, 2021<br>Tags:
<a href=https://www.kryptoslogic.com/blog/tag/trickbot>TrickBot</a></time></header><div class=blog-post-content><p><h1 id=overview>Overview</h1><p>TrickBot is an established and widespread multi-purpose trojan. Active since 2016 and modular in nature, it can accomplish a variety of goals ranging from credential theft to lateral movement. Many of the malware&rsquo;s capabilities come as self-contained modules, which the malware is instructed to download from the C2. Initially, TrickBot&rsquo;s main focus was bank fraud, but this later shifted toward corporate targetted ransomware attacks, eventually resulting in the discontinuation of their fraud operation.</p><p>In June 2021, Kryptos Logic Threat Intelligence team began observing new developments to the TrickBot webinject module. TrickBot&rsquo;s webinject module supports both static and dynamic configuration for injects. The static inject type causes the victim to be redirected to an attacker-controlled replica of the intended destination site, where credentials can then be harvested. The dynamic inject type transparently forwards the server response to the TrickBot C2, where the source is then modified to contain malicious components, before being returned to the victim as though it came from the legitimate site. In the current iteration of the webinject module, injects are achieved by proxying traffic through a local SOCKS server, if the traffic matches a list of target URLs the traffic is modified accordingly.</p><p>Through our monitoring, we were able to obtain a debug version of the module, which contained new features being tested. In this evolution of their webinject capabilities, TrickBot has added support for Zeus-style webinject configs. During development the module was served under a test name and supported parsing configs named <code>zeus</code>. We have since observed the updated module being pushed out to real victims under the name <code>injectDll</code>, superseding their old webinject module. Previously, webinject configs were stored in two files named <code>sinj</code> (static injects) and <code>dinj</code> (dynamic injects). Now, there exists a single config file named <code>winj</code> containing Zeus-style webinjects.</p><h1 id=injectdll>InjectDLL</h1><p>We began observing new changes to their webinject module when we came across a debug build uploaded to <sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>VirusTotal. This module was different from the previous known webinjects, since it makes reference to a config by the name of <code>winj</code>.</p><p>However, we were not able to pull down such a debug build from the C2 servers, since we were not aware of the base name that was given to the module. Base names are the names given to modules by TrickBot, and are used by the main bot to fetch these modules from TrickBot&rsquo;s plugin servers.</p><p>Currently we are seeing the bot pull down the released versions of webinject module as <code>injectDll32</code> and <code>injectDll64</code> for the 32-bit and 64-bit module respectively.</p><p>An example for a module request made by the main bot is as follows:<br><code>https://&lt;c2_address>/&lt;gtag>/&lt;unique_bot_id>/5/injectDll64/</code></p><p>In this blog we will not go into detail on how the main bot communicates to its C2, since it has already been covered<sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>.</p><h2 id=winj-config>winj Config</h2><p>In this module we see the introduction of Zeus webinject configs, in addition to the regular webinject configs that TrickBot previously used. A good description on how the webinject config works can be found in its leaked manual<sup id=fnref:3><a href=#fn:3 class=footnote-ref role=doc-noteref>3</a></sup>.</p><p>Due to Zeus having been the gold standard for banking malware, Zeus-style webinjects are extremely popular. It is not uncommon for other malware families to support Zeus-style webinject syntax for cross-compatibility (<sup id=fnref:4><a href=#fn:4 class=footnote-ref role=doc-noteref>4</a></sup>Zloader, <sup id=fnref:5><a href=#fn:5 class=footnote-ref role=doc-noteref>5</a></sup>Citadel, to name a few).</p><p>In the debug version, the module referred to this new config simply as <code>zeus</code>; however in the release version this has been renamed to <code>winj</code>. As with the previous webinjects, the module is able to parse the usual webinject configs <code>dinj</code> and <code>sinj</code>. Additionally, they continue to use the <code>dpost</code> configs in order to send the results of the webjects to the handler C2s.</p><p>Example <code>winj</code>:</p><pre><code>set_url &lt;target-website-url&gt; GP
data_before
data_end
data_after
&lt;/head&gt;
data_end
data_inject
&lt;script&gt;&lt;/script&gt;
data_end
</code></pre><h2 id=mitm>MitM</h2><p>As previously reported<sup id=fnref:6><a href=#fn:6 class=footnote-ref role=doc-noteref>6</a></sup>, the module shares substantial code with IcedID/Bokbot&rsquo;s Man-in-the-Browser webinject module. To MitM TLS connections, it creates a self-signed TLS certificate and adds it to the certificate store. The module contains a packed payload that is injected into the victim&rsquo;s browser, where it hooks socket APIs to redirect traffic to a locally listening SOCKS proxy, it also hooks <code>CertVerifyCertificateChainPolicy</code> and <code>CertGetCertificateChain</code> to ensure no certificate errors are shown to the victim.</p><hr><h1 id=conclusion>Conclusion</h1><p>The resumption of development of the webinject module indicates that TrickBot intends to revive its bank fraud operation, which appears to have been shelved for over a year. The addition of Zeus-style webinjects may suggest expansion of their Malware-as-a-Service platform, enabling users to bring their own webinjects.</p><hr><h1 id=iocs>IOCs</h1><div class=overflow-auto-md><table><thead><tr><th style=text-align:left>SHA256</th><th style=text-align:left>Module Base Name</th><th>Description</th></tr></thead><tbody><tr><td style=text-align:left>dd268740958fe3829c927054b900f6287235662cd93c1e91d51c38c44eb2571b</td><td style=text-align:left>n/a</td><td>32-bit Webinject Debug Module</td></tr><tr><td style=text-align:left>3bd5117466a9bcd539a482343957f8c9a74ad2fa0d5da959fcfa0d42beb9133d</td><td style=text-align:left>n/a</td><td>64-bit Webinject Debug Module</td></tr><tr><td style=text-align:left>c79f016996b45cd7cc88aa3ce6c4d1ab247a1d803de4b742f64f3bf1e183ffb0</td><td style=text-align:left>injectDll32</td><td>32-bit Webinject Module</td></tr><tr><td style=text-align:left>19f4f1ca50b3306c9d953e12e573b1e65670b110b358d0240e55331c7ed0d76f</td><td style=text-align:left>injectDll64</td><td>64-bit Webinject Module</td></tr></tbody></table></div><hr><h1 id=yara>YARA</h1><pre><code>rule TrickBot__Webinject
{
    meta:
        id = &quot;7eKHCSumVp7QRXF0z7BC1i&quot;
        fingerprint = &quot;8a66f290d84a54e8ee148c461513627e83b8f092acebe8251c6098a88d8c4eba&quot;
        version = &quot;1.0&quot;
        first_imported = &quot;2021-07-01&quot;
        last_modified = &quot;2021-07-01&quot;
        status = &quot;RELEASED&quot;
        sharing = &quot;TLP:WHITE&quot;
        source = &quot;KRYPTOS LOGIC&quot;
        author = &quot;KRYPTOS LOGIC&quot;
        description = &quot;Detects TrickBot updated Webinject module&quot;
        category = &quot;MALWARE&quot;
        malware = &quot;BOT&quot;
        hash = &quot;c79f016996b45cd7cc88aa3ce6c4d1ab247a1d803de4b742f64f3bf1e183ffb0&quot;

    strings:
        $a = &quot;c:\\developer\\webinject\\http-lib\\parser.c&quot; wide
        $zeus1 = &quot;data_before&quot;
        $zeus2 = &quot;data_after&quot;
        $zeus3 = &quot;data_inject&quot;
        $zeus4 = &quot;data_end&quot;
        $name = /wbi-x(86|64).dll/

    condition:
        all of them
}
</code></pre><hr><h1 id=references>References</h1><section class=footnotes role=doc-endnotes><hr><ol><li id=fn:1 role=doc-endnote><p><a href=https://www.virustotal.com/gui/file/dd268740958fe3829c927054b900f6287235662cd93c1e91d51c38c44eb2571b/detection>https://www.virustotal.com/gui/file/dd268740958fe3829c927054b900f6287235662cd93c1e91d51c38c44eb2571b/detection</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2 role=doc-endnote><p><a href=https://gist.github.com/hasherezade/88837ea728d3950c7c38160d016ea6cf>https://gist.github.com/hasherezade/88837ea728d3950c7c38160d016ea6cf</a>&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:3 role=doc-endnote><p><a href=https://github.com/Visgean/Zeus/blob/translation/manual_en.html>https://github.com/Visgean/Zeus/blob/translation/manual_en.html</a>&#160;<a href=#fnref:3 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:4 role=doc-endnote><p><a href="https://www.malwarebytes.com/resources/files/2020/06/the-silent-night-zloader-zbot_final.pdf#page=15">https://www.malwarebytes.com/resources/files/2020/06/the-silent-night-zloader-zbot_final.pdf#page=15</a>&#160;<a href=#fnref:4 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:5 role=doc-endnote><p><a href=https://www.virusbulletin.com/virusbulletin/2014/09/prosecting-citadel-botnet-revealing-dominance-zeus-descendent-part-one>https://www.virusbulletin.com/virusbulletin/2014/09/prosecting-citadel-botnet-revealing-dominance-zeus-descendent-part-one</a>&#160;<a href=#fnref:5 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:6 role=doc-endnote><p><a href=https://www.bleepingcomputer.com/news/security/TrickBot-trojan-gets-icedid-proxy-module-to-steal-banking-info/>https://www.bleepingcomputer.com/news/security/TrickBot-trojan-gets-icedid-proxy-module-to-steal-banking-info/</a>&#160;<a href=#fnref:6 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></section></p></div></div></div><div class=col-lg-3><div class=blog-post-widget><h2>Connect with Kryptos</h2><ul class=blog-social-list><li class=social--email><a href="/cdn-cgi/l/email-protection#3c4f494c4c534e487c574e454c48534f50535b555f125f5351" title="Kryptos Logic Support Email" target=_blank><i class="fas fa-envelope"></i></a></li><li class=social--twitter><a href=https://twitter.com/kryptoslogic title="Kryptos Logic on Twitter" target=_blank><i class="fab fa-twitter"></i></a></li><li class=social--linkedin><a href=https://www.linkedin.com/company/kryptos-logic title="Kryptos Logic on Linkedin" target=_blank><i class="fab fa-linkedin"></i></a></li><li class=social--github><a href=https://github.com/kryptoslogic title="Kryptos Logic on GitHub" target=_blank><i class="fab fa-github"></i></a></li><li class=social--github><a href=https://www.kryptoslogic.com/blog/index.xml title="Blog Posts RSS"><i class="fas fa-rss"></i></a></li></ul></div><div class=blog-post-widget><h2>Recent Posts</h2><ul><li><a href=/blog/2022/01/deep-dive-into-trickbots-web-injection/>Deep Dive into Trickbot's Web Injection</a>, 24 Jan, 2022</li><li><a href=/blog/2021/07/adjusting-the-anchor/>Adjusting the Anchor</a>, 15 Jul, 2021</li><li><a href=/blog/2021/07/trickbot-and-zeus/>TrickBot and Zeus</a>, 01 Jul, 2021</li><li><a href=/blog/2021/02/trickbot-masrv-module/>TrickBot masrv Module</a>, 01 Feb, 2021</li><li><a href=/blog/2021/01/faster-poly1305-key-multicollisions/>Faster Poly1305 key multicollisions</a>, 13 Jan, 2021</li></ul></div><div class=blog-post-widget><h2>Categories</h2><ul><li><a href=https://www.kryptoslogic.com/blog/category/malware>malware</a> (14)</li><li><a href=https://www.kryptoslogic.com/blog/category/crypto>crypto</a> (3)</li><li><a href=https://www.kryptoslogic.com/blog/category/linux>linux</a> (1)</li><li><a href=https://www.kryptoslogic.com/blog/category/program-analysis>program-analysis</a> (1)</li><li><a href=https://www.kryptoslogic.com/blog/category/reverse-engineering>reverse-engineering</a> (1)</li><li><a href=https://www.kryptoslogic.com/blog/category/vulnerability>vulnerability</a> (1)</li></ul></div><div class=blog-post-widget><h2>Tags</h2><ul><li><a href=https://www.kryptoslogic.com/blog/tag/emotet>emotet</a> (4)</li><li><a href=https://www.kryptoslogic.com/blog/tag/trickbot>trickbot</a> (3)</li><li><a href=https://www.kryptoslogic.com/blog/tag/wannacry>wannacry</a> (3)</li><li><a href=https://www.kryptoslogic.com/blog/tag/exploit>exploit</a> (2)</li><li><a href=https://www.kryptoslogic.com/blog/tag/anchor>anchor</a> (1)</li><li><a href=https://www.kryptoslogic.com/blog/tag/bluekeep>bluekeep</a> (1)</li><li><a href=https://www.kryptoslogic.com/blog/tag/coinmining>coinmining</a> (1)</li><li><a href=https://www.kryptoslogic.com/blog/tag/cve-2020-0609>cve-2020-0609</a> (1)</li><li><a href=https://www.kryptoslogic.com/blog/tag/cve-2020-0610>cve-2020-0610</a> (1)</li><li><a href=https://www.kryptoslogic.com/blog/tag/petya>petya</a> (1)</li></ul></div></div></div></div></div></div><div class=footer><div class=container><div class=row><div class=col-12><div class=footer-inner><h3 class=footer-title>Kryptos Logic</h3></div></div></div></div><div class=sub-footer><div class=container><ul class=footer-social-list><li class=social--email><a href="/cdn-cgi/l/email-protection#f88b8d8888978a8cb8938a81888c978b94979f919bd69b9795" title="Kryptos Logic Support Email" target=_blank><i class="fas fa-envelope"></i></a></li><li class=social--twitter><a href=https://twitter.com/kryptoslogic title="Kryptos Logic on Twitter" target=_blank><i class="fab fa-twitter"></i></a></li><li class=social--linkedin><a href=https://www.linkedin.com/company/kryptos-logic title="Kryptos Logic on Linkedin" target=_blank><i class="fab fa-linkedin"></i></a></li><li class=social--github><a href=https://github.com/kryptoslogic title="Kryptos Logic on GitHub" target=_blank><i class="fab fa-github"></i></a></li></ul><ul><li>Â© 2024 Kryptos Logic</li><li><a href=https://www.kryptoslogic.com/blog>Blog</a></li><li><a href=https://www.kryptoslogic.com/contact>Support</a></li><li><a href=https://www.kryptoslogic.com/terms>Terms</a></li><li><a href=https://www.kryptoslogic.com/privacy>Privacy</a></li><li><a href=https://www.kryptoslogic.com/jobs>Jobs</a></li></ul></div></div></div><script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/OwlCarousel2/2.3.4/owl.carousel.min.js integrity="sha256-pTxD+DSzIwmwhOqTFN+DB+nHjO4iAsbgfyFq5K5bcE0=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/js/bootstrap.bundle.min.js integrity="sha256-fzFFyH01cBVPYzl16KT40wqjhgPtq6FFUB6ckN2+GGw=" crossorigin=anonymous></script><script type=text/javascript src=/js/bundle.min.c8d5dd0eddb1cc4e0507a2b1c83f71c19a0fc6d71d14d7ad9dc9a9c89b5f7ab6.js></script></body></html>