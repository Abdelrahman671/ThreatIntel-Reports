<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>Manually unpacking Anubis APK | Random RE</title>
<meta name="generator" content="Jekyll v3.8.5" />
<meta property="og:title" content="Manually unpacking Anubis APK" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="I’ve been seeing people talk about Anubis lately so I decided to take a look at it, unfortunately these led me to a whole bunch of packed APK files. Obviously there are blog posts describing the unpack files but all the hashes are leading me to the packed versions. So what do you do in this situation? Well you learn how to search basically, just like you have to learn how to use your favorite search engine if you have a virustotal account you end up having to figure out how to search for whatever you’re looking for. Take a look at the jadx-gui picture in this phishlabs writeup[1], in this writeup we can see a number of strings but if we search for the twitter address on VirusTotal[2] then we come up with a number of classes.dex files." />
<meta property="og:description" content="I’ve been seeing people talk about Anubis lately so I decided to take a look at it, unfortunately these led me to a whole bunch of packed APK files. Obviously there are blog posts describing the unpack files but all the hashes are leading me to the packed versions. So what do you do in this situation? Well you learn how to search basically, just like you have to learn how to use your favorite search engine if you have a virustotal account you end up having to figure out how to search for whatever you’re looking for. Take a look at the jadx-gui picture in this phishlabs writeup[1], in this writeup we can see a number of strings but if we search for the twitter address on VirusTotal[2] then we come up with a number of classes.dex files." />
<link rel="canonical" href="/malware,/reverse-engineering/2018/08/30/Unpacking-Anubis-APK.html" />
<meta property="og:url" content="/malware,/reverse-engineering/2018/08/30/Unpacking-Anubis-APK.html" />
<meta property="og:site_name" content="Random RE" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-08-30T16:31:12+00:00" />
<script type="application/ld+json">
{"@type":"BlogPosting","headline":"Manually unpacking Anubis APK","dateModified":"2018-08-30T16:31:12+00:00","datePublished":"2018-08-30T16:31:12+00:00","url":"/malware,/reverse-engineering/2018/08/30/Unpacking-Anubis-APK.html","mainEntityOfPage":{"@type":"WebPage","@id":"/malware,/reverse-engineering/2018/08/30/Unpacking-Anubis-APK.html"},"description":"I’ve been seeing people talk about Anubis lately so I decided to take a look at it, unfortunately these led me to a whole bunch of packed APK files. Obviously there are blog posts describing the unpack files but all the hashes are leading me to the packed versions. So what do you do in this situation? Well you learn how to search basically, just like you have to learn how to use your favorite search engine if you have a virustotal account you end up having to figure out how to search for whatever you’re looking for. Take a look at the jadx-gui picture in this phishlabs writeup[1], in this writeup we can see a number of strings but if we search for the twitter address on VirusTotal[2] then we come up with a number of classes.dex files.","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="Random RE" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/">Random RE</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/about/">About</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Manually unpacking Anubis APK</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2018-08-30T16:31:12+00:00" itemprop="datePublished">Aug 30, 2018
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p>I’ve been seeing people talk about Anubis lately so I decided to take a look at it, unfortunately these led me to a whole bunch of packed APK files. Obviously there are blog posts describing the unpack files but all the hashes are leading me to the packed versions. So what do you do in this situation? Well you learn how to search basically, just like you have to learn how to use your favorite search engine if you have a virustotal account you end up having to figure out how to search for whatever you’re looking for. Take a look at the jadx-gui picture in this phishlabs writeup[<a href="https://info.phishlabs.com/blog/bankbot-anubis-threat-upgrade">1</a>], in this writeup we can see a number of strings but if we search for the twitter address on VirusTotal[<a href="https://www.virustotal.com/#/intelligence-overview">2</a>] then we come up with a number of classes.dex files.</p>

<p>Example hash:  7118e74f6a1bad86fa0a72c3e5e424c36c11087c4e369b09dcb7bf5c3ace78fa</p>

<p>Searching for the twitter address from the aforementioned writeup leads us to a number of dex files in VirusTotal</p>

<p><img src="/assets/anubis_unpack/anubis_dex_file.png" alt="Anubis Class Dex" title="Anubis DEX File" /></p>

<p>We can then pivot backwards from this file to see where this dex file came from by utilizing the ITW(In The Wild) tab which will show that it came from a file bundle.</p>

<p><img src="/assets/anubis_unpack/dex_itw.png" alt="Anubis Dex file bundle" title="Anubis DEX File ITW" /></p>

<p>This file bundle is just a zipped up classes.dex file, using the ITW tab again we see it was created during the execution of another file.</p>

<p><img src="/assets/anubis_unpack/zip_execution_parent.png" alt="Anubis ITW execution" title="Anubis DEX parent" /></p>

<p>This parent file is an APK with a similar looking obfuscation as the other files I had looked at from reading reports! So these obfuscated APKs are creating these Anubis DEX files which is actually a common occurrence with packed APK files that keep an encoded DEX file on board as a resource.</p>

<p>Another hint that this is packed is by taking a look at the manifest inside this APK.</p>

<p><img src="/assets/anubis_unpack/1_Manifest_shows_other_calls.png" alt="Anubis Manifest" title="Odd calls in Manifest" /></p>

<p>We can see lots of referenced code in the manifest which doesn’t actually exist in the current decompiled DEX file, this is another very big indicator that we’re dealing with an encoded DEX file in this APK. So the idea is that initial execution in this APK will decode the hidden classes.dex file and replace the current one with that one. Since the resources has a file called ‘files’ which is just binary data I assume all my theories up until now are true, we could then just execute the APK and catch the decoded classes.dex file like how sandboxes do but that’s not really any fun.</p>

<p>So a few possible ways to attack finding the relevant code section that will be responsible for decoding the dex file, we can trace execution through the obfuscated code of the current dex file and look for possibilities or interesting functions, you can look for where the resource object gets loaded and then trace that, or you can just blindly look for functions that might appear to be doing something interesting and then backtrack. You’d actually be surprised how often number 3 works after you have a few years experience with reverse engineering malware.</p>

<p>For this one however because of all the garbage code that’s been addded I just literally searched the decompiled code for “^ “ and ended up finding an interesting little function that was being called with an array of integers over and over again by the int values were changing(obfuscated strings?).</p>

<p><img src="/assets/anubis_unpack/6_xor_data.png" alt="Anubis XOR data" title="Data being XORd" /></p>

<p>If you’ve spent much time reversing encoding and encryption algorithms you might recognize the general flow of that code block but I won’t ruin the surprise for now for the rest of you.</p>

<p>Backtracking we can see this function and others named the same, this is basically an overloaded function which can make tracing execution a little painful as you have to match up which function does what based on which parameters are passed. Ofcourse since there’s garbage code and obfuscation that can be easier said than done sometimes.</p>

<p><img src="/assets/anubis_unpack/3_Call_uses_another_variable.png" alt="Anubis overloaded function" title="Anubis overloaded function" /></p>

<p>So this function takes an array and then it sets the byte array that it ends up XORing so what is this ‘OAeAqJYuzXcD’? Searching for it shows that it’s built as a byte array.</p>

<p><img src="/assets/anubis_unpack/4_Created_256_byte_array.png" alt="Anubis build byte array" title="Anubis build byte array" /></p>

<p>The value being passed in for the length of the array is 256 so this a byte array of length 256. Searching for this array some more shows that it’s also used with the same 256 value and filled with data based on a byte array passed in. So this looks like it’s building an SBOX similar to RC4. Looking for how this all gets called shows that it ends up being called near the top of the ‘com.lpapxwl.bemtobai.SVBkpSlwf’ class.</p>

<p><img src="/assets/anubis_unpack/5_build_rc4_sbox.png" alt="Anubis build RC4 SBOX" title="Anubis build RC4 SBOX" /></p>

<p>We can continue to follow that plus the previously identified function that was XORing the SBOX back to a section of code near the top of the same code page.</p>

<p><img src="/assets/anubis_unpack/2_anubis_call_with_key.png" alt="Anubis Decoding overview" title="Anubis Decode overview" /></p>

<p>What stands out there is that another 256 byte array is being built and then passed in to the ‘dlPiWCFOIB’ function and then passed into the overloaded function that builds the SBOX like we previously found. Looking up the ‘dlPiWCFOIB’ function shows that it is initializing the SBOX.</p>

<p><img src="/assets/anubis_unpack/anubis_init_sbox.png" alt="Anubis Init SBOX" title="Anubis Init SBOX" /></p>

<p>So could the array of integers at the top of the decoding overview screenshot be the RC4 key then? Let’s test it on the binary data blob we found in the resources.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="s">"(byte) 75, (byte) 41, (byte) -22, (byte) 1, (byte) -99, (byte) -118, (byte) 73, (byte) 34, (byte) 71, (byte) -89, (byte) -26, (byte) 11, (byte) -21, (byte) 24, (byte) -108, (byte) -24, (byte) 24, (byte) 89, (byte) 20, (byte) 91, (byte) -49, (byte) 104, (byte) -99, (byte) -16, (byte) 27, (byte) 73, (byte) 38, (byte) -123, (byte) -60, (byte) 14, (byte) -71, (byte) -4, (byte) 102, (byte) -96, (byte) 37, (byte) 46, (byte) -101, (byte) -13, (byte) 24, (byte) -44, (byte) -56, (byte) -95"</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">a</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">'(byte) '</span><span class="p">)</span>
<span class="p">[</span><span class="s">''</span><span class="p">,</span> <span class="s">'75, '</span><span class="p">,</span> <span class="s">'41, '</span><span class="p">,</span> <span class="s">'-22, '</span><span class="p">,</span> <span class="s">'1, '</span><span class="p">,</span> <span class="s">'-99, '</span><span class="p">,</span> <span class="s">'-118, '</span><span class="p">,</span> <span class="s">'73, '</span><span class="p">,</span> <span class="s">'34, '</span><span class="p">,</span> <span class="s">'71, '</span><span class="p">,</span> <span class="s">'-89, '</span><span class="p">,</span> <span class="s">'-26, '</span><span class="p">,</span> <span class="s">'11, '</span><span class="p">,</span> <span class="s">'-21, '</span><span class="p">,</span> <span class="s">'24, '</span><span class="p">,</span> <span class="s">'-108, '</span><span class="p">,</span> <span class="s">'-24, '</span><span class="p">,</span> <span class="s">'24, '</span><span class="p">,</span> <span class="s">'89, '</span><span class="p">,</span> <span class="s">'20, '</span><span class="p">,</span> <span class="s">'91, '</span><span class="p">,</span> <span class="s">'-49, '</span><span class="p">,</span> <span class="s">'104, '</span><span class="p">,</span> <span class="s">'-99, '</span><span class="p">,</span> <span class="s">'-16, '</span><span class="p">,</span> <span class="s">'27, '</span><span class="p">,</span> <span class="s">'73, '</span><span class="p">,</span> <span class="s">'38, '</span><span class="p">,</span> <span class="s">'-123, '</span><span class="p">,</span> <span class="s">'-60, '</span><span class="p">,</span> <span class="s">'14, '</span><span class="p">,</span> <span class="s">'-71, '</span><span class="p">,</span> <span class="s">'-4, '</span><span class="p">,</span> <span class="s">'102, '</span><span class="p">,</span> <span class="s">'-96, '</span><span class="p">,</span> <span class="s">'37, '</span><span class="p">,</span> <span class="s">'46, '</span><span class="p">,</span> <span class="s">'-101, '</span><span class="p">,</span> <span class="s">'-13, '</span><span class="p">,</span> <span class="s">'24, '</span><span class="p">,</span> <span class="s">'-44, '</span><span class="p">,</span> <span class="s">'-56, '</span><span class="p">,</span> <span class="s">'-95'</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">'(byte) '</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">b</span>
<span class="p">[</span><span class="s">''</span><span class="p">,</span> <span class="s">'75, '</span><span class="p">,</span> <span class="s">'41, '</span><span class="p">,</span> <span class="s">'-22, '</span><span class="p">,</span> <span class="s">'1, '</span><span class="p">,</span> <span class="s">'-99, '</span><span class="p">,</span> <span class="s">'-118, '</span><span class="p">,</span> <span class="s">'73, '</span><span class="p">,</span> <span class="s">'34, '</span><span class="p">,</span> <span class="s">'71, '</span><span class="p">,</span> <span class="s">'-89, '</span><span class="p">,</span> <span class="s">'-26, '</span><span class="p">,</span> <span class="s">'11, '</span><span class="p">,</span> <span class="s">'-21, '</span><span class="p">,</span> <span class="s">'24, '</span><span class="p">,</span> <span class="s">'-108, '</span><span class="p">,</span> <span class="s">'-24, '</span><span class="p">,</span> <span class="s">'24, '</span><span class="p">,</span> <span class="s">'89, '</span><span class="p">,</span> <span class="s">'20, '</span><span class="p">,</span> <span class="s">'91, '</span><span class="p">,</span> <span class="s">'-49, '</span><span class="p">,</span> <span class="s">'104, '</span><span class="p">,</span> <span class="s">'-99, '</span><span class="p">,</span> <span class="s">'-16, '</span><span class="p">,</span> <span class="s">'27, '</span><span class="p">,</span> <span class="s">'73, '</span><span class="p">,</span> <span class="s">'38, '</span><span class="p">,</span> <span class="s">'-123, '</span><span class="p">,</span> <span class="s">'-60, '</span><span class="p">,</span> <span class="s">'14, '</span><span class="p">,</span> <span class="s">'-71, '</span><span class="p">,</span> <span class="s">'-4, '</span><span class="p">,</span> <span class="s">'102, '</span><span class="p">,</span> <span class="s">'-96, '</span><span class="p">,</span> <span class="s">'37, '</span><span class="p">,</span> <span class="s">'46, '</span><span class="p">,</span> <span class="s">'-101, '</span><span class="p">,</span> <span class="s">'-13, '</span><span class="p">,</span> <span class="s">'24, '</span><span class="p">,</span> <span class="s">'-44, '</span><span class="p">,</span> <span class="s">'-56, '</span><span class="p">,</span> <span class="s">'-95'</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">b</span>
<span class="p">[</span><span class="s">'75, '</span><span class="p">,</span> <span class="s">'41, '</span><span class="p">,</span> <span class="s">'-22, '</span><span class="p">,</span> <span class="s">'1, '</span><span class="p">,</span> <span class="s">'-99, '</span><span class="p">,</span> <span class="s">'-118, '</span><span class="p">,</span> <span class="s">'73, '</span><span class="p">,</span> <span class="s">'34, '</span><span class="p">,</span> <span class="s">'71, '</span><span class="p">,</span> <span class="s">'-89, '</span><span class="p">,</span> <span class="s">'-26, '</span><span class="p">,</span> <span class="s">'11, '</span><span class="p">,</span> <span class="s">'-21, '</span><span class="p">,</span> <span class="s">'24, '</span><span class="p">,</span> <span class="s">'-108, '</span><span class="p">,</span> <span class="s">'-24, '</span><span class="p">,</span> <span class="s">'24, '</span><span class="p">,</span> <span class="s">'89, '</span><span class="p">,</span> <span class="s">'20, '</span><span class="p">,</span> <span class="s">'91, '</span><span class="p">,</span> <span class="s">'-49, '</span><span class="p">,</span> <span class="s">'104, '</span><span class="p">,</span> <span class="s">'-99, '</span><span class="p">,</span> <span class="s">'-16, '</span><span class="p">,</span> <span class="s">'27, '</span><span class="p">,</span> <span class="s">'73, '</span><span class="p">,</span> <span class="s">'38, '</span><span class="p">,</span> <span class="s">'-123, '</span><span class="p">,</span> <span class="s">'-60, '</span><span class="p">,</span> <span class="s">'14, '</span><span class="p">,</span> <span class="s">'-71, '</span><span class="p">,</span> <span class="s">'-4, '</span><span class="p">,</span> <span class="s">'102, '</span><span class="p">,</span> <span class="s">'-96, '</span><span class="p">,</span> <span class="s">'37, '</span><span class="p">,</span> <span class="s">'46, '</span><span class="p">,</span> <span class="s">'-101, '</span><span class="p">,</span> <span class="s">'-13, '</span><span class="p">,</span> <span class="s">'24, '</span><span class="p">,</span> <span class="s">'-44, '</span><span class="p">,</span> <span class="s">'-56, '</span><span class="p">,</span> <span class="s">'-95'</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">b</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">','</span><span class="p">)</span>
<span class="p">[</span><span class="s">'-95'</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">', '</span><span class="p">),</span><span class="n">b</span><span class="p">)</span>
<span class="p">[[</span><span class="s">'75'</span><span class="p">,</span> <span class="s">''</span><span class="p">],</span> <span class="p">[</span><span class="s">'41'</span><span class="p">,</span> <span class="s">''</span><span class="p">],</span> <span class="p">[</span><span class="s">'-22'</span><span class="p">,</span> <span class="s">''</span><span class="p">],</span> <span class="p">[</span><span class="s">'1'</span><span class="p">,</span> <span class="s">''</span><span class="p">],</span> <span class="p">[</span><span class="s">'-99'</span><span class="p">,</span> <span class="s">''</span><span class="p">],</span> <span class="p">[</span><span class="s">'-118'</span><span class="p">,</span> <span class="s">''</span><span class="p">],</span> <span class="p">[</span><span class="s">'73'</span><span class="p">,</span> <span class="s">''</span><span class="p">],</span> <span class="p">[</span><span class="s">'34'</span><span class="p">,</span> <span class="s">''</span><span class="p">],</span> <span class="p">[</span><span class="s">'71'</span><span class="p">,</span> <span class="s">''</span><span class="p">],</span> <span class="p">[</span><span class="s">'-89'</span><span class="p">,</span> <span class="s">''</span><span class="p">],</span> <span class="p">[</span><span class="s">'-26'</span><span class="p">,</span> <span class="s">''</span><span class="p">],</span> <span class="p">[</span><span class="s">'11'</span><span class="p">,</span> <span class="s">''</span><span class="p">],</span> <span class="p">[</span><span class="s">'-21'</span><span class="p">,</span> <span class="s">''</span><span class="p">],</span> <span class="p">[</span><span class="s">'24'</span><span class="p">,</span> <span class="s">''</span><span class="p">],</span> <span class="p">[</span><span class="s">'-108'</span><span class="p">,</span> <span class="s">''</span><span class="p">],</span> <span class="p">[</span><span class="s">'-24'</span><span class="p">,</span> <span class="s">''</span><span class="p">],</span> <span class="p">[</span><span class="s">'24'</span><span class="p">,</span> <span class="s">''</span><span class="p">],</span> <span class="p">[</span><span class="s">'89'</span><span class="p">,</span> <span class="s">''</span><span class="p">],</span> <span class="p">[</span><span class="s">'20'</span><span class="p">,</span> <span class="s">''</span><span class="p">],</span> <span class="p">[</span><span class="s">'91'</span><span class="p">,</span> <span class="s">''</span><span class="p">],</span> <span class="p">[</span><span class="s">'-49'</span><span class="p">,</span> <span class="s">''</span><span class="p">],</span> <span class="p">[</span><span class="s">'104'</span><span class="p">,</span> <span class="s">''</span><span class="p">],</span> <span class="p">[</span><span class="s">'-99'</span><span class="p">,</span> <span class="s">''</span><span class="p">],</span> <span class="p">[</span><span class="s">'-16'</span><span class="p">,</span> <span class="s">''</span><span class="p">],</span> <span class="p">[</span><span class="s">'27'</span><span class="p">,</span> <span class="s">''</span><span class="p">],</span> <span class="p">[</span><span class="s">'73'</span><span class="p">,</span> <span class="s">''</span><span class="p">],</span> <span class="p">[</span><span class="s">'38'</span><span class="p">,</span> <span class="s">''</span><span class="p">],</span> <span class="p">[</span><span class="s">'-123'</span><span class="p">,</span> <span class="s">''</span><span class="p">],</span> <span class="p">[</span><span class="s">'-60'</span><span class="p">,</span> <span class="s">''</span><span class="p">],</span> <span class="p">[</span><span class="s">'14'</span><span class="p">,</span> <span class="s">''</span><span class="p">],</span> <span class="p">[</span><span class="s">'-71'</span><span class="p">,</span> <span class="s">''</span><span class="p">],</span> <span class="p">[</span><span class="s">'-4'</span><span class="p">,</span> <span class="s">''</span><span class="p">],</span> <span class="p">[</span><span class="s">'102'</span><span class="p">,</span> <span class="s">''</span><span class="p">],</span> <span class="p">[</span><span class="s">'-96'</span><span class="p">,</span> <span class="s">''</span><span class="p">],</span> <span class="p">[</span><span class="s">'37'</span><span class="p">,</span> <span class="s">''</span><span class="p">],</span> <span class="p">[</span><span class="s">'46'</span><span class="p">,</span> <span class="s">''</span><span class="p">],</span> <span class="p">[</span><span class="s">'-101'</span><span class="p">,</span> <span class="s">''</span><span class="p">],</span> <span class="p">[</span><span class="s">'-13'</span><span class="p">,</span> <span class="s">''</span><span class="p">],</span> <span class="p">[</span><span class="s">'24'</span><span class="p">,</span> <span class="s">''</span><span class="p">],</span> <span class="p">[</span><span class="s">'-44'</span><span class="p">,</span> <span class="s">''</span><span class="p">],</span> <span class="p">[</span><span class="s">'-56'</span><span class="p">,</span> <span class="s">''</span><span class="p">],</span> <span class="p">[</span><span class="s">'-95'</span><span class="p">]]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">', '</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span><span class="n">b</span><span class="p">)</span>
<span class="p">[</span><span class="s">'75'</span><span class="p">,</span> <span class="s">'41'</span><span class="p">,</span> <span class="s">'-22'</span><span class="p">,</span> <span class="s">'1'</span><span class="p">,</span> <span class="s">'-99'</span><span class="p">,</span> <span class="s">'-118'</span><span class="p">,</span> <span class="s">'73'</span><span class="p">,</span> <span class="s">'34'</span><span class="p">,</span> <span class="s">'71'</span><span class="p">,</span> <span class="s">'-89'</span><span class="p">,</span> <span class="s">'-26'</span><span class="p">,</span> <span class="s">'11'</span><span class="p">,</span> <span class="s">'-21'</span><span class="p">,</span> <span class="s">'24'</span><span class="p">,</span> <span class="s">'-108'</span><span class="p">,</span> <span class="s">'-24'</span><span class="p">,</span> <span class="s">'24'</span><span class="p">,</span> <span class="s">'89'</span><span class="p">,</span> <span class="s">'20'</span><span class="p">,</span> <span class="s">'91'</span><span class="p">,</span> <span class="s">'-49'</span><span class="p">,</span> <span class="s">'104'</span><span class="p">,</span> <span class="s">'-99'</span><span class="p">,</span> <span class="s">'-16'</span><span class="p">,</span> <span class="s">'27'</span><span class="p">,</span> <span class="s">'73'</span><span class="p">,</span> <span class="s">'38'</span><span class="p">,</span> <span class="s">'-123'</span><span class="p">,</span> <span class="s">'-60'</span><span class="p">,</span> <span class="s">'14'</span><span class="p">,</span> <span class="s">'-71'</span><span class="p">,</span> <span class="s">'-4'</span><span class="p">,</span> <span class="s">'102'</span><span class="p">,</span> <span class="s">'-96'</span><span class="p">,</span> <span class="s">'37'</span><span class="p">,</span> <span class="s">'46'</span><span class="p">,</span> <span class="s">'-101'</span><span class="p">,</span> <span class="s">'-13'</span><span class="p">,</span> <span class="s">'24'</span><span class="p">,</span> <span class="s">'-44'</span><span class="p">,</span> <span class="s">'-56'</span><span class="p">,</span> <span class="s">'-95'</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">c</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">', '</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span><span class="n">b</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">c</span>
<span class="p">[</span><span class="s">'75'</span><span class="p">,</span> <span class="s">'41'</span><span class="p">,</span> <span class="s">'-22'</span><span class="p">,</span> <span class="s">'1'</span><span class="p">,</span> <span class="s">'-99'</span><span class="p">,</span> <span class="s">'-118'</span><span class="p">,</span> <span class="s">'73'</span><span class="p">,</span> <span class="s">'34'</span><span class="p">,</span> <span class="s">'71'</span><span class="p">,</span> <span class="s">'-89'</span><span class="p">,</span> <span class="s">'-26'</span><span class="p">,</span> <span class="s">'11'</span><span class="p">,</span> <span class="s">'-21'</span><span class="p">,</span> <span class="s">'24'</span><span class="p">,</span> <span class="s">'-108'</span><span class="p">,</span> <span class="s">'-24'</span><span class="p">,</span> <span class="s">'24'</span><span class="p">,</span> <span class="s">'89'</span><span class="p">,</span> <span class="s">'20'</span><span class="p">,</span> <span class="s">'91'</span><span class="p">,</span> <span class="s">'-49'</span><span class="p">,</span> <span class="s">'104'</span><span class="p">,</span> <span class="s">'-99'</span><span class="p">,</span> <span class="s">'-16'</span><span class="p">,</span> <span class="s">'27'</span><span class="p">,</span> <span class="s">'73'</span><span class="p">,</span> <span class="s">'38'</span><span class="p">,</span> <span class="s">'-123'</span><span class="p">,</span> <span class="s">'-60'</span><span class="p">,</span> <span class="s">'14'</span><span class="p">,</span> <span class="s">'-71'</span><span class="p">,</span> <span class="s">'-4'</span><span class="p">,</span> <span class="s">'102'</span><span class="p">,</span> <span class="s">'-96'</span><span class="p">,</span> <span class="s">'37'</span><span class="p">,</span> <span class="s">'46'</span><span class="p">,</span> <span class="s">'-101'</span><span class="p">,</span> <span class="s">'-13'</span><span class="p">,</span> <span class="s">'24'</span><span class="p">,</span> <span class="s">'-44'</span><span class="p">,</span> <span class="s">'-56'</span><span class="p">,</span> <span class="s">'-95'</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="n">c</span><span class="p">)</span>
<span class="p">[</span><span class="mi">75</span><span class="p">,</span> <span class="mi">41</span><span class="p">,</span> <span class="o">-</span><span class="mi">22</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">99</span><span class="p">,</span> <span class="o">-</span><span class="mi">118</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">71</span><span class="p">,</span> <span class="o">-</span><span class="mi">89</span><span class="p">,</span> <span class="o">-</span><span class="mi">26</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="o">-</span><span class="mi">21</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="o">-</span><span class="mi">108</span><span class="p">,</span> <span class="o">-</span><span class="mi">24</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">89</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">91</span><span class="p">,</span> <span class="o">-</span><span class="mi">49</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="o">-</span><span class="mi">99</span><span class="p">,</span> <span class="o">-</span><span class="mi">16</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">38</span><span class="p">,</span> <span class="o">-</span><span class="mi">123</span><span class="p">,</span> <span class="o">-</span><span class="mi">60</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="o">-</span><span class="mi">71</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="o">-</span><span class="mi">96</span><span class="p">,</span> <span class="mi">37</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="o">-</span><span class="mi">101</span><span class="p">,</span> <span class="o">-</span><span class="mi">13</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="o">-</span><span class="mi">44</span><span class="p">,</span> <span class="o">-</span><span class="mi">56</span><span class="p">,</span> <span class="o">-</span><span class="mi">95</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">d</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span><span class="n">c</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
<span class="p">[</span><span class="mi">75</span><span class="p">,</span> <span class="mi">41</span><span class="p">,</span> <span class="mi">234</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">157</span><span class="p">,</span> <span class="mi">138</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">34</span><span class="p">,</span> <span class="mi">71</span><span class="p">,</span> <span class="mi">167</span><span class="p">,</span> <span class="mi">230</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">235</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">148</span><span class="p">,</span> <span class="mi">232</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">89</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">91</span><span class="p">,</span> <span class="mi">207</span><span class="p">,</span> <span class="mi">104</span><span class="p">,</span> <span class="mi">157</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span> <span class="mi">73</span><span class="p">,</span> <span class="mi">38</span><span class="p">,</span> <span class="mi">133</span><span class="p">,</span> <span class="mi">196</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">185</span><span class="p">,</span> <span class="mi">252</span><span class="p">,</span> <span class="mi">102</span><span class="p">,</span> <span class="mi">160</span><span class="p">,</span> <span class="mi">37</span><span class="p">,</span> <span class="mi">46</span><span class="p">,</span> <span class="mi">155</span><span class="p">,</span> <span class="mi">243</span><span class="p">,</span> <span class="mi">24</span><span class="p">,</span> <span class="mi">212</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">161</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">e</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">&amp;</span> <span class="mh">0xff</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">map</span><span class="p">(</span><span class="nb">chr</span><span class="p">,</span><span class="n">e</span><span class="p">)</span>
<span class="p">[</span><span class="s">'K'</span><span class="p">,</span> <span class="s">')'</span><span class="p">,</span> <span class="s">'</span><span class="se">\xea</span><span class="s">'</span><span class="p">,</span> <span class="s">'</span><span class="se">\x01</span><span class="s">'</span><span class="p">,</span> <span class="s">'</span><span class="se">\x9d</span><span class="s">'</span><span class="p">,</span> <span class="s">'</span><span class="se">\x8a</span><span class="s">'</span><span class="p">,</span> <span class="s">'I'</span><span class="p">,</span> <span class="s">'"'</span><span class="p">,</span> <span class="s">'G'</span><span class="p">,</span> <span class="s">'</span><span class="se">\xa7</span><span class="s">'</span><span class="p">,</span> <span class="s">'</span><span class="se">\xe6</span><span class="s">'</span><span class="p">,</span> <span class="s">'</span><span class="se">\x0b</span><span class="s">'</span><span class="p">,</span> <span class="s">'</span><span class="se">\xeb</span><span class="s">'</span><span class="p">,</span> <span class="s">'</span><span class="se">\x18</span><span class="s">'</span><span class="p">,</span> <span class="s">'</span><span class="se">\x94</span><span class="s">'</span><span class="p">,</span> <span class="s">'</span><span class="se">\xe8</span><span class="s">'</span><span class="p">,</span> <span class="s">'</span><span class="se">\x18</span><span class="s">'</span><span class="p">,</span> <span class="s">'Y'</span><span class="p">,</span> <span class="s">'</span><span class="se">\x14</span><span class="s">'</span><span class="p">,</span> <span class="s">'['</span><span class="p">,</span> <span class="s">'</span><span class="se">\xcf</span><span class="s">'</span><span class="p">,</span> <span class="s">'h'</span><span class="p">,</span> <span class="s">'</span><span class="se">\x9d</span><span class="s">'</span><span class="p">,</span> <span class="s">'</span><span class="se">\xf0</span><span class="s">'</span><span class="p">,</span> <span class="s">'</span><span class="se">\x1b</span><span class="s">'</span><span class="p">,</span> <span class="s">'I'</span><span class="p">,</span> <span class="s">'&amp;'</span><span class="p">,</span> <span class="s">'</span><span class="se">\x85</span><span class="s">'</span><span class="p">,</span> <span class="s">'</span><span class="se">\xc4</span><span class="s">'</span><span class="p">,</span> <span class="s">'</span><span class="se">\x0e</span><span class="s">'</span><span class="p">,</span> <span class="s">'</span><span class="se">\xb9</span><span class="s">'</span><span class="p">,</span> <span class="s">'</span><span class="se">\xfc</span><span class="s">'</span><span class="p">,</span> <span class="s">'f'</span><span class="p">,</span> <span class="s">'</span><span class="se">\xa0</span><span class="s">'</span><span class="p">,</span> <span class="s">'</span><span class="si">%</span><span class="s">'</span><span class="p">,</span> <span class="s">'.'</span><span class="p">,</span> <span class="s">'</span><span class="se">\x9b</span><span class="s">'</span><span class="p">,</span> <span class="s">'</span><span class="se">\xf3</span><span class="s">'</span><span class="p">,</span> <span class="s">'</span><span class="se">\x18</span><span class="s">'</span><span class="p">,</span> <span class="s">'</span><span class="se">\xd4</span><span class="s">'</span><span class="p">,</span> <span class="s">'</span><span class="se">\xc8</span><span class="s">'</span><span class="p">,</span> <span class="s">'</span><span class="se">\xa1</span><span class="s">'</span><span class="p">]</span>
<span class="o">&gt;&gt;&gt;</span> <span class="s">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">chr</span><span class="p">,</span><span class="n">e</span><span class="p">))</span>
<span class="s">'K)</span><span class="se">\xea\x01\x9d\x8a</span><span class="s">I"G</span><span class="se">\xa7\xe6\x0b\xeb\x18\x94\xe8\x18</span><span class="s">Y</span><span class="se">\x14</span><span class="s">[</span><span class="se">\xcf</span><span class="s">h</span><span class="se">\x9d\xf0\x1b</span><span class="s">I&amp;</span><span class="se">\x85\xc4\x0e\xb9\xfc</span><span class="s">f</span><span class="se">\xa0</span><span class="si">%</span><span class="s">.</span><span class="se">\x9b\xf3\x18\xd4\xc8\xa1</span><span class="s">'</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">f</span> <span class="o">=</span> <span class="s">''</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">chr</span><span class="p">,</span><span class="n">e</span><span class="p">))</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">rc4</span> <span class="o">=</span> <span class="n">ARC4</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">rc4</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">data</span><span class="p">)[:</span><span class="mi">500</span><span class="p">]</span>
<span class="s">'</span><span class="se">\x88</span><span class="s">P</span><span class="se">\xe3</span><span class="s">"</span><span class="se">\x8d\xfa</span><span class="s">{A</span><span class="se">\x9d\xe2\xf3\xd6</span><span class="s">7</span><span class="se">\x80\x0f</span><span class="s">(</span><span class="se">\xfc\xf8\'\xff\xe7\xf9</span><span class="s">Ul</span><span class="se">\xff\x9b\x9e</span><span class="s">Q{</span><span class="se">\xa1\xde\xad</span><span class="s">6</span><span class="se">\xd1\xb0</span><span class="s">Y9</span><span class="se">\xf9</span><span class="s">r</span><span class="se">\'\x05\xb6\xce</span><span class="s">n</span><span class="se">\xfa\xf7</span><span class="s">Q</span><span class="se">\xc7</span><span class="s">`</span><span class="se">\x02\xd8</span><span class="s">r</span><span class="se">\xf1\x88\x7f\xfb\t</span><span class="si">%</span><span class="s">@;</span><span class="se">\xda\xbd\xf1</span><span class="s">nI</span><span class="se">\x81</span><span class="s">-!</span><span class="se">\xac\xa2\xe3</span><span class="s">!X</span><span class="se">\xb8\r</span><span class="s">=;</span><span class="se">\xd5</span><span class="s">3 </span><span class="se">\xb8\xf4\xbb</span><span class="s">T</span><span class="se">\xfc</span><span class="s">a</span><span class="se">\xf4\x10\xd0\t\xf2\x12</span><span class="s">;</span><span class="se">\xbc\x8b\x0b\x89\x99</span><span class="s">K</span><span class="se">\xc5</span><span class="s">s</span><span class="se">\xf7\x8f</span><span class="s">N</span><span class="se">\x0c</span><span class="s">3vc</span><span class="se">\xa6\x92</span><span class="s">i</span><span class="se">\xbc\n\x88\xdf</span><span class="si">%</span><span class="s">D</span><span class="se">\x0e\xbc\x91</span><span class="s">Q0RA</span><span class="se">\xf5</span><span class="s">9</span><span class="se">\xc1\xb8</span><span class="s">]</span><span class="se">\xdf</span><span class="s">&lt;hut</span><span class="se">\xeb\xe3\\</span><span class="s">G</span><span class="se">\xa5</span><span class="s">/| </span><span class="se">\xdd\x98</span><span class="s">7zMl</span><span class="se">\x03\xf1</span><span class="s">?</span><span class="se">\xb1\x82</span><span class="s">}m</span><span class="se">\x02\x14</span><span class="s">|</span><span class="se">\\\x01\xc8\xc8\xec</span><span class="s">&lt;.</span><span class="se">\xf0</span><span class="s">;</span><span class="se">\xd4</span><span class="s">#</span><span class="se">\xac\xe8</span><span class="s">j</span><span class="se">\x01</span><span class="s">]</span><span class="se">\xf6</span><span class="s">W</span><span class="se">\xa6\x86\xf7\xa5\x13\xa9\x8e\x84\x87\xbf\xfa</span><span class="s">t</span><span class="se">\xb8\x02\xdb\xfb\x91\xed\xf2</span><span class="s">n</span><span class="se">\xf8\xb8\xa9</span><span class="s">n</span><span class="se">\xad\xa1</span><span class="s">5E4</span><span class="se">\x0e</span><span class="s">$</span><span class="se">\xab</span><span class="s">u</span><span class="se">\xda</span><span class="s">*</span><span class="se">\xe7\xf8</span><span class="s">?</span><span class="se">\x8d\xdb\xb4\x16</span><span class="s">&lt;n2</span><span class="se">\x13</span><span class="s">c</span><span class="se">\xb6</span><span class="s">W</span><span class="se">\x90\xa5\x12\xeb\x92\x8e\x1e\t</span><span class="s">`Y</span><span class="se">\xcf</span><span class="s">r</span><span class="se">\xb0</span><span class="s">yt</span><span class="se">\x94\xe6</span><span class="s">S</span><span class="se">\xc6</span><span class="s">u_</span><span class="se">\n</span><span class="s">C</span><span class="se">\xe2\x91</span><span class="s">:r</span><span class="se">\x85\x84</span><span class="s">i#</span><span class="se">\xd2\xe7\x89\xf1\x96\'</span><span class="si">%</span><span class="se">\x08</span><span class="s">l</span><span class="se">\n\x8d\xcc\xc9\xc6\x81\xe5\xd2</span><span class="s">E</span><span class="se">\x81\xfa\xa7</span><span class="s">c</span><span class="se">\xb7</span><span class="s">4v</span><span class="se">\xc7\xfc</span><span class="s">,</span><span class="se">\x99\xcd\xae</span><span class="s">?</span><span class="se">\xde\x08</span><span class="s">[</span><span class="se">\x9b\xe0\x9e\x86</span><span class="s">.</span><span class="se">\x8f\xfa\x84\xbb\x82</span><span class="s">"</span><span class="se">\xe7</span><span class="s">u</span><span class="se">\xd8\xa9\xfe\x96\xa5</span><span class="s">@</span><span class="se">\xdf\x9b\xfe\x84</span><span class="s">3</span><span class="se">\xb4</span><span class="s">/[</span><span class="se">\xcd</span><span class="s">"&lt;</span><span class="se">\x9e\x1e\xd2\xcc\xb2\x99</span><span class="s">Y</span><span class="se">\x18</span><span class="s">d</span><span class="se">\x98\xcc\x10\xc0</span><span class="s">P!</span><span class="se">\xc7</span><span class="s">(</span><span class="se">\x17</span><span class="s">9&amp;b*</span><span class="se">\x8d\xfe</span><span class="s">TU</span><span class="se">\xd3\x18</span><span class="s">"9Y--</span><span class="se">\xa9</span><span class="s">e|</span><span class="se">\x92\xeb</span><span class="s">*</span><span class="se">\xa0</span><span class="s">F</span><span class="se">\xc5</span><span class="s">}x$</span><span class="se">\x82</span><span class="s">jdm!*</span><span class="se">\xce</span><span class="s">H</span><span class="se">\xb1\xed</span><span class="s">b</span><span class="se">\xd0</span><span class="s">Q1w</span><span class="se">\xe3</span><span class="s">O</span><span class="se">\xf5</span><span class="s">.</span><span class="se">\xf7\xeb\x84\xa1</span><span class="s">*W</span><span class="se">\xc0\xd1\xf6\xc7</span><span class="s">1U</span><span class="se">\xfd</span><span class="s">w</span><span class="se">\xa1</span><span class="s">.</span><span class="se">\x0b\xd6</span><span class="s">S</span><span class="se">\xc3</span><span class="s">eZ</span><span class="se">\xe5</span><span class="s">xSl</span><span class="se">\xb7\xaf</span><span class="s">_</span><span class="se">\xcf</span><span class="s">N</span><span class="se">\xb4\x08\x07</span><span class="s">?</span><span class="se">\xe8\xac\xb0</span><span class="s">c</span><span class="se">\xdc\xe9</span><span class="s">+</span><span class="se">\xe0\xc1\x03\xcc\xc5\xff\xe7\xc8\'</span><span class="s">Y</span><span class="se">\xa6\x8f\xb9\xc0\x81\n</span><span class="s">l5</span><span class="se">\xc3\xb2</span><span class="s">$</span><span class="se">\xbe</span><span class="s">I*&lt;</span><span class="se">\xe8\xf8\xd1\xff\xad</span><span class="s">7&gt;Tb</span><span class="se">\\\x1c\x0c\xed\xa2\xf0</span><span class="s">J</span><span class="se">\x12\xd7\x07</span><span class="s">+ </span><span class="se">\xb2\xba\xac\x1b</span><span class="s">L,</span><span class="se">\xef\x8f</span><span class="s">@Ia</span><span class="se">\t\xe8\xc3\xbb\xa9\x1a</span><span class="s">z</span><span class="se">\xe8\xee\xb4\xa7\xfe\t\xce</span><span class="s">"('</span>
</code></pre></div></div>

<p>Well that didn’t work, so let’s take a look at the binary data a little closer.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">data</span><span class="p">[:</span><span class="mi">100</span><span class="p">]</span>
<span class="s">'</span><span class="se">\x9a\xb8\x01\x00</span><span class="s">B</span><span class="se">\xa3\xe1</span><span class="s">&amp;</span><span class="se">\xdb</span><span class="s">Y</span><span class="se">\x9a</span><span class="s">gN</span><span class="se">\xbb\xc4</span><span class="s">4vv</span><span class="se">\x8c</span><span class="s">h?</span><span class="se">\x12\x89</span><span class="s">/</span><span class="se">\xd9\xeb</span><span class="s">(N"p</span><span class="se">\xbd\x1f</span><span class="s">Y</span><span class="se">\xd1\x00\xde\x0e</span><span class="s">s</span><span class="se">\xc3\xe2</span><span class="s">D</span><span class="se">\xa4\xd5\xa0</span><span class="s">9</span><span class="se">\x8e\x86\xc7\xa3</span><span class="s">m</span><span class="se">\x92\xd6\x04\x04</span><span class="s">r</span><span class="se">\xb6</span><span class="s">5w</span><span class="se">\xb3\xf8\x81</span><span class="s">W</span><span class="se">\xb0\xd3\xe7\xab\x1c\xbe\xaa</span><span class="s">"</span><span class="se">\xb5\x8f</span><span class="s">O8</span><span class="se">\xdb</span><span class="s">v</span><span class="se">\x8e</span><span class="s">i</span><span class="se">\x1a\x7f</span><span class="s">,7</span><span class="se">\x10</span><span class="s">-}-</span><span class="se">\xb9</span><span class="s">w</span><span class="se">\xc0</span><span class="s">M</span><span class="se">\x02\xf7</span><span class="s">CJ</span><span class="se">\x15\xa3</span><span class="s">X*</span><span class="se">\x7f\xf6</span><span class="s">'</span>
</code></pre></div></div>

<p>The first four bytes could be an integer, maybe a length value?</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="kn">import</span> <span class="nn">struct</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">struct</span><span class="o">.</span><span class="n">unpack_from</span><span class="p">(</span><span class="s">'&lt;I'</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
<span class="p">(</span><span class="mi">112794</span><span class="p">,)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
<span class="mi">225596</span>
</code></pre></div></div>

<p>It’s definately possible, so let’s try decrypting past that.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">rc4</span> <span class="o">=</span> <span class="n">ARC4</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">rc4</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="mi">4</span><span class="p">:])[:</span><span class="mi">500</span><span class="p">]</span>
<span class="s">'PK</span><span class="se">\x03\x04\x14\x00\x00\x00\x08\x00\xad\x85\x0f</span><span class="s">MGt</span><span class="se">\xb5\x9c</span><span class="s">"</span><span class="se">\xb8\x01\x00\xf4\r\x04\x00\x0b\x00\x00\x00</span><span class="s">classes.dex</span><span class="se">\x9c\x9d\t</span><span class="s">`</span><span class="se">\x14</span><span class="s">E</span><span class="se">\xd6\xc7</span><span class="s">k8</span><span class="se">\x12\xc0\xfb\xbe\xb5\xbd\x05</span><span class="s">C</span><span class="se">\x10\xbc</span><span class="s">A]</span><span class="se">\x03\x04\x08\x84\x10</span><span class="s">I</span><span class="se">\xb8\x8d\xd8\x99\xe9\xcc</span><span class="s">4</span><span class="se">\x99\x8b</span><span class="s">9r</span><span class="se">\xe9\xee\x12\x0e</span><span class="s">A</span><span class="se">\x01</span><span class="s">O</span><span class="se">\x90</span><span class="s">S</span><span class="se">\x0e\xe5</span><span class="s">F </span><span class="se">\xdc\xe1</span><span class="s">^7</span><span class="se">\xb8\xde\x18</span><span class="s">D</span><span class="se">\x04</span><span class="s">V]</span><span class="se">\'\xa2</span><span class="s">x</span><span class="se">\x1f\xab\xeb</span><span class="s">z</span><span class="se">\xa0\xeb\xf7\x7f</span><span class="s">U</span><span class="se">\xaf</span><span class="s">gz</span><span class="se">\xc2\x04\xe2\'\xfe\xf2\xaa\xeb\xea\xea\xea\xaa</span><span class="s">z</span><span class="se">\xaf\xaa</span><span class="s">{</span><span class="se">\xba\\</span><span class="s">FE</span><span class="se">\xbb\x1b</span><span class="s">n</span><span class="se">\xbc</span><span class="s">Yl|</span><span class="se">\xdd\x7f\xd1\x94\xd1\xff\xaa</span><span class="s">-</span><span class="se">\xdf</span><span class="s">z</span><span class="se">\xe3\xd2</span><span class="s">N</span><span class="se">\x97\xf4\xd8</span><span class="s">vQ</span><span class="se">\x9b\x17\xa7\x1f\xcd\xee\xf5\xb7\xff\x9c\xd2</span><span class="s">J</span><span class="se">\x04\x85\x10\x15\x83</span><span class="s">o:S</span><span class="se">\xf0\x7f</span><span class="s">7</span><span class="se">\xc0\xaf\xa2\xad\x90\xfe\x1e\x87\x10\xf9\xd7\x08\xb1\x1e\xf2\xdb\xeb\x85\xf8\xb9\x85\x10\x85</span><span class="s">w</span><span class="se">\x0b\xf1</span><span class="s">`k!.</span><span class="se">\x1e</span><span class="s">*</span><span class="se">\xc4</span><span class="s">x</span><span class="se">\xc4\xf9</span><span class="s">u</span><span class="se">\x1c\xd2</span><span class="s">W</span><span class="se">\xb6\x14\x0f</span><span class="s">N</span><span class="se">\x13\x92\xbf\x80</span><span class="s">j0</span><span class="se">\x01</span><span class="s">L</span><span class="se">\x02</span><span class="s">S</span><span class="se">\xc1</span><span class="s">40</span><span class="se">\x13\xcc\x05\x0b\xc1\x12\xb0\n\xac\x07\xb5</span><span class="s">`</span><span class="se">\x07</span><span class="s">x</span><span class="se">\x05\x1c\x02</span><span class="s">_</span><span class="se">\x81\x1f\xc1\xaf\xe0\xc2\xe9</span><span class="s">B</span><span class="se">\\\x06</span><span class="s">n</span><span class="se">\x06\xdd</span><span class="s">@</span><span class="se">\x16\xe8\t\x06\x82</span><span class="s">A`</span><span class="se">\x04\x18\x05</span><span class="s">"`</span><span class="se">\x1c</span><span class="s">x</span><span class="se">\x02</span><span class="s">L</span><span class="se">\x03</span><span class="s">3</span><span class="se">\xc0\x1c\xf0</span><span class="s">,X</span><span class="se">\n</span><span class="s">V</span><span class="se">\x81\x8d</span><span class="s">`</span><span class="se">\x17</span><span class="s">x</span><span class="se">\x15\xbc\x01\xde\x06\xdf\x83\x1f\xc1</span><span class="s">/</span><span class="se">\xe0\x7f\xa0\xf5\xd3</span><span class="s">B</span><span class="se">\x9c\t</span><span class="s">.</span><span class="se">\x01\xd7\x82\xdb</span><span class="s">A</span><span class="se">\x0e\x18\x00\x06\x83</span><span class="s">a</span><span class="se">\xe0</span><span class="s">^p?p</span><span class="se">\x02</span><span class="s">7(</span><span class="se">\x05\x0f\x82\xa9\xe0\x19\xb0\x00\xac\x06\x1b\xc0</span><span class="s">V</span><span class="se">\xf0</span><span class="s">7</span><span class="se">\xf0\n</span><span class="s">x</span><span class="se">\x13\xbc\x05\x0e\x80\xc3\xe0</span><span class="s">;</span><span class="se">\xf0</span><span class="s">?</span><span class="se">\xd0</span><span class="s">n</span><span class="se">\x06\xce\x07\xae\x06\xd7\x83\x1b</span><span class="s">A</span><span class="se">\x0e\x18\t</span><span class="s">*</span><span class="se">\xc0</span><span class="s">4</span><span class="se">\xf0</span><span class="s">&lt;x</span><span class="se">\x05\xc4\xc0\x0f\xe0\xe4\x99</span><span class="s">B</span><span class="se">\\\x01\xfe\x04\x86\x00</span><span class="s">?x</span><span class="se">\x18</span><span class="s">,</span><span class="se">\x00\x1b\xc0</span><span class="s">K</span><span class="se">\xe0</span><span class="s">}</span><span class="se">\xf0\x11\xf8\x01\xa4\xcf\x12\xe2\\</span><span class="s">p-</span><span class="se">\xb8\x01</span><span class="s">t</span><span class="se">\x05</span><span class="s">w</span><span class="se">\x82\xee\xa0</span><span class="s">7</span><span class="se">\xe8\x0b\xf2\x80\x1f\x94\x83\x07\xc0</span><span class="s">_</span><span class="se">\xc1</span><span class="s">x</span><span class="se">\xf0</span><span class="s">0</span><span class="se">\x98\n\x9e\x04</span><span class="s">s</span><span class="se">\xc1</span><span class="s">B</span><span class="se">\xb0\x18\xac\x00\x1b\xc0\x16\xb0\x03\xfc\x1d\xbc\x0e\xf6\x82\xfd\xe0\x10\xf8\x17</span><span class="s">h</span><span class="se">\x00\x1f\x83\xcf\xc0</span><span class="s">w</span><span class="se">\xe0\x07\xf0</span><span class="s">3</span><span class="se">\xf8\r</span><span class="s">8f</span><span class="se">\xa3\xce</span><span class="s">A</span><span class="se">\x1b</span><span class="s">p28</span><span class="se">\x1d</span><span class="s">'</span>
</code></pre></div></div>

<p>There we go, a zip file header and the name of the zipped file is classes.dex!</p>

<p>A quick look at the decoded dex file shows lots of interesting data including our twitter string from earlier.</p>

<p><img src="/assets/anubis_unpack/unpacked/1_config_data.png" alt="Anubis config data" title="Anubis config data" /></p>

<p>Looking around at some of the other code shows a few interesting routines.</p>

<p>RC4:</p>

<p><img src="/assets/anubis_unpack/unpacked/2_rc4.png" alt="Anubis RC4" title="Anubis RC4" /></p>

<p>Hexlify:</p>

<p><img src="/assets/anubis_unpack/unpacked/3_hexlify.png" alt="Anubis Hexlify" title="Anubis Hexlify" /></p>

<p>So going off prior research into Anubis we know that the twitter data is then base64 decode to a hexlified string, so let’s find where that twitter string gets used.</p>

<p><img src="/assets/anubis_unpack/unpacked/4_twitter_string_used.png" alt="Anubis twitter string" title="Anubis twitter string" /></p>

<p>Here we can see the twitter string being used along with it referencing the <zero> tags for pulling out the data, following one of the later function calls if we're assuming it's first going to base64 decode and unhexlify leads us to the following function.</zero></p>

<p><img src="/assets/anubis_unpack/unpacked/5_rc4_key.png" alt="Anubis Decode data" title="Anubis Decode data" /></p>

<p>So could this be the RC4 key then? Let’s test with the hexlified string from the phishlabs report.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&gt;&gt;&gt;</span> <span class="n">m</span> <span class="o">=</span> <span class="s">"3090c08a8f3c3950d98c612399622d02057bce22a5b8b01e4dc3960fa03648c822f3"</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="n">binascii</span><span class="o">.</span><span class="n">unhexlify</span><span class="p">(</span><span class="n">m</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">a</span>
<span class="s">'0</span><span class="se">\x90\xc0\x8a\x8f</span><span class="s">&lt;9P</span><span class="se">\xd9\x8c</span><span class="s">a#</span><span class="se">\x99</span><span class="s">b-</span><span class="se">\x02\x05</span><span class="s">{</span><span class="se">\xce</span><span class="s">"</span><span class="se">\xa5\xb8\xb0\x1e</span><span class="s">M</span><span class="se">\xc3\x96\x0f\xa0</span><span class="s">6H</span><span class="se">\xc8</span><span class="s">"</span><span class="se">\xf3</span><span class="s">'</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">l</span> <span class="o">=</span> <span class="n">ARC4</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="s">'flash1'</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">w</span> <span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">decrypt</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
<span class="o">&gt;&gt;&gt;</span> <span class="n">w</span>
<span class="s">'hxxps://lukasstefankotiywlepok.com'</span>
</code></pre></div></div>

<p>It works! That’s it, hope it helps! For further reading I’ve included a number of references to android unpacking articles.</p>

<p>References:</p>
<ol>
  <li>https://info.phishlabs.com/blog/bankbot-anubis-threat-upgrade</li>
  <li>https://www.virustotal.com/#/intelligence-overview</li>
  <li>https://www.fortinet.com/blog/threat-research/unmasking-android-malware-a-deep-dive-into-a-new-rootnik-variant-part-i.html</li>
  <li>https://link.springer.com/article/10.1186/s13638-016-0720-3</li>
  <li>https://arxiv.org/pdf/1801.01633.pdf</li>
  <li>https://d3gpjj9d20n0p3.cloudfront.net/fortiguard/research/AndroidPackers_Hacktivity.pdf</li>
</ol>


  </div><a class="u-url" href="/malware,/reverse-engineering/2018/08/30/Unpacking-Anubis-APK.html" hidden></a>
</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">

    <h2 class="footer-heading">Random RE</h2>

    <div class="footer-col-wrapper">
      <div class="footer-col footer-col-1">
        <ul class="contact-list">
          <li class="p-name">Random RE</li><li><a class="u-email" href="mailto:sysopfb@gmail.com">sysopfb@gmail.com</a></li></ul>
      </div>

      <div class="footer-col footer-col-2"><ul class="social-media-list"><li><a href="https://github.com/sysopfb"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">sysopfb</span></a></li><li><a href="https://www.twitter.com/sysopfb"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#twitter"></use></svg> <span class="username">sysopfb</span></a></li></ul>
</div>

      <div class="footer-col footer-col-3">
        <p>Place for me to dump random RE posts mostly revolving around Malware.</p>
      </div>
    </div>

  </div>

</footer>
</body>

</html>
