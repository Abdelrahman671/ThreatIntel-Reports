<!doctype html>
<html lang="en">

<head>
    <title>Old dog, new tricks - Analysing new RTF-based campaign distributing Agent Tesla, Loki with PyREbox</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://blog.talosintelligence.com/assets/css/bootstrap.min.css?v=d7eb88ed59">

    <link rel="stylesheet" href="https://blog.talosintelligence.com/assets/css/navigation.css?v=d7eb88ed59">
    <link rel="stylesheet" href="https://blog.talosintelligence.com/assets/css/footer.css?v=d7eb88ed59">

    <link rel="stylesheet" href="https://blog.talosintelligence.com/assets/css/pagination.css?v=d7eb88ed59">

    <link rel="stylesheet" href="https://blog.talosintelligence.com/assets/css/banners.css?v=d7eb88ed59">

    <link rel="stylesheet" href="https://blog.talosintelligence.com/assets/css/style.css?v=d7eb88ed59">

    <link rel="stylesheet" href="https://blog.talosintelligence.com/assets/css/prism.css?v=d7eb88ed59">
    <link rel="stylesheet" href="https://blog.talosintelligence.com/assets/css/prism-vsc-dark-plus.css?v=d7eb88ed59">
    <link rel="stylesheet" href="https://blog.talosintelligence.com/assets/css/prism-talos.css?v=d7eb88ed59">

    <link rel="stylesheet" href="https://blog.talosintelligence.com/assets/css/landing-page.css?v=d7eb88ed59">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;1,100;1,300;1,400&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Fira+Mono:wght@400;500&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;1,100;1,300;1,400&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/ghost-theme-utils@latest/dist/css/style.min.css" rel="stylesheet">


    <link rel="icon" href="https://blog.talosintelligence.com/content/images/size/w256h256/2022/07/talos_o_square.png" type="image/png">
    <link rel="canonical" href="https://blog.talosintelligence.com/old-dog-new-tricks-analysing-new-rtf_15/">
    <meta name="referrer" content="no-referrer-when-downgrade">
    
    <meta property="og:site_name" content="Cisco Talos Blog">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Old dog, new tricks - Analysing new RTF-based campaign distributing Agent Tesla, Loki with PyREbox">
    <meta property="og:description" content="This blog post was authored by Edmund Brumaghin and Holger Unterbrink with contributions from Emmanuel Tacheau.


Executive Summary

Cisco Talos has discovered a new malware campaign that drops the sophisticated information-stealing trojan called &quot;Agent Tesla,&quot; and other malware such as the Loki information stealer. Initially, Talos&#x27; telemetry systems detected a">
    <meta property="og:url" content="https://blog.talosintelligence.com/old-dog-new-tricks-analysing-new-rtf_15/">
    <meta property="og:image" content="https://blog.talosintelligence.com/content/images/-ILV99MjYnYg/W8BAtVH4IMI/AAAAAAAABGk/bB1Yb8eFqgstw9tlTMs6jO-9mc3LilCNgCEwYBhgL/w1200-h630-p-k-no-nu/image4.jpg">
    <meta property="article:published_time" content="2018-10-15T16:00:00.000Z">
    <meta property="article:modified_time" content="2022-12-13T18:03:44.000Z">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Old dog, new tricks - Analysing new RTF-based campaign distributing Agent Tesla, Loki with PyREbox">
    <meta name="twitter:description" content="This blog post was authored by Edmund Brumaghin and Holger Unterbrink with contributions from Emmanuel Tacheau.


Executive Summary

Cisco Talos has discovered a new malware campaign that drops the sophisticated information-stealing trojan called &quot;Agent Tesla,&quot; and other malware such as the Loki information stealer. Initially, Talos&#x27; telemetry systems detected a">
    <meta name="twitter:url" content="https://blog.talosintelligence.com/old-dog-new-tricks-analysing-new-rtf_15/">
    <meta name="twitter:image" content="https://blog.talosintelligence.com/content/images/size/w1200/2022/12/image4-1.jpg">
    <meta name="twitter:label1" content="Written by">
    <meta name="twitter:data1" content="Holger Unterbrink">
    <meta name="twitter:site" content="@TalosSecurity">
    <meta property="og:image:width" content="803">
    <meta property="og:image:height" content="422">
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "Cisco Talos Blog",
        "url": "https://blog.talosintelligence.com/",
        "logo": {
            "@type": "ImageObject",
            "url": "https://blog.talosintelligence.com/content/images/2022/11/TalosBrand_ukraine.svg"
        }
    },
    "author": {
        "@type": "Person",
        "name": "Holger Unterbrink",
        "url": "https://blog.talosintelligence.com/author/holger-unterbrink/",
        "sameAs": []
    },
    "headline": "Old dog, new tricks - Analysing new RTF-based campaign distributing Agent Tesla, Loki with PyREbox",
    "url": "https://blog.talosintelligence.com/old-dog-new-tricks-analysing-new-rtf_15/",
    "datePublished": "2018-10-15T16:00:00.000Z",
    "dateModified": "2022-12-13T18:03:44.000Z",
    "image": {
        "@type": "ImageObject",
        "url": "https://blog.talosintelligence.com/content/images/size/w1200/2022/12/image4-1.jpg",
        "width": 1200,
        "height": 298
    },
    "description": "This blog post was authored by Edmund Brumaghin and Holger Unterbrink with contributions from Emmanuel Tacheau.\n\n\nExecutive Summary\n\nCisco Talos has discovered a new malware campaign that drops the sophisticated information-stealing trojan called &quot;Agent Tesla,&quot; and other malware such as the Loki information stealer. Initially, Talos&#x27; telemetry systems detected a highly suspicious document that wasn&#x27;t picked up by common antivirus solutions. However, Threat Grid, Cisco&#x27;s unified malware analysis ",
    "mainEntityOfPage": "https://blog.talosintelligence.com/old-dog-new-tricks-analysing-new-rtf_15/"
}
    </script>

    <meta name="generator" content="Ghost 5.97">
    <link rel="alternate" type="application/rss+xml" title="Cisco Talos Blog" href="https://blog.talosintelligence.com/rss/">
    
    <script defer src="https://cdn.jsdelivr.net/ghost/sodo-search@~1.3/umd/sodo-search.min.js" data-key="4ffb0139d74ada998f4b141e4d" data-styles="https://cdn.jsdelivr.net/ghost/sodo-search@~1.3/umd/main.css" data-sodo-search="https://cisco-talos-blog.ghost.io/" data-locale="en" crossorigin="anonymous"></script>
    
    <link href="https://blog.talosintelligence.com/webmentions/receive/" rel="webmention">
    <script defer src="/public/cards.min.js?v=d7eb88ed59"></script><style>:root {--ghost-accent-color: #006db6;}</style>
    <link rel="stylesheet" type="text/css" href="/public/cards.min.css?v=d7eb88ed59">
    <style type='text/css'>
    img[src*="icon_check_white.svg"] { width: 20px; margin-left: 0px; margin-right: auto; }
    
    #ghost-portal-root { display: none; }
</style>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-F45RVJG3BK"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-F45RVJG3BK');
</script>
</head>

<body class="post-template">

    <div id="mobile-page-header" class="desktop-hide">
    <h1>Cisco Talos Blog</h1>
</div>

<nav id="nav">
    <input id="nav-trigger" class="nav-trigger" type="checkbox"/>
    <label for="nav-trigger">
        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="22px" height="16px" viewBox="0 0 22 16">
            <g id="menu-icon">
                <path fill="#FFFFFF" d="M20.5,3h-19C0.672,3,0,2.329,0,1.5S0.672,0,1.5,0h19C21.328,0,22,0.671,22,1.5S21.328,3,20.5,3z"></path>
                <path fill="#FFFFFF" d="M20.5,9.5h-19C0.672,9.5,0,8.828,0,8c0-0.829,0.672-1.5,1.5-1.5h19C21.328,6.5,22,7.171,22,8   C22,8.828,21.328,9.5,20.5,9.5z"></path>
                <path fill="#FFFFFF" d="M20.5,16h-19C0.672,16,0,15.328,0,14.5S0.672,13,1.5,13h19c0.828,0,1.5,0.672,1.5,1.5S21.328,16,20.5,16z"></path>
            </g>
        </svg>
    </label>
    <div id="top-nav-bar">
    </div>

    <div id="navigation">
        <div class="navigation-logos-wrapper">
            <div id="talos-logo-wrapper">
                <a class="navbar-brand" href="https://talosintelligence.com">
                </a>
            </div>
        </div>
        <div class="navigation-links-wrapper">
            <ul class="main-nav-list">
                <li class="nav-item">
                    <div class="primary-link-wrapper">
                        <a class="primary_nav_link" href="https://talosintelligence.com/reputation">
                            <div class="mobile-nav-icon"><!-- Generator: Adobe Illustrator 24.2.1, SVG Export Plug-In . SVG Version: 6.00 Build 0)  --><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Layer_1" x="0px" y="0px" viewBox="0 0 20 20" height="20px" width="20px" style="enable-background:new 0 0 20 20;" xml:space="preserve">
                            <style type="text/css">
                                .white{fill:#FFFFFF;}
                            </style>
                            <g>
                                <path class="white" d="M19.5,9.5h-1.1c-0.3-4.2-3.6-7.6-7.8-7.8V0.5C10.5,0.2,10.3,0,10,0l0,0C9.7,0,9.5,0.2,9.5,0.5l0,0v1.1   C5.3,1.9,1.9,5.3,1.6,9.5H0.5C0.2,9.5,0,9.7,0,10s0.2,0.5,0.5,0.5l0,0h1.1c0.3,4.2,3.6,7.6,7.8,7.8v1.1c0,0.3,0.2,0.5,0.5,0.5l0,0   c0.3,0,0.5-0.2,0.5-0.5l0,0v-1.1c4.2-0.3,7.6-3.6,7.8-7.8h1.1c0.3,0,0.5-0.2,0.5-0.5C20,9.7,19.8,9.5,19.5,9.5 M16.6,10.5h0.7   c-0.3,3.6-3.2,6.5-6.8,6.8v-0.8c0-0.3-0.2-0.5-0.5-0.5l0,0c-0.3,0-0.5,0.2-0.5,0.5v0.8C5.8,17,3,14.2,2.7,10.5h0.8   C3.8,10.5,4,10.3,4,10S3.8,9.5,3.5,9.5l0,0H2.7C3,5.8,5.8,3,9.5,2.7v0.8C9.5,3.7,9.7,4,10,4l0,0c0.3,0,0.5-0.2,0.5-0.5V2.7   C14.2,3,17,5.8,17.3,9.5h-0.7c-0.3,0-0.5,0.2-0.5,0.5C16.1,10.3,16.3,10.5,16.6,10.5L16.6,10.5"></path>
                                                            <circle class="white" cx="10" cy="10" r="3.2"></circle>
                            </g>
                            </svg>
                            </div>
                            <span class="top-nav-link-text">
                                Intelligence Center
                            </span>
                        </a>
                    </div>
                    <input class="sub-nav-trigger" id="intelligence-sub-trigger" type="checkbox">
                    <label class="sub-nav-trigger-label" for="intelligence-sub-trigger">
                        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="48.167px" height="47.75px" viewBox="0 0 48.167 47.75">
                            <circle opacity="0.4" fill="none" stroke="#FFFFFF" stroke-miterlimit="10" cx="24.083" cy="23.875" r="22"></circle>
                            <g>
                                <circle fill="#FFFFFF" cx="24.083" cy="16.068" r="2.496"></circle>
                                <circle fill="#FFFFFF" cx="24.083" cy="23.875" r="2.496"></circle>
                                <circle fill="#FFFFFF" cx="24.083" cy="31.682" r="2.496"></circle>
                            </g>
                        </svg>

                    </label>
                    <ul class="sub-nav sub-nav-single-list">
                        <li class="desktop-hide">
                            <a class="mobile_nav_link" href="https://talosintelligence.com/reputation"><h1>Intelligence Center</h1>
                            </a></li>
                        <li class="desktop-hide">
                            <label class="subnav-back-button" for="intelligence-sub-trigger">BACK</label>
                        </li>
                        <li><a class="secondary_nav_link" href="https://talosintelligence.com/reputation_center">Intelligence Search</a></li>
                        <li><a class="secondary_nav_link" href="https://talosintelligence.com/reputation_center/email_rep">Email &amp; Spam Trends</a></li>
                    </ul>
                    <div class="desktop-hide subnav-overlay"><!-- Generator: Adobe Illustrator 24.2.1, SVG Export Plug-In . SVG Version: 6.00 Build 0)  --><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Layer_1" x="0px" y="0px" viewBox="0 0 20 20" height="20px" width="20px" style="enable-background:new 0 0 20 20;" xml:space="preserve">
                        <style type="text/css">
                            .white{fill:#FFFFFF;}
                        </style>
                                                <g>
                            <path class="white" d="M19.5,9.5h-1.1c-0.3-4.2-3.6-7.6-7.8-7.8V0.5C10.5,0.2,10.3,0,10,0l0,0C9.7,0,9.5,0.2,9.5,0.5l0,0v1.1   C5.3,1.9,1.9,5.3,1.6,9.5H0.5C0.2,9.5,0,9.7,0,10s0.2,0.5,0.5,0.5l0,0h1.1c0.3,4.2,3.6,7.6,7.8,7.8v1.1c0,0.3,0.2,0.5,0.5,0.5l0,0   c0.3,0,0.5-0.2,0.5-0.5l0,0v-1.1c4.2-0.3,7.6-3.6,7.8-7.8h1.1c0.3,0,0.5-0.2,0.5-0.5C20,9.7,19.8,9.5,19.5,9.5 M16.6,10.5h0.7   c-0.3,3.6-3.2,6.5-6.8,6.8v-0.8c0-0.3-0.2-0.5-0.5-0.5l0,0c-0.3,0-0.5,0.2-0.5,0.5v0.8C5.8,17,3,14.2,2.7,10.5h0.8   C3.8,10.5,4,10.3,4,10S3.8,9.5,3.5,9.5l0,0H2.7C3,5.8,5.8,3,9.5,2.7v0.8C9.5,3.7,9.7,4,10,4l0,0c0.3,0,0.5-0.2,0.5-0.5V2.7   C14.2,3,17,5.8,17.3,9.5h-0.7c-0.3,0-0.5,0.2-0.5,0.5C16.1,10.3,16.3,10.5,16.6,10.5L16.6,10.5"></path>
                                                    <circle class="white" cx="10" cy="10" r="3.2"></circle>
                        </g>
                        </svg>
                    </div>
                </li>
                <li class="nav-item">
                    <div class="primary-link-wrapper">
                        <a class="primary_nav_link" href="https://talosintelligence.com/vulnerability_info"><div class="mobile-nav-icon"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="26px" height="20px" viewBox="0 0 26 20">
                            <g id="vuln-icon" class="nav-icon">
                                <path fill="#FFFFFF" d="M24.256,18.49L13.872,0.503C13.692,0.192,13.36,0,13,0c-0.359,0-0.692,0.192-0.872,0.503L1.744,18.49  c-0.18,0.312-0.18,0.695,0,1.006C1.924,19.809,2.257,20,2.616,20h20.769c0.359,0,0.691-0.191,0.871-0.504  C24.436,19.186,24.436,18.803,24.256,18.49 M14.268,18.215h-2.533v-1.85h2.533V18.215z M14.268,15.441h-2.533L10.89,6.515h4.222  L14.268,15.441z"></path>
                            </g>
                        </svg>
                        </div>
                            <span class="top-nav-link-text">
                            Vulnerability Research
                            </span>
                        </a></div>
                    <input class="sub-nav-trigger" id="vuln-sub-trigger" type="checkbox">
                    <label class="sub-nav-trigger-label" for="vuln-sub-trigger">
                        <div class="mobile-nav-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="48.167px" height="47.75px" viewBox="0 0 48.167 47.75">
                            <circle opacity="0.4" fill="none" stroke="#FFFFFF" stroke-miterlimit="10" cx="24.083" cy="23.875" r="22"></circle>
                            <g>
                                <circle fill="#FFFFFF" cx="24.083" cy="16.068" r="2.496"></circle>
                                <circle fill="#FFFFFF" cx="24.083" cy="23.875" r="2.496"></circle>
                                <circle fill="#FFFFFF" cx="24.083" cy="31.682" r="2.496"></circle>
                            </g>
                        </svg>
                        </div>
                    </label>
                    <ul class="sub-nav sub-nav-single-list">
                        <li class="desktop-hide">
                            <a href="https://talosintelligence.com/vulnerability_info"><h1>Vulnerability Information</h1>
                            </a></li>
                        <li class="desktop-hide">
                            <label class="subnav-back-button" for="vuln-sub-trigger">BACK</label>
                        </li>
                        <li><a class="vulnerabilty-info-nav-link" href="https://talosintelligence.com/vulnerability_reports">Vulnerability Reports</a></li>
                        <li><a class="vulnerabilty-info-nav-link" href="https://talosintelligence.com/ms_advisories">Microsoft Advisories</a></li>
                    </ul>
                    <div class="desktop-hide subnav-overlay">
                        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="26px" height="20px" viewBox="0 0 26 20">
                        <g id="vuln-icon" class="nav-icon">
                            <path fill="#FFFFFF" d="M24.256,18.49L13.872,0.503C13.692,0.192,13.36,0,13,0c-0.359,0-0.692,0.192-0.872,0.503L1.744,18.49  c-0.18,0.312-0.18,0.695,0,1.006C1.924,19.809,2.257,20,2.616,20h20.769c0.359,0,0.691-0.191,0.871-0.504  C24.436,19.186,24.436,18.803,24.256,18.49 M14.268,18.215h-2.533v-1.85h2.533V18.215z M14.268,15.441h-2.533L10.89,6.515h4.222  L14.268,15.441z"></path>
                        </g>
                        </svg>
                    </div>
                </li>
                <li class="nav-item">
                    <a class="primary_nav_link" href="https://talosintelligence.com/incident_response">
                        <div class="mobile-nav-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="111.588" height="148.311" viewBox="0 0 111.588 148.311">
                            <path d="M1.181,128.446v15.7a4.167,4.167,0,0,0,4.167,4.167h100.9a4.167,4.167,0,0,0,4.167-4.167v-15.7a4.167,4.167,0,0,0-4.167-4.167H5.348a4.167,4.167,0,0,0-4.167,4.166M55.8,63.109a3.277,3.277,0,1,1,0,6.553c-10.344,0-20.755,8.578-20.755,18.57a3.277,3.277,0,1,1-6.554,0C28.489,73.947,41.93,63.109,55.8,63.109Zm0-12.016c-21.787,0-39.325,17.81-39.325,39.937v26.7H95.122V91.03c0-22.128-17.537-39.937-39.324-39.937m52.365-38.3a3.291,3.291,0,0,0-2.254,1.024L88.432,31.294a3.283,3.283,0,0,0,4.642,4.644l17.478-17.479a3.278,3.278,0,0,0-2.389-5.666m-105.138,0a3.276,3.276,0,0,0-1.98,5.666L18.522,35.938a3.283,3.283,0,0,0,4.643-4.644L5.687,13.817A3.255,3.255,0,0,0,3.025,12.793ZM55.389.026a3.276,3.276,0,0,0-2.867,3.345V19.642a3.277,3.277,0,1,0,6.554,0V3.371A3.283,3.283,0,0,0,55.389.026Z" fill="#fff"></path>
                            </svg>
                        </div>
                        <span class="top-nav-link-text">
                        Incident Response
                        </span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="primary_nav_link" href="https://blog.talosintelligence.com">
                        <div class="mobile-nav-icon">
                        <!-- Generator: Adobe Illustrator 16.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  --><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Layer_1" x="0px" y="0px" width="260px" height="296.5px" viewBox="0 0 260 296.5" enable-background="new 0 0 260 296.5" xml:space="preserve">
                        <path fill="#FFFFFF" d="M243.586,42.404h-14.448c-0.943-4.513-3.143-8.813-6.616-12.33L201.793,9.098  c-4.7-4.757-10.972-7.377-17.66-7.377c-6.578,0-12.777,2.547-17.457,7.173l-33.875,33.511H17.586c-6.6,0-12,5.399-12,12V226.28  c0,6.6,5.4,12,12,12H153.83l84.21,56.278l-27.448-56.278h32.994c6.6,0,12-5.4,12-12V54.404  C255.586,47.804,250.186,42.404,243.586,42.404z M214.662,48.045c-0.01,0.2-0.021,0.399-0.044,0.599  c-0.008,0.069-0.021,0.139-0.031,0.207c-0.046,0.345-0.113,0.688-0.196,1.026c-0.034,0.137-0.063,0.273-0.103,0.408  c-0.039,0.135-0.087,0.267-0.133,0.399c-0.051,0.151-0.102,0.302-0.16,0.45c-0.049,0.126-0.105,0.249-0.16,0.373  c-0.068,0.153-0.139,0.307-0.216,0.457c-0.059,0.116-0.12,0.23-0.184,0.345c-0.088,0.157-0.181,0.312-0.278,0.465  c-0.065,0.104-0.13,0.206-0.2,0.308c-0.115,0.168-0.239,0.33-0.366,0.492c-0.064,0.081-0.124,0.165-0.19,0.244  c-0.199,0.238-0.409,0.472-0.635,0.694L82.458,182.308l-47.932,12.871l13.427-47.74L177.223,19.561  c1.917-1.895,4.414-2.84,6.911-2.84c2.534,0,5.068,0.975,6.99,2.92l20.726,20.974c0.545,0.552,1.002,1.156,1.39,1.79  c0.574,0.938,0.975,1.951,1.206,2.993c0.004,0.021,0.01,0.04,0.014,0.06c0.049,0.226,0.086,0.453,0.119,0.682  c0.008,0.06,0.017,0.118,0.024,0.178c0.026,0.211,0.045,0.424,0.058,0.636c0.004,0.077,0.007,0.153,0.009,0.23  c0.007,0.203,0.011,0.407,0.005,0.61C214.673,47.877,214.666,47.961,214.662,48.045z"></path>
                        </svg>
                    </div>
                        <span class="top-nav-link-text">Blog</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="primary_nav_link" href="https://support.talosintelligence.com">
                        <div class="mobile-nav-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="26px" height="20px" viewBox="0 0 123.17 159.292">
                            <path d="M61.59,0,0,17.069v85.32c0,23.472,61.59,56.9,61.59,56.9s61.58-36.288,61.58-56.9V17.069Zm-.433,149.746C38.314,136.662,8.128,114.3,8.128,102.389V23.239l53.029-14.7Z" fill="#fff"></path>
                        </svg>
                        </div>
                        <span class="top-nav-link-text">Support</span>
                    </a>
                </li>
            </ul>


<!--                <li class="nav-item desktop-hide">-->
<!--                    <button class="search-button" data-ghost-search><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg> <span>Search Blog</span></button>-->
<!--                </li>-->

            <ul class="secondary-nav-list">
                <div class="more-desktop-link">
                    <div class="more-link-wrapper">
                        <span class="more-nav-link">
                            <div class="desktop-nav-icon more-menu-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="22px" height="16px" viewBox="0 0 22 16">
                                <g id="menu-icon">
                                    <path fill="#FFFFFF" d="M20.5,3h-19C0.672,3,0,2.329,0,1.5S0.672,0,1.5,0h19C21.328,0,22,0.671,22,1.5S21.328,3,20.5,3z"></path>
                                    <path fill="#FFFFFF" d="M20.5,9.5h-19C0.672,9.5,0,8.828,0,8c0-0.829,0.672-1.5,1.5-1.5h19C21.328,6.5,22,7.171,22,8   C22,8.828,21.328,9.5,20.5,9.5z"></path>
                                    <path fill="#FFFFFF" d="M20.5,16h-19C0.672,16,0,15.328,0,14.5S0.672,13,1.5,13h19c0.828,0,1.5,0.672,1.5,1.5S21.328,16,20.5,16z"></path>
                                </g>
                                </svg>
                            </div>
                            <span class="top-nav-link-text top-nav-more-text">
                            More
                            </span>
                        </span>
                    </div>
                </div>
                <li class="nav-item more-text-link">
                    <div class="more-link-wrapper more-link-wrapper-mobile">
                        <span class="more-nav-link">
                            <div class="mobile-nav-icon"><!-- Generator: Adobe Illustrator 24.2.1, SVG Export Plug-In . SVG Version: 6.00 Build 0)  --><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Layer_1" x="0px" y="0px" viewBox="0 0 20 20" style="enable-background:new 0 0 20 20;" width="25px" height="25px" xml:space="preserve">
                                <style type="text/css">
                                    .white{fill:#FFFFFF;}
                                </style>
                                <path class="white" d="M19.4,17.1c0,0.1-0.1,0-0.2,0c0,0-1.3-0.9-2-1.4c-0.2-0.1-0.5-0.1-0.6,0.1c-0.3,0.3-0.6,0.8-0.9,1.3  c-0.1,0.2-0.1,0.5,0.1,0.6l2,1.5c0.1,0,0,0.1,0.1,0.2c0,0.1,0,0.1-0.1,0.2c-1.2,0.5-2.6,0.2-3.5-0.7c-0.8-0.9-1-2-0.7-3.1L4.5,6.5  c-1,0.3-2.3,0-3-0.9c-0.8-0.9-1.1-1.7-1-2.7c0-0.1,0-0.1,0.1-0.2c0.1,0,0.2,0.1,0.2,0.1l2,1.5C3,4.4,3.3,4.5,3.4,4.2  c0,0,0.5-0.8,0.9-1.3c0.1-0.2,0.1-0.5-0.1-0.6L2.3,0.9c-0.1,0,0-0.1-0.1-0.3c0-0.1,0-0.1,0.1-0.2C3.5-0.1,5,0.2,5.8,1.1  c0.8,0.9,1,2,0.7,3.1l9.1,9.3c1-0.3,2.3,0,3,0.9c0.7,0.7,0.9,1.5,0.9,2.5C19.5,16.9,19.5,17,19.4,17.1z"></path>
                                </svg>
                            </div>
                            <span class="top-nav-link-text top-nav-more-text">
                            Security Resources
                            </span>
                        </span>
                    </div>
                    <input class="sub-nav-trigger" id="security-resources-sub-trigger" type="checkbox">
                    <label class="sub-nav-trigger-label" for="security-resources-sub-trigger">
                        <div class="mobile-nav-icon"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="48.167px" height="47.75px" viewBox="0 0 48.167 47.75">
                            <circle opacity="0.4" fill="none" stroke="#FFFFFF" stroke-miterlimit="10" cx="24.083" cy="23.875" r="22"></circle>
                            <g>
                                <circle fill="#FFFFFF" cx="24.083" cy="16.068" r="2.496"></circle>
                                <circle fill="#FFFFFF" cx="24.083" cy="23.875" r="2.496"></circle>
                                <circle fill="#FFFFFF" cx="24.083" cy="31.682" r="2.496"></circle>
                            </g>
                        </svg>
                        </div>
                    </label>
                    <div class="sub-nav sub-nav-multiple-list sub-nav-multiple-list-left">
                        <div class="sub-nav-multiple-wrapper">
                            <div class="sub-nav-list-top-of-mobile-wrapper">
                                <h1 class="sub-nav-list-header sub-nav-list-top-of-mobile">Security Resources</h1>
                                <ul class="sub-nav-list">
                                    <li class="desktop-hide">
                                        <label class="subnav-back-button" for="security-resources-sub-trigger">BACK</label>
                                    </li>
                                </ul>
                            </div>
                            <div class="sub-nav-list-item-wrapper">
                                <span class="sub-nav-desktop-header uppercase">Security Resources</span>
                                <ul class="sub-nav-list">
                                    <li>
                                        <a href="https://talosintelligence.com/software"><span>Open Source Security Tools</span>
                                        </a></li>
                                    <li>
                                        <a href="https://talosintelligence.com/categories"><span>Intelligence Categories Reference</span>
                                        </a></li>
                                    <li>
                                        <a href="https://talosintelligence.com/secure-endpoint-naming"><span>Secure Endpoint Naming Reference</span>
                                        </a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="desktop-hide subnav-overlay"><!-- Generator: Adobe Illustrator 24.2.1, SVG Export Plug-In . SVG Version: 6.00 Build 0)  --><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Layer_1" x="0px" y="0px" viewBox="0 0 20 20" style="enable-background:new 0 0 20 20;" width="25px" height="25px" xml:space="preserve">
                        <style type="text/css">
                            .white{fill:#FFFFFF;}
                        </style>
                                                <path class="white" d="M19.4,17.1c0,0.1-0.1,0-0.2,0c0,0-1.3-0.9-2-1.4c-0.2-0.1-0.5-0.1-0.6,0.1c-0.3,0.3-0.6,0.8-0.9,1.3  c-0.1,0.2-0.1,0.5,0.1,0.6l2,1.5c0.1,0,0,0.1,0.1,0.2c0,0.1,0,0.1-0.1,0.2c-1.2,0.5-2.6,0.2-3.5-0.7c-0.8-0.9-1-2-0.7-3.1L4.5,6.5  c-1,0.3-2.3,0-3-0.9c-0.8-0.9-1.1-1.7-1-2.7c0-0.1,0-0.1,0.1-0.2c0.1,0,0.2,0.1,0.2,0.1l2,1.5C3,4.4,3.3,4.5,3.4,4.2  c0,0,0.5-0.8,0.9-1.3c0.1-0.2,0.1-0.5-0.1-0.6L2.3,0.9c-0.1,0,0-0.1-0.1-0.3c0-0.1,0-0.1,0.1-0.2C3.5-0.1,5,0.2,5.8,1.1  c0.8,0.9,1,2,0.7,3.1l9.1,9.3c1-0.3,2.3,0,3,0.9c0.7,0.7,0.9,1.5,0.9,2.5C19.5,16.9,19.5,17,19.4,17.1z"></path>
                        </svg>
                    </div>
                </li>
                <li class="nav-item">
                    <div class="more-link-wrapper more-link-wrapper-mobile">
                        <span class="more-nav-link">
                            <div class="mobile-nav-icon"><!-- Generator: Adobe Illustrator 24.2.1, SVG Export Plug-In . SVG Version: 6.00 Build 0)  --><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Layer_1" x="0px" y="0px" viewBox="0 0 20 20" width="25px" height="25px" style="enable-background:new 0 0 20 20;" xml:space="preserve">
                                <style type="text/css">
                                    .sticoncomment{fill-rule:evenodd;clip-rule:evenodd;fill:#FFFFFF;}
                                </style>
                                <path class="sticoncomment" d="M13.6,7.1H6.4c-0.3,0-0.6-0.3-0.6-0.6c0-0.3,0.3-0.6,0.6-0.6l7.2,0c0.3,0,0.6,0.3,0.6,0.6  C14.2,6.8,13.9,7.1,13.6,7.1L13.6,7.1z M13.6,9.4H6.4c-0.3,0-0.6-0.3-0.6-0.6s0.3-0.6,0.6-0.6l7.2,0c0.3,0,0.6,0.3,0.6,0.6  C14.2,9.2,13.9,9.4,13.6,9.4L13.6,9.4z M11.5,11.7H6.4c-0.3,0-0.6-0.3-0.6-0.6c0-0.3,0.3-0.6,0.6-0.6h5.1c0.3,0,0.6,0.3,0.6,0.6  C12.1,11.5,11.8,11.7,11.5,11.7z M15.8,3H4.2C3.5,3,3,3.5,3,4.2V17l2.8-2.3h10c0.6,0,1.2-0.5,1.2-1.2V4.2C17,3.5,16.5,3,15.8,3  L15.8,3z"></path>
                                </svg>
                            </div>
                            <span class="top-nav-link-text top-nav-more-text">
                            Media
                            </span>
                        </span>
                    </div>
                    <input class="sub-nav-trigger" id="media-sub-trigger" type="checkbox">
                    <label class="sub-nav-trigger-label" for="media-sub-trigger">
                        <div class="mobile-nav-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="48.167px" height="47.75px" viewBox="0 0 48.167 47.75">
                            <circle opacity="0.4" fill="none" stroke="#FFFFFF" stroke-miterlimit="10" cx="24.083" cy="23.875" r="22"></circle>
                            <g>
                                <circle fill="#FFFFFF" cx="24.083" cy="16.068" r="2.496"></circle>
                                <circle fill="#FFFFFF" cx="24.083" cy="23.875" r="2.496"></circle>
                                <circle fill="#FFFFFF" cx="24.083" cy="31.682" r="2.496"></circle>
                            </g>
                            </svg>
                        </div>
                    </label>
                    <div class="sub-nav sub-nav-multiple-list sub-nav-multiple-list-middle">
                        <div class="sub-nav-multiple-wrapper">
                            <div class="sub-nav-list-top-of-mobile-wrapper">
                                <h1 class="sub-nav-list-header sub-nav-list-top-of-mobile">Media</h1>
                                <ul class="sub-nav-list">
                                    <li class="desktop-hide">
                                        <label class="subnav-back-button" for="media-sub-trigger">BACK</label>
                                    </li>
                                </ul>
                            </div>
                            <div class="sub-nav-list-item-wrapper">
                                <span class="sub-nav-desktop-header uppercase">Media</span>
                                <ul class="sub-nav-list">
                                    <li>
                                        <a href="https://blog.talosintelligence.com"><span>Talos Intelligence Blog</span>
                                        </a></li>
                                    <li>
                                        <a href="https://blog.talosintelligence.com/category/threat-source-newsletter/"><span>Threat Source Newsletter</span>
                                        </a></li>
                                    <li>
                                        <a href="https://talosintelligence.com/podcasts/shows/beers_with_talos"><span>Beers with Talos Podcast</span>
                                        </a></li>
                                    <li>
                                        <a href="https://talosintelligence.com/podcasts/shows/talos_takes"><span>Talos Takes Podcast</span>
                                        </a></li>
                                    <li>
                                        <a target="_blank" href="https://www.youtube.com/channel/UCPZ1DtzQkStYBSG3GTNoyfg/featured"><span>Talos Videos</span>
                                        </a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="desktop-hide subnav-overlay"><!-- Generator: Adobe Illustrator 24.2.1, SVG Export Plug-In . SVG Version: 6.00 Build 0)  --><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Layer_1" x="0px" y="0px" viewBox="0 0 20 20" width="25px" height="25px" style="enable-background:new 0 0 20 20;" xml:space="preserve">
                        <style type="text/css">
                            .sticoncomment{fill-rule:evenodd;clip-rule:evenodd;fill:#FFFFFF;}
                        </style>
                        <path class="sticoncomment" d="M13.6,7.1H6.4c-0.3,0-0.6-0.3-0.6-0.6c0-0.3,0.3-0.6,0.6-0.6l7.2,0c0.3,0,0.6,0.3,0.6,0.6  C14.2,6.8,13.9,7.1,13.6,7.1L13.6,7.1z M13.6,9.4H6.4c-0.3,0-0.6-0.3-0.6-0.6s0.3-0.6,0.6-0.6l7.2,0c0.3,0,0.6,0.3,0.6,0.6  C14.2,9.2,13.9,9.4,13.6,9.4L13.6,9.4z M11.5,11.7H6.4c-0.3,0-0.6-0.3-0.6-0.6c0-0.3,0.3-0.6,0.6-0.6h5.1c0.3,0,0.6,0.3,0.6,0.6  C12.1,11.5,11.8,11.7,11.5,11.7z M15.8,3H4.2C3.5,3,3,3.5,3,4.2V17l2.8-2.3h10c0.6,0,1.2-0.5,1.2-1.2V4.2C17,3.5,16.5,3,15.8,3  L15.8,3z"></path>
                        </svg>
                    </div>
                </li>
                <li class="nav-item">
                    <div class="more-link-wrapper more-link-wrapper-mobile">
                        <span class="more-nav-link">
                            <div class="mobile-nav-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="25px" height="25px" viewBox="0 0 55 55">
                                <g>
                                    <g class="mobile-nav-home">
                                        <path fill-rule="evenodd" clip-rule="evenodd" fill="#FFFFFF" d="M45.201,12.343c0.378,0.48,0.758,0.925,1.096,1.401    c2.975,4.207,4.543,8.876,4.494,14.044c-0.05,5.452-1.643,10.386-5.186,14.593c-3.484,4.133-7.929,6.73-13.182,7.895    c-6.313,1.398-12.216,0.275-17.695-3.131c-0.441-0.273-0.847-0.6-1.266-0.904c-0.11-0.078-0.208-0.174-0.337-0.287    c0.127-0.141,0.246-0.27,0.366-0.398c0.887-0.949,1.765-1.904,2.663-2.844c0.114-0.119,0.321-0.217,0.485-0.217    c3.658-0.006,7.318,0,10.975,0.008c3.458,0.006,6.913,0.02,10.369,0.02c0.957,0,1.871-0.193,2.62-0.844    c0.797-0.693,1.157-1.596,1.157-2.643c0.001-7.533,0.003-15.067-0.005-22.601c-0.002-0.309,0.088-0.524,0.3-0.743    C43.098,14.598,44.127,13.49,45.201,12.343"></path>
                                        <path fill-rule="evenodd" clip-rule="evenodd" fill="#FFFFFF" d="M41.402,8.822c-0.99,1.027-1.994,2.021-2.935,3.072    c-0.312,0.35-0.616,0.416-1.036,0.415c-6.98-0.009-13.957-0.007-20.938-0.007c-2.039,0-3.561,1.514-3.561,3.557    c0,6.504,0.002,13.008,0.006,19.512c0.002,0.973,0.011,1.943,0.004,2.914c0,0.133-0.04,0.301-0.127,0.393    c-1.069,1.162-2.15,2.314-3.229,3.469c-0.021,0.023-0.052,0.039-0.109,0.08c-0.159-0.188-0.323-0.369-0.471-0.562    c-2.535-3.348-4.119-7.102-4.605-11.268c-0.61-5.229,0.194-10.229,2.835-14.839c2.669-4.664,6.655-7.805,11.618-9.75    c3.205-1.257,6.533-1.852,9.977-1.621c4.478,0.298,8.553,1.754,12.227,4.325c0.101,0.072,0.197,0.151,0.291,0.229    C41.364,8.755,41.374,8.778,41.402,8.822"></path>
                                        <path fill-rule="evenodd" clip-rule="evenodd" fill="#FFFFFF" d="M39.799,12.47c0.873-0.911,1.749-1.829,2.676-2.797    c0.605,0.564,1.195,1.112,1.816,1.691c-0.941,0.985-1.817,1.903-2.703,2.83c-0.276-0.339-0.511-0.688-0.807-0.975    C40.492,12.941,40.145,12.728,39.799,12.47"></path>
                                        <path fill-rule="evenodd" clip-rule="evenodd" fill="#FFFFFF" d="M10.35,43.279c0.969-1.016,1.885-1.977,2.76-2.893    c0.213,0.369,0.376,0.762,0.639,1.072c0.265,0.312,0.627,0.539,0.98,0.832c-0.853,0.891-1.713,1.791-2.624,2.746    C11.513,44.445,10.939,43.869,10.35,43.279"></path>
                                    </g>
                                </g>
                                </svg>
                            </div>
                            <span class="top-nav-link-text top-nav-more-text">
                            Company
                            </span>
                        </span>
                    </div>
                    <input class="sub-nav-trigger" id="company-sub-trigger" type="checkbox">
                    <label class="sub-nav-trigger-label" for="company-sub-trigger">
                        <div class="mobile-nav-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="48.167px" height="47.75px" viewBox="0 0 48.167 47.75">
                            <circle opacity="0.4" fill="none" stroke="#FFFFFF" stroke-miterlimit="10" cx="24.083" cy="23.875" r="22"></circle>
                            <g>
                                <circle fill="#FFFFFF" cx="24.083" cy="16.068" r="2.496"></circle>
                                <circle fill="#FFFFFF" cx="24.083" cy="23.875" r="2.496"></circle>
                                <circle fill="#FFFFFF" cx="24.083" cy="31.682" r="2.496"></circle>
                            </g>
                        </svg>
                        </div>
                    </label>
                    <div class="sub-nav sub-nav-multiple-list sub-nav-multiple-list-right">
                        <div class="sub-nav-multiple-wrapper">
                            <div class="sub-nav-list-top-of-mobile-wrapper">
                                <h1 class="sub-nav-list-header sub-nav-list-top-of-mobile">Company</h1>
                                <ul class="sub-nav-list">
                                    <li class="desktop-hide">
                                        <label class="subnav-back-button" for="company-sub-trigger">BACK</label>
                                    </li>
                                </ul>
                            </div>
                            <div class="sub-nav-list-item-wrapper">
                                <span class="sub-nav-desktop-header uppercase">Company</span>
                                <ul class="sub-nav-list">
                                    <li>
                                        <a href="https://talosintelligence.com/about"><span>About Talos</span>
                                        </a></li>
                                    <li>
                                        <a href="https://talosintelligence.com/careers"><span>Careers</span>
                                        </a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="desktop-hide subnav-overlay"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="25px" height="25px" viewBox="0 0 55 55">
                        <g>
                            <g class="mobile-nav-home">
                                <path fill-rule="evenodd" clip-rule="evenodd" fill="#FFFFFF" d="M45.201,12.343c0.378,0.48,0.758,0.925,1.096,1.401    c2.975,4.207,4.543,8.876,4.494,14.044c-0.05,5.452-1.643,10.386-5.186,14.593c-3.484,4.133-7.929,6.73-13.182,7.895    c-6.313,1.398-12.216,0.275-17.695-3.131c-0.441-0.273-0.847-0.6-1.266-0.904c-0.11-0.078-0.208-0.174-0.337-0.287    c0.127-0.141,0.246-0.27,0.366-0.398c0.887-0.949,1.765-1.904,2.663-2.844c0.114-0.119,0.321-0.217,0.485-0.217    c3.658-0.006,7.318,0,10.975,0.008c3.458,0.006,6.913,0.02,10.369,0.02c0.957,0,1.871-0.193,2.62-0.844    c0.797-0.693,1.157-1.596,1.157-2.643c0.001-7.533,0.003-15.067-0.005-22.601c-0.002-0.309,0.088-0.524,0.3-0.743    C43.098,14.598,44.127,13.49,45.201,12.343"></path>
                                <path fill-rule="evenodd" clip-rule="evenodd" fill="#FFFFFF" d="M41.402,8.822c-0.99,1.027-1.994,2.021-2.935,3.072    c-0.312,0.35-0.616,0.416-1.036,0.415c-6.98-0.009-13.957-0.007-20.938-0.007c-2.039,0-3.561,1.514-3.561,3.557    c0,6.504,0.002,13.008,0.006,19.512c0.002,0.973,0.011,1.943,0.004,2.914c0,0.133-0.04,0.301-0.127,0.393    c-1.069,1.162-2.15,2.314-3.229,3.469c-0.021,0.023-0.052,0.039-0.109,0.08c-0.159-0.188-0.323-0.369-0.471-0.562    c-2.535-3.348-4.119-7.102-4.605-11.268c-0.61-5.229,0.194-10.229,2.835-14.839c2.669-4.664,6.655-7.805,11.618-9.75    c3.205-1.257,6.533-1.852,9.977-1.621c4.478,0.298,8.553,1.754,12.227,4.325c0.101,0.072,0.197,0.151,0.291,0.229    C41.364,8.755,41.374,8.778,41.402,8.822"></path>
                                <path fill-rule="evenodd" clip-rule="evenodd" fill="#FFFFFF" d="M39.799,12.47c0.873-0.911,1.749-1.829,2.676-2.797    c0.605,0.564,1.195,1.112,1.816,1.691c-0.941,0.985-1.817,1.903-2.703,2.83c-0.276-0.339-0.511-0.688-0.807-0.975    C40.492,12.941,40.145,12.728,39.799,12.47"></path>
                                <path fill-rule="evenodd" clip-rule="evenodd" fill="#FFFFFF" d="M10.35,43.279c0.969-1.016,1.885-1.977,2.76-2.893    c0.213,0.369,0.376,0.762,0.639,1.072c0.265,0.312,0.627,0.539,0.98,0.832c-0.853,0.891-1.713,1.791-2.624,2.746    C11.513,44.445,10.939,43.869,10.35,43.279"></path>
                            </g>
                        </g>
                    </svg>
                    </div>
                </li>
            </ul>
            <div class="nav-search-wrapper">
                <button class="search-button" data-ghost-search>
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                </button>
            </div>
        </div>



    </div>
</nav>

    

    <main id="site-main">
        <div class="container-fluid">
            <div class="row main-content-row">
                <div class="col">
                    <div class="post-full-content">
                        
<article class="post ">
        <div class="feature-image-wrapper my-5">
            <figure>
                <img src="/content/images/2022/12/image4-1.jpg" alt="" class="img-fluid" />
            </figure>
        </div>

    <h1 class="text-center">Old dog, new tricks - Analysing new RTF-based campaign distributing Agent Tesla, Loki with PyREbox</h1>

    <div class="text-center m-1">
        <div class="post-author">
            <span>By </span>
                <a href="https://blog.talosintelligence.com/author/holger-unterbrink/">Holger Unterbrink</a>
        </div>

        <br/>
        <time class="post-datetime" datetime="October 15, 2018 12:00">
            Monday, October 15, 2018 12:00
        </time>

        <div class="m-3">
        </div>
    </div>

    <section class="post-content-wrapper mt-5">
        <div class="post-content">
            <p>This blog post was authored by <a href="https://www.blogger.com/profile/10442669663667294759">Edmund Brumaghin</a> and <a href="http://blogs.cisco.com/author/holgerunterbrink">Holger Unterbrink</a> with contributions from <a href="https://blogs.cisco.com/author/emmanueltacheau">Emmanuel Tacheau</a>.</p><h3 id="executive-summary">Executive Summary</h3><p>Cisco Talos has discovered a new malware campaign that drops the sophisticated information-stealing trojan called "Agent Tesla," and other malware such as the Loki information stealer. Initially, Talos' telemetry systems detected a highly suspicious document that wasn't picked up by common antivirus solutions. However, <a href="https://www.cisco.com/c/en/us/products/security/threat-grid/index.html">Threat Grid</a>, Cisco's unified malware analysis and threat intelligence platform, identified the unknown file as malware. The adversaries behind this malware use a well-known exploit chain, but modified it in such a way so that antivirus solutions don't detect it. In this post, we will outline the steps the adversaries took to remain undetected, and why it's important to use more sophisticated software to track these kinds of attacks. If undetected, Agent Tesla has the ability to steal user's login information from a number of important pieces of software, such as Google Chrome, Mozilla Firefox, Microsoft Outlook and many others. It can also be used to capture screenshots, record webcams, and allow attackers to install additional malware on infected systems.</p><h3 id="technical-details">Technical Details</h3><p>In most cases, the first stage of the attack occurred in a similar way to the FormBook malware campaign, which we discussed earlier this year in a <a href="https://blog.talosintelligence.com/2018/06/my-little-formbook.html">blog post</a>. The actors behind the previous FormBook campaign used CVE-2017-0199 — a remote code execution vulnerability in multiple versions of Microsoft Office — to download and open an RTF document from inside a malicious DOCX file. We have also observed newer campaigns being used to distribute Agent Tesla and Loki that are leveraging CVE-2017-11882. An example of one of the malware distribution URLs is in the screenshot below. Besides Agent Tesla and Loki, this infrastructure is also distributing many other malware families, such as Gamarue, which has the ability to completely take over a user's machine and has the same capabilities as a typical information stealer. <br><br>The aforementioned FormBook blog contains more information about this stage. Many users have the assumption that modern Microsoft Word documents are less dangerous than RTF or DOC files. While this is partially true, attackers can still find ways with these newer file formats to exploit various vulnerabilities. </p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.talosintelligence.com/content/images/2022/12/image4-2.jpg" class="kg-image" alt loading="lazy" width="1697" height="422" srcset="https://blog.talosintelligence.com/content/images/size/w600/2022/12/image4-2.jpg 600w, https://blog.talosintelligence.com/content/images/size/w1000/2022/12/image4-2.jpg 1000w, https://blog.talosintelligence.com/content/images/size/w1600/2022/12/image4-2.jpg 1600w, https://blog.talosintelligence.com/content/images/2022/12/image4-2.jpg 1697w" sizes="(min-width: 720px) 720px"><figcaption>Figure 1 - First stage exploit</figcaption></figure><p>In the case of Agent Tesla, the downloaded file was an RTF file with the SHA256 hash  <em>cf193637626e85b34a7ccaed9e4459b75605af46cedc95325583b879990e0e61</em>. At the time the file was analyzed, it had almost no detections on the multi-engine antivirus scanning website VirusTotal. Only two out of 58 antivirus programs found anything suspicious. The programs that flagged this sample were only warning about a wrongly formatted RTF file. AhnLab-V3 marked it for "<em>RTF/Malform-A.Gen,</em>" while Zoner said it was likely flagged for "<em>RTFBadVersion.</em>"<br><br>However, Cisco's Threat Grid painted a different picture, and identified the file as malware. </p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.talosintelligence.com/content/images/2022/12/image9-2.jpg" class="kg-image" alt loading="lazy" width="1755" height="1017" srcset="https://blog.talosintelligence.com/content/images/size/w600/2022/12/image9-2.jpg 600w, https://blog.talosintelligence.com/content/images/size/w1000/2022/12/image9-2.jpg 1000w, https://blog.talosintelligence.com/content/images/size/w1600/2022/12/image9-2.jpg 1600w, https://blog.talosintelligence.com/content/images/2022/12/image9-2.jpg 1755w" sizes="(min-width: 720px) 720px"><figcaption>Figure 2 - ThreatGrid Behavior Indicators (BI)</figcaption></figure><p><br>Figure 2 above shows just a subset of the triggered behaviour indicators (BI), and the part of the process tree below shows the highly suspicious execution chain.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.talosintelligence.com/content/images/2022/12/image22.jpg" class="kg-image" alt loading="lazy" width="1624" height="709" srcset="https://blog.talosintelligence.com/content/images/size/w600/2022/12/image22.jpg 600w, https://blog.talosintelligence.com/content/images/size/w1000/2022/12/image22.jpg 1000w, https://blog.talosintelligence.com/content/images/size/w1600/2022/12/image22.jpg 1600w, https://blog.talosintelligence.com/content/images/2022/12/image22.jpg 1624w" sizes="(min-width: 720px) 720px"><figcaption>Figure 3 - ThreatGrid process tree</figcaption></figure><p>In figure 3, we can see that <em>Winword.exe</em> starts, and a bit later, a <em>svchost</em> process executes the Microsoft Equation Editor (<em>EQNEDT32.exe</em>), which starts a process called "<em>scvhost.exe</em>". Equation Editor is a tool that Microsoft Office uses as a helper application to embed mathematical equations into documents. Word for example, uses OLE/COM functions to start the Equation Editor, which matches what we see in figure 3. It's pretty uncommon for the Equation Editor application to start other executables, like the executable shown in figure 3. Not to mention that an executable using such a similar name, like the system file "svchost.exe," is suspicious on its own. A user could easily miss the fact that the file name is barely changed.<br><br>The Threat Grid process timeline below confirms that this file is behaving like typical malware.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.talosintelligence.com/content/images/2022/12/image18-1.jpg" class="kg-image" alt loading="lazy" width="1793" height="1039" srcset="https://blog.talosintelligence.com/content/images/size/w600/2022/12/image18-1.jpg 600w, https://blog.talosintelligence.com/content/images/size/w1000/2022/12/image18-1.jpg 1000w, https://blog.talosintelligence.com/content/images/size/w1600/2022/12/image18-1.jpg 1600w, https://blog.talosintelligence.com/content/images/2022/12/image18-1.jpg 1793w" sizes="(min-width: 720px) 720px"><figcaption>Figure 4 - ThreatGrid process timeline</figcaption></figure><p>You can see in figure 4 at points 1 and 2 that the Equation Editor downloaded a file called "<em>xyz[1].123</em>" and then created the <em>scvhost.exe</em> process, which created another instance [<em>scvhost.exe(26)</em>] of itself a bit later (blue rectangle). Typical command and control (C2) traffic follows at point 4. At this point, we were sure that this is malware. The question was — why isn't it detected by any antivirus systems? And how does it manage to fly under the radar?</p><h4 id="the-malicious-rtf-file">The malicious RTF file</h4><p>The <a href="https://en.wikipedia.org/wiki/Rich_Text_Format">RTF standard</a> is a proprietary document file format developed by Microsoft as a cross-platform document interchange. A simplified, standard RTF file looks like what you can see in figure 4. It is built out of text and control words (strings). The upper portion is the source code and the lower shows how this file is displayed in Microsoft Word.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.talosintelligence.com/content/images/2022/12/image11-2.jpg" class="kg-image" alt loading="lazy" width="1043" height="776" srcset="https://blog.talosintelligence.com/content/images/size/w600/2022/12/image11-2.jpg 600w, https://blog.talosintelligence.com/content/images/size/w1000/2022/12/image11-2.jpg 1000w, https://blog.talosintelligence.com/content/images/2022/12/image11-2.jpg 1043w" sizes="(min-width: 720px) 720px"><figcaption>Figure 5 - Simple RTF document</figcaption></figure><p>RTF files do not support any macro language, but they do support Microsoft Object Linking and Embedding (OLE) objects and Macintosh Edition Manager subscriber objects via the '<em>\object</em>' control word. The user can link or embed an object from the same or different format into the RTF document. For example, the user can embed a mathematical equation formula, created by the Microsoft Equation Editor into the RTF document. Simplified, it would be stored in the object's data as a hexadecimal data stream. If the user opens this RTF file with Word, it hands over the object data to the Equation Editor application via OLE functions and gets the data back in a format that Word can display. In other words, the equation is displayed as being embedded in the document, even if Word could not handle it without the external application. This is pretty much what the file "<em>3027748749.rtf</em>" is doing. The only difference is, it is adding a lot of obfuscation, as you can see in figure 6. The big disadvantages of the RTF standard are that it comes with so many control words and common RTF parsers are supposed to ignore anything they don't know. Therefore, adversaries have plenty of options to <a href="https://www.decalage.info/rtf_tricks">obfuscate</a> the content of the RTF files. </p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.talosintelligence.com/content/images/2022/12/image17-1.jpg" class="kg-image" alt loading="lazy" width="1496" height="422" srcset="https://blog.talosintelligence.com/content/images/size/w600/2022/12/image17-1.jpg 600w, https://blog.talosintelligence.com/content/images/size/w1000/2022/12/image17-1.jpg 1000w, https://blog.talosintelligence.com/content/images/2022/12/image17-1.jpg 1496w" sizes="(min-width: 720px) 720px"><figcaption>Figure 6 - 3027748749.rtf</figcaption></figure><p>We were able to use the rtfdump/rtfobj tools to verify the structure and extract the actual object data payload, despite the fact that the RTF file was heavily obfuscated. Figure 8 shows that the file tries to start the Microsoft Equation Editor (class name: <em>EQuATioN.3</em>).</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.talosintelligence.com/content/images/2022/12/image12.jpg" class="kg-image" alt loading="lazy" width="1178" height="97" srcset="https://blog.talosintelligence.com/content/images/size/w600/2022/12/image12.jpg 600w, https://blog.talosintelligence.com/content/images/size/w1000/2022/12/image12.jpg 1000w, https://blog.talosintelligence.com/content/images/2022/12/image12.jpg 1178w" sizes="(min-width: 720px) 720px"><figcaption>Figure 7 - rtfdump</figcaption></figure><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.talosintelligence.com/content/images/2022/12/image15-1.jpg" class="kg-image" alt loading="lazy" width="958" height="334" srcset="https://blog.talosintelligence.com/content/images/size/w600/2022/12/image15-1.jpg 600w, https://blog.talosintelligence.com/content/images/2022/12/image15-1.jpg 958w" sizes="(min-width: 720px) 720px"><figcaption>Figure 8 - rtfobj</figcaption></figure><p>In figure 6, you can also see that the adversaries are using the <em>\objupdate</em> trick. This <a href="http://latex2rtf.sourceforge.net/rtfspec_7.html">forces</a> the embedded object to update before it's displayed. In other words, the user does not have to click on the object before it's loaded. This would be the case for "normal" objects. But by force-opening the file, the exploit starts right away.<br><br>Let's have a look to the <em>objdata</em> content from above, converted to a hexadecimal binary stream. More header details can be found <a href="https://msdn.microsoft.com/en-us/library/dd942076.aspx">here</a>.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.talosintelligence.com/content/images/2022/12/image8-1.jpg" class="kg-image" alt loading="lazy" width="1502" height="804" srcset="https://blog.talosintelligence.com/content/images/size/w600/2022/12/image8-1.jpg 600w, https://blog.talosintelligence.com/content/images/size/w1000/2022/12/image8-1.jpg 1000w, https://blog.talosintelligence.com/content/images/2022/12/image8-1.jpg 1502w" sizes="(min-width: 720px) 720px"><figcaption>Figure 9 - Headers</figcaption></figure><p>We can find a similar <a href="http://rtf2latex2e.sourceforge.net/MTEF3.html">MTEF Header</a> like the one described in the FormBook post, but to avoid detection, the adversaries have changed the header's values. The only difference is that, except in the MTEF version field, the actors have filled the header fields with random values. The MTEF version field needs to be 2 or 3 to make the exploit work.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.talosintelligence.com/content/images/2022/12/image13-3.jpg" class="kg-image" alt loading="lazy" width="1183" height="406" srcset="https://blog.talosintelligence.com/content/images/size/w600/2022/12/image13-3.jpg 600w, https://blog.talosintelligence.com/content/images/size/w1000/2022/12/image13-3.jpg 1000w, https://blog.talosintelligence.com/content/images/2022/12/image13-3.jpg 1183w" sizes="(min-width: 720px) 720px"><figcaption>Figure 10 - MTEF V2 header</figcaption></figure><p>After the MTEF header, we have an unknown MTEF byte stream tag of two bytes (F1 01) followed by the a <em>Font Tag (08 E0 7B … )</em>.The bytes following the Font Tag (B9 C3 …) do not look like a normal font name, so this is a good indicator that we are looking at an exploit. The bytes do look very different to what we have seen in our research mentioned previously, but let's decode them.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.talosintelligence.com/content/images/2022/12/image7-2.jpg" class="kg-image" alt loading="lazy" width="1676" height="427" srcset="https://blog.talosintelligence.com/content/images/size/w600/2022/12/image7-2.jpg 600w, https://blog.talosintelligence.com/content/images/size/w1000/2022/12/image7-2.jpg 1000w, https://blog.talosintelligence.com/content/images/size/w1600/2022/12/image7-2.jpg 1600w, https://blog.talosintelligence.com/content/images/2022/12/image7-2.jpg 1676w" sizes="(min-width: 720px) 720px"><figcaption>Figure 11 - Shellcode - new campaign.</figcaption></figure><p>This looks pretty similar to what we have seen before. In figure 12, you can see the decoded shellcode from our previous research.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.talosintelligence.com/content/images/2022/12/image27.jpg" class="kg-image" alt loading="lazy" width="1529" height="425" srcset="https://blog.talosintelligence.com/content/images/size/w600/2022/12/image27.jpg 600w, https://blog.talosintelligence.com/content/images/size/w1000/2022/12/image27.jpg 1000w, https://blog.talosintelligence.com/content/images/2022/12/image27.jpg 1529w" sizes="(min-width: 720px) 720px"><figcaption>Figure 12 - Shellcode - former campaign.</figcaption></figure><p>The adversaries have just changed registers and some other minor parts. At this point, we are already pretty sure that this is CVE-2017-11882, but let's prove this.</p><h4 id="pyrebox-rock-n-roll">PyREBox rock 'n' roll</h4><p>In order to verify that the malicious RTF file is exploiting CVE-2017-11882, we used PyREBox, a dynamic analysis engine developed by Talos. This tool allows us to instrument the execution of a complete system and monitor different events, such as instruction execution, memory read and writes, operating system events, and also provides interactive analysis capabilities that allow us to inspect the state of the emulated system at any time. For additional information about the tool, please refer to the <a href="https://blog.talosintelligence.com/2018/04/malware-monitor-pyrebox-for-analysis.html">blog posts</a> about its release and the <a href="https://github.com/Cisco-Talos/pyrebox/tree/master/mw_monitor">malware monitoring scripts</a><a href="https://github.com/Cisco-Talos/pyrebox/tree/master/docs/pyrebox_hitb_ams.pdf">presented</a> at the Hack in the Box 2018 conference.<br><br>For this analysis, we leveraged the shadow stack plugin, which was released together with other exploit analysis scripts (shellcode detection and stack pivoting detection) at <a href="https://securitycongress.euskalhack.org/">EuskalHack</a> Security Congress III earlier this year (<a href="https://github.com/Cisco-Talos/pyrebox/tree/master/docs/pyrebox_euskalhack.pdf">slides available</a>). This script monitors all the call and RET instructions executed under the context of a given process (in this case, the equation editor process), and maintains a shadow stack that keeps track of all the valid return addresses (those that follow every executed call instruction).<br><br>The only thing we need to do is configure the plugin to monitor the equation editor process (the plugin will wait for it to be created), and open the RTF document inside the emulated guest. PyREBox will stop the execution of the system whenever a RET instruction jumps into an address that is not preceded by a call instruction. This approach allows us to detect the exploitation of stack overflow bugs that overwrite the return address stored on the stack. Once the execution is stopped, PyREBox spawns an interactive IPython shell that allows us to inspect the system and debug and/or trace the execution of the equation editor process.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.talosintelligence.com/content/images/2022/12/image1-2.jpg" class="kg-image" alt loading="lazy" width="1999" height="676" srcset="https://blog.talosintelligence.com/content/images/size/w600/2022/12/image1-2.jpg 600w, https://blog.talosintelligence.com/content/images/size/w1000/2022/12/image1-2.jpg 1000w, https://blog.talosintelligence.com/content/images/size/w1600/2022/12/image1-2.jpg 1600w, https://blog.talosintelligence.com/content/images/2022/12/image1-2.jpg 1999w" sizes="(min-width: 720px) 720px"><figcaption>Figure 13 - PyREBox stops the execution the moment it detects the first return to an invalid address: 0x44fd22.</figcaption></figure><p>PyREBox will stop the execution on the return address at <em>0x00411874</em>, which belongs to the vulnerable function reported in CVE-2017-11882. In this case, the malware authors decided to leverage this vulnerability to overwrite the return address with an address contained in Equation Editor's main executable module: <em>0x0044fd22</em>. If we examine this address (see Figure 13), we see that it points to another RET instruction that will pop another address from the stack and jump into it. The shadow stack plugin detects this situation again, and stops the execution on the next step of the exploit.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.talosintelligence.com/content/images/2022/12/image5-1.jpg" class="kg-image" alt loading="lazy" width="1892" height="680" srcset="https://blog.talosintelligence.com/content/images/size/w600/2022/12/image5-1.jpg 600w, https://blog.talosintelligence.com/content/images/size/w1000/2022/12/image5-1.jpg 1000w, https://blog.talosintelligence.com/content/images/size/w1600/2022/12/image5-1.jpg 1600w, https://blog.talosintelligence.com/content/images/2022/12/image5-1.jpg 1892w" sizes="(min-width: 720px) 720px"><figcaption>Figure 14 — First stage of the shellcode.</figcaption></figure><p>Figure 14 shows the first stage of the shellcode, which is executed right after the second RET. This shellcode will call to GlobalLock function (<em>0x18f36e</em>) and afterward, will jump into a second buffer containing the second stage of the shellcode.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.talosintelligence.com/content/images/2022/12/image25.jpg" class="kg-image" alt loading="lazy" width="1676" height="1742" srcset="https://blog.talosintelligence.com/content/images/size/w600/2022/12/image25.jpg 600w, https://blog.talosintelligence.com/content/images/size/w1000/2022/12/image25.jpg 1000w, https://blog.talosintelligence.com/content/images/size/w1600/2022/12/image25.jpg 1600w, https://blog.talosintelligence.com/content/images/2022/12/image25.jpg 1676w" sizes="(min-width: 720px) 720px"><figcaption>Figure 15 - Start of the second stage of the shellcode.</figcaption></figure><p>The second stage of the shellcode consists of a sequence of <em>jmp/call</em> instructions followed by a decryption loop.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.talosintelligence.com/content/images/2022/12/image19-1.jpg" class="kg-image" alt loading="lazy" width="1288" height="1434" srcset="https://blog.talosintelligence.com/content/images/size/w600/2022/12/image19-1.jpg 600w, https://blog.talosintelligence.com/content/images/size/w1000/2022/12/image19-1.jpg 1000w, https://blog.talosintelligence.com/content/images/2022/12/image19-1.jpg 1288w" sizes="(min-width: 720px) 720px"><figcaption>Figure 16 - Decryption loop of the second stage of the shellcode.</figcaption></figure><p>This decryption loop will unpack the final payload of the shellcode, and finally jump into this decoded buffer. PyREBox allows us to dump the memory buffer containing the shellcode at any point during the execution. There are several ways to achieve this, but one possible way is to use the volatility framework (which is available through the PyREBox shell) to list the VAD regions in the process and dump the buffer containing the interesting code. This buffer can then be imported into IDA Pro for a deeper analysis.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.talosintelligence.com/content/images/2022/12/image21.jpg" class="kg-image" alt loading="lazy" width="715" height="1999" srcset="https://blog.talosintelligence.com/content/images/size/w600/2022/12/image21.jpg 600w, https://blog.talosintelligence.com/content/images/2022/12/image21.jpg 715w"><figcaption>Figure 17 — Decrypted buffer of the second stage (final stage of the shellcode).</figcaption></figure><p>This final stage of the shellcode is quite straightforward. It leverages standard techniques to find the <em>kernel32.dll</em> module in the linked list of loaded modules available in the PEB, and afterward, will parse its export table to locate the <em>LoadLibrary</em> and <em>GetProcAddress</em> functions. By using these functions, the script resolves several API functions (<em>ExpandEnvironmentStrings</em>, <em>URLDownloadToFileA</em>, and <em>ShellExecute</em>) to download and execute the <em>xyz.123</em> binary from the URL, which we have already seen in the Threat Grid analysis. The shellcode starts this executable with the name "<em>scvhost.exe</em>," which we have also seen before in the Threat Grid report.<br><br>We have also seen several other campaigns using the exact same infection chain, but delivering Loki as the final payload. We list these in the IOC sections. </p><h4 id="payload-details">Payload details</h4><p>Let's look into the final payload file "<em>xyz.123</em>" (<em>a8ac66acd22d1e194a05c09a3dc3d98a78ebcc2914312cdd647bc209498564d8</em>) or "<em>scvhost.exe</em>" if you prefer the process name from above. <br><br><em>$ file xyz123.exe</em><br><br>xyz123.exe: PE32 executable (GUI) Intel 80386 Mono/.Net assembly, for MS Windows<br><br>Loading the file into <a href="https://github.com/0xd4d/dnSpy">dnSpy</a> — a .NET assembly editor, decompiler and debugger — confirms that it's a .NET executable that's heavily obfuscated.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.talosintelligence.com/content/images/2022/12/image10-2.jpg" class="kg-image" alt loading="lazy" width="1076" height="1177" srcset="https://blog.talosintelligence.com/content/images/size/w600/2022/12/image10-2.jpg 600w, https://blog.talosintelligence.com/content/images/size/w1000/2022/12/image10-2.jpg 1000w, https://blog.talosintelligence.com/content/images/2022/12/image10-2.jpg 1076w" sizes="(min-width: 720px) 720px"><figcaption>Figure 18 - xyz123.exe.</figcaption></figure><p>The execution starts at the class constructor (cctor) executing the <br>&lt;Module&gt;.ҭъЩӂӬҀУ\u0486\u0489їҒреӱҤЫѝйҹП()method. It loads a large array into memory and decodes it. The rest of the cctor reconstructs a <em>xs.dll</em> and other code from the array and proceeds at the entry point with additional routines. At the end, it jumps by calling the <em>P.M()</em> method into the <em>xs.dll</em>.  </p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.talosintelligence.com/content/images/2022/12/image3-3.jpg" class="kg-image" alt loading="lazy" width="1442" height="743" srcset="https://blog.talosintelligence.com/content/images/size/w600/2022/12/image3-3.jpg 600w, https://blog.talosintelligence.com/content/images/size/w1000/2022/12/image3-3.jpg 1000w, https://blog.talosintelligence.com/content/images/2022/12/image3-3.jpg 1442w" sizes="(min-width: 720px) 720px"><figcaption>Figure 19 - P.M() method.</figcaption></figure><p>This one is interesting because it presents us a well-known artifact that shows that the assembly was obfuscated with the <a href="https://secureteam.net/acode-features-detailed">Agile.Net obfuscator</a>.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.talosintelligence.com/content/images/2022/12/image14-1.jpg" class="kg-image" alt loading="lazy" width="1574" height="938" srcset="https://blog.talosintelligence.com/content/images/size/w600/2022/12/image14-1.jpg 600w, https://blog.talosintelligence.com/content/images/size/w1000/2022/12/image14-1.jpg 1000w, https://blog.talosintelligence.com/content/images/2022/12/image14-1.jpg 1574w" sizes="(min-width: 720px) 720px"><figcaption>Figure 20 - Agile.Net obfuscator artifact.</figcaption></figure><p>Since there is no custom obfuscation, we can just execute the file, wait a while, and dump it via <a href="https://github.com/CodeCracker-Tools/MegaDumper">Megadumper</a>, a tool that dumps .NET executables directly from memory. This already looks much better.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.talosintelligence.com/content/images/2022/12/image2-1.jpg" class="kg-image" alt loading="lazy" width="1789" height="962" srcset="https://blog.talosintelligence.com/content/images/size/w600/2022/12/image2-1.jpg 600w, https://blog.talosintelligence.com/content/images/size/w1000/2022/12/image2-1.jpg 1000w, https://blog.talosintelligence.com/content/images/size/w1600/2022/12/image2-1.jpg 1600w, https://blog.talosintelligence.com/content/images/2022/12/image2-1.jpg 1789w" sizes="(min-width: 720px) 720px"><figcaption>Figure 21 - Deobfuscated code step one.</figcaption></figure><p>Unfortunately, the obfuscator has encrypted all strings with the H.G() method and we cannot see the content of those strings. </p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.talosintelligence.com/content/images/2022/12/image6-1.jpg" class="kg-image" alt loading="lazy" width="1477" height="775" srcset="https://blog.talosintelligence.com/content/images/size/w600/2022/12/image6-1.jpg 600w, https://blog.talosintelligence.com/content/images/size/w1000/2022/12/image6-1.jpg 1000w, https://blog.talosintelligence.com/content/images/2022/12/image6-1.jpg 1477w" sizes="(min-width: 720px) 720px"><figcaption>Figure 22 - H.G() method</figcaption></figure><p>Luckily, the de4dot .NET deobfuscator tool kills this with one command. We just need to tell it which method in the sample is used to decrypt the strings at runtime. This is done by handing over the Token from the corresponding method, in this case, <em>0x06000001</em>. De4dot has an issue with auto-detecting the Agile .NETobfuscator, so we have to hand over this function via the '-p' option.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.talosintelligence.com/content/images/2022/12/image20-1.jpg" class="kg-image" alt loading="lazy" width="1396" height="252" srcset="https://blog.talosintelligence.com/content/images/size/w600/2022/12/image20-1.jpg 600w, https://blog.talosintelligence.com/content/images/size/w1000/2022/12/image20-1.jpg 1000w, https://blog.talosintelligence.com/content/images/2022/12/image20-1.jpg 1396w" sizes="(min-width: 720px) 720px"><figcaption>Figure 23 - de4dot .NET deobfuscator.</figcaption></figure><p>Even if it looks like the operation failed, it has successfully replaced all obfuscated strings and recovered them, as we can see below.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.talosintelligence.com/content/images/2022/12/image16-2.jpg" class="kg-image" alt loading="lazy" width="1469" height="724" srcset="https://blog.talosintelligence.com/content/images/size/w600/2022/12/image16-2.jpg 600w, https://blog.talosintelligence.com/content/images/size/w1000/2022/12/image16-2.jpg 1000w, https://blog.talosintelligence.com/content/images/2022/12/image16-2.jpg 1469w" sizes="(min-width: 720px) 720px"><figcaption>Figure 24 - Decoded strings.</figcaption></figure><p>Examining the source code shows us that the adversaries are using an information stealer/RAT sold by a company selling grayware products: <a href="https://www.agenttesla.com/">Agent Tesla</a>. Agent Tesla contains a number of questionable functions, such as password stealing, screen capturing and the ability to download additional malware. However, the sellers of this product say that it is used for password recovery and child monitoring. </p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.talosintelligence.com/content/images/2022/12/image28.jpg" class="kg-image" alt loading="lazy" width="1999" height="1402" srcset="https://blog.talosintelligence.com/content/images/size/w600/2022/12/image28.jpg 600w, https://blog.talosintelligence.com/content/images/size/w1000/2022/12/image28.jpg 1000w, https://blog.talosintelligence.com/content/images/size/w1600/2022/12/image28.jpg 1600w, https://blog.talosintelligence.com/content/images/2022/12/image28.jpg 1999w" sizes="(min-width: 720px) 720px"><figcaption>Figure 25 - Sample of password stealing methods.</figcaption></figure><p>The malware comes with password-stealing routines for more than 25 common applications and other rootkit functions such as keylogging, clipboard stealing, screenshots and webcam access. Passwords are stolen from the following applications, among others:</p><ul><li>Chrome</li><li>Firefox</li><li>Internet Explorer</li><li>Yandex</li><li>Opera</li><li>Outlook</li><li>Thunderbird</li><li>IncrediMail</li><li>Eudora</li><li>FileZilla</li><li>WinSCP</li><li>FTP Navigator</li><li>Paltalk</li><li>Internet Download Manager</li><li>JDownloader</li><li>Apple keychain</li><li>SeaMonkey</li><li>Comodo Dragon</li><li>Flock</li><li>DynDNS</li></ul><p>This version comes with routines for SMTP, FTP and HTTP exfiltration, but is using only the HTTP POST one which you can see in figure 26 below. The decision as to which exfiltration method is used is hardcoded in a variable stored in the configuration, which is checked in almost all methods like this:<br><br><em>if (Operators.CompareString(_P.Exfil, "webpanel", false) == 0)</em><br><em>...</em><br><em>else if (Operators.CompareString(_P.Exfil, "smtp", false) == 0)</em><br><em>...</em><br><em>else if (Operators.CompareString(_P.Exfil, "ftp", false) == 0)</em></p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.talosintelligence.com/content/images/2022/12/image24.jpg" class="kg-image" alt loading="lazy" width="1781" height="886" srcset="https://blog.talosintelligence.com/content/images/size/w600/2022/12/image24.jpg 600w, https://blog.talosintelligence.com/content/images/size/w1000/2022/12/image24.jpg 1000w, https://blog.talosintelligence.com/content/images/size/w1600/2022/12/image24.jpg 1600w, https://blog.talosintelligence.com/content/images/2022/12/image24.jpg 1781w" sizes="(min-width: 720px) 720px"><figcaption>Figure 26 - HTTP exfiltration routine.</figcaption></figure><p>For example, it creates the POST request string, as you can see below in figure 27.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.talosintelligence.com/content/images/2022/12/image26.jpg" class="kg-image" alt loading="lazy" width="1908" height="549" srcset="https://blog.talosintelligence.com/content/images/size/w600/2022/12/image26.jpg 600w, https://blog.talosintelligence.com/content/images/size/w1000/2022/12/image26.jpg 1000w, https://blog.talosintelligence.com/content/images/size/w1600/2022/12/image26.jpg 1600w, https://blog.talosintelligence.com/content/images/2022/12/image26.jpg 1908w" sizes="(min-width: 720px) 720px"><figcaption>Figure 27 - POST request.</figcaption></figure><p>Then, it encrypts it with 3DES before sending it (figure 28). The _P.Y (<em>"0295A...1618C"</em>) method in figure 26 creates the MD5 hash of the string. This hash is used as secret for the 3DES encryption.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.talosintelligence.com/content/images/2022/12/image23.jpg" class="kg-image" alt loading="lazy" width="1249" height="614" srcset="https://blog.talosintelligence.com/content/images/size/w600/2022/12/image23.jpg 600w, https://blog.talosintelligence.com/content/images/size/w1000/2022/12/image23.jpg 1000w, https://blog.talosintelligence.com/content/images/2022/12/image23.jpg 1249w" sizes="(min-width: 720px) 720px"><figcaption>Figure 28 - 3DES Encryption method</figcaption></figure><h3 id="conclusion"><br>Conclusion</h3><p>This is a highly effective malware campaign that is able to avoid detection by most antivirus applications. Therefore, it is necessary to have additional tools such as Threat Grid to defend your organization from these kinds of threats.<br><br>The actor behind this malware used the RTF standard because of its complexity, and used a modified exploit of a Microsoft Office vulnerability to download Agent Tesla and other malware. It is not completely clear if the actor changed the exploit manually, or if they used a tool to produce the shellcode. Either way, this shows that the actor or their tools have ability to modify the assembler code in such a way that the resulting opcode bytes look completely different, but still exploit the same vulnerability. This is a technique that could very well be used to deploy other malware in a stealthy way in the future.</p><h4 id="ioc">IOC</h4><p><br><strong>Maldocs</strong><br>cf193637626e85b34a7ccaed9e4459b75605af46cedc95325583b879990e0e61 - 3027748749.rtf<br><br>A8ac66acd22d1e194a05c09a3dc3d98a78ebcc2914312cdd647bc209498564d8 - xyz.123<br><br>38fa057674b5577e33cee537a0add3e4e26f83bc0806ace1d1021d5d110c8bb2 -         Proforma_Invoice_AMC18.docx<br><br>4fa7299ba750e4db0a18001679b4a23abb210d4d8e6faf05ce2cbe2586aff23f - Proforma_Invoice_AMC19.docx<br><br>1dd34c9e89e5ce7a3740eedf05e74ef9aad1cd6ce7206365f5de78a150aa9398 - HSBC8117695310_doc<br><br><br><strong>Distribution Domains</strong><br>avast[.]dongguanmolds[.]com<br>avast[.]aandagroupbd[.]website<br><br><br><strong>Loki related samples from hxxp://avast[.]dongguanmolds[.]com</strong><br>a8ac66acd22d1e194a05c09a3dc3d98a78ebcc2914312cdd647bc209498564d8 - xyz.123 <br><br>5efab642326ea8f738fe1ea3ae129921ecb302ecce81237c44bf7266bc178bff - xyz.123<br><br>55607c427c329612e4a3407fca35483b949fc3647f60d083389996d533a77bc7 - xyz.123<br><br>992e8aca9966c1d42ff66ecabacde5299566e74ecb9d146c746acc39454af9ae - xyz.123<br><br>1dd34c9e89e5ce7a3740eedf05e74ef9aad1cd6ce7206365f5de78a150aa9398 - HSBC8117695310.doc<br><br>d9f1d308addfdebaa7183ca180019075c04cd51a96b1693a4ebf6ce98aadf678 - plugin.wbk <br><br><br><strong>Loki related URLs:</strong><br>hxxp://46[.]166[.]133[.]164/0x22/fre.php<br>hxxp://alphastand[.]top/alien/fre.php<br>hxxp://alphastand[.]trade/alien/fre.php<br>hxxp://alphastand[.]win/alien/fre.php<br>hxxp://kbfvzoboss[.]bid/alien/fre.php<br>hxxp://logs[.]biznetviigator[.]com/0x22/fre.php<br><br><br><strong>Other related samples</strong><br>1dd34c9e89e5ce7a3740eedf05e74ef9aad1cd6ce7206365f5de78a150aa9398<br>7c9f8316e52edf16dde86083ee978a929f4c94e3e055eeaef0ad4edc03f4a625<br>8b779294705a84a34938de7b8041f42b92c2d9bcc6134e5efed567295f57baf9<br>996c88f99575ab5d784ad3b9fa3fcc75c7450ea4f9de582ce9c7b3d147f7c6d5<br>dcab4a46f6e62cfaad2b8e7b9d1d8964caaadeca15790c6e19b9a18bc3996e18</p>
        </div>
    </section>
    <div class="social-media-wrapper">
    <h5>Share this post</h5>
    <ul class="social-media-share-list">
        <li>
            <a class="share-facebook" title="Share this on Facebook" data-text="Old dog, new tricks - Analysing new RTF-based campaign distributing Agent Tesla, Loki with PyREbox" data-href="https://blog.talosintelligence.com/old-dog-new-tricks-analysing-new-rtf_15/" rel="nofollow" target="_blank" href="https://www.facebook.com/sharer.php?u=https://blog.talosintelligence.com/old-dog-new-tricks-analysing-new-rtf_15/"></a>
        </li>
        <li>
            <a class="share-x" title="Post This" data-text="Old dog, new tricks - Analysing new RTF-based campaign distributing Agent Tesla, Loki with PyREbox" data-href="https://blog.talosintelligence.com/old-dog-new-tricks-analysing-new-rtf_15/" rel="nofollow" target="_blank" href="https://x.com/share?url=https://blog.talosintelligence.com/old-dog-new-tricks-analysing-new-rtf_15/"></a>
        </li>
        <li>
            <a class="share-linkedin" title="Share this on LinkedIn" data-text="Old dog, new tricks - Analysing new RTF-based campaign distributing Agent Tesla, Loki with PyREbox" data-href="https://blog.talosintelligence.com/old-dog-new-tricks-analysing-new-rtf_15/" rel="nofollow" target="_blank" href="https://www.linkedin.com/sharing/share-offsite/?url=https://blog.talosintelligence.com/old-dog-new-tricks-analysing-new-rtf_15/"></a>
        </li>
        <li>
            <a class="share-reddit" title="Reddit This" data-text="Old dog, new tricks - Analysing new RTF-based campaign distributing Agent Tesla, Loki with PyREbox" data-href="https://blog.talosintelligence.com/old-dog-new-tricks-analysing-new-rtf_15/" rel="nofollow" target="_blank" href="https://www.reddit/submit?url=https://blog.talosintelligence.com/old-dog-new-tricks-analysing-new-rtf_15/"></a>
        </li>
        <li>
            <a class="share-email" title="Email This" href="mailto:?body=Old dog, new tricks - Analysing new RTF-based campaign distributing Agent Tesla, Loki with PyREboxhttps://blog.talosintelligence.com/old-dog-new-tricks-analysing-new-rtf_15/"></a>
        </li>
    </ul>
</div></article>
                    </div>
                </div>
                <div class="col-lg alt-layout-row-dk sidebar" id="side-bar">
                </div>
            </div>
        </div>
    </main>


    <footer id="footer">
    <div class="row footer_nav_wrapper">
        <div class="col-xl-10 col-12">
            <div class="multi-col-list-wrapper">
                <ul class="footer-parent-list">
                    <li class="footer-links-group">
                        <ul>
                            <li>
                                <h6>Intelligence Center</h6>
                            </li>
                            <li><a href="https://talosintelligence.com/reputation_center">Intelligence Search</a></li>
                            <li><a href="https://talosintelligence.com/reputation_center/email_rep">Email &amp; Spam Trends</a></li>
                        </ul>
                    </li>
                    <li class="footer-links-group">
                        <ul>
                            <li>
                                <h6>Vulnerability Research</h6>
                            </li>
                            <li><a href="https://talosintelligence.com/vulnerability_info">Vulnerability Reports</a></li>
                            <li><a href="https://talosintelligence.com/ms_advisories">Microsoft Advisories</a></li>
                        </ul>
                    </li>
                    <li class="footer-links-group">
                        <ul>
                            <li>
                                <h6>Incident Response</h6>
                            </li>
                            <li>
                                <a href="https://talosintelligence.com/incident_response">Talos IR Capabilities</a></li>
                            <li>
                                <a href="https://talosintelligence.com/incident_response">Emergency Support</a>
                            </li>

                        </ul>
                    </li>
                    <li class="footer-links-group">
                        <ul>
                            <li>
                                <h6>Security Resources</h6>
                            </li>
                            <li><a href="https://talosintelligence.com/software">Open Source Security Tools</a></li>
                            <li><a href="https://talosintelligence.com/categories">Intelligence Categories Reference</a></li>
                            <li><a href="https://talosintelligence.com/secure-endpoint-naming">Secure Endpoint Naming Reference</a></li>
                        </ul>
                    </li>
                    <li class="footer-links-group">
                        <ul>
                            <li>
                                <h6>Media</h6>
                            </li>
                            <li><a href="https://blog.talosintelligence.com">Talos Intelligence Blog</a></li>
                            <li><a href="https://blog.talosintelligence.com/category/threat-source-newsletter/">Threat Source Newsletter</a></li>
                            <li><a href="https://talosintelligence.com/podcasts/shows/beers_with_talos">Beers with Talos Podcast</a></li>
                            <li><a href="https://talosintelligence.com/podcasts/shows/talos_takes">Talos Takes Podcast</a></li>
                            <li><a target="_blank" href="https://www.youtube.com/channel/UCPZ1DtzQkStYBSG3GTNoyfg/featured">Talos Videos</a></li>
                        </ul>
                    </li>
                    <li class="footer-links-group">
                        <ul>
                            <li>
                                <h6>Support</h6>
                            </li>
                            <li><a href="https://support.talosintelligence.com">Support Documentation</a></li>
                        </ul>
                    </li>
                    <li class="footer-links-group">
                        <ul>
                            <li>
                                <h6>Company</h6>
                            </li>
                            <li><a href="https://talosintelligence.com/about">About Talos</a></li>
                            <li><a href="https://talosintelligence.com/careers">Careers</a></li>
                            <li><a target="_blank" href="https://www.cisco.com/c/en/us/products/security/product-listing.html">Cisco Security</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
        <div class="col-xl-2 col-12 connect_social">
            <div class="connect-footer-section-wrapper">
                <h6>Follow us</h6>
                <ul>
                    <li>
                        <a target="_blank" href="https://x.com/talossecurity"><div class="footer-media-icon" id="footer-media-icon-x"></div>
                        </a></li>
                    <li>
                        <a target="_blank" href="https://www.youtube.com/channel/UCPZ1DtzQkStYBSG3GTNoyfg/featured"><div class="footer-media-icon" id="footer-media-icon-youtube"></div>
                        </a></li>
                    <li>
                        <a target="_blank" href="https://www.linkedin.com/company/cisco-talos-intelligence-group/"><div class="footer-media-icon" id="footer-media-icon-linkedin"></div>
                        </a></li>
                </ul>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-12 footer_corporate">
            <a target="_blank" href="http://tools.cisco.com/security/center/home.x"><img alt="Cisco" src="../assets/images/logo_cisco_white.svg">
            </a><p class="copyright">
            ©
            2024
            Cisco Systems, Inc. and/or its affiliates. All rights
            reserved. View our
            <a target="_blank" class="underline" href="http://www.cisco.com/web/siteassets/legal/privacy_full.html">Privacy Policy.</a>
        </p>
        </div>
    </div>
</footer>
    


<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="https://blog.talosintelligence.com/assets/js/jquery-3.6.0.min.js?v=d7eb88ed59"></script>
<script src="https://blog.talosintelligence.com/assets/js/popper.min.js?v=d7eb88ed59"></script>
<script src="https://blog.talosintelligence.com/assets/js/bootstrap.bundle.min.js?v=d7eb88ed59"></script>
<script src="https://blog.talosintelligence.com/assets/js/date.js?v=d7eb88ed59"></script>
<script src="https://blog.talosintelligence.com/assets/js/prism.js?v=d7eb88ed59"></script>
<script src="https://cdn.jsdelivr.net/npm/ghost-theme-utils@latest/dist/js/ghost-theme-utils.min.js" async defer></script>


</body>

</html>