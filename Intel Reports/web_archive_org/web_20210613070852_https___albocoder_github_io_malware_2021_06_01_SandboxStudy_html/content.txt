<!DOCTYPE html>
<head><script src="//archive.org/includes/athena.js" type="text/javascript"></script>
<script type="text/javascript">window.addEventListener('DOMContentLoaded',function(){var v=archive_analytics.values;v.service='wb';v.server_name='wwwb-app216.us.archive.org';v.server_ms=409;archive_analytics.send_pageview({});});</script>
<script type="text/javascript" src="/_static/js/bundle-playback.js?v=HxkREWBo" charset="utf-8"></script>
<script type="text/javascript" src="/_static/js/wombat.js?v=txqj7nKC" charset="utf-8"></script>
<script>window.RufflePlayer=window.RufflePlayer||{};window.RufflePlayer.config={"autoplay":"on","unmuteOverlay":"hidden"};</script>
<script type="text/javascript" src="/_static/js/ruffle/ruffle.js"></script>
<script type="text/javascript">
    __wm.init("https://web.archive.org/web");
  __wm.wombat("https://albocoder.github.io/malware/2021/06/01/SandboxStudy.html","20210613070852","https://web.archive.org/","web","/_static/",
	      "1623568132");
</script>
<link rel="stylesheet" type="text/css" href="/_static/css/banner-styles.css?v=S1zqJCYt" />
<link rel="stylesheet" type="text/css" href="/_static/css/iconochive.css?v=3PDvdIFv" />
<!-- End Wayback Rewrite JS Include -->

  <link rel="shortcut icon" type="image/png" href="/web/20210613070852im_/https://albocoder.github.io/assets/images/favicon.ico">
</head>

<!-- BEGIN WAYBACK TOOLBAR INSERT -->
<script>__wm.rw(0);</script>
<div id="wm-ipp-base" lang="en" style="display:none;direction:ltr;">
<div id="wm-ipp" style="position:fixed;left:0;top:0;right:0;">
<div id="donato" style="position:relative;width:100%;">
  <div id="donato-base">
    <iframe id="donato-if" src="https://archive.org/includes/donate.php?as_page=1&amp;platform=wb&amp;referer=https%3A//web.archive.org/web/20210613070852/https%3A//albocoder.github.io/malware/2021/06/01/SandboxStudy.html"
	    scrolling="no" frameborder="0" style="width:100%; height:100%">
    </iframe>
  </div>
</div><div id="wm-ipp-inside">
  <div id="wm-toolbar" style="position:relative;display:flex;flex-flow:row nowrap;justify-content:space-between;">
    <div id="wm-logo" style="/*width:110px;*/padding-top:12px;">
      <a href="/web/" title="Wayback Machine home page"><img src="/_static/images/toolbar/wayback-toolbar-logo-200.png" srcset="/_static/images/toolbar/wayback-toolbar-logo-100.png, /_static/images/toolbar/wayback-toolbar-logo-150.png 1.5x, /_static/images/toolbar/wayback-toolbar-logo-200.png 2x" alt="Wayback Machine" style="width:100px" border="0" /></a>
    </div>
    <div class="c" style="display:flex;flex-flow:column nowrap;justify-content:space-between;flex:1;">
      <form class="u" style="display:flex;flex-direction:row;flex-wrap:nowrap;" target="_top" method="get" action="/web/submit" name="wmtb" id="wmtb"><input type="text" name="url" id="wmtbURL" value="https://albocoder.github.io/malware/2021/06/01/SandboxStudy.html" onfocus="this.focus();this.select();" style="flex:1;"/><input type="hidden" name="type" value="replay" /><input type="hidden" name="date" value="20210613070852" /><input type="submit" value="Go" />
      </form>
      <div style="display:flex;flex-flow:row nowrap;align-items:flex-end;">
                <div class="s" id="wm-nav-captures" style="flex:1;">
                    <a class="t" href="/web/20210613070852*/https://albocoder.github.io/malware/2021/06/01/SandboxStudy.html" title="See a list of every capture for this URL">4 captures</a>
          <div class="r" title="Timespan for captures of this URL">13 Jun 2021 - 18 Sep 2024</div>
          </div>
        <div class="k">
          <a href="" id="wm-graph-anchor">
            <div id="wm-ipp-sparkline" title="Explore captures for this URL" style="position: relative">
              <canvas id="wm-sparkline-canvas" width="725" height="27" border="0"></canvas>
            </div>
          </a>
        </div>
      </div>
    </div>
    <div class="n">
      <table>
        <tbody>
          <!-- NEXT/PREV MONTH NAV AND MONTH INDICATOR -->
          <tr class="m">
            <td class="b" nowrap="nowrap">May</td>
            <td class="c" id="displayMonthEl" title="You are here: 07:08:52 Jun 13, 2021">JUN</td>
            <td class="f" nowrap="nowrap"><a href="https://web.archive.org/web/20240918005120/http://albocoder.github.io/malware/2021/06/01/SandboxStudy.html" title="18 Sep 2024"><strong>Sep</strong></a></td>
          </tr>
          <!-- NEXT/PREV CAPTURE NAV AND DAY OF MONTH INDICATOR -->
          <tr class="d">
            <td class="b" nowrap="nowrap"><img src="/_static/images/toolbar/wm_tb_prv_off.png" alt="Previous capture" width="14" height="16" border="0" /></td>
            <td class="c" id="displayDayEl" style="width:34px;font-size:22px;white-space:nowrap;" title="You are here: 07:08:52 Jun 13, 2021">13</td>
            <td class="f" nowrap="nowrap"><a href="https://web.archive.org/web/20210626082616/https://albocoder.github.io/malware/2021/06/01/SandboxStudy.html" title="08:26:16 Jun 26, 2021"><img src="/_static/images/toolbar/wm_tb_nxt_on.png" alt="Next capture" width="14" height="16" border="0" /></a></td>
          </tr>
          <!-- NEXT/PREV YEAR NAV AND YEAR INDICATOR -->
          <tr class="y">
            <td class="b" nowrap="nowrap">2020</td>
            <td class="c" id="displayYearEl" title="You are here: 07:08:52 Jun 13, 2021">2021</td>
            <td class="f" nowrap="nowrap"><a href="https://web.archive.org/web/20240918005120/http://albocoder.github.io/malware/2021/06/01/SandboxStudy.html" title="18 Sep 2024"><strong>2024</strong></a></td>
          </tr>
        </tbody>
      </table>
    </div>
    <div class="r" style="display:flex;flex-flow:column nowrap;align-items:flex-end;justify-content:space-between;">
      <div id="wm-btns" style="text-align:right;height:23px;">
                <span class="xxs">
          <div id="wm-save-snapshot-success">success</div>
          <div id="wm-save-snapshot-fail">fail</div>
          <a id="wm-save-snapshot-open" href="#" title="Share via My Web Archive" >
            <span class="iconochive-web"></span>
          </a>
          <a href="https://archive.org/account/login.php" title="Sign In" id="wm-sign-in">
            <span class="iconochive-person"></span>
          </a>
          <span id="wm-save-snapshot-in-progress" class="iconochive-web"></span>
        </span>
                <a class="xxs" href="http://faq.web.archive.org/" title="Get some help using the Wayback Machine" style="top:-6px;"><span class="iconochive-question" style="color:rgb(87,186,244);font-size:160%;"></span></a>
        <a id="wm-tb-close" href="#close" style="top:-2px;" title="Close the toolbar"><span class="iconochive-remove-circle" style="color:#888888;font-size:240%;"></span></a>
      </div>
      <div id="wm-share" class="xxs">
        <a href="/web/20210613070852/http://web.archive.org/screenshot/https://albocoder.github.io/malware/2021/06/01/SandboxStudy.html"
           id="wm-screenshot"
           title="screenshot">
          <span class="wm-icon-screen-shot"></span>
        </a>
        <a href="#" id="wm-video" title="video">
          <span class="iconochive-movies"></span>
        </a>
        <a id="wm-share-facebook" href="#" data-url="https://web.archive.org/web/20210613070852/https://albocoder.github.io/malware/2021/06/01/SandboxStudy.html" title="Share on Facebook" style="margin-right:5px;" target="_blank"><span class="iconochive-facebook" style="color:#3b5998;font-size:160%;"></span></a>
        <a id="wm-share-twitter" href="#" data-url="https://web.archive.org/web/20210613070852/https://albocoder.github.io/malware/2021/06/01/SandboxStudy.html" title="Share on Twitter" style="margin-right:5px;" target="_blank"><span class="iconochive-twitter" style="color:#1dcaff;font-size:160%;"></span></a>
      </div>
      <div style="padding-right:2px;text-align:right;white-space:nowrap;">
        <a id="wm-expand" class="wm-btn wm-closed" href="#expand"><span id="wm-expand-icon" class="iconochive-down-solid"></span> <span class="xxs" style="font-size:80%;">About this capture</span></a>
      </div>
    </div>
  </div>
    <div id="wm-capinfo" style="border-top:1px solid #777;display:none; overflow: hidden">
        <div id="wm-capinfo-notice" source="api"></div>
                <div id="wm-capinfo-collected-by">
    <div style="background-color:#666;color:#fff;font-weight:bold;text-align:center">COLLECTED BY</div>
    <div style="padding:3px;position:relative" id="wm-collected-by-content">
            <div style="display:inline-block;vertical-align:top;width:50%;">
			<span class="c-logo" style="background-image:url(https://archive.org/services/img/archiveteam);"></span>
		Organization: <a style="color:#33f;" href="https://archive.org/details/archiveteam" target="_new"><span class="wm-title">Archive Team</span></a>
		<div style="max-height:75px;overflow:hidden;position:relative;">
	  <div style="position:absolute;top:0;left:0;width:100%;height:75px;background:linear-gradient(to bottom,rgba(255,255,255,0) 0%,rgba(255,255,255,0) 90%,rgba(255,255,255,255) 100%);"></div>
	  <img align=right src="http://archiveteam.org/images/e/e6/Archiveteam.jpg" width=200> Formed in 2009, the Archive Team (not to be confused with the archive.org Archive-It Team) is a rogue archivist collective dedicated to saving copies of rapidly dying or deleted websites for the sake of history and digital heritage. The group is 100% composed of volunteers and interested parties, and has expanded into a large amount of related projects for saving online and digital history.
<p>
History is littered with hundreds of conflicts over the future of a community, group, location or business that were "resolved" when one of the parties stepped ahead and destroyed what was there. With the original point of contention destroyed, the debates would fall to the wayside. Archive Team believes that by duplicated condemned data, the conversation and debate can continue, as well as the richness and insight gained by keeping the materials. Our projects have ranged in size from a single volunteer downloading the data to a small-but-critical site, to over 100 volunteers stepping forward to acquire terabytes of user-created data to save for future generations.
<p>
The main site for Archive Team is at <a href="http://www.archiveteam.org">archiveteam.org</a> and contains up to the date information on various projects, manifestos, plans and walkthroughs.
<p>
This collection contains the output of many Archive Team projects, both ongoing and completed. Thanks to the generous providing of disk space by the Internet Archive, multi-terabyte datasets can be made available, as well as in use by the <a href="http://archive.org/web/web.php">Wayback Machine</a>, providing a path back to lost websites and work. 
<p>
Our collection has grown to the point of having sub-collections for the type of data we acquire. If you are seeking to browse the contents of these collections, the Wayback Machine is the best first stop. Otherwise, you are free to dig into the stacks to see what you may find.
<p>
<b>The Archive Team Panic Downloads</b> are full pulldowns of currently extant websites, meant to serve as emergency backups for needed sites that are in danger of closing, or which will be missed dearly if suddenly lost due to hard drive crashes or server failures. 
<p>
	</div>
	      </div>
      <div style="display:inline-block;vertical-align:top;width:49%;">
			<span class="c-logo" style="background-image:url(https://archive.org/services/img/archiveteam_urls)"></span>
		<div>Collection: <a style="color:#33f;" href="https://archive.org/details/archiveteam_urls" target="_new"><span class="wm-title">Archive Team: URLs</span></a></div>
	      </div>
    </div>
    </div>
    <div id="wm-capinfo-timestamps">
    <div style="background-color:#666;color:#fff;font-weight:bold;text-align:center" title="Timestamps for the elements of this page">TIMESTAMPS</div>
    <div>
      <div id="wm-capresources" style="margin:0 5px 5px 5px;max-height:250px;overflow-y:scroll !important"></div>
      <div id="wm-capresources-loading" style="text-align:left;margin:0 20px 5px 5px;display:none"><img src="/_static/images/loading.gif" alt="loading" /></div>
    </div>
    </div>
  </div></div></div></div><div id="wm-ipp-print">The Wayback Machine - https://web.archive.org/web/20210613070852/https://albocoder.github.io/malware/2021/06/01/SandboxStudy.html</div>
<script type="text/javascript">//<![CDATA[
__wm.bt(725,27,25,2,"web","https://albocoder.github.io/malware/2021/06/01/SandboxStudy.html","20210613070852",1996,"/_static/",["/_static/css/banner-styles.css?v=S1zqJCYt","/_static/css/iconochive.css?v=3PDvdIFv"], false);
  __wm.rw(1);
//]]></script>
<!-- END WAYBACK TOOLBAR INSERT -->
 <html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.7.1 -->
<title>Inside commercial malware sandboxes | Erin Avllazagaj</title>
<meta name="generator" content="Jekyll v3.9.0"/>
<meta property="og:title" content="Inside commercial malware sandboxes"/>
<meta name="author" content="Erin Avllazagaj"/>
<meta property="og:locale" content="en_US"/>
<link rel="canonical" href="https://web.archive.org/web/20210613070852/https://albocoder.github.io/malware/2021/06/01/SandboxStudy.html"/>
<meta property="og:url" content="https://web.archive.org/web/20210613070852/https://albocoder.github.io/malware/2021/06/01/SandboxStudy.html"/>
<meta property="og:site_name" content="Erin Avllazagaj"/>
<meta property="og:type" content="article"/>
<meta property="article:published_time" content="2021-06-01T00:00:00+00:00"/>
<meta name="twitter:card" content="summary"/>
<meta property="twitter:title" content="Inside commercial malware sandboxes"/>
<script type="application/ld+json">
{"dateModified":"2021-06-01T00:00:00+00:00","datePublished":"2021-06-01T00:00:00+00:00","mainEntityOfPage":{"@type":"WebPage","@id":"https://web.archive.org/web/20210613070852/https://albocoder.github.io/malware/2021/06/01/SandboxStudy.html"},"url":"https://web.archive.org/web/20210613070852/https://albocoder.github.io/malware/2021/06/01/SandboxStudy.html","@type":"BlogPosting","author":{"@type":"Person","name":"Erin Avllazagaj"},"headline":"Inside commercial malware sandboxes","@context":"https://web.archive.org/web/20210613070852/https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/web/20210613070852cs_/https://albocoder.github.io/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://web.archive.org/web/20210613070852/https://albocoder.github.io/feed.xml" title="Erin Avllazagaj"/><script>
if(!(window.doNotTrack === "1" || navigator.doNotTrack === "1" || navigator.doNotTrack === "yes" || navigator.msDoNotTrack === "1")) {
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://web.archive.org/web/20210613070852/https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'G-MLGRKHG0RE', 'auto');
  ga('send', 'pageview');
}
</script>
  
</head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/web/20210613070852/https://albocoder.github.io/">Erin Avllazagaj</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger"/>
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewbox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/web/20210613070852/https://albocoder.github.io/blog/">Blog</a><a class="page-link" href="/web/20210613070852/https://albocoder.github.io/cv/">CV</a><a class="page-link" href="/web/20210613070852/https://albocoder.github.io/publications/">Publications</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">Inside commercial malware sandboxes</h1>
    <p class="post-meta">
      <time class="dt-published" datetime="2021-06-01T00:00:00+00:00" itemprop="datePublished">Jun 1, 2021
      </time></p>
  </header>

  <div class="post-content e-content" itemprop="articleBody">
    <p><img src="https://web.archive.org/web/20210613070852im_/https://i.imgur.com/gzO8TuY.jpg" alt="Koro Sensei sandbox"/></p>

<h2 id="introduction">Introduction</h2>

<p>In this blog post I will explore the commercial malware sandboxes. It appears malware is <strong>allowed</strong> to access the internet in many sandboxes <img src="https://web.archive.org/web/20210613070852im_/https://cdn.betterttv.net/emote/5e9c6c187e090362f8b0b9e8/1x" alt="KEKW"/>. So with that access I decided to collect all the environmental features I could think of and send them to my discord channel. Since Python is the language with the largest library support ever (maybe?) I wrote a python script to take many environment features through <code class="language-plaintext highlighter-rouge">psutil</code>, <code class="language-plaintext highlighter-rouge">platform</code>, <code class="language-plaintext highlighter-rouge">cpuinfo</code> etc. The whole <a href="https://web.archive.org/web/20210613070852/https://gist.github.com/Albocoder/43827f62dceb0970d4810e3719b993d9"><em>python code</em></a> is here.</p>

<p>Then we use pyinstaller to create a single executable (~10 MB <img src="https://web.archive.org/web/20210613070852im_/https://cdn.betterttv.net/emote/5e4e7a1f08b4447d56a92967/1x" alt="PogO"/>) using a command like this: <code class="language-plaintext highlighter-rouge">pyinstaller --onefile --noupx sandbox-env-stealer.py</code>. Then for the sake of completeness we compressed the executable in the latest upx and uploaded to VirusTotal. After a few crashes we ended with <em>4</em> samples:</p>

<ul>
  <li><a href="https://web.archive.org/web/20210613070852/https://www.virustotal.com/gui/file/47ed17bdea1dab10fdee7f61dff8b8f33ad5d092b3e1e5f0f5a3522a27798183/detection">47ed17bdea1dab10fdee…</a></li>
  <li><a href="https://web.archive.org/web/20210613070852/https://www.virustotal.com/gui/file/07a783fc3ae6a065dc0bfad5e8f89ec3ae5be3bb1ec8ada6f774710399f65305/detection">07a783fc3ae6a065dc0b…</a></li>
  <li><a href="https://web.archive.org/web/20210613070852/https://www.virustotal.com/gui/file/e472c0493a9a35b7975ca2b5acb4663746993c55c6f2d94742d301d88f050e95/detection">e472c0493a9a35b7975c…</a></li>
  <li><a href="https://web.archive.org/web/20210613070852/https://www.virustotal.com/gui/file/88d38301327da310c5c00a0b3ae8209730e033f3c57575a447096d94a647e816/detection">88d38301327da310c5c0…</a> (disregard the file name <img src="https://web.archive.org/web/20210613070852im_/https://cdn.betterttv.net/emote/56e9f494fff3cc5c35e5287e/1x" alt="monkaS"/>)</li>
</ul>

<p>Of course, you can <a href="/web/20210613070852/https://albocoder.github.io/assets/misc/sandbox_reports.zip">download</a> the data I collected and play for yourself.</p>

<h2 id="experiment-setup">Experiment setup</h2>

<p>I submitted one of the first samples on <em>17/03/2020</em> (because corona lockdown was getting boring). Then life happened. After deciding to revisit this project I submitted the other 4 samples around March 2021. 
I collected the following features (some ommited for brevity):</p>

<ul>
  <li>Windows version + arch</li>
  <li>CPU name + core count</li>
  <li>local and internet IP address</li>
  <li>CPU counters</li>
  <li>disk partitions and counters</li>
</ul>

<h2 id="what-did-learn">What did learn?</h2>

<h3 id="os-version">OS version</h3>

<p>First, I noticed that <strong>78%</strong> of all the sandboxes run Windows 7 build 7601 (the most famous pirated version <img src="https://web.archive.org/web/20210613070852im_/https://cdn.betterttv.net/emote/59b73909b27c823d5b1f6052/1x" alt=""/>).
That accounts for 40 out of the 51 executions. The table below illustrates it all. As it seems, the only versions are Windows 7 (build 7600 and 7601) and some flavor of Windows 10.
A malware sample will have a high chance of being run on a real machine if the detected OS is anything but the following.</p>

<table>
  <thead>
    <tr>
      <th>OS version</th>
      <th># execs</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Win 7 build 7601</td>
      <td>40</td>
    </tr>
    <tr>
      <td>Win 10.0.18362</td>
      <td>3</td>
    </tr>
    <tr>
      <td>Win 7 build 7600</td>
      <td>3</td>
    </tr>
    <tr>
      <td>Win 10.0.14393</td>
      <td>3</td>
    </tr>
    <tr>
      <td>Win 10.0.17134</td>
      <td>2</td>
    </tr>
  </tbody>
</table>

<h3 id="timeline-analysis">Timeline analysis</h3>

<p>In this section I will analyze some runtime features of the sandboxes. Here there are some interesting features malware authors can use to quickly identify sandboxes.
There are also some lessons I learned from looking at the executions.</p>

<p>First off, I wanted to see how many executions we were getting per malware and how often. This is particularly important since in <a href="/web/20210613070852/https://albocoder.github.io/assets/pdf_files/malw_variability.pdf">our paper</a> we showed that a malware need to run in 3 random environments at least every 3 weeks.</p>

<p>It appears, for the oldest malware sample <strong>10</strong> executions appear on the same day as the submission, <strong>1</strong> execution 1 day later, <strong>3</strong> executions 33 days later and <strong>2</strong> executions 62 days later.
This means that the sample was deemed interesting 2 months from its first “appearance”.
However, we can’t conclude that this is what happens for all the samples, with different number of VT engine detections or with more interest from individual AV vendors.
For the record, I did get an execution report back from the first sample just yesterday, after clicking the “<em>reanalyze</em>” on VT <img src="https://web.archive.org/web/20210613070852im_/https://cdn.betterttv.net/emote/5ab6f0ece1d6391b63498774/1x" alt=""/>. 
Either way, the malware was executed about 2 to 3 times every month, which is close enough to 3 weeks (that we recommend in our paper), but we demonstrated in the paper that on average 1 week stale of data decreases the detection rate.</p>

<h3 id="environment-analysis">Environment analysis</h3>

<p>This sections will show some environment features that the malware can read.</p>

<h4 id="the-running-processes">The running processes</h4>

<p>A common routine seen on many malware and benign samples is that or iterating the running processes.
I (as in python libraries) use a similar routine to retrieve the running processes.
The table below shows some of the running processes and the number of machines they were seen to run on.
Something interesting we can see here are the “special” programs. In some machines we see the appearance of <code class="language-plaintext highlighter-rouge">bitcoin-qt.exe</code>, <code class="language-plaintext highlighter-rouge">infinium.exe</code> etc, while in some others we see <code class="language-plaintext highlighter-rouge">steam.exe</code>, <code class="language-plaintext highlighter-rouge">SteamService.exe</code> etc, in some others <code class="language-plaintext highlighter-rouge">filezilla.exe</code> or <code class="language-plaintext highlighter-rouge">centralcreditcard.exe</code>.
This is usually done to see if the malware is a crypto miner, a game hack, a file infector or a point-of-sale malware respectively.</p>

<div style="height:300px;overflow:auto;">
<table>
<tr><th>Processes</th><th>Number of machines</th></tr>

<tr><td>...</td><td>...</td></tr>

<tr><td>conhost.exe         </td><td>   47  </td></tr>
<tr><td>lsass.exe           </td><td>   46  </td></tr>
<tr><td>spoolsv.exe         </td><td>   46  </td></tr>
<tr><td>wininit.exe         </td><td>   46  </td></tr>
<tr><td>smss.exe            </td><td>   46  </td></tr>
<tr><td>System Idle Process </td><td>   46  </td></tr>
<tr><td>explorer.exe        </td><td>   46  </td></tr>
<tr><td>winlogon.exe        </td><td>   46  </td></tr>
<tr><td>System              </td><td>   46  </td></tr>
<tr><td>services.exe        </td><td>   46  </td></tr>
<tr><td>opera.exe           </td><td>   43  </td></tr>
<tr><td>firefox.exe         </td><td>   43  </td></tr>
<tr><td>dwm.exe             </td><td>   41  </td></tr>
<tr><td>lsm.exe             </td><td>   40  </td></tr>
<tr><td>Skype.exe           </td><td>   29  </td></tr>
<tr><td>OSPPSVC.EXE         </td><td>   27  </td></tr>
<tr><td>taskeng.exe         </td><td>   24  </td></tr>

<tr><td>...</td><td>...</td></tr>

<tr><td>bitcoin-qt.exe                                                               </td><td>   14 </td></tr>
<tr><td>infium.exe                                                                   </td><td>   14 </td></tr>
<tr><td>qip.exe                                                                      </td><td>   14 </td></tr>
<tr><td>communicator.exe                                                             </td><td>   14 </td></tr>
<tr><td>bitcoind.exe                                                                 </td><td>   14 </td></tr>
<tr><td>steam.exe                                                                    </td><td>   14 </td></tr>
<tr><td>sppsvc.exe                                                                   </td><td>   12 </td></tr>
<tr><td>vslvqrlijtvi.exe                                                             </td><td>   12 </td></tr>
<tr><td>splwow64.exe                                                                 </td><td>   12 </td></tr>
<tr><td>artifact.exe                                                                 </td><td>   10 </td></tr>
<tr><td>fontdrvhost.exe                                                              </td><td>   10 </td></tr>
<tr><td>SteamService.exe                                                             </td><td>    9 </td></tr>
<tr><td>SearchProtocolHost.exe                                                       </td><td>    9 </td></tr>
<tr><td>SearchFilterHost.exe                                                         </td><td>    9 </td></tr>
<tr><td>GoogleUpdate.exe                                                             </td><td>    8 </td></tr>
<tr><td>dllhost.exe                                                                  </td><td>    8 </td></tr>
<tr><td>ioynossujx.exe                                                               </td><td>    8 </td></tr>
<tr><td>wqwupyjrsw.exe                                                               </td><td>    8 </td></tr>
<tr><td>notepad.exe                                                                  </td><td>    8 </td></tr>
<tr><td>taskmgr.exe                                                                  </td><td>    7 </td></tr>
<tr><td>ONENOTEM.EXE                                                                 </td><td>    7 </td></tr>
<tr><td>sihost.exe                                                                   </td><td>    6 </td></tr>
<tr><td>vmtoolsd.exe                                                                 </td><td>    6 </td></tr>
<tr><td>SearchUI.exe                                                                 </td><td>    6 </td></tr>
<tr><td>TrustedInstaller.exe                                                         </td><td>    6 </td></tr>
<tr><td>1a7446534577bab0984f5eb275bdf1f43ed92dfc.exe                                 </td><td>    6 </td></tr>
<tr><td>ivpvkimw.exe                                                                 </td><td>    6 </td></tr>
<tr><td>utg2.exe                                                                     </td><td>    6 </td></tr>
<tr><td>Helios12.exe                                                                 </td><td>    5 </td></tr>
<tr><td>OfficeClickToRun.exe                                                         </td><td>    5 </td></tr>
<tr><td>OmniPOS.exe                                                                  </td><td>    5 </td></tr>
<tr><td>ifs.exe                                                                      </td><td>    5 </td></tr>
<tr><td>EdcSvr.exe                                                                   </td><td>    5 </td></tr>
<tr><td>Registry                                                                     </td><td>    5 </td></tr>
<tr><td>OUTLOOK.EXE                                                                  </td><td>    5 </td></tr>
<tr><td>wmpnetwk.exe                                                                 </td><td>    5 </td></tr>
<tr><td>CentralCreditCard.exe                                                        </td><td>    5 </td></tr>
<tr><td>8lfuaq3.exe                                                                  </td><td>    4 </td></tr>
<tr><td>SophosFileScanner.exe                                                        </td><td>    4 </td></tr>
<tr><td>e5d46536.exe                                                                 </td><td>    4 </td></tr>
<tr><td>SgrmBroker.exe                                                               </td><td>    4 </td></tr>
<tr><td>nvtray.exe                                                                   </td><td>    4 </td></tr>
<tr><td>hmpalert.exe                                                                 </td><td>    4 </td></tr>
<tr><td>350befaf.exe                                                                 </td><td>    4 </td></tr>
<tr><td>1a34b48b.exe                                                                 </td><td>    4 </td></tr>
<tr><td>avp.exe                                                                      </td><td>    3 </td></tr>
<tr><td>SEDService.exe                                                               </td><td>    3 </td></tr>
<tr><td>Tcpview.exe                                                                  </td><td>    3 </td></tr>
<tr><td>mp3tray.exe                                                                  </td><td>    3 </td></tr>
<tr><td>InstallRite.exe                                                              </td><td>    3 </td></tr>
<tr><td>SavService.exe                                                               </td><td>    3 </td></tr>
<tr><td>scap.exe                                                                     </td><td>    3 </td></tr>
<tr><td>mscorsvw.exe                                                                 </td><td>    3 </td></tr>
<tr><td>SAVAdminService.exe                                                          </td><td>    3 </td></tr>
<tr><td>sdrservice.exe                                                               </td><td>    3 </td></tr>
<tr><td>StartMenuExperienceHost.exe                                                  </td><td>    3 </td></tr>
<tr><td>Procmon.exe                                                                  </td><td>    3 </td></tr>
<tr><td>backgroundTaskHost.exe                                                       </td><td>    3 </td></tr>
<tr><td>HttpLog.exe                                                                  </td><td>    3 </td></tr>
<tr><td>ShellExperienceHost.exe                                                      </td><td>    3 </td></tr>
<tr><td>taskhostw.exe                                                                </td><td>    3 </td></tr>
<tr><td>popwack.exe                                                                  </td><td>    3 </td></tr>
<tr><td>msdtc.exe                                                                    </td><td>    3 </td></tr>
<tr><td>sedsvc.exe                                                                   </td><td>    3 </td></tr>
<tr><td>avpui.exe                                                                    </td><td>    3 </td></tr>
<tr><td>procexp64.exe                                                                </td><td>    3 </td></tr>
<tr><td>Procmon64.exe                                                                </td><td>    3 </td></tr>
<tr><td>SophosCleanM64.exe                                                           </td><td>    2 </td></tr>
<tr><td>module-cargo.exe                                                             </td><td>    2 </td></tr>
<tr><td>WindowsInternal.ComposableShell.Experiences.TextInput.InputApp.exe           </td><td>    2 </td></tr>
<tr><td>MemCompression                                                               </td><td>    2 </td></tr>
<tr><td>DS5FEMT81XbOM0LW.exe                                                         </td><td>    2 </td></tr>
<tr><td>SecurityHealthService.exe                                                    </td><td>    2 </td></tr>
<tr><td>88d38301327da310c5c00a0b3ae8209730e033f3c57575a447096d94a647e816.exe         </td><td>    2 </td></tr>
<tr><td>swc_service.exe                                                              </td><td>    2 </td></tr>
<tr><td>KMSAuto Net.exe                                                              </td><td>    2 </td></tr>
<tr><td>3sO7_zsS.exe                                                                 </td><td>    2 </td></tr>
<tr><td>SophosFS.exe                                                                 </td><td>    2 </td></tr>
<tr><td>TiWorker.exe                                                                 </td><td>    2 </td></tr>
<tr><td>s35zi2y.exe                                                                  </td><td>    2 </td></tr>
<tr><td>ld8itap.exe                                                                  </td><td>    2 </td></tr>
<tr><td>SophosNtpService.exe                                                         </td><td>    2 </td></tr>
<tr><td>GoogleUpdateSetup.exe                                                        </td><td>    2 </td></tr>
<tr><td>SSPService.exe                                                               </td><td>    2 </td></tr>
<tr><td>swi_service.exe                                                              </td><td>    2 </td></tr>
<tr><td>pythonw.exe                                                                  </td><td>    2 </td></tr>
<tr><td>WbjiETqs.exe                                                                 </td><td>    2 </td></tr>
<tr><td>ctfmon.exe                                                                   </td><td>    2 </td></tr>
<tr><td>pw.exe                                                                       </td><td>    2 </td></tr>
<tr><td>swi_filter.exe                                                               </td><td>    2 </td></tr>
<tr><td>hltpwzd.exe                                                                  </td><td>    2 </td></tr>
<tr><td>Sophos.Encryption.BitLockerService.exe                                       </td><td>    2 </td></tr>
<tr><td>uniform-98682.exe                                                            </td><td>    2 </td></tr>
<tr><td>8eu3umxnf.exe                                                                </td><td>    2 </td></tr>
<tr><td>SophosIPS.exe                                                                </td><td>    2 </td></tr>
<tr><td>union_rechnung_install_39213.exe                                             </td><td>    2 </td></tr>
<tr><td>userinit.exe                                                                 </td><td>    2 </td></tr>
<tr><td>gzqhbp.exe                                                                   </td><td>    2 </td></tr>
<tr><td>05a62b54.exe                                                                 </td><td>    2 </td></tr>
<tr><td>SophosSafestore64.exe                                                        </td><td>    2 </td></tr>
<tr><td>sdcservice.exe                                                               </td><td>    2 </td></tr>
<tr><td>swi_fc.exe                                                                   </td><td>    2 </td></tr>
<tr><td>3myJvMOn.exe                                                                 </td><td>    2 </td></tr>
<tr><td>WmiApSrv.exe                                                                 </td><td>    2 </td></tr>
<tr><td>cuckoo-47ed17bdea1dab10fdee7f61dff8b8f33ad5d092b3e1e5f0f5a3522a27798183.exe  </td><td>    2 </td></tr>
<tr><td>mtwebooS.exe                                                                 </td><td>    2 </td></tr>
<tr><td>05a62b54e6e32c406f33d22634b03fe8.exe                                         </td><td>    2 </td></tr>
<tr><td>SnrUNWUv.exe                                                                 </td><td>    2 </td></tr>
<tr><td>msiexec.exe                                                                  </td><td>    2 </td></tr>
<tr><td>follow-sneaky-on-twitch.exe                                                  </td><td>    2 </td></tr>
<tr><td>SophosHealth.exe                                                             </td><td>    2 </td></tr>
<tr><td>...</td><td>...</td></tr>
<tr><td>absolutetelnet.exe        </td>   <td> 1 </td>  </tr>                      
<tr><td>gmmeby.exe                </td>   <td> 1 </td>  </tr>                      
<tr><td>outlook.exe               </td>   <td> 1 </td>  </tr>                      
<tr><td>isspos.exe                </td>   <td> 1 </td>  </tr>                      
<tr><td>qgksae.exe                </td>   <td> 1 </td>  </tr>                      
<tr><td>totalcmd.exe              </td>   <td> 1 </td>  </tr>                      
<tr><td>ncftp.exe                 </td>   <td> 1 </td>  </tr>                      
<tr><td>whatsapp.exe              </td>   <td> 1 </td>  </tr>                      
<tr><td>igfxCUIService.exe        </td>   <td> 1 </td>  </tr>                      
<tr><td>winscp.exe                </td>   <td> 1 </td>  </tr>                      
<tr><td>coreftp.exe               </td>   <td> 1 </td>  </tr>                      
<tr><td>barca.exe                 </td>   <td> 1 </td>  </tr>                      
<tr><td>socbristol.exe            </td>   <td> 1 </td>  </tr>                      
<tr><td>rundll32.exe              </td>   <td> 1 </td>  </tr>                      
<tr><td>accupos.exe               </td>   <td> 1 </td>  </tr>                      
<tr><td>bedrooms-story-avoid.exe  </td>   <td> 1 </td>  </tr>                      
<tr><td>active-charge.exe         </td>   <td> 1 </td>  </tr>                      
<tr><td>fling.exe                 </td>   <td> 1 </td>  </tr>                      
<tr><td>vrmafl.exe                </td>   <td> 1 </td>  </tr>                      
<tr><td>gmailnotifierpro.exe      </td>   <td> 1 </td>  </tr>                      
<tr><td>pidgin.exe                </td>   <td> 1 </td>  </tr>                      
<tr><td>diaryrecent.exe           </td>   <td> 1 </td>  </tr>                      
<tr><td>creditservice.exe         </td>   <td> 1 </td>  </tr>                      
<tr><td>operamail.exe             </td>   <td> 1 </td>  </tr>                      
<tr><td>centralcreditcard.exe     </td>   <td> 1 </td>  </tr>                      
<tr><td>unsecapp.exe              </td>   <td> 1 </td>  </tr>                      
<tr><td>AutoKMS.exe               </td>   <td> 1 </td>  </tr>                      
<tr><td>medical reservoir.exe     </td>   <td> 1 </td>  </tr>                      
<tr><td>alftp.exe                 </td>   <td> 1 </td>  </tr>                      
<tr><td>netsh.exe                 </td>   <td> 1 </td>  </tr>                      
<tr><td>wspsvc.exe                </td>   <td> 1 </td>  </tr>                      
<tr><td>scriptftp.exe             </td>   <td> 1 </td>  </tr>                      
<tr><td>spgagentservice.exe       </td>   <td> 1 </td>  </tr>                      
<tr><td>slwvdq.exe                </td>   <td> 1 </td>  </tr>                      
<tr><td>edcsvr.exe                </td>   <td> 1 </td>  </tr>                      
<tr><td>Sysmon.exe                </td>   <td> 1 </td>  </tr>                      
<tr><td>american.exe              </td>   <td> 1 </td>  </tr>                      
<tr><td>wmi64.exe                 </td>   <td> 1 </td>  </tr>                      
<tr><td>flashfxp.exe              </td>   <td> 1 </td>  </tr>                      
<tr><td>axdnik.exe                </td>   <td> 1 </td>  </tr>                      
<tr><td>webpagepioneer.exe        </td>   <td> 1 </td>  </tr>                      
<tr><td>skype.exe                 </td>   <td> 1 </td>  </tr>                      
<tr><td>Memory Compression        </td>   <td> 1 </td>  </tr>                      
<tr><td>fpos.exe                  </td>   <td> 1 </td>  </tr>                      
<tr><td>ApplicationFrameHost.exe  </td>   <td> 1 </td>  </tr>                      
<tr><td>filezilla.exe             </td>   <td> 1 </td>  </tr>                      
<tr><td>spcwin.exe                </td>   <td> 1 </td>  </tr>                      
</table>
</div>
<p><br/></p>

<p>Unfortunately, we can also see things like <code class="language-plaintext highlighter-rouge">cuckoo-47ed17bdea1dab10fdee7f61dff8b8f33ad5d092b3e1e5f0f5a3522a27798183.exe</code> or <code class="language-plaintext highlighter-rouge">1a7446534577bab0984f5eb275bdf1f43ed92dfc.exe</code> which is simply the checksum hash of the sample. An attacker can simply compute the popular checksums (the ones on the <code class="language-plaintext highlighter-rouge">details</code> section in VT) and see if its name is any of those and terminate <img src="https://web.archive.org/web/20210613070852im_/https://cdn.betterttv.net/emote/5d6096974932b21d9c332904/1x" alt=""/>.</p>

<h4 id="machine-names">Machine names</h4>

<p>One thing I wanted to see is the username the malware in the sandbox will run on. For the most part I was underwhelmed. It appears the machine name remains the same across executions, which may be easy for an attacker to just submit bogus “malware” just to harvest all the machine names. In terms of the context I did see that sometimes the sample was executed as <code class="language-plaintext highlighter-rouge">Administrator</code> meaning that some sandboxes give the “malware” admin privilleges. This is done to make sure that malware can execute.</p>

<div style="height:300px;overflow:auto;">
<table>
<tr><th>Username</th><th>Number of executions</th></tr>
<tr><td>art-PC          </td><td> 7 </td></tr>
<tr><td>PC-4a095e27cb   </td><td> 5 </td></tr>
<tr><td>w7sb64-01       </td><td> 3 </td></tr>
<tr><td>w7x64           </td><td> 3 </td></tr>
<tr><td>z97Otih0P4v-PC  </td><td> 2 </td></tr>
<tr><td>AMAZING-AVOCADO </td><td> 2 </td></tr>
<tr><td>mgvwazbfy       </td><td> 1 </td></tr>
<tr><td>WIN-IMCGBF4ZV49 </td><td> 1 </td></tr>
<tr><td>HAPUBWS-PC      </td><td> 1 </td></tr>
<tr><td>DESKTOP-VXO5LFI </td><td> 1 </td></tr>
<tr><td>QGl87k-PC       </td><td> 1 </td></tr>
<tr><td>IOFXBF742797820 </td><td> 1 </td></tr>
<tr><td>WIN-QVM8C8V0B1E </td><td> 1 </td></tr>
<tr><td>XDuwTfOno       </td><td> 1 </td></tr>
<tr><td>dillon          </td><td> 1 </td></tr>
<tr><td>WIN-BROIECEJLD2 </td><td> 1 </td></tr>
<tr><td>CZAC38122213349 </td><td> 1 </td></tr>
<tr><td>Xj8Uz1ljKXdt-PC </td><td> 1 </td></tr>
<tr><td>DESKTOP-ILTLN65 </td><td> 1 </td></tr>
<tr><td>OngJeNyHDSzmoUHw</td><td> 1 </td></tr>
<tr><td>Anna-PC         </td><td> 1 </td></tr>
<tr><td>DcXhlNjDfk-PC   </td><td> 1 </td></tr>
<tr><td>WIN-FYI1QSCHQHU </td><td> 1 </td></tr>
<tr><td>WIN-LQOUJKDIROR </td><td> 1 </td></tr>
<tr><td>XGUW12547433669 </td><td> 1 </td></tr>
<tr><td>AL MUKALLA      </td><td> 1 </td></tr>
<tr><td>WIN-KRAZH63AMC2 </td><td> 1 </td></tr>
<tr><td>PC              </td><td> 1 </td></tr>
<tr><td>GCSPJUXFT667743 </td><td> 1 </td></tr>
<tr><td>DESKTOP-D019GDM </td><td> 1 </td></tr>
<tr><td>WIN-UJ21PNWQMR2 </td><td> 1 </td></tr>
<tr><td>Lisa-PC         </td><td> 1 </td></tr>
<tr><td>vX3juZIWR5Wy-PC </td><td> 1 </td></tr>
<tr><td>WIN-TGCR76AWNUB </td><td> 1 </td></tr>
<tr><td>WIN-U1DY5TBDUI7 </td><td> 1 </td></tr>
</table>
</div>
<p><br/></p>

<h3 id="hardware-analysis">Hardware analysis</h3>

<h4 id="cpu-and-memory-analysis">CPU and memory analysis</h4>

<p>Next we are interested to know what CPU are the sandboxes running on?
I realized the <code class="language-plaintext highlighter-rouge">platform.processor()</code> was not returning the actual CPU name, but it was too late when I realized so I used the available information from this command and scrapped some tables online to get the processor name (<a href="/web/20210613070852/https://albocoder.github.io/assets/misc/cpu_name_database.pkl">here</a> is the <em>pkl</em> file that aggregates all data).
In the latest version I added this awesome library called <code class="language-plaintext highlighter-rouge">cpuinfo</code>, so in case you need to collect your own data the cpuinfo will do the work.</p>

<table>
  <thead>
    <tr>
      <th>number of cores</th>
      <th>potential cores</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1</td>
      <td>{ 8 , 4 }</td>
    </tr>
    <tr>
      <td>1</td>
      <td>{ 8 , 4 }</td>
    </tr>
    <tr>
      <td>1</td>
      <td>{ 8 , 4 }</td>
    </tr>
    <tr>
      <td>4</td>
      <td>{ 16 }</td>
    </tr>
    <tr>
      <td>2</td>
      <td>{ 8 , 4 }</td>
    </tr>
    <tr>
      <td>1</td>
      <td>{ 8 , 4 }</td>
    </tr>
    <tr>
      <td>1</td>
      <td>{ 8 , 4 }</td>
    </tr>
    <tr>
      <td>1</td>
      <td>{ 8 , 4 }</td>
    </tr>
    <tr>
      <td>1</td>
      <td>{ 8 , 4 }</td>
    </tr>
  </tbody>
</table>

<p>As hypothesized, the machine has the wrong number of cores for the CPU name (VICTORY <img src="https://web.archive.org/web/20210613070852im_/https://cdn.betterttv.net/emote/5f1b0186cf6d2144653d2970/1x" alt=""/>). In the <strong>9</strong> machines, I found that the most used CPUs are <code class="language-plaintext highlighter-rouge">Intel(R) Core(TM) i5-7500 CPU @ 3.40GHz</code>, <code class="language-plaintext highlighter-rouge">Intel(R) Core(TM) i7-4790K CPU @ 4.00GHz</code> and <code class="language-plaintext highlighter-rouge">Intel(R) Xeon(R) W-2140B CPU @ 3.20GHz</code>. The machines seem to have 1 core for the most times but the name is that of a cpu with 4 or 8 cores.</p>

<p>I also checked the CPU utilization rates. Hypothetically, the sandboxes would have low CPU utilization, since they are only meant to run the malware.</p>

<p><img src="/web/20210613070852im_/https://albocoder.github.io/assets/blog1_sandbox/cpu_utilization.svg" alt=""/></p>

<p>While most of the sandboxes have a utilization less than 20% there are still cases where sandboxes have 80%  or even 100%. I believe the CPU utilization cannot be a feature to distingush between sandboxes and real machines.</p>

<p>Lastly for this section we look into memory. How much memory can commercial sandboxes spare?</p>

<p><img src="/web/20210613070852im_/https://albocoder.github.io/assets/blog1_sandbox/memory_in_machines.svg" alt=""/></p>

<p>It appears most of the machines have 1 to 2 GB of RAM to spare. In 2 cases I found machines with 512MB of memory like its 2010 <img src="https://web.archive.org/web/20210613070852im_/https://cdn.betterttv.net/emote/55cbeb8f8b9c49ef325bf738/1x" alt=""/>. Props to the AV vendor(s) that allocated 4, 8 and 16GB for a sandbox to run a malware sample.</p>

<h4 id="disk-partitions">Disk Partitions</h4>

<p>An interesting result here is that in ALL sandboxes there seems to be 1 disk partion of type <code class="language-plaintext highlighter-rouge">cdrom</code> <img src="https://web.archive.org/web/20210613070852im_/https://cdn.betterttv.net/emote/58e5abdaf3ef4c75c9c6f0f9/1x" alt=""/>.
Hypothetically this may happen because during the VM creation the Windows installation disk was left inserted (more work needs to be done to verify this).</p>

<p>For the main disk partition (where Windows is installed) we notice quite a spectrum of sizes, but the usage in general is quite low (except for the <code class="language-plaintext highlighter-rouge">32GB</code> disks with high usage because Windows is installed there). In 2021 I wouldn’t expect there to be many machines left with 32GB in the main drive, so this may raise some suspicions from the attackers prespective.</p>

<p><img src="/web/20210613070852im_/https://albocoder.github.io/assets/blog1_sandbox/disk_sizes.svg" alt=""/>
<img src="/web/20210613070852im_/https://albocoder.github.io/assets/blog1_sandbox/disk_usages.svg" alt=""/></p>

<h4 id="network-interfaces">Network Interfaces</h4>

<p>In general 2 to 3 interfaces and <strong>5</strong> network interfaces in 1 sandbox. The most prevalent are of course <code class="language-plaintext highlighter-rouge">Loopback Pseudo-Interface 1</code> and <code class="language-plaintext highlighter-rouge">Local Area Connection</code>.
Then I noticed some pattern of <code class="language-plaintext highlighter-rouge">isatap.{&lt;random GUID here&gt;}</code> and <code class="language-plaintext highlighter-rouge">Teredo Tunneling Pseudo-Interface</code>. Upon further analysis I found that these interface exist to enable IPv6 communication, so there is nothing special that an attacker can use here <img src="https://web.archive.org/web/20210613070852im_/https://cdn.betterttv.net/emote/5d7eefb7c0652668c9e4d394/1x" alt=""/>.</p>

<h4 id="battery">Battery</h4>

<p>Not a single sandbox had a battery. Attackers right now pulling a high IQ strat <img src="https://web.archive.org/web/20210613070852im_/https://cdn.betterttv.net/emote/5acdc7cb31ca5d147369ead8/1x" alt=""/>.</p>

<h3 id="time-analysis">Time analysis</h3>

<p>One thing its hard to keep up to date while restoring the snapshot (at least in Windows) is local time.
Its a bit more difficult when you consider the geolocation the machine is supposed to be at.
For this I collected the local time, the global UTC time and the external IP address of the sandbox and metadata for that IP.
Thanks to <a href="https://web.archive.org/web/20210613070852/https://www.ipify.org/"><code class="language-plaintext highlighter-rouge">ipfy</code></a>, <a href="https://web.archive.org/web/20210613070852/https://just-the-time.appspot.com/"><code class="language-plaintext highlighter-rouge">just-the-time</code></a>, and <a href="https://web.archive.org/web/20210613070852/https://ipinfo.io/"><code class="language-plaintext highlighter-rouge">ipinfo</code></a> for the awesome service.
The process I followed is pretty simple. I use the data from <code class="language-plaintext highlighter-rouge">ipinfo</code> to get the geolocation and convert the UTC time to the local time for that geolocation, then I calculated the time skew between the time of the geolocation and the sandboxes local time.</p>

<table>
  <thead>
    <tr>
      <th>time difference(hours)</th>
      <th>number of machines</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>-19.0</td>
      <td>1</td>
    </tr>
    <tr>
      <td>-9.0</td>
      <td>2</td>
    </tr>
    <tr>
      <td>-8.0</td>
      <td>1</td>
    </tr>
    <tr>
      <td>-3.0</td>
      <td>1</td>
    </tr>
    <tr>
      <td>-2.0</td>
      <td>18</td>
    </tr>
    <tr>
      <td>-1.0</td>
      <td>4</td>
    </tr>
    <tr>
      <td><strong>0.0</strong></td>
      <td><strong>19</strong></td>
    </tr>
    <tr>
      <td>3.0</td>
      <td>1</td>
    </tr>
    <tr>
      <td>5.0</td>
      <td>1</td>
    </tr>
    <tr>
      <td>9.0</td>
      <td>2</td>
    </tr>
  </tbody>
</table>

<p>As it appears, around <strong>65%</strong> of the sandboxes have some sort of a time skew (and I believe the other 35% are simply lucky to VPN on the same timezone or not even VPN at all, will get to this later <img src="https://web.archive.org/web/20210613070852im_/https://cdn.betterttv.net/emote/59f27b3f4ebd8047f54dee29/1x" alt=""/>).</p>

<p>This is a very low effort feature a real malware can use to check if its inside a sandbox given that such info can be checked for free.
Even through a CnC server the attacker can measure whether the malware has made it into the sandboxes.
Throughout our <a href="/web/20210613070852/https://albocoder.github.io/assets/pdf_files/malw_variability.pdf"><code class="language-plaintext highlighter-rouge">paper</code></a> we also noticed that there are some real users’ machines with an outdated clock (sometimes out of date by about 50 years <img src="https://web.archive.org/web/20210613070852im_/https://cdn.betterttv.net/emote/5d20a55de1cfde376e532972/1x" alt=""/>) however this made up for <em>less than 0.001%</em> of the machines in the real world not 65%, so a malware author may simply choose to forgive these outdated machines just to be safe from analysis.
And from a defender’s prespective, PLEASE UPDATE THE CLOCK BEFORE ROUTING THE NET TRAFFIC TO NARNIA.</p>

<h3 id="ip-analysis">IP analysis</h3>

<p>This is the meat of the blog post, in my opinion. Thanks again to <a href="https://web.archive.org/web/20210613070852/https://ipinfo.io/"><code class="language-plaintext highlighter-rouge">ipinfo</code></a> for the 7 day free trial. As the most interesting to me, I first looked at “Who owns these IP addresses? Who are the companies/ISPs?”. As shown in the table below the network traffic in all the sandboxes is routed through VPNs that they get from dedicated servers. It appears CrowdStrike has their own IP range that they use to route traffic (registered under their official name <img src="https://web.archive.org/web/20210613070852im_/https://cdn.betterttv.net/emote/55f47f507f08be9f0a63ce37/1x" alt=""/>, hide the pain Harold).</p>

<div style="height:300px;overflow:auto;">
<table>
<tr><th>IP owner company</th><th>number of IPs in the dataset</th></tr>
<tr><td>TELUS Communications Inc.          </td><td>    5      </td></tr>
<tr><td>Wintek Corporation                 </td><td>    5      </td></tr>
<tr><td>PJSC Vimpelcom                     </td><td>    5      </td></tr>
<tr><td>Verizon Business Special Project   </td><td>    3      </td></tr>
<tr><td>LLC Digital Network                </td><td>    3      </td></tr>
<tr><td>Cox Communications Inc.            </td><td>    3      </td></tr>
<tr><td>Zwiebelfreunde e.V.                </td><td>    2      </td></tr>
<tr><td>Bell Canada                        </td><td>    2      </td></tr>
<tr><td>111250 Russia Moscow SOVINTEL/EDN  </td><td>    2      </td></tr>
<tr><td>1337 Services LLC                  </td><td>    1      </td></tr>
<tr><td>Vodafone D2 GmbH                   </td><td>    1      </td></tr>
<tr><td>Telecom Colocation, LLC            </td><td>    1      </td></tr>
<tr><td>IPG                                </td><td>    1      </td></tr>
<tr><td>111250 Russia MOscow EDN/Sovintel  </td><td>    1      </td></tr>
<tr><td>Bungee Servers SP                  </td><td>    1      </td></tr>
<tr><td><b>CrowdStrike Services</b>        </td><td>  <b>1</b> </td></tr>
<tr><td>Dedicated Servers                  </td><td>    1      </td></tr>
<tr><td>LeaseWeb Netherlands B.V.          </td><td>    1      </td></tr>
<tr><td>ARCOR AG                           </td><td>    1      </td></tr>
<tr><td>Deutsche Telekom AG                </td><td>    1      </td></tr>
<tr><td>Datacamp Limited                   </td><td>    1      </td></tr>
<tr><td>Core-Backbone GmbH                 </td><td>    1      </td></tr>
</table>
</div>
<p><br/></p>

<p>Now we want to know where exatly are these IPs from. With this much data it’s hard to say which IPs are owned by the AV vendors, since they are also just buying VPN access, but I wanted to see where they are buying from. It appears Russia, US, Canada and Germany are the most prominent countries, and in Russia, Moscow seems to be the city with the highest number of IPs.</p>

<p><img src="/web/20210613070852im_/https://albocoder.github.io/assets/blog1_sandbox/countries_piechart.svg" alt=""/>
<img src="/web/20210613070852im_/https://albocoder.github.io/assets/blog1_sandbox/IP_locations.svg" alt=""/></p>

<h2 id="conclusion">Conclusion</h2>

<p>There is no silver bullet to detect sandboxes, but there are some features and bugs <img src="https://web.archive.org/web/20210613070852im_/https://cdn.betterttv.net/emote/57f540e061ff29ea0eec6f27/1x" alt=""/> the attacker can use to detect them.
On the other hand the sandboxes can also cover these weaknesses. It’s all about that arms race <img src="https://web.archive.org/web/20210613070852im_/https://cdn.betterttv.net/emote/5d0d7140ca4f4b50240ff6b4/1x" alt=""/>.</p>

  </div><div id="disqus_thread"></div>
  <script>
    var disqus_config = function () {
      this.page.url = 'https://web.archive.org/web/20210613070852/https://albocoder.github.io/malware/2021/06/01/SandboxStudy.html';
      this.page.identifier = 'https://web.archive.org/web/20210613070852/https://albocoder.github.io/malware/2021/06/01/SandboxStudy.html';
    };

    (function() {
      var d = document, s = d.createElement('script');

      s.src = 'https://web.archive.org/web/20210613070852/https://albocoder-github-io.disqus.com/embed.js';

      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://web.archive.org/web/20210613070852/https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript><a class="u-url" href="/web/20210613070852/https://albocoder.github.io/malware/2021/06/01/SandboxStudy.html" hidden></a>
</article>

      </div>
    </main>

    <!-- include footer.html -->

  </body>

</html>
<!--
     FILE ARCHIVED ON 07:08:52 Jun 13, 2021 AND RETRIEVED FROM THE
     INTERNET ARCHIVE ON 04:23:17 Dec 18, 2024.
     JAVASCRIPT APPENDED BY WAYBACK MACHINE, COPYRIGHT INTERNET ARCHIVE.

     ALL OTHER CONTENT MAY ALSO BE PROTECTED BY COPYRIGHT (17 U.S.C.
     SECTION 108(a)(3)).
-->
<!--
playback timings (ms):
  captures_list: 2.466
  exclusion.robots: 0.037
  exclusion.robots.policy: 0.022
  esindex: 0.013
  cdx.remote: 9.969
  LoadShardBlock: 151.081 (3)
  PetaboxLoader3.datanode: 113.402 (5)
  load_resource: 197.904
  PetaboxLoader3.resolve: 131.376
  loaddict: 42.871
-->