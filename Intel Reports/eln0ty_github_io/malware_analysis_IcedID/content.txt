<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.19.2 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>IcedID gziploader analysis (Part1) - eln0ty</title>
<meta name="description" content="IcedID , also known as BokBot, was among one of the most active malware families and has been known for loading different types of payloads such as Cobalt Strike. ">


  <meta name="author" content="Abdallah Elnoty">


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="eln0ty">
<meta property="og:title" content="IcedID gziploader analysis (Part1)">
<meta property="og:url" content="https://eln0ty.github.io/malware%20analysis/IcedID/">


  <meta property="og:description" content="IcedID , also known as BokBot, was among one of the most active malware families and has been known for loading different types of payloads such as Cobalt Strike. ">



  <meta property="og:image" content="https://eln0ty.github.io/assets/images/malware-analysis/IcedID/logo.jpg">





  <meta property="article:published_time" content="2022-03-17T00:00:00+00:00">





  

  


<link rel="canonical" href="https://eln0ty.github.io/malware%20analysis/IcedID/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Abdallah Elnoty",
      "url": "https://eln0ty.github.io/"
    
  }
</script>






<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="eln0ty Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<!-- end custom head snippets -->

<!-- favicon -->
<link rel="icon" type="image/png" sizes="32x32" href="/assets/images/site_data/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/assets/images/site_data/favicon-16x16.png">
<meta name="theme-color" content="#ffffff">

  </head>

  <body class="layout--single wide">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/images/site_data/logo.png" alt=""></a>
        
        <a class="site-title" href="/">
          eln0ty
          
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/categories/#malware-analysis">Malware Analysis</a>
            </li><li class="masthead__menu-item">
              <a href="/categories/#forensics">Forensics</a>
            </li><li class="masthead__menu-item">
              <a href="/categories">All Categories</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="/assets/images/site_data/avatar.jpg" alt="Abdallah Elnoty" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Abdallah Elnoty</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>Malware Analysis &amp; Reverse Engineering</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">127.0.0.1</span>
        </li>
      

      
        
          
            <li><a href="mailto:abdallahelnoty@gmail.com" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i><span class="label">Email</span></a></li>
          
        
          
        
          
            <li><a href="https://twitter.com/eln0ty" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-twitter-square" aria-hidden="true"></i><span class="label">Twitter</span></a></li>
          
        
          
            <li><a href="https://facebook.com/eln0ty" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-facebook-square" aria-hidden="true"></i><span class="label">Facebook</span></a></li>
          
        
          
            <li><a href="https://www.linkedin.com/in/eln0ty" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span class="label">LinkedIn</span></a></li>
          
        
          
            <li><a href="https://github.com/eln0ty" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="IcedID gziploader analysis (Part1)">
    <meta itemprop="description" content="Introduction">
    <meta itemprop="datePublished" content="2022-03-17T00:00:00+00:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">IcedID gziploader analysis (Part1)
</h1>
          
            <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  5 minute read

</p>
          
        </header>
      

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right ">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-file-alt"></i> On this page</h4></header>
              <ul class="toc__menu">
  <li><a href="#introduction">Introduction</a></li>
  <li><a href="#entry-stage">Entry Stage</a></li>
  <li><a href="#first-stage">First Stage</a>
    <ul>
      <li><a href="#decrypt-config">Decrypt Config</a></li>
      <li><a href="#misleading-traffic">Misleading traffic</a></li>
      <li><a href="#playing-with-cookies">Playing with cookies</a></li>
      <li><a href="#connect-c2-server">Connect C2 server</a></li>
    </ul>
  </li>
  <li><a href="#conclusion">Conclusion</a></li>
  <li><a href="#iocs">IOCs</a></li>
</ul>

            </nav>
          </aside>
        
        <h1 id="introduction">Introduction</h1>

<p>IcedID , also known as BokBot, was among one of the most active malware families and has been known for loading different types of payloads such as Cobalt Strike.</p>

<p>In this report, I’m going to walk through an analysis of a malicious document that distributes and executes an IcedID DLL payload then, the malicious payload itself.</p>

<p>Our process divided to 3 stages (Entry stage + 1st stage + 2nd stage) but unfortunately, I can’t get to the second stage because the C2 server is down. Here I will review some of the characteristics of our different stages:</p>

<ul>
  <li>Entry stage: Malicious document executes VBA macro to download <code class="language-plaintext highlighter-rouge">IcedID</code> on the disk.</li>
  <li>First stage: Loader is executed and download the the real malware (C2 is down in this step)</li>
  <li>The Second: The malware for which this process was being performed is being executed and this is something that is determined by the server administrator (Cobalt Strike for example).</li>
</ul>

<p><a href="/assets/images/malware-analysis/IcedID/overview.png"><img src="/assets/images/malware-analysis/IcedID/overview.png" alt="" /></a></p>

<h1 id="entry-stage">Entry Stage</h1>

<p><strong>sha256</strong>: <code class="language-plaintext highlighter-rouge">f604ca55de802f334064610d65e23890ab81906cdac3f8a5c7c25126176289c8</code></p>

<p>I used <code class="language-plaintext highlighter-rouge">olevba</code> to extract the embedded script from the .doc file.</p>

<p><a href="/assets/images/malware-analysis/IcedID/olevba.jpg"><img src="/assets/images/malware-analysis/IcedID/olevba.jpg" alt="" /></a></p>

<p>I just want to point out that I used <code class="language-plaintext highlighter-rouge">Exiftool</code> to extract some meta data to understand the script:</p>

<p>-&gt; <code class="language-plaintext highlighter-rouge">Exiftool &lt;filename.doc&gt;</code></p>

<p><a href="/assets/images/malware-analysis/IcedID/exiftool.jpg"><img src="/assets/images/malware-analysis/IcedID/exiftool.jpg" alt="" /></a></p>

<p>When I opened the document, I found obfuscated content with white color and too small size. So, I griped it and removed all <code class="language-plaintext highlighter-rouge">%1</code> instances. This is some of code after beautifying:</p>

<p><a href="/assets/images/malware-analysis/IcedID/html.jpg"><img src="/assets/images/malware-analysis/IcedID/html.jpg" alt="" /></a></p>

<p><a href="/assets/images/malware-analysis/IcedID/html2.jpg"><img src="/assets/images/malware-analysis/IcedID/html2.jpg" alt="" /></a></p>

<p>The main function for the whole script is decoding the 2 strings in the top of HTML code then creates a connection with the server to download <strong>IcedID</strong> dll Loader. I <code class="language-plaintext highlighter-rouge">cyberchef</code> to get these strings.</p>

<p>Final results:</p>

<p><a href="/assets/images/malware-analysis/IcedID/dropped.jpg"><img src="/assets/images/malware-analysis/IcedID/dropped.jpg" alt="" /></a></p>

<h1 id="first-stage">First Stage</h1>

<p>The main purpose of this stage is to drop the payload and it could be a real malware or another dropper. This process depends on the malware developer and what he wants.</p>

<p>Let’s start the analysis with our dropped DLL payload. Dropped file is packed. I tried to upload it to automatic unpacker <a href="https://www.unpac.me/">umpac.me</a> but it doesn’t support x64 binaries. Let’s unpack in manually with <strong>x64dbg</strong>.</p>

<p>The unpacking process is really simple. It allocates memory for the unpacked code using <code class="language-plaintext highlighter-rouge">VirtualAlloc()</code>. So we just set a breakpoint at <code class="language-plaintext highlighter-rouge">VirtualAlloc()</code> and run the debugger twice, then dump the file from memory.</p>

<p><a href="/assets/images/malware-analysis/IcedID/VirtualAlloc.png"><img src="/assets/images/malware-analysis/IcedID/VirtualAlloc.png" alt="" /></a></p>

<h2 id="decrypt-config">Decrypt Config</h2>

<p>The first function that malware performs, it decrypts <strong>C2 server</strong> and <strong>campaign number</strong>.</p>

<p>Malware uses a pretty simple decryption algorithm. It retrieves the encrypted data from <code class="language-plaintext highlighter-rouge">.data</code> section then -&gt; <code class="language-plaintext highlighter-rouge">data[0:32] ^ data[64:96] </code>.</p>

<p><a href="/assets/images/malware-analysis/IcedID/dec_fun.png"><img src="/assets/images/malware-analysis/IcedID/dec_fun.png" alt="" /></a></p>

<p>I wrote a python script to decrypt the config.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">struct</span>

<span class="c1">#data[0:32]
</span><span class="n">data</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x55</span><span class="p">,</span><span class="mh">0x00</span><span class="p">,</span><span class="mh">0x29</span><span class="p">,</span><span class="mh">0x36</span><span class="p">,</span><span class="mh">0x84</span><span class="p">,</span><span class="mh">0x33</span><span class="p">,</span><span class="mh">0x8f</span><span class="p">,</span><span class="mh">0x67</span><span class="p">,</span><span class="mh">0x5d</span><span class="p">,</span><span class="mh">0xe1</span><span class="p">,</span><span class="mh">0x1b</span><span class="p">,</span><span class="mh">0xc1</span><span class="p">,</span><span class="mh">0x4e</span><span class="p">,</span><span class="mh">0xe6</span><span class="p">,</span><span class="mh">0x17</span><span class="p">,</span><span class="mh">0xf5</span><span class="p">,</span><span class="mh">0x2b</span><span class="p">,</span><span class="mh">0x35</span><span class="p">,</span><span class="mh">0xd7</span><span class="p">,</span><span class="mh">0xed</span><span class="p">,</span><span class="mh">0x15</span><span class="p">,</span><span class="mh">0xf4</span><span class="p">,</span><span class="mh">0x2a</span><span class="p">,</span><span class="mh">0x30</span><span class="p">,</span><span class="mh">0x21</span><span class="p">,</span><span class="mh">0x70</span><span class="p">,</span><span class="mh">0xbc</span><span class="p">,</span><span class="mh">0x03</span><span class="p">,</span><span class="mh">0x37</span><span class="p">,</span><span class="mh">0xb7</span><span class="p">,</span><span class="mh">0xe8</span><span class="p">,</span><span class="mh">0x66</span><span class="p">]</span>
<span class="c1">#data[64:96]
</span><span class="n">key</span> <span class="o">=</span> <span class="p">[</span><span class="mh">0x16</span><span class="p">,</span><span class="mh">0x68</span><span class="p">,</span><span class="mh">0x29</span><span class="p">,</span><span class="mh">0x53</span><span class="p">,</span><span class="mh">0xe2</span><span class="p">,</span><span class="mh">0x5a</span><span class="p">,</span><span class="mh">0xfd</span><span class="p">,</span><span class="mh">0x02</span><span class="p">,</span><span class="mh">0x33</span><span class="p">,</span><span class="mh">0x88</span><span class="p">,</span><span class="mh">0x78</span><span class="p">,</span><span class="mh">0xa0</span><span class="p">,</span><span class="mh">0x3a</span><span class="p">,</span><span class="mh">0x94</span><span class="p">,</span><span class="mh">0x7e</span><span class="p">,</span><span class="mh">0x97</span><span class="p">,</span><span class="mh">0x47</span><span class="p">,</span><span class="mh">0x50</span><span class="p">,</span><span class="mh">0xf9</span><span class="p">,</span><span class="mh">0x8e</span><span class="p">,</span><span class="mh">0x7a</span><span class="p">,</span><span class="mh">0x99</span><span class="p">,</span><span class="mh">0x2a</span><span class="p">,</span><span class="mh">0x54</span><span class="p">,</span><span class="mh">0xee</span><span class="p">,</span><span class="mh">0x10</span><span class="p">,</span><span class="mh">0x9c</span><span class="p">,</span><span class="mh">0x64</span><span class="p">,</span><span class="mh">0x2c</span><span class="p">,</span><span class="mh">0x69</span><span class="p">,</span><span class="mh">0xae</span><span class="p">,</span><span class="mh">0x5c</span><span class="p">]</span>
<span class="n">res</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">()</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">32</span><span class="p">):</span>
	<span class="n">res</span><span class="p">.</span><span class="n">append</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">^</span> <span class="n">key</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

<span class="k">print</span><span class="p">(</span><span class="s">"CampaignID:"</span><span class="p">,</span> <span class="n">struct</span><span class="p">.</span><span class="n">unpack</span><span class="p">(</span><span class="s">"&lt;I"</span><span class="p">,</span> <span class="n">res</span><span class="p">[:</span><span class="mi">4</span><span class="p">])[</span><span class="mi">0</span><span class="p">])</span>
<span class="k">print</span><span class="p">(</span><span class="s">"C2:"</span><span class="p">,</span> <span class="n">res</span><span class="p">[</span><span class="mi">4</span><span class="p">:].</span><span class="n">split</span><span class="p">(</span><span class="sa">b</span><span class="s">'</span><span class="se">\x00</span><span class="s">'</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="n">decode</span><span class="p">())</span>

<span class="s">'''
Results
	CampaignID: 1694525507
	C2: firenicatrible.com
'''</span>
</code></pre></div></div>

<p>The first 4 bytes refer to <strong>Campaign number</strong> that shows the purpose of the attack. Second, <strong>C2</strong> decryption.</p>

<h2 id="misleading-traffic">Misleading traffic</h2>

<p>The mawlare sends traffic to <code class="language-plaintext highlighter-rouge">aws.amazon.com</code> to mislead, and between the lines it sends a request to the C2 to drop the malicious file.</p>

<p><a href="/assets/images/malware-analysis/IcedID/amazon.jpg"><img src="/assets/images/malware-analysis/IcedID/amazon.jpg" alt="" /></a></p>

<p><a href="/assets/images/malware-analysis/IcedID/mislead.jpg"><img src="/assets/images/malware-analysis/IcedID/mislead.jpg" alt="" /></a></p>

<h2 id="playing-with-cookies">Playing with cookies</h2>

<p>This is first impression when you look to the function which manipulating the request cookies.</p>

<p><a href="/assets/images/malware-analysis/IcedID/cookies.jpg"><img src="/assets/images/malware-analysis/IcedID/playing.jpg" alt="" /></a></p>

<p><strong>IcedID</strong> sends 6 parameters in cookies after manipulating them numerically. I will give you a summary of them and why they are important then explain in details.</p>

<table>
  <thead>
    <tr>
      <th style="text-align: center">Name</th>
      <th style="text-align: left">Value</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">_gads</td>
      <td style="text-align: left">First DWORD from decoded config data(Campaign number), flag from inspecting server certificate,  number of milliseconds, sys info</td>
    </tr>
    <tr>
      <td style="text-align: center">_gat</td>
      <td style="text-align: left">Windows version info</td>
    </tr>
    <tr>
      <td style="text-align: center">_ga</td>
      <td style="text-align: left">Processor info via CPUID including hypervisor brand if available</td>
    </tr>
    <tr>
      <td style="text-align: center">_u</td>
      <td style="text-align: left">Computername, Username and VM detection</td>
    </tr>
    <tr>
      <td style="text-align: center">_io</td>
      <td style="text-align: left">Domain identifier from SID</td>
    </tr>
    <tr>
      <td style="text-align: center">_gid</td>
      <td style="text-align: left">Based on physical address of NIC</td>
    </tr>
  </tbody>
</table>

<h3 id="_gads">_gads</h3>

<ul>
  <li>
    <h4 id="campaign-number">Campaign number</h4>

    <p>I already explained it in the code above (Campaign number = 1694525507)</p>
  </li>
  <li>
    <h4 id="flag">flag</h4>

    <p>The value most of time = 1 because amazon server is always available</p>
  </li>
  <li>
    <h4 id="vm-detection">VM detection</h4>

    <p><code class="language-plaintext highlighter-rouge">GetTickCount64</code> retrieves the number of milliseconds that have elapsed since the system was started.</p>
  </li>
  <li>
    <h4 id="system-information">System information</h4>

    <p>Retrieves the specified system information.</p>

    <p><a href="/assets/images/malware-analysis/IcedID/sys_info.jpg"><img src="/assets/images/malware-analysis/IcedID/sys_info.jpg" alt="" /></a></p>
  </li>
</ul>

<h3 id="_gat">_gat</h3>

<p>Check version:</p>

<p><a href="/assets/images/malware-analysis/IcedID/GetVersion.jpg"><img src="/assets/images/malware-analysis/IcedID/GetVersion.jpg" alt="" /></a></p>

<h3 id="_ga">_ga</h3>

<p>Check cpu:</p>

<p><a href="/assets/images/malware-analysis/IcedID/cpu.jpg"><img src="/assets/images/malware-analysis/IcedID/cpu.jpg" alt="" /></a></p>

<h3 id="_u">_u</h3>

<ul>
  <li>
    <h4 id="computername">Computername</h4>

    <p><a href="/assets/images/malware-analysis/IcedID/computername.jpg"><img src="/assets/images/malware-analysis/IcedID/computername.jpg" alt="" /></a></p>
  </li>
  <li>
    <h4 id="username">Username</h4>

    <p><a href="/assets/images/malware-analysis/IcedID/useranme.jpg"><img src="/assets/images/malware-analysis/IcedID/useranme.jpg" alt="" /></a></p>
  </li>
  <li>
    <h4 id="vm-detection-1">VM detection</h4>

    <p>The last parameter is a bit tricky. I crossed reference the values then I found that:</p>

    <p><a href="/assets/images/malware-analysis/IcedID/vm detection.jpg"><img src="/assets/images/malware-analysis/IcedID/vm detection.jpg" alt="" /></a></p>

    <p>Its common to use <code class="language-plaintext highlighter-rouge">RDTSC</code> to get fine-grained timing information, where the overhead of a virtualization trap would be quite significant. Most common use is to have two <code class="language-plaintext highlighter-rouge">RDTSC</code> instructions with a small amount of code between them, taking the difference of the times as the elapsed time (number of cycles) for the code sequence.</p>

    <p>But in our case, this malware sleeps 4 times instead of calling it twice.</p>
  </li>
</ul>

<h3 id="_io">_io</h3>

<p>Check <strong>SID</strong>:</p>

<p><a href="/assets/images/malware-analysis/IcedID/sid.jpg"><img src="/assets/images/malware-analysis/IcedID/sid.jpg" alt="" /></a></p>

<h3 id="_gid">_gid</h3>

<p>The <code class="language-plaintext highlighter-rouge">GetAdaptersInfo</code> function retrieves adapter information for the local computer.</p>

<p><a href="/assets/images/malware-analysis/IcedID/gid.jpg"><img src="/assets/images/malware-analysis/IcedID/gid.jpg" alt="" /></a></p>

<p>The view from <a href="https://tria.ge/211215-qrtm9ahef3/behavioral1">sandbox</a> traffic.</p>

<p><a href="/assets/images/malware-analysis/IcedID/cookies.jpg"><img src="/assets/images/malware-analysis/IcedID/cookies.jpg" alt="" /></a></p>

<p>Now, the attacker knows almost all the information about the victim’s machine, and he is ready to drop a suitable malware to start <strong>Stage2</strong> depending on the campaign number that determines the attack behavior.</p>

<h2 id="connect-c2-server">Connect C2 server</h2>

<p>In this step, malware connect to C2 server.</p>

<p><a href="/assets/images/malware-analysis/IcedID/connect.jpg"><img src="/assets/images/malware-analysis/IcedID/connect.jpg" alt="" /></a></p>

<p>Then it drops the malicious file in <code class="language-plaintext highlighter-rouge">c:\\ProgramData\\</code>.</p>

<p><a href="/assets/images/malware-analysis/IcedID/data_dir.jpg"><img src="/assets/images/malware-analysis/IcedID/data_dir.jpg" alt="" /></a></p>

<p>Unfortunately, This is the end of analysis because the server is down. My next report will be about the second stage of the loader and an example of malware that can be downloaded from it. <strong>stay tuned for more</strong>. “إن شاء الله”</p>

<h1 id="conclusion">Conclusion</h1>

<ol>
  <li>Phishing mails drops malicious document</li>
  <li>Malicious document runs VBS script</li>
  <li>The script executes JavaScript code to drop dll file</li>
  <li>dll file connects to C2 server</li>
</ol>

<p>There are several steps you can take to protect against <strong>phishing</strong>:</p>

<ul>
  <li><strong>Do not reply</strong>, even if you recognize the sender as a well-known business or financial institution. If you have an account with this institution, contact them directly and ask them to verify the information included in the email.</li>
  <li><strong>Do not click any links</strong> provided in these emails.</li>
  <li><strong>Do not open any attachments</strong>. If you receive an attachment you are not expecting, confirm with the senders that they did indeed send the message and meant to send an attachment.</li>
  <li><strong>Do not enter your personal information or passwords on an untrusted Web site or form</strong> referenced in this email.</li>
  <li><strong>Delete the message</strong>.</li>
</ul>

<h1 id="iocs">IOCs</h1>

<blockquote>
  <blockquote>
    <p>Hash</p>

    <ul>
      <li>doc				 -&gt; 	f604ca55de802f334064610d65e23890ab81906cdac3f8a5c7c25126176289c8</li>
      <li>Packed dll       -&gt;     CFE2CAF566857C05A6A686CA296387C5E1BFDDA6915FF0ED984C1C53CD5192A3</li>
      <li>Unpacked dll  -&gt;     1A2A8F604B8E4917A7E5A2A8994F748B59CA435C8AABC6D3ED211C696B883BC4</li>
    </ul>
  </blockquote>

  <blockquote>
    <p>URLs</p>

    <ul>
      <li>maldonadoposts.com</li>
      <li>firenicatrible.com</li>
    </ul>
  </blockquote>

  <blockquote>
    <p>Files</p>

    <ul>
      <li>c:\users\public\youYou.jpg</li>
      <li>c:\users\%username%\documents\karolYouYou.hta</li>
    </ul>
  </blockquote>
</blockquote>

        
      </section>

      <footer class="page__meta">
        
        


  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-folder-open" aria-hidden="true"></i> Categories: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/categories/#malware-analysis" class="page__taxonomy-item" rel="tag">Malware Analysis</a>
    
    </span>
  </p>


        
          <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2022-03-17T00:00:00+00:00">March 17, 2022</time></p>
        
      </footer>

      

      
  <nav class="pagination">
    
      <a href="/malware%20analysis/HermeticWiper/" class="pagination--pager" title="HermeticWiper/FoxBlade Analysis (in-depth)
">Previous</a>
    
    
      <a href="#" class="pagination--pager disabled">Next</a>
    
  </nav>

    </div>

    
  </article>

  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
      
        
      
        
      
        
      
        
      
        
      
    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2022 Abdallah Elnoty. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a> &amp; <a href="https://mademistakes.com/work/minimal-mistakes-jekyll-theme/" rel="nofollow">Minimal Mistakes</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>
  <script src="https://kit.fontawesome.com/4eee35f757.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>







  </body>
</html>
