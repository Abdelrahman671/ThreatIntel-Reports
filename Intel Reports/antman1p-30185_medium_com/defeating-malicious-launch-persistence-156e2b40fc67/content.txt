<!doctype html><html lang="en"><head><title data-rh="true">Defeating Malicious Launch Persistence | by 4n7m4n | Medium</title><meta data-rh="true" charset="utf-8"/><meta data-rh="true" name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1,maximum-scale=1"/><meta data-rh="true" name="theme-color" content="#000000"/><meta data-rh="true" name="twitter:app:name:iphone" content="Medium"/><meta data-rh="true" name="twitter:app:id:iphone" content="828256236"/><meta data-rh="true" property="al:ios:app_name" content="Medium"/><meta data-rh="true" property="al:ios:app_store_id" content="828256236"/><meta data-rh="true" property="al:android:package" content="com.medium.reader"/><meta data-rh="true" property="fb:app_id" content="542599432471018"/><meta data-rh="true" property="og:site_name" content="Medium"/><meta data-rh="true" property="og:type" content="article"/><meta data-rh="true" property="article:published_time" content="2021-11-23T21:27:31.442Z"/><meta data-rh="true" name="title" content="Defeating Malicious Launch Persistence | by 4n7m4n | Medium"/><meta data-rh="true" property="og:title" content="Defeating Malicious Launch Persistence"/><meta data-rh="true" property="al:android:url" content="medium://p/156e2b40fc67"/><meta data-rh="true" property="al:ios:url" content="medium://p/156e2b40fc67"/><meta data-rh="true" property="al:android:app_name" content="Medium"/><meta data-rh="true" name="description" content="This research started with me looking for suggestions for my organization on mitigating launch persistence techniques for macOS. As a red team operator, sharing knowledge and recommendations with our…"/><meta data-rh="true" property="og:description" content="A New Mitigation Strategy for the most used macOS Persistence Technique"/><meta data-rh="true" property="og:url" content="https://antman1p-30185.medium.com/defeating-malicious-launch-persistence-156e2b40fc67"/><meta data-rh="true" property="al:web:url" content="https://antman1p-30185.medium.com/defeating-malicious-launch-persistence-156e2b40fc67"/><meta data-rh="true" property="og:image" content="https://miro.medium.com/v2/resize:fit:1200/1*Jn5o3_7Ori7R3FowlPkLiA.png"/><meta data-rh="true" property="article:author" content="https://antman1p-30185.medium.com"/><meta data-rh="true" name="author" content="4n7m4n"/><meta data-rh="true" name="robots" content="index,noarchive,follow,max-image-preview:large"/><meta data-rh="true" name="referrer" content="unsafe-url"/><meta data-rh="true" property="twitter:title" content="Defeating Malicious Launch Persistence"/><meta data-rh="true" name="twitter:site" content="@Medium"/><meta data-rh="true" name="twitter:app:url:iphone" content="medium://p/156e2b40fc67"/><meta data-rh="true" property="twitter:description" content="A New Mitigation Strategy for the most used macOS Persistence Technique"/><meta data-rh="true" name="twitter:image:src" content="https://miro.medium.com/v2/resize:fit:1200/1*Jn5o3_7Ori7R3FowlPkLiA.png"/><meta data-rh="true" name="twitter:card" content="summary_large_image"/><meta data-rh="true" name="twitter:creator" content="@antman1P"/><meta data-rh="true" name="twitter:label1" content="Reading time"/><meta data-rh="true" name="twitter:data1" content="11 min read"/><link data-rh="true" rel="icon" href="https://miro.medium.com/v2/5d8de952517e8160e40ef9841c781cdc14a5db313057fa3c3de41c6f5b494b19"/><link data-rh="true" rel="search" type="application/opensearchdescription+xml" title="Medium" href="/osd.xml"/><link data-rh="true" rel="apple-touch-icon" sizes="152x152" href="https://miro.medium.com/v2/resize:fill:304:304/10fd5c419ac61637245384e7099e131627900034828f4f386bdaa47a74eae156"/><link data-rh="true" rel="apple-touch-icon" sizes="120x120" href="https://miro.medium.com/v2/resize:fill:240:240/10fd5c419ac61637245384e7099e131627900034828f4f386bdaa47a74eae156"/><link data-rh="true" rel="apple-touch-icon" sizes="76x76" href="https://miro.medium.com/v2/resize:fill:152:152/10fd5c419ac61637245384e7099e131627900034828f4f386bdaa47a74eae156"/><link data-rh="true" rel="apple-touch-icon" sizes="60x60" href="https://miro.medium.com/v2/resize:fill:120:120/10fd5c419ac61637245384e7099e131627900034828f4f386bdaa47a74eae156"/><link data-rh="true" rel="mask-icon" href="https://miro.medium.com/v2/resize:fill:1000:1000/7*GAOKVe--MXbEJmV9230oOQ.png" color="#171717"/><link data-rh="true" rel="preconnect" href="https://glyph.medium.com" crossOrigin=""/><link data-rh="true" id="glyph_preload_link" rel="preload" as="style" type="text/css" href="https://glyph.medium.com/css/unbound.css"/><link data-rh="true" id="glyph_link" rel="stylesheet" type="text/css" href="https://glyph.medium.com/css/unbound.css"/><link data-rh="true" rel="author" href="https://antman1p-30185.medium.com"/><link data-rh="true" rel="canonical" href="https://antman1p-30185.medium.com/defeating-malicious-launch-persistence-156e2b40fc67"/><link data-rh="true" rel="alternate" href="android-app://com.medium.reader/https/medium.com/p/156e2b40fc67"/><script data-rh="true" type="application/ld+json">{"@context":"http:\u002F\u002Fschema.org","@type":"NewsArticle","image":["https:\u002F\u002Fmiro.medium.com\u002Fv2\u002Fresize:fit:1200\u002F1*Jn5o3_7Ori7R3FowlPkLiA.png"],"url":"https:\u002F\u002Fantman1p-30185.medium.com\u002Fdefeating-malicious-launch-persistence-156e2b40fc67","dateCreated":"2021-11-23T15:01:53.066Z","datePublished":"2021-11-23T15:01:53.066Z","dateModified":"2022-01-04T08:39:09.446Z","headline":"Defeating Malicious Launch Persistence - 4n7m4n - Medium","name":"Defeating Malicious Launch Persistence - 4n7m4n - Medium","description":"This research started with me looking for suggestions for my organization on mitigating launch persistence techniques for macOS. As a red team operator, sharing knowledge and recommendations with our…","identifier":"156e2b40fc67","author":{"@type":"Person","name":"4n7m4n","url":"https:\u002F\u002Fantman1p-30185.medium.com"},"creator":["4n7m4n"],"publisher":{"@type":"Organization","name":"Medium","url":"https:\u002F\u002Fantman1p-30185.medium.com\u002F","logo":{"@type":"ImageObject","width":272,"height":60,"url":"https:\u002F\u002Fmiro.medium.com\u002Fv2\u002Fresize:fit:544\u002F7*V1_7XP4snlmqrc_0Njontw.png"}},"mainEntityOfPage":"https:\u002F\u002Fantman1p-30185.medium.com\u002Fdefeating-malicious-launch-persistence-156e2b40fc67"}</script><style type="text/css" data-fela-rehydration="512" data-fela-type="STATIC">html{box-sizing:border-box;-webkit-text-size-adjust:100%}*, *:before, *:after{box-sizing:inherit}body{margin:0;padding:0;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;color:rgba(0,0,0,0.8);position:relative;min-height:100vh}h1, h2, h3, h4, h5, h6, dl, dd, ol, ul, menu, figure, blockquote, p, pre, form{margin:0}menu, ol, ul{padding:0;list-style:none;list-style-image:none}main{display:block}a{color:inherit;text-decoration:none}a, button, input{-webkit-tap-highlight-color:transparent}img, svg{vertical-align:middle}button{background:transparent;overflow:visible}button, input, optgroup, select, textarea{margin:0}:root{--reach-tabs:1;--reach-menu-button:1}#speechify-root{font-family:Sohne, sans-serif}div[data-popper-reference-hidden="true"]{visibility:hidden;pointer-events:none}.grecaptcha-badge{visibility:hidden}
/*XCode style (c) Angel Garcia <angelgarcia.mail@gmail.com>*/.hljs {background: #fff;color: black;
}/* Gray DOCTYPE selectors like WebKit */
.xml .hljs-meta {color: #c0c0c0;
}.hljs-comment,
.hljs-quote {color: #007400;
}.hljs-tag,
.hljs-attribute,
.hljs-keyword,
.hljs-selector-tag,
.hljs-literal,
.hljs-name {color: #aa0d91;
}.hljs-variable,
.hljs-template-variable {color: #3F6E74;
}.hljs-code,
.hljs-string,
.hljs-meta .hljs-string {color: #c41a16;
}.hljs-regexp,
.hljs-link {color: #0E0EFF;
}.hljs-title,
.hljs-symbol,
.hljs-bullet,
.hljs-number {color: #1c00cf;
}.hljs-section,
.hljs-meta {color: #643820;
}.hljs-title.class_,
.hljs-class .hljs-title,
.hljs-type,
.hljs-built_in,
.hljs-params {color: #5c2699;
}.hljs-attr {color: #836C28;
}.hljs-subst {color: #000;
}.hljs-formula {background-color: #eee;font-style: italic;
}.hljs-addition {background-color: #baeeba;
}.hljs-deletion {background-color: #ffc8bd;
}.hljs-selector-id,
.hljs-selector-class {color: #9b703f;
}.hljs-doctag,
.hljs-strong {font-weight: bold;
}.hljs-emphasis {font-style: italic;
}
</style><style type="text/css" data-fela-rehydration="512" data-fela-type="KEYFRAME">@-webkit-keyframes k1{0%{opacity:0.8}50%{opacity:0.5}100%{opacity:0.8}}@-moz-keyframes k1{0%{opacity:0.8}50%{opacity:0.5}100%{opacity:0.8}}@keyframes k1{0%{opacity:0.8}50%{opacity:0.5}100%{opacity:0.8}}</style><style type="text/css" data-fela-rehydration="512" data-fela-type="RULE">.a{font-family:medium-content-sans-serif-font, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif}.b{font-weight:400}.c{background-color:rgba(255, 255, 255, 1)}.l{display:block}.m{position:sticky}.n{top:0}.o{z-index:500}.p{padding:0 24px}.q{align-items:center}.r{border-bottom:solid 1px #F2F2F2}.y{height:41px}.z{line-height:20px}.ab{display:flex}.ac{height:57px}.ae{flex:1 0 auto}.af{color:inherit}.ag{fill:inherit}.ah{font-size:inherit}.ai{border:inherit}.aj{font-family:inherit}.ak{letter-spacing:inherit}.al{font-weight:inherit}.am{padding:0}.an{margin:0}.ao{cursor:pointer}.ap:disabled{cursor:not-allowed}.aq:disabled{color:#6B6B6B}.ar:disabled{fill:#6B6B6B}.au{width:auto}.av path{fill:#242424}.aw{height:25px}.ax{margin-left:16px}.ay{border:none}.az{border-radius:20px}.ba{width:240px}.bb{background:#F9F9F9}.bc path{fill:#6B6B6B}.be{outline:none}.bf{font-family:sohne, "Helvetica Neue", Helvetica, Arial, sans-serif}.bg{font-size:14px}.bh{width:100%}.bi{padding:10px 20px 10px 0}.bj{background-color:transparent}.bk{color:#242424}.bl::placeholder{color:#6B6B6B}.bm{display:inline-block}.bn{margin-left:12px}.bo{margin-right:12px}.bp{border-radius:4px}.bq{margin-left:24px}.br{height:24px}.bx{background-color:#F9F9F9}.by{border-radius:50%}.bz{height:32px}.ca{width:32px}.cb{justify-content:center}.ch{max-width:680px}.ci{min-width:0}.cj{animation:k1 1.2s ease-in-out infinite}.ck{height:100vh}.cl{margin-bottom:16px}.cm{margin-top:48px}.cn{align-items:flex-start}.co{flex-direction:column}.cp{justify-content:space-between}.cq{margin-bottom:24px}.cw{width:80%}.cx{background-color:#F2F2F2}.dd{height:44px}.de{width:44px}.df{margin:auto 0}.dg{margin-bottom:4px}.dh{height:16px}.di{width:120px}.dj{width:80px}.dp{margin-bottom:8px}.dq{width:96%}.dr{width:98%}.ds{width:81%}.dt{margin-left:8px}.du{color:#6B6B6B}.dv{font-size:13px}.dw{height:100%}.ep{color:#FFFFFF}.eq{fill:#FFFFFF}.er{background:#1A8917}.es{border-color:#1A8917}.ew:disabled{cursor:inherit !important}.ex:disabled{opacity:0.3}.ey:disabled:hover{background:#1A8917}.ez:disabled:hover{border-color:#1A8917}.fa{border-radius:99em}.fb{border-width:1px}.fc{border-style:solid}.fd{box-sizing:border-box}.fe{text-decoration:none}.ff{text-align:center}.fi{margin-right:32px}.fj{position:relative}.fk{fill:#6B6B6B}.fn{background:transparent}.fo svg{margin-left:4px}.fp svg{fill:#6B6B6B}.fr{box-shadow:inset 0 0 0 1px rgba(0, 0, 0, 0.05)}.fs{position:absolute}.fz{margin:0 24px}.gd{background:rgba(255, 255, 255, 1)}.ge{border:1px solid #F2F2F2}.gf{box-shadow:0 1px 4px #F2F2F2}.gg{max-height:100vh}.gh{overflow-y:auto}.gi{left:0}.gj{top:calc(100vh + 100px)}.gk{bottom:calc(100vh + 100px)}.gl{width:10px}.gm{pointer-events:none}.gn{word-break:break-word}.go{word-wrap:break-word}.gp:after{display:block}.gq:after{content:""}.gr:after{clear:both}.gs{margin-left:auto}.gt{margin-right:auto}.gu{max-width:1280px}.ha{clear:both}.hc{cursor:zoom-in}.hd{z-index:auto}.hf{max-width:100%}.hg{height:auto}.hh{line-height:1.23}.hi{letter-spacing:0}.hj{font-style:normal}.hk{font-weight:700}.if{margin-bottom:-0.27em}.ig{line-height:1.394}.jb{align-items:baseline}.jc{width:48px}.jd{height:48px}.je{border:2px solid rgba(255, 255, 255, 1)}.jf{z-index:0}.jg{box-shadow:none}.jh{border:1px solid rgba(0, 0, 0, 0.05)}.ji{margin-bottom:2px}.jj{flex-wrap:nowrap}.jk{font-size:16px}.jl{line-height:24px}.jn{margin:0 8px}.jo{display:inline}.jp{color:#1A8917}.jq{fill:#1A8917}.jt{flex:0 0 auto}.jw{flex-wrap:wrap}.jx{padding-left:8px}.jy{padding-right:8px}.kz> *{flex-shrink:0}.la{overflow-x:scroll}.lb::-webkit-scrollbar{display:none}.lc{scrollbar-width:none}.ld{-ms-overflow-style:none}.le{width:74px}.lf{flex-direction:row}.lg{z-index:2}.lh{margin-right:4px}.lk{-webkit-user-select:none}.ll{border:0}.lm{fill:rgba(117, 117, 117, 1)}.lp{outline:0}.lq{user-select:none}.lr> svg{pointer-events:none}.ma{cursor:progress}.mb{opacity:1}.mc{padding:4px 0}.mf{margin-top:0px}.mg{width:16px}.mi{display:inline-flex}.mo{padding:8px 2px}.mp svg{color:#6B6B6B}.ng{line-height:1.18}.nh{letter-spacing:-0.022em}.ni{font-weight:600}.ob{margin-bottom:-0.31em}.oc{line-height:1.58}.od{letter-spacing:-0.004em}.oe{font-family:source-serif-pro, Georgia, Cambria, "Times New Roman", Times, serif}.ou{margin-bottom:-0.46em}.pa{text-decoration:underline}.pb{background:none}.pc{margin-top:32px}.pd{margin-bottom:14px}.pe{padding-top:24px}.pf{padding-bottom:10px}.pg{background-color:#000000}.ph{height:3px}.pi{width:3px}.pj{margin-right:20px}.pk{padding:2px 4px}.pl{font-size:75%}.pm> strong{font-family:inherit}.pn{font-family:source-code-pro, Menlo, Monaco, "Courier New", Courier, monospace}.po{font-style:italic}.pp{max-width:367px}.pv{margin-top:10px}.pw{max-width:728px}.pz{list-style-type:decimal}.qa{margin-left:30px}.qb{padding-left:0px}.qh{max-width:545px}.qi{max-width:265px}.qj{max-width:1600px}.qk{margin-bottom:26px}.ql{margin-top:6px}.qm{margin-top:8px}.qn{margin-right:8px}.qo{padding:8px 16px}.qp{border-radius:100px}.qq{transition:background 300ms ease}.qs{white-space:nowrap}.qt{border-top:none}.qz{height:52px}.ra{max-height:52px}.rb{box-sizing:content-box}.rc{position:static}.rd{z-index:1}.rf{max-width:155px}.rq{align-items:flex-end}.rr{width:76px}.rs{height:76px}.rt{border:2px solid #F9F9F9}.ru{height:72px}.rv{width:72px}.rw{stroke:#F2F2F2}.rx{height:36px}.ry{width:36px}.rz{color:#F2F2F2}.sa{fill:#F2F2F2}.sb{background:#F2F2F2}.sc{border-color:#F2F2F2}.si{font-weight:500}.sj{font-size:24px}.sk{line-height:30px}.sl{letter-spacing:-0.016em}.sm{margin-top:16px}.sn{height:0px}.so{border-bottom:solid 1px #E5E5E5}.sp{margin-top:72px}.sq{padding:24px 0}.sr{margin-bottom:0px}.ss{margin-right:16px}.as:hover:not(:disabled){color:rgba(25, 25, 25, 1)}.at:hover:not(:disabled){fill:rgba(25, 25, 25, 1)}.et:hover{background:#156D12}.eu:hover{border-color:#156D12}.ev:hover{cursor:pointer}.fl:hover{color:#242424}.fm:hover{fill:#242424}.fq:hover svg{fill:#242424}.ft:hover{background-color:rgba(0, 0, 0, 0.1)}.jm:hover{text-decoration:underline}.jr:hover:not(:disabled){color:#156D12}.js:hover:not(:disabled){fill:#156D12}.lo:hover{fill:rgba(8, 8, 8, 1)}.md:hover{fill:#000000}.me:hover p{color:#000000}.mh:hover{color:#000000}.mq:hover svg{color:#000000}.qr:hover{background-color:#F2F2F2}.sd:hover{background:#F2F2F2}.se:hover{border-color:#F2F2F2}.sf:hover{cursor:wait}.sg:hover{color:#F2F2F2}.sh:hover{fill:#F2F2F2}.bd:focus-within path{fill:#242424}.he:focus{transform:scale(1.01)}.ln:focus{fill:rgba(8, 8, 8, 1)}.mr:focus svg{color:#000000}.ls:active{border-style:none}</style><style type="text/css" data-fela-rehydration="512" data-fela-type="RULE" media="all and (min-width: 1080px)">.d{display:none}.bw{width:64px}.cg{margin:0 64px}.cv{height:48px}.dc{margin-bottom:52px}.do{margin-bottom:48px}.ef{font-size:14px}.eg{line-height:20px}.em{font-size:13px}.eo{padding:5px 12px}.fh{display:flex}.fy{margin-bottom:68px}.gc{max-width:680px}.gz{margin-top:40px}.ib{font-size:42px}.ic{margin-top:1em}.id{line-height:52px}.ie{letter-spacing:-0.011em}.it{font-size:22px}.iu{margin-top:0.92em}.iv{line-height:28px}.ja{align-items:center}.kl{border-top:solid 1px #F2F2F2}.km{border-bottom:solid 1px #F2F2F2}.kn{margin:32px 0 0}.ko{padding:3px 8px}.kx> *{margin-right:24px}.ky> :last-child{margin-right:0}.lz{margin-top:0px}.mn{margin:0}.nx{font-size:20px}.ny{margin-top:1.72em}.nz{line-height:24px}.oa{letter-spacing:0}.or{margin-top:0.94em}.os{line-height:32px}.ot{letter-spacing:-0.003em}.oz{margin-top:2.14em}.pu{margin-top:56px}.qg{margin-top:1.14em}.qy{margin-bottom:88px}.rk{display:inline-block}.rp{padding-top:72px}</style><style type="text/css" data-fela-rehydration="512" data-fela-type="RULE" media="all and (max-width: 1079.98px)">.e{display:none}.ly{margin-top:0px}.px{margin-left:auto}.py{text-align:center}.rj{display:inline-block}</style><style type="text/css" data-fela-rehydration="512" data-fela-type="RULE" media="all and (max-width: 903.98px)">.f{display:none}.lx{margin-top:0px}.ri{display:inline-block}</style><style type="text/css" data-fela-rehydration="512" data-fela-type="RULE" media="all and (max-width: 727.98px)">.g{display:none}.lv{margin-top:0px}.lw{margin-right:0px}.rh{display:inline-block}</style><style type="text/css" data-fela-rehydration="512" data-fela-type="RULE" media="all and (max-width: 551.98px)">.h{display:none}.s{display:flex}.t{justify-content:space-between}.bs{width:24px}.cc{margin:0 24px}.cr{height:40px}.cy{margin-bottom:44px}.dk{margin-bottom:32px}.dx{font-size:13px}.dy{line-height:20px}.eh{padding:0px 8px 1px}.fu{margin-bottom:4px}.gv{margin-top:32px}.hl{font-size:32px}.hm{margin-top:1.01em}.hn{line-height:38px}.ho{letter-spacing:-0.014em}.ih{font-size:18px}.ii{margin-top:0.79em}.ij{line-height:24px}.iw{align-items:flex-start}.ju{flex-direction:column}.jz{margin:24px -24px 0}.ka{padding:0}.kp> *{margin-right:8px}.kq> :last-child{margin-right:24px}.li{margin-left:0px}.lt{margin-top:0px}.lu{margin-right:0px}.mj{margin:0}.ms{border:1px solid #F2F2F2}.mt{border-radius:99em}.mu{padding:0px 16px 0px 12px}.mv{height:38px}.mw{align-items:center}.my svg{margin-right:8px}.nj{font-size:16px}.nk{margin-top:1.23em}.nl{letter-spacing:0}.of{margin-top:0.67em}.og{line-height:28px}.oh{letter-spacing:-0.003em}.ov{margin-top:1.56em}.pq{margin-top:40px}.qc{margin-top:1.34em}.qu{margin-bottom:80px}.rg{display:inline-block}.rl{padding-top:48px}.mx:hover{border-color:#E5E5E5}</style><style type="text/css" data-fela-rehydration="512" data-fela-type="RULE" media="all and (min-width: 904px) and (max-width: 1079.98px)">.i{display:none}.bv{width:64px}.cf{margin:0 64px}.cu{height:48px}.db{margin-bottom:52px}.dn{margin-bottom:48px}.ed{font-size:14px}.ee{line-height:20px}.ek{font-size:13px}.el{padding:5px 12px}.fg{display:flex}.fx{margin-bottom:68px}.gb{max-width:680px}.gy{margin-top:40px}.hx{font-size:42px}.hy{margin-top:1em}.hz{line-height:52px}.ia{letter-spacing:-0.011em}.iq{font-size:22px}.ir{margin-top:0.92em}.is{line-height:28px}.iz{align-items:center}.kh{border-top:solid 1px #F2F2F2}.ki{border-bottom:solid 1px #F2F2F2}.kj{margin:32px 0 0}.kk{padding:3px 8px}.kv> *{margin-right:24px}.kw> :last-child{margin-right:0}.mm{margin:0}.nt{font-size:20px}.nu{margin-top:1.72em}.nv{line-height:24px}.nw{letter-spacing:0}.oo{margin-top:0.94em}.op{line-height:32px}.oq{letter-spacing:-0.003em}.oy{margin-top:2.14em}.pt{margin-top:56px}.qf{margin-top:1.14em}.qx{margin-bottom:88px}.ro{padding-top:72px}</style><style type="text/css" data-fela-rehydration="512" data-fela-type="RULE" media="all and (min-width: 728px) and (max-width: 903.98px)">.j{display:none}.w{display:flex}.x{justify-content:space-between}.bu{width:64px}.ce{margin:0 48px}.ct{height:48px}.da{margin-bottom:52px}.dm{margin-bottom:48px}.eb{font-size:13px}.ec{line-height:20px}.ej{padding:0px 8px 1px}.fw{margin-bottom:68px}.ga{max-width:680px}.gx{margin-top:40px}.ht{font-size:42px}.hu{margin-top:1em}.hv{line-height:52px}.hw{letter-spacing:-0.011em}.in{font-size:22px}.io{margin-top:0.92em}.ip{line-height:28px}.iy{align-items:center}.kd{border-top:solid 1px #F2F2F2}.ke{border-bottom:solid 1px #F2F2F2}.kf{margin:32px 0 0}.kg{padding:3px 8px}.kt> *{margin-right:24px}.ku> :last-child{margin-right:0}.ml{margin:0}.np{font-size:20px}.nq{margin-top:1.72em}.nr{line-height:24px}.ns{letter-spacing:0}.ol{margin-top:0.94em}.om{line-height:32px}.on{letter-spacing:-0.003em}.ox{margin-top:2.14em}.ps{margin-top:56px}.qe{margin-top:1.14em}.qw{margin-bottom:88px}.rn{padding-top:72px}</style><style type="text/css" data-fela-rehydration="512" data-fela-type="RULE" media="all and (min-width: 552px) and (max-width: 727.98px)">.k{display:none}.u{display:flex}.v{justify-content:space-between}.bt{width:24px}.cd{margin:0 24px}.cs{height:40px}.cz{margin-bottom:44px}.dl{margin-bottom:32px}.dz{font-size:13px}.ea{line-height:20px}.ei{padding:0px 8px 1px}.fv{margin-bottom:4px}.gw{margin-top:32px}.hp{font-size:32px}.hq{margin-top:1.01em}.hr{line-height:38px}.hs{letter-spacing:-0.014em}.ik{font-size:18px}.il{margin-top:0.79em}.im{line-height:24px}.ix{align-items:flex-start}.jv{flex-direction:column}.kb{margin:24px 0 0}.kc{padding:0}.kr> *{margin-right:8px}.ks> :last-child{margin-right:8px}.lj{margin-left:0px}.mk{margin:0}.mz{border:1px solid #F2F2F2}.na{border-radius:99em}.nb{padding:0px 16px 0px 12px}.nc{height:38px}.nd{align-items:center}.nf svg{margin-right:8px}.nm{font-size:16px}.nn{margin-top:1.23em}.no{letter-spacing:0}.oi{margin-top:0.67em}.oj{line-height:28px}.ok{letter-spacing:-0.003em}.ow{margin-top:1.56em}.pr{margin-top:40px}.qd{margin-top:1.34em}.qv{margin-bottom:80px}.rm{padding-top:48px}.ne:hover{border-color:#E5E5E5}</style><style type="text/css" data-fela-rehydration="512" data-fela-type="RULE" media="print">.re{display:none}</style><style type="text/css" data-fela-rehydration="512" data-fela-type="RULE" media="(prefers-reduced-motion: no-preference)">.hb{transition:transform 300ms cubic-bezier(0.2, 0, 0.2, 1)}</style></head><body><div id="root"><div class="a b c"><div class="d e f g h i j k"></div><script>document.domain = document.domain;</script><div class="l c"><div class="l m n o c"><div class="p q r s t u v w x i d y z"><a class="du ag dv bf ak b am an ao ap aq ar as at s u w i d q dw z" href="https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F156e2b40fc67&amp;%7Efeature=LoOpenInAppButton&amp;%7Echannel=ShowPostUnderUser&amp;source=---top_nav_layout_nav----------------------------------" rel="noopener follow">Open in app<svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" fill="none" viewBox="0 0 10 10" class="dt"><path fill="currentColor" d="M.985 8.485a.375.375 0 1 0 .53.53zM8.75 1.25h.375A.375.375 0 0 0 8.75.875zM8.375 6.5a.375.375 0 1 0 .75 0zM3.5.875a.375.375 0 1 0 0 .75zm-1.985 8.14 7.5-7.5-.53-.53-7.5 7.5zm6.86-7.765V6.5h.75V1.25zM3.5 1.625h5.25v-.75H3.5z"></path></svg></a><div class="ab q"><p class="bf b dx dy dz ea eb ec ed ee ef eg du"><span><button class="bf b dx dy eh dz ea ei eb ec ej ek ee el em eg eo ep eq er es et eu ev ew ex ey ez fa fb fc fd bm fe ff" data-testid="headerSignUpButton">Sign up</button></span></p><div class="ax l"><p class="bf b dx dy dz ea eb ec ed ee ef eg du"><span><a class="af ag ah ai aj ak al am an ao ap aq ar as at" data-testid="headerSignInButton" href="https://medium.com/m/signin?operation=login&amp;redirect=https%3A%2F%2Fantman1p-30185.medium.com%2Fdefeating-malicious-launch-persistence-156e2b40fc67&amp;source=post_page---top_nav_layout_nav-----------------------global_nav-----------" rel="noopener follow">Sign in</a></span></p></div></div></div><div class="p q r ab ac"><div class="ab q ae"><a class="af ag ah ai aj ak al am an ao ap aq ar as at ab" aria-label="Homepage" data-testid="headerMediumLogo" href="https://medium.com/?source=---top_nav_layout_nav----------------------------------" rel="noopener follow"><svg xmlns="http://www.w3.org/2000/svg" width="719" height="160" fill="none" viewBox="0 0 719 160" class="au av aw"><path fill="#242424" d="m174.104 9.734.215-.047V8.02H130.39L89.6 103.89 48.81 8.021H1.472v1.666l.212.047c8.018 1.81 12.09 4.509 12.09 14.242V137.93c0 9.734-4.087 12.433-12.106 14.243l-.212.047v1.671h32.118v-1.665l-.213-.048c-8.018-1.809-12.089-4.509-12.089-14.242V30.586l52.399 123.305h2.972l53.925-126.743V140.75c-.687 7.688-4.721 10.062-11.982 11.701l-.215.05v1.652h55.948v-1.652l-.215-.05c-7.269-1.639-11.4-4.013-12.087-11.701l-.037-116.774h.037c0-9.733 4.071-12.432 12.087-14.242m25.555 75.488c.915-20.474 8.268-35.252 20.606-35.507 3.806.063 6.998 1.312 9.479 3.714 5.272 5.118 7.751 15.812 7.368 31.793zm-.553 5.77h65.573v-.275c-.186-15.656-4.721-27.834-13.466-36.196-7.559-7.227-18.751-11.203-30.507-11.203h-.263c-6.101 0-13.584 1.48-18.909 4.16-6.061 2.807-11.407 7.003-15.855 12.511-7.161 8.874-11.499 20.866-12.554 34.343q-.05.606-.092 1.212a50 50 0 0 0-.065 1.151 85.807 85.807 0 0 0-.094 5.689c.71 30.524 17.198 54.917 46.483 54.917 25.705 0 40.675-18.791 44.407-44.013l-1.886-.664c-6.557 13.556-18.334 21.771-31.738 20.769-18.297-1.369-32.314-19.922-31.042-42.395m139.722 41.359c-2.151 5.101-6.639 7.908-12.653 7.908s-11.513-4.129-15.418-11.63c-4.197-8.053-6.405-19.436-6.405-32.92 0-28.067 8.729-46.22 22.24-46.22 5.657 0 10.111 2.807 12.236 7.704zm43.499 20.008c-8.019-1.897-12.089-4.722-12.089-14.951V1.309l-48.716 14.353v1.757l.299-.024c6.72-.543 11.278.386 13.925 2.83 2.072 1.915 3.082 4.853 3.082 8.987v18.66c-4.803-3.067-10.516-4.56-17.448-4.56-14.059 0-26.909 5.92-36.176 16.672-9.66 11.205-14.767 26.518-14.767 44.278-.003 31.72 15.612 53.039 38.851 53.039 13.595 0 24.533-7.449 29.54-20.013v16.865h43.711v-1.746zM424.1 19.819c0-9.904-7.468-17.374-17.375-17.374-9.859 0-17.573 7.632-17.573 17.374s7.721 17.374 17.573 17.374c9.907 0 17.375-7.47 17.375-17.374m11.499 132.546c-8.019-1.897-12.089-4.722-12.089-14.951h-.035V43.635l-43.714 12.551v1.705l.263.024c9.458.842 12.047 4.1 12.047 15.152v81.086h43.751v-1.746zm112.013 0c-8.018-1.897-12.089-4.722-12.089-14.951V43.635l-41.621 12.137v1.71l.246.026c7.733.813 9.967 4.257 9.967 15.36v59.279c-2.578 5.102-7.415 8.131-13.274 8.336-9.503 0-14.736-6.419-14.736-18.073V43.638l-43.714 12.55v1.703l.262.024c9.459.84 12.05 4.097 12.05 15.152v50.17a56.3 56.3 0 0 0 .91 10.444l.787 3.423c3.701 13.262 13.398 20.197 28.59 20.197 12.868 0 24.147-7.966 29.115-20.43v17.311h43.714v-1.747zm169.818 1.788v-1.749l-.213-.05c-8.7-2.006-12.089-5.789-12.089-13.49v-63.79c0-19.89-11.171-31.761-29.883-31.761-13.64 0-25.141 7.882-29.569 20.16-3.517-13.01-13.639-20.16-28.606-20.16-13.146 0-23.449 6.938-27.869 18.657V43.643L545.487 55.68v1.715l.263.024c9.345.829 12.047 4.181 12.047 14.95v81.784h40.787v-1.746l-.215-.053c-6.941-1.631-9.181-4.606-9.181-12.239V66.998c1.836-4.289 5.537-9.37 12.853-9.37 9.086 0 13.692 6.296 13.692 18.697v77.828h40.797v-1.746l-.215-.053c-6.94-1.631-9.18-4.606-9.18-12.239V75.066a42 42 0 0 0-.578-7.26c1.947-4.661 5.86-10.177 13.475-10.177 9.214 0 13.691 6.114 13.691 18.696v77.828z"></path></svg></a><div class="ax h"><div class="ab ay az ba bb q bc bd"><div class="bm" aria-hidden="false" aria-describedby="searchResults" aria-labelledby="searchResults"></div><div class="bn bo ab"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.092 11.06a6.95 6.95 0 1 1 13.9 0 6.95 6.95 0 0 1-13.9 0m6.95-8.05a8.05 8.05 0 1 0 5.13 14.26l3.75 3.75a.56.56 0 1 0 .79-.79l-3.73-3.73A8.05 8.05 0 0 0 11.042 3z" clip-rule="evenodd"></path></svg></div><input role="combobox" aria-controls="searchResults" aria-expanded="false" aria-label="search" data-testid="headerSearchInput" tabindex="0" class="ay be bf bg z bh bi bj bk bl" placeholder="Search" value=""/></div></div></div><div class="h k w fg fh"><div class="fi ab"><span><a class="af ag ah ai aj ak al am an ao ap aq ar as at" data-testid="headerWriteButton" href="https://medium.com/m/signin?operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2Fnew-story&amp;source=---top_nav_layout_nav-----------------------new_post_topnav-----------" rel="noopener follow"><div class="bf b bg z du fj fk ab q fl fm"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" aria-label="Write"><path fill="currentColor" d="M14 4a.5.5 0 0 0 0-1zm7 6a.5.5 0 0 0-1 0zm-7-7H4v1h10zM3 4v16h1V4zm1 17h16v-1H4zm17-1V10h-1v10zm-1 1a1 1 0 0 0 1-1h-1zM3 20a1 1 0 0 0 1 1v-1zM4 3a1 1 0 0 0-1 1h1z"></path><path stroke="currentColor" d="m17.5 4.5-8.458 8.458a.25.25 0 0 0-.06.098l-.824 2.47a.25.25 0 0 0 .316.316l2.47-.823a.25.25 0 0 0 .098-.06L19.5 6.5m-2-2 2.323-2.323a.25.25 0 0 1 .354 0l1.646 1.646a.25.25 0 0 1 0 .354L19.5 6.5m-2-2 2 2"></path></svg><div class="dt l">Write</div></div></a></span></div></div><div class="k j i d"><div class="fi ab"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" data-testid="headerSearchButton" href="https://medium.com/search?source=---top_nav_layout_nav----------------------------------" rel="noopener follow"><div class="bf b bg z du fj fk ab q fl fm"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" aria-label="Search"><path fill="currentColor" fill-rule="evenodd" d="M4.092 11.06a6.95 6.95 0 1 1 13.9 0 6.95 6.95 0 0 1-13.9 0m6.95-8.05a8.05 8.05 0 1 0 5.13 14.26l3.75 3.75a.56.56 0 1 0 .79-.79l-3.73-3.73A8.05 8.05 0 0 0 11.042 3z" clip-rule="evenodd"></path></svg></div></a></div></div><div class="fi h k j"><div class="ab q"><p class="bf b dx dy dz ea eb ec ed ee ef eg du"><span><button class="bf b dx dy eh dz ea ei eb ec ej ek ee el em eg eo ep eq er es et eu ev ew ex ey ez fa fb fc fd bm fe ff" data-testid="headerSignUpButton">Sign up</button></span></p><div class="ax l"><p class="bf b dx dy dz ea eb ec ed ee ef eg du"><span><a class="af ag ah ai aj ak al am an ao ap aq ar as at" data-testid="headerSignInButton" href="https://medium.com/m/signin?operation=login&amp;redirect=https%3A%2F%2Fantman1p-30185.medium.com%2Fdefeating-malicious-launch-persistence-156e2b40fc67&amp;source=post_page---top_nav_layout_nav-----------------------global_nav-----------" rel="noopener follow">Sign in</a></span></p></div></div></div><div class="l" aria-hidden="false"><button class="ay fn am ab q ao fo fp fq" aria-label="user options menu" data-testid="headerUserIcon"><div class="l fj"><img alt="" class="l fd by bz ca cx" src="https://miro.medium.com/v2/resize:fill:64:64/1*dmbNkD5D-u45r44go_cf0g.png" width="32" height="32" loading="lazy" role="presentation"/><div class="fr by l bz ca fs n ay ft"></div></div></button></div></div></div><div class="l"><div class="fu fv fw fx fy l"><div class="ab cb"><div class="ci bh fz ga gb gc"></div></div><article><div class="l"><div class="l"><span class="l"></span><section><div><div class="fs gi gj gk gl gm"></div><div class="gn go gp gq gr"><div class="ab cb"><div class="ci bh fz ga gb gc"><figure class="gv gw gx gy gz ha gs gt paragraph-image"><div role="button" tabindex="0" class="hb hc fj hd bh he"><div class="gs gt gu"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*Jn5o3_7Ori7R3FowlPkLiA.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*Jn5o3_7Ori7R3FowlPkLiA.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*Jn5o3_7Ori7R3FowlPkLiA.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*Jn5o3_7Ori7R3FowlPkLiA.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*Jn5o3_7Ori7R3FowlPkLiA.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*Jn5o3_7Ori7R3FowlPkLiA.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Jn5o3_7Ori7R3FowlPkLiA.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*Jn5o3_7Ori7R3FowlPkLiA.png 640w, https://miro.medium.com/v2/resize:fit:720/1*Jn5o3_7Ori7R3FowlPkLiA.png 720w, https://miro.medium.com/v2/resize:fit:750/1*Jn5o3_7Ori7R3FowlPkLiA.png 750w, https://miro.medium.com/v2/resize:fit:786/1*Jn5o3_7Ori7R3FowlPkLiA.png 786w, https://miro.medium.com/v2/resize:fit:828/1*Jn5o3_7Ori7R3FowlPkLiA.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*Jn5o3_7Ori7R3FowlPkLiA.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*Jn5o3_7Ori7R3FowlPkLiA.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"/><img alt="" class="bh hf hg c" width="700" height="350" loading="eager" role="presentation"/></picture></div></div></figure><div><h1 id="647d" class="pw-post-title hh hi hj bf hk hl hm hn ho hp hq hr hs ht hu hv hw hx hy hz ia ib ic id ie if bk" data-testid="storyTitle">Defeating Malicious Launch Persistence</h1></div><div><h2 id="522f" class="pw-subtitle-paragraph ig hi hj bf b ih ii ij ik il im in io ip iq ir is it iu iv cq du">A New Mitigation Strategy for the most used macOS Persistence Technique</h2><div><div class="speechify-ignore ab cp"><div class="speechify-ignore bh l"><div class="iw ix iy iz ja ab"><div><div class="ab jb"><a rel="noopener follow" href="/?source=post_page-----156e2b40fc67--------------------------------"><div><div class="bm" aria-hidden="false"><div class="l jc jd by je jf"><div class="l fj"><img alt="4n7m4n" class="l fd by dd de cx" src="https://miro.medium.com/v2/resize:fill:88:88/1*0EACXzt6sjlhQSMHVCyseQ.jpeg" width="44" height="44" loading="lazy" data-testid="authorPhoto"/><div class="jg by l dd de fs n jh ft"></div></div></div></div></div></a></div></div><div class="bn bh l"><div class="ab"><div style="flex:1"><span class="bf b bg z bk"><div class="ji ab q"><div class="ab q jj"><div class="ab q"><div><div class="bm" aria-hidden="false"><p class="bf b jk jl bk"><a class="af ag ah ai aj ak al am an ao ap aq ar jm" data-testid="authorName" rel="noopener follow" href="/?source=post_page-----156e2b40fc67--------------------------------">4n7m4n</a></p></div></div></div><span class="jn jo" aria-hidden="true"><span class="bf b bg z du">·</span></span><p class="bf b jk jl du"><span><a class="jp jq ah ai aj ak al am an ao ap aq ar ex jr js" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F6933f3d65c15&amp;operation=register&amp;redirect=https%3A%2F%2Fantman1p-30185.medium.com%2Fdefeating-malicious-launch-persistence-156e2b40fc67&amp;user=4n7m4n&amp;userId=6933f3d65c15&amp;source=post_page-6933f3d65c15----156e2b40fc67---------------------post_header-----------" rel="noopener follow">Follow</a></span></p></div></div></span></div></div><div class="l jt"><span class="bf b bg z du"><div class="ab cn ju jv jw"><span class="bf b bg z du"><div class="ab ae"><span data-testid="storyReadTime">11 min read</span><div class="jx jy l" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bf b bg z du">·</span></span></div><span data-testid="storyPublishDate">Nov 23, 2021</span></div></span></div></span></div></div></div><div class="ab cp jz ka kb kc kd ke kf kg kh ki kj kk kl km kn ko"><div class="h k w fg fh q"><div class="le l"><div class="ab q lf lg"><div class="pw-multi-vote-icon fj lh li lj lk"><span><a class="af ag ah ai aj ak al am an ao ap aq ar as at" data-testid="headerClapButton" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Fp%2F156e2b40fc67&amp;operation=register&amp;redirect=https%3A%2F%2Fantman1p-30185.medium.com%2Fdefeating-malicious-launch-persistence-156e2b40fc67&amp;user=4n7m4n&amp;userId=6933f3d65c15&amp;source=-----156e2b40fc67---------------------clap_footer-----------" rel="noopener follow"><div><div class="bm" aria-hidden="false"><div class="ll ao lm ln lo lp am lq lr ls lk"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM13.916 3.953l1.523-2.112-1.184-.39zM8.589 1.84l1.522 2.112-.337-2.501zM18.523 18.92c-.86.86-1.75 1.246-2.62 1.33a6 6 0 0 0 .407-.372c2.388-2.389 2.86-4.951 1.399-7.623l-.912-1.603-.79-1.672c-.26-.56-.194-.98.203-1.288a.7.7 0 0 1 .546-.132c.283.046.546.231.728.5l2.363 4.157c.976 1.624 1.141 4.237-1.324 6.702m-10.999-.438L3.37 14.328a.828.828 0 0 1 .585-1.408.83.83 0 0 1 .585.242l2.158 2.157a.365.365 0 0 0 .516-.516l-2.157-2.158-1.449-1.449a.826.826 0 0 1 1.167-1.17l3.438 3.44a.363.363 0 0 0 .516 0 .364.364 0 0 0 0-.516L5.293 9.513l-.97-.97a.826.826 0 0 1 0-1.166.84.84 0 0 1 1.167 0l.97.968 3.437 3.436a.36.36 0 0 0 .517 0 .366.366 0 0 0 0-.516L6.977 7.83a.82.82 0 0 1-.241-.584.82.82 0 0 1 .824-.826c.219 0 .43.087.584.242l5.787 5.787a.366.366 0 0 0 .587-.415l-1.117-2.363c-.26-.56-.194-.98.204-1.289a.7.7 0 0 1 .546-.132c.283.046.545.232.727.501l2.193 3.86c1.302 2.38.883 4.59-1.277 6.75-1.156 1.156-2.602 1.627-4.19 1.367-1.418-.236-2.866-1.033-4.079-2.246M10.75 5.971l2.12 2.12c-.41.502-.465 1.17-.128 1.89l.22.465-3.523-3.523a.8.8 0 0 1-.097-.368c0-.22.086-.428.241-.584a.847.847 0 0 1 1.167 0m7.355 1.705c-.31-.461-.746-.758-1.23-.837a1.44 1.44 0 0 0-1.11.275c-.312.24-.505.543-.59.881a1.74 1.74 0 0 0-.906-.465 1.47 1.47 0 0 0-.82.106l-2.182-2.182a1.56 1.56 0 0 0-2.2 0 1.54 1.54 0 0 0-.396.701 1.56 1.56 0 0 0-2.21-.01 1.55 1.55 0 0 0-.416.753c-.624-.624-1.649-.624-2.237-.037a1.557 1.557 0 0 0 0 2.2c-.239.1-.501.238-.715.453a1.56 1.56 0 0 0 0 2.2l.516.515a1.556 1.556 0 0 0-.753 2.615L7.01 19c1.32 1.319 2.909 2.189 4.475 2.449q.482.08.971.08c.85 0 1.653-.198 2.393-.579.231.033.46.054.686.054 1.266 0 2.457-.52 3.505-1.567 2.763-2.763 2.552-5.734 1.439-7.586z" clip-rule="evenodd"></path></svg></div></div></div></a></span></div><div class="pw-multi-vote-count l lt lu lv lw lx ly lz"><p class="bf b dv z du"><span class="ma">--</span></p></div></div></div><div><div class="bm" aria-hidden="false"><button class="ao ll mb mc ab q fk md me" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="mf"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"></path></svg></button></div></div></div><div class="ab q kp kq kr ks kt ku kv kw kx ky kz la lb lc ld"><div class="mg k j i d"></div><div class="h k"><div><div class="bm" aria-hidden="false"><span><a class="af ag ah ai aj ak al am an ao ap aq ar as at" data-testid="headerBookmarkButton" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F156e2b40fc67&amp;operation=register&amp;redirect=https%3A%2F%2Fantman1p-30185.medium.com%2Fdefeating-malicious-launch-persistence-156e2b40fc67&amp;source=-----156e2b40fc67---------------------bookmark_footer-----------" rel="noopener follow"><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="none" viewBox="0 0 25 25" class="du mh" aria-label="Add to list bookmark button"><path fill="currentColor" d="M18 2.5a.5.5 0 0 1 1 0V5h2.5a.5.5 0 0 1 0 1H19v2.5a.5.5 0 1 1-1 0V6h-2.5a.5.5 0 0 1 0-1H18zM7 7a1 1 0 0 1 1-1h3.5a.5.5 0 0 0 0-1H8a2 2 0 0 0-2 2v14a.5.5 0 0 0 .805.396L12.5 17l5.695 4.396A.5.5 0 0 0 19 21v-8.5a.5.5 0 0 0-1 0v7.485l-5.195-4.012a.5.5 0 0 0-.61 0L7 19.985z"></path></svg></a></span></div></div></div><div class="fd mi cn"><div class="l ae"><div class="ab cb"><div class="mj mk ml mm mn hf ci bh"><div class="ab"><div class="bm bh" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="Listen" data-testid="audioPlayButton" class="af fk ah ai aj ak al mo an ao ap ex mp mq me mr ms mt mu mv s mw mx my mz na nb nc u nd ne nf"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"></path></svg><div class="j i d"><p class="bf b bg z du">Listen</p></div></button></div></div></div></div></div></div></div></div><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="af fk ah ai aj ak al mo an ao ap ex mp mq me mr ms mt mu mv s mw mx my mz na nb nc u nd ne nf"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"></path></svg><div class="j i d"><p class="bf b bg z du">Share</p></div></button></div></div></div></div></div></div></div></div></div><h2 id="eb66" class="ng nh hj bf ni nj nk dy nl nm nn ea no np nq nr ns nt nu nv nw nx ny nz oa ob bk">Why Launch Persistence Research?</h2><p id="0eb3" class="pw-post-body-paragraph oc od hj oe b ih of og oh ik oi oj ok np ol om on nt oo op oq nx or os ot ou gn bk">This research started with me looking for suggestions for my organization on mitigating launch persistence techniques for macOS. As a red team operator, sharing knowledge and recommendations with our security organizations is crucial to making our customers safer.</p><p id="b6c2" class="pw-post-body-paragraph oc od hj oe b ih ov og oh ik ow oj ok np ox om on nt oy op oq nx oz os ot ou gn bk">I took a look at the <a class="af pa" href="https://attack.mitre.org/matrices/enterprise/macos/" rel="noopener ugc nofollow" target="_blank">macOS MITRE ATT&amp;CK matrix</a> for the persistence tactic (<a class="af pa" href="https://attack.mitre.org/tactics/TA0003/" rel="noopener ugc nofollow" target="_blank">TA003</a>), its launch persistence technique which MITRE calls &quot;Create or Modify System Process&quot; (<a class="af pa" href="https://attack.mitre.org/techniques/T1543/" rel="noopener ugc nofollow" target="_blank">T1543</a>), and more specifically, the “Launch Agent” (<a class="af pa" href="https://attack.mitre.org/techniques/T1543/001/" rel="noopener ugc nofollow" target="_blank">T1543.001</a>) and “Launch Daemon” (<a class="af pa" href="https://attack.mitre.org/techniques/T1543/004/" rel="noopener ugc nofollow" target="_blank">T1543.004</a>) sub techniques. Collectively I am calling these two sub-techniques “launch persistence.” Patrick Wardle calls launch persistence “launch items.” Still, I want to ensure no confusion between these and “login items” or “startup items,” which are entirely different persistence mechanisms.</p><p id="9173" class="pw-post-body-paragraph oc od hj oe b ih ov og oh ik ow oj ok np ox om on nt oy op oq nx oz os ot ou gn bk">MITRE suggested setting group policies for mitigation to block launch persistence behavior. The problem was that I hadn&#x27;t heard of any organization doing this, and I could not find any reference for this from MITRE or otherwise.</p><p id="45e0" class="pw-post-body-paragraph oc od hj oe b ih ov og oh ik ow oj ok np ox om on nt oy op oq nx oz os ot ou gn bk">I started asking around, and no one could tell me how any organization does this. So, I decided to figure out how an enterprise could mitigate launch persistence at scale.</p><p id="56f6" class="pw-post-body-paragraph oc od hj oe b ih ov og oh ik ow oj ok np ox om on nt oy op oq nx oz os ot ou gn bk">Upon discovering this new mitigation method, I reached out to my friend <a class="af pa" href="https://twitter.com/jbradley89" rel="noopener ugc nofollow" target="_blank">Jaron Bradley</a> at <a class="af pa" href="https://twitter.com/JamfSoftware" rel="noopener ugc nofollow" target="_blank">Jamf</a> Protect to see if he knew if my approach was possible using an MDM solution like Jamf Pro. He connected me with <span class="jo"><span class="jo" aria-hidden="false"><a class="pb jp fe" href="https://medium.com/u/3f436b2de07e?source=post_page-----156e2b40fc67--------------------------------" rel="noopener" target="_blank">Matthew Benyo</a></span></span>, also from Jamf, who I teamed up with on this blog. <a class="af pa" href="https://twitter.com/mattbenyo" rel="noopener ugc nofollow" target="_blank">Matt </a>describes how to prepare this method using Jamf Pro in his section below.</p><p id="371e" class="pw-post-body-paragraph oc od hj oe b ih ov og oh ik ow oj ok np ox om on nt oy op oq nx oz os ot ou gn bk">I also reached out to <span class="jo"><span class="jo" aria-hidden="false"><a class="pb jp fe" href="https://medium.com/u/727c9e5054e4?source=post_page-----156e2b40fc67--------------------------------" rel="noopener" target="_blank">Cat Self</a></span></span>, macOS lead for MITRE ATT&amp;CK, for some leads in the macOS community. She was a great help in tracking down some individuals with experience in macOS administration who I was able to bounce my mitigation idea off of for a sanity check. Thank you, <a class="af pa" href="https://twitter.com/coolestcatiknow" rel="noopener ugc nofollow" target="_blank">Cat</a>!</p><p id="c258" class="pw-post-body-paragraph oc od hj oe b ih ov og oh ik ow oj ok np ox om on nt oy op oq nx oz os ot ou gn bk">The first section of this blog will cover persistence, launch agents, and why it is important to mitigate the techniques. So, if you already understand this or don’t want/need a refresher, you can skip to the next section.</p></div></div></div><div class="ab cb pc pd pe pf" role="separator"><span class="pg by bm ph pi pj"></span><span class="pg by bm ph pi pj"></span><span class="pg by bm ph pi"></span></div><div class="gn go gp gq gr"><div class="ab cb"><div class="ci bh fz ga gb gc"><h2 id="3020" class="ng nh hj bf ni nj nk dy nl nm nn ea no np nq nr ns nt nu nv nw nx ny nz oa ob bk">Persistence</h2><p id="130b" class="pw-post-body-paragraph oc od hj oe b ih of og oh ik oi oj ok np ol om on nt oo op oq nx or os ot ou gn bk">Persistence is a vital tactic in the adversarial kill chain. It is typically the next step after initial access and payload/malware execution. &quot;Persistence is the means by which malware ensures that it will be automatically (re)executed by the operating system on system startup or user (re)login&quot; (Wardle, 2020, p. 2). Most malware attempts to gain persistence. Otherwise, a system reboot would kill access to the infected system.</p><h2 id="8d4b" class="ng nh hj bf ni nj nk dy nl nm nn ea no np nq nr ns nt nu nv nw nx ny nz oa ob bk">Launch Persistence and launchd</h2><p id="5220" class="pw-post-body-paragraph oc od hj oe b ih of og oh ik oi oj ok np ol om on nt oo op oq nx or os ot ou gn bk">Launch persistence includes launch agents and launch daemons. “Launch items are the Apple recommended way to persist non-application binaries (e.g., software updates, background processes, etc)” (Wardle, 2020, p. 5).</p><p id="0491" class="pw-post-body-paragraph oc od hj oe b ih ov og oh ik ow oj ok np ox om on nt oy op oq nx oz os ot ou gn bk"><strong class="oe hk">How does this work?</strong> After system boot and during system initialization, launchd searches the <code class="cx pk pl pm pn b"><em class="po">/System/Library/LaunchDaemons/</em></code><em class="po"> </em>and the root<em class="po"> </em><code class="cx pk pl pm pn b"><em class="po">/Library/LaunchDaemons/</em></code><em class="po"> </em>directories for property list files (plists) and launches the daemon that the plist requests to be running at all times. These are launch daemons.</p><p id="1f62" class="pw-post-body-paragraph oc od hj oe b ih ov og oh ik ow oj ok np ox om on nt oy op oq nx oz os ot ou gn bk">When a user logs in, macOS starts a per-user launchd. This launchd launches the agent requested to be launched on-demand from the property list files found in <code class="cx pk pl pm pn b">/System/Library/LaunchAgents</code>, the root <code class="cx pk pl pm pn b">/Library/LaunchAgents</code>, and the user’s <code class="cx pk pl pm pn b">~/Library/LaunchAgents</code> directory. These are launch agents.</p><h2 id="8df9" class="ng nh hj bf ni nj nk dy nl nm nn ea no np nq nr ns nt nu nv nw nx ny nz oa ob bk">Property Lists (plists)</h2><p id="9147" class="pw-post-body-paragraph oc od hj oe b ih of og oh ik oi oj ok np ol om on nt oo op oq nx or os ot ou gn bk">Property lists are very important to understand when discussing launch persistence because they describe the launch persistence to launchd. A plist is typically an XML document that contains key/value pairs. A plist can also be in JSON format, and in more rare cases a binary. We will just focus on the XML plists for this article.</p><p id="83ca" class="pw-post-body-paragraph oc od hj oe b ih ov og oh ik ow oj ok np ox om on nt oy op oq nx oz os ot ou gn bk">To view the contents of a plist in human-readable form use the following commands:</p><p id="ecee" class="pw-post-body-paragraph oc od hj oe b ih ov og oh ik ow oj ok np ox om on nt oy op oq nx oz os ot ou gn bk"><code class="cx pk pl pm pn b">plutil -p &lt;path to plist&gt;</code></p><p id="176f" class="pw-post-body-paragraph oc od hj oe b ih ov og oh ik ow oj ok np ox om on nt oy op oq nx oz os ot ou gn bk"><code class="cx pk pl pm pn b">defaults read &lt;path to plist&gt;</code></p><p id="34e5" class="pw-post-body-paragraph oc od hj oe b ih ov og oh ik ow oj ok np ox om on nt oy op oq nx oz os ot ou gn bk"><code class="cx pk pl pm pn b">cat &lt;path to plist&gt;</code></p><figure class="pq pr ps pt pu ha gs gt paragraph-image"><div class="gs gt pp"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*MmWRFSEMiO6JzvT9ULXCYA.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*MmWRFSEMiO6JzvT9ULXCYA.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*MmWRFSEMiO6JzvT9ULXCYA.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*MmWRFSEMiO6JzvT9ULXCYA.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*MmWRFSEMiO6JzvT9ULXCYA.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*MmWRFSEMiO6JzvT9ULXCYA.png 1100w, https://miro.medium.com/v2/resize:fit:734/format:webp/1*MmWRFSEMiO6JzvT9ULXCYA.png 734w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 367px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*MmWRFSEMiO6JzvT9ULXCYA.png 640w, https://miro.medium.com/v2/resize:fit:720/1*MmWRFSEMiO6JzvT9ULXCYA.png 720w, https://miro.medium.com/v2/resize:fit:750/1*MmWRFSEMiO6JzvT9ULXCYA.png 750w, https://miro.medium.com/v2/resize:fit:786/1*MmWRFSEMiO6JzvT9ULXCYA.png 786w, https://miro.medium.com/v2/resize:fit:828/1*MmWRFSEMiO6JzvT9ULXCYA.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*MmWRFSEMiO6JzvT9ULXCYA.png 1100w, https://miro.medium.com/v2/resize:fit:734/1*MmWRFSEMiO6JzvT9ULXCYA.png 734w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 367px"/><img alt="" class="bh hf hg c" width="367" height="276" loading="lazy" role="presentation"/></picture></div><figcaption class="pv ff pw gs gt px py bf b bg z du">Example Property List</figcaption></figure><p id="f6f5" class="pw-post-body-paragraph oc od hj oe b ih ov og oh ik ow oj ok np ox om on nt oy op oq nx oz os ot ou gn bk">In terms of persistence, the most pertinent key/value pairs include:</p><ol class=""><li id="662c" class="oc od hj oe b ih ov og oh ik ow oj ok np ox om on nt oy op oq nx oz os ot ou pz qa qb bk"><strong class="oe hk">Key</strong>: Program or Program Arguments. <strong class="oe hk">Value</strong>: Path to launch persistence’s script or binary to execute.</li><li id="8486" class="oc od hj oe b ih qc og oh ik qd oj ok np qe om on nt qf op oq nx qg os ot ou pz qa qb bk"><strong class="oe hk">Key</strong>: RunAtLoad. <strong class="oe hk">Value</strong>: Contains a boolean that, if set to <em class="po">true, </em>instructs launchd to automatically launch the launch persistence. The malware will be persistently restarted by macOS at system reboot at user re-login.</li><li id="4785" class="oc od hj oe b ih qc og oh ik qd oj ok np qe om on nt qf op oq nx qg os ot ou pz qa qb bk"><strong class="oe hk">Key</strong>: Label. <strong class="oe hk">Value</strong>: The job name. “This key is required for every job definition. It identifies the job and has to be unique for the launchd instance. Theoretically, it is possible for an agent to have the same label as a daemon, as daemons are loaded by the root launchd whereas agents are loaded by a user launchd, but it is not recommended by convention job names are written in <a class="af pa" href="http://en.wikipedia.org/wiki/Reverse_domain_name_notation" rel="noopener ugc nofollow" target="_blank"><strong class="oe hk">reverse domain notation</strong></a>” (Soma-Zone, <em class="po">What is Launchd?</em>). For example <em class="po">com.redteam.evil</em>. For private agents, the domain local is a good choice: <em class="po">local.cleanup.</em></li></ol><p id="5116" class="pw-post-body-paragraph oc od hj oe b ih ov og oh ik ow oj ok np ox om on nt oy op oq nx oz os ot ou gn bk">These three key/value pairs are all that is needed to create launch persistence.</p><h2 id="1741" class="ng nh hj bf ni nj nk dy nl nm nn ea no np nq nr ns nt nu nv nw nx ny nz oa ob bk">Launch Persistence and Malware</h2><p id="cd75" class="pw-post-body-paragraph oc od hj oe b ih of og oh ik oi oj ok np ol om on nt oo op oq nx or os ot ou gn bk">To persist as a launch agent, malware can create a plist in the <em class="po">LaunchAgents</em> directories, and for a launch daemon, it can do the same in the <em class="po">LaunchDaemons </em>directory. Malware can create its persistence in the same manner as Apple recommends developers create persistence for their legitimate applications.</p><p id="ca98" class="pw-post-body-paragraph oc od hj oe b ih ov og oh ik ow oj ok np ox om on nt oy op oq nx oz os ot ou gn bk">Apple’s own Launch Agents live in the <code class="cx pk pl pm pn b">/System/Library/LaunchAgents</code> directory while Launch Daemons live in <code class="cx pk pl pm pn b">/System/Library/LaunchDaemons</code>. “Since the introduction of System Integrity Protection (SIP) in OS X 10.11 (El Capitan) these OS directories are now protected, therefore malware cannot modify them (i.e., they cannot create a “system” Launch Persistence). As such, malware is now constrained to creating launch persistence in the /Library or ~/Library directories” (Wardle, 2020, p. 6).</p><p id="7494" class="pw-post-body-paragraph oc od hj oe b ih ov og oh ik ow oj ok np ox om on nt oy op oq nx oz os ot ou gn bk">Most macOS malware persists using launch persistence. In 2020, 80% of persistent malware persisted via launch persistence. According to “<a class="af pa" href="https://objective-see.com/blog/blog_0x53.html" rel="noopener ugc nofollow" target="_blank">The Mac Malware of 2019</a>” report, all persistent malware persisted via launch persistence. Needless to say, this is a critical technique for organizations to mitigate.</p></div></div></div><div class="ab cb pc pd pe pf" role="separator"><span class="pg by bm ph pi pj"></span><span class="pg by bm ph pi pj"></span><span class="pg by bm ph pi"></span></div><div class="gn go gp gq gr"><div class="ab cb"><div class="ci bh fz ga gb gc"><h2 id="e935" class="ng nh hj bf ni nj nk dy nl nm nn ea no np nq nr ns nt nu nv nw nx ny nz oa ob bk">Mitigation</h2><p id="5675" class="pw-post-body-paragraph oc od hj oe b ih of og oh ik oi oj ok np ol om on nt oo op oq nx or os ot ou gn bk">To mitigate the adversarial launch persistence techniques on our home computers, we can use <a class="af pa" href="https://twitter.com/patrickwardle" rel="noopener ugc nofollow" target="_blank">Patrick Wardle</a> of <a class="af pa" href="https://objective-see.com/index.html" rel="noopener ugc nofollow" target="_blank">Objective-See</a>’s Free and Open Sourced tool, <a class="af pa" href="https://objective-see.com/products/blockblock.html" rel="noopener ugc nofollow" target="_blank">BlockBlock</a>. BlockBlock monitors common persistence locations and alerts whenever a persistent component is added. BlockBlock is a fantastic tool and is excellent for use on your personal mac, but it isn’t scalable to the enterprise. We need something that will block an adversary from creating a plist in the launch persistence directories.</p><h2 id="2410" class="ng nh hj bf ni nj nk dy nl nm nn ea no np nq nr ns nt nu nv nw nx ny nz oa ob bk">Enterprise Mitigation</h2><p id="d692" class="pw-post-body-paragraph oc od hj oe b ih of og oh ik oi oj ok np ol om on nt oo op oq nx or os ot ou gn bk">What I have found in my research is that we can lock the root-level launch persistence directories (<code class="cx pk pl pm pn b">/Library/Launch(Agents || Daemons)</code>) using a macOS mobile device management (MDM) solution. Assuming that the user of this managed machine does not have access to the local administrative (root) user account on this machine, the MDM admin(s) can lock these launch persistence directories using the root account. Now, only the owner of these directories (root) can unlock them. As it stands, malware, even running as root, would need to unlock the directory, and then create its launch persistence plist in the unlocked directory. I have not seen macOS malware with this bit of sophistication in the wild.</p><h2 id="cb1d" class="ng nh hj bf ni nj nk dy nl nm nn ea no np nq nr ns nt nu nv nw nx ny nz oa ob bk">What do you mean by “locked?”</h2><p id="f7f2" class="pw-post-body-paragraph oc od hj oe b ih of og oh ik oi oj ok np ol om on nt oo op oq nx or os ot ou gn bk">Files and directories on macOS have a flag called the <code class="cx pk pl pm pn b">uchg</code>, or user immutable flag. If one sets this flag, then the file or directory is “locked.” If set, this immutable bit means that the associated file or folder cannot be changed. If we set this user immutable bit on the root launch persistence directories, nothing can add to or remove from the directories. Malware cannot add a plist, which means, without additional actions, no additional launch persistence files can be added.</p><p id="6a04" class="pw-post-body-paragraph oc od hj oe b ih ov og oh ik ow oj ok np ox om on nt oy op oq nx oz os ot ou gn bk">We can check if a file/directory has the <code class="cx pk pl pm pn b">uchg</code> flag set by listing the file using the <code class="cx pk pl pm pn b">ls</code> command with the <code class="cx pk pl pm pn b">-O</code> option:</p><p id="4349" class="pw-post-body-paragraph oc od hj oe b ih ov og oh ik ow oj ok np ox om on nt oy op oq nx oz os ot ou gn bk"><code class="cx pk pl pm pn b">ls -O &lt;path/to/file/dir&gt;</code></p><figure class="pq pr ps pt pu ha gs gt paragraph-image"><div class="gs gt qh"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*54zSwFkUcpspvZGHNLR72w.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*54zSwFkUcpspvZGHNLR72w.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*54zSwFkUcpspvZGHNLR72w.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*54zSwFkUcpspvZGHNLR72w.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*54zSwFkUcpspvZGHNLR72w.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*54zSwFkUcpspvZGHNLR72w.png 1100w, https://miro.medium.com/v2/resize:fit:1090/format:webp/1*54zSwFkUcpspvZGHNLR72w.png 1090w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 545px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*54zSwFkUcpspvZGHNLR72w.png 640w, https://miro.medium.com/v2/resize:fit:720/1*54zSwFkUcpspvZGHNLR72w.png 720w, https://miro.medium.com/v2/resize:fit:750/1*54zSwFkUcpspvZGHNLR72w.png 750w, https://miro.medium.com/v2/resize:fit:786/1*54zSwFkUcpspvZGHNLR72w.png 786w, https://miro.medium.com/v2/resize:fit:828/1*54zSwFkUcpspvZGHNLR72w.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*54zSwFkUcpspvZGHNLR72w.png 1100w, https://miro.medium.com/v2/resize:fit:1090/1*54zSwFkUcpspvZGHNLR72w.png 1090w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 545px"/><img alt="" class="bh hf hg c" width="545" height="31" loading="lazy" role="presentation"/></picture></div><figcaption class="pv ff pw gs gt px py bf b bg z du">LauchAgents directory is immutable</figcaption></figure><p id="0a1f" class="pw-post-body-paragraph oc od hj oe b ih ov og oh ik ow oj ok np ox om on nt oy op oq nx oz os ot ou gn bk">We can set or unset this immutable bit using the default macOS tool, <code class="cx pk pl pm pn b">chflags</code>.</p><p id="43c2" class="pw-post-body-paragraph oc od hj oe b ih ov og oh ik ow oj ok np ox om on nt oy op oq nx oz os ot ou gn bk">To add the immutable bit:</p><p id="9587" class="pw-post-body-paragraph oc od hj oe b ih ov og oh ik ow oj ok np ox om on nt oy op oq nx oz os ot ou gn bk"><code class="cx pk pl pm pn b">$ chflags uchg /Library/LauchAgents</code></p><p id="25e4" class="pw-post-body-paragraph oc od hj oe b ih ov og oh ik ow oj ok np ox om on nt oy op oq nx oz os ot ou gn bk">To remove it:</p><p id="a9ff" class="pw-post-body-paragraph oc od hj oe b ih ov og oh ik ow oj ok np ox om on nt oy op oq nx oz os ot ou gn bk"><code class="cx pk pl pm pn b">$ chflags nouchg /Library/LauchAgents</code></p><p id="207e" class="pw-post-body-paragraph oc od hj oe b ih ov og oh ik ow oj ok np ox om on nt oy op oq nx oz os ot ou gn bk">You can also change the bit using the file information window, which you can access by pressing <code class="cx pk pl pm pn b">command + i</code> . You can then check or uncheck the “Locked” check box. This method is not helpful in using an MDM for scripting the locking at scale but works if you’d like to do it on your personal macOS machine.</p><figure class="pq pr ps pt pu ha gs gt paragraph-image"><div class="gs gt qi"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*UxCbFAYrPDF2xGze8d69VQ.jpeg 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*UxCbFAYrPDF2xGze8d69VQ.jpeg 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*UxCbFAYrPDF2xGze8d69VQ.jpeg 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*UxCbFAYrPDF2xGze8d69VQ.jpeg 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*UxCbFAYrPDF2xGze8d69VQ.jpeg 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*UxCbFAYrPDF2xGze8d69VQ.jpeg 1100w, https://miro.medium.com/v2/resize:fit:530/format:webp/1*UxCbFAYrPDF2xGze8d69VQ.jpeg 530w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 265px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*UxCbFAYrPDF2xGze8d69VQ.jpeg 640w, https://miro.medium.com/v2/resize:fit:720/1*UxCbFAYrPDF2xGze8d69VQ.jpeg 720w, https://miro.medium.com/v2/resize:fit:750/1*UxCbFAYrPDF2xGze8d69VQ.jpeg 750w, https://miro.medium.com/v2/resize:fit:786/1*UxCbFAYrPDF2xGze8d69VQ.jpeg 786w, https://miro.medium.com/v2/resize:fit:828/1*UxCbFAYrPDF2xGze8d69VQ.jpeg 828w, https://miro.medium.com/v2/resize:fit:1100/1*UxCbFAYrPDF2xGze8d69VQ.jpeg 1100w, https://miro.medium.com/v2/resize:fit:530/1*UxCbFAYrPDF2xGze8d69VQ.jpeg 530w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 265px"/><img alt="" class="bh hf hg c" width="265" height="707" loading="lazy" role="presentation"/></picture></div><figcaption class="pv ff pw gs gt px py bf b bg z du">Unlocked LaunchAgents directory via File Information</figcaption></figure><h2 id="83fb" class="ng nh hj bf ni nj nk dy nl nm nn ea no np nq nr ns nt nu nv nw nx ny nz oa ob bk">Will this break application functionality?</h2><p id="c034" class="pw-post-body-paragraph oc od hj oe b ih of og oh ik oi oj ok np ol om on nt oo op oq nx or os ot ou gn bk">When I told my colleagues about this mitigation method, they expressed concerns for legitimate applications that edit the plists they have created in the launch persistence directories. If an application loses its ability to write to its plist, this mitigation method might break application functionality. I agreed and did some testing.</p><p id="b55a" class="pw-post-body-paragraph oc od hj oe b ih ov og oh ik ow oj ok np ox om on nt oy op oq nx oz os ot ou gn bk">It turns out that with the immutable bit set, I was still able to edit and completely overwrite a plist inside these locked directories. So, even though nothing can add or remove a file in the locked launch persistence directories, one can still change the files inside. While this is excellent news for my mitigation method, this seems like immutable does not equal immutable. <em class="po">I reported this as a bug to Apple on 11/8/2021 and am awaiting a response.</em></p><p id="c016" class="pw-post-body-paragraph oc od hj oe b ih ov og oh ik ow oj ok np ox om on nt oy op oq nx oz os ot ou gn bk">Note: <span class="jo"><span class="jo" aria-hidden="false"><a class="pb jp fe" href="https://medium.com/u/3f436b2de07e?source=post_page-----156e2b40fc67--------------------------------" rel="noopener" target="_blank">Matthew Benyo</a></span></span> informed me that one could use <code class="cx pk pl pm pn b">chflags -R uchg /Library/LauchAgents</code> (<code class="cx pk pl pm pn b">-R</code> option) and this will recursively lock the directory and all of its contents. However, because many services frequently update their plists this option is not ideal in that it may break service/application functionality.</p><h2 id="5af4" class="ng nh hj bf ni nj nk dy nl nm nn ea no np nq nr ns nt nu nv nw nx ny nz oa ob bk">What about the USER LaunchAgents directory?</h2><p id="b0c8" class="pw-post-body-paragraph oc od hj oe b ih of og oh ik oi oj ok np ol om on nt oo op oq nx or os ot ou gn bk">So, the local user account doesn’t own the root launch persistence directories. Therefore it cannot unlock the folder. Still, since the user owns the <code class="cx pk pl pm pn b">/Users/&lt;username&gt;/Library/LaunchAgents</code> directory, they can just unlock it, negating the mitigation in userland. This user LaunchAgent directory might not be necessary for an enterprise environment. Most approved software that I’ve seen lately in an enterprise environment doesn’t need to install persistence here, so we need a way to lock it down permanently.</p><p id="d4da" class="pw-post-body-paragraph oc od hj oe b ih ov og oh ik ow oj ok np ox om on nt oy op oq nx oz os ot ou gn bk">Our MDM solution can create an unprivileged user account on each managed macOS system. Using this unprivileged administrative account, the MDM administrator can create the LaunchAgent directory for our real user and change ownership of the directory to the unprivileged administrative user account. The MDM administrator can then lock the directory. Now the actual user cannot unlock the directory because they, again, do not own it.</p><p id="0546" class="pw-post-body-paragraph oc od hj oe b ih ov og oh ik ow oj ok np ox om on nt oy op oq nx oz os ot ou gn bk">This new unprivileged administrative user can be considered a honey-user account. Defense should monitor it, and any attempts to log in to the account should create an alert and probably be regarded as malicious.</p><h2 id="714c" class="ng nh hj bf ni nj nk dy nl nm nn ea no np nq nr ns nt nu nv nw nx ny nz oa ob bk">How do we do this at scale?</h2><p id="c44c" class="pw-post-body-paragraph oc od hj oe b ih of og oh ik oi oj ok np ol om on nt oo op oq nx or os ot ou gn bk">Applications only need to add/create a plist to the root launch persistence directories at install time. If your IT administrators manage installations, they can install approved software using an MDM solution with scripting capabilities.</p><p id="9f41" class="pw-post-body-paragraph oc od hj oe b ih ov og oh ik ow oj ok np ox om on nt oy op oq nx oz os ot ou gn bk">To explain how an administrator can configure this in an enterprise environment, I have teamed up with <span class="jo"><span class="jo" aria-hidden="false"><a class="pb jp fe" href="https://medium.com/u/3f436b2de07e?source=post_page-----156e2b40fc67--------------------------------" rel="noopener" target="_blank">Matthew Benyo</a></span></span> from <a class="af pa" href="https://www.jamf.com/products/jamf-pro/" rel="noopener ugc nofollow" target="_blank">Jamf</a>.</p></div></div></div><div class="ab cb pc pd pe pf" role="separator"><span class="pg by bm ph pi pj"></span><span class="pg by bm ph pi pj"></span><span class="pg by bm ph pi"></span></div><div class="gn go gp gq gr"><div class="ab cb"><div class="ci bh fz ga gb gc"><h2 id="d402" class="ng nh hj bf ni nj nk dy nl nm nn ea no np nq nr ns nt nu nv nw nx ny nz oa ob bk">Protecting Launch Directories with Jamf Pro</h2><p id="21e6" class="pw-post-body-paragraph oc od hj oe b ih of og oh ik oi oj ok np ol om on nt oo op oq nx or os ot ou gn bk">The following is an example of how an admin might use Jamf Pro to lock the <code class="cx pk pl pm pn b">LaunchDaemon </code>and <code class="cx pk pl pm pn b">LaunchAgent </code>directories across a macOS fleet. This workflow highlights key Jamf Pro features, including scripting via the Jamf Pro binary, reporting and monitoring via custom inventory attributes, and scoping actions with a dynamic Smart Computer Group.</p><h2 id="fc10" class="ng nh hj bf ni nj nk dy nl nm nn ea no np nq nr ns nt nu nv nw nx ny nz oa ob bk">Reporting on uchg Status</h2><p id="ae19" class="pw-post-body-paragraph oc od hj oe b ih of og oh ik oi oj ok np ol om on nt oo op oq nx or os ot ou gn bk">The first step of the Jamf Pro workflow is to be able to determine whether the launch persistence directories have been <code class="cx pk pl pm pn b">uchg </code>locked. We do this by creating a Jamf Pro Extension Attribute that is updated during the routine Jamf Pro inventory update. This custom inventory attribute checks the <code class="cx pk pl pm pn b">uchg </code>status of the launch persistence directories and updates each computer’s inventory record.</p><p id="c699" class="pw-post-body-paragraph oc od hj oe b ih ov og oh ik ow oj ok np ox om on nt oy op oq nx oz os ot ou gn bk">As Anthony demonstrated, you can see the <code class="cx pk pl pm pn b">uchg</code> status by listing the file or directory using the ls command with the <code class="cx pk pl pm pn b">-lO</code> option: <code class="cx pk pl pm pn b">ls -lO &lt;path/to/file/dir&gt;</code> .</p><p id="1e32" class="pw-post-body-paragraph oc od hj oe b ih ov og oh ik ow oj ok np ox om on nt oy op oq nx oz os ot ou gn bk">In this example, we have created a custom Extension Attribute called “Launch Persistence Directories”. The Extension Attributes work by running a snippet of bash script that checks the <code class="cx pk pl pm pn b">uchg</code> status of each launch persistence directory location and returns the result.</p><figure class="pq pr ps pt pu ha gs gt paragraph-image"><div role="button" tabindex="0" class="hb hc fj hd bh he"><div class="gs gt qj"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*RlyKmER6ZnreA2QkwdHReA.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*RlyKmER6ZnreA2QkwdHReA.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*RlyKmER6ZnreA2QkwdHReA.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*RlyKmER6ZnreA2QkwdHReA.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*RlyKmER6ZnreA2QkwdHReA.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*RlyKmER6ZnreA2QkwdHReA.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RlyKmER6ZnreA2QkwdHReA.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*RlyKmER6ZnreA2QkwdHReA.png 640w, https://miro.medium.com/v2/resize:fit:720/1*RlyKmER6ZnreA2QkwdHReA.png 720w, https://miro.medium.com/v2/resize:fit:750/1*RlyKmER6ZnreA2QkwdHReA.png 750w, https://miro.medium.com/v2/resize:fit:786/1*RlyKmER6ZnreA2QkwdHReA.png 786w, https://miro.medium.com/v2/resize:fit:828/1*RlyKmER6ZnreA2QkwdHReA.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*RlyKmER6ZnreA2QkwdHReA.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*RlyKmER6ZnreA2QkwdHReA.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"/><img alt="" class="bh hf hg c" width="700" height="438" loading="lazy" role="presentation"/></picture></div></div></figure><p id="6383" class="pw-post-body-paragraph oc od hj oe b ih ov og oh ik ow oj ok np ox om on nt oy op oq nx oz os ot ou gn bk">We can check the flags of a file or directory by running ls with the -Ol flag. We can then grab the <code class="cx pk pl pm pn b">uchg</code> flag status by using <code class="cx pk pl pm pn b">awk</code> to capture the fifth column, put that output into variables, and then test the variable values for the substring <code class="cx pk pl pm pn b">uchg</code>.</p><figure class="pq pr ps pt pu ha gs gt paragraph-image"><div role="button" tabindex="0" class="hb hc fj hd bh he"><div class="gs gt qj"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*_2emNE2vaJH_gJgloPFYyg.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*_2emNE2vaJH_gJgloPFYyg.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*_2emNE2vaJH_gJgloPFYyg.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*_2emNE2vaJH_gJgloPFYyg.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*_2emNE2vaJH_gJgloPFYyg.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*_2emNE2vaJH_gJgloPFYyg.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*_2emNE2vaJH_gJgloPFYyg.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*_2emNE2vaJH_gJgloPFYyg.png 640w, https://miro.medium.com/v2/resize:fit:720/1*_2emNE2vaJH_gJgloPFYyg.png 720w, https://miro.medium.com/v2/resize:fit:750/1*_2emNE2vaJH_gJgloPFYyg.png 750w, https://miro.medium.com/v2/resize:fit:786/1*_2emNE2vaJH_gJgloPFYyg.png 786w, https://miro.medium.com/v2/resize:fit:828/1*_2emNE2vaJH_gJgloPFYyg.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*_2emNE2vaJH_gJgloPFYyg.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*_2emNE2vaJH_gJgloPFYyg.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"/><img alt="" class="bh hf hg c" width="700" height="395" loading="lazy" role="presentation"/></picture></div></div></figure><p id="e465" class="pw-post-body-paragraph oc od hj oe b ih ov og oh ik ow oj ok np ox om on nt oy op oq nx oz os ot ou gn bk">The image below is how the result of this Extension Attribute appears in the computer inventory record:</p><figure class="pq pr ps pt pu ha gs gt paragraph-image"><div role="button" tabindex="0" class="hb hc fj hd bh he"><div class="gs gt qj"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*gKpgq1W7wWgQwMOXdFffTA.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*gKpgq1W7wWgQwMOXdFffTA.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*gKpgq1W7wWgQwMOXdFffTA.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*gKpgq1W7wWgQwMOXdFffTA.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*gKpgq1W7wWgQwMOXdFffTA.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*gKpgq1W7wWgQwMOXdFffTA.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*gKpgq1W7wWgQwMOXdFffTA.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*gKpgq1W7wWgQwMOXdFffTA.png 640w, https://miro.medium.com/v2/resize:fit:720/1*gKpgq1W7wWgQwMOXdFffTA.png 720w, https://miro.medium.com/v2/resize:fit:750/1*gKpgq1W7wWgQwMOXdFffTA.png 750w, https://miro.medium.com/v2/resize:fit:786/1*gKpgq1W7wWgQwMOXdFffTA.png 786w, https://miro.medium.com/v2/resize:fit:828/1*gKpgq1W7wWgQwMOXdFffTA.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*gKpgq1W7wWgQwMOXdFffTA.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*gKpgq1W7wWgQwMOXdFffTA.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"/><img alt="" class="bh hf hg c" width="700" height="438" loading="lazy" role="presentation"/></picture></div></div></figure><p id="c2c9" class="pw-post-body-paragraph oc od hj oe b ih ov og oh ik ow oj ok np ox om on nt oy op oq nx oz os ot ou gn bk">Once we can report on the <code class="cx pk pl pm pn b">uchg </code>status of the Launch directories, we can then use that attribute as the basis for a Smart Group to scope our policy. First, we give the Smart Group an identifying name. Then we define the criteria for this group as <em class="po">any computer that contains the word unlocked in the Launch Persistence Directories inventory field.</em></p><figure class="pq pr ps pt pu ha gs gt paragraph-image"><div role="button" tabindex="0" class="hb hc fj hd bh he"><div class="gs gt qj"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*yqOqespd4lwy7NiiGPFbeg.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*yqOqespd4lwy7NiiGPFbeg.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*yqOqespd4lwy7NiiGPFbeg.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*yqOqespd4lwy7NiiGPFbeg.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*yqOqespd4lwy7NiiGPFbeg.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*yqOqespd4lwy7NiiGPFbeg.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yqOqespd4lwy7NiiGPFbeg.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*yqOqespd4lwy7NiiGPFbeg.png 640w, https://miro.medium.com/v2/resize:fit:720/1*yqOqespd4lwy7NiiGPFbeg.png 720w, https://miro.medium.com/v2/resize:fit:750/1*yqOqespd4lwy7NiiGPFbeg.png 750w, https://miro.medium.com/v2/resize:fit:786/1*yqOqespd4lwy7NiiGPFbeg.png 786w, https://miro.medium.com/v2/resize:fit:828/1*yqOqespd4lwy7NiiGPFbeg.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*yqOqespd4lwy7NiiGPFbeg.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*yqOqespd4lwy7NiiGPFbeg.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"/><img alt="" class="bh hf hg c" width="700" height="438" loading="lazy" role="presentation"/></picture></div></div></figure><h2 id="b078" class="ng nh hj bf ni nj nk dy nl nm nn ea no np nq nr ns nt nu nv nw nx ny nz oa ob bk">Writing the Script</h2><p id="8701" class="pw-post-body-paragraph oc od hj oe b ih of og oh ik oi oj ok np ol om on nt oo op oq nx or os ot ou gn bk">Next, we need to write the script that locks the launch persistence directories. Since the <code class="cx pk pl pm pn b">~/Library/LaunchAgents/</code> directory does not exist by default, in this script, we check for its existence and create it if not present. If the user is a standard user, Antonio recommends creating an unprivileged user account on each machine and changing ownership of the <code class="cx pk pl pm pn b">~/Library/LaunchAgents</code> to this stand-in account. This avoids having the directory owned by root and prevents the local user from simply unlocking their directory as its owner.</p><p id="07d8" class="pw-post-body-paragraph oc od hj oe b ih ov og oh ik ow oj ok np ox om on nt oy op oq nx oz os ot ou gn bk">Lastly, we use <code class="cx pk pl pm pn b">chflags uchg</code> to lock each directory.</p><figure class="pq pr ps pt pu ha gs gt paragraph-image"><div role="button" tabindex="0" class="hb hc fj hd bh he"><div class="gs gt qj"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*dF_RkHf_dBbxr9zyKZKSOg.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*dF_RkHf_dBbxr9zyKZKSOg.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*dF_RkHf_dBbxr9zyKZKSOg.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*dF_RkHf_dBbxr9zyKZKSOg.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*dF_RkHf_dBbxr9zyKZKSOg.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*dF_RkHf_dBbxr9zyKZKSOg.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dF_RkHf_dBbxr9zyKZKSOg.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*dF_RkHf_dBbxr9zyKZKSOg.png 640w, https://miro.medium.com/v2/resize:fit:720/1*dF_RkHf_dBbxr9zyKZKSOg.png 720w, https://miro.medium.com/v2/resize:fit:750/1*dF_RkHf_dBbxr9zyKZKSOg.png 750w, https://miro.medium.com/v2/resize:fit:786/1*dF_RkHf_dBbxr9zyKZKSOg.png 786w, https://miro.medium.com/v2/resize:fit:828/1*dF_RkHf_dBbxr9zyKZKSOg.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*dF_RkHf_dBbxr9zyKZKSOg.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*dF_RkHf_dBbxr9zyKZKSOg.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"/><img alt="" class="bh hf hg c" width="700" height="438" loading="lazy" role="presentation"/></picture></div></div></figure><h2 id="cdc8" class="ng nh hj bf ni nj nk dy nl nm nn ea no np nq nr ns nt nu nv nw nx ny nz oa ob bk">Crafting the Policy</h2><p id="3524" class="pw-post-body-paragraph oc od hj oe b ih of og oh ik oi oj ok np ol om on nt oo op oq nx or os ot ou gn bk">Finally, we create a policy that ties all of these elements together. After giving the policy an appropriate name, we set the policy to be triggered at the recurring check-in (every 15 minutes by default) on any computer that is in scope.</p><figure class="pq pr ps pt pu ha gs gt paragraph-image"><div role="button" tabindex="0" class="hb hc fj hd bh he"><div class="gs gt qj"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*DvOEzIZElp00EaPVYA5Lqw.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*DvOEzIZElp00EaPVYA5Lqw.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*DvOEzIZElp00EaPVYA5Lqw.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*DvOEzIZElp00EaPVYA5Lqw.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*DvOEzIZElp00EaPVYA5Lqw.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*DvOEzIZElp00EaPVYA5Lqw.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DvOEzIZElp00EaPVYA5Lqw.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*DvOEzIZElp00EaPVYA5Lqw.png 640w, https://miro.medium.com/v2/resize:fit:720/1*DvOEzIZElp00EaPVYA5Lqw.png 720w, https://miro.medium.com/v2/resize:fit:750/1*DvOEzIZElp00EaPVYA5Lqw.png 750w, https://miro.medium.com/v2/resize:fit:786/1*DvOEzIZElp00EaPVYA5Lqw.png 786w, https://miro.medium.com/v2/resize:fit:828/1*DvOEzIZElp00EaPVYA5Lqw.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*DvOEzIZElp00EaPVYA5Lqw.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*DvOEzIZElp00EaPVYA5Lqw.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"/><img alt="" class="bh hf hg c" width="700" height="438" loading="lazy" role="presentation"/></picture></div></div></figure><p id="d143" class="pw-post-body-paragraph oc od hj oe b ih ov og oh ik ow oj ok np ox om on nt oy op oq nx oz os ot ou gn bk">And for the scope, we set the policy to run against any computer that falls into the “Launch Directories Unlocked” Smart Group that we previously created.</p><figure class="pq pr ps pt pu ha gs gt paragraph-image"><div role="button" tabindex="0" class="hb hc fj hd bh he"><div class="gs gt qj"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*C-pZJ2aM4nP-_B1DtoM6hg.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*C-pZJ2aM4nP-_B1DtoM6hg.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*C-pZJ2aM4nP-_B1DtoM6hg.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*C-pZJ2aM4nP-_B1DtoM6hg.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*C-pZJ2aM4nP-_B1DtoM6hg.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*C-pZJ2aM4nP-_B1DtoM6hg.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*C-pZJ2aM4nP-_B1DtoM6hg.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*C-pZJ2aM4nP-_B1DtoM6hg.png 640w, https://miro.medium.com/v2/resize:fit:720/1*C-pZJ2aM4nP-_B1DtoM6hg.png 720w, https://miro.medium.com/v2/resize:fit:750/1*C-pZJ2aM4nP-_B1DtoM6hg.png 750w, https://miro.medium.com/v2/resize:fit:786/1*C-pZJ2aM4nP-_B1DtoM6hg.png 786w, https://miro.medium.com/v2/resize:fit:828/1*C-pZJ2aM4nP-_B1DtoM6hg.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*C-pZJ2aM4nP-_B1DtoM6hg.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*C-pZJ2aM4nP-_B1DtoM6hg.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"/><img alt="" class="bh hf hg c" width="700" height="438" loading="lazy" role="presentation"/></picture></div></div></figure><p id="2d1a" class="pw-post-body-paragraph oc od hj oe b ih ov og oh ik ow oj ok np ox om on nt oy op oq nx oz os ot ou gn bk">As for the Policy payloads, we will configure the Scripts payload and add our Lock Launch Directories script.</p><figure class="pq pr ps pt pu ha gs gt paragraph-image"><div role="button" tabindex="0" class="hb hc fj hd bh he"><div class="gs gt qj"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*trrOWcE9h556WbjmzKRlTw.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*trrOWcE9h556WbjmzKRlTw.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*trrOWcE9h556WbjmzKRlTw.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*trrOWcE9h556WbjmzKRlTw.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*trrOWcE9h556WbjmzKRlTw.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*trrOWcE9h556WbjmzKRlTw.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*trrOWcE9h556WbjmzKRlTw.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*trrOWcE9h556WbjmzKRlTw.png 640w, https://miro.medium.com/v2/resize:fit:720/1*trrOWcE9h556WbjmzKRlTw.png 720w, https://miro.medium.com/v2/resize:fit:750/1*trrOWcE9h556WbjmzKRlTw.png 750w, https://miro.medium.com/v2/resize:fit:786/1*trrOWcE9h556WbjmzKRlTw.png 786w, https://miro.medium.com/v2/resize:fit:828/1*trrOWcE9h556WbjmzKRlTw.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*trrOWcE9h556WbjmzKRlTw.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*trrOWcE9h556WbjmzKRlTw.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"/><img alt="" class="bh hf hg c" width="700" height="438" loading="lazy" role="presentation"/></picture></div></div></figure><p id="302b" class="pw-post-body-paragraph oc od hj oe b ih ov og oh ik ow oj ok np ox om on nt oy op oq nx oz os ot ou gn bk">We also add a secondary Maintenance payload to force an inventory update, to immediately reflect this change in the computer inventory record and remove the computer from the “Launch Directories Unlocked” Smart Computer Group.</p><figure class="pq pr ps pt pu ha gs gt paragraph-image"><div role="button" tabindex="0" class="hb hc fj hd bh he"><div class="gs gt qj"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*aAQPqNfzhG1ypvaCDY0JZQ.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*aAQPqNfzhG1ypvaCDY0JZQ.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*aAQPqNfzhG1ypvaCDY0JZQ.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*aAQPqNfzhG1ypvaCDY0JZQ.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*aAQPqNfzhG1ypvaCDY0JZQ.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*aAQPqNfzhG1ypvaCDY0JZQ.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*aAQPqNfzhG1ypvaCDY0JZQ.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*aAQPqNfzhG1ypvaCDY0JZQ.png 640w, https://miro.medium.com/v2/resize:fit:720/1*aAQPqNfzhG1ypvaCDY0JZQ.png 720w, https://miro.medium.com/v2/resize:fit:750/1*aAQPqNfzhG1ypvaCDY0JZQ.png 750w, https://miro.medium.com/v2/resize:fit:786/1*aAQPqNfzhG1ypvaCDY0JZQ.png 786w, https://miro.medium.com/v2/resize:fit:828/1*aAQPqNfzhG1ypvaCDY0JZQ.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*aAQPqNfzhG1ypvaCDY0JZQ.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*aAQPqNfzhG1ypvaCDY0JZQ.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"/><img alt="" class="bh hf hg c" width="700" height="438" loading="lazy" role="presentation"/></picture></div></div></figure><p id="eb95" class="pw-post-body-paragraph oc od hj oe b ih ov og oh ik ow oj ok np ox om on nt oy op oq nx oz os ot ou gn bk">When the need arises to install a legitimate Launch Daemon or Launch Agent, an admin should run the chflags <code class="cx pk pl pm pn b">nouchg</code>in a preinstall script to remove the lock and then re-enable the flag in a post-install script.</p></div></div></div><div class="ab cb pc pd pe pf" role="separator"><span class="pg by bm ph pi pj"></span><span class="pg by bm ph pi pj"></span><span class="pg by bm ph pi"></span></div><div class="gn go gp gq gr"><div class="ab cb"><div class="ci bh fz ga gb gc"><h2 id="e86c" class="ng nh hj bf ni nj nk dy nl nm nn ea no np nq nr ns nt nu nv nw nx ny nz oa ob bk">To Summarize</h2><p id="766c" class="pw-post-body-paragraph oc od hj oe b ih of og oh ik oi oj ok np ol om on nt oo op oq nx or os ot ou gn bk">We can lock the root-level launch persistence directories using an MDM solution with scripting capabilities, like Jamf Pro. An administrator would only unlock it when installing approved software. They would then relock it after install.</p><p id="d077" class="pw-post-body-paragraph oc od hj oe b ih ov og oh ik ow oj ok np ox om on nt oy op oq nx oz os ot ou gn bk">The administrator can create a honey-user account for each managed macOS machine and change the owner of the user-level LaunchAgents directory to this honey-user. The admin can then lock the user-level directory.</p><p id="661d" class="pw-post-body-paragraph oc od hj oe b ih ov og oh ik ow oj ok np ox om on nt oy op oq nx oz os ot ou gn bk">I hope this mitigation strategy works for your enterprise environment. I’d love to hear from anyone who gives it a try. Contact me via my <a class="af pa" href="https://twitter.com/antman1P" rel="noopener ugc nofollow" target="_blank">antman1p </a>Twitter.</p><p id="6290" class="pw-post-body-paragraph oc od hj oe b ih ov og oh ik ow oj ok np ox om on nt oy op oq nx oz os ot ou gn bk">As always, thanks for reading, and stand by for more sauce!</p></div></div></div><div class="ab cb pc pd pe pf" role="separator"><span class="pg by bm ph pi pj"></span><span class="pg by bm ph pi pj"></span><span class="pg by bm ph pi"></span></div><div class="gn go gp gq gr"><div class="ab cb"><div class="ci bh fz ga gb gc"><h2 id="0438" class="ng nh hj bf ni nj nk dy nl nm nn ea no np nq nr ns nt nu nv nw nx ny nz oa ob bk">Works Cited</h2><p id="86be" class="pw-post-body-paragraph oc od hj oe b ih of og oh ik oi oj ok np ol om on nt oo op oq nx or os ot ou gn bk">Apple. (2016, September 13). <em class="po">Daemons and services programming guide</em>. Creating Launch Daemons and Agents. Retrieved November 9, 2021, from <a class="af pa" href="https://developer.apple.com/library/archive/documentation/MacOSX/Conceptual/BPSystemStartup/Chapters/CreatingLaunchdJobs.html." rel="noopener ugc nofollow" target="_blank">https://developer.apple.com/library/archive/documentation/MacOSX/Conceptual/BPSystemStartup/Chapters/CreatingLaunchdJobs.html.</a></p><p id="37df" class="pw-post-body-paragraph oc od hj oe b ih ov og oh ik ow oj ok np ox om on nt oy op oq nx oz os ot ou gn bk"><em class="po">Mitre ATT&amp;CK®</em>. MITRE ATT&amp;CK®. (n.d.). Retrieved November 9, 2021, from <a class="af pa" href="https://attack.mitre.org/." rel="noopener ugc nofollow" target="_blank">https://attack.mitre.org/.</a></p><p id="0bc5" class="pw-post-body-paragraph oc od hj oe b ih ov og oh ik ow oj ok np ox om on nt oy op oq nx oz os ot ou gn bk">Patrick Wardle. (2020). <em class="po">Analysis</em>. The Art of Mac Malware. Retrieved November 9, 2021, from <a class="af pa" href="https://taomm.org/vol1/analysis.html." rel="noopener ugc nofollow" target="_blank">https://taomm.org/vol1/analysis.html.</a></p><p id="11de" class="pw-post-body-paragraph oc od hj oe b ih ov og oh ik ow oj ok np ox om on nt oy op oq nx oz os ot ou gn bk">Soma-Zone. (n.d.). <em class="po">What is Launchd?</em> A launchd Tutorial. Retrieved November 21, 2021, from <a class="af pa" href="https://www.launchd.info/." rel="noopener ugc nofollow" target="_blank">https://www.launchd.info/.</a></p><p id="7bca" class="pw-post-body-paragraph oc od hj oe b ih ov og oh ik ow oj ok np ox om on nt oy op oq nx oz os ot ou gn bk">Thanks to <span class="jo"><span class="jo" aria-hidden="false"><a class="pb jp fe" href="https://medium.com/u/d64a8a5f03d6?source=post_page-----156e2b40fc67--------------------------------" rel="noopener" target="_blank">Justin Bui</a></span></span> for the feedback!</p></div></div></div></div></section></div></div></article></div><div class="ab cb"><div class="ci bh fz ga gb gc"><div class="qk ql ab jw"><div class="qm ab"><a class="qn ay am ao" href="https://medium.com/tag/macos?source=post_page-----156e2b40fc67--------------------------------" rel="noopener follow"><div class="qo fj cx qp ge qq qr bf b bg z bk qs">Macos</div></a></div><div class="qm ab"><a class="qn ay am ao" href="https://medium.com/tag/mitre-attack?source=post_page-----156e2b40fc67--------------------------------" rel="noopener follow"><div class="qo fj cx qp ge qq qr bf b bg z bk qs">Mitre Attack</div></a></div><div class="qm ab"><a class="qn ay am ao" href="https://medium.com/tag/jamf-pro?source=post_page-----156e2b40fc67--------------------------------" rel="noopener follow"><div class="qo fj cx qp ge qq qr bf b bg z bk qs">Jamf Pro</div></a></div><div class="qm ab"><a class="qn ay am ao" href="https://medium.com/tag/launchagents?source=post_page-----156e2b40fc67--------------------------------" rel="noopener follow"><div class="qo fj cx qp ge qq qr bf b bg z bk qs">Launchagents</div></a></div><div class="qm ab"><a class="qn ay am ao" href="https://medium.com/tag/persistence?source=post_page-----156e2b40fc67--------------------------------" rel="noopener follow"><div class="qo fj cx qp ge qq qr bf b bg z bk qs">Persistence</div></a></div></div></div></div><div class="l"></div><footer class="qt qu qv qw qx qy qz ra rb ab q rc rd c"><div class="l ae"><div class="ab cb"><div class="ci bh fz ga gb gc"><div class="ab cp re"><div class="ab q lf"><div class="rf l"><span class="l rg rh ri e d"><div class="ab q lf lg"><div class="pw-multi-vote-icon fj lh li lj lk"><span><a class="af ag ah ai aj ak al am an ao ap aq ar as at" data-testid="footerClapButton" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Fp%2F156e2b40fc67&amp;operation=register&amp;redirect=https%3A%2F%2Fantman1p-30185.medium.com%2Fdefeating-malicious-launch-persistence-156e2b40fc67&amp;user=4n7m4n&amp;userId=6933f3d65c15&amp;source=-----156e2b40fc67---------------------clap_footer-----------" rel="noopener follow"><div><div class="bm" aria-hidden="false"><div class="ll ao lm ln lo lp am lq lr ls lk"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM13.916 3.953l1.523-2.112-1.184-.39zM8.589 1.84l1.522 2.112-.337-2.501zM18.523 18.92c-.86.86-1.75 1.246-2.62 1.33a6 6 0 0 0 .407-.372c2.388-2.389 2.86-4.951 1.399-7.623l-.912-1.603-.79-1.672c-.26-.56-.194-.98.203-1.288a.7.7 0 0 1 .546-.132c.283.046.546.231.728.5l2.363 4.157c.976 1.624 1.141 4.237-1.324 6.702m-10.999-.438L3.37 14.328a.828.828 0 0 1 .585-1.408.83.83 0 0 1 .585.242l2.158 2.157a.365.365 0 0 0 .516-.516l-2.157-2.158-1.449-1.449a.826.826 0 0 1 1.167-1.17l3.438 3.44a.363.363 0 0 0 .516 0 .364.364 0 0 0 0-.516L5.293 9.513l-.97-.97a.826.826 0 0 1 0-1.166.84.84 0 0 1 1.167 0l.97.968 3.437 3.436a.36.36 0 0 0 .517 0 .366.366 0 0 0 0-.516L6.977 7.83a.82.82 0 0 1-.241-.584.82.82 0 0 1 .824-.826c.219 0 .43.087.584.242l5.787 5.787a.366.366 0 0 0 .587-.415l-1.117-2.363c-.26-.56-.194-.98.204-1.289a.7.7 0 0 1 .546-.132c.283.046.545.232.727.501l2.193 3.86c1.302 2.38.883 4.59-1.277 6.75-1.156 1.156-2.602 1.627-4.19 1.367-1.418-.236-2.866-1.033-4.079-2.246M10.75 5.971l2.12 2.12c-.41.502-.465 1.17-.128 1.89l.22.465-3.523-3.523a.8.8 0 0 1-.097-.368c0-.22.086-.428.241-.584a.847.847 0 0 1 1.167 0m7.355 1.705c-.31-.461-.746-.758-1.23-.837a1.44 1.44 0 0 0-1.11.275c-.312.24-.505.543-.59.881a1.74 1.74 0 0 0-.906-.465 1.47 1.47 0 0 0-.82.106l-2.182-2.182a1.56 1.56 0 0 0-2.2 0 1.54 1.54 0 0 0-.396.701 1.56 1.56 0 0 0-2.21-.01 1.55 1.55 0 0 0-.416.753c-.624-.624-1.649-.624-2.237-.037a1.557 1.557 0 0 0 0 2.2c-.239.1-.501.238-.715.453a1.56 1.56 0 0 0 0 2.2l.516.515a1.556 1.556 0 0 0-.753 2.615L7.01 19c1.32 1.319 2.909 2.189 4.475 2.449q.482.08.971.08c.85 0 1.653-.198 2.393-.579.231.033.46.054.686.054 1.266 0 2.457-.52 3.505-1.567 2.763-2.763 2.552-5.734 1.439-7.586z" clip-rule="evenodd"></path></svg></div></div></div></a></span></div><div class="pw-multi-vote-count l lt lu lv lw lx ly lz"><p class="bf b dv z du"><span class="ma">--</span></p></div></div></span><span class="l h g f rj rk"><div class="ab q lf lg"><div class="pw-multi-vote-icon fj lh li lj lk"><span><a class="af ag ah ai aj ak al am an ao ap aq ar as at" data-testid="footerClapButton" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Fp%2F156e2b40fc67&amp;operation=register&amp;redirect=https%3A%2F%2Fantman1p-30185.medium.com%2Fdefeating-malicious-launch-persistence-156e2b40fc67&amp;user=4n7m4n&amp;userId=6933f3d65c15&amp;source=-----156e2b40fc67---------------------clap_footer-----------" rel="noopener follow"><div><div class="bm" aria-hidden="false"><div class="ll ao lm ln lo lp am lq lr ls lk"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM13.916 3.953l1.523-2.112-1.184-.39zM8.589 1.84l1.522 2.112-.337-2.501zM18.523 18.92c-.86.86-1.75 1.246-2.62 1.33a6 6 0 0 0 .407-.372c2.388-2.389 2.86-4.951 1.399-7.623l-.912-1.603-.79-1.672c-.26-.56-.194-.98.203-1.288a.7.7 0 0 1 .546-.132c.283.046.546.231.728.5l2.363 4.157c.976 1.624 1.141 4.237-1.324 6.702m-10.999-.438L3.37 14.328a.828.828 0 0 1 .585-1.408.83.83 0 0 1 .585.242l2.158 2.157a.365.365 0 0 0 .516-.516l-2.157-2.158-1.449-1.449a.826.826 0 0 1 1.167-1.17l3.438 3.44a.363.363 0 0 0 .516 0 .364.364 0 0 0 0-.516L5.293 9.513l-.97-.97a.826.826 0 0 1 0-1.166.84.84 0 0 1 1.167 0l.97.968 3.437 3.436a.36.36 0 0 0 .517 0 .366.366 0 0 0 0-.516L6.977 7.83a.82.82 0 0 1-.241-.584.82.82 0 0 1 .824-.826c.219 0 .43.087.584.242l5.787 5.787a.366.366 0 0 0 .587-.415l-1.117-2.363c-.26-.56-.194-.98.204-1.289a.7.7 0 0 1 .546-.132c.283.046.545.232.727.501l2.193 3.86c1.302 2.38.883 4.59-1.277 6.75-1.156 1.156-2.602 1.627-4.19 1.367-1.418-.236-2.866-1.033-4.079-2.246M10.75 5.971l2.12 2.12c-.41.502-.465 1.17-.128 1.89l.22.465-3.523-3.523a.8.8 0 0 1-.097-.368c0-.22.086-.428.241-.584a.847.847 0 0 1 1.167 0m7.355 1.705c-.31-.461-.746-.758-1.23-.837a1.44 1.44 0 0 0-1.11.275c-.312.24-.505.543-.59.881a1.74 1.74 0 0 0-.906-.465 1.47 1.47 0 0 0-.82.106l-2.182-2.182a1.56 1.56 0 0 0-2.2 0 1.54 1.54 0 0 0-.396.701 1.56 1.56 0 0 0-2.21-.01 1.55 1.55 0 0 0-.416.753c-.624-.624-1.649-.624-2.237-.037a1.557 1.557 0 0 0 0 2.2c-.239.1-.501.238-.715.453a1.56 1.56 0 0 0 0 2.2l.516.515a1.556 1.556 0 0 0-.753 2.615L7.01 19c1.32 1.319 2.909 2.189 4.475 2.449q.482.08.971.08c.85 0 1.653-.198 2.393-.579.231.033.46.054.686.054 1.266 0 2.457-.52 3.505-1.567 2.763-2.763 2.552-5.734 1.439-7.586z" clip-rule="evenodd"></path></svg></div></div></div></a></span></div><div class="pw-multi-vote-count l lt lu lv lw lx ly lz"><p class="bf b dv z du"><span class="ma">--</span></p></div></div></span></div><div class="bq ab"><div><div class="bm" aria-hidden="false"><button class="ao ll mb mc ab q fk md me" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="mf"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"></path></svg></button></div></div></div></div><div class="ab q"><div class="pj l jt"><div><div class="bm" aria-hidden="false"><span><a class="af ag ah ai aj ak al am an ao ap aq ar as at" data-testid="footerBookmarkButton" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F156e2b40fc67&amp;operation=register&amp;redirect=https%3A%2F%2Fantman1p-30185.medium.com%2Fdefeating-malicious-launch-persistence-156e2b40fc67&amp;source=--------------------------bookmark_footer-----------" rel="noopener follow"><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="none" viewBox="0 0 25 25" class="du mh" aria-label="Add to list bookmark button"><path fill="currentColor" d="M18 2.5a.5.5 0 0 1 1 0V5h2.5a.5.5 0 0 1 0 1H19v2.5a.5.5 0 1 1-1 0V6h-2.5a.5.5 0 0 1 0-1H18zM7 7a1 1 0 0 1 1-1h3.5a.5.5 0 0 0 0-1H8a2 2 0 0 0-2 2v14a.5.5 0 0 0 .805.396L12.5 17l5.695 4.396A.5.5 0 0 0 19 21v-8.5a.5.5 0 0 0-1 0v7.485l-5.195-4.012a.5.5 0 0 0-.61 0L7 19.985z"></path></svg></a></span></div></div></div><div class="pj l jt"><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="footerSocialShareButton" class="af fk ah ai aj ak al mo an ao ap ex mp mq me mr"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"></path></svg></button></div></div></div></div></div></div></div></div></div></footer><div class="rl rm rn ro rp l bx"><div class="ab cb"><div class="ci bh fz ga gb gc"><div class="cl ab rq cp"><div class="ab jb"><a rel="noopener follow" href="/?source=post_page-----156e2b40fc67--------------------------------"><div class="l rr rs by rt jf"><div class="l fj"><img alt="4n7m4n" class="l fd by ru rv cx" src="https://miro.medium.com/v2/resize:fill:144:144/1*0EACXzt6sjlhQSMHVCyseQ.jpeg" width="72" height="72" loading="lazy"/><div class="jg by l ru rv fs n jh ft"></div></div></div></a></div><div class="j i d"><div class="ab"><span><button class="bf b bg z ep qo eq er es et eu ev ew ex ey ez fa au fb fc fd bm fe ff">Follow</button></span><div class="dt l"><div><div><div class="bm" aria-hidden="false"><div class="l"><span><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fc8901b310bee&amp;operation=register&amp;redirect=https%3A%2F%2Fantman1p-30185.medium.com%2Fdefeating-malicious-launch-persistence-156e2b40fc67&amp;newsletterV3=6933f3d65c15&amp;newsletterV3Id=c8901b310bee&amp;user=4n7m4n&amp;userId=6933f3d65c15&amp;source=-----156e2b40fc67---------------------subscribe_user-----------" rel="noopener follow"><button class="bf b bg z rz am sa sb sc sd se sf sg sh ew ex ey ez fa fb fc fd bm fe ff" aria-label="Subscribe"><svg xmlns="http://www.w3.org/2000/svg" width="38" height="38" fill="none" viewBox="0 0 38 38" class="rw rx ry"><rect width="0.5" height="6.5" x="26.25" y="9.25" rx="0.25"></rect><rect width="0.5" height="6.5" x="29.75" y="12.25" rx="0.25" transform="rotate(90 29.75 12.25)"></rect><path d="M19.5 12.5h-7a1 1 0 0 0-1 1v11a1 1 0 0 0 1 1h13a1 1 0 0 0 1-1v-5"></path><path d="M11.5 14.5 19 20l4-3"></path></svg></button></a></span></div></div></div></div></div></div></div></div><div class="ab cn cp"><div class="l"><div class="ab q"><a class="af ag ah ai aj ak al am an ao ap aq ar as at ab q" rel="noopener follow" href="/?source=post_page-----156e2b40fc67--------------------------------"><h2 class="pw-author-name bf si sj sk sl bk"><span class="gn jy">Written by <!-- -->4n7m4n</span></h2></a></div><div class="qm ab"><div class="l jt"><span class="pw-follower-count bf b bg z bk"><a class="af ag ah ai aj ak al am an ao ap aq ar jm" rel="noopener follow" href="/followers?source=post_page-----156e2b40fc67--------------------------------">105 Followers</a></span></div></div><div class="sm l"><p class="bf b bg z bk"><span class="gn">Red Team Pen Testing Nobody | OSCP | InfoSec | Tech Junkie | OIF Veteran | Tweets are mine, not yours, nor anyone else&#x27;s... Certainly not my employer&#x27;s</span></p></div></div><div class="h k"><div class="ab"><span><button class="bf b bg z ep qo eq er es et eu ev ew ex ey ez fa au fb fc fd bm fe ff">Follow</button></span><div class="dt l"><div><div><div class="bm" aria-hidden="false"><div class="l"><span><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Fc8901b310bee&amp;operation=register&amp;redirect=https%3A%2F%2Fantman1p-30185.medium.com%2Fdefeating-malicious-launch-persistence-156e2b40fc67&amp;newsletterV3=6933f3d65c15&amp;newsletterV3Id=c8901b310bee&amp;user=4n7m4n&amp;userId=6933f3d65c15&amp;source=-----156e2b40fc67---------------------subscribe_user-----------" rel="noopener follow"><button class="bf b bg z rz am sa sb sc sd se sf sg sh ew ex ey ez fa fb fc fd bm fe ff" aria-label="Subscribe"><svg xmlns="http://www.w3.org/2000/svg" width="38" height="38" fill="none" viewBox="0 0 38 38" class="rw rx ry"><rect width="0.5" height="6.5" x="26.25" y="9.25" rx="0.25"></rect><rect width="0.5" height="6.5" x="29.75" y="12.25" rx="0.25" transform="rotate(90 29.75 12.25)"></rect><path d="M19.5 12.5h-7a1 1 0 0 0-1 1v11a1 1 0 0 0 1 1h13a1 1 0 0 0 1-1v-5"></path><path d="M11.5 14.5 19 20l4-3"></path></svg></button></a></span></div></div></div></div></div></div></div></div><div class="sn bh so gv gw gx gy gz"></div></div></div><div class="h k j"><div class="sn bh so sp"></div><div class="ab cb"><div class="ci bh fz ga gb gc"><div class="sq ab lf jw"><div class="sr ss l"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://help.medium.com/hc/en-us?source=post_page-----156e2b40fc67--------------------------------" rel="noopener follow"><p class="bf b dv z du">Help</p></a></div><div class="sr ss l"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://medium.statuspage.io/?source=post_page-----156e2b40fc67--------------------------------" rel="noopener follow"><p class="bf b dv z du">Status</p></a></div><div class="sr ss l"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://medium.com/about?autoplay=1&amp;source=post_page-----156e2b40fc67--------------------------------" rel="noopener follow"><p class="bf b dv z du">About</p></a></div><div class="sr ss l"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=post_page-----156e2b40fc67--------------------------------" rel="noopener follow"><p class="bf b dv z du">Careers</p></a></div><div class="sr ss l"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="pressinquiries@medium.com?source=post_page-----156e2b40fc67--------------------------------" rel="noopener follow"><p class="bf b dv z du">Press</p></a></div><div class="sr ss l"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://blog.medium.com/?source=post_page-----156e2b40fc67--------------------------------" rel="noopener follow"><p class="bf b dv z du">Blog</p></a></div><div class="sr ss l"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----156e2b40fc67--------------------------------" rel="noopener follow"><p class="bf b dv z du">Privacy</p></a></div><div class="sr ss l"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----156e2b40fc67--------------------------------" rel="noopener follow"><p class="bf b dv z du">Terms</p></a></div><div class="sr ss l"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://speechify.com/medium?source=post_page-----156e2b40fc67--------------------------------" rel="noopener follow"><p class="bf b dv z du">Text to speech</p></a></div><div class="sr l"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://medium.com/business?source=post_page-----156e2b40fc67--------------------------------" rel="noopener follow"><p class="bf b dv z du">Teams</p></a></div></div></div></div></div></div></div></div></div></div><script>window.__BUILD_ID__="main-20241017-182126-a0128a89d2"</script><script>window.__GRAPHQL_URI__ = "https://antman1p-30185.medium.com/_/graphql"</script><script>window.__PRELOADED_STATE__ = {"algolia":{"queries":{}},"cache":{"experimentGroupSet":true,"reason":"","group":"enabled","tags":["group-edgeCachePosts","post-156e2b40fc67","user-6933f3d65c15"],"serverVariantState":"44136fa355b3678a1146ad16f7e8649e94fb4fc21fe77e8310c060f61caaff8a","middlewareEnabled":true,"cacheStatus":"DYNAMIC","shouldUseCache":true,"vary":[],"lohpSummerUpsellEnabled":false,"publicationHierarchyEnabled":false},"client":{"hydrated":false,"isUs":false,"isNativeMedium":false,"isSafariMobile":false,"isSafari":false,"isFirefox":true,"routingEntity":{"type":"USER","id":"6933f3d65c15","explicit":true},"viewerIsBot":false},"debug":{"requestId":"3046d7b3-e26f-4839-858e-17b4cbaa375f","hybridDevServices":[],"originalSpanCarrier":{"traceparent":"00-919536f818865f88497abf14628d0cac-05d5859d436f31f7-01"}},"multiVote":{"clapsPerPost":{}},"navigation":{"branch":{"show":null,"hasRendered":null,"blockedByCTA":false},"hideGoogleOneTap":false,"hasRenderedAlternateUserBanner":null,"currentLocation":"https:\u002F\u002Fantman1p-30185.medium.com\u002Fdefeating-malicious-launch-persistence-156e2b40fc67","host":"antman1p-30185.medium.com","hostname":"antman1p-30185.medium.com","referrer":"","hasSetReferrer":false,"susiModal":{"step":null,"operation":"register"},"postRead":false,"partnerProgram":{"selectedCountryCode":null},"queryString":"","currentHash":""},"config":{"nodeEnv":"production","version":"main-20241017-182126-a0128a89d2","target":"production","productName":"Medium","publicUrl":"https:\u002F\u002Fcdn-client.medium.com\u002Flite","authDomain":"medium.com","authGoogleClientId":"216296035834-k1k6qe060s2tp2a2jam4ljdcms00sttg.apps.googleusercontent.com","favicon":"production","glyphUrl":"https:\u002F\u002Fglyph.medium.com","branchKey":"key_live_ofxXr2qTrrU9NqURK8ZwEhknBxiI6KBm","algolia":{"appId":"MQ57UUUQZ2","apiKeySearch":"394474ced050e3911ae2249ecc774921","indexPrefix":"medium_","host":"-dsn.algolia.net"},"recaptchaKey":"6Lfc37IUAAAAAKGGtC6rLS13R1Hrw_BqADfS1LRk","recaptcha3Key":"6Lf8R9wUAAAAABMI_85Wb8melS7Zj6ziuf99Yot5","recaptchaEnterpriseKeyId":"6Le-uGgpAAAAAPprRaokM8AKthQ9KNGdoxaGUvVp","datadog":{"applicationId":"6702d87d-a7e0-42fe-bbcb-95b469547ea0","clientToken":"pub853ea8d17ad6821d9f8f11861d23dfed","rumToken":"pubf9cc52896502b9413b68ba36fc0c7162","context":{"deployment":{"target":"production","tag":"main-20241017-182126-a0128a89d2","commit":"a0128a89d2d76bfa55b25492370b0bae4050224f"}},"datacenter":"us"},"googleAnalyticsCode":"G-7JY7T788PK","googlePay":{"apiVersion":"2","apiVersionMinor":"0","merchantId":"BCR2DN6TV7EMTGBM","merchantName":"Medium","instanceMerchantId":"13685562959212738550"},"applePay":{"version":3},"signInWallCustomDomainCollectionIds":["3a8144eabfe3","336d898217ee","61061eb0c96b","138adf9c44c","819cc2aaeee0"],"mediumMastodonDomainName":"me.dm","mediumOwnedAndOperatedCollectionIds":["8a9336e5bb4","b7e45b22fec3","193b68bd4fba","8d6b8a439e32","54c98c43354d","3f6ecf56618","d944778ce714","92d2092dc598","ae2a65f35510","1285ba81cada","544c7006046e","fc8964313712","40187e704f1c","88d9857e584e","7b6769f2748b","bcc38c8f6edf","cef6983b292","cb8577c9149e","444d13b52878","713d7dbc99b0","ef8e90590e66","191186aaafa0","55760f21cdc5","9dc80918cc93","bdc4052bbdba","8ccfed20cbb2"],"tierOneDomains":["medium.com","thebolditalic.com","arcdigital.media","towardsdatascience.com","uxdesign.cc","codeburst.io","psiloveyou.xyz","writingcooperative.com","entrepreneurshandbook.co","prototypr.io","betterhumans.coach.me","theascent.pub"],"topicsToFollow":["d61cf867d93f","8a146bc21b28","1eca0103fff3","4d562ee63426","aef1078a3ef5","e15e46793f8d","6158eb913466","55f1c20aba7a","3d18b94f6858","4861fee224fd","63c6f1f93ee","1d98b3a9a871","decb52b64abf","ae5d4995e225","830cded25262"],"topicToTagMappings":{"accessibility":"accessibility","addiction":"addiction","android-development":"android-development","art":"art","artificial-intelligence":"artificial-intelligence","astrology":"astrology","basic-income":"basic-income","beauty":"beauty","biotech":"biotech","blockchain":"blockchain","books":"books","business":"business","cannabis":"cannabis","cities":"cities","climate-change":"climate-change","comics":"comics","coronavirus":"coronavirus","creativity":"creativity","cryptocurrency":"cryptocurrency","culture":"culture","cybersecurity":"cybersecurity","data-science":"data-science","design":"design","digital-life":"digital-life","disability":"disability","economy":"economy","education":"education","equality":"equality","family":"family","feminism":"feminism","fiction":"fiction","film":"film","fitness":"fitness","food":"food","freelancing":"freelancing","future":"future","gadgets":"gadgets","gaming":"gaming","gun-control":"gun-control","health":"health","history":"history","humor":"humor","immigration":"immigration","ios-development":"ios-development","javascript":"javascript","justice":"justice","language":"language","leadership":"leadership","lgbtqia":"lgbtqia","lifestyle":"lifestyle","machine-learning":"machine-learning","makers":"makers","marketing":"marketing","math":"math","media":"media","mental-health":"mental-health","mindfulness":"mindfulness","money":"money","music":"music","neuroscience":"neuroscience","nonfiction":"nonfiction","outdoors":"outdoors","parenting":"parenting","pets":"pets","philosophy":"philosophy","photography":"photography","podcasts":"podcast","poetry":"poetry","politics":"politics","privacy":"privacy","product-management":"product-management","productivity":"productivity","programming":"programming","psychedelics":"psychedelics","psychology":"psychology","race":"race","relationships":"relationships","religion":"religion","remote-work":"remote-work","san-francisco":"san-francisco","science":"science","self":"self","self-driving-cars":"self-driving-cars","sexuality":"sexuality","social-media":"social-media","society":"society","software-engineering":"software-engineering","space":"space","spirituality":"spirituality","sports":"sports","startups":"startup","style":"style","technology":"technology","transportation":"transportation","travel":"travel","true-crime":"true-crime","tv":"tv","ux":"ux","venture-capital":"venture-capital","visual-design":"visual-design","work":"work","world":"world","writing":"writing"},"defaultImages":{"avatar":{"imageId":"1*dmbNkD5D-u45r44go_cf0g.png","height":150,"width":150},"orgLogo":{"imageId":"7*V1_7XP4snlmqrc_0Njontw.png","height":110,"width":500},"postLogo":{"imageId":"bd978bb536350a710e8efb012513429cabdc4c28700604261aeda246d0f980b7","height":810,"width":1440},"postPreviewImage":{"imageId":"1*hn4v1tCaJy7cWMyb0bpNpQ.png","height":386,"width":579}},"collectionStructuredData":{"8d6b8a439e32":{"name":"Elemental","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fcdn-images-1.medium.com\u002Fmax\u002F980\u002F1*9ygdqoKprhwuTVKUM0DLPA@2x.png","width":980,"height":159}}},"3f6ecf56618":{"name":"Forge","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fcdn-images-1.medium.com\u002Fmax\u002F596\u002F1*uULpIlImcO5TDuBZ6lm7Lg@2x.png","width":596,"height":183}}},"ae2a65f35510":{"name":"GEN","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fmiro.medium.com\u002Fmax\u002F264\u002F1*RdVZMdvfV3YiZTw6mX7yWA.png","width":264,"height":140}}},"88d9857e584e":{"name":"LEVEL","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fmiro.medium.com\u002Fmax\u002F540\u002F1*JqYMhNX6KNNb2UlqGqO2WQ.png","width":540,"height":108}}},"7b6769f2748b":{"name":"Marker","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fcdn-images-1.medium.com\u002Fmax\u002F383\u002F1*haCUs0wF6TgOOvfoY-jEoQ@2x.png","width":383,"height":92}}},"444d13b52878":{"name":"OneZero","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fmiro.medium.com\u002Fmax\u002F540\u002F1*cw32fIqCbRWzwJaoQw6BUg.png","width":540,"height":123}}},"8ccfed20cbb2":{"name":"Zora","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fmiro.medium.com\u002Fmax\u002F540\u002F1*tZUQqRcCCZDXjjiZ4bDvgQ.png","width":540,"height":106}}}},"embeddedPostIds":{"coronavirus":"cd3010f9d81f"},"sharedCdcMessaging":{"COVID_APPLICABLE_TAG_SLUGS":[],"COVID_APPLICABLE_TOPIC_NAMES":[],"COVID_APPLICABLE_TOPIC_NAMES_FOR_TOPIC_PAGE":[],"COVID_MESSAGES":{"tierA":{"text":"For more information on the novel coronavirus and Covid-19, visit cdc.gov.","markups":[{"start":66,"end":73,"href":"https:\u002F\u002Fwww.cdc.gov\u002Fcoronavirus\u002F2019-nCoV"}]},"tierB":{"text":"Anyone can publish on Medium per our Policies, but we don’t fact-check every story. For more info about the coronavirus, see cdc.gov.","markups":[{"start":37,"end":45,"href":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Fcategories\u002F201931128-Policies-Safety"},{"start":125,"end":132,"href":"https:\u002F\u002Fwww.cdc.gov\u002Fcoronavirus\u002F2019-nCoV"}]},"paywall":{"text":"This article has been made free for everyone, thanks to Medium Members. For more information on the novel coronavirus and Covid-19, visit cdc.gov.","markups":[{"start":56,"end":70,"href":"https:\u002F\u002Fmedium.com\u002Fmembership"},{"start":138,"end":145,"href":"https:\u002F\u002Fwww.cdc.gov\u002Fcoronavirus\u002F2019-nCoV"}]},"unbound":{"text":"This article is free for everyone, thanks to Medium Members. For more information on the novel coronavirus and Covid-19, visit cdc.gov.","markups":[{"start":45,"end":59,"href":"https:\u002F\u002Fmedium.com\u002Fmembership"},{"start":127,"end":134,"href":"https:\u002F\u002Fwww.cdc.gov\u002Fcoronavirus\u002F2019-nCoV"}]}},"COVID_BANNER_POST_ID_OVERRIDE_WHITELIST":["3b31a67bff4a"]},"sharedVoteMessaging":{"TAGS":["politics","election-2020","government","us-politics","election","2020-presidential-race","trump","donald-trump","democrats","republicans","congress","republican-party","democratic-party","biden","joe-biden","maga"],"TOPICS":["politics","election"],"MESSAGE":{"text":"Find out more about the U.S. election results here.","markups":[{"start":46,"end":50,"href":"https:\u002F\u002Fcookpolitical.com\u002F2020-national-popular-vote-tracker"}]},"EXCLUDE_POSTS":["397ef29e3ca5"]},"embedPostRules":[],"recircOptions":{"v1":{"limit":3},"v2":{"limit":8}},"braintreeClientKey":"production_zjkj96jm_m56f8fqpf7ngnrd4","braintree":{"enabled":true,"merchantId":"m56f8fqpf7ngnrd4","merchantAccountId":{"usd":"AMediumCorporation_instant","eur":"amediumcorporation_EUR","cad":"amediumcorporation_CAD"},"publicKey":"ds2nn34bg2z7j5gd","braintreeEnvironment":"production","dashboardUrl":"https:\u002F\u002Fwww.braintreegateway.com\u002Fmerchants","gracePeriodDurationInDays":14,"mediumMembershipPlanId":{"monthly":"ce105f8c57a3","monthlyV2":"e8a5e126-792b-4ee6-8fba-d574c1b02fc5","monthlyWithTrial":"d5ee3dbe3db8","monthlyPremium":"fa741a9b47a2","yearly":"a40ad4a43185","yearlyV2":"3815d7d6-b8ca-4224-9b8c-182f9047866e","yearlyStaff":"d74fb811198a","yearlyWithTrial":"b3bc7350e5c7","yearlyPremium":"e21bd2c12166","monthlyOneYearFree":"e6c0637a-2bad-4171-ab4f-3c268633d83c","monthly25PercentOffFirstYear":"235ecc62-0cdb-49ae-9378-726cd21c504b","monthly20PercentOffFirstYear":"ba518864-9c13-4a99-91ca-411bf0cac756","monthly15PercentOffFirstYear":"594c029b-9f89-43d5-88f8-8173af4e070e","monthly10PercentOffFirstYear":"c6c7bc9a-40f2-4b51-8126-e28511d5bdb0","monthlyForStudents":"629ebe51-da7d-41fd-8293-34cd2f2030a8","yearlyOneYearFree":"78ba7be9-0d9f-4ece-aa3e-b54b826f2bf1","yearly25PercentOffFirstYear":"2dbb010d-bb8f-4eeb-ad5c-a08509f42d34","yearly20PercentOffFirstYear":"47565488-435b-47f8-bf93-40d5fbe0ebc8","yearly15PercentOffFirstYear":"8259809b-0881-47d9-acf7-6c001c7f720f","yearly10PercentOffFirstYear":"9dd694fb-96e1-472c-8d9e-3c868d5c1506","yearlyForStudents":"e29345ef-ab1c-4234-95c5-70e50fe6bc23","monthlyCad":"p52orjkaceei","yearlyCad":"h4q9g2up9ktt"},"braintreeDiscountId":{"oneMonthFree":"MONTHS_FREE_01","threeMonthsFree":"MONTHS_FREE_03","sixMonthsFree":"MONTHS_FREE_06","fiftyPercentOffOneYear":"FIFTY_PERCENT_OFF_ONE_YEAR"},"3DSecureVersion":"2","defaultCurrency":"usd","providerPlanIdCurrency":{"4ycw":"usd","rz3b":"usd","3kqm":"usd","jzw6":"usd","c2q2":"usd","nnsw":"usd","q8qw":"usd","d9y6":"usd","fx7w":"cad","nwf2":"cad"}},"paypalClientId":"AXj1G4fotC2GE8KzWX9mSxCH1wmPE3nJglf4Z2ig_amnhvlMVX87otaq58niAg9iuLktVNF_1WCMnN7v","paypal":{"host":"https:\u002F\u002Fapi.paypal.com:443","clientMode":"production","serverMode":"live","webhookId":"4G466076A0294510S","monthlyPlan":{"planId":"P-9WR0658853113943TMU5FDQA","name":"Medium Membership (Monthly) with setup fee","description":"Unlimited access to the best and brightest stories on Medium. Membership billed monthly."},"yearlyPlan":{"planId":"P-7N8963881P8875835MU5JOPQ","name":"Medium Membership (Annual) with setup fee","description":"Unlimited access to the best and brightest stories on Medium. Membership billed annually."},"oneYearGift":{"name":"Medium Membership (1 Year, Digital Gift Code)","description":"Unlimited access to the best and brightest stories on Medium. Gift codes can be redeemed at medium.com\u002Fredeem.","price":"50.00","currency":"USD","sku":"membership-gift-1-yr"},"oldMonthlyPlan":{"planId":"P-96U02458LM656772MJZUVH2Y","name":"Medium Membership (Monthly)","description":"Unlimited access to the best and brightest stories on Medium. Membership billed monthly."},"oldYearlyPlan":{"planId":"P-59P80963JF186412JJZU3SMI","name":"Medium Membership (Annual)","description":"Unlimited access to the best and brightest stories on Medium. Membership billed annually."},"monthlyPlanWithTrial":{"planId":"P-66C21969LR178604GJPVKUKY","name":"Medium Membership (Monthly) with setup fee","description":"Unlimited access to the best and brightest stories on Medium. Membership billed monthly."},"yearlyPlanWithTrial":{"planId":"P-6XW32684EX226940VKCT2MFA","name":"Medium Membership (Annual) with setup fee","description":"Unlimited access to the best and brightest stories on Medium. Membership billed annually."},"oldMonthlyPlanNoSetupFee":{"planId":"P-4N046520HR188054PCJC7LJI","name":"Medium Membership (Monthly)","description":"Unlimited access to the best and brightest stories on Medium. Membership billed monthly."},"oldYearlyPlanNoSetupFee":{"planId":"P-7A4913502Y5181304CJEJMXQ","name":"Medium Membership (Annual)","description":"Unlimited access to the best and brightest stories on Medium. Membership billed annually."},"sdkUrl":"https:\u002F\u002Fwww.paypal.com\u002Fsdk\u002Fjs"},"stripePublishableKey":"pk_live_7FReX44VnNIInZwrIIx6ghjl","log":{"json":true,"level":"info"},"imageUploadMaxSizeMb":25,"staffPicks":{"title":"Staff Picks","catalogId":"c7bc6e1ee00f"}},"session":{"xsrf":""}}</script><script>window.__APOLLO_STATE__ = {"ROOT_QUERY":{"__typename":"Query","viewer":null,"collectionByDomainOrSlug({\"domainOrSlug\":\"antman1p-30185.medium.com\"})":null,"postResult({\"id\":\"156e2b40fc67\"})":{"__ref":"Post:156e2b40fc67"}},"LinkedAccounts:6933f3d65c15":{"__typename":"LinkedAccounts","mastodon":null,"id":"6933f3d65c15"},"UserViewerEdge:userId:6933f3d65c15-viewerId:lo_b1fba1d1167c":{"__typename":"UserViewerEdge","id":"userId:6933f3d65c15-viewerId:lo_b1fba1d1167c","isFollowing":false,"isUser":false,"isMuting":false},"NewsletterV3:c8901b310bee":{"__typename":"NewsletterV3","id":"c8901b310bee","type":"NEWSLETTER_TYPE_AUTHOR","slug":"6933f3d65c15","name":"6933f3d65c15","collection":null,"user":{"__ref":"User:6933f3d65c15"}},"User:6933f3d65c15":{"__typename":"User","id":"6933f3d65c15","name":"4n7m4n","username":"antman1p-30185","newsletterV3":{"__ref":"NewsletterV3:c8901b310bee"},"linkedAccounts":{"__ref":"LinkedAccounts:6933f3d65c15"},"isSuspended":false,"imageId":"1*0EACXzt6sjlhQSMHVCyseQ.jpeg","mediumMemberAt":1659009237000,"verifications":{"__typename":"VerifiedInfo","isBookAuthor":false},"socialStats":{"__typename":"SocialStats","followerCount":105},"customDomainState":{"__typename":"CustomDomainState","live":{"__typename":"CustomDomain","domain":"antman1p-30185.medium.com"}},"hasSubdomain":true,"bio":"Red Team Pen Testing Nobody | OSCP | InfoSec | Tech Junkie | OIF Veteran | Tweets are mine, not yours, nor anyone else's... Certainly not my employer's","isPartnerProgramEnrolled":false,"viewerEdge":{"__ref":"UserViewerEdge:userId:6933f3d65c15-viewerId:lo_b1fba1d1167c"},"viewerIsUser":false,"postSubscribeMembershipUpsellShownAt":0,"userPostCounts({\"includeResponsesCount\":true})":null,"membership":{"__ref":"Membership:e0e891fbcba0"},"allowNotes":true,"twitterScreenName":"antman1P"},"Membership:e0e891fbcba0":{"__typename":"Membership","tier":"MEMBER","id":"e0e891fbcba0"},"ImageMetadata:1*Jn5o3_7Ori7R3FowlPkLiA.png":{"__typename":"ImageMetadata","id":"1*Jn5o3_7Ori7R3FowlPkLiA.png","originalHeight":640,"originalWidth":1280,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:9a6304d1f1c7_0":{"__typename":"Paragraph","id":"9a6304d1f1c7_0","name":"f697","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*Jn5o3_7Ori7R3FowlPkLiA.png"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_1":{"__typename":"Paragraph","id":"9a6304d1f1c7_1","name":"647d","type":"H3","href":null,"layout":null,"metadata":null,"text":"Defeating Malicious Launch Persistence","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_2":{"__typename":"Paragraph","id":"9a6304d1f1c7_2","name":"522f","type":"H4","href":null,"layout":null,"metadata":null,"text":"A New Mitigation Strategy for the most used macOS Persistence Technique","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_3":{"__typename":"Paragraph","id":"9a6304d1f1c7_3","name":"eb66","type":"H4","href":null,"layout":null,"metadata":null,"text":"Why Launch Persistence Research?","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_4":{"__typename":"Paragraph","id":"9a6304d1f1c7_4","name":"0eb3","type":"P","href":null,"layout":null,"metadata":null,"text":"This research started with me looking for suggestions for my organization on mitigating launch persistence techniques for macOS. As a red team operator, sharing knowledge and recommendations with our security organizations is crucial to making our customers safer.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_5":{"__typename":"Paragraph","id":"9a6304d1f1c7_5","name":"b6c2","type":"P","href":null,"layout":null,"metadata":null,"text":"I took a look at the macOS MITRE ATT&CK matrix for the persistence tactic (TA003), its launch persistence technique which MITRE calls \"Create or Modify System Process\" (T1543), and more specifically, the “Launch Agent” (T1543.001) and “Launch Daemon” (T1543.004) sub techniques. Collectively I am calling these two sub-techniques “launch persistence.” Patrick Wardle calls launch persistence “launch items.” Still, I want to ensure no confusion between these and “login items” or “startup items,” which are entirely different persistence mechanisms.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":21,"end":46,"href":"https:\u002F\u002Fattack.mitre.org\u002Fmatrices\u002Fenterprise\u002Fmacos\u002F","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":75,"end":80,"href":"https:\u002F\u002Fattack.mitre.org\u002Ftactics\u002FTA0003\u002F","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":169,"end":174,"href":"https:\u002F\u002Fattack.mitre.org\u002Ftechniques\u002FT1543\u002F","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":220,"end":229,"href":"https:\u002F\u002Fattack.mitre.org\u002Ftechniques\u002FT1543\u002F001\u002F","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":252,"end":261,"href":"https:\u002F\u002Fattack.mitre.org\u002Ftechniques\u002FT1543\u002F004\u002F","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_6":{"__typename":"Paragraph","id":"9a6304d1f1c7_6","name":"9173","type":"P","href":null,"layout":null,"metadata":null,"text":"MITRE suggested setting group policies for mitigation to block launch persistence behavior. The problem was that I hadn't heard of any organization doing this, and I could not find any reference for this from MITRE or otherwise.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_7":{"__typename":"Paragraph","id":"9a6304d1f1c7_7","name":"45e0","type":"P","href":null,"layout":null,"metadata":null,"text":"I started asking around, and no one could tell me how any organization does this. So, I decided to figure out how an enterprise could mitigate launch persistence at scale.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_8":{"__typename":"Paragraph","id":"9a6304d1f1c7_8","name":"56f6","type":"P","href":null,"layout":null,"metadata":null,"text":"Upon discovering this new mitigation method, I reached out to my friend Jaron Bradley at Jamf Protect to see if he knew if my approach was possible using an MDM solution like Jamf Pro. He connected me with Matthew Benyo, also from Jamf, who I teamed up with on this blog. Matt describes how to prepare this method using Jamf Pro in his section below.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":72,"end":85,"href":"https:\u002F\u002Ftwitter.com\u002Fjbradley89","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":89,"end":93,"href":"https:\u002F\u002Ftwitter.com\u002FJamfSoftware","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":206,"end":219,"href":null,"anchorType":"USER","userId":"3f436b2de07e","linkMetadata":null},{"__typename":"Markup","type":"A","start":272,"end":277,"href":"https:\u002F\u002Ftwitter.com\u002Fmattbenyo","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_9":{"__typename":"Paragraph","id":"9a6304d1f1c7_9","name":"371e","type":"P","href":null,"layout":null,"metadata":null,"text":"I also reached out to Cat Self, macOS lead for MITRE ATT&CK, for some leads in the macOS community. She was a great help in tracking down some individuals with experience in macOS administration who I was able to bounce my mitigation idea off of for a sanity check. Thank you, Cat!","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":22,"end":30,"href":null,"anchorType":"USER","userId":"727c9e5054e4","linkMetadata":null},{"__typename":"Markup","type":"A","start":277,"end":280,"href":"https:\u002F\u002Ftwitter.com\u002Fcoolestcatiknow","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_10":{"__typename":"Paragraph","id":"9a6304d1f1c7_10","name":"c258","type":"P","href":null,"layout":null,"metadata":null,"text":"The first section of this blog will cover persistence, launch agents, and why it is important to mitigate the techniques. So, if you already understand this or don’t want\u002Fneed a refresher, you can skip to the next section.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_11":{"__typename":"Paragraph","id":"9a6304d1f1c7_11","name":"3020","type":"H4","href":null,"layout":null,"metadata":null,"text":"Persistence","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_12":{"__typename":"Paragraph","id":"9a6304d1f1c7_12","name":"130b","type":"P","href":null,"layout":null,"metadata":null,"text":"Persistence is a vital tactic in the adversarial kill chain. It is typically the next step after initial access and payload\u002Fmalware execution. \"Persistence is the means by which malware ensures that it will be automatically (re)executed by the operating system on system startup or user (re)login\" (Wardle, 2020, p. 2). Most malware attempts to gain persistence. Otherwise, a system reboot would kill access to the infected system.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_13":{"__typename":"Paragraph","id":"9a6304d1f1c7_13","name":"8d4b","type":"H4","href":null,"layout":null,"metadata":null,"text":"Launch Persistence and launchd","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_14":{"__typename":"Paragraph","id":"9a6304d1f1c7_14","name":"5220","type":"P","href":null,"layout":null,"metadata":null,"text":"Launch persistence includes launch agents and launch daemons. “Launch items are the Apple recommended way to persist non-application binaries (e.g., software updates, background processes, etc)” (Wardle, 2020, p. 5).","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_15":{"__typename":"Paragraph","id":"9a6304d1f1c7_15","name":"0491","type":"P","href":null,"layout":null,"metadata":null,"text":"How does this work? After system boot and during system initialization, launchd searches the \u002FSystem\u002FLibrary\u002FLaunchDaemons\u002F and the root \u002FLibrary\u002FLaunchDaemons\u002F directories for property list files (plists) and launches the daemon that the plist requests to be running at all times. These are launch daemons.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":93,"end":123,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":137,"end":160,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":0,"end":19,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":93,"end":124,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":136,"end":161,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_16":{"__typename":"Paragraph","id":"9a6304d1f1c7_16","name":"1f62","type":"P","href":null,"layout":null,"metadata":null,"text":"When a user logs in, macOS starts a per-user launchd. This launchd launches the agent requested to be launched on-demand from the property list files found in \u002FSystem\u002FLibrary\u002FLaunchAgents, the root \u002FLibrary\u002FLaunchAgents, and the user’s ~\u002FLibrary\u002FLaunchAgents directory. These are launch agents.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":159,"end":187,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":198,"end":219,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":236,"end":258,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_17":{"__typename":"Paragraph","id":"9a6304d1f1c7_17","name":"8df9","type":"H4","href":null,"layout":null,"metadata":null,"text":"Property Lists (plists)","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_18":{"__typename":"Paragraph","id":"9a6304d1f1c7_18","name":"9147","type":"P","href":null,"layout":null,"metadata":null,"text":"Property lists are very important to understand when discussing launch persistence because they describe the launch persistence to launchd. A plist is typically an XML document that contains key\u002Fvalue pairs. A plist can also be in JSON format, and in more rare cases a binary. We will just focus on the XML plists for this article.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_19":{"__typename":"Paragraph","id":"9a6304d1f1c7_19","name":"83ca","type":"P","href":null,"layout":null,"metadata":null,"text":"To view the contents of a plist in human-readable form use the following commands:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_20":{"__typename":"Paragraph","id":"9a6304d1f1c7_20","name":"ecee","type":"P","href":null,"layout":null,"metadata":null,"text":"plutil -p \u003Cpath to plist\u003E","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":0,"end":25,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_21":{"__typename":"Paragraph","id":"9a6304d1f1c7_21","name":"176f","type":"P","href":null,"layout":null,"metadata":null,"text":"defaults read \u003Cpath to plist\u003E","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":0,"end":29,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_22":{"__typename":"Paragraph","id":"9a6304d1f1c7_22","name":"34e5","type":"P","href":null,"layout":null,"metadata":null,"text":"cat \u003Cpath to plist\u003E","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":0,"end":19,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*MmWRFSEMiO6JzvT9ULXCYA.png":{"__typename":"ImageMetadata","id":"1*MmWRFSEMiO6JzvT9ULXCYA.png","originalHeight":276,"originalWidth":367,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:9a6304d1f1c7_23":{"__typename":"Paragraph","id":"9a6304d1f1c7_23","name":"85b8","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*MmWRFSEMiO6JzvT9ULXCYA.png"},"text":"Example Property List","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_24":{"__typename":"Paragraph","id":"9a6304d1f1c7_24","name":"f6f5","type":"P","href":null,"layout":null,"metadata":null,"text":"In terms of persistence, the most pertinent key\u002Fvalue pairs include:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_25":{"__typename":"Paragraph","id":"9a6304d1f1c7_25","name":"662c","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Key: Program or Program Arguments. Value: Path to launch persistence’s script or binary to execute.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"STRONG","start":0,"end":3,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":35,"end":40,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_26":{"__typename":"Paragraph","id":"9a6304d1f1c7_26","name":"8486","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Key: RunAtLoad. Value: Contains a boolean that, if set to true, instructs launchd to automatically launch the launch persistence. The malware will be persistently restarted by macOS at system reboot at user re-login.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"STRONG","start":0,"end":3,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":16,"end":21,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":58,"end":64,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_27":{"__typename":"Paragraph","id":"9a6304d1f1c7_27","name":"4785","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Key: Label. Value: The job name. “This key is required for every job definition. It identifies the job and has to be unique for the launchd instance. Theoretically, it is possible for an agent to have the same label as a daemon, as daemons are loaded by the root launchd whereas agents are loaded by a user launchd, but it is not recommended by convention job names are written in reverse domain notation” (Soma-Zone, What is Launchd?). For example com.redteam.evil. For private agents, the domain local is a good choice: local.cleanup.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":381,"end":404,"href":"http:\u002F\u002Fen.wikipedia.org\u002Fwiki\u002FReverse_domain_name_notation","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":0,"end":3,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":12,"end":17,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":381,"end":404,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":418,"end":434,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":449,"end":465,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":522,"end":536,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_28":{"__typename":"Paragraph","id":"9a6304d1f1c7_28","name":"5116","type":"P","href":null,"layout":null,"metadata":null,"text":"These three key\u002Fvalue pairs are all that is needed to create launch persistence.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_29":{"__typename":"Paragraph","id":"9a6304d1f1c7_29","name":"1741","type":"H4","href":null,"layout":null,"metadata":null,"text":"Launch Persistence and Malware","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_30":{"__typename":"Paragraph","id":"9a6304d1f1c7_30","name":"cd75","type":"P","href":null,"layout":null,"metadata":null,"text":"To persist as a launch agent, malware can create a plist in the LaunchAgents directories, and for a launch daemon, it can do the same in the LaunchDaemons directory. Malware can create its persistence in the same manner as Apple recommends developers create persistence for their legitimate applications.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":64,"end":76,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":141,"end":155,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_31":{"__typename":"Paragraph","id":"9a6304d1f1c7_31","name":"ca98","type":"P","href":null,"layout":null,"metadata":null,"text":"Apple’s own Launch Agents live in the \u002FSystem\u002FLibrary\u002FLaunchAgents directory while Launch Daemons live in \u002FSystem\u002FLibrary\u002FLaunchDaemons. “Since the introduction of System Integrity Protection (SIP) in OS X 10.11 (El Capitan) these OS directories are now protected, therefore malware cannot modify them (i.e., they cannot create a “system” Launch Persistence). As such, malware is now constrained to creating launch persistence in the \u002FLibrary or ~\u002FLibrary directories” (Wardle, 2020, p. 6).","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":38,"end":66,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":106,"end":135,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_32":{"__typename":"Paragraph","id":"9a6304d1f1c7_32","name":"7494","type":"P","href":null,"layout":null,"metadata":null,"text":"Most macOS malware persists using launch persistence. In 2020, 80% of persistent malware persisted via launch persistence. According to “The Mac Malware of 2019” report, all persistent malware persisted via launch persistence. Needless to say, this is a critical technique for organizations to mitigate.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":137,"end":160,"href":"https:\u002F\u002Fobjective-see.com\u002Fblog\u002Fblog_0x53.html","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_33":{"__typename":"Paragraph","id":"9a6304d1f1c7_33","name":"e935","type":"H4","href":null,"layout":null,"metadata":null,"text":"Mitigation","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_34":{"__typename":"Paragraph","id":"9a6304d1f1c7_34","name":"5675","type":"P","href":null,"layout":null,"metadata":null,"text":"To mitigate the adversarial launch persistence techniques on our home computers, we can use Patrick Wardle of Objective-See’s Free and Open Sourced tool, BlockBlock. BlockBlock monitors common persistence locations and alerts whenever a persistent component is added. BlockBlock is a fantastic tool and is excellent for use on your personal mac, but it isn’t scalable to the enterprise. We need something that will block an adversary from creating a plist in the launch persistence directories.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":92,"end":106,"href":"https:\u002F\u002Ftwitter.com\u002Fpatrickwardle","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":110,"end":123,"href":"https:\u002F\u002Fobjective-see.com\u002Findex.html","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":154,"end":164,"href":"https:\u002F\u002Fobjective-see.com\u002Fproducts\u002Fblockblock.html","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_35":{"__typename":"Paragraph","id":"9a6304d1f1c7_35","name":"2410","type":"H4","href":null,"layout":null,"metadata":null,"text":"Enterprise Mitigation","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_36":{"__typename":"Paragraph","id":"9a6304d1f1c7_36","name":"d692","type":"P","href":null,"layout":null,"metadata":null,"text":"What I have found in my research is that we can lock the root-level launch persistence directories (\u002FLibrary\u002FLaunch(Agents || Daemons)) using a macOS mobile device management (MDM) solution. Assuming that the user of this managed machine does not have access to the local administrative (root) user account on this machine, the MDM admin(s) can lock these launch persistence directories using the root account. Now, only the owner of these directories (root) can unlock them. As it stands, malware, even running as root, would need to unlock the directory, and then create its launch persistence plist in the unlocked directory. I have not seen macOS malware with this bit of sophistication in the wild.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":100,"end":134,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_37":{"__typename":"Paragraph","id":"9a6304d1f1c7_37","name":"cb1d","type":"H4","href":null,"layout":null,"metadata":null,"text":"What do you mean by “locked?”","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_38":{"__typename":"Paragraph","id":"9a6304d1f1c7_38","name":"f7f2","type":"P","href":null,"layout":null,"metadata":null,"text":"Files and directories on macOS have a flag called the uchg, or user immutable flag. If one sets this flag, then the file or directory is “locked.” If set, this immutable bit means that the associated file or folder cannot be changed. If we set this user immutable bit on the root launch persistence directories, nothing can add to or remove from the directories. Malware cannot add a plist, which means, without additional actions, no additional launch persistence files can be added.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":54,"end":58,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_39":{"__typename":"Paragraph","id":"9a6304d1f1c7_39","name":"6a04","type":"P","href":null,"layout":null,"metadata":null,"text":"We can check if a file\u002Fdirectory has the uchg flag set by listing the file using the ls command with the -O option:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":41,"end":45,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":85,"end":87,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":105,"end":107,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_40":{"__typename":"Paragraph","id":"9a6304d1f1c7_40","name":"4349","type":"P","href":null,"layout":null,"metadata":null,"text":"ls -O \u003Cpath\u002Fto\u002Ffile\u002Fdir\u003E","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":0,"end":24,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*54zSwFkUcpspvZGHNLR72w.png":{"__typename":"ImageMetadata","id":"1*54zSwFkUcpspvZGHNLR72w.png","originalHeight":31,"originalWidth":545,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:9a6304d1f1c7_41":{"__typename":"Paragraph","id":"9a6304d1f1c7_41","name":"7d46","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*54zSwFkUcpspvZGHNLR72w.png"},"text":"LauchAgents directory is immutable","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_42":{"__typename":"Paragraph","id":"9a6304d1f1c7_42","name":"0a1f","type":"P","href":null,"layout":null,"metadata":null,"text":"We can set or unset this immutable bit using the default macOS tool, chflags.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":69,"end":76,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_43":{"__typename":"Paragraph","id":"9a6304d1f1c7_43","name":"43c2","type":"P","href":null,"layout":null,"metadata":null,"text":"To add the immutable bit:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_44":{"__typename":"Paragraph","id":"9a6304d1f1c7_44","name":"9587","type":"P","href":null,"layout":null,"metadata":null,"text":"$ chflags uchg \u002FLibrary\u002FLauchAgents","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":0,"end":35,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_45":{"__typename":"Paragraph","id":"9a6304d1f1c7_45","name":"25e4","type":"P","href":null,"layout":null,"metadata":null,"text":"To remove it:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_46":{"__typename":"Paragraph","id":"9a6304d1f1c7_46","name":"a9ff","type":"P","href":null,"layout":null,"metadata":null,"text":"$ chflags nouchg \u002FLibrary\u002FLauchAgents","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":0,"end":37,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_47":{"__typename":"Paragraph","id":"9a6304d1f1c7_47","name":"207e","type":"P","href":null,"layout":null,"metadata":null,"text":"You can also change the bit using the file information window, which you can access by pressing command + i . You can then check or uncheck the “Locked” check box. This method is not helpful in using an MDM for scripting the locking at scale but works if you’d like to do it on your personal macOS machine.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":96,"end":107,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*UxCbFAYrPDF2xGze8d69VQ.jpeg":{"__typename":"ImageMetadata","id":"1*UxCbFAYrPDF2xGze8d69VQ.jpeg","originalHeight":707,"originalWidth":265,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:9a6304d1f1c7_48":{"__typename":"Paragraph","id":"9a6304d1f1c7_48","name":"9b46","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*UxCbFAYrPDF2xGze8d69VQ.jpeg"},"text":"Unlocked LaunchAgents directory via File Information","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_49":{"__typename":"Paragraph","id":"9a6304d1f1c7_49","name":"83fb","type":"H4","href":null,"layout":null,"metadata":null,"text":"Will this break application functionality?","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_50":{"__typename":"Paragraph","id":"9a6304d1f1c7_50","name":"c034","type":"P","href":null,"layout":null,"metadata":null,"text":"When I told my colleagues about this mitigation method, they expressed concerns for legitimate applications that edit the plists they have created in the launch persistence directories. If an application loses its ability to write to its plist, this mitigation method might break application functionality. I agreed and did some testing.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_51":{"__typename":"Paragraph","id":"9a6304d1f1c7_51","name":"b55a","type":"P","href":null,"layout":null,"metadata":null,"text":"It turns out that with the immutable bit set, I was still able to edit and completely overwrite a plist inside these locked directories. So, even though nothing can add or remove a file in the locked launch persistence directories, one can still change the files inside. While this is excellent news for my mitigation method, this seems like immutable does not equal immutable. I reported this as a bug to Apple on 11\u002F8\u002F2021 and am awaiting a response.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":378,"end":452,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_52":{"__typename":"Paragraph","id":"9a6304d1f1c7_52","name":"c016","type":"P","href":null,"layout":null,"metadata":null,"text":"Note: Matthew Benyo informed me that one could use chflags -R uchg \u002FLibrary\u002FLauchAgents (-R option) and this will recursively lock the directory and all of its contents. However, because many services frequently update their plists this option is not ideal in that it may break service\u002Fapplication functionality.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":51,"end":87,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":89,"end":91,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":6,"end":19,"href":null,"anchorType":"USER","userId":"3f436b2de07e","linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_53":{"__typename":"Paragraph","id":"9a6304d1f1c7_53","name":"5af4","type":"H4","href":null,"layout":null,"metadata":null,"text":"What about the USER LaunchAgents directory?","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_54":{"__typename":"Paragraph","id":"9a6304d1f1c7_54","name":"b0c8","type":"P","href":null,"layout":null,"metadata":null,"text":"So, the local user account doesn’t own the root launch persistence directories. Therefore it cannot unlock the folder. Still, since the user owns the \u002FUsers\u002F\u003Cusername\u003E\u002FLibrary\u002FLaunchAgents directory, they can just unlock it, negating the mitigation in userland. This user LaunchAgent directory might not be necessary for an enterprise environment. Most approved software that I’ve seen lately in an enterprise environment doesn’t need to install persistence here, so we need a way to lock it down permanently.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":150,"end":188,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_55":{"__typename":"Paragraph","id":"9a6304d1f1c7_55","name":"d4da","type":"P","href":null,"layout":null,"metadata":null,"text":"Our MDM solution can create an unprivileged user account on each managed macOS system. Using this unprivileged administrative account, the MDM administrator can create the LaunchAgent directory for our real user and change ownership of the directory to the unprivileged administrative user account. The MDM administrator can then lock the directory. Now the actual user cannot unlock the directory because they, again, do not own it.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_56":{"__typename":"Paragraph","id":"9a6304d1f1c7_56","name":"0546","type":"P","href":null,"layout":null,"metadata":null,"text":"This new unprivileged administrative user can be considered a honey-user account. Defense should monitor it, and any attempts to log in to the account should create an alert and probably be regarded as malicious.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_57":{"__typename":"Paragraph","id":"9a6304d1f1c7_57","name":"714c","type":"H4","href":null,"layout":null,"metadata":null,"text":"How do we do this at scale?","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_58":{"__typename":"Paragraph","id":"9a6304d1f1c7_58","name":"c44c","type":"P","href":null,"layout":null,"metadata":null,"text":"Applications only need to add\u002Fcreate a plist to the root launch persistence directories at install time. If your IT administrators manage installations, they can install approved software using an MDM solution with scripting capabilities.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_59":{"__typename":"Paragraph","id":"9a6304d1f1c7_59","name":"9f41","type":"P","href":null,"layout":null,"metadata":null,"text":"To explain how an administrator can configure this in an enterprise environment, I have teamed up with Matthew Benyo from Jamf.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":103,"end":116,"href":null,"anchorType":"USER","userId":"3f436b2de07e","linkMetadata":null},{"__typename":"Markup","type":"A","start":122,"end":126,"href":"https:\u002F\u002Fwww.jamf.com\u002Fproducts\u002Fjamf-pro\u002F","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_60":{"__typename":"Paragraph","id":"9a6304d1f1c7_60","name":"d402","type":"H4","href":null,"layout":null,"metadata":null,"text":"Protecting Launch Directories with Jamf Pro","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_61":{"__typename":"Paragraph","id":"9a6304d1f1c7_61","name":"21e6","type":"P","href":null,"layout":null,"metadata":null,"text":"The following is an example of how an admin might use Jamf Pro to lock the LaunchDaemon and LaunchAgent directories across a macOS fleet. This workflow highlights key Jamf Pro features, including scripting via the Jamf Pro binary, reporting and monitoring via custom inventory attributes, and scoping actions with a dynamic Smart Computer Group.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":75,"end":88,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":92,"end":104,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_62":{"__typename":"Paragraph","id":"9a6304d1f1c7_62","name":"fc10","type":"H4","href":null,"layout":null,"metadata":null,"text":"Reporting on uchg Status","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_63":{"__typename":"Paragraph","id":"9a6304d1f1c7_63","name":"ae19","type":"P","href":null,"layout":null,"metadata":null,"text":"The first step of the Jamf Pro workflow is to be able to determine whether the launch persistence directories have been uchg locked. We do this by creating a Jamf Pro Extension Attribute that is updated during the routine Jamf Pro inventory update. This custom inventory attribute checks the uchg status of the launch persistence directories and updates each computer’s inventory record.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":120,"end":125,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":292,"end":297,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_64":{"__typename":"Paragraph","id":"9a6304d1f1c7_64","name":"c699","type":"P","href":null,"layout":null,"metadata":null,"text":"As Anthony demonstrated, you can see the uchg status by listing the file or directory using the ls command with the -lO option: ls -lO \u003Cpath\u002Fto\u002Ffile\u002Fdir\u003E .","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":41,"end":45,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":116,"end":119,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":128,"end":153,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_65":{"__typename":"Paragraph","id":"9a6304d1f1c7_65","name":"1e32","type":"P","href":null,"layout":null,"metadata":null,"text":"In this example, we have created a custom Extension Attribute called “Launch Persistence Directories”. The Extension Attributes work by running a snippet of bash script that checks the uchg status of each launch persistence directory location and returns the result.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":185,"end":189,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*RlyKmER6ZnreA2QkwdHReA.png":{"__typename":"ImageMetadata","id":"1*RlyKmER6ZnreA2QkwdHReA.png","originalHeight":1000,"originalWidth":1600,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:9a6304d1f1c7_66":{"__typename":"Paragraph","id":"9a6304d1f1c7_66","name":"cbf4","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*RlyKmER6ZnreA2QkwdHReA.png"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_67":{"__typename":"Paragraph","id":"9a6304d1f1c7_67","name":"6383","type":"P","href":null,"layout":null,"metadata":null,"text":"We can check the flags of a file or directory by running ls with the -Ol flag. We can then grab the uchg flag status by using awk to capture the fifth column, put that output into variables, and then test the variable values for the substring uchg.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":100,"end":104,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":126,"end":129,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":243,"end":247,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*_2emNE2vaJH_gJgloPFYyg.png":{"__typename":"ImageMetadata","id":"1*_2emNE2vaJH_gJgloPFYyg.png","originalHeight":902,"originalWidth":1600,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:9a6304d1f1c7_68":{"__typename":"Paragraph","id":"9a6304d1f1c7_68","name":"aaa7","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*_2emNE2vaJH_gJgloPFYyg.png"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_69":{"__typename":"Paragraph","id":"9a6304d1f1c7_69","name":"e465","type":"P","href":null,"layout":null,"metadata":null,"text":"The image below is how the result of this Extension Attribute appears in the computer inventory record:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*gKpgq1W7wWgQwMOXdFffTA.png":{"__typename":"ImageMetadata","id":"1*gKpgq1W7wWgQwMOXdFffTA.png","originalHeight":1000,"originalWidth":1600,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:9a6304d1f1c7_70":{"__typename":"Paragraph","id":"9a6304d1f1c7_70","name":"2594","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*gKpgq1W7wWgQwMOXdFffTA.png"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_71":{"__typename":"Paragraph","id":"9a6304d1f1c7_71","name":"c2c9","type":"P","href":null,"layout":null,"metadata":null,"text":"Once we can report on the uchg status of the Launch directories, we can then use that attribute as the basis for a Smart Group to scope our policy. First, we give the Smart Group an identifying name. Then we define the criteria for this group as any computer that contains the word unlocked in the Launch Persistence Directories inventory field.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":26,"end":31,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":246,"end":345,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*yqOqespd4lwy7NiiGPFbeg.png":{"__typename":"ImageMetadata","id":"1*yqOqespd4lwy7NiiGPFbeg.png","originalHeight":1000,"originalWidth":1600,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:9a6304d1f1c7_72":{"__typename":"Paragraph","id":"9a6304d1f1c7_72","name":"7147","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*yqOqespd4lwy7NiiGPFbeg.png"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_73":{"__typename":"Paragraph","id":"9a6304d1f1c7_73","name":"b078","type":"H4","href":null,"layout":null,"metadata":null,"text":"Writing the Script","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_74":{"__typename":"Paragraph","id":"9a6304d1f1c7_74","name":"8701","type":"P","href":null,"layout":null,"metadata":null,"text":"Next, we need to write the script that locks the launch persistence directories. Since the ~\u002FLibrary\u002FLaunchAgents\u002F directory does not exist by default, in this script, we check for its existence and create it if not present. If the user is a standard user, Antonio recommends creating an unprivileged user account on each machine and changing ownership of the ~\u002FLibrary\u002FLaunchAgents to this stand-in account. This avoids having the directory owned by root and prevents the local user from simply unlocking their directory as its owner.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":91,"end":114,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":360,"end":382,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_75":{"__typename":"Paragraph","id":"9a6304d1f1c7_75","name":"07d8","type":"P","href":null,"layout":null,"metadata":null,"text":"Lastly, we use chflags uchg to lock each directory.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":15,"end":27,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*dF_RkHf_dBbxr9zyKZKSOg.png":{"__typename":"ImageMetadata","id":"1*dF_RkHf_dBbxr9zyKZKSOg.png","originalHeight":1000,"originalWidth":1600,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:9a6304d1f1c7_76":{"__typename":"Paragraph","id":"9a6304d1f1c7_76","name":"0910","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*dF_RkHf_dBbxr9zyKZKSOg.png"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_77":{"__typename":"Paragraph","id":"9a6304d1f1c7_77","name":"cdc8","type":"H4","href":null,"layout":null,"metadata":null,"text":"Crafting the Policy","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_78":{"__typename":"Paragraph","id":"9a6304d1f1c7_78","name":"3524","type":"P","href":null,"layout":null,"metadata":null,"text":"Finally, we create a policy that ties all of these elements together. After giving the policy an appropriate name, we set the policy to be triggered at the recurring check-in (every 15 minutes by default) on any computer that is in scope.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*DvOEzIZElp00EaPVYA5Lqw.png":{"__typename":"ImageMetadata","id":"1*DvOEzIZElp00EaPVYA5Lqw.png","originalHeight":1000,"originalWidth":1600,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:9a6304d1f1c7_79":{"__typename":"Paragraph","id":"9a6304d1f1c7_79","name":"c8c6","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*DvOEzIZElp00EaPVYA5Lqw.png"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_80":{"__typename":"Paragraph","id":"9a6304d1f1c7_80","name":"d143","type":"P","href":null,"layout":null,"metadata":null,"text":"And for the scope, we set the policy to run against any computer that falls into the “Launch Directories Unlocked” Smart Group that we previously created.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*C-pZJ2aM4nP-_B1DtoM6hg.png":{"__typename":"ImageMetadata","id":"1*C-pZJ2aM4nP-_B1DtoM6hg.png","originalHeight":1000,"originalWidth":1600,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:9a6304d1f1c7_81":{"__typename":"Paragraph","id":"9a6304d1f1c7_81","name":"9016","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*C-pZJ2aM4nP-_B1DtoM6hg.png"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_82":{"__typename":"Paragraph","id":"9a6304d1f1c7_82","name":"2d1a","type":"P","href":null,"layout":null,"metadata":null,"text":"As for the Policy payloads, we will configure the Scripts payload and add our Lock Launch Directories script.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*trrOWcE9h556WbjmzKRlTw.png":{"__typename":"ImageMetadata","id":"1*trrOWcE9h556WbjmzKRlTw.png","originalHeight":1000,"originalWidth":1600,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:9a6304d1f1c7_83":{"__typename":"Paragraph","id":"9a6304d1f1c7_83","name":"d312","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*trrOWcE9h556WbjmzKRlTw.png"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_84":{"__typename":"Paragraph","id":"9a6304d1f1c7_84","name":"302b","type":"P","href":null,"layout":null,"metadata":null,"text":"We also add a secondary Maintenance payload to force an inventory update, to immediately reflect this change in the computer inventory record and remove the computer from the “Launch Directories Unlocked” Smart Computer Group.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*aAQPqNfzhG1ypvaCDY0JZQ.png":{"__typename":"ImageMetadata","id":"1*aAQPqNfzhG1ypvaCDY0JZQ.png","originalHeight":1000,"originalWidth":1600,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:9a6304d1f1c7_85":{"__typename":"Paragraph","id":"9a6304d1f1c7_85","name":"c0d8","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*aAQPqNfzhG1ypvaCDY0JZQ.png"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_86":{"__typename":"Paragraph","id":"9a6304d1f1c7_86","name":"eb95","type":"P","href":null,"layout":null,"metadata":null,"text":"When the need arises to install a legitimate Launch Daemon or Launch Agent, an admin should run the chflags nouchgin a preinstall script to remove the lock and then re-enable the flag in a post-install script.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":108,"end":114,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_87":{"__typename":"Paragraph","id":"9a6304d1f1c7_87","name":"e86c","type":"H4","href":null,"layout":null,"metadata":null,"text":"To Summarize","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_88":{"__typename":"Paragraph","id":"9a6304d1f1c7_88","name":"766c","type":"P","href":null,"layout":null,"metadata":null,"text":"We can lock the root-level launch persistence directories using an MDM solution with scripting capabilities, like Jamf Pro. An administrator would only unlock it when installing approved software. They would then relock it after install.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_89":{"__typename":"Paragraph","id":"9a6304d1f1c7_89","name":"d077","type":"P","href":null,"layout":null,"metadata":null,"text":"The administrator can create a honey-user account for each managed macOS machine and change the owner of the user-level LaunchAgents directory to this honey-user. The admin can then lock the user-level directory.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_90":{"__typename":"Paragraph","id":"9a6304d1f1c7_90","name":"661d","type":"P","href":null,"layout":null,"metadata":null,"text":"I hope this mitigation strategy works for your enterprise environment. I’d love to hear from anyone who gives it a try. Contact me via my antman1p Twitter.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":138,"end":147,"href":"https:\u002F\u002Ftwitter.com\u002Fantman1P","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_91":{"__typename":"Paragraph","id":"9a6304d1f1c7_91","name":"6290","type":"P","href":null,"layout":null,"metadata":null,"text":"As always, thanks for reading, and stand by for more sauce!","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_92":{"__typename":"Paragraph","id":"9a6304d1f1c7_92","name":"0438","type":"H4","href":null,"layout":null,"metadata":null,"text":"Works Cited","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_93":{"__typename":"Paragraph","id":"9a6304d1f1c7_93","name":"86be","type":"P","href":null,"layout":null,"metadata":null,"text":"Apple. (2016, September 13). Daemons and services programming guide. Creating Launch Daemons and Agents. Retrieved November 9, 2021, from https:\u002F\u002Fdeveloper.apple.com\u002Flibrary\u002Farchive\u002Fdocumentation\u002FMacOSX\u002FConceptual\u002FBPSystemStartup\u002FChapters\u002FCreatingLaunchdJobs.html.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":138,"end":264,"href":"https:\u002F\u002Fdeveloper.apple.com\u002Flibrary\u002Farchive\u002Fdocumentation\u002FMacOSX\u002FConceptual\u002FBPSystemStartup\u002FChapters\u002FCreatingLaunchdJobs.html.","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":29,"end":67,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_94":{"__typename":"Paragraph","id":"9a6304d1f1c7_94","name":"37df","type":"P","href":null,"layout":null,"metadata":null,"text":"Mitre ATT&CK®. MITRE ATT&CK®. (n.d.). Retrieved November 9, 2021, from https:\u002F\u002Fattack.mitre.org\u002F.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":71,"end":97,"href":"https:\u002F\u002Fattack.mitre.org\u002F.","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":0,"end":13,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_95":{"__typename":"Paragraph","id":"9a6304d1f1c7_95","name":"0bc5","type":"P","href":null,"layout":null,"metadata":null,"text":"Patrick Wardle. (2020). Analysis. The Art of Mac Malware. Retrieved November 9, 2021, from https:\u002F\u002Ftaomm.org\u002Fvol1\u002Fanalysis.html.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":91,"end":128,"href":"https:\u002F\u002Ftaomm.org\u002Fvol1\u002Fanalysis.html.","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":24,"end":32,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_96":{"__typename":"Paragraph","id":"9a6304d1f1c7_96","name":"11de","type":"P","href":null,"layout":null,"metadata":null,"text":"Soma-Zone. (n.d.). What is Launchd? A launchd Tutorial. Retrieved November 21, 2021, from https:\u002F\u002Fwww.launchd.info\u002F.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":90,"end":116,"href":"https:\u002F\u002Fwww.launchd.info\u002F.","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":19,"end":35,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:9a6304d1f1c7_97":{"__typename":"Paragraph","id":"9a6304d1f1c7_97","name":"7bca","type":"P","href":null,"layout":null,"metadata":null,"text":"Thanks to Justin Bui for the feedback!","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":10,"end":20,"href":null,"anchorType":"USER","userId":"d64a8a5f03d6","linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"PostViewerEdge:postId:156e2b40fc67-viewerId:lo_b1fba1d1167c":{"__typename":"PostViewerEdge","shouldIndexPostForExternalSearch":true,"id":"postId:156e2b40fc67-viewerId:lo_b1fba1d1167c"},"Tag:macos":{"__typename":"Tag","id":"macos","displayTitle":"Macos","normalizedTagSlug":"macos"},"Tag:mitre-attack":{"__typename":"Tag","id":"mitre-attack","displayTitle":"Mitre Attack","normalizedTagSlug":"mitre-attack"},"Tag:jamf-pro":{"__typename":"Tag","id":"jamf-pro","displayTitle":"Jamf Pro","normalizedTagSlug":"jamf-pro"},"Tag:launchagents":{"__typename":"Tag","id":"launchagents","displayTitle":"Launchagents","normalizedTagSlug":"launchagents"},"Tag:persistence":{"__typename":"Tag","id":"persistence","displayTitle":"Persistence","normalizedTagSlug":"persistence"},"Post:156e2b40fc67":{"__typename":"Post","id":"156e2b40fc67","collection":null,"content({\"postMeteringOptions\":{}})":{"__typename":"PostContent","isLockedPreviewOnly":false,"bodyModel":{"__typename":"RichText","sections":[{"__typename":"Section","name":"d9d6","startIndex":0,"textLayout":null,"imageLayout":null,"backgroundImage":null,"videoLayout":null,"backgroundVideo":null},{"__typename":"Section","name":"e7a6","startIndex":11,"textLayout":null,"imageLayout":null,"backgroundImage":null,"videoLayout":null,"backgroundVideo":null},{"__typename":"Section","name":"d537","startIndex":33,"textLayout":null,"imageLayout":null,"backgroundImage":null,"videoLayout":null,"backgroundVideo":null},{"__typename":"Section","name":"30c9","startIndex":60,"textLayout":null,"imageLayout":null,"backgroundImage":null,"videoLayout":null,"backgroundVideo":null},{"__typename":"Section","name":"af2c","startIndex":87,"textLayout":null,"imageLayout":null,"backgroundImage":null,"videoLayout":null,"backgroundVideo":null},{"__typename":"Section","name":"0a6f","startIndex":92,"textLayout":null,"imageLayout":null,"backgroundImage":null,"videoLayout":null,"backgroundVideo":null}],"paragraphs":[{"__ref":"Paragraph:9a6304d1f1c7_0"},{"__ref":"Paragraph:9a6304d1f1c7_1"},{"__ref":"Paragraph:9a6304d1f1c7_2"},{"__ref":"Paragraph:9a6304d1f1c7_3"},{"__ref":"Paragraph:9a6304d1f1c7_4"},{"__ref":"Paragraph:9a6304d1f1c7_5"},{"__ref":"Paragraph:9a6304d1f1c7_6"},{"__ref":"Paragraph:9a6304d1f1c7_7"},{"__ref":"Paragraph:9a6304d1f1c7_8"},{"__ref":"Paragraph:9a6304d1f1c7_9"},{"__ref":"Paragraph:9a6304d1f1c7_10"},{"__ref":"Paragraph:9a6304d1f1c7_11"},{"__ref":"Paragraph:9a6304d1f1c7_12"},{"__ref":"Paragraph:9a6304d1f1c7_13"},{"__ref":"Paragraph:9a6304d1f1c7_14"},{"__ref":"Paragraph:9a6304d1f1c7_15"},{"__ref":"Paragraph:9a6304d1f1c7_16"},{"__ref":"Paragraph:9a6304d1f1c7_17"},{"__ref":"Paragraph:9a6304d1f1c7_18"},{"__ref":"Paragraph:9a6304d1f1c7_19"},{"__ref":"Paragraph:9a6304d1f1c7_20"},{"__ref":"Paragraph:9a6304d1f1c7_21"},{"__ref":"Paragraph:9a6304d1f1c7_22"},{"__ref":"Paragraph:9a6304d1f1c7_23"},{"__ref":"Paragraph:9a6304d1f1c7_24"},{"__ref":"Paragraph:9a6304d1f1c7_25"},{"__ref":"Paragraph:9a6304d1f1c7_26"},{"__ref":"Paragraph:9a6304d1f1c7_27"},{"__ref":"Paragraph:9a6304d1f1c7_28"},{"__ref":"Paragraph:9a6304d1f1c7_29"},{"__ref":"Paragraph:9a6304d1f1c7_30"},{"__ref":"Paragraph:9a6304d1f1c7_31"},{"__ref":"Paragraph:9a6304d1f1c7_32"},{"__ref":"Paragraph:9a6304d1f1c7_33"},{"__ref":"Paragraph:9a6304d1f1c7_34"},{"__ref":"Paragraph:9a6304d1f1c7_35"},{"__ref":"Paragraph:9a6304d1f1c7_36"},{"__ref":"Paragraph:9a6304d1f1c7_37"},{"__ref":"Paragraph:9a6304d1f1c7_38"},{"__ref":"Paragraph:9a6304d1f1c7_39"},{"__ref":"Paragraph:9a6304d1f1c7_40"},{"__ref":"Paragraph:9a6304d1f1c7_41"},{"__ref":"Paragraph:9a6304d1f1c7_42"},{"__ref":"Paragraph:9a6304d1f1c7_43"},{"__ref":"Paragraph:9a6304d1f1c7_44"},{"__ref":"Paragraph:9a6304d1f1c7_45"},{"__ref":"Paragraph:9a6304d1f1c7_46"},{"__ref":"Paragraph:9a6304d1f1c7_47"},{"__ref":"Paragraph:9a6304d1f1c7_48"},{"__ref":"Paragraph:9a6304d1f1c7_49"},{"__ref":"Paragraph:9a6304d1f1c7_50"},{"__ref":"Paragraph:9a6304d1f1c7_51"},{"__ref":"Paragraph:9a6304d1f1c7_52"},{"__ref":"Paragraph:9a6304d1f1c7_53"},{"__ref":"Paragraph:9a6304d1f1c7_54"},{"__ref":"Paragraph:9a6304d1f1c7_55"},{"__ref":"Paragraph:9a6304d1f1c7_56"},{"__ref":"Paragraph:9a6304d1f1c7_57"},{"__ref":"Paragraph:9a6304d1f1c7_58"},{"__ref":"Paragraph:9a6304d1f1c7_59"},{"__ref":"Paragraph:9a6304d1f1c7_60"},{"__ref":"Paragraph:9a6304d1f1c7_61"},{"__ref":"Paragraph:9a6304d1f1c7_62"},{"__ref":"Paragraph:9a6304d1f1c7_63"},{"__ref":"Paragraph:9a6304d1f1c7_64"},{"__ref":"Paragraph:9a6304d1f1c7_65"},{"__ref":"Paragraph:9a6304d1f1c7_66"},{"__ref":"Paragraph:9a6304d1f1c7_67"},{"__ref":"Paragraph:9a6304d1f1c7_68"},{"__ref":"Paragraph:9a6304d1f1c7_69"},{"__ref":"Paragraph:9a6304d1f1c7_70"},{"__ref":"Paragraph:9a6304d1f1c7_71"},{"__ref":"Paragraph:9a6304d1f1c7_72"},{"__ref":"Paragraph:9a6304d1f1c7_73"},{"__ref":"Paragraph:9a6304d1f1c7_74"},{"__ref":"Paragraph:9a6304d1f1c7_75"},{"__ref":"Paragraph:9a6304d1f1c7_76"},{"__ref":"Paragraph:9a6304d1f1c7_77"},{"__ref":"Paragraph:9a6304d1f1c7_78"},{"__ref":"Paragraph:9a6304d1f1c7_79"},{"__ref":"Paragraph:9a6304d1f1c7_80"},{"__ref":"Paragraph:9a6304d1f1c7_81"},{"__ref":"Paragraph:9a6304d1f1c7_82"},{"__ref":"Paragraph:9a6304d1f1c7_83"},{"__ref":"Paragraph:9a6304d1f1c7_84"},{"__ref":"Paragraph:9a6304d1f1c7_85"},{"__ref":"Paragraph:9a6304d1f1c7_86"},{"__ref":"Paragraph:9a6304d1f1c7_87"},{"__ref":"Paragraph:9a6304d1f1c7_88"},{"__ref":"Paragraph:9a6304d1f1c7_89"},{"__ref":"Paragraph:9a6304d1f1c7_90"},{"__ref":"Paragraph:9a6304d1f1c7_91"},{"__ref":"Paragraph:9a6304d1f1c7_92"},{"__ref":"Paragraph:9a6304d1f1c7_93"},{"__ref":"Paragraph:9a6304d1f1c7_94"},{"__ref":"Paragraph:9a6304d1f1c7_95"},{"__ref":"Paragraph:9a6304d1f1c7_96"},{"__ref":"Paragraph:9a6304d1f1c7_97"}]},"validatedShareKey":"","shareKeyCreator":null},"creator":{"__ref":"User:6933f3d65c15"},"inResponseToEntityType":null,"isLocked":false,"isMarkedPaywallOnly":false,"lockedSource":"LOCKED_POST_SOURCE_NONE","mediumUrl":"https:\u002F\u002Fantman1p-30185.medium.com\u002Fdefeating-malicious-launch-persistence-156e2b40fc67","primaryTopic":null,"topics":[{"__typename":"Topic","slug":"cybersecurity"}],"isPublished":true,"latestPublishedVersion":"9a6304d1f1c7","visibility":"PUBLIC","postResponses":{"__typename":"PostResponses","count":0},"clapCount":8,"allowResponses":true,"isLimitedState":false,"title":"Defeating Malicious Launch Persistence","isSeries":false,"sequence":null,"uniqueSlug":"defeating-malicious-launch-persistence-156e2b40fc67","socialTitle":"","socialDek":"","canonicalUrl":"","metaDescription":"","latestPublishedAt":1637702851442,"readingTime":11,"previewContent":{"__typename":"PreviewContent","subtitle":"A New Mitigation Strategy for the most used macOS Persistence Technique"},"previewImage":{"__ref":"ImageMetadata:1*Jn5o3_7Ori7R3FowlPkLiA.png"},"isShortform":false,"seoTitle":"","firstPublishedAt":1637679713066,"updatedAt":1641285549446,"shortformType":"SHORTFORM_TYPE_LINK","seoDescription":"","viewerEdge":{"__ref":"PostViewerEdge:postId:156e2b40fc67-viewerId:lo_b1fba1d1167c"},"isSuspended":false,"license":"ALL_RIGHTS_RESERVED","tags":[{"__ref":"Tag:macos"},{"__ref":"Tag:mitre-attack"},{"__ref":"Tag:jamf-pro"},{"__ref":"Tag:launchagents"},{"__ref":"Tag:persistence"}],"isNewsletter":false,"statusForCollection":null,"pendingCollection":null,"detectedLanguage":"en","wordCount":2544,"layerCake":0}}</script><script>window.__MIDDLEWARE_STATE__={"session":{"xsrf":""},"cache":{"cacheStatus":"HIT"}}</script><script src="https://cdn-client.medium.com/lite/static/js/manifest.7e50e797.js"></script><script src="https://cdn-client.medium.com/lite/static/js/9865.1496d74a.js"></script><script src="https://cdn-client.medium.com/lite/static/js/main.018e7ca9.js"></script><script src="https://cdn-client.medium.com/lite/static/js/instrumentation.d9108df7.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/reporting.ff22a7a5.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/5049.d1ead72d.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/4810.6318add7.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/6618.db187378.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/1386.6a7a21a1.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/9977.84e4bd5c.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/719.ae4dd3e0.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/5250.9f9e01d2.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/6349.b071a958.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/2648.26563adf.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/8393.826a25fb.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/1443.598cb8b2.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/3735.8c38ede2.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/5642.d10c9ba0.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/6546.cd03f950.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/6834.08de95de.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/1781.db373833.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/2420.0330d157.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/839.ca7937c2.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/7975.d195c6f1.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/2106.21ff89d3.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/7394.55c925ce.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/2961.00a48598.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/230.4d7a2738.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/4391.59acaed3.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/PostPage.MainContent.563d0db5.chunk.js"></script><script>window.main();</script><script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'8d758fc75e0adf4d',t:'MTcyOTcyNjcxNi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body></html>