import os
import re

# Regex pattern to detect URLs
url_pattern = re.compile(r'(https?://\S+)')

def is_pdf(file_path):
    """Check if a file is a PDF by reading its signature."""
    try:
        with open(file_path, 'rb') as f:
            return f.read(4) == b'%PDF'
    except:
        return False

def get_unique_name(path, base_name, extension):
    """Generate a unique file name if a file with the desired name exists."""
    counter = 1
    new_name = f"{base_name}{extension}"
    new_path = os.path.join(path, new_name)
    while os.path.exists(new_path):
        new_name = f"{base_name}_{counter}{extension}"
        new_path = os.path.join(path, new_name)
        counter += 1
    return new_path

def process_files(directory):
    for root, _, files in os.walk(directory):
        for file in files:
            file_path = os.path.join(root, file)
            
            # Determine file type and rename accordingly
            if is_pdf(file_path):
                new_name = get_unique_name(root, 'content', '.pdf')
            
            else:
                # Read file content to check text content type
                try:
                    with open(file_path, 'r', encoding='utf-8', errors='ignore') as f:
                        lines = f.readlines()
                    
                    if len(lines) == 1 and re.search(url_pattern, lines[0]):
                        new_name = get_unique_name(root, 'link', '.md')
                    
                    elif len(lines) > 1:
                        new_name = get_unique_name(root, 'content', '.txt')
                    
                    else:
                        continue  # Skip files that don’t match criteria
                except:
                    continue  # Skip files that can’t be read as text

            # Rename file
            os.rename(file_path, new_name)
            print(f'Renamed: {file_path} to {new_name}')

# Example usage
process_files(r'.')
