<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Borr Malware – Telegraph</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0, user-scalable=no" />
    <meta name="format-detection" content="telephone=no" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="MobileOptimized" content="176" />
    <meta name="HandheldFriendly" content="True" />
    <meta name="robots" content="index, follow" />
    <meta property="og:type" content="article">
    <meta property="og:title" content="Borr Malware">
    <meta property="og:description" content="Продажник: https://lolzteam.online/threads/1327287/
Семпл: https://twitter.com/ViriBack/status/1222704498923032576
Реверс
Для начала откроем файл в ExeInfoPe.">
    <meta property="og:image" content="">
    <meta property="og:site_name" content="Telegraph">
    <meta property="article:published_time" content="2020-02-04T14:55:56+0000">
    <meta property="article:modified_time" content="2020-02-04T18:13:41+0000">
    <meta property="article:author" content="https://t.me/onek1lo_blog">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Borr Malware">
    <meta name="twitter:description" content="Продажник: https://lolzteam.online/threads/1327287/
Семпл: https://twitter.com/ViriBack/status/1222704498923032576
Реверс
Для начала откроем файл в ExeInfoPe.">
    <meta name="twitter:image" content="">
    <link rel="canonical" href="https://telegra.ph/Borr-Malware-02-04" />
    <link rel="shortcut icon" href="/favicon.ico?1" type="image/x-icon">
    <link rel="icon" type="image/png" href="/images/favicon.png?1" sizes="16x16">
    <link rel="icon" type="image/png" href="/images/favicon_2x.png?1" sizes="32x32">
    <link href="/css/quill.core.min.css" rel="stylesheet">
    <link href="/css/core.min.css?47" rel="stylesheet">
  </head>
  <body>
    <div class="tl_page_wrap">
      <div class="tl_page">
        <main class="tl_article">
          <header class="tl_article_header" dir="auto">
            <h1>Borr Malware</h1>
            <address>
              <a rel="author" href="https://t.me/onek1lo_blog" target="_blank">https://t.me/onek1lo_blog</a><!--
           --><time datetime="2020-02-04T14:55:56+0000">February 04, 2020</time>
            </address>
          </header>
          <article id="_tl_editor" class="tl_article_content"><h1>Borr Malware<br></h1><address><a href="https://t.me/onek1lo_blog" target="_blank">https://t.me/onek1lo_blog</a><br></address><p>Продажник: <a href="https://lolzteam.online/threads/1327287/" target="_blank">https://lolzteam.online/threads/1327287/</a></p><p>Семпл: <a href="https://twitter.com/ViriBack/status/1222704498923032576" target="_blank">https://twitter.com/ViriBack/status/1222704498923032576</a></p><h3 id="Реверс">Реверс</h3><p>Для начала откроем файл в ExeInfoPe.</p><figure><img src="/file/0e80b38d8d50e3663f947.png"><figcaption>Исходный семпл</figcaption></figure><p>DotNet файл, накрытый SmartAssembly. Первым делом попытаемся скормить его De4dot.</p><figure><img src="/file/23f2a0b55368a3161bf41.png"><figcaption></figcaption></figure><p>Результат не порадовал, чистого файла мы не получили. Придется смотреть вручную. Открываем файл в DnSpy, переходим в .cctor</p><figure><img src="/file/2458d10162ecd06ccc961.png"><figcaption>.cctor</figcaption></figure><p>Ничего интересного в этих методах я не нашел. Но зато меня привлек файл в ресурсах, очень похожий на шифрованный бинарник.</p><figure><img src="/file/4559c693a6740392ce92b.png"><figcaption></figcaption></figure><p>Значит, в каком то куске кода он будет расшифрован и подгружен. Пропускаем методы (ставим брекпоинт в конце .cctor), шагаем и смотрим модули</p><figure><img src="/file/19b8c9250305966ab997b.png"><figcaption></figcaption></figure><p>Подгрузилась Dll (1thzpxouagh). Сохраняем ее и открываем в DnSpy.</p><p>Оказывается, стиллер накрыт криптом из SmartAssembly + RunPE. Стаб использует RunPE, а значит скорее всего в ресурсах нативный файл.</p><figure><img src="/file/f46bd5cf0196fc1cb1c0a.png"><figcaption></figcaption></figure><p>Смотрим ресурсы, видим шифрованный файл. В самом коде все главные методы без обфускации. Написать декриптор будет просто.</p><figure><img src="/file/1d50a2497baecef3ebd5b.png"><figcaption>Пишем декриптор</figcaption></figure><p>После расшифровки получаем чистый билд. Откроем его в ExeInfoPE.</p><figure><img src="/file/81ebefda2c1ff32d40566.png"><figcaption>Чистый билд</figcaption></figure><p>Файл нативен, и это правда. Но несовсем. Данный софт использует технологию <a href="https://habr.com/en/sandbox/26894/" target="_blank"><em>CRL-Hosting</em></a><em>. </em>Грубо говоря, перед нами сейчас нативная обертка DotNet файла.</p><p>С точки зрения написания малвари кажется, что этот способ сокрытия кода наиболее эффективен. Однако это не панацея. В процессе работы будет подгружен .net модуль, который легко сдампить.</p><p>В нашем случае все еще проще. Стиллер работает какое-то время, а значит можно даже не искать нужные брекпоинты - просто запускаем приложение в дебаггере, ждем несколько секунд и ставим паузу. Net модуль загружен, можно дампить.</p><p>Лично я испльзовал x32dbg и ExtremeDumper.</p><figure><img src="/file/f6dd5dc268ec75206ed8f.png"><figcaption>Дампим, дампим, дампим...</figcaption></figure><p>Что делаем? Правильно.</p><figure><img src="/file/3ba202ea70ae9434ba903.png"><figcaption>Последний рывок</figcaption></figure><p>Неизвестный обфускатор. Ничего страшного, открываем в DnSpy и видим мод конфузера.</p><figure><img src="/file/bd5eb9c1fec052211d103.png"><figcaption>Шо, опять?</figcaption></figure><p>Ставим брекпоинт на Main, чекаем переменные.</p><figure><img src="/file/dff67354755539e4e1607.png"><figcaption></figcaption></figure><p>Сохраняем, открываем, уже лучше. Однако строки и методы все равно обфусцированны.</p><figure><img src="/file/06bf3d651f9ce7d522c91.png"><figcaption></figcaption></figure><p>Теперь пришло время заюзать спец тулзы для конфузера. В конце концов имеем чистые сурсы. </p><figure><img src="/file/54fd0bb6fa273391d834a.png"><figcaption></figcaption></figure><p><br></p><h3 id="Анализ-кода">Анализ кода</h3><p>Первое что бросается в глаза - конфиг передается открытым текстом. Неужели так сложно было сделать банальный XOR+base64? Просто несерьезно.</p><figure><img src="/file/d1b2090f27c3b1767647a.png"><figcaption></figcaption></figure><p>Лоадер дропает EXE со статичным именем в TEMP. Привет рантайм.</p><figure><img src="/file/3ca904c1389c0601b079f.png"><figcaption></figcaption></figure><p>Далее меня привлек конфиг. Как я понял, при запуске стиллер проверяет, действительна ли лицензия, и если все ок то продолжает работу. Как по мне это не самый лучший подход. Что если сервер/ip забанят? Как этот запрос в сеть скажется на рантайме, учитывая что все билды будут стучать на этот хост? </p><figure><img src="/file/04cbf23cbbf9532b24716.png"><figcaption></figcaption></figure><p>Кстати, вот <a href="http://92.63.197.188/Auth/index.php" target="_blank"><em>сюда </em></a>стучит софт при запуске.</p><figure><img src="/file/124701d1b214ad6f467c9.png"><figcaption></figcaption></figure><p>Сбор данных с браузера осуществляется с помощью дроченого SqliteHandler.</p><figure><img src="/file/f364d434f0cdd160ae3a5.png"><figcaption></figcaption></figure><p>Я не знаю почему все юзают CryptUnprotectData, когда есть System.Security.Cryptography.ProtectedData</p><figure><img src="/file/180575f3768a2b11454ce.png"><figcaption></figcaption></figure><p>Стиллер outlook в наглую спизжен с моих сурсов. Даже не оптимизировали по нормальному.</p><figure><img src="/file/19f17112bf6b5fcb067c9.png"><figcaption></figcaption></figure><p>Можно было бы добавить больше FTP.</p><figure><img src="/file/4eb8167bea6d765838673.png"><figcaption></figcaption></figure><p>Лог собирается на диске, причем папка дропа статична. Снова рантайм.</p><figure><img src="/file/32d4f80d6e712ba9d6107.png"><figcaption></figcaption></figure><p>И самое большое огорчение - граббер. Софт/панель не предусматривают возможность добавления собственных путей сбора файлов.</p><p>В топике было написано о обходе WindowsDefender, но где этот обход находится я так и не нашел.  <a href="https://cyberscan.org/results.php?id=10uZhNgjOC&amp;__cf_chl_jschl_tk__=e974ba64090ec6d23ca5f12e95c3f5db928db78e-1580828700-0-Ac0ob_ln-Uz-Qp1hNItCdex-BaJOIWeMY8Sv3HTJ5vWn2X-C9c54nm6yxOdVdMOwwysXiQ1Snts2rdKSzVjtM13HKN0x4FWoJgly7s0d-iJsg62432jtEKCFp9IyhE_B8PWfDvicccRaiesYEA7N8EQkrlASABTVM5icRhyaLayfRKRKIjnIMfPzhHUI2aInkyFaMO7c2EcjwMMSP9bAPwg0gKfRWdeVUSAMKeDg2hMsz2QrwjFRRdTOTCOTTMNvfwrVoQFnslIRdORSZG6Ggy4ONVS4kGTTTdZX-ohiDFdxmkhGhBsQa3pvOqiogGtPVClerHZ9y17zEf06g5AWYX-3Aoxr8po0atTVAyb2BZWR" target="_blank"><em>Детект </em></a><em> </em>чистого файла.</p><p>Создается впечптление что софт написан на похуй. Ни многопоточности, ни каких то других фишек - абсолютно дефолтный стиллер с дефолтными методами с гитхаба.</p><p>На этом желание копать дальше пропало - все это я уже видел.</p><p><br></p><h3 id="Панель">Панель</h3><p>В командах (?) Borr и Krown один и тот же web кодер, поэтому их панели похожи. </p><figure><img src="/file/5e428c90b1890ba12592d.png"><figcaption>Borr</figcaption></figure><figure><img src="/file/44ab38b66b4c5f152a2f9.png"><figcaption>Krown</figcaption></figure><figure><img src="/file/0bd0f1af1a5cad6540ae1.png"><figcaption>Настройки граббера</figcaption></figure><figure><img src="/file/1f57da4be5074237afcdb.png"><figcaption>Поиск по логам</figcaption></figure><p>Нужно отдать должное, панель в этом софте выглядит круто. Но настройки конфига скудноваты (имхо).</p><p><br></p><h3 id="Итог">Итог</h3><p><strong>Borr Stealer </strong> - салат из правленных исходников с гитхаба с минимумом новизны и щепоткой конфузера.</p><p>-Путей сбора файлов мало</p><p>-При этом добалять свои пути невозможно</p><p>-Судя по стилю написания кода, создается впечатление, что софт написан не малвар-кодером, а фрилансером за еду</p><p>Как по мне, данный продукт не соответствует цене (30&#036; в неделю без крипта). <br class="inline">Единственное что понравилось - обфускация (было интересно реверсить) и панель.<br class="inline"></p><p><br></p><p><a href="https://github.com/onek1lo/Borr-Stealer" target="_blank">Исходник</a></p><p><a href="https://anonfile.com/53406bVfn2/BINS_rar" target="_blank">Бинарники </a>(onek1lo)</p><p><a href="https://t.me/onek1lo_blog" target="_blank">Блог</a></p></article>
          <div id="_tl_link_tooltip" class="tl_link_tooltip"></div>
          <div id="_tl_tooltip" class="tl_tooltip">
            <div class="buttons">
              <span class="button_hover"></span>
              <span class="button_group"><!--
             --><button id="_bold_button"></button><!--
             --><button id="_italic_button"></button><!--
             --><button id="_link_button"></button><!--
           --></span><!--
           --><span class="button_group"><!--
             --><button id="_header_button"></button><!--
             --><button id="_subheader_button"></button><!--
             --><button id="_quote_button"></button><!--
           --></span>
            </div>
            <div class="prompt">
              <span class="close"></span>
              <div class="prompt_input_wrap"><input type="url" class="prompt_input" /></div>
            </div>
          </div>
          <div id="_tl_blocks" class="tl_blocks">
            <div class="buttons">
              <button id="_image_button"></button><!--
           --><button id="_embed_button"></button>
            </div>
          </div>
          <aside class="tl_article_buttons">
            <div class="account account_top"></div>
            <button id="_edit_button" class="button edit_button">Edit</button><!--
         --><button id="_publish_button" class="button publish_button">Publish</button>
            <div class="account account_bottom"></div>
            <div id="_error_msg" class="error_msg"></div>
          </aside>
        </main>
      </div>
          <div class="tl_page_footer">
      <div id="_report_button" class="tl_footer_button">Report content on this page</div>
    </div>
    </div>
      <div class="tl_popup tl_popup_hidden" id="_report_popup">
    <main class="tl_popup_body tl_report_popup">
      <form id="_report_form" method="post">
        <section>
          <h2 class="tl_popup_header">Report Page</h2>
          <div class="tl_radio_items">
            <label class="tl_radio_item">
              <input type="radio" class="radio" name="reason" value="violence">
              <span class="tl_radio_item_label">Violence</span>
            </label>
            <label class="tl_radio_item">
              <input type="radio" class="radio" name="reason" value="childabuse">
              <span class="tl_radio_item_label">Child Abuse</span>
            </label>
            <label class="tl_radio_item">
              <input type="radio" class="radio" name="reason" value="copyright">
              <span class="tl_radio_item_label">Copyright</span>
            </label>
            <label class="tl_radio_item">
              <input type="radio" class="radio" name="reason" value="illegal_drugs">
              <span class="tl_radio_item_label">Illegal Drugs</span>
            </label>
            <label class="tl_radio_item">
              <input type="radio" class="radio" name="reason" value="personal_details">
              <span class="tl_radio_item_label">Personal Details</span>
            </label>
            <label class="tl_radio_item">
              <input type="radio" class="radio" name="reason" value="other">
              <span class="tl_radio_item_label">Other</span>
            </label>
          </div>
          <div class="tl_textfield_item tl_comment_field">
            <input type="text" class="tl_textfield" name="comment" value="" placeholder="Add Comment…">
          </div>
          <div class="tl_copyright_field">
            Please submit your DMCA takedown request to <a href="mailto:dmca@telegram.org?subject=Report%20to%20Telegraph%20page%20%22Borr%20Malware%22&body=Reported%20page%3A%20https%3A%2F%2Ftelegra.ph%2FBorr-Malware-02-04%0A%0A%0A" target="_blank">dmca@telegram.org</a>
          </div>
        </section>
        <aside class="tl_popup_buttons">
          <button type="reset" class="button" id="_report_cancel">Cancel</button>
          <button type="submit" class="button submit_button">Report</button>
        </aside>
      </form>
    </main>
  </div>
    
    <script>var T={"apiUrl":"https:\/\/edit.telegra.ph","uploadEnabled":false,"datetime":1580828156,"pageId":"962ddbd76f5002998df85","editable":true};(function(){var b=document.querySelector('time');if(b&&T.datetime){var a=new Date(1E3*T.datetime),d='January February March April May June July August September October November December'.split(' ')[a.getMonth()],c=a.getDate();b.innerText=d+' '+(10>c?'0':'')+c+', '+a.getFullYear()}})();</script>
    <script src="/js/jquery.min.js"></script>
    <script src="/js/jquery.selection.min.js"></script>
    <script src="/js/autosize.min.js"></script>
    <script src="/js/load-image.all.min.js?1"></script>
    <script src="/js/quill.min.js?10"></script>
    <script src="/js/core.min.js?67"></script>
    <script async src="https://t.me/_websync_?path=Borr-Malware-02-04&hash=045a2c60689ca9e0db"></script>
  </body>
</html>