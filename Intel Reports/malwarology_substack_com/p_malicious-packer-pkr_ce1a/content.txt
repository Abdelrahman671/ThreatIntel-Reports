<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8" />
        <meta name="norton-safeweb-site-verification" content="24usqpep0ejc5w6hod3dulxwciwp0djs6c6ufp96av3t4whuxovj72wfkdjxu82yacb7430qjm8adbd5ezlt4592dq4zrvadcn9j9n-0btgdzpiojfzno16-fnsnu7xd" />
        
        <link rel="preconnect" href="https://substackcdn.com" />
        

        

        
        <link rel="preload" as="style" href="https://substackcdn.com/bundle/theme/main.ff63ed3264a43608effd.css" />
        
        
        
        <link rel="preload" as="font" href="https://fonts.gstatic.com/s/spectral/v13/rnCr-xNNww_2s0amA9M5knjsS_ul.woff2" crossorigin />
        

        
            
                <link rel="stylesheet" type="text/css" href="https://substackcdn.com/bundle/assets/entry-f04ac16f.css" />
            
                <link rel="stylesheet" type="text/css" href="https://substackcdn.com/bundle/assets/index-d3aa5455.css" />
            
                <link rel="stylesheet" type="text/css" href="https://substackcdn.com/bundle/assets/Button-8e48000e.css" />
            
                <link rel="stylesheet" type="text/css" href="https://substackcdn.com/bundle/assets/free_email_form-c2d8479d.css" />
            
                <link rel="stylesheet" type="text/css" href="https://substackcdn.com/bundle/assets/Tag-cd2d8805.css" />
            
                <link rel="stylesheet" type="text/css" href="https://substackcdn.com/bundle/assets/Badge-e926a7c1.css" />
            
                <link rel="stylesheet" type="text/css" href="https://substackcdn.com/bundle/assets/PubIcon-348b05fa.css" />
            
                <link rel="stylesheet" type="text/css" href="https://substackcdn.com/bundle/assets/Tooltip-d0af0cf2.css" />
            
                <link rel="stylesheet" type="text/css" href="https://substackcdn.com/bundle/assets/Divider-f90fb756.css" />
            
                <link rel="stylesheet" type="text/css" href="https://substackcdn.com/bundle/assets/UserBadge-d10c54cf.css" />
            
                <link rel="stylesheet" type="text/css" href="https://substackcdn.com/bundle/assets/viralGifts-cd637408.css" />
            
                <link rel="stylesheet" type="text/css" href="https://substackcdn.com/bundle/assets/index-6825017b.css" />
            
                <link rel="stylesheet" type="text/css" href="https://substackcdn.com/bundle/assets/index-b4563b63.css" />
            
                <link rel="stylesheet" type="text/css" href="https://substackcdn.com/bundle/assets/Modal-2a9c6d98.css" />
            
                <link rel="stylesheet" type="text/css" href="https://substackcdn.com/bundle/assets/Menu-d642b189.css" />
            
                <link rel="stylesheet" type="text/css" href="https://substackcdn.com/bundle/assets/theme-7c4aee7d.css" />
            
                <link rel="stylesheet" type="text/css" href="https://substackcdn.com/bundle/assets/TextInput-6d3a77c0.css" />
            
                <link rel="stylesheet" type="text/css" href="https://substackcdn.com/bundle/assets/ProfileHoverCard-59932449.css" />
            
                <link rel="stylesheet" type="text/css" href="https://substackcdn.com/bundle/assets/Select-41454476.css" />
            
                <link rel="stylesheet" type="text/css" href="https://substackcdn.com/bundle/assets/IntroPopup-fb6d4938.css" />
            
                <link rel="stylesheet" type="text/css" href="https://substackcdn.com/bundle/assets/post-d26f1986.css" />
            
                <link rel="stylesheet" type="text/css" href="https://substackcdn.com/bundle/assets/ThemedPostHeader-8314a8f5.css" />
            
                <link rel="stylesheet" type="text/css" href="https://substackcdn.com/bundle/assets/index-a0b28901.css" />
            
                <link rel="stylesheet" type="text/css" href="https://substackcdn.com/bundle/assets/FilePicker-011ef325.css" />
            
                <link rel="stylesheet" type="text/css" href="https://substackcdn.com/bundle/assets/ImageViewerModal-3811bdd5.css" />
            
                <link rel="stylesheet" type="text/css" href="https://substackcdn.com/bundle/assets/Recipe-796f9114.css" />
            
                <link rel="stylesheet" type="text/css" href="https://substackcdn.com/bundle/assets/object-3dec9b2c.css" />
            
                <link rel="stylesheet" type="text/css" href="https://substackcdn.com/bundle/assets/partition-0242053f.css" />
            
                <link rel="stylesheet" type="text/css" href="https://substackcdn.com/bundle/assets/ShowsVideoPlayer-6c0c0eb2.css" />
            
                <link rel="stylesheet" type="text/css" href="https://substackcdn.com/bundle/assets/SectionLogo-44ead5a1.css" />
            
                <link rel="stylesheet" type="text/css" href="https://substackcdn.com/bundle/assets/BulwarkCallout-42b8163a.css" />
            
                <link rel="stylesheet" type="text/css" href="https://substackcdn.com/bundle/assets/overflow_menu-db9a534e.css" />
            
                <link rel="stylesheet" type="text/css" href="https://substackcdn.com/bundle/assets/NavbarUserWidget-fac5f6fb.css" />
            
                <link rel="stylesheet" type="text/css" href="https://substackcdn.com/bundle/assets/Tracking-4e616c35.css" />
            
                <link rel="stylesheet" type="text/css" href="https://substackcdn.com/bundle/assets/Switch-6bb7e637.css" />
            
                <link rel="stylesheet" type="text/css" href="https://substackcdn.com/bundle/assets/SegmentedButton-f360c1e5.css" />
            
                <link rel="stylesheet" type="text/css" href="https://substackcdn.com/bundle/assets/TabBar-c0819249.css" />
            
                <link rel="stylesheet" type="text/css" href="https://substackcdn.com/bundle/assets/RadioField-5c1c622e.css" />
            
                <link rel="stylesheet" type="text/css" href="https://substackcdn.com/bundle/assets/UnreadBadge-2cbd5ba6.css" />
            
                <link rel="stylesheet" type="text/css" href="https://substackcdn.com/bundle/assets/Field-6e53593d.css" />
            
                <link rel="stylesheet" type="text/css" href="https://substackcdn.com/bundle/assets/Radio-c45ba470.css" />
            
                <link rel="stylesheet" type="text/css" href="https://substackcdn.com/bundle/assets/FPHeader-a915d9ec.css" />
            
                <link rel="stylesheet" type="text/css" href="https://substackcdn.com/bundle/assets/recentSurfaces-fa9efc75.css" />
            
                <link rel="stylesheet" type="text/css" href="https://substackcdn.com/bundle/assets/CookieConsentFooter-0d9aca19.css" />
            
                <link rel="stylesheet" type="text/css" href="https://substackcdn.com/bundle/assets/newsletter_item_list-d09fc28e.css" />
            
                <link rel="stylesheet" type="text/css" href="https://substackcdn.com/bundle/assets/CreditCardIcon-c6de514f.css" />
            
                <link rel="stylesheet" type="text/css" href="https://substackcdn.com/bundle/assets/comments_page-0d58d687.css" />
            
                <link rel="stylesheet" type="text/css" href="https://substackcdn.com/bundle/assets/ProfileSetupToast-b1d1db47.css" />
            
                <link rel="stylesheet" type="text/css" href="https://substackcdn.com/bundle/assets/ChatAppUpsell-5a642ab8.css" />
            
                <link rel="stylesheet" type="text/css" href="https://substackcdn.com/bundle/assets/RewardBox-5297e7a9.css" />
            
                <link rel="stylesheet" type="text/css" href="https://substackcdn.com/bundle/assets/Logo-8a4d9999.css" />
            
                <link rel="stylesheet" type="text/css" href="https://substackcdn.com/bundle/assets/onboarding-934c9a78.css" />
            
                <link rel="stylesheet" type="text/css" href="https://substackcdn.com/bundle/assets/setup_all_podcasts-65de25ac.css" />
            
        

        
        
        
        
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0, viewport-fit=cover" />
        <meta name="author" content="Malwarology LLC" />
        <meta property="og:url" content="https://malwarology.substack.com/p/malicious-packer-pkr_ce1a" />
        <title data-preact-helmet>Malicious Packer pkr_ce1a - by Malwarology LLC</title>
        <meta data-preact-helmet name="theme-color" content="#ffffff"><meta data-preact-helmet property="og:type" content="article"><meta data-preact-helmet property="og:title" content="Malicious Packer pkr_ce1a"><meta data-preact-helmet name="twitter:title" content="Malicious Packer pkr_ce1a"><meta data-preact-helmet name="description" content="First Stage"><meta data-preact-helmet property="og:description" content="First Stage"><meta data-preact-helmet name="twitter:description" content="First Stage"><meta data-preact-helmet property="og:image" content="https://substackcdn.com/image/fetch/w_1200,h_600,c_fill,f_jpg,q_auto:good,fl_progressive:steep,g_auto/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc0688009-9c87-4d72-95de-6e40b6e0b8bf_987x400.png"><meta data-preact-helmet name="twitter:image" content="https://substackcdn.com/image/fetch/f_auto,q_auto:best,fl_progressive:steep/https%3A%2F%2Fmalwarology.substack.com%2Fapi%2Fv1%2Fpost_preview%2F85422807%2Ftwitter.jpg%3Fversion%3D4"><meta data-preact-helmet name="twitter:card" content="summary_large_image">
        <link rel="canonical" href="https://malwarology.substack.com/p/malicious-packer-pkr_ce1a" />

        

        

        
            
                <link rel="shortcut icon" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F790e1260-e621-4c0a-ae6e-51d60641ea37%2Ffavicon.ico">
            
        
            
                <link rel="icon" type="image/png" sizes="16x16" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F790e1260-e621-4c0a-ae6e-51d60641ea37%2Ffavicon-16x16.png">
            
        
            
                <link rel="icon" type="image/png" sizes="32x32" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F790e1260-e621-4c0a-ae6e-51d60641ea37%2Ffavicon-32x32.png">
            
        
            
                <link rel="icon" type="image/png" sizes="48x48" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F790e1260-e621-4c0a-ae6e-51d60641ea37%2Ffavicon-48x48.png">
            
        
            
                <link rel="apple-touch-icon" sizes="57x57" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F790e1260-e621-4c0a-ae6e-51d60641ea37%2Fapple-touch-icon-57x57.png">
            
        
            
                <link rel="apple-touch-icon" sizes="60x60" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F790e1260-e621-4c0a-ae6e-51d60641ea37%2Fapple-touch-icon-60x60.png">
            
        
            
                <link rel="apple-touch-icon" sizes="72x72" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F790e1260-e621-4c0a-ae6e-51d60641ea37%2Fapple-touch-icon-72x72.png">
            
        
            
                <link rel="apple-touch-icon" sizes="76x76" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F790e1260-e621-4c0a-ae6e-51d60641ea37%2Fapple-touch-icon-76x76.png">
            
        
            
                <link rel="apple-touch-icon" sizes="114x114" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F790e1260-e621-4c0a-ae6e-51d60641ea37%2Fapple-touch-icon-114x114.png">
            
        
            
                <link rel="apple-touch-icon" sizes="120x120" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F790e1260-e621-4c0a-ae6e-51d60641ea37%2Fapple-touch-icon-120x120.png">
            
        
            
                <link rel="apple-touch-icon" sizes="144x144" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F790e1260-e621-4c0a-ae6e-51d60641ea37%2Fapple-touch-icon-144x144.png">
            
        
            
                <link rel="apple-touch-icon" sizes="152x152" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F790e1260-e621-4c0a-ae6e-51d60641ea37%2Fapple-touch-icon-152x152.png">
            
        
            
                <link rel="apple-touch-icon" sizes="167x167" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F790e1260-e621-4c0a-ae6e-51d60641ea37%2Fapple-touch-icon-167x167.png">
            
        
            
                <link rel="apple-touch-icon" sizes="180x180" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F790e1260-e621-4c0a-ae6e-51d60641ea37%2Fapple-touch-icon-180x180.png">
            
        
            
                <link rel="apple-touch-icon" sizes="1024x1024" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F790e1260-e621-4c0a-ae6e-51d60641ea37%2Fapple-touch-icon-1024x1024.png">
            
        
            
        
            
        
            
        

        

        
            <link rel="alternate" type="application/rss+xml" href="/feed" title="Malwarology Research"/>
        

        
        
          <style>
            @font-face{font-family:'Spectral';font-style:italic;font-weight:400;font-display:fallback;src:url(https://fonts.gstatic.com/s/spectral/v13/rnCt-xNNww_2s0amA9M8on7mTNmnUHowCw.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Spectral';font-style:italic;font-weight:400;font-display:fallback;src:url(https://fonts.gstatic.com/s/spectral/v13/rnCt-xNNww_2s0amA9M8onXmTNmnUHowCw.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Spectral';font-style:italic;font-weight:400;font-display:fallback;src:url(https://fonts.gstatic.com/s/spectral/v13/rnCt-xNNww_2s0amA9M8onTmTNmnUHowCw.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Spectral';font-style:italic;font-weight:400;font-display:fallback;src:url(https://fonts.gstatic.com/s/spectral/v13/rnCt-xNNww_2s0amA9M8onrmTNmnUHo.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Spectral';font-style:normal;font-weight:400;font-display:fallback;src:url(https://fonts.gstatic.com/s/spectral/v13/rnCr-xNNww_2s0amA9M9knjsS_ulYHs.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Spectral';font-style:normal;font-weight:400;font-display:fallback;src:url(https://fonts.gstatic.com/s/spectral/v13/rnCr-xNNww_2s0amA9M2knjsS_ulYHs.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Spectral';font-style:normal;font-weight:400;font-display:fallback;src:url(https://fonts.gstatic.com/s/spectral/v13/rnCr-xNNww_2s0amA9M3knjsS_ulYHs.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Spectral';font-style:normal;font-weight:400;font-display:fallback;src:url(https://fonts.gstatic.com/s/spectral/v13/rnCr-xNNww_2s0amA9M5knjsS_ul.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}@font-face{font-family:'Spectral';font-style:normal;font-weight:600;font-display:fallback;src:url(https://fonts.gstatic.com/s/spectral/v13/rnCs-xNNww_2s0amA9vmtm3FafaPWnIIMrY.woff2) format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116}@font-face{font-family:'Spectral';font-style:normal;font-weight:600;font-display:fallback;src:url(https://fonts.gstatic.com/s/spectral/v13/rnCs-xNNww_2s0amA9vmtm3OafaPWnIIMrY.woff2) format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB}@font-face{font-family:'Spectral';font-style:normal;font-weight:600;font-display:fallback;src:url(https://fonts.gstatic.com/s/spectral/v13/rnCs-xNNww_2s0amA9vmtm3PafaPWnIIMrY.woff2) format('woff2');unicode-range:U+0100-02AF,U+0304,U+0308,U+0329,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20CF,U+2113,U+2C60-2C7F,U+A720-A7FF}@font-face{font-family:'Spectral';font-style:normal;font-weight:600;font-display:fallback;src:url(https://fonts.gstatic.com/s/spectral/v13/rnCs-xNNww_2s0amA9vmtm3BafaPWnII.woff2) format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+2074,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD}
            
          </style>
        
        

        <style>:root{--color_theme_bg_pop:#2C44A0;--background_pop:#2C44A0;--cover_bg_color:#FFFFFF;--background_pop_darken:#273b8c;--print_on_pop:#ffffff;--color_theme_bg_pop_darken:#273b8c;--color_theme_print_on_pop:#ffffff;--border_subtle:rgba(204, 204, 204, 0.5);--background_subtle:rgba(223, 227, 241, 0.4);--print_pop:#2c44a0;--color_theme_accent:#2c44a0;--cover_print_primary:#363737;--cover_print_secondary:#757575;--cover_print_tertiary:#b6b6b6;--cover_border_color:#2c44a0;--home_hero:newspaper;--home_posts:list;--web_bg_color:#ffffff;--background_contrast_1:#f0f0f0;--color_theme_bg_contrast_1:#f0f0f0;--background_contrast_2:#dddddd;--color_theme_bg_contrast_2:#dddddd;--background_contrast_3:#b7b7b7;--color_theme_bg_contrast_3:#b7b7b7;--background_contrast_4:#929292;--color_theme_bg_contrast_4:#929292;--background_contrast_5:#515151;--color_theme_bg_contrast_5:#515151;--color_theme_detail:#e6e6e6;--background_contrast_pop:rgba(44, 68, 160, 0.4);--color_theme_bg_contrast_pop:rgba(44, 68, 160, 0.4);--input_background:#ffffff;--cover_input_background:#ffffff;--tooltip_background:#191919;--web_bg_color_h:0;--web_bg_color_s:0%;--web_bg_color_l:100%;--print_on_web_bg_color:#363737;--print_secondary_on_web_bg_color:#868787;--selected_comment_background_color:#fdf9f3;--background_pop_rgb:44, 68, 160;--background_pop_rgb_pc:44 68 160;--color_theme_bg_pop_rgb:44, 68, 160;--color_theme_bg_pop_rgb_pc:44 68 160;--color_theme_accent_rgb:44, 68, 160;--color_theme_accent_rgb_pc:44 68 160;}</style>

        
            <link rel="stylesheet" href="https://substackcdn.com/bundle/theme/main.ff63ed3264a43608effd.css" />
        

        <style></style>

        

        

        
    </head>

    <body class="">
        

        

        <div id="entry">
            <div id="main" class="main typography use-theme-bg"><div data-testid="navbar" class="main-menu animated with-wordmark"><div class="main-menu-content"><div class="topbar"><div class="topbar-content"><div class="navbar-logo-container"><a href="/" native><img src="https://substackcdn.com/image/fetch/w_96,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Faaa855c0-e07d-47f9-9daa-5cbabdbf5eb3_256x256.png" class="navbar-logo"/></a></div><h1 class="navbar-title left-align loading"><a href="/" native class="navbar-title-link"><img src="https://substackcdn.com/image/fetch/e_trim:10:white/e_trim:10:transparent/h_72,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F65785ab2-dc7b-4d24-8d4a-48c89be5c374_1638x440.png" alt="Malwarology Research" class="navbar-logo-wordmark"/></a></h1><div class="navbar-buttons"><div class="pencraft pc-display-contents pc-reset _pubTheme_c2zmd_1"><div class="pencraft pc-display-flex pc-gap-4 pc-reset"><span><button tabindex="0" type="button" class="pencraft pc-reset pencraft _iconButton2_bxx6e_689 _iconButtonBase_bxx6e_183 _buttonBase_bxx6e_1 _buttonNew_bxx6e_97 _size_md_bxx6e_166 _priority_tertiary_bxx6e_83"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-search"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.3-4.3"></path></svg></button></span><button tabindex="0" type="button" aria-label="Share Publication" id="trigger69993" aria-expanded="false" aria-haspopup="dialog" aria-controls="dialog69994" ariaLabel="View more" class="pencraft pc-reset pencraft _iconButton2_bxx6e_689 _iconButtonBase_bxx6e_183 _buttonBase_bxx6e_1 _buttonNew_bxx6e_97 _size_md_bxx6e_166 _priority_tertiary_bxx6e_83"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-share"><path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"></path><polyline points="16 6 12 2 8 6"></polyline><line x1="12" x2="12" y1="2" y2="15"></line></svg></button></div><button tabindex="0" type="button" data-testid="noncontributor-cta-button" class="pencraft pc-reset pencraft _buttonBase_bxx6e_1 _button_bxx6e_1 _buttonNew_bxx6e_97 _button2_bxx6e_148 _priority_primary_bxx6e_71 _size_md_bxx6e_166">Subscribe</button><button tabindex="0" type="button" native data-href="https://substack.com/sign-in?redirect=%2Fp%2Fmalicious-packer-pkr_ce1a&amp;for_pub=malwarology" class="pencraft pc-reset pencraft _buttonBase_bxx6e_1 _button_bxx6e_1 _buttonNew_bxx6e_97 _button2_bxx6e_148 _priority_tertiary_bxx6e_83 _size_md_bxx6e_166">Sign in</button></div></div></div></div></div><div class="topbar-spacer"></div></div><div><script type="application/ld+json">{"@context":"https://schema.org","@type":"NewsArticle","url":"https://malwarology.substack.com/p/malicious-packer-pkr_ce1a","mainEntityOfPage":"https://malwarology.substack.com/p/malicious-packer-pkr_ce1a","headline":"Malicious Packer pkr_ce1a","description":"First Stage","image":[{"@type":"ImageObject","url":"https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc0688009-9c87-4d72-95de-6e40b6e0b8bf_987x400.png"}],"datePublished":"2022-11-19T02:28:00+00:00","dateModified":"2022-11-19T02:28:00+00:00","isAccessibleForFree":true,"author":[{"@type":"Person","name":"Malwarology LLC","url":"https://substack.com/@malwarology","description":null,"identifier":"user:97072969","sameAs":["https://twitter.com/malwarology"],"image":{"@type":"ImageObject","contentUrl":"https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F2c74d94f-2add-4298-97f6-c9e6bc6bd1c5_2484x2204.png","thumbnailUrl":"https://substackcdn.com/image/fetch/w_128,h_128,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F2c74d94f-2add-4298-97f6-c9e6bc6bd1c5_2484x2204.png"}}],"publisher":{"@type":"Organization","name":"Malwarology Research","url":"https://malwarology.substack.com","description":"A newsletter about malware reverse engineering, malware analysis, and threat intelligence. This includes formal deep dive reports on malware families, analysis tools and techniques tutorials, and as-it-happens research project progress updates.","interactionStatistic":{"@type":"InteractionCounter","name":"Subscribers","interactionType":"https://schema.org/SubscribeAction","userInteractionCount":10},"identifier":"pub:947576","logo":{"@type":"ImageObject","url":"https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Faaa855c0-e07d-47f9-9daa-5cbabdbf5eb3_256x256.png","contentUrl":"https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Faaa855c0-e07d-47f9-9daa-5cbabdbf5eb3_256x256.png","thumbnailUrl":"https://substackcdn.com/image/fetch/w_128,h_128,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Faaa855c0-e07d-47f9-9daa-5cbabdbf5eb3_256x256.png"},"image":{"@type":"ImageObject","url":"https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Faaa855c0-e07d-47f9-9daa-5cbabdbf5eb3_256x256.png","contentUrl":"https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Faaa855c0-e07d-47f9-9daa-5cbabdbf5eb3_256x256.png","thumbnailUrl":"https://substackcdn.com/image/fetch/w_128,h_128,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Faaa855c0-e07d-47f9-9daa-5cbabdbf5eb3_256x256.png"}}}</script><div class="single-post-container"><div class="container"><div class="single-post"><div class="pencraft pc-display-contents pc-reset _pubTheme_c2zmd_1"><article class="typography newsletter-post post"><div inert role="dialog" class="modal typography out gone share-dialog popup"><div class="modal-table"><div class="modal-row"><div class="modal-cell modal-content no-fullscreen"><div class="container"><button tabindex="0" type="button" data-testid="close-modal" class="pencraft pc-reset pencraft modal-btn modal-exit-btn no-margin _iconButton2_bxx6e_689 _iconButtonBase_bxx6e_183 _buttonBase_bxx6e_1 _buttonNew_bxx6e_97 _size_md_bxx6e_166 _priority_tertiary_bxx6e_83"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="secondary" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x"><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg></button><div class="pencraft pc-display-contents pc-reset _pubTheme_c2zmd_1"><div class="pencraft pc-display-contents pc-reset _elevatedTheme_jpget_1"><div class="pencraft pc-display-flex pc-flexDirection-column pc-gap-24 pc-padding-24 pc-reset _bg-primary_1tdk8_209 _border-detail_1tdk8_25 pc-borderRadius-md _container_1xu3k_8"><h4 class="pencraft _flexGrow_1tdk8_338 pc-reset _align-center_h3mln_13 _line-height-24_h3mln_83 _font-display_h3mln_103 _size-20_h3mln_59 _weight-bold_h3mln_151 _reset_h3mln_1">Share this post</h4><a href="https://substack.com/home/post/p-85422807?utm_campaign=post&amp;utm_medium=web" class="pencraft pc-display-flex pc-flexDirection-column pc-gap-8 pc-reset _animate_1tdk8_232 _cursor-pointer_1tdk8_252"><div style="background:linear-gradient(180deg, rgba(81,70,54,0.75), rgba(81,70,54,0.75)), var(--color-dark-bg-secondary);" tabindex="0" draggable="false" class="pencraft pc-display-flex pc-flexDirection-column pc-minWidth-0 pc-position-relative pc-reset _bg-secondary_1tdk8_212 _animate_1tdk8_232 pc-borderRadius-md _showFocus_1tdk8_72 _postAttachment_1jaic_563"><div class="pencraft pc-display-flex pc-flexDirection-column pc-reset _border-bottom-detail_1tdk8_31 _vibrantHeader_1jaic_607"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,h_222,c_fill,f_webp,q_auto:good,fl_progressive:steep,g_auto/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc0688009-9c87-4d72-95de-6e40b6e0b8bf_987x400.png 424w, https://substackcdn.com/image/fetch/w_520,h_272,c_fill,f_webp,q_auto:good,fl_progressive:steep,g_auto/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc0688009-9c87-4d72-95de-6e40b6e0b8bf_987x400.png 520w, https://substackcdn.com/image/fetch/w_848,h_444,c_fill,f_webp,q_auto:good,fl_progressive:steep,g_auto/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc0688009-9c87-4d72-95de-6e40b6e0b8bf_987x400.png 848w, https://substackcdn.com/image/fetch/w_1040,h_545,c_fill,f_webp,q_auto:good,fl_progressive:steep,g_auto/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc0688009-9c87-4d72-95de-6e40b6e0b8bf_987x400.png 1040w, https://substackcdn.com/image/fetch/w_1272,h_666,c_fill,f_webp,q_auto:good,fl_progressive:steep,g_auto/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc0688009-9c87-4d72-95de-6e40b6e0b8bf_987x400.png 1272w, https://substackcdn.com/image/fetch/w_1456,h_762,c_fill,f_webp,q_auto:good,fl_progressive:steep,g_auto/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc0688009-9c87-4d72-95de-6e40b6e0b8bf_987x400.png 1456w, https://substackcdn.com/image/fetch/w_1560,h_817,c_fill,f_webp,q_auto:good,fl_progressive:steep,g_auto/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc0688009-9c87-4d72-95de-6e40b6e0b8bf_987x400.png 1560w" sizes="520px"/><img src="https://substackcdn.com/image/fetch/w_520,h_272,c_fill,f_auto,q_auto:good,fl_progressive:steep,g_auto/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc0688009-9c87-4d72-95de-6e40b6e0b8bf_987x400.png" sizes="520px" alt srcset="https://substackcdn.com/image/fetch/w_424,h_222,c_fill,f_auto,q_auto:good,fl_progressive:steep,g_auto/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc0688009-9c87-4d72-95de-6e40b6e0b8bf_987x400.png 424w, https://substackcdn.com/image/fetch/w_520,h_272,c_fill,f_auto,q_auto:good,fl_progressive:steep,g_auto/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc0688009-9c87-4d72-95de-6e40b6e0b8bf_987x400.png 520w, https://substackcdn.com/image/fetch/w_848,h_444,c_fill,f_auto,q_auto:good,fl_progressive:steep,g_auto/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc0688009-9c87-4d72-95de-6e40b6e0b8bf_987x400.png 848w, https://substackcdn.com/image/fetch/w_1040,h_545,c_fill,f_auto,q_auto:good,fl_progressive:steep,g_auto/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc0688009-9c87-4d72-95de-6e40b6e0b8bf_987x400.png 1040w, https://substackcdn.com/image/fetch/w_1272,h_666,c_fill,f_auto,q_auto:good,fl_progressive:steep,g_auto/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc0688009-9c87-4d72-95de-6e40b6e0b8bf_987x400.png 1272w, https://substackcdn.com/image/fetch/w_1456,h_762,c_fill,f_auto,q_auto:good,fl_progressive:steep,g_auto/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc0688009-9c87-4d72-95de-6e40b6e0b8bf_987x400.png 1456w, https://substackcdn.com/image/fetch/w_1560,h_817,c_fill,f_auto,q_auto:good,fl_progressive:steep,g_auto/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc0688009-9c87-4d72-95de-6e40b6e0b8bf_987x400.png 1560w" width="520" draggable="false" class="_img_16u6n_1 _postImage_1jaic_611 _vibrantPostImage_1jaic_617 pencraft pc-reset"/></picture></div><div class="pencraft pc-display-flex pc-gap-12 pc-padding-12 pc-alignItems-center pc-reset"><div class="pencraft pc-display-flex pc-flexDirection-column pc-gap-2 pc-minWidth-0 _flexGrow_1tdk8_338 pc-reset"><div class="pencraft pc-display-flex pc-gap-8 pc-paddingBottom-4 pc-alignItems-center pc-reset"><div draggable="false" class="pencraft pc-display-flex pc-position-relative pc-reset"><div style="width:18px;height:18px;" class="pencraft pc-display-flex pc-reset _bg-white_1tdk8_331 pc-borderRadius-xs _overflow-hidden_1tdk8_351 _sizing-border-box_1tdk8_385"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_36,h_36,c_fill,f_webp,q_auto:good,fl_progressive:steep,g_auto/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Faaa855c0-e07d-47f9-9daa-5cbabdbf5eb3_256x256.png"/><img src="https://substackcdn.com/image/fetch/w_36,h_36,c_fill,f_auto,q_auto:good,fl_progressive:steep,g_auto/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Faaa855c0-e07d-47f9-9daa-5cbabdbf5eb3_256x256.png" sizes="100vw" alt="Malwarology Research" width="36" height="36" style="width:18px;height:18px;" draggable="false" class="_img_16u6n_1 _object-fit-cover_16u6n_5 pencraft pc-reset"/></picture></div></div><div class="pencraft _flexGrow_1tdk8_338 pc-reset _ellipsis_1tdk8_379 _color-vibrance-secondary_h3mln_229 _line-height-20_h3mln_80 _font-text_h3mln_106 _size-13_h3mln_39 _weight-regular_h3mln_142 _nowrap_h3mln_249 _reset_h3mln_1">Malwarology Research</div></div><div class="pencraft pc-reset _color-vibrance-primary_h3mln_226 _line-height-20_h3mln_80 _font-text_h3mln_106 _size-15_h3mln_47 _weight-medium_h3mln_145 _clamp_h3mln_254 _clamp-2_h3mln_263 _reset_h3mln_1">Malicious Packer pkr_ce1a</div></div></div></div></a><div class="pencraft pc-display-flex pc-flexDirection-column pc-gap-16 pc-reset"><div class="pencraft pc-display-flex pc-justifyContent-space-between pc-reset"><a class="pencraft pc-display-flex pc-flexDirection-column pc-gap-8 pc-width-64 pc-alignItems-center pc-reset _cursor-pointer_1tdk8_252 _button_qtdwu_1"><div class="pencraft pc-display-flex pc-flexDirection-column pc-width-64 pc-height-64 pc-justifyContent-center pc-alignItems-center pc-reset _bg-secondary_1tdk8_212 _animate_1tdk8_232 pc-borderRadius-lg _icon_qtdwu_4"><svg role="img" style="height:20px;width:20px;" width="20" height="20" viewBox="0 0 20 20" fill="none" stroke-width="2" stroke="var(--color-fg-primary)" xmlns="http://www.w3.org/2000/svg"><g><title></title><path d="M7.50008 14.1666H5.83341C4.72835 14.1666 3.66854 13.7276 2.88714 12.9462C2.10573 12.1648 1.66675 11.105 1.66675 9.99992C1.66675 8.89485 2.10573 7.83504 2.88714 7.05364C3.66854 6.27224 4.72835 5.83325 5.83341 5.83325H7.50008M12.5001 5.83325H14.1667C15.2718 5.83325 16.3316 6.27224 17.113 7.05364C17.8944 7.83504 18.3334 8.89485 18.3334 9.99992C18.3334 11.105 17.8944 12.1648 17.113 12.9462C16.3316 13.7276 15.2718 14.1666 14.1667 14.1666H12.5001M6.66675 9.99992H13.3334"></path></g></svg></div><div class="pencraft pc-reset _color-primary_h3mln_166 _line-height-20_h3mln_80 _font-text_h3mln_106 _size-11_h3mln_31 _weight-semibold_h3mln_148 _reset_h3mln_1">Copy link</div></a><a class="pencraft pc-display-flex pc-flexDirection-column pc-gap-8 pc-width-64 pc-alignItems-center pc-reset _cursor-pointer_1tdk8_252 _button_qtdwu_1"><div class="pencraft pc-display-flex pc-flexDirection-column pc-width-64 pc-height-64 pc-justifyContent-center pc-alignItems-center pc-reset _bg-secondary_1tdk8_212 _animate_1tdk8_232 pc-borderRadius-lg _icon_qtdwu_4"><svg role="img" style="height:20px;width:20px;" width="20" height="20" viewBox="0 0 20 20" fill="var(--color-fg-primary)" stroke-width="1.8" stroke="none" xmlns="http://www.w3.org/2000/svg"><g><title></title><path stroke="none" d="M20 10C20 4.47715 15.5229 0 10 0C4.47715 0 0 4.47715 0 10C0 14.9912 3.65684 19.1283 8.4375 19.8785V12.8906H5.89844V10H8.4375V7.79688C8.4375 5.29063 9.93047 3.90625 12.2146 3.90625C13.3084 3.90625 14.4531 4.10156 14.4531 4.10156V6.5625H13.1922C11.95 6.5625 11.5625 7.3334 11.5625 8.125V10H14.3359L13.8926 12.8906H11.5625V19.8785C16.3432 19.1283 20 14.9912 20 10Z"></path></g></svg></div><div class="pencraft pc-reset _color-primary_h3mln_166 _line-height-20_h3mln_80 _font-text_h3mln_106 _size-11_h3mln_31 _weight-semibold_h3mln_148 _reset_h3mln_1">Facebook</div></a><a class="pencraft pc-display-flex pc-flexDirection-column pc-gap-8 pc-width-64 pc-alignItems-center pc-reset _cursor-pointer_1tdk8_252 _button_qtdwu_1"><div class="pencraft pc-display-flex pc-flexDirection-column pc-width-64 pc-height-64 pc-justifyContent-center pc-alignItems-center pc-reset _bg-secondary_1tdk8_212 _animate_1tdk8_232 pc-borderRadius-lg _icon_qtdwu_4"><svg role="img" style="height:20px;width:20px;" width="20" height="20" viewBox="0 0 20 20" fill="var(--color-fg-primary)" stroke-width="1.8" stroke="var(--color-fg-primary)" xmlns="http://www.w3.org/2000/svg"><g><title></title><path stroke="none" d="M9.9958 11.0646C10.2693 11.0646 10.5346 10.9569 10.7915 10.7248L19.0717 3.431C18.6241 3.13262 18.1102 3 17.3974 3H2.60257C1.88976 3 1.37587 3.13262 0.920011 3.431L9.20011 10.7248C9.46534 10.9569 9.73057 11.0646 9.9958 11.0646ZM0.215499 15.9465L6.34893 9.82137L0.198922 4.40075C0.107749 4.5748 0 4.99751 0 5.56941V14.7199C0 15.2503 0.0828842 15.6316 0.215499 15.9465ZM2.35391 17.2892H17.646C18.2511 17.2892 18.7235 17.14 19.0385 16.9245L12.731 10.6171L11.5209 11.6945C11.0402 12.1173 10.518 12.3328 9.9958 12.3328C9.48197 12.3328 8.95975 12.1173 8.47905 11.6945L7.26894 10.6171L0.961455 16.9245C1.27642 17.14 1.74057 17.2892 2.35391 17.2892ZM19.7844 15.9465C19.9088 15.6316 20 15.2503 20 14.7199V5.56941C20 4.99751 19.8922 4.5748 19.8011 4.40075L13.651 9.82137L19.7844 15.9465Z"></path></g></svg></div><div class="pencraft pc-reset _color-primary_h3mln_166 _line-height-20_h3mln_80 _font-text_h3mln_106 _size-11_h3mln_31 _weight-semibold_h3mln_148 _reset_h3mln_1">Email</div></a><a class="pencraft pc-display-flex pc-flexDirection-column pc-gap-8 pc-width-64 pc-alignItems-center pc-reset _cursor-pointer_1tdk8_252 _button_qtdwu_1"><div class="pencraft pc-display-flex pc-flexDirection-column pc-width-64 pc-height-64 pc-justifyContent-center pc-alignItems-center pc-reset _bg-secondary_1tdk8_212 _animate_1tdk8_232 pc-borderRadius-lg _icon_qtdwu_4"><svg role="img" style="height:20px;width:20px;" width="20" height="20" viewBox="0 0 20 20" fill="var(--color-fg-primary)" stroke-width="1.8" stroke="none" xmlns="http://www.w3.org/2000/svg"><g><title></title><path d="M1.96484 0.624512H18.0354V2.70052H1.96484V0.624512Z" stroke="none"></path><path d="M1.96484 4.77655H18.0354V6.85254H1.96484V4.77655Z" stroke="none"></path><path d="M1.96484 8.92857V19.9505L10.0001 14.6347L18.0354 19.9505V8.92857H1.96484Z" stroke="none"></path></g></svg></div><div class="pencraft pc-reset _color-primary_h3mln_166 _line-height-20_h3mln_80 _font-text_h3mln_106 _size-11_h3mln_31 _weight-semibold_h3mln_148 _reset_h3mln_1">Notes</div></a><a id="trigger69995" aria-expanded="false" aria-haspopup="dialog" aria-controls="dialog69996" ariaLabel="View more" class="pencraft pc-display-flex pc-flexDirection-column pc-gap-8 pc-width-64 pc-alignItems-center pc-reset _cursor-pointer_1tdk8_252 _button_qtdwu_1"><div class="pencraft pc-display-flex pc-flexDirection-column pc-width-64 pc-height-64 pc-justifyContent-center pc-alignItems-center pc-reset _bg-secondary_1tdk8_212 _animate_1tdk8_232 pc-borderRadius-lg _icon_qtdwu_4"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--color-fg-primary)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-ellipsis"><circle cx="12" cy="12" r="1"></circle><circle cx="19" cy="12" r="1"></circle><circle cx="5" cy="12" r="1"></circle></svg></div><div class="pencraft pc-reset _color-primary_h3mln_166 _line-height-20_h3mln_80 _font-text_h3mln_106 _size-11_h3mln_31 _weight-semibold_h3mln_148 _reset_h3mln_1">More</div></a></div></div></div></div></div></div></div></div></div></div><div class="post-header"><h1 class="post-title unpublished">Malicious Packer pkr_ce1a</h1><h3 class="subtitle">First Stage</h3><div class="pencraft pc-display-flex pc-flexDirection-column pc-paddingBottom-16 pc-reset"><div class="pencraft pc-display-flex pc-flexDirection-column pc-paddingTop-16 pc-paddingBottom-16 pc-reset"><div class="pencraft pc-display-flex pc-gap-12 pc-alignItems-center pc-reset byline-wrapper"><div class="pencraft pc-display-flex pc-flexDirection-column pc-reset"><div class="pencraft pc-display-flex pc-gap-4 pc-reset"><div class="pencraft pc-reset _color-pub-secondary-text_h3mln_193 _line-height-20_h3mln_80 _font-meta_h3mln_115 _size-11_h3mln_31 _weight-medium_h3mln_145 _transform-uppercase_h3mln_237 _reset_h3mln_1 _meta_h3mln_437">Nov 19, 2022</div></div></div></div></div><div class="pencraft pc-display-flex pc-gap-16 pc-paddingTop-16 pc-paddingBottom-16 pc-justifyContent-space-between pc-alignItems-center _flexGrow_1tdk8_338 pc-reset _border-top-detail-themed_1tdk8_47 _border-bottom-detail-themed_1tdk8_50 post-ufi"><div class="pencraft pc-display-flex pc-gap-8 pc-reset"><a role="button" class="post-ufi-button style-button state-disabled no-label with-border"><svg role="img" style="height:20px;width:20px;" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke="#000" xmlns="http://www.w3.org/2000/svg" class="icon"><g><title></title><path d="M21 3V8M21 8H16M21 8L18 5.29962C16.7056 4.14183 15.1038 3.38328 13.3879 3.11547C11.6719 2.84766 9.9152 3.08203 8.32951 3.79031C6.74382 4.49858 5.39691 5.65051 4.45125 7.10715C3.5056 8.5638 3.00158 10.2629 3 11.9996M3 21V16M3 16H8M3 16L6 18.7C7.29445 19.8578 8.89623 20.6163 10.6121 20.8841C12.3281 21.152 14.0848 20.9176 15.6705 20.2093C17.2562 19.501 18.6031 18.3491 19.5487 16.8925C20.4944 15.4358 20.9984 13.7367 21 12" stroke-linecap="round" stroke-linejoin="round"></path></g></svg></a></div><div class="pencraft pc-display-flex pc-gap-8 pc-reset"><a role="button" href="javascript:void(0)" aria-label="View share options" class="post-ufi-button style-button no-icon has-label with-border"><div class="label">Share</div></a></div></div></div></div><div class="visibility-check"></div><div><div class="available-content"><div dir="auto" class="body markup"><h1 class="header-anchor-post">Summary<div class="pencraft pc-display-flex pc-alignItems-center pc-position-absolute pc-reset header-anchor-parent"><div class="pencraft pc-display-contents pc-reset _pubTheme_c2zmd_1"><div id="§summary" class="pencraft pc-reset header-anchor offset-top"></div><button tabindex="0" type="button" data-href="https://malwarology.substack.com/i/85422807/summary" class="pencraft pc-reset pencraft _iconButton2_bxx6e_689 _iconButtonBase_bxx6e_183 _buttonBase_bxx6e_1 _buttonNew_bxx6e_97 _size_sm_bxx6e_158 _priority_secondary_bxx6e_46"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></button></div></div></h1><p><span>This </span><a href="https://github.com/MBCProject/mbc-markdown/blob/master/anti-static-analysis/software-packing.md" rel="nofollow ugc noopener">packer</a><span> has been observed delivering a wide variety of malware families including </span><a href="https://malpedia.caad.fkie.fraunhofer.de/details/win.smokeloader" rel="nofollow ugc noopener">SmokeLoader</a><span> and </span><a href="https://malpedia.caad.fkie.fraunhofer.de/details/win.vidar" rel="nofollow ugc noopener">Vidar</a><span> among many others. It has been observed in the wild going back a number of years potentially to 2017. The particular variant of the packer analyzed here contains two sets of bytes with no apparent use which occur on either side of values that are integral to the decoding and unpacking process. These two byte strings are stable across many months of observed samples of this packer. What follows is a detailed analysis of the first stage of one sample of this packer which delivers a SmokeLoader payload. Until a widely recognized name or identifier can be determined for this packer, it has the designation </span><code>pkr_ce1a</code><span>.</span></p><h1 class="header-anchor-post">Identification<div class="pencraft pc-display-flex pc-alignItems-center pc-position-absolute pc-reset header-anchor-parent"><div class="pencraft pc-display-contents pc-reset _pubTheme_c2zmd_1"><div id="§identification" class="pencraft pc-reset header-anchor offset-top"></div><button tabindex="0" type="button" data-href="https://malwarology.substack.com/i/85422807/identification" class="pencraft pc-reset pencraft _iconButton2_bxx6e_689 _iconButtonBase_bxx6e_183 _buttonBase_bxx6e_1 _buttonNew_bxx6e_97 _size_sm_bxx6e_158 _priority_secondary_bxx6e_46"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></button></div></div></h1><p><span>This sample has two known filenames. The first, </span><code>6523.exe</code><span>, is observed in the wild in the path component of the URL used to distribute the file.</span><span class="footnote-hovercard-target"><a class="footnote-anchor" data-component-name="FootnoteAnchorToDOM" id="footnote-anchor-1-85422807" href="https://malwarology.substack.com/p/malicious-packer-pkr_ce1a#footnote-1-85422807" target="_self" rel="nofollow ugc noopener">1</a></span><span> The second, </span><code>povgwaoci.iwe</code><span>, is located in the </span><code>RT_VERSION</code><span> resource within the </span><code>VS_VERSIONINFO</code><span> structure in a field named </span><code>InternationalName</code><span>. This field along with others in the same StringTable structure are not parsed by </span><a href="https://exiftool.org/" rel="nofollow ugc noopener">Exiftool</a><span> or </span><a href="https://cerbero.io/ea/" rel="nofollow ugc noopener">Cerbero Suite</a><span>. This indicates that the structure is malformed or non-standard.</span></p><div class="subscription-widget-wrap"><div class="subscription-widget show-subscribe"><div class="preamble"><p>Malwarology Research is a reader-supported publication. To receive new posts and support my work, consider becoming a free or paid subscriber.</p></div><div data-component-name="SubscribeWidget" class="subscribe-widget"><div class="pencraft pc-display-flex pc-justifyContent-center pc-reset"><div class="_container_11q5m_1"><form action="/api/v1/free?nojs=true" method="post" novalidate class="form _form_11q5m_6"><input type="hidden" name="first_url" value/><input type="hidden" name="first_referrer" value/><input type="hidden" name="current_url"/><input type="hidden" name="current_referrer"/><input type="hidden" name="first_session_url" value/><input type="hidden" name="first_session_referrer" value/><input type="hidden" name="referral_code"/><input type="hidden" name="source" value="subscribe-widget-preamble"/><input type="hidden" name="referring_pub_id"/><input type="hidden" name="additional_referring_pub_ids"/><div class="_sideBySideWrap_11q5m_10"><div class="_emailInputWrapper_11q5m_57"><input type="email" name="email" placeholder="Type your email..." class="pencraft _emailInput_11q5m_23"/></div><button tabindex="0" type="submit" class="button rightButton primary subscribe-btn _button_11q5m_76"><span class="button-text ">Subscribe</span></button></div><div id="error-container"></div></form></div></div></div></div></div><p><span>According to AV detection results, the correct identification of the unpacked file, </span><em>SmokeLoader</em><span>, does appear. There is also one detection based on dynamic analysis: </span><em>Zenpack</em><span>.</span></p><p><span>The import hash of this sample is shared by a group of other files.</span><span class="footnote-hovercard-target"><a class="footnote-anchor" data-component-name="FootnoteAnchorToDOM" id="footnote-anchor-2-85422807" href="https://malwarology.substack.com/p/malicious-packer-pkr_ce1a#footnote-2-85422807" target="_self" rel="nofollow ugc noopener">2</a></span><span> However, the large majority of imported functions are called in dead code located after opaque predicates. Therefore, the usefulness of this import hash is almost nothing. Closer analysis of the opaque predicates in this sample can be found below.</span></p><h1 class="header-anchor-post">Behavioral and Code Analysis Findings<div class="pencraft pc-display-flex pc-alignItems-center pc-position-absolute pc-reset header-anchor-parent"><div class="pencraft pc-display-contents pc-reset _pubTheme_c2zmd_1"><div id="§behavioral-and-code-analysis-findings" class="pencraft pc-reset header-anchor offset-top"></div><button tabindex="0" type="button" data-href="https://malwarology.substack.com/i/85422807/behavioral-and-code-analysis-findings" class="pencraft pc-reset pencraft _iconButton2_bxx6e_689 _iconButtonBase_bxx6e_183 _buttonBase_bxx6e_1 _buttonNew_bxx6e_97 _size_sm_bxx6e_158 _priority_secondary_bxx6e_46"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></button></div></div></h1><h2 class="header-anchor-post">Build Analysis<div class="pencraft pc-display-flex pc-alignItems-center pc-position-absolute pc-reset header-anchor-parent"><div class="pencraft pc-display-contents pc-reset _pubTheme_c2zmd_1"><div id="§build-analysis" class="pencraft pc-reset header-anchor offset-top"></div><button tabindex="0" type="button" data-href="https://malwarology.substack.com/i/85422807/build-analysis" class="pencraft pc-reset pencraft _iconButton2_bxx6e_689 _iconButtonBase_bxx6e_183 _buttonBase_bxx6e_1 _buttonNew_bxx6e_97 _size_sm_bxx6e_158 _priority_secondary_bxx6e_46"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></button></div></div></h2><p>According to the File Header, the timestamp of compilation is 2022-02-16T10:14:32Z. The linker version found in the PE32 Optional Header is 9.0.</p><div class="captioned-image-container"><figure><a class="image-link image2" target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc0688009-9c87-4d72-95de-6e40b6e0b8bf_987x400.png" data-component-name="Image2ToDOM" rel="nofollow ugc noopener"><div class="image2-inset"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc0688009-9c87-4d72-95de-6e40b6e0b8bf_987x400.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc0688009-9c87-4d72-95de-6e40b6e0b8bf_987x400.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc0688009-9c87-4d72-95de-6e40b6e0b8bf_987x400.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc0688009-9c87-4d72-95de-6e40b6e0b8bf_987x400.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc0688009-9c87-4d72-95de-6e40b6e0b8bf_987x400.png" width="524" height="212.36068895643365" data-attrs="{&quot;src&quot;:&quot;https://bucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com/public/images/c0688009-9c87-4d72-95de-6e40b6e0b8bf_987x400.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:400,&quot;width&quot;:987,&quot;resizeWidth&quot;:524,&quot;bytes&quot;:116144,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null,&quot;isProcessing&quot;:false}" class="sizing-normal" alt srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc0688009-9c87-4d72-95de-6e40b6e0b8bf_987x400.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc0688009-9c87-4d72-95de-6e40b6e0b8bf_987x400.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc0688009-9c87-4d72-95de-6e40b6e0b8bf_987x400.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc0688009-9c87-4d72-95de-6e40b6e0b8bf_987x400.png 1456w" sizes="100vw" loading="lazy"/></picture><div></div></div></a><figcaption class="image-caption">Linker Version 9.0</figcaption></figure></div><p><span>The compiler is identified as </span><em>Visual Studio 2008 Release</em><span> according to function signatures in Ghidra that match a number of library functions in the sample. One example of this detection for the </span><code>___security_init_cookie</code><span> function is shown in the figure below.</span></p><div class="captioned-image-container"><figure><a class="image-link image2 is-viewable-img" target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fa9981c4e-80b7-42b1-8d7d-70b221343a8e_1526x658.png" data-component-name="Image2ToDOM" rel="nofollow ugc noopener"><div class="image2-inset"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fa9981c4e-80b7-42b1-8d7d-70b221343a8e_1526x658.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fa9981c4e-80b7-42b1-8d7d-70b221343a8e_1526x658.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fa9981c4e-80b7-42b1-8d7d-70b221343a8e_1526x658.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fa9981c4e-80b7-42b1-8d7d-70b221343a8e_1526x658.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fa9981c4e-80b7-42b1-8d7d-70b221343a8e_1526x658.png" width="596" height="257.0659340659341" data-attrs="{&quot;src&quot;:&quot;https://bucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com/public/images/a9981c4e-80b7-42b1-8d7d-70b221343a8e_1526x658.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:false,&quot;imageSize&quot;:&quot;normal&quot;,&quot;height&quot;:628,&quot;width&quot;:1456,&quot;resizeWidth&quot;:596,&quot;bytes&quot;:147679,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null,&quot;isProcessing&quot;:false}" class="sizing-normal" alt srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fa9981c4e-80b7-42b1-8d7d-70b221343a8e_1526x658.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fa9981c4e-80b7-42b1-8d7d-70b221343a8e_1526x658.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fa9981c4e-80b7-42b1-8d7d-70b221343a8e_1526x658.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fa9981c4e-80b7-42b1-8d7d-70b221343a8e_1526x658.png 1456w" sizes="100vw" loading="lazy"/></picture><div class="image-link-expand"><div class="pencraft pc-display-flex pc-gap-8 pc-reset"><div class="pencraft pc-reset icon-container restack-image"><svg role="img" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke-width="1.8" stroke="#000" xmlns="http://www.w3.org/2000/svg"><g><title></title><path d="M21 3V8M21 8H16M21 8L18 5.29962C16.7056 4.14183 15.1038 3.38328 13.3879 3.11547C11.6719 2.84766 9.9152 3.08203 8.32951 3.79031C6.74382 4.49858 5.39691 5.65051 4.45125 7.10715C3.5056 8.5638 3.00158 10.2629 3 11.9996M3 21V16M3 16H8M3 16L6 18.7C7.29445 19.8578 8.89623 20.6163 10.6121 20.8841C12.3281 21.152 14.0848 20.9176 15.6705 20.2093C17.2562 19.501 18.6031 18.3491 19.5487 16.8925C20.4944 15.4358 20.9984 13.7367 21 12" stroke-linecap="round" stroke-linejoin="round"></path></g></svg></div><div class="pencraft pc-reset icon-container view-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-maximize2"><polyline points="15 3 21 3 21 9"></polyline><polyline points="9 21 3 21 3 15"></polyline><line x1="21" x2="14" y1="3" y2="10"></line><line x1="3" x2="10" y1="21" y2="14"></line></svg></div></div></div></div></a><figcaption class="image-caption">Compiler Detection: Visual Studio 2008 Release</figcaption></figure></div><p><span>The majority of the library functions found in the sample are from </span><em>Microsoft Visual C++ 9.0.21022</em><span>. This is identified in the sample’s rich signature.</span></p><div class="captioned-image-container"><figure><a class="image-link image2" target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F3e395003-8628-423b-b240-6c6095ae01ff_1150x452.png" data-component-name="Image2ToDOM" rel="nofollow ugc noopener"><div class="image2-inset"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F3e395003-8628-423b-b240-6c6095ae01ff_1150x452.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F3e395003-8628-423b-b240-6c6095ae01ff_1150x452.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F3e395003-8628-423b-b240-6c6095ae01ff_1150x452.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F3e395003-8628-423b-b240-6c6095ae01ff_1150x452.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F3e395003-8628-423b-b240-6c6095ae01ff_1150x452.png" width="542" height="213.0295652173913" data-attrs="{&quot;src&quot;:&quot;https://bucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com/public/images/3e395003-8628-423b-b240-6c6095ae01ff_1150x452.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:452,&quot;width&quot;:1150,&quot;resizeWidth&quot;:542,&quot;bytes&quot;:100560,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null,&quot;isProcessing&quot;:false}" class="sizing-normal" alt srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F3e395003-8628-423b-b240-6c6095ae01ff_1150x452.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F3e395003-8628-423b-b240-6c6095ae01ff_1150x452.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F3e395003-8628-423b-b240-6c6095ae01ff_1150x452.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F3e395003-8628-423b-b240-6c6095ae01ff_1150x452.png 1456w" sizes="100vw" loading="lazy"/></picture><div></div></div></a><figcaption class="image-caption">Rich Signature: VC++ 9.0.21022</figcaption></figure></div><h2 class="header-anchor-post">Main Function<div class="pencraft pc-display-flex pc-alignItems-center pc-position-absolute pc-reset header-anchor-parent"><div class="pencraft pc-display-contents pc-reset _pubTheme_c2zmd_1"><div id="§main-function" class="pencraft pc-reset header-anchor offset-top"></div><button tabindex="0" type="button" data-href="https://malwarology.substack.com/i/85422807/main-function" class="pencraft pc-reset pencraft _iconButton2_bxx6e_689 _iconButtonBase_bxx6e_183 _buttonBase_bxx6e_1 _buttonNew_bxx6e_97 _size_sm_bxx6e_158 _priority_secondary_bxx6e_46"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></button></div></div></h2><div class="captioned-image-container"><figure><a class="image-link image2 is-viewable-img" target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F168206b9-c47c-4ea0-969d-0a4ed5eb4616_1212x1055.png" data-component-name="Image2ToDOM" rel="nofollow ugc noopener"><div class="image2-inset"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F168206b9-c47c-4ea0-969d-0a4ed5eb4616_1212x1055.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F168206b9-c47c-4ea0-969d-0a4ed5eb4616_1212x1055.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F168206b9-c47c-4ea0-969d-0a4ed5eb4616_1212x1055.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F168206b9-c47c-4ea0-969d-0a4ed5eb4616_1212x1055.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F168206b9-c47c-4ea0-969d-0a4ed5eb4616_1212x1055.png" width="564" height="490.94059405940595" data-attrs="{&quot;src&quot;:&quot;https://bucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com/public/images/168206b9-c47c-4ea0-969d-0a4ed5eb4616_1212x1055.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:1055,&quot;width&quot;:1212,&quot;resizeWidth&quot;:564,&quot;bytes&quot;:352113,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null,&quot;isProcessing&quot;:false}" class="sizing-normal" alt srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F168206b9-c47c-4ea0-969d-0a4ed5eb4616_1212x1055.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F168206b9-c47c-4ea0-969d-0a4ed5eb4616_1212x1055.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F168206b9-c47c-4ea0-969d-0a4ed5eb4616_1212x1055.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F168206b9-c47c-4ea0-969d-0a4ed5eb4616_1212x1055.png 1456w" sizes="100vw" loading="lazy"/></picture><div class="image-link-expand"><div class="pencraft pc-display-flex pc-gap-8 pc-reset"><div class="pencraft pc-reset icon-container restack-image"><svg role="img" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke-width="1.8" stroke="#000" xmlns="http://www.w3.org/2000/svg"><g><title></title><path d="M21 3V8M21 8H16M21 8L18 5.29962C16.7056 4.14183 15.1038 3.38328 13.3879 3.11547C11.6719 2.84766 9.9152 3.08203 8.32951 3.79031C6.74382 4.49858 5.39691 5.65051 4.45125 7.10715C3.5056 8.5638 3.00158 10.2629 3 11.9996M3 21V16M3 16H8M3 16L6 18.7C7.29445 19.8578 8.89623 20.6163 10.6121 20.8841C12.3281 21.152 14.0848 20.9176 15.6705 20.2093C17.2562 19.501 18.6031 18.3491 19.5487 16.8925C20.4944 15.4358 20.9984 13.7367 21 12" stroke-linecap="round" stroke-linejoin="round"></path></g></svg></div><div class="pencraft pc-reset icon-container view-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-maximize2"><polyline points="15 3 21 3 21 9"></polyline><polyline points="9 21 3 21 3 15"></polyline><line x1="21" x2="14" y1="3" y2="10"></line><line x1="3" x2="10" y1="21" y2="14"></line></svg></div></div></div></div></a><figcaption class="image-caption">Main Function</figcaption></figure></div><p><span>The instructions highlighted in yellow in the figure above are examples of </span><a href="https://github.com/MBCProject/mbc-markdown/blob/master/anti-static-analysis/executable-code-obfuscation.md#:~:text=analysis%20visually%20harder.-,Junk%20Code%20Insertion,-B0032.007" rel="nofollow ugc noopener">junk code insertion</a><span>. These are dummy instructions that are placed between relevant instructions with the goal of making signature development more difficult. The instructions at the end of the function highlighted in white are not executed. These highlight colorings are used throughout the screenshots of this analysis.</span></p><p><span>The first instructions in the main function calculate the size of the encoded data that contains the shellcode which is the next stage of the packer. The first part is read from a constant in the </span><code>.data</code><span> section at address </span><code>0x41cc3c</code><span>. The second part is hardcoded in the main function at address </span><code>0x406573</code><span>. The size is calculated in the next instruction by adding the two parts together. The resulting size is written to a variable in the </span><code>.data</code><span> section. Highlighted in the figure below are the bytes before and after the first constant. These two sets of bytes are not read during the execution of the packer, and their purpose is unknown. However, they are stable across builds of this packer going back for months at least.</span></p><div class="captioned-image-container"><figure><a class="image-link image2" target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fbe61ed5a-e890-4f81-8b22-003cdb96b0f8_1090x290.png" data-component-name="Image2ToDOM" rel="nofollow ugc noopener"><div class="image2-inset"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fbe61ed5a-e890-4f81-8b22-003cdb96b0f8_1090x290.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fbe61ed5a-e890-4f81-8b22-003cdb96b0f8_1090x290.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fbe61ed5a-e890-4f81-8b22-003cdb96b0f8_1090x290.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fbe61ed5a-e890-4f81-8b22-003cdb96b0f8_1090x290.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fbe61ed5a-e890-4f81-8b22-003cdb96b0f8_1090x290.png" width="552" height="146.86238532110093" data-attrs="{&quot;src&quot;:&quot;https://bucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com/public/images/be61ed5a-e890-4f81-8b22-003cdb96b0f8_1090x290.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:290,&quot;width&quot;:1090,&quot;resizeWidth&quot;:552,&quot;bytes&quot;:63104,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null,&quot;isProcessing&quot;:false}" class="sizing-normal" alt srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fbe61ed5a-e890-4f81-8b22-003cdb96b0f8_1090x290.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fbe61ed5a-e890-4f81-8b22-003cdb96b0f8_1090x290.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fbe61ed5a-e890-4f81-8b22-003cdb96b0f8_1090x290.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fbe61ed5a-e890-4f81-8b22-003cdb96b0f8_1090x290.png 1456w" sizes="100vw" loading="lazy"/></picture><div></div></div></a><figcaption class="image-caption">Stable Surrounding Bytes</figcaption></figure></div><p><span>The address where the encoded data is located goes through a similar process. The first part is read from the </span><code>.data</code><span> section then written to a variable in the same section. The addition to the second part does not occur until later in the </span><code>unpack_shellcode</code><span> function. The bytes surrounding this part are shown in the figure below.</span></p><div class="captioned-image-container"><figure><a class="image-link image2" target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F02024936-1f68-4e97-a267-33b14f702000_1093x288.png" data-component-name="Image2ToDOM" rel="nofollow ugc noopener"><div class="image2-inset"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F02024936-1f68-4e97-a267-33b14f702000_1093x288.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F02024936-1f68-4e97-a267-33b14f702000_1093x288.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F02024936-1f68-4e97-a267-33b14f702000_1093x288.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F02024936-1f68-4e97-a267-33b14f702000_1093x288.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F02024936-1f68-4e97-a267-33b14f702000_1093x288.png" width="556" height="146.5032021957914" data-attrs="{&quot;src&quot;:&quot;https://bucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com/public/images/02024936-1f68-4e97-a267-33b14f702000_1093x288.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:288,&quot;width&quot;:1093,&quot;resizeWidth&quot;:556,&quot;bytes&quot;:58860,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null,&quot;isProcessing&quot;:false}" class="sizing-normal" alt srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F02024936-1f68-4e97-a267-33b14f702000_1093x288.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F02024936-1f68-4e97-a267-33b14f702000_1093x288.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F02024936-1f68-4e97-a267-33b14f702000_1093x288.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F02024936-1f68-4e97-a267-33b14f702000_1093x288.png 1456w" sizes="100vw" loading="lazy"/></picture><div></div></div></a><figcaption class="image-caption">Stable Surrounding Bytes</figcaption></figure></div><p><span>The next set of instructions handles loading </span><code>kernel32.dll</code><span> and resolving the address of </span><code>LocalAlloc</code><span>.</span><span class="footnote-hovercard-target"><a class="footnote-anchor" data-component-name="FootnoteAnchorToDOM" id="footnote-anchor-3-85422807" href="https://malwarology.substack.com/p/malicious-packer-pkr_ce1a#footnote-3-85422807" target="_self" rel="nofollow ugc noopener">3</a></span><span> These instructions taken together are unique to this packer and shared across hundreds of variants. The stray instruction at address </span><code>0x406588</code><span> is part of the previous logical grouping of instructions. This is an example of </span><a href="https://github.com/MBCProject/mbc-markdown/blob/master/anti-static-analysis/executable-code-obfuscation.md#:~:text=to%20confuse%20disassembler.-,Interleaving%20Code,-B0032.014" rel="nofollow ugc noopener">interleaving code</a><span> that is meant to make signature development more difficult.</span></p><div class="captioned-image-container"><figure><a class="image-link image2" target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fac742791-6fc4-424c-b79e-2538e69faebe_1389x257.png" data-component-name="Image2ToDOM" rel="nofollow ugc noopener"><div class="image2-inset"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fac742791-6fc4-424c-b79e-2538e69faebe_1389x257.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fac742791-6fc4-424c-b79e-2538e69faebe_1389x257.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fac742791-6fc4-424c-b79e-2538e69faebe_1389x257.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fac742791-6fc4-424c-b79e-2538e69faebe_1389x257.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fac742791-6fc4-424c-b79e-2538e69faebe_1389x257.png" width="644" height="119.15622750179986" data-attrs="{&quot;src&quot;:&quot;https://bucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com/public/images/ac742791-6fc4-424c-b79e-2538e69faebe_1389x257.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:257,&quot;width&quot;:1389,&quot;resizeWidth&quot;:644,&quot;bytes&quot;:110510,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null,&quot;isProcessing&quot;:false}" class="sizing-normal" alt srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fac742791-6fc4-424c-b79e-2538e69faebe_1389x257.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fac742791-6fc4-424c-b79e-2538e69faebe_1389x257.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fac742791-6fc4-424c-b79e-2538e69faebe_1389x257.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fac742791-6fc4-424c-b79e-2538e69faebe_1389x257.png 1456w" sizes="100vw" loading="lazy"/></picture><div></div></div></a><figcaption class="image-caption"><span>Resolve </span><code>LocalAlloc</code></figcaption></figure></div><p><span>The call to </span><code>LocalAlloc</code><span> is obfuscated by calling it from the </span><code>eax</code><span> register. This is a type of function call obfuscation. The </span><code>uBytes</code><span> parameter to the function is 63072 bytes which is the result of the calculation described above.</span></p><div class="captioned-image-container"><figure><a class="image-link image2" target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F3c5832a3-a278-4491-9111-27bc29b8d822_1238x163.png" data-component-name="Image2ToDOM" rel="nofollow ugc noopener"><div class="image2-inset"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F3c5832a3-a278-4491-9111-27bc29b8d822_1238x163.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F3c5832a3-a278-4491-9111-27bc29b8d822_1238x163.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F3c5832a3-a278-4491-9111-27bc29b8d822_1238x163.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F3c5832a3-a278-4491-9111-27bc29b8d822_1238x163.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F3c5832a3-a278-4491-9111-27bc29b8d822_1238x163.png" width="656" height="86.37156704361874" data-attrs="{&quot;src&quot;:&quot;https://bucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com/public/images/3c5832a3-a278-4491-9111-27bc29b8d822_1238x163.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:163,&quot;width&quot;:1238,&quot;resizeWidth&quot;:656,&quot;bytes&quot;:71941,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null,&quot;isProcessing&quot;:false}" class="sizing-normal" alt srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F3c5832a3-a278-4491-9111-27bc29b8d822_1238x163.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F3c5832a3-a278-4491-9111-27bc29b8d822_1238x163.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F3c5832a3-a278-4491-9111-27bc29b8d822_1238x163.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F3c5832a3-a278-4491-9111-27bc29b8d822_1238x163.png 1456w" sizes="100vw" loading="lazy"/></picture><div></div></div></a><figcaption class="image-caption"><span>Obfuscated Call to </span><code>LocalAlloc</code></figcaption></figure></div><p>The final instructions in the main function are calls to other malicious functions and finally a call to the entry point of the decoded shellcode. The next stage of the packer starts after that call.</p><h2 class="header-anchor-post">Change Protection Function<div class="pencraft pc-display-flex pc-alignItems-center pc-position-absolute pc-reset header-anchor-parent"><div class="pencraft pc-display-contents pc-reset _pubTheme_c2zmd_1"><div id="§change-protection-function" class="pencraft pc-reset header-anchor offset-top"></div><button tabindex="0" type="button" data-href="https://malwarology.substack.com/i/85422807/change-protection-function" class="pencraft pc-reset pencraft _iconButton2_bxx6e_689 _iconButtonBase_bxx6e_183 _buttonBase_bxx6e_1 _buttonNew_bxx6e_97 _size_sm_bxx6e_158 _priority_secondary_bxx6e_46"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></button></div></div></h2><div class="captioned-image-container"><figure><a class="image-link image2 is-viewable-img" target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fabf65e66-e753-4257-9483-3156944cdc14_1278x1639.png" data-component-name="Image2ToDOM" rel="nofollow ugc noopener"><div class="image2-inset"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fabf65e66-e753-4257-9483-3156944cdc14_1278x1639.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fabf65e66-e753-4257-9483-3156944cdc14_1278x1639.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fabf65e66-e753-4257-9483-3156944cdc14_1278x1639.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fabf65e66-e753-4257-9483-3156944cdc14_1278x1639.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fabf65e66-e753-4257-9483-3156944cdc14_1278x1639.png" width="558" height="715.6197183098592" data-attrs="{&quot;src&quot;:&quot;https://bucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com/public/images/abf65e66-e753-4257-9483-3156944cdc14_1278x1639.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:1639,&quot;width&quot;:1278,&quot;resizeWidth&quot;:558,&quot;bytes&quot;:558933,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null,&quot;isProcessing&quot;:false}" class="sizing-normal" alt srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fabf65e66-e753-4257-9483-3156944cdc14_1278x1639.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fabf65e66-e753-4257-9483-3156944cdc14_1278x1639.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fabf65e66-e753-4257-9483-3156944cdc14_1278x1639.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fabf65e66-e753-4257-9483-3156944cdc14_1278x1639.png 1456w" sizes="100vw" loading="lazy"/></picture><div class="image-link-expand"><div class="pencraft pc-display-flex pc-gap-8 pc-reset"><div class="pencraft pc-reset icon-container restack-image"><svg role="img" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke-width="1.8" stroke="#000" xmlns="http://www.w3.org/2000/svg"><g><title></title><path d="M21 3V8M21 8H16M21 8L18 5.29962C16.7056 4.14183 15.1038 3.38328 13.3879 3.11547C11.6719 2.84766 9.9152 3.08203 8.32951 3.79031C6.74382 4.49858 5.39691 5.65051 4.45125 7.10715C3.5056 8.5638 3.00158 10.2629 3 11.9996M3 21V16M3 16H8M3 16L6 18.7C7.29445 19.8578 8.89623 20.6163 10.6121 20.8841C12.3281 21.152 14.0848 20.9176 15.6705 20.2093C17.2562 19.501 18.6031 18.3491 19.5487 16.8925C20.4944 15.4358 20.9984 13.7367 21 12" stroke-linecap="round" stroke-linejoin="round"></path></g></svg></div><div class="pencraft pc-reset icon-container view-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-maximize2"><polyline points="15 3 21 3 21 9"></polyline><polyline points="9 21 3 21 3 15"></polyline><line x1="21" x2="14" y1="3" y2="10"></line><line x1="3" x2="10" y1="21" y2="14"></line></svg></div></div></div></div></a><figcaption class="image-caption">Change Protection Function</figcaption></figure></div><p><span>This function is a wrapper around an obfuscated call to </span><code>VirtualProtect</code><span>. Starting at address </span><code>0x4058e3</code><span> and continuing until the call to </span><code>GetProcAddress</code><span>, the name of the function </span><code>VirtualProtect</code><span> is written character-by-character, out of order, to a variable in the </span><code>.data</code><span> section. Building the function name in this way is an example of </span><a href="https://github.com/MBCProject/mbc-markdown/blob/master/anti-static-analysis/disassembler-evasion.md#:~:text=Variable%20Recomposition" rel="nofollow ugc noopener">variable recomposition</a><span>. The address of this string is then used as the </span><code>lpProcName</code><span> parameter to </span><code>GetProcAddress</code><span>. Finally, a call is made to </span><code>VirtualProtect</code><span> to change the protection from </span><code>PAGE_READWRITE</code><span> (</span><code>0x4</code><span>) to </span><code>PAGE_EXECUTE_READWRITE</code><span> (</span><code>0x40</code><span>) thus enabling execution in the newly allocated memory.</span></p><p><span>The </span><code>flNewProtect</code><span> parameter to the </span><code>VirtualProtect</code><span> function is also obfuscated by adding together </span><code>0x20</code><span> and </span><code>0x20</code><span>. This hides the </span><code>PAGE_EXECUTE_READWRITE</code><span> flag of </span><code>0x40</code><span> from being located near the call to </span><code>VirtualProtect</code><span>. This is a form of </span><a href="https://github.com/MBCProject/mbc-markdown/blob/master/anti-static-analysis/disassembler-evasion.md#:~:text=Argument%20Obfuscation" rel="nofollow ugc noopener">argument obfuscation</a><span>.</span></p><div class="captioned-image-container"><figure><a class="image-link image2" target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fa5b5e201-e7f0-4939-9a34-c2ab7d687616_1521x66.png" data-component-name="Image2ToDOM" rel="nofollow ugc noopener"><div class="image2-inset"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fa5b5e201-e7f0-4939-9a34-c2ab7d687616_1521x66.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fa5b5e201-e7f0-4939-9a34-c2ab7d687616_1521x66.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fa5b5e201-e7f0-4939-9a34-c2ab7d687616_1521x66.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fa5b5e201-e7f0-4939-9a34-c2ab7d687616_1521x66.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fa5b5e201-e7f0-4939-9a34-c2ab7d687616_1521x66.png" width="1456" height="63" data-attrs="{&quot;src&quot;:&quot;https://bucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com/public/images/a5b5e201-e7f0-4939-9a34-c2ab7d687616_1521x66.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:63,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:40379,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null,&quot;isProcessing&quot;:false}" class="sizing-normal" alt srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fa5b5e201-e7f0-4939-9a34-c2ab7d687616_1521x66.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fa5b5e201-e7f0-4939-9a34-c2ab7d687616_1521x66.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fa5b5e201-e7f0-4939-9a34-c2ab7d687616_1521x66.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fa5b5e201-e7f0-4939-9a34-c2ab7d687616_1521x66.png 1456w" sizes="100vw" loading="lazy"/></picture><div></div></div></a><figcaption class="image-caption">Obfuscated New Protect Value</figcaption></figure></div><h2 class="header-anchor-post">Unpack Shellcode Function<div class="pencraft pc-display-flex pc-alignItems-center pc-position-absolute pc-reset header-anchor-parent"><div class="pencraft pc-display-contents pc-reset _pubTheme_c2zmd_1"><div id="§unpack-shellcode-function" class="pencraft pc-reset header-anchor offset-top"></div><button tabindex="0" type="button" data-href="https://malwarology.substack.com/i/85422807/unpack-shellcode-function" class="pencraft pc-reset pencraft _iconButton2_bxx6e_689 _iconButtonBase_bxx6e_183 _buttonBase_bxx6e_1 _buttonNew_bxx6e_97 _size_sm_bxx6e_158 _priority_secondary_bxx6e_46"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></button></div></div></h2><p><span>This function performs three actions that are interspersed with anti-analysis code. The first action is moving the encoded data from its starting location in the </span><code>.data</code><span> section to the newly allocated memory.</span></p><div class="captioned-image-container"><figure><a class="image-link image2 is-viewable-img" target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F72a2f4df-84b0-49ad-a659-fca776c25d5e_1637x1513.png" data-component-name="Image2ToDOM" rel="nofollow ugc noopener"><div class="image2-inset"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F72a2f4df-84b0-49ad-a659-fca776c25d5e_1637x1513.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F72a2f4df-84b0-49ad-a659-fca776c25d5e_1637x1513.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F72a2f4df-84b0-49ad-a659-fca776c25d5e_1637x1513.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F72a2f4df-84b0-49ad-a659-fca776c25d5e_1637x1513.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F72a2f4df-84b0-49ad-a659-fca776c25d5e_1637x1513.png" width="632" height="584.2527472527472" data-attrs="{&quot;src&quot;:&quot;https://bucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com/public/images/72a2f4df-84b0-49ad-a659-fca776c25d5e_1637x1513.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:1346,&quot;width&quot;:1456,&quot;resizeWidth&quot;:632,&quot;bytes&quot;:362197,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null,&quot;isProcessing&quot;:false}" class="sizing-normal" alt srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F72a2f4df-84b0-49ad-a659-fca776c25d5e_1637x1513.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F72a2f4df-84b0-49ad-a659-fca776c25d5e_1637x1513.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F72a2f4df-84b0-49ad-a659-fca776c25d5e_1637x1513.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F72a2f4df-84b0-49ad-a659-fca776c25d5e_1637x1513.png 1456w" sizes="100vw" loading="lazy"/></picture><div class="image-link-expand"><div class="pencraft pc-display-flex pc-gap-8 pc-reset"><div class="pencraft pc-reset icon-container restack-image"><svg role="img" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke-width="1.8" stroke="#000" xmlns="http://www.w3.org/2000/svg"><g><title></title><path d="M21 3V8M21 8H16M21 8L18 5.29962C16.7056 4.14183 15.1038 3.38328 13.3879 3.11547C11.6719 2.84766 9.9152 3.08203 8.32951 3.79031C6.74382 4.49858 5.39691 5.65051 4.45125 7.10715C3.5056 8.5638 3.00158 10.2629 3 11.9996M3 21V16M3 16H8M3 16L6 18.7C7.29445 19.8578 8.89623 20.6163 10.6121 20.8841C12.3281 21.152 14.0848 20.9176 15.6705 20.2093C17.2562 19.501 18.6031 18.3491 19.5487 16.8925C20.4944 15.4358 20.9984 13.7367 21 12" stroke-linecap="round" stroke-linejoin="round"></path></g></svg></div><div class="pencraft pc-reset icon-container view-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-maximize2"><polyline points="15 3 21 3 21 9"></polyline><polyline points="9 21 3 21 3 15"></polyline><line x1="21" x2="14" y1="3" y2="10"></line><line x1="3" x2="10" y1="21" y2="14"></line></svg></div></div></div></div></a><figcaption class="image-caption">Move Encoded Data</figcaption></figure></div><p><span>Note the instructions at addresses </span><code>0x405aa7</code><span> and </span><code>0x405acd</code><span>. These are both </span><a href="https://github.com/MBCProject/mbc-markdown/blob/master/anti-static-analysis/executable-code-obfuscation.md" rel="nofollow ugc noopener">opaque predicates</a><span>. An opaque predicate appears to be a conditional jump, but the conditions can only be met in one way making the jump effectively unconditional. The one at the top is basically a fake: it never jumps. The one in the middle always jumps. This one additionally encloses a block of </span><a href="https://github.com/MBCProject/mbc-markdown/blob/master/anti-static-analysis/executable-code-obfuscation.md#:~:text=.%20%5BNEEDS%20REVIEW%5D-,Dead%20Code%20Insertion,-B0032.003" rel="nofollow ugc noopener">dead code</a><span>. This packer very frequently couples dead code insertion with opaque predicates that always jump over the dead code. The function calls in the dead code are included in the import table making identification via import hash of little utility.</span></p><p><span>Later on in this function is the call to the </span><code>decode</code><span> function. After that is a call to a function which shifts the pointer to the decoded shellcode. The shift changes the offset from the start of this data to the location of the shellcode original execution point (OEP). Because the shellcode is position independent, this OEP is also offset zero of the shellcode. Both of these functions are analyzed in more detail below.</span></p><p><span>The </span><code>shift_shellcode_oep</code><span> function is additionally wrapped in an anti-emulator </span><a href="https://github.com/MBCProject/mbc-markdown/blob/master/anti-behavioral-analysis/emulator-evasion.md#:~:text=to%20block%20emulators.-,Extra%20Loops,-/Time%20Locks" rel="nofollow ugc noopener">loop which has a very high number of iterations</a><span>. This slows processing in an emulator which can potentially cause a timeout and an analysis failure.</span></p><div class="captioned-image-container"><figure><a class="image-link image2 is-viewable-img" target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F866ae73e-b5eb-401e-b158-b7530d7f909b_1450x673.png" data-component-name="Image2ToDOM" rel="nofollow ugc noopener"><div class="image2-inset"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F866ae73e-b5eb-401e-b158-b7530d7f909b_1450x673.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F866ae73e-b5eb-401e-b158-b7530d7f909b_1450x673.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F866ae73e-b5eb-401e-b158-b7530d7f909b_1450x673.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F866ae73e-b5eb-401e-b158-b7530d7f909b_1450x673.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F866ae73e-b5eb-401e-b158-b7530d7f909b_1450x673.png" width="646" height="299.83310344827584" data-attrs="{&quot;src&quot;:&quot;https://bucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com/public/images/866ae73e-b5eb-401e-b158-b7530d7f909b_1450x673.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:673,&quot;width&quot;:1450,&quot;resizeWidth&quot;:646,&quot;bytes&quot;:106252,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null,&quot;isProcessing&quot;:false}" class="sizing-normal" alt srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F866ae73e-b5eb-401e-b158-b7530d7f909b_1450x673.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F866ae73e-b5eb-401e-b158-b7530d7f909b_1450x673.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F866ae73e-b5eb-401e-b158-b7530d7f909b_1450x673.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F866ae73e-b5eb-401e-b158-b7530d7f909b_1450x673.png 1456w" sizes="100vw" loading="lazy"/></picture><div class="image-link-expand"><div class="pencraft pc-display-flex pc-gap-8 pc-reset"><div class="pencraft pc-reset icon-container restack-image"><svg role="img" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke-width="1.8" stroke="#000" xmlns="http://www.w3.org/2000/svg"><g><title></title><path d="M21 3V8M21 8H16M21 8L18 5.29962C16.7056 4.14183 15.1038 3.38328 13.3879 3.11547C11.6719 2.84766 9.9152 3.08203 8.32951 3.79031C6.74382 4.49858 5.39691 5.65051 4.45125 7.10715C3.5056 8.5638 3.00158 10.2629 3 11.9996M3 21V16M3 16H8M3 16L6 18.7C7.29445 19.8578 8.89623 20.6163 10.6121 20.8841C12.3281 21.152 14.0848 20.9176 15.6705 20.2093C17.2562 19.501 18.6031 18.3491 19.5487 16.8925C20.4944 15.4358 20.9984 13.7367 21 12" stroke-linecap="round" stroke-linejoin="round"></path></g></svg></div><div class="pencraft pc-reset icon-container view-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-maximize2"><polyline points="15 3 21 3 21 9"></polyline><polyline points="9 21 3 21 3 15"></polyline><line x1="21" x2="14" y1="3" y2="10"></line><line x1="3" x2="10" y1="21" y2="14"></line></svg></div></div></div></div></a><figcaption class="image-caption">Decode and Shift Shellcode OEP Functions</figcaption></figure></div><p><span>Note the comparison instruction at address </span><code>0x406486</code><span>. During the anti-emulation loop, the call to </span><code>shift_shellcode_oep</code><span> is made once when the counter reaches </span><code>0x770e</code><span>. This is a type of anti-emulation circumvention countermeasure. A basic method for circumventing extremely long loops that target emulators is to patch out the loop. Another is to detect the loop in the emulator and then modify the counter to leave the loop. Because the shift function is called once at a point in the loop, either of these circumventions could end up not executing this function and would leave the emulator unable to execute the shellcode correctly.</span></p><p><span>The </span><code>unpack_shellcode</code><span> function overall contains ten opaque predicates primarily of the same type shown above. One of them is slightly different in that it creates a dead end filled with dead code. The last instruction in the dead end is a call to </span><code>terminate</code><span>. Therefore, this appears to be a location where the execution of the packer ends.</span></p><div class="captioned-image-container"><figure><a class="image-link image2 is-viewable-img" target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F5357e40a-81ff-4af9-b8a2-721de45ba45f_1956x1173.png" data-component-name="Image2ToDOM" rel="nofollow ugc noopener"><div class="image2-inset"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F5357e40a-81ff-4af9-b8a2-721de45ba45f_1956x1173.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F5357e40a-81ff-4af9-b8a2-721de45ba45f_1956x1173.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F5357e40a-81ff-4af9-b8a2-721de45ba45f_1956x1173.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F5357e40a-81ff-4af9-b8a2-721de45ba45f_1956x1173.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F5357e40a-81ff-4af9-b8a2-721de45ba45f_1956x1173.png" width="560" height="335.7692307692308" data-attrs="{&quot;src&quot;:&quot;https://bucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com/public/images/5357e40a-81ff-4af9-b8a2-721de45ba45f_1956x1173.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:873,&quot;width&quot;:1456,&quot;resizeWidth&quot;:560,&quot;bytes&quot;:300550,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null,&quot;isProcessing&quot;:false}" class="sizing-normal" alt srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F5357e40a-81ff-4af9-b8a2-721de45ba45f_1956x1173.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F5357e40a-81ff-4af9-b8a2-721de45ba45f_1956x1173.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F5357e40a-81ff-4af9-b8a2-721de45ba45f_1956x1173.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F5357e40a-81ff-4af9-b8a2-721de45ba45f_1956x1173.png 1456w" sizes="100vw" loading="lazy"/></picture><div class="image-link-expand"><div class="pencraft pc-display-flex pc-gap-8 pc-reset"><div class="pencraft pc-reset icon-container restack-image"><svg role="img" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke-width="1.8" stroke="#000" xmlns="http://www.w3.org/2000/svg"><g><title></title><path d="M21 3V8M21 8H16M21 8L18 5.29962C16.7056 4.14183 15.1038 3.38328 13.3879 3.11547C11.6719 2.84766 9.9152 3.08203 8.32951 3.79031C6.74382 4.49858 5.39691 5.65051 4.45125 7.10715C3.5056 8.5638 3.00158 10.2629 3 11.9996M3 21V16M3 16H8M3 16L6 18.7C7.29445 19.8578 8.89623 20.6163 10.6121 20.8841C12.3281 21.152 14.0848 20.9176 15.6705 20.2093C17.2562 19.501 18.6031 18.3491 19.5487 16.8925C20.4944 15.4358 20.9984 13.7367 21 12" stroke-linecap="round" stroke-linejoin="round"></path></g></svg></div><div class="pencraft pc-reset icon-container view-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-maximize2"><polyline points="15 3 21 3 21 9"></polyline><polyline points="9 21 3 21 3 15"></polyline><line x1="21" x2="14" y1="3" y2="10"></line><line x1="3" x2="10" y1="21" y2="14"></line></svg></div></div></div></div></a><figcaption class="image-caption">Opaque Predicate with Dead End</figcaption></figure></div><p><span>There are a total of four anti-emulation loops similar to the one analyzed above. Two of these wrap opaque predicates which in turn wrap inserted dead code. One, however, in addition to wrapping two opaque predicates, also contains two additional anti-emulator behaviors. Both of these are calls to </span><a href="https://github.com/MBCProject/mbc-markdown/blob/master/anti-behavioral-analysis/emulator-evasion.md#:~:text=non%2Dexhaustive%20emulators.-,Unusual,-/Undocumented%20API%20Calls" rel="nofollow ugc noopener">unusual APIs</a><span>: </span><code>GetGeoInfoA</code><span> and </span><code>GetSystemDefaultLangID</code><span>. During analysis, </span><a href="https://github.com/qilingframework/qiling" rel="nofollow ugc noopener">Qiling emulator</a><span> halted with an exception because neither of these API calls have been implemented.</span></p><div class="captioned-image-container"><figure><a class="image-link image2" target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc611ee6a-667b-46de-af2f-23e79541614e_1082x394.png" data-component-name="Image2ToDOM" rel="nofollow ugc noopener"><div class="image2-inset"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc611ee6a-667b-46de-af2f-23e79541614e_1082x394.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc611ee6a-667b-46de-af2f-23e79541614e_1082x394.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc611ee6a-667b-46de-af2f-23e79541614e_1082x394.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc611ee6a-667b-46de-af2f-23e79541614e_1082x394.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc611ee6a-667b-46de-af2f-23e79541614e_1082x394.png" width="574" height="209.0166358595194" data-attrs="{&quot;src&quot;:&quot;https://bucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com/public/images/c611ee6a-667b-46de-af2f-23e79541614e_1082x394.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:394,&quot;width&quot;:1082,&quot;resizeWidth&quot;:574,&quot;bytes&quot;:107919,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null,&quot;isProcessing&quot;:false}" class="sizing-normal" alt srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc611ee6a-667b-46de-af2f-23e79541614e_1082x394.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc611ee6a-667b-46de-af2f-23e79541614e_1082x394.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc611ee6a-667b-46de-af2f-23e79541614e_1082x394.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc611ee6a-667b-46de-af2f-23e79541614e_1082x394.png 1456w" sizes="100vw" loading="lazy"/></picture><div></div></div></a><figcaption class="image-caption">Anti-Emulation: Unusual API Calls</figcaption></figure></div><p><span>In the very first code block of the </span><code>unpack_shellcode</code><span> function, a new and subsequently unused exception handler is registered. Chances are about even that this is an anti-emulation behavior or it is just junk code. If it is anti-emulation, it is targeting older emulators based on specific versions of </span><a href="https://github.com/unicorn-engine/unicorn" rel="nofollow ugc noopener">Unicorn Engine</a><span> which </span><a href="https://github.com/unipacker/unicorn#:~:text=not%20available%20in%20the%20current%20version" rel="nofollow ugc noopener">do not implement access</a><span> to the Windows Thread Information Block (TIB). Moving the contents of </span><code>fs:0x0</code><span> as happens at address </span><code>0x405983</code><span> would fail in that particular environment. This type of anti-emulation is an </span><a href="https://github.com/MBCProject/mbc-markdown/blob/master/anti-behavioral-analysis/emulator-evasion.md#:~:text=emulators%20give%20up.-,Undocumented%20Opcodes,-B0005.002" rel="nofollow ugc noopener">unimplemented opcode</a><span>.</span></p><div class="captioned-image-container"><figure><a class="image-link image2 is-viewable-img" target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fe93c840b-b386-45b8-97d5-083b6df35bff_1257x567.png" data-component-name="Image2ToDOM" rel="nofollow ugc noopener"><div class="image2-inset"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fe93c840b-b386-45b8-97d5-083b6df35bff_1257x567.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fe93c840b-b386-45b8-97d5-083b6df35bff_1257x567.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fe93c840b-b386-45b8-97d5-083b6df35bff_1257x567.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fe93c840b-b386-45b8-97d5-083b6df35bff_1257x567.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fe93c840b-b386-45b8-97d5-083b6df35bff_1257x567.png" width="556" height="250.79713603818615" data-attrs="{&quot;src&quot;:&quot;https://bucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com/public/images/e93c840b-b386-45b8-97d5-083b6df35bff_1257x567.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:567,&quot;width&quot;:1257,&quot;resizeWidth&quot;:556,&quot;bytes&quot;:189345,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null,&quot;isProcessing&quot;:false}" class="sizing-normal" alt srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fe93c840b-b386-45b8-97d5-083b6df35bff_1257x567.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fe93c840b-b386-45b8-97d5-083b6df35bff_1257x567.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fe93c840b-b386-45b8-97d5-083b6df35bff_1257x567.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fe93c840b-b386-45b8-97d5-083b6df35bff_1257x567.png 1456w" sizes="100vw" loading="lazy"/></picture><div class="image-link-expand"><div class="pencraft pc-display-flex pc-gap-8 pc-reset"><div class="pencraft pc-reset icon-container restack-image"><svg role="img" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke-width="1.8" stroke="#000" xmlns="http://www.w3.org/2000/svg"><g><title></title><path d="M21 3V8M21 8H16M21 8L18 5.29962C16.7056 4.14183 15.1038 3.38328 13.3879 3.11547C11.6719 2.84766 9.9152 3.08203 8.32951 3.79031C6.74382 4.49858 5.39691 5.65051 4.45125 7.10715C3.5056 8.5638 3.00158 10.2629 3 11.9996M3 21V16M3 16H8M3 16L6 18.7C7.29445 19.8578 8.89623 20.6163 10.6121 20.8841C12.3281 21.152 14.0848 20.9176 15.6705 20.2093C17.2562 19.501 18.6031 18.3491 19.5487 16.8925C20.4944 15.4358 20.9984 13.7367 21 12" stroke-linecap="round" stroke-linejoin="round"></path></g></svg></div><div class="pencraft pc-reset icon-container view-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-maximize2"><polyline points="15 3 21 3 21 9"></polyline><polyline points="9 21 3 21 3 15"></polyline><line x1="21" x2="14" y1="3" y2="10"></line><line x1="3" x2="10" y1="21" y2="14"></line></svg></div></div></div></div></a><figcaption class="image-caption">Register New SEH</figcaption></figure></div><p><span>In the last block of the </span><code>unpack_shellcode</code><span> function, before the return, the SEH is reset back to the previous handler. This occurs right after a junk call to </span><code>LoadLibraryW</code><span> from which no functions are subsequently resolved.</span></p><div class="captioned-image-container"><figure><a class="image-link image2" target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F687c0682-ef02-4251-8aba-b60016f085de_1182x415.png" data-component-name="Image2ToDOM" rel="nofollow ugc noopener"><div class="image2-inset"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F687c0682-ef02-4251-8aba-b60016f085de_1182x415.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F687c0682-ef02-4251-8aba-b60016f085de_1182x415.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F687c0682-ef02-4251-8aba-b60016f085de_1182x415.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F687c0682-ef02-4251-8aba-b60016f085de_1182x415.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F687c0682-ef02-4251-8aba-b60016f085de_1182x415.png" width="598" height="209.95769881556683" data-attrs="{&quot;src&quot;:&quot;https://bucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com/public/images/687c0682-ef02-4251-8aba-b60016f085de_1182x415.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:415,&quot;width&quot;:1182,&quot;resizeWidth&quot;:598,&quot;bytes&quot;:128386,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null,&quot;isProcessing&quot;:false}" class="sizing-normal" alt srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F687c0682-ef02-4251-8aba-b60016f085de_1182x415.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F687c0682-ef02-4251-8aba-b60016f085de_1182x415.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F687c0682-ef02-4251-8aba-b60016f085de_1182x415.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F687c0682-ef02-4251-8aba-b60016f085de_1182x415.png 1456w" sizes="100vw" loading="lazy"/></picture><div></div></div></a><figcaption class="image-caption"><span>Last Block of </span><code>unpack_shellcode</code></figcaption></figure></div><h2 class="header-anchor-post">Decode Function<div class="pencraft pc-display-flex pc-alignItems-center pc-position-absolute pc-reset header-anchor-parent"><div class="pencraft pc-display-contents pc-reset _pubTheme_c2zmd_1"><div id="§decode-function" class="pencraft pc-reset header-anchor offset-top"></div><button tabindex="0" type="button" data-href="https://malwarology.substack.com/i/85422807/decode-function" class="pencraft pc-reset pencraft _iconButton2_bxx6e_689 _iconButtonBase_bxx6e_183 _buttonBase_bxx6e_1 _buttonNew_bxx6e_97 _size_sm_bxx6e_158 _priority_secondary_bxx6e_46"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></button></div></div></h2><div class="captioned-image-container"><figure><a class="image-link image2 is-viewable-img" target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F815bc94f-494e-473b-95df-9d6b84992ac4_1578x1811.png" data-component-name="Image2ToDOM" rel="nofollow ugc noopener"><div class="image2-inset"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F815bc94f-494e-473b-95df-9d6b84992ac4_1578x1811.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F815bc94f-494e-473b-95df-9d6b84992ac4_1578x1811.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F815bc94f-494e-473b-95df-9d6b84992ac4_1578x1811.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F815bc94f-494e-473b-95df-9d6b84992ac4_1578x1811.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F815bc94f-494e-473b-95df-9d6b84992ac4_1578x1811.png" width="578" height="663.3502747252747" data-attrs="{&quot;src&quot;:&quot;https://bucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com/public/images/815bc94f-494e-473b-95df-9d6b84992ac4_1578x1811.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:1671,&quot;width&quot;:1456,&quot;resizeWidth&quot;:578,&quot;bytes&quot;:506937,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null,&quot;isProcessing&quot;:false}" class="sizing-normal" alt srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F815bc94f-494e-473b-95df-9d6b84992ac4_1578x1811.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F815bc94f-494e-473b-95df-9d6b84992ac4_1578x1811.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F815bc94f-494e-473b-95df-9d6b84992ac4_1578x1811.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F815bc94f-494e-473b-95df-9d6b84992ac4_1578x1811.png 1456w" sizes="100vw" loading="lazy"/></picture><div class="image-link-expand"><div class="pencraft pc-display-flex pc-gap-8 pc-reset"><div class="pencraft pc-reset icon-container restack-image"><svg role="img" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke-width="1.8" stroke="#000" xmlns="http://www.w3.org/2000/svg"><g><title></title><path d="M21 3V8M21 8H16M21 8L18 5.29962C16.7056 4.14183 15.1038 3.38328 13.3879 3.11547C11.6719 2.84766 9.9152 3.08203 8.32951 3.79031C6.74382 4.49858 5.39691 5.65051 4.45125 7.10715C3.5056 8.5638 3.00158 10.2629 3 11.9996M3 21V16M3 16H8M3 16L6 18.7C7.29445 19.8578 8.89623 20.6163 10.6121 20.8841C12.3281 21.152 14.0848 20.9176 15.6705 20.2093C17.2562 19.501 18.6031 18.3491 19.5487 16.8925C20.4944 15.4358 20.9984 13.7367 21 12" stroke-linecap="round" stroke-linejoin="round"></path></g></svg></div><div class="pencraft pc-reset icon-container view-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-maximize2"><polyline points="15 3 21 3 21 9"></polyline><polyline points="9 21 3 21 3 15"></polyline><line x1="21" x2="14" y1="3" y2="10"></line><line x1="3" x2="10" y1="21" y2="14"></line></svg></div></div></div></div></a><figcaption class="image-caption">Decode Function (Truncated)</figcaption></figure></div><p><span>The data is decoded in chunks. So this function has three basic purposes: convert the encoded shellcode size to a chunk count by dividing by 8, wrapping a loop around the call to the </span><code>decode_chunk</code><span> function, and then calling that function. In the middle of this function is a very large insertion of dead code wrapped by an opaque predicate. This is highlighted in white in the figure above. It has also been truncated for the screenshot. There are two locations in this function with </span><a href="https://github.com/MBCProject/mbc-markdown/blob/master/anti-static-analysis/executable-code-obfuscation.md#:~:text=analysis%20visually%20harder.-,Junk%20Code%20Insertion,-B0032.007" rel="nofollow ugc noopener">junk code insertion</a><span> which impedes signature development: at addresses </span><code>0x4057c1</code><span> and </span><code>0x4057cc</code><span>.</span></p><p><span>The chunks are 8 bytes long, therefore at the end of the loop after the call to </span><code>decode_chunk</code><span>, 8 is added to the chunk pointer then the chunk count is decremented by one.</span></p><div class="captioned-image-container"><figure><a class="image-link image2" target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F4d353779-4295-445a-b4c5-4f29724bf8fa_1075x267.png" data-component-name="Image2ToDOM" rel="nofollow ugc noopener"><div class="image2-inset"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F4d353779-4295-445a-b4c5-4f29724bf8fa_1075x267.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F4d353779-4295-445a-b4c5-4f29724bf8fa_1075x267.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F4d353779-4295-445a-b4c5-4f29724bf8fa_1075x267.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F4d353779-4295-445a-b4c5-4f29724bf8fa_1075x267.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F4d353779-4295-445a-b4c5-4f29724bf8fa_1075x267.png" width="586" height="145.5460465116279" data-attrs="{&quot;src&quot;:&quot;https://bucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com/public/images/4d353779-4295-445a-b4c5-4f29724bf8fa_1075x267.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:267,&quot;width&quot;:1075,&quot;resizeWidth&quot;:586,&quot;bytes&quot;:70157,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null,&quot;isProcessing&quot;:false}" class="sizing-normal" alt srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F4d353779-4295-445a-b4c5-4f29724bf8fa_1075x267.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F4d353779-4295-445a-b4c5-4f29724bf8fa_1075x267.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F4d353779-4295-445a-b4c5-4f29724bf8fa_1075x267.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F4d353779-4295-445a-b4c5-4f29724bf8fa_1075x267.png 1456w" sizes="100vw" loading="lazy"/></picture><div></div></div></a><figcaption class="image-caption">Chunk Decode Loop Control</figcaption></figure></div><h2 class="header-anchor-post">Decode Chunk Function<div class="pencraft pc-display-flex pc-alignItems-center pc-position-absolute pc-reset header-anchor-parent"><div class="pencraft pc-display-contents pc-reset _pubTheme_c2zmd_1"><div id="§decode-chunk-function" class="pencraft pc-reset header-anchor offset-top"></div><button tabindex="0" type="button" data-href="https://malwarology.substack.com/i/85422807/decode-chunk-function" class="pencraft pc-reset pencraft _iconButton2_bxx6e_689 _iconButtonBase_bxx6e_183 _buttonBase_bxx6e_1 _buttonNew_bxx6e_97 _size_sm_bxx6e_158 _priority_secondary_bxx6e_46"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></button></div></div></h2><div class="captioned-image-container"><figure><a class="image-link image2 is-viewable-img" target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F1af58b00-5530-4369-9a66-fc90ad0debc5_1081x1547.png" data-component-name="Image2ToDOM" rel="nofollow ugc noopener"><div class="image2-inset"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F1af58b00-5530-4369-9a66-fc90ad0debc5_1081x1547.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F1af58b00-5530-4369-9a66-fc90ad0debc5_1081x1547.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F1af58b00-5530-4369-9a66-fc90ad0debc5_1081x1547.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F1af58b00-5530-4369-9a66-fc90ad0debc5_1081x1547.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F1af58b00-5530-4369-9a66-fc90ad0debc5_1081x1547.png" width="508" height="726.9898242368178" data-attrs="{&quot;src&quot;:&quot;https://bucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com/public/images/1af58b00-5530-4369-9a66-fc90ad0debc5_1081x1547.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:1547,&quot;width&quot;:1081,&quot;resizeWidth&quot;:508,&quot;bytes&quot;:326966,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null,&quot;isProcessing&quot;:false}" class="sizing-normal" alt srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F1af58b00-5530-4369-9a66-fc90ad0debc5_1081x1547.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F1af58b00-5530-4369-9a66-fc90ad0debc5_1081x1547.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F1af58b00-5530-4369-9a66-fc90ad0debc5_1081x1547.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F1af58b00-5530-4369-9a66-fc90ad0debc5_1081x1547.png 1456w" sizes="100vw" loading="lazy"/></picture><div class="image-link-expand"><div class="pencraft pc-display-flex pc-gap-8 pc-reset"><div class="pencraft pc-reset icon-container restack-image"><svg role="img" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke-width="1.8" stroke="#000" xmlns="http://www.w3.org/2000/svg"><g><title></title><path d="M21 3V8M21 8H16M21 8L18 5.29962C16.7056 4.14183 15.1038 3.38328 13.3879 3.11547C11.6719 2.84766 9.9152 3.08203 8.32951 3.79031C6.74382 4.49858 5.39691 5.65051 4.45125 7.10715C3.5056 8.5638 3.00158 10.2629 3 11.9996M3 21V16M3 16H8M3 16L6 18.7C7.29445 19.8578 8.89623 20.6163 10.6121 20.8841C12.3281 21.152 14.0848 20.9176 15.6705 20.2093C17.2562 19.501 18.6031 18.3491 19.5487 16.8925C20.4944 15.4358 20.9984 13.7367 21 12" stroke-linecap="round" stroke-linejoin="round"></path></g></svg></div><div class="pencraft pc-reset icon-container view-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-maximize2"><polyline points="15 3 21 3 21 9"></polyline><polyline points="9 21 3 21 3 15"></polyline><line x1="21" x2="14" y1="3" y2="10"></line><line x1="3" x2="10" y1="21" y2="14"></line></svg></div></div></div></div></a><figcaption class="image-caption">Decompiled Decode Chunk Function</figcaption></figure></div><p><span>The </span><code>decode_chunk</code><span> function has four opaque predicates that each wrap dead code, and there are two locations with junk code insertion. In addition to these, the logic of the function is quite convoluted. However, after patching out all of the opaque predicates, dead code, and junk code, a cleaner decompilation graph can be analyzed. The figure above is that graph, fully annotated and cleaned up.</span></p><p><span>There are three tiny functions called during the decoding algorithm: </span><code>load_data_keyB</code><span>, </span><code>add_key4</code><span>, and, </span><code>xor_mix</code><span>. These simply isolate small pieces of the algorithm to impede analysis and make signature development more difficult.</span></p><div class="captioned-image-container"><figure><a class="image-link image2 is-viewable-img" target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F1d2e540c-d4c4-4163-bb9b-d85d529a4b86_1132x890.png" data-component-name="Image2ToDOM" rel="nofollow ugc noopener"><div class="image2-inset"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F1d2e540c-d4c4-4163-bb9b-d85d529a4b86_1132x890.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F1d2e540c-d4c4-4163-bb9b-d85d529a4b86_1132x890.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F1d2e540c-d4c4-4163-bb9b-d85d529a4b86_1132x890.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F1d2e540c-d4c4-4163-bb9b-d85d529a4b86_1132x890.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F1d2e540c-d4c4-4163-bb9b-d85d529a4b86_1132x890.png" width="518" height="407.26148409893995" data-attrs="{&quot;src&quot;:&quot;https://bucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com/public/images/1d2e540c-d4c4-4163-bb9b-d85d529a4b86_1132x890.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:890,&quot;width&quot;:1132,&quot;resizeWidth&quot;:518,&quot;bytes&quot;:199304,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null,&quot;isProcessing&quot;:false}" class="sizing-normal" alt srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F1d2e540c-d4c4-4163-bb9b-d85d529a4b86_1132x890.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F1d2e540c-d4c4-4163-bb9b-d85d529a4b86_1132x890.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F1d2e540c-d4c4-4163-bb9b-d85d529a4b86_1132x890.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F1d2e540c-d4c4-4163-bb9b-d85d529a4b86_1132x890.png 1456w" sizes="100vw" loading="lazy"/></picture><div class="image-link-expand"><div class="pencraft pc-display-flex pc-gap-8 pc-reset"><div class="pencraft pc-reset icon-container restack-image"><svg role="img" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke-width="1.8" stroke="#000" xmlns="http://www.w3.org/2000/svg"><g><title></title><path d="M21 3V8M21 8H16M21 8L18 5.29962C16.7056 4.14183 15.1038 3.38328 13.3879 3.11547C11.6719 2.84766 9.9152 3.08203 8.32951 3.79031C6.74382 4.49858 5.39691 5.65051 4.45125 7.10715C3.5056 8.5638 3.00158 10.2629 3 11.9996M3 21V16M3 16H8M3 16L6 18.7C7.29445 19.8578 8.89623 20.6163 10.6121 20.8841C12.3281 21.152 14.0848 20.9176 15.6705 20.2093C17.2562 19.501 18.6031 18.3491 19.5487 16.8925C20.4944 15.4358 20.9984 13.7367 21 12" stroke-linecap="round" stroke-linejoin="round"></path></g></svg></div><div class="pencraft pc-reset icon-container view-image"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-maximize2"><polyline points="15 3 21 3 21 9"></polyline><polyline points="9 21 3 21 3 15"></polyline><line x1="21" x2="14" y1="3" y2="10"></line><line x1="3" x2="10" y1="21" y2="14"></line></svg></div></div></div></div></a><figcaption class="image-caption">Algorithm Isolates</figcaption></figure></div><h2 class="header-anchor-post">Shift Shellcode OEP Function<div class="pencraft pc-display-flex pc-alignItems-center pc-position-absolute pc-reset header-anchor-parent"><div class="pencraft pc-display-contents pc-reset _pubTheme_c2zmd_1"><div id="§shift-shellcode-oep-function" class="pencraft pc-reset header-anchor offset-top"></div><button tabindex="0" type="button" data-href="https://malwarology.substack.com/i/85422807/shift-shellcode-oep-function" class="pencraft pc-reset pencraft _iconButton2_bxx6e_689 _iconButtonBase_bxx6e_183 _buttonBase_bxx6e_1 _buttonNew_bxx6e_97 _size_sm_bxx6e_158 _priority_secondary_bxx6e_46"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></button></div></div></h2><div class="captioned-image-container"><figure><a class="image-link image2" target="_blank" href="https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fba1a1065-4d5e-499c-a529-9417c7dcd8cf_1064x434.png" data-component-name="Image2ToDOM" rel="nofollow ugc noopener"><div class="image2-inset"><picture><source type="image/webp" srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fba1a1065-4d5e-499c-a529-9417c7dcd8cf_1064x434.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fba1a1065-4d5e-499c-a529-9417c7dcd8cf_1064x434.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fba1a1065-4d5e-499c-a529-9417c7dcd8cf_1064x434.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fba1a1065-4d5e-499c-a529-9417c7dcd8cf_1064x434.png 1456w" sizes="100vw"/><img src="https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fba1a1065-4d5e-499c-a529-9417c7dcd8cf_1064x434.png" width="534" height="217.81578947368422" data-attrs="{&quot;src&quot;:&quot;https://bucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com/public/images/ba1a1065-4d5e-499c-a529-9417c7dcd8cf_1064x434.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:434,&quot;width&quot;:1064,&quot;resizeWidth&quot;:534,&quot;bytes&quot;:115377,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null,&quot;isProcessing&quot;:false}" class="sizing-normal" alt srcset="https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fba1a1065-4d5e-499c-a529-9417c7dcd8cf_1064x434.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fba1a1065-4d5e-499c-a529-9417c7dcd8cf_1064x434.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fba1a1065-4d5e-499c-a529-9417c7dcd8cf_1064x434.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fba1a1065-4d5e-499c-a529-9417c7dcd8cf_1064x434.png 1456w" sizes="100vw" loading="lazy"/></picture><div></div></div></a><figcaption class="image-caption">Shift Shellcode OEP Function</figcaption></figure></div><p><span>The </span><code>shift_shellcode_oep</code><span> function is very simple. It adds </span><code>0x3bf1</code><span> to the address of the start of the decoded shellcode in allocated memory. This shifts the pointer from the start of the decoded data to the offset of the OEP. This is the address that is called in the main function.</span></p><h1 class="header-anchor-post">Recommendations<div class="pencraft pc-display-flex pc-alignItems-center pc-position-absolute pc-reset header-anchor-parent"><div class="pencraft pc-display-contents pc-reset _pubTheme_c2zmd_1"><div id="§recommendations" class="pencraft pc-reset header-anchor offset-top"></div><button tabindex="0" type="button" data-href="https://malwarology.substack.com/i/85422807/recommendations" class="pencraft pc-reset pencraft _iconButton2_bxx6e_689 _iconButtonBase_bxx6e_183 _buttonBase_bxx6e_1 _buttonNew_bxx6e_97 _size_sm_bxx6e_158 _priority_secondary_bxx6e_46"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></button></div></div></h1><p>This packer is polymorphic. Variants and builds share many of the same functionality, behavior, and code features. However, they are in different order with randomization of opaque predicates, junk code, and dead code. In spite of this, detection can be achieved by focusing on the two stretches of stable bytes which were identified above. The following two YARA rules match these bytes.</p><pre><code>rule Packer_pkr_ce1a_ShellcodeSizePart
{
    meta:
        author = &quot;Malwarology LLC&quot;
        date = &quot;2022-10-14&quot;
        description = &quot;Detects bytes surrounding the first part of the data size of the second stage shellcode in Packer pkr_ce1a.&quot;
        reference = &quot;https://malwarology.substack.com/p/malicious-packer-pkr_ce1a&quot;
        sharing = &quot;TLP:CLEAR&quot;
        exemplar = &quot;fc04e80d343f5929aea4aac77fb12485c7b07b3a3d2fc383d68912c9ad0666da&quot;
        address = &quot;0x41cc3c&quot;
        packer = &quot;pkr_ce1a&quot;
    strings:
        $a = { 00699AF974[4]96AACB4600 }
    condition:
        $a and
        uint16(0) == 0x5A4D and
        uint32(uint32(0x3C)) == 0x00004550
}</code></pre><pre><code>rule Packer_pkr_ce1a_ShellcodeAddrPart
{
    meta:
        author = &quot;Malwarology LLC&quot;
        date = &quot;2022-10-17&quot;
        description = &quot;Detects bytes surrounding the first part of the address of the second stage shellcode in Packer pkr_ce1a.&quot;
        reference = &quot;https://malwarology.substack.com/p/malicious-packer-pkr_ce1a&quot;
        sharing = &quot;TLP:CLEAR&quot;
        exemplar = &quot;fc04e80d343f5929aea4aac77fb12485c7b07b3a3d2fc383d68912c9ad0666da&quot;
        address = &quot;0x41bc9c&quot;
        packer = &quot;pkr_ce1a&quot;
    strings:
        $a = { 0094488D6A[4]F2160B6800 }
    condition:
        $a and
        uint16(0) == 0x5A4D and
        uint32(uint32(0x3C)) == 0x00004550
}</code></pre><h1 class="header-anchor-post">Supporting Data and IOCs<div class="pencraft pc-display-flex pc-alignItems-center pc-position-absolute pc-reset header-anchor-parent"><div class="pencraft pc-display-contents pc-reset _pubTheme_c2zmd_1"><div id="§supporting-data-and-iocs" class="pencraft pc-reset header-anchor offset-top"></div><button tabindex="0" type="button" data-href="https://malwarology.substack.com/i/85422807/supporting-data-and-iocs" class="pencraft pc-reset pencraft _iconButton2_bxx6e_689 _iconButtonBase_bxx6e_183 _buttonBase_bxx6e_1 _buttonNew_bxx6e_97 _size_sm_bxx6e_158 _priority_secondary_bxx6e_46"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></button></div></div></h1><h2 class="header-anchor-post">File<div class="pencraft pc-display-flex pc-alignItems-center pc-position-absolute pc-reset header-anchor-parent"><div class="pencraft pc-display-contents pc-reset _pubTheme_c2zmd_1"><div id="§file" class="pencraft pc-reset header-anchor offset-top"></div><button tabindex="0" type="button" data-href="https://malwarology.substack.com/i/85422807/file" class="pencraft pc-reset pencraft _iconButton2_bxx6e_689 _iconButtonBase_bxx6e_183 _buttonBase_bxx6e_1 _buttonNew_bxx6e_97 _size_sm_bxx6e_158 _priority_secondary_bxx6e_46"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></button></div></div></h2><ul><li><p><code>Filename: 6523.exe</code></p></li><li><p><code>Filename: povgwaoci.iwe</code></p></li><li><p><code>MD5: 5663a767ac9d9b9efde3244125509cf3</code></p></li><li><p><code>SHA1: 84f383a3ddb9f073655e1f6383b9c1d015e26524</code></p></li><li><p><code>SHA25: fc04e80d343f5929aea4aac77fb12485c7b07b3a3d2fc383d68912c9ad0666da</code></p></li><li><p><code>Imphash: bc57832ec1fddf960b28fd6e06cc17ba</code></p></li><li><p><code>Timestamp: 2022-02-16T10:14:32Z</code></p></li><li><p><code>File Type: Win32 EXE</code></p></li><li><p><code>Magic: PE32 executable (GUI) Intel 80386, for MS Windows</code></p></li><li><p><code>Size: 238080</code></p></li><li><p><code>First Seen: 2022-10-14T18:37:13Z</code><span class="footnote-hovercard-target"><a class="footnote-anchor" data-component-name="FootnoteAnchorToDOM" id="footnote-anchor-4-85422807" href="https://malwarology.substack.com/p/malicious-packer-pkr_ce1a#footnote-4-85422807" target="_self" rel="nofollow ugc noopener">4</a></span></p></li></ul><h2 class="header-anchor-post">Distribution URL<div class="pencraft pc-display-flex pc-alignItems-center pc-position-absolute pc-reset header-anchor-parent"><div class="pencraft pc-display-contents pc-reset _pubTheme_c2zmd_1"><div id="§distribution-url" class="pencraft pc-reset header-anchor offset-top"></div><button tabindex="0" type="button" data-href="https://malwarology.substack.com/i/85422807/distribution-url" class="pencraft pc-reset pencraft _iconButton2_bxx6e_689 _iconButtonBase_bxx6e_183 _buttonBase_bxx6e_1 _buttonNew_bxx6e_97 _size_sm_bxx6e_158 _priority_secondary_bxx6e_46"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></button></div></div></h2><ul><li><p><code>hxxp[://]guluiiiimnstrannaer[.]net/dl/6523.exe</code></p></li></ul><h2 class="header-anchor-post">Malware Behavior Catalog<div class="pencraft pc-display-flex pc-alignItems-center pc-position-absolute pc-reset header-anchor-parent"><div class="pencraft pc-display-contents pc-reset _pubTheme_c2zmd_1"><div id="§malware-behavior-catalog" class="pencraft pc-reset header-anchor offset-top"></div><button tabindex="0" type="button" data-href="https://malwarology.substack.com/i/85422807/malware-behavior-catalog" class="pencraft pc-reset pencraft _iconButton2_bxx6e_689 _iconButtonBase_bxx6e_183 _buttonBase_bxx6e_1 _buttonNew_bxx6e_97 _size_sm_bxx6e_158 _priority_secondary_bxx6e_46"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></button></div></div></h2><ul><li><p>DEFENSE EVASION::Software Packing [F0001]</p></li><li><p>ANTI-BEHAVIORAL ANALYSIS::Emulator Evasion::Undocumented Opcodes [B0005.002]</p></li><li><p>ANTI-BEHAVIORAL ANALYSIS::Emulator Evasion::Unusual/Undocumented API Calls [B0005.003]</p></li><li><p>ANTI-BEHAVIORAL ANALYSIS::Emulator Evasion::Extra Loops/Time Locks [B0005.004]</p></li><li><p>ANTI-STATIC ANALYSIS::Disassembler Evasion::Argument Obfuscation [B0012.001]</p></li><li><p>ANTI-STATIC ANALYSIS::Disassembler Evasion::Variable Recomposition [B0012.004]</p></li><li><p>ANTI-STATIC ANALYSIS::Executable Code Obfuscation::Dead Code Insertion [B0032.003]</p></li><li><p>ANTI-STATIC ANALYSIS::Executable Code Obfuscation::Junk Code Insertion [B0032.007]</p></li><li><p>ANTI-STATIC ANALYSIS::Executable Code Obfuscation::Interleaving Code [B0032.014]</p></li></ul><h2 class="header-anchor-post">Malware Behavior Catalog Proposed Methods<div class="pencraft pc-display-flex pc-alignItems-center pc-position-absolute pc-reset header-anchor-parent"><div class="pencraft pc-display-contents pc-reset _pubTheme_c2zmd_1"><div id="§malware-behavior-catalog-proposed-methods" class="pencraft pc-reset header-anchor offset-top"></div><button tabindex="0" type="button" data-href="https://malwarology.substack.com/i/85422807/malware-behavior-catalog-proposed-methods" class="pencraft pc-reset pencraft _iconButton2_bxx6e_689 _iconButtonBase_bxx6e_183 _buttonBase_bxx6e_1 _buttonNew_bxx6e_97 _size_sm_bxx6e_158 _priority_secondary_bxx6e_46"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></button></div></div></h2><ul><li><p>ANTI-BEHAVIORAL ANALYSIS::Emulator Evasion::Unimplemented Opcodes [B0005]</p></li><li><p>ANTI-STATIC ANALYSIS::Executable Code Obfuscation::Opaque Predicate [B0032]</p></li><li><p>ANTI-STATIC ANALYSIS::Executable Code Obfuscation::Function Call Obfuscation [B0032]</p></li></ul><h2 class="header-anchor-post">Analyses<div class="pencraft pc-display-flex pc-alignItems-center pc-position-absolute pc-reset header-anchor-parent"><div class="pencraft pc-display-contents pc-reset _pubTheme_c2zmd_1"><div id="§analyses" class="pencraft pc-reset header-anchor offset-top"></div><button tabindex="0" type="button" data-href="https://malwarology.substack.com/i/85422807/analyses" class="pencraft pc-reset pencraft _iconButton2_bxx6e_689 _iconButtonBase_bxx6e_183 _buttonBase_bxx6e_1 _buttonNew_bxx6e_97 _size_sm_bxx6e_158 _priority_secondary_bxx6e_46"><svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></button></div></div></h2><ul><li><p><a href="https://analyze.intezer.com/analyses/4ae9acb6-01f0-4ff5-89bf-c967349e08f9" rel="nofollow ugc noopener">Intezer</a></p></li><li><p><a href="https://www.unpac.me/results/a6d0217d-02c0-4db8-9186-fc0d99137789/" rel="nofollow ugc noopener">UnpacMe</a></p></li></ul><div class="footnote" data-component-name="FootnoteToDOM"><a id="footnote-1-85422807" href="https://malwarology.substack.com/p/malicious-packer-pkr_ce1a#footnote-anchor-1-85422807" class="footnote-number" contenteditable="false" target="_self" rel="nofollow ugc noopener">1</a><div class="footnote-content"><p><a href="https://bazaar.abuse.ch/sample/fc04e80d343f5929aea4aac77fb12485c7b07b3a3d2fc383d68912c9ad0666da#:~:text=Sample%20downloaded%20from" rel="nofollow ugc noopener">Sample downloaded from hxxp[://]guluiiiimnstrannaer[.]net/dl/6523.exe</a></p></div></div><div class="footnote" data-component-name="FootnoteToDOM"><a id="footnote-2-85422807" href="https://malwarology.substack.com/p/malicious-packer-pkr_ce1a#footnote-anchor-2-85422807" class="footnote-number" contenteditable="false" target="_self" rel="nofollow ugc noopener">2</a><div class="footnote-content"><p><code>Imphash: bc57832ec1fddf960b28fd6e06cc17ba</code></p></div></div><div class="footnote" data-component-name="FootnoteToDOM"><a id="footnote-3-85422807" href="https://malwarology.substack.com/p/malicious-packer-pkr_ce1a#footnote-anchor-3-85422807" class="footnote-number" contenteditable="false" target="_self" rel="nofollow ugc noopener">3</a><div class="footnote-content"><p><a href="https://learn.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-localalloc" rel="nofollow ugc noopener">LocalAlloc function (winbase.h)</a></p></div></div><div class="footnote" data-component-name="FootnoteToDOM"><a id="footnote-4-85422807" href="https://malwarology.substack.com/p/malicious-packer-pkr_ce1a#footnote-anchor-4-85422807" class="footnote-number" contenteditable="false" target="_self" rel="nofollow ugc noopener">4</a><div class="footnote-content"><p>VirusTotal</p></div></div></div></div><div class="visibility-check"></div><div class="post-footer"><div class="pencraft pc-display-flex pc-gap-16 pc-paddingTop-16 pc-paddingBottom-16 pc-justifyContent-space-between pc-alignItems-center _flexGrow_1tdk8_338 pc-reset _border-top-detail-themed_1tdk8_47 _border-bottom-detail-themed_1tdk8_50 post-ufi"><div class="pencraft pc-display-flex pc-gap-8 pc-reset"><a role="button" class="post-ufi-button style-button state-disabled no-label with-border"><svg role="img" style="height:20px;width:20px;" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke-width="2" stroke="#000" xmlns="http://www.w3.org/2000/svg" class="icon"><g><title></title><path d="M21 3V8M21 8H16M21 8L18 5.29962C16.7056 4.14183 15.1038 3.38328 13.3879 3.11547C11.6719 2.84766 9.9152 3.08203 8.32951 3.79031C6.74382 4.49858 5.39691 5.65051 4.45125 7.10715C3.5056 8.5638 3.00158 10.2629 3 11.9996M3 21V16M3 16H8M3 16L6 18.7C7.29445 19.8578 8.89623 20.6163 10.6121 20.8841C12.3281 21.152 14.0848 20.9176 15.6705 20.2093C17.2562 19.501 18.6031 18.3491 19.5487 16.8925C20.4944 15.4358 20.9984 13.7367 21 12" stroke-linecap="round" stroke-linejoin="round"></path></g></svg></a></div><div class="pencraft pc-display-flex pc-gap-8 pc-reset"><a role="button" href="javascript:void(0)" aria-label="View share options" class="post-ufi-button style-button no-icon has-label with-border"><div class="label">Share</div></a></div></div></div></div></article></div></div></div><div class="pencraft pc-display-contents pc-reset _pubTheme_c2zmd_1"><div class="single-post-section"><div class="container"><div class="visibility-check"></div><div class="pencraft pc-paddingTop-24 pc-paddingBottom-24 pc-reset"><div class="portable-archive empty-list"><div class="pencraft pc-display-flex pc-paddingLeft-8 pc-paddingRight-8 pc-paddingBottom-16 pc-justifyContent-space-between pc-alignItems-center pc-reset"><div class="pencraft pc-display-flex pc-gap-8 pc-padding-4 pc-position-relative pc-reset _bg-secondary_1tdk8_212 pc-borderRadius-full _segments_18trq_55"><button tabindex="0" type="button" class="pencraft pc-display-flex pc-height-32 pc-paddingLeft-12 pc-paddingRight-12 pc-justifyContent-center pc-alignItems-center pc-reset _bg-unset_1tdk8_265 _animate_1tdk8_232 _cursor-pointer_1tdk8_252 _outline-none_1tdk8_64 _border-unset_1tdk8_21 pc-borderRadius-full _sizing-border-box_1tdk8_385 _showFocus_1tdk8_72 pencraft _segment_18trq_55 _active_18trq_26"><div class="pencraft pc-reset _line-height-20_h3mln_80 _font-text_h3mln_106 _size-14_h3mln_43 _weight-semibold_h3mln_148 _reset_h3mln_1 _segmentText_18trq_65 _active_18trq_26">Top</div></button><button tabindex="0" type="button" class="pencraft pc-display-flex pc-height-32 pc-paddingLeft-12 pc-paddingRight-12 pc-justifyContent-center pc-alignItems-center pc-reset _bg-unset_1tdk8_265 _animate_1tdk8_232 _cursor-pointer_1tdk8_252 _outline-none_1tdk8_64 _border-unset_1tdk8_21 pc-borderRadius-full _sizing-border-box_1tdk8_385 _showFocus_1tdk8_72 pencraft _segment_18trq_55"><div class="pencraft pc-reset _line-height-20_h3mln_80 _font-text_h3mln_106 _size-14_h3mln_43 _weight-semibold_h3mln_148 _reset_h3mln_1 _segmentText_18trq_65">Latest</div></button><div class="pencraft pc-display-flex pc-height-32 pc-boxShadow-sm pc-position-absolute pc-reset _bg-primary_1tdk8_209 pc-borderRadius-full _segmentPill_18trq_80"></div></div><button tabindex="0" type="button" class="pencraft pc-reset pencraft _iconButton2_bxx6e_689 _iconButtonBase_bxx6e_183 _buttonBase_bxx6e_1 _buttonNew_bxx6e_97 _size_md_bxx6e_166 _priority_tertiary_bxx6e_83"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-search"><circle cx="11" cy="11" r="8"></circle><path d="m21 21-4.3-4.3"></path></svg></button></div><div class="portable-archive-list"><p class="portable-archive-empty">No posts</p></div></div></div></div></div><div class="visibility-check"></div><div class="subscribe-footer"><div class="container"><p>Ready for more?</p><div class="pencraft pc-display-flex pc-justifyContent-center pc-reset"><div><div class="_container_11q5m_1"><form action="/api/v1/free?nojs=true" method="post" novalidate class="form _form_11q5m_6"><input type="hidden" name="first_url" value/><input type="hidden" name="first_referrer" value/><input type="hidden" name="current_url"/><input type="hidden" name="current_referrer"/><input type="hidden" name="first_session_url" value/><input type="hidden" name="first_session_referrer" value/><input type="hidden" name="referral_code"/><input type="hidden" name="source" value="subscribe_footer"/><input type="hidden" name="referring_pub_id"/><input type="hidden" name="additional_referring_pub_ids"/><div class="_sideBySideWrap_11q5m_10"><div class="_emailInputWrapper_11q5m_57"><input type="email" name="email" placeholder="Type your email..." class="pencraft _emailInput_11q5m_23 _emailInputOnAccentBackground_11q5m_49"/></div><button tabindex="0" type="submit" class="button rightButton primary subscribe-btn _button_11q5m_76 _buttonOnAccentBackground_11q5m_89"><span class="button-text ">Subscribe</span></button></div><div id="error-container"></div></form></div></div></div></div></div></div></div></div><div class="footer-wrap publication-footer"><div class="visibility-check"></div><div class="footer themed-background"><div class="container"><div class="footer-blurbs"><div class="footer-copyright-blurb">© 2024 Malwarology LLC</div><div class="footer-terms-blurb"><a href="https://substack.com/privacy" target="_blank" rel="noopener noreferrer">Privacy</a><span> ∙ </span><a href="https://substack.com/tos" target="_blank" rel="noopener noreferrer">Terms</a><span> ∙ </span><a href="https://substack.com/ccpa#personal-data-collected" target="_blank" rel="noopener noreferrer">Collection notice</a></div></div><div class="footer-buttons"><a native href="https://substack.com/signup?utm_source=substack&amp;utm_medium=web&amp;utm_content=footer" class="footer-substack-cta start-publishing"><svg role="img" width="1000" height="1000" viewBox="0 0 1000 1000" fill="#FF6719" stroke-width="1.8" stroke="none" xmlns="http://www.w3.org/2000/svg"><g><title></title><path d="M764.166 348.371H236.319V419.402H764.166V348.371Z"></path><path d="M236.319 483.752V813.999L500.231 666.512L764.19 813.999V483.752H236.319Z"></path><path d="M764.166 213H236.319V284.019H764.166V213Z"></path></g></svg> Start Writing</a><a native href="https://substack.com/app/app-store-redirect?utm_campaign=app-marketing&amp;utm_content=web-footer-button" class="footer-substack-cta get-the-app no-icon">Get the app</a></div><div translated class="pencraft pc-reset _reset_h3mln_1 footer-slogan-blurb"><a href="https://substack.com" native>Substack</a> is the home for great culture</div></div></div></div></div><div inert role="dialog" class="modal typography out gone share-dialog popup"><div class="modal-table"><div class="modal-row"><div class="modal-cell modal-content no-fullscreen"><div class="container"><button tabindex="0" type="button" data-testid="close-modal" class="pencraft pc-reset pencraft modal-btn modal-exit-btn no-margin _iconButton2_bxx6e_689 _iconButtonBase_bxx6e_183 _buttonBase_bxx6e_1 _buttonNew_bxx6e_97 _size_md_bxx6e_166 _priority_tertiary_bxx6e_83"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="secondary" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-x"><path d="M18 6 6 18"></path><path d="m6 6 12 12"></path></svg></button><div class="pencraft pc-display-contents pc-reset _pubTheme_c2zmd_1"><div class="pencraft pc-display-contents pc-reset _elevatedTheme_jpget_1"><div class="pencraft pc-display-flex pc-flexDirection-column pc-gap-24 pc-padding-24 pc-reset _bg-primary_1tdk8_209 _border-detail_1tdk8_25 pc-borderRadius-md _container_1xu3k_8"><h4 class="pencraft _flexGrow_1tdk8_338 pc-reset _align-center_h3mln_13 _line-height-24_h3mln_83 _font-display_h3mln_103 _size-20_h3mln_59 _weight-bold_h3mln_151 _reset_h3mln_1">Share</h4><a href class="pencraft pc-display-flex pc-flexDirection-column pc-gap-8 pc-reset _animate_1tdk8_232 _cursor-pointer_1tdk8_252"><div class="pencraft pc-display-contents pc-reset _elevatedTheme_jpget_1"><div tabindex="0" rel="nofollow noopener ugc" target="_blank" draggable="false" class="pencraft pc-display-flex pc-gap-12 pc-padding-12 pc-position-relative pc-reset _bg-primary_1tdk8_209 _animate_1tdk8_232 pc-borderRadius-md _showFocus_1tdk8_72 _postAttachment_1jaic_563"><div class="pencraft pc-display-flex pc-flexDirection-column pc-gap-2 pc-minWidth-0 _flexGrow_1tdk8_338 pc-reset"><div class="pencraft pc-reset _color-primary_h3mln_166 _line-height-20_h3mln_80 _font-text_h3mln_106 _size-15_h3mln_47 _weight-medium_h3mln_145 _clamp_h3mln_254 _clamp-2_h3mln_263 _reset_h3mln_1"></div></div><div class="pencraft pc-display-flex pc-width-64 pc-height-64 pc-justifyContent-center pc-alignItems-center pc-reset _bg-secondary_1tdk8_212 pc-borderRadius-md"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--color-fg-secondary)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-link"><path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path></svg></div></div></div></a><div class="pencraft pc-display-flex pc-flexDirection-column pc-gap-16 pc-reset"><div class="pencraft pc-display-flex pc-justifyContent-space-between pc-reset"><a class="pencraft pc-display-flex pc-flexDirection-column pc-gap-8 pc-width-64 pc-alignItems-center pc-reset _cursor-pointer_1tdk8_252 _button_qtdwu_1"><div class="pencraft pc-display-flex pc-flexDirection-column pc-width-64 pc-height-64 pc-justifyContent-center pc-alignItems-center pc-reset _bg-secondary_1tdk8_212 _animate_1tdk8_232 pc-borderRadius-lg _icon_qtdwu_4"><svg role="img" style="height:20px;width:20px;" width="20" height="20" viewBox="0 0 20 20" fill="none" stroke-width="2" stroke="var(--color-fg-primary)" xmlns="http://www.w3.org/2000/svg"><g><title></title><path d="M7.50008 14.1666H5.83341C4.72835 14.1666 3.66854 13.7276 2.88714 12.9462C2.10573 12.1648 1.66675 11.105 1.66675 9.99992C1.66675 8.89485 2.10573 7.83504 2.88714 7.05364C3.66854 6.27224 4.72835 5.83325 5.83341 5.83325H7.50008M12.5001 5.83325H14.1667C15.2718 5.83325 16.3316 6.27224 17.113 7.05364C17.8944 7.83504 18.3334 8.89485 18.3334 9.99992C18.3334 11.105 17.8944 12.1648 17.113 12.9462C16.3316 13.7276 15.2718 14.1666 14.1667 14.1666H12.5001M6.66675 9.99992H13.3334"></path></g></svg></div><div class="pencraft pc-reset _color-primary_h3mln_166 _line-height-20_h3mln_80 _font-text_h3mln_106 _size-11_h3mln_31 _weight-semibold_h3mln_148 _reset_h3mln_1">Copy link</div></a><a class="pencraft pc-display-flex pc-flexDirection-column pc-gap-8 pc-width-64 pc-alignItems-center pc-reset _cursor-pointer_1tdk8_252 _button_qtdwu_1"><div class="pencraft pc-display-flex pc-flexDirection-column pc-width-64 pc-height-64 pc-justifyContent-center pc-alignItems-center pc-reset _bg-secondary_1tdk8_212 _animate_1tdk8_232 pc-borderRadius-lg _icon_qtdwu_4"><svg role="img" style="height:20px;width:20px;" width="20" height="20" viewBox="0 0 20 20" fill="var(--color-fg-primary)" stroke-width="1.8" stroke="none" xmlns="http://www.w3.org/2000/svg"><g><title></title><path stroke="none" d="M20 10C20 4.47715 15.5229 0 10 0C4.47715 0 0 4.47715 0 10C0 14.9912 3.65684 19.1283 8.4375 19.8785V12.8906H5.89844V10H8.4375V7.79688C8.4375 5.29063 9.93047 3.90625 12.2146 3.90625C13.3084 3.90625 14.4531 4.10156 14.4531 4.10156V6.5625H13.1922C11.95 6.5625 11.5625 7.3334 11.5625 8.125V10H14.3359L13.8926 12.8906H11.5625V19.8785C16.3432 19.1283 20 14.9912 20 10Z"></path></g></svg></div><div class="pencraft pc-reset _color-primary_h3mln_166 _line-height-20_h3mln_80 _font-text_h3mln_106 _size-11_h3mln_31 _weight-semibold_h3mln_148 _reset_h3mln_1">Facebook</div></a><a class="pencraft pc-display-flex pc-flexDirection-column pc-gap-8 pc-width-64 pc-alignItems-center pc-reset _cursor-pointer_1tdk8_252 _button_qtdwu_1"><div class="pencraft pc-display-flex pc-flexDirection-column pc-width-64 pc-height-64 pc-justifyContent-center pc-alignItems-center pc-reset _bg-secondary_1tdk8_212 _animate_1tdk8_232 pc-borderRadius-lg _icon_qtdwu_4"><svg role="img" style="height:20px;width:20px;" width="20" height="20" viewBox="0 0 20 20" fill="var(--color-fg-primary)" stroke-width="1.8" stroke="var(--color-fg-primary)" xmlns="http://www.w3.org/2000/svg"><g><title></title><path stroke="none" d="M9.9958 11.0646C10.2693 11.0646 10.5346 10.9569 10.7915 10.7248L19.0717 3.431C18.6241 3.13262 18.1102 3 17.3974 3H2.60257C1.88976 3 1.37587 3.13262 0.920011 3.431L9.20011 10.7248C9.46534 10.9569 9.73057 11.0646 9.9958 11.0646ZM0.215499 15.9465L6.34893 9.82137L0.198922 4.40075C0.107749 4.5748 0 4.99751 0 5.56941V14.7199C0 15.2503 0.0828842 15.6316 0.215499 15.9465ZM2.35391 17.2892H17.646C18.2511 17.2892 18.7235 17.14 19.0385 16.9245L12.731 10.6171L11.5209 11.6945C11.0402 12.1173 10.518 12.3328 9.9958 12.3328C9.48197 12.3328 8.95975 12.1173 8.47905 11.6945L7.26894 10.6171L0.961455 16.9245C1.27642 17.14 1.74057 17.2892 2.35391 17.2892ZM19.7844 15.9465C19.9088 15.6316 20 15.2503 20 14.7199V5.56941C20 4.99751 19.8922 4.5748 19.8011 4.40075L13.651 9.82137L19.7844 15.9465Z"></path></g></svg></div><div class="pencraft pc-reset _color-primary_h3mln_166 _line-height-20_h3mln_80 _font-text_h3mln_106 _size-11_h3mln_31 _weight-semibold_h3mln_148 _reset_h3mln_1">Email</div></a><a class="pencraft pc-display-flex pc-flexDirection-column pc-gap-8 pc-width-64 pc-alignItems-center pc-reset _cursor-pointer_1tdk8_252 _button_qtdwu_1"><div class="pencraft pc-display-flex pc-flexDirection-column pc-width-64 pc-height-64 pc-justifyContent-center pc-alignItems-center pc-reset _bg-secondary_1tdk8_212 _animate_1tdk8_232 pc-borderRadius-lg _icon_qtdwu_4"><svg role="img" style="height:20px;width:20px;" width="20" height="20" viewBox="0 0 20 20" fill="var(--color-fg-primary)" stroke-width="1.8" stroke="none" xmlns="http://www.w3.org/2000/svg"><g><title></title><path d="M1.96484 0.624512H18.0354V2.70052H1.96484V0.624512Z" stroke="none"></path><path d="M1.96484 4.77655H18.0354V6.85254H1.96484V4.77655Z" stroke="none"></path><path d="M1.96484 8.92857V19.9505L10.0001 14.6347L18.0354 19.9505V8.92857H1.96484Z" stroke="none"></path></g></svg></div><div class="pencraft pc-reset _color-primary_h3mln_166 _line-height-20_h3mln_80 _font-text_h3mln_106 _size-11_h3mln_31 _weight-semibold_h3mln_148 _reset_h3mln_1">Notes</div></a><a id="trigger70001" aria-expanded="false" aria-haspopup="dialog" aria-controls="dialog70002" ariaLabel="View more" class="pencraft pc-display-flex pc-flexDirection-column pc-gap-8 pc-width-64 pc-alignItems-center pc-reset _cursor-pointer_1tdk8_252 _button_qtdwu_1"><div class="pencraft pc-display-flex pc-flexDirection-column pc-width-64 pc-height-64 pc-justifyContent-center pc-alignItems-center pc-reset _bg-secondary_1tdk8_212 _animate_1tdk8_232 pc-borderRadius-lg _icon_qtdwu_4"><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="var(--color-fg-primary)" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-ellipsis"><circle cx="12" cy="12" r="1"></circle><circle cx="19" cy="12" r="1"></circle><circle cx="5" cy="12" r="1"></circle></svg></div><div class="pencraft pc-reset _color-primary_h3mln_166 _line-height-20_h3mln_80 _font-text_h3mln_106 _size-11_h3mln_31 _weight-semibold_h3mln_148 _reset_h3mln_1">More</div></a></div></div></div></div></div></div></div></div></div></div><div style="left:auto;right:16px;bottom:16px;z-index:999;transform:translateY(0px);" class="pencraft pc-position-fixed pc-reset _sizing-border-box_1tdk8_385"></div><div></div>
        </div>

        
            <script src="https://js.sentry-cdn.com/6c2ff3e3828e4017b7faf7b63e24cdf8.min.js" crossorigin="anonymous"></script>
            <script>
                window.Sentry && window.Sentry.onLoad(function() {
                    window.Sentry.init({
                        environment: window._preloads.sentry_environment,
                        dsn: window._preloads.sentry_dsn,
                    })
                })
            </script>
        


        
        
        
        <script>window._preloads        = JSON.parse("{\"isEU\":false,\"language\":\"en\",\"country\":\"BR\",\"base_url\":\"https://malwarology.substack.com\",\"stripe_publishable_key\":\"pk_live_vNnuGHOFnt4mM7V9PuCAAPJz\",\"captcha_site_key\":\"6LdYbsYZAAAAAIFIRh8X_16GoFRLIReh-e-q6qSa\",\"pub\":{\"apple_pay_disabled\":false,\"apex_domain\":null,\"author_id\":97072969,\"byline_images_enabled\":true,\"bylines_enabled\":false,\"chartable_token\":null,\"community_enabled\":false,\"copyright\":\"Malwarology LLC\",\"cover_photo_url\":null,\"created_at\":\"2022-06-22T04:36:57.924Z\",\"custom_domain_optional\":false,\"custom_domain\":null,\"custom_publication_theme_id\":null,\"default_comment_sort\":\"best_first\",\"default_coupon\":null,\"default_group_coupon\":\"11fecce3\",\"default_show_guest_bios\":true,\"email_banner_url\":null,\"email_from_name\":\"Malwarology LLC\",\"email_from\":null,\"embed_tracking_disabled\":false,\"explicit\":false,\"expose_paywall_content_to_search_engines\":false,\"fb_pixel_id\":null,\"fb_site_verification_token\":null,\"flagged_as_spam\":false,\"founding_subscription_benefits\":[\"Advanced member-only posts\"],\"free_subscription_benefits\":[\"Occasional public posts\"],\"ga_pixel_id\":null,\"google_site_verification_token\":null,\"google_tag_manager_token\":null,\"hero_image\":null,\"hero_text\":\"A newsletter about malware reverse engineering, malware analysis, and threat intelligence. This includes formal deep dive reports on malware families, analysis tools and techniques tutorials, and as-it-happens research project progress updates.\",\"hide_intro_subtitle\":null,\"hide_intro_title\":null,\"hide_podcast_feed_link\":false,\"homepage_type\":\"newspaper\",\"id\":947576,\"image_thumbnails_always_enabled\":false,\"invite_only\":false,\"language\":\"en\",\"logo_url_wide\":\"https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fsubstack-post-media.s3.amazonaws.com%2Fpublic%2Fimages%2F65785ab2-dc7b-4d24-8d4a-48c89be5c374_1638x440.png\",\"logo_url\":\"https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Faaa855c0-e07d-47f9-9daa-5cbabdbf5eb3_256x256.png\",\"minimum_group_size\":2,\"moderation_enabled\":true,\"name\":\"Malwarology Research\",\"paid_subscription_benefits\":[\"Subscriber-only posts and full archive\"],\"parsely_pixel_id\":null,\"payments_state\":\"paused\",\"paywall_free_trial_enabled\":false,\"podcast_art_url\":null,\"paid_podcast_episode_art_url\":null,\"podcast_byline\":null,\"podcast_description\":null,\"podcast_enabled\":false,\"podcast_feed_url\":null,\"podcast_title\":null,\"post_preview_limit\":200,\"require_clickthrough\":false,\"rss_feed_url\":null,\"rss_website_url\":null,\"show_pub_podcast_tab\":false,\"show_recs_on_homepage\":true,\"subdomain\":\"malwarology\",\"subscriber_invites\":0,\"support_email\":null,\"theme_var_background_pop\":\"#EA410B\",\"theme_var_color_links\":false,\"theme_var_cover_bg_color\":null,\"trial_end_override\":null,\"twitter_pixel_id\":null,\"type\":\"newsletter\",\"post_reaction_faces_enabled\":true,\"is_personal_mode\":false,\"plans\":null,\"stripe_user_id\":\"acct_1M4ptSAA0eVPwzRj\",\"stripe_country\":\"US\",\"stripe_publishable_key\":\"pk_live_51M4ptSAA0eVPwzRjMnQnjRHRg724ibuzlRJj668Hnf3p3of51nvElyxLkDT2XORG2Kbv07QXPV7eCxEdgXAR4KKI00IdTsGeL6\",\"automatic_tax_enabled\":false,\"author_name\":\"Malwarology LLC\",\"author_handle\":\"malwarology\",\"author_photo_url\":\"https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F2c74d94f-2add-4298-97f6-c9e6bc6bd1c5_2484x2204.png\",\"author_bio\":null,\"twitter_share_on_publish_opt_in\":null,\"has_custom_tos\":false,\"has_custom_privacy\":false,\"theme\":{\"background_pop_color\":\"#2C44A0\",\"web_bg_color\":\"#ffffff\",\"cover_bg_color\":null,\"publication_id\":947576,\"color_links\":null,\"font_preset_heading\":null,\"font_preset_body\":null,\"font_family_headings\":null,\"font_family_body\":null,\"font_family_ui\":null,\"font_size_body_desktop\":null,\"print_secondary\":null,\"custom_css_web\":null,\"custom_css_email\":null,\"home_hero\":\"newspaper\",\"home_posts\":\"list\",\"home_show_top_posts\":false,\"hide_images_from_list\":false,\"home_hero_alignment\":\"left\",\"home_hero_show_podcast_links\":true,\"default_post_header_variant\":null},\"threads_v2_settings\":null,\"default_group_coupon_percent_off\":\"20.00\",\"pause_return_date\":null,\"has_posts\":true,\"has_recommendations\":false,\"first_post_date\":\"2022-11-19T02:28:00.005Z\",\"has_podcast\":false,\"has_free_podcast\":false,\"has_subscriber_only_podcast\":false,\"has_community_content\":false,\"twitter_permissions\":\"none\",\"rankingDetail\":\"Launched 2 years ago\",\"rankingDetailFreeIncluded\":\"Launched 2 years ago\",\"rankingDetailOrderOfMagnitude\":0,\"rankingDetailFreeIncludedOrderOfMagnitude\":10,\"rankingDetailFreeSubscriberCount\":null,\"rankingDetailByLanguage\":{\"de\":{\"rankingDetail\":\"Vor vor 2 Jahren gelauncht\",\"rankingDetailFreeIncluded\":\"Vor vor 2 Jahren gelauncht\",\"rankingDetailOrderOfMagnitude\":0,\"rankingDetailFreeIncludedOrderOfMagnitude\":10,\"rankingDetailFreeSubscriberCount\":null,\"freeSubscriberCount\":null,\"freeSubscriberCountOrderOfMagnitude\":\"84\"},\"es\":{\"rankingDetail\":\"Lanzado hace 2 a\u00F1os\",\"rankingDetailFreeIncluded\":\"Lanzado hace 2 a\u00F1os\",\"rankingDetailOrderOfMagnitude\":0,\"rankingDetailFreeIncludedOrderOfMagnitude\":10,\"rankingDetailFreeSubscriberCount\":null,\"freeSubscriberCount\":null,\"freeSubscriberCountOrderOfMagnitude\":\"84\"},\"fr\":{\"rankingDetail\":\"Lanc\u00E9 il y a 2 ann\u00E9es\",\"rankingDetailFreeIncluded\":\"Lanc\u00E9 il y a 2 ann\u00E9es\",\"rankingDetailOrderOfMagnitude\":0,\"rankingDetailFreeIncludedOrderOfMagnitude\":10,\"rankingDetailFreeSubscriberCount\":null,\"freeSubscriberCount\":null,\"freeSubscriberCountOrderOfMagnitude\":\"84\"},\"pt\":{\"rankingDetail\":\"Lan\u00E7ado 2 anos\",\"rankingDetailFreeIncluded\":\"Lan\u00E7ado 2 anos\",\"rankingDetailOrderOfMagnitude\":0,\"rankingDetailFreeIncludedOrderOfMagnitude\":10,\"rankingDetailFreeSubscriberCount\":null,\"freeSubscriberCount\":null,\"freeSubscriberCountOrderOfMagnitude\":\"84\"},\"pt-br\":{\"rankingDetail\":\"Lan\u00E7ado 2 anos\",\"rankingDetailFreeIncluded\":\"Lan\u00E7ado 2 anos\",\"rankingDetailOrderOfMagnitude\":0,\"rankingDetailFreeIncludedOrderOfMagnitude\":10,\"rankingDetailFreeSubscriberCount\":null,\"freeSubscriberCount\":null,\"freeSubscriberCountOrderOfMagnitude\":\"84\"},\"it\":{\"rankingDetail\":\"Lanciato 2 anni\",\"rankingDetailFreeIncluded\":\"Lanciato 2 anni\",\"rankingDetailOrderOfMagnitude\":0,\"rankingDetailFreeIncludedOrderOfMagnitude\":10,\"rankingDetailFreeSubscriberCount\":null,\"freeSubscriberCount\":null,\"freeSubscriberCountOrderOfMagnitude\":\"84\"},\"en\":{\"rankingDetail\":\"Launched 2 years ago\",\"rankingDetailFreeIncluded\":\"Launched 2 years ago\",\"rankingDetailOrderOfMagnitude\":0,\"rankingDetailFreeIncludedOrderOfMagnitude\":10,\"rankingDetailFreeSubscriberCount\":null,\"freeSubscriberCount\":null,\"freeSubscriberCountOrderOfMagnitude\":\"84\"}},\"freeSubscriberCount\":null,\"freeSubscriberCountOrderOfMagnitude\":\"84\",\"author_bestseller_tier\":0,\"disable_monthly_subscriptions\":false,\"disable_annual_subscriptions\":false,\"hide_post_restacks\":false,\"notes_feed_enabled\":false,\"last_chat_post_at\":null,\"no_follow\":true,\"paywall_chat\":\"free\",\"sections\":[],\"multipub_migration\":null,\"navigationBarItems\":[],\"contributors\":[{\"name\":\"Malwarology LLC\",\"handle\":\"malwarology\",\"role\":\"admin\",\"owner\":true,\"user_id\":97072969,\"photo_url\":\"https://bucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com/public/images/2c74d94f-2add-4298-97f6-c9e6bc6bd1c5_2484x2204.png\",\"bio\":null}],\"threads_v2_enabled\":false,\"viralGiftsConfig\":{\"id\":\"9daadccb-4e7a-491c-8c77-4e95cbf8bcec\",\"publication_id\":947576,\"enabled\":false,\"gifts_per_user\":5,\"gift_length_months\":1,\"send_extra_gifts\":true,\"message\":\"A substack by Malwarology LLC\",\"created_at\":\"2022-11-16T18:11:03.82721+00:00\",\"updated_at\":\"2022-11-16T18:11:03.82721+00:00\",\"days_til_invite\":14,\"send_emails\":true,\"show_link\":null,\"grant_email_body\":\"{\\\"type\\\":\\\"doc\\\",\\\"content\\\":[{\\\"type\\\":\\\"paragraph\\\",\\\"content\\\":[{\\\"type\\\":\\\"text\\\",\\\"text\\\":\\\"Dear reader,\\\"}]},{\\\"type\\\":\\\"paragraph\\\",\\\"content\\\":[{\\\"type\\\":\\\"text\\\",\\\"text\\\":\\\"Thank you for being a member of the Malwarology Research community. As a paying subscriber, you\u2019ve helped make Malwarology Research what it is today.\\\"}]},{\\\"type\\\":\\\"paragraph\\\",\\\"content\\\":[{\\\"type\\\":\\\"text\\\",\\\"text\\\":\\\"As a thank you, you now have three FREE 1-month gift subscriptions to give to family and friends (usual value = $120). Know someone who might love Malwarology Research? Click on the link below to share one of your gift subscriptions with them.\\\"}]},{\\\"type\\\":\\\"button\\\",\\\"attrs\\\":{\\\"url\\\":\\\"%%grant_gift_url%%\\\",\\\"text\\\":\\\"Give a subscription\\\",\\\"action\\\":null,\\\"class\\\":\\\"left\\\"}},{\\\"type\\\":\\\"paragraph\\\",\\\"content\\\":[{\\\"type\\\":\\\"text\\\",\\\"text\\\":\\\"Thanks again for reading and sharing Malwarology Research!\\\"}]}]}\",\"grant_email_subject\":\"Malwarology Research subscriptions for you to give away\"},\"tier\":1,\"no_index\":false,\"can_set_google_site_verification\":false,\"can_have_sitemap\":false,\"founding_plan_name_english\":\"Advanced Member\",\"draft_plans\":[{\"id\":\"yearly80usd\",\"object\":\"plan\",\"active\":true,\"aggregate_usage\":null,\"amount\":8000,\"amount_decimal\":\"8000\",\"billing_scheme\":\"per_unit\",\"created\":1669215967,\"currency\":\"usd\",\"interval\":\"year\",\"interval_count\":1,\"livemode\":true,\"metadata\":{\"substack\":\"yes\"},\"meter\":null,\"nickname\":\"$80 a year\",\"product\":\"prod_Mr2bUrzZr6eqcR\",\"tiers\":null,\"tiers_mode\":null,\"transform_usage\":null,\"trial_period_days\":null,\"usage_type\":\"licensed\",\"currency_options\":{\"aud\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":12500,\"unit_amount_decimal\":\"12500\"},\"brl\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":45500,\"unit_amount_decimal\":\"45500\"},\"cad\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":11000,\"unit_amount_decimal\":\"11000\"},\"chf\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":7500,\"unit_amount_decimal\":\"7500\"},\"dkk\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":56000,\"unit_amount_decimal\":\"56000\"},\"eur\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":7500,\"unit_amount_decimal\":\"7500\"},\"gbp\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":6500,\"unit_amount_decimal\":\"6500\"},\"mxn\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":147500,\"unit_amount_decimal\":\"147500\"},\"nok\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":85500,\"unit_amount_decimal\":\"85500\"},\"nzd\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":13500,\"unit_amount_decimal\":\"13500\"},\"pln\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":32500,\"unit_amount_decimal\":\"32500\"},\"sek\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":85000,\"unit_amount_decimal\":\"85000\"},\"usd\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":8000,\"unit_amount_decimal\":\"8000\"}}},{\"id\":\"monthly8usd\",\"object\":\"plan\",\"active\":true,\"aggregate_usage\":null,\"amount\":800,\"amount_decimal\":\"800\",\"billing_scheme\":\"per_unit\",\"created\":1669215967,\"currency\":\"usd\",\"interval\":\"month\",\"interval_count\":1,\"livemode\":true,\"metadata\":{\"substack\":\"yes\"},\"meter\":null,\"nickname\":\"$8 a month\",\"product\":\"prod_Mr2bKRPUanFJAY\",\"tiers\":null,\"tiers_mode\":null,\"transform_usage\":null,\"trial_period_days\":null,\"usage_type\":\"licensed\",\"currency_options\":{\"aud\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":1300,\"unit_amount_decimal\":\"1300\"},\"brl\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":4600,\"unit_amount_decimal\":\"4600\"},\"cad\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":1100,\"unit_amount_decimal\":\"1100\"},\"chf\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":800,\"unit_amount_decimal\":\"800\"},\"dkk\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":6000,\"unit_amount_decimal\":\"6000\"},\"eur\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":800,\"unit_amount_decimal\":\"800\"},\"gbp\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":700,\"unit_amount_decimal\":\"700\"},\"mxn\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":15000,\"unit_amount_decimal\":\"15000\"},\"nok\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":9000,\"unit_amount_decimal\":\"9000\"},\"nzd\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":1400,\"unit_amount_decimal\":\"1400\"},\"pln\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":3300,\"unit_amount_decimal\":\"3300\"},\"sek\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":8500,\"unit_amount_decimal\":\"8500\"},\"usd\":{\"custom_unit_amount\":null,\"tax_behavior\":\"unspecified\",\"unit_amount\":800,\"unit_amount_decimal\":\"800\"}}},{\"id\":\"founding15000usd\",\"name\":\"founding15000usd\",\"nickname\":\"founding15000usd\",\"active\":true,\"amount\":15000,\"currency\":\"usd\",\"interval\":\"year\",\"interval_count\":1,\"metadata\":{\"substack\":\"yes\",\"founding\":\"yes\",\"no_coupons\":\"yes\",\"short_description\":\"Advanced Member\",\"short_description_english\":\"Advanced Member\",\"minimum\":\"15000\",\"minimum_local\":{\"aud\":24000,\"brl\":92000,\"cad\":21500,\"chf\":13500,\"dkk\":107000,\"eur\":14500,\"gbp\":12000,\"mxn\":303000,\"nok\":168000,\"nzd\":26500,\"pln\":61500,\"sek\":164500,\"usd\":15000}},\"currency_options\":{\"aud\":{\"unit_amount\":24000,\"tax_behavior\":\"unspecified\"},\"brl\":{\"unit_amount\":92000,\"tax_behavior\":\"unspecified\"},\"cad\":{\"unit_amount\":21500,\"tax_behavior\":\"unspecified\"},\"chf\":{\"unit_amount\":13500,\"tax_behavior\":\"unspecified\"},\"dkk\":{\"unit_amount\":107000,\"tax_behavior\":\"unspecified\"},\"eur\":{\"unit_amount\":14500,\"tax_behavior\":\"unspecified\"},\"gbp\":{\"unit_amount\":12000,\"tax_behavior\":\"unspecified\"},\"mxn\":{\"unit_amount\":303000,\"tax_behavior\":\"unspecified\"},\"nok\":{\"unit_amount\":168000,\"tax_behavior\":\"unspecified\"},\"nzd\":{\"unit_amount\":26500,\"tax_behavior\":\"unspecified\"},\"pln\":{\"unit_amount\":61500,\"tax_behavior\":\"unspecified\"},\"sek\":{\"unit_amount\":164500,\"tax_behavior\":\"unspecified\"},\"usd\":{\"unit_amount\":15000,\"tax_behavior\":\"unspecified\"}}}],\"base_url\":\"https://malwarology.substack.com\",\"hostname\":\"malwarology.substack.com\",\"is_on_substack\":false,\"spotify_podcast_settings\":null,\"podcastPalette\":{\"DarkMuted\":{\"population\":72,\"rgb\":[73,153,137]},\"DarkVibrant\":{\"population\":6013,\"rgb\":[4,100,84]},\"LightMuted\":{\"population\":7,\"rgb\":[142,198,186]},\"LightVibrant\":{\"population\":3,\"rgb\":[166,214,206]},\"Muted\":{\"population\":6,\"rgb\":[92,164,156]},\"Vibrant\":{\"population\":5,\"rgb\":[76,164,146]}},\"pageThemes\":{\"podcast\":null},\"live_subscriber_counts\":false,\"subscribeCardVersionHash\":\"417eee62cc6679bdefb863059e10424a\"},\"confirmedLogin\":false,\"hide_intro_popup\":false,\"block_auto_login\":false,\"domainInfo\":{\"isSubstack\":true,\"customDomain\":null},\"experimentFeatures\":{},\"experimentExposures\":{},\"siteConfigs\":{\"score_upsell_email\":\"control\",\"first_chat_email_enabled\":true,\"notes_video_max_duration_minutes\":5,\"reader-onboarding-promoted-pub\":737237,\"pub_creation_captcha_behavior\":\"risky_pubs\",\"new_commenter_approval\":false,\"pub_update_opennode_api_key\":false,\"embedding_search_using_quantized_field\":false,\"zendesk_automation_cancellations\":false,\"hide_book_a_meeting_button\":false,\"mfa_action_box_enabled\":false,\"publication_max_bylines\":35,\"no_contest_charge_disputes\":false,\"new_subscription_management\":false,\"publication_tabs_reorder\":false,\"comp_expiry_email_new_copy\":\"NONE\",\"free_unlock_required\":false,\"traffic_rule_check_enabled\":false,\"amp_emails_enabled\":false,\"enable_post_summarization\":false,\"image_deep_link_enabled\":false,\"bitcoin_enabled\":false,\"show_entire_square_image\":false,\"hide_subscriber_count\":false,\"publication_author_display_override\":\"\",\"custom_themes_substack_player_for_video_embeds\":false,\"generate_pdf_tax_report\":false,\"show_generic_post_importer\":false,\"enable_pledges_modal\":true,\"include_pdf_invoice\":false,\"app_upsell_after_posting_notes\":\"experiment\",\"platform_searcher_enabled\":false,\"free_signup_notification_strategy\":\"experiment\",\"use_post_podcast_import_batching\":true,\"meetings_v1\":false,\"live_stream_share_override_pub_id\":0,\"exempt_from_gtm_filter\":false,\"group_sections_and_podcasts_in_menu\":false,\"boost_optin_modal_enabled\":true,\"upload_to_youtube\":true,\"post_blogspot_importer\":false,\"enable_chat_post_editing\":true,\"pub_tts_override\":\"default\",\"disable_monthly_subscriptions\":false,\"skip_welcome_email\":false,\"chat_reader_thread_notification_default\":false,\"scheduled_pinned_posts\":false,\"disable_redirect_outbound_utm_params\":false,\"reader_gift_referrals_enabled\":true,\"enable_bestseller_survey_modal\":false,\"dont_show_guest_byline\":false,\"like_comments_enabled\":true,\"thefp_disable_wallets\":false,\"enable_author_note_email_toggle\":false,\"meetings_embed_publication_name\":false,\"livekit_track_egress_custom_base_url\":\"http://livekit-egress-custom-recorder-participant-test.s3-website-us-east-1.amazonaws.com\",\"people_you_may_know_algorithm\":\"experiment\",\"show_note_stats\":false,\"welcome_screen_blurb_override\":\"\",\"post_recipients_batch_limit\":1000,\"like_posts_enabled\":true,\"notes_publication_mentions_enabled\":false,\"twitter_player_card_enabled\":true,\"show_app_upsell_subscribe_flow\":true,\"feed_promoted_user\":false,\"writer_beta_android_enable_post_editor_v2\":false,\"show_note_stats_for_all_notes\":false,\"section_specific_csv_imports_enabled\":false,\"custom_themes_free_press_custom_paywall\":false,\"bypass_profile_substack_logo_detection\":false,\"use_preloaded_player_sources\":false,\"generate_twitter_card_with_lamda\":false,\"list_pruning_enabled\":false,\"facebook_connect\":false,\"opt_in_to_sections_during_subscribe\":false,\"underlined_colored_links\":false,\"temporal_livestream_ended_draft\":false,\"max_image_upload_mb\":32,\"modal_rec_variant_user\":\"control\",\"extract_stripe_receipt_url\":false,\"enable_android_dms_writer_beta\":false,\"threads_suggested_ios_version\":null,\"pledges_disabled\":false,\"threads_minimum_ios_version\":812,\"hide_podcast_email_setup_link\":false,\"subscribe_captcha_behavior\":\"default\",\"publication_ban_sample_rate\":0,\"grant_viral_gifts_to_gift_recipients\":\"experiment\",\"show_lives_in_election_tab\":false,\"custom_themes_substack_subscribe_modal\":false,\"share_viral_gift_as_link\":\"experiment\",\"continue_support_cta_in_newsletter_emails\":false,\"bloomberg_syndication_enabled\":false,\"custom_publication_theme\":false,\"lists_enabled\":false,\"generated_database_maintenance_mode\":false,\"allow_document_freeze\":false,\"podcast_main_feed_is_firehose\":false,\"pub_app_incentive_gift\":\"\",\"no_embed_redirect\":false,\"translate_mobile_app\":false,\"customized_email_from_name_for_new_follow_emails\":\"treatment\",\"spotify_open_access_sandbox_mode\":false,\"fullstory_enabled\":false,\"chat_reply_poll_interval\":3,\"enable_reader_marketing_page\":false,\"force_pub_links_to_use_subdomain\":false,\"email_existing_users_on_import\":false,\"always_show_cookie_banner\":false,\"hide_media_download_option\":false,\"twitter_figures_enabled\":false,\"hide_post_restacks\":false,\"feed_item_source_debug_mode\":false,\"writer_beta_android_enable_post_editor\":false,\"allow_multiple_feed_post_impressions\":\"control\",\"daily_promoted_notes_enabled\":true,\"publication_homepage_title_display_override\":\"\",\"pub_banned_word_list\":\"\",\"post_preview_highlight_byline\":false,\"4k_video\":false,\"custom_themes_substack_video_player\":false,\"bypass_unlock_token_limit\":false,\"post_metering_enabled\":false,\"notifications_disabled\":\"\",\"cross_post_notification_threshold\":1000,\"facebook_connect_prod_app\":true,\"messages_inbox_page_size\":50,\"minimum_android_version\":756,\"feed_main_disabled\":false,\"enable_transcription_translations\":false,\"use_og_image_as_twitter_image_for_post_previews\":false,\"always_use_podcast_channel_art_as_episode_art_in_rss\":false,\"cookie_preference_middleware_enabled\":false,\"seo_tier_override\":\"NONE\",\"no_follow_links\":false,\"publisher_api_enabled\":false,\"zendesk_support_priority\":\"default\",\"enable_subscriber_referrals_awards\":true,\"onboarding_pymk_ranking\":false,\"show_substack_funded_gifts_tooltip\":true,\"enable_thefp_theme_emails\":false,\"thread_permalink_preview_min_ios_version\":4192,\"post_management_search_engine\":\"elasticsearch\",\"enable_thefp_theme_comments\":false,\"internal_android_enable_post_editor\":false,\"web_reader_podcasts_tab\":false,\"phone_verification_fallback_to_twilio\":true,\"send_as_email_reply_bar\":\"experiment\",\"live_stream_creation_enabled\":false,\"disable_card_element_in_europe\":false,\"enable_global_navigation_ios_beta\":false,\"enable_web_typing_indicators\":false,\"custom_themes_substack_audio_player\":false,\"web_vitals_sample_rate\":0,\"allow_live_stream_auto_takedown\":\"true\",\"skip_twitter_step_in_writer_onboarding\":true,\"temporal_zync_post_editor\":false,\"enable_related_posts\":false,\"use_ranker_for_category_tabs\":false,\"ai_image_generation_enabled\":true,\"disable_personal_substack_initialization\":false,\"section_specific_welcome_pages\":false,\"local_payment_methods\":\"control\",\"feed_post_score_scale_factor\":0.1,\"posts_in_rss_feed\":20,\"post_rec_endpoint\":\"\",\"publisher_dashboard_section_selector\":false,\"reader_surveys_platform_question_order\":\"36,1,4,2,3,5,6,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35\",\"negative_feedback_in_onboarding\":\"experiment\",\"login_guard_app_link_in_email\":true,\"modal_rec_variant_content\":\"control\",\"monthly_sub_is_one_off\":false,\"unread_notes_activity_digest\":\"control\",\"display_cookie_settings\":false,\"welcome_page_query_params\":false,\"enable_mobile_publication_setup\":false,\"enable_free_podcast_urls\":false,\"enable_thefp_theme_posts\":false,\"disable_truncated_pub_roles\":false,\"use_microlink_for_instagram_embeds\":false,\"post_notification_batch_delay_ms\":30000,\"social_context_in_pymk_feed_module_v2\":\"treatment-nofacepile\",\"ios_post_stats_for_admins\":false,\"live_stream_concurrent_viewer_count_drawer\":false,\"section_specific_preambles\":false,\"android_live_stream_multihost_enabled\":false,\"show_menu_on_posts\":false,\"app_upsell_follow_prompt\":\"control\",\"trust_and_safety_features_enabled\":false,\"free_signup_confirmation_behavior\":\"with_email_validation\",\"opt_into_all_trending_topics\":false,\"ios_writer_stats_public_launch_v2\":false,\"enable_android_post_stats\":false,\"ios_chat_revamp_enabled\":false,\"post_notification_batch_chunk_size\":100,\"republishing_enabled\":false,\"app_mode\":false,\"show_phone_banner\":false,\"enable_tts_web\":false,\"enable_author_pages\":false,\"enable_decagon_chat\":true,\"first_month_upsell\":\"control\",\"twitter_connect_flows_enabled\":false,\"live_stream_creation_from_desktop_enabled\":true,\"enable_user_contacts\":true,\"gift_post_unlocks_recipient_2\":\"experiment\",\"live_stream_invite_ttl_seconds\":300,\"welcome_page_update_desktop_visuals_limited\":\"experiment\",\"rss_verification_code\":\"\",\"notification_post_emails\":\"experiment\",\"pin_primary_publication_chat_ios_v2\":\"treatment_thread_list\",\"chat_suppress_contributor_push_option_enabled\":false,\"rate_limit_live_reaction_messages_v2\":\"15ps\",\"custom_themes_free_press_newsletters_page\":false,\"export_hooks_enabled\":false,\"audio_encoding_bitrate\":null,\"bestseller_pub_override\":false,\"extra_seats_coupon_type\":false,\"post_subdomain_universal_links\":false,\"post_import_max_file_size\":26214400,\"livekit_reconnect_slate_url\":\"https://mux-livestream-assets.s3.us-east-1.amazonaws.com/custom-disconnect-slate-tall.png\",\"exclude_from_pymk_suggestions\":false,\"minimum_ios_version\":2200,\"disable_annual_subscriptions\":false,\"enable_bestseller_survey_modal_override\":false,\"android_feed_image_carousel\":\"control\",\"enable_android_dms\":false,\"non_mfa_password_login_guard\":\"block_suspicious\",\"feed_ranker_use_user_comment_reaction_cache\":true,\"enable_tabbed_notes_search\":false,\"ios_feed_layout_v2_beta\":false,\"web_feed_more_like_this\":false,\"recipes_enabled\":false,\"disable_deletion\":false,\"livekit_egress_custom_base_url\":\"http://livekit-egress-custom-recorder.s3-website-us-east-1.amazonaws.com\",\"clip_focused_video_upload_flow\":false,\"live_stream_max_guest_users\":2,\"unitary_image_moderation_percent\":100,\"can_reimport_unsubscribed_users_with_2x_optin\":false,\"feed_posts_negative_weight_pct\":500,\"included_in_demo_feed\":false,\"live_event_mixin\":\"\",\"review_incoming_email\":\"default\",\"app_install_prompts\":\"native_banner_if_supported\",\"ios_chat_uikit\":false,\"recent_notes_boost\":0,\"thread_permalink_preview_min_android_version\":2037,\"enable_home_screen_nav_bar_hiding_ios\":false,\"notes_implicit_engagement_weight_pct\":1,\"publisher_banner\":\"\",\"load_test_unichat\":false,\"enable_video_seo_data\":true,\"phone_verification_banned_countries\":\"PH, BD, UA, PK, UZ, ID, MA, KG, ML, AZ, GT, SN, BZ, EG, MM, MX, VN, ZW, NG, JO, RU, MY, KE, CN\",\"enable_small_queue_cards_ios\":true,\"show_open_post_as_pdf_button\":false,\"free_press_combo_subscribe_flow_enabled\":false,\"restack_with_image\":false,\"enable_bluesky_embeds\":false,\"gift_from_substack_modal\":\"experiment\",\"extended_podcast_episode_metadata\":true,\"gifts_from_substack_feature_available\":true,\"enable_css_layers\":false,\"blocked_email_domains\":\"nastyx.com,heweek.com,marchub.com,wesolar.io,cetnob.com,asaud.com,sigmazon.com,ofionk.com,degcos.com,janfab.com,obisims.com,esterace.com,barakal.com,coloruz.com,rogtat.com,ploncy.com,konetas.com,pelagius.net,teeuk.com,laafd.com,vjuum.com,txcct.com,rteet.com,dpptd.com,funvahnuwa.com,btcmod.com\",\"accept_gift_home_header_enabled\":false,\"app_install_reminder_email\":\"experiment\",\"enable_apple_news_sync\":false,\"postsById_batch_size\":20,\"banned_image_generation_word_list\":\"nude, naked, unclothed, undressed, withoutclothes, sex, sexy, erotic, topless, bottomless, barechest, barebody, scantilyclad, suggestive, lingerie, bikini, underwear, panties, bra, thong, porn, pornographic, provocative, orgy, fetish, kinky, bdsm, domination, submission, lewd, explicit, genitals, penis, vagina, buttocks, anus, breasts, nipples, areola, privateparts, crotch, pubicarea, thighgap, intercourse, masturbation, ejaculation, penetration, moaning, groping, fondling, exposing, stripping, flashing, adultcontent, XXX, NSFW, OnlyFans, camgirl, escort, prostitute, callgirl, massage, striptease, ass, busty, strip, stripclub, tits, spanking, pawg, bimbo, crotch, succubus, seductive\",\"thefp_show_sections\":false,\"web_otp_login\":\"experiment\",\"holiday_gifting_post_header\":\"experiment\",\"enable_subscription_push_for_non_quickstart\":true,\"enable_activity_drawer\":true},\"publicationSettings\":{\"block_ai_crawlers\":false,\"credit_token_enabled\":false,\"custom_tos_and_privacy\":false,\"did_identity\":null,\"disable_optimistic_bank_payments\":false,\"display_welcome_page_details\":true,\"enable_meetings\":false,\"payment_pledges_enabled\":false,\"enable_post_page_conversion\":true,\"enable_prev_next_nav\":false,\"enable_restacking\":true,\"gifts_from_substack_disabled\":false,\"google_analytics_4_token\":null,\"group_sections_and_podcasts_in_menu_enabled\":false,\"medium_length_description\":\"\",\"notes_feed_enabled\":false,\"paywall_unlock_tokens\":false,\"post_preview_crop_gravity\":\"center\",\"reader_referrals_enabled\":false,\"reader_referrals_leaderboard_enabled\":false,\"seen_coming_soon_explainer\":false,\"seen_google_analytics_migration_modal\":false,\"local_currency_modal_seen\":true,\"local_payment_methods_modal_seen\":false,\"twitter_pixel_signup_event_id\":null,\"twitter_pixel_subscribe_event_id\":null,\"use_local_currency\":true,\"welcome_page_opt_out_text\":\"No thanks\",\"cookie_settings\":\"\",\"show_restacks_below_posts\":true,\"holiday_gifting_post_header\":false,\"homepage_message_text\":\"\",\"homepage_message_link\":\"\"},\"publicationUserSettings\":null,\"userSettings\":{\"user_id\":null,\"activity_likes_enabled\":true,\"hasDismissedSectionToNewsletterRename\":false,\"is_guest_post_enabled\":true,\"feed_web_nux_seen_at\":null,\"has_seen_select_to_restack_tooltip_nux\":false,\"invite_friends_nux_dismissed_at\":null,\"suggestions_feed_item_last_shown_at\":null,\"has_seen_select_to_restack_modal\":false,\"last_home_tab\":null,\"last_notification_alert_shown_at\":null,\"disable_reply_hiding\":false,\"newest_seen_chat_item_published_at\":null,\"explicitContentEnabled\":false,\"contactMatchingEnabled\":false,\"messageRequestLevel\":\"everyone\",\"liveStreamAcceptableInviteLevel\":\"everyone\",\"liveStreamAcceptableChatLevel\":\"everyone\",\"creditTokensTreatmentExposed\":false,\"appBadgeIncludesChat\":false,\"autoPlayVideo\":true,\"smart_delivery_enabled\":false,\"chatbotTermsLastAcceptedAt\":null,\"has_seen_notes_post_app_upsell\":false,\"substack_summer_nux_dismissed_at\":null,\"first_note_id\":null,\"show_concurrent_live_stream_viewers\":false},\"subscriberCountDetails\":null,\"mux_env_key\":\"u42pci814i6011qg3segrcpp9\",\"sentry_environment\":\"production\",\"launchWelcomePage\":false,\"noIndex\":false,\"post\":{\"audience\":\"everyone\",\"audience_before_archived\":null,\"canonical_url\":\"https://malwarology.substack.com/p/malicious-packer-pkr_ce1a\",\"default_comment_sort\":null,\"editor_v2\":false,\"exempt_from_archive_paywall\":false,\"free_unlock_required\":false,\"id\":85422807,\"podcast_art_url\":null,\"podcast_duration\":null,\"podcast_preview_upload_id\":null,\"podcast_upload_id\":null,\"podcast_url\":\"\",\"post_date\":\"2022-11-19T02:28:00.005Z\",\"publication_id\":947576,\"search_engine_description\":null,\"search_engine_title\":null,\"section_id\":null,\"should_send_free_preview\":false,\"show_guest_bios\":true,\"slug\":\"malicious-packer-pkr_ce1a\",\"social_title\":null,\"subtitle\":\"First Stage\",\"teaser_post_eligible\":true,\"title\":\"Malicious Packer pkr_ce1a\",\"type\":\"newsletter\",\"video_upload_id\":null,\"write_comment_permissions\":\"only_paid\",\"restacks\":0,\"reactions\":{\"\u2764\":0},\"top_exclusions\":[],\"pins\":[],\"section_pins\":[],\"previous_post_slug\":null,\"next_post_slug\":\"non-standard-version-information\",\"cover_image\":\"https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc0688009-9c87-4d72-95de-6e40b6e0b8bf_987x400.png\",\"cover_image_is_square\":false,\"cover_image_is_explicit\":false,\"videoUpload\":null,\"podcastFields\":null,\"podcastUpload\":null,\"podcastPreviewUpload\":null,\"voiceover_upload_id\":null,\"voiceoverUpload\":null,\"has_voiceover\":false,\"description\":\"First Stage\",\"body_html\":\"<h1>Summary</h1><p>This <a href=\\\"https://github.com/MBCProject/mbc-markdown/blob/master/anti-static-analysis/software-packing.md\\\">packer</a> has been observed delivering a wide variety of malware families including <a href=\\\"https://malpedia.caad.fkie.fraunhofer.de/details/win.smokeloader\\\">SmokeLoader</a> and <a href=\\\"https://malpedia.caad.fkie.fraunhofer.de/details/win.vidar\\\">Vidar</a> among many others. It has been observed in the wild going back a number of years potentially to 2017. The particular variant of the packer analyzed here contains two sets of bytes with no apparent use which occur on either side of values that are integral to the decoding and unpacking process. These two byte strings are stable across many months of observed samples of this packer. What follows is a detailed analysis of the first stage of one sample of this packer which delivers a SmokeLoader payload. Until a widely recognized name or identifier can be determined for this packer, it has the designation <code>pkr_ce1a</code>.</p><h1>Identification</h1><p>This sample has two known filenames. The first, <code>6523.exe</code>, is observed in the wild in the path component of the URL used to distribute the file.<a class=\\\"footnote-anchor\\\" data-component-name=\\\"FootnoteAnchorToDOM\\\" id=\\\"footnote-anchor-1\\\" href=\\\"#footnote-1\\\" target=\\\"_self\\\">1</a> The second, <code>povgwaoci.iwe</code>, is located in the <code>RT_VERSION</code> resource within the <code>VS_VERSIONINFO</code> structure in a field named <code>InternationalName</code>. This field along with others in the same StringTable structure are not parsed by <a href=\\\"https://exiftool.org/\\\">Exiftool</a> or <a href=\\\"https://cerbero.io/ea/\\\">Cerbero Suite</a>. This indicates that the structure is malformed or non-standard.</p><div class=\\\"subscription-widget-wrap-editor\\\" data-attrs=\\\"{&quot;url&quot;:&quot;https://malwarology.substack.com/subscribe?&quot;,&quot;text&quot;:&quot;Subscribe&quot;,&quot;language&quot;:&quot;en&quot;}\\\" data-component-name=\\\"SubscribeWidgetToDOM\\\"><div class=\\\"subscription-widget show-subscribe\\\"><div class=\\\"preamble\\\"><p class=\\\"cta-caption\\\">Malwarology Research is a reader-supported publication. To receive new posts and support my work, consider becoming a free or paid subscriber.</p></div><form class=\\\"subscription-widget-subscribe\\\"><input type=\\\"email\\\" class=\\\"email-input\\\" name=\\\"email\\\" placeholder=\\\"Type your email\u2026\\\" tabindex=\\\"-1\\\"><input type=\\\"submit\\\" class=\\\"button primary\\\" value=\\\"Subscribe\\\"><div class=\\\"fake-input-wrapper\\\"><div class=\\\"fake-input\\\"></div><div class=\\\"fake-button\\\"></div></div></form></div></div><p>According to AV detection results, the correct identification of the unpacked file, <em>SmokeLoader</em>, does appear. There is also one detection based on dynamic analysis: <em>Zenpack</em>.</p><p>The import hash of this sample is shared by a group of other files.<a class=\\\"footnote-anchor\\\" data-component-name=\\\"FootnoteAnchorToDOM\\\" id=\\\"footnote-anchor-2\\\" href=\\\"#footnote-2\\\" target=\\\"_self\\\">2</a> However, the large majority of imported functions are called in dead code located after opaque predicates. Therefore, the usefulness of this import hash is almost nothing. Closer analysis of the opaque predicates in this sample can be found below.</p><h1>Behavioral and Code Analysis Findings</h1><h2>Build Analysis</h2><p>According to the File Header, the timestamp of compilation is 2022-02-16T10:14:32Z. The linker version found in the PE32 Optional Header is 9.0.</p><div class=\\\"captioned-image-container\\\"><figure><a class=\\\"image-link image2\\\" target=\\\"_blank\\\" href=\\\"https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc0688009-9c87-4d72-95de-6e40b6e0b8bf_987x400.png\\\" data-component-name=\\\"Image2ToDOM\\\"><div class=\\\"image2-inset\\\"><picture><source type=\\\"image/webp\\\" srcset=\\\"https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc0688009-9c87-4d72-95de-6e40b6e0b8bf_987x400.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc0688009-9c87-4d72-95de-6e40b6e0b8bf_987x400.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc0688009-9c87-4d72-95de-6e40b6e0b8bf_987x400.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc0688009-9c87-4d72-95de-6e40b6e0b8bf_987x400.png 1456w\\\" sizes=\\\"100vw\\\"><img src=\\\"https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc0688009-9c87-4d72-95de-6e40b6e0b8bf_987x400.png\\\" width=\\\"524\\\" height=\\\"212.36068895643365\\\" data-attrs=\\\"{&quot;src&quot;:&quot;https://bucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com/public/images/c0688009-9c87-4d72-95de-6e40b6e0b8bf_987x400.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:400,&quot;width&quot;:987,&quot;resizeWidth&quot;:524,&quot;bytes&quot;:116144,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null,&quot;isProcessing&quot;:false}\\\" class=\\\"sizing-normal\\\" alt=\\\"\\\" srcset=\\\"https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc0688009-9c87-4d72-95de-6e40b6e0b8bf_987x400.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc0688009-9c87-4d72-95de-6e40b6e0b8bf_987x400.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc0688009-9c87-4d72-95de-6e40b6e0b8bf_987x400.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc0688009-9c87-4d72-95de-6e40b6e0b8bf_987x400.png 1456w\\\" sizes=\\\"100vw\\\" loading=\\\"lazy\\\"></picture><div></div></div></a><figcaption class=\\\"image-caption\\\">Linker Version 9.0</figcaption></figure></div><p>The compiler is identified as <em>Visual Studio 2008 Release</em> according to function signatures in Ghidra that match a number of library functions in the sample. One example of this detection for the <code>___security_init_cookie</code> function is shown in the figure below.</p><div class=\\\"captioned-image-container\\\"><figure><a class=\\\"image-link image2 is-viewable-img\\\" target=\\\"_blank\\\" href=\\\"https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fa9981c4e-80b7-42b1-8d7d-70b221343a8e_1526x658.png\\\" data-component-name=\\\"Image2ToDOM\\\"><div class=\\\"image2-inset\\\"><picture><source type=\\\"image/webp\\\" srcset=\\\"https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fa9981c4e-80b7-42b1-8d7d-70b221343a8e_1526x658.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fa9981c4e-80b7-42b1-8d7d-70b221343a8e_1526x658.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fa9981c4e-80b7-42b1-8d7d-70b221343a8e_1526x658.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fa9981c4e-80b7-42b1-8d7d-70b221343a8e_1526x658.png 1456w\\\" sizes=\\\"100vw\\\"><img src=\\\"https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fa9981c4e-80b7-42b1-8d7d-70b221343a8e_1526x658.png\\\" width=\\\"596\\\" height=\\\"257.0659340659341\\\" data-attrs=\\\"{&quot;src&quot;:&quot;https://bucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com/public/images/a9981c4e-80b7-42b1-8d7d-70b221343a8e_1526x658.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:false,&quot;imageSize&quot;:&quot;normal&quot;,&quot;height&quot;:628,&quot;width&quot;:1456,&quot;resizeWidth&quot;:596,&quot;bytes&quot;:147679,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null,&quot;isProcessing&quot;:false}\\\" class=\\\"sizing-normal\\\" alt=\\\"\\\" srcset=\\\"https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fa9981c4e-80b7-42b1-8d7d-70b221343a8e_1526x658.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fa9981c4e-80b7-42b1-8d7d-70b221343a8e_1526x658.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fa9981c4e-80b7-42b1-8d7d-70b221343a8e_1526x658.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fa9981c4e-80b7-42b1-8d7d-70b221343a8e_1526x658.png 1456w\\\" sizes=\\\"100vw\\\" loading=\\\"lazy\\\"></picture><div class=\\\"image-link-expand\\\"><div class=\\\"pencraft pc-display-flex pc-gap-8 pc-reset\\\"><div class=\\\"pencraft pc-reset icon-container restack-image\\\"><svg role=\\\"img\\\" width=\\\"24\\\" height=\\\"24\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke-width=\\\"1.8\\\" stroke=\\\"#000\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\"><g><title></title><path d=\\\"M21 3V8M21 8H16M21 8L18 5.29962C16.7056 4.14183 15.1038 3.38328 13.3879 3.11547C11.6719 2.84766 9.9152 3.08203 8.32951 3.79031C6.74382 4.49858 5.39691 5.65051 4.45125 7.10715C3.5056 8.5638 3.00158 10.2629 3 11.9996M3 21V16M3 16H8M3 16L6 18.7C7.29445 19.8578 8.89623 20.6163 10.6121 20.8841C12.3281 21.152 14.0848 20.9176 15.6705 20.2093C17.2562 19.501 18.6031 18.3491 19.5487 16.8925C20.4944 15.4358 20.9984 13.7367 21 12\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"></path></g></svg></div><div class=\\\"pencraft pc-reset icon-container view-image\\\"><svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"20\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" class=\\\"lucide lucide-maximize2\\\"><polyline points=\\\"15 3 21 3 21 9\\\"></polyline><polyline points=\\\"9 21 3 21 3 15\\\"></polyline><line x1=\\\"21\\\" x2=\\\"14\\\" y1=\\\"3\\\" y2=\\\"10\\\"></line><line x1=\\\"3\\\" x2=\\\"10\\\" y1=\\\"21\\\" y2=\\\"14\\\"></line></svg></div></div></div></div></a><figcaption class=\\\"image-caption\\\">Compiler Detection: Visual Studio 2008 Release</figcaption></figure></div><p>The majority of the library functions found in the sample are from <em>Microsoft Visual C++ 9.0.21022</em>. This is identified in the sample\u2019s rich signature.</p><div class=\\\"captioned-image-container\\\"><figure><a class=\\\"image-link image2\\\" target=\\\"_blank\\\" href=\\\"https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F3e395003-8628-423b-b240-6c6095ae01ff_1150x452.png\\\" data-component-name=\\\"Image2ToDOM\\\"><div class=\\\"image2-inset\\\"><picture><source type=\\\"image/webp\\\" srcset=\\\"https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F3e395003-8628-423b-b240-6c6095ae01ff_1150x452.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F3e395003-8628-423b-b240-6c6095ae01ff_1150x452.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F3e395003-8628-423b-b240-6c6095ae01ff_1150x452.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F3e395003-8628-423b-b240-6c6095ae01ff_1150x452.png 1456w\\\" sizes=\\\"100vw\\\"><img src=\\\"https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F3e395003-8628-423b-b240-6c6095ae01ff_1150x452.png\\\" width=\\\"542\\\" height=\\\"213.0295652173913\\\" data-attrs=\\\"{&quot;src&quot;:&quot;https://bucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com/public/images/3e395003-8628-423b-b240-6c6095ae01ff_1150x452.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:452,&quot;width&quot;:1150,&quot;resizeWidth&quot;:542,&quot;bytes&quot;:100560,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null,&quot;isProcessing&quot;:false}\\\" class=\\\"sizing-normal\\\" alt=\\\"\\\" srcset=\\\"https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F3e395003-8628-423b-b240-6c6095ae01ff_1150x452.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F3e395003-8628-423b-b240-6c6095ae01ff_1150x452.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F3e395003-8628-423b-b240-6c6095ae01ff_1150x452.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F3e395003-8628-423b-b240-6c6095ae01ff_1150x452.png 1456w\\\" sizes=\\\"100vw\\\" loading=\\\"lazy\\\"></picture><div></div></div></a><figcaption class=\\\"image-caption\\\">Rich Signature: VC++ 9.0.21022</figcaption></figure></div><h2>Main Function</h2><div class=\\\"captioned-image-container\\\"><figure><a class=\\\"image-link image2 is-viewable-img\\\" target=\\\"_blank\\\" href=\\\"https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F168206b9-c47c-4ea0-969d-0a4ed5eb4616_1212x1055.png\\\" data-component-name=\\\"Image2ToDOM\\\"><div class=\\\"image2-inset\\\"><picture><source type=\\\"image/webp\\\" srcset=\\\"https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F168206b9-c47c-4ea0-969d-0a4ed5eb4616_1212x1055.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F168206b9-c47c-4ea0-969d-0a4ed5eb4616_1212x1055.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F168206b9-c47c-4ea0-969d-0a4ed5eb4616_1212x1055.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F168206b9-c47c-4ea0-969d-0a4ed5eb4616_1212x1055.png 1456w\\\" sizes=\\\"100vw\\\"><img src=\\\"https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F168206b9-c47c-4ea0-969d-0a4ed5eb4616_1212x1055.png\\\" width=\\\"564\\\" height=\\\"490.94059405940595\\\" data-attrs=\\\"{&quot;src&quot;:&quot;https://bucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com/public/images/168206b9-c47c-4ea0-969d-0a4ed5eb4616_1212x1055.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:1055,&quot;width&quot;:1212,&quot;resizeWidth&quot;:564,&quot;bytes&quot;:352113,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null,&quot;isProcessing&quot;:false}\\\" class=\\\"sizing-normal\\\" alt=\\\"\\\" srcset=\\\"https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F168206b9-c47c-4ea0-969d-0a4ed5eb4616_1212x1055.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F168206b9-c47c-4ea0-969d-0a4ed5eb4616_1212x1055.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F168206b9-c47c-4ea0-969d-0a4ed5eb4616_1212x1055.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F168206b9-c47c-4ea0-969d-0a4ed5eb4616_1212x1055.png 1456w\\\" sizes=\\\"100vw\\\" loading=\\\"lazy\\\"></picture><div class=\\\"image-link-expand\\\"><div class=\\\"pencraft pc-display-flex pc-gap-8 pc-reset\\\"><div class=\\\"pencraft pc-reset icon-container restack-image\\\"><svg role=\\\"img\\\" width=\\\"24\\\" height=\\\"24\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke-width=\\\"1.8\\\" stroke=\\\"#000\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\"><g><title></title><path d=\\\"M21 3V8M21 8H16M21 8L18 5.29962C16.7056 4.14183 15.1038 3.38328 13.3879 3.11547C11.6719 2.84766 9.9152 3.08203 8.32951 3.79031C6.74382 4.49858 5.39691 5.65051 4.45125 7.10715C3.5056 8.5638 3.00158 10.2629 3 11.9996M3 21V16M3 16H8M3 16L6 18.7C7.29445 19.8578 8.89623 20.6163 10.6121 20.8841C12.3281 21.152 14.0848 20.9176 15.6705 20.2093C17.2562 19.501 18.6031 18.3491 19.5487 16.8925C20.4944 15.4358 20.9984 13.7367 21 12\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"></path></g></svg></div><div class=\\\"pencraft pc-reset icon-container view-image\\\"><svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"20\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" class=\\\"lucide lucide-maximize2\\\"><polyline points=\\\"15 3 21 3 21 9\\\"></polyline><polyline points=\\\"9 21 3 21 3 15\\\"></polyline><line x1=\\\"21\\\" x2=\\\"14\\\" y1=\\\"3\\\" y2=\\\"10\\\"></line><line x1=\\\"3\\\" x2=\\\"10\\\" y1=\\\"21\\\" y2=\\\"14\\\"></line></svg></div></div></div></div></a><figcaption class=\\\"image-caption\\\">Main Function</figcaption></figure></div><p>The instructions highlighted in yellow in the figure above are examples of <a href=\\\"https://github.com/MBCProject/mbc-markdown/blob/master/anti-static-analysis/executable-code-obfuscation.md#:~:text=analysis%20visually%20harder.-,Junk%20Code%20Insertion,-B0032.007\\\">junk code insertion</a>. These are dummy instructions that are placed between relevant instructions with the goal of making signature development more difficult. The instructions at the end of the function highlighted in white are not executed. These highlight colorings are used throughout the screenshots of this analysis.</p><p>The first instructions in the main function calculate the size of the encoded data that contains the shellcode which is the next stage of the packer. The first part is read from a constant in the <code>.data</code> section at address <code>0x41cc3c</code>. The second part is hardcoded in the main function at address <code>0x406573</code>. The size is calculated in the next instruction by adding the two parts together. The resulting size is written to a variable in the <code>.data</code> section. Highlighted in the figure below are the bytes before and after the first constant. These two sets of bytes are not read during the execution of the packer, and their purpose is unknown. However, they are stable across builds of this packer going back for months at least.</p><div class=\\\"captioned-image-container\\\"><figure><a class=\\\"image-link image2\\\" target=\\\"_blank\\\" href=\\\"https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fbe61ed5a-e890-4f81-8b22-003cdb96b0f8_1090x290.png\\\" data-component-name=\\\"Image2ToDOM\\\"><div class=\\\"image2-inset\\\"><picture><source type=\\\"image/webp\\\" srcset=\\\"https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fbe61ed5a-e890-4f81-8b22-003cdb96b0f8_1090x290.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fbe61ed5a-e890-4f81-8b22-003cdb96b0f8_1090x290.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fbe61ed5a-e890-4f81-8b22-003cdb96b0f8_1090x290.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fbe61ed5a-e890-4f81-8b22-003cdb96b0f8_1090x290.png 1456w\\\" sizes=\\\"100vw\\\"><img src=\\\"https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fbe61ed5a-e890-4f81-8b22-003cdb96b0f8_1090x290.png\\\" width=\\\"552\\\" height=\\\"146.86238532110093\\\" data-attrs=\\\"{&quot;src&quot;:&quot;https://bucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com/public/images/be61ed5a-e890-4f81-8b22-003cdb96b0f8_1090x290.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:290,&quot;width&quot;:1090,&quot;resizeWidth&quot;:552,&quot;bytes&quot;:63104,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null,&quot;isProcessing&quot;:false}\\\" class=\\\"sizing-normal\\\" alt=\\\"\\\" srcset=\\\"https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fbe61ed5a-e890-4f81-8b22-003cdb96b0f8_1090x290.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fbe61ed5a-e890-4f81-8b22-003cdb96b0f8_1090x290.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fbe61ed5a-e890-4f81-8b22-003cdb96b0f8_1090x290.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fbe61ed5a-e890-4f81-8b22-003cdb96b0f8_1090x290.png 1456w\\\" sizes=\\\"100vw\\\" loading=\\\"lazy\\\"></picture><div></div></div></a><figcaption class=\\\"image-caption\\\">Stable Surrounding Bytes</figcaption></figure></div><p>The address where the encoded data is located goes through a similar process. The first part is read from the <code>.data</code> section then written to a variable in the same section. The addition to the second part does not occur until later in the <code>unpack_shellcode</code> function. The bytes surrounding this part are shown in the figure below.</p><div class=\\\"captioned-image-container\\\"><figure><a class=\\\"image-link image2\\\" target=\\\"_blank\\\" href=\\\"https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F02024936-1f68-4e97-a267-33b14f702000_1093x288.png\\\" data-component-name=\\\"Image2ToDOM\\\"><div class=\\\"image2-inset\\\"><picture><source type=\\\"image/webp\\\" srcset=\\\"https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F02024936-1f68-4e97-a267-33b14f702000_1093x288.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F02024936-1f68-4e97-a267-33b14f702000_1093x288.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F02024936-1f68-4e97-a267-33b14f702000_1093x288.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F02024936-1f68-4e97-a267-33b14f702000_1093x288.png 1456w\\\" sizes=\\\"100vw\\\"><img src=\\\"https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F02024936-1f68-4e97-a267-33b14f702000_1093x288.png\\\" width=\\\"556\\\" height=\\\"146.5032021957914\\\" data-attrs=\\\"{&quot;src&quot;:&quot;https://bucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com/public/images/02024936-1f68-4e97-a267-33b14f702000_1093x288.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:288,&quot;width&quot;:1093,&quot;resizeWidth&quot;:556,&quot;bytes&quot;:58860,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null,&quot;isProcessing&quot;:false}\\\" class=\\\"sizing-normal\\\" alt=\\\"\\\" srcset=\\\"https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F02024936-1f68-4e97-a267-33b14f702000_1093x288.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F02024936-1f68-4e97-a267-33b14f702000_1093x288.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F02024936-1f68-4e97-a267-33b14f702000_1093x288.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F02024936-1f68-4e97-a267-33b14f702000_1093x288.png 1456w\\\" sizes=\\\"100vw\\\" loading=\\\"lazy\\\"></picture><div></div></div></a><figcaption class=\\\"image-caption\\\">Stable Surrounding Bytes</figcaption></figure></div><p>The next set of instructions handles loading <code>kernel32.dll</code> and resolving the address of <code>LocalAlloc</code>.<a class=\\\"footnote-anchor\\\" data-component-name=\\\"FootnoteAnchorToDOM\\\" id=\\\"footnote-anchor-3\\\" href=\\\"#footnote-3\\\" target=\\\"_self\\\">3</a> These instructions taken together are unique to this packer and shared across hundreds of variants. The stray instruction at address <code>0x406588</code> is part of the previous logical grouping of instructions. This is an example of <a href=\\\"https://github.com/MBCProject/mbc-markdown/blob/master/anti-static-analysis/executable-code-obfuscation.md#:~:text=to%20confuse%20disassembler.-,Interleaving%20Code,-B0032.014\\\">interleaving code</a> that is meant to make signature development more difficult.</p><div class=\\\"captioned-image-container\\\"><figure><a class=\\\"image-link image2\\\" target=\\\"_blank\\\" href=\\\"https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fac742791-6fc4-424c-b79e-2538e69faebe_1389x257.png\\\" data-component-name=\\\"Image2ToDOM\\\"><div class=\\\"image2-inset\\\"><picture><source type=\\\"image/webp\\\" srcset=\\\"https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fac742791-6fc4-424c-b79e-2538e69faebe_1389x257.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fac742791-6fc4-424c-b79e-2538e69faebe_1389x257.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fac742791-6fc4-424c-b79e-2538e69faebe_1389x257.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fac742791-6fc4-424c-b79e-2538e69faebe_1389x257.png 1456w\\\" sizes=\\\"100vw\\\"><img src=\\\"https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fac742791-6fc4-424c-b79e-2538e69faebe_1389x257.png\\\" width=\\\"644\\\" height=\\\"119.15622750179986\\\" data-attrs=\\\"{&quot;src&quot;:&quot;https://bucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com/public/images/ac742791-6fc4-424c-b79e-2538e69faebe_1389x257.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:257,&quot;width&quot;:1389,&quot;resizeWidth&quot;:644,&quot;bytes&quot;:110510,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null,&quot;isProcessing&quot;:false}\\\" class=\\\"sizing-normal\\\" alt=\\\"\\\" srcset=\\\"https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fac742791-6fc4-424c-b79e-2538e69faebe_1389x257.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fac742791-6fc4-424c-b79e-2538e69faebe_1389x257.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fac742791-6fc4-424c-b79e-2538e69faebe_1389x257.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fac742791-6fc4-424c-b79e-2538e69faebe_1389x257.png 1456w\\\" sizes=\\\"100vw\\\" loading=\\\"lazy\\\"></picture><div></div></div></a><figcaption class=\\\"image-caption\\\">Resolve <code>LocalAlloc</code></figcaption></figure></div><p>The call to <code>LocalAlloc</code> is obfuscated by calling it from the <code>eax</code> register. This is a type of function call obfuscation. The <code>uBytes</code> parameter to the function is 63072 bytes which is the result of the calculation described above.</p><div class=\\\"captioned-image-container\\\"><figure><a class=\\\"image-link image2\\\" target=\\\"_blank\\\" href=\\\"https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F3c5832a3-a278-4491-9111-27bc29b8d822_1238x163.png\\\" data-component-name=\\\"Image2ToDOM\\\"><div class=\\\"image2-inset\\\"><picture><source type=\\\"image/webp\\\" srcset=\\\"https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F3c5832a3-a278-4491-9111-27bc29b8d822_1238x163.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F3c5832a3-a278-4491-9111-27bc29b8d822_1238x163.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F3c5832a3-a278-4491-9111-27bc29b8d822_1238x163.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F3c5832a3-a278-4491-9111-27bc29b8d822_1238x163.png 1456w\\\" sizes=\\\"100vw\\\"><img src=\\\"https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F3c5832a3-a278-4491-9111-27bc29b8d822_1238x163.png\\\" width=\\\"656\\\" height=\\\"86.37156704361874\\\" data-attrs=\\\"{&quot;src&quot;:&quot;https://bucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com/public/images/3c5832a3-a278-4491-9111-27bc29b8d822_1238x163.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:163,&quot;width&quot;:1238,&quot;resizeWidth&quot;:656,&quot;bytes&quot;:71941,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null,&quot;isProcessing&quot;:false}\\\" class=\\\"sizing-normal\\\" alt=\\\"\\\" srcset=\\\"https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F3c5832a3-a278-4491-9111-27bc29b8d822_1238x163.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F3c5832a3-a278-4491-9111-27bc29b8d822_1238x163.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F3c5832a3-a278-4491-9111-27bc29b8d822_1238x163.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F3c5832a3-a278-4491-9111-27bc29b8d822_1238x163.png 1456w\\\" sizes=\\\"100vw\\\" loading=\\\"lazy\\\"></picture><div></div></div></a><figcaption class=\\\"image-caption\\\">Obfuscated Call to <code>LocalAlloc</code></figcaption></figure></div><p>The final instructions in the main function are calls to other malicious functions and finally a call to the entry point of the decoded shellcode. The next stage of the packer starts after that call.</p><h2>Change Protection Function</h2><div class=\\\"captioned-image-container\\\"><figure><a class=\\\"image-link image2 is-viewable-img\\\" target=\\\"_blank\\\" href=\\\"https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fabf65e66-e753-4257-9483-3156944cdc14_1278x1639.png\\\" data-component-name=\\\"Image2ToDOM\\\"><div class=\\\"image2-inset\\\"><picture><source type=\\\"image/webp\\\" srcset=\\\"https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fabf65e66-e753-4257-9483-3156944cdc14_1278x1639.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fabf65e66-e753-4257-9483-3156944cdc14_1278x1639.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fabf65e66-e753-4257-9483-3156944cdc14_1278x1639.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fabf65e66-e753-4257-9483-3156944cdc14_1278x1639.png 1456w\\\" sizes=\\\"100vw\\\"><img src=\\\"https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fabf65e66-e753-4257-9483-3156944cdc14_1278x1639.png\\\" width=\\\"558\\\" height=\\\"715.6197183098592\\\" data-attrs=\\\"{&quot;src&quot;:&quot;https://bucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com/public/images/abf65e66-e753-4257-9483-3156944cdc14_1278x1639.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:1639,&quot;width&quot;:1278,&quot;resizeWidth&quot;:558,&quot;bytes&quot;:558933,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null,&quot;isProcessing&quot;:false}\\\" class=\\\"sizing-normal\\\" alt=\\\"\\\" srcset=\\\"https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fabf65e66-e753-4257-9483-3156944cdc14_1278x1639.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fabf65e66-e753-4257-9483-3156944cdc14_1278x1639.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fabf65e66-e753-4257-9483-3156944cdc14_1278x1639.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fabf65e66-e753-4257-9483-3156944cdc14_1278x1639.png 1456w\\\" sizes=\\\"100vw\\\" loading=\\\"lazy\\\"></picture><div class=\\\"image-link-expand\\\"><div class=\\\"pencraft pc-display-flex pc-gap-8 pc-reset\\\"><div class=\\\"pencraft pc-reset icon-container restack-image\\\"><svg role=\\\"img\\\" width=\\\"24\\\" height=\\\"24\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke-width=\\\"1.8\\\" stroke=\\\"#000\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\"><g><title></title><path d=\\\"M21 3V8M21 8H16M21 8L18 5.29962C16.7056 4.14183 15.1038 3.38328 13.3879 3.11547C11.6719 2.84766 9.9152 3.08203 8.32951 3.79031C6.74382 4.49858 5.39691 5.65051 4.45125 7.10715C3.5056 8.5638 3.00158 10.2629 3 11.9996M3 21V16M3 16H8M3 16L6 18.7C7.29445 19.8578 8.89623 20.6163 10.6121 20.8841C12.3281 21.152 14.0848 20.9176 15.6705 20.2093C17.2562 19.501 18.6031 18.3491 19.5487 16.8925C20.4944 15.4358 20.9984 13.7367 21 12\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"></path></g></svg></div><div class=\\\"pencraft pc-reset icon-container view-image\\\"><svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"20\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" class=\\\"lucide lucide-maximize2\\\"><polyline points=\\\"15 3 21 3 21 9\\\"></polyline><polyline points=\\\"9 21 3 21 3 15\\\"></polyline><line x1=\\\"21\\\" x2=\\\"14\\\" y1=\\\"3\\\" y2=\\\"10\\\"></line><line x1=\\\"3\\\" x2=\\\"10\\\" y1=\\\"21\\\" y2=\\\"14\\\"></line></svg></div></div></div></div></a><figcaption class=\\\"image-caption\\\">Change Protection Function</figcaption></figure></div><p>This function is a wrapper around an obfuscated call to <code>VirtualProtect</code>. Starting at address <code>0x4058e3</code> and continuing until the call to <code>GetProcAddress</code>, the name of the function <code>VirtualProtect</code> is written character-by-character, out of order, to a variable in the <code>.data</code> section. Building the function name in this way is an example of <a href=\\\"https://github.com/MBCProject/mbc-markdown/blob/master/anti-static-analysis/disassembler-evasion.md#:~:text=Variable%20Recomposition\\\">variable recomposition</a>. The address of this string is then used as the <code>lpProcName</code> parameter to <code>GetProcAddress</code>. Finally, a call is made to <code>VirtualProtect</code> to change the protection from <code>PAGE_READWRITE</code> (<code>0x4</code>) to <code>PAGE_EXECUTE_READWRITE</code> (<code>0x40</code>) thus enabling execution in the newly allocated memory.</p><p>The <code>flNewProtect</code> parameter to the <code>VirtualProtect</code> function is also obfuscated by adding together <code>0x20</code> and <code>0x20</code>. This hides the <code>PAGE_EXECUTE_READWRITE</code> flag of <code>0x40</code> from being located near the call to <code>VirtualProtect</code>. This is a form of <a href=\\\"https://github.com/MBCProject/mbc-markdown/blob/master/anti-static-analysis/disassembler-evasion.md#:~:text=Argument%20Obfuscation\\\">argument obfuscation</a>.</p><div class=\\\"captioned-image-container\\\"><figure><a class=\\\"image-link image2\\\" target=\\\"_blank\\\" href=\\\"https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fa5b5e201-e7f0-4939-9a34-c2ab7d687616_1521x66.png\\\" data-component-name=\\\"Image2ToDOM\\\"><div class=\\\"image2-inset\\\"><picture><source type=\\\"image/webp\\\" srcset=\\\"https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fa5b5e201-e7f0-4939-9a34-c2ab7d687616_1521x66.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fa5b5e201-e7f0-4939-9a34-c2ab7d687616_1521x66.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fa5b5e201-e7f0-4939-9a34-c2ab7d687616_1521x66.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fa5b5e201-e7f0-4939-9a34-c2ab7d687616_1521x66.png 1456w\\\" sizes=\\\"100vw\\\"><img src=\\\"https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fa5b5e201-e7f0-4939-9a34-c2ab7d687616_1521x66.png\\\" width=\\\"1456\\\" height=\\\"63\\\" data-attrs=\\\"{&quot;src&quot;:&quot;https://bucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com/public/images/a5b5e201-e7f0-4939-9a34-c2ab7d687616_1521x66.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:63,&quot;width&quot;:1456,&quot;resizeWidth&quot;:null,&quot;bytes&quot;:40379,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null,&quot;isProcessing&quot;:false}\\\" class=\\\"sizing-normal\\\" alt=\\\"\\\" srcset=\\\"https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fa5b5e201-e7f0-4939-9a34-c2ab7d687616_1521x66.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fa5b5e201-e7f0-4939-9a34-c2ab7d687616_1521x66.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fa5b5e201-e7f0-4939-9a34-c2ab7d687616_1521x66.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fa5b5e201-e7f0-4939-9a34-c2ab7d687616_1521x66.png 1456w\\\" sizes=\\\"100vw\\\" loading=\\\"lazy\\\"></picture><div></div></div></a><figcaption class=\\\"image-caption\\\">Obfuscated New Protect Value</figcaption></figure></div><h2>Unpack Shellcode Function</h2><p>This function performs three actions that are interspersed with anti-analysis code. The first action is moving the encoded data from its starting location in the <code>.data</code> section to the newly allocated memory.</p><div class=\\\"captioned-image-container\\\"><figure><a class=\\\"image-link image2 is-viewable-img\\\" target=\\\"_blank\\\" href=\\\"https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F72a2f4df-84b0-49ad-a659-fca776c25d5e_1637x1513.png\\\" data-component-name=\\\"Image2ToDOM\\\"><div class=\\\"image2-inset\\\"><picture><source type=\\\"image/webp\\\" srcset=\\\"https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F72a2f4df-84b0-49ad-a659-fca776c25d5e_1637x1513.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F72a2f4df-84b0-49ad-a659-fca776c25d5e_1637x1513.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F72a2f4df-84b0-49ad-a659-fca776c25d5e_1637x1513.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F72a2f4df-84b0-49ad-a659-fca776c25d5e_1637x1513.png 1456w\\\" sizes=\\\"100vw\\\"><img src=\\\"https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F72a2f4df-84b0-49ad-a659-fca776c25d5e_1637x1513.png\\\" width=\\\"632\\\" height=\\\"584.2527472527472\\\" data-attrs=\\\"{&quot;src&quot;:&quot;https://bucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com/public/images/72a2f4df-84b0-49ad-a659-fca776c25d5e_1637x1513.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:1346,&quot;width&quot;:1456,&quot;resizeWidth&quot;:632,&quot;bytes&quot;:362197,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null,&quot;isProcessing&quot;:false}\\\" class=\\\"sizing-normal\\\" alt=\\\"\\\" srcset=\\\"https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F72a2f4df-84b0-49ad-a659-fca776c25d5e_1637x1513.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F72a2f4df-84b0-49ad-a659-fca776c25d5e_1637x1513.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F72a2f4df-84b0-49ad-a659-fca776c25d5e_1637x1513.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F72a2f4df-84b0-49ad-a659-fca776c25d5e_1637x1513.png 1456w\\\" sizes=\\\"100vw\\\" loading=\\\"lazy\\\"></picture><div class=\\\"image-link-expand\\\"><div class=\\\"pencraft pc-display-flex pc-gap-8 pc-reset\\\"><div class=\\\"pencraft pc-reset icon-container restack-image\\\"><svg role=\\\"img\\\" width=\\\"24\\\" height=\\\"24\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke-width=\\\"1.8\\\" stroke=\\\"#000\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\"><g><title></title><path d=\\\"M21 3V8M21 8H16M21 8L18 5.29962C16.7056 4.14183 15.1038 3.38328 13.3879 3.11547C11.6719 2.84766 9.9152 3.08203 8.32951 3.79031C6.74382 4.49858 5.39691 5.65051 4.45125 7.10715C3.5056 8.5638 3.00158 10.2629 3 11.9996M3 21V16M3 16H8M3 16L6 18.7C7.29445 19.8578 8.89623 20.6163 10.6121 20.8841C12.3281 21.152 14.0848 20.9176 15.6705 20.2093C17.2562 19.501 18.6031 18.3491 19.5487 16.8925C20.4944 15.4358 20.9984 13.7367 21 12\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"></path></g></svg></div><div class=\\\"pencraft pc-reset icon-container view-image\\\"><svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"20\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" class=\\\"lucide lucide-maximize2\\\"><polyline points=\\\"15 3 21 3 21 9\\\"></polyline><polyline points=\\\"9 21 3 21 3 15\\\"></polyline><line x1=\\\"21\\\" x2=\\\"14\\\" y1=\\\"3\\\" y2=\\\"10\\\"></line><line x1=\\\"3\\\" x2=\\\"10\\\" y1=\\\"21\\\" y2=\\\"14\\\"></line></svg></div></div></div></div></a><figcaption class=\\\"image-caption\\\">Move Encoded Data</figcaption></figure></div><p>Note the instructions at addresses <code>0x405aa7</code> and <code>0x405acd</code>. These are both <a href=\\\"https://github.com/MBCProject/mbc-markdown/blob/master/anti-static-analysis/executable-code-obfuscation.md\\\">opaque predicates</a>. An opaque predicate appears to be a conditional jump, but the conditions can only be met in one way making the jump effectively unconditional. The one at the top is basically a fake: it never jumps. The one in the middle always jumps. This one additionally encloses a block of <a href=\\\"https://github.com/MBCProject/mbc-markdown/blob/master/anti-static-analysis/executable-code-obfuscation.md#:~:text=.%20%5BNEEDS%20REVIEW%5D-,Dead%20Code%20Insertion,-B0032.003\\\">dead code</a>. This packer very frequently couples dead code insertion with opaque predicates that always jump over the dead code. The function calls in the dead code are included in the import table making identification via import hash of little utility.</p><p>Later on in this function is the call to the <code>decode</code> function. After that is a call to a function which shifts the pointer to the decoded shellcode. The shift changes the offset from the start of this data to the location of the shellcode original execution point (OEP). Because the shellcode is position independent, this OEP is also offset zero of the shellcode. Both of these functions are analyzed in more detail below.</p><p>The <code>shift_shellcode_oep</code> function is additionally wrapped in an anti-emulator <a href=\\\"https://github.com/MBCProject/mbc-markdown/blob/master/anti-behavioral-analysis/emulator-evasion.md#:~:text=to%20block%20emulators.-,Extra%20Loops,-/Time%20Locks\\\">loop which has a very high number of iterations</a>. This slows processing in an emulator which can potentially cause a timeout and an analysis failure.</p><div class=\\\"captioned-image-container\\\"><figure><a class=\\\"image-link image2 is-viewable-img\\\" target=\\\"_blank\\\" href=\\\"https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F866ae73e-b5eb-401e-b158-b7530d7f909b_1450x673.png\\\" data-component-name=\\\"Image2ToDOM\\\"><div class=\\\"image2-inset\\\"><picture><source type=\\\"image/webp\\\" srcset=\\\"https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F866ae73e-b5eb-401e-b158-b7530d7f909b_1450x673.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F866ae73e-b5eb-401e-b158-b7530d7f909b_1450x673.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F866ae73e-b5eb-401e-b158-b7530d7f909b_1450x673.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F866ae73e-b5eb-401e-b158-b7530d7f909b_1450x673.png 1456w\\\" sizes=\\\"100vw\\\"><img src=\\\"https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F866ae73e-b5eb-401e-b158-b7530d7f909b_1450x673.png\\\" width=\\\"646\\\" height=\\\"299.83310344827584\\\" data-attrs=\\\"{&quot;src&quot;:&quot;https://bucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com/public/images/866ae73e-b5eb-401e-b158-b7530d7f909b_1450x673.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:673,&quot;width&quot;:1450,&quot;resizeWidth&quot;:646,&quot;bytes&quot;:106252,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null,&quot;isProcessing&quot;:false}\\\" class=\\\"sizing-normal\\\" alt=\\\"\\\" srcset=\\\"https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F866ae73e-b5eb-401e-b158-b7530d7f909b_1450x673.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F866ae73e-b5eb-401e-b158-b7530d7f909b_1450x673.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F866ae73e-b5eb-401e-b158-b7530d7f909b_1450x673.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F866ae73e-b5eb-401e-b158-b7530d7f909b_1450x673.png 1456w\\\" sizes=\\\"100vw\\\" loading=\\\"lazy\\\"></picture><div class=\\\"image-link-expand\\\"><div class=\\\"pencraft pc-display-flex pc-gap-8 pc-reset\\\"><div class=\\\"pencraft pc-reset icon-container restack-image\\\"><svg role=\\\"img\\\" width=\\\"24\\\" height=\\\"24\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke-width=\\\"1.8\\\" stroke=\\\"#000\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\"><g><title></title><path d=\\\"M21 3V8M21 8H16M21 8L18 5.29962C16.7056 4.14183 15.1038 3.38328 13.3879 3.11547C11.6719 2.84766 9.9152 3.08203 8.32951 3.79031C6.74382 4.49858 5.39691 5.65051 4.45125 7.10715C3.5056 8.5638 3.00158 10.2629 3 11.9996M3 21V16M3 16H8M3 16L6 18.7C7.29445 19.8578 8.89623 20.6163 10.6121 20.8841C12.3281 21.152 14.0848 20.9176 15.6705 20.2093C17.2562 19.501 18.6031 18.3491 19.5487 16.8925C20.4944 15.4358 20.9984 13.7367 21 12\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"></path></g></svg></div><div class=\\\"pencraft pc-reset icon-container view-image\\\"><svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"20\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" class=\\\"lucide lucide-maximize2\\\"><polyline points=\\\"15 3 21 3 21 9\\\"></polyline><polyline points=\\\"9 21 3 21 3 15\\\"></polyline><line x1=\\\"21\\\" x2=\\\"14\\\" y1=\\\"3\\\" y2=\\\"10\\\"></line><line x1=\\\"3\\\" x2=\\\"10\\\" y1=\\\"21\\\" y2=\\\"14\\\"></line></svg></div></div></div></div></a><figcaption class=\\\"image-caption\\\">Decode and Shift Shellcode OEP Functions</figcaption></figure></div><p>Note the comparison instruction at address <code>0x406486</code>. During the anti-emulation loop, the call to <code>shift_shellcode_oep</code> is made once when the counter reaches <code>0x770e</code>. This is a type of anti-emulation circumvention countermeasure. A basic method for circumventing extremely long loops that target emulators is to patch out the loop. Another is to detect the loop in the emulator and then modify the counter to leave the loop. Because the shift function is called once at a point in the loop, either of these circumventions could end up not executing this function and would leave the emulator unable to execute the shellcode correctly.</p><p>The <code>unpack_shellcode</code> function overall contains ten opaque predicates primarily of the same type shown above. One of them is slightly different in that it creates a dead end filled with dead code. The last instruction in the dead end is a call to <code>terminate</code>. Therefore, this appears to be a location where the execution of the packer ends.</p><div class=\\\"captioned-image-container\\\"><figure><a class=\\\"image-link image2 is-viewable-img\\\" target=\\\"_blank\\\" href=\\\"https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F5357e40a-81ff-4af9-b8a2-721de45ba45f_1956x1173.png\\\" data-component-name=\\\"Image2ToDOM\\\"><div class=\\\"image2-inset\\\"><picture><source type=\\\"image/webp\\\" srcset=\\\"https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F5357e40a-81ff-4af9-b8a2-721de45ba45f_1956x1173.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F5357e40a-81ff-4af9-b8a2-721de45ba45f_1956x1173.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F5357e40a-81ff-4af9-b8a2-721de45ba45f_1956x1173.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F5357e40a-81ff-4af9-b8a2-721de45ba45f_1956x1173.png 1456w\\\" sizes=\\\"100vw\\\"><img src=\\\"https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F5357e40a-81ff-4af9-b8a2-721de45ba45f_1956x1173.png\\\" width=\\\"560\\\" height=\\\"335.7692307692308\\\" data-attrs=\\\"{&quot;src&quot;:&quot;https://bucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com/public/images/5357e40a-81ff-4af9-b8a2-721de45ba45f_1956x1173.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:873,&quot;width&quot;:1456,&quot;resizeWidth&quot;:560,&quot;bytes&quot;:300550,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null,&quot;isProcessing&quot;:false}\\\" class=\\\"sizing-normal\\\" alt=\\\"\\\" srcset=\\\"https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F5357e40a-81ff-4af9-b8a2-721de45ba45f_1956x1173.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F5357e40a-81ff-4af9-b8a2-721de45ba45f_1956x1173.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F5357e40a-81ff-4af9-b8a2-721de45ba45f_1956x1173.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F5357e40a-81ff-4af9-b8a2-721de45ba45f_1956x1173.png 1456w\\\" sizes=\\\"100vw\\\" loading=\\\"lazy\\\"></picture><div class=\\\"image-link-expand\\\"><div class=\\\"pencraft pc-display-flex pc-gap-8 pc-reset\\\"><div class=\\\"pencraft pc-reset icon-container restack-image\\\"><svg role=\\\"img\\\" width=\\\"24\\\" height=\\\"24\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke-width=\\\"1.8\\\" stroke=\\\"#000\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\"><g><title></title><path d=\\\"M21 3V8M21 8H16M21 8L18 5.29962C16.7056 4.14183 15.1038 3.38328 13.3879 3.11547C11.6719 2.84766 9.9152 3.08203 8.32951 3.79031C6.74382 4.49858 5.39691 5.65051 4.45125 7.10715C3.5056 8.5638 3.00158 10.2629 3 11.9996M3 21V16M3 16H8M3 16L6 18.7C7.29445 19.8578 8.89623 20.6163 10.6121 20.8841C12.3281 21.152 14.0848 20.9176 15.6705 20.2093C17.2562 19.501 18.6031 18.3491 19.5487 16.8925C20.4944 15.4358 20.9984 13.7367 21 12\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"></path></g></svg></div><div class=\\\"pencraft pc-reset icon-container view-image\\\"><svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"20\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" class=\\\"lucide lucide-maximize2\\\"><polyline points=\\\"15 3 21 3 21 9\\\"></polyline><polyline points=\\\"9 21 3 21 3 15\\\"></polyline><line x1=\\\"21\\\" x2=\\\"14\\\" y1=\\\"3\\\" y2=\\\"10\\\"></line><line x1=\\\"3\\\" x2=\\\"10\\\" y1=\\\"21\\\" y2=\\\"14\\\"></line></svg></div></div></div></div></a><figcaption class=\\\"image-caption\\\">Opaque Predicate with Dead End</figcaption></figure></div><p>There are a total of four anti-emulation loops similar to the one analyzed above. Two of these wrap opaque predicates which in turn wrap inserted dead code. One, however, in addition to wrapping two opaque predicates, also contains two additional anti-emulator behaviors. Both of these are calls to <a href=\\\"https://github.com/MBCProject/mbc-markdown/blob/master/anti-behavioral-analysis/emulator-evasion.md#:~:text=non%2Dexhaustive%20emulators.-,Unusual,-/Undocumented%20API%20Calls\\\">unusual APIs</a>: <code>GetGeoInfoA</code> and <code>GetSystemDefaultLangID</code>. During analysis, <a href=\\\"https://github.com/qilingframework/qiling\\\">Qiling emulator</a> halted with an exception because neither of these API calls have been implemented.</p><div class=\\\"captioned-image-container\\\"><figure><a class=\\\"image-link image2\\\" target=\\\"_blank\\\" href=\\\"https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc611ee6a-667b-46de-af2f-23e79541614e_1082x394.png\\\" data-component-name=\\\"Image2ToDOM\\\"><div class=\\\"image2-inset\\\"><picture><source type=\\\"image/webp\\\" srcset=\\\"https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc611ee6a-667b-46de-af2f-23e79541614e_1082x394.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc611ee6a-667b-46de-af2f-23e79541614e_1082x394.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc611ee6a-667b-46de-af2f-23e79541614e_1082x394.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc611ee6a-667b-46de-af2f-23e79541614e_1082x394.png 1456w\\\" sizes=\\\"100vw\\\"><img src=\\\"https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc611ee6a-667b-46de-af2f-23e79541614e_1082x394.png\\\" width=\\\"574\\\" height=\\\"209.0166358595194\\\" data-attrs=\\\"{&quot;src&quot;:&quot;https://bucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com/public/images/c611ee6a-667b-46de-af2f-23e79541614e_1082x394.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:394,&quot;width&quot;:1082,&quot;resizeWidth&quot;:574,&quot;bytes&quot;:107919,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null,&quot;isProcessing&quot;:false}\\\" class=\\\"sizing-normal\\\" alt=\\\"\\\" srcset=\\\"https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc611ee6a-667b-46de-af2f-23e79541614e_1082x394.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc611ee6a-667b-46de-af2f-23e79541614e_1082x394.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc611ee6a-667b-46de-af2f-23e79541614e_1082x394.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fc611ee6a-667b-46de-af2f-23e79541614e_1082x394.png 1456w\\\" sizes=\\\"100vw\\\" loading=\\\"lazy\\\"></picture><div></div></div></a><figcaption class=\\\"image-caption\\\">Anti-Emulation: Unusual API Calls</figcaption></figure></div><p>In the very first code block of the <code>unpack_shellcode</code> function, a new and subsequently unused exception handler is registered. Chances are about even that this is an anti-emulation behavior or it is just junk code. If it is anti-emulation, it is targeting older emulators based on specific versions of <a href=\\\"https://github.com/unicorn-engine/unicorn\\\">Unicorn Engine</a> which <a href=\\\"https://github.com/unipacker/unicorn#:~:text=not%20available%20in%20the%20current%20version\\\">do not implement access</a> to the Windows Thread Information Block (TIB). Moving the contents of <code>fs:0x0</code> as happens at address <code>0x405983</code> would fail in that particular environment. This type of anti-emulation is an <a href=\\\"https://github.com/MBCProject/mbc-markdown/blob/master/anti-behavioral-analysis/emulator-evasion.md#:~:text=emulators%20give%20up.-,Undocumented%20Opcodes,-B0005.002\\\">unimplemented opcode</a>.</p><div class=\\\"captioned-image-container\\\"><figure><a class=\\\"image-link image2 is-viewable-img\\\" target=\\\"_blank\\\" href=\\\"https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fe93c840b-b386-45b8-97d5-083b6df35bff_1257x567.png\\\" data-component-name=\\\"Image2ToDOM\\\"><div class=\\\"image2-inset\\\"><picture><source type=\\\"image/webp\\\" srcset=\\\"https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fe93c840b-b386-45b8-97d5-083b6df35bff_1257x567.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fe93c840b-b386-45b8-97d5-083b6df35bff_1257x567.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fe93c840b-b386-45b8-97d5-083b6df35bff_1257x567.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fe93c840b-b386-45b8-97d5-083b6df35bff_1257x567.png 1456w\\\" sizes=\\\"100vw\\\"><img src=\\\"https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fe93c840b-b386-45b8-97d5-083b6df35bff_1257x567.png\\\" width=\\\"556\\\" height=\\\"250.79713603818615\\\" data-attrs=\\\"{&quot;src&quot;:&quot;https://bucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com/public/images/e93c840b-b386-45b8-97d5-083b6df35bff_1257x567.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:567,&quot;width&quot;:1257,&quot;resizeWidth&quot;:556,&quot;bytes&quot;:189345,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null,&quot;isProcessing&quot;:false}\\\" class=\\\"sizing-normal\\\" alt=\\\"\\\" srcset=\\\"https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fe93c840b-b386-45b8-97d5-083b6df35bff_1257x567.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fe93c840b-b386-45b8-97d5-083b6df35bff_1257x567.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fe93c840b-b386-45b8-97d5-083b6df35bff_1257x567.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fe93c840b-b386-45b8-97d5-083b6df35bff_1257x567.png 1456w\\\" sizes=\\\"100vw\\\" loading=\\\"lazy\\\"></picture><div class=\\\"image-link-expand\\\"><div class=\\\"pencraft pc-display-flex pc-gap-8 pc-reset\\\"><div class=\\\"pencraft pc-reset icon-container restack-image\\\"><svg role=\\\"img\\\" width=\\\"24\\\" height=\\\"24\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke-width=\\\"1.8\\\" stroke=\\\"#000\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\"><g><title></title><path d=\\\"M21 3V8M21 8H16M21 8L18 5.29962C16.7056 4.14183 15.1038 3.38328 13.3879 3.11547C11.6719 2.84766 9.9152 3.08203 8.32951 3.79031C6.74382 4.49858 5.39691 5.65051 4.45125 7.10715C3.5056 8.5638 3.00158 10.2629 3 11.9996M3 21V16M3 16H8M3 16L6 18.7C7.29445 19.8578 8.89623 20.6163 10.6121 20.8841C12.3281 21.152 14.0848 20.9176 15.6705 20.2093C17.2562 19.501 18.6031 18.3491 19.5487 16.8925C20.4944 15.4358 20.9984 13.7367 21 12\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"></path></g></svg></div><div class=\\\"pencraft pc-reset icon-container view-image\\\"><svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"20\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" class=\\\"lucide lucide-maximize2\\\"><polyline points=\\\"15 3 21 3 21 9\\\"></polyline><polyline points=\\\"9 21 3 21 3 15\\\"></polyline><line x1=\\\"21\\\" x2=\\\"14\\\" y1=\\\"3\\\" y2=\\\"10\\\"></line><line x1=\\\"3\\\" x2=\\\"10\\\" y1=\\\"21\\\" y2=\\\"14\\\"></line></svg></div></div></div></div></a><figcaption class=\\\"image-caption\\\">Register New SEH</figcaption></figure></div><p>In the last block of the <code>unpack_shellcode</code> function, before the return, the SEH is reset back to the previous handler. This occurs right after a junk call to <code>LoadLibraryW</code> from which no functions are subsequently resolved.</p><div class=\\\"captioned-image-container\\\"><figure><a class=\\\"image-link image2\\\" target=\\\"_blank\\\" href=\\\"https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F687c0682-ef02-4251-8aba-b60016f085de_1182x415.png\\\" data-component-name=\\\"Image2ToDOM\\\"><div class=\\\"image2-inset\\\"><picture><source type=\\\"image/webp\\\" srcset=\\\"https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F687c0682-ef02-4251-8aba-b60016f085de_1182x415.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F687c0682-ef02-4251-8aba-b60016f085de_1182x415.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F687c0682-ef02-4251-8aba-b60016f085de_1182x415.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F687c0682-ef02-4251-8aba-b60016f085de_1182x415.png 1456w\\\" sizes=\\\"100vw\\\"><img src=\\\"https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F687c0682-ef02-4251-8aba-b60016f085de_1182x415.png\\\" width=\\\"598\\\" height=\\\"209.95769881556683\\\" data-attrs=\\\"{&quot;src&quot;:&quot;https://bucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com/public/images/687c0682-ef02-4251-8aba-b60016f085de_1182x415.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:415,&quot;width&quot;:1182,&quot;resizeWidth&quot;:598,&quot;bytes&quot;:128386,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null,&quot;isProcessing&quot;:false}\\\" class=\\\"sizing-normal\\\" alt=\\\"\\\" srcset=\\\"https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F687c0682-ef02-4251-8aba-b60016f085de_1182x415.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F687c0682-ef02-4251-8aba-b60016f085de_1182x415.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F687c0682-ef02-4251-8aba-b60016f085de_1182x415.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F687c0682-ef02-4251-8aba-b60016f085de_1182x415.png 1456w\\\" sizes=\\\"100vw\\\" loading=\\\"lazy\\\"></picture><div></div></div></a><figcaption class=\\\"image-caption\\\">Last Block of <code>unpack_shellcode</code></figcaption></figure></div><h2>Decode Function</h2><div class=\\\"captioned-image-container\\\"><figure><a class=\\\"image-link image2 is-viewable-img\\\" target=\\\"_blank\\\" href=\\\"https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F815bc94f-494e-473b-95df-9d6b84992ac4_1578x1811.png\\\" data-component-name=\\\"Image2ToDOM\\\"><div class=\\\"image2-inset\\\"><picture><source type=\\\"image/webp\\\" srcset=\\\"https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F815bc94f-494e-473b-95df-9d6b84992ac4_1578x1811.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F815bc94f-494e-473b-95df-9d6b84992ac4_1578x1811.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F815bc94f-494e-473b-95df-9d6b84992ac4_1578x1811.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F815bc94f-494e-473b-95df-9d6b84992ac4_1578x1811.png 1456w\\\" sizes=\\\"100vw\\\"><img src=\\\"https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F815bc94f-494e-473b-95df-9d6b84992ac4_1578x1811.png\\\" width=\\\"578\\\" height=\\\"663.3502747252747\\\" data-attrs=\\\"{&quot;src&quot;:&quot;https://bucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com/public/images/815bc94f-494e-473b-95df-9d6b84992ac4_1578x1811.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:1671,&quot;width&quot;:1456,&quot;resizeWidth&quot;:578,&quot;bytes&quot;:506937,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null,&quot;isProcessing&quot;:false}\\\" class=\\\"sizing-normal\\\" alt=\\\"\\\" srcset=\\\"https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F815bc94f-494e-473b-95df-9d6b84992ac4_1578x1811.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F815bc94f-494e-473b-95df-9d6b84992ac4_1578x1811.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F815bc94f-494e-473b-95df-9d6b84992ac4_1578x1811.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F815bc94f-494e-473b-95df-9d6b84992ac4_1578x1811.png 1456w\\\" sizes=\\\"100vw\\\" loading=\\\"lazy\\\"></picture><div class=\\\"image-link-expand\\\"><div class=\\\"pencraft pc-display-flex pc-gap-8 pc-reset\\\"><div class=\\\"pencraft pc-reset icon-container restack-image\\\"><svg role=\\\"img\\\" width=\\\"24\\\" height=\\\"24\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke-width=\\\"1.8\\\" stroke=\\\"#000\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\"><g><title></title><path d=\\\"M21 3V8M21 8H16M21 8L18 5.29962C16.7056 4.14183 15.1038 3.38328 13.3879 3.11547C11.6719 2.84766 9.9152 3.08203 8.32951 3.79031C6.74382 4.49858 5.39691 5.65051 4.45125 7.10715C3.5056 8.5638 3.00158 10.2629 3 11.9996M3 21V16M3 16H8M3 16L6 18.7C7.29445 19.8578 8.89623 20.6163 10.6121 20.8841C12.3281 21.152 14.0848 20.9176 15.6705 20.2093C17.2562 19.501 18.6031 18.3491 19.5487 16.8925C20.4944 15.4358 20.9984 13.7367 21 12\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"></path></g></svg></div><div class=\\\"pencraft pc-reset icon-container view-image\\\"><svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"20\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" class=\\\"lucide lucide-maximize2\\\"><polyline points=\\\"15 3 21 3 21 9\\\"></polyline><polyline points=\\\"9 21 3 21 3 15\\\"></polyline><line x1=\\\"21\\\" x2=\\\"14\\\" y1=\\\"3\\\" y2=\\\"10\\\"></line><line x1=\\\"3\\\" x2=\\\"10\\\" y1=\\\"21\\\" y2=\\\"14\\\"></line></svg></div></div></div></div></a><figcaption class=\\\"image-caption\\\">Decode Function (Truncated)</figcaption></figure></div><p>The data is decoded in chunks. So this function has three basic purposes: convert the encoded shellcode size to a chunk count by dividing by 8, wrapping a loop around the call to the <code>decode_chunk</code> function, and then calling that function. In the middle of this function is a very large insertion of dead code wrapped by an opaque predicate. This is highlighted in white in the figure above. It has also been truncated for the screenshot. There are two locations in this function with <a href=\\\"https://github.com/MBCProject/mbc-markdown/blob/master/anti-static-analysis/executable-code-obfuscation.md#:~:text=analysis%20visually%20harder.-,Junk%20Code%20Insertion,-B0032.007\\\">junk code insertion</a> which impedes signature development: at addresses <code>0x4057c1</code> and <code>0x4057cc</code>.</p><p>The chunks are 8 bytes long, therefore at the end of the loop after the call to <code>decode_chunk</code>, 8 is added to the chunk pointer then the chunk count is decremented by one.</p><div class=\\\"captioned-image-container\\\"><figure><a class=\\\"image-link image2\\\" target=\\\"_blank\\\" href=\\\"https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F4d353779-4295-445a-b4c5-4f29724bf8fa_1075x267.png\\\" data-component-name=\\\"Image2ToDOM\\\"><div class=\\\"image2-inset\\\"><picture><source type=\\\"image/webp\\\" srcset=\\\"https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F4d353779-4295-445a-b4c5-4f29724bf8fa_1075x267.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F4d353779-4295-445a-b4c5-4f29724bf8fa_1075x267.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F4d353779-4295-445a-b4c5-4f29724bf8fa_1075x267.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F4d353779-4295-445a-b4c5-4f29724bf8fa_1075x267.png 1456w\\\" sizes=\\\"100vw\\\"><img src=\\\"https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F4d353779-4295-445a-b4c5-4f29724bf8fa_1075x267.png\\\" width=\\\"586\\\" height=\\\"145.5460465116279\\\" data-attrs=\\\"{&quot;src&quot;:&quot;https://bucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com/public/images/4d353779-4295-445a-b4c5-4f29724bf8fa_1075x267.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:267,&quot;width&quot;:1075,&quot;resizeWidth&quot;:586,&quot;bytes&quot;:70157,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null,&quot;isProcessing&quot;:false}\\\" class=\\\"sizing-normal\\\" alt=\\\"\\\" srcset=\\\"https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F4d353779-4295-445a-b4c5-4f29724bf8fa_1075x267.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F4d353779-4295-445a-b4c5-4f29724bf8fa_1075x267.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F4d353779-4295-445a-b4c5-4f29724bf8fa_1075x267.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F4d353779-4295-445a-b4c5-4f29724bf8fa_1075x267.png 1456w\\\" sizes=\\\"100vw\\\" loading=\\\"lazy\\\"></picture><div></div></div></a><figcaption class=\\\"image-caption\\\">Chunk Decode Loop Control</figcaption></figure></div><h2>Decode Chunk Function</h2><div class=\\\"captioned-image-container\\\"><figure><a class=\\\"image-link image2 is-viewable-img\\\" target=\\\"_blank\\\" href=\\\"https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F1af58b00-5530-4369-9a66-fc90ad0debc5_1081x1547.png\\\" data-component-name=\\\"Image2ToDOM\\\"><div class=\\\"image2-inset\\\"><picture><source type=\\\"image/webp\\\" srcset=\\\"https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F1af58b00-5530-4369-9a66-fc90ad0debc5_1081x1547.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F1af58b00-5530-4369-9a66-fc90ad0debc5_1081x1547.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F1af58b00-5530-4369-9a66-fc90ad0debc5_1081x1547.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F1af58b00-5530-4369-9a66-fc90ad0debc5_1081x1547.png 1456w\\\" sizes=\\\"100vw\\\"><img src=\\\"https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F1af58b00-5530-4369-9a66-fc90ad0debc5_1081x1547.png\\\" width=\\\"508\\\" height=\\\"726.9898242368178\\\" data-attrs=\\\"{&quot;src&quot;:&quot;https://bucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com/public/images/1af58b00-5530-4369-9a66-fc90ad0debc5_1081x1547.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:1547,&quot;width&quot;:1081,&quot;resizeWidth&quot;:508,&quot;bytes&quot;:326966,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null,&quot;isProcessing&quot;:false}\\\" class=\\\"sizing-normal\\\" alt=\\\"\\\" srcset=\\\"https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F1af58b00-5530-4369-9a66-fc90ad0debc5_1081x1547.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F1af58b00-5530-4369-9a66-fc90ad0debc5_1081x1547.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F1af58b00-5530-4369-9a66-fc90ad0debc5_1081x1547.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F1af58b00-5530-4369-9a66-fc90ad0debc5_1081x1547.png 1456w\\\" sizes=\\\"100vw\\\" loading=\\\"lazy\\\"></picture><div class=\\\"image-link-expand\\\"><div class=\\\"pencraft pc-display-flex pc-gap-8 pc-reset\\\"><div class=\\\"pencraft pc-reset icon-container restack-image\\\"><svg role=\\\"img\\\" width=\\\"24\\\" height=\\\"24\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke-width=\\\"1.8\\\" stroke=\\\"#000\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\"><g><title></title><path d=\\\"M21 3V8M21 8H16M21 8L18 5.29962C16.7056 4.14183 15.1038 3.38328 13.3879 3.11547C11.6719 2.84766 9.9152 3.08203 8.32951 3.79031C6.74382 4.49858 5.39691 5.65051 4.45125 7.10715C3.5056 8.5638 3.00158 10.2629 3 11.9996M3 21V16M3 16H8M3 16L6 18.7C7.29445 19.8578 8.89623 20.6163 10.6121 20.8841C12.3281 21.152 14.0848 20.9176 15.6705 20.2093C17.2562 19.501 18.6031 18.3491 19.5487 16.8925C20.4944 15.4358 20.9984 13.7367 21 12\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"></path></g></svg></div><div class=\\\"pencraft pc-reset icon-container view-image\\\"><svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"20\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" class=\\\"lucide lucide-maximize2\\\"><polyline points=\\\"15 3 21 3 21 9\\\"></polyline><polyline points=\\\"9 21 3 21 3 15\\\"></polyline><line x1=\\\"21\\\" x2=\\\"14\\\" y1=\\\"3\\\" y2=\\\"10\\\"></line><line x1=\\\"3\\\" x2=\\\"10\\\" y1=\\\"21\\\" y2=\\\"14\\\"></line></svg></div></div></div></div></a><figcaption class=\\\"image-caption\\\">Decompiled Decode Chunk Function</figcaption></figure></div><p>The <code>decode_chunk</code> function has four opaque predicates that each wrap dead code, and there are two locations with junk code insertion. In addition to these, the logic of the function is quite convoluted. However, after patching out all of the opaque predicates, dead code, and junk code, a cleaner decompilation graph can be analyzed. The figure above is that graph, fully annotated and cleaned up.</p><p>There are three tiny functions called during the decoding algorithm: <code>load_data_keyB</code>, <code>add_key4</code>, and, <code>xor_mix</code>. These simply isolate small pieces of the algorithm to impede analysis and make signature development more difficult.</p><div class=\\\"captioned-image-container\\\"><figure><a class=\\\"image-link image2 is-viewable-img\\\" target=\\\"_blank\\\" href=\\\"https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F1d2e540c-d4c4-4163-bb9b-d85d529a4b86_1132x890.png\\\" data-component-name=\\\"Image2ToDOM\\\"><div class=\\\"image2-inset\\\"><picture><source type=\\\"image/webp\\\" srcset=\\\"https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F1d2e540c-d4c4-4163-bb9b-d85d529a4b86_1132x890.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F1d2e540c-d4c4-4163-bb9b-d85d529a4b86_1132x890.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F1d2e540c-d4c4-4163-bb9b-d85d529a4b86_1132x890.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F1d2e540c-d4c4-4163-bb9b-d85d529a4b86_1132x890.png 1456w\\\" sizes=\\\"100vw\\\"><img src=\\\"https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F1d2e540c-d4c4-4163-bb9b-d85d529a4b86_1132x890.png\\\" width=\\\"518\\\" height=\\\"407.26148409893995\\\" data-attrs=\\\"{&quot;src&quot;:&quot;https://bucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com/public/images/1d2e540c-d4c4-4163-bb9b-d85d529a4b86_1132x890.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:890,&quot;width&quot;:1132,&quot;resizeWidth&quot;:518,&quot;bytes&quot;:199304,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null,&quot;isProcessing&quot;:false}\\\" class=\\\"sizing-normal\\\" alt=\\\"\\\" srcset=\\\"https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F1d2e540c-d4c4-4163-bb9b-d85d529a4b86_1132x890.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F1d2e540c-d4c4-4163-bb9b-d85d529a4b86_1132x890.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F1d2e540c-d4c4-4163-bb9b-d85d529a4b86_1132x890.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2F1d2e540c-d4c4-4163-bb9b-d85d529a4b86_1132x890.png 1456w\\\" sizes=\\\"100vw\\\" loading=\\\"lazy\\\"></picture><div class=\\\"image-link-expand\\\"><div class=\\\"pencraft pc-display-flex pc-gap-8 pc-reset\\\"><div class=\\\"pencraft pc-reset icon-container restack-image\\\"><svg role=\\\"img\\\" width=\\\"24\\\" height=\\\"24\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke-width=\\\"1.8\\\" stroke=\\\"#000\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\"><g><title></title><path d=\\\"M21 3V8M21 8H16M21 8L18 5.29962C16.7056 4.14183 15.1038 3.38328 13.3879 3.11547C11.6719 2.84766 9.9152 3.08203 8.32951 3.79031C6.74382 4.49858 5.39691 5.65051 4.45125 7.10715C3.5056 8.5638 3.00158 10.2629 3 11.9996M3 21V16M3 16H8M3 16L6 18.7C7.29445 19.8578 8.89623 20.6163 10.6121 20.8841C12.3281 21.152 14.0848 20.9176 15.6705 20.2093C17.2562 19.501 18.6031 18.3491 19.5487 16.8925C20.4944 15.4358 20.9984 13.7367 21 12\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\"></path></g></svg></div><div class=\\\"pencraft pc-reset icon-container view-image\\\"><svg xmlns=\\\"http://www.w3.org/2000/svg\\\" width=\\\"20\\\" height=\\\"20\\\" viewBox=\\\"0 0 24 24\\\" fill=\\\"none\\\" stroke=\\\"currentColor\\\" stroke-width=\\\"2\\\" stroke-linecap=\\\"round\\\" stroke-linejoin=\\\"round\\\" class=\\\"lucide lucide-maximize2\\\"><polyline points=\\\"15 3 21 3 21 9\\\"></polyline><polyline points=\\\"9 21 3 21 3 15\\\"></polyline><line x1=\\\"21\\\" x2=\\\"14\\\" y1=\\\"3\\\" y2=\\\"10\\\"></line><line x1=\\\"3\\\" x2=\\\"10\\\" y1=\\\"21\\\" y2=\\\"14\\\"></line></svg></div></div></div></div></a><figcaption class=\\\"image-caption\\\">Algorithm Isolates</figcaption></figure></div><h2>Shift Shellcode OEP Function</h2><div class=\\\"captioned-image-container\\\"><figure><a class=\\\"image-link image2\\\" target=\\\"_blank\\\" href=\\\"https://substackcdn.com/image/fetch/f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fba1a1065-4d5e-499c-a529-9417c7dcd8cf_1064x434.png\\\" data-component-name=\\\"Image2ToDOM\\\"><div class=\\\"image2-inset\\\"><picture><source type=\\\"image/webp\\\" srcset=\\\"https://substackcdn.com/image/fetch/w_424,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fba1a1065-4d5e-499c-a529-9417c7dcd8cf_1064x434.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fba1a1065-4d5e-499c-a529-9417c7dcd8cf_1064x434.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fba1a1065-4d5e-499c-a529-9417c7dcd8cf_1064x434.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_webp,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fba1a1065-4d5e-499c-a529-9417c7dcd8cf_1064x434.png 1456w\\\" sizes=\\\"100vw\\\"><img src=\\\"https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fba1a1065-4d5e-499c-a529-9417c7dcd8cf_1064x434.png\\\" width=\\\"534\\\" height=\\\"217.81578947368422\\\" data-attrs=\\\"{&quot;src&quot;:&quot;https://bucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com/public/images/ba1a1065-4d5e-499c-a529-9417c7dcd8cf_1064x434.png&quot;,&quot;srcNoWatermark&quot;:null,&quot;fullscreen&quot;:null,&quot;imageSize&quot;:null,&quot;height&quot;:434,&quot;width&quot;:1064,&quot;resizeWidth&quot;:534,&quot;bytes&quot;:115377,&quot;alt&quot;:null,&quot;title&quot;:null,&quot;type&quot;:&quot;image/png&quot;,&quot;href&quot;:null,&quot;belowTheFold&quot;:true,&quot;topImage&quot;:false,&quot;internalRedirect&quot;:null,&quot;isProcessing&quot;:false}\\\" class=\\\"sizing-normal\\\" alt=\\\"\\\" srcset=\\\"https://substackcdn.com/image/fetch/w_424,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fba1a1065-4d5e-499c-a529-9417c7dcd8cf_1064x434.png 424w, https://substackcdn.com/image/fetch/w_848,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fba1a1065-4d5e-499c-a529-9417c7dcd8cf_1064x434.png 848w, https://substackcdn.com/image/fetch/w_1272,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fba1a1065-4d5e-499c-a529-9417c7dcd8cf_1064x434.png 1272w, https://substackcdn.com/image/fetch/w_1456,c_limit,f_auto,q_auto:good,fl_progressive:steep/https%3A%2F%2Fbucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com%2Fpublic%2Fimages%2Fba1a1065-4d5e-499c-a529-9417c7dcd8cf_1064x434.png 1456w\\\" sizes=\\\"100vw\\\" loading=\\\"lazy\\\"></picture><div></div></div></a><figcaption class=\\\"image-caption\\\">Shift Shellcode OEP Function</figcaption></figure></div><p>The <code>shift_shellcode_oep</code> function is very simple. It adds <code>0x3bf1</code> to the address of the start of the decoded shellcode in allocated memory. This shifts the pointer from the start of the decoded data to the offset of the OEP. This is the address that is called in the main function.</p><h1>Recommendations</h1><p>This packer is polymorphic. Variants and builds share many of the same functionality, behavior, and code features. However, they are in different order with randomization of opaque predicates, junk code, and dead code. In spite of this, detection can be achieved by focusing on the two stretches of stable bytes which were identified above. The following two YARA rules match these bytes.</p><pre><code>rule Packer_pkr_ce1a_ShellcodeSizePart\\n{\\n    meta:\\n        author = \\\"Malwarology LLC\\\"\\n        date = \\\"2022-10-14\\\"\\n        description = \\\"Detects bytes surrounding the first part of the data size of the second stage shellcode in Packer pkr_ce1a.\\\"\\n        reference = \\\"https://malwarology.substack.com/p/malicious-packer-pkr_ce1a\\\"\\n        sharing = \\\"TLP:CLEAR\\\"\\n        exemplar = \\\"fc04e80d343f5929aea4aac77fb12485c7b07b3a3d2fc383d68912c9ad0666da\\\"\\n        address = \\\"0x41cc3c\\\"\\n        packer = \\\"pkr_ce1a\\\"\\n    strings:\\n        $a = { 00699AF974[4]96AACB4600 }\\n    condition:\\n        $a and\\n        uint16(0) == 0x5A4D and\\n        uint32(uint32(0x3C)) == 0x00004550\\n}</code></pre><pre><code>rule Packer_pkr_ce1a_ShellcodeAddrPart\\n{\\n    meta:\\n        author = \\\"Malwarology LLC\\\"\\n        date = \\\"2022-10-17\\\"\\n        description = \\\"Detects bytes surrounding the first part of the address of the second stage shellcode in Packer pkr_ce1a.\\\"\\n        reference = \\\"https://malwarology.substack.com/p/malicious-packer-pkr_ce1a\\\"\\n        sharing = \\\"TLP:CLEAR\\\"\\n        exemplar = \\\"fc04e80d343f5929aea4aac77fb12485c7b07b3a3d2fc383d68912c9ad0666da\\\"\\n        address = \\\"0x41bc9c\\\"\\n        packer = \\\"pkr_ce1a\\\"\\n    strings:\\n        $a = { 0094488D6A[4]F2160B6800 }\\n    condition:\\n        $a and\\n        uint16(0) == 0x5A4D and\\n        uint32(uint32(0x3C)) == 0x00004550\\n}</code></pre><h1>Supporting Data and IOCs</h1><h2>File</h2><ul><li><p><code>Filename: 6523.exe</code></p></li><li><p><code>Filename: povgwaoci.iwe</code></p></li><li><p><code>MD5: 5663a767ac9d9b9efde3244125509cf3</code></p></li><li><p><code>SHA1: 84f383a3ddb9f073655e1f6383b9c1d015e26524</code></p></li><li><p><code>SHA25: fc04e80d343f5929aea4aac77fb12485c7b07b3a3d2fc383d68912c9ad0666da</code></p></li><li><p><code>Imphash: bc57832ec1fddf960b28fd6e06cc17ba</code></p></li><li><p><code>Timestamp: 2022-02-16T10:14:32Z</code></p></li><li><p><code>File Type: Win32 EXE</code></p></li><li><p><code>Magic: PE32 executable (GUI) Intel 80386, for MS Windows</code></p></li><li><p><code>Size: 238080</code></p></li><li><p><code>First Seen: 2022-10-14T18:37:13Z</code><a class=\\\"footnote-anchor\\\" data-component-name=\\\"FootnoteAnchorToDOM\\\" id=\\\"footnote-anchor-4\\\" href=\\\"#footnote-4\\\" target=\\\"_self\\\">4</a></p></li></ul><h2>Distribution URL</h2><ul><li><p><code>hxxp[://]guluiiiimnstrannaer[.]net/dl/6523.exe</code></p></li></ul><h2>Malware Behavior Catalog</h2><ul><li><p>DEFENSE EVASION::Software Packing [F0001]</p></li><li><p>ANTI-BEHAVIORAL ANALYSIS::Emulator Evasion::Undocumented Opcodes [B0005.002]</p></li><li><p>ANTI-BEHAVIORAL ANALYSIS::Emulator Evasion::Unusual/Undocumented API Calls [B0005.003]</p></li><li><p>ANTI-BEHAVIORAL ANALYSIS::Emulator Evasion::Extra Loops/Time Locks [B0005.004]</p></li><li><p>ANTI-STATIC ANALYSIS::Disassembler Evasion::Argument Obfuscation [B0012.001]</p></li><li><p>ANTI-STATIC ANALYSIS::Disassembler Evasion::Variable Recomposition [B0012.004]</p></li><li><p>ANTI-STATIC ANALYSIS::Executable Code Obfuscation::Dead Code Insertion [B0032.003]</p></li><li><p>ANTI-STATIC ANALYSIS::Executable Code Obfuscation::Junk Code Insertion [B0032.007]</p></li><li><p>ANTI-STATIC ANALYSIS::Executable Code Obfuscation::Interleaving Code [B0032.014]</p></li></ul><h2>Malware Behavior Catalog Proposed Methods</h2><ul><li><p>ANTI-BEHAVIORAL ANALYSIS::Emulator Evasion::Unimplemented Opcodes [B0005]</p></li><li><p>ANTI-STATIC ANALYSIS::Executable Code Obfuscation::Opaque Predicate [B0032]</p></li><li><p>ANTI-STATIC ANALYSIS::Executable Code Obfuscation::Function Call Obfuscation [B0032]</p></li></ul><h2>Analyses</h2><ul><li><p><a href=\\\"https://analyze.intezer.com/analyses/4ae9acb6-01f0-4ff5-89bf-c967349e08f9\\\">Intezer</a></p></li><li><p><a href=\\\"https://www.unpac.me/results/a6d0217d-02c0-4db8-9186-fc0d99137789/\\\">UnpacMe</a></p></li></ul><div class=\\\"footnote\\\" data-component-name=\\\"FootnoteToDOM\\\"><a id=\\\"footnote-1\\\" href=\\\"#footnote-anchor-1\\\" class=\\\"footnote-number\\\" contenteditable=\\\"false\\\" target=\\\"_self\\\">1</a><div class=\\\"footnote-content\\\"><p><a href=\\\"https://bazaar.abuse.ch/sample/fc04e80d343f5929aea4aac77fb12485c7b07b3a3d2fc383d68912c9ad0666da#:~:text=Sample%20downloaded%20from\\\">Sample downloaded from hxxp[://]guluiiiimnstrannaer[.]net/dl/6523.exe</a></p></div></div><div class=\\\"footnote\\\" data-component-name=\\\"FootnoteToDOM\\\"><a id=\\\"footnote-2\\\" href=\\\"#footnote-anchor-2\\\" class=\\\"footnote-number\\\" contenteditable=\\\"false\\\" target=\\\"_self\\\">2</a><div class=\\\"footnote-content\\\"><p><code>Imphash: bc57832ec1fddf960b28fd6e06cc17ba</code></p></div></div><div class=\\\"footnote\\\" data-component-name=\\\"FootnoteToDOM\\\"><a id=\\\"footnote-3\\\" href=\\\"#footnote-anchor-3\\\" class=\\\"footnote-number\\\" contenteditable=\\\"false\\\" target=\\\"_self\\\">3</a><div class=\\\"footnote-content\\\"><p><a href=\\\"https://learn.microsoft.com/en-us/windows/win32/api/winbase/nf-winbase-localalloc\\\">LocalAlloc function (winbase.h)</a></p></div></div><div class=\\\"footnote\\\" data-component-name=\\\"FootnoteToDOM\\\"><a id=\\\"footnote-4\\\" href=\\\"#footnote-anchor-4\\\" class=\\\"footnote-number\\\" contenteditable=\\\"false\\\" target=\\\"_self\\\">4</a><div class=\\\"footnote-content\\\"><p>VirusTotal</p></div></div>\",\"truncated_body_text\":\"Summary\",\"wordcount\":2092,\"postTags\":[],\"postCountryBlocks\":[],\"coverImagePalette\":{\"Vibrant\":{\"rgb\":[204,36,4],\"population\":160},\"DarkVibrant\":{\"rgb\":[130.05,22.95,2.5500000000000025],\"population\":0},\"LightVibrant\":{\"rgb\":[186,146,98],\"population\":9},\"Muted\":{\"rgb\":[100,177,182],\"population\":3},\"DarkMuted\":{\"rgb\":[81,70,54],\"population\":139},\"LightMuted\":{\"rgb\":[123,158,164],\"population\":109}},\"publishedBylines\":[{\"id\":97072969,\"name\":\"Malwarology LLC\",\"handle\":\"malwarology\",\"previous_name\":null,\"photo_url\":\"https://bucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com/public/images/2c74d94f-2add-4298-97f6-c9e6bc6bd1c5_2484x2204.png\",\"bio\":null,\"profile_set_up_at\":\"2022-06-22T04:36:21.674Z\",\"publicationUsers\":[{\"id\":891478,\"user_id\":97072969,\"publication_id\":947576,\"role\":\"admin\",\"public\":true,\"is_primary\":false,\"publication\":{\"id\":947576,\"name\":\"Malwarology Research\",\"subdomain\":\"malwarology\",\"custom_domain\":null,\"custom_domain_optional\":false,\"hero_text\":\"A newsletter about malware reverse engineering, malware analysis, and threat intelligence. This includes formal deep dive reports on malware families, analysis tools and techniques tutorials, and as-it-happens research project progress updates.\",\"logo_url\":\"https://bucketeer-e05bbc84-baa3-437e-9518-adb32be77984.s3.amazonaws.com/public/images/aaa855c0-e07d-47f9-9daa-5cbabdbf5eb3_256x256.png\",\"author_id\":97072969,\"theme_var_background_pop\":\"#EA410B\",\"created_at\":\"2022-06-22T04:36:57.924Z\",\"rss_website_url\":null,\"email_from_name\":\"Malwarology LLC\",\"copyright\":\"Malwarology LLC\",\"founding_plan_name\":\"Advanced Member\",\"community_enabled\":false,\"invite_only\":false,\"payments_state\":\"paused\",\"language\":null,\"explicit\":false,\"is_personal_mode\":false}}],\"twitter_screen_name\":\"malwarology\",\"is_guest\":false,\"bestseller_tier\":null}],\"reaction\":null,\"reaction_count\":0,\"comment_count\":0,\"child_comment_count\":0,\"is_geoblocked\":false,\"hasCashtag\":false},\"comments\":[],\"canonicalUrl\":\"https://malwarology.substack.com/p/malicious-packer-pkr_ce1a\",\"inlineComments\":false,\"readerIsSearchCrawler\":false,\"ogUrl\":\"https://malwarology.substack.com/p/malicious-packer-pkr_ce1a\",\"bannedFromNotes\":false,\"themeVariables\":{\"color_theme_bg_pop\":\"#2C44A0\",\"background_pop\":\"#2C44A0\",\"color_theme_bg_web\":null,\"cover_bg_color\":\"#FFFFFF\",\"background_pop_darken\":\"#273b8c\",\"print_on_pop\":\"#ffffff\",\"color_theme_bg_pop_darken\":\"#273b8c\",\"color_theme_print_on_pop\":\"#ffffff\",\"border_subtle\":\"rgba(204, 204, 204, 0.5)\",\"background_subtle\":\"rgba(223, 227, 241, 0.4)\",\"print_pop\":\"#2c44a0\",\"color_theme_accent\":\"#2c44a0\",\"cover_print_primary\":\"#363737\",\"cover_print_secondary\":\"#757575\",\"cover_print_tertiary\":\"#b6b6b6\",\"cover_border_color\":\"#2c44a0\",\"home_hero\":\"newspaper\",\"home_posts\":\"list\",\"web_bg_color\":\"#ffffff\",\"background_contrast_1\":\"#f0f0f0\",\"color_theme_bg_contrast_1\":\"#f0f0f0\",\"background_contrast_2\":\"#dddddd\",\"color_theme_bg_contrast_2\":\"#dddddd\",\"background_contrast_3\":\"#b7b7b7\",\"color_theme_bg_contrast_3\":\"#b7b7b7\",\"background_contrast_4\":\"#929292\",\"color_theme_bg_contrast_4\":\"#929292\",\"background_contrast_5\":\"#515151\",\"color_theme_bg_contrast_5\":\"#515151\",\"color_theme_detail\":\"#e6e6e6\",\"background_contrast_pop\":\"rgba(44, 68, 160, 0.4)\",\"color_theme_bg_contrast_pop\":\"rgba(44, 68, 160, 0.4)\",\"input_background\":\"#ffffff\",\"cover_input_background\":\"#ffffff\",\"tooltip_background\":\"#191919\",\"web_bg_color_h\":\"0\",\"web_bg_color_s\":\"0%\",\"web_bg_color_l\":\"100%\",\"print_on_web_bg_color\":\"#363737\",\"print_secondary_on_web_bg_color\":\"#868787\",\"selected_comment_background_color\":\"#fdf9f3\",\"background_pop_rgb\":\"44, 68, 160\",\"background_pop_rgb_pc\":\"44 68 160\",\"color_theme_bg_pop_rgb\":\"44, 68, 160\",\"color_theme_bg_pop_rgb_pc\":\"44 68 160\",\"color_theme_accent_rgb\":\"44, 68, 160\",\"color_theme_accent_rgb_pc\":\"44 68 160\"},\"recentEpisodes\":null,\"trackFrontendVisit\":true,\"showHolidayGiftingHeader\":false,\"isChatActive\":false,\"isMeetingsActive\":false,\"hasViralGiftsCount\":0,\"features\":{},\"showCookieBanner\":false,\"disabledCookies\":[],\"dd_env\":\"prod\",\"dd_ti\":true}")</script>
        <script>window._analyticsConfig = JSON.parse("{\"properties\":{\"subdomain\":\"malwarology\",\"publication_id\":947576,\"has_plans\":false,\"pub_community_enabled\":false,\"is_personal_publication\":false,\"is_subscribed\":false,\"is_free_subscribed\":false,\"is_author\":false,\"is_contributor\":false,\"is_admin\":false,\"is_founding\":false},\"adwordsAccountId\":\"AW-316245675\",\"adwordsEventSendTo\":\"Tf76CKqcyL4DEKuN5pYB\"}")</script>

        
            <script type="module" src="https://substackcdn.com/bundle/assets/main-fad78344.js" charset="utf-8"  defer></script>
        
        
        <script nomodule>
            (function() {
                var message = 'Your browser does not support modern JavaScript modules. Please upgrade your browser for the best experience.';
                var warningDiv = document.createElement('div');
                warningDiv.style.color = 'red';
                warningDiv.style.padding = '10px';
                warningDiv.style.margin = '10px 0';
                warningDiv.style.border = '1px solid red';
                warningDiv.style.backgroundColor = 'lightyellow';
                warningDiv.innerText = message;
                document.body.prepend(warningDiv);
            })();
        </script>

        
            <!-- Datadog Analytics -->
            <script>
              (function(h,o,u,n,d) {
                h=h[d]=h[d]||{q:[],onReady:function(c){h.q.push(c)}}
                d=o.createElement(u);d.async=1;d.src=n
                n=o.getElementsByTagName(u)[0];n.parentNode.insertBefore(d,n)
              })(window,document,'script','https://www.datadoghq-browser-agent.com/us1/v5/datadog-rum.js','DD_RUM')
              window.DD_RUM.onReady(function() {
                window.DD_RUM.init({
                  clientToken: 'puba71073f072643721169b68f352438710',
                  applicationId: '2e321b35-c76b-4073-8d04-cc9a10461793',
                  site: 'datadoghq.com',
                  service: 'substack-web',
                  env: window._preloads.dd_env,
                  version: '867cbc1b581d8ad1ebcb5bbfc85f99f4be00a17e',
                  sessionSampleRate: 1,
                  sessionReplaySampleRate: 100,
                  trackUserInteractions: window._preloads.dd_ti,
                  trackResources: true,
                  trackLongTasks: true,
                  defaultPrivacyLevel: 'mask-user-input',
                  allowedTracingUrls: [/https?:\/\/(.+\/.)?substack(cdn)?\.com/]
                });
              })
            </script>
            <!-- End Datadog Analytics -->

            <!-- Cloudflare Web Analytics -->
            <script defer src="https://static.cloudflareinsights.com/beacon.min.js" data-cf-beacon='{"token": "216309cffb464db4b0e02daf0b8e8060"}'></script>
            <!-- End Cloudflare Web Analytics -->
        

        <!-- Fallback tracking pixels -->
        

        

        <noscript>
    <style>
        #nojs-banner {
            position: fixed;
            bottom: 0;
            left: 0;
            padding: 16px 16px 16px 32px;
            width: 100%;
            box-sizing: border-box;
            background: red;
            color: white;
            font-family: -apple-system, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
            font-size: 13px;
            line-height: 13px;
        }
        #nojs-banner a {
            color: inherit;
            text-decoration: underline;
        }
    </style>

    <div id="nojs-banner">
        This site requires JavaScript to run correctly. Please <a href="https://enable-javascript.com/" target="_blank">turn on JavaScript</a> or unblock scripts
    </div>
</noscript>


        

        

        
        
    </body>
</html>
