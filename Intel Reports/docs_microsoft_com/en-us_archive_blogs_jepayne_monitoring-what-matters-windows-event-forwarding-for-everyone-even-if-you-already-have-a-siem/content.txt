<!DOCTYPE html><html
	class="hasSidebar hasPageActions hasBreadcrumb conceptual has-default-focus theme-light"
	lang="en-us"
	dir="ltr"
	data-authenticated="false"
	data-auth-status-determined="false"
	data-target="docs"
	x-ms-format-detection="none">

<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0" />
	<meta property="og:title" content="Monitoring what matters - Windows Event Forwarding for everyone (even if you already have a SIEM.)" />
	<meta property="og:type" content="website" />
	<meta property="og:url" content="https://learn.microsoft.com/en-us/archive/blogs/jepayne/monitoring-what-matters-windows-event-forwarding-for-everyone-even-if-you-already-have-a-siem" /><meta property="og:image" content="https://learn.microsoft.com/en-us/media/open-graph-image.png" />

	<meta property="og:image:alt" content="Microsoft Learn" />

	<meta name="twitter:card" content="summary_large_image" />

	<meta name="twitter:site" content="@MicrosoftLearn" />

	<meta name="color-scheme" content="light dark"><meta name="archived_blog_id" content="125401" />
<meta name="archived_blog_orig_url" content="https://blogs.technet.microsoft.com/jepayne" />
<meta name="archived_blog_post_id" content="51" />
<meta name="author" content="kexugit" />
<meta name="breadcrumb_path" content="/archive/blogs/bread/toc.json" />
<meta name="depot_name" content="MSDN.blogs-archive" />
<meta name="document_id" content="83a2b2e7-6b16-55ab-ab8c-fef12b28034b" />
<meta name="document_version_independent_id" content="4770cc02-21f6-7e54-ae92-2a55467b4293" />
<meta name="feedback_help_link_type" content="" />
<meta name="feedback_help_link_url" content="" />
<meta name="feedback_product_url" content="" />
<meta name="feedback_system" content="None" />
<meta name="git_commit_id" content="5019655ffa733bb8ab1266cc2a6a7b70a1ecdfa6" />
<meta name="gitcommit" content="https://docs-archive.visualstudio.com/DefaultCollection/docs-archive-project/_git/blogs-archive-pr/commit/5019655ffa733bb8ab1266cc2a6a7b70a1ecdfa6?path=/blogs-archive/jepayne/monitoring-what-matters-windows-event-forwarding-for-everyone-even-if-you-already-have-a-siem.md&amp;_a=contents" />
<meta name="is_archived" content="true" />
<meta name="locale" content="en-us" />
<meta name="ms.author" content="Archiveddocs" />
<meta name="ms.date" content="11/23/2015" />
<meta name="ms.topic" content="Archived" />
<meta name="original_content_git_url" content="https://docs-archive.visualstudio.com/DefaultCollection/docs-archive-project/_git/blogs-archive-pr?path=/blogs-archive/jepayne/monitoring-what-matters-windows-event-forwarding-for-everyone-even-if-you-already-have-a-siem.md&amp;version=GBlive&amp;_a=contents" />
<meta name="page_type" content="conceptual" />
<meta name="ROBOTS" content="NOINDEX,NOFOLLOW" />
<meta name="schema" content="Conceptual" />
<meta name="site_name" content="Docs" />
<meta name="toc_rel" content="toc.json" />
<meta name="uhfHeaderId" content="MSDocsHeader-Archive" />
<meta name="updated_at" content="2024-09-25 03:21 AM" />
<meta name="word_count" content="4286" />
<meta name="persistent_id" content="98af2254-9198-ce12-4eb9-f3a38b3c1f45" />
	<meta name="scope" content="Blogs" /><meta name="github_feedback_content_git_url" content="https://docs-archive.visualstudio.com/DefaultCollection/docs-archive-project/_git/blogs-archive-pr?path=/blogs-archive/jepayne/monitoring-what-matters-windows-event-forwarding-for-everyone-even-if-you-already-have-a-siem.md&version=GBlive&_a=contents" /><link href="https://learn.microsoft.com/en-us/archive/blogs/jepayne/monitoring-what-matters-windows-event-forwarding-for-everyone-even-if-you-already-have-a-siem" rel="canonical"><title>Monitoring what matters - Windows Event Forwarding for everyone (even if you already have a SIEM.) | Microsoft Learn</title><link rel="stylesheet" href="/static/assets/0.4.028516059/styles/site-ltr.css">

	<script id="msdocs-script">
	var msDocs = {environment: {
			supportLevel: 'production',
			accessLevel: 'online',
			reviewFeatures: false,
			systemContent: true,
			azurePortalHostname: 'portal.azure.com',
			legacyHosting: false,
			siteName: 'learn',
		},data: {
			timeOrigin: Date.now(),
			contentLocale: 'en-us',
			contentDir: 'ltr',
			userLocale: 'en-us',
			userDir: 'ltr',
			pageTemplate: 'Conceptual',
			brand: '',
			context: {},
			hasBinaryRating: false,
			feedbackHelpLinkType:'',
			feedbackHelpLinkUrl:'',
			standardFeedback: false,
			showFeedbackReport: false,
			enableTutorialFeedback: false,
			feedbackSystem: 'None',
			feedbackGitHubRepo: '',
			feedbackProductUrl: '',extendBreadcrumb: false,isEditDisplayable: false,
			hideViewSource: false,
			hasPageActions: true,
			hasPrintButton: true,
			hasBookmark: true,
			hasShare: true,
			isPermissioned: false,
			isPrivateUnauthorized: false,hasRecommendations: true,},
		functions:{}
	};
	</script><script src="https://wcpstatic.microsoft.com/mscc/lib/v2/wcp-consent.js"></script>
	<script src="https://js.monitor.azure.com/scripts/c/ms.jsll-4.min.js"></script><script src="/static/assets/0.4.028516059/global/deprecation.js"></script><script src="/static/assets/0.4.028516059/scripts/en-us/index-docs.js"></script></head>

<body lang="en-us" dir="ltr">
	<div class="header-holder has-default-focus">
		<a href="#main" class="skip-to-main-link has-outline-color-text visually-hidden-until-focused position-fixed has-inner-focus focus-visible top-0 left-0 right-0 padding-xs has-text-centered has-body-background" tabindex="1">Skip to main content</a><div hidden id="cookie-consent-holder" data-test-id="cookie-consent-container"></div>

		<div id="unsupported-browser" style="
			background-color: white;
			color: black;
			padding: 16px;
			border-bottom: 1px solid grey;"
			hidden
		>
			<div style="max-width: 800px; margin: 0 auto;">
				<p style="font-size: 24px">This browser is no longer supported.</p>
				<p style="font-size: 16px; margin-top: 16px;">Upgrade to Microsoft Edge to take advantage of the latest features, security updates, and technical support.</p>
				<div style="margin-top: 12px;">
					<a href="https://go.microsoft.com/fwlink/p/?LinkID=2092881 "
						style="
						background-color: #0078d4;
						border: 1px solid #0078d4;
						color: white;
						padding: 6px 12px;
						border-radius: 2px;
						display: inline-block;
						">Download Microsoft Edge</a>
					<a href="https://learn.microsoft.com/en-us/lifecycle/faq/internet-explorer-microsoft-edge"
						style="
							background-color: white;
							padding: 6px 12px;
							border: 1px solid #505050;
							color: #171717;
							border-radius: 2px;
							display: inline-block;
							">More info about Internet Explorer and Microsoft Edge</a>
				</div>
			</div>
		</div>
		<!-- liquid-tag banners global -->

		<!-- site header -->
		<header id="ms--site-header" data-test-id="site-header-wrapper" role="banner" itemscope="itemscope" itemtype="http://schema.org/Organization">
			<div id="ms--mobile-nav" class="site-header display-none-tablet padding-inline-none gap-none" data-bi-name="mobile-header" data-test-id="mobile-header"></div>
			<div id="ms--primary-nav" class="site-header display-none display-flex-tablet" data-bi-name="L1-header" data-test-id="primary-header"></div>
			<div id="ms--secondary-nav" class="site-header display-none display-flex-tablet" data-bi-name="L2-header" data-test-id="secondary-header"></div>
		</header><div id="content-header" class="content-header uhf-container has-padding has-default-focus border-bottom-none" data-bi-name="content-header">
				<div class="content-header-controls margin-xxs margin-inline-sm-tablet">
					<button type="button" class="contents-button button button-sm margin-right-xxs" data-bi-name="contents-expand" aria-haspopup="true" data-contents-button>
						<span class="icon"><span class="docon docon-menu" aria-hidden="true"></span></span>
						<span class="contents-expand-title">Table of contents</span>
					</button>
					<button type="button" class="ap-collapse-behavior ap-expanded button button-sm" data-bi-name="ap-collapse" aria-controls="action-panel">
						<span class="icon"><span class="docon docon-exit-mode" aria-hidden="true"></span></span>
						<span>Exit focus mode</span>
					</button>
				</div>
			</div><div id="disclaimer-holder" class="has-overflow-hidden has-default-focus">
			<!-- liquid-tag banners sectional -->
		</div>
	</div>

	<div class="mainContainer  uhf-container has-default-focus" data-bi-name="body">

		<div class="columns has-large-gaps is-gapless-mobile "><div id="left-container" class="left-container is-hidden-mobile column is-one-third-tablet is-one-quarter-desktop">
				<nav id="affixed-left-container" class="margin-top-sm-tablet position-sticky display-flex flex-direction-column" aria-label="Primary"></nav>
			</div><!-- .primary-holder -->
			<section class="primary-holder column is-two-thirds-tablet is-three-quarters-desktop">
				<!--div.columns -->
				<div class="columns is-gapless-mobile has-large-gaps "><div id="main-column" class="column  is-full is-8-desktop">

						<main id="main" class="" role="main" data-bi-name="content" lang="en-us" dir="ltr"><!-- article-header -->
							<div id="article-header" class="background-color-body margin-top-sm-tablet margin-bottom-xs display-none-print">
								<div class="display-flex align-items-center "><details id="article-header-breadcrumbs-overflow-popover" class="popover" data-for="article-header-breadcrumbs">
										<summary class="button button-clear button-primary button-sm inner-focus" aria-label="All breadcrumbs">
											<span class="icon">
												<span class="docon docon-more"></span>
											</span>
										</summary>
										<div id="article-header-breadcrumbs-overflow" class="popover-content padding-none">

										</div>
									</details>

									<bread-crumbs id="article-header-breadcrumbs" data-test-id="article-header-breadcrumbs" class="overflow-hidden flex-grow-1 margin-right-sm margin-right-md-tablet margin-right-lg-desktop margin-left-negative-xxs padding-left-xxs"></bread-crumbs><div id="article-header-page-actions"  class="opacity-none margin-left-auto display-flex flex-wrap-no-wrap align-items-stretch"><a
											id="lang-link-tablet"
											class="button button-primary button-clear button-sm display-none display-inline-flex-tablet"
											title="Read in English" data-bi-name="language-toggle"
											data-read-in-link
											hidden>
											<span class="icon margin-none" aria-hidden="true" data-read-in-link-icon>
												<span class="docon docon-locale-globe"></span>
											</span>
											<span class="is-visually-hidden" data-read-in-link-text>Read in English</span>
										</a><button
												type="button"
												class="collection button button-clear button-sm button-primary display-none display-inline-flex-tablet"
												data-list-type="collection"
												data-bi-name="collection"
												title="Add to collection">
												<span class="icon margin-none" aria-hidden="true">
													<span class="docon docon-circle-addition"></span>
												</span>
												<span class="collection-status is-visually-hidden">Save</span>
											</button>
										<details class="popover popover-right" id="article-header-page-actions-overflow">
											<summary class="justify-content-flex-start button button-clear button-sm button-primary" aria-label="More actions" title="More actions">
												<span class="icon" aria-hidden="true">
													<span class="docon docon-more-vertical"></span>
												</span>
											</summary>
											<div class="popover-content padding-xs"><button
														data-page-action-item="overflow-mobile"
														type="button"
														class="justify-content-flex-start button-block button-sm has-inner-focus button button-clear display-none-tablet"
														data-bi-name="contents-expand"
														data-contents-button
														data-popover-close>
														<span class="icon">
															<span class="docon docon-editor-list-bullet" aria-hidden="true"></span>
														</span><span class="contents-expand-title">Table of contents</span></button><a
													id="lang-link-overflow"
													class="justify-content-flex-start button-sm has-inner-focus button button-clear button-block display-none-tablet"
													title="Read in English" data-bi-name="language-toggle"
													data-page-action-item="overflow-mobile"
													data-check-hidden="true"
													data-read-in-link
													hidden
													>
													<span class="icon" aria-hidden="true" data-read-in-link-icon>
														<span class="docon docon-locale-globe"></span>
													</span>
													<span data-read-in-link-text>Read in English</span>
												</a><button
														type="button"
														class="collection justify-content-flex-start button button-clear button-sm has-inner-focus button-block display-none-tablet"
														data-list-type="collection"
														data-bi-name="collection"
														title="Save"
														data-page-action-item="overflow-mobile"
														data-check-hidden="true"
														data-popover-close>
														<span class="icon" aria-hidden="true">
															<span class="docon docon-circle-addition"></span>
														</span>
														<span class="collection-status">Save</span>
													</button>

			 										
													<button
													 	type="button"
														class="collection justify-content-flex-start button button-clear button-sm has-inner-focus button-block display-none-tablet"
														data-list-type="plan"
														data-bi-name="plan"
														title="Add to Plan"
														data-page-action-item="overflow-mobile"
														data-check-hidden="true"
														data-popover-close
														hidden>
														<span class="icon" aria-hidden="true">
															<span class="docon docon-circle-addition"></span>
														</span>
														<span class="plan-status">Add to Plan</span>
													</button><div aria-hidden="true" class="margin-none" data-page-action-item="overflow-all"></div>
														<hr class="display-none-tablet margin-bottom-xxs margin-top-xxs" />
														<h4 class="font-size-sm padding-left-xxs">Share via</h4>

													<a class="button button-clear button-sm button-block has-inner-focus text-decoration-none justify-content-flex-start share-facebook" data-bi-name="facebook" data-page-action-item="overflow-all">
															<span class="icon" aria-hidden="true">
																<span class="docon docon-facebook-share font-size-md color-primary"></span>
															</span>
															<span class="margin-left-xxs">Facebook</span>
														</a>
														<a class="button button-clear button-sm has-inner-focus button-block text-decoration-none justify-content-flex-start share-twitter" data-bi-name="twitter" data-page-action-item="overflow-all">
															<span class="icon" aria-hidden="true">
																<span class="docon docon-xlogo-share font-size-xxs"></span>
															</span>
															<span class="margin-left-xxs">x.com</span>
														</a>
														<a class="button button-clear button-sm has-inner-focus button-block text-decoration-none justify-content-flex-start share-linkedin" data-bi-name="linkedin" data-page-action-item="overflow-all">
															<span class="icon" aria-hidden="true">
																<span class="docon docon-linked-in-logo font-size-sm color-primary"></span>
															</span>
															<span class="margin-left-xxs">LinkedIn</span>
														</a>
														<a class="button button-clear button-sm button-block has-inner-focus text-decoration-none justify-content-flex-start margin-bottom-xxs share-email" data-bi-name="email" data-page-action-item="overflow-all">
															<span class="icon" aria-hidden="true">
																<span class="docon docon-mail-message font-size-sm color-primary"></span>
															</span>
															<span class="margin-left-xxs">Email</span>
														</a><hr />
													<button
														class="button button-block button-clear button-sm justify-content-flex-start has-inner-focus margin-top-xxs"
														title="Print"
														type="button"
														aria-label="Print"
														data-bi-name="print"
														data-page-action-item="overflow-all"
														data-popover-close
														data-print-page
														data-check-hidden="true">
														<span class="icon" aria-hidden="true">
															<span class="docon docon-print font-size-sm color-primary"></span>
														</span>
														<span class="margin-left-xxs">Print</span>
													</button>
											</div>
										</details>
										
									</div></div>
							</div>
							<!-- end article-header --><div>
								<button type="button" class="border contents-button button button-clear button-sm is-hidden-tablet has-inner-focus" data-bi-name="contents-expand" data-contents-button hidden>
									<span class="icon">
										<span class="docon docon-editor-list-bullet" aria-hidden="true"></span>
									</span><span class="contents-expand-title">Table of contents</span></button>
							</div><!-- end mobile-contents button  -->

							<div class="content "><h1 id="monitoring-what-matters---windows-event-forwarding-for-everyone-even-if-you-already-have-a-siem">Monitoring what matters - Windows Event Forwarding for everyone (even if you already have a SIEM.)</h1><div class="display-flex justify-content-space-between align-items-center flex-wrap-wrap page-metadata-container">
										<div class="margin-right-xxs">
											<ul class="metadata page-metadata" data-bi-name="page info" lang="en-us" dir="ltr"><li>Article</li><li>
														<time class="is-invisible" data-article-date aria-label="Article review date" datetime="2015-11-23T00:00:00.000Z" data-article-date-source="ms.date">11/23/2015</time>
													</li></ul>
										</div></div><nav id="center-doc-outline" class="doc-outline is-hidden-desktop display-none-print margin-bottom-sm" data-bi-name="intopic toc" aria-label="In this article">
											<h2 id="ms--in-this-article" class="title is-6 margin-block-xs">In this article</h2>
										</nav><!-- <content> --><p>&nbsp;&nbsp; Last week at Ignite Australia I presented a session (<a href="https://web.archive.org/web/20170930115439/https://channel9.msdn.com/Events/Ignite/Australia-2015/INF327" title="available here" data-linktype="external">available here</a>&nbsp;) on something I don't think gets talked about enough&nbsp;- Windows Event Forwarding, or WEF. &nbsp;(<em>Edit: I've also since done an depth</em><a href="https://web.archive.org/web/20170930115439/https://mva.microsoft.com/en-US/training-courses/event-forwarding-and-log-analysis-16506" data-linktype="external"><em>Microsoft Virtual Academy session</em></a><em>on&nbsp;Event Forwarding&nbsp;too!</em> ).</p>
<p>Often when we engage for an Incident Response, we find the customer :</p>
<ul>
<li>Has no centralized logging</li>
<li>Are not monitoring endpoints/member servers (often just DCs)</li>
<li>Spam logs with extra data</li>
<li>Are not logging key events</li>
<li>Logs roll too quickly</li>
<li>Those with centralized logging still missing data, takes too long for IT admins to get reports</li>
</ul>
<p>In Internet speak :</p>
<p><a href="https://msdntnarchive.blob.core.windows.net/media/2015/11/014.png" data-linktype="external"><img src="https://msdntnarchive.blob.core.windows.net/media/2015/11/014-1024x508.png" alt="" data-linktype="external"></a></p>
<p>WEF's been part of the operating system for a while now, but not many people take advantage of it. Many people appear to not even be aware of it, as evidenced by this highly scientific poll.</p>
<p><a href="https://msdntnarchive.blob.core.windows.net/media/2015/11/023.png" data-linktype="external"><img src="https://msdntnarchive.blob.core.windows.net/media/2015/11/023-1024x646.png" alt="" data-linktype="external"></a></p>
<p>WEF is not only free and built-in, it has some nice features when configured appropriately :</p>
<ul>
<li>Works nicely as a compliment to SCOM or SIEM products.</li>
<li>Can dramatically increase your overall visibility in the environment. Frequently desktops aren't part of the centralized monitoring due to licensing costs - WEF can be setup (for free) to collect the key events from the desktops and then be forwarding on to the SIEM.</li>
<li>Configured via GPO (easy!)</li>
<li>Uses Windows Remote Management (Kerberos) to prevent man in the middle</li>
<li>Can (and should be) targeted to specific events</li>
<li>Native evtx (xml) log format</li>
<li>âPushâ log mode â less attack surface than adding a monitoring agent or account to a widely privileged group</li>
<li>IT admins control their own logging destiny - AD guys looking to track down a certain service account don't have to wait on the security team.</li>
</ul>
<p>Setting WEF up is really easy too.&nbsp;Prerequisites&nbsp;are essentially a server and a GPO. To collect security events, we'll also need to grant the local Network Service principal rights to read that log. This is just the Network Service on the machine itself, so it's not a wide privilege throughout the domain. The WinRM service will also need to be started on all the clients in the domain - just started though, not configured. This is key, as just starting the WinRM service doesn't leave it in a listening state, versus a quick config of the service would make it listening.</p>
<p>Recommendations for the collector server would be to use 2012R2, although you can even do this on Windows 7 if you have licensing restraints. The log files will be pretty small if you're just collecting targeted/critical events, so you likely won't need much above and beyond your typical VM drive size but you may want to bump up the memory in the box a bit to avoid race conditions.</p>
<p>On your collector server, fire up an administrative command prompt (you do have UAC enabled, right? ð ) and type in winrm qc. You'll then be asked two important questions - do you want the WinRM service to start automatically and do you want to poke a hole in the firewall for WinRM. I'd recommend controlling the firewall with a GPO as well, but go ahead and answer yes to both of these.</p>
<p><a href="https://msdntnarchive.blob.core.windows.net/media/2015/11/033.png" data-linktype="external"><img src="https://msdntnarchive.blob.core.windows.net/media/2015/11/033-1024x639.png" alt="" data-linktype="external"></a></p>
<p>When that created the WinRM listener, it also created a Service Principal Name for Kerberos authentication to the service. If something goes flakey with WEF, this is usually where it happens. If the SPNs aren't right, Kerberos authentication can't happen which makes Event Forwarding not work. You may also have noticed the listener is on HTTP ://* - WinRM is at its core HTTP, so while the SPN is WSMAN for WinRM, if you try to install WEF on a server that already has an HTTP SPN Windows Event Forwarding will fail as if it's a duplicate SPN. If you're curious, you can check your SPNs out via attribute editor.</p>
<p><a href=""><img src="https://msdntnarchive.blob.core.windows.net/media/2015/11/044.png" alt="" data-linktype="external"></a></p>
<p>Once WinRM is setup (and hopefully after you've set the firewall via GPO) you can enable Event Forwarding. Open up Event Viewer on the Collector and navigate to the area called "Subscriptions" that you've probably never clicked on before. ð If you haven't clicked on it before, you'll get prompted with this question:</p>
<p><a href=""><img src="https://msdntnarchive.blob.core.windows.net/media/2015/11/053.png" alt="" data-linktype="external"></a></p>
<p>We do need/want the Windows Event Collector to start up automatically with the computer, so go ahead and click yes on that.</p>
<p>And that's it, you've configured a Windows Event Collector! The next trick is to get things report to it.</p>
<p>The best way to do that is via GPO. First things first, we'll need to give the local Network Service principal rights to read the security log. To make sure we don't break anything, run the following command on a server/workstation in your environment:</p>
<p>&nbsp;<strong>wevtutil gl security</strong></p>
<p>That will spit out the information about the Security Event Log, as shown below. The weird "O:BAG:SYD:" line is where the permissions on the log are stored. Copy out that line from the O through the last parenthesis and stick it into Notepad. If yours doesn't have (A;;0x1;;;NS) on the end like mine does, append that in Notepad.</p>
<p><a href="https://msdntnarchive.blob.core.windows.net/media/2015/11/062.png" data-linktype="external"><img src="https://msdntnarchive.blob.core.windows.net/media/2015/11/062-1024x412.png" alt="" data-linktype="external"></a></p>
<p>Copy the whole O:BAG:SYD line from Notepad, as we'll need it in the GPO. Create a new GPO in your domain to point the systems you want to monitor at the collector server - the same GPO can be used for both member systems and Domain Controllers in your environment, unless you want to point them at different collectors for delegation reasons.</p>
<p>You'll need to configure two settings :</p>
<p><strong>Computer&gt;Policies&gt;Admin Templates&gt;Windows Components&gt;Event Forwarding&gt;Configure target subscription manager</strong></p>
<p>This will need to be populated with the address of your collector server in this format :</p>
<p><strong>Server=https://fqdnofsubscriptionserver:5985/wsman/SubscriptionManager/WEC,Refresh=60</strong></p>
<p>The refresh interval on the end indicates how often clients should check in to see if new subscriptions are there for them. 60 seconds might be a bit aggressive in production, but it helps out a lot when you're setting things up and testing.</p>
<p><strong>Computer&gt;Policies&gt;Admin Templates&gt;Windows Components&gt;Event Log Service&gt;Security&gt; Configure log access</strong></p>
<p>This is where you'll need to paste your O:BAG:SYD line from Notepad. Remember this is an authoritative setting, so if you had permissions set some other way on a system in your environment this would replace them.</p>
<p>When you're done, your GPO should look like this:</p>
<p><a href=""><img src="https://msdntnarchive.blob.core.windows.net/media/2015/11/072.png" alt="" data-linktype="external"></a></p>
<p>Now any system that has this GPO will know to check into the web service running on the Windows Event Collector to see if there are any subscriptions for it. Computers only send events when they get a subscription telling them to do so.</p>
<p><strong>So what should you monitor?</strong></p>
<p>You absolutely could configure WEF to collect all the security logs in your domain - and maybe if you don't have any other centralized logging in your domain you should do this for forensic reasons - but the real value of WEF is targeted alerts, filtering out what really matters. This is also where WEF is a great compliment to a SIEM you already have in your environment - let the SIEM do the heavy lifting of collecting every single event and use WEF for targeted visibility, and use WEF to get important security events from workstations/member servers in your environment you may not have covered by the SIEM. The SIEM can then collect them from the WEF server, still providing you with the "single pane of glass" view.</p>
<p>The five basic things I think everyone should start with for monitoring in their domain (if they aren't already) are :</p>
<ul>
<li>Security Event Logs being cleared</li>
<li>High value groups like Domain Admins being Changed</li>
<li>Local administrator groups being changed</li>
<li>Local users being created or deleted on member systems</li>
<li>New Services being installed, particularly on Domain Controllers (as this is often an indicator of malware or lateral movement behavior.)</li>
</ul>
<p>Configuring subscriptions can be done via the GUI (easy mode) or via XPath filters (lots more flexibility.) The settings for the subscriptions do matter though, as this is where you configure the logs to be in "push" mode versus "pull."</p>
<p>Let's configure the Security Event log cleared alert via the GUI:</p>
<p>Right click on Subscriptions, then select Create Subscription. We'll need to give the subscription a name and pick "Source Computer Initiated" as that's what makes it "push."</p>
<p><a href=""><img src="https://msdntnarchive.blob.core.windows.net/media/2015/11/082.png" alt="" data-linktype="external"></a></p>
<p>Select Computer Groups next, as this will define which computers send us the events we're interested in. Since we want to know whenever anyone anywhere clears a security log, we're going to use the two built-in/auto populating groups in AD, "Domain Controllers" and "Domain Computers."</p>
<p><a href=""><img src="https://msdntnarchive.blob.core.windows.net/media/2015/11/092.png" alt="" data-linktype="external"></a></p>
<p>Next we click Select Events to define what we're monitoring. This alert is pretty straight forward, we're looking for Event ID 1102 in the Security log, so we can do it all via the GUI. ð</p>
<p><a href=""><img src="https://msdntnarchive.blob.core.windows.net/media/2015/11/1010.png" alt="" data-linktype="external"></a></p>
<p>If we click on the XML tab we can see what the XPath filter we just created looks like.</p>
<p><a href=""><img src="https://msdntnarchive.blob.core.windows.net/media/2015/11/1114.png" alt="" data-linktype="external"></a></p>
<p>Click okay on that and then click Advanced on the main page. We want to set the subscription to Minimize Latency, to make sure we get events as soon as possible and also to help it catch up if we miss any.</p>
<p><a href=""><img src="https://msdntnarchive.blob.core.windows.net/media/2015/11/1212.png" alt="" data-linktype="external"></a></p>
<p>You can troubleshoot that things have actually checked in by checking the Source Computers column on the main Subscriptions page :</p>
<p><a href=""><img src="https://msdntnarchive.blob.core.windows.net/media/2015/11/136.png" alt="" data-linktype="external"></a></p>
<p>You can also check the Event Forwarding Plugin Operational log under Applications and Services on the client to make sure everything is happy. This is where you'll see descriptive errors if something has gone awry with Kerberos or Firewalls.</p>
<p><a href="https://msdntnarchive.blob.core.windows.net/media/2015/11/146.png" data-linktype="external"><img src="https://msdntnarchive.blob.core.windows.net/media/2015/11/146-1024x711.png" alt="" data-linktype="external"></a></p>
<p>Click okay and you've got a subscription. Find a low-value test VM, clear the Security log and see if you get an alert. ð</p>
<p>Configure those 5 events with cut and paste for two commands? Yes you can!</p>
<p>Thanks to Australian PFE Russell Tomkins, you can do just that. Below are two XML files that contain the appropriate subscriptions for Domain Computers and Domain Controllers. The subscriptions here are maybe a bit wider than you want in your production domain to start with, as it's collecting services installing on workstations too, but give it a go. We'll want that data if we ever have to do an IR for you.</p>
<p>To import the XML files, save them to a directory on the server and then run the following commands from the same directory on your Windows Event Collector.</p>
<p><strong>wecutil cs DomainComputers.xml</strong></p>
<p><strong>wecutil cs DomainControllers.xml</strong></p>
<p><strong>DomainComputers.xml</strong></p>
<p>&lt;Subscription xmlns="https://schemas.microsoft.com/2006/03/windows/events/subscription"&gt;<br>
&lt;SubscriptionId&gt;Domain Computer Events&lt;/SubscriptionId&gt;<br>
&lt;SubscriptionType&gt;SourceInitiated&lt;/SubscriptionType&gt;<br>
&lt;Description&gt;Important Domain Controller Events&lt;/Description&gt;<br>
&lt;Enabled&gt;True&lt;/Enabled&gt;<br>
&lt;Uri&gt;https://schemas.microsoft.com/wbem/wsman/1/windows/EventLog&lt;/Uri&gt;<br>
&lt;ConfigurationMode&gt;MinLatency&lt;/ConfigurationMode&gt;<br>
&lt;Query&gt;<br>
&lt;![CDATA[&lt;QueryList&gt;<br>
&lt;Query Id="0" Path="Security"&gt;<br>
&lt;!-- Local Admins Changed --&gt;<br>
&lt;Select Path="Security"&gt;<br>
*[EventData[Data[@Name='TargetUserName'] and (Data='Administrators')]]<br>
and<br>
*[System[(EventID='4732') or (EventID='4733')]]<br>
&lt;/Select&gt;<br>
&lt;!-- Local user created or deleted --&gt;<br>
&lt;Select Path="Security"&gt;*[System[(EventID='4720') or (EventID='4726')]]&lt;/Select&gt;<br>
&lt;!-- New Service Installed --&gt;<br>
&lt;!-- Event Log Cleared --&gt;<br>
&lt;Select Path="Security"&gt;*[System[(EventID='1102')]]&lt;/Select&gt;<br>
&lt;/Query&gt;<br>
&lt;/QueryList&gt;]]&gt;<br>
&lt;/Query&gt;<br>
&lt;ReadExistingEvents&gt;true&lt;/ReadExistingEvents&gt;<br>
&lt;TransportName&gt;http&lt;/TransportName&gt;<br>
&lt;ContentFormat&gt;RenderedText&lt;/ContentFormat&gt;<br>
&lt;Locale Language="en-US"/&gt;<br>
&lt;LogFile&gt;ForwardedEvents&lt;/LogFile&gt;<br>
&lt;AllowedSourceNonDomainComputers&gt;&lt;/AllowedSourceNonDomainComputers&gt;<br>
&lt;AllowedSourceDomainComputers&gt;O:NSG:NSD:(A;;GA;;;DC)(A;;GA;;;DD)&lt;/AllowedSourceDomainComputers&gt;<br>
&lt;/Subscription&gt;</p>
<p><strong>DomainControllers.xml</strong></p>
<p>&lt;Subscription xmlns="https://schemas.microsoft.com/2006/03/windows/events/subscription"&gt;<br>
&lt;SubscriptionId&gt;Domain Controller Events&lt;/SubscriptionId&gt;<br>
&lt;SubscriptionType&gt;SourceInitiated&lt;/SubscriptionType&gt;<br>
&lt;Description&gt;Important Domain Controller Events&lt;/Description&gt;<br>
&lt;Enabled&gt;True&lt;/Enabled&gt;<br>
&lt;Uri&gt;https://schemas.microsoft.com/wbem/wsman/1/windows/EventLog&lt;/Uri&gt;<br>
&lt;ConfigurationMode&gt;MinLatency&lt;/ConfigurationMode&gt;<br>
&lt;Query&gt;<br>
&lt;![CDATA[&lt;QueryList&gt;<br>
&lt;Query Id="0" Path="Security"&gt;<br>
&lt;!-- New Service Installed --&gt;<br>
&lt;Select Path="System"&gt;*[System[(EventID='7045')]]&lt;/Select&gt;<br>
&lt;!-- Member Added or Removed from an AD Domain Local, Universal or&nbsp; Global Security Group --&gt;<br>
&lt;Select Path="Security"&gt;<br>
(*[EventData[Data[@Name="TargetUserName"] = "Administrators"]]) or<br>
(*[EventData[Data[@Name="TargetUserName"] = "Domain Admins"]]) or<br>
(*[EventData[Data[@Name="TargetUserName"] = "Schema Admins"]]) or<br>
(*[EventData[Data[@Name="TargetUserName"] = "Enterprise Admins"]]) or<br>
(*[EventData[Data[@Name="TargetUserName"] =&nbsp; "Print Operators"]]) or<br>
(*[EventData[Data[@Name="TargetUserName"] = "Server Operators"]]) or<br>
(*[EventData[Data[@Name="TargetUserName"] = "Backup Operators"]])<br>
and<br>
*[System[(EventID='4732') or (EventID='4733') or (EventID='4756') or (EventID='4757') or (EventID='4728') or (EventID='4729')]]<br>
&lt;/Select&gt;<br>
&lt;!-- Event Log Cleared --&gt;<br>
&lt;Select Path="Security"&gt;*[System[(EventID='1102')]]&lt;/Select&gt;<br>
&lt;/Query&gt;<br>
&lt;/QueryList&gt;]]&gt;<br>
&lt;/Query&gt;<br>
&lt;ReadExistingEvents&gt;True&lt;/ReadExistingEvents&gt;<br>
&lt;TransportName&gt;http&lt;/TransportName&gt;<br>
&lt;ContentFormat&gt;RenderedText&lt;/ContentFormat&gt;<br>
&lt;Locale Language="en-US"/&gt;<br>
&lt;LogFile&gt;ForwardedEvents&lt;/LogFile&gt;<br>
&lt;AllowedSourceNonDomainComputers&gt;&lt;/AllowedSourceNonDomainComputers&gt;<br>
&lt;AllowedSourceDomainComputers&gt;O:NSG:NSD:(A;;GA;;;DD)&lt;/AllowedSourceDomainComputers&gt;<br>
&lt;/Subscription&gt;</p>
<p>If you have more than one domain, you'll need to specify the SIDs of Domain Computers/Domain Controllers in the &lt;AllowedSourceDomainComputers&gt; line as well as the DC (Domain Computers) and DD (Domain Controlls) SDDLs that are in there.</p>
<p>Hope this helps. Be sure to check out my post on&nbsp;<a href="https://web.archive.org/web/20170930115439/https://blogs.technet.microsoft.com/b/jepayne/archive/2015/11/27/tracking-lateral-movement-part-one-special-groups-and-specific-service-accounts.aspx" title="https://blogs.technet.com/b/jepayne/archive/2015/11/27/tracking-lateral-movement-part-one-special-groups-and-specific-service-accounts.aspx" data-linktype="external">tracking Special Groups with WEF</a>&nbsp;and look forward to more things you can do with WEF in future blog posts! Happy Logging!</p>
<p>-Jessica @<a href="https://web.archive.org/web/20170930115439/https://twitter.com/jepayneMSFT" title="@jepayneMSFT" data-linktype="external">jepayneMSFT</a></p>
<h2 id="comments">Comments</h2>
<ul>
<li><strong>Anonymous</strong><br>
November 23, 2015<br>
The comment has been removed</li>
<li><strong>Anonymous</strong><br>
November 24, 2015<br>
The video of the presentation has now been posted, well worth watching.<br><a href="https://channel9.msdn.com/Events/Ignite/Australia-2015/INF327" data-linktype="external">https://channel9.msdn.com/Events/Ignite/Australia-2015/INF327</a></li>
<li><strong>Anonymous</strong><br>
November 26, 2015<br>
Lateral Movement - the moving of an attacker from one compromised host throughout your domain until they</li>
<li><strong>Anonymous</strong><br>
November 30, 2015<br>
Sounds like a great session!</li>
<li><strong>Anonymous</strong><br>
December 02, 2015<br>
Thanks again Jessica. I watched this at Ignite and watched the recording to refresh.</li>
<li><strong>Anonymous</strong><br>
December 24, 2015<br>
Hallo - is this traffic sent plaintext across the network?</li>
<li><strong>Anonymous</strong><br>
December 24, 2015<br>
The comment has been removed</li>
<li><strong>Anonymous</strong><br>
December 28, 2015<br>
Hey Jessica. I've been using this method since you led a POP-SLAM engagement a few months back. Glad to see you blogging!<br><br>I wanted to throw this in for people interested. I started to work on a PowerShell module for Event Subscriptions, but it still needs a lot of work. It's basically a wrapped for wecutil, but was made with automation in mind.<br><br><a href="https://github.com/davidhowell-tx/PS-WinEventSubscriptions" data-linktype="external">https://github.com/davidhowell-tx/PS-WinEventSubscriptions</a><br><br>I also have a script posted that uses the module. It queries AD for Domain Admins membership and updates a subscription with the members' SamAccountName for monitoring.</li>
<li><strong>Anonymous</strong><br>
December 28, 2015<br>
Hi, Jessica Payne from Microsoft Enterprise Cybersecurity Group's Global Incident Response and Recovery</li>
<li><strong>Anonymous</strong><br>
December 30, 2015<br>
Hi David - glad you've been able to put the SLAM stuff into practice! You guys were super fun. (Embrace the 500 account!)<br><br>Spoiler alert for the posts ahead, there's a Powershell logging module at the end of it that ties into the PowerBI dashboards - the fact you made your own is super cool too!<br><br>Keep up the good work and innovation. :) <br><br>-Jessica</li>
<li><strong>Anonymous</strong><br>
January 11, 2016<br>
This is really handy and I'm in the middle of implementing it however, we use group policy preferences to change the local admins group so everytime a machine boots up, it changes the membership of the group and forwards and event, meaning we have 300 events every morning just from powering up. is there anyway to filter xpath to not monitor the groups added to local admin?</li>
<li><strong>Anonymous</strong><br>
January 11, 2016<br>
More great stuff from you, Jessica, thanks so much! I'm wondering if there's a benefit or negative to creating separate subscriptions vs. combining the filters into one event in terms of processing or traffic for either the source or destination servers? For example, if I also want to monitor the special groups (I do!) I could create a new subscription or I could modify the existing subscriptions with the additional filter elements. Is one solution empirically "better" or "worse" than another, or is it purely dealer's choice?</li>
<li><strong>Anonymous</strong><br>
January 12, 2016<br>
Tom - there's a way to filter based on who is doing the change, GPO should be done by SYSTEM so you could "suppress" those (knowing you might miss something.) The dashboard at the end of the series should help too. Are you doing adds or Restricted Groups? I'm a bigger fan of Restricted Groups. <br><br>-Jessica</li>
<li><strong>Anonymous</strong><br>
January 12, 2016<br>
Tony - I like to use different subscriptions so I can track if something goes wrong in the Event Forwarding Plugin operational log, but you can also use one big "security stuff" or "operational stuff" subscription for simplicity too. So sort of your choice? :) <br>-Jessica</li>
<li><strong>Anonymous</strong><br>
January 15, 2016<br>
We're adding a security group of I.T. staff to the local admins group by GPP. Not sure how restricted groups work but if you could point me in the direction of a good article I can certain start researching.
<ul>
<li><strong>Anonymous</strong><br>
May 18, 2016<br>
The comment has been removed
<ul>
<li><strong>Anonymous</strong><br>
May 20, 2016<br>
The comment has been removed</li>
<li><strong>Anonymous</strong><br>
May 20, 2016<br>
Suppress Path="Security"&gt;*[EventData[Data[@Name="SubjectUserSid"] = "S-1-5-18"]]&lt;/Suppress</li>
</ul>
</li>
</ul>
</li>
<li><strong>Anonymous</strong><br>
January 25, 2016<br>
Hi, The Captain here from Microsoft Enterprise Cybersecurity Group's Global Incident Response and</li>
<li><strong>Anonymous</strong><br>
February 23, 2016<br>
Jessica - great post and glad this topic seems to be getting more coverage. I have a OneNote notebook full of references trying to piece together a best practice approach.<br><br>In all my research it would appear you can create an event log on the collector server other than the Forwarded Events, but I never seen a post on how. The reasoning behind this would be to push domain controller logs at one log with the corresponding file on a dedicated and performant disk (we generate around 750GB per day) and create other event logs for member servers and clients (again spreading out the disk IO load). Is this possible and if so how?<br><br>Thanks<br><br>Paul</li>
<li><strong>Anonymous</strong><br>
February 23, 2016<br>
Paul - yes you can do that! It was hard to get working reliably but we got some help from MSIT on how they do it and have it being tested at some customers now. Should be part of an upcoming post once we make sure it is still reliable at 500k+ endpoints.
<ul>
<li><strong>Anonymous</strong><br>
March 10, 2016<br>
The comment has been removed
<ul>
<li><strong>Anonymous</strong><br>
May 23, 2016<br>
For those wishing to create custom event logs, Russell Tomkins has blogged about the way we do it inside of Microsoft : <a href="https://blogs.technet.microsoft.com/russellt/2016/05/18/creating-custom-windows-event-forwarding-logs/" data-linktype="external">https://blogs.technet.microsoft.com/russellt/2016/05/18/creating-custom-windows-event-forwarding-logs/</a></li>
</ul>
</li>
</ul>
</li>
<li><strong>Anonymous</strong><br>
March 09, 2016<br>
Hi Jessica, I am looking forward to implementing WEF in my current company after seeing this presentation. We have been reviewing SIEM providers for sometime now and it's a minefield for sure. I agree with some of your comments from the presentation that one needs to be clear about the type of events that are being logged. I believe there are a key list that everyone should focus as essential but each company should know what's important to them beyond that. Can you recommend how to create a dashboard for the events?</li>
<li><strong>Anonymous</strong><br>
May 18, 2016<br>
Thanks for this article Jessica, it is extremely helpful.This is simple but I stumbled so I thought I would share to help anybody else doing this.I glossed over the whole âWinRM must be startedâ part so my first attempt did nothing.Add this to your GPO to get it up and running:Computer &gt; Policies &gt; Windows Settings &gt; Security Settings &gt; System Services &gt; Windows Remote Management (WS-Management) Startup = Automatic@dconsec</li>
<li><strong>Anonymous</strong><br>
May 24, 2016<br>
Hi Jessica,I had a similar issue with HTTP SPN.And I had concluded that to make a denial of service of Event Forwarding you just have to do a setspn...What's your thoughts on that ?How do you monitor that clients are still sending events to collector ?RegardsGreg</li>
<li><strong>Anonymous</strong><br>
June 30, 2016<br>
Thanks for this post.  Very easy to follow.  Thank you!  One thing -- The  tag in the DomainComputers.xml section looks like it might be incorrect as it mentions domain controllers.</li>
<li><strong>Anonymous</strong><br>
July 22, 2016<br>
Thank you so much, Jessica! You just fixed the last issue I was having setting this up.The MSDN docs don't mention the access restrictions on the Security logfile, so I was a bit confused when some of our servers didn't send their Security logs (but others did, go figure).So that other people can Google the error I was having now to find this article: Event 101, Eventlog-ForwardingPluginStatus SubscribePartialSuccess returned status data which included:
<ul>
<li><strong>Anonymous</strong><br>
August 23, 2016<br>
The comment has been removed
<ul>
<li><strong>Anonymous</strong><br>
September 15, 2016<br>
Hi David - check out my reply to Joel for a fix, this is a known issue between versions.</li>
</ul>
</li>
</ul>
</li>
<li><strong>Anonymous</strong><br>
September 13, 2016<br>
The comment has been removed
<ul>
<li><strong>Anonymous</strong><br>
September 15, 2016<br>
There's an error in the XML schema for 2012R2 since it was made on 2008R2. Best way to ensure it imports is to make a new subscription via GUI and export using :wecutil gs "%subscriptionname%" /f:xml &gt;&gt;"C:\Temp%subscriptionname%.xml"You can then use that one as a template and just change the XPath portion.
<ul>
<li><strong>Anonymous</strong><br>
November 10, 2016<br>
This isn't working for me still Jessica.  I've created the subscription on a 2012R2 host, exported it, but then can't import it again (even if i dont change the exported file!).  Any ideas?
<ul>
<li><strong>Anonymous</strong><br>
December 13, 2016<br>
Does the import display any error? -Jessica</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><strong>Anonymous</strong><br>
October 07, 2016<br>
The comment has been removed</li>
<li><strong>Anonymous</strong><br>
October 20, 2016<br>
Thanks for the article. Works fine, however occasionally the source computers will turn into an inactive state for apparantly no reason. See my reply to a thread about this here: <a href="https://social.technet.microsoft.com/Forums/en-US/3d62d46b-33e7-4db6-b672-8555fd6a9f35/event-log-forwarding-subscription-is-unsubscribed" data-linktype="external">https://social.technet.microsoft.com/Forums/en-US/3d62d46b-33e7-4db6-b672-8555fd6a9f35/event-log-forwarding-subscription-is-unsubscribed</a></li>
<li><strong>Anonymous</strong><br>
November 17, 2016<br>
What about environments where there are thousands of users forwarding events per day, is there built in options for load balancing between multiple WEC servers?
<ul>
<li><strong>Anonymous</strong><br>
December 13, 2016<br>
Load balancing in WEF/WEC (in a supported way) is achieved by putting multiple collectors in the GPO - then it will send a copy of the event to each server, while maintaining the "bookmark" of which was sent last. While network load balancing solutions are possible, due to the bookmark manner or operation it will have the same net result of sending a copy to each server leading to duplicates. -Jessica
<ul>
<li><strong>Anonymous</strong><br>
January 30, 2017<br>
We're attempting this via network load balancing right now. We also have a single virtual address (VIP + FQDN + SPN) which fronts four event collectors on the backend.If the setup is source-initiated, I'm hoping that this wont mean that the backend servers would get duplicate events, since any bookmark being maintained by each client would only point to the virtual address.<span class="no-loc" dir="ltr" lang="en-us">@Jessica</span> - is this correct? is one bookmark maintained by the client for the last event sent, or is it maintained per last event sent to each server?
<ul>
<li><strong>Anonymous</strong><br>
August 07, 2017<br>
did you get network load balancing working ?</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><strong>Anonymous</strong><br>
January 12, 2017<br>
Hi Jessica, I decided to roll with WEF after reading this post! Any ideas as to what would give an eventid of 102 with error 5004? I'm testing the collection of sysmon logs from Microsoft-Windows-Sysmon/Operational but it keeps erroring with: The subscription Collect Sysmon Logs can not be created. The error code is 5004.</li>
<li><strong>Anonymous</strong><br>
February 22, 2017<br>
I assume there is no way to do wildcards since Microsoft is using XPath 1.0?</li>
<li><strong>Anonymous</strong><br>
March 28, 2017<br>
Hi Everybodyquick question...Is it possible to implement a WEC server to address multiple forest ? If yes, is there any technical aspects I should take care of ? (We had implemented a WEC servers, we can subscriptions from other forest, but logs are not forwarded..;despite GPO is applied)Thanks in advance for your inputs / Cheers  / Kristoff</li>
<li><strong>Anonymous</strong><br>
April 19, 2017<br>
Thanks for the Jessica! I am monitoring security logs for changes (4728, 4729) and it does not work with security groups under the 'Builtin' OU (e.g. Administrators) and also the 'Users' OU (e.g. Domain Admins) although the respective audit policies are enabled for these OUs. Any suggestions on how to deal with this quirk gracefully with WEF?
<ul>
<li><strong>Anonymous</strong><br>
April 19, 2017<br>
Ah - found the problem. I was just forwarding events for domain global groups. Added the respective event log IDs for universal and domain local groups. See <a href="https://technet.microsoft.com/en-us/library/dn311500(v=ws.11).aspx" data-linktype="external">https://technet.microsoft.com/en-us/library/dn311500(v=ws.11).aspx</a></li>
</ul>
</li>
<li><strong>Anonymous</strong><br>
May 30, 2017<br>
Great article and video. One question/comment - my understanding is that running WinRM with the quick config (qc) switch also starts WinRS by default, which may be an unintended security issue if admins aren't aware and haven't explicitly blocked WinRS through GPO (assuming they don't need it).</li>
<li><strong>Anonymous</strong><br>
July 27, 2017<br>
The comment has been removed</li>
<li><strong>Anonymous</strong><br>
August 08, 2017<br>
Hello Jessica,I have (2) Windows 2012 R2 servers setup as WEF Collectors and I have several Source Initiated Subscriptions in place. One of the Source Initiated Subscriptions is dedicated to pulling Security Log information from (14 Domain Controllers.)This subscription is setup using HTTPS and collects Security Log Events only.When I check the Runtime Status, one of the DC's shows as "Inactive" and no event log information is being captured for the DC.I believe this was working when it was initially setup.  The WEF GPO that is assigned to the Domain Controllers OU is configured correctly:server=https://ServerName.DomainName:5986/wsman/SubscriptionManager/WEC,Refresh=60Can you please tell what I am missing in order to get this one DC to show up as Active"Thank youGlenn</li>
<li><strong>Anonymous</strong><br>
August 31, 2017<br>
The comment has been removed</li>
<li><strong>Anonymous</strong><br>
September 15, 2017<br>
These instructions are great!  They got me up and running in no time. Iâve just started experimenting with WEF for use in the enterprise and Iâve come across an odd scenario that I have not seen documented elsewhere. I have WEF setup with a simple Powershell subscription that includes 4103 and 4104 event IDs. Iâve tried it with a few simple PS scripts, and everything works as expected.However, I got a little more ambitious and ran a 2MB mimikatz script that had Base64 encoded executables embedded in it. The appropriate 4103 and 4104 (script block logging) events were generated on the endpoint. However, instead of forwarding the events to my collector, the subscription for Powershell events started âflappingâ and alternating between the subscription being created and removed (event IDs 100 and 103, respectively in the Eventlog-ForwardingPlugin channel). There are 200+ sizable 4104 events being generated by the script, so I wonder if the size/number of the events is causing an issue.  One other detailâ¦if I remove 4104 events from the subscription, and run the mimikatz script, everything works as expected and the 4103 events appear on the collector.</li>
<li><strong>Anonymous</strong><br>
December 11, 2017<br>
Jessica,You deleted the content on the last update.
<ul>
<li><strong>Anonymous</strong><br>
December 12, 2017<br>
Woops, fixed. Thanks for catching it.</li>
<li><strong>Anonymous</strong><br>
December 18, 2017<br>
JPayne,This content is too outrageous to not be on the internet! I was looking for it during an incident after i changed jobs and had to pull it from memory. Keep up the awesome work.</li>
</ul>
</li>
<li><strong>Anonymous</strong><br>
December 16, 2017<br>
Hello Jessica - Great read!!One question I have is amount of space I need to factor for my central server to collect the security logs. I am looking to collect these events from around 15000 endpoints. On an average how many events per sec are generated from the Win10 machines and what would be size of each event</li>
<li><strong>Anonymous</strong><br>
December 19, 2017<br>
Great post Jessica! I will be forwarding this to all of my customers.</li>
<li><strong>Anonymous</strong><br>
April 10, 2018<br>
Is it possible to forward the whole Windows eventlog? (Not only: Application, Security, Setup, System, for example "Applications and Services Logs/Microsoft/Windows/Hyper-V Worker")</li>
</ul>
</div><div id="ms--inline-notifications" class="margin-block-xs" data-bi-name="inline-notification"></div><div id="assertive-live-region" role="alert" aria-live="assertive" class="visually-hidden" aria-relevant="additions" aria-atomic="true"></div>
							<div id="polite-live-region" role="status" aria-live="polite" class="visually-hidden" aria-relevant="additions" aria-atomic="true"></div>
							<!-- </content> -->

						</main><!-- recommendations section --><!-- end recommendations section -->

						<!-- feedback section --><!-- end feedback section -->

						<!-- feedback report section --><!-- end feedback report section --><aside
								id="ms--additional-resources-mobile"
								aria-label="Additional resources"
								class="display-none-desktop display-none-print"
							>
								<hr class="hr" hidden />
								<h2 id="ms--additional-resources-mobile-heading" class="title is-3" hidden>Additional resources</h2>
								<section id="right-rail-recommendations-mobile" data-bi-name="recommendations" hidden></section>
								<section id="right-rail-training-mobile" data-bi-name="learning-resources-card" hidden></section>
								<section id="right-rail-events-mobile" data-bi-name="events-card" hidden></section>
								<section id="right-rail-qna-mobile" data-bi-name="qna-link-card" hidden></section>
							</aside><div class="border-top is-visible-interactive has-default-focus margin-top-sm "><footer id="footer-interactive" data-bi-name="footer" class="footer-layout"><div class="display-flex gap-xs flex-wrap-wrap is-full-height padding-right-lg-desktop"><a
				data-mscc-ic="false"
				class="locale-selector-link button button-sm button-clear flex-shrink-0"
				href="#"
				data-bi-name="select-locale">
					<span class="icon" aria-hidden="true">
						<span class="docon docon-world"></span>
					</span>
					<span class="local-selector-link-text"></span></a><div class="ccpa-privacy-link" data-ccpa-privacy-link hidden>
<a
	href="https://aka.ms/yourcaliforniaprivacychoices"
	class="button button-sm button-clear flex-shrink-0"
	data-mscc-ic="false"
	data-bi-name="your-privacy-choices"
>
	<svg
		role="img"
		aria-label="California Consumer Privacy Act (CCPA) Opt-Out Icon"
		xmlns="http://www.w3.org/2000/svg"
		viewBox="0 0 30 14"
		xml:space="preserve"
		height="16"
		width="43"
		focusable="false"
	>
		<title>California Consumer Privacy Act (CCPA) Opt-Out Icon</title>
		<path d="M7.4 12.8h6.8l3.1-11.6H7.4C4.2 1.2 1.6 3.8 1.6 7s2.6 5.8 5.8 5.8z" style="fill-rule:evenodd;clip-rule:evenodd;fill:#fff"></path>
		<path d="M22.6 0H7.4c-3.9 0-7 3.1-7 7s3.1 7 7 7h15.2c3.9 0 7-3.1 7-7s-3.2-7-7-7zm-21 7c0-3.2 2.6-5.8 5.8-5.8h9.9l-3.1 11.6H7.4c-3.2 0-5.8-2.6-5.8-5.8z" style="fill-rule:evenodd;clip-rule:evenodd;fill:#06f"></path>
		<path d="M24.6 4c.2.2.2.6 0 .8L22.5 7l2.2 2.2c.2.2.2.6 0 .8-.2.2-.6.2-.8 0l-2.2-2.2-2.2 2.2c-.2.2-.6.2-.8 0-.2-.2-.2-.6 0-.8L20.8 7l-2.2-2.2c-.2-.2-.2-.6 0-.8.2-.2.6-.2.8 0l2.2 2.2L23.8 4c.2-.2.6-.2.8 0z" style="fill:#fff"></path>
		<path d="M12.7 4.1c.2.2.3.6.1.8L8.6 9.8c-.1.1-.2.2-.3.2-.2.1-.5.1-.7-.1L5.4 7.7c-.2-.2-.2-.6 0-.8.2-.2.6-.2.8 0L8 8.6l3.8-4.5c.2-.2.6-.2.9 0z" style="fill:#06f"></path>
	</svg>
	<span>Your Privacy Choices</span>
</a>

		</div>
		<div class="flex-shrink-0">
<div class="dropdown has-caret-up">
	<button class="dropdown-trigger button button-clear button-sm has-inner-focus theme-dropdown-trigger"
		aria-controls="theme-menu-interactive" aria-expanded="false" title="Theme" data-bi-name="theme">
		<span class="icon">
			<span class="docon docon-sun" aria-hidden="true"></span>
		</span>
		<span>Theme</span>
		<span class="icon expanded-indicator" aria-hidden="true">
			<span class="docon docon-chevron-down-light"></span>
		</span>
	</button>
	<div class="dropdown-menu" id="theme-menu-interactive" role="menu">
		<ul class="theme-selector padding-xxs" role="none">
			<li class="theme display-block" role="menuitem">
				<button class="button button-clear button-sm theme-control button-block justify-content-flex-start"
					data-theme-to="light">
					<span class="theme-light margin-right-xxs">
						<span
							class="theme-selector-icon border display-inline-block has-body-background"
							aria-hidden="true">
							<svg class="svg" xmlns="http://www.w3.org/2000/svg"
								viewBox="0 0 22 14">
								<rect width="22" height="14" class="has-fill-body-background" />
								<rect x="5" y="5" width="12" height="4" class="has-fill-secondary" />
								<rect x="5" y="2" width="2" height="1" class="has-fill-secondary" />
								<rect x="8" y="2" width="2" height="1" class="has-fill-secondary" />
								<rect x="11" y="2" width="3" height="1" class="has-fill-secondary" />
								<rect x="1" y="1" width="2" height="2" class="has-fill-secondary" />
								<rect x="5" y="10" width="7" height="2" rx="0.3" class="has-fill-primary" />
								<rect x="19" y="1" width="2" height="2" rx="1" class="has-fill-secondary" />
							</svg>
						</span>
					</span>
					<span>Light</span>
				</button>
			</li>
			<li class="theme display-block" role="menuitem">
				<button class="button button-clear button-sm theme-control button-block justify-content-flex-start"
					data-theme-to="dark">
					<span class="theme-dark margin-right-xxs">
						<span
							class="border theme-selector-icon display-inline-block has-body-background"
							aria-hidden="true">
							<svg class="svg" xmlns="http://www.w3.org/2000/svg"
								viewBox="0 0 22 14">
								<rect width="22" height="14" class="has-fill-body-background" />
								<rect x="5" y="5" width="12" height="4" class="has-fill-secondary" />
								<rect x="5" y="2" width="2" height="1" class="has-fill-secondary" />
								<rect x="8" y="2" width="2" height="1" class="has-fill-secondary" />
								<rect x="11" y="2" width="3" height="1" class="has-fill-secondary" />
								<rect x="1" y="1" width="2" height="2" class="has-fill-secondary" />
								<rect x="5" y="10" width="7" height="2" rx="0.3" class="has-fill-primary" />
								<rect x="19" y="1" width="2" height="2" rx="1" class="has-fill-secondary" />
							</svg>
						</span>
					</span>
					<span>Dark</span>
				</button>
			</li>
			<li class="theme display-block" role="menuitem">
				<button class="button button-clear button-sm theme-control button-block justify-content-flex-start"
					data-theme-to="high-contrast">
					<span class="theme-high-contrast margin-right-xxs">
						<span
							class="border theme-selector-icon display-inline-block has-body-background"
							aria-hidden="true">
							<svg class="svg" xmlns="http://www.w3.org/2000/svg"
								viewBox="0 0 22 14">
								<rect width="22" height="14" class="has-fill-body-background" />
								<rect x="5" y="5" width="12" height="4" class="has-fill-secondary" />
								<rect x="5" y="2" width="2" height="1" class="has-fill-secondary" />
								<rect x="8" y="2" width="2" height="1" class="has-fill-secondary" />
								<rect x="11" y="2" width="3" height="1" class="has-fill-secondary" />
								<rect x="1" y="1" width="2" height="2" class="has-fill-secondary" />
								<rect x="5" y="10" width="7" height="2" rx="0.3" class="has-fill-primary" />
								<rect x="19" y="1" width="2" height="2" rx="1" class="has-fill-secondary" />
							</svg>
						</span>
					</span>
					<span>High contrast</span>
				</button>
			</li>
		</ul>
	</div>
</div>

		</div>
	</div>
	<ul class="links" data-bi-name="footerlinks">
		<li class="manage-cookies-holder" hidden></li><li><a class="external-link-indicator" data-mscc-ic="false" href="/en-us/previous-versions/" data-bi-name="archivelink">Previous Versions</a></li>
				<li><a class="external-link-indicator" data-mscc-ic="false" href="https://techcommunity.microsoft.com/t5/microsoft-learn-blog/bg-p/MicrosoftLearnBlog" data-bi-name="bloglink">Blog</a></li>
				<li><a class="external-link-indicator" data-mscc-ic="false" href="/en-us/contribute/" data-bi-name="contributorGuide">Contribute</a></li><li><a class="external-link-indicator" data-mscc-ic="false" href="https://go.microsoft.com/fwlink/?LinkId=521839" data-bi-name="privacy">Privacy</a></li><li><a class="external-link-indicator" data-mscc-ic="false" href="/en-us/legal/termsofuse" data-bi-name="termsofuse">Terms of Use</a></li><li><a class="external-link-indicator" data-mscc-ic="false" href="https://www.microsoft.com/legal/intellectualproperty/Trademarks/" data-bi-name="trademarks">Trademarks</a></li><li>&copy; Microsoft 2024</li>
	</ul>
</footer></div></div><div
							id="ms--additional-resources"
							class="right-container column is-4-desktop display-none display-block-desktop"
							data-bi-name="pageactions"
							role="complementary"
							aria-label="Additional resources"
						>
							<div id="affixed-right-container" class="margin-top-sm-tablet" data-bi-name="right-column">
								<h2 id="ms--additional-resources-heading" class="title is-6 margin-top-md" hidden>Additional resources</h2>
								<section id="right-rail-events" data-bi-name="events-card" hidden></section>
								<section id="right-rail-training" data-bi-name="learning-resources-card" hidden></section>
								<section id="right-rail-recommendations" data-bi-name="recommendations" hidden></section>
								<nav id="side-doc-outline" class="doc-outline" data-bi-name="intopic toc" aria-label="In this article">
									<h3>In this article</h3>
								</nav>
								<section id="right-rail-qna" class="margin-top-xxs" data-bi-name="qna-link-card" hidden></section>
							</div>
						</div></div>
				<!--end of div.columns -->

			</section>
			<!--end of .primary-holder -->

			<!-- interactive container -->
			<aside id="interactive-container" class="interactive-container is-visible-interactive column has-body-background-dark ">
			</aside>
			<!-- end of interactive container -->
		</div>

	</div>
	<!--end of .mainContainer -->

	<section class="border-top has-default-focus is-hidden-interactive margin-top-sm "><footer id="footer" data-bi-name="footer" class="footer-layout uhf-container has-padding" role="contentinfo"><div class="display-flex gap-xs flex-wrap-wrap is-full-height padding-right-lg-desktop"><a
				data-mscc-ic="false"
				class="locale-selector-link button button-sm button-clear flex-shrink-0"
				href="#"
				data-bi-name="select-locale">
					<span class="icon" aria-hidden="true">
						<span class="docon docon-world"></span>
					</span>
					<span class="local-selector-link-text"></span></a><div class="ccpa-privacy-link" data-ccpa-privacy-link hidden>
<a
	href="https://aka.ms/yourcaliforniaprivacychoices"
	class="button button-sm button-clear flex-shrink-0"
	data-mscc-ic="false"
	data-bi-name="your-privacy-choices"
>
	<svg
		role="img"
		aria-label="California Consumer Privacy Act (CCPA) Opt-Out Icon"
		xmlns="http://www.w3.org/2000/svg"
		viewBox="0 0 30 14"
		xml:space="preserve"
		height="16"
		width="43"
		focusable="false"
	>
		<title>California Consumer Privacy Act (CCPA) Opt-Out Icon</title>
		<path d="M7.4 12.8h6.8l3.1-11.6H7.4C4.2 1.2 1.6 3.8 1.6 7s2.6 5.8 5.8 5.8z" style="fill-rule:evenodd;clip-rule:evenodd;fill:#fff"></path>
		<path d="M22.6 0H7.4c-3.9 0-7 3.1-7 7s3.1 7 7 7h15.2c3.9 0 7-3.1 7-7s-3.2-7-7-7zm-21 7c0-3.2 2.6-5.8 5.8-5.8h9.9l-3.1 11.6H7.4c-3.2 0-5.8-2.6-5.8-5.8z" style="fill-rule:evenodd;clip-rule:evenodd;fill:#06f"></path>
		<path d="M24.6 4c.2.2.2.6 0 .8L22.5 7l2.2 2.2c.2.2.2.6 0 .8-.2.2-.6.2-.8 0l-2.2-2.2-2.2 2.2c-.2.2-.6.2-.8 0-.2-.2-.2-.6 0-.8L20.8 7l-2.2-2.2c-.2-.2-.2-.6 0-.8.2-.2.6-.2.8 0l2.2 2.2L23.8 4c.2-.2.6-.2.8 0z" style="fill:#fff"></path>
		<path d="M12.7 4.1c.2.2.3.6.1.8L8.6 9.8c-.1.1-.2.2-.3.2-.2.1-.5.1-.7-.1L5.4 7.7c-.2-.2-.2-.6 0-.8.2-.2.6-.2.8 0L8 8.6l3.8-4.5c.2-.2.6-.2.9 0z" style="fill:#06f"></path>
	</svg>
	<span>Your Privacy Choices</span>
</a>

		</div>
		<div class="flex-shrink-0">
<div class="dropdown has-caret-up">
	<button class="dropdown-trigger button button-clear button-sm has-inner-focus theme-dropdown-trigger"
		aria-controls="theme-menu" aria-expanded="false" title="Theme" data-bi-name="theme">
		<span class="icon">
			<span class="docon docon-sun" aria-hidden="true"></span>
		</span>
		<span>Theme</span>
		<span class="icon expanded-indicator" aria-hidden="true">
			<span class="docon docon-chevron-down-light"></span>
		</span>
	</button>
	<div class="dropdown-menu" id="theme-menu" role="menu">
		<ul class="theme-selector padding-xxs" role="none">
			<li class="theme display-block" role="menuitem">
				<button class="button button-clear button-sm theme-control button-block justify-content-flex-start"
					data-theme-to="light">
					<span class="theme-light margin-right-xxs">
						<span
							class="theme-selector-icon border display-inline-block has-body-background"
							aria-hidden="true">
							<svg class="svg" xmlns="http://www.w3.org/2000/svg"
								viewBox="0 0 22 14">
								<rect width="22" height="14" class="has-fill-body-background" />
								<rect x="5" y="5" width="12" height="4" class="has-fill-secondary" />
								<rect x="5" y="2" width="2" height="1" class="has-fill-secondary" />
								<rect x="8" y="2" width="2" height="1" class="has-fill-secondary" />
								<rect x="11" y="2" width="3" height="1" class="has-fill-secondary" />
								<rect x="1" y="1" width="2" height="2" class="has-fill-secondary" />
								<rect x="5" y="10" width="7" height="2" rx="0.3" class="has-fill-primary" />
								<rect x="19" y="1" width="2" height="2" rx="1" class="has-fill-secondary" />
							</svg>
						</span>
					</span>
					<span>Light</span>
				</button>
			</li>
			<li class="theme display-block" role="menuitem">
				<button class="button button-clear button-sm theme-control button-block justify-content-flex-start"
					data-theme-to="dark">
					<span class="theme-dark margin-right-xxs">
						<span
							class="border theme-selector-icon display-inline-block has-body-background"
							aria-hidden="true">
							<svg class="svg" xmlns="http://www.w3.org/2000/svg"
								viewBox="0 0 22 14">
								<rect width="22" height="14" class="has-fill-body-background" />
								<rect x="5" y="5" width="12" height="4" class="has-fill-secondary" />
								<rect x="5" y="2" width="2" height="1" class="has-fill-secondary" />
								<rect x="8" y="2" width="2" height="1" class="has-fill-secondary" />
								<rect x="11" y="2" width="3" height="1" class="has-fill-secondary" />
								<rect x="1" y="1" width="2" height="2" class="has-fill-secondary" />
								<rect x="5" y="10" width="7" height="2" rx="0.3" class="has-fill-primary" />
								<rect x="19" y="1" width="2" height="2" rx="1" class="has-fill-secondary" />
							</svg>
						</span>
					</span>
					<span>Dark</span>
				</button>
			</li>
			<li class="theme display-block" role="menuitem">
				<button class="button button-clear button-sm theme-control button-block justify-content-flex-start"
					data-theme-to="high-contrast">
					<span class="theme-high-contrast margin-right-xxs">
						<span
							class="border theme-selector-icon display-inline-block has-body-background"
							aria-hidden="true">
							<svg class="svg" xmlns="http://www.w3.org/2000/svg"
								viewBox="0 0 22 14">
								<rect width="22" height="14" class="has-fill-body-background" />
								<rect x="5" y="5" width="12" height="4" class="has-fill-secondary" />
								<rect x="5" y="2" width="2" height="1" class="has-fill-secondary" />
								<rect x="8" y="2" width="2" height="1" class="has-fill-secondary" />
								<rect x="11" y="2" width="3" height="1" class="has-fill-secondary" />
								<rect x="1" y="1" width="2" height="2" class="has-fill-secondary" />
								<rect x="5" y="10" width="7" height="2" rx="0.3" class="has-fill-primary" />
								<rect x="19" y="1" width="2" height="2" rx="1" class="has-fill-secondary" />
							</svg>
						</span>
					</span>
					<span>High contrast</span>
				</button>
			</li>
		</ul>
	</div>
</div>

		</div>
	</div>
	<ul class="links" data-bi-name="footerlinks">
		<li class="manage-cookies-holder" hidden></li><li><a class="external-link-indicator" data-mscc-ic="false" href="/en-us/previous-versions/" data-bi-name="archivelink">Previous Versions</a></li>
				<li><a class="external-link-indicator" data-mscc-ic="false" href="https://techcommunity.microsoft.com/t5/microsoft-learn-blog/bg-p/MicrosoftLearnBlog" data-bi-name="bloglink">Blog</a></li>
				<li><a class="external-link-indicator" data-mscc-ic="false" href="/en-us/contribute/" data-bi-name="contributorGuide">Contribute</a></li><li><a class="external-link-indicator" data-mscc-ic="false" href="https://go.microsoft.com/fwlink/?LinkId=521839" data-bi-name="privacy">Privacy</a></li><li><a class="external-link-indicator" data-mscc-ic="false" href="/en-us/legal/termsofuse" data-bi-name="termsofuse">Terms of Use</a></li><li><a class="external-link-indicator" data-mscc-ic="false" href="https://www.microsoft.com/legal/intellectualproperty/Trademarks/" data-bi-name="trademarks">Trademarks</a></li><li>&copy; Microsoft 2024</li>
	</ul>
</footer>

	</section>

	<div id="action-panel" role="region" aria-label="Action Panel" class="action-panel has-default-focus" tabindex="-1"></div>
</body>
</html>