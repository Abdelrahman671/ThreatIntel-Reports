<!doctype html>
<html lang="en-US">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width">
	<link rel="profile" href="https://gmpg.org/xfn/11">

	<title>Cobalt Strike, a Defenderâ€™s Guide &#8211; Part 2 &#8211; The DFIR Report</title>
			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 <meta name='robots' content='max-image-preview:large' />
	<style>img:is([sizes="auto" i], [sizes^="auto," i]) { contain-intrinsic-size: 3000px 1500px }</style>
	<link rel='dns-prefetch' href='//stats.wp.com' />
<link rel='preconnect' href='//c0.wp.com' />
<link rel="alternate" type="application/rss+xml" title="The DFIR Report &raquo; Feed" href="https://thedfirreport.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="The DFIR Report &raquo; Comments Feed" href="https://thedfirreport.com/comments/feed/" />
<script type="9378db564915928314866b15-text/javascript">
/* <![CDATA[ */
window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/15.0.3\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/15.0.3\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/thedfirreport.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=6.7.1"}};
/*! This file is auto-generated */
!function(i,n){var o,s,e;function c(e){try{var t={supportTests:e,timestamp:(new Date).valueOf()};sessionStorage.setItem(o,JSON.stringify(t))}catch(e){}}function p(e,t,n){e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillText(t,0,0);var t=new Uint32Array(e.getImageData(0,0,e.canvas.width,e.canvas.height).data),r=(e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillText(n,0,0),new Uint32Array(e.getImageData(0,0,e.canvas.width,e.canvas.height).data));return t.every(function(e,t){return e===r[t]})}function u(e,t,n){switch(t){case"flag":return n(e,"\ud83c\udff3\ufe0f\u200d\u26a7\ufe0f","\ud83c\udff3\ufe0f\u200b\u26a7\ufe0f")?!1:!n(e,"\ud83c\uddfa\ud83c\uddf3","\ud83c\uddfa\u200b\ud83c\uddf3")&&!n(e,"\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc65\udb40\udc6e\udb40\udc67\udb40\udc7f","\ud83c\udff4\u200b\udb40\udc67\u200b\udb40\udc62\u200b\udb40\udc65\u200b\udb40\udc6e\u200b\udb40\udc67\u200b\udb40\udc7f");case"emoji":return!n(e,"\ud83d\udc26\u200d\u2b1b","\ud83d\udc26\u200b\u2b1b")}return!1}function f(e,t,n){var r="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope?new OffscreenCanvas(300,150):i.createElement("canvas"),a=r.getContext("2d",{willReadFrequently:!0}),o=(a.textBaseline="top",a.font="600 32px Arial",{});return e.forEach(function(e){o[e]=t(a,e,n)}),o}function t(e){var t=i.createElement("script");t.src=e,t.defer=!0,i.head.appendChild(t)}"undefined"!=typeof Promise&&(o="wpEmojiSettingsSupports",s=["flag","emoji"],n.supports={everything:!0,everythingExceptFlag:!0},e=new Promise(function(e){i.addEventListener("DOMContentLoaded",e,{once:!0})}),new Promise(function(t){var n=function(){try{var e=JSON.parse(sessionStorage.getItem(o));if("object"==typeof e&&"number"==typeof e.timestamp&&(new Date).valueOf()<e.timestamp+604800&&"object"==typeof e.supportTests)return e.supportTests}catch(e){}return null}();if(!n){if("undefined"!=typeof Worker&&"undefined"!=typeof OffscreenCanvas&&"undefined"!=typeof URL&&URL.createObjectURL&&"undefined"!=typeof Blob)try{var e="postMessage("+f.toString()+"("+[JSON.stringify(s),u.toString(),p.toString()].join(",")+"));",r=new Blob([e],{type:"text/javascript"}),a=new Worker(URL.createObjectURL(r),{name:"wpTestEmojiSupports"});return void(a.onmessage=function(e){c(n=e.data),a.terminate(),t(n)})}catch(e){}c(n=f(s,u,p))}t(n)}).then(function(e){for(var t in e)n.supports[t]=e[t],n.supports.everything=n.supports.everything&&n.supports[t],"flag"!==t&&(n.supports.everythingExceptFlag=n.supports.everythingExceptFlag&&n.supports[t]);n.supports.everythingExceptFlag=n.supports.everythingExceptFlag&&!n.supports.flag,n.DOMReady=!1,n.readyCallback=function(){n.DOMReady=!0}}).then(function(){return e}).then(function(){var e;n.supports.everything||(n.readyCallback(),(e=n.source||{}).concatemoji?t(e.concatemoji):e.wpemoji&&e.twemoji&&(t(e.twemoji),t(e.wpemoji)))}))}((window,document),window._wpemojiSettings);
/* ]]> */
</script>
<link rel='stylesheet' id='jetpack_related-posts-css' href='https://c0.wp.com/p/jetpack/14.1/modules/related-posts/related-posts.css' type='text/css' media='all' />
<style id='wp-emoji-styles-inline-css' type='text/css'>

	img.wp-smiley, img.emoji {
		display: inline !important;
		border: none !important;
		box-shadow: none !important;
		height: 1em !important;
		width: 1em !important;
		margin: 0 0.07em !important;
		vertical-align: -0.1em !important;
		background: none !important;
		padding: 0 !important;
	}
</style>
<link rel='stylesheet' id='wp-block-library-css' href='https://c0.wp.com/c/6.7.1/wp-includes/css/dist/block-library/style.min.css' type='text/css' media='all' />
<link rel='stylesheet' id='mediaelement-css' href='https://c0.wp.com/c/6.7.1/wp-includes/js/mediaelement/mediaelementplayer-legacy.min.css' type='text/css' media='all' />
<link rel='stylesheet' id='wp-mediaelement-css' href='https://c0.wp.com/c/6.7.1/wp-includes/js/mediaelement/wp-mediaelement.min.css' type='text/css' media='all' />
<style id='jetpack-sharing-buttons-style-inline-css' type='text/css'>
.jetpack-sharing-buttons__services-list{display:flex;flex-direction:row;flex-wrap:wrap;gap:0;list-style-type:none;margin:5px;padding:0}.jetpack-sharing-buttons__services-list.has-small-icon-size{font-size:12px}.jetpack-sharing-buttons__services-list.has-normal-icon-size{font-size:16px}.jetpack-sharing-buttons__services-list.has-large-icon-size{font-size:24px}.jetpack-sharing-buttons__services-list.has-huge-icon-size{font-size:36px}@media print{.jetpack-sharing-buttons__services-list{display:none!important}}.editor-styles-wrapper .wp-block-jetpack-sharing-buttons{gap:0;padding-inline-start:0}ul.jetpack-sharing-buttons__services-list.has-background{padding:1.25em 2.375em}
</style>
<style id='classic-theme-styles-inline-css' type='text/css'>
/*! This file is auto-generated */
.wp-block-button__link{color:#fff;background-color:#32373c;border-radius:9999px;box-shadow:none;text-decoration:none;padding:calc(.667em + 2px) calc(1.333em + 2px);font-size:1.125em}.wp-block-file__button{background:#32373c;color:#fff;text-decoration:none}
</style>
<style id='global-styles-inline-css' type='text/css'>
:root{--wp--preset--aspect-ratio--square: 1;--wp--preset--aspect-ratio--4-3: 4/3;--wp--preset--aspect-ratio--3-4: 3/4;--wp--preset--aspect-ratio--3-2: 3/2;--wp--preset--aspect-ratio--2-3: 2/3;--wp--preset--aspect-ratio--16-9: 16/9;--wp--preset--aspect-ratio--9-16: 9/16;--wp--preset--color--black: #000000;--wp--preset--color--cyan-bluish-gray: #abb8c3;--wp--preset--color--white: #ffffff;--wp--preset--color--pale-pink: #f78da7;--wp--preset--color--vivid-red: #cf2e2e;--wp--preset--color--luminous-vivid-orange: #ff6900;--wp--preset--color--luminous-vivid-amber: #fcb900;--wp--preset--color--light-green-cyan: #7bdcb5;--wp--preset--color--vivid-green-cyan: #00d084;--wp--preset--color--pale-cyan-blue: #8ed1fc;--wp--preset--color--vivid-cyan-blue: #0693e3;--wp--preset--color--vivid-purple: #9b51e0;--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple: linear-gradient(135deg,rgba(6,147,227,1) 0%,rgb(155,81,224) 100%);--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan: linear-gradient(135deg,rgb(122,220,180) 0%,rgb(0,208,130) 100%);--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange: linear-gradient(135deg,rgba(252,185,0,1) 0%,rgba(255,105,0,1) 100%);--wp--preset--gradient--luminous-vivid-orange-to-vivid-red: linear-gradient(135deg,rgba(255,105,0,1) 0%,rgb(207,46,46) 100%);--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray: linear-gradient(135deg,rgb(238,238,238) 0%,rgb(169,184,195) 100%);--wp--preset--gradient--cool-to-warm-spectrum: linear-gradient(135deg,rgb(74,234,220) 0%,rgb(151,120,209) 20%,rgb(207,42,186) 40%,rgb(238,44,130) 60%,rgb(251,105,98) 80%,rgb(254,248,76) 100%);--wp--preset--gradient--blush-light-purple: linear-gradient(135deg,rgb(255,206,236) 0%,rgb(152,150,240) 100%);--wp--preset--gradient--blush-bordeaux: linear-gradient(135deg,rgb(254,205,165) 0%,rgb(254,45,45) 50%,rgb(107,0,62) 100%);--wp--preset--gradient--luminous-dusk: linear-gradient(135deg,rgb(255,203,112) 0%,rgb(199,81,192) 50%,rgb(65,88,208) 100%);--wp--preset--gradient--pale-ocean: linear-gradient(135deg,rgb(255,245,203) 0%,rgb(182,227,212) 50%,rgb(51,167,181) 100%);--wp--preset--gradient--electric-grass: linear-gradient(135deg,rgb(202,248,128) 0%,rgb(113,206,126) 100%);--wp--preset--gradient--midnight: linear-gradient(135deg,rgb(2,3,129) 0%,rgb(40,116,252) 100%);--wp--preset--font-size--small: 13px;--wp--preset--font-size--medium: 20px;--wp--preset--font-size--large: 36px;--wp--preset--font-size--x-large: 42px;--wp--preset--spacing--20: 0.44rem;--wp--preset--spacing--30: 0.67rem;--wp--preset--spacing--40: 1rem;--wp--preset--spacing--50: 1.5rem;--wp--preset--spacing--60: 2.25rem;--wp--preset--spacing--70: 3.38rem;--wp--preset--spacing--80: 5.06rem;--wp--preset--shadow--natural: 6px 6px 9px rgba(0, 0, 0, 0.2);--wp--preset--shadow--deep: 12px 12px 50px rgba(0, 0, 0, 0.4);--wp--preset--shadow--sharp: 6px 6px 0px rgba(0, 0, 0, 0.2);--wp--preset--shadow--outlined: 6px 6px 0px -3px rgba(255, 255, 255, 1), 6px 6px rgba(0, 0, 0, 1);--wp--preset--shadow--crisp: 6px 6px 0px rgba(0, 0, 0, 1);}:where(.is-layout-flex){gap: 0.5em;}:where(.is-layout-grid){gap: 0.5em;}body .is-layout-flex{display: flex;}.is-layout-flex{flex-wrap: wrap;align-items: center;}.is-layout-flex > :is(*, div){margin: 0;}body .is-layout-grid{display: grid;}.is-layout-grid > :is(*, div){margin: 0;}:where(.wp-block-columns.is-layout-flex){gap: 2em;}:where(.wp-block-columns.is-layout-grid){gap: 2em;}:where(.wp-block-post-template.is-layout-flex){gap: 1.25em;}:where(.wp-block-post-template.is-layout-grid){gap: 1.25em;}.has-black-color{color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-color{color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-color{color: var(--wp--preset--color--white) !important;}.has-pale-pink-color{color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-color{color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-color{color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-color{color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-color{color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-color{color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-color{color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-color{color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-color{color: var(--wp--preset--color--vivid-purple) !important;}.has-black-background-color{background-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-background-color{background-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-background-color{background-color: var(--wp--preset--color--white) !important;}.has-pale-pink-background-color{background-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-background-color{background-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-background-color{background-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-background-color{background-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-background-color{background-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-background-color{background-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-background-color{background-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-background-color{background-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-background-color{background-color: var(--wp--preset--color--vivid-purple) !important;}.has-black-border-color{border-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-border-color{border-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-border-color{border-color: var(--wp--preset--color--white) !important;}.has-pale-pink-border-color{border-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-border-color{border-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-border-color{border-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-border-color{border-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-border-color{border-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-border-color{border-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-border-color{border-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-border-color{border-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-border-color{border-color: var(--wp--preset--color--vivid-purple) !important;}.has-vivid-cyan-blue-to-vivid-purple-gradient-background{background: var(--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple) !important;}.has-light-green-cyan-to-vivid-green-cyan-gradient-background{background: var(--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan) !important;}.has-luminous-vivid-amber-to-luminous-vivid-orange-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange) !important;}.has-luminous-vivid-orange-to-vivid-red-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-orange-to-vivid-red) !important;}.has-very-light-gray-to-cyan-bluish-gray-gradient-background{background: var(--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray) !important;}.has-cool-to-warm-spectrum-gradient-background{background: var(--wp--preset--gradient--cool-to-warm-spectrum) !important;}.has-blush-light-purple-gradient-background{background: var(--wp--preset--gradient--blush-light-purple) !important;}.has-blush-bordeaux-gradient-background{background: var(--wp--preset--gradient--blush-bordeaux) !important;}.has-luminous-dusk-gradient-background{background: var(--wp--preset--gradient--luminous-dusk) !important;}.has-pale-ocean-gradient-background{background: var(--wp--preset--gradient--pale-ocean) !important;}.has-electric-grass-gradient-background{background: var(--wp--preset--gradient--electric-grass) !important;}.has-midnight-gradient-background{background: var(--wp--preset--gradient--midnight) !important;}.has-small-font-size{font-size: var(--wp--preset--font-size--small) !important;}.has-medium-font-size{font-size: var(--wp--preset--font-size--medium) !important;}.has-large-font-size{font-size: var(--wp--preset--font-size--large) !important;}.has-x-large-font-size{font-size: var(--wp--preset--font-size--x-large) !important;}
:where(.wp-block-post-template.is-layout-flex){gap: 1.25em;}:where(.wp-block-post-template.is-layout-grid){gap: 1.25em;}
:where(.wp-block-columns.is-layout-flex){gap: 2em;}:where(.wp-block-columns.is-layout-grid){gap: 2em;}
:root :where(.wp-block-pullquote){font-size: 1.5em;line-height: 1.6;}
</style>
<link rel='stylesheet' id='freenews-style-css' href='https://thedfirreport.com/wp-content/themes/freenews/style.css?ver=6.7.1' type='text/css' media='all' />
<style id='freenews-style-inline-css' type='text/css'>
.tags-links, .byline, .comments-link { clip: rect(1px, 1px, 1px, 1px); height: 1px; position: absolute; overflow: hidden; width: 1px; }
</style>
<link rel='stylesheet' id='font-awesome-css' href='https://thedfirreport.com/wp-content/themes/freenews/assets/library/fontawesome/css/all.min.css?ver=6.7.1' type='text/css' media='all' />
<link rel='stylesheet' id='freenews-google-fonts-css' href='https://thedfirreport.com/wp-content/fonts/d92fef3d9e5de6f7993b11046e265436.css' type='text/css' media='all' />
<link rel='stylesheet' id='sharedaddy-css' href='https://c0.wp.com/p/jetpack/14.1/modules/sharedaddy/sharing.css' type='text/css' media='all' />
<link rel='stylesheet' id='social-logos-css' href='https://c0.wp.com/p/jetpack/14.1/_inc/social-logos/social-logos.min.css' type='text/css' media='all' />
<script type="9378db564915928314866b15-text/javascript" id="jetpack_related-posts-js-extra">
/* <![CDATA[ */
var related_posts_js_options = {"post_heading":"h4"};
/* ]]> */
</script>
<script type="9378db564915928314866b15-text/javascript" src="https://c0.wp.com/p/jetpack/14.1/_inc/build/related-posts/related-posts.min.js" id="jetpack_related-posts-js"></script>
<script type="9378db564915928314866b15-text/javascript" src="https://c0.wp.com/c/6.7.1/wp-includes/js/jquery/jquery.min.js" id="jquery-core-js"></script>
<script type="9378db564915928314866b15-text/javascript" src="https://c0.wp.com/c/6.7.1/wp-includes/js/jquery/jquery-migrate.min.js" id="jquery-migrate-js"></script>
<script type="9378db564915928314866b15-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/js/global.js?ver=1" id="freenews-global-js"></script>
<link rel="https://api.w.org/" href="https://thedfirreport.com/wp-json/" /><link rel="alternate" title="JSON" type="application/json" href="https://thedfirreport.com/wp-json/wp/v2/posts/5314" /><link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://thedfirreport.com/xmlrpc.php?rsd" />
<meta name="generator" content="WordPress 6.7.1" />
<link rel="canonical" href="https://thedfirreport.com/2022/01/24/cobalt-strike-a-defenders-guide-part-2/" />
<link rel='shortlink' href='https://thedfirreport.com/?p=5314' />
<link rel="alternate" title="oEmbed (JSON)" type="application/json+oembed" href="https://thedfirreport.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fthedfirreport.com%2F2022%2F01%2F24%2Fcobalt-strike-a-defenders-guide-part-2%2F" />
<link rel="alternate" title="oEmbed (XML)" type="text/xml+oembed" href="https://thedfirreport.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fthedfirreport.com%2F2022%2F01%2F24%2Fcobalt-strike-a-defenders-guide-part-2%2F&#038;format=xml" />

		<!-- GA Google Analytics @ https://m0n.co/ga -->
		<script async src="https://www.googletagmanager.com/gtag/js?id=UA-162747485-1" type="9378db564915928314866b15-text/javascript"></script>
		<script type="9378db564915928314866b15-text/javascript">
			window.dataLayer = window.dataLayer || [];
			function gtag(){dataLayer.push(arguments);}
			gtag('js', new Date());
			gtag('config', 'UA-162747485-1');
		</script>

	<script type="9378db564915928314866b15-text/javascript">
(function(url){
	if(/(?:Chrome\/26\.0\.1410\.63 Safari\/537\.31|WordfenceTestMonBot)/.test(navigator.userAgent)){ return; }
	var addEvent = function(evt, handler) {
		if (window.addEventListener) {
			document.addEventListener(evt, handler, false);
		} else if (window.attachEvent) {
			document.attachEvent('on' + evt, handler);
		}
	};
	var removeEvent = function(evt, handler) {
		if (window.removeEventListener) {
			document.removeEventListener(evt, handler, false);
		} else if (window.detachEvent) {
			document.detachEvent('on' + evt, handler);
		}
	};
	var evts = 'contextmenu dblclick drag dragend dragenter dragleave dragover dragstart drop keydown keypress keyup mousedown mousemove mouseout mouseover mouseup mousewheel scroll'.split(' ');
	var logHuman = function() {
		if (window.wfLogHumanRan) { return; }
		window.wfLogHumanRan = true;
		var wfscr = document.createElement('script');
		wfscr.type = 'text/javascript';
		wfscr.async = true;
		wfscr.src = url + '&r=' + Math.random();
		(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(wfscr);
		for (var i = 0; i < evts.length; i++) {
			removeEvent(evts[i], logHuman);
		}
	};
	for (var i = 0; i < evts.length; i++) {
		addEvent(evts[i], logHuman);
	}
})('//thedfirreport.com/?wordfence_lh=1&hid=D988499CE8AF075D233019841D77B5AE');
</script>	<style>img#wpstats{display:none}</style>
		<style type="text/css" id="custom-background-css">
body.custom-background { background-color: #f8f8f8; }
</style>
	
<!-- Jetpack Open Graph Tags -->
<meta property="og:type" content="article" />
<meta property="og:title" content="Cobalt Strike, a Defenderâ€™s Guide &#8211; Part 2" />
<meta property="og:url" content="https://thedfirreport.com/2022/01/24/cobalt-strike-a-defenders-guide-part-2/" />
<meta property="og:description" content="Our previous reportÂ on Cobalt Strike focused on the most frequently used capabilities that we had observed. In this report, we will focus on the network traffic it produced, and provide some easy wâ€¦" />
<meta property="article:published_time" content="2022-01-24T03:03:49+00:00" />
<meta property="article:modified_time" content="2024-09-10T12:17:18+00:00" />
<meta property="og:site_name" content="The DFIR Report" />
<meta property="og:image" content="https://thedfirreport.com/wp-content/uploads/2022/01/Cobalt-Strike.jpg" />
<meta property="og:image:width" content="872" />
<meta property="og:image:height" content="583" />
<meta property="og:image:alt" content="" />
<meta property="og:locale" content="en_US" />
<meta name="twitter:text:title" content="Cobalt Strike, a Defenderâ€™s Guide &#8211; Part 2" />
<meta name="twitter:image" content="https://thedfirreport.com/wp-content/uploads/2022/01/Cobalt-Strike.jpg?w=640" />
<meta name="twitter:card" content="summary_large_image" />

<!-- End Jetpack Open Graph Tags -->
<link rel="icon" href="https://thedfirreport.com/wp-content/uploads/2020/04/cropped-dfir-v1-w-32x32.png" sizes="32x32" />
<link rel="icon" href="https://thedfirreport.com/wp-content/uploads/2020/04/cropped-dfir-v1-w-192x192.png" sizes="192x192" />
<link rel="apple-touch-icon" href="https://thedfirreport.com/wp-content/uploads/2020/04/cropped-dfir-v1-w-180x180.png" />
<meta name="msapplication-TileImage" content="https://thedfirreport.com/wp-content/uploads/2020/04/cropped-dfir-v1-w-270x270.png" />
</head>

<body class="post-template-default single single-post postid-5314 single-format-standard custom-background has-sidebar tags-hidden author-hidden comment-hidden">
	<div id="page" class="site">
	<a class="skip-link screen-reader-text" href="#content">Skip to content</a>

	
	<header id="masthead" class="site-header">
		<div id="main-header" class="main-header">
			<div class="navigation-top">
        		<div class="wrap">
            	<div id="site-header-menu" class="site-header-menu">
               	<nav class="main-navigation" aria-label="Primary Menu" role="navigation">
							    <button class="menu-toggle" aria-controls="primary-menu" aria-expanded="false">
        <span class="toggle-text">Menu</span>
        <span class="toggle-bar"></span>
    </button>

    <ul id="primary-menu" class="menu nav-menu"><li id="menu-item-21337" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-21337"><a href="https://thedfirreport.com/">Reports</a></li>
<li id="menu-item-21314" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21314"><a href="https://thedfirreport.com/analysts/">Analysts</a></li>
<li id="menu-item-21315" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-21315"><a href="https://thedfirreport.com/services/">Services</a>
<ul class="sub-menu">
	<li id="menu-item-21319" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21319"><a href="https://thedfirreport.com/services/threat-intelligence/">Threat Intelligence</a></li>
	<li id="menu-item-21318" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21318"><a href="https://thedfirreport.com/services/detection-rules/">Detection Rules</a></li>
	<li id="menu-item-31055" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-31055"><a href="https://thedfirreport.com/services/dfir-labs/">DFIR Labs</a>
	<ul class="sub-menu">
		<li id="menu-item-35456" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-35456"><a href="https://thedfirreport.com/services/dfir-labs/ctf/">Capture The Flag (CTF)</a></li>
		<li id="menu-item-32606" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-32606"><a href="https://thedfirreport.com/services/dfir-labs/dfir-labs-leaderboard/">Leaderboard</a></li>
		<li id="menu-item-38108" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-38108"><a href="https://thedfirreport.com/services/dfir-labs/ctf-winners/">CTF Winners</a></li>
	</ul>
</li>
	<li id="menu-item-21320" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21320"><a href="https://thedfirreport.com/services/case-artifacts/">Case Artifacts</a></li>
	<li id="menu-item-21317" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-21317"><a href="https://thedfirreport.com/services/mentoring-coaching-program/">Mentoring &#038; Coaching Program</a>
	<ul class="sub-menu">
		<li id="menu-item-21325" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21325"><a href="https://thedfirreport.com/services/mentoring-coaching-program/book-a-session/">Book A Session</a></li>
		<li id="menu-item-21326" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21326"><a href="https://thedfirreport.com/services/mentoring-coaching-program/meet-the-team/">Meet The Team</a></li>
	</ul>
</li>
</ul>
</li>
<li id="menu-item-31033" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-31033"><a href="https://store.thedfirreport.com/collections/dfir-labs">Access DFIR Labs</a></li>
<li id="menu-item-21313" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21313"><a href="https://thedfirreport.com/subscribe/">Subscribe</a></li>
<li id="menu-item-21316" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21316"><a href="https://thedfirreport.com/contact/">Contact Us</a></li>
</ul>						 </nav><!-- #site-navigation -->
           		</div>
        		</div><!-- .wrap -->
			</div><!-- .navigation-top -->
			       <nav class="secondary-navigation" role="navigation" aria-label="Secondary Navigation">
            <div class="wrap">
                <button class="secondary-menu-toggle" aria-controls="primary-menu" aria-expanded="false">
                    <span class="secondary-toggle-text">Menu</span>
                    <span class="secondary-toggle-bar"></span>
                </button>
                <ul id="primary-menu" class="secondary-menu"><li id="menu-item-21323" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21323"><a href="https://thedfirreport.com/services/threat-intelligence/">Threat Intelligence</a></li>
<li id="menu-item-21322" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21322"><a href="https://thedfirreport.com/services/detection-rules/">Detection Rules</a></li>
<li id="menu-item-31037" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-31037"><a href="https://thedfirreport.com/services/dfir-labs/">DFIR Labs</a>
<ul class="sub-menu">
	<li id="menu-item-35457" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-35457"><a href="https://thedfirreport.com/services/dfir-labs/ctf/">Capture The Flag (CTF)</a></li>
	<li id="menu-item-32608" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-32608"><a href="https://thedfirreport.com/services/dfir-labs/dfir-labs-leaderboard/">Leaderboard</a></li>
	<li id="menu-item-38110" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-38110"><a href="https://thedfirreport.com/services/dfir-labs/ctf-winners/">CTF Winners</a></li>
</ul>
</li>
<li id="menu-item-21321" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-21321"><a href="https://thedfirreport.com/services/mentoring-coaching-program/">Mentoring &#038; Coaching Program</a>
<ul class="sub-menu">
	<li id="menu-item-21327" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21327"><a href="https://thedfirreport.com/services/mentoring-coaching-program/book-a-session/">Book A Session</a></li>
	<li id="menu-item-21328" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21328"><a href="https://thedfirreport.com/services/mentoring-coaching-program/meet-the-team/">Meet The Team</a></li>
</ul>
</li>
<li id="menu-item-21324" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21324"><a href="https://thedfirreport.com/services/case-artifacts/">Case Artifacts</a></li>
</ul>            </div><!-- .wrap -->
        </nav><!-- .secondary-navigation -->       
			<div class="main-header-brand">
				<div class="header-brand">
					<div class="wrap">
						<div class="header-brand-content">
							    <div class="site-branding">
                <div class="site-branding-text">

                           <p class="site-title"><a href="https://thedfirreport.com/" rel="home">The DFIR Report</a></p>
                                <p class="site-description">Real Intrusions by Real Attackers, The Truth Behind the Intrusion</p>
            
        </div><!-- .site-branding-text -->
    </div><!-- .site-branding -->


							<div class="header-right">
								<div class="header-banner">

																	</div><!-- .header-banner -->
							</div><!-- .header-right -->
						</div><!-- .header-brand-content -->
					</div><!-- .wrap -->
				</div><!-- .header-brand -->

				<div id="nav-sticker">
					<div class="navigation-top">
						<div class="wrap">
							<div id="site-header-menu" class="site-header-menu">
								<nav id="site-navigation" class="main-navigation" aria-label="Primary Menu">
								    <button class="menu-toggle" aria-controls="primary-menu" aria-expanded="false">
        <span class="toggle-text">Menu</span>
        <span class="toggle-bar"></span>
    </button>

    <ul id="primary-menu" class="menu nav-menu"><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-21337"><a href="https://thedfirreport.com/">Reports</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21314"><a href="https://thedfirreport.com/analysts/">Analysts</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-21315"><a href="https://thedfirreport.com/services/">Services</a>
<ul class="sub-menu">
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21319"><a href="https://thedfirreport.com/services/threat-intelligence/">Threat Intelligence</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21318"><a href="https://thedfirreport.com/services/detection-rules/">Detection Rules</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-31055"><a href="https://thedfirreport.com/services/dfir-labs/">DFIR Labs</a>
	<ul class="sub-menu">
		<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-35456"><a href="https://thedfirreport.com/services/dfir-labs/ctf/">Capture The Flag (CTF)</a></li>
		<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-32606"><a href="https://thedfirreport.com/services/dfir-labs/dfir-labs-leaderboard/">Leaderboard</a></li>
		<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-38108"><a href="https://thedfirreport.com/services/dfir-labs/ctf-winners/">CTF Winners</a></li>
	</ul>
</li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21320"><a href="https://thedfirreport.com/services/case-artifacts/">Case Artifacts</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-21317"><a href="https://thedfirreport.com/services/mentoring-coaching-program/">Mentoring &#038; Coaching Program</a>
	<ul class="sub-menu">
		<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21325"><a href="https://thedfirreport.com/services/mentoring-coaching-program/book-a-session/">Book A Session</a></li>
		<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21326"><a href="https://thedfirreport.com/services/mentoring-coaching-program/meet-the-team/">Meet The Team</a></li>
	</ul>
</li>
</ul>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-31033"><a href="https://store.thedfirreport.com/collections/dfir-labs">Access DFIR Labs</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21313"><a href="https://thedfirreport.com/subscribe/">Subscribe</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21316"><a href="https://thedfirreport.com/contact/">Contact Us</a></li>
</ul>								</nav><!-- #site-navigation -->
            			</div>
        				</div><!-- .wrap -->
     				</div><!-- .navigation-top -->
				<div class="clock"> 
					<div id="time"></div>
					<div id="date">Wednesday, December 18, 2024</div>
				</div>
				</div><!-- #nav-sticker -->
				       <nav class="secondary-navigation" role="navigation" aria-label="Secondary Navigation">
            <div class="wrap">
                <button class="secondary-menu-toggle" aria-controls="primary-menu" aria-expanded="false">
                    <span class="secondary-toggle-text">Menu</span>
                    <span class="secondary-toggle-bar"></span>
                </button>
                <ul id="primary-menu" class="secondary-menu"><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21323"><a href="https://thedfirreport.com/services/threat-intelligence/">Threat Intelligence</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21322"><a href="https://thedfirreport.com/services/detection-rules/">Detection Rules</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-31037"><a href="https://thedfirreport.com/services/dfir-labs/">DFIR Labs</a>
<ul class="sub-menu">
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-35457"><a href="https://thedfirreport.com/services/dfir-labs/ctf/">Capture The Flag (CTF)</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-32608"><a href="https://thedfirreport.com/services/dfir-labs/dfir-labs-leaderboard/">Leaderboard</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-38110"><a href="https://thedfirreport.com/services/dfir-labs/ctf-winners/">CTF Winners</a></li>
</ul>
</li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-21321"><a href="https://thedfirreport.com/services/mentoring-coaching-program/">Mentoring &#038; Coaching Program</a>
<ul class="sub-menu">
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21327"><a href="https://thedfirreport.com/services/mentoring-coaching-program/book-a-session/">Book A Session</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21328"><a href="https://thedfirreport.com/services/mentoring-coaching-program/meet-the-team/">Meet The Team</a></li>
</ul>
</li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21324"><a href="https://thedfirreport.com/services/case-artifacts/">Case Artifacts</a></li>
</ul>            </div><!-- .wrap -->
        </nav><!-- .secondary-navigation -->       
			</div><!-- .main-header-brand -->
						
							</div><!-- .main-header -->
	</header><!-- #masthead -->

	<div id="content" class="site-content">
		<div class="site-content-cell">
						<div class="wrap wrap-width">

	<div id="primary" class="content-area">
		<main id="main" class="site-main">

		
<article id="post-5314" class="post-5314 post type-post status-publish format-standard hentry category-cobaltstrike entry">
	
	<div class="entry-content-holder">
		<header class="entry-header">

		
				<div class="entry-meta">

					
		<span class="cat-links">
		
			<a class="category-color-6" href="https://thedfirreport.com/category/cobaltstrike/">cobaltstrike</a>
				</span>
	
				</div><!-- .entry-meta -->
			<h1 class="entry-title">Cobalt Strike, a Defenderâ€™s Guide &#8211; Part 2</h1>
		<div class="entry-meta">
			<span class="posted-on"><a href="https://thedfirreport.com/2022/01/24/cobalt-strike-a-defenders-guide-part-2/" rel="bookmark"><time class="entry-date published" datetime="2022-01-24T03:03:49+00:00">January 24, 2022</time></a></span>		</div><!-- .entry-meta -->

		
	</header><!-- .entry-header -->

	<div class="entry-content">
		<p class="ql-block" data-block-id="block-a739667c-2a7b-4547-8579-28edb92ad463">Our <a class="ql-link" href="https://thedfirreport.com/2021/08/29/cobalt-strike-a-defenders-guide/" target="_blank" rel="noopener noreferrer">previous report</a><span data-void-detect="true">Â on Cobalt Strike focused on the most frequently used capabilities that we had observed. In this report, we will focus on the network traffic it produced, and provide some easy wins defenders can be on the look out for to detect beaconing activity. We cover topics such as domain fronting, SOCKS proxy, C2 traffic, Sigma rules, JARM, JA3/S, RITA &amp; more.</span></p>
<p class="ql-block" data-block-id="block-a739667c-2a7b-4547-8579-28edb92ad463"><span data-void-detect="true">As with our previous article, we will highlight the common ways we see threat actors using Cobalt Strike.</span></p>
<p data-block-id="block-a7c27e78-eadd-41e9-a00f-fdcb60c131f3"><img fetchpriority="high" decoding="async" class="size-full wp-image-5341 aligncenter" src="https://thedfirreport.com/wp-content/uploads/2022/01/image2.png" alt="" width="707" height="353" srcset="https://thedfirreport.com/wp-content/uploads/2022/01/image2.png 707w, https://thedfirreport.com/wp-content/uploads/2022/01/image2-300x150.png 300w" sizes="(max-width: 707px) 100vw, 707px" /></p>
<p class="ql-block" data-block-id="block-a7c27e78-eadd-41e9-a00f-fdcb60c131f3">Big shout-out to <a class="ql-link" href="https://twitter.com/Kostastsale/" target="_blank" rel="noopener noreferrer">@Kostastsale</a><span data-void-detect="true"> for helping put this Part 2 together! Also thanks to </span><a class="ql-link" href="https://twitter.com/svch0st" target="_blank" rel="noopener noreferrer">@svch0st</a><span data-void-detect="true">, </span><a class="ql-link" href="https://twitter.com/pigerlin" target="_blank" rel="noopener noreferrer" data-void-detect="true"><span contenteditable="false">@pigerlin</span></a>, and <a class="ql-link" href="https://twitter.com/0xtornado" target="_blank" rel="noopener noreferrer"><span contenteditable="false">@0xtornado</span></a><span data-void-detect="true"> for reviewing this report.</span></p>
<h2 id="services" class="wp-block-heading"><a href="https://thedfirreport.com/2024/08/26/blacksuit-ransomware/#services">The DFIR Report Services</a></h2>
<ul class="wp-block-list">
<li><a href="https://thedfirreport.com/services/threat-intelligence/#threat-brief" target="_blank" rel="noreferrer noopener">Private Threat Briefs</a>: Over 20 private DFIR reports annually.</li>
<li><a href="https://thedfirreport.com/services/threat-intelligence/#threat-feed" target="_blank" rel="noreferrer noopener">Threat Feed</a>:Â Focuses on tracking Command and Control frameworks like Cobalt Strike, Metasploit, Sliver, etc.</li>
<li><a href="https://thedfirreport.com/services/threat-intelligence/#all-intel" target="_blank" rel="noreferrer noopener">All Intel</a>:Â Includes everything from Private Threat Briefs and Threat Feed, plus private events, opendir reports, long-term tracking, data clustering, and other curated intel.</li>
<li><a href="https://thedfirreport.com/services/detection-rules/" target="_blank" rel="noreferrer noopener">Private Sigma Ruleset</a>:Â Features 100+ Sigma rules derived from 40+ cases, mapped to ATT&amp;CK with test examples.</li>
<li><a href="https://thedfirreport.com/services/dfir-labs/" target="_blank" rel="noreferrer noopener">DFIR Labs</a>:Â Offers cloud-based, hands-on learning experiences, using real data, from real intrusions. Interactive labs are available with different difficulty levels and can be accessed on-demand, accommodating various learning speeds.</li>
</ul>
<p><a href="https://thedfirreport.com/contact/" target="_blank" rel="noreferrer noopener">Contact us</a>Â today for pricing or a demo!</p>
<p class="ql-block" data-block-id="block-8fa01ce9-4d77-4d99-85f2-465a5ce786ff">Even though network monitoring and detection capabilities do not come easy for many organizations, they can generally offer a high return on investment if implemented correctly. Malware has to contact its C2 server if it is to receive further instructions. This article will demonstrate how to detect this communication before threat actors accomplish their objectives. There are a couple of factors that we can utilize to fingerprint any suspicious traffic and subsequent infrastructure. Before we get into that part, we should first discuss what makes Cobalt Strike so versatile.</p>
<p class="ql-block" data-block-id="block-447a163c-35ae-46cf-a967-7a4a9e599302">Cobalt Strike&#8217;s versatility comes from the ability to change the indicators with each payload. This is made possible thanks to Malleable C2 profiles. Our other post touched on Malleable C2 profiles and how threat actors use them; however, that was just some of their many applications. Below you can find information related to some of the most important fields that could throw off an analyst while investigating a Cobalt Strike network communication:</p>
<p class="ql-block" data-block-id="block-8c6beb49-3a5c-4a46-899b-c359a04c4bb4"><em>The reference profile below is taken from Raphael Mudge&#8217;s GitHub <span class="ql-comment" data-comment-ids="648781176" data-comment-unresolved-ids="">repository</span>.</em></p>
<pre>###Global Options###
set sample_name "whatever.profile";
set sleeptime "0"; <span style="color: #ff0000;">&lt;================</span> # Decimal number to indicate the time the beacon will sleep for between communications in milliseconds
set jitter    "25"; <span style="color: #ff0000;">&lt;================</span> # A number that indicates the percentage of a random sleep time that beacon will introduce to its C2 comm
set useragent "&lt;string&gt;"; <span style="color: #ff0000;">&lt;================</span> # Custom user agent of your choice
set data_jitter "35"; <span style="color: #ff0000;">&lt;================</span> # Represents the value bytes variable that would instruct Cobalt Strike to send a random string on http-get/post to match the bytes value.
set headers_remove "&lt;header to remove&gt;"; <span style="color: #ff0000;">&lt;================</span> # Specifying headers to be removed in a comma separated manner.

####### Not much explanation is needed here, you can change the certificate information to your heart's content.#######
https-certificate {
    set C "US";
    set CN "whatever.com";
    set L "California";
    set O "whatever LLC.";
    set OU "local.org";
    set ST "CA";
    set validity "365";
}
###HTTP-Config Block###
http-config {
    set headers "&lt;headers to include&gt;"; <span style="color: #ff0000;">&lt;================</span> # Specifying the headers that you want to include.
    header "&lt;name of the header(s)&gt;";  <span style="color: #ff0000;">&lt;================</span> # Specifying the name of the header that will store the data that are transmitted to the C2 server
    set trust_x_forwarded_for "&lt;true OR false&gt;";  <span style="color: #ff0000;">&lt;================</span> # If the C2 server is behind a redirector, this option would allow to forward the traffic to the correct destination 
    set block_useragents "&lt;user agents&gt;";  <span style="color: #ff0000;">&lt;================</span> # User agents that C2 server will block and show a 404 response
    set allow_useragents "&lt;user agents&gt;"  <span style="color: #ff0000;">&lt;================</span> # Opposite of the above
}
###HTTP-GET Block. This function and all of its fields could also exist and be customized for the HTTP-POST Block (Server communication)###
http-get {
    set uri "/&lt;URI string&gt;";  <span style="color: #ff0000;">&lt;================</span> # Specifying the URI to reference in bidirectional communication from client and server
    set verb "POST";  <span style="color: #ff0000;">&lt;================</span> # Setting the verb when requesting available tasks from the C2 server.	   
    client {
        header "Host" "whatever.com";  <span style="color: #ff0000;">&lt;================</span> # Setting the header specific to client communication with the C2. 
        header "Connection" "close";
### Metadata corresponds to the information that the beacon is sending to the C2 server about itself. The operators may choose to enable additional fields that will include data on the C2 communication. You can mix and match fields below:
    metadata {
        #base64;  <span style="color: #ff0000;">&lt;================</span> # Base64 encoded string
        base64url;  <span style="color: #ff0000;">&lt;================</span> # URL safe Base64 encoded string
        #mask;  <span style="color: #ff0000;">&lt;================</span> # Encrypting and encoding the data with XOR mask and random key
        #netbios;  <span style="color: #ff0000;">&lt;================</span> # Encoding data as netbios in lower case
        #netbiosu;  <span style="color: #ff0000;">&lt;================</span> # Another variation of netbios encoding 
        #prepend "TEST123";  <span style="color: #ff0000;">&lt;================</span> # Choosing a string to prepend to the transmitted data
        append ".php";  <span style="color: #ff0000;">&lt;================</span> # Choosing a string to append
     ### Termination statements: This statement tells Beacon and its server wherein the transaction to store the transformed data. You may choose one of these termination statement methods.
        parameter "file";  <span style="color: #ff0000;">&lt;================</span> # Adding a parameter to the URI.
        #header "Cookie";  <span style="color: #ff0000;">&lt;================</span> # Adding a specific string within a specific header.
        #uri-append;  <span style="color: #ff0000;">&lt;================ <span style="color: #000000;"># Adding a specific string in the URI.</span> </span>
        #print;
    }
    parameter "test1" "t</pre>
<p class="ql-block" data-block-id="block-6d165789-04a6-4dfd-809f-4fa498ec4dcf">We added comments to the profile above to explain the numerous fields operators can change to customize the profile to their needs. All these different fields provide control and flexibility over the indicators of the C2 channel. Many free, open-source randomizer scripts exist to create a unique profile such as <a class="ql-link" href="https://github.com/threatexpress/random_c2_profile" target="_blank" rel="noopener noreferrer">Random C2 Profile Generator </a><span data-void-detect="true">by </span><a class="ql-link" href="https://twitter.com/joevest" target="_blank" rel="noopener noreferrer">@joevest</a><span data-void-detect="true">, </span><a class="ql-link" href="https://github.com/bluscreenofjeff/Malleable-C2-Randomizer" target="_blank" rel="noopener noreferrer">Malleable-C2-Randomizer</a><span data-void-detect="true"> by </span><a class="ql-link" href="https://twitter.com/bluscreenofjeff" target="_blank" rel="noopener noreferrer" data-void-detect="true">@bluscreenofjeff</a>, and <a class="ql-link" href="https://github.com/FortyNorthSecurity/C2concealer" target="_blank" rel="noopener noreferrer">C2concealer </a><span data-void-detect="true">by </span><a class="ql-link" href="https://twitter.com/FortyNorthSec" target="_blank" rel="noopener noreferrer">@FortyNorthSec</a>.</p>
<p class="ql-block" data-block-id="block-cce6b763-d12e-4296-8c6f-da94c5c0fcd1">Below are some of the Cobalt Strike C2 servers that we observed during intrusions. On the right column, we show the URLs that the Cobalt Strike payloads were configured to query. A trained eye could spot some of the Malleable profiles that exist on freely available resources such as Raphael Mudge&#8217;s list on his <a class="ql-link" href="https://github.com/rsmudge/Malleable-C2-Profiles" target="_blank" rel="noopener noreferrer">GitHub page</a>. Another example is the &#8220;<em>jquery-3.3.1.min.js&#8221; </em>which is associated with <a class="ql-link" href="https://github.com/threatexpress/malleable-c2/blob/master/jquery-c2.3.11.profile" target="_blank" rel="noopener noreferrer">this</a><span data-void-detect="true"> malleable C2 profile as we observed in </span><a class="ql-link" href="https://thedfirreport.com/?s=jquery-3.3.1" target="_blank" rel="noopener noreferrer">four intrusions</a><span data-void-detect="true">.</span></p>
<pre>+----------------------+-----------------------+
| C2 Server            |  URI queried          |
+----------------------+-----------------------+
| gawocag.com          | /nd                   |
| 190.114.254.116      | /push                 |
| 190.114.254.116      | /__utm.gif            |
| kaslose.com          | /jquery-3.3.1.min.js  |
| yawero.com           | /skin.js              |
| sazoya.com           | /skin.js              |
| 192.198.86.130       | /skin.js              |
| 162.244.83.216       | /jquery-3.3.1.min.js  |
| sammitng.com         | /jquery-3.3.1.min.js  |
| 23.19.227.147        | /styles.html          |
| securityupdateav.com | /tab_shop_active.html |
| 108.62.118.247       | /as                   |
| windowsupdatesc.com  | /as                   |
| 212.114.52.180       | /copyright.css        |
| defenderupdateav.com | /default.css          |
| onlineworkercz[.]com | /kj                   |
| checkauj.com         | /jquery-3.3.1.min.js  |
+----------------------+-----------------------+</pre>
<p class="ql-block" data-block-id="block-d2f4b286-13e5-473c-b054-f7cf47dbba6e">A deep dive into all available fields can be found on <a class="ql-link" href="https://blog.zsec.uk/cobalt-strike-profiles/" target="_blank" rel="noopener noreferrer">this post</a><span data-void-detect="true"> from </span><a class="ql-link" href="https://twitter.com/ZephrFish" target="_blank" rel="noopener noreferrer">@ZephrFish</a><span data-void-detect="true">. He also includes other fields related to post-exploitation beacon configuration along with network communication-related fields. Another great resource is </span><a class="ql-link" href="https://posts.specterops.io/a-deep-dive-into-cobalt-strike-malleable-c2-6660e33b0e0b" target="_blank" rel="noopener noreferrer" data-void-detect="true">this article</a><span data-void-detect="true"> released by SpecterOps.</span></p>
<h2 class="ql-heading" data-block-id="block-ddde2b59-8a37-4ff7-9f48-975fa0be0e73">Domain Fronting</h2>
<p class="ql-block" data-block-id="block-b2a283f4-c0ed-4fff-aaa6-15f48119ccca"><span class="ql-comment" data-comment-ids="696589931" data-comment-unresolved-ids="">Domain fronting is another method for concealing communication between the endpoint and the command and control servers.</span> The main purpose of domain fronting is to connect to a restricted host while pretending to communicate with an allowed host. It essentially masks your traffic to a certain website by masquerading it as a different domain.</p>
<p class="ql-block" data-block-id="block-6656c8ee-f3b7-4c20-bcfa-23350b9569da">This technique is possible thanks to Content Delivery Networks (CDNs). Domain fronting was mostly used by web services to bypass censorship in several countries that restricted traffic (e.g., China). In recent years, attackers have started using this technique to hide their malicious infrastructure behind legitimate domains. Because domain fronting is a complicated topic to grasp, below we have included an image from the official Cobalt Strike <a class="ql-link" href="https://www.cobaltstrike.com/blog/high-reputation-redirectors-and-domain-fronting/" target="_blank" rel="noopener noreferrer">page</a><span data-void-detect="true"> that discusses this technique.</span></p>
<p data-block-id="block-6656c8ee-f3b7-4c20-bcfa-23350b9569da"><a href="https://thedfirreport.com/wp-content/uploads/2022/01/image3.png"><img decoding="async" class="size-full wp-image-5343 aligncenter" src="https://thedfirreport.com/wp-content/uploads/2022/01/image3.png" alt="" width="1445" height="870" srcset="https://thedfirreport.com/wp-content/uploads/2022/01/image3.png 1445w, https://thedfirreport.com/wp-content/uploads/2022/01/image3-300x181.png 300w, https://thedfirreport.com/wp-content/uploads/2022/01/image3-1024x617.png 1024w, https://thedfirreport.com/wp-content/uploads/2022/01/image3-768x462.png 768w" sizes="(max-width: 1445px) 100vw, 1445px" /></a></p>
<div class="ql-block" data-block-id="block-b764674f-70b3-4d8e-b353-7ef4e4a564ca"></div>
<p class="ql-block" data-block-id="block-65efc977-d2dd-49bd-935e-de8c24d6f57a">Cobalt Strike made domain fronting possible by allowing the operators to configure related settings via the malleable C2 profiles. The following prerequisites must be met in order for domain fronting to be possible:</p>
<ol>
<li>Own a domain. (e.g., <span data-void-detect="true">infosecppl.store)</span></li>
<li>Pick one of the many web services that provide CDN capabilities. (e.g., <span data-void-detect="true">cloudfront.net).</span></li>
<li>Setup the CDN service to create a new CDN endpoint and redirect traffic to your domain. (e.g., <span data-void-detect="true">l33th4x0r.cloudfront.net).</span></li>
<li>Setup a profile to facilitate domain fronting.</li>
<li>Identify a domain that uses the same CDN to ensure that the traffic will be forwarded to the correct resource.</li>
</ol>
<p class="ql-block" data-block-id="block-6f997fac-9545-401e-83da-e0e3966e8557">Step five is where things get interesting. Attackers can use legitimate domains that are registered under the same CDN provider. As demonstrated in the screenshot above, all they have to do is include their CDN endpoint domain (created in step three) in the host header of the request. In that way, the legitimate website will forward the traffic through the CDN to the original destination according to the host header.</p>
<p class="ql-block" data-block-id="block-48213072-cd00-4570-9c72-6dd855339e66">In the screenshots below, you can see how the malleable C2 profiles are configured to allow domain fronting using the Fastly and AzureEdge CDNs:</p>
<p class="ql-block" data-block-id="block-48213072-cd00-4570-9c72-6dd855339e66"><a href="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-3.png"><img decoding="async" class="size-full wp-image-5344 aligncenter" src="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-3.png" alt="" width="1043" height="972" srcset="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-3.png 1043w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-3-300x280.png 300w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-3-1024x954.png 1024w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-3-768x716.png 768w" sizes="(max-width: 1043px) 100vw, 1043px" /></a></p>
<div data-block-id="block-f8452da4-49d7-46d7-ad3a-3276a79cb11d">This research <a class="ql-link" href="https://www.bamsoftware.com/papers/fronting/" target="_blank" rel="noopener noreferrer">paper</a><span data-void-detect="true"> released by academics from the University of California, Berkeley, is a great introduction to domain fronting. This paper inspired many researchers to expand the possibilities of this unique way of hiding the final destination server on web traffic. One of those researchers is </span><a class="ql-link" href="https://twitter.com/vysecurity" target="_blank" rel="noopener noreferrer">Vincent</a><span data-void-detect="true"> who wrote a great </span><a class="ql-link" href="https://www.vincentyiu.com/red-team/domain-fronting/domain-fronting-who-am-i" target="_blank" rel="noopener noreferrer" data-void-detect="true">article</a><span data-void-detect="true"> on domain fronting. He explains in simple terms how it works. He also published a </span><a class="ql-link" href="https://github.com/vysecurity/FindFrontableDomains" target="_blank" rel="noopener noreferrer" data-void-detect="true">Python</a><span data-void-detect="true"> script to identify possible domains that can be leveraged for domain fronting.</span></div>
<p class="ql-block" data-block-id="block-0394b004-6fdc-4e17-99c1-0392ced14dc1">Looking into our reporting, we don&#8217;t see many instances of domain fronting. This is most likely due to the complex process of setting up the necessary infrastructure. Although, based on the data we have collected regarding malicious infrastructure, domain fronting appears to be used by threat actors. According to our data from early 2021 up to now, Amazon Cloudfront takes the lead on preferable CDN used by threat actors, by a large margin.</p>
<p data-block-id="block-0394b004-6fdc-4e17-99c1-0392ced14dc1"><a href="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-4.png"><img loading="lazy" decoding="async" class="size-full wp-image-5345 aligncenter" src="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-4.png" alt="" width="790" height="467" srcset="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-4.png 790w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-4-300x177.png 300w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-4-768x454.png 768w" sizes="auto, (max-width: 790px) 100vw, 790px" /></a></p>
<p class="ql-block" data-block-id="block-787a1ba2-32ff-4a75-953c-c28322d9ab7a">The data above is available via our services. More information on this service and others can be found <a class="ql-link" href="https://thedfirreport.com/services/" target="_blank" rel="noopener noreferrer">here</a><span data-void-detect="true">.</span></p>
<h2 class="ql-heading" data-block-id="block-0fcc4289-b380-45c9-983e-79e7c71c75c1">Reverse Proxy using Cobalt Strike Beacon</h2>
<p class="ql-block" data-block-id="block-50bbb57f-8a4a-4f92-b49a-f704166c18c2">A technique that we come across often is a reverse proxy. We see instances where threat actors use their beacon sessions to establish RDP access through a reverse proxy. Cobalt Strike has the ability to run a SOCKS proxy server on the team server. This enables the operators to setup a listening port and leverage it to relay traffic to and from the open beacon session. The screenshot below demonstrates this implementation.</p>
<p data-block-id="block-50bbb57f-8a4a-4f92-b49a-f704166c18c2"><a href="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-5.png"><img loading="lazy" decoding="async" class="size-full wp-image-5347 aligncenter" src="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-5.png" alt="" width="1095" height="756" srcset="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-5.png 1095w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-5-300x207.png 300w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-5-1024x707.png 1024w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-5-768x530.png 768w" sizes="auto, (max-width: 1095px) 100vw, 1095px" /></a></p>
<p class="ql-block" data-block-id="block-4241e250-0b96-4ef5-b9cb-abc699941e12">Image credit: <a class="ql-link" href="https://www.cobaltstrike.com/blog/reverse-port-forward-through-a-socks-proxy/" target="_blank" rel="noopener noreferrer">cobaltstrike.com</a></p>
<p class="ql-block" data-block-id="block-b70dc71c-7562-483b-b853-1dd16c5ba5e9">Some of the cases we have observed threat actors using reverse proxy are:</p>
<ul>
<li><a class="ql-link" href="https://thedfirreport.com/2021/12/13/diavol-ransomware/" target="_blank" rel="noopener noreferrer">Diavol Ransomware</a></li>
<li><a class="ql-link" href="https://thedfirreport.com/2021/10/04/bazarloader-and-the-conti-leaks/" target="_blank" rel="noopener noreferrer">BazarLoader and the Conti Leaks</a></li>
<li><a class="ql-link" href="https://thedfirreport.com/2020/06/21/snatch-ransomware/" target="_blank" rel="noopener noreferrer">Snatch Ransomware</a></li>
</ul>
<p class="ql-block" data-block-id="block-ca9f955b-5d3a-4fba-a506-06498b667c63">In most, of the above cases, the aim of the attackers was to establish a Remote Desktop session. There are numerous advantages to establishing a RDP session, including the ability to navigate using a graphical environment and easily move laterally once the necessary access has been granted.</p>
<p class="ql-block" data-block-id="block-dda0983d-2d04-44fd-ac8b-f810b6dbb8d3">Below, we demonstrate how attackers take advantage of this technique using <a class="ql-link" href="https://github.com/haad/proxychains" target="_blank" rel="noopener noreferrer">proxychains</a><span data-void-detect="true"> from the attackers&#8217; kali Linux host. In the first image, the attackers open a socks listening port, in this case port 8888, on the Cobalt Strike team server.</span><a href="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-6.png"><img loading="lazy" decoding="async" class="size-full wp-image-5348 aligncenter" src="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-6.png" alt="" width="787" height="306" srcset="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-6.png 787w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-6-300x117.png 300w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-6-768x299.png 768w" sizes="auto, (max-width: 787px) 100vw, 787px" /></a></p>
<div class="ql-block" data-block-id="block-2e106290-16ac-46d3-9b97-fdc10ffa7f3c"><em>Creating the listening port (TCP port 8888)</em></div>
<div class="ql-block" data-block-id="block-4f8342b9-3d25-4828-b8e4-07fc533adddc"></div>
<p class="ql-block" data-block-id="block-ea1e65aa-f264-4053-806a-95c42f60e1bd">In this second image, we employ proxychains from the attacker&#8217;s Kali Linux host to RDP into our target&#8217;s environment via the SOCKS server. We essentially add the team server&#8217;s IP address into the proxychains configuration and connect with xfreerdp.</p>
<p data-block-id="block-ea1e65aa-f264-4053-806a-95c42f60e1bd"><a href="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-7.png"><img loading="lazy" decoding="async" class="size-full wp-image-5349 aligncenter" src="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-7.png" alt="" width="1358" height="911" srcset="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-7.png 1358w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-7-300x201.png 300w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-7-1024x687.png 1024w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-7-768x515.png 768w" sizes="auto, (max-width: 1358px) 100vw, 1358px" /></a><em>RDP into the target host using reverse proxy</em></p>
<p class="ql-block" data-block-id="block-f4b5e59e-8f5e-4ec4-9d70-d1505033ad86">Looking into the generated artifacts, we can see that a 4624 typ<span class="ql-comment ql-comment_active ql-comment_overlap" data-comment-ids="524453064" data-comment-unresolved-ids="524453064">e</span> 3 event is created on the target host. One interesting aspect that we have also mentioned in similar cases from our reporting is that the victim&#8217;s hostname is captured in this logon event as well as the source address being 127.0.0.1.</p>
<p class="ql-block" data-block-id="block-f4b5e59e-8f5e-4ec4-9d70-d1505033ad86"><a href="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-8.png"><img loading="lazy" decoding="async" class="size-full wp-image-5350 aligncenter" src="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-8.png" alt="" width="1477" height="1275" srcset="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-8.png 1477w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-8-300x259.png 300w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-8-1024x884.png 1024w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-8-768x663.png 768w" sizes="auto, (max-width: 1477px) 100vw, 1477px" /></a></p>
<div class="ql-block" data-block-id="block-f087a47a-3713-4c8f-a12a-139fc1838c8a"><em>Security Event ID 4624 Type 3 shows the attacker&#8217;s hostname</em></div>
<div class="ql-block" data-block-id="block-222d7ede-4439-4657-afeb-a7d72f0f2bc7"></div>
<p class="ql-block" data-block-id="block-7be22372-4c72-4e0d-9d1d-9c1645170e00">Once again, the running Cobalt Strike beacon acts as the intermediary to facilitate the Remote Desktop session via reverse proxy.</p>
<h2 class="ql-heading" data-block-id="block-14a1164e-b815-494f-9f20-13d1bb1b120c"><strong>Inside Cobalt Strike&#8217;s C2 Traffic</strong></h2>
<p class="ql-block" data-block-id="block-cfdd5670-efa3-4506-99b4-acd5469d285a">This section will attempt to illustrate how the different malleable C2 profiles can affect network communication.</p>
<p class="ql-block" data-block-id="block-4c050f65-a511-4f64-9aa7-4429c9638ab3">In some of the examples below, we simulated the malicious C2 channel to show how different malleable profile configurations can change the observed traffic. After that, we&#8217;ll examine network data associated with lateral movement and the various methods employed by Cobalt Strike operators based on our observations.</p>
<h3 class="ql-heading" data-block-id="block-7625bfa4-804a-4f1a-ab1c-e31bacd4e4ad"><strong>HTTP/HTTPS C2 traffic</strong></h3>
<p class="ql-block" data-block-id="block-8b3ba43e-35fa-4fa3-8320-6fb4a77ec2eb">We will use a slightly modified version of the <a href="https://raw.githubusercontent.com/threatexpress/malleable-c2/master/jquery-c2.3.11.profile" target="_blank" rel="noopener">jquery profile</a><span data-void-detect="true">Â </span>to illustrate how the configuration defines the various fields that make up the C2 connection. <span data-void-detect="true">Our previous article presented this jquery profile as one of the most commonly used profiles by threat actors in the intrusions we reported.</span></p>
<p data-block-id="block-8b3ba43e-35fa-4fa3-8320-6fb4a77ec2eb"><a href="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-9.png"><img loading="lazy" decoding="async" class="size-full wp-image-5351 aligncenter" src="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-9.png" alt="" width="1600" height="1006" srcset="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-9.png 1600w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-9-300x189.png 300w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-9-1024x644.png 1024w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-9-768x483.png 768w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-9-1536x966.png 1536w" sizes="auto, (max-width: 1600px) 100vw, 1600px" /></a></p>
<p class="ql-block" data-block-id="block-ec7cfac7-3339-4fef-aa93-68ec99dc007f"><span class="ql-comment" data-comment-ids="696589728" data-comment-unresolved-ids="">As shown above, malleable C2 profiles can generate unique network traffic based on the provided configuration. </span>A portion of the malleable C2 profile configuration is shown at the bottom half of the screenshot. At the top half of the screenshot, we show the HTTP communication between the Beacon and the Cobalt Strike server.</p>
<p class="ql-block" data-block-id="block-b47231d6-e5cf-4454-bb86-7850b66ab62a">The malleable profile determines the content of all parameters used in GET and POST requests. Because of how simple it is to change these parameters, creating network signatures for proactive defense can be difficult. <span class="ql-comment" data-comment-ids="696589778" data-comment-unresolved-ids="">Defenders can create signatures for publicly available profiles (see Sigma section below) or profiles extracted and made available thru open-source reporting. One could search for traffic that matches known patterns (such as jquery or amazon) but the target IP/domain does not match the expected infrastructure.</span></p>
<h3 class="ql-heading" data-block-id="block-76542420-a542-456f-936d-e27336bbca73"><strong>DNS C2 traffic</strong></h3>
<p class="ql-block" data-block-id="block-006e3ee6-5534-4cad-9b16-f54a9731df56">Cobalt Strike is capable of using DNS as the C2 method. Operators can choose to configure their server to respond to beacon requests in A, AAAA or TXT records. This strategy is useful for more covert operations, as the destination host could be a benign DNS server. Defenders will have to inspect the traffic data and look for suspicious DNS records.</p>
<p class="ql-block" data-block-id="block-1f8e13f3-df32-4f2d-9986-b0f45a71811e">The screenshot below is from the official Cobalt Strike <a class="ql-link" href="https://hstechdocs.helpsystems.com/manuals/cobaltstrike/current/userguide/content/topics/listener-infrastructue_beacon-dns.htm#_Toc65482739" target="_blank" rel="noopener noreferrer">documentation page</a><span data-void-detect="true"> and shows how DNS communication works between the compromised host and the C2 server.</span></p>
<p data-block-id="block-1f8e13f3-df32-4f2d-9986-b0f45a71811e"><a href="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-10.png"><img loading="lazy" decoding="async" class="size-full wp-image-5352 aligncenter" src="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-10.png" alt="" width="1600" height="956" srcset="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-10.png 1600w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-10-300x179.png 300w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-10-1024x612.png 1024w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-10-768x459.png 768w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-10-1536x918.png 1536w" sizes="auto, (max-width: 1600px) 100vw, 1600px" /></a></p>
<p class="ql-block" data-block-id="block-892eda2b-41a7-4299-9d4d-68ca42717edb">In the below example, we emulated this technique and configured the Beacon to communicate over DNS and request new tasks using A records. In the same way, we can configure the Beacon to use TXT or AAAA records for requesting tasks or sending information to the server. It is worth noting that the default method is the DNS TXT record data channel. Below is the infrastructure that we used for demonstration purposes:</p>
<ul>
<li>Target Host: 192.168.88.179</li>
<li>Internal DNS server: 192.168.88.2</li>
<li>Cobalt Strike C2 domain: <a class="ql-link" href="http://infosecppl.store" target="_blank" rel="noopener noreferrer">infosecppl.store</a></li>
</ul>
<p class="ql-block" data-block-id="block-83d73dac-7c84-4700-9fa7-55fc3bd91f1f">We instructed the Beacon to execute the command systeminfo on the compromised host. As you can see from the screenshot below, it took 148 packets containing DNS requests and responses to finish the task and send back the data to the Cobalt Strike Server. The activity took 5 seconds to complete.</p>
<div class="ql-block" data-block-id="block-875bda3d-0a87-46af-913c-06117f3921f5"><a href="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-11.png"><img loading="lazy" decoding="async" class="size-full wp-image-5353 aligncenter" src="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-11.png" alt="" width="1600" height="526" srcset="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-11.png 1600w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-11-300x99.png 300w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-11-1024x337.png 1024w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-11-768x252.png 768w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-11-1536x505.png 1536w" sizes="auto, (max-width: 1600px) 100vw, 1600px" /></a></div>
<p class="ql-block" data-block-id="block-c6a79889-f86a-449c-952a-7c802844a942">As with HTTP/HTTPS traffic, DNS traffic can be randomized using malleable C2 profiles. Some of the options that are available to threat actors are as follows:</p>
<p data-block-id="block-c6a79889-f86a-449c-952a-7c802844a942"><a href="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-12.png"><img loading="lazy" decoding="async" class="size-full wp-image-5354 aligncenter" src="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-12.png" alt="" width="1277" height="573" srcset="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-12.png 1277w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-12-300x135.png 300w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-12-1024x459.png 1024w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-12-768x345.png 768w" sizes="auto, (max-width: 1277px) 100vw, 1277px" /></a><em>The above table was taken from <a href="https://www.cobaltstrike.com/help-malleable-c2#dns-beacon-bm" target="_blank" rel="noopener">Cobalt Strike&#8217;s official documentation</a></em></p>
<h3 data-block-id="block-fdfe0d2c-b0e1-4c1d-ab49-9b224017e205"><strong>SMB Beacons</strong></h3>
<p class="ql-block" data-block-id="block-ac88be4b-0180-4af2-bb5d-e8d5dc59618c">Another option for threat actors is to employ SMB beacons, once they have gained access to the network. SMB beacons open a local port on the target host and listen for incoming communication from a parent beacon. The communication between the two beacons is possible thanks to named pipes.</p>
<p class="ql-block" data-block-id="block-6730efa7-4bde-4d8d-894c-84daadb31628">The operators can configure the pipename on the client; however, the default pipename starts with &#8220;<em>msagent_#&#8221; </em>for SMB beacons. For a list of default pipe names for other services including some custom profiles check out @svch0st&#8217;s post <a class="ql-link" href="https://svch0st.medium.com/guide-to-named-pipes-and-hunting-for-cobalt-strike-pipes-dc46b2c5f575" target="_blank" rel="noopener noreferrer">here</a><span data-void-detect="true">.</span></p>
<p data-block-id="block-6730efa7-4bde-4d8d-894c-84daadb31628"><a href="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-21.png"><img loading="lazy" decoding="async" class="size-full wp-image-5364 aligncenter" src="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-21.png" alt="" width="687" height="587" srcset="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-21.png 687w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-21-300x256.png 300w" sizes="auto, (max-width: 687px) 100vw, 687px" /></a></p>
<p class="ql-block" data-block-id="block-b6d570e3-a5e2-4359-af4e-ced0af2463ec">SMB beacons are mostly used to make network detection harder and to get access to isolated systems where communication to the internet is prohibited. Additionally, due to SMB protocol being accessible in most internal networks, it makes for a reliable C2 method. Operators can also chain beacons and move laterally inside the network.</p>
<p class="ql-block" data-block-id="block-224d7522-8304-4336-badc-725cdd19ad0f">According to our records, SMB beacons are not frequently used. However, they&#8217;re still a powerful weapon in the hands of skilled operators. As we do not see SMB beacons used often in our intrusion cases, we took an example case from our lab to demonstrate the effectiveness of this method.</p>
<p class="ql-block" data-block-id="block-20b3da12-a143-4c2f-a9b5-6216489274fd">We ran a PowerShell loader on the target host, which loaded a stageless SMB beacon in memory. In our case, the SMB Beacon is communicating over the network with a parent Beacon using named pipes. For this example, we chose the named pipe &#8220;my_pipes&#8221;.</p>
<p data-block-id="block-20b3da12-a143-4c2f-a9b5-6216489274fd"><a href="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-22.png"><img loading="lazy" decoding="async" class="size-full wp-image-5365 aligncenter" src="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-22.png" alt="" width="482" height="262" srcset="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-22.png 482w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-22-300x163.png 300w" sizes="auto, (max-width: 482px) 100vw, 482px" /></a></p>
<p class="ql-block" data-block-id="block-ecdcf42e-42c8-49a9-b624-bbcae2385dae">As you can see from the screenshots below, windows event 4688 contains the execution of the PowerShell command.</p>
<p data-block-id="block-ecdcf42e-42c8-49a9-b624-bbcae2385dae"><a href="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-23.png"><img loading="lazy" decoding="async" class="size-full wp-image-5366 aligncenter" src="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-23.png" alt="" width="1133" height="423" srcset="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-23.png 1133w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-23-300x112.png 300w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-23-1024x382.png 1024w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-23-768x287.png 768w" sizes="auto, (max-width: 1133px) 100vw, 1133px" /></a></p>
<p class="ql-block" data-block-id="block-36b4ce7f-af67-4004-a524-f5e893aab3a9">As explained in our <a class="ql-link" href="https://thedfirreport.com/2021/08/29/cobalt-strike-a-defenders-guide/" target="_blank" rel="noopener noreferrer">previous Cobalt Strike</a><span data-void-detect="true"> article, Sysmon events 17 and 18 can log named pipes. However, Sysmon should be explicitly configured to log named pipes. A good public Sysmon config that includes named pipes and much more is </span><a class="ql-link" href="https://twitter.com/olafhartong" target="_blank" rel="noopener noreferrer">Olaf</a><span data-void-detect="true">&#8216;s </span><a class="ql-link" href="https://github.com/olafhartong/sysmon-modular" target="_blank" rel="noopener noreferrer">Sysmon Moduler</a><span data-void-detect="true">. </span></p>
<p class="ql-block" data-block-id="block-4b6506dd-63f6-4a6d-92f0-bf9b6a6cd7b9">Below, you can see the named pipe created that we specified on the Cobalt Strike interface when we created the SMB listener.</p>
<p data-block-id="block-4b6506dd-63f6-4a6d-92f0-bf9b6a6cd7b9"><a href="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-24.png"><img loading="lazy" decoding="async" class="size-full wp-image-5367 aligncenter" src="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-24.png" alt="" width="659" height="291" srcset="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-24.png 659w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-24-300x132.png 300w" sizes="auto, (max-width: 659px) 100vw, 659px" /></a></p>
<p class="ql-block" data-block-id="block-f48bff1b-2978-4e33-a802-9e423ae7b1ae">Furthermore, the SMB Beacon will communicate over port 445 to the main beacon as we described above, which will then send the results to the C2 server. This is known as chaining beacons. The below screenshot illustrates the SMB communication between the beacon on the beachhead host and the chained beacon(s). Another way to describe the communication is a parent/child relationship.</p>
<p data-block-id="block-f48bff1b-2978-4e33-a802-9e423ae7b1ae"><a href="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-25.png"><img loading="lazy" decoding="async" class="size-full wp-image-5368 aligncenter" src="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-25.png" alt="" width="2446" height="1758" srcset="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-25.png 2446w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-25-300x216.png 300w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-25-1024x736.png 1024w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-25-768x552.png 768w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-25-1536x1104.png 1536w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-25-2048x1472.png 2048w" sizes="auto, (max-width: 2446px) 100vw, 2446px" /></a></p>
<p class="ql-block" data-block-id="block-6da3e39e-62de-49c1-b40d-8afa923450a8">The network traffic shows the target host communicating over SMB with the other compromised host running the parent HTTP Beacon. Named Pipes are used to facilitate the transition of data.</p>
<p class="ql-block" data-block-id="block-e3455e63-0ff3-4ea0-bd2d-a5a0e3e5f89c"><em>192.168.38.102 = SMB Beacon</em></p>
<p class="ql-block" data-block-id="block-e0a58752-d54f-4f6b-b271-e9c98fb26198"><em>192.168.38.104 = HTTP Parent Beacon</em></p>
<p data-block-id="block-e0a58752-d54f-4f6b-b271-e9c98fb26198"><a href="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-26.png"><img loading="lazy" decoding="async" class="size-full wp-image-5369 aligncenter" src="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-26.png" alt="" width="1234" height="500" srcset="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-26.png 1234w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-26-300x122.png 300w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-26-1024x415.png 1024w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-26-768x311.png 768w" sizes="auto, (max-width: 1234px) 100vw, 1234px" /></a></p>
<h2 class="ql-heading" data-block-id="block-1ac085ac-dd0d-4981-9a33-fb1ecd847f11"><strong>Detecting and Analyzing C2 Traffic</strong></h2>
<p class="ql-block" data-block-id="block-62650312-c03f-4e6d-865d-a3dc5e0ae78f">Thanks to free, open-source tooling, investigating network traffic has become more accessible. There are specific tools that we use to analyze suspicious network traffic in our intrusion cases. We believe that no single tool can provide complete detection coverage, but we can get close by combining them. In the following section, we will look at these tools that could accelerate analysis for defenders.</p>
<h3 class="ql-heading" data-block-id="block-2b8acd82-8a4d-418f-888b-503a73e519db">Sigma</h3>
<p class="ql-block" data-block-id="block-ec83c110-47bd-4afb-aa1f-51a8c0266f34">We&#8217;ll go through a few Sigma rules that can help us detect Cobalt Strike&#8217;s network activity.</p>
<p class="ql-block" data-block-id="block-0f41cb98-01be-43f2-b4a6-bdac8e65710a"><a class="ql-link" href="https://github.com/SigmaHQ/sigma/blob/master/rules/network/net_mal_dns_cobaltstrike.yml" target="_blank" rel="noopener noreferrer">Cobalt Strike DNS Beaconing</a><span data-void-detect="true"> is a rule created by <a href="https://twitter.com/cyb3rops" target="_blank" rel="noopener">Florian Roth</a> which looks</span> at DNS logs to detect the default DNS C2 behavior based on the dns_stager_subhost, put_output and dns_stager_subhost as seen above.</p>
<p data-block-id="block-0f41cb98-01be-43f2-b4a6-bdac8e65710a"><a href="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-27.png"><img loading="lazy" decoding="async" class="size-full wp-image-5370 aligncenter" src="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-27.png" alt="" width="604" height="577" srcset="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-27.png 604w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-27-300x287.png 300w" sizes="auto, (max-width: 604px) 100vw, 604px" /></a></p>
<p class="ql-block" data-block-id="block-6f8c568b-cfd5-42fc-ad80-be94d5124be8">Below is a more generic <a class="ql-link" href="https://bradleyjkemp.dev/sigmadoc/rules/network/net_dns_c2_detection.yml/" target="_blank" rel="noopener noreferrer">rule</a><span data-void-detect="true"> created by </span><a class="ql-link" href="https://twitter.com/bareiss_patrick" target="_blank" rel="noopener noreferrer">@bareiss_patrick</a><span data-void-detect="true"> which is a good example of detecting suspicious DNS traffic based on</span> a high amount of queries for a single domain.</p>
<p data-block-id="block-6f8c568b-cfd5-42fc-ad80-be94d5124be8"><a href="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-28.png"><img loading="lazy" decoding="async" class="size-full wp-image-5371 aligncenter" src="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-28.png" alt="" width="736" height="536" srcset="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-28.png 736w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-28-300x218.png 300w" sizes="auto, (max-width: 736px) 100vw, 736px" /></a></p>
<p class="ql-block" data-block-id="block-d0ec5ef8-9eca-4965-87b8-d6c175f69d9a">Another more generic <a class="ql-link" href="https://github.com/SigmaHQ/sigma/blob/eb382c4a59b6d87e186ee269805fe2db2acf250e/rules/network/net_high_txt_records_requests_rate.yml" target="_blank" rel="noopener noreferrer">rule</a> created by <a href="https://twitter.com/yugoslavskiy" target="_blank" rel="noopener">Daniil Yugoslavskiy</a> uses dns logs to look for 50 or more TXT records from a single source in one minute:</p>
<p data-block-id="block-d0ec5ef8-9eca-4965-87b8-d6c175f69d9a"><a href="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-29.png"><img loading="lazy" decoding="async" class="size-full wp-image-5372 aligncenter" src="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-29.png" alt="" width="1059" height="485" srcset="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-29.png 1059w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-29-300x137.png 300w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-29-1024x469.png 1024w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-29-768x352.png 768w" sizes="auto, (max-width: 1059px) 100vw, 1059px" /></a></p>
<p class="ql-block" data-block-id="block-8b7b2986-ad8d-4276-a1eb-b2848e4f8473"><a class="ql-link" href="https://github.com/SigmaHQ/sigma/blob/eb382c4a59b6d87e186ee269805fe2db2acf250e/rules/network/zeek/zeek_default_cobalt_strike_certificate.yml" target="_blank" rel="noopener noreferrer">Default Cobalt Strike Certificate</a><span data-void-detect="true"> is a rule written by <a href="https://twitter.com/bh4b3sh" target="_blank" rel="noopener">Bhabesh Raj</a> that uses Zeek logs </span>to detect the default Cobalt Strike certificate.</p>
<p data-block-id="block-8b7b2986-ad8d-4276-a1eb-b2848e4f8473"><a href="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-30.png"><img loading="lazy" decoding="async" class="size-full wp-image-5373 aligncenter" src="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-30.png" alt="" width="1027" height="560" srcset="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-30.png 1027w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-30-300x164.png 300w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-30-1024x558.png 1024w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-30-768x419.png 768w" sizes="auto, (max-width: 1027px) 100vw, 1027px" /></a></p>
<p class="ql-block" data-block-id="block-8d02e807-4c8d-4a50-87e2-512ef0dcd108"><a class="ql-link" href="https://github.com/SigmaHQ/sigma/blob/eb382c4a59b6d87e186ee269805fe2db2acf250e/rules/windows/builtin/security/win_rdp_reverse_tunnel.yml" target="_blank" rel="noopener noreferrer">RDP over Reverse SSH Tunnel WFP</a><span data-void-detect="true"> by </span><a class="ql-link" href="blank" target="_blank" rel="noopener noreferrer" data-void-detect="true">Samir Bous</a><a class="ql-link" href="blank" target="_blank" rel="noopener noreferrer">seaden</a><span data-void-detect="true"> is a rule that can look for suspicious RDP activity using reverse tunneling.</span></p>
<p data-block-id="block-8d02e807-4c8d-4a50-87e2-512ef0dcd108"><a href="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-31.png"><img loading="lazy" decoding="async" class="size-full wp-image-5374 aligncenter" src="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-31.png" alt="" width="1016" height="807" srcset="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-31.png 1016w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-31-300x238.png 300w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-31-768x610.png 768w" sizes="auto, (max-width: 1016px) 100vw, 1016px" /></a></p>
<p class="ql-block" data-block-id="block-066a25d3-092b-49e9-81bc-cca4c8c855d4"><a class="ql-link" href="https://github.com/SigmaHQ/sigma/blob/master/rules/proxy/proxy_cobalt_amazon.yml" target="_blank" rel="noopener noreferrer" data-void-detect="true">CobaltStrike Malleable Amazon Browsing Traffic Profile</a><span data-void-detect="true"> by </span><a class="ql-link" href="https://twitter.com/markus_neis" target="_blank" rel="noopener noreferrer">Markus Neis</a><span data-void-detect="true"> which looks at proxy logs for the Amazon Malleable profile.</span></p>
<p data-block-id="block-066a25d3-092b-49e9-81bc-cca4c8c855d4"><a href="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-32.png"><img loading="lazy" decoding="async" class="size-full wp-image-5375 aligncenter" src="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-32.png" alt="" width="888" height="684" srcset="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-32.png 888w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-32-300x231.png 300w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-32-768x592.png 768w" sizes="auto, (max-width: 888px) 100vw, 888px" /></a></p>
<p class="ql-block" data-block-id="block-79e12b4d-fd1a-4e07-8a3d-4a3a13247f24">Other malleable profile rules include <a class="ql-link" href="https://github.com/SigmaHQ/sigma/blob/master/rules/proxy/proxy_cobalt_malformed_uas.yml" target="_blank" rel="noopener noreferrer">CobaltStrike Malformed UAs in Malleable Profiles</a><span data-void-detect="true">, </span><a class="ql-link" href="https://github.com/SigmaHQ/sigma/blob/master/rules/proxy/proxy_cobalt_ocsp.yml" target="_blank" rel="noopener noreferrer">CobaltStrike Malleable (OCSP) Profile</a><span data-void-detect="true">, and </span><a class="ql-link" href="https://github.com/SigmaHQ/sigma/blob/master/rules/proxy/proxy_cobalt_onedrive.yml" target="_blank" rel="noopener noreferrer">CobaltStrike Malleable OneDrive Browsing Traffic Profile</a>.</p>
<p class="ql-block" data-block-id="block-ee4a03fa-68da-42d2-bf05-2c78f9a4200f">All Sigma rules here are documented towards the bottom of <a class="ql-link" href="https://thedfirreport.com/2021/08/29/cobalt-strike-a-defenders-guide/" target="_blank" rel="noopener noreferrer">Part 1</a><span data-void-detect="true">.</span></p>
<h3 class="ql-heading" data-block-id="block-47bd5a86-5340-454f-a622-93ad6ccc3134"><strong>Rita</strong></h3>
<p class="ql-block" data-block-id="block-c2f4fe6e-12dd-4e6e-a239-b6fdf0b7c02a">Rita stands for Real Intelligence Threat Analytics (RITA), developed by <a class="ql-link" href="https://www.activecountermeasures.com/" target="_blank" rel="noopener noreferrer">Active Countermeasures</a><span data-void-detect="true">. Rita is a framework for detecting command and control communication. It takes Zeek logs data and can, in our experience, accurately detect beaconing activity. </span></p>
<p class="ql-block" data-block-id="block-6ac3a6b4-8bb8-42b8-95dd-836260c04ed1"><span data-void-detect="true">One of the great features of Rita is its ease of use and detailed output information in various forms, including CSV and HTML. One</span> simply can point Rita to the Zeek logs and wait for the results. The more available data, the more precise the results will be. Zeek logs can be<span data-void-detect="true"> generated from the PCAP(s).</span></p>
<p class="ql-block" data-block-id="block-49573aff-7d64-4f9c-b76c-2bd2859ac57e">The screenshot samples below show the results created by Rita based on the traffic we used in the previous sections to demonstrate the jquery malleable C2 profile.</p>
<p data-block-id="block-49573aff-7d64-4f9c-b76c-2bd2859ac57e"><a href="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-33.png"><img loading="lazy" decoding="async" class="size-full wp-image-5376 aligncenter" src="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-33.png" alt="" width="1600" height="216" srcset="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-33.png 1600w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-33-300x41.png 300w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-33-1024x138.png 1024w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-33-768x104.png 768w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-33-1536x207.png 1536w" sizes="auto, (max-width: 1600px) 100vw, 1600px" /></a></p>
<p class="ql-block" data-block-id="block-8cb75f15-9ef0-4309-8976-b837d007abe3">We left the Beacon running for an hour to simulate an actual infection while several other network-unrelated processes ran in the background. During this hour, we tasked the Beacon with carrying out several commands. Rita determined that one hour of network data was adequate for identifying the beacon link and assigning it the highest score. Although, the more data you have, the more accurate the results will be.</p>
<p class="ql-block" data-block-id="block-6bc6f720-3d29-4c75-a4a4-e94579452fea">Below, we can see the results from one of our recent cases, <a href="https://thedfirreport.com/2021/10/04/bazarloader-and-the-conti-leaks/" target="_blank" rel="noopener">BazarLoader and the Conti Leaks</a><span data-void-detect="true">. The first three IP addresses relate to the CS servers with which the Beacon communicated.</span></p>
<p data-block-id="block-6bc6f720-3d29-4c75-a4a4-e94579452fea"><a href="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-34.png"><img loading="lazy" decoding="async" class="size-full wp-image-5377 aligncenter" src="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-34.png" alt="" width="1600" height="82" srcset="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-34.png 1600w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-34-300x15.png 300w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-34-1024x52.png 1024w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-34-768x39.png 768w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-34-1536x79.png 1536w" sizes="auto, (max-width: 1600px) 100vw, 1600px" /></a></p>
<p class="ql-block" data-block-id="block-59d8bb78-a019-4e30-bfcc-62cfca6b07c7">Rita accurately identified beaconing activity related to Cobalt Strike C2 communication. Using Rita, we can identify malicious C2 traffic based on multiple variables, including communication frequency, average bytes sent/received, number of connections etc. As a result, we can detect Cobalt Strike beaconing regardless of the malleable C2 profile utilized or any additional jitter present.</p>
<h3 class="ql-heading" data-block-id="block-769deb1a-af34-40d0-901e-ba409bb8c00b"><strong>JA3/JA3S</strong></h3>
<p class="ql-block" data-block-id="block-d267e2a8-99f2-4ff9-8338-cee30e661e87">JA3 is an open-source project created by <a class="ql-link" href="https://www.linkedin.com/in/johnalthouse/" target="_blank" rel="noopener noreferrer">John Althouse</a><span data-void-detect="true">, </span><a class="ql-link" href="https://www.linkedin.com/in/annh/" target="_blank" rel="noopener noreferrer">Jeff Atkinson</a><span data-void-detect="true"> and </span><a class="ql-link" href="https://www.linkedin.com/in/joshratkins/" target="_blank" rel="noopener noreferrer">Josh Atkins</a><span data-void-detect="true">. JA3/JA3S can create SSL fingerprints for communication between clients and servers. The unique signatures can represent several values collected from fields in the Client Hello packet:</span></p>
<pre class="ql-block" data-block-id="block-a0f89f69-0688-46e4-a44d-8fa1ba5187e6">- SSL Version
- Accepted Ciphers
- List of Extensions
- Elliptic Curves
- Elliptic Curve Formats</pre>
<p class="ql-block" data-block-id="block-9a332a0c-9e31-472e-b47f-0c327872cfc1">For more information on how JA3 works, you can visit the official GitHub repository here: <a class="ql-link" href="https://github.com/salesforce/ja3" target="_blank" rel="noopener noreferrer">https://github.com/salesforce/ja3</a><span data-void-detect="true">.</span></p>
<p class="ql-block" data-block-id="block-33b06801-8211-44b3-8b54-49838d3e4efc">The JA3 tool is used to generate a signature for the client-side beacon connection with the server. JA3S, on the other hand, is able to generate a server fingerprint. The combination of the two can produce the most accurate result. JA3S can capture the full cryptographic communication and combine the JA3 findings to generate the signature.</p>
<p class="ql-block" data-block-id="block-4b4bbf68-cf36-4a71-8c21-a9045e690256">The downside of this method is that it can produce inaccurate results if the Cobalt Strike is behind redirectors.</p>
<p class="ql-block" data-block-id="block-7cca5820-7e3f-491a-82ea-556ebf1cecc8">We can find many <a class="ql-link" href="https://thedfirreport.com/?s=72a589da586844d7f0818ce684948eea" target="_blank" rel="noopener noreferrer">reports</a><span data-void-detect="true"> that contain the JA3 value that corresponds to the Cobalt Strike fingerprint. When it comes to Cobalt Strike infrastructure, the known JA3 and JA3s signatures that we are looking for are:</span></p>
<p class="ql-block" data-block-id="block-3ecbb5ca-f10a-42c2-9af6-6b441c27ae86"><strong>JA3</strong></p>
<ul>
<li>72a589da586844d7f0818ce684948eea</li>
<li>a0e9f5d64349fb13191bc781f81f42e1</li>
</ul>
<p class="ql-block" data-block-id="block-3c4fdd5e-3d2c-4270-b9f0-4f9848bfbdec"><strong>JA3s</strong></p>
<ul>
<li>b742b407517bac9536a77a7b0fee28e9</li>
<li>ae4edc6faf64d08308082ad26be60767</li>
</ul>
<p class="ql-block" data-block-id="block-d9f47d0f-5bdb-4822-9366-7d645c0969c5">By using JA3/S signatures, we can discover various malware C2 servers and not just Cobalt Strike. Salesforce provides a thorough collection of signatures that belong to many different applications <a class="ql-link" href="https://github.com/salesforce/ja3/tree/master/lists" target="_blank" rel="noopener noreferrer">here</a><span data-void-detect="true">. Some other example signatures with well known JA3 fingerprints are:</span></p>
<ul>
<li>Trickbot: 6734f37431670b3ab4292b8f60f29984</li>
<li><span class="ql-comment" data-comment-ids="648784542" data-comment-unresolved-ids="">AsyncRat: </span>fc54e0d16d9764783542f0146a98b300</li>
<li>Dridex: 51c64c77e60f3980eea90869b68c58a8</li>
<li>JA3 of Python usually hosting Empire or PoshC2: db42e3017c8b6d160751ef3a04f695e7</li>
<li>TOR client: e7d705a3286e19ea42f587b344ee6865</li>
</ul>
<p class="ql-block" data-block-id="block-dfe19d4e-7ba8-4312-8af2-e8c6e490865e">Another very good website to test the JA3 signature against a large database is <a class="ql-link" href="https://ja3er.com" target="_blank" rel="noopener noreferrer">ja3er</a><span data-void-detect="true">.</span></p>
<h3 class="ql-heading" data-block-id="block-1962eb4a-f67b-4294-b29c-68c6a0b87320"><strong>JARM</strong></h3>
<p class="ql-block" data-block-id="block-a7103fdf-53fc-4125-ac83-705989877664">Similar to JA3/JA3S, JARM has the ability to fingerprint the TLS values of the remote server. It does this by interacting with the target server sending 10 TLS Client Hello packets and recording the specific attributes from the replies. It will then hash the result values and create the final JARM fingerprint.</p>
<p class="ql-block" data-block-id="block-a43a480a-0b1a-4294-9d6e-3d57e397a633">Unlike JA3/S, JARM is an active way of fingerprinting remote server applications. <a class="ql-link" href="https://twitter.com/4a4133?lang=en" target="_blank" rel="noopener noreferrer">John Althouse</a><span data-void-detect="true"> has created a </span><a class="ql-link" href="https://medium.com/@jalthouse/great-question-11aa555f6b28" target="_blank" rel="noopener noreferrer">medium post</a><span data-void-detect="true"> that accurately conveys the differences between JA3/S and JARM:</span></p>
<p class="ql-block" data-block-id="block-3ff3ab64-7f6c-49c0-a408-5737049c697c"><em>&#8220;JARM actively scans the server and builds a fingerprint of the server application. Whereas JA3/S is passive, just listening, not reaching out, JARM is active, actively probing the target. And is able to build a fingerprint of the server application where JA3S could not.&#8221;</em></p>
<p class="ql-block" data-block-id="block-2f663c41-e9ab-4adb-93a9-712daa339f9c">According to research and further changes on the JAVA TLS version as mentioned below, the JARM fingerprint that corresponds to a default configuration of the Cobalt Strike is:</p>
<ul>
<li><em>07d14d16d21d21d00042d41d00041de5fb3038104f457d92ba02e9311512c2</em></li>
</ul>
<p class="ql-block" data-block-id="block-f4ff6793-adb4-474f-b053-ba5d40077500">Cobalt Strike is dependent on Java to run both the client graphical user interface (GUI) and the team server. When we scan a Cobalt Strike server using JARM, the results we get back are dependent on the Java version that is used. According to Cobalt Strike&#8217;s <a class="ql-link" href="https://www.cobaltstrike.com/help-java-dependency" target="_blank" rel="noopener noreferrer">documentation</a><span data-void-detect="true">, OpenJDK 11 is the preferred version that needs to be installed by the operators. This makes it easier to identify a potential Cobalt Strike server, however, defenders should be aware that this outcome alone is prone to false positives. This is because many other legitimate servers on the internet use this version of Java to operate their web applications.</span></p>
<p class="ql-block" data-block-id="block-b2ade06d-3c96-4d57-8fe1-de9923110440">On <span class="ql-comment" data-comment-ids="726227190" data-comment-unresolved-ids="">April 20th</span>, 2021 Java Disabled TLS 1.0 and TLS 1.1 in favor of TLS 1.2 or above. Following this change, the JARM fingerprint for Cobalt Strike servers changed:</p>
<p class="ql-block" data-block-id="block-b5ab0c0f-2cc0-4951-84fc-fb7bfce686f3">From: <em>07d14d16d21d21d07c42d41d00041d24a458a375eef0c576d23a7bab9a9fb1</em></p>
<p class="ql-block" data-block-id="block-c7a0f71a-0e62-4e10-8b14-61f078be5cf3">To: <em>07d14d16d21d21d00042d41d00041de5fb3038104f457d92ba02e9311512c2</em></p>
<p data-block-id="block-c7a0f71a-0e62-4e10-8b14-61f078be5cf3"><a href="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-35.png"><img loading="lazy" decoding="async" class="size-full wp-image-5378 aligncenter" src="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-35.png" alt="" width="743" height="152" srcset="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-35.png 743w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-35-300x61.png 300w" sizes="auto, (max-width: 743px) 100vw, 743px" /></a></p>
<p data-block-id="block-c7a0f71a-0e62-4e10-8b14-61f078be5cf3">This change was highlighted by <a class="ql-link" href="https://twitter.com/bodziurity" target="_blank" rel="noopener noreferrer">@bodziurity</a><span data-void-detect="true"> and </span><a class="ql-link" href="https://twitter.com/WLesicki" target="_blank" rel="noopener noreferrer">@WLesicki</a><span data-void-detect="true"> in a collaborative effort:</span></p>
<p data-block-id="block-a1666d9f-5141-4098-a452-ea8c14307c5a"><a href="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-36.png"><img loading="lazy" decoding="async" class="size-full wp-image-5379 aligncenter" src="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-36.png" alt="" width="585" height="611" srcset="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-36.png 585w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-36-287x300.png 287w" sizes="auto, (max-width: 585px) 100vw, 585px" /></a></p>
<p data-block-id="block-a1666d9f-5141-4098-a452-ea8c14307c5a">Cobalt Strike has a <a class="ql-link" href="https://blog.cobaltstrike.com/2020/12/08/a-red-teamer-plays-with-jarm/" target="_blank" rel="noopener noreferrer">post</a><span data-void-detect="true"> dedicated to JARM that goes into detail on how JARM works and how the specific hash value is created based on the Java version.</span></p>
<p class="ql-block" data-block-id="block-468e1fc3-f3ff-49cc-828a-6976aa2a8fde">Looking into our reporting for this hash value will return four of our <a class="ql-link" href="https://thedfirreport.com/?s=07d14d16d21d21d07c42d41d00041d24a458a375eef0c576d23a7bab9a9fb1" target="_blank" rel="noopener noreferrer">cases</a><span data-void-detect="true">. All these cases involve Cobalt Strike as the post-exploitation method.</span></p>
<p class="ql-block" data-block-id="block-26d48c87-5579-49a5-9d41-948f5fa99259">To generate a JARM fingerprint against a server, you can run the <a class="ql-link" href="https://github.com/salesforce/jarm" target="_blank" rel="noopener noreferrer">JARM python tool</a><span data-void-detect="true">:</span></p>
<pre>python3 jarm.py [target] -p [port]</pre>
<div data-block-id="block-8cd975f1-b72b-44c4-b550-12540e14a7ac"><a href="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-1.png"><img loading="lazy" decoding="async" class="size-full wp-image-5380 aligncenter" src="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-1.png" alt="" width="576" height="74" srcset="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-1.png 576w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-1-300x39.png 300w" sizes="auto, (max-width: 576px) 100vw, 576px" /></a></div>
<p class="ql-block" data-block-id="block-6ec4e3b8-6634-4c12-8109-47f2b2cfaa6f">While JARM&#8217;s offer another tool to help reveal adversary infrastructure they are not an indicator that can be used in isolation. JARM signatures can be masked, Dagmawi Mulugeta presented at <a class="ql-link" href="https://conference.hitb.org/hitbsecconf2021ams/materials/D2%20COMMSEC%20-%20JARM%20Randomizer%20Evading%20JARM%20Fingerprinting%20-%20Dagmawi%20Mulugeta.pdf" target="_blank" rel="noopener noreferrer">HiTB Amsterdam in 2021</a><span data-void-detect="true"> a tool that enables red teams or adversaries to mask the JARM signatures of their infrastructure. </span>Called <a class="ql-link" href="https://github.com/netskopeoss/jarm_randomizer" target="_blank" rel="noopener noreferrer">JARM Randomizer</a><span data-void-detect="true"> the tool can be configured as a proxy in front of the Cobalt Strike server to serve up false data to potential internet scanners.</span></p>
<p class="ql-block" data-block-id="block-5bb6106e-1d65-4dce-8a15-cb6f370f0311">Other JARMs can be found at: <a class="ql-link" href="https://github.com/cedowens/C2-JARM" target="_blank" rel="noopener noreferrer">https://github.com/cedowens/C2-JARM</a>.</p>
<h3 class="ql-heading" data-block-id="block-28ca94e9-3350-43dc-80a8-91263916da66"><strong><span class="ql-comment" data-comment-ids="750219550" data-comment-unresolved-ids="">Arkime (Moloch) and JA3/S</span></strong></h3>
<p class="ql-block" data-block-id="block-f9d9b8b4-c3e6-49cc-b39f-253326bb66a4"><span class="ql-comment" data-comment-ids="750219550" data-comment-unresolved-ids="">We included </span><a class="ql-link" href="https://arkime.com/index#home" target="_blank" rel="noopener noreferrer"><span class="ql-comment" data-comment-ids="750219550" data-comment-unresolved-ids="">Arkime</span></a> <span class="ql-comment" data-comment-ids="750219550" data-comment-unresolved-ids="">as it integrates with JA3/JA3S and other plugins to enhance network analysis. Arkime is a tool that we use a lot to investigate network activity and gather indicators. It can index network traffic and make events easily searchable. </span></p>
<p class="ql-block" data-block-id="block-cb2f0cd7-2caa-43cd-a9aa-348a0747ad45"><span class="ql-comment" data-comment-ids="750219550" data-comment-unresolved-ids="">Arkime is simple to set up and excellent for reviewing traffic. Arkime makes use of additional analysis tools by including them as plugins. More on this and other tools in the next report.</span></p>
<p data-block-id="block-cb2f0cd7-2caa-43cd-a9aa-348a0747ad45"><a href="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-2.png"><img loading="lazy" decoding="async" class="size-full wp-image-5381 aligncenter" src="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-2.png" alt="" width="1259" height="1066" srcset="https://thedfirreport.com/wp-content/uploads/2022/01/cs2-2.png 1259w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-2-300x254.png 300w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-2-1024x867.png 1024w, https://thedfirreport.com/wp-content/uploads/2022/01/cs2-2-768x650.png 768w" sizes="auto, (max-width: 1259px) 100vw, 1259px" /></a></p>
<h2 class="ql-heading" data-block-id="block-7294987f-da75-4186-ad38-b257d4a9dc8d">All for now</h2>
<p class="ql-block" data-block-id="block-581fbdbb-364c-4f8f-a253-cabfccbfd807">That wraps up Cobalt Strike, a Defenderâ€™s Guide Part 2. Would you like to see something specific in Part 3? Contact us here or on Twitter with suggestions. Thanks for reading and hope this helps!</p>
<p class="ql-block" data-block-id="block-ef81f06b-78c4-4f2f-900e-2382ce360a92">Please see the bottom of our <a class="ql-link" href="https://thedfirreport.com/2021/08/29/cobalt-strike-a-defenders-guide/" target="_blank" rel="noopener noreferrer">first report</a><span data-void-detect="true"> for more detections &amp; rules.</span></p>
<div class="sharedaddy sd-sharing-enabled"><div class="robots-nocontent sd-block sd-social sd-social-icon-text sd-sharing"><h3 class="sd-title">Share this:</h3><div class="sd-content"><ul><li class="share-twitter"><a rel="nofollow noopener noreferrer" data-shared="sharing-twitter-5314" class="share-twitter sd-button share-icon" href="https://thedfirreport.com/2022/01/24/cobalt-strike-a-defenders-guide-part-2/?share=twitter" target="_blank" title="Click to share on Twitter" ><span>Twitter</span></a></li><li class="share-linkedin"><a rel="nofollow noopener noreferrer" data-shared="sharing-linkedin-5314" class="share-linkedin sd-button share-icon" href="https://thedfirreport.com/2022/01/24/cobalt-strike-a-defenders-guide-part-2/?share=linkedin" target="_blank" title="Click to share on LinkedIn" ><span>LinkedIn</span></a></li><li class="share-reddit"><a rel="nofollow noopener noreferrer" data-shared="" class="share-reddit sd-button share-icon" href="https://thedfirreport.com/2022/01/24/cobalt-strike-a-defenders-guide-part-2/?share=reddit" target="_blank" title="Click to share on Reddit" ><span>Reddit</span></a></li><li class="share-facebook"><a rel="nofollow noopener noreferrer" data-shared="sharing-facebook-5314" class="share-facebook sd-button share-icon" href="https://thedfirreport.com/2022/01/24/cobalt-strike-a-defenders-guide-part-2/?share=facebook" target="_blank" title="Click to share on Facebook" ><span>Facebook</span></a></li><li class="share-jetpack-whatsapp"><a rel="nofollow noopener noreferrer" data-shared="" class="share-jetpack-whatsapp sd-button share-icon" href="https://thedfirreport.com/2022/01/24/cobalt-strike-a-defenders-guide-part-2/?share=jetpack-whatsapp" target="_blank" title="Click to share on WhatsApp" ><span>WhatsApp</span></a></li><li class="share-end"></li></ul></div></div></div>
<div id='jp-relatedposts' class='jp-relatedposts' >
	<h3 class="jp-relatedposts-headline"><em>Related</em></h3>
</div>
	</div><!-- .entry-content -->

	
		<footer class="entry-footer">
			<div class="entry-meta">

							</div><!-- .entry-meta -->
		</footer><!-- .entry-footer -->
			
		</div><!-- .entry-content-holder -->
</article><!-- #post-5314 -->

	<nav class="navigation post-navigation" aria-label="Posts">
		<h2 class="screen-reader-text">Post navigation</h2>
		<div class="nav-links"><div class="nav-previous"><a href="https://thedfirreport.com/2021/12/13/diavol-ransomware/" rel="prev">Diavol Ransomware</a></div><div class="nav-next"><a href="https://thedfirreport.com/2022/02/07/qbot-likes-to-move-it-move-it/" rel="next">Qbot Likes to Move It, Move It</a></div></div>
	</nav>
		</main><!-- #main -->
	</div><!-- #primary -->


<aside id="secondary" class="widget-area">
	<section id="search-4" class="widget widget_search"><form role="search" method="get" class="search-form" action="https://thedfirreport.com/">
				<label>
					<span class="screen-reader-text">Search for:</span>
					<input type="search" class="search-field" placeholder="Search &hellip;" value="" name="s" />
				</label>
				<input type="submit" class="search-submit" value="Search" />
			</form></section><section id="google_translate_widget-5" class="widget widget_google_translate_widget"><div id="google_translate_element"></div></section><section id="block-7" class="widget widget_block">	<div class="wp-block-jetpack-subscriptions__supports-newline wp-block-jetpack-subscriptions">
		<div class="wp-block-jetpack-subscriptions__container is-not-subscriber">
							<form
					action="https://wordpress.com/email-subscriptions"
					method="post"
					accept-charset="utf-8"
					data-blog="175340963"
					data-post_access_level="everybody"
					data-subscriber_email=""
					id="subscribe-blog"
				>
					<div class="wp-block-jetpack-subscriptions__form-elements">
												<p id="subscribe-email">
							<label
								id="subscribe-field-label"
								for="subscribe-field"
								class="screen-reader-text"
							>
								Type your emailâ€¦							</label>
							<input
									required="required"
									type="email"
									name="email"
									class="no-border-radius "
									style="font-size: 16px;padding: 15px 23px 15px 23px;border-radius: 0px;border-width: 1px;"
									placeholder="Type your emailâ€¦"
									value=""
									id="subscribe-field"
									title="Please fill in this field."
								/>						</p>
												<p id="subscribe-submit"
													>
							<input type="hidden" name="action" value="subscribe"/>
							<input type="hidden" name="blog_id" value="175340963"/>
							<input type="hidden" name="source" value="https://thedfirreport.com/2022/01/24/cobalt-strike-a-defenders-guide-part-2/"/>
							<input type="hidden" name="sub-type" value="subscribe-block"/>
							<input type="hidden" name="app_source" value=""/>
							<input type="hidden" name="redirect_fragment" value="subscribe-blog"/>
							<input type="hidden" name="lang" value="en_US"/>
							<input type="hidden" id="_wpnonce" name="_wpnonce" value="5f8e4cdff7" /><input type="hidden" name="_wp_http_referer" value="/2022/01/24/cobalt-strike-a-defenders-guide-part-2/" /><input type="hidden" name="post_id" value="5314"/>							<button type="submit"
																	class="wp-block-button__link no-border-radius"
																									style="font-size: 16px;padding: 15px 23px 15px 23px;margin: 0; margin-left: 10px;border-radius: 0px;border-width: 1px;"
																name="jetpack_subscriptions_widget"
							>
								Subscribe							</button>
						</p>
					</div>
				</form>
								</div>
	</div>
	</section><section id="block-21" class="widget widget_block">
<div class="wp-block-media-text" style="grid-template-columns:15% auto"><figure class="wp-block-media-text__media"><a href="https://the-dfir-report-store.myshopify.com/products/dfir-labs-ctf-july-6-16-00-20-00-utc"><img loading="lazy" decoding="async" width="200" height="200" src="https://thedfirreport.com/wp-content/uploads/2024/06/ctf-1.png" alt="" class="wp-image-35571 size-full" srcset="https://thedfirreport.com/wp-content/uploads/2024/06/ctf-1.png 200w, https://thedfirreport.com/wp-content/uploads/2024/06/ctf-1-150x150.png 150w" sizes="auto, (max-width: 200px) 100vw, 200px" /></a></figure><div class="wp-block-media-text__content">
<h4 class="wp-block-heading"><a href="https://the-dfir-report-store.myshopify.com/products/dfir-labs-ctf-july-6-16-00-20-00-utc">Register For Our Next CTF</a></h4>
</div></div>
</section><section id="block-8" class="widget widget_block">
<div class="wp-block-media-text" style="grid-template-columns:15% auto"><figure class="wp-block-media-text__media"><a href="https://thedfirreport.com/"><img loading="lazy" decoding="async" width="200" height="200" src="https://thedfirreport.com/wp-content/uploads/2023/09/monitor5-s.png" alt="" class="wp-image-21332 size-full" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/monitor5-s.png 200w, https://thedfirreport.com/wp-content/uploads/2023/09/monitor5-s-150x150.png 150w" sizes="auto, (max-width: 200px) 100vw, 200px" /></a></figure><div class="wp-block-media-text__content">
<h3 class="wp-block-heading"><a href="https://thedfirreport.com/" data-type="link" data-id="https://thedfirreport.com/">Reports</a></h3>
</div></div>
</section><section id="block-9" class="widget widget_block">
<div class="wp-block-media-text" style="grid-template-columns:15% auto"><figure class="wp-block-media-text__media"><a href="https://thedfirreport.com/services/threat-intelligence/"><img loading="lazy" decoding="async" width="200" height="200" src="https://thedfirreport.com/wp-content/uploads/2023/09/cloud4-s.png" alt="" class="wp-image-21334 size-full" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/cloud4-s.png 200w, https://thedfirreport.com/wp-content/uploads/2023/09/cloud4-s-150x150.png 150w" sizes="auto, (max-width: 200px) 100vw, 200px" /></a></figure><div class="wp-block-media-text__content">
<h3 class="wp-block-heading"><a href="https://thedfirreport.com/services/threat-intelligence/">Threat Intelligence</a></h3>
</div></div>
</section><section id="block-10" class="widget widget_block">
<div class="wp-block-media-text" style="grid-template-columns:15% auto"><figure class="wp-block-media-text__media"><a href="https://thedfirreport.com/services/detection-rules/"><img loading="lazy" decoding="async" width="200" height="200" src="https://thedfirreport.com/wp-content/uploads/2023/09/warning4-s.png" alt="" class="wp-image-21336 size-full" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/warning4-s.png 200w, https://thedfirreport.com/wp-content/uploads/2023/09/warning4-s-150x150.png 150w" sizes="auto, (max-width: 200px) 100vw, 200px" /></a></figure><div class="wp-block-media-text__content">
<h3 class="wp-block-heading"><a href="https://thedfirreport.com/services/detection-rules/">Detection Rules</a></h3>
</div></div>
</section><section id="block-16" class="widget widget_block">
<div class="wp-block-media-text" style="grid-template-columns:15% auto"><figure class="wp-block-media-text__media"><a href="https://thedfirreport.com/services/dfir-labs/"><img loading="lazy" decoding="async" width="200" height="200" src="https://thedfirreport.com/wp-content/uploads/2024/04/labs-s.png" alt="" class="wp-image-31051 size-full" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/labs-s.png 200w, https://thedfirreport.com/wp-content/uploads/2024/04/labs-s-150x150.png 150w" sizes="auto, (max-width: 200px) 100vw, 200px" /></a></figure><div class="wp-block-media-text__content">
<h3 class="wp-block-heading"><a href="https://thedfirreport.com/services/dfir-labs/">DFIR Labs</a></h3>
</div></div>
</section><section id="block-12" class="widget widget_block">
<div class="wp-block-media-text" style="grid-template-columns:15% auto"><figure class="wp-block-media-text__media"><a href="https://thedfirreport.com/services/mentoring-coaching-program/"><img loading="lazy" decoding="async" width="200" height="200" src="https://thedfirreport.com/wp-content/uploads/2023/09/help4-s.png" alt="" class="wp-image-21333 size-full" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/help4-s.png 200w, https://thedfirreport.com/wp-content/uploads/2023/09/help4-s-150x150.png 150w" sizes="auto, (max-width: 200px) 100vw, 200px" /></a></figure><div class="wp-block-media-text__content">
<h3 class="wp-block-heading"><a href="https://thedfirreport.com/services/mentoring-coaching-program/">Mentoring and Coaching</a></h3>
</div></div>
</section></aside><!-- #secondary -->
</div><!-- .wrap .wrap-width-->
		</div><!-- .site-content-cell -->
	</div><!-- #content -->
	
	<footer id="colophon" class="site-footer" role="contentinfo">

			
		<div class="copyright-area">
			<div class="wrap">
								<div class="site-info">
					    <a href="https://wordpress.org/">
Proudly powered by WordPress</a>
<span class="sep"> | </span>
Copyright 2023 | The DFIR Report | All Rights Reserved				</div><!-- .site-info -->
												<div class="footer-right-info">
															</div>
									</div><!-- .wrap -->
		</div><!-- .copyright-area -->
	</footer><!-- #colophon -->
			<button href="#" class="back-to-top" type="button"><i class="fa-solid fa-arrow-up-long"></i>Go Top</button>
	</div><!-- #page -->


	<script type="9378db564915928314866b15-text/javascript">
		window.WPCOM_sharing_counts = {"https:\/\/thedfirreport.com\/2022\/01\/24\/cobalt-strike-a-defenders-guide-part-2\/":5314};
	</script>
				<style id='jetpack-block-subscriptions-inline-css' type='text/css'>
.is-style-compact .is-not-subscriber .wp-block-button__link,.is-style-compact .is-not-subscriber .wp-block-jetpack-subscriptions__button{border-end-start-radius:0!important;border-start-start-radius:0!important;margin-inline-start:0!important}.is-style-compact .is-not-subscriber .components-text-control__input,.is-style-compact .is-not-subscriber p#subscribe-email input[type=email]{border-end-end-radius:0!important;border-start-end-radius:0!important}.is-style-compact:not(.wp-block-jetpack-subscriptions__use-newline) .components-text-control__input{border-inline-end-width:0!important}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form-container{display:flex;flex-direction:column}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline:not(.wp-block-jetpack-subscriptions__use-newline) .is-not-subscriber .wp-block-jetpack-subscriptions__form-elements{align-items:flex-start;display:flex}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline:not(.wp-block-jetpack-subscriptions__use-newline) p#subscribe-submit{display:flex;justify-content:center}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form .wp-block-jetpack-subscriptions__button,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form .wp-block-jetpack-subscriptions__textfield .components-text-control__input,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form button,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form input[type=email],.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form .wp-block-jetpack-subscriptions__button,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form .wp-block-jetpack-subscriptions__textfield .components-text-control__input,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form button,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form input[type=email]{box-sizing:border-box;cursor:pointer;line-height:1.3;min-width:auto!important;white-space:nowrap!important}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form .wp-block-jetpack-subscriptions__button[contenteditable=true],.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form .wp-block-jetpack-subscriptions__button[contenteditable=true]{white-space:pre-wrap!important}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form input[type=email]::placeholder,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form input[type=email]:disabled,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form input[type=email]::placeholder,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form input[type=email]:disabled{color:currentColor;opacity:.5}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form .wp-block-jetpack-subscriptions__button,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form button,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form .wp-block-jetpack-subscriptions__button,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form button{border-color:#0000;border-style:solid}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form .wp-block-jetpack-subscriptions__textfield,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form p#subscribe-email,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form .wp-block-jetpack-subscriptions__textfield,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form p#subscribe-email{background:#0000;flex-grow:1}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form .wp-block-jetpack-subscriptions__textfield .components-base-control__field,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form .wp-block-jetpack-subscriptions__textfield .components-text-control__input,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form .wp-block-jetpack-subscriptions__textfield input[type=email],.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form p#subscribe-email .components-base-control__field,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form p#subscribe-email .components-text-control__input,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form p#subscribe-email input[type=email],.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form .wp-block-jetpack-subscriptions__textfield .components-base-control__field,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form .wp-block-jetpack-subscriptions__textfield .components-text-control__input,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form .wp-block-jetpack-subscriptions__textfield input[type=email],.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form p#subscribe-email .components-base-control__field,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form p#subscribe-email .components-text-control__input,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form p#subscribe-email input[type=email]{height:auto;margin:0;width:100%}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form p#subscribe-email,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form p#subscribe-submit,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form p#subscribe-email,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form p#subscribe-submit{line-height:0;margin:0;padding:0}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline.wp-block-jetpack-subscriptions__show-subs .wp-block-jetpack-subscriptions__subscount{font-size:16px;margin:8px 0;text-align:end}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline.wp-block-jetpack-subscriptions__use-newline .wp-block-jetpack-subscriptions__form-elements{display:block}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline.wp-block-jetpack-subscriptions__use-newline .wp-block-jetpack-subscriptions__button,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline.wp-block-jetpack-subscriptions__use-newline button{display:inline-block;max-width:100%}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline.wp-block-jetpack-subscriptions__use-newline .wp-block-jetpack-subscriptions__subscount{text-align:start}#subscribe-submit.is-link{text-align:center;width:auto!important}#subscribe-submit.is-link a{margin-left:0!important;margin-top:0!important;width:auto!important}@keyframes jetpack-memberships_button__spinner-animation{to{transform:rotate(1turn)}}.jetpack-memberships-spinner{display:none;height:1em;margin:0 0 0 5px;width:1em}.jetpack-memberships-spinner svg{height:100%;margin-bottom:-2px;width:100%}.jetpack-memberships-spinner-rotating{animation:jetpack-memberships_button__spinner-animation .75s linear infinite;transform-origin:center}.is-loading .jetpack-memberships-spinner{display:inline-block}body.jetpack-memberships-modal-open{overflow:hidden}dialog.jetpack-memberships-modal{opacity:1}dialog.jetpack-memberships-modal,dialog.jetpack-memberships-modal iframe{background:#0000;border:0;bottom:0;box-shadow:none;height:100%;left:0;margin:0;padding:0;position:fixed;right:0;top:0;width:100%}dialog.jetpack-memberships-modal::backdrop{background-color:#000;opacity:.7;transition:opacity .2s ease-out}dialog.jetpack-memberships-modal.is-loading,dialog.jetpack-memberships-modal.is-loading::backdrop{opacity:0}
</style>
<script type="9378db564915928314866b15-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/js/navigation.min.js?ver=6.7.1" id="freenews-navigation-js"></script>
<script type="9378db564915928314866b15-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/js/skip-link-focus-fix.js?ver=6.7.1" id="freenews-skip-link-focus-fix-js"></script>
<script type="9378db564915928314866b15-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/library/sticky-sidebar/ResizeSensor.min.js?ver=6.7.1" id="ResizeSensor-js"></script>
<script type="9378db564915928314866b15-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/library/sticky-sidebar/theia-sticky-sidebar.min.js?ver=6.7.1" id="theia-sticky-sidebar-js"></script>
<script type="9378db564915928314866b15-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/library/slick/slick.min.js?ver=6.7.1" id="slick-js"></script>
<script type="9378db564915928314866b15-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/library/slick/slick-settings.js?ver=6.7.1" id="freenews-slick-settings-js"></script>
<script type="9378db564915928314866b15-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/library/sticky/jquery.sticky.js?ver=6.7.1" id="jquery-sticky-js"></script>
<script type="9378db564915928314866b15-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/library/sticky/sticky-setting.js?ver=6.7.1" id="freenews-sticky-settings-js"></script>
<script type="9378db564915928314866b15-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/library/marquee/jquery.marquee.min.js?ver=6.7.1" id="marquee-js"></script>
<script type="9378db564915928314866b15-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/library/marquee/marquee-settings.js?ver=6.7.1" id="freenews-marquee-settings-js"></script>
<script type="9378db564915928314866b15-text/javascript" src="https://stats.wp.com/e-202451.js" id="jetpack-stats-js" data-wp-strategy="defer"></script>
<script type="9378db564915928314866b15-text/javascript" id="jetpack-stats-js-after">
/* <![CDATA[ */
_stq = window._stq || [];
_stq.push([ "view", JSON.parse("{\"v\":\"ext\",\"blog\":\"175340963\",\"post\":\"5314\",\"tz\":\"0\",\"srv\":\"thedfirreport.com\",\"j\":\"1:14.1\"}") ]);
_stq.push([ "clickTrackerInit", "175340963", "5314" ]);
/* ]]> */
</script>
<script type="9378db564915928314866b15-text/javascript" id="google-translate-init-js-extra">
/* <![CDATA[ */
var _wp_google_translate_widget = {"lang":"en_US","layout":"0"};
/* ]]> */
</script>
<script type="9378db564915928314866b15-text/javascript" src="https://c0.wp.com/p/jetpack/14.1/_inc/build/widgets/google-translate/google-translate.min.js" id="google-translate-init-js"></script>
<script type="9378db564915928314866b15-text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit&amp;ver=14.1" id="google-translate-js"></script>
<script type="9378db564915928314866b15-text/javascript" id="jetpack-blocks-assets-base-url-js-before">
/* <![CDATA[ */
var Jetpack_Block_Assets_Base_Url="https://thedfirreport.com/wp-content/plugins/jetpack/_inc/blocks/";
/* ]]> */
</script>
<script type="9378db564915928314866b15-text/javascript" src="https://c0.wp.com/c/6.7.1/wp-includes/js/dist/dom-ready.min.js" id="wp-dom-ready-js"></script>
<script type="9378db564915928314866b15-text/javascript" src="https://c0.wp.com/c/6.7.1/wp-includes/js/dist/vendor/wp-polyfill.min.js" id="wp-polyfill-js"></script>
<script type="9378db564915928314866b15-text/javascript" src="https://thedfirreport.com/wp-content/plugins/jetpack/_inc/blocks/subscriptions/view.js?minify=false&amp;ver=14.1" id="jetpack-block-subscriptions-js"></script>
<script type="9378db564915928314866b15-text/javascript" id="sharing-js-js-extra">
/* <![CDATA[ */
var sharing_js_options = {"lang":"en","counts":"1","is_stats_active":"1"};
/* ]]> */
</script>
<script type="9378db564915928314866b15-text/javascript" src="https://c0.wp.com/p/jetpack/14.1/_inc/build/sharedaddy/sharing.min.js" id="sharing-js-js"></script>
<script type="9378db564915928314866b15-text/javascript" id="sharing-js-js-after">
/* <![CDATA[ */
var windowOpen;
			( function () {
				function matches( el, sel ) {
					return !! (
						el.matches && el.matches( sel ) ||
						el.msMatchesSelector && el.msMatchesSelector( sel )
					);
				}

				document.body.addEventListener( 'click', function ( event ) {
					if ( ! event.target ) {
						return;
					}

					var el;
					if ( matches( event.target, 'a.share-twitter' ) ) {
						el = event.target;
					} else if ( event.target.parentNode && matches( event.target.parentNode, 'a.share-twitter' ) ) {
						el = event.target.parentNode;
					}

					if ( el ) {
						event.preventDefault();

						// If there's another sharing window open, close it.
						if ( typeof windowOpen !== 'undefined' ) {
							windowOpen.close();
						}
						windowOpen = window.open( el.getAttribute( 'href' ), 'wpcomtwitter', 'menubar=1,resizable=1,width=600,height=350' );
						return false;
					}
				} );
			} )();
var windowOpen;
			( function () {
				function matches( el, sel ) {
					return !! (
						el.matches && el.matches( sel ) ||
						el.msMatchesSelector && el.msMatchesSelector( sel )
					);
				}

				document.body.addEventListener( 'click', function ( event ) {
					if ( ! event.target ) {
						return;
					}

					var el;
					if ( matches( event.target, 'a.share-linkedin' ) ) {
						el = event.target;
					} else if ( event.target.parentNode && matches( event.target.parentNode, 'a.share-linkedin' ) ) {
						el = event.target.parentNode;
					}

					if ( el ) {
						event.preventDefault();

						// If there's another sharing window open, close it.
						if ( typeof windowOpen !== 'undefined' ) {
							windowOpen.close();
						}
						windowOpen = window.open( el.getAttribute( 'href' ), 'wpcomlinkedin', 'menubar=1,resizable=1,width=580,height=450' );
						return false;
					}
				} );
			} )();
var windowOpen;
			( function () {
				function matches( el, sel ) {
					return !! (
						el.matches && el.matches( sel ) ||
						el.msMatchesSelector && el.msMatchesSelector( sel )
					);
				}

				document.body.addEventListener( 'click', function ( event ) {
					if ( ! event.target ) {
						return;
					}

					var el;
					if ( matches( event.target, 'a.share-facebook' ) ) {
						el = event.target;
					} else if ( event.target.parentNode && matches( event.target.parentNode, 'a.share-facebook' ) ) {
						el = event.target.parentNode;
					}

					if ( el ) {
						event.preventDefault();

						// If there's another sharing window open, close it.
						if ( typeof windowOpen !== 'undefined' ) {
							windowOpen.close();
						}
						windowOpen = window.open( el.getAttribute( 'href' ), 'wpcomfacebook', 'menubar=1,resizable=1,width=600,height=400' );
						return false;
					}
				} );
			} )();
/* ]]> */
</script>

<script src="/cdn-cgi/scripts/7d0fa10a/cloudflare-static/rocket-loader.min.js" data-cf-settings="9378db564915928314866b15-|49" defer></script><script defer src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon='{"rayId":"8f3b220adb35e2b8","version":"2024.10.5","r":1,"serverTiming":{"name":{"cfExtPri":true,"cfL4":true,"cfSpeedBrain":true,"cfCacheStatus":true}},"token":"e6611380fbbe475a97dc9cf0a0e9fd2b","b":1}' crossorigin="anonymous"></script>
</body>
</html>
