<!DOCTYPE html>
<html>
<head>
    
        
<meta charset="utf-8">
<meta name="HandheldFriendly" content="True">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="referrer" content="no-referrer-when-downgrade">

<title>Quick look at Nazar&#39;s backdoor - Capabilities  - MalwareLab.pl Research Notes</title>
<meta name="description" content="">

<link rel="alternate" type="application/rss+xml" title="RSS" href="https://blog.malwarelab.pl/rss/">

<link rel="icon" type="image/x-icon" href="https://blog.malwarelab.pl/favicon.ico">
<link rel="apple-touch-icon-precomposed" href="https://blog.malwarelab.pl/favicon.png">

<link rel="stylesheet" href="https://blog.malwarelab.pl/static/css/style.css?rnd=1593086112" />

<meta property="og:title" content="Quick look at Nazar&#39;s backdoor - Capabilities" />
<meta property="og:description" content="Intro Yesterday at a virtual edition of OPCDE Juan AndrÃ©s Guerrero-Saade disclosed to the world part of his research on threat groups listed in Lost in Translation, a leak of Equation Group tools done by Shadowbrokers in 2017. Shortly after he published an analysis on his blog and shared hashes. During the talk Juan mentioned that he doesn&rsquo;t really know what the piece of malware, belonging to Nazar APT, actually does so we put some time to find out." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://blog.malwarelab.pl/posts/nazar_eyservice/" />
<meta property="article:published_time" content="2020-04-23T18:26:13+02:00" />
<meta property="article:modified_time" content="2020-04-23T18:26:13+02:00" />

<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Quick look at Nazar&#39;s backdoor - Capabilities"/>
<meta name="twitter:description" content="Intro Yesterday at a virtual edition of OPCDE Juan AndrÃ©s Guerrero-Saade disclosed to the world part of his research on threat groups listed in Lost in Translation, a leak of Equation Group tools done by Shadowbrokers in 2017. Shortly after he published an analysis on his blog and shared hashes. During the talk Juan mentioned that he doesn&rsquo;t really know what the piece of malware, belonging to Nazar APT, actually does so we put some time to find out."/>








    
</head>
<body>
    <div class="container">
        <header> 
            
                <h1 class="site-header">
    <a href="https://blog.malwarelab.pl">MalwareLab.pl Research Notes</a>
</h1>
<nav>
    
    
</nav>

            
        </header>
        <main>
            

    <article class="post">
        <header>
            <h1>Quick look at Nazar&#39;s backdoor - Capabilities</h1>
        </header>
        <div class="content">
            <h1 id="intro">Intro</h1>
<p>Yesterday at a virtual edition of <a href="https://online.opcde.com/">OPCDE</a> <a href="https://twitter.com/juanandres_gs">Juan AndrÃ©s Guerrero-Saade</a> disclosed to the world part of his research on threat groups listed in <code>Lost in Translation</code>, a leak of Equation Group tools done by Shadowbrokers in 2017. Shortly after he published an analysis on his <a href="https://www.epicturla.com/blog/the-lost-nazar">blog</a> and shared hashes. During the talk Juan mentioned that he doesn&rsquo;t really know what the piece of malware, belonging to Nazar APT, actually does so we put some time to find out.</p>
<h1 id="eyservice">EYService</h1>
<p>EYService (<strong>2fe9b76496a9480273357b6d35c012809bfa3ae8976813a7f5f4959402e3fbb6</strong>) is a main part of the backdoor and its the one we took a look at. This a passive backdoor that relies on, now discontinued, Packet Sniffer SDK (PSSDK) from Microolap. We wont go into details of communication and how packets from and to c2 are build, this will be a subject of following posts. Instead we will present capabilities of this malware. All magic is happening in <code>00404F10h</code> where we can find a big if-else tree with various commands id.</p>
<table>
<thead>
<tr>
<th>Command</th>
<th>Action</th>
<th>Comments</th>
</tr>
</thead>
<tbody>
<tr>
<td>311</td>
<td>prepare/execute keyloger</td>
<td>loads %WINSYSDIR%\hodll.dll calls <code>instalhook</code> and <code>removehook</code> from it, saves data to %WINSYSDIR%\report.txt</td>
</tr>
<tr>
<td>139</td>
<td>shutdown os</td>
<td>calls ole object via rclsid: F6E5B398-E3DF-496B-A2AD-C20FEA30DBFE, riid: DBCB4B31-21B8-4A0F-BC69-0C3CE3B66D00 - registerd by godown.dll</td>
</tr>
<tr>
<td>189</td>
<td>prepare/take screen shot</td>
<td>loads ViewScreen.dll, calls SaveBitmapToPNGFile, saves screenshot to %CWD%\z.png</td>
</tr>
<tr>
<td>119</td>
<td>prepare/record audio</td>
<td>using mixer* WINAPI, saves recorded audio to %WINSYSDIR%\music.mp3</td>
</tr>
<tr>
<td>199</td>
<td>list drives</td>
<td>Enumerates drives, saves results to %WINSYSDIR%\Drives.txt</td>
</tr>
<tr>
<td>200</td>
<td>list files</td>
<td>Enumerates files on drive, save results to %WINSYSDIR%\Files.txt</td>
</tr>
<tr>
<td>201</td>
<td>read file</td>
<td></td>
</tr>
<tr>
<td>209</td>
<td>remove file</td>
<td></td>
</tr>
<tr>
<td>499</td>
<td>list programs</td>
<td>Its done by enumerating HKLM\Software\Microsoft\Windows\CurrentVersion\Uninstall, results are saved to %WINSYSDIR%\Programs.txt</td>
</tr>
<tr>
<td>599</td>
<td>list available devices</td>
<td></td>
</tr>
<tr>
<td>999</td>
<td>ping</td>
<td>sends back pong</td>
</tr>
<tr>
<td>555</td>
<td>get os info</td>
<td>sends back windows version and computer name</td>
</tr>
<tr>
<td>315</td>
<td>disable audio recording</td>
<td></td>
</tr>
<tr>
<td>312</td>
<td>disable keyloger</td>
<td></td>
</tr>
<tr>
<td>313</td>
<td>disable screenshot</td>
<td></td>
</tr>
<tr>
<td>666</td>
<td>set unused flag</td>
<td></td>
</tr>
</tbody>
</table>
<h1 id="update-27042020">Update 27.04.2020</h1>
<p>Quick update regarding commands <strong>555</strong>, <strong>999</strong>, <strong>139</strong></p>
<ul>
<li>999 - ping</li>
<li>555 - get os info</li>
<li>139 - shut down system via godown.dll</li>
</ul>
<h1 id="conclusion">Conclusion</h1>
<p>In this short post we showed a capabilities of a malware used by Nazar APT, clearly designed with espionage purposes. Stay tune for next part about abusing IP and TCP protocol in order to smuggle commands. In the meantime if you have an interesting piece of malware and need someone to take a look at it don&rsquo;t hesitate to contact us - <a href="/cdn-cgi/l/email-protection#20434f4e54414354604d414c574152454c41420e504c"><span class="__cf_email__" data-cfemail="187b77766c797b6c587579746f796a7d74797a366874">[email&#160;protected]</span></a></p>

        </div>
        <div class="article-info">
    
        <div class="article-date">2020-04-23</div>
    
    <div class="article-taxonomies">
        
            
                <ul class="article-tags">
                    
                        <li><a href="https://blog.malwarelab.pl/tags/nazar">#Nazar</a></li>
                    
                        <li><a href="https://blog.malwarelab.pl/tags/apt">#APT</a></li>
                    
                        <li><a href="https://blog.malwarelab.pl/tags/malware-analysis">#Malware Analysis</a></li>
                    
                        <li><a href="https://blog.malwarelab.pl/tags/sig37">#sig37</a></li>
                    
                </ul>
        
    </div>
</div>
    </article>
    


        </main>
        <footer>
            
                <p>Â© 2020<br>
Powered by <a target="_blank" href="https://gohugo.io/">Hugo</a>, theme <a target="_blank" href="https://github.com/mitrichius/hugo-theme-anubis">Anubis</a>.
</p>
            
        </footer>
    </div>
<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script></body>
</html>
