<!doctype html><html lang="en"><head><title data-rh="true">HTML Smuggling Detection. Introduction | by Micah Babinski | Medium</title><meta data-rh="true" charset="utf-8"/><meta data-rh="true" name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1,maximum-scale=1"/><meta data-rh="true" name="theme-color" content="#000000"/><meta data-rh="true" name="twitter:app:name:iphone" content="Medium"/><meta data-rh="true" name="twitter:app:id:iphone" content="828256236"/><meta data-rh="true" property="al:ios:app_name" content="Medium"/><meta data-rh="true" property="al:ios:app_store_id" content="828256236"/><meta data-rh="true" property="al:android:package" content="com.medium.reader"/><meta data-rh="true" property="fb:app_id" content="542599432471018"/><meta data-rh="true" property="og:site_name" content="Medium"/><meta data-rh="true" property="og:type" content="article"/><meta data-rh="true" property="article:published_time" content="2022-12-28T14:02:17.056Z"/><meta data-rh="true" name="title" content="HTML Smuggling Detection. Introduction | by Micah Babinski | Medium"/><meta data-rh="true" property="og:title" content="HTML Smuggling Detection"/><meta data-rh="true" property="al:android:url" content="medium://p/5adefebb6841"/><meta data-rh="true" property="al:ios:url" content="medium://p/5adefebb6841"/><meta data-rh="true" property="al:android:app_name" content="Medium"/><meta data-rh="true" name="description" content="In this article I’ll delve into HTML smuggling detection, following the detection engineering process I’ve described over my last two posts. This process includes research, testing, and development…"/><meta data-rh="true" property="og:description" content="Introduction"/><meta data-rh="true" property="og:url" content="https://micahbabinski.medium.com/html-smuggling-detection-5adefebb6841"/><meta data-rh="true" property="al:web:url" content="https://micahbabinski.medium.com/html-smuggling-detection-5adefebb6841"/><meta data-rh="true" property="og:image" content="https://miro.medium.com/v2/resize:fit:1200/1*5P6AoNfhFJraUVFkpN1NXw.jpeg"/><meta data-rh="true" property="article:author" content="https://micahbabinski.medium.com"/><meta data-rh="true" name="author" content="Micah Babinski"/><meta data-rh="true" name="robots" content="index,noarchive,follow,max-image-preview:large"/><meta data-rh="true" name="referrer" content="unsafe-url"/><meta data-rh="true" property="twitter:title" content="HTML Smuggling Detection"/><meta data-rh="true" name="twitter:site" content="@Medium"/><meta data-rh="true" name="twitter:app:url:iphone" content="medium://p/5adefebb6841"/><meta data-rh="true" property="twitter:description" content="Introduction"/><meta data-rh="true" name="twitter:image:src" content="https://miro.medium.com/v2/resize:fit:1200/1*5P6AoNfhFJraUVFkpN1NXw.jpeg"/><meta data-rh="true" name="twitter:card" content="summary_large_image"/><meta data-rh="true" name="twitter:creator" content="@MicahBabinski"/><meta data-rh="true" name="twitter:label1" content="Reading time"/><meta data-rh="true" name="twitter:data1" content="15 min read"/><link data-rh="true" rel="icon" href="https://miro.medium.com/v2/5d8de952517e8160e40ef9841c781cdc14a5db313057fa3c3de41c6f5b494b19"/><link data-rh="true" rel="search" type="application/opensearchdescription+xml" title="Medium" href="/osd.xml"/><link data-rh="true" rel="apple-touch-icon" sizes="152x152" href="https://miro.medium.com/v2/resize:fill:304:304/10fd5c419ac61637245384e7099e131627900034828f4f386bdaa47a74eae156"/><link data-rh="true" rel="apple-touch-icon" sizes="120x120" href="https://miro.medium.com/v2/resize:fill:240:240/10fd5c419ac61637245384e7099e131627900034828f4f386bdaa47a74eae156"/><link data-rh="true" rel="apple-touch-icon" sizes="76x76" href="https://miro.medium.com/v2/resize:fill:152:152/10fd5c419ac61637245384e7099e131627900034828f4f386bdaa47a74eae156"/><link data-rh="true" rel="apple-touch-icon" sizes="60x60" href="https://miro.medium.com/v2/resize:fill:120:120/10fd5c419ac61637245384e7099e131627900034828f4f386bdaa47a74eae156"/><link data-rh="true" rel="mask-icon" href="https://miro.medium.com/v2/resize:fill:1000:1000/7*GAOKVe--MXbEJmV9230oOQ.png" color="#171717"/><link data-rh="true" rel="preconnect" href="https://glyph.medium.com" crossOrigin=""/><link data-rh="true" id="glyph_preload_link" rel="preload" as="style" type="text/css" href="https://glyph.medium.com/css/unbound.css"/><link data-rh="true" id="glyph_link" rel="stylesheet" type="text/css" href="https://glyph.medium.com/css/unbound.css"/><link data-rh="true" rel="author" href="https://micahbabinski.medium.com"/><link data-rh="true" rel="canonical" href="https://micahbabinski.medium.com/html-smuggling-detection-5adefebb6841"/><link data-rh="true" rel="alternate" href="android-app://com.medium.reader/https/medium.com/p/5adefebb6841"/><script data-rh="true" type="application/ld+json">{"@context":"http:\u002F\u002Fschema.org","@type":"NewsArticle","image":["https:\u002F\u002Fmiro.medium.com\u002Fv2\u002Fresize:fit:1200\u002F1*5P6AoNfhFJraUVFkpN1NXw.jpeg"],"url":"https:\u002F\u002Fmicahbabinski.medium.com\u002Fhtml-smuggling-detection-5adefebb6841","dateCreated":"2022-12-28T13:58:22.794Z","datePublished":"2022-12-28T13:58:22.794Z","dateModified":"2022-12-28T14:02:24.936Z","headline":"HTML Smuggling Detection - Micah Babinski - Medium","name":"HTML Smuggling Detection - Micah Babinski - Medium","description":"In this article I’ll delve into HTML smuggling detection, following the detection engineering process I’ve described over my last two posts. This process includes research, testing, and development…","identifier":"5adefebb6841","author":{"@type":"Person","name":"Micah Babinski","url":"https:\u002F\u002Fmicahbabinski.medium.com"},"creator":["Micah Babinski"],"publisher":{"@type":"Organization","name":"Medium","url":"https:\u002F\u002Fmicahbabinski.medium.com\u002F","logo":{"@type":"ImageObject","width":272,"height":60,"url":"https:\u002F\u002Fmiro.medium.com\u002Fv2\u002Fresize:fit:544\u002F7*V1_7XP4snlmqrc_0Njontw.png"}},"mainEntityOfPage":"https:\u002F\u002Fmicahbabinski.medium.com\u002Fhtml-smuggling-detection-5adefebb6841"}</script><style type="text/css" data-fela-rehydration="621" data-fela-type="STATIC">html{box-sizing:border-box;-webkit-text-size-adjust:100%}*, *:before, *:after{box-sizing:inherit}body{margin:0;padding:0;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;color:rgba(0,0,0,0.8);position:relative;min-height:100vh}h1, h2, h3, h4, h5, h6, dl, dd, ol, ul, menu, figure, blockquote, p, pre, form{margin:0}menu, ol, ul{padding:0;list-style:none;list-style-image:none}main{display:block}a{color:inherit;text-decoration:none}a, button, input{-webkit-tap-highlight-color:transparent}img, svg{vertical-align:middle}button{background:transparent;overflow:visible}button, input, optgroup, select, textarea{margin:0}:root{--reach-tabs:1;--reach-menu-button:1}#speechify-root{font-family:Sohne, sans-serif}div[data-popper-reference-hidden="true"]{visibility:hidden;pointer-events:none}.grecaptcha-badge{visibility:hidden}
/*XCode style (c) Angel Garcia <angelgarcia.mail@gmail.com>*/.hljs {background: #fff;color: black;
}/* Gray DOCTYPE selectors like WebKit */
.xml .hljs-meta {color: #c0c0c0;
}.hljs-comment,
.hljs-quote {color: #007400;
}.hljs-tag,
.hljs-attribute,
.hljs-keyword,
.hljs-selector-tag,
.hljs-literal,
.hljs-name {color: #aa0d91;
}.hljs-variable,
.hljs-template-variable {color: #3F6E74;
}.hljs-code,
.hljs-string,
.hljs-meta .hljs-string {color: #c41a16;
}.hljs-regexp,
.hljs-link {color: #0E0EFF;
}.hljs-title,
.hljs-symbol,
.hljs-bullet,
.hljs-number {color: #1c00cf;
}.hljs-section,
.hljs-meta {color: #643820;
}.hljs-title.class_,
.hljs-class .hljs-title,
.hljs-type,
.hljs-built_in,
.hljs-params {color: #5c2699;
}.hljs-attr {color: #836C28;
}.hljs-subst {color: #000;
}.hljs-formula {background-color: #eee;font-style: italic;
}.hljs-addition {background-color: #baeeba;
}.hljs-deletion {background-color: #ffc8bd;
}.hljs-selector-id,
.hljs-selector-class {color: #9b703f;
}.hljs-doctag,
.hljs-strong {font-weight: bold;
}.hljs-emphasis {font-style: italic;
}
</style><style type="text/css" data-fela-rehydration="621" data-fela-type="KEYFRAME">@-webkit-keyframes k1{0%{opacity:0.8}50%{opacity:0.5}100%{opacity:0.8}}@-moz-keyframes k1{0%{opacity:0.8}50%{opacity:0.5}100%{opacity:0.8}}@keyframes k1{0%{opacity:0.8}50%{opacity:0.5}100%{opacity:0.8}}</style><style type="text/css" data-fela-rehydration="621" data-fela-type="RULE">.a{font-family:medium-content-sans-serif-font, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif}.b{font-weight:400}.c{background-color:rgba(255, 255, 255, 1)}.l{display:block}.m{position:sticky}.n{top:0}.o{z-index:500}.p{padding:0 24px}.q{align-items:center}.r{border-bottom:solid 1px #F2F2F2}.y{height:41px}.z{line-height:20px}.ab{display:flex}.ac{height:57px}.ae{flex:1 0 auto}.af{color:inherit}.ag{fill:inherit}.ah{font-size:inherit}.ai{border:inherit}.aj{font-family:inherit}.ak{letter-spacing:inherit}.al{font-weight:inherit}.am{padding:0}.an{margin:0}.ao{cursor:pointer}.ap:disabled{cursor:not-allowed}.aq:disabled{color:#6B6B6B}.ar:disabled{fill:#6B6B6B}.au{width:auto}.av path{fill:#242424}.aw{height:25px}.ax{margin-left:16px}.ay{border:none}.az{border-radius:20px}.ba{width:240px}.bb{background:#F9F9F9}.bc path{fill:#6B6B6B}.be{outline:none}.bf{font-family:sohne, "Helvetica Neue", Helvetica, Arial, sans-serif}.bg{font-size:14px}.bh{width:100%}.bi{padding:10px 20px 10px 0}.bj{background-color:transparent}.bk{color:#242424}.bl::placeholder{color:#6B6B6B}.bm{display:inline-block}.bn{margin-left:12px}.bo{margin-right:12px}.bp{border-radius:4px}.bq{margin-left:24px}.br{height:24px}.bx{background-color:#F9F9F9}.by{border-radius:50%}.bz{height:32px}.ca{width:32px}.cb{justify-content:center}.ch{max-width:680px}.ci{min-width:0}.cj{animation:k1 1.2s ease-in-out infinite}.ck{height:100vh}.cl{margin-bottom:16px}.cm{margin-top:48px}.cn{align-items:flex-start}.co{flex-direction:column}.cp{justify-content:space-between}.cq{margin-bottom:24px}.cw{width:80%}.cx{background-color:#F2F2F2}.dd{height:44px}.de{width:44px}.df{margin:auto 0}.dg{margin-bottom:4px}.dh{height:16px}.di{width:120px}.dj{width:80px}.dp{margin-bottom:8px}.dq{width:96%}.dr{width:98%}.ds{width:81%}.dt{margin-left:8px}.du{color:#6B6B6B}.dv{font-size:13px}.dw{height:100%}.ep{color:#FFFFFF}.eq{fill:#FFFFFF}.er{background:#1A8917}.es{border-color:#1A8917}.ew:disabled{cursor:inherit !important}.ex:disabled{opacity:0.3}.ey:disabled:hover{background:#1A8917}.ez:disabled:hover{border-color:#1A8917}.fa{border-radius:99em}.fb{border-width:1px}.fc{border-style:solid}.fd{box-sizing:border-box}.fe{text-decoration:none}.ff{text-align:center}.fi{margin-right:32px}.fj{position:relative}.fk{fill:#6B6B6B}.fn{background:transparent}.fo svg{margin-left:4px}.fp svg{fill:#6B6B6B}.fr{box-shadow:inset 0 0 0 1px rgba(0, 0, 0, 0.05)}.fs{position:absolute}.fz{margin:0 24px}.gd{background:rgba(255, 255, 255, 1)}.ge{border:1px solid #F2F2F2}.gf{box-shadow:0 1px 4px #F2F2F2}.gg{max-height:100vh}.gh{overflow-y:auto}.gi{left:0}.gj{top:calc(100vh + 100px)}.gk{bottom:calc(100vh + 100px)}.gl{width:10px}.gm{pointer-events:none}.gn{word-break:break-word}.go{word-wrap:break-word}.gp:after{display:block}.gq:after{content:""}.gr:after{clear:both}.gs{line-height:1.23}.gt{letter-spacing:0}.gu{font-style:normal}.gv{font-weight:700}.ia{align-items:baseline}.ib{width:48px}.ic{height:48px}.id{border:2px solid rgba(255, 255, 255, 1)}.ie{z-index:0}.if{box-shadow:none}.ig{border:1px solid rgba(0, 0, 0, 0.05)}.ih{margin-bottom:2px}.ii{flex-wrap:nowrap}.ij{font-size:16px}.ik{line-height:24px}.im{margin:0 8px}.in{display:inline}.io{color:#1A8917}.ip{fill:#1A8917}.is{flex:0 0 auto}.iv{flex-wrap:wrap}.iw{padding-left:8px}.ix{padding-right:8px}.jy> *{flex-shrink:0}.jz{overflow-x:scroll}.ka::-webkit-scrollbar{display:none}.kb{scrollbar-width:none}.kc{-ms-overflow-style:none}.kd{width:74px}.ke{flex-direction:row}.kf{z-index:2}.kg{margin-right:4px}.kj{-webkit-user-select:none}.kk{border:0}.kl{fill:rgba(117, 117, 117, 1)}.ko{outline:0}.kp{user-select:none}.kq> svg{pointer-events:none}.kz{cursor:progress}.la{margin-left:4px}.lb{margin-top:0px}.lc{opacity:1}.ld{padding:4px 0}.lg{width:16px}.li{display:inline-flex}.lo{max-width:100%}.lp{padding:8px 2px}.lq svg{color:#6B6B6B}.mh{margin-left:auto}.mi{margin-right:auto}.mj{max-width:1200px}.mp{clear:both}.mr{cursor:zoom-in}.ms{z-index:auto}.mu{height:auto}.mv{margin-top:10px}.mw{max-width:728px}.mz{line-height:1.12}.na{letter-spacing:-0.022em}.nb{font-weight:600}.nw{margin-bottom:-0.28em}.nx{line-height:1.58}.ny{letter-spacing:-0.004em}.nz{font-family:source-serif-pro, Georgia, Cambria, "Times New Roman", Times, serif}.ou{margin-bottom:-0.46em}.ov{line-height:1.18}.pj{margin-bottom:-0.31em}.pp{margin-top:32px}.pq{margin-bottom:14px}.pr{padding-top:24px}.ps{padding-bottom:10px}.pt{background-color:#000000}.pu{height:3px}.pv{width:3px}.pw{margin-right:20px}.qc{text-decoration:underline}.qi{margin:auto}.qj{overflow:hidden}.qk{padding-bottom:56.199999999999996%}.ql{height:0}.qm{list-style-type:disc}.qn{margin-left:30px}.qo{padding-left:0px}.qz{box-shadow:inset 0 0 0 1px #F2F2F2}.ra{padding:0px}.rb{padding:16px 20px}.rc{flex:1 1 auto}.re{max-height:40px}.rf{text-overflow:ellipsis}.rg{display:-webkit-box}.rh{-webkit-line-clamp:2}.ri{-webkit-box-orient:vertical}.rk{margin-top:8px}.rl{margin-top:12px}.rm{font-style:italic}.rn{box-shadow:inset 3px 0 0 0 #242424}.ro{padding-left:23px}.rp{margin-left:-20px}.rq{max-width:320px}.rr{width:160px}.rs{background-image:url(https://miro.medium.com/v2/da:true/resize:fit:320/0*xcHotd7W88ngKtix)}.rt{background-origin:border-box}.ru{background-size:cover}.rv{height:167px}.rw{background-position:50% 50%}.rx{max-width:1618px}.ry{overflow-x:auto}.rz{font-family:source-code-pro, Menlo, Monaco, "Courier New", Courier, monospace}.sa{padding:32px}.sb{border:1px solid #E5E5E5}.sc{line-height:1.4}.sd{margin-top:-0.2em}.se{margin-bottom:-0.2em}.sf{white-space:pre}.sg{min-width:fit-content}.sh{max-width:1894px}.si{max-width:1125px}.sj{max-width:984px}.sk{max-width:1897px}.sl{max-width:947px}.sm{max-width:780px}.sn{max-width:740px}.so{max-width:609px}.sp{list-style-type:decimal}.sq{background-image:url(https://miro.medium.com/v2/da:true/resize:fit:320/0*HauLSq_zxp26dzLm)}.sr{max-width:961px}.ss{max-width:1206px}.st{max-width:1529px}.su{margin-bottom:26px}.sv{margin-top:6px}.sw{margin-right:8px}.sx{padding:8px 16px}.sy{border-radius:100px}.sz{transition:background 300ms ease}.tb{white-space:nowrap}.tc{border-top:none}.td{height:52px}.te{max-height:52px}.tf{box-sizing:content-box}.tg{position:static}.th{z-index:1}.tj{max-width:155px}.tu{height:0px}.tv{margin-bottom:40px}.uk{height:64px}.ul{width:64px}.um{align-self:flex-end}.un{color:rgba(255, 255, 255, 1)}.uo{fill:rgba(255, 255, 255, 1)}.up{background:rgba(25, 25, 25, 1)}.uq{border-color:rgba(25, 25, 25, 1)}.ut:disabled{opacity:0.1}.uu:disabled:hover{background:rgba(25, 25, 25, 1)}.uv:disabled:hover{border-color:rgba(25, 25, 25, 1)}.vb{padding-right:4px}.vc{font-weight:500}.vj{white-space:pre-wrap}.vk{margin-top:16px}.vt{gap:18px}.vu{fill:rgba(61, 61, 61, 1)}.vw{padding-bottom:6px}.vx{border-bottom:1px solid #F2F2F2}.wd{fill:#242424}.we{background:0}.wf{border-color:#242424}.wg:disabled:hover{color:#242424}.wh:disabled:hover{fill:#242424}.wi:disabled:hover{border-color:#242424}.wt{border-bottom:solid 1px #E5E5E5}.wu{margin-top:72px}.wv{padding:24px 0}.ww{margin-bottom:0px}.wx{margin-right:16px}.as:hover:not(:disabled){color:rgba(25, 25, 25, 1)}.at:hover:not(:disabled){fill:rgba(25, 25, 25, 1)}.et:hover{background:#156D12}.eu:hover{border-color:#156D12}.ev:hover{cursor:pointer}.fl:hover{color:#242424}.fm:hover{fill:#242424}.fq:hover svg{fill:#242424}.ft:hover{background-color:rgba(0, 0, 0, 0.1)}.il:hover{text-decoration:underline}.iq:hover:not(:disabled){color:#156D12}.ir:hover:not(:disabled){fill:#156D12}.kn:hover{fill:rgba(8, 8, 8, 1)}.le:hover{fill:#000000}.lf:hover p{color:#000000}.lh:hover{color:#000000}.lr:hover svg{color:#000000}.ta:hover{background-color:#F2F2F2}.uj:hover{background-color:none}.ur:hover{background:#000000}.us:hover{border-color:#242424}.vv:hover{fill:rgba(25, 25, 25, 1)}.bd:focus-within path{fill:#242424}.km:focus{fill:rgba(8, 8, 8, 1)}.ls:focus svg{color:#000000}.mt:focus{transform:scale(1.01)}.kr:active{border-style:none}</style><style type="text/css" data-fela-rehydration="621" data-fela-type="RULE" media="all and (min-width: 1080px)">.d{display:none}.bw{width:64px}.cg{margin:0 64px}.cv{height:48px}.dc{margin-bottom:52px}.do{margin-bottom:48px}.ef{font-size:14px}.eg{line-height:20px}.em{font-size:13px}.eo{padding:5px 12px}.fh{display:flex}.fy{margin-bottom:68px}.gc{max-width:680px}.hq{font-size:42px}.hr{margin-top:1.19em}.hs{margin-bottom:32px}.ht{line-height:52px}.hu{letter-spacing:-0.011em}.hz{align-items:center}.jk{border-top:solid 1px #F2F2F2}.jl{border-bottom:solid 1px #F2F2F2}.jm{margin:32px 0 0}.jn{padding:3px 8px}.jw> *{margin-right:24px}.jx> :last-child{margin-right:0}.ky{margin-top:0px}.ln{margin:0}.mo{margin-top:40px}.ns{font-size:24px}.nt{margin-top:1.95em}.nu{line-height:30px}.nv{letter-spacing:-0.016em}.oq{font-size:20px}.or{margin-top:0.94em}.os{line-height:32px}.ot{letter-spacing:-0.003em}.pg{margin-top:1.72em}.ph{line-height:24px}.pi{letter-spacing:0}.po{margin-top:2.14em}.qb{margin-top:1.25em}.qh{margin-top:56px}.qt{margin-top:1.14em}.qy{margin-top:32px}.to{display:inline-block}.tt{margin-bottom:104px}.tw{flex-direction:row}.tz{margin-bottom:0}.ua{margin-right:20px}.uw{max-width:500px}.vp{margin-bottom:88px}.vs{margin-bottom:72px}.wc{margin:40px 0 16px}.wn{width:min-width}.ws{padding-top:72px}</style><style type="text/css" data-fela-rehydration="621" data-fela-type="RULE" media="all and (max-width: 1079.98px)">.e{display:none}.kx{margin-top:0px}.mx{margin-left:auto}.my{text-align:center}.tn{display:inline-block}</style><style type="text/css" data-fela-rehydration="621" data-fela-type="RULE" media="all and (max-width: 903.98px)">.f{display:none}.kw{margin-top:0px}.tm{display:inline-block}</style><style type="text/css" data-fela-rehydration="621" data-fela-type="RULE" media="all and (max-width: 727.98px)">.g{display:none}.ku{margin-top:0px}.kv{margin-right:0px}.rd{padding:10px 12px 10px}.tl{display:inline-block}</style><style type="text/css" data-fela-rehydration="621" data-fela-type="RULE" media="all and (max-width: 551.98px)">.h{display:none}.s{display:flex}.t{justify-content:space-between}.bs{width:24px}.cc{margin:0 24px}.cr{height:40px}.cy{margin-bottom:44px}.dk{margin-bottom:32px}.dx{font-size:13px}.dy{line-height:20px}.eh{padding:0px 8px 1px}.fu{margin-bottom:4px}.gw{font-size:32px}.gx{margin-top:1.01em}.gy{margin-bottom:24px}.gz{line-height:38px}.ha{letter-spacing:-0.014em}.hv{align-items:flex-start}.it{flex-direction:column}.iy{margin:24px -24px 0}.iz{padding:0}.jo> *{margin-right:8px}.jp> :last-child{margin-right:24px}.kh{margin-left:0px}.ks{margin-top:0px}.kt{margin-right:0px}.lj{margin:0}.lt{border:1px solid #F2F2F2}.lu{border-radius:99em}.lv{padding:0px 16px 0px 12px}.lw{height:38px}.lx{align-items:center}.lz svg{margin-right:8px}.mk{margin-top:32px}.nc{font-size:20px}.nd{margin-top:1.2em}.ne{line-height:24px}.nf{letter-spacing:0}.oa{font-size:18px}.ob{margin-top:0.67em}.oc{line-height:28px}.od{letter-spacing:-0.003em}.ow{font-size:16px}.ox{margin-top:1.23em}.pk{margin-top:1.56em}.px{margin-top:0.93em}.qd{margin-top:40px}.qp{margin-top:1.34em}.qu{margin-top:24px}.tk{display:inline-block}.tp{margin-bottom:96px}.uh{margin-bottom:20px}.ui{margin-right:0}.va{max-width:100%}.vd{font-size:24px}.ve{line-height:30px}.vf{letter-spacing:-0.016em}.vl{margin-bottom:64px}.vy{margin:32px 0 16px}.wj{width:100%}.wo{padding-top:48px}.ly:hover{border-color:#E5E5E5}</style><style type="text/css" data-fela-rehydration="621" data-fela-type="RULE" media="all and (min-width: 904px) and (max-width: 1079.98px)">.i{display:none}.bv{width:64px}.cf{margin:0 64px}.cu{height:48px}.db{margin-bottom:52px}.dn{margin-bottom:48px}.ed{font-size:14px}.ee{line-height:20px}.ek{font-size:13px}.el{padding:5px 12px}.fg{display:flex}.fx{margin-bottom:68px}.gb{max-width:680px}.hl{font-size:42px}.hm{margin-top:1.19em}.hn{margin-bottom:32px}.ho{line-height:52px}.hp{letter-spacing:-0.011em}.hy{align-items:center}.jg{border-top:solid 1px #F2F2F2}.jh{border-bottom:solid 1px #F2F2F2}.ji{margin:32px 0 0}.jj{padding:3px 8px}.ju> *{margin-right:24px}.jv> :last-child{margin-right:0}.lm{margin:0}.mn{margin-top:40px}.no{font-size:24px}.np{margin-top:1.95em}.nq{line-height:30px}.nr{letter-spacing:-0.016em}.om{font-size:20px}.on{margin-top:0.94em}.oo{line-height:32px}.op{letter-spacing:-0.003em}.pd{margin-top:1.72em}.pe{line-height:24px}.pf{letter-spacing:0}.pn{margin-top:2.14em}.qa{margin-top:1.25em}.qg{margin-top:56px}.qs{margin-top:1.14em}.qx{margin-top:32px}.ts{margin-bottom:104px}.tx{flex-direction:row}.ub{margin-bottom:0}.uc{margin-right:20px}.ux{max-width:500px}.vo{margin-bottom:88px}.vr{margin-bottom:72px}.wb{margin:40px 0 16px}.wm{width:min-width}.wr{padding-top:72px}</style><style type="text/css" data-fela-rehydration="621" data-fela-type="RULE" media="all and (min-width: 728px) and (max-width: 903.98px)">.j{display:none}.w{display:flex}.x{justify-content:space-between}.bu{width:64px}.ce{margin:0 48px}.ct{height:48px}.da{margin-bottom:52px}.dm{margin-bottom:48px}.eb{font-size:13px}.ec{line-height:20px}.ej{padding:0px 8px 1px}.fw{margin-bottom:68px}.ga{max-width:680px}.hg{font-size:42px}.hh{margin-top:1.19em}.hi{margin-bottom:32px}.hj{line-height:52px}.hk{letter-spacing:-0.011em}.hx{align-items:center}.jc{border-top:solid 1px #F2F2F2}.jd{border-bottom:solid 1px #F2F2F2}.je{margin:32px 0 0}.jf{padding:3px 8px}.js> *{margin-right:24px}.jt> :last-child{margin-right:0}.ll{margin:0}.mm{margin-top:40px}.nk{font-size:24px}.nl{margin-top:1.95em}.nm{line-height:30px}.nn{letter-spacing:-0.016em}.oi{font-size:20px}.oj{margin-top:0.94em}.ok{line-height:32px}.ol{letter-spacing:-0.003em}.pa{margin-top:1.72em}.pb{line-height:24px}.pc{letter-spacing:0}.pm{margin-top:2.14em}.pz{margin-top:1.25em}.qf{margin-top:56px}.qr{margin-top:1.14em}.qw{margin-top:32px}.tr{margin-bottom:104px}.ty{flex-direction:row}.ud{margin-bottom:0}.ue{margin-right:20px}.uy{max-width:500px}.vn{margin-bottom:88px}.vq{margin-bottom:72px}.wa{margin:40px 0 16px}.wl{width:min-width}.wq{padding-top:72px}</style><style type="text/css" data-fela-rehydration="621" data-fela-type="RULE" media="all and (min-width: 552px) and (max-width: 727.98px)">.k{display:none}.u{display:flex}.v{justify-content:space-between}.bt{width:24px}.cd{margin:0 24px}.cs{height:40px}.cz{margin-bottom:44px}.dl{margin-bottom:32px}.dz{font-size:13px}.ea{line-height:20px}.ei{padding:0px 8px 1px}.fv{margin-bottom:4px}.hb{font-size:32px}.hc{margin-top:1.01em}.hd{margin-bottom:24px}.he{line-height:38px}.hf{letter-spacing:-0.014em}.hw{align-items:flex-start}.iu{flex-direction:column}.ja{margin:24px 0 0}.jb{padding:0}.jq> *{margin-right:8px}.jr> :last-child{margin-right:8px}.ki{margin-left:0px}.lk{margin:0}.ma{border:1px solid #F2F2F2}.mb{border-radius:99em}.mc{padding:0px 16px 0px 12px}.md{height:38px}.me{align-items:center}.mg svg{margin-right:8px}.ml{margin-top:32px}.ng{font-size:20px}.nh{margin-top:1.2em}.ni{line-height:24px}.nj{letter-spacing:0}.oe{font-size:18px}.of{margin-top:0.67em}.og{line-height:28px}.oh{letter-spacing:-0.003em}.oy{font-size:16px}.oz{margin-top:1.23em}.pl{margin-top:1.56em}.py{margin-top:0.93em}.qe{margin-top:40px}.qq{margin-top:1.34em}.qv{margin-top:24px}.tq{margin-bottom:96px}.uf{margin-bottom:20px}.ug{margin-right:0}.uz{max-width:100%}.vg{font-size:24px}.vh{line-height:30px}.vi{letter-spacing:-0.016em}.vm{margin-bottom:64px}.vz{margin:32px 0 16px}.wk{width:100%}.wp{padding-top:48px}.mf:hover{border-color:#E5E5E5}</style><style type="text/css" data-fela-rehydration="621" data-fela-type="RULE" media="print">.ti{display:none}</style><style type="text/css" data-fela-rehydration="621" data-fela-type="RULE" media="(prefers-reduced-motion: no-preference)">.mq{transition:transform 300ms cubic-bezier(0.2, 0, 0.2, 1)}</style><style type="text/css" data-fela-rehydration="621" data-fela-type="RULE" media="(orientation: landscape) and (max-width: 903.98px)">.rj{max-height:none}</style></head><body><div id="root"><div class="a b c"><div class="d e f g h i j k"></div><script>document.domain = document.domain;</script><div class="l c"><div class="l m n o c"><div class="p q r s t u v w x i d y z"><a class="du ag dv bf ak b am an ao ap aq ar as at s u w i d q dw z" href="https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F5adefebb6841&amp;%7Efeature=LoOpenInAppButton&amp;%7Echannel=ShowPostUnderUser&amp;source=---top_nav_layout_nav----------------------------------" rel="noopener follow">Open in app<svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" fill="none" viewBox="0 0 10 10" class="dt"><path fill="currentColor" d="M.985 8.485a.375.375 0 1 0 .53.53zM8.75 1.25h.375A.375.375 0 0 0 8.75.875zM8.375 6.5a.375.375 0 1 0 .75 0zM3.5.875a.375.375 0 1 0 0 .75zm-1.985 8.14 7.5-7.5-.53-.53-7.5 7.5zm6.86-7.765V6.5h.75V1.25zM3.5 1.625h5.25v-.75H3.5z"></path></svg></a><div class="ab q"><p class="bf b dx dy dz ea eb ec ed ee ef eg du"><span><button class="bf b dx dy eh dz ea ei eb ec ej ek ee el em eg eo ep eq er es et eu ev ew ex ey ez fa fb fc fd bm fe ff" data-testid="headerSignUpButton">Sign up</button></span></p><div class="ax l"><p class="bf b dx dy dz ea eb ec ed ee ef eg du"><span><a class="af ag ah ai aj ak al am an ao ap aq ar as at" data-testid="headerSignInButton" href="https://medium.com/m/signin?operation=login&amp;redirect=https%3A%2F%2Fmicahbabinski.medium.com%2Fhtml-smuggling-detection-5adefebb6841&amp;source=post_page---top_nav_layout_nav-----------------------global_nav-----------" rel="noopener follow">Sign in</a></span></p></div></div></div><div class="p q r ab ac"><div class="ab q ae"><a class="af ag ah ai aj ak al am an ao ap aq ar as at ab" aria-label="Homepage" data-testid="headerMediumLogo" href="https://medium.com/?source=---top_nav_layout_nav----------------------------------" rel="noopener follow"><svg xmlns="http://www.w3.org/2000/svg" width="719" height="160" fill="none" viewBox="0 0 719 160" class="au av aw"><path fill="#242424" d="m174.104 9.734.215-.047V8.02H130.39L89.6 103.89 48.81 8.021H1.472v1.666l.212.047c8.018 1.81 12.09 4.509 12.09 14.242V137.93c0 9.734-4.087 12.433-12.106 14.243l-.212.047v1.671h32.118v-1.665l-.213-.048c-8.018-1.809-12.089-4.509-12.089-14.242V30.586l52.399 123.305h2.972l53.925-126.743V140.75c-.687 7.688-4.721 10.062-11.982 11.701l-.215.05v1.652h55.948v-1.652l-.215-.05c-7.269-1.639-11.4-4.013-12.087-11.701l-.037-116.774h.037c0-9.733 4.071-12.432 12.087-14.242m25.555 75.488c.915-20.474 8.268-35.252 20.606-35.507 3.806.063 6.998 1.312 9.479 3.714 5.272 5.118 7.751 15.812 7.368 31.793zm-.553 5.77h65.573v-.275c-.186-15.656-4.721-27.834-13.466-36.196-7.559-7.227-18.751-11.203-30.507-11.203h-.263c-6.101 0-13.584 1.48-18.909 4.16-6.061 2.807-11.407 7.003-15.855 12.511-7.161 8.874-11.499 20.866-12.554 34.343q-.05.606-.092 1.212a50 50 0 0 0-.065 1.151 85.807 85.807 0 0 0-.094 5.689c.71 30.524 17.198 54.917 46.483 54.917 25.705 0 40.675-18.791 44.407-44.013l-1.886-.664c-6.557 13.556-18.334 21.771-31.738 20.769-18.297-1.369-32.314-19.922-31.042-42.395m139.722 41.359c-2.151 5.101-6.639 7.908-12.653 7.908s-11.513-4.129-15.418-11.63c-4.197-8.053-6.405-19.436-6.405-32.92 0-28.067 8.729-46.22 22.24-46.22 5.657 0 10.111 2.807 12.236 7.704zm43.499 20.008c-8.019-1.897-12.089-4.722-12.089-14.951V1.309l-48.716 14.353v1.757l.299-.024c6.72-.543 11.278.386 13.925 2.83 2.072 1.915 3.082 4.853 3.082 8.987v18.66c-4.803-3.067-10.516-4.56-17.448-4.56-14.059 0-26.909 5.92-36.176 16.672-9.66 11.205-14.767 26.518-14.767 44.278-.003 31.72 15.612 53.039 38.851 53.039 13.595 0 24.533-7.449 29.54-20.013v16.865h43.711v-1.746zM424.1 19.819c0-9.904-7.468-17.374-17.375-17.374-9.859 0-17.573 7.632-17.573 17.374s7.721 17.374 17.573 17.374c9.907 0 17.375-7.47 17.375-17.374m11.499 132.546c-8.019-1.897-12.089-4.722-12.089-14.951h-.035V43.635l-43.714 12.551v1.705l.263.024c9.458.842 12.047 4.1 12.047 15.152v81.086h43.751v-1.746zm112.013 0c-8.018-1.897-12.089-4.722-12.089-14.951V43.635l-41.621 12.137v1.71l.246.026c7.733.813 9.967 4.257 9.967 15.36v59.279c-2.578 5.102-7.415 8.131-13.274 8.336-9.503 0-14.736-6.419-14.736-18.073V43.638l-43.714 12.55v1.703l.262.024c9.459.84 12.05 4.097 12.05 15.152v50.17a56.3 56.3 0 0 0 .91 10.444l.787 3.423c3.701 13.262 13.398 20.197 28.59 20.197 12.868 0 24.147-7.966 29.115-20.43v17.311h43.714v-1.747zm169.818 1.788v-1.749l-.213-.05c-8.7-2.006-12.089-5.789-12.089-13.49v-63.79c0-19.89-11.171-31.761-29.883-31.761-13.64 0-25.141 7.882-29.569 20.16-3.517-13.01-13.639-20.16-28.606-20.16-13.146 0-23.449 6.938-27.869 18.657V43.643L545.487 55.68v1.715l.263.024c9.345.829 12.047 4.181 12.047 14.95v81.784h40.787v-1.746l-.215-.053c-6.941-1.631-9.181-4.606-9.181-12.239V66.998c1.836-4.289 5.537-9.37 12.853-9.37 9.086 0 13.692 6.296 13.692 18.697v77.828h40.797v-1.746l-.215-.053c-6.94-1.631-9.18-4.606-9.18-12.239V75.066a42 42 0 0 0-.578-7.26c1.947-4.661 5.86-10.177 13.475-10.177 9.214 0 13.691 6.114 13.691 18.696v77.828z"></path></svg></a><div class="ax h"><div class="ab ay az ba bb q bc bd"><div class="bm" aria-hidden="false" aria-describedby="searchResults" aria-labelledby="searchResults"></div><div class="bn bo ab"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.092 11.06a6.95 6.95 0 1 1 13.9 0 6.95 6.95 0 0 1-13.9 0m6.95-8.05a8.05 8.05 0 1 0 5.13 14.26l3.75 3.75a.56.56 0 1 0 .79-.79l-3.73-3.73A8.05 8.05 0 0 0 11.042 3z" clip-rule="evenodd"></path></svg></div><input role="combobox" aria-controls="searchResults" aria-expanded="false" aria-label="search" data-testid="headerSearchInput" tabindex="0" class="ay be bf bg z bh bi bj bk bl" placeholder="Search" value=""/></div></div></div><div class="h k w fg fh"><div class="fi ab"><span><a class="af ag ah ai aj ak al am an ao ap aq ar as at" data-testid="headerWriteButton" href="https://medium.com/m/signin?operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2Fnew-story&amp;source=---top_nav_layout_nav-----------------------new_post_topnav-----------" rel="noopener follow"><div class="bf b bg z du fj fk ab q fl fm"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" aria-label="Write"><path fill="currentColor" d="M14 4a.5.5 0 0 0 0-1zm7 6a.5.5 0 0 0-1 0zm-7-7H4v1h10zM3 4v16h1V4zm1 17h16v-1H4zm17-1V10h-1v10zm-1 1a1 1 0 0 0 1-1h-1zM3 20a1 1 0 0 0 1 1v-1zM4 3a1 1 0 0 0-1 1h1z"></path><path stroke="currentColor" d="m17.5 4.5-8.458 8.458a.25.25 0 0 0-.06.098l-.824 2.47a.25.25 0 0 0 .316.316l2.47-.823a.25.25 0 0 0 .098-.06L19.5 6.5m-2-2 2.323-2.323a.25.25 0 0 1 .354 0l1.646 1.646a.25.25 0 0 1 0 .354L19.5 6.5m-2-2 2 2"></path></svg><div class="dt l">Write</div></div></a></span></div></div><div class="k j i d"><div class="fi ab"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" data-testid="headerSearchButton" href="https://medium.com/search?source=---top_nav_layout_nav----------------------------------" rel="noopener follow"><div class="bf b bg z du fj fk ab q fl fm"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" aria-label="Search"><path fill="currentColor" fill-rule="evenodd" d="M4.092 11.06a6.95 6.95 0 1 1 13.9 0 6.95 6.95 0 0 1-13.9 0m6.95-8.05a8.05 8.05 0 1 0 5.13 14.26l3.75 3.75a.56.56 0 1 0 .79-.79l-3.73-3.73A8.05 8.05 0 0 0 11.042 3z" clip-rule="evenodd"></path></svg></div></a></div></div><div class="fi h k j"><div class="ab q"><p class="bf b dx dy dz ea eb ec ed ee ef eg du"><span><button class="bf b dx dy eh dz ea ei eb ec ej ek ee el em eg eo ep eq er es et eu ev ew ex ey ez fa fb fc fd bm fe ff" data-testid="headerSignUpButton">Sign up</button></span></p><div class="ax l"><p class="bf b dx dy dz ea eb ec ed ee ef eg du"><span><a class="af ag ah ai aj ak al am an ao ap aq ar as at" data-testid="headerSignInButton" href="https://medium.com/m/signin?operation=login&amp;redirect=https%3A%2F%2Fmicahbabinski.medium.com%2Fhtml-smuggling-detection-5adefebb6841&amp;source=post_page---top_nav_layout_nav-----------------------global_nav-----------" rel="noopener follow">Sign in</a></span></p></div></div></div><div class="l" aria-hidden="false"><button class="ay fn am ab q ao fo fp fq" aria-label="user options menu" data-testid="headerUserIcon"><div class="l fj"><img alt="" class="l fd by bz ca cx" src="https://miro.medium.com/v2/resize:fill:64:64/1*dmbNkD5D-u45r44go_cf0g.png" width="32" height="32" loading="lazy" role="presentation"/><div class="fr by l bz ca fs n ay ft"></div></div></button></div></div></div><div class="l"><div class="fu fv fw fx fy l"><div class="ab cb"><div class="ci bh fz ga gb gc"></div></div><article><div class="l"><div class="l"><span class="l"></span><section><div><div class="fs gi gj gk gl gm"></div><div class="gn go gp gq gr"><div class="ab cb"><div class="ci bh fz ga gb gc"><div><h1 id="7e61" class="pw-post-title gs gt gu bf gv gw gx gy gz ha hb hc hd he hf hg hh hi hj hk hl hm hn ho hp hq hr hs ht hu bk" data-testid="storyTitle">HTML Smuggling Detection</h1><div><div class="speechify-ignore ab cp"><div class="speechify-ignore bh l"><div class="hv hw hx hy hz ab"><div><div class="ab ia"><div><div class="bm" aria-hidden="false"><a rel="noopener follow" href="/?source=post_page---byline--5adefebb6841--------------------------------"><div class="l ib ic by id ie"><div class="l fj"><img alt="Micah Babinski" class="l fd by dd de cx" src="https://miro.medium.com/v2/resize:fill:88:88/1*mTA5GOa5eEXK6eiPX6bibQ.png" width="44" height="44" loading="lazy" data-testid="authorPhoto"/><div class="if by l dd de fs n ig ft"></div></div></div></a></div></div></div></div><div class="bn bh l"><div class="ab"><div style="flex:1"><span class="bf b bg z bk"><div class="ih ab q"><div class="ab q ii"><div class="ab q"><div><div class="bm" aria-hidden="false"><p class="bf b ij ik bk"><a class="af ag ah ai aj ak al am an ao ap aq ar il" data-testid="authorName" rel="noopener follow" href="/?source=post_page---byline--5adefebb6841--------------------------------">Micah Babinski</a></p></div></div></div><span class="im in" aria-hidden="true"><span class="bf b bg z du">·</span></span><p class="bf b ij ik du"><span><a class="io ip ah ai aj ak al am an ao ap aq ar ex iq ir" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F47a061e2b431&amp;operation=register&amp;redirect=https%3A%2F%2Fmicahbabinski.medium.com%2Fhtml-smuggling-detection-5adefebb6841&amp;user=Micah+Babinski&amp;userId=47a061e2b431&amp;source=post_page-47a061e2b431--byline--5adefebb6841---------------------post_header-----------" rel="noopener follow">Follow</a></span></p></div></div></span></div></div><div class="l is"><span class="bf b bg z du"><div class="ab cn it iu iv"><span class="bf b bg z du"><div class="ab ae"><span data-testid="storyReadTime">15 min read</span><div class="iw ix l" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bf b bg z du">·</span></span></div><span data-testid="storyPublishDate">Dec 28, 2022</span></div></span></div></span></div></div></div><div class="ab cp iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn"><div class="h k w fg fh q"><div class="kd l"><div class="ab q ke kf"><div class="pw-multi-vote-icon fj kg kh ki kj"><span><a class="af ag ah ai aj ak al am an ao ap aq ar as at" data-testid="headerClapButton" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Fp%2F5adefebb6841&amp;operation=register&amp;redirect=https%3A%2F%2Fmicahbabinski.medium.com%2Fhtml-smuggling-detection-5adefebb6841&amp;user=Micah+Babinski&amp;userId=47a061e2b431&amp;source=---header_actions--5adefebb6841---------------------clap_footer-----------" rel="noopener follow"><div><div class="bm" aria-hidden="false"><div class="kk ao kl km kn ko am kp kq kr kj"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM13.916 3.953l1.523-2.112-1.184-.39zM8.589 1.84l1.522 2.112-.337-2.501zM18.523 18.92c-.86.86-1.75 1.246-2.62 1.33a6 6 0 0 0 .407-.372c2.388-2.389 2.86-4.951 1.399-7.623l-.912-1.603-.79-1.672c-.26-.56-.194-.98.203-1.288a.7.7 0 0 1 .546-.132c.283.046.546.231.728.5l2.363 4.157c.976 1.624 1.141 4.237-1.324 6.702m-10.999-.438L3.37 14.328a.828.828 0 0 1 .585-1.408.83.83 0 0 1 .585.242l2.158 2.157a.365.365 0 0 0 .516-.516l-2.157-2.158-1.449-1.449a.826.826 0 0 1 1.167-1.17l3.438 3.44a.363.363 0 0 0 .516 0 .364.364 0 0 0 0-.516L5.293 9.513l-.97-.97a.826.826 0 0 1 0-1.166.84.84 0 0 1 1.167 0l.97.968 3.437 3.436a.36.36 0 0 0 .517 0 .366.366 0 0 0 0-.516L6.977 7.83a.82.82 0 0 1-.241-.584.82.82 0 0 1 .824-.826c.219 0 .43.087.584.242l5.787 5.787a.366.366 0 0 0 .587-.415l-1.117-2.363c-.26-.56-.194-.98.204-1.289a.7.7 0 0 1 .546-.132c.283.046.545.232.727.501l2.193 3.86c1.302 2.38.883 4.59-1.277 6.75-1.156 1.156-2.602 1.627-4.19 1.367-1.418-.236-2.866-1.033-4.079-2.246M10.75 5.971l2.12 2.12c-.41.502-.465 1.17-.128 1.89l.22.465-3.523-3.523a.8.8 0 0 1-.097-.368c0-.22.086-.428.241-.584a.847.847 0 0 1 1.167 0m7.355 1.705c-.31-.461-.746-.758-1.23-.837a1.44 1.44 0 0 0-1.11.275c-.312.24-.505.543-.59.881a1.74 1.74 0 0 0-.906-.465 1.47 1.47 0 0 0-.82.106l-2.182-2.182a1.56 1.56 0 0 0-2.2 0 1.54 1.54 0 0 0-.396.701 1.56 1.56 0 0 0-2.21-.01 1.55 1.55 0 0 0-.416.753c-.624-.624-1.649-.624-2.237-.037a1.557 1.557 0 0 0 0 2.2c-.239.1-.501.238-.715.453a1.56 1.56 0 0 0 0 2.2l.516.515a1.556 1.556 0 0 0-.753 2.615L7.01 19c1.32 1.319 2.909 2.189 4.475 2.449q.482.08.971.08c.85 0 1.653-.198 2.393-.579.231.033.46.054.686.054 1.266 0 2.457-.52 3.505-1.567 2.763-2.763 2.552-5.734 1.439-7.586z" clip-rule="evenodd"></path></svg></div></div></div></a></span></div><div class="pw-multi-vote-count l ks kt ku kv kw kx ky"><p class="bf b dv z du"><span class="kz">--</span></p></div></div></div><div><div class="bm" aria-hidden="false"><button class="ao kk lc ld ab q fk le lf" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="lb"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"></path></svg><p class="bf b dv z du"><span class="pw-responses-count la lb">1</span></p></button></div></div></div><div class="ab q jo jp jq jr js jt ju jv jw jx jy jz ka kb kc"><div class="lg k j i d"></div><div class="h k"><div><div class="bm" aria-hidden="false"><span><a class="af ag ah ai aj ak al am an ao ap aq ar as at" data-testid="headerBookmarkButton" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F5adefebb6841&amp;operation=register&amp;redirect=https%3A%2F%2Fmicahbabinski.medium.com%2Fhtml-smuggling-detection-5adefebb6841&amp;source=---header_actions--5adefebb6841---------------------bookmark_footer-----------" rel="noopener follow"><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="none" viewBox="0 0 25 25" class="du lh" aria-label="Add to list bookmark button"><path fill="currentColor" d="M18 2.5a.5.5 0 0 1 1 0V5h2.5a.5.5 0 0 1 0 1H19v2.5a.5.5 0 1 1-1 0V6h-2.5a.5.5 0 0 1 0-1H18zM7 7a1 1 0 0 1 1-1h3.5a.5.5 0 0 0 0-1H8a2 2 0 0 0-2 2v14a.5.5 0 0 0 .805.396L12.5 17l5.695 4.396A.5.5 0 0 0 19 21v-8.5a.5.5 0 0 0-1 0v7.485l-5.195-4.012a.5.5 0 0 0-.61 0L7 19.985z"></path></svg></a></span></div></div></div><div class="fd li cn"><div class="l ae"><div class="ab cb"><div class="lj lk ll lm ln lo ci bh"><div class="ab"><div class="bm bh" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="Listen" data-testid="audioPlayButton" class="af fk ah ai aj ak al lp an ao ap ex lq lr lf ls lt lu lv lw s lx ly lz ma mb mc md u me mf mg"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"></path></svg><div class="j i d"><p class="bf b bg z du">Listen</p></div></button></div></div></div></div></div></div></div></div><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="af fk ah ai aj ak al lp an ao ap ex lq lr lf ls lt lu lv lw s lx ly lz ma mb mc md u me mf mg"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"></path></svg><div class="j i d"><p class="bf b bg z du">Share</p></div></button></div></div></div></div></div></div></div></div></div><figure class="mk ml mm mn mo mp mh mi paragraph-image"><div role="button" tabindex="0" class="mq mr fj ms bh mt"><div class="mh mi mj"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*5P6AoNfhFJraUVFkpN1NXw.jpeg 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*5P6AoNfhFJraUVFkpN1NXw.jpeg 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*5P6AoNfhFJraUVFkpN1NXw.jpeg 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*5P6AoNfhFJraUVFkpN1NXw.jpeg 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*5P6AoNfhFJraUVFkpN1NXw.jpeg 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*5P6AoNfhFJraUVFkpN1NXw.jpeg 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*5P6AoNfhFJraUVFkpN1NXw.jpeg 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*5P6AoNfhFJraUVFkpN1NXw.jpeg 640w, https://miro.medium.com/v2/resize:fit:720/1*5P6AoNfhFJraUVFkpN1NXw.jpeg 720w, https://miro.medium.com/v2/resize:fit:750/1*5P6AoNfhFJraUVFkpN1NXw.jpeg 750w, https://miro.medium.com/v2/resize:fit:786/1*5P6AoNfhFJraUVFkpN1NXw.jpeg 786w, https://miro.medium.com/v2/resize:fit:828/1*5P6AoNfhFJraUVFkpN1NXw.jpeg 828w, https://miro.medium.com/v2/resize:fit:1100/1*5P6AoNfhFJraUVFkpN1NXw.jpeg 1100w, https://miro.medium.com/v2/resize:fit:1400/1*5P6AoNfhFJraUVFkpN1NXw.jpeg 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"/><img alt="" class="bh lo mu c" width="700" height="350" loading="eager" role="presentation"/></picture></div></div><figcaption class="mv ff mw mh mi mx my bf b bg z du">The most famous fictional smuggler that I could think of</figcaption></figure><h1 id="d6e6" class="mz na gu bf nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw bk">Introduction</h1><p id="80d2" class="pw-post-body-paragraph nx ny gu nz b oa ob oc od oe of og oh oi oj ok ol om on oo op oq or os ot ou gn bk">In this article I’ll delve into HTML smuggling detection, following the detection engineering process I’ve described over my last two posts. This process includes research, testing, and development of new detection concepts. Unlike my previous posts however, this time we’ll be observing, profiling, and detecting real QakBot malware in the lab. With this piece I hope to show how current and aspiring detection engineers can go beyond simulated, CTF-style challenges to study and detect real-world attacker techniques, flagging them for our SOC, and allowing our incident response colleagues to neutralize the threat.</p><h2 id="0ca2" class="ov na gu bf nb ow ox dy nf oy oz ea nj oi pa pb pc om pd pe pf oq pg ph pi pj bk">Our Itinerary</h2><p id="b1d3" class="pw-post-body-paragraph nx ny gu nz b oa ob oc od oe of og oh oi oj ok ol om on oo op oq or os ot ou gn bk">After some background and defining the objective, I’ll demonstrate how we can execute QakBot HTML Smuggling malware in the lab, tracking it’s behavior in Splunk. Then, I’ll sequence observable events of this attack, and identify useful detection points (which I think of as “building blocks,” or links of the attack chain). I’ll also introduce correlation (specifically chain rules), a crucial tool in your threat detection toolbox. To illustrate what this looks like, I’ll discuss and demonstrate an as-yet-unreleased capability of Sigma, called Sigma Correlations. I’ll wrap up by testing a new chain rule against 10 additional samples of QakBot HTML Smuggling malware to see how it performs.</p><p id="c1af" class="pw-post-body-paragraph nx ny gu nz b oa pk oc od oe pl og oh oi pm ok ol om pn oo op oq po os ot ou gn bk">Let’s get started! 🏁🏁🏁</p></div></div></div><div class="ab cb pp pq pr ps" role="separator"><span class="pt by bm pu pv pw"></span><span class="pt by bm pu pv pw"></span><span class="pt by bm pu pv"></span></div><div class="gn go gp gq gr"><div class="ab cb"><div class="ci bh fz ga gb gc"><h1 id="c24b" class="mz na gu bf nb nc px ne nf ng py ni nj nk pz nm nn no qa nq nr ns qb nu nv nw bk">Background</h1><p id="b129" class="pw-post-body-paragraph nx ny gu nz b oa ob oc od oe of og oh oi oj ok ol om on oo op oq or os ot ou gn bk">Early on in my cybersecurity journey, John Strand of Black Hills Information Security said something that stuck with me: “There is no ‘YOU HAVE BEEN HACKED’ log.” Event logs can be confusing and hard to read even on a good day. Deriving useful, actionable insights from logs is tricky! The challenge sometimes requires deep analysis and specialized techniques to be successful.</p><p id="74c3" class="pw-post-body-paragraph nx ny gu nz b oa pk oc od oe pl og oh oi pm ok ol om pn oo op oq po os ot ou gn bk">I’ve had that lesson in the back of my mind throughout my career in security, and it was with this in mind that a few months ago, I started seeing tons of posts like this one from <a class="af qc" href="https://twitter.com/pr0xylife" rel="noopener ugc nofollow" target="_blank">@pr0xylife</a>:</p><figure class="qd qe qf qg qh mp"><div class="qi qj l fj"><div class="qk ql l"></div></div></figure><p id="d708" class="pw-post-body-paragraph nx ny gu nz b oa pk oc od oe pl og oh oi pm ok ol om pn oo op oq po os ot ou gn bk">I like the way that pr0xylife and their peers summarize these attacks so succinctly, and I found myself repeating the sequence of file types out loud — almost like a weird form of poetry!</p><p id="9ba9" class="pw-post-body-paragraph nx ny gu nz b oa pk oc od oe pl og oh oi pm ok ol om pn oo op oq po os ot ou gn bk">I wanted to learn more, but didn’t know how to get started. I had reviewed some excellent research on QakBot by the team at Trellix, so I knew a bit about their techniques. (If you have never heard of QakBot, please read the Trellix report!) As I started following QakBot activity and digging deeper, I realized that pr0xylife and others were describing the subtle combinations and variations in the way QakBot could trick its victims and evade our defenses. Some examples:</p><ul class=""><li id="f002" class="nx ny gu nz b oa pk oc od oe pl og oh oi pm ok ol om pn oo op oq po os ot ou qm qn qo bk">It uses <a class="af qc" href="https://www.microsoft.com/en-us/security/blog/2021/11/11/html-smuggling-surges-highly-evasive-loader-technique-increasingly-used-in-banking-malware-targeted-attacks/" rel="noopener ugc nofollow" target="_blank">HTML Smuggling</a>, where a malicious HTML file containing encoded JavaScript is executed by the victim’s browser, downloading the next stage of the payload.</li><li id="bbea" class="nx ny gu nz b oa qp oc od oe qq og oh oi qr ok ol om qs oo op oq qt os ot ou qm qn qo bk">It uses <a class="af qc" href="https://www.trendmicro.com/en_us/research/22/j/black-basta-infiltrates-networks-via-qakbot-brute-ratel-and-coba.html" rel="noopener ugc nofollow" target="_blank">password protected zip files</a> to block sandboxing analysis.</li><li id="2543" class="nx ny gu nz b oa qp oc od oe qq og oh oi qr ok ol om qs oo op oq qt os ot ou qm qn qo bk">It uses a disk image format called an .iso file to evade the Mark-of-the-Web protection, as Red Canary <a class="af qc" href="https://redcanary.com/blog/iso-files/" rel="noopener ugc nofollow" target="_blank">explains very well</a>.</li><li id="5aa0" class="nx ny gu nz b oa qp oc od oe qq og oh oi qr ok ol om qs oo op oq qt os ot ou qm qn qo bk">LNK files disguised to lure users into executing to hidden .CMD and .DLL files.</li><li id="59f6" class="nx ny gu nz b oa qp oc od oe qq og oh oi qr ok ol om qs oo op oq qt os ot ou qm qn qo bk">And on and on with ever more deceptive tricks!</li></ul><p id="fc11" class="pw-post-body-paragraph nx ny gu nz b oa pk oc od oe pl og oh oi pm ok ol om pn oo op oq po os ot ou gn bk">Viewed independently of one another, few of these behaviors will trigger an alert, much less get escalated, in many SOCs. So it seemed like a good use case for correlation, where multiple security event log entries are aggregated, sequenced, and timed in relation to each other to yield more sophisticated and high-fidelity alerts. If this sounds confusing, keep reading! By the end of this article, you should have a much better understanding of what correlation means and how you can put it to work for threat detection.</p><h1 id="b49e" class="mz na gu bf nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw bk">The Objective</h1><p id="d4ca" class="pw-post-body-paragraph nx ny gu nz b oa ob oc od oe of og oh oi oj ok ol om on oo op oq or os ot ou gn bk">There are some detections out there for HTML smuggling and other QakBot-connected techniques. These are mostly based on matching suspicious log events, such as this one from Elastic security:</p><div class="qu qv qw qx qy qz"><a href="https://www.elastic.co/guide/en/security/current/suspicious-html-file-creation.html?source=post_page-----5adefebb6841--------------------------------" rel="noopener  ugc nofollow" target="_blank"><div class="ra ab is"><div class="rb ab co cb rc rd"><h2 class="bf gv ij z qj re rf rg rh ri rj gt bk">Suspicious HTML File Creation | Elastic Security Solution [8.5] | Elastic</h2><div class="rk l"><h3 class="bf b ij z qj re rf rg rh ri rj du">Identifies the execution of a browser process to open an HTML file with high entropy and size. Adversaries may smuggle…</h3></div><div class="rl l"><p class="bf b dv z qj re rf rg rh ri rj du">www.elastic.co</p></div></div></div></a></div><p id="4d66" class="pw-post-body-paragraph nx ny gu nz b oa pk oc od oe pl og oh oi pm ok ol om pn oo op oq po os ot ou gn bk">I wanted to see if I could build my own detections, utilizing <em class="rm">correlation </em>(as opposed to simple matching) to make them resilient to subtle shifts in attack behavior.</p><blockquote class="rn ro rp"><p id="c363" class="nx ny rm nz b oa pk oc od oe pl og oh oi pm ok ol om pn oo op oq po os ot ou gn bk">TBH, I was also sick of QakBot’s dumb chicanery and wanted a reliable way to place it squarely within our sights.</p></blockquote><figure class="qd qe qf qg qh mp mh mi paragraph-image"><div class="mh mi rq"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/0*c4yEMPAmk8GZ39Px.gif 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/0*c4yEMPAmk8GZ39Px.gif 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/0*c4yEMPAmk8GZ39Px.gif 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/0*c4yEMPAmk8GZ39Px.gif 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/0*c4yEMPAmk8GZ39Px.gif 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/0*c4yEMPAmk8GZ39Px.gif 1100w, https://miro.medium.com/v2/resize:fit:640/format:webp/0*c4yEMPAmk8GZ39Px.gif 640w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 320px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/0*c4yEMPAmk8GZ39Px.gif 640w, https://miro.medium.com/v2/resize:fit:720/0*c4yEMPAmk8GZ39Px.gif 720w, https://miro.medium.com/v2/resize:fit:750/0*c4yEMPAmk8GZ39Px.gif 750w, https://miro.medium.com/v2/resize:fit:786/0*c4yEMPAmk8GZ39Px.gif 786w, https://miro.medium.com/v2/resize:fit:828/0*c4yEMPAmk8GZ39Px.gif 828w, https://miro.medium.com/v2/resize:fit:1100/0*c4yEMPAmk8GZ39Px.gif 1100w, https://miro.medium.com/v2/resize:fit:640/0*c4yEMPAmk8GZ39Px.gif 640w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 320px"/><img alt="" class="bh lo mu c" width="320" height="320" loading="lazy" role="presentation"/></picture></div><figcaption class="mv ff mw mh mi mx my bf b bg z du">Me, after seeing yet another QakBot variation</figcaption></figure><h1 id="96f1" class="mz na gu bf nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw bk">Initial Observation and Analysis of QakBot Malware</h1><p id="7061" class="pw-post-body-paragraph nx ny gu nz b oa ob oc od oe of og oh oi oj ok ol om on oo op oq or os ot ou gn bk">To accomplish my objective, I had to go beyond threat intelligence reports from security vendors and Atomic Red Team tests; I needed my own data created from real malware samples. I turned to an old favorite: malware-traffic-analysis.net by Brad Duncan (@malware_traffic). This site is among the most useful educational resources I have come across in security. In addition to Wireshark tutorials and hands-on network traffic exercises, the site offers quality analysis of real-world malware samples, including QakBot HTML smuggling files.</p><p id="0f3b" class="pw-post-body-paragraph nx ny gu nz b oa pk oc od oe pl og oh oi pm ok ol om pn oo op oq po os ot ou gn bk">After making snapshots of my lab VMs, I fired up my virtual detection lab and visited a recent entry. Be careful, the files hosted on this site are unsafe!</p><div class="qu qv qw qx qy qz"><a href="https://www.malware-traffic-analysis.net/2022/12/09/index.html?source=post_page-----5adefebb6841--------------------------------" rel="noopener  ugc nofollow" target="_blank"><div class="ra ab is"><div class="rb ab co cb rc rd"><h2 class="bf gv ij z qj re rf rg rh ri rj gt bk">Malware-Traffic-Analysis.net - 2022-12-09 - HTML smuggling leads to Qakbot, distribution/botnet…</h2><div class="rk l"><h3 class="bf b ij z qj re rf rg rh ri rj du">NOTES: The HTML file used for smuggling was posted to VirusTotal today, and create/modify dates for the disk image &amp;…</h3></div><div class="rl l"><p class="bf b dv z qj re rf rg rh ri rj du">www.malware-traffic-analysis.net</p></div></div><div class="rr l"><div class="rs l rt ru rv rr rw lo qz"></div></div></div></a></div><p id="f9c4" class="pw-post-body-paragraph nx ny gu nz b oa pk oc od oe pl og oh oi pm ok ol om pn oo op oq po os ot ou gn bk">I downloaded the artifacts zip file and extracted it to my downloads folder using the WinRAR utility built into my detection lab:</p><figure class="qd qe qf qg qh mp mh mi paragraph-image"><div role="button" tabindex="0" class="mq mr fj ms bh mt"><div class="mh mi rx"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*omXoSeRFe_vVHWoJXd3f8A.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*omXoSeRFe_vVHWoJXd3f8A.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*omXoSeRFe_vVHWoJXd3f8A.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*omXoSeRFe_vVHWoJXd3f8A.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*omXoSeRFe_vVHWoJXd3f8A.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*omXoSeRFe_vVHWoJXd3f8A.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*omXoSeRFe_vVHWoJXd3f8A.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*omXoSeRFe_vVHWoJXd3f8A.png 640w, https://miro.medium.com/v2/resize:fit:720/1*omXoSeRFe_vVHWoJXd3f8A.png 720w, https://miro.medium.com/v2/resize:fit:750/1*omXoSeRFe_vVHWoJXd3f8A.png 750w, https://miro.medium.com/v2/resize:fit:786/1*omXoSeRFe_vVHWoJXd3f8A.png 786w, https://miro.medium.com/v2/resize:fit:828/1*omXoSeRFe_vVHWoJXd3f8A.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*omXoSeRFe_vVHWoJXd3f8A.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*omXoSeRFe_vVHWoJXd3f8A.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"/><img alt="" class="bh lo mu c" width="700" height="364" loading="lazy" role="presentation"/></picture></div></div></figure><p id="218f" class="pw-post-body-paragraph nx ny gu nz b oa pk oc od oe pl og oh oi pm ok ol om pn oo op oq po os ot ou gn bk">The IOC notes were extremely helpful in giving context to the included files. Among the notes were the following, which let me know that the infection chain started with the HTML file, called SCAN_DT6281.html.</p><pre class="qd qe qf qg qh ry rz sa bp sb bb bk"><span id="1469" class="sc na gu rz b bg sd se l sf sg">2022-12-09 (FRIDAY) - HTML SMUGGLING FOR QAKBOT (QBOT) DISTRIBUTION TAG: AZD<br/><br/>DISTRIBUTION:<br/><br/>- Unknown source, possibly email --&gt; HTML file --&gt; password-protected zip archive --&gt; extracted ISO image with .img file extension</span></pre><p id="8871" class="pw-post-body-paragraph nx ny gu nz b oa pk oc od oe pl og oh oi pm ok ol om pn oo op oq po os ot ou gn bk">I opened the HTML file in Chrome browser and noticed an immediate zip file download (bottom left below):</p><figure class="qd qe qf qg qh mp mh mi paragraph-image"><div role="button" tabindex="0" class="mq mr fj ms bh mt"><div class="mh mi sh"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*vED27mk8J738r6_w_BBL6w.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*vED27mk8J738r6_w_BBL6w.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*vED27mk8J738r6_w_BBL6w.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*vED27mk8J738r6_w_BBL6w.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*vED27mk8J738r6_w_BBL6w.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*vED27mk8J738r6_w_BBL6w.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vED27mk8J738r6_w_BBL6w.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*vED27mk8J738r6_w_BBL6w.png 640w, https://miro.medium.com/v2/resize:fit:720/1*vED27mk8J738r6_w_BBL6w.png 720w, https://miro.medium.com/v2/resize:fit:750/1*vED27mk8J738r6_w_BBL6w.png 750w, https://miro.medium.com/v2/resize:fit:786/1*vED27mk8J738r6_w_BBL6w.png 786w, https://miro.medium.com/v2/resize:fit:828/1*vED27mk8J738r6_w_BBL6w.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*vED27mk8J738r6_w_BBL6w.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*vED27mk8J738r6_w_BBL6w.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"/><img alt="" class="bh lo mu c" width="700" height="335" loading="lazy" role="presentation"/></picture></div></div><figcaption class="mv ff mw mh mi mx my bf b bg z du">Seems legit</figcaption></figure><p id="0f59" class="pw-post-body-paragraph nx ny gu nz b oa pk oc od oe pl og oh oi pm ok ol om pn oo op oq po os ot ou gn bk"><em class="rm">…sure, let’s open up the zip file, why not?</em></p><p id="014a" class="pw-post-body-paragraph nx ny gu nz b oa pk oc od oe pl og oh oi pm ok ol om pn oo op oq po os ot ou gn bk">The zip file was password protected but could be opened using the password displayed on the HTML page. The zip file contained a single .img file, which I know to be another mountable disk image file format. Double-clicking this mounted the file as the D drive on my system:</p><figure class="qd qe qf qg qh mp mh mi paragraph-image"><div role="button" tabindex="0" class="mq mr fj ms bh mt"><div class="mh mi si"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*wU3Up7GGMha3qSGvVtlc2g.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*wU3Up7GGMha3qSGvVtlc2g.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*wU3Up7GGMha3qSGvVtlc2g.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*wU3Up7GGMha3qSGvVtlc2g.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*wU3Up7GGMha3qSGvVtlc2g.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*wU3Up7GGMha3qSGvVtlc2g.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wU3Up7GGMha3qSGvVtlc2g.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*wU3Up7GGMha3qSGvVtlc2g.png 640w, https://miro.medium.com/v2/resize:fit:720/1*wU3Up7GGMha3qSGvVtlc2g.png 720w, https://miro.medium.com/v2/resize:fit:750/1*wU3Up7GGMha3qSGvVtlc2g.png 750w, https://miro.medium.com/v2/resize:fit:786/1*wU3Up7GGMha3qSGvVtlc2g.png 786w, https://miro.medium.com/v2/resize:fit:828/1*wU3Up7GGMha3qSGvVtlc2g.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*wU3Up7GGMha3qSGvVtlc2g.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*wU3Up7GGMha3qSGvVtlc2g.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"/><img alt="" class="bh lo mu c" width="700" height="305" loading="lazy" role="presentation"/></picture></div></div><figcaption class="mv ff mw mh mi mx my bf b bg z du">The shortcut LNK (SCAN_DT6281) and hidden folder (IncomingPay)</figcaption></figure><p id="b262" class="pw-post-body-paragraph nx ny gu nz b oa pk oc od oe pl og oh oi pm ok ol om pn oo op oq po os ot ou gn bk">I also noticed a hidden directory called IncomingPay, which contained a .lnk file, two text files which contained (I kid you not) excerpts from the Wikipedia page on Psychology, a .cmd file 🤔, and a .lc file 🤷.</p><p id="40df" class="pw-post-body-paragraph nx ny gu nz b oa pk oc od oe pl og oh oi pm ok ol om pn oo op oq po os ot ou gn bk">As a security professional and dutiful watcher of corporate security awareness training, all of my 🚩🚩🚩 were up and waving in the breeze. But this is for science, so I take the bait and double-click the LNK file, just as the attacker wants the victim to do. 🎣 A command line window appears for a few seconds, then disappears:</p><figure class="qd qe qf qg qh mp mh mi paragraph-image"><div role="button" tabindex="0" class="mq mr fj ms bh mt"><div class="mh mi sj"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*uE61FK8e5VnRUAfJpCW0sA.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*uE61FK8e5VnRUAfJpCW0sA.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*uE61FK8e5VnRUAfJpCW0sA.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*uE61FK8e5VnRUAfJpCW0sA.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*uE61FK8e5VnRUAfJpCW0sA.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*uE61FK8e5VnRUAfJpCW0sA.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uE61FK8e5VnRUAfJpCW0sA.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*uE61FK8e5VnRUAfJpCW0sA.png 640w, https://miro.medium.com/v2/resize:fit:720/1*uE61FK8e5VnRUAfJpCW0sA.png 720w, https://miro.medium.com/v2/resize:fit:750/1*uE61FK8e5VnRUAfJpCW0sA.png 750w, https://miro.medium.com/v2/resize:fit:786/1*uE61FK8e5VnRUAfJpCW0sA.png 786w, https://miro.medium.com/v2/resize:fit:828/1*uE61FK8e5VnRUAfJpCW0sA.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*uE61FK8e5VnRUAfJpCW0sA.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*uE61FK8e5VnRUAfJpCW0sA.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"/><img alt="" class="bh lo mu c" width="700" height="367" loading="lazy" role="presentation"/></picture></div></div></figure><p id="c07a" class="pw-post-body-paragraph nx ny gu nz b oa pk oc od oe pl og oh oi pm ok ol om pn oo op oq po os ot ou gn bk">The LNK file target property is interesting:</p><pre class="qd qe qf qg qh ry rz sa bp sb bb bk"><span id="7069" class="sc na gu rz b bg sd se l sf sg">C:\Windows\System32\cmd.exe /c IncomingPay\Issues.cmd A B C D E F G H I J K L M N O P Q R S T U V W X Y Z 0 1 2 3 4 5 6 7 8 9</span></pre><p id="eda2" class="pw-post-body-paragraph nx ny gu nz b oa pk oc od oe pl og oh oi pm ok ol om pn oo op oq po os ot ou gn bk">This tells me that I’ve run the Issues.cmd file located in the IncomingPay directory using CMD, which is important to know for later. Now back in Splunk, I start running queries to see what is happening on my victim VM:</p><figure class="qd qe qf qg qh mp mh mi paragraph-image"><div role="button" tabindex="0" class="mq mr fj ms bh mt"><div class="mh mi sk"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*dJt2MIxLSklub6ZLxtHqig.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*dJt2MIxLSklub6ZLxtHqig.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*dJt2MIxLSklub6ZLxtHqig.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*dJt2MIxLSklub6ZLxtHqig.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*dJt2MIxLSklub6ZLxtHqig.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*dJt2MIxLSklub6ZLxtHqig.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dJt2MIxLSklub6ZLxtHqig.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*dJt2MIxLSklub6ZLxtHqig.png 640w, https://miro.medium.com/v2/resize:fit:720/1*dJt2MIxLSklub6ZLxtHqig.png 720w, https://miro.medium.com/v2/resize:fit:750/1*dJt2MIxLSklub6ZLxtHqig.png 750w, https://miro.medium.com/v2/resize:fit:786/1*dJt2MIxLSklub6ZLxtHqig.png 786w, https://miro.medium.com/v2/resize:fit:828/1*dJt2MIxLSklub6ZLxtHqig.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*dJt2MIxLSklub6ZLxtHqig.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*dJt2MIxLSklub6ZLxtHqig.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"/><img alt="" class="bh lo mu c" width="700" height="122" loading="lazy" role="presentation"/></picture></div></div><figcaption class="mv ff mw mh mi mx my bf b bg z du">Notice the commands logged immediately after I took the bait!</figcaption></figure><p id="1722" class="pw-post-body-paragraph nx ny gu nz b oa pk oc od oe pl og oh oi pm ok ol om pn oo op oq po os ot ou gn bk">How do I know what searches to run? I don’t really, but through my experience as an analyst and researcher I know that there are certain types of evidence that may appear in my logs — process executions, file creations, network connections, and the like. This is where on-the-job experience as a security analyst, or a good dose of CTF-style trainings (like those available at <a class="af qc" href="https://cyberdefenders.org/" rel="noopener ugc nofollow" target="_blank">CyberDefenders</a> or <a class="af qc" href="https://letsdefend.io/" rel="noopener ugc nofollow" target="_blank">LetsDefend</a>) come in handy.</p><p id="a9ed" class="pw-post-body-paragraph nx ny gu nz b oa pk oc od oe pl og oh oi pm ok ol om pn oo op oq po os ot ou gn bk">After refreshing my searches a few times and wondering if I had done something wrong, I noticed a definite, incontrovertible sign of an intrusion: a burst of recon activity on my victim host:</p><figure class="qd qe qf qg qh mp mh mi paragraph-image"><div role="button" tabindex="0" class="mq mr fj ms bh mt"><div class="mh mi sl"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*GvEUBnM24or7X8OioRTuaA.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*GvEUBnM24or7X8OioRTuaA.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*GvEUBnM24or7X8OioRTuaA.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*GvEUBnM24or7X8OioRTuaA.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*GvEUBnM24or7X8OioRTuaA.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*GvEUBnM24or7X8OioRTuaA.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*GvEUBnM24or7X8OioRTuaA.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*GvEUBnM24or7X8OioRTuaA.png 640w, https://miro.medium.com/v2/resize:fit:720/1*GvEUBnM24or7X8OioRTuaA.png 720w, https://miro.medium.com/v2/resize:fit:750/1*GvEUBnM24or7X8OioRTuaA.png 750w, https://miro.medium.com/v2/resize:fit:786/1*GvEUBnM24or7X8OioRTuaA.png 786w, https://miro.medium.com/v2/resize:fit:828/1*GvEUBnM24or7X8OioRTuaA.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*GvEUBnM24or7X8OioRTuaA.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*GvEUBnM24or7X8OioRTuaA.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"/><img alt="" class="bh lo mu c" width="700" height="257" loading="lazy" role="presentation"/></picture></div></div><figcaption class="mv ff mw mh mi mx my bf b bg z du">I forgot to include in the screenshot, but the parent process for all these commands was wermgr.exe (what???)</figcaption></figure><p id="501c" class="pw-post-body-paragraph nx ny gu nz b oa pk oc od oe pl og oh oi pm ok ol om pn oo op oq po os ot ou gn bk">As I was looking at these commands, I noted the time period in which they occurred — all within the span of a few seconds! Also, the processes were all spawned by an unusual parent —<a class="af qc" href="https://strontic.github.io/xcyclopedia/library/wermgr.exe-0F652BF7ADA772981E8AAB0D108FCC92.html" rel="noopener ugc nofollow" target="_blank"> wermgr.exe</a> (the Windows Error Reporting Manager). A good detection opportunity, perhaps? Event the most confused admin or overbuilt piece of [legit] software will not run all these suspicious recon commands within such a short timeframe, and <em class="rm">never</em> as children of a wermgr.exe. Swinging over to my network connections, I noticed that wermgr.exe had suddenly become extremely chatty with external IP addresses:</p><figure class="qd qe qf qg qh mp mh mi paragraph-image"><div role="button" tabindex="0" class="mq mr fj ms bh mt"><div class="mh mi sm"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*4z-NOmsooSXa8QEMpZpwvg.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*4z-NOmsooSXa8QEMpZpwvg.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*4z-NOmsooSXa8QEMpZpwvg.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*4z-NOmsooSXa8QEMpZpwvg.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*4z-NOmsooSXa8QEMpZpwvg.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*4z-NOmsooSXa8QEMpZpwvg.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*4z-NOmsooSXa8QEMpZpwvg.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*4z-NOmsooSXa8QEMpZpwvg.png 640w, https://miro.medium.com/v2/resize:fit:720/1*4z-NOmsooSXa8QEMpZpwvg.png 720w, https://miro.medium.com/v2/resize:fit:750/1*4z-NOmsooSXa8QEMpZpwvg.png 750w, https://miro.medium.com/v2/resize:fit:786/1*4z-NOmsooSXa8QEMpZpwvg.png 786w, https://miro.medium.com/v2/resize:fit:828/1*4z-NOmsooSXa8QEMpZpwvg.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*4z-NOmsooSXa8QEMpZpwvg.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*4z-NOmsooSXa8QEMpZpwvg.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"/><img alt="" class="bh lo mu c" width="700" height="366" loading="lazy" role="presentation"/></picture></div></div><figcaption class="mv ff mw mh mi mx my bf b bg z du">Uhhhhh………………</figcaption></figure><p id="757f" class="pw-post-body-paragraph nx ny gu nz b oa pk oc od oe pl og oh oi pm ok ol om pn oo op oq po os ot ou gn bk">Following this initial assessment of my data, I determined that:</p><ul class=""><li id="b936" class="nx ny gu nz b oa pk oc od oe pl og oh oi pm ok ol om pn oo op oq po os ot ou qm qn qo bk">The malware sample contained a malicious initial access vector (duh, the rogues gallery of the .html, .zip, .img, .lnk, .cmd, and .lc files).</li><li id="e5d7" class="nx ny gu nz b oa qp oc od oe qq og oh oi qr ok ol om qs oo op oq qt os ot ou qm qn qo bk">The malware would download the zip file after opening the HTML page in a browser, and the zip file contained a mountable .img file.</li><li id="9a98" class="nx ny gu nz b oa qp oc od oe qq og oh oi qr ok ol om qs oo op oq qt os ot ou qm qn qo bk">The mounted drive contained a malicious shortcut that would result in the execution of additional commands.</li><li id="a3c6" class="nx ny gu nz b oa qp oc od oe qq og oh oi qr ok ol om qs oo op oq qt os ot ou qm qn qo bk">An injected wermgr.exe process spawned an automated burst of recon activity and then connected to suspicious external IP addresses, presumably to send the attacker information about our system and network.</li></ul><p id="29d3" class="pw-post-body-paragraph nx ny gu nz b oa pk oc od oe pl og oh oi pm ok ol om pn oo op oq po os ot ou gn bk">In Mitre ATT&amp;CK terms, this all amounts to Initial Access, Defense Evasion, Discovery, and Command and Control. In other words: big oof.</p><figure class="qd qe qf qg qh mp mh mi paragraph-image"><div role="button" tabindex="0" class="mq mr fj ms bh mt"><div class="mh mi sn"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*nXvAlI7u5JM8xO0LdDq35g.jpeg 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*nXvAlI7u5JM8xO0LdDq35g.jpeg 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*nXvAlI7u5JM8xO0LdDq35g.jpeg 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*nXvAlI7u5JM8xO0LdDq35g.jpeg 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*nXvAlI7u5JM8xO0LdDq35g.jpeg 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*nXvAlI7u5JM8xO0LdDq35g.jpeg 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*nXvAlI7u5JM8xO0LdDq35g.jpeg 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*nXvAlI7u5JM8xO0LdDq35g.jpeg 640w, https://miro.medium.com/v2/resize:fit:720/1*nXvAlI7u5JM8xO0LdDq35g.jpeg 720w, https://miro.medium.com/v2/resize:fit:750/1*nXvAlI7u5JM8xO0LdDq35g.jpeg 750w, https://miro.medium.com/v2/resize:fit:786/1*nXvAlI7u5JM8xO0LdDq35g.jpeg 786w, https://miro.medium.com/v2/resize:fit:828/1*nXvAlI7u5JM8xO0LdDq35g.jpeg 828w, https://miro.medium.com/v2/resize:fit:1100/1*nXvAlI7u5JM8xO0LdDq35g.jpeg 1100w, https://miro.medium.com/v2/resize:fit:1400/1*nXvAlI7u5JM8xO0LdDq35g.jpeg 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"/><img alt="" class="bh lo mu c" width="700" height="477" loading="lazy" role="presentation"/></picture></div></div><figcaption class="mv ff mw mh mi mx my bf b bg z du">Rogues Gallery</figcaption></figure><h1 id="3ad6" class="mz na gu bf nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw bk">Breaking Down the Attack into Detection Building Blocks</h1><p id="0e45" class="pw-post-body-paragraph nx ny gu nz b oa ob oc od oe of og oh oi oj ok ol om on oo op oq or os ot ou gn bk">Having performed an initial execution of the QakBot HTML smuggling technique in the lab and reverted to my VM snapshots, it was time to dig further into the logs to see what was happening.</p><figure class="qd qe qf qg qh mp mh mi paragraph-image"><div class="mh mi so"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/0*nHIUWxrtQ-a1nA9A.jpg 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/0*nHIUWxrtQ-a1nA9A.jpg 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/0*nHIUWxrtQ-a1nA9A.jpg 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/0*nHIUWxrtQ-a1nA9A.jpg 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/0*nHIUWxrtQ-a1nA9A.jpg 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/0*nHIUWxrtQ-a1nA9A.jpg 1100w, https://miro.medium.com/v2/resize:fit:1218/format:webp/0*nHIUWxrtQ-a1nA9A.jpg 1218w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 609px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/0*nHIUWxrtQ-a1nA9A.jpg 640w, https://miro.medium.com/v2/resize:fit:720/0*nHIUWxrtQ-a1nA9A.jpg 720w, https://miro.medium.com/v2/resize:fit:750/0*nHIUWxrtQ-a1nA9A.jpg 750w, https://miro.medium.com/v2/resize:fit:786/0*nHIUWxrtQ-a1nA9A.jpg 786w, https://miro.medium.com/v2/resize:fit:828/0*nHIUWxrtQ-a1nA9A.jpg 828w, https://miro.medium.com/v2/resize:fit:1100/0*nHIUWxrtQ-a1nA9A.jpg 1100w, https://miro.medium.com/v2/resize:fit:1218/0*nHIUWxrtQ-a1nA9A.jpg 1218w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 609px"/><img alt="" class="bh lo mu c" width="609" height="410" loading="lazy" role="presentation"/></picture></div></figure><p id="452e" class="pw-post-body-paragraph nx ny gu nz b oa pk oc od oe pl og oh oi pm ok ol om pn oo op oq po os ot ou gn bk">As I reviewed the various types of events generated by the attack, I began to develop a plain-language narrative understanding of what was happening:</p><blockquote class="rn ro rp"><p id="d227" class="nx ny rm nz b oa pk oc od oe pl og oh oi pm ok ol om pn oo op oq po os ot ou gn bk">“An attacker <strong class="nz gv">sends</strong> a victim an HTML file that purports to contain a report, invoice, or other document of interest to them. Basically, a phishing lure. When the victim <strong class="nz gv">opens the file</strong> in their browser, embedded JavaScript code executes, which <strong class="nz gv">downloads or builds a password-protected zip file</strong> on the victim’s system. When the victim <strong class="nz gv">unzips the archive</strong>, the extraction <strong class="nz gv">creates a mountable</strong> disk image file. After <strong class="nz gv">mounting the drive</strong>, the user sees a shortcut that they believe will take them to the resource they are trying to find. But the shortcut actually calls a command or scripting interpreter that <strong class="nz gv">executes other malicious files </strong>that are hidden on the disk drive, leading to initial access compromise.”</p></blockquote><p id="a04e" class="pw-post-body-paragraph nx ny gu nz b oa pk oc od oe pl og oh oi pm ok ol om pn oo op oq po os ot ou gn bk">That’s a wordy chunk of prose right there, but it makes sense in my head. If I am going to detect something, I need to understand it first! Note the bold text: I used my narrative to highlight events that I could use to detect the attack chain. Based on this review, I analyzed the logs from the attack, trying to isolate the following events:</p><ol class=""><li id="d78f" class="nx ny gu nz b oa pk oc od oe pl og oh oi pm ok ol om pn oo op oq po os ot ou sp qn qo bk">Phishing email sent to victim containing an HTML attachment.</li><li id="0025" class="nx ny gu nz b oa qp oc od oe qq og oh oi qr ok ol om qs oo op oq qt os ot ou sp qn qo bk">Creation of an HTML file in suspicious locations.</li><li id="d8bf" class="nx ny gu nz b oa qp oc od oe qq og oh oi qr ok ol om qs oo op oq qt os ot ou sp qn qo bk">Opening of a stand-alone HTML file in a browser application.</li><li id="6cf8" class="nx ny gu nz b oa qp oc od oe qq og oh oi qr ok ol om qs oo op oq qt os ot ou sp qn qo bk">Download/creation of a zip file by the browser application.</li><li id="9fe5" class="nx ny gu nz b oa qp oc od oe qq og oh oi qr ok ol om qs oo op oq qt os ot ou sp qn qo bk">Opening/extraction of a password-protected zip file.</li><li id="de0f" class="nx ny gu nz b oa qp oc od oe qq og oh oi qr ok ol om qs oo op oq qt os ot ou sp qn qo bk">Creation of a mountable disk drive file format (.iso, .img, etc).</li><li id="5441" class="nx ny gu nz b oa qp oc od oe qq og oh oi qr ok ol om qs oo op oq qt os ot ou sp qn qo bk">Mounting a drive.</li><li id="1cd6" class="nx ny gu nz b oa qp oc od oe qq og oh oi qr ok ol om qs oo op oq qt os ot ou sp qn qo bk">Process execution on an external drive (either from an executable on that drive, or system executable touching files on that drive).</li></ol><p id="2a9d" class="pw-post-body-paragraph nx ny gu nz b oa pk oc od oe pl og oh oi pm ok ol om pn oo op oq po os ot ou gn bk">Whew! That’s…a lot of events.</p><h2 id="d2ea" class="ov na gu bf nb ow ox dy nf oy oz ea nj oi pa pb pc om pd pe pf oq pg ph pi pj bk">The Good News</h2><p id="4ba5" class="pw-post-body-paragraph nx ny gu nz b oa ob oc od oe of og oh oi oj ok ol om on oo op oq or os ot ou gn bk">The good news was, there are ways to detect nearly every event listed above! This means I had numerous ideas for how to query and filter available logs to extract the meaningful events (building blocks) for future detections.</p><h2 id="0b25" class="ov na gu bf nb ow ox dy nf oy oz ea nj oi pa pb pc om pd pe pf oq pg ph pi pj bk">The Bad News</h2><p id="b677" class="pw-post-body-paragraph nx ny gu nz b oa ob oc od oe of og oh oi oj ok ol om on oo op oq or os ot ou gn bk">The bad news was, none of these many events is, on its own, malicious. Again, there is no YOU HAVE BEEN HACKED log: each one of these events could occur in the course of normal business and be completely safe and benign. The solution would be to correlate these events, in an ordered or unordered sequence, grouping them by a common attribute like hostname, and triggering an alert when all of these occur within a time window, like an hour. The problem is, from my analysis and testing (more on that in a moment), chaining or <em class="rm">correlating</em> that many events would result in a brittle detection.</p><h2 id="499c" class="ov na gu bf nb ow ox dy nf oy oz ea nj oi pa pb pc om pd pe pf oq pg ph pi pj bk">Brittle vs. Resilient</h2><p id="d794" class="pw-post-body-paragraph nx ny gu nz b oa ob oc od oe of og oh oi oj ok ol om on oo op oq or os ot ou gn bk">“Brittleness” describes the degree to which a detection idea falls apart in the face of subtle changes to attacker techniques, variations in actions performed by the victim, problems with logging, or other factors outside of our control. Brittle detections contrast with “resilient” detections, which are flexible and can withstand these subtle shifts.</p><p id="4a73" class="pw-post-body-paragraph nx ny gu nz b oa pk oc od oe pl og oh oi pm ok ol om pn oo op oq po os ot ou gn bk">It’s not as simple as saying “Brittle = bad and resilient = good.” A brittle detection could be highly-targeted, with a narrow “aperture.” The advantage could be that, if a brittle detection rule fires, there is a very high probability that it is a true positive. Resilient detections may have a wider aperture and may match more potential malicious activity. However, this could lead to false positives and a frustrated SOC if they are not developed with care.</p><p id="96f3" class="pw-post-body-paragraph nx ny gu nz b oa pk oc od oe pl og oh oi pm ok ol om pn oo op oq po os ot ou gn bk">With this in mind, I returned to my list of events from above.</p><h2 id="dfd6" class="ov na gu bf nb ow ox dy nf oy oz ea nj oi pa pb pc om pd pe pf oq pg ph pi pj bk">Determining the Building Blocks to Test</h2><p id="8ff4" class="pw-post-body-paragraph nx ny gu nz b oa ob oc od oe of og oh oi oj ok ol om on oo op oq or os ot ou gn bk">In context, I realized that items one through three in the list above may not be good components of my HTML Smuggling detection. Lack of visibility and a high volume of innocent behavior would hinder item 1. I struck item two because I had limited ability to test this event, and item three proved unreliable depending on which browser I used. Plus, while not technically HTML Smuggling, a lot of QakBot activity uses URLs, rather than stand-alone HTML files, to deliver the initial payload.</p><p id="1ee9" class="pw-post-body-paragraph nx ny gu nz b oa pk oc od oe pl og oh oi pm ok ol om pn oo op oq po os ot ou gn bk">Item five (extraction of a password-protected zip file) has lots of potential, and can be detected using <a class="af qc" href="https://github.com/SigmaHQ/sigma/blob/master/rules/windows/builtin/security/win_security_susp_opened_encrypted_zip.yml" rel="noopener ugc nofollow" target="_blank">this rule</a> written by Florian Roth and inspired by the research of <a class="af qc" href="https://twitter.com/SBousseaden" rel="noopener ugc nofollow" target="_blank">@SBousseaden</a>. However, I left it out of my scope because 1) that event was not logging in my lab and 2) some documentation indicates that it is only applicable to certain operating systems.</p><p id="ee12" class="pw-post-body-paragraph nx ny gu nz b oa pk oc od oe pl og oh oi pm ok ol om pn oo op oq po os ot ou gn bk">After exploring my data, enumerating possible detection building blocks for my correlation, and winnowing that list down based on further analysis, I had the following building blocks:</p><ol class=""><li id="cb2d" class="nx ny gu nz b oa pk oc od oe pl og oh oi pm ok ol om pn oo op oq po os ot ou sp qn qo bk"><a class="af qc" href="https://github.com/mbabinski/Sigma-Rules/blob/main/2022_HTMLSmuggling/1_win_zipfile_drop.yml" rel="noopener ugc nofollow" target="_blank">Web Browser Creates (Downloads) Zip Archive File (represents opening the malicious HTML file in a browser).</a></li><li id="9406" class="nx ny gu nz b oa qp oc od oe qq og oh oi qr ok ol om qs oo op oq qt os ot ou sp qn qo bk"><a class="af qc" href="https://github.com/mbabinski/Sigma-Rules/blob/main/2022_HTMLSmuggling/2_win_susp_file_extraction.yml" rel="noopener ugc nofollow" target="_blank">ISO, VHD, LNK or IMG File Extracted from Zip (extracting the malicious disk image file).</a></li><li id="0dc5" class="nx ny gu nz b oa qp oc od oe qq og oh oi qr ok ol om qs oo op oq qt os ot ou sp qn qo bk"><a class="af qc" href="https://github.com/mbabinski/Sigma-Rules/blob/main/2022_HTMLSmuggling/3_win_security_iso_mount.yml" rel="noopener ugc nofollow" target="_blank">Disk Image Mount (mounting the image — this one I pulled directly from Sigma).</a></li><li id="968b" class="nx ny gu nz b oa qp oc od oe qq og oh oi qr ok ol om qs oo op oq qt os ot ou sp qn qo bk"><a class="af qc" href="https://github.com/mbabinski/Sigma-Rules/blob/main/2022_HTMLSmuggling/4_win_process_creation_ext_drive.yml" rel="noopener ugc nofollow" target="_blank">Suspicious User-Initiated Process Execution on External Drive (clicking the .lnk file which runs or references files on the external drive).</a></li></ol><p id="7194" class="pw-post-body-paragraph nx ny gu nz b oa pk oc od oe pl og oh oi pm ok ol om pn oo op oq po os ot ou gn bk">With these building block concepts in place, I wrote or adapted a query and Sigma rule for each one, then correlated them into a chain rule.</p><h1 id="d934" class="mz na gu bf nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw bk">Sigma Correlations</h1><p id="a065" class="pw-post-body-paragraph nx ny gu nz b oa ob oc od oe of og oh oi oj ok ol om on oo op oq or os ot ou gn bk">Correlation allows us to track log events through time. Rather than triggering an alert for each of the four events listed above, a chain rule correlation allows us to alert only when all four events occur in order on the same host by the same user, which is much more suspicious. Many SIEM products and their corresponding query languages support this type of chaining (although some do not).</p><p id="6db6" class="pw-post-body-paragraph nx ny gu nz b oa pk oc od oe pl og oh oi pm ok ol om pn oo op oq po os ot ou gn bk">To support this functionality, Sigma has a Correlations standard in progress that will allow us to write custom correlation rules in a common format then convert them to whatever SIEM product supports this logic. The draft standard can be reviewed here:</p><div class="qu qv qw qx qy qz"><a href="https://github.com/SigmaHQ/sigma-specification/blob/main/wip/Sigma_Correlations.md?source=post_page-----5adefebb6841--------------------------------#temporal-proximity-temporal" rel="noopener  ugc nofollow" target="_blank"><div class="ra ab is"><div class="rb ab co cb rc rd"><h2 class="bf gv ij z qj re rf rg rh ri rj gt bk">sigma-specification/Sigma_Correlations.md at main · SigmaHQ/sigma-specification</h2><div class="rk l"><h3 class="bf b ij z qj re rf rg rh ri rj du">Sigma correlations is a new YAML-based extension that allows the expression of aggregations and relationships between…</h3></div><div class="rl l"><p class="bf b dv z qj re rf rg rh ri rj du">github.com</p></div></div><div class="rr l"><div class="sq l rt ru rv rr rw lo qz"></div></div></div></a></div><p id="df6d" class="pw-post-body-paragraph nx ny gu nz b oa pk oc od oe pl og oh oi pm ok ol om pn oo op oq po os ot ou gn bk">What might this look like? <strong class="nz gv">It’s a draft standard, and subject to change</strong>, but a simple example of a brute force chain rule might look like this:</p><pre class="qd qe qf qg qh ry rz sa bp sb bb bk"><span id="ceed" class="sc na gu rz b bg sd se l sf sg">action: correlation<br/>type: temporal<br/>rule:<br/>    - many_failed_logins<br/>    - successful_login<br/>group-by:<br/>    - User<br/>timespan: 1h<br/>ordered: true</span></pre><p id="f93e" class="pw-post-body-paragraph nx ny gu nz b oa pk oc od oe pl og oh oi pm ok ol om pn oo op oq po os ot ou gn bk">When the rule query “many_failed_logins” is matched followed by the “successful_login” rule within a one hour window, the correlation rule will fire. For a good example of a SIEM product that supports correlations, check out <a class="af qc" href="https://help.sumologic.com/docs/cse/rules/write-chain-rule/#:~:text=About%20Chain%20rules%E2%80%8B&amp;text=In%20a%20Chain%20rule%20you,rule%20expressions%20in%20the%20rule." rel="noopener ugc nofollow" target="_blank">SumoLogic chain rules</a>.</p><p id="596c" class="pw-post-body-paragraph nx ny gu nz b oa pk oc od oe pl og oh oi pm ok ol om pn oo op oq po os ot ou gn bk">My draft correlations rule looks like this:</p><pre class="qd qe qf qg qh ry rz sa bp sb bb bk"><span id="27f5" class="sc na gu rz b bg sd se l sf sg">title: HTML Smuggling Activity - Chain Rule<br/>id: 0952f2fa-e29b-4eb5-831c-ce21520c56e3<br/>status: experimental<br/>description: Detects HTML smuggling-style compromise (such as HTML &gt; ZIP &gt; ISO/IMG/VHD &gt; CMD/BAT/VBS &gt; DLL). Includes rules to detect zipfile dropped by browser, ISO/IMG/VHD/LNK file extraction, disk image mount, followed by user-initiated process creation on an external drive.<br/>references:<br/>    - https://blog.talosintelligence.com/html-smugglers-turn-to-svg-images/#:~:text=HTML%20smuggling%20is%20a%20technique,directly%20on%20the%20victim&#x27;s%20device.<br/>    - https://www.malwarebytes.com/blog/news/2021/11/evasive-maneuvers-html-smuggling-explained<br/>    - Original research and analysis performed off of QakBot intelligence gathered at https://github.com/pr0xylife/Qakbot, https://www.malware-traffic-analysis.net/, and https://github.com/executemalware/Malware-IOCs<br/>author: Micah Babinski<br/>date: 2022/12/27<br/>tags:<br/>    - attack.s0650<br/>    - attack.s0483<br/>    - attack.initial_access<br/>    - attack.defense_evasion<br/>    - attack.execution<br/>    - attack.t1564<br/>    - attack.t1566.001<br/>    - attack.t1566<br/>    - attack.t1027<br/>    - attack.t1027.006<br/>    - attack.t1059<br/>    - attack.t1204<br/>    - attack.t1204.002<br/>action: correlation<br/>type: temporal<br/>rule:<br/>    - 1_win_zipfile_drop.yml<br/>    - 2_win_susp_file_extraction.yml<br/>    - 3_win_security_iso_mount.yml<br/>    - 4_win_process_creation_ext_drive.yml<br/>group-by:<br/>    - ComputerName<br/>    - User<br/>timespan: 1h<br/>ordered: true<br/>falsepositives:<br/>    - Unknown<br/>level: high</span></pre><p id="3bfd" class="pw-post-body-paragraph nx ny gu nz b oa pk oc od oe pl og oh oi pm ok ol om pn oo op oq po os ot ou gn bk">This looks like many other Sigma rules you may have seen before, but has some unique elements. The action and type statements let you know this is a correlation rule of the temporal type. The four <strong class="nz gv">rules</strong> listed show the component rules in scope (these must be in the same directory as the correlation). The <strong class="nz gv">timespan</strong> specifies that the four participating rules must fire within one hour of each other, and the <strong class="nz gv">group-by</strong> statement defines fields in the rules which relate them to each other. Finally, the <strong class="nz gv">ordered: true</strong> statement lets Sigma know that these rules should occur in sequence.</p><blockquote class="rn ro rp"><p id="44c3" class="nx ny rm nz b oa pk oc od oe pl og oh oi pm ok ol om pn oo op oq po os ot ou gn bk">Again, the Sigma Correlations specification is in development, and is subject to change. Still, this will be a very useful expansion of Sigma’s capabilities, so I wanted to preview it for you now!</p></blockquote><h1 id="0aa6" class="mz na gu bf nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw bk">Testing the Correlation</h1><p id="607b" class="pw-post-body-paragraph nx ny gu nz b oa ob oc od oe of og oh oi oj ok ol om on oo op oq or os ot ou gn bk">With this detection concept taking shape, and a hypothesis developed in the form of my correlation rule, it was time to test the detection with a larger sample size. I relied on the MalwareBazaar repository from Abuse.ch, which provides a helpful library of tagged malware samples. I downloaded 10 QakBot HTML samples, mostly reported by pr0xylife, ranging in date first seen from July 11 to December 22, 2022. I prepared the samples on my lab VM, and named each one according to its first seen date and its “humanhash” property (a random, unique sequence of human-readable words, such as (“dakota-earth-mockingbird-march”):</p><figure class="qd qe qf qg qh mp mh mi paragraph-image"><div role="button" tabindex="0" class="mq mr fj ms bh mt"><div class="mh mi sr"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*m86g4e3G5O47pk_O7Qiz0Q.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*m86g4e3G5O47pk_O7Qiz0Q.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*m86g4e3G5O47pk_O7Qiz0Q.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*m86g4e3G5O47pk_O7Qiz0Q.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*m86g4e3G5O47pk_O7Qiz0Q.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*m86g4e3G5O47pk_O7Qiz0Q.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*m86g4e3G5O47pk_O7Qiz0Q.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*m86g4e3G5O47pk_O7Qiz0Q.png 640w, https://miro.medium.com/v2/resize:fit:720/1*m86g4e3G5O47pk_O7Qiz0Q.png 720w, https://miro.medium.com/v2/resize:fit:750/1*m86g4e3G5O47pk_O7Qiz0Q.png 750w, https://miro.medium.com/v2/resize:fit:786/1*m86g4e3G5O47pk_O7Qiz0Q.png 786w, https://miro.medium.com/v2/resize:fit:828/1*m86g4e3G5O47pk_O7Qiz0Q.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*m86g4e3G5O47pk_O7Qiz0Q.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*m86g4e3G5O47pk_O7Qiz0Q.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"/><img alt="" class="bh lo mu c" width="700" height="382" loading="lazy" role="presentation"/></picture></div></div><figcaption class="mv ff mw mh mi mx my bf b bg z du">My 10 lovely HTML smuggling samples all ready to test</figcaption></figure><p id="75f3" class="pw-post-body-paragraph nx ny gu nz b oa pk oc od oe pl og oh oi pm ok ol om pn oo op oq po os ot ou gn bk">To track my results, I made a simple table in Google Sheets:</p><figure class="qd qe qf qg qh mp mh mi paragraph-image"><div role="button" tabindex="0" class="mq mr fj ms bh mt"><div class="mh mi ss"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*3xHm84vu77udS0JgtMRMaw.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*3xHm84vu77udS0JgtMRMaw.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*3xHm84vu77udS0JgtMRMaw.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*3xHm84vu77udS0JgtMRMaw.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*3xHm84vu77udS0JgtMRMaw.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*3xHm84vu77udS0JgtMRMaw.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*3xHm84vu77udS0JgtMRMaw.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*3xHm84vu77udS0JgtMRMaw.png 640w, https://miro.medium.com/v2/resize:fit:720/1*3xHm84vu77udS0JgtMRMaw.png 720w, https://miro.medium.com/v2/resize:fit:750/1*3xHm84vu77udS0JgtMRMaw.png 750w, https://miro.medium.com/v2/resize:fit:786/1*3xHm84vu77udS0JgtMRMaw.png 786w, https://miro.medium.com/v2/resize:fit:828/1*3xHm84vu77udS0JgtMRMaw.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*3xHm84vu77udS0JgtMRMaw.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*3xHm84vu77udS0JgtMRMaw.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"/><img alt="" class="bh lo mu c" width="700" height="147" loading="lazy" role="presentation"/></picture></div></div></figure><p id="915e" class="pw-post-body-paragraph nx ny gu nz b oa pk oc od oe pl og oh oi pm ok ol om pn oo op oq po os ot ou gn bk">I made a clean, pre-test snapshot of my victim VM host to revert back to after each test, and started in on the test. After testing seven of the ten samples, my sequence of four building blocks had perfect coverage! When I hit the eighth sample, however, the fourth rule in the chain did not fire, because the .lnk file called RunDLL32.exe directly, instead of cmd.exe or wscript.exe. This was fine — I simply made an adjustment to the conditions of my Sigma rule, retested, and got perfect matches! I was delighted with the results and excited to share the detection use case with the community.</p><h2 id="a3e0" class="ov na gu bf nb ow ox dy nf oy oz ea nj oi pa pb pc om pd pe pf oq pg ph pi pj bk">Bonus Round!</h2><p id="fe9d" class="pw-post-body-paragraph nx ny gu nz b oa ob oc od oe of og oh oi oj ok ol om on oo op oq or os ot ou gn bk">Many QakBot phishing attacks do not use .html attachments, but instead use malicious .pdf files with embedded links, or just good old-fashioned phishing links that point to zip files hosted on a compromised website. To test whether my detection was flexible enough to catch these instances as well, I tested them on a couple of recent examples from the IOC repository maintained by @ExecuteMalware, and found that these URL-based driveby attacks were also caught by the detection. The one documented here even included a .wsf (Windows Script File) — a file type with which I was unfamiliar but was nonetheless caught by my detection.</p><figure class="qd qe qf qg qh mp mh mi paragraph-image"><div role="button" tabindex="0" class="mq mr fj ms bh mt"><div class="mh mi st"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*biWXEKLHEEun4BZ2LrL7dg.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*biWXEKLHEEun4BZ2LrL7dg.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*biWXEKLHEEun4BZ2LrL7dg.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*biWXEKLHEEun4BZ2LrL7dg.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*biWXEKLHEEun4BZ2LrL7dg.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*biWXEKLHEEun4BZ2LrL7dg.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*biWXEKLHEEun4BZ2LrL7dg.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*biWXEKLHEEun4BZ2LrL7dg.png 640w, https://miro.medium.com/v2/resize:fit:720/1*biWXEKLHEEun4BZ2LrL7dg.png 720w, https://miro.medium.com/v2/resize:fit:750/1*biWXEKLHEEun4BZ2LrL7dg.png 750w, https://miro.medium.com/v2/resize:fit:786/1*biWXEKLHEEun4BZ2LrL7dg.png 786w, https://miro.medium.com/v2/resize:fit:828/1*biWXEKLHEEun4BZ2LrL7dg.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*biWXEKLHEEun4BZ2LrL7dg.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*biWXEKLHEEun4BZ2LrL7dg.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"/><img alt="" class="bh lo mu c" width="700" height="233" loading="lazy" role="presentation"/></picture></div></div><figcaption class="mv ff mw mh mi mx my bf b bg z du">Windows Script File (.wsf) Delivered During a Recent QakBot Attack</figcaption></figure><p id="6aff" class="pw-post-body-paragraph nx ny gu nz b oa pk oc od oe pl og oh oi pm ok ol om pn oo op oq po os ot ou gn bk">Hooray for resilience!</p><h1 id="68d9" class="mz na gu bf nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq nr ns nt nu nv nw bk">Conclusion</h1><p id="367a" class="pw-post-body-paragraph nx ny gu nz b oa ob oc od oe of og oh oi oj ok ol om on oo op oq or os ot ou gn bk">Congratulations! You’ve reached the end of a lengthy post about some dense, complicated topics. You can find all the rules referenced <a class="af qc" href="https://github.com/mbabinski/Sigma-Rules/tree/main/2022_HTMLSmuggling" rel="noopener ugc nofollow" target="_blank">here</a>. Thank you for reading, and I hope you’ve enjoyed my ramblings on QakBot, HTML Smuggling, Sigma, and correlations. I am truly excited for Sigma Correlations to launch. It will be a big win for the detection engineering community and will allow us to share more sophisticated detection use cases.</p><p id="6b08" class="pw-post-body-paragraph nx ny gu nz b oa pk oc od oe pl og oh oi pm ok ol om pn oo op oq po os ot ou gn bk">I was really pleased with how my tests went, particularly when it showed that one of the building blocks in my chain rule had failed and needed adjustment! After all, why test if you think your work is already perfect? Lastly, this experience drove home for me what I had already started to believe — that we can’t detect what we don’t understand. There’s no substitute for first-hand experience with real live malware if you are trying to see what it does.</p><p id="b9a4" class="pw-post-body-paragraph nx ny gu nz b oa pk oc od oe pl og oh oi pm ok ol om pn oo op oq po os ot ou gn bk">Thanks to the Detection Lab project that I’ve enthused about in previous posts, this real-life experience is in reach for more people than ever. Lastly, thanks to pr0xylife, Brad (malware_traffic), and executemalware for providing pristine repositories of well-documented QakBot malware samples for us to access, analyze, and understand. These are truly an educational treasure trove!</p><p id="6054" class="pw-post-body-paragraph nx ny gu nz b oa pk oc od oe pl og oh oi pm ok ol om pn oo op oq po os ot ou gn bk">Please feel free to send me ideas, comments, or suggestions on how I can improve. I am still new to this, and I welcome respectful feedback and critique in any form.</p><p id="dbe3" class="pw-post-body-paragraph nx ny gu nz b oa pk oc od oe pl og oh oi pm ok ol om pn oo op oq po os ot ou gn bk">As always, happy analyzing! 🧐</p></div></div></div></div></section></div></div></article></div><div class="ab cb"><div class="ci bh fz ga gb gc"><div class="su sv ab iv"><div class="rk ab"><a class="sw ay am ao" href="https://medium.com/tag/cybersecurity?source=post_page-----5adefebb6841--------------------------------" rel="noopener follow"><div class="sx fj cx sy ge sz ta bf b bg z bk tb">Cybersecurity</div></a></div><div class="rk ab"><a class="sw ay am ao" href="https://medium.com/tag/malware?source=post_page-----5adefebb6841--------------------------------" rel="noopener follow"><div class="sx fj cx sy ge sz ta bf b bg z bk tb">Malware</div></a></div><div class="rk ab"><a class="sw ay am ao" href="https://medium.com/tag/detection-engineering?source=post_page-----5adefebb6841--------------------------------" rel="noopener follow"><div class="sx fj cx sy ge sz ta bf b bg z bk tb">Detection Engineering</div></a></div><div class="rk ab"><a class="sw ay am ao" href="https://medium.com/tag/information-security?source=post_page-----5adefebb6841--------------------------------" rel="noopener follow"><div class="sx fj cx sy ge sz ta bf b bg z bk tb">Information Security</div></a></div><div class="rk ab"><a class="sw ay am ao" href="https://medium.com/tag/threat-intelligence?source=post_page-----5adefebb6841--------------------------------" rel="noopener follow"><div class="sx fj cx sy ge sz ta bf b bg z bk tb">Threat Intelligence</div></a></div></div></div></div><div class="l"></div><footer class="tc pq td te tf ab q tg th c"><div class="l ae"><div class="ab cb"><div class="ci bh fz ga gb gc"><div class="ab cp ti"><div class="ab q ke"><div class="tj l"><span class="l tk tl tm e d"><div class="ab q ke kf"><div class="pw-multi-vote-icon fj kg kh ki kj"><span><a class="af ag ah ai aj ak al am an ao ap aq ar as at" data-testid="footerClapButton" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Fp%2F5adefebb6841&amp;operation=register&amp;redirect=https%3A%2F%2Fmicahbabinski.medium.com%2Fhtml-smuggling-detection-5adefebb6841&amp;user=Micah+Babinski&amp;userId=47a061e2b431&amp;source=---footer_actions--5adefebb6841---------------------clap_footer-----------" rel="noopener follow"><div><div class="bm" aria-hidden="false"><div class="kk ao kl km kn ko am kp kq kr kj"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM13.916 3.953l1.523-2.112-1.184-.39zM8.589 1.84l1.522 2.112-.337-2.501zM18.523 18.92c-.86.86-1.75 1.246-2.62 1.33a6 6 0 0 0 .407-.372c2.388-2.389 2.86-4.951 1.399-7.623l-.912-1.603-.79-1.672c-.26-.56-.194-.98.203-1.288a.7.7 0 0 1 .546-.132c.283.046.546.231.728.5l2.363 4.157c.976 1.624 1.141 4.237-1.324 6.702m-10.999-.438L3.37 14.328a.828.828 0 0 1 .585-1.408.83.83 0 0 1 .585.242l2.158 2.157a.365.365 0 0 0 .516-.516l-2.157-2.158-1.449-1.449a.826.826 0 0 1 1.167-1.17l3.438 3.44a.363.363 0 0 0 .516 0 .364.364 0 0 0 0-.516L5.293 9.513l-.97-.97a.826.826 0 0 1 0-1.166.84.84 0 0 1 1.167 0l.97.968 3.437 3.436a.36.36 0 0 0 .517 0 .366.366 0 0 0 0-.516L6.977 7.83a.82.82 0 0 1-.241-.584.82.82 0 0 1 .824-.826c.219 0 .43.087.584.242l5.787 5.787a.366.366 0 0 0 .587-.415l-1.117-2.363c-.26-.56-.194-.98.204-1.289a.7.7 0 0 1 .546-.132c.283.046.545.232.727.501l2.193 3.86c1.302 2.38.883 4.59-1.277 6.75-1.156 1.156-2.602 1.627-4.19 1.367-1.418-.236-2.866-1.033-4.079-2.246M10.75 5.971l2.12 2.12c-.41.502-.465 1.17-.128 1.89l.22.465-3.523-3.523a.8.8 0 0 1-.097-.368c0-.22.086-.428.241-.584a.847.847 0 0 1 1.167 0m7.355 1.705c-.31-.461-.746-.758-1.23-.837a1.44 1.44 0 0 0-1.11.275c-.312.24-.505.543-.59.881a1.74 1.74 0 0 0-.906-.465 1.47 1.47 0 0 0-.82.106l-2.182-2.182a1.56 1.56 0 0 0-2.2 0 1.54 1.54 0 0 0-.396.701 1.56 1.56 0 0 0-2.21-.01 1.55 1.55 0 0 0-.416.753c-.624-.624-1.649-.624-2.237-.037a1.557 1.557 0 0 0 0 2.2c-.239.1-.501.238-.715.453a1.56 1.56 0 0 0 0 2.2l.516.515a1.556 1.556 0 0 0-.753 2.615L7.01 19c1.32 1.319 2.909 2.189 4.475 2.449q.482.08.971.08c.85 0 1.653-.198 2.393-.579.231.033.46.054.686.054 1.266 0 2.457-.52 3.505-1.567 2.763-2.763 2.552-5.734 1.439-7.586z" clip-rule="evenodd"></path></svg></div></div></div></a></span></div><div class="pw-multi-vote-count l ks kt ku kv kw kx ky"><p class="bf b dv z du"><span class="kz">--</span></p></div></div></span><span class="l h g f tn to"><div class="ab q ke kf"><div class="pw-multi-vote-icon fj kg kh ki kj"><span><a class="af ag ah ai aj ak al am an ao ap aq ar as at" data-testid="footerClapButton" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Fp%2F5adefebb6841&amp;operation=register&amp;redirect=https%3A%2F%2Fmicahbabinski.medium.com%2Fhtml-smuggling-detection-5adefebb6841&amp;user=Micah+Babinski&amp;userId=47a061e2b431&amp;source=---footer_actions--5adefebb6841---------------------clap_footer-----------" rel="noopener follow"><div><div class="bm" aria-hidden="false"><div class="kk ao kl km kn ko am kp kq kr kj"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM13.916 3.953l1.523-2.112-1.184-.39zM8.589 1.84l1.522 2.112-.337-2.501zM18.523 18.92c-.86.86-1.75 1.246-2.62 1.33a6 6 0 0 0 .407-.372c2.388-2.389 2.86-4.951 1.399-7.623l-.912-1.603-.79-1.672c-.26-.56-.194-.98.203-1.288a.7.7 0 0 1 .546-.132c.283.046.546.231.728.5l2.363 4.157c.976 1.624 1.141 4.237-1.324 6.702m-10.999-.438L3.37 14.328a.828.828 0 0 1 .585-1.408.83.83 0 0 1 .585.242l2.158 2.157a.365.365 0 0 0 .516-.516l-2.157-2.158-1.449-1.449a.826.826 0 0 1 1.167-1.17l3.438 3.44a.363.363 0 0 0 .516 0 .364.364 0 0 0 0-.516L5.293 9.513l-.97-.97a.826.826 0 0 1 0-1.166.84.84 0 0 1 1.167 0l.97.968 3.437 3.436a.36.36 0 0 0 .517 0 .366.366 0 0 0 0-.516L6.977 7.83a.82.82 0 0 1-.241-.584.82.82 0 0 1 .824-.826c.219 0 .43.087.584.242l5.787 5.787a.366.366 0 0 0 .587-.415l-1.117-2.363c-.26-.56-.194-.98.204-1.289a.7.7 0 0 1 .546-.132c.283.046.545.232.727.501l2.193 3.86c1.302 2.38.883 4.59-1.277 6.75-1.156 1.156-2.602 1.627-4.19 1.367-1.418-.236-2.866-1.033-4.079-2.246M10.75 5.971l2.12 2.12c-.41.502-.465 1.17-.128 1.89l.22.465-3.523-3.523a.8.8 0 0 1-.097-.368c0-.22.086-.428.241-.584a.847.847 0 0 1 1.167 0m7.355 1.705c-.31-.461-.746-.758-1.23-.837a1.44 1.44 0 0 0-1.11.275c-.312.24-.505.543-.59.881a1.74 1.74 0 0 0-.906-.465 1.47 1.47 0 0 0-.82.106l-2.182-2.182a1.56 1.56 0 0 0-2.2 0 1.54 1.54 0 0 0-.396.701 1.56 1.56 0 0 0-2.21-.01 1.55 1.55 0 0 0-.416.753c-.624-.624-1.649-.624-2.237-.037a1.557 1.557 0 0 0 0 2.2c-.239.1-.501.238-.715.453a1.56 1.56 0 0 0 0 2.2l.516.515a1.556 1.556 0 0 0-.753 2.615L7.01 19c1.32 1.319 2.909 2.189 4.475 2.449q.482.08.971.08c.85 0 1.653-.198 2.393-.579.231.033.46.054.686.054 1.266 0 2.457-.52 3.505-1.567 2.763-2.763 2.552-5.734 1.439-7.586z" clip-rule="evenodd"></path></svg></div></div></div></a></span></div><div class="pw-multi-vote-count l ks kt ku kv kw kx ky"><p class="bf b dv z du"><span class="kz">--</span></p></div></div></span></div><div class="bq ab"><div><div class="bm" aria-hidden="false"><button class="ao kk lc ld ab q fk le lf" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="lb"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"></path></svg><p class="bf b bg z du"><span class="pw-responses-count la lb">1</span></p></button></div></div></div></div><div class="ab q"><div class="pw l is"><div><div class="bm" aria-hidden="false"><span><a class="af ag ah ai aj ak al am an ao ap aq ar as at" data-testid="footerBookmarkButton" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F5adefebb6841&amp;operation=register&amp;redirect=https%3A%2F%2Fmicahbabinski.medium.com%2Fhtml-smuggling-detection-5adefebb6841&amp;source=---footer_actions--5adefebb6841---------------------bookmark_footer-----------" rel="noopener follow"><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="none" viewBox="0 0 25 25" class="du lh" aria-label="Add to list bookmark button"><path fill="currentColor" d="M18 2.5a.5.5 0 0 1 1 0V5h2.5a.5.5 0 0 1 0 1H19v2.5a.5.5 0 1 1-1 0V6h-2.5a.5.5 0 0 1 0-1H18zM7 7a1 1 0 0 1 1-1h3.5a.5.5 0 0 0 0-1H8a2 2 0 0 0-2 2v14a.5.5 0 0 0 .805.396L12.5 17l5.695 4.396A.5.5 0 0 0 19 21v-8.5a.5.5 0 0 0-1 0v7.485l-5.195-4.012a.5.5 0 0 0-.61 0L7 19.985z"></path></svg></a></span></div></div></div><div class="pw l is"><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="footerSocialShareButton" class="af fk ah ai aj ak al lp an ao ap ex lq lr lf ls"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"></path></svg></button></div></div></div></div></div></div></div></div></div></footer><div class="tp tq tr ts tt l"><div class="ab cb"><div class="ci bh fz ga gb gc"><div class="tu bh r tv"></div><div class="ab tw tx ty iu it"><div class="tz ua ub uc ud ue uf ug uh ui ab cp"><div class="h k"><a tabindex="0" rel="noopener follow" href="/?source=post_page---post_author_info--5adefebb6841--------------------------------"><div class="l fj"><img alt="Micah Babinski" class="l fd by ic ib cx" src="https://miro.medium.com/v2/resize:fill:96:96/1*mTA5GOa5eEXK6eiPX6bibQ.png" width="48" height="48" loading="lazy"/><div class="fr by l ic ib fs n ay uj"></div></div></a></div><div class="j i d"><a tabindex="0" rel="noopener follow" href="/?source=post_page---post_author_info--5adefebb6841--------------------------------"><div class="l fj"><img alt="Micah Babinski" class="l fd by uk ul cx" src="https://miro.medium.com/v2/resize:fill:128:128/1*mTA5GOa5eEXK6eiPX6bibQ.png" width="64" height="64" loading="lazy"/><div class="fr by l uk ul fs n ay uj"></div></div></a></div><div class="j i d um is"><div class="ab"><span><button class="bf b bg z un sx uo up uq ur us ev ew ut uu uv fa fb fc fd bm fe ff">Follow</button></span></div></div></div><div class="ab co rc"><div class="uw ux uy uz va l"><a class="af ag ah aj ak al am an ao ap aq ar as at ab q" rel="noopener follow" href="/?source=post_page---post_author_info--5adefebb6841--------------------------------"><h2 class="pw-author-name bf vc vd ve vf vg vh vi oi pb pc om pe pf oq ph pi bk"><span class="gn vb">Written by <!-- -->Micah Babinski</span></h2></a><div class="rk ab ia"><div class="l is"><span class="pw-follower-count bf b bg z du"><a class="af ag ah ai aj ak al am an ao ap aq ar il" rel="noopener follow" href="/followers?source=post_page---post_author_info--5adefebb6841--------------------------------">264 Followers</a></span></div><div class="bf b bg z du ab vj"><span class="im l" aria-hidden="true"><span class="bf b bg z du">·</span></span><a class="af ag ah ai aj ak al am an ao ap aq ar il" rel="noopener follow" href="/following?source=post_page---post_author_info--5adefebb6841--------------------------------">85 Following</a></div></div><div class="vk l"><p class="bf b bg z bk"><span class="gn">Cybersecurity pro, featuring bagpiping and GIS chops. Lives with wife Quinn and son Malcolm. Loves mountains, Indian food, and mountains of Indian food.</span></p></div></div></div><div class="h k"><div class="ab"><span><button class="bf b bg z un sx uo up uq ur us ev ew ut uu uv fa fb fc fd bm fe ff">Follow</button></span></div></div></div></div></div></div><div class="vl vm vn vo vp l"><div class="tu bh r vl vm vq vr vs"></div><div class="ab cb"><div class="ci bh fz ga gb gc"><div class="ab q cp"><h2 class="bf vc nc ne nf ng ni nj nk nm nn no nq nr ns nu nv bk">Responses (<!-- -->1<!-- -->)</h2><div class="ab vt"><div><div class="bm" aria-hidden="false"><a class="vu vv" href="https://policy.medium.com/medium-rules-30e5502c4eb4?source=post_page---post_responses--5adefebb6841--------------------------------" rel="noopener follow" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 25 25"><path fill-rule="evenodd" d="M11.987 5.036a.754.754 0 0 1 .914-.01c.972.721 1.767 1.218 2.6 1.543.828.322 1.719.485 2.887.505a.755.755 0 0 1 .741.757c-.018 3.623-.43 6.256-1.449 8.21-1.034 1.984-2.662 3.209-4.966 4.083a.75.75 0 0 1-.537-.003c-2.243-.874-3.858-2.095-4.897-4.074-1.024-1.951-1.457-4.583-1.476-8.216a.755.755 0 0 1 .741-.757c1.195-.02 2.1-.182 2.923-.503.827-.322 1.6-.815 2.519-1.535m.468.903c-.897.69-1.717 1.21-2.623 1.564-.898.35-1.856.527-3.026.565.037 3.45.469 5.817 1.36 7.515.884 1.684 2.25 2.762 4.284 3.571 2.092-.81 3.465-1.89 4.344-3.575.886-1.698 1.299-4.065 1.334-7.512-1.149-.039-2.091-.217-2.99-.567-.906-.353-1.745-.873-2.683-1.561m-.009 9.155a2.672 2.672 0 1 0 0-5.344 2.672 2.672 0 0 0 0 5.344m0 1a3.672 3.672 0 1 0 0-7.344 3.672 3.672 0 0 0 0 7.344m-1.813-3.777.525-.526.916.917 1.623-1.625.526.526-2.149 2.152z" clip-rule="evenodd"></path></svg></a></div></div></div></div><div class="vw vx vy vz wa wb wc l"></div><div class="pp l"><button class="bf b bg z bk sx wd we wf lh le us ev ew ex wg wh wi fa wj wk wl wm wn fb fc fd bm fe ff">See all responses</button></div></div></div></div><div class="wo wp wq wr ws l bx"><div class="h k j"><div class="tu bh wt wu"></div><div class="ab cb"><div class="ci bh fz ga gb gc"><div class="wv ab ke iv"><div class="ww wx l"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://help.medium.com/hc/en-us?source=post_page-----5adefebb6841--------------------------------" rel="noopener follow"><p class="bf b dv z du">Help</p></a></div><div class="ww wx l"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://medium.statuspage.io/?source=post_page-----5adefebb6841--------------------------------" rel="noopener follow"><p class="bf b dv z du">Status</p></a></div><div class="ww wx l"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://medium.com/about?autoplay=1&amp;source=post_page-----5adefebb6841--------------------------------" rel="noopener follow"><p class="bf b dv z du">About</p></a></div><div class="ww wx l"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=post_page-----5adefebb6841--------------------------------" rel="noopener follow"><p class="bf b dv z du">Careers</p></a></div><div class="ww wx l"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="pressinquiries@medium.com?source=post_page-----5adefebb6841--------------------------------" rel="noopener follow"><p class="bf b dv z du">Press</p></a></div><div class="ww wx l"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://blog.medium.com/?source=post_page-----5adefebb6841--------------------------------" rel="noopener follow"><p class="bf b dv z du">Blog</p></a></div><div class="ww wx l"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----5adefebb6841--------------------------------" rel="noopener follow"><p class="bf b dv z du">Privacy</p></a></div><div class="ww wx l"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----5adefebb6841--------------------------------" rel="noopener follow"><p class="bf b dv z du">Terms</p></a></div><div class="ww wx l"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://speechify.com/medium?source=post_page-----5adefebb6841--------------------------------" rel="noopener follow"><p class="bf b dv z du">Text to speech</p></a></div><div class="ww l"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://medium.com/business?source=post_page-----5adefebb6841--------------------------------" rel="noopener follow"><p class="bf b dv z du">Teams</p></a></div></div></div></div></div></div></div></div></div></div><script>window.__BUILD_ID__="main-20241216-164309-0d4958d8a6"</script><script>window.__GRAPHQL_URI__ = "https://micahbabinski.medium.com/_/graphql"</script><script>window.__PRELOADED_STATE__ = {"algolia":{"queries":{}},"cache":{"experimentGroupSet":true,"reason":"","group":"enabled","tags":["group-edgeCachePosts","post-5adefebb6841","user-47a061e2b431"],"serverVariantState":"44136fa355b3678a1146ad16f7e8649e94fb4fc21fe77e8310c060f61caaff8a","middlewareEnabled":true,"cacheStatus":"DYNAMIC","shouldUseCache":true,"vary":[],"lohpSummerUpsellEnabled":false},"client":{"hydrated":false,"isUs":false,"isNativeMedium":false,"isSafariMobile":false,"isSafari":false,"isFirefox":false,"routingEntity":{"type":"USER","id":"47a061e2b431","explicit":true},"viewerIsBot":false},"debug":{"requestId":"322c6ab6-7dbd-476c-be4d-14fb4862a719","hybridDevServices":[],"originalSpanCarrier":{"traceparent":"00-b81771756200b51d86970865746d6e5e-8f939f19e0f96ed0-01"}},"multiVote":{"clapsPerPost":{}},"navigation":{"branch":{"show":null,"hasRendered":null,"blockedByCTA":false},"hideGoogleOneTap":false,"hasRenderedAlternateUserBanner":null,"currentLocation":"https:\u002F\u002Fmicahbabinski.medium.com\u002Fhtml-smuggling-detection-5adefebb6841","host":"micahbabinski.medium.com","hostname":"micahbabinski.medium.com","referrer":"","hasSetReferrer":false,"susiModal":{"step":null,"operation":"register"},"postRead":false,"partnerProgram":{"selectedCountryCode":null},"queryString":"","currentHash":""},"config":{"nodeEnv":"production","version":"main-20241216-164309-0d4958d8a6","target":"production","productName":"Medium","publicUrl":"https:\u002F\u002Fcdn-client.medium.com\u002Flite","authDomain":"medium.com","authGoogleClientId":"216296035834-k1k6qe060s2tp2a2jam4ljdcms00sttg.apps.googleusercontent.com","favicon":"production","glyphUrl":"https:\u002F\u002Fglyph.medium.com","branchKey":"key_live_ofxXr2qTrrU9NqURK8ZwEhknBxiI6KBm","algolia":{"appId":"MQ57UUUQZ2","apiKeySearch":"394474ced050e3911ae2249ecc774921","indexPrefix":"medium_","host":"-dsn.algolia.net"},"recaptchaKey":"6Lfc37IUAAAAAKGGtC6rLS13R1Hrw_BqADfS1LRk","recaptcha3Key":"6Lf8R9wUAAAAABMI_85Wb8melS7Zj6ziuf99Yot5","recaptchaEnterpriseKeyId":"6Le-uGgpAAAAAPprRaokM8AKthQ9KNGdoxaGUvVp","datadog":{"applicationId":"6702d87d-a7e0-42fe-bbcb-95b469547ea0","clientToken":"pub853ea8d17ad6821d9f8f11861d23dfed","rumToken":"pubf9cc52896502b9413b68ba36fc0c7162","context":{"deployment":{"target":"production","tag":"main-20241216-164309-0d4958d8a6","commit":"0d4958d8a6e728d0bc7ba6245eaad002411a6eb7"}},"datacenter":"us"},"googleAnalyticsCode":"G-7JY7T788PK","googlePay":{"apiVersion":"2","apiVersionMinor":"0","merchantId":"BCR2DN6TV7EMTGBM","merchantName":"Medium","instanceMerchantId":"13685562959212738550"},"applePay":{"version":3},"signInWallCustomDomainCollectionIds":["3a8144eabfe3","336d898217ee","61061eb0c96b","138adf9c44c","819cc2aaeee0"],"mediumMastodonDomainName":"me.dm","mediumOwnedAndOperatedCollectionIds":["8a9336e5bb4","b7e45b22fec3","193b68bd4fba","8d6b8a439e32","54c98c43354d","3f6ecf56618","d944778ce714","92d2092dc598","ae2a65f35510","1285ba81cada","544c7006046e","fc8964313712","40187e704f1c","88d9857e584e","7b6769f2748b","bcc38c8f6edf","cef6983b292","cb8577c9149e","444d13b52878","713d7dbc99b0","ef8e90590e66","191186aaafa0","55760f21cdc5","9dc80918cc93","bdc4052bbdba","8ccfed20cbb2"],"tierOneDomains":["medium.com","thebolditalic.com","arcdigital.media","towardsdatascience.com","uxdesign.cc","codeburst.io","psiloveyou.xyz","writingcooperative.com","entrepreneurshandbook.co","prototypr.io","betterhumans.coach.me","theascent.pub"],"topicsToFollow":["d61cf867d93f","8a146bc21b28","1eca0103fff3","4d562ee63426","aef1078a3ef5","e15e46793f8d","6158eb913466","55f1c20aba7a","3d18b94f6858","4861fee224fd","63c6f1f93ee","1d98b3a9a871","decb52b64abf","ae5d4995e225","830cded25262"],"topicToTagMappings":{"accessibility":"accessibility","addiction":"addiction","android-development":"android-development","art":"art","artificial-intelligence":"artificial-intelligence","astrology":"astrology","basic-income":"basic-income","beauty":"beauty","biotech":"biotech","blockchain":"blockchain","books":"books","business":"business","cannabis":"cannabis","cities":"cities","climate-change":"climate-change","comics":"comics","coronavirus":"coronavirus","creativity":"creativity","cryptocurrency":"cryptocurrency","culture":"culture","cybersecurity":"cybersecurity","data-science":"data-science","design":"design","digital-life":"digital-life","disability":"disability","economy":"economy","education":"education","equality":"equality","family":"family","feminism":"feminism","fiction":"fiction","film":"film","fitness":"fitness","food":"food","freelancing":"freelancing","future":"future","gadgets":"gadgets","gaming":"gaming","gun-control":"gun-control","health":"health","history":"history","humor":"humor","immigration":"immigration","ios-development":"ios-development","javascript":"javascript","justice":"justice","language":"language","leadership":"leadership","lgbtqia":"lgbtqia","lifestyle":"lifestyle","machine-learning":"machine-learning","makers":"makers","marketing":"marketing","math":"math","media":"media","mental-health":"mental-health","mindfulness":"mindfulness","money":"money","music":"music","neuroscience":"neuroscience","nonfiction":"nonfiction","outdoors":"outdoors","parenting":"parenting","pets":"pets","philosophy":"philosophy","photography":"photography","podcasts":"podcast","poetry":"poetry","politics":"politics","privacy":"privacy","product-management":"product-management","productivity":"productivity","programming":"programming","psychedelics":"psychedelics","psychology":"psychology","race":"race","relationships":"relationships","religion":"religion","remote-work":"remote-work","san-francisco":"san-francisco","science":"science","self":"self","self-driving-cars":"self-driving-cars","sexuality":"sexuality","social-media":"social-media","society":"society","software-engineering":"software-engineering","space":"space","spirituality":"spirituality","sports":"sports","startups":"startup","style":"style","technology":"technology","transportation":"transportation","travel":"travel","true-crime":"true-crime","tv":"tv","ux":"ux","venture-capital":"venture-capital","visual-design":"visual-design","work":"work","world":"world","writing":"writing"},"defaultImages":{"avatar":{"imageId":"1*dmbNkD5D-u45r44go_cf0g.png","height":150,"width":150},"orgLogo":{"imageId":"7*V1_7XP4snlmqrc_0Njontw.png","height":110,"width":500},"postLogo":{"imageId":"bd978bb536350a710e8efb012513429cabdc4c28700604261aeda246d0f980b7","height":810,"width":1440},"postPreviewImage":{"imageId":"1*hn4v1tCaJy7cWMyb0bpNpQ.png","height":386,"width":579}},"collectionStructuredData":{"8d6b8a439e32":{"name":"Elemental","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fcdn-images-1.medium.com\u002Fmax\u002F980\u002F1*9ygdqoKprhwuTVKUM0DLPA@2x.png","width":980,"height":159}}},"3f6ecf56618":{"name":"Forge","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fcdn-images-1.medium.com\u002Fmax\u002F596\u002F1*uULpIlImcO5TDuBZ6lm7Lg@2x.png","width":596,"height":183}}},"ae2a65f35510":{"name":"GEN","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fmiro.medium.com\u002Fmax\u002F264\u002F1*RdVZMdvfV3YiZTw6mX7yWA.png","width":264,"height":140}}},"88d9857e584e":{"name":"LEVEL","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fmiro.medium.com\u002Fmax\u002F540\u002F1*JqYMhNX6KNNb2UlqGqO2WQ.png","width":540,"height":108}}},"7b6769f2748b":{"name":"Marker","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fcdn-images-1.medium.com\u002Fmax\u002F383\u002F1*haCUs0wF6TgOOvfoY-jEoQ@2x.png","width":383,"height":92}}},"444d13b52878":{"name":"OneZero","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fmiro.medium.com\u002Fmax\u002F540\u002F1*cw32fIqCbRWzwJaoQw6BUg.png","width":540,"height":123}}},"8ccfed20cbb2":{"name":"Zora","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fmiro.medium.com\u002Fmax\u002F540\u002F1*tZUQqRcCCZDXjjiZ4bDvgQ.png","width":540,"height":106}}}},"embeddedPostIds":{"coronavirus":"cd3010f9d81f"},"sharedCdcMessaging":{"COVID_APPLICABLE_TAG_SLUGS":[],"COVID_APPLICABLE_TOPIC_NAMES":[],"COVID_APPLICABLE_TOPIC_NAMES_FOR_TOPIC_PAGE":[],"COVID_MESSAGES":{"tierA":{"text":"For more information on the novel coronavirus and Covid-19, visit cdc.gov.","markups":[{"start":66,"end":73,"href":"https:\u002F\u002Fwww.cdc.gov\u002Fcoronavirus\u002F2019-nCoV"}]},"tierB":{"text":"Anyone can publish on Medium per our Policies, but we don’t fact-check every story. For more info about the coronavirus, see cdc.gov.","markups":[{"start":37,"end":45,"href":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Fcategories\u002F201931128-Policies-Safety"},{"start":125,"end":132,"href":"https:\u002F\u002Fwww.cdc.gov\u002Fcoronavirus\u002F2019-nCoV"}]},"paywall":{"text":"This article has been made free for everyone, thanks to Medium Members. For more information on the novel coronavirus and Covid-19, visit cdc.gov.","markups":[{"start":56,"end":70,"href":"https:\u002F\u002Fmedium.com\u002Fmembership"},{"start":138,"end":145,"href":"https:\u002F\u002Fwww.cdc.gov\u002Fcoronavirus\u002F2019-nCoV"}]},"unbound":{"text":"This article is free for everyone, thanks to Medium Members. For more information on the novel coronavirus and Covid-19, visit cdc.gov.","markups":[{"start":45,"end":59,"href":"https:\u002F\u002Fmedium.com\u002Fmembership"},{"start":127,"end":134,"href":"https:\u002F\u002Fwww.cdc.gov\u002Fcoronavirus\u002F2019-nCoV"}]}},"COVID_BANNER_POST_ID_OVERRIDE_WHITELIST":["3b31a67bff4a"]},"sharedVoteMessaging":{"TAGS":["politics","election-2020","government","us-politics","election","2020-presidential-race","trump","donald-trump","democrats","republicans","congress","republican-party","democratic-party","biden","joe-biden","maga"],"TOPICS":["politics","election"],"MESSAGE":{"text":"Find out more about the U.S. election results here.","markups":[{"start":46,"end":50,"href":"https:\u002F\u002Fcookpolitical.com\u002F2020-national-popular-vote-tracker"}]},"EXCLUDE_POSTS":["397ef29e3ca5"]},"embedPostRules":[],"recircOptions":{"v1":{"limit":3},"v2":{"limit":8}},"braintreeClientKey":"production_zjkj96jm_m56f8fqpf7ngnrd4","braintree":{"enabled":true,"merchantId":"m56f8fqpf7ngnrd4","merchantAccountId":{"usd":"AMediumCorporation_instant","eur":"amediumcorporation_EUR","cad":"amediumcorporation_CAD"},"publicKey":"ds2nn34bg2z7j5gd","braintreeEnvironment":"production","dashboardUrl":"https:\u002F\u002Fwww.braintreegateway.com\u002Fmerchants","gracePeriodDurationInDays":14,"mediumMembershipPlanId":{"monthly":"ce105f8c57a3","monthlyV2":"e8a5e126-792b-4ee6-8fba-d574c1b02fc5","monthlyWithTrial":"d5ee3dbe3db8","monthlyPremium":"fa741a9b47a2","yearly":"a40ad4a43185","yearlyV2":"3815d7d6-b8ca-4224-9b8c-182f9047866e","yearlyStaff":"d74fb811198a","yearlyWithTrial":"b3bc7350e5c7","yearlyPremium":"e21bd2c12166","monthlyOneYearFree":"e6c0637a-2bad-4171-ab4f-3c268633d83c","monthly25PercentOffFirstYear":"235ecc62-0cdb-49ae-9378-726cd21c504b","monthly20PercentOffFirstYear":"ba518864-9c13-4a99-91ca-411bf0cac756","monthly15PercentOffFirstYear":"594c029b-9f89-43d5-88f8-8173af4e070e","monthly10PercentOffFirstYear":"c6c7bc9a-40f2-4b51-8126-e28511d5bdb0","monthlyForStudents":"629ebe51-da7d-41fd-8293-34cd2f2030a8","yearlyOneYearFree":"78ba7be9-0d9f-4ece-aa3e-b54b826f2bf1","yearly25PercentOffFirstYear":"2dbb010d-bb8f-4eeb-ad5c-a08509f42d34","yearly20PercentOffFirstYear":"47565488-435b-47f8-bf93-40d5fbe0ebc8","yearly15PercentOffFirstYear":"8259809b-0881-47d9-acf7-6c001c7f720f","yearly10PercentOffFirstYear":"9dd694fb-96e1-472c-8d9e-3c868d5c1506","yearlyForStudents":"e29345ef-ab1c-4234-95c5-70e50fe6bc23","monthlyCad":"p52orjkaceei","yearlyCad":"h4q9g2up9ktt"},"braintreeDiscountId":{"oneMonthFree":"MONTHS_FREE_01","threeMonthsFree":"MONTHS_FREE_03","sixMonthsFree":"MONTHS_FREE_06","fiftyPercentOffOneYear":"FIFTY_PERCENT_OFF_ONE_YEAR"},"3DSecureVersion":"2","defaultCurrency":"usd","providerPlanIdCurrency":{"4ycw":"usd","rz3b":"usd","3kqm":"usd","jzw6":"usd","c2q2":"usd","nnsw":"usd","q8qw":"usd","d9y6":"usd","fx7w":"cad","nwf2":"cad"}},"paypalClientId":"AXj1G4fotC2GE8KzWX9mSxCH1wmPE3nJglf4Z2ig_amnhvlMVX87otaq58niAg9iuLktVNF_1WCMnN7v","paypal":{"host":"https:\u002F\u002Fapi.paypal.com:443","clientMode":"production","serverMode":"live","webhookId":"4G466076A0294510S","monthlyPlan":{"planId":"P-9WR0658853113943TMU5FDQA","name":"Medium Membership (Monthly) with setup fee","description":"Unlimited access to the best and brightest stories on Medium. Membership billed monthly."},"yearlyPlan":{"planId":"P-7N8963881P8875835MU5JOPQ","name":"Medium Membership (Annual) with setup fee","description":"Unlimited access to the best and brightest stories on Medium. Membership billed annually."},"oneYearGift":{"name":"Medium Membership (1 Year, Digital Gift Code)","description":"Unlimited access to the best and brightest stories on Medium. Gift codes can be redeemed at medium.com\u002Fredeem.","price":"50.00","currency":"USD","sku":"membership-gift-1-yr"},"oldMonthlyPlan":{"planId":"P-96U02458LM656772MJZUVH2Y","name":"Medium Membership (Monthly)","description":"Unlimited access to the best and brightest stories on Medium. Membership billed monthly."},"oldYearlyPlan":{"planId":"P-59P80963JF186412JJZU3SMI","name":"Medium Membership (Annual)","description":"Unlimited access to the best and brightest stories on Medium. Membership billed annually."},"monthlyPlanWithTrial":{"planId":"P-66C21969LR178604GJPVKUKY","name":"Medium Membership (Monthly) with setup fee","description":"Unlimited access to the best and brightest stories on Medium. Membership billed monthly."},"yearlyPlanWithTrial":{"planId":"P-6XW32684EX226940VKCT2MFA","name":"Medium Membership (Annual) with setup fee","description":"Unlimited access to the best and brightest stories on Medium. Membership billed annually."},"oldMonthlyPlanNoSetupFee":{"planId":"P-4N046520HR188054PCJC7LJI","name":"Medium Membership (Monthly)","description":"Unlimited access to the best and brightest stories on Medium. Membership billed monthly."},"oldYearlyPlanNoSetupFee":{"planId":"P-7A4913502Y5181304CJEJMXQ","name":"Medium Membership (Annual)","description":"Unlimited access to the best and brightest stories on Medium. Membership billed annually."},"sdkUrl":"https:\u002F\u002Fwww.paypal.com\u002Fsdk\u002Fjs"},"stripePublishableKey":"pk_live_7FReX44VnNIInZwrIIx6ghjl","log":{"json":true,"level":"info"},"imageUploadMaxSizeMb":25,"staffPicks":{"title":"Staff Picks","catalogId":"c7bc6e1ee00f"}},"session":{"xsrf":""}}</script><script>window.__APOLLO_STATE__ = {"ROOT_QUERY":{"__typename":"Query","viewer":null,"collectionByDomainOrSlug({\"domainOrSlug\":\"micahbabinski.medium.com\"})":null,"postResult({\"id\":\"5adefebb6841\"})":{"__ref":"Post:5adefebb6841"}},"LinkedAccounts:47a061e2b431":{"__typename":"LinkedAccounts","mastodon":null,"id":"47a061e2b431"},"User:47a061e2b431":{"__typename":"User","id":"47a061e2b431","linkedAccounts":{"__ref":"LinkedAccounts:47a061e2b431"},"isSuspended":false,"name":"Micah Babinski","imageId":"1*mTA5GOa5eEXK6eiPX6bibQ.png","customDomainState":{"__typename":"CustomDomainState","live":{"__typename":"CustomDomain","domain":"micahbabinski.medium.com"}},"hasSubdomain":true,"username":"micahbabinski","verifications":{"__typename":"VerifiedInfo","isBookAuthor":false},"socialStats":{"__typename":"SocialStats","followerCount":264,"followingCount":83,"collectionFollowingCount":2},"bio":"Cybersecurity pro, featuring bagpiping and GIS chops. Lives with wife Quinn and son Malcolm. Loves mountains, Indian food, and mountains of Indian food.","membership":null,"allowNotes":true,"viewerEdge":{"__ref":"UserViewerEdge:userId:47a061e2b431-viewerId:lo_bc0227835f94"},"twitterScreenName":"MicahBabinski"},"Paragraph:72a248ad8d1b_0":{"__typename":"Paragraph","id":"72a248ad8d1b_0","name":"7e61","type":"H3","href":null,"layout":null,"metadata":null,"text":"HTML Smuggling Detection","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*5P6AoNfhFJraUVFkpN1NXw.jpeg":{"__typename":"ImageMetadata","id":"1*5P6AoNfhFJraUVFkpN1NXw.jpeg","originalHeight":600,"originalWidth":1200,"focusPercentX":null,"focusPercentY":null,"alt":""},"Paragraph:72a248ad8d1b_1":{"__typename":"Paragraph","id":"72a248ad8d1b_1","name":"87f7","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*5P6AoNfhFJraUVFkpN1NXw.jpeg"},"text":"The most famous fictional smuggler that I could think of","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_2":{"__typename":"Paragraph","id":"72a248ad8d1b_2","name":"d6e6","type":"H3","href":null,"layout":null,"metadata":null,"text":"Introduction","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_3":{"__typename":"Paragraph","id":"72a248ad8d1b_3","name":"80d2","type":"P","href":null,"layout":null,"metadata":null,"text":"In this article I’ll delve into HTML smuggling detection, following the detection engineering process I’ve described over my last two posts. This process includes research, testing, and development of new detection concepts. Unlike my previous posts however, this time we’ll be observing, profiling, and detecting real QakBot malware in the lab. With this piece I hope to show how current and aspiring detection engineers can go beyond simulated, CTF-style challenges to study and detect real-world attacker techniques, flagging them for our SOC, and allowing our incident response colleagues to neutralize the threat.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_4":{"__typename":"Paragraph","id":"72a248ad8d1b_4","name":"0ca2","type":"H4","href":null,"layout":null,"metadata":null,"text":"Our Itinerary","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_5":{"__typename":"Paragraph","id":"72a248ad8d1b_5","name":"b1d3","type":"P","href":null,"layout":null,"metadata":null,"text":"After some background and defining the objective, I’ll demonstrate how we can execute QakBot HTML Smuggling malware in the lab, tracking it’s behavior in Splunk. Then, I’ll sequence observable events of this attack, and identify useful detection points (which I think of as “building blocks,” or links of the attack chain). I’ll also introduce correlation (specifically chain rules), a crucial tool in your threat detection toolbox. To illustrate what this looks like, I’ll discuss and demonstrate an as-yet-unreleased capability of Sigma, called Sigma Correlations. I’ll wrap up by testing a new chain rule against 10 additional samples of QakBot HTML Smuggling malware to see how it performs.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_6":{"__typename":"Paragraph","id":"72a248ad8d1b_6","name":"c1af","type":"P","href":null,"layout":null,"metadata":null,"text":"Let’s get started! 🏁🏁🏁","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_7":{"__typename":"Paragraph","id":"72a248ad8d1b_7","name":"c24b","type":"H3","href":null,"layout":null,"metadata":null,"text":"Background","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_8":{"__typename":"Paragraph","id":"72a248ad8d1b_8","name":"b129","type":"P","href":null,"layout":null,"metadata":null,"text":"Early on in my cybersecurity journey, John Strand of Black Hills Information Security said something that stuck with me: “There is no ‘YOU HAVE BEEN HACKED’ log.” Event logs can be confusing and hard to read even on a good day. Deriving useful, actionable insights from logs is tricky! The challenge sometimes requires deep analysis and specialized techniques to be successful.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_9":{"__typename":"Paragraph","id":"72a248ad8d1b_9","name":"74c3","type":"P","href":null,"layout":null,"metadata":null,"text":"I’ve had that lesson in the back of my mind throughout my career in security, and it was with this in mind that a few months ago, I started seeing tons of posts like this one from @pr0xylife:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":180,"end":190,"href":"https:\u002F\u002Ftwitter.com\u002Fpr0xylife","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"MediaResource:f7d2aed98a10cc6c56a4c5623ab16566":{"__typename":"MediaResource","id":"f7d2aed98a10cc6c56a4c5623ab16566","iframeSrc":"https:\u002F\u002Fcdn.embedly.com\u002Fwidgets\u002Fmedia.html?type=text%2Fhtml&key=a19fcc184b9711e1b4764040d3dc5c07&schema=twitter&url=https%3A\u002F\u002Ftwitter.com\u002Fpr0xylife\u002Fstatus\u002F1547703381262680064%3Flang%3Den&image=https%3A\u002F\u002Fi.embed.ly\u002F1\u002Fimage%3Furl%3Dhttps%253A%252F%252Fabs.twimg.com%252Ferrors%252Flogo46x38.png%26key%3Da19fcc184b9711e1b4764040d3dc5c07","iframeHeight":281,"iframeWidth":500,"title":"proxylife on Twitter: \"#Qakbot - obama201 - html \u003E .zip \u003E .iso \u003E .lnk \u003E calc.exe \u003E .dll \u003E .dllT1574 - DLL Search Order Hijacking cmd.exe \u002Fq \u002Fc calc.exeregsvr32 \u002Fs C:\\Users\\User\\AppData\\Local\\Temp\\WindowsCodecs.dllregsvr32.exe 7533.dllhttps:\u002F\u002Ft.co\u002F8EI63li9olIOC'shttps:\u002F\u002Ft.co\u002FBYhFkccqky pic.twitter.com\u002FPEkfEzLxYv \u002F Twitter\""},"Paragraph:72a248ad8d1b_10":{"__typename":"Paragraph","id":"72a248ad8d1b_10","name":"94f7","type":"IFRAME","href":null,"layout":"INSET_CENTER","metadata":null,"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":{"__typename":"Iframe","mediaResource":{"__ref":"MediaResource:f7d2aed98a10cc6c56a4c5623ab16566"}},"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_11":{"__typename":"Paragraph","id":"72a248ad8d1b_11","name":"d708","type":"P","href":null,"layout":null,"metadata":null,"text":"I like the way that pr0xylife and their peers summarize these attacks so succinctly, and I found myself repeating the sequence of file types out loud — almost like a weird form of poetry!","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_12":{"__typename":"Paragraph","id":"72a248ad8d1b_12","name":"9ba9","type":"P","href":null,"layout":null,"metadata":null,"text":"I wanted to learn more, but didn’t know how to get started. I had reviewed some excellent research on QakBot by the team at Trellix, so I knew a bit about their techniques. (If you have never heard of QakBot, please read the Trellix report!) As I started following QakBot activity and digging deeper, I realized that pr0xylife and others were describing the subtle combinations and variations in the way QakBot could trick its victims and evade our defenses. Some examples:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_13":{"__typename":"Paragraph","id":"72a248ad8d1b_13","name":"f002","type":"ULI","href":null,"layout":null,"metadata":null,"text":"It uses HTML Smuggling, where a malicious HTML file containing encoded JavaScript is executed by the victim’s browser, downloading the next stage of the payload.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":8,"end":22,"href":"https:\u002F\u002Fwww.microsoft.com\u002Fen-us\u002Fsecurity\u002Fblog\u002F2021\u002F11\u002F11\u002Fhtml-smuggling-surges-highly-evasive-loader-technique-increasingly-used-in-banking-malware-targeted-attacks\u002F","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_14":{"__typename":"Paragraph","id":"72a248ad8d1b_14","name":"bbea","type":"ULI","href":null,"layout":null,"metadata":null,"text":"It uses password protected zip files to block sandboxing analysis.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":8,"end":36,"href":"https:\u002F\u002Fwww.trendmicro.com\u002Fen_us\u002Fresearch\u002F22\u002Fj\u002Fblack-basta-infiltrates-networks-via-qakbot-brute-ratel-and-coba.html","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_15":{"__typename":"Paragraph","id":"72a248ad8d1b_15","name":"2543","type":"ULI","href":null,"layout":null,"metadata":null,"text":"It uses a disk image format called an .iso file to evade the Mark-of-the-Web protection, as Red Canary explains very well.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":103,"end":121,"href":"https:\u002F\u002Fredcanary.com\u002Fblog\u002Fiso-files\u002F","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_16":{"__typename":"Paragraph","id":"72a248ad8d1b_16","name":"5aa0","type":"ULI","href":null,"layout":null,"metadata":null,"text":"LNK files disguised to lure users into executing to hidden .CMD and .DLL files.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_17":{"__typename":"Paragraph","id":"72a248ad8d1b_17","name":"59f6","type":"ULI","href":null,"layout":null,"metadata":null,"text":"And on and on with ever more deceptive tricks!","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_18":{"__typename":"Paragraph","id":"72a248ad8d1b_18","name":"fc11","type":"P","href":null,"layout":null,"metadata":null,"text":"Viewed independently of one another, few of these behaviors will trigger an alert, much less get escalated, in many SOCs. So it seemed like a good use case for correlation, where multiple security event log entries are aggregated, sequenced, and timed in relation to each other to yield more sophisticated and high-fidelity alerts. If this sounds confusing, keep reading! By the end of this article, you should have a much better understanding of what correlation means and how you can put it to work for threat detection.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_19":{"__typename":"Paragraph","id":"72a248ad8d1b_19","name":"b49e","type":"H3","href":null,"layout":null,"metadata":null,"text":"The Objective","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_20":{"__typename":"Paragraph","id":"72a248ad8d1b_20","name":"d4ca","type":"P","href":null,"layout":null,"metadata":null,"text":"There are some detections out there for HTML smuggling and other QakBot-connected techniques. These are mostly based on matching suspicious log events, such as this one from Elastic security:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_21":{"__typename":"Paragraph","id":"72a248ad8d1b_21","name":"a12b","type":"MIXTAPE_EMBED","href":null,"layout":null,"metadata":null,"text":"Suspicious HTML File Creation | Elastic Security Solution [8.5] | Elastic\nIdentifies the execution of a browser process to open an HTML file with high entropy and size. Adversaries may smuggle…www.elastic.co","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":0,"end":207,"href":"https:\u002F\u002Fwww.elastic.co\u002Fguide\u002Fen\u002Fsecurity\u002Fcurrent\u002Fsuspicious-html-file-creation.html","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":0,"end":73,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":74,"end":193,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":{"__typename":"MixtapeMetadata","href":"https:\u002F\u002Fwww.elastic.co\u002Fguide\u002Fen\u002Fsecurity\u002Fcurrent\u002Fsuspicious-html-file-creation.html","mediaResource":{"__typename":"MediaResource","mediumCatalog":null},"thumbnailImageId":""}},"Paragraph:72a248ad8d1b_22":{"__typename":"Paragraph","id":"72a248ad8d1b_22","name":"4d66","type":"P","href":null,"layout":null,"metadata":null,"text":"I wanted to see if I could build my own detections, utilizing correlation (as opposed to simple matching) to make them resilient to subtle shifts in attack behavior.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":62,"end":74,"href":"","anchorType":"LINK","userId":"","linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_23":{"__typename":"Paragraph","id":"72a248ad8d1b_23","name":"c363","type":"BQ","href":null,"layout":null,"metadata":null,"text":"TBH, I was also sick of QakBot’s dumb chicanery and wanted a reliable way to place it squarely within our sights.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:0*c4yEMPAmk8GZ39Px.gif":{"__typename":"ImageMetadata","id":"0*c4yEMPAmk8GZ39Px.gif","originalHeight":320,"originalWidth":320,"focusPercentX":-1,"focusPercentY":-1,"alt":""},"Paragraph:72a248ad8d1b_24":{"__typename":"Paragraph","id":"72a248ad8d1b_24","name":"e818","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:0*c4yEMPAmk8GZ39Px.gif"},"text":"Me, after seeing yet another QakBot variation","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_25":{"__typename":"Paragraph","id":"72a248ad8d1b_25","name":"96f1","type":"H3","href":null,"layout":null,"metadata":null,"text":"Initial Observation and Analysis of QakBot Malware","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_26":{"__typename":"Paragraph","id":"72a248ad8d1b_26","name":"7061","type":"P","href":null,"layout":null,"metadata":null,"text":"To accomplish my objective, I had to go beyond threat intelligence reports from security vendors and Atomic Red Team tests; I needed my own data created from real malware samples. I turned to an old favorite: malware-traffic-analysis.net by Brad Duncan (@malware_traffic). This site is among the most useful educational resources I have come across in security. In addition to Wireshark tutorials and hands-on network traffic exercises, the site offers quality analysis of real-world malware samples, including QakBot HTML smuggling files.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_27":{"__typename":"Paragraph","id":"72a248ad8d1b_27","name":"0f3b","type":"P","href":null,"layout":null,"metadata":null,"text":"After making snapshots of my lab VMs, I fired up my virtual detection lab and visited a recent entry. Be careful, the files hosted on this site are unsafe!","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_28":{"__typename":"Paragraph","id":"72a248ad8d1b_28","name":"fcae","type":"MIXTAPE_EMBED","href":null,"layout":null,"metadata":null,"text":"Malware-Traffic-Analysis.net - 2022-12-09 - HTML smuggling leads to Qakbot, distribution\u002Fbotnet…\nNOTES: The HTML file used for smuggling was posted to VirusTotal today, and create\u002Fmodify dates for the disk image &…www.malware-traffic-analysis.net","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":0,"end":246,"href":"https:\u002F\u002Fwww.malware-traffic-analysis.net\u002F2022\u002F12\u002F09\u002Findex.html","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":0,"end":96,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":97,"end":214,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":{"__typename":"MixtapeMetadata","href":"https:\u002F\u002Fwww.malware-traffic-analysis.net\u002F2022\u002F12\u002F09\u002Findex.html","mediaResource":{"__typename":"MediaResource","mediumCatalog":null},"thumbnailImageId":"0*xcHotd7W88ngKtix"}},"Paragraph:72a248ad8d1b_29":{"__typename":"Paragraph","id":"72a248ad8d1b_29","name":"f9c4","type":"P","href":null,"layout":null,"metadata":null,"text":"I downloaded the artifacts zip file and extracted it to my downloads folder using the WinRAR utility built into my detection lab:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*omXoSeRFe_vVHWoJXd3f8A.png":{"__typename":"ImageMetadata","id":"1*omXoSeRFe_vVHWoJXd3f8A.png","originalHeight":840,"originalWidth":1618,"focusPercentX":-1,"focusPercentY":-1,"alt":""},"Paragraph:72a248ad8d1b_30":{"__typename":"Paragraph","id":"72a248ad8d1b_30","name":"36c8","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*omXoSeRFe_vVHWoJXd3f8A.png"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_31":{"__typename":"Paragraph","id":"72a248ad8d1b_31","name":"218f","type":"P","href":null,"layout":null,"metadata":null,"text":"The IOC notes were extremely helpful in giving context to the included files. Among the notes were the following, which let me know that the infection chain started with the HTML file, called SCAN_DT6281.html.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_32":{"__typename":"Paragraph","id":"72a248ad8d1b_32","name":"1469","type":"PRE","href":null,"layout":null,"metadata":null,"text":"2022-12-09 (FRIDAY) - HTML SMUGGLING FOR QAKBOT (QBOT) DISTRIBUTION TAG: AZD\n\nDISTRIBUTION:\n\n- Unknown source, possibly email --\u003E HTML file --\u003E password-protected zip archive --\u003E extracted ISO image with .img file extension","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":{"__typename":"CodeBlockMetadata","mode":"EXPLICIT","lang":"plaintext"},"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_33":{"__typename":"Paragraph","id":"72a248ad8d1b_33","name":"8871","type":"P","href":null,"layout":null,"metadata":null,"text":"I opened the HTML file in Chrome browser and noticed an immediate zip file download (bottom left below):","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*vED27mk8J738r6_w_BBL6w.png":{"__typename":"ImageMetadata","id":"1*vED27mk8J738r6_w_BBL6w.png","originalHeight":906,"originalWidth":1894,"focusPercentX":-1,"focusPercentY":-1,"alt":""},"Paragraph:72a248ad8d1b_34":{"__typename":"Paragraph","id":"72a248ad8d1b_34","name":"d31a","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*vED27mk8J738r6_w_BBL6w.png"},"text":"Seems legit","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_35":{"__typename":"Paragraph","id":"72a248ad8d1b_35","name":"0f59","type":"P","href":null,"layout":null,"metadata":null,"text":"…sure, let’s open up the zip file, why not?","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":0,"end":43,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_36":{"__typename":"Paragraph","id":"72a248ad8d1b_36","name":"014a","type":"P","href":null,"layout":null,"metadata":null,"text":"The zip file was password protected but could be opened using the password displayed on the HTML page. The zip file contained a single .img file, which I know to be another mountable disk image file format. Double-clicking this mounted the file as the D drive on my system:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*wU3Up7GGMha3qSGvVtlc2g.png":{"__typename":"ImageMetadata","id":"1*wU3Up7GGMha3qSGvVtlc2g.png","originalHeight":489,"originalWidth":1125,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:72a248ad8d1b_37":{"__typename":"Paragraph","id":"72a248ad8d1b_37","name":"2082","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*wU3Up7GGMha3qSGvVtlc2g.png"},"text":"The shortcut LNK (SCAN_DT6281) and hidden folder (IncomingPay)","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_38":{"__typename":"Paragraph","id":"72a248ad8d1b_38","name":"b262","type":"P","href":null,"layout":null,"metadata":null,"text":"I also noticed a hidden directory called IncomingPay, which contained a .lnk file, two text files which contained (I kid you not) excerpts from the Wikipedia page on Psychology, a .cmd file 🤔, and a .lc file 🤷.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_39":{"__typename":"Paragraph","id":"72a248ad8d1b_39","name":"40df","type":"P","href":null,"layout":null,"metadata":null,"text":"As a security professional and dutiful watcher of corporate security awareness training, all of my 🚩🚩🚩 were up and waving in the breeze. But this is for science, so I take the bait and double-click the LNK file, just as the attacker wants the victim to do. 🎣 A command line window appears for a few seconds, then disappears:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*uE61FK8e5VnRUAfJpCW0sA.png":{"__typename":"ImageMetadata","id":"1*uE61FK8e5VnRUAfJpCW0sA.png","originalHeight":515,"originalWidth":984,"focusPercentX":-1,"focusPercentY":-1,"alt":""},"Paragraph:72a248ad8d1b_40":{"__typename":"Paragraph","id":"72a248ad8d1b_40","name":"8b2f","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*uE61FK8e5VnRUAfJpCW0sA.png"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_41":{"__typename":"Paragraph","id":"72a248ad8d1b_41","name":"c07a","type":"P","href":null,"layout":null,"metadata":null,"text":"The LNK file target property is interesting:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_42":{"__typename":"Paragraph","id":"72a248ad8d1b_42","name":"7069","type":"PRE","href":null,"layout":null,"metadata":null,"text":"C:\\Windows\\System32\\cmd.exe \u002Fc IncomingPay\\Issues.cmd A B C D E F G H I J K L M N O P Q R S T U V W X Y Z 0 1 2 3 4 5 6 7 8 9","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":{"__typename":"CodeBlockMetadata","mode":"AUTO","lang":"undefined"},"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_43":{"__typename":"Paragraph","id":"72a248ad8d1b_43","name":"eda2","type":"P","href":null,"layout":null,"metadata":null,"text":"This tells me that I’ve run the Issues.cmd file located in the IncomingPay directory using CMD, which is important to know for later. Now back in Splunk, I start running queries to see what is happening on my victim VM:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*dJt2MIxLSklub6ZLxtHqig.png":{"__typename":"ImageMetadata","id":"1*dJt2MIxLSklub6ZLxtHqig.png","originalHeight":330,"originalWidth":1897,"focusPercentX":-1,"focusPercentY":-1,"alt":""},"Paragraph:72a248ad8d1b_44":{"__typename":"Paragraph","id":"72a248ad8d1b_44","name":"2fbe","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*dJt2MIxLSklub6ZLxtHqig.png"},"text":"Notice the commands logged immediately after I took the bait!","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_45":{"__typename":"Paragraph","id":"72a248ad8d1b_45","name":"1722","type":"P","href":null,"layout":null,"metadata":null,"text":"How do I know what searches to run? I don’t really, but through my experience as an analyst and researcher I know that there are certain types of evidence that may appear in my logs — process executions, file creations, network connections, and the like. This is where on-the-job experience as a security analyst, or a good dose of CTF-style trainings (like those available at CyberDefenders or LetsDefend) come in handy.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":377,"end":391,"href":"https:\u002F\u002Fcyberdefenders.org\u002F","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":395,"end":405,"href":"https:\u002F\u002Fletsdefend.io\u002F","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_46":{"__typename":"Paragraph","id":"72a248ad8d1b_46","name":"a9ed","type":"P","href":null,"layout":null,"metadata":null,"text":"After refreshing my searches a few times and wondering if I had done something wrong, I noticed a definite, incontrovertible sign of an intrusion: a burst of recon activity on my victim host:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*GvEUBnM24or7X8OioRTuaA.png":{"__typename":"ImageMetadata","id":"1*GvEUBnM24or7X8OioRTuaA.png","originalHeight":347,"originalWidth":947,"focusPercentX":-1,"focusPercentY":-1,"alt":""},"Paragraph:72a248ad8d1b_47":{"__typename":"Paragraph","id":"72a248ad8d1b_47","name":"2153","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*GvEUBnM24or7X8OioRTuaA.png"},"text":"I forgot to include in the screenshot, but the parent process for all these commands was wermgr.exe (what???)","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_48":{"__typename":"Paragraph","id":"72a248ad8d1b_48","name":"501c","type":"P","href":null,"layout":null,"metadata":null,"text":"As I was looking at these commands, I noted the time period in which they occurred — all within the span of a few seconds! Also, the processes were all spawned by an unusual parent — wermgr.exe (the Windows Error Reporting Manager). A good detection opportunity, perhaps? Event the most confused admin or overbuilt piece of [legit] software will not run all these suspicious recon commands within such a short timeframe, and never as children of a wermgr.exe. Swinging over to my network connections, I noticed that wermgr.exe had suddenly become extremely chatty with external IP addresses:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":182,"end":193,"href":"https:\u002F\u002Fstrontic.github.io\u002Fxcyclopedia\u002Flibrary\u002Fwermgr.exe-0F652BF7ADA772981E8AAB0D108FCC92.html","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":425,"end":430,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*4z-NOmsooSXa8QEMpZpwvg.png":{"__typename":"ImageMetadata","id":"1*4z-NOmsooSXa8QEMpZpwvg.png","originalHeight":407,"originalWidth":780,"focusPercentX":-1,"focusPercentY":-1,"alt":""},"Paragraph:72a248ad8d1b_49":{"__typename":"Paragraph","id":"72a248ad8d1b_49","name":"ebb5","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*4z-NOmsooSXa8QEMpZpwvg.png"},"text":"Uhhhhh………………","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_50":{"__typename":"Paragraph","id":"72a248ad8d1b_50","name":"757f","type":"P","href":null,"layout":null,"metadata":null,"text":"Following this initial assessment of my data, I determined that:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_51":{"__typename":"Paragraph","id":"72a248ad8d1b_51","name":"b936","type":"ULI","href":null,"layout":null,"metadata":null,"text":"The malware sample contained a malicious initial access vector (duh, the rogues gallery of the .html, .zip, .img, .lnk, .cmd, and .lc files).","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_52":{"__typename":"Paragraph","id":"72a248ad8d1b_52","name":"e5d7","type":"ULI","href":null,"layout":null,"metadata":null,"text":"The malware would download the zip file after opening the HTML page in a browser, and the zip file contained a mountable .img file.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_53":{"__typename":"Paragraph","id":"72a248ad8d1b_53","name":"9a98","type":"ULI","href":null,"layout":null,"metadata":null,"text":"The mounted drive contained a malicious shortcut that would result in the execution of additional commands.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_54":{"__typename":"Paragraph","id":"72a248ad8d1b_54","name":"a3c6","type":"ULI","href":null,"layout":null,"metadata":null,"text":"An injected wermgr.exe process spawned an automated burst of recon activity and then connected to suspicious external IP addresses, presumably to send the attacker information about our system and network.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_55":{"__typename":"Paragraph","id":"72a248ad8d1b_55","name":"29d3","type":"P","href":null,"layout":null,"metadata":null,"text":"In Mitre ATT&CK terms, this all amounts to Initial Access, Defense Evasion, Discovery, and Command and Control. In other words: big oof.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*nXvAlI7u5JM8xO0LdDq35g.jpeg":{"__typename":"ImageMetadata","id":"1*nXvAlI7u5JM8xO0LdDq35g.jpeg","originalHeight":504,"originalWidth":740,"focusPercentX":-1,"focusPercentY":-1,"alt":""},"Paragraph:72a248ad8d1b_56":{"__typename":"Paragraph","id":"72a248ad8d1b_56","name":"2dfa","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*nXvAlI7u5JM8xO0LdDq35g.jpeg"},"text":"Rogues Gallery","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_57":{"__typename":"Paragraph","id":"72a248ad8d1b_57","name":"3ad6","type":"H3","href":null,"layout":null,"metadata":null,"text":"Breaking Down the Attack into Detection Building Blocks","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_58":{"__typename":"Paragraph","id":"72a248ad8d1b_58","name":"0e45","type":"P","href":null,"layout":null,"metadata":null,"text":"Having performed an initial execution of the QakBot HTML smuggling technique in the lab and reverted to my VM snapshots, it was time to dig further into the logs to see what was happening.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:0*nHIUWxrtQ-a1nA9A.jpg":{"__typename":"ImageMetadata","id":"0*nHIUWxrtQ-a1nA9A.jpg","originalHeight":410,"originalWidth":609,"focusPercentX":-1,"focusPercentY":-1,"alt":""},"Paragraph:72a248ad8d1b_59":{"__typename":"Paragraph","id":"72a248ad8d1b_59","name":"56f3","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:0*nHIUWxrtQ-a1nA9A.jpg"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_60":{"__typename":"Paragraph","id":"72a248ad8d1b_60","name":"452e","type":"P","href":null,"layout":null,"metadata":null,"text":"As I reviewed the various types of events generated by the attack, I began to develop a plain-language narrative understanding of what was happening:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_61":{"__typename":"Paragraph","id":"72a248ad8d1b_61","name":"d227","type":"BQ","href":null,"layout":null,"metadata":null,"text":"“An attacker sends a victim an HTML file that purports to contain a report, invoice, or other document of interest to them. Basically, a phishing lure. When the victim opens the file in their browser, embedded JavaScript code executes, which downloads or builds a password-protected zip file on the victim’s system. When the victim unzips the archive, the extraction creates a mountable disk image file. After mounting the drive, the user sees a shortcut that they believe will take them to the resource they are trying to find. But the shortcut actually calls a command or scripting interpreter that executes other malicious files that are hidden on the disk drive, leading to initial access compromise.”","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"STRONG","start":13,"end":18,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":168,"end":182,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":242,"end":291,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":332,"end":350,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":367,"end":386,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":410,"end":428,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":601,"end":632,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_62":{"__typename":"Paragraph","id":"72a248ad8d1b_62","name":"a04e","type":"P","href":null,"layout":null,"metadata":null,"text":"That’s a wordy chunk of prose right there, but it makes sense in my head. If I am going to detect something, I need to understand it first! Note the bold text: I used my narrative to highlight events that I could use to detect the attack chain. Based on this review, I analyzed the logs from the attack, trying to isolate the following events:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_63":{"__typename":"Paragraph","id":"72a248ad8d1b_63","name":"d78f","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Phishing email sent to victim containing an HTML attachment.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_64":{"__typename":"Paragraph","id":"72a248ad8d1b_64","name":"0025","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Creation of an HTML file in suspicious locations.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_65":{"__typename":"Paragraph","id":"72a248ad8d1b_65","name":"d8bf","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Opening of a stand-alone HTML file in a browser application.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_66":{"__typename":"Paragraph","id":"72a248ad8d1b_66","name":"6cf8","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Download\u002Fcreation of a zip file by the browser application.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_67":{"__typename":"Paragraph","id":"72a248ad8d1b_67","name":"9fe5","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Opening\u002Fextraction of a password-protected zip file.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_68":{"__typename":"Paragraph","id":"72a248ad8d1b_68","name":"de0f","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Creation of a mountable disk drive file format (.iso, .img, etc).","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_69":{"__typename":"Paragraph","id":"72a248ad8d1b_69","name":"5441","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Mounting a drive.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_70":{"__typename":"Paragraph","id":"72a248ad8d1b_70","name":"1cd6","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Process execution on an external drive (either from an executable on that drive, or system executable touching files on that drive).","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_71":{"__typename":"Paragraph","id":"72a248ad8d1b_71","name":"2a9d","type":"P","href":null,"layout":null,"metadata":null,"text":"Whew! That’s…a lot of events.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_72":{"__typename":"Paragraph","id":"72a248ad8d1b_72","name":"d2ea","type":"H4","href":null,"layout":null,"metadata":null,"text":"The Good News","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_73":{"__typename":"Paragraph","id":"72a248ad8d1b_73","name":"4ba5","type":"P","href":null,"layout":null,"metadata":null,"text":"The good news was, there are ways to detect nearly every event listed above! This means I had numerous ideas for how to query and filter available logs to extract the meaningful events (building blocks) for future detections.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_74":{"__typename":"Paragraph","id":"72a248ad8d1b_74","name":"0b25","type":"H4","href":null,"layout":null,"metadata":null,"text":"The Bad News","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_75":{"__typename":"Paragraph","id":"72a248ad8d1b_75","name":"b677","type":"P","href":null,"layout":null,"metadata":null,"text":"The bad news was, none of these many events is, on its own, malicious. Again, there is no YOU HAVE BEEN HACKED log: each one of these events could occur in the course of normal business and be completely safe and benign. The solution would be to correlate these events, in an ordered or unordered sequence, grouping them by a common attribute like hostname, and triggering an alert when all of these occur within a time window, like an hour. The problem is, from my analysis and testing (more on that in a moment), chaining or correlating that many events would result in a brittle detection.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":527,"end":538,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_76":{"__typename":"Paragraph","id":"72a248ad8d1b_76","name":"499c","type":"H4","href":null,"layout":null,"metadata":null,"text":"Brittle vs. Resilient","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_77":{"__typename":"Paragraph","id":"72a248ad8d1b_77","name":"d794","type":"P","href":null,"layout":null,"metadata":null,"text":"“Brittleness” describes the degree to which a detection idea falls apart in the face of subtle changes to attacker techniques, variations in actions performed by the victim, problems with logging, or other factors outside of our control. Brittle detections contrast with “resilient” detections, which are flexible and can withstand these subtle shifts.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_78":{"__typename":"Paragraph","id":"72a248ad8d1b_78","name":"4a73","type":"P","href":null,"layout":null,"metadata":null,"text":"It’s not as simple as saying “Brittle = bad and resilient = good.” A brittle detection could be highly-targeted, with a narrow “aperture.” The advantage could be that, if a brittle detection rule fires, there is a very high probability that it is a true positive. Resilient detections may have a wider aperture and may match more potential malicious activity. However, this could lead to false positives and a frustrated SOC if they are not developed with care.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_79":{"__typename":"Paragraph","id":"72a248ad8d1b_79","name":"96f3","type":"P","href":null,"layout":null,"metadata":null,"text":"With this in mind, I returned to my list of events from above.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_80":{"__typename":"Paragraph","id":"72a248ad8d1b_80","name":"dfd6","type":"H4","href":null,"layout":null,"metadata":null,"text":"Determining the Building Blocks to Test","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_81":{"__typename":"Paragraph","id":"72a248ad8d1b_81","name":"8ff4","type":"P","href":null,"layout":null,"metadata":null,"text":"In context, I realized that items one through three in the list above may not be good components of my HTML Smuggling detection. Lack of visibility and a high volume of innocent behavior would hinder item 1. I struck item two because I had limited ability to test this event, and item three proved unreliable depending on which browser I used. Plus, while not technically HTML Smuggling, a lot of QakBot activity uses URLs, rather than stand-alone HTML files, to deliver the initial payload.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_82":{"__typename":"Paragraph","id":"72a248ad8d1b_82","name":"1ee9","type":"P","href":null,"layout":null,"metadata":null,"text":"Item five (extraction of a password-protected zip file) has lots of potential, and can be detected using this rule written by Florian Roth and inspired by the research of @SBousseaden. However, I left it out of my scope because 1) that event was not logging in my lab and 2) some documentation indicates that it is only applicable to certain operating systems.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":105,"end":114,"href":"https:\u002F\u002Fgithub.com\u002FSigmaHQ\u002Fsigma\u002Fblob\u002Fmaster\u002Frules\u002Fwindows\u002Fbuiltin\u002Fsecurity\u002Fwin_security_susp_opened_encrypted_zip.yml","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":171,"end":183,"href":"https:\u002F\u002Ftwitter.com\u002FSBousseaden","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_83":{"__typename":"Paragraph","id":"72a248ad8d1b_83","name":"ee12","type":"P","href":null,"layout":null,"metadata":null,"text":"After exploring my data, enumerating possible detection building blocks for my correlation, and winnowing that list down based on further analysis, I had the following building blocks:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_84":{"__typename":"Paragraph","id":"72a248ad8d1b_84","name":"cb2d","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Web Browser Creates (Downloads) Zip Archive File (represents opening the malicious HTML file in a browser).","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":0,"end":107,"href":"https:\u002F\u002Fgithub.com\u002Fmbabinski\u002FSigma-Rules\u002Fblob\u002Fmain\u002F2022_HTMLSmuggling\u002F1_win_zipfile_drop.yml","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_85":{"__typename":"Paragraph","id":"72a248ad8d1b_85","name":"9406","type":"OLI","href":null,"layout":null,"metadata":null,"text":"ISO, VHD, LNK or IMG File Extracted from Zip (extracting the malicious disk image file).","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":0,"end":88,"href":"https:\u002F\u002Fgithub.com\u002Fmbabinski\u002FSigma-Rules\u002Fblob\u002Fmain\u002F2022_HTMLSmuggling\u002F2_win_susp_file_extraction.yml","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_86":{"__typename":"Paragraph","id":"72a248ad8d1b_86","name":"0dc5","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Disk Image Mount (mounting the image — this one I pulled directly from Sigma).","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":0,"end":78,"href":"https:\u002F\u002Fgithub.com\u002Fmbabinski\u002FSigma-Rules\u002Fblob\u002Fmain\u002F2022_HTMLSmuggling\u002F3_win_security_iso_mount.yml","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_87":{"__typename":"Paragraph","id":"72a248ad8d1b_87","name":"968b","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Suspicious User-Initiated Process Execution on External Drive (clicking the .lnk file which runs or references files on the external drive).","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":0,"end":140,"href":"https:\u002F\u002Fgithub.com\u002Fmbabinski\u002FSigma-Rules\u002Fblob\u002Fmain\u002F2022_HTMLSmuggling\u002F4_win_process_creation_ext_drive.yml","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_88":{"__typename":"Paragraph","id":"72a248ad8d1b_88","name":"7194","type":"P","href":null,"layout":null,"metadata":null,"text":"With these building block concepts in place, I wrote or adapted a query and Sigma rule for each one, then correlated them into a chain rule.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_89":{"__typename":"Paragraph","id":"72a248ad8d1b_89","name":"d934","type":"H3","href":null,"layout":null,"metadata":null,"text":"Sigma Correlations","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_90":{"__typename":"Paragraph","id":"72a248ad8d1b_90","name":"a065","type":"P","href":null,"layout":null,"metadata":null,"text":"Correlation allows us to track log events through time. Rather than triggering an alert for each of the four events listed above, a chain rule correlation allows us to alert only when all four events occur in order on the same host by the same user, which is much more suspicious. Many SIEM products and their corresponding query languages support this type of chaining (although some do not).","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_91":{"__typename":"Paragraph","id":"72a248ad8d1b_91","name":"6db6","type":"P","href":null,"layout":null,"metadata":null,"text":"To support this functionality, Sigma has a Correlations standard in progress that will allow us to write custom correlation rules in a common format then convert them to whatever SIEM product supports this logic. The draft standard can be reviewed here:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_92":{"__typename":"Paragraph","id":"72a248ad8d1b_92","name":"2361","type":"MIXTAPE_EMBED","href":null,"layout":null,"metadata":null,"text":"sigma-specification\u002FSigma_Correlations.md at main · SigmaHQ\u002Fsigma-specification\nSigma correlations is a new YAML-based extension that allows the expression of aggregations and relationships between…github.com","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":0,"end":208,"href":"https:\u002F\u002Fgithub.com\u002FSigmaHQ\u002Fsigma-specification\u002Fblob\u002Fmain\u002Fwip\u002FSigma_Correlations.md#temporal-proximity-temporal","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":0,"end":79,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":80,"end":198,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":{"__typename":"MixtapeMetadata","href":"https:\u002F\u002Fgithub.com\u002FSigmaHQ\u002Fsigma-specification\u002Fblob\u002Fmain\u002Fwip\u002FSigma_Correlations.md#temporal-proximity-temporal","mediaResource":{"__typename":"MediaResource","mediumCatalog":null},"thumbnailImageId":"0*HauLSq_zxp26dzLm"}},"Paragraph:72a248ad8d1b_93":{"__typename":"Paragraph","id":"72a248ad8d1b_93","name":"df6d","type":"P","href":null,"layout":null,"metadata":null,"text":"What might this look like? It’s a draft standard, and subject to change, but a simple example of a brute force chain rule might look like this:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"STRONG","start":27,"end":71,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_94":{"__typename":"Paragraph","id":"72a248ad8d1b_94","name":"ceed","type":"PRE","href":null,"layout":null,"metadata":null,"text":"action: correlation\ntype: temporal\nrule:\n    - many_failed_logins\n    - successful_login\ngroup-by:\n    - User\ntimespan: 1h\nordered: true","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":{"__typename":"CodeBlockMetadata","mode":"EXPLICIT","lang":"yaml"},"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_95":{"__typename":"Paragraph","id":"72a248ad8d1b_95","name":"f93e","type":"P","href":null,"layout":null,"metadata":null,"text":"When the rule query “many_failed_logins” is matched followed by the “successful_login” rule within a one hour window, the correlation rule will fire. For a good example of a SIEM product that supports correlations, check out SumoLogic chain rules.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":225,"end":246,"href":"https:\u002F\u002Fhelp.sumologic.com\u002Fdocs\u002Fcse\u002Frules\u002Fwrite-chain-rule\u002F#:~:text=About%20Chain%20rules%E2%80%8B&text=In%20a%20Chain%20rule%20you,rule%20expressions%20in%20the%20rule.","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_96":{"__typename":"Paragraph","id":"72a248ad8d1b_96","name":"596c","type":"P","href":null,"layout":null,"metadata":null,"text":"My draft correlations rule looks like this:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_97":{"__typename":"Paragraph","id":"72a248ad8d1b_97","name":"27f5","type":"PRE","href":null,"layout":null,"metadata":null,"text":"title: HTML Smuggling Activity - Chain Rule\nid: 0952f2fa-e29b-4eb5-831c-ce21520c56e3\nstatus: experimental\ndescription: Detects HTML smuggling-style compromise (such as HTML \u003E ZIP \u003E ISO\u002FIMG\u002FVHD \u003E CMD\u002FBAT\u002FVBS \u003E DLL). Includes rules to detect zipfile dropped by browser, ISO\u002FIMG\u002FVHD\u002FLNK file extraction, disk image mount, followed by user-initiated process creation on an external drive.\nreferences:\n    - https:\u002F\u002Fblog.talosintelligence.com\u002Fhtml-smugglers-turn-to-svg-images\u002F#:~:text=HTML%20smuggling%20is%20a%20technique,directly%20on%20the%20victim's%20device.\n    - https:\u002F\u002Fwww.malwarebytes.com\u002Fblog\u002Fnews\u002F2021\u002F11\u002Fevasive-maneuvers-html-smuggling-explained\n    - Original research and analysis performed off of QakBot intelligence gathered at https:\u002F\u002Fgithub.com\u002Fpr0xylife\u002FQakbot, https:\u002F\u002Fwww.malware-traffic-analysis.net\u002F, and https:\u002F\u002Fgithub.com\u002Fexecutemalware\u002FMalware-IOCs\nauthor: Micah Babinski\ndate: 2022\u002F12\u002F27\ntags:\n    - attack.s0650\n    - attack.s0483\n    - attack.initial_access\n    - attack.defense_evasion\n    - attack.execution\n    - attack.t1564\n    - attack.t1566.001\n    - attack.t1566\n    - attack.t1027\n    - attack.t1027.006\n    - attack.t1059\n    - attack.t1204\n    - attack.t1204.002\naction: correlation\ntype: temporal\nrule:\n    - 1_win_zipfile_drop.yml\n    - 2_win_susp_file_extraction.yml\n    - 3_win_security_iso_mount.yml\n    - 4_win_process_creation_ext_drive.yml\ngroup-by:\n    - ComputerName\n    - User\ntimespan: 1h\nordered: true\nfalsepositives:\n    - Unknown\nlevel: high","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":{"__typename":"CodeBlockMetadata","mode":"EXPLICIT","lang":"yaml"},"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_98":{"__typename":"Paragraph","id":"72a248ad8d1b_98","name":"3bfd","type":"P","href":null,"layout":null,"metadata":null,"text":"This looks like many other Sigma rules you may have seen before, but has some unique elements. The action and type statements let you know this is a correlation rule of the temporal type. The four rules listed show the component rules in scope (these must be in the same directory as the correlation). The timespan specifies that the four participating rules must fire within one hour of each other, and the group-by statement defines fields in the rules which relate them to each other. Finally, the ordered: true statement lets Sigma know that these rules should occur in sequence.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"STRONG","start":197,"end":202,"href":"","anchorType":"LINK","userId":"","linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":306,"end":314,"href":"","anchorType":"LINK","userId":"","linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":408,"end":416,"href":"","anchorType":"LINK","userId":"","linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":501,"end":514,"href":"","anchorType":"LINK","userId":"","linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_99":{"__typename":"Paragraph","id":"72a248ad8d1b_99","name":"44c3","type":"BQ","href":null,"layout":null,"metadata":null,"text":"Again, the Sigma Correlations specification is in development, and is subject to change. Still, this will be a very useful expansion of Sigma’s capabilities, so I wanted to preview it for you now!","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_100":{"__typename":"Paragraph","id":"72a248ad8d1b_100","name":"0aa6","type":"H3","href":null,"layout":null,"metadata":null,"text":"Testing the Correlation","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_101":{"__typename":"Paragraph","id":"72a248ad8d1b_101","name":"607b","type":"P","href":null,"layout":null,"metadata":null,"text":"With this detection concept taking shape, and a hypothesis developed in the form of my correlation rule, it was time to test the detection with a larger sample size. I relied on the MalwareBazaar repository from Abuse.ch, which provides a helpful library of tagged malware samples. I downloaded 10 QakBot HTML samples, mostly reported by pr0xylife, ranging in date first seen from July 11 to December 22, 2022. I prepared the samples on my lab VM, and named each one according to its first seen date and its “humanhash” property (a random, unique sequence of human-readable words, such as (“dakota-earth-mockingbird-march”):","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*m86g4e3G5O47pk_O7Qiz0Q.png":{"__typename":"ImageMetadata","id":"1*m86g4e3G5O47pk_O7Qiz0Q.png","originalHeight":524,"originalWidth":961,"focusPercentX":-1,"focusPercentY":-1,"alt":""},"Paragraph:72a248ad8d1b_102":{"__typename":"Paragraph","id":"72a248ad8d1b_102","name":"8503","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*m86g4e3G5O47pk_O7Qiz0Q.png"},"text":"My 10 lovely HTML smuggling samples all ready to test","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_103":{"__typename":"Paragraph","id":"72a248ad8d1b_103","name":"75f3","type":"P","href":null,"layout":null,"metadata":null,"text":"To track my results, I made a simple table in Google Sheets:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*3xHm84vu77udS0JgtMRMaw.png":{"__typename":"ImageMetadata","id":"1*3xHm84vu77udS0JgtMRMaw.png","originalHeight":252,"originalWidth":1206,"focusPercentX":-1,"focusPercentY":-1,"alt":""},"Paragraph:72a248ad8d1b_104":{"__typename":"Paragraph","id":"72a248ad8d1b_104","name":"6c0d","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*3xHm84vu77udS0JgtMRMaw.png"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_105":{"__typename":"Paragraph","id":"72a248ad8d1b_105","name":"915e","type":"P","href":null,"layout":null,"metadata":null,"text":"I made a clean, pre-test snapshot of my victim VM host to revert back to after each test, and started in on the test. After testing seven of the ten samples, my sequence of four building blocks had perfect coverage! When I hit the eighth sample, however, the fourth rule in the chain did not fire, because the .lnk file called RunDLL32.exe directly, instead of cmd.exe or wscript.exe. This was fine — I simply made an adjustment to the conditions of my Sigma rule, retested, and got perfect matches! I was delighted with the results and excited to share the detection use case with the community.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_106":{"__typename":"Paragraph","id":"72a248ad8d1b_106","name":"a3e0","type":"H4","href":null,"layout":null,"metadata":null,"text":"Bonus Round!","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_107":{"__typename":"Paragraph","id":"72a248ad8d1b_107","name":"fe9d","type":"P","href":null,"layout":null,"metadata":null,"text":"Many QakBot phishing attacks do not use .html attachments, but instead use malicious .pdf files with embedded links, or just good old-fashioned phishing links that point to zip files hosted on a compromised website. To test whether my detection was flexible enough to catch these instances as well, I tested them on a couple of recent examples from the IOC repository maintained by @ExecuteMalware, and found that these URL-based driveby attacks were also caught by the detection. The one documented here even included a .wsf (Windows Script File) — a file type with which I was unfamiliar but was nonetheless caught by my detection.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*biWXEKLHEEun4BZ2LrL7dg.png":{"__typename":"ImageMetadata","id":"1*biWXEKLHEEun4BZ2LrL7dg.png","originalHeight":507,"originalWidth":1529,"focusPercentX":-1,"focusPercentY":-1,"alt":""},"Paragraph:72a248ad8d1b_108":{"__typename":"Paragraph","id":"72a248ad8d1b_108","name":"648a","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*biWXEKLHEEun4BZ2LrL7dg.png"},"text":"Windows Script File (.wsf) Delivered During a Recent QakBot Attack","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_109":{"__typename":"Paragraph","id":"72a248ad8d1b_109","name":"6aff","type":"P","href":null,"layout":null,"metadata":null,"text":"Hooray for resilience!","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_110":{"__typename":"Paragraph","id":"72a248ad8d1b_110","name":"68d9","type":"H3","href":null,"layout":null,"metadata":null,"text":"Conclusion","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_111":{"__typename":"Paragraph","id":"72a248ad8d1b_111","name":"367a","type":"P","href":null,"layout":null,"metadata":null,"text":"Congratulations! You’ve reached the end of a lengthy post about some dense, complicated topics. You can find all the rules referenced here. Thank you for reading, and I hope you’ve enjoyed my ramblings on QakBot, HTML Smuggling, Sigma, and correlations. I am truly excited for Sigma Correlations to launch. It will be a big win for the detection engineering community and will allow us to share more sophisticated detection use cases.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":134,"end":138,"href":"https:\u002F\u002Fgithub.com\u002Fmbabinski\u002FSigma-Rules\u002Ftree\u002Fmain\u002F2022_HTMLSmuggling","anchorType":"LINK","userId":"","linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_112":{"__typename":"Paragraph","id":"72a248ad8d1b_112","name":"6b08","type":"P","href":null,"layout":null,"metadata":null,"text":"I was really pleased with how my tests went, particularly when it showed that one of the building blocks in my chain rule had failed and needed adjustment! After all, why test if you think your work is already perfect? Lastly, this experience drove home for me what I had already started to believe — that we can’t detect what we don’t understand. There’s no substitute for first-hand experience with real live malware if you are trying to see what it does.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_113":{"__typename":"Paragraph","id":"72a248ad8d1b_113","name":"b9a4","type":"P","href":null,"layout":null,"metadata":null,"text":"Thanks to the Detection Lab project that I’ve enthused about in previous posts, this real-life experience is in reach for more people than ever. Lastly, thanks to pr0xylife, Brad (malware_traffic), and executemalware for providing pristine repositories of well-documented QakBot malware samples for us to access, analyze, and understand. These are truly an educational treasure trove!","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_114":{"__typename":"Paragraph","id":"72a248ad8d1b_114","name":"6054","type":"P","href":null,"layout":null,"metadata":null,"text":"Please feel free to send me ideas, comments, or suggestions on how I can improve. I am still new to this, and I welcome respectful feedback and critique in any form.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:72a248ad8d1b_115":{"__typename":"Paragraph","id":"72a248ad8d1b_115","name":"dbe3","type":"P","href":null,"layout":null,"metadata":null,"text":"As always, happy analyzing! 🧐","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"UserViewerEdge:userId:47a061e2b431-viewerId:lo_bc0227835f94":{"__typename":"UserViewerEdge","id":"userId:47a061e2b431-viewerId:lo_bc0227835f94","isMuting":false},"PostViewerEdge:postId:5adefebb6841-viewerId:lo_bc0227835f94":{"__typename":"PostViewerEdge","shouldIndexPostForExternalSearch":true,"id":"postId:5adefebb6841-viewerId:lo_bc0227835f94"},"Tag:cybersecurity":{"__typename":"Tag","id":"cybersecurity","displayTitle":"Cybersecurity","normalizedTagSlug":"cybersecurity"},"Tag:malware":{"__typename":"Tag","id":"malware","displayTitle":"Malware","normalizedTagSlug":"malware"},"Tag:detection-engineering":{"__typename":"Tag","id":"detection-engineering","displayTitle":"Detection Engineering","normalizedTagSlug":"detection-engineering"},"Tag:information-security":{"__typename":"Tag","id":"information-security","displayTitle":"Information Security","normalizedTagSlug":"information-security"},"Tag:threat-intelligence":{"__typename":"Tag","id":"threat-intelligence","displayTitle":"Threat Intelligence","normalizedTagSlug":"threat-intelligence"},"Post:5adefebb6841":{"__typename":"Post","id":"5adefebb6841","collection":null,"content({\"postMeteringOptions\":{}})":{"__typename":"PostContent","isLockedPreviewOnly":false,"bodyModel":{"__typename":"RichText","sections":[{"__typename":"Section","name":"d986","startIndex":0,"textLayout":null,"imageLayout":null,"backgroundImage":null,"videoLayout":null,"backgroundVideo":null},{"__typename":"Section","name":"292c","startIndex":7,"textLayout":null,"imageLayout":null,"backgroundImage":null,"videoLayout":null,"backgroundVideo":null}],"paragraphs":[{"__ref":"Paragraph:72a248ad8d1b_0"},{"__ref":"Paragraph:72a248ad8d1b_1"},{"__ref":"Paragraph:72a248ad8d1b_2"},{"__ref":"Paragraph:72a248ad8d1b_3"},{"__ref":"Paragraph:72a248ad8d1b_4"},{"__ref":"Paragraph:72a248ad8d1b_5"},{"__ref":"Paragraph:72a248ad8d1b_6"},{"__ref":"Paragraph:72a248ad8d1b_7"},{"__ref":"Paragraph:72a248ad8d1b_8"},{"__ref":"Paragraph:72a248ad8d1b_9"},{"__ref":"Paragraph:72a248ad8d1b_10"},{"__ref":"Paragraph:72a248ad8d1b_11"},{"__ref":"Paragraph:72a248ad8d1b_12"},{"__ref":"Paragraph:72a248ad8d1b_13"},{"__ref":"Paragraph:72a248ad8d1b_14"},{"__ref":"Paragraph:72a248ad8d1b_15"},{"__ref":"Paragraph:72a248ad8d1b_16"},{"__ref":"Paragraph:72a248ad8d1b_17"},{"__ref":"Paragraph:72a248ad8d1b_18"},{"__ref":"Paragraph:72a248ad8d1b_19"},{"__ref":"Paragraph:72a248ad8d1b_20"},{"__ref":"Paragraph:72a248ad8d1b_21"},{"__ref":"Paragraph:72a248ad8d1b_22"},{"__ref":"Paragraph:72a248ad8d1b_23"},{"__ref":"Paragraph:72a248ad8d1b_24"},{"__ref":"Paragraph:72a248ad8d1b_25"},{"__ref":"Paragraph:72a248ad8d1b_26"},{"__ref":"Paragraph:72a248ad8d1b_27"},{"__ref":"Paragraph:72a248ad8d1b_28"},{"__ref":"Paragraph:72a248ad8d1b_29"},{"__ref":"Paragraph:72a248ad8d1b_30"},{"__ref":"Paragraph:72a248ad8d1b_31"},{"__ref":"Paragraph:72a248ad8d1b_32"},{"__ref":"Paragraph:72a248ad8d1b_33"},{"__ref":"Paragraph:72a248ad8d1b_34"},{"__ref":"Paragraph:72a248ad8d1b_35"},{"__ref":"Paragraph:72a248ad8d1b_36"},{"__ref":"Paragraph:72a248ad8d1b_37"},{"__ref":"Paragraph:72a248ad8d1b_38"},{"__ref":"Paragraph:72a248ad8d1b_39"},{"__ref":"Paragraph:72a248ad8d1b_40"},{"__ref":"Paragraph:72a248ad8d1b_41"},{"__ref":"Paragraph:72a248ad8d1b_42"},{"__ref":"Paragraph:72a248ad8d1b_43"},{"__ref":"Paragraph:72a248ad8d1b_44"},{"__ref":"Paragraph:72a248ad8d1b_45"},{"__ref":"Paragraph:72a248ad8d1b_46"},{"__ref":"Paragraph:72a248ad8d1b_47"},{"__ref":"Paragraph:72a248ad8d1b_48"},{"__ref":"Paragraph:72a248ad8d1b_49"},{"__ref":"Paragraph:72a248ad8d1b_50"},{"__ref":"Paragraph:72a248ad8d1b_51"},{"__ref":"Paragraph:72a248ad8d1b_52"},{"__ref":"Paragraph:72a248ad8d1b_53"},{"__ref":"Paragraph:72a248ad8d1b_54"},{"__ref":"Paragraph:72a248ad8d1b_55"},{"__ref":"Paragraph:72a248ad8d1b_56"},{"__ref":"Paragraph:72a248ad8d1b_57"},{"__ref":"Paragraph:72a248ad8d1b_58"},{"__ref":"Paragraph:72a248ad8d1b_59"},{"__ref":"Paragraph:72a248ad8d1b_60"},{"__ref":"Paragraph:72a248ad8d1b_61"},{"__ref":"Paragraph:72a248ad8d1b_62"},{"__ref":"Paragraph:72a248ad8d1b_63"},{"__ref":"Paragraph:72a248ad8d1b_64"},{"__ref":"Paragraph:72a248ad8d1b_65"},{"__ref":"Paragraph:72a248ad8d1b_66"},{"__ref":"Paragraph:72a248ad8d1b_67"},{"__ref":"Paragraph:72a248ad8d1b_68"},{"__ref":"Paragraph:72a248ad8d1b_69"},{"__ref":"Paragraph:72a248ad8d1b_70"},{"__ref":"Paragraph:72a248ad8d1b_71"},{"__ref":"Paragraph:72a248ad8d1b_72"},{"__ref":"Paragraph:72a248ad8d1b_73"},{"__ref":"Paragraph:72a248ad8d1b_74"},{"__ref":"Paragraph:72a248ad8d1b_75"},{"__ref":"Paragraph:72a248ad8d1b_76"},{"__ref":"Paragraph:72a248ad8d1b_77"},{"__ref":"Paragraph:72a248ad8d1b_78"},{"__ref":"Paragraph:72a248ad8d1b_79"},{"__ref":"Paragraph:72a248ad8d1b_80"},{"__ref":"Paragraph:72a248ad8d1b_81"},{"__ref":"Paragraph:72a248ad8d1b_82"},{"__ref":"Paragraph:72a248ad8d1b_83"},{"__ref":"Paragraph:72a248ad8d1b_84"},{"__ref":"Paragraph:72a248ad8d1b_85"},{"__ref":"Paragraph:72a248ad8d1b_86"},{"__ref":"Paragraph:72a248ad8d1b_87"},{"__ref":"Paragraph:72a248ad8d1b_88"},{"__ref":"Paragraph:72a248ad8d1b_89"},{"__ref":"Paragraph:72a248ad8d1b_90"},{"__ref":"Paragraph:72a248ad8d1b_91"},{"__ref":"Paragraph:72a248ad8d1b_92"},{"__ref":"Paragraph:72a248ad8d1b_93"},{"__ref":"Paragraph:72a248ad8d1b_94"},{"__ref":"Paragraph:72a248ad8d1b_95"},{"__ref":"Paragraph:72a248ad8d1b_96"},{"__ref":"Paragraph:72a248ad8d1b_97"},{"__ref":"Paragraph:72a248ad8d1b_98"},{"__ref":"Paragraph:72a248ad8d1b_99"},{"__ref":"Paragraph:72a248ad8d1b_100"},{"__ref":"Paragraph:72a248ad8d1b_101"},{"__ref":"Paragraph:72a248ad8d1b_102"},{"__ref":"Paragraph:72a248ad8d1b_103"},{"__ref":"Paragraph:72a248ad8d1b_104"},{"__ref":"Paragraph:72a248ad8d1b_105"},{"__ref":"Paragraph:72a248ad8d1b_106"},{"__ref":"Paragraph:72a248ad8d1b_107"},{"__ref":"Paragraph:72a248ad8d1b_108"},{"__ref":"Paragraph:72a248ad8d1b_109"},{"__ref":"Paragraph:72a248ad8d1b_110"},{"__ref":"Paragraph:72a248ad8d1b_111"},{"__ref":"Paragraph:72a248ad8d1b_112"},{"__ref":"Paragraph:72a248ad8d1b_113"},{"__ref":"Paragraph:72a248ad8d1b_114"},{"__ref":"Paragraph:72a248ad8d1b_115"}]},"validatedShareKey":"","shareKeyCreator":null},"creator":{"__ref":"User:47a061e2b431"},"inResponseToEntityType":null,"isLocked":false,"isMarkedPaywallOnly":false,"lockedSource":"LOCKED_POST_SOURCE_NONE","mediumUrl":"https:\u002F\u002Fmicahbabinski.medium.com\u002Fhtml-smuggling-detection-5adefebb6841","primaryTopic":null,"topics":[{"__typename":"Topic","slug":"cybersecurity"}],"isPublished":true,"latestPublishedVersion":"72a248ad8d1b","visibility":"PUBLIC","postResponses":{"__typename":"PostResponses","count":1},"clapCount":23,"allowResponses":true,"isLimitedState":false,"title":"HTML Smuggling Detection","isSeries":false,"sequence":null,"uniqueSlug":"html-smuggling-detection-5adefebb6841","socialTitle":"","socialDek":"","canonicalUrl":"","metaDescription":"","latestPublishedAt":1672236137056,"readingTime":14.695283018867924,"previewContent":{"__typename":"PreviewContent","subtitle":"Introduction"},"previewImage":{"__ref":"ImageMetadata:1*5P6AoNfhFJraUVFkpN1NXw.jpeg"},"isShortform":false,"seoTitle":"","firstPublishedAt":1672235902794,"updatedAt":1672236144936,"shortformType":"SHORTFORM_TYPE_LINK","seoDescription":"","viewerEdge":{"__ref":"PostViewerEdge:postId:5adefebb6841-viewerId:lo_bc0227835f94"},"isSuspended":false,"license":"ALL_RIGHTS_RESERVED","tags":[{"__ref":"Tag:cybersecurity"},{"__ref":"Tag:malware"},{"__ref":"Tag:detection-engineering"},{"__ref":"Tag:information-security"},{"__ref":"Tag:threat-intelligence"}],"isNewsletter":false,"statusForCollection":null,"pendingCollection":null,"detectedLanguage":"en","wordCount":3510,"layerCake":0,"responsesLocked":false}}</script><script>window.__MIDDLEWARE_STATE__={"session":{"xsrf":""},"cache":{"cacheStatus":"HIT"}}</script><script src="https://cdn-client.medium.com/lite/static/js/manifest.48bdf878.js"></script><script src="https://cdn-client.medium.com/lite/static/js/9865.1496d74a.js"></script><script src="https://cdn-client.medium.com/lite/static/js/main.872afbe3.js"></script><script src="https://cdn-client.medium.com/lite/static/js/instrumentation.d9108df7.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/reporting.ff22a7a5.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/5049.d1ead72d.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/4810.6318add7.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/6618.db187378.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/2707.a4e221ac.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/9977.933c1c9a.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/8599.73cb8339.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/5250.9f9e01d2.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/9898.d9e26c5e.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/2648.26563adf.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/8393.826a25fb.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/4863.28ab43f6.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/6589.247b1d02.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/5642.0f82ef97.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/6546.cd03f950.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/6834.8aa8d357.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/2420.2a5e2d95.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/839.1c286b32.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/7975.60bcefe8.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/2106.0350840b.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/7394.73a57633.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/5794.9e8ff5dd.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/8204.7749bc66.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/4391.59acaed3.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/PostPage.MainContent.2dc8b1c6.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/8414.6565ad5f.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/3974.8d3e0217.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/2527.d5e0c2f5.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/PostResponsesContent.7ad7ca92.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/responses.editor.5a11f4da.chunk.js"></script><script>window.main();</script><script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'8f3b5b882c7de131',t:'MTczNDQ4NTExMS4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script><script defer src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon='{"rayId":"8f3b5b882c7de131","version":"2024.10.5","serverTiming":{"name":{"cfExtPri":true,"cfL4":true,"cfSpeedBrain":true,"cfCacheStatus":true}},"token":"0b5f665943484354a59c39c6833f7078","b":1}' crossorigin="anonymous"></script>
</body></html>