<!doctype html><html lang="en"><head><title data-rh="true">The chronicles of Bumblebee: The Hook, the Bee, and the Trickbot connection | by Eli Salem | Medium</title><meta data-rh="true" charset="utf-8"/><meta data-rh="true" name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1,maximum-scale=1"/><meta data-rh="true" name="theme-color" content="#000000"/><meta data-rh="true" name="twitter:app:name:iphone" content="Medium"/><meta data-rh="true" name="twitter:app:id:iphone" content="828256236"/><meta data-rh="true" property="al:ios:app_name" content="Medium"/><meta data-rh="true" property="al:ios:app_store_id" content="828256236"/><meta data-rh="true" property="al:android:package" content="com.medium.reader"/><meta data-rh="true" property="fb:app_id" content="542599432471018"/><meta data-rh="true" property="og:site_name" content="Medium"/><meta data-rh="true" property="og:type" content="article"/><meta data-rh="true" property="article:published_time" content="2022-04-27T06:29:27.963Z"/><meta data-rh="true" name="title" content="The chronicles of Bumblebee: The Hook, the Bee, and the Trickbot connection | by Eli Salem | Medium"/><meta data-rh="true" property="og:title" content="The chronicles of Bumblebee: The Hook, the Bee, and the Trickbot connection"/><meta data-rh="true" property="al:android:url" content="medium://p/686379311056"/><meta data-rh="true" property="al:ios:url" content="medium://p/686379311056"/><meta data-rh="true" property="al:android:app_name" content="Medium"/><meta data-rh="true" name="description" content="In late March 2022, a new malware dubbed “Bumblebee” was discovered, and reported to be distributed in phishing campaigns containing ISO files which eventually drop DLL files that contained the…"/><meta data-rh="true" property="og:description" content="In late March 2022, a new malware dubbed “Bumblebee” was discovered, and reported to be distributed in phishing campaigns containing ISO…"/><meta data-rh="true" property="og:url" content="https://elis531989.medium.com/the-chronicles-of-bumblebee-the-hook-the-bee-and-the-trickbot-connection-686379311056"/><meta data-rh="true" property="al:web:url" content="https://elis531989.medium.com/the-chronicles-of-bumblebee-the-hook-the-bee-and-the-trickbot-connection-686379311056"/><meta data-rh="true" property="og:image" content="https://miro.medium.com/v2/resize:fit:487/1*LglRPWDxARM11kMkI0pTqw.png"/><meta data-rh="true" property="article:author" content="https://elis531989.medium.com"/><meta data-rh="true" name="author" content="Eli Salem"/><meta data-rh="true" name="robots" content="index,noarchive,follow,max-image-preview:large"/><meta data-rh="true" name="referrer" content="unsafe-url"/><meta data-rh="true" property="twitter:title" content="The chronicles of Bumblebee: The Hook, the Bee, and the Trickbot connection"/><meta data-rh="true" name="twitter:site" content="@Medium"/><meta data-rh="true" name="twitter:app:url:iphone" content="medium://p/686379311056"/><meta data-rh="true" property="twitter:description" content="In late March 2022, a new malware dubbed “Bumblebee” was discovered, and reported to be distributed in phishing campaigns containing ISO…"/><meta data-rh="true" name="twitter:image:src" content="https://miro.medium.com/v2/resize:fit:487/1*LglRPWDxARM11kMkI0pTqw.png"/><meta data-rh="true" name="twitter:card" content="summary_large_image"/><meta data-rh="true" name="twitter:creator" content="@elisalem9"/><meta data-rh="true" name="twitter:label1" content="Reading time"/><meta data-rh="true" name="twitter:data1" content="17 min read"/><link data-rh="true" rel="icon" href="https://miro.medium.com/v2/5d8de952517e8160e40ef9841c781cdc14a5db313057fa3c3de41c6f5b494b19"/><link data-rh="true" rel="search" type="application/opensearchdescription+xml" title="Medium" href="/osd.xml"/><link data-rh="true" rel="apple-touch-icon" sizes="152x152" href="https://miro.medium.com/v2/resize:fill:304:304/10fd5c419ac61637245384e7099e131627900034828f4f386bdaa47a74eae156"/><link data-rh="true" rel="apple-touch-icon" sizes="120x120" href="https://miro.medium.com/v2/resize:fill:240:240/10fd5c419ac61637245384e7099e131627900034828f4f386bdaa47a74eae156"/><link data-rh="true" rel="apple-touch-icon" sizes="76x76" href="https://miro.medium.com/v2/resize:fill:152:152/10fd5c419ac61637245384e7099e131627900034828f4f386bdaa47a74eae156"/><link data-rh="true" rel="apple-touch-icon" sizes="60x60" href="https://miro.medium.com/v2/resize:fill:120:120/10fd5c419ac61637245384e7099e131627900034828f4f386bdaa47a74eae156"/><link data-rh="true" rel="mask-icon" href="https://miro.medium.com/v2/resize:fill:1000:1000/7*GAOKVe--MXbEJmV9230oOQ.png" color="#171717"/><link data-rh="true" rel="preconnect" href="https://glyph.medium.com" crossOrigin=""/><link data-rh="true" id="glyph_preload_link" rel="preload" as="style" type="text/css" href="https://glyph.medium.com/css/unbound.css"/><link data-rh="true" id="glyph_link" rel="stylesheet" type="text/css" href="https://glyph.medium.com/css/unbound.css"/><link data-rh="true" rel="author" href="https://elis531989.medium.com"/><link data-rh="true" rel="canonical" href="https://elis531989.medium.com/the-chronicles-of-bumblebee-the-hook-the-bee-and-the-trickbot-connection-686379311056"/><link data-rh="true" rel="alternate" href="android-app://com.medium.reader/https/medium.com/p/686379311056"/><script data-rh="true" type="application/ld+json">{"@context":"http:\u002F\u002Fschema.org","@type":"NewsArticle","image":["https:\u002F\u002Fmiro.medium.com\u002Fv2\u002Fresize:fit:1200\u002F1*LglRPWDxARM11kMkI0pTqw.png"],"url":"https:\u002F\u002Felis531989.medium.com\u002Fthe-chronicles-of-bumblebee-the-hook-the-bee-and-the-trickbot-connection-686379311056","dateCreated":"2022-04-27T06:29:27.963Z","datePublished":"2022-04-27T06:29:27.963Z","dateModified":"2022-04-30T02:16:01.022Z","headline":"The chronicles of Bumblebee: The Hook, the Bee, and the Trickbot connection","name":"The chronicles of Bumblebee: The Hook, the Bee, and the Trickbot connection","description":"In late March 2022, a new malware dubbed “Bumblebee” was discovered, and reported to be distributed in phishing campaigns containing ISO files which eventually drop DLL files that contained the…","identifier":"686379311056","author":{"@type":"Person","name":"Eli Salem","url":"https:\u002F\u002Felis531989.medium.com"},"creator":["Eli Salem"],"publisher":{"@type":"Organization","name":"Medium","url":"https:\u002F\u002Felis531989.medium.com\u002F","logo":{"@type":"ImageObject","width":272,"height":60,"url":"https:\u002F\u002Fmiro.medium.com\u002Fv2\u002Fresize:fit:544\u002F7*V1_7XP4snlmqrc_0Njontw.png"}},"mainEntityOfPage":"https:\u002F\u002Felis531989.medium.com\u002Fthe-chronicles-of-bumblebee-the-hook-the-bee-and-the-trickbot-connection-686379311056"}</script><style type="text/css" data-fela-rehydration="563" data-fela-type="STATIC">html{box-sizing:border-box;-webkit-text-size-adjust:100%}*, *:before, *:after{box-sizing:inherit}body{margin:0;padding:0;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;color:rgba(0,0,0,0.8);position:relative;min-height:100vh}h1, h2, h3, h4, h5, h6, dl, dd, ol, ul, menu, figure, blockquote, p, pre, form{margin:0}menu, ol, ul{padding:0;list-style:none;list-style-image:none}main{display:block}a{color:inherit;text-decoration:none}a, button, input{-webkit-tap-highlight-color:transparent}img, svg{vertical-align:middle}button{background:transparent;overflow:visible}button, input, optgroup, select, textarea{margin:0}:root{--reach-tabs:1;--reach-menu-button:1}#speechify-root{font-family:Sohne, sans-serif}div[data-popper-reference-hidden="true"]{visibility:hidden;pointer-events:none}.grecaptcha-badge{visibility:hidden}
/*XCode style (c) Angel Garcia <angelgarcia.mail@gmail.com>*/.hljs {background: #fff;color: black;
}/* Gray DOCTYPE selectors like WebKit */
.xml .hljs-meta {color: #c0c0c0;
}.hljs-comment,
.hljs-quote {color: #007400;
}.hljs-tag,
.hljs-attribute,
.hljs-keyword,
.hljs-selector-tag,
.hljs-literal,
.hljs-name {color: #aa0d91;
}.hljs-variable,
.hljs-template-variable {color: #3F6E74;
}.hljs-code,
.hljs-string,
.hljs-meta .hljs-string {color: #c41a16;
}.hljs-regexp,
.hljs-link {color: #0E0EFF;
}.hljs-title,
.hljs-symbol,
.hljs-bullet,
.hljs-number {color: #1c00cf;
}.hljs-section,
.hljs-meta {color: #643820;
}.hljs-title.class_,
.hljs-class .hljs-title,
.hljs-type,
.hljs-built_in,
.hljs-params {color: #5c2699;
}.hljs-attr {color: #836C28;
}.hljs-subst {color: #000;
}.hljs-formula {background-color: #eee;font-style: italic;
}.hljs-addition {background-color: #baeeba;
}.hljs-deletion {background-color: #ffc8bd;
}.hljs-selector-id,
.hljs-selector-class {color: #9b703f;
}.hljs-doctag,
.hljs-strong {font-weight: bold;
}.hljs-emphasis {font-style: italic;
}
</style><style type="text/css" data-fela-rehydration="563" data-fela-type="KEYFRAME">@-webkit-keyframes k1{0%{opacity:0.8}50%{opacity:0.5}100%{opacity:0.8}}@-moz-keyframes k1{0%{opacity:0.8}50%{opacity:0.5}100%{opacity:0.8}}@keyframes k1{0%{opacity:0.8}50%{opacity:0.5}100%{opacity:0.8}}</style><style type="text/css" data-fela-rehydration="563" data-fela-type="RULE">.a{font-family:medium-content-sans-serif-font, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif}.b{font-weight:400}.c{background-color:rgba(255, 255, 255, 1)}.l{display:block}.m{position:sticky}.n{top:0}.o{z-index:500}.p{padding:0 24px}.q{align-items:center}.r{border-bottom:solid 1px #F2F2F2}.y{height:41px}.z{line-height:20px}.ab{display:flex}.ac{height:57px}.ae{flex:1 0 auto}.af{color:inherit}.ag{fill:inherit}.ah{font-size:inherit}.ai{border:inherit}.aj{font-family:inherit}.ak{letter-spacing:inherit}.al{font-weight:inherit}.am{padding:0}.an{margin:0}.ao{cursor:pointer}.ap:disabled{cursor:not-allowed}.aq:disabled{color:#6B6B6B}.ar:disabled{fill:#6B6B6B}.au{width:auto}.av path{fill:#242424}.aw{height:25px}.ax{margin-left:16px}.ay{border:none}.az{border-radius:20px}.ba{width:240px}.bb{background:#F9F9F9}.bc path{fill:#6B6B6B}.be{outline:none}.bf{font-family:sohne, "Helvetica Neue", Helvetica, Arial, sans-serif}.bg{font-size:14px}.bh{width:100%}.bi{padding:10px 20px 10px 0}.bj{background-color:transparent}.bk{color:#242424}.bl::placeholder{color:#6B6B6B}.bm{display:inline-block}.bn{margin-left:12px}.bo{margin-right:12px}.bp{border-radius:4px}.bq{margin-left:24px}.br{height:24px}.bx{background-color:#F9F9F9}.by{border-radius:50%}.bz{height:32px}.ca{width:32px}.cb{justify-content:center}.ch{max-width:680px}.ci{min-width:0}.cj{animation:k1 1.2s ease-in-out infinite}.ck{height:100vh}.cl{margin-bottom:16px}.cm{margin-top:48px}.cn{align-items:flex-start}.co{flex-direction:column}.cp{justify-content:space-between}.cq{margin-bottom:24px}.cw{width:80%}.cx{background-color:#F2F2F2}.dd{height:44px}.de{width:44px}.df{margin:auto 0}.dg{margin-bottom:4px}.dh{height:16px}.di{width:120px}.dj{width:80px}.dp{margin-bottom:8px}.dq{width:96%}.dr{width:98%}.ds{width:81%}.dt{margin-left:8px}.du{color:#6B6B6B}.dv{font-size:13px}.dw{height:100%}.ep{color:#FFFFFF}.eq{fill:#FFFFFF}.er{background:#1A8917}.es{border-color:#1A8917}.ew:disabled{cursor:inherit !important}.ex:disabled{opacity:0.3}.ey:disabled:hover{background:#1A8917}.ez:disabled:hover{border-color:#1A8917}.fa{border-radius:99em}.fb{border-width:1px}.fc{border-style:solid}.fd{box-sizing:border-box}.fe{text-decoration:none}.ff{text-align:center}.fi{margin-right:32px}.fj{position:relative}.fk{fill:#6B6B6B}.fn{background:transparent}.fo svg{margin-left:4px}.fp svg{fill:#6B6B6B}.fr{box-shadow:inset 0 0 0 1px rgba(0, 0, 0, 0.05)}.fs{position:absolute}.fz{margin:0 24px}.gd{background:rgba(255, 255, 255, 1)}.ge{border:1px solid #F2F2F2}.gf{box-shadow:0 1px 4px #F2F2F2}.gg{max-height:100vh}.gh{overflow-y:auto}.gi{left:0}.gj{top:calc(100vh + 100px)}.gk{bottom:calc(100vh + 100px)}.gl{width:10px}.gm{pointer-events:none}.gn{word-break:break-word}.go{word-wrap:break-word}.gp:after{display:block}.gq:after{content:""}.gr:after{clear:both}.gs{line-height:1.23}.gt{letter-spacing:0}.gu{font-style:normal}.gv{font-weight:700}.ia{align-items:baseline}.ib{width:48px}.ic{height:48px}.id{border:2px solid rgba(255, 255, 255, 1)}.ie{z-index:0}.if{box-shadow:none}.ig{border:1px solid rgba(0, 0, 0, 0.05)}.ih{margin-bottom:2px}.ii{flex-wrap:nowrap}.ij{font-size:16px}.ik{line-height:24px}.im{margin:0 8px}.in{display:inline}.io{color:#1A8917}.ip{fill:#1A8917}.is{flex:0 0 auto}.iv{flex-wrap:wrap}.iw{padding-left:8px}.ix{padding-right:8px}.jy> *{flex-shrink:0}.jz{overflow-x:scroll}.ka::-webkit-scrollbar{display:none}.kb{scrollbar-width:none}.kc{-ms-overflow-style:none}.kd{width:74px}.ke{flex-direction:row}.kf{z-index:2}.kg{margin-right:4px}.kj{-webkit-user-select:none}.kk{border:0}.kl{fill:rgba(117, 117, 117, 1)}.ko{outline:0}.kp{user-select:none}.kq> svg{pointer-events:none}.kz{cursor:progress}.la{opacity:1}.lb{padding:4px 0}.le{margin-top:0px}.lf{width:16px}.lh{display:inline-flex}.ln{max-width:100%}.lo{padding:8px 2px}.lp svg{color:#6B6B6B}.mg{margin-left:auto}.mh{margin-right:auto}.mi{max-width:487px}.mo{clear:both}.mp{height:auto}.mq{line-height:1.58}.mr{letter-spacing:-0.004em}.ms{font-family:source-serif-pro, Georgia, Cambria, "Times New Roman", Times, serif}.nn{margin-bottom:-0.46em}.no{list-style-type:decimal}.np{margin-left:30px}.nq{padding-left:0px}.nr{font-style:italic}.nx{line-height:1.12}.ny{letter-spacing:-0.022em}.nz{font-weight:600}.ou{margin-bottom:-0.28em}.pa{max-width:932px}.ph{cursor:zoom-in}.pi{z-index:auto}.pk{margin-top:10px}.pl{max-width:728px}.po{max-width:467px}.pp{line-height:1.18}.qd{margin-bottom:-0.31em}.qe{max-width:515px}.qf{max-width:934px}.qg{max-width:803px}.qh{max-width:953px}.qi{max-width:682px}.qj{max-width:1362px}.qk{max-width:1117px}.ql{max-width:1099px}.qm{max-width:328px}.qn{max-width:870px}.qo{max-width:615px}.qp{max-width:514px}.qq{max-width:629px}.qr{max-width:500px}.qs{max-width:833px}.qt{max-width:537px}.qu{max-width:601px}.qv{max-width:471px}.qw{max-width:1033px}.qx{max-width:701px}.qy{max-width:518px}.qz{max-width:264px}.ra{max-width:547px}.rb{max-width:877px}.rc{max-width:970px}.rd{max-width:799px}.re{max-width:1035px}.rf{max-width:860px}.rg{max-width:697px}.rh{max-width:434px}.ri{max-width:494px}.rj{max-width:408px}.rk{max-width:520px}.rl{max-width:414px}.rm{max-width:1064px}.rn{max-width:391px}.ro{max-width:841px}.rp{max-width:534px}.rq{max-width:612px}.rr{max-width:453px}.rs{max-width:787px}.rt{max-width:780px}.ru{max-width:810px}.rv{max-width:581px}.rw{max-width:405px}.rx{max-width:406px}.ry{max-width:901px}.rz{max-width:560px}.sa{max-width:755px}.sb{max-width:993px}.sc{max-width:636px}.sd{max-width:469px}.se{max-width:876px}.sf{max-width:578px}.sg{max-width:379px}.sh{max-width:558px}.si{max-width:777px}.sj{max-width:819px}.sk{max-width:691px}.sl{max-width:868px}.sm{max-width:600px}.sn{max-width:764px}.so{text-decoration:underline}.sp{border-top:none}.sv{height:52px}.sw{max-height:52px}.sx{box-sizing:content-box}.sy{position:static}.sz{z-index:1}.tb{max-width:155px}.th{margin-right:20px}.tn{align-items:flex-end}.to{width:76px}.tp{height:76px}.tq{border:2px solid #F9F9F9}.tr{height:72px}.ts{width:72px}.tt{padding:8px 16px}.tu{stroke:#F2F2F2}.tv{height:36px}.tw{width:36px}.tx{color:#F2F2F2}.ty{fill:#F2F2F2}.tz{background:#F2F2F2}.ua{border-color:#F2F2F2}.ug{font-weight:500}.uh{font-size:24px}.ui{line-height:30px}.uj{letter-spacing:-0.016em}.uk{margin-top:8px}.ul{margin-top:16px}.um{height:0px}.un{border-bottom:solid 1px #E5E5E5}.uo{margin-top:72px}.up{padding:24px 0}.uq{margin-bottom:0px}.ur{margin-right:16px}.as:hover:not(:disabled){color:rgba(25, 25, 25, 1)}.at:hover:not(:disabled){fill:rgba(25, 25, 25, 1)}.et:hover{background:#156D12}.eu:hover{border-color:#156D12}.ev:hover{cursor:pointer}.fl:hover{color:#242424}.fm:hover{fill:#242424}.fq:hover svg{fill:#242424}.ft:hover{background-color:rgba(0, 0, 0, 0.1)}.il:hover{text-decoration:underline}.iq:hover:not(:disabled){color:#156D12}.ir:hover:not(:disabled){fill:#156D12}.kn:hover{fill:rgba(8, 8, 8, 1)}.lc:hover{fill:#000000}.ld:hover p{color:#000000}.lg:hover{color:#000000}.lq:hover svg{color:#000000}.ub:hover{background:#F2F2F2}.uc:hover{border-color:#F2F2F2}.ud:hover{cursor:wait}.ue:hover{color:#F2F2F2}.uf:hover{fill:#F2F2F2}.bd:focus-within path{fill:#242424}.km:focus{fill:rgba(8, 8, 8, 1)}.lr:focus svg{color:#000000}.pj:focus{transform:scale(1.01)}.kr:active{border-style:none}</style><style type="text/css" data-fela-rehydration="563" data-fela-type="RULE" media="all and (min-width: 1080px)">.d{display:none}.bw{width:64px}.cg{margin:0 64px}.cv{height:48px}.dc{margin-bottom:52px}.do{margin-bottom:48px}.ef{font-size:14px}.eg{line-height:20px}.em{font-size:13px}.eo{padding:5px 12px}.fh{display:flex}.fy{margin-bottom:68px}.gc{max-width:680px}.hq{font-size:42px}.hr{margin-top:1.19em}.hs{margin-bottom:32px}.ht{line-height:52px}.hu{letter-spacing:-0.011em}.hz{align-items:center}.jk{border-top:solid 1px #F2F2F2}.jl{border-bottom:solid 1px #F2F2F2}.jm{margin:32px 0 0}.jn{padding:3px 8px}.jw> *{margin-right:24px}.jx> :last-child{margin-right:0}.ky{margin-top:0px}.lm{margin:0}.mn{margin-top:40px}.nj{font-size:20px}.nk{margin-top:2.14em}.nl{line-height:32px}.nm{letter-spacing:-0.003em}.nw{margin-top:1.14em}.oq{font-size:24px}.or{margin-top:1.95em}.os{line-height:30px}.ot{letter-spacing:-0.016em}.oz{margin-top:0.94em}.pf{margin-top:56px}.qa{margin-top:1.72em}.qb{line-height:24px}.qc{letter-spacing:0}.su{margin-bottom:88px}.tg{display:inline-block}.tm{padding-top:72px}</style><style type="text/css" data-fela-rehydration="563" data-fela-type="RULE" media="all and (max-width: 1079.98px)">.e{display:none}.kx{margin-top:0px}.pm{margin-left:auto}.pn{text-align:center}.tf{display:inline-block}</style><style type="text/css" data-fela-rehydration="563" data-fela-type="RULE" media="all and (max-width: 903.98px)">.f{display:none}.kw{margin-top:0px}.te{display:inline-block}</style><style type="text/css" data-fela-rehydration="563" data-fela-type="RULE" media="all and (max-width: 727.98px)">.g{display:none}.ku{margin-top:0px}.kv{margin-right:0px}.td{display:inline-block}</style><style type="text/css" data-fela-rehydration="563" data-fela-type="RULE" media="all and (max-width: 551.98px)">.h{display:none}.s{display:flex}.t{justify-content:space-between}.bs{width:24px}.cc{margin:0 24px}.cr{height:40px}.cy{margin-bottom:44px}.dk{margin-bottom:32px}.dx{font-size:13px}.dy{line-height:20px}.eh{padding:0px 8px 1px}.fu{margin-bottom:4px}.gw{font-size:32px}.gx{margin-top:1.01em}.gy{margin-bottom:24px}.gz{line-height:38px}.ha{letter-spacing:-0.014em}.hv{align-items:flex-start}.it{flex-direction:column}.iy{margin:24px -24px 0}.iz{padding:0}.jo> *{margin-right:8px}.jp> :last-child{margin-right:24px}.kh{margin-left:0px}.ks{margin-top:0px}.kt{margin-right:0px}.li{margin:0}.ls{border:1px solid #F2F2F2}.lt{border-radius:99em}.lu{padding:0px 16px 0px 12px}.lv{height:38px}.lw{align-items:center}.ly svg{margin-right:8px}.mj{margin-top:32px}.mt{font-size:18px}.mu{margin-top:1.56em}.mv{line-height:28px}.mw{letter-spacing:-0.003em}.ns{margin-top:1.34em}.oa{font-size:20px}.ob{margin-top:1.2em}.oc{line-height:24px}.od{letter-spacing:0}.ov{margin-top:0.67em}.pb{margin-top:40px}.pq{font-size:16px}.pr{margin-top:1.23em}.sq{margin-bottom:80px}.tc{display:inline-block}.ti{padding-top:48px}.lx:hover{border-color:#E5E5E5}</style><style type="text/css" data-fela-rehydration="563" data-fela-type="RULE" media="all and (min-width: 904px) and (max-width: 1079.98px)">.i{display:none}.bv{width:64px}.cf{margin:0 64px}.cu{height:48px}.db{margin-bottom:52px}.dn{margin-bottom:48px}.ed{font-size:14px}.ee{line-height:20px}.ek{font-size:13px}.el{padding:5px 12px}.fg{display:flex}.fx{margin-bottom:68px}.gb{max-width:680px}.hl{font-size:42px}.hm{margin-top:1.19em}.hn{margin-bottom:32px}.ho{line-height:52px}.hp{letter-spacing:-0.011em}.hy{align-items:center}.jg{border-top:solid 1px #F2F2F2}.jh{border-bottom:solid 1px #F2F2F2}.ji{margin:32px 0 0}.jj{padding:3px 8px}.ju> *{margin-right:24px}.jv> :last-child{margin-right:0}.ll{margin:0}.mm{margin-top:40px}.nf{font-size:20px}.ng{margin-top:2.14em}.nh{line-height:32px}.ni{letter-spacing:-0.003em}.nv{margin-top:1.14em}.om{font-size:24px}.on{margin-top:1.95em}.oo{line-height:30px}.op{letter-spacing:-0.016em}.oy{margin-top:0.94em}.pe{margin-top:56px}.px{margin-top:1.72em}.py{line-height:24px}.pz{letter-spacing:0}.st{margin-bottom:88px}.tl{padding-top:72px}</style><style type="text/css" data-fela-rehydration="563" data-fela-type="RULE" media="all and (min-width: 728px) and (max-width: 903.98px)">.j{display:none}.w{display:flex}.x{justify-content:space-between}.bu{width:64px}.ce{margin:0 48px}.ct{height:48px}.da{margin-bottom:52px}.dm{margin-bottom:48px}.eb{font-size:13px}.ec{line-height:20px}.ej{padding:0px 8px 1px}.fw{margin-bottom:68px}.ga{max-width:680px}.hg{font-size:42px}.hh{margin-top:1.19em}.hi{margin-bottom:32px}.hj{line-height:52px}.hk{letter-spacing:-0.011em}.hx{align-items:center}.jc{border-top:solid 1px #F2F2F2}.jd{border-bottom:solid 1px #F2F2F2}.je{margin:32px 0 0}.jf{padding:3px 8px}.js> *{margin-right:24px}.jt> :last-child{margin-right:0}.lk{margin:0}.ml{margin-top:40px}.nb{font-size:20px}.nc{margin-top:2.14em}.nd{line-height:32px}.ne{letter-spacing:-0.003em}.nu{margin-top:1.14em}.oi{font-size:24px}.oj{margin-top:1.95em}.ok{line-height:30px}.ol{letter-spacing:-0.016em}.ox{margin-top:0.94em}.pd{margin-top:56px}.pu{margin-top:1.72em}.pv{line-height:24px}.pw{letter-spacing:0}.ss{margin-bottom:88px}.tk{padding-top:72px}</style><style type="text/css" data-fela-rehydration="563" data-fela-type="RULE" media="all and (min-width: 552px) and (max-width: 727.98px)">.k{display:none}.u{display:flex}.v{justify-content:space-between}.bt{width:24px}.cd{margin:0 24px}.cs{height:40px}.cz{margin-bottom:44px}.dl{margin-bottom:32px}.dz{font-size:13px}.ea{line-height:20px}.ei{padding:0px 8px 1px}.fv{margin-bottom:4px}.hb{font-size:32px}.hc{margin-top:1.01em}.hd{margin-bottom:24px}.he{line-height:38px}.hf{letter-spacing:-0.014em}.hw{align-items:flex-start}.iu{flex-direction:column}.ja{margin:24px 0 0}.jb{padding:0}.jq> *{margin-right:8px}.jr> :last-child{margin-right:8px}.ki{margin-left:0px}.lj{margin:0}.lz{border:1px solid #F2F2F2}.ma{border-radius:99em}.mb{padding:0px 16px 0px 12px}.mc{height:38px}.md{align-items:center}.mf svg{margin-right:8px}.mk{margin-top:32px}.mx{font-size:18px}.my{margin-top:1.56em}.mz{line-height:28px}.na{letter-spacing:-0.003em}.nt{margin-top:1.34em}.oe{font-size:20px}.of{margin-top:1.2em}.og{line-height:24px}.oh{letter-spacing:0}.ow{margin-top:0.67em}.pc{margin-top:40px}.ps{font-size:16px}.pt{margin-top:1.23em}.sr{margin-bottom:80px}.tj{padding-top:48px}.me:hover{border-color:#E5E5E5}</style><style type="text/css" data-fela-rehydration="563" data-fela-type="RULE" media="print">.ta{display:none}</style><style type="text/css" data-fela-rehydration="563" data-fela-type="RULE" media="(prefers-reduced-motion: no-preference)">.pg{transition:transform 300ms cubic-bezier(0.2, 0, 0.2, 1)}</style></head><body><div id="root"><div class="a b c"><div class="d e f g h i j k"></div><script>document.domain = document.domain;</script><div class="l c"><div class="l m n o c"><div class="p q r s t u v w x i d y z"><a class="du ag dv bf ak b am an ao ap aq ar as at s u w i d q dw z" href="https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F686379311056&amp;%7Efeature=LoOpenInAppButton&amp;%7Echannel=ShowPostUnderUser&amp;source=---top_nav_layout_nav----------------------------------" rel="noopener follow">Open in app<svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" fill="none" viewBox="0 0 10 10" class="dt"><path fill="currentColor" d="M.985 8.485a.375.375 0 1 0 .53.53zM8.75 1.25h.375A.375.375 0 0 0 8.75.875zM8.375 6.5a.375.375 0 1 0 .75 0zM3.5.875a.375.375 0 1 0 0 .75zm-1.985 8.14 7.5-7.5-.53-.53-7.5 7.5zm6.86-7.765V6.5h.75V1.25zM3.5 1.625h5.25v-.75H3.5z"></path></svg></a><div class="ab q"><p class="bf b dx dy dz ea eb ec ed ee ef eg du"><span><button class="bf b dx dy eh dz ea ei eb ec ej ek ee el em eg eo ep eq er es et eu ev ew ex ey ez fa fb fc fd bm fe ff" data-testid="headerSignUpButton">Sign up</button></span></p><div class="ax l"><p class="bf b dx dy dz ea eb ec ed ee ef eg du"><span><a class="af ag ah ai aj ak al am an ao ap aq ar as at" data-testid="headerSignInButton" href="https://medium.com/m/signin?operation=login&amp;redirect=https%3A%2F%2Felis531989.medium.com%2Fthe-chronicles-of-bumblebee-the-hook-the-bee-and-the-trickbot-connection-686379311056&amp;source=post_page---top_nav_layout_nav-----------------------global_nav-----------" rel="noopener follow">Sign in</a></span></p></div></div></div><div class="p q r ab ac"><div class="ab q ae"><a class="af ag ah ai aj ak al am an ao ap aq ar as at ab" aria-label="Homepage" data-testid="headerMediumLogo" href="https://medium.com/?source=---top_nav_layout_nav----------------------------------" rel="noopener follow"><svg xmlns="http://www.w3.org/2000/svg" width="719" height="160" fill="none" viewBox="0 0 719 160" class="au av aw"><path fill="#242424" d="m174.104 9.734.215-.047V8.02H130.39L89.6 103.89 48.81 8.021H1.472v1.666l.212.047c8.018 1.81 12.09 4.509 12.09 14.242V137.93c0 9.734-4.087 12.433-12.106 14.243l-.212.047v1.671h32.118v-1.665l-.213-.048c-8.018-1.809-12.089-4.509-12.089-14.242V30.586l52.399 123.305h2.972l53.925-126.743V140.75c-.687 7.688-4.721 10.062-11.982 11.701l-.215.05v1.652h55.948v-1.652l-.215-.05c-7.269-1.639-11.4-4.013-12.087-11.701l-.037-116.774h.037c0-9.733 4.071-12.432 12.087-14.242m25.555 75.488c.915-20.474 8.268-35.252 20.606-35.507 3.806.063 6.998 1.312 9.479 3.714 5.272 5.118 7.751 15.812 7.368 31.793zm-.553 5.77h65.573v-.275c-.186-15.656-4.721-27.834-13.466-36.196-7.559-7.227-18.751-11.203-30.507-11.203h-.263c-6.101 0-13.584 1.48-18.909 4.16-6.061 2.807-11.407 7.003-15.855 12.511-7.161 8.874-11.499 20.866-12.554 34.343q-.05.606-.092 1.212a50 50 0 0 0-.065 1.151 85.807 85.807 0 0 0-.094 5.689c.71 30.524 17.198 54.917 46.483 54.917 25.705 0 40.675-18.791 44.407-44.013l-1.886-.664c-6.557 13.556-18.334 21.771-31.738 20.769-18.297-1.369-32.314-19.922-31.042-42.395m139.722 41.359c-2.151 5.101-6.639 7.908-12.653 7.908s-11.513-4.129-15.418-11.63c-4.197-8.053-6.405-19.436-6.405-32.92 0-28.067 8.729-46.22 22.24-46.22 5.657 0 10.111 2.807 12.236 7.704zm43.499 20.008c-8.019-1.897-12.089-4.722-12.089-14.951V1.309l-48.716 14.353v1.757l.299-.024c6.72-.543 11.278.386 13.925 2.83 2.072 1.915 3.082 4.853 3.082 8.987v18.66c-4.803-3.067-10.516-4.56-17.448-4.56-14.059 0-26.909 5.92-36.176 16.672-9.66 11.205-14.767 26.518-14.767 44.278-.003 31.72 15.612 53.039 38.851 53.039 13.595 0 24.533-7.449 29.54-20.013v16.865h43.711v-1.746zM424.1 19.819c0-9.904-7.468-17.374-17.375-17.374-9.859 0-17.573 7.632-17.573 17.374s7.721 17.374 17.573 17.374c9.907 0 17.375-7.47 17.375-17.374m11.499 132.546c-8.019-1.897-12.089-4.722-12.089-14.951h-.035V43.635l-43.714 12.551v1.705l.263.024c9.458.842 12.047 4.1 12.047 15.152v81.086h43.751v-1.746zm112.013 0c-8.018-1.897-12.089-4.722-12.089-14.951V43.635l-41.621 12.137v1.71l.246.026c7.733.813 9.967 4.257 9.967 15.36v59.279c-2.578 5.102-7.415 8.131-13.274 8.336-9.503 0-14.736-6.419-14.736-18.073V43.638l-43.714 12.55v1.703l.262.024c9.459.84 12.05 4.097 12.05 15.152v50.17a56.3 56.3 0 0 0 .91 10.444l.787 3.423c3.701 13.262 13.398 20.197 28.59 20.197 12.868 0 24.147-7.966 29.115-20.43v17.311h43.714v-1.747zm169.818 1.788v-1.749l-.213-.05c-8.7-2.006-12.089-5.789-12.089-13.49v-63.79c0-19.89-11.171-31.761-29.883-31.761-13.64 0-25.141 7.882-29.569 20.16-3.517-13.01-13.639-20.16-28.606-20.16-13.146 0-23.449 6.938-27.869 18.657V43.643L545.487 55.68v1.715l.263.024c9.345.829 12.047 4.181 12.047 14.95v81.784h40.787v-1.746l-.215-.053c-6.941-1.631-9.181-4.606-9.181-12.239V66.998c1.836-4.289 5.537-9.37 12.853-9.37 9.086 0 13.692 6.296 13.692 18.697v77.828h40.797v-1.746l-.215-.053c-6.94-1.631-9.18-4.606-9.18-12.239V75.066a42 42 0 0 0-.578-7.26c1.947-4.661 5.86-10.177 13.475-10.177 9.214 0 13.691 6.114 13.691 18.696v77.828z"></path></svg></a><div class="ax h"><div class="ab ay az ba bb q bc bd"><div class="bm" aria-hidden="false" aria-describedby="searchResults" aria-labelledby="searchResults"></div><div class="bn bo ab"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.092 11.06a6.95 6.95 0 1 1 13.9 0 6.95 6.95 0 0 1-13.9 0m6.95-8.05a8.05 8.05 0 1 0 5.13 14.26l3.75 3.75a.56.56 0 1 0 .79-.79l-3.73-3.73A8.05 8.05 0 0 0 11.042 3z" clip-rule="evenodd"></path></svg></div><input role="combobox" aria-controls="searchResults" aria-expanded="false" aria-label="search" data-testid="headerSearchInput" tabindex="0" class="ay be bf bg z bh bi bj bk bl" placeholder="Search" value=""/></div></div></div><div class="h k w fg fh"><div class="fi ab"><span><a class="af ag ah ai aj ak al am an ao ap aq ar as at" data-testid="headerWriteButton" href="https://medium.com/m/signin?operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2Fnew-story&amp;source=---top_nav_layout_nav-----------------------new_post_topnav-----------" rel="noopener follow"><div class="bf b bg z du fj fk ab q fl fm"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" aria-label="Write"><path fill="currentColor" d="M14 4a.5.5 0 0 0 0-1zm7 6a.5.5 0 0 0-1 0zm-7-7H4v1h10zM3 4v16h1V4zm1 17h16v-1H4zm17-1V10h-1v10zm-1 1a1 1 0 0 0 1-1h-1zM3 20a1 1 0 0 0 1 1v-1zM4 3a1 1 0 0 0-1 1h1z"></path><path stroke="currentColor" d="m17.5 4.5-8.458 8.458a.25.25 0 0 0-.06.098l-.824 2.47a.25.25 0 0 0 .316.316l2.47-.823a.25.25 0 0 0 .098-.06L19.5 6.5m-2-2 2.323-2.323a.25.25 0 0 1 .354 0l1.646 1.646a.25.25 0 0 1 0 .354L19.5 6.5m-2-2 2 2"></path></svg><div class="dt l">Write</div></div></a></span></div></div><div class="k j i d"><div class="fi ab"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" data-testid="headerSearchButton" href="https://medium.com/search?source=---top_nav_layout_nav----------------------------------" rel="noopener follow"><div class="bf b bg z du fj fk ab q fl fm"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" aria-label="Search"><path fill="currentColor" fill-rule="evenodd" d="M4.092 11.06a6.95 6.95 0 1 1 13.9 0 6.95 6.95 0 0 1-13.9 0m6.95-8.05a8.05 8.05 0 1 0 5.13 14.26l3.75 3.75a.56.56 0 1 0 .79-.79l-3.73-3.73A8.05 8.05 0 0 0 11.042 3z" clip-rule="evenodd"></path></svg></div></a></div></div><div class="fi h k j"><div class="ab q"><p class="bf b dx dy dz ea eb ec ed ee ef eg du"><span><button class="bf b dx dy eh dz ea ei eb ec ej ek ee el em eg eo ep eq er es et eu ev ew ex ey ez fa fb fc fd bm fe ff" data-testid="headerSignUpButton">Sign up</button></span></p><div class="ax l"><p class="bf b dx dy dz ea eb ec ed ee ef eg du"><span><a class="af ag ah ai aj ak al am an ao ap aq ar as at" data-testid="headerSignInButton" href="https://medium.com/m/signin?operation=login&amp;redirect=https%3A%2F%2Felis531989.medium.com%2Fthe-chronicles-of-bumblebee-the-hook-the-bee-and-the-trickbot-connection-686379311056&amp;source=post_page---top_nav_layout_nav-----------------------global_nav-----------" rel="noopener follow">Sign in</a></span></p></div></div></div><div class="l" aria-hidden="false"><button class="ay fn am ab q ao fo fp fq" aria-label="user options menu" data-testid="headerUserIcon"><div class="l fj"><img alt="" class="l fd by bz ca cx" src="https://miro.medium.com/v2/resize:fill:64:64/1*dmbNkD5D-u45r44go_cf0g.png" width="32" height="32" loading="lazy" role="presentation"/><div class="fr by l bz ca fs n ay ft"></div></div></button></div></div></div><div class="l"><div class="fu fv fw fx fy l"><div class="ab cb"><div class="ci bh fz ga gb gc"></div></div><article><div class="l"><div class="l"><span class="l"></span><section><div><div class="fs gi gj gk gl gm"></div><div class="gn go gp gq gr"><div class="ab cb"><div class="ci bh fz ga gb gc"><div><h1 id="bd36" class="pw-post-title gs gt gu bf gv gw gx gy gz ha hb hc hd he hf hg hh hi hj hk hl hm hn ho hp hq hr hs ht hu bk" data-testid="storyTitle">The chronicles of Bumblebee: The Hook, the Bee, and the Trickbot connection</h1><div><div class="speechify-ignore ab cp"><div class="speechify-ignore bh l"><div class="hv hw hx hy hz ab"><div><div class="ab ia"><a rel="noopener follow" href="/?source=post_page-----686379311056--------------------------------"><div><div class="bm" aria-hidden="false"><div class="l ib ic by id ie"><div class="l fj"><img alt="Eli Salem" class="l fd by dd de cx" src="https://miro.medium.com/v2/resize:fill:88:88/1*yYX7vWD9X65EM0PVIv9FOw.jpeg" width="44" height="44" loading="lazy" data-testid="authorPhoto"/><div class="if by l dd de fs n ig ft"></div></div></div></div></div></a></div></div><div class="bn bh l"><div class="ab"><div style="flex:1"><span class="bf b bg z bk"><div class="ih ab q"><div class="ab q ii"><div class="ab q"><div><div class="bm" aria-hidden="false"><p class="bf b ij ik bk"><a class="af ag ah ai aj ak al am an ao ap aq ar il" data-testid="authorName" rel="noopener follow" href="/?source=post_page-----686379311056--------------------------------">Eli Salem</a></p></div></div></div><span class="im in" aria-hidden="true"><span class="bf b bg z du">·</span></span><p class="bf b ij ik du"><span><a class="io ip ah ai aj ak al am an ao ap aq ar ex iq ir" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Ff375cbce3f63&amp;operation=register&amp;redirect=https%3A%2F%2Felis531989.medium.com%2Fthe-chronicles-of-bumblebee-the-hook-the-bee-and-the-trickbot-connection-686379311056&amp;user=Eli+Salem&amp;userId=f375cbce3f63&amp;source=post_page-f375cbce3f63----686379311056---------------------post_header-----------" rel="noopener follow">Follow</a></span></p></div></div></span></div></div><div class="l is"><span class="bf b bg z du"><div class="ab cn it iu iv"><span class="bf b bg z du"><div class="ab ae"><span data-testid="storyReadTime">17 min read</span><div class="iw ix l" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bf b bg z du">·</span></span></div><span data-testid="storyPublishDate">Apr 27, 2022</span></div></span></div></span></div></div></div><div class="ab cp iy iz ja jb jc jd je jf jg jh ji jj jk jl jm jn"><div class="h k w fg fh q"><div class="kd l"><div class="ab q ke kf"><div class="pw-multi-vote-icon fj kg kh ki kj"><span><a class="af ag ah ai aj ak al am an ao ap aq ar as at" data-testid="headerClapButton" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Fp%2F686379311056&amp;operation=register&amp;redirect=https%3A%2F%2Felis531989.medium.com%2Fthe-chronicles-of-bumblebee-the-hook-the-bee-and-the-trickbot-connection-686379311056&amp;user=Eli+Salem&amp;userId=f375cbce3f63&amp;source=-----686379311056---------------------clap_footer-----------" rel="noopener follow"><div><div class="bm" aria-hidden="false"><div class="kk ao kl km kn ko am kp kq kr kj"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM13.916 3.953l1.523-2.112-1.184-.39zM8.589 1.84l1.522 2.112-.337-2.501zM18.523 18.92c-.86.86-1.75 1.246-2.62 1.33a6 6 0 0 0 .407-.372c2.388-2.389 2.86-4.951 1.399-7.623l-.912-1.603-.79-1.672c-.26-.56-.194-.98.203-1.288a.7.7 0 0 1 .546-.132c.283.046.546.231.728.5l2.363 4.157c.976 1.624 1.141 4.237-1.324 6.702m-10.999-.438L3.37 14.328a.828.828 0 0 1 .585-1.408.83.83 0 0 1 .585.242l2.158 2.157a.365.365 0 0 0 .516-.516l-2.157-2.158-1.449-1.449a.826.826 0 0 1 1.167-1.17l3.438 3.44a.363.363 0 0 0 .516 0 .364.364 0 0 0 0-.516L5.293 9.513l-.97-.97a.826.826 0 0 1 0-1.166.84.84 0 0 1 1.167 0l.97.968 3.437 3.436a.36.36 0 0 0 .517 0 .366.366 0 0 0 0-.516L6.977 7.83a.82.82 0 0 1-.241-.584.82.82 0 0 1 .824-.826c.219 0 .43.087.584.242l5.787 5.787a.366.366 0 0 0 .587-.415l-1.117-2.363c-.26-.56-.194-.98.204-1.289a.7.7 0 0 1 .546-.132c.283.046.545.232.727.501l2.193 3.86c1.302 2.38.883 4.59-1.277 6.75-1.156 1.156-2.602 1.627-4.19 1.367-1.418-.236-2.866-1.033-4.079-2.246M10.75 5.971l2.12 2.12c-.41.502-.465 1.17-.128 1.89l.22.465-3.523-3.523a.8.8 0 0 1-.097-.368c0-.22.086-.428.241-.584a.847.847 0 0 1 1.167 0m7.355 1.705c-.31-.461-.746-.758-1.23-.837a1.44 1.44 0 0 0-1.11.275c-.312.24-.505.543-.59.881a1.74 1.74 0 0 0-.906-.465 1.47 1.47 0 0 0-.82.106l-2.182-2.182a1.56 1.56 0 0 0-2.2 0 1.54 1.54 0 0 0-.396.701 1.56 1.56 0 0 0-2.21-.01 1.55 1.55 0 0 0-.416.753c-.624-.624-1.649-.624-2.237-.037a1.557 1.557 0 0 0 0 2.2c-.239.1-.501.238-.715.453a1.56 1.56 0 0 0 0 2.2l.516.515a1.556 1.556 0 0 0-.753 2.615L7.01 19c1.32 1.319 2.909 2.189 4.475 2.449q.482.08.971.08c.85 0 1.653-.198 2.393-.579.231.033.46.054.686.054 1.266 0 2.457-.52 3.505-1.567 2.763-2.763 2.552-5.734 1.439-7.586z" clip-rule="evenodd"></path></svg></div></div></div></a></span></div><div class="pw-multi-vote-count l ks kt ku kv kw kx ky"><p class="bf b dv z du"><span class="kz">--</span></p></div></div></div><div><div class="bm" aria-hidden="false"><button class="ao kk la lb ab q fk lc ld" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="le"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"></path></svg></button></div></div></div><div class="ab q jo jp jq jr js jt ju jv jw jx jy jz ka kb kc"><div class="lf k j i d"></div><div class="h k"><div><div class="bm" aria-hidden="false"><span><a class="af ag ah ai aj ak al am an ao ap aq ar as at" data-testid="headerBookmarkButton" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F686379311056&amp;operation=register&amp;redirect=https%3A%2F%2Felis531989.medium.com%2Fthe-chronicles-of-bumblebee-the-hook-the-bee-and-the-trickbot-connection-686379311056&amp;source=-----686379311056---------------------bookmark_footer-----------" rel="noopener follow"><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="none" viewBox="0 0 25 25" class="du lg" aria-label="Add to list bookmark button"><path fill="currentColor" d="M18 2.5a.5.5 0 0 1 1 0V5h2.5a.5.5 0 0 1 0 1H19v2.5a.5.5 0 1 1-1 0V6h-2.5a.5.5 0 0 1 0-1H18zM7 7a1 1 0 0 1 1-1h3.5a.5.5 0 0 0 0-1H8a2 2 0 0 0-2 2v14a.5.5 0 0 0 .805.396L12.5 17l5.695 4.396A.5.5 0 0 0 19 21v-8.5a.5.5 0 0 0-1 0v7.485l-5.195-4.012a.5.5 0 0 0-.61 0L7 19.985z"></path></svg></a></span></div></div></div><div class="fd lh cn"><div class="l ae"><div class="ab cb"><div class="li lj lk ll lm ln ci bh"><div class="ab"><div class="bm bh" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="Listen" data-testid="audioPlayButton" class="af fk ah ai aj ak al lo an ao ap ex lp lq ld lr ls lt lu lv s lw lx ly lz ma mb mc u md me mf"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"></path></svg><div class="j i d"><p class="bf b bg z du">Listen</p></div></button></div></div></div></div></div></div></div></div><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="af fk ah ai aj ak al lo an ao ap ex lp lq ld lr ls lt lu lv s lw lx ly lz ma mb mc u md me mf"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"></path></svg><div class="j i d"><p class="bf b bg z du">Share</p></div></button></div></div></div></div></div></div></div></div></div><figure class="mj mk ml mm mn mo mg mh paragraph-image"><div class="mg mh mi"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*LglRPWDxARM11kMkI0pTqw.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*LglRPWDxARM11kMkI0pTqw.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*LglRPWDxARM11kMkI0pTqw.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*LglRPWDxARM11kMkI0pTqw.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*LglRPWDxARM11kMkI0pTqw.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*LglRPWDxARM11kMkI0pTqw.png 1100w, https://miro.medium.com/v2/resize:fit:974/format:webp/1*LglRPWDxARM11kMkI0pTqw.png 974w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 487px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*LglRPWDxARM11kMkI0pTqw.png 640w, https://miro.medium.com/v2/resize:fit:720/1*LglRPWDxARM11kMkI0pTqw.png 720w, https://miro.medium.com/v2/resize:fit:750/1*LglRPWDxARM11kMkI0pTqw.png 750w, https://miro.medium.com/v2/resize:fit:786/1*LglRPWDxARM11kMkI0pTqw.png 786w, https://miro.medium.com/v2/resize:fit:828/1*LglRPWDxARM11kMkI0pTqw.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*LglRPWDxARM11kMkI0pTqw.png 1100w, https://miro.medium.com/v2/resize:fit:974/1*LglRPWDxARM11kMkI0pTqw.png 974w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 487px"/><img alt="" class="bh ln mp c" width="487" height="512" loading="eager" role="presentation"/></picture></div></figure><p id="5f70" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">In late March 2022, a new malware dubbed “Bumblebee” was discovered, and reported to be distributed in phishing campaigns containing ISO files which eventually drop DLL files that contained the Bumblebee malware itself.[1][3].<br/>This malware deployment technique is not new, and several other malware has already been observed using it, most notably: BazarLoader, and IcedID[3]. Also, similar to the aforementioned malware, Bumblebee too was observed delivering the Cobalt-Strike framework.</p><p id="3470" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">From a threat research perspective, what makes this malware interesting is the fact that it was associated with the Conti ransomware group as one of the group&#x27;s threat loaders[1].<br/>In the past, the traditional loaders of Conti were Trickbot, Bazarloader, and Emotet, so it was quite intriguing to inspect this malware closely.</p><p id="fa68" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">In this article, I will present a code analysis of the Bumblebee malware, obviously, due to the malware&#x27;s large size I will not cover everything, and will focus on the parts that I think are the most interesting in terms of capabilities.<br/>Also, one of my favorite topics in malware research is the ways of malware to avoid detection, so I will put more emphasis on this subject as well.</p><p id="92ae" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">Lastly, I divided the entire article into three parts, the table of contents is the following:</p><ol class=""><li id="7161" class="mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq bk"><strong class="ms gv"><em class="nr">PART 1: The hook- unpacking the bumblebee’s crypter<br/>- Unpacking mechanism<br/>- Enters the hook<br/>- Executing the code<br/>- Bumblebee dropper high-level summary</em></strong></li><li id="ac45" class="mq mr gu ms b mt ns mv mw mx nt mz na nb nu nd ne nf nv nh ni nj nw nl nm nn no np nq bk"><strong class="ms gv"><em class="nr">PART 2: The bee- Investing the bumblebee’s payload<br/>- Stolen anti-analysis code<br/>- Searching for processes<br/>- Searching registry keys<br/>- Searching file paths<br/>- Executing processes<br/>- The little ones inside the flask: hiding additional DLLs</em></strong></li><li id="5980" class="mq mr gu ms b mt ns mv mw mx nt mz na nb nu nd ne nf nv nh ni nj nw nl nm nn no np nq bk"><strong class="ms gv"><em class="nr">PART 3: The Trickbot connection- Investigating the hooking DLL<br/>- Check for existing hooks<br/>- Setting the hooks<br/>- First hooks: Disable exceptions<br/>- Second hooks: Further code execution<br/>- The Trickbot hooking engine<br/>- Static differences and code evolution<br/>- Additional similarities <br/>- Customize flattened RC4<br/>- RapportGP.dll high-level summary</em></strong></li></ol><h1 id="652c" class="nx ny gu bf nz oa ob oc od oe of og oh oi oj ok ol om on oo op oq or os ot ou bk">PART 1</h1><h1 id="02c4" class="nx ny gu bf nz oa ob oc od oe of og oh oi oj ok ol om on oo op oq or os ot ou bk">The Hook: Unpacking the bumblebee’s crypter</h1><p id="6a86" class="pw-post-body-paragraph mq mr gu ms b mt ov mv mw mx ow mz na nb ox nd ne nf oy nh ni nj oz nl nm nn gn bk">Hash: a9c8b7c411571700e6ea03e4e48ddb896a33e53e</p><figure class="pb pc pd pe pf mo mg mh paragraph-image"><div role="button" tabindex="0" class="pg ph fj pi bh pj"><div class="mg mh pa"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*67nk9n2x4g-LkjYOiLhRyw.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*67nk9n2x4g-LkjYOiLhRyw.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*67nk9n2x4g-LkjYOiLhRyw.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*67nk9n2x4g-LkjYOiLhRyw.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*67nk9n2x4g-LkjYOiLhRyw.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*67nk9n2x4g-LkjYOiLhRyw.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*67nk9n2x4g-LkjYOiLhRyw.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*67nk9n2x4g-LkjYOiLhRyw.png 640w, https://miro.medium.com/v2/resize:fit:720/1*67nk9n2x4g-LkjYOiLhRyw.png 720w, https://miro.medium.com/v2/resize:fit:750/1*67nk9n2x4g-LkjYOiLhRyw.png 750w, https://miro.medium.com/v2/resize:fit:786/1*67nk9n2x4g-LkjYOiLhRyw.png 786w, https://miro.medium.com/v2/resize:fit:828/1*67nk9n2x4g-LkjYOiLhRyw.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*67nk9n2x4g-LkjYOiLhRyw.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*67nk9n2x4g-LkjYOiLhRyw.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"/><img alt="" class="bh ln mp c" width="700" height="386" loading="lazy" role="presentation"/></picture></div></div><figcaption class="pk ff pl mg mh pm pn bf b bg z du">Bumblebee dropper as seen in PEstudio</figcaption></figure><p id="7df6" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">The initial dropper of Bumblebee is a 64bit file, with relatively high entropy which indicates a possibly obfuscated \ encrypted content that will be decrypted in runtime.</p><p id="926c" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">The DLL itself contains two export functions: InternalJob and SetPath. Also, the file’s internal name appears to be “<em class="nr">lodqcbw041xd9.dll</em>”.</p><figure class="pb pc pd pe pf mo mg mh paragraph-image"><div class="mg mh po"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*TGWaJwFGw4jY03O_GFv6BQ.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*TGWaJwFGw4jY03O_GFv6BQ.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*TGWaJwFGw4jY03O_GFv6BQ.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*TGWaJwFGw4jY03O_GFv6BQ.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*TGWaJwFGw4jY03O_GFv6BQ.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*TGWaJwFGw4jY03O_GFv6BQ.png 1100w, https://miro.medium.com/v2/resize:fit:934/format:webp/1*TGWaJwFGw4jY03O_GFv6BQ.png 934w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 467px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*TGWaJwFGw4jY03O_GFv6BQ.png 640w, https://miro.medium.com/v2/resize:fit:720/1*TGWaJwFGw4jY03O_GFv6BQ.png 720w, https://miro.medium.com/v2/resize:fit:750/1*TGWaJwFGw4jY03O_GFv6BQ.png 750w, https://miro.medium.com/v2/resize:fit:786/1*TGWaJwFGw4jY03O_GFv6BQ.png 786w, https://miro.medium.com/v2/resize:fit:828/1*TGWaJwFGw4jY03O_GFv6BQ.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*TGWaJwFGw4jY03O_GFv6BQ.png 1100w, https://miro.medium.com/v2/resize:fit:934/1*TGWaJwFGw4jY03O_GFv6BQ.png 934w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 467px"/><img alt="" class="bh ln mp c" width="467" height="327" loading="lazy" role="presentation"/></picture></div><figcaption class="pk ff pl mg mh pm pn bf b bg z du">Bumblebee dropper exports and internal name in PE-Bear</figcaption></figure><h2 id="7946" class="pp ny gu bf nz pq pr dy od ps pt ea oh nb pu pv pw nf px py pz nj qa qb qc qd bk">Unpacking mechanism</h2><p id="43ea" class="pw-post-body-paragraph mq mr gu ms b mt ov mv mw mx ow mz na nb ox nd ne nf oy nh ni nj oz nl nm nn gn bk">Once we enter the loader’s main function, we see that it is unique, and does not look like any common crypters that can be found in Conti’s loaders (such as Emotet or Bazarloader).</p><figure class="pb pc pd pe pf mo mg mh paragraph-image"><div class="mg mh qe"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*p_n-hNxUH1wyonQBDZFyQA.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*p_n-hNxUH1wyonQBDZFyQA.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*p_n-hNxUH1wyonQBDZFyQA.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*p_n-hNxUH1wyonQBDZFyQA.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*p_n-hNxUH1wyonQBDZFyQA.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*p_n-hNxUH1wyonQBDZFyQA.png 1100w, https://miro.medium.com/v2/resize:fit:1030/format:webp/1*p_n-hNxUH1wyonQBDZFyQA.png 1030w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 515px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*p_n-hNxUH1wyonQBDZFyQA.png 640w, https://miro.medium.com/v2/resize:fit:720/1*p_n-hNxUH1wyonQBDZFyQA.png 720w, https://miro.medium.com/v2/resize:fit:750/1*p_n-hNxUH1wyonQBDZFyQA.png 750w, https://miro.medium.com/v2/resize:fit:786/1*p_n-hNxUH1wyonQBDZFyQA.png 786w, https://miro.medium.com/v2/resize:fit:828/1*p_n-hNxUH1wyonQBDZFyQA.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*p_n-hNxUH1wyonQBDZFyQA.png 1100w, https://miro.medium.com/v2/resize:fit:1030/1*p_n-hNxUH1wyonQBDZFyQA.png 1030w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 515px"/><img alt="" class="bh ln mp c" width="515" height="405" loading="lazy" role="presentation"/></picture></div><figcaption class="pk ff pl mg mh pm pn bf b bg z du">Bumblebee loader\crypter main</figcaption></figure><p id="836d" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">As we open the loader in IDA, we see that the majority of the PE in the IDA navigator has the olive color which means unexplored bytes. This is common when there is some content in the PE that needs to be decrypted during runtime.</p><figure class="pb pc pd pe pf mo mg mh paragraph-image"><div role="button" tabindex="0" class="pg ph fj pi bh pj"><div class="mg mh qf"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*WCKPhR_VCJoqYE2Z7Rn0Zw.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*WCKPhR_VCJoqYE2Z7Rn0Zw.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*WCKPhR_VCJoqYE2Z7Rn0Zw.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*WCKPhR_VCJoqYE2Z7Rn0Zw.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*WCKPhR_VCJoqYE2Z7Rn0Zw.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*WCKPhR_VCJoqYE2Z7Rn0Zw.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*WCKPhR_VCJoqYE2Z7Rn0Zw.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*WCKPhR_VCJoqYE2Z7Rn0Zw.png 640w, https://miro.medium.com/v2/resize:fit:720/1*WCKPhR_VCJoqYE2Z7Rn0Zw.png 720w, https://miro.medium.com/v2/resize:fit:750/1*WCKPhR_VCJoqYE2Z7Rn0Zw.png 750w, https://miro.medium.com/v2/resize:fit:786/1*WCKPhR_VCJoqYE2Z7Rn0Zw.png 786w, https://miro.medium.com/v2/resize:fit:828/1*WCKPhR_VCJoqYE2Z7Rn0Zw.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*WCKPhR_VCJoqYE2Z7Rn0Zw.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*WCKPhR_VCJoqYE2Z7Rn0Zw.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"/><img alt="" class="bh ln mp c" width="700" height="128" loading="lazy" role="presentation"/></picture></div></div><figcaption class="pk ff pl mg mh pm pn bf b bg z du">Bumblebee loader unexplored bytes</figcaption></figure><p id="bb31" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk"><strong class="ms gv">Tip</strong>: During my analysis, I disabled the file’s ASLR to match the addresses in IDA and Xdbg, this is super helpful and saves a lot of time.<br/>To do so, open the file in CFF explorer, and then:</p><ol class=""><li id="409f" class="mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq bk">Click Optional Header</li><li id="2dd3" class="mq mr gu ms b mt ns mv mw mx nt mz na nb nu nd ne nf nv nh ni nj nw nl nm nn no np nq bk">Go to DllCharacteristics</li><li id="4b0d" class="mq mr gu ms b mt ns mv mw mx nt mz na nb nu nd ne nf nv nh ni nj nw nl nm nn no np nq bk">Remove the V from “DLL can move”</li></ol><figure class="pb pc pd pe pf mo mg mh paragraph-image"><div role="button" tabindex="0" class="pg ph fj pi bh pj"><div class="mg mh qg"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*L_Uqy06ieJb1285FX3umRA.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*L_Uqy06ieJb1285FX3umRA.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*L_Uqy06ieJb1285FX3umRA.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*L_Uqy06ieJb1285FX3umRA.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*L_Uqy06ieJb1285FX3umRA.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*L_Uqy06ieJb1285FX3umRA.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*L_Uqy06ieJb1285FX3umRA.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*L_Uqy06ieJb1285FX3umRA.png 640w, https://miro.medium.com/v2/resize:fit:720/1*L_Uqy06ieJb1285FX3umRA.png 720w, https://miro.medium.com/v2/resize:fit:750/1*L_Uqy06ieJb1285FX3umRA.png 750w, https://miro.medium.com/v2/resize:fit:786/1*L_Uqy06ieJb1285FX3umRA.png 786w, https://miro.medium.com/v2/resize:fit:828/1*L_Uqy06ieJb1285FX3umRA.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*L_Uqy06ieJb1285FX3umRA.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*L_Uqy06ieJb1285FX3umRA.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"/><img alt="" class="bh ln mp c" width="700" height="510" loading="lazy" role="presentation"/></picture></div></div><figcaption class="pk ff pl mg mh pm pn bf b bg z du">Disabling ASLR</figcaption></figure><p id="6821" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">Next, we can see that the DllEntryPoint is an empty export function, so we will want to redirect our execution flow to one of the working export functions, for this case, we will choose “SetPath”.</p><p id="28d9" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">To redirect the flow, do the following:</p><ol class=""><li id="4630" class="mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq bk">In IDA \ PE-Bear, copy the address of the required export function</li><li id="ac36" class="mq mr gu ms b mt ns mv mw mx nt mz na nb nu nd ne nf nv nh ni nj nw nl nm nn no np nq bk">In Xdbg, right click on RIP</li><li id="a156" class="mq mr gu ms b mt ns mv mw mx nt mz na nb nu nd ne nf nv nh ni nj nw nl nm nn no np nq bk">Click on “Modify Value”</li><li id="db1a" class="mq mr gu ms b mt ns mv mw mx nt mz na nb nu nd ne nf nv nh ni nj nw nl nm nn no np nq bk">Paste the address of the export function</li></ol><figure class="pb pc pd pe pf mo mg mh paragraph-image"><div role="button" tabindex="0" class="pg ph fj pi bh pj"><div class="mg mh qh"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*H9PeDPeek-mIwadY0gWYRw.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*H9PeDPeek-mIwadY0gWYRw.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*H9PeDPeek-mIwadY0gWYRw.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*H9PeDPeek-mIwadY0gWYRw.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*H9PeDPeek-mIwadY0gWYRw.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*H9PeDPeek-mIwadY0gWYRw.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H9PeDPeek-mIwadY0gWYRw.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*H9PeDPeek-mIwadY0gWYRw.png 640w, https://miro.medium.com/v2/resize:fit:720/1*H9PeDPeek-mIwadY0gWYRw.png 720w, https://miro.medium.com/v2/resize:fit:750/1*H9PeDPeek-mIwadY0gWYRw.png 750w, https://miro.medium.com/v2/resize:fit:786/1*H9PeDPeek-mIwadY0gWYRw.png 786w, https://miro.medium.com/v2/resize:fit:828/1*H9PeDPeek-mIwadY0gWYRw.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*H9PeDPeek-mIwadY0gWYRw.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*H9PeDPeek-mIwadY0gWYRw.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"/><img alt="" class="bh ln mp c" width="700" height="582" loading="lazy" role="presentation"/></picture></div></div><figcaption class="pk ff pl mg mh pm pn bf b bg z du">Changing the address</figcaption></figure><p id="c1b7" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">After clicking OK we will find ourselves at the beginning of the export function. This trick can be used in any other malware the executed via designated export function</p><figure class="pb pc pd pe pf mo mg mh paragraph-image"><div class="mg mh qi"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*Xpc-4dF-1Oc3E8TRH0uaIw.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*Xpc-4dF-1Oc3E8TRH0uaIw.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*Xpc-4dF-1Oc3E8TRH0uaIw.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*Xpc-4dF-1Oc3E8TRH0uaIw.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*Xpc-4dF-1Oc3E8TRH0uaIw.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*Xpc-4dF-1Oc3E8TRH0uaIw.png 1100w, https://miro.medium.com/v2/resize:fit:1364/format:webp/1*Xpc-4dF-1Oc3E8TRH0uaIw.png 1364w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 682px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*Xpc-4dF-1Oc3E8TRH0uaIw.png 640w, https://miro.medium.com/v2/resize:fit:720/1*Xpc-4dF-1Oc3E8TRH0uaIw.png 720w, https://miro.medium.com/v2/resize:fit:750/1*Xpc-4dF-1Oc3E8TRH0uaIw.png 750w, https://miro.medium.com/v2/resize:fit:786/1*Xpc-4dF-1Oc3E8TRH0uaIw.png 786w, https://miro.medium.com/v2/resize:fit:828/1*Xpc-4dF-1Oc3E8TRH0uaIw.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*Xpc-4dF-1Oc3E8TRH0uaIw.png 1100w, https://miro.medium.com/v2/resize:fit:1364/1*Xpc-4dF-1Oc3E8TRH0uaIw.png 1364w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 682px"/><img alt="" class="bh ln mp c" width="682" height="80" loading="lazy" role="presentation"/></picture></div><figcaption class="pk ff pl mg mh pm pn bf b bg z du">Bumblebee SetPath</figcaption></figure><p id="363a" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">From a reverse engineer perspective, the crypter is an inconvenient binary to inspect, and there are not many “quick wins” we can gather just by looking at it, however, this crypter is unique in today&#x27;s landscape so I will focus on the areas I found are the most interesting.</p><p id="8094" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">First, the crypter will start with a traditional unpacking activity, in the function <em class="nr">sub_180003490 </em>there are two other functions:</p><ol class=""><li id="f7a9" class="mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq bk"><em class="nr">sub_1800021D0 </em>- which will allocate virtual memory using <em class="nr">HeapAlloc </em>(this function will happen multiple times during the crypter unpacking)</li><li id="20d2" class="mq mr gu ms b mt ns mv mw mx nt mz na nb nu nd ne nf nv nh ni nj nw nl nm nn no np nq bk"><em class="nr">sub_1800029BC </em>- Which gets an embedded content and writes it into the newly allocated memory</li></ol><figure class="pb pc pd pe pf mo mg mh paragraph-image"><div role="button" tabindex="0" class="pg ph fj pi bh pj"><div class="mg mh qj"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*ez9iDaOPzCmKL-M2HpyGLA.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*ez9iDaOPzCmKL-M2HpyGLA.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*ez9iDaOPzCmKL-M2HpyGLA.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*ez9iDaOPzCmKL-M2HpyGLA.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*ez9iDaOPzCmKL-M2HpyGLA.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*ez9iDaOPzCmKL-M2HpyGLA.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ez9iDaOPzCmKL-M2HpyGLA.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*ez9iDaOPzCmKL-M2HpyGLA.png 640w, https://miro.medium.com/v2/resize:fit:720/1*ez9iDaOPzCmKL-M2HpyGLA.png 720w, https://miro.medium.com/v2/resize:fit:750/1*ez9iDaOPzCmKL-M2HpyGLA.png 750w, https://miro.medium.com/v2/resize:fit:786/1*ez9iDaOPzCmKL-M2HpyGLA.png 786w, https://miro.medium.com/v2/resize:fit:828/1*ez9iDaOPzCmKL-M2HpyGLA.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*ez9iDaOPzCmKL-M2HpyGLA.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*ez9iDaOPzCmKL-M2HpyGLA.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"/><img alt="" class="bh ln mp c" width="700" height="293" loading="lazy" role="presentation"/></picture></div></div><figcaption class="pk ff pl mg mh pm pn bf b bg z du">Bumblebee loader\crypter main</figcaption></figure><p id="4fa2" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">Then, the function <em class="nr">sub_180002FF4 </em>will be executed to do the following:</p><ol class=""><li id="36af" class="mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq bk">Allocate new virtual memory using the same <em class="nr">sub_1800021D0 </em>function.</li><li id="0934" class="mq mr gu ms b mt ns mv mw mx nt mz na nb nu nd ne nf nv nh ni nj nw nl nm nn no np nq bk">Manipulate the content from the first allocated buffer and write the output into the newly allocated memory</li></ol><figure class="pb pc pd pe pf mo mg mh paragraph-image"><div role="button" tabindex="0" class="pg ph fj pi bh pj"><div class="mg mh qk"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*fxlEM6gpstWILmBJpNtLcg.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*fxlEM6gpstWILmBJpNtLcg.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*fxlEM6gpstWILmBJpNtLcg.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*fxlEM6gpstWILmBJpNtLcg.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*fxlEM6gpstWILmBJpNtLcg.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*fxlEM6gpstWILmBJpNtLcg.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fxlEM6gpstWILmBJpNtLcg.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*fxlEM6gpstWILmBJpNtLcg.png 640w, https://miro.medium.com/v2/resize:fit:720/1*fxlEM6gpstWILmBJpNtLcg.png 720w, https://miro.medium.com/v2/resize:fit:750/1*fxlEM6gpstWILmBJpNtLcg.png 750w, https://miro.medium.com/v2/resize:fit:786/1*fxlEM6gpstWILmBJpNtLcg.png 786w, https://miro.medium.com/v2/resize:fit:828/1*fxlEM6gpstWILmBJpNtLcg.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*fxlEM6gpstWILmBJpNtLcg.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*fxlEM6gpstWILmBJpNtLcg.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"/><img alt="" class="bh ln mp c" width="700" height="274" loading="lazy" role="presentation"/></picture></div></div><figcaption class="pk ff pl mg mh pm pn bf b bg z du">Bumblebee loader\crypter main</figcaption></figure><p id="817f" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">The next step will be the function <em class="nr">sub_180004180</em>, this function will do the following:</p><ol class=""><li id="3495" class="mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq bk">It executes a function named <em class="nr">sub_180001670 </em>that will allocate multiple virtual memories using the already mentioned <em class="nr">sub_1800021D0</em>.</li><li id="976b" class="mq mr gu ms b mt ns mv mw mx nt mz na nb nu nd ne nf nv nh ni nj nw nl nm nn no np nq bk">Call the function named <em class="nr">sub_180003CE </em>that will use the virtual memory that was allocated in <em class="nr">sub_180002FF4</em>, do additional manipulations, and eventually writes an unpacked MZ into the last allocated buffer from the function <em class="nr">sub_180001670</em>.</li></ol><figure class="pb pc pd pe pf mo mg mh paragraph-image"><div role="button" tabindex="0" class="pg ph fj pi bh pj"><div class="mg mh ql"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*o1sv_BFsuTZPXfTuLjarYA.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*o1sv_BFsuTZPXfTuLjarYA.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*o1sv_BFsuTZPXfTuLjarYA.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*o1sv_BFsuTZPXfTuLjarYA.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*o1sv_BFsuTZPXfTuLjarYA.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*o1sv_BFsuTZPXfTuLjarYA.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*o1sv_BFsuTZPXfTuLjarYA.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*o1sv_BFsuTZPXfTuLjarYA.png 640w, https://miro.medium.com/v2/resize:fit:720/1*o1sv_BFsuTZPXfTuLjarYA.png 720w, https://miro.medium.com/v2/resize:fit:750/1*o1sv_BFsuTZPXfTuLjarYA.png 750w, https://miro.medium.com/v2/resize:fit:786/1*o1sv_BFsuTZPXfTuLjarYA.png 786w, https://miro.medium.com/v2/resize:fit:828/1*o1sv_BFsuTZPXfTuLjarYA.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*o1sv_BFsuTZPXfTuLjarYA.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*o1sv_BFsuTZPXfTuLjarYA.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"/><img alt="" class="bh ln mp c" width="700" height="217" loading="lazy" role="presentation"/></picture></div></div><figcaption class="pk ff pl mg mh pm pn bf b bg z du">Bumblebee loader\crypter main</figcaption></figure><p id="4ac2" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">When looking statically in the function <em class="nr">sub_180003CE</em>, the loop that will write the unpacked file will be the following:</p><figure class="pb pc pd pe pf mo mg mh paragraph-image"><div class="mg mh qm"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*8Sl8OTk6NSJX5kxlBb3Sqg.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*8Sl8OTk6NSJX5kxlBb3Sqg.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*8Sl8OTk6NSJX5kxlBb3Sqg.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*8Sl8OTk6NSJX5kxlBb3Sqg.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*8Sl8OTk6NSJX5kxlBb3Sqg.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*8Sl8OTk6NSJX5kxlBb3Sqg.png 1100w, https://miro.medium.com/v2/resize:fit:656/format:webp/1*8Sl8OTk6NSJX5kxlBb3Sqg.png 656w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 328px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*8Sl8OTk6NSJX5kxlBb3Sqg.png 640w, https://miro.medium.com/v2/resize:fit:720/1*8Sl8OTk6NSJX5kxlBb3Sqg.png 720w, https://miro.medium.com/v2/resize:fit:750/1*8Sl8OTk6NSJX5kxlBb3Sqg.png 750w, https://miro.medium.com/v2/resize:fit:786/1*8Sl8OTk6NSJX5kxlBb3Sqg.png 786w, https://miro.medium.com/v2/resize:fit:828/1*8Sl8OTk6NSJX5kxlBb3Sqg.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*8Sl8OTk6NSJX5kxlBb3Sqg.png 1100w, https://miro.medium.com/v2/resize:fit:656/1*8Sl8OTk6NSJX5kxlBb3Sqg.png 656w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 328px"/><img alt="" class="bh ln mp c" width="328" height="79" loading="lazy" role="presentation"/></picture></div><figcaption class="pk ff pl mg mh pm pn bf b bg z du">Bumblebee loader payload decryption</figcaption></figure><p id="9b7b" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">And when observing dynamically, it will look like the following:</p><figure class="pb pc pd pe pf mo mg mh paragraph-image"><div role="button" tabindex="0" class="pg ph fj pi bh pj"><div class="mg mh qn"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*-sjjkOn-yZM9jkfaYeFCBA.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*-sjjkOn-yZM9jkfaYeFCBA.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*-sjjkOn-yZM9jkfaYeFCBA.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*-sjjkOn-yZM9jkfaYeFCBA.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*-sjjkOn-yZM9jkfaYeFCBA.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*-sjjkOn-yZM9jkfaYeFCBA.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*-sjjkOn-yZM9jkfaYeFCBA.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*-sjjkOn-yZM9jkfaYeFCBA.png 640w, https://miro.medium.com/v2/resize:fit:720/1*-sjjkOn-yZM9jkfaYeFCBA.png 720w, https://miro.medium.com/v2/resize:fit:750/1*-sjjkOn-yZM9jkfaYeFCBA.png 750w, https://miro.medium.com/v2/resize:fit:786/1*-sjjkOn-yZM9jkfaYeFCBA.png 786w, https://miro.medium.com/v2/resize:fit:828/1*-sjjkOn-yZM9jkfaYeFCBA.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*-sjjkOn-yZM9jkfaYeFCBA.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*-sjjkOn-yZM9jkfaYeFCBA.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"/><img alt="" class="bh ln mp c" width="700" height="377" loading="lazy" role="presentation"/></picture></div></div><figcaption class="pk ff pl mg mh pm pn bf b bg z du">Bumblebee loader payload decryption</figcaption></figure><p id="3bd9" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">In the end, we get an allocated memory with Read-Write permissions with an unpacked payload inside.</p><figure class="pb pc pd pe pf mo mg mh paragraph-image"><div class="mg mh qo"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*V_sV8WKW7Gy_vjM57YO2tg.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*V_sV8WKW7Gy_vjM57YO2tg.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*V_sV8WKW7Gy_vjM57YO2tg.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*V_sV8WKW7Gy_vjM57YO2tg.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*V_sV8WKW7Gy_vjM57YO2tg.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*V_sV8WKW7Gy_vjM57YO2tg.png 1100w, https://miro.medium.com/v2/resize:fit:1230/format:webp/1*V_sV8WKW7Gy_vjM57YO2tg.png 1230w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 615px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*V_sV8WKW7Gy_vjM57YO2tg.png 640w, https://miro.medium.com/v2/resize:fit:720/1*V_sV8WKW7Gy_vjM57YO2tg.png 720w, https://miro.medium.com/v2/resize:fit:750/1*V_sV8WKW7Gy_vjM57YO2tg.png 750w, https://miro.medium.com/v2/resize:fit:786/1*V_sV8WKW7Gy_vjM57YO2tg.png 786w, https://miro.medium.com/v2/resize:fit:828/1*V_sV8WKW7Gy_vjM57YO2tg.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*V_sV8WKW7Gy_vjM57YO2tg.png 1100w, https://miro.medium.com/v2/resize:fit:1230/1*V_sV8WKW7Gy_vjM57YO2tg.png 1230w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 615px"/><img alt="" class="bh ln mp c" width="615" height="525" loading="lazy" role="presentation"/></picture></div><figcaption class="pk ff pl mg mh pm pn bf b bg z du">Bumblebee loader payload decrypted in process hacker</figcaption></figure><p id="93a7" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">Until now, everything that is observed are things that are pretty much common in other loaders \ crypters, however, we still have two unsolved questions:</p><ol class=""><li id="0f75" class="mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq bk">The code section of the payload does not have Execute permission, so it cant run.</li><li id="b9e7" class="mq mr gu ms b mt ns mv mw mx nt mz na nb nu nd ne nf nv nh ni nj nw nl nm nn no np nq bk">What makes this loader special?</li></ol><h2 id="149f" class="pp ny gu bf nz pq pr dy od ps pt ea oh nb pu pv pw nf px py pz nj qa qb qc qd bk">Enters the hook</h2><p id="154e" class="pw-post-body-paragraph mq mr gu ms b mt ov mv mw mx ow mz na nb ox nd ne nf oy nh ni nj oz nl nm nn gn bk">The loader will enter a function called <em class="nr">sub_180001000</em>, this function will create inline hooks[5] that will ignite the chain of events that will lead to the code execution.</p><figure class="pb pc pd pe pf mo mg mh paragraph-image"><div class="mg mh qp"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*D4yXs_AdtwMvRUR3QI6uEA.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*D4yXs_AdtwMvRUR3QI6uEA.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*D4yXs_AdtwMvRUR3QI6uEA.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*D4yXs_AdtwMvRUR3QI6uEA.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*D4yXs_AdtwMvRUR3QI6uEA.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*D4yXs_AdtwMvRUR3QI6uEA.png 1100w, https://miro.medium.com/v2/resize:fit:1028/format:webp/1*D4yXs_AdtwMvRUR3QI6uEA.png 1028w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 514px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*D4yXs_AdtwMvRUR3QI6uEA.png 640w, https://miro.medium.com/v2/resize:fit:720/1*D4yXs_AdtwMvRUR3QI6uEA.png 720w, https://miro.medium.com/v2/resize:fit:750/1*D4yXs_AdtwMvRUR3QI6uEA.png 750w, https://miro.medium.com/v2/resize:fit:786/1*D4yXs_AdtwMvRUR3QI6uEA.png 786w, https://miro.medium.com/v2/resize:fit:828/1*D4yXs_AdtwMvRUR3QI6uEA.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*D4yXs_AdtwMvRUR3QI6uEA.png 1100w, https://miro.medium.com/v2/resize:fit:1028/1*D4yXs_AdtwMvRUR3QI6uEA.png 1028w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 514px"/><img alt="" class="bh ln mp c" width="514" height="364" loading="lazy" role="presentation"/></picture></div><figcaption class="pk ff pl mg mh pm pn bf b bg z du">Bumblebee loader payload decryption</figcaption></figure><p id="fcb5" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">As we enter, we notice something interesting, the loader assign functions to a memory address, then it will call another function named <em class="nr">sub_100025EC</em>.</p><figure class="pb pc pd pe pf mo mg mh paragraph-image"><div class="mg mh qq"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*HkI0q_bK8OpHPxgzc97nbA.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*HkI0q_bK8OpHPxgzc97nbA.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*HkI0q_bK8OpHPxgzc97nbA.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*HkI0q_bK8OpHPxgzc97nbA.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*HkI0q_bK8OpHPxgzc97nbA.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*HkI0q_bK8OpHPxgzc97nbA.png 1100w, https://miro.medium.com/v2/resize:fit:1258/format:webp/1*HkI0q_bK8OpHPxgzc97nbA.png 1258w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 629px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*HkI0q_bK8OpHPxgzc97nbA.png 640w, https://miro.medium.com/v2/resize:fit:720/1*HkI0q_bK8OpHPxgzc97nbA.png 720w, https://miro.medium.com/v2/resize:fit:750/1*HkI0q_bK8OpHPxgzc97nbA.png 750w, https://miro.medium.com/v2/resize:fit:786/1*HkI0q_bK8OpHPxgzc97nbA.png 786w, https://miro.medium.com/v2/resize:fit:828/1*HkI0q_bK8OpHPxgzc97nbA.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*HkI0q_bK8OpHPxgzc97nbA.png 1100w, https://miro.medium.com/v2/resize:fit:1258/1*HkI0q_bK8OpHPxgzc97nbA.png 1258w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 629px"/><img alt="" class="bh ln mp c" width="629" height="122" loading="lazy" role="presentation"/></picture></div><figcaption class="pk ff pl mg mh pm pn bf b bg z du">Assign functions to addresses</figcaption></figure><p id="0e3f" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">This function will do the following:</p><ol class=""><li id="186d" class="mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq bk">Get Ntdll handle with <em class="nr">LoadLibrary</em></li><li id="0d61" class="mq mr gu ms b mt ns mv mw mx nt mz na nb nu nd ne nf nv nh ni nj nw nl nm nn no np nq bk">Get the address of <em class="nr">NtOpenFile</em></li><li id="7c11" class="mq mr gu ms b mt ns mv mw mx nt mz na nb nu nd ne nf nv nh ni nj nw nl nm nn no np nq bk">Get the address of <em class="nr">NtCreateSection</em></li><li id="aecd" class="mq mr gu ms b mt ns mv mw mx nt mz na nb nu nd ne nf nv nh ni nj nw nl nm nn no np nq bk">Get the address of <em class="nr">NtMapViewOfSection</em></li><li id="156a" class="mq mr gu ms b mt ns mv mw mx nt mz na nb nu nd ne nf nv nh ni nj nw nl nm nn no np nq bk">Return the data</li></ol><figure class="pb pc pd pe pf mo mg mh paragraph-image"><div class="mg mh qr"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*abc5_ZQVKRghtvRm_F3VFw.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*abc5_ZQVKRghtvRm_F3VFw.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*abc5_ZQVKRghtvRm_F3VFw.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*abc5_ZQVKRghtvRm_F3VFw.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*abc5_ZQVKRghtvRm_F3VFw.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*abc5_ZQVKRghtvRm_F3VFw.png 1100w, https://miro.medium.com/v2/resize:fit:1000/format:webp/1*abc5_ZQVKRghtvRm_F3VFw.png 1000w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 500px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*abc5_ZQVKRghtvRm_F3VFw.png 640w, https://miro.medium.com/v2/resize:fit:720/1*abc5_ZQVKRghtvRm_F3VFw.png 720w, https://miro.medium.com/v2/resize:fit:750/1*abc5_ZQVKRghtvRm_F3VFw.png 750w, https://miro.medium.com/v2/resize:fit:786/1*abc5_ZQVKRghtvRm_F3VFw.png 786w, https://miro.medium.com/v2/resize:fit:828/1*abc5_ZQVKRghtvRm_F3VFw.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*abc5_ZQVKRghtvRm_F3VFw.png 1100w, https://miro.medium.com/v2/resize:fit:1000/1*abc5_ZQVKRghtvRm_F3VFw.png 1000w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 500px"/><img alt="" class="bh ln mp c" width="500" height="468" loading="lazy" role="presentation"/></picture></div><figcaption class="pk ff pl mg mh pm pn bf b bg z du">Getting NT functions</figcaption></figure><p id="6ac7" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">To observe it dynamically, we can just go to the debugger and step over the functions themselves.</p><figure class="pb pc pd pe pf mo mg mh paragraph-image"><div role="button" tabindex="0" class="pg ph fj pi bh pj"><div class="mg mh qs"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*oVbmew3gnkSdrM2bF6pnfw.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*oVbmew3gnkSdrM2bF6pnfw.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*oVbmew3gnkSdrM2bF6pnfw.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*oVbmew3gnkSdrM2bF6pnfw.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*oVbmew3gnkSdrM2bF6pnfw.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*oVbmew3gnkSdrM2bF6pnfw.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*oVbmew3gnkSdrM2bF6pnfw.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*oVbmew3gnkSdrM2bF6pnfw.png 640w, https://miro.medium.com/v2/resize:fit:720/1*oVbmew3gnkSdrM2bF6pnfw.png 720w, https://miro.medium.com/v2/resize:fit:750/1*oVbmew3gnkSdrM2bF6pnfw.png 750w, https://miro.medium.com/v2/resize:fit:786/1*oVbmew3gnkSdrM2bF6pnfw.png 786w, https://miro.medium.com/v2/resize:fit:828/1*oVbmew3gnkSdrM2bF6pnfw.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*oVbmew3gnkSdrM2bF6pnfw.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*oVbmew3gnkSdrM2bF6pnfw.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"/><img alt="" class="bh ln mp c" width="700" height="37" loading="lazy" role="presentation"/></picture></div></div><figcaption class="pk ff pl mg mh pm pn bf b bg z du">Getting NT functions</figcaption></figure><p id="3c73" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">After exiting <em class="nr">sub_100025EC</em>, our attention will go to a function named <em class="nr">sub_1800037C4</em>. This function will be responsible to install a hook in the aforementioned NT functions.</p><p id="bb67" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">It will do it in the following way:</p><ol class=""><li id="8eaf" class="mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq bk">Call <em class="nr">VirtualProtect </em>to change the protection of the area it wants to write into to be writeable</li><li id="6ade" class="mq mr gu ms b mt ns mv mw mx nt mz na nb nu nd ne nf nv nh ni nj nw nl nm nn no np nq bk">Call <em class="nr">sub_180002978 </em>that will take as arguments:<br/>1. The function to write into <br/>2. The content it wants to write<br/>3. The size</li><li id="c8da" class="mq mr gu ms b mt ns mv mw mx nt mz na nb nu nd ne nf nv nh ni nj nw nl nm nn no np nq bk">Call <em class="nr">VirtualProtect </em>to change the protection again to not be writeable</li></ol><figure class="pb pc pd pe pf mo mg mh paragraph-image"><div class="mg mh qt"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*LtJSSlRWSzv6n4KlC64_Vw.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*LtJSSlRWSzv6n4KlC64_Vw.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*LtJSSlRWSzv6n4KlC64_Vw.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*LtJSSlRWSzv6n4KlC64_Vw.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*LtJSSlRWSzv6n4KlC64_Vw.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*LtJSSlRWSzv6n4KlC64_Vw.png 1100w, https://miro.medium.com/v2/resize:fit:1074/format:webp/1*LtJSSlRWSzv6n4KlC64_Vw.png 1074w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 537px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*LtJSSlRWSzv6n4KlC64_Vw.png 640w, https://miro.medium.com/v2/resize:fit:720/1*LtJSSlRWSzv6n4KlC64_Vw.png 720w, https://miro.medium.com/v2/resize:fit:750/1*LtJSSlRWSzv6n4KlC64_Vw.png 750w, https://miro.medium.com/v2/resize:fit:786/1*LtJSSlRWSzv6n4KlC64_Vw.png 786w, https://miro.medium.com/v2/resize:fit:828/1*LtJSSlRWSzv6n4KlC64_Vw.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*LtJSSlRWSzv6n4KlC64_Vw.png 1100w, https://miro.medium.com/v2/resize:fit:1074/1*LtJSSlRWSzv6n4KlC64_Vw.png 1074w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 537px"/><img alt="" class="bh ln mp c" width="537" height="159" loading="lazy" role="presentation"/></picture></div><figcaption class="pk ff pl mg mh pm pn bf b bg z du">Setting hook</figcaption></figure><p id="6c30" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">Eventually, this activity will occur inside a loop to install the hooks in each of the NT functions. The hook that will be installed will be the functions that have been assigned to memory addresses at the beginning of the larger function.</p><ol class=""><li id="e963" class="mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq bk"><em class="nr">sub_180001D4 </em>for NtMapViewOfSection</li><li id="cb3c" class="mq mr gu ms b mt ns mv mw mx nt mz na nb nu nd ne nf nv nh ni nj nw nl nm nn no np nq bk"><em class="nr">sub_1800023D4 </em>for NtOpenFile</li><li id="9c7a" class="mq mr gu ms b mt ns mv mw mx nt mz na nb nu nd ne nf nv nh ni nj nw nl nm nn no np nq bk"><em class="nr">sub_1800041EC </em>for NtCreateSection</li></ol><p id="fb1e" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">If we wanted to observe the changes dynamically we have two options, the first one is to just observe it in the debugger by step over <em class="nr">sub_180002978</em></p><figure class="pb pc pd pe pf mo mg mh paragraph-image"><div class="mg mh qu"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*0oQzk2MaBpQzacH7UTj9Xg.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*0oQzk2MaBpQzacH7UTj9Xg.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*0oQzk2MaBpQzacH7UTj9Xg.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*0oQzk2MaBpQzacH7UTj9Xg.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*0oQzk2MaBpQzacH7UTj9Xg.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*0oQzk2MaBpQzacH7UTj9Xg.png 1100w, https://miro.medium.com/v2/resize:fit:1202/format:webp/1*0oQzk2MaBpQzacH7UTj9Xg.png 1202w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 601px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*0oQzk2MaBpQzacH7UTj9Xg.png 640w, https://miro.medium.com/v2/resize:fit:720/1*0oQzk2MaBpQzacH7UTj9Xg.png 720w, https://miro.medium.com/v2/resize:fit:750/1*0oQzk2MaBpQzacH7UTj9Xg.png 750w, https://miro.medium.com/v2/resize:fit:786/1*0oQzk2MaBpQzacH7UTj9Xg.png 786w, https://miro.medium.com/v2/resize:fit:828/1*0oQzk2MaBpQzacH7UTj9Xg.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*0oQzk2MaBpQzacH7UTj9Xg.png 1100w, https://miro.medium.com/v2/resize:fit:1202/1*0oQzk2MaBpQzacH7UTj9Xg.png 1202w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 601px"/><img alt="" class="bh ln mp c" width="601" height="236" loading="lazy" role="presentation"/></picture></div><figcaption class="pk ff pl mg mh pm pn bf b bg z du">Hooked NT functions</figcaption></figure><p id="229e" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">Another option is to use the took Hollow hunter[6] with the “/hooks” as an argument. Then, we will have a .tag file from the hooked DLL (if found of course)</p><figure class="pb pc pd pe pf mo mg mh paragraph-image"><div class="mg mh qv"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*JtAazixTTL29gwv7mA7ztg.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*JtAazixTTL29gwv7mA7ztg.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*JtAazixTTL29gwv7mA7ztg.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*JtAazixTTL29gwv7mA7ztg.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*JtAazixTTL29gwv7mA7ztg.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*JtAazixTTL29gwv7mA7ztg.png 1100w, https://miro.medium.com/v2/resize:fit:942/format:webp/1*JtAazixTTL29gwv7mA7ztg.png 942w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 471px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*JtAazixTTL29gwv7mA7ztg.png 640w, https://miro.medium.com/v2/resize:fit:720/1*JtAazixTTL29gwv7mA7ztg.png 720w, https://miro.medium.com/v2/resize:fit:750/1*JtAazixTTL29gwv7mA7ztg.png 750w, https://miro.medium.com/v2/resize:fit:786/1*JtAazixTTL29gwv7mA7ztg.png 786w, https://miro.medium.com/v2/resize:fit:828/1*JtAazixTTL29gwv7mA7ztg.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*JtAazixTTL29gwv7mA7ztg.png 1100w, https://miro.medium.com/v2/resize:fit:942/1*JtAazixTTL29gwv7mA7ztg.png 942w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 471px"/><img alt="" class="bh ln mp c" width="471" height="270" loading="lazy" role="presentation"/></picture></div><figcaption class="pk ff pl mg mh pm pn bf b bg z du">View hooks using hollow hunter</figcaption></figure><p id="9c66" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">And when we open this file with a text editor we could see the indication of who are the hooked function, and where the hook itself lies.</p><figure class="pb pc pd pe pf mo mg mh paragraph-image"><div role="button" tabindex="0" class="pg ph fj pi bh pj"><div class="mg mh qw"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*JtQYKv2fdneg60jXJhMaYg.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*JtQYKv2fdneg60jXJhMaYg.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*JtQYKv2fdneg60jXJhMaYg.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*JtQYKv2fdneg60jXJhMaYg.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*JtQYKv2fdneg60jXJhMaYg.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*JtQYKv2fdneg60jXJhMaYg.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*JtQYKv2fdneg60jXJhMaYg.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*JtQYKv2fdneg60jXJhMaYg.png 640w, https://miro.medium.com/v2/resize:fit:720/1*JtQYKv2fdneg60jXJhMaYg.png 720w, https://miro.medium.com/v2/resize:fit:750/1*JtQYKv2fdneg60jXJhMaYg.png 750w, https://miro.medium.com/v2/resize:fit:786/1*JtQYKv2fdneg60jXJhMaYg.png 786w, https://miro.medium.com/v2/resize:fit:828/1*JtQYKv2fdneg60jXJhMaYg.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*JtQYKv2fdneg60jXJhMaYg.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*JtQYKv2fdneg60jXJhMaYg.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"/><img alt="" class="bh ln mp c" width="700" height="79" loading="lazy" role="presentation"/></picture></div></div><figcaption class="pk ff pl mg mh pm pn bf b bg z du">View hooks using hollow hunter</figcaption></figure><p id="f9cc" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">To summarize the hooking procedure, it will look like this:</p><figure class="pb pc pd pe pf mo mg mh paragraph-image"><div role="button" tabindex="0" class="pg ph fj pi bh pj"><div class="mg mh qx"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*A7PmIFpkFJ8o1_Ja9TsdxQ.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*A7PmIFpkFJ8o1_Ja9TsdxQ.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*A7PmIFpkFJ8o1_Ja9TsdxQ.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*A7PmIFpkFJ8o1_Ja9TsdxQ.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*A7PmIFpkFJ8o1_Ja9TsdxQ.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*A7PmIFpkFJ8o1_Ja9TsdxQ.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*A7PmIFpkFJ8o1_Ja9TsdxQ.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*A7PmIFpkFJ8o1_Ja9TsdxQ.png 640w, https://miro.medium.com/v2/resize:fit:720/1*A7PmIFpkFJ8o1_Ja9TsdxQ.png 720w, https://miro.medium.com/v2/resize:fit:750/1*A7PmIFpkFJ8o1_Ja9TsdxQ.png 750w, https://miro.medium.com/v2/resize:fit:786/1*A7PmIFpkFJ8o1_Ja9TsdxQ.png 786w, https://miro.medium.com/v2/resize:fit:828/1*A7PmIFpkFJ8o1_Ja9TsdxQ.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*A7PmIFpkFJ8o1_Ja9TsdxQ.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*A7PmIFpkFJ8o1_Ja9TsdxQ.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"/><img alt="" class="bh ln mp c" width="700" height="480" loading="lazy" role="presentation"/></picture></div></div><figcaption class="pk ff pl mg mh pm pn bf b bg z du">Bumblebee loader install hook mechanism</figcaption></figure><h2 id="daaf" class="pp ny gu bf nz pq pr dy od ps pt ea oh nb pu pv pw nf px py pz nj qa qb qc qd bk">Executing the code</h2><p id="1c9e" class="pw-post-body-paragraph mq mr gu ms b mt ov mv mw mx ow mz na nb ox nd ne nf oy nh ni nj oz nl nm nn gn bk">After we finish setting the hooks, we will head to the function <em class="nr">sub_1800013A0</em></p><figure class="pb pc pd pe pf mo mg mh paragraph-image"><div class="mg mh qy"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*iZkubghe8brKYhMA2mWnig.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*iZkubghe8brKYhMA2mWnig.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*iZkubghe8brKYhMA2mWnig.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*iZkubghe8brKYhMA2mWnig.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*iZkubghe8brKYhMA2mWnig.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*iZkubghe8brKYhMA2mWnig.png 1100w, https://miro.medium.com/v2/resize:fit:1036/format:webp/1*iZkubghe8brKYhMA2mWnig.png 1036w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 518px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*iZkubghe8brKYhMA2mWnig.png 640w, https://miro.medium.com/v2/resize:fit:720/1*iZkubghe8brKYhMA2mWnig.png 720w, https://miro.medium.com/v2/resize:fit:750/1*iZkubghe8brKYhMA2mWnig.png 750w, https://miro.medium.com/v2/resize:fit:786/1*iZkubghe8brKYhMA2mWnig.png 786w, https://miro.medium.com/v2/resize:fit:828/1*iZkubghe8brKYhMA2mWnig.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*iZkubghe8brKYhMA2mWnig.png 1100w, https://miro.medium.com/v2/resize:fit:1036/1*iZkubghe8brKYhMA2mWnig.png 1036w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 518px"/><img alt="" class="bh ln mp c" width="518" height="356" loading="lazy" role="presentation"/></picture></div><figcaption class="pk ff pl mg mh pm pn bf b bg z du">Bumblebee loader\crypter main</figcaption></figure><p id="0f95" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">This function will attempt to execute the DLL “<em class="nr">GdiPlus.dll</em>” using the API call <em class="nr">LoadLibrary</em>, with SetPath as an export function.</p><figure class="pb pc pd pe pf mo mg mh paragraph-image"><div class="mg mh qz"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*0bEYpAPwPCTmasBBUythCA.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*0bEYpAPwPCTmasBBUythCA.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*0bEYpAPwPCTmasBBUythCA.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*0bEYpAPwPCTmasBBUythCA.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*0bEYpAPwPCTmasBBUythCA.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*0bEYpAPwPCTmasBBUythCA.png 1100w, https://miro.medium.com/v2/resize:fit:528/format:webp/1*0bEYpAPwPCTmasBBUythCA.png 528w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 264px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*0bEYpAPwPCTmasBBUythCA.png 640w, https://miro.medium.com/v2/resize:fit:720/1*0bEYpAPwPCTmasBBUythCA.png 720w, https://miro.medium.com/v2/resize:fit:750/1*0bEYpAPwPCTmasBBUythCA.png 750w, https://miro.medium.com/v2/resize:fit:786/1*0bEYpAPwPCTmasBBUythCA.png 786w, https://miro.medium.com/v2/resize:fit:828/1*0bEYpAPwPCTmasBBUythCA.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*0bEYpAPwPCTmasBBUythCA.png 1100w, https://miro.medium.com/v2/resize:fit:528/1*0bEYpAPwPCTmasBBUythCA.png 528w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 264px"/><img alt="" class="bh ln mp c" width="264" height="90" loading="lazy" role="presentation"/></picture></div><figcaption class="pk ff pl mg mh pm pn bf b bg z du">LoadLibrary loading GdiPlus.dll</figcaption></figure><figure class="pb pc pd pe pf mo mg mh paragraph-image"><div class="mg mh ra"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*5QkNSYwF5TJBdsQtHCvyLA.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*5QkNSYwF5TJBdsQtHCvyLA.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*5QkNSYwF5TJBdsQtHCvyLA.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*5QkNSYwF5TJBdsQtHCvyLA.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*5QkNSYwF5TJBdsQtHCvyLA.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*5QkNSYwF5TJBdsQtHCvyLA.png 1100w, https://miro.medium.com/v2/resize:fit:1094/format:webp/1*5QkNSYwF5TJBdsQtHCvyLA.png 1094w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 547px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*5QkNSYwF5TJBdsQtHCvyLA.png 640w, https://miro.medium.com/v2/resize:fit:720/1*5QkNSYwF5TJBdsQtHCvyLA.png 720w, https://miro.medium.com/v2/resize:fit:750/1*5QkNSYwF5TJBdsQtHCvyLA.png 750w, https://miro.medium.com/v2/resize:fit:786/1*5QkNSYwF5TJBdsQtHCvyLA.png 786w, https://miro.medium.com/v2/resize:fit:828/1*5QkNSYwF5TJBdsQtHCvyLA.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*5QkNSYwF5TJBdsQtHCvyLA.png 1100w, https://miro.medium.com/v2/resize:fit:1094/1*5QkNSYwF5TJBdsQtHCvyLA.png 1094w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 547px"/><img alt="" class="bh ln mp c" width="547" height="37" loading="lazy" role="presentation"/></picture></div><figcaption class="pk ff pl mg mh pm pn bf b bg z du">LoadLibrary loading GdiPlus.dll</figcaption></figure><p id="2c07" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk"><strong class="ms gv">Q</strong>: Why does the malware even want to use <em class="nr">GdiPlus.dll</em>? <br/><strong class="ms gv">A</strong>: It doesn&#x27;t. <br/><strong class="ms gv">Q</strong>: So why the need to load it?<br/><strong class="ms gv">A</strong>: Because it is not loaded (wait what?!)</p><p id="2e9a" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">The malware will attempt to use some (and unique) custom unpacking:</p><ol class=""><li id="5fb2" class="mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq bk">When <em class="nr">LoadLibrary </em>loads a DLL file, it uses internally the hooked NT function as part of its internal activity.</li><li id="5087" class="mq mr gu ms b mt ns mv mw mx nt mz na nb nu nd ne nf nv nh ni nj nw nl nm nn no np nq bk">The malware chooses a DLL that is not loaded yet.</li><li id="72a7" class="mq mr gu ms b mt ns mv mw mx nt mz na nb nu nd ne nf nv nh ni nj nw nl nm nn no np nq bk"><em class="nr">NtOpenFile </em>will get a file handle of <em class="nr">GdiPlus.dll</em></li><li id="bf8b" class="mq mr gu ms b mt ns mv mw mx nt mz na nb nu nd ne nf nv nh ni nj nw nl nm nn no np nq bk"><em class="nr">NtCreateSection </em>will create a section for the file handle of <em class="nr">GdiPlus.dll</em></li></ol><p id="a74c" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">However, here is when things become tricky, when the <em class="nr">LoadLibrary </em>will try to use <em class="nr">MapViewOfSection </em>to map the <em class="nr">GdiPlus.dll</em> section, the hook function of <em class="nr">MapViewOfSection </em>(<em class="nr">sub_180001D4C</em>) will do the following:</p><ol class=""><li id="27ee" class="mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq bk">It will use <em class="nr">CreateSection </em>to create a new section with READ-WRITE-EXECUTE permissions, without any file handle to associate it with.</li><li id="96a2" class="mq mr gu ms b mt ns mv mw mx nt mz na nb nu nd ne nf nv nh ni nj nw nl nm nn no np nq bk">It will write the unpacked malicious content into this section</li><li id="a56a" class="mq mr gu ms b mt ns mv mw mx nt mz na nb nu nd ne nf nv nh ni nj nw nl nm nn no np nq bk">It returns NTSTATUS_SUCCESS to the <em class="nr">LoadLibrary </em>so it will seem to it as if <em class="nr">GdiPlus.dll </em>was mapped successfully.</li></ol><figure class="pb pc pd pe pf mo mg mh paragraph-image"><div role="button" tabindex="0" class="pg ph fj pi bh pj"><div class="mg mh rb"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*HYi8U-NZ5vmslw8CL5N67A.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*HYi8U-NZ5vmslw8CL5N67A.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*HYi8U-NZ5vmslw8CL5N67A.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*HYi8U-NZ5vmslw8CL5N67A.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*HYi8U-NZ5vmslw8CL5N67A.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*HYi8U-NZ5vmslw8CL5N67A.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*HYi8U-NZ5vmslw8CL5N67A.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*HYi8U-NZ5vmslw8CL5N67A.png 640w, https://miro.medium.com/v2/resize:fit:720/1*HYi8U-NZ5vmslw8CL5N67A.png 720w, https://miro.medium.com/v2/resize:fit:750/1*HYi8U-NZ5vmslw8CL5N67A.png 750w, https://miro.medium.com/v2/resize:fit:786/1*HYi8U-NZ5vmslw8CL5N67A.png 786w, https://miro.medium.com/v2/resize:fit:828/1*HYi8U-NZ5vmslw8CL5N67A.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*HYi8U-NZ5vmslw8CL5N67A.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*HYi8U-NZ5vmslw8CL5N67A.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"/><img alt="" class="bh ln mp c" width="700" height="387" loading="lazy" role="presentation"/></picture></div></div><figcaption class="pk ff pl mg mh pm pn bf b bg z du">Hooked NtMapViewOfSection mechanism</figcaption></figure><p id="7a19" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">The result will be an unpacked bumblebee malware that resides in the RWX section and is associated with <em class="nr">GdiPlus.dll</em>. Interestingly, the <em class="nr">GdiPlus.dll</em> is considered a relocated DLL in Process hacker.</p><figure class="pb pc pd pe pf mo mg mh paragraph-image"><div role="button" tabindex="0" class="pg ph fj pi bh pj"><div class="mg mh rc"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*0DswdV1ARzZAaXVoQG-7cg.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*0DswdV1ARzZAaXVoQG-7cg.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*0DswdV1ARzZAaXVoQG-7cg.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*0DswdV1ARzZAaXVoQG-7cg.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*0DswdV1ARzZAaXVoQG-7cg.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*0DswdV1ARzZAaXVoQG-7cg.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*0DswdV1ARzZAaXVoQG-7cg.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*0DswdV1ARzZAaXVoQG-7cg.png 640w, https://miro.medium.com/v2/resize:fit:720/1*0DswdV1ARzZAaXVoQG-7cg.png 720w, https://miro.medium.com/v2/resize:fit:750/1*0DswdV1ARzZAaXVoQG-7cg.png 750w, https://miro.medium.com/v2/resize:fit:786/1*0DswdV1ARzZAaXVoQG-7cg.png 786w, https://miro.medium.com/v2/resize:fit:828/1*0DswdV1ARzZAaXVoQG-7cg.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*0DswdV1ARzZAaXVoQG-7cg.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*0DswdV1ARzZAaXVoQG-7cg.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"/><img alt="" class="bh ln mp c" width="700" height="345" loading="lazy" role="presentation"/></picture></div></div><figcaption class="pk ff pl mg mh pm pn bf b bg z du">Relocated module point to RWX section</figcaption></figure><h2 id="c3bb" class="pp ny gu bf nz pq pr dy od ps pt ea oh nb pu pv pw nf px py pz nj qa qb qc qd bk">Bumblebee dropper high lever summary</h2><p id="b356" class="pw-post-body-paragraph mq mr gu ms b mt ov mv mw mx ow mz na nb ox nd ne nf oy nh ni nj oz nl nm nn gn bk">If we want to look at all the dropper unpacking mechanism steps in a high-level overview and summarize them into three steps, it will look like this:</p><figure class="pb pc pd pe pf mo mg mh paragraph-image"><div role="button" tabindex="0" class="pg ph fj pi bh pj"><div class="mg mh rd"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*ZyU_42T2Cnk4o5DAIQ62gQ.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*ZyU_42T2Cnk4o5DAIQ62gQ.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*ZyU_42T2Cnk4o5DAIQ62gQ.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*ZyU_42T2Cnk4o5DAIQ62gQ.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*ZyU_42T2Cnk4o5DAIQ62gQ.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*ZyU_42T2Cnk4o5DAIQ62gQ.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZyU_42T2Cnk4o5DAIQ62gQ.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*ZyU_42T2Cnk4o5DAIQ62gQ.png 640w, https://miro.medium.com/v2/resize:fit:720/1*ZyU_42T2Cnk4o5DAIQ62gQ.png 720w, https://miro.medium.com/v2/resize:fit:750/1*ZyU_42T2Cnk4o5DAIQ62gQ.png 750w, https://miro.medium.com/v2/resize:fit:786/1*ZyU_42T2Cnk4o5DAIQ62gQ.png 786w, https://miro.medium.com/v2/resize:fit:828/1*ZyU_42T2Cnk4o5DAIQ62gQ.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*ZyU_42T2Cnk4o5DAIQ62gQ.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*ZyU_42T2Cnk4o5DAIQ62gQ.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"/><img alt="" class="bh ln mp c" width="700" height="712" loading="lazy" role="presentation"/></picture></div></div><figcaption class="pk ff pl mg mh pm pn bf b bg z du">Bumblebee dropper overview</figcaption></figure><h1 id="7885" class="nx ny gu bf nz oa ob oc od oe of og oh oi oj ok ol om on oo op oq or os ot ou bk">PART 2</h1><h1 id="bb98" class="nx ny gu bf nz oa ob oc od oe of og oh oi oj ok ol om on oo op oq or os ot ou bk">The bee: Investigating the bumblebee’s payload</h1><figure class="pb pc pd pe pf mo mg mh paragraph-image"><div role="button" tabindex="0" class="pg ph fj pi bh pj"><div class="mg mh re"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*i-pEV2hH9-qspahKip2m6g.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*i-pEV2hH9-qspahKip2m6g.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*i-pEV2hH9-qspahKip2m6g.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*i-pEV2hH9-qspahKip2m6g.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*i-pEV2hH9-qspahKip2m6g.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*i-pEV2hH9-qspahKip2m6g.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*i-pEV2hH9-qspahKip2m6g.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*i-pEV2hH9-qspahKip2m6g.png 640w, https://miro.medium.com/v2/resize:fit:720/1*i-pEV2hH9-qspahKip2m6g.png 720w, https://miro.medium.com/v2/resize:fit:750/1*i-pEV2hH9-qspahKip2m6g.png 750w, https://miro.medium.com/v2/resize:fit:786/1*i-pEV2hH9-qspahKip2m6g.png 786w, https://miro.medium.com/v2/resize:fit:828/1*i-pEV2hH9-qspahKip2m6g.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*i-pEV2hH9-qspahKip2m6g.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*i-pEV2hH9-qspahKip2m6g.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"/><img alt="" class="bh ln mp c" width="700" height="348" loading="lazy" role="presentation"/></picture></div></div><figcaption class="pk ff pl mg mh pm pn bf b bg z du">Unpacked Bumblebee payload</figcaption></figure><p id="1b10" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">The unpacked malware is a large 64-bit file with quite high entropy. <br/>This file appears to be the core component of the Bumblebee malware. It features many traditional capabilities we would expect from malware, such as internet communication, file manipulation, collecting user information, cryptography libraries, etc.</p><p id="ff91" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">In my article I will not cover this file as much because of scoping decisions, however, some interesting code parts to mention are:</p><h2 id="7d87" class="pp ny gu bf nz pq pr dy od ps pt ea oh nb pu pv pw nf px py pz nj qa qb qc qd bk">Stolen anti-analysis code</h2><p id="284f" class="pw-post-body-paragraph mq mr gu ms b mt ov mv mw mx ow mz na nb ox nd ne nf oy nh ni nj oz nl nm nn gn bk">As with many malware, Bumblebee also has anti-analysis tricks, however, the majority of them are grouped in one large function. Also, During my observation, I notice that additional anti-analysis checks have been added as time goes by, which indicates a quick evolving malware or that the authors are still in the “testing the waters” phase.</p><p id="2116" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">In addition, this entire anti-analysis function code is taken from the GitHub page of the “al-khaser project”[7]. For good measure, I will show some examples.</p><p id="7b0d" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk"><strong class="ms gv">Searching for processes</strong></p><p id="c6c0" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">The malware will search for multiple tools that are being used for dynamic and static malware analysis tools. The malware will iterate through the processes using <em class="nr">CreateToolHelp32Snapshot</em>.</p><figure class="pb pc pd pe pf mo mg mh paragraph-image"><div role="button" tabindex="0" class="pg ph fj pi bh pj"><div class="mg mh rf"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*n45plFDNoltaq-QobNbPHQ.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*n45plFDNoltaq-QobNbPHQ.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*n45plFDNoltaq-QobNbPHQ.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*n45plFDNoltaq-QobNbPHQ.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*n45plFDNoltaq-QobNbPHQ.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*n45plFDNoltaq-QobNbPHQ.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*n45plFDNoltaq-QobNbPHQ.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*n45plFDNoltaq-QobNbPHQ.png 640w, https://miro.medium.com/v2/resize:fit:720/1*n45plFDNoltaq-QobNbPHQ.png 720w, https://miro.medium.com/v2/resize:fit:750/1*n45plFDNoltaq-QobNbPHQ.png 750w, https://miro.medium.com/v2/resize:fit:786/1*n45plFDNoltaq-QobNbPHQ.png 786w, https://miro.medium.com/v2/resize:fit:828/1*n45plFDNoltaq-QobNbPHQ.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*n45plFDNoltaq-QobNbPHQ.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*n45plFDNoltaq-QobNbPHQ.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"/><img alt="" class="bh ln mp c" width="700" height="426" loading="lazy" role="presentation"/></picture></div></div><figcaption class="pk ff pl mg mh pm pn bf b bg z du">Searching for processes in Bumblebee</figcaption></figure><p id="ac77" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">As said, this code is the exact code found in the al-khaser project.</p><figure class="pb pc pd pe pf mo mg mh paragraph-image"><div class="mg mh rg"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*_Zn_zaaTgHSPH_RiWbndtw.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*_Zn_zaaTgHSPH_RiWbndtw.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*_Zn_zaaTgHSPH_RiWbndtw.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*_Zn_zaaTgHSPH_RiWbndtw.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*_Zn_zaaTgHSPH_RiWbndtw.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*_Zn_zaaTgHSPH_RiWbndtw.png 1100w, https://miro.medium.com/v2/resize:fit:1394/format:webp/1*_Zn_zaaTgHSPH_RiWbndtw.png 1394w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 697px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*_Zn_zaaTgHSPH_RiWbndtw.png 640w, https://miro.medium.com/v2/resize:fit:720/1*_Zn_zaaTgHSPH_RiWbndtw.png 720w, https://miro.medium.com/v2/resize:fit:750/1*_Zn_zaaTgHSPH_RiWbndtw.png 750w, https://miro.medium.com/v2/resize:fit:786/1*_Zn_zaaTgHSPH_RiWbndtw.png 786w, https://miro.medium.com/v2/resize:fit:828/1*_Zn_zaaTgHSPH_RiWbndtw.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*_Zn_zaaTgHSPH_RiWbndtw.png 1100w, https://miro.medium.com/v2/resize:fit:1394/1*_Zn_zaaTgHSPH_RiWbndtw.png 1394w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 697px"/><img alt="" class="bh ln mp c" width="697" height="672" loading="lazy" role="presentation"/></picture></div><figcaption class="pk ff pl mg mh pm pn bf b bg z du">al-khaser source code</figcaption></figure><p id="bdd7" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">The malware also attempts to detect any kind of virtualization environment with the detection of their processes, it varies from Vmware to Vbox processes.</p><figure class="pb pc pd pe pf mo mg mh paragraph-image"><div class="mg mh rh"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*NiQwFzicYMkiIqGB9D6nWQ.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*NiQwFzicYMkiIqGB9D6nWQ.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*NiQwFzicYMkiIqGB9D6nWQ.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*NiQwFzicYMkiIqGB9D6nWQ.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*NiQwFzicYMkiIqGB9D6nWQ.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*NiQwFzicYMkiIqGB9D6nWQ.png 1100w, https://miro.medium.com/v2/resize:fit:868/format:webp/1*NiQwFzicYMkiIqGB9D6nWQ.png 868w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 434px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*NiQwFzicYMkiIqGB9D6nWQ.png 640w, https://miro.medium.com/v2/resize:fit:720/1*NiQwFzicYMkiIqGB9D6nWQ.png 720w, https://miro.medium.com/v2/resize:fit:750/1*NiQwFzicYMkiIqGB9D6nWQ.png 750w, https://miro.medium.com/v2/resize:fit:786/1*NiQwFzicYMkiIqGB9D6nWQ.png 786w, https://miro.medium.com/v2/resize:fit:828/1*NiQwFzicYMkiIqGB9D6nWQ.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*NiQwFzicYMkiIqGB9D6nWQ.png 1100w, https://miro.medium.com/v2/resize:fit:868/1*NiQwFzicYMkiIqGB9D6nWQ.png 868w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 434px"/><img alt="" class="bh ln mp c" width="434" height="167" loading="lazy" role="presentation"/></picture></div><figcaption class="pk ff pl mg mh pm pn bf b bg z du">Searching for Vmware processes in Bumblebee</figcaption></figure><p id="cbdd" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk"><strong class="ms gv">Searching registry keys</strong></p><p id="55a5" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">The malware will attempt to search for designated registry keys that indicate any kind of virtual environment from multiple products.</p><figure class="pb pc pd pe pf mo mg mh paragraph-image"><div class="mg mh ri"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*Tk4CAcfny5Dl78YqnNitbQ.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*Tk4CAcfny5Dl78YqnNitbQ.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*Tk4CAcfny5Dl78YqnNitbQ.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*Tk4CAcfny5Dl78YqnNitbQ.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*Tk4CAcfny5Dl78YqnNitbQ.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*Tk4CAcfny5Dl78YqnNitbQ.png 1100w, https://miro.medium.com/v2/resize:fit:988/format:webp/1*Tk4CAcfny5Dl78YqnNitbQ.png 988w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 494px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*Tk4CAcfny5Dl78YqnNitbQ.png 640w, https://miro.medium.com/v2/resize:fit:720/1*Tk4CAcfny5Dl78YqnNitbQ.png 720w, https://miro.medium.com/v2/resize:fit:750/1*Tk4CAcfny5Dl78YqnNitbQ.png 750w, https://miro.medium.com/v2/resize:fit:786/1*Tk4CAcfny5Dl78YqnNitbQ.png 786w, https://miro.medium.com/v2/resize:fit:828/1*Tk4CAcfny5Dl78YqnNitbQ.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*Tk4CAcfny5Dl78YqnNitbQ.png 1100w, https://miro.medium.com/v2/resize:fit:988/1*Tk4CAcfny5Dl78YqnNitbQ.png 988w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 494px"/><img alt="" class="bh ln mp c" width="494" height="183" loading="lazy" role="presentation"/></picture></div><figcaption class="pk ff pl mg mh pm pn bf b bg z du">Searching for Vmware registry key in Bumblebee</figcaption></figure><p id="40f9" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk"><strong class="ms gv">Searching file paths</strong></p><p id="22d8" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">The malware will search for file paths that can indicate any kind of virtual environment.</p><figure class="pb pc pd pe pf mo mg mh paragraph-image"><div class="mg mh rj"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*QUnLfdtO5QNZxKJAXfOnKg.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*QUnLfdtO5QNZxKJAXfOnKg.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*QUnLfdtO5QNZxKJAXfOnKg.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*QUnLfdtO5QNZxKJAXfOnKg.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*QUnLfdtO5QNZxKJAXfOnKg.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*QUnLfdtO5QNZxKJAXfOnKg.png 1100w, https://miro.medium.com/v2/resize:fit:816/format:webp/1*QUnLfdtO5QNZxKJAXfOnKg.png 816w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 408px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*QUnLfdtO5QNZxKJAXfOnKg.png 640w, https://miro.medium.com/v2/resize:fit:720/1*QUnLfdtO5QNZxKJAXfOnKg.png 720w, https://miro.medium.com/v2/resize:fit:750/1*QUnLfdtO5QNZxKJAXfOnKg.png 750w, https://miro.medium.com/v2/resize:fit:786/1*QUnLfdtO5QNZxKJAXfOnKg.png 786w, https://miro.medium.com/v2/resize:fit:828/1*QUnLfdtO5QNZxKJAXfOnKg.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*QUnLfdtO5QNZxKJAXfOnKg.png 1100w, https://miro.medium.com/v2/resize:fit:816/1*QUnLfdtO5QNZxKJAXfOnKg.png 816w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 408px"/><img alt="" class="bh ln mp c" width="408" height="361" loading="lazy" role="presentation"/></picture></div><figcaption class="pk ff pl mg mh pm pn bf b bg z du">Searching for VBOX files in Bumblebee</figcaption></figure><p id="69da" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">At this point, it will be useless to continue writing the anti-analysis capabilities, so for those who want to see all, please visit the al-khaser project GitHub page.</p><h2 id="c9ea" class="pp ny gu bf nz pq pr dy od ps pt ea oh nb pu pv pw nf px py pz nj qa qb qc qd bk">Executing processes</h2><p id="eb14" class="pw-post-body-paragraph mq mr gu ms b mt ov mv mw mx ow mz na nb ox nd ne nf oy nh ni nj oz nl nm nn gn bk">Among the malware, capabilities are to execute Rundll.exe to run the DLL with the InternalJob as an export function using Wscript.</p><figure class="pb pc pd pe pf mo mg mh paragraph-image"><div class="mg mh rk"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*e8RiUM88-6bdfiKNa_kHqw.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*e8RiUM88-6bdfiKNa_kHqw.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*e8RiUM88-6bdfiKNa_kHqw.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*e8RiUM88-6bdfiKNa_kHqw.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*e8RiUM88-6bdfiKNa_kHqw.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*e8RiUM88-6bdfiKNa_kHqw.png 1100w, https://miro.medium.com/v2/resize:fit:1040/format:webp/1*e8RiUM88-6bdfiKNa_kHqw.png 1040w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 520px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*e8RiUM88-6bdfiKNa_kHqw.png 640w, https://miro.medium.com/v2/resize:fit:720/1*e8RiUM88-6bdfiKNa_kHqw.png 720w, https://miro.medium.com/v2/resize:fit:750/1*e8RiUM88-6bdfiKNa_kHqw.png 750w, https://miro.medium.com/v2/resize:fit:786/1*e8RiUM88-6bdfiKNa_kHqw.png 786w, https://miro.medium.com/v2/resize:fit:828/1*e8RiUM88-6bdfiKNa_kHqw.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*e8RiUM88-6bdfiKNa_kHqw.png 1100w, https://miro.medium.com/v2/resize:fit:1040/1*e8RiUM88-6bdfiKNa_kHqw.png 1040w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 520px"/><img alt="" class="bh ln mp c" width="520" height="465" loading="lazy" role="presentation"/></picture></div><figcaption class="pk ff pl mg mh pm pn bf b bg z du">Executing Wscript</figcaption></figure><p id="bb12" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">Also, the malware can use PowerShell to perform further activities</p><figure class="pb pc pd pe pf mo mg mh paragraph-image"><div class="mg mh rl"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*tD8HU7seJ4H28I0KxMejxg.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*tD8HU7seJ4H28I0KxMejxg.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*tD8HU7seJ4H28I0KxMejxg.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*tD8HU7seJ4H28I0KxMejxg.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*tD8HU7seJ4H28I0KxMejxg.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*tD8HU7seJ4H28I0KxMejxg.png 1100w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*tD8HU7seJ4H28I0KxMejxg.png 828w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 414px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*tD8HU7seJ4H28I0KxMejxg.png 640w, https://miro.medium.com/v2/resize:fit:720/1*tD8HU7seJ4H28I0KxMejxg.png 720w, https://miro.medium.com/v2/resize:fit:750/1*tD8HU7seJ4H28I0KxMejxg.png 750w, https://miro.medium.com/v2/resize:fit:786/1*tD8HU7seJ4H28I0KxMejxg.png 786w, https://miro.medium.com/v2/resize:fit:828/1*tD8HU7seJ4H28I0KxMejxg.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*tD8HU7seJ4H28I0KxMejxg.png 1100w, https://miro.medium.com/v2/resize:fit:828/1*tD8HU7seJ4H28I0KxMejxg.png 828w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 414px"/><img alt="" class="bh ln mp c" width="414" height="165" loading="lazy" role="presentation"/></picture></div><figcaption class="pk ff pl mg mh pm pn bf b bg z du">Executing PowerShell</figcaption></figure><h2 id="0cc7" class="pp ny gu bf nz pq pr dy od ps pt ea oh nb pu pv pw nf px py pz nj qa qb qc qd bk">The little ones inside the flask</h2><p id="1831" class="pw-post-body-paragraph mq mr gu ms b mt ov mv mw mx ow mz na nb ox nd ne nf oy nh ni nj oz nl nm nn gn bk">One of the most interesting things about the Bumblebee core component is the fact that it contains two DLL files inside of him.</p><figure class="pb pc pd pe pf mo mg mh paragraph-image"><div role="button" tabindex="0" class="pg ph fj pi bh pj"><div class="mg mh rm"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*yga8DcFVPDIL4tcK9eJ3eA.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*yga8DcFVPDIL4tcK9eJ3eA.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*yga8DcFVPDIL4tcK9eJ3eA.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*yga8DcFVPDIL4tcK9eJ3eA.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*yga8DcFVPDIL4tcK9eJ3eA.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*yga8DcFVPDIL4tcK9eJ3eA.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*yga8DcFVPDIL4tcK9eJ3eA.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*yga8DcFVPDIL4tcK9eJ3eA.png 640w, https://miro.medium.com/v2/resize:fit:720/1*yga8DcFVPDIL4tcK9eJ3eA.png 720w, https://miro.medium.com/v2/resize:fit:750/1*yga8DcFVPDIL4tcK9eJ3eA.png 750w, https://miro.medium.com/v2/resize:fit:786/1*yga8DcFVPDIL4tcK9eJ3eA.png 786w, https://miro.medium.com/v2/resize:fit:828/1*yga8DcFVPDIL4tcK9eJ3eA.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*yga8DcFVPDIL4tcK9eJ3eA.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*yga8DcFVPDIL4tcK9eJ3eA.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"/><img alt="" class="bh ln mp c" width="700" height="341" loading="lazy" role="presentation"/></picture></div></div><figcaption class="pk ff pl mg mh pm pn bf b bg z du">Two hidden DLL files inside the unpacked Bumblebee</figcaption></figure><p id="dd46" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">Both of these files have the same internal name <em class="nr">RapportGP.dll</em> (which is also used by the security company Trusteer)</p><figure class="pb pc pd pe pf mo mg mh paragraph-image"><div class="mg mh rn"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*mLuUbODYgSbjitcpDWQ9BA.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*mLuUbODYgSbjitcpDWQ9BA.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*mLuUbODYgSbjitcpDWQ9BA.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*mLuUbODYgSbjitcpDWQ9BA.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*mLuUbODYgSbjitcpDWQ9BA.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*mLuUbODYgSbjitcpDWQ9BA.png 1100w, https://miro.medium.com/v2/resize:fit:782/format:webp/1*mLuUbODYgSbjitcpDWQ9BA.png 782w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 391px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*mLuUbODYgSbjitcpDWQ9BA.png 640w, https://miro.medium.com/v2/resize:fit:720/1*mLuUbODYgSbjitcpDWQ9BA.png 720w, https://miro.medium.com/v2/resize:fit:750/1*mLuUbODYgSbjitcpDWQ9BA.png 750w, https://miro.medium.com/v2/resize:fit:786/1*mLuUbODYgSbjitcpDWQ9BA.png 786w, https://miro.medium.com/v2/resize:fit:828/1*mLuUbODYgSbjitcpDWQ9BA.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*mLuUbODYgSbjitcpDWQ9BA.png 1100w, https://miro.medium.com/v2/resize:fit:782/1*mLuUbODYgSbjitcpDWQ9BA.png 782w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 391px"/><img alt="" class="bh ln mp c" width="391" height="214" loading="lazy" role="presentation"/></picture></div><figcaption class="pk ff pl mg mh pm pn bf b bg z du">Bumblebee hooking DLL aka RapportGP.dll</figcaption></figure><p id="aec1" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">The two DLL files are completely identical except for the fact that one of them is 32-bit and the other is 64-bit.</p><h1 id="4017" class="nx ny gu bf nz oa ob oc od oe of og oh oi oj ok ol om on oo op oq or os ot ou bk">PART 3: The shadow of Trickbot- Investigating the hooking DLL</h1><p id="f21f" class="pw-post-body-paragraph mq mr gu ms b mt ov mv mw mx ow mz na nb ox nd ne nf oy nh ni nj oz nl nm nn gn bk">In the last part, I will investigate the <em class="nr">RapportGP.dll</em>, as said, there are two versions: 32\64 bit, and for my analysis, I will focus only on the 32 bit.</p><p id="bab6" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">The main concept behind <em class="nr">RapportGP.dll</em> is hooking, and the entire module’s mechanism is supporting this activity.</p><h2 id="ac23" class="pp ny gu bf nz pq pr dy od ps pt ea oh nb pu pv pw nf px py pz nj qa qb qc qd bk">Check for existing hooks</h2><p id="de3b" class="pw-post-body-paragraph mq mr gu ms b mt ov mv mw mx ow mz na nb ox nd ne nf oy nh ni nj oz nl nm nn gn bk">One of the first activities of the module occurs in a function named “<em class="nr">sub_100060C0</em>”, in general, this function will be responsible to check if there is any hooked function from a list of pre-determined functions.</p><p id="300d" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">Inside <em class="nr">sub_100060C0</em>, the chain of events that leads to this is the following:</p><ol class=""><li id="91c2" class="mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq bk">A handle to <em class="nr">Ntdll.dll</em>, <em class="nr">Kernel32.dll</em>, <em class="nr">Kernelbase.dll</em>, <em class="nr">Advapi32.dll</em> obtained</li><li id="a3d7" class="mq mr gu ms b mt ns mv mw mx nt mz na nb nu nd ne nf nv nh ni nj nw nl nm nn no np nq bk">The requested DLL’s path obtained</li><li id="1c85" class="mq mr gu ms b mt ns mv mw mx nt mz na nb nu nd ne nf nv nh ni nj nw nl nm nn no np nq bk">A call to the function <em class="nr">sub_100059B0 was </em>made to get a copy of <em class="nr">NtProtectVirtualMemory </em>that stored in the allocated memory</li><li id="eb69" class="mq mr gu ms b mt ns mv mw mx nt mz na nb nu nd ne nf nv nh ni nj nw nl nm nn no np nq bk">The arguments are sent to another function named <em class="nr">sub_10005B90</em></li></ol><figure class="pb pc pd pe pf mo mg mh paragraph-image"><div role="button" tabindex="0" class="pg ph fj pi bh pj"><div class="mg mh ro"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*VO_v9EB-1WpWsducAwSJgg.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*VO_v9EB-1WpWsducAwSJgg.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*VO_v9EB-1WpWsducAwSJgg.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*VO_v9EB-1WpWsducAwSJgg.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*VO_v9EB-1WpWsducAwSJgg.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*VO_v9EB-1WpWsducAwSJgg.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*VO_v9EB-1WpWsducAwSJgg.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*VO_v9EB-1WpWsducAwSJgg.png 640w, https://miro.medium.com/v2/resize:fit:720/1*VO_v9EB-1WpWsducAwSJgg.png 720w, https://miro.medium.com/v2/resize:fit:750/1*VO_v9EB-1WpWsducAwSJgg.png 750w, https://miro.medium.com/v2/resize:fit:786/1*VO_v9EB-1WpWsducAwSJgg.png 786w, https://miro.medium.com/v2/resize:fit:828/1*VO_v9EB-1WpWsducAwSJgg.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*VO_v9EB-1WpWsducAwSJgg.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*VO_v9EB-1WpWsducAwSJgg.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"/><img alt="" class="bh ln mp c" width="700" height="533" loading="lazy" role="presentation"/></picture></div></div><figcaption class="pk ff pl mg mh pm pn bf b bg z du">1. RapportGP.dll checking and disabling existing hooks</figcaption></figure><p id="ce85" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">The functions it wants to check are:</p><p id="8a5b" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">In <em class="nr">Ntdll.dll</em></p><figure class="pb pc pd pe pf mo mg mh paragraph-image"><div class="mg mh rp"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*6t6pL0Zp3UgUWF80GtA4aA.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*6t6pL0Zp3UgUWF80GtA4aA.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*6t6pL0Zp3UgUWF80GtA4aA.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*6t6pL0Zp3UgUWF80GtA4aA.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*6t6pL0Zp3UgUWF80GtA4aA.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*6t6pL0Zp3UgUWF80GtA4aA.png 1100w, https://miro.medium.com/v2/resize:fit:1068/format:webp/1*6t6pL0Zp3UgUWF80GtA4aA.png 1068w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 534px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*6t6pL0Zp3UgUWF80GtA4aA.png 640w, https://miro.medium.com/v2/resize:fit:720/1*6t6pL0Zp3UgUWF80GtA4aA.png 720w, https://miro.medium.com/v2/resize:fit:750/1*6t6pL0Zp3UgUWF80GtA4aA.png 750w, https://miro.medium.com/v2/resize:fit:786/1*6t6pL0Zp3UgUWF80GtA4aA.png 786w, https://miro.medium.com/v2/resize:fit:828/1*6t6pL0Zp3UgUWF80GtA4aA.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*6t6pL0Zp3UgUWF80GtA4aA.png 1100w, https://miro.medium.com/v2/resize:fit:1068/1*6t6pL0Zp3UgUWF80GtA4aA.png 1068w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 534px"/><img alt="" class="bh ln mp c" width="534" height="758" loading="lazy" role="presentation"/></picture></div><figcaption class="pk ff pl mg mh pm pn bf b bg z du">RapportGP.dll list of Ntdll functions to check</figcaption></figure><p id="ccf5" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">In <em class="nr">Kernel32.dll</em></p><figure class="pb pc pd pe pf mo mg mh paragraph-image"><div class="mg mh rq"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*tLWiS8gb0L2wY6a4BDPWMg.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*tLWiS8gb0L2wY6a4BDPWMg.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*tLWiS8gb0L2wY6a4BDPWMg.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*tLWiS8gb0L2wY6a4BDPWMg.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*tLWiS8gb0L2wY6a4BDPWMg.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*tLWiS8gb0L2wY6a4BDPWMg.png 1100w, https://miro.medium.com/v2/resize:fit:1224/format:webp/1*tLWiS8gb0L2wY6a4BDPWMg.png 1224w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 612px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*tLWiS8gb0L2wY6a4BDPWMg.png 640w, https://miro.medium.com/v2/resize:fit:720/1*tLWiS8gb0L2wY6a4BDPWMg.png 720w, https://miro.medium.com/v2/resize:fit:750/1*tLWiS8gb0L2wY6a4BDPWMg.png 750w, https://miro.medium.com/v2/resize:fit:786/1*tLWiS8gb0L2wY6a4BDPWMg.png 786w, https://miro.medium.com/v2/resize:fit:828/1*tLWiS8gb0L2wY6a4BDPWMg.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*tLWiS8gb0L2wY6a4BDPWMg.png 1100w, https://miro.medium.com/v2/resize:fit:1224/1*tLWiS8gb0L2wY6a4BDPWMg.png 1224w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 612px"/><img alt="" class="bh ln mp c" width="612" height="305" loading="lazy" role="presentation"/></picture></div><figcaption class="pk ff pl mg mh pm pn bf b bg z du">RapportGP.dll list of Kernel32 functions to check</figcaption></figure><p id="fd31" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">In <em class="nr">Kernelbase.dll</em></p><figure class="pb pc pd pe pf mo mg mh paragraph-image"><div class="mg mh ri"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*XVsk7sYs7i5NhYP-IQFXrA.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*XVsk7sYs7i5NhYP-IQFXrA.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*XVsk7sYs7i5NhYP-IQFXrA.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*XVsk7sYs7i5NhYP-IQFXrA.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*XVsk7sYs7i5NhYP-IQFXrA.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*XVsk7sYs7i5NhYP-IQFXrA.png 1100w, https://miro.medium.com/v2/resize:fit:988/format:webp/1*XVsk7sYs7i5NhYP-IQFXrA.png 988w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 494px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*XVsk7sYs7i5NhYP-IQFXrA.png 640w, https://miro.medium.com/v2/resize:fit:720/1*XVsk7sYs7i5NhYP-IQFXrA.png 720w, https://miro.medium.com/v2/resize:fit:750/1*XVsk7sYs7i5NhYP-IQFXrA.png 750w, https://miro.medium.com/v2/resize:fit:786/1*XVsk7sYs7i5NhYP-IQFXrA.png 786w, https://miro.medium.com/v2/resize:fit:828/1*XVsk7sYs7i5NhYP-IQFXrA.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*XVsk7sYs7i5NhYP-IQFXrA.png 1100w, https://miro.medium.com/v2/resize:fit:988/1*XVsk7sYs7i5NhYP-IQFXrA.png 988w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 494px"/><img alt="" class="bh ln mp c" width="494" height="397" loading="lazy" role="presentation"/></picture></div><figcaption class="pk ff pl mg mh pm pn bf b bg z du">RapportGP.dll list of Kernelbase functions to check</figcaption></figure><p id="803c" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">In <em class="nr">Advapi32.dll</em></p><figure class="pb pc pd pe pf mo mg mh paragraph-image"><div class="mg mh rr"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*va9oRtRsoAF-CyYJ2SsRUw.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*va9oRtRsoAF-CyYJ2SsRUw.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*va9oRtRsoAF-CyYJ2SsRUw.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*va9oRtRsoAF-CyYJ2SsRUw.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*va9oRtRsoAF-CyYJ2SsRUw.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*va9oRtRsoAF-CyYJ2SsRUw.png 1100w, https://miro.medium.com/v2/resize:fit:906/format:webp/1*va9oRtRsoAF-CyYJ2SsRUw.png 906w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 453px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*va9oRtRsoAF-CyYJ2SsRUw.png 640w, https://miro.medium.com/v2/resize:fit:720/1*va9oRtRsoAF-CyYJ2SsRUw.png 720w, https://miro.medium.com/v2/resize:fit:750/1*va9oRtRsoAF-CyYJ2SsRUw.png 750w, https://miro.medium.com/v2/resize:fit:786/1*va9oRtRsoAF-CyYJ2SsRUw.png 786w, https://miro.medium.com/v2/resize:fit:828/1*va9oRtRsoAF-CyYJ2SsRUw.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*va9oRtRsoAF-CyYJ2SsRUw.png 1100w, https://miro.medium.com/v2/resize:fit:906/1*va9oRtRsoAF-CyYJ2SsRUw.png 906w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 453px"/><img alt="" class="bh ln mp c" width="453" height="121" loading="lazy" role="presentation"/></picture></div><figcaption class="pk ff pl mg mh pm pn bf b bg z du">RapportGP.dll list of Advapi32 functions to check</figcaption></figure><p id="aa37" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">In <em class="nr">sub_10005B90</em>, the module path of the requested DLL file will be mapped to memory and will be sent to an additional function named “<em class="nr">sub_10005D40</em>” that will deal with the actual checking.</p><figure class="pb pc pd pe pf mo mg mh paragraph-image"><div role="button" tabindex="0" class="pg ph fj pi bh pj"><div class="mg mh rs"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*Wumujqc70Hw3MSm9HvwQCQ.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*Wumujqc70Hw3MSm9HvwQCQ.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*Wumujqc70Hw3MSm9HvwQCQ.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*Wumujqc70Hw3MSm9HvwQCQ.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*Wumujqc70Hw3MSm9HvwQCQ.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*Wumujqc70Hw3MSm9HvwQCQ.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Wumujqc70Hw3MSm9HvwQCQ.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*Wumujqc70Hw3MSm9HvwQCQ.png 640w, https://miro.medium.com/v2/resize:fit:720/1*Wumujqc70Hw3MSm9HvwQCQ.png 720w, https://miro.medium.com/v2/resize:fit:750/1*Wumujqc70Hw3MSm9HvwQCQ.png 750w, https://miro.medium.com/v2/resize:fit:786/1*Wumujqc70Hw3MSm9HvwQCQ.png 786w, https://miro.medium.com/v2/resize:fit:828/1*Wumujqc70Hw3MSm9HvwQCQ.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*Wumujqc70Hw3MSm9HvwQCQ.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*Wumujqc70Hw3MSm9HvwQCQ.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"/><img alt="" class="bh ln mp c" width="700" height="338" loading="lazy" role="presentation"/></picture></div></div><figcaption class="pk ff pl mg mh pm pn bf b bg z du">2. RapportGP.dll checking and disabling existing hooks</figcaption></figure><p id="2965" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">As for the checks themselves, it is quite simple:</p><ol class=""><li id="7f4e" class="mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq bk">The malware iterate through the export functions of the legitimate DLL file that was mapped to memory by the process when it loads.</li><li id="163e" class="mq mr gu ms b mt ns mv mw mx nt mz na nb nu nd ne nf nv nh ni nj nw nl nm nn no np nq bk">The malware will check if the name is one of the function names it wants to check</li><li id="99cf" class="mq mr gu ms b mt ns mv mw mx nt mz na nb nu nd ne nf nv nh ni nj nw nl nm nn no np nq bk">Once found, the malware calls <em class="nr">sub_10001040 </em>that checks for hooks evidence in the DLL that was mapped by the process loader</li><li id="3d47" class="mq mr gu ms b mt ns mv mw mx nt mz na nb nu nd ne nf nv nh ni nj nw nl nm nn no np nq bk">The malware will do the same for the DLL that was mapped by the malware itself (in <em class="nr">sub_10005B90</em>).</li><li id="c9d4" class="mq mr gu ms b mt ns mv mw mx nt mz na nb nu nd ne nf nv nh ni nj nw nl nm nn no np nq bk">If no hooks are found, it will continue to iterate</li></ol><figure class="pb pc pd pe pf mo mg mh paragraph-image"><div role="button" tabindex="0" class="pg ph fj pi bh pj"><div class="mg mh rt"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*2efFqFPIHOq8TgyK9HOAnw.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*2efFqFPIHOq8TgyK9HOAnw.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*2efFqFPIHOq8TgyK9HOAnw.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*2efFqFPIHOq8TgyK9HOAnw.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*2efFqFPIHOq8TgyK9HOAnw.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*2efFqFPIHOq8TgyK9HOAnw.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*2efFqFPIHOq8TgyK9HOAnw.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*2efFqFPIHOq8TgyK9HOAnw.png 640w, https://miro.medium.com/v2/resize:fit:720/1*2efFqFPIHOq8TgyK9HOAnw.png 720w, https://miro.medium.com/v2/resize:fit:750/1*2efFqFPIHOq8TgyK9HOAnw.png 750w, https://miro.medium.com/v2/resize:fit:786/1*2efFqFPIHOq8TgyK9HOAnw.png 786w, https://miro.medium.com/v2/resize:fit:828/1*2efFqFPIHOq8TgyK9HOAnw.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*2efFqFPIHOq8TgyK9HOAnw.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*2efFqFPIHOq8TgyK9HOAnw.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"/><img alt="" class="bh ln mp c" width="700" height="594" loading="lazy" role="presentation"/></picture></div></div><figcaption class="pk ff pl mg mh pm pn bf b bg z du">3. RapportGP.dll checking and disabling existing hooks</figcaption></figure><p id="3ec3" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">And if there is an indication of hooks, the malware does the following</p><ol class=""><li id="9413" class="mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq bk">Get information about the original function</li><li id="92e4" class="mq mr gu ms b mt ns mv mw mx nt mz na nb nu nd ne nf nv nh ni nj nw nl nm nn no np nq bk">It will change the protection</li><li id="2248" class="mq mr gu ms b mt ns mv mw mx nt mz na nb nu nd ne nf nv nh ni nj nw nl nm nn no np nq bk">Check if it&#x27;s writable</li><li id="dafc" class="mq mr gu ms b mt ns mv mw mx nt mz na nb nu nd ne nf nv nh ni nj nw nl nm nn no np nq bk">Write the content of the mapped function to the original function. In this way, it restores it to the state it should be if there are no hooks.</li></ol><figure class="pb pc pd pe pf mo mg mh paragraph-image"><div role="button" tabindex="0" class="pg ph fj pi bh pj"><div class="mg mh ru"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*ncFHLW8iQLTFZ8C2ZbEFKg.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*ncFHLW8iQLTFZ8C2ZbEFKg.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*ncFHLW8iQLTFZ8C2ZbEFKg.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*ncFHLW8iQLTFZ8C2ZbEFKg.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*ncFHLW8iQLTFZ8C2ZbEFKg.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*ncFHLW8iQLTFZ8C2ZbEFKg.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ncFHLW8iQLTFZ8C2ZbEFKg.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*ncFHLW8iQLTFZ8C2ZbEFKg.png 640w, https://miro.medium.com/v2/resize:fit:720/1*ncFHLW8iQLTFZ8C2ZbEFKg.png 720w, https://miro.medium.com/v2/resize:fit:750/1*ncFHLW8iQLTFZ8C2ZbEFKg.png 750w, https://miro.medium.com/v2/resize:fit:786/1*ncFHLW8iQLTFZ8C2ZbEFKg.png 786w, https://miro.medium.com/v2/resize:fit:828/1*ncFHLW8iQLTFZ8C2ZbEFKg.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*ncFHLW8iQLTFZ8C2ZbEFKg.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*ncFHLW8iQLTFZ8C2ZbEFKg.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"/><img alt="" class="bh ln mp c" width="700" height="315" loading="lazy" role="presentation"/></picture></div></div><figcaption class="pk ff pl mg mh pm pn bf b bg z du">4. RapportGP.dll checking and disabling existing hooks</figcaption></figure><p id="c087" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">If we wanted to observe this activity dynamically, all we need to do is to change the bytes from the beginning of one of the functions the malware wants to check. For example, let&#x27;s take <em class="nr">NtCreateFile</em>.</p><ol class=""><li id="7d10" class="mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq bk">Original function at 775222C0</li><li id="f49f" class="mq mr gu ms b mt ns mv mw mx nt mz na nb nu nd ne nf nv nh ni nj nw nl nm nn no np nq bk">The function that mapped by the malware at 02E022C0</li></ol><figure class="pb pc pd pe pf mo mg mh paragraph-image"><div class="mg mh rv"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*Z38zAEFQ6guWL_PkqmZgtQ.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*Z38zAEFQ6guWL_PkqmZgtQ.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*Z38zAEFQ6guWL_PkqmZgtQ.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*Z38zAEFQ6guWL_PkqmZgtQ.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*Z38zAEFQ6guWL_PkqmZgtQ.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*Z38zAEFQ6guWL_PkqmZgtQ.png 1100w, https://miro.medium.com/v2/resize:fit:1162/format:webp/1*Z38zAEFQ6guWL_PkqmZgtQ.png 1162w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 581px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*Z38zAEFQ6guWL_PkqmZgtQ.png 640w, https://miro.medium.com/v2/resize:fit:720/1*Z38zAEFQ6guWL_PkqmZgtQ.png 720w, https://miro.medium.com/v2/resize:fit:750/1*Z38zAEFQ6guWL_PkqmZgtQ.png 750w, https://miro.medium.com/v2/resize:fit:786/1*Z38zAEFQ6guWL_PkqmZgtQ.png 786w, https://miro.medium.com/v2/resize:fit:828/1*Z38zAEFQ6guWL_PkqmZgtQ.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*Z38zAEFQ6guWL_PkqmZgtQ.png 1100w, https://miro.medium.com/v2/resize:fit:1162/1*Z38zAEFQ6guWL_PkqmZgtQ.png 1162w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 581px"/><img alt="" class="bh ln mp c" width="581" height="270" loading="lazy" role="presentation"/></picture></div><figcaption class="pk ff pl mg mh pm pn bf b bg z du">5. RapportGP.dll checking and disabling existing hooks</figcaption></figure><p id="6e8c" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">When looking in the dump, we can see that their code is exactly the same</p><figure class="pb pc pd pe pf mo mg mh paragraph-image"><div class="mg mh rw"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*Ba-iAwvvHnaYx2GPXY-cWw.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*Ba-iAwvvHnaYx2GPXY-cWw.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*Ba-iAwvvHnaYx2GPXY-cWw.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*Ba-iAwvvHnaYx2GPXY-cWw.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*Ba-iAwvvHnaYx2GPXY-cWw.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*Ba-iAwvvHnaYx2GPXY-cWw.png 1100w, https://miro.medium.com/v2/resize:fit:810/format:webp/1*Ba-iAwvvHnaYx2GPXY-cWw.png 810w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 405px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*Ba-iAwvvHnaYx2GPXY-cWw.png 640w, https://miro.medium.com/v2/resize:fit:720/1*Ba-iAwvvHnaYx2GPXY-cWw.png 720w, https://miro.medium.com/v2/resize:fit:750/1*Ba-iAwvvHnaYx2GPXY-cWw.png 750w, https://miro.medium.com/v2/resize:fit:786/1*Ba-iAwvvHnaYx2GPXY-cWw.png 786w, https://miro.medium.com/v2/resize:fit:828/1*Ba-iAwvvHnaYx2GPXY-cWw.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*Ba-iAwvvHnaYx2GPXY-cWw.png 1100w, https://miro.medium.com/v2/resize:fit:810/1*Ba-iAwvvHnaYx2GPXY-cWw.png 810w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 405px"/><img alt="" class="bh ln mp c" width="405" height="199" loading="lazy" role="presentation"/></picture></div><figcaption class="pk ff pl mg mh pm pn bf b bg z du">6. RapportGP.dll checking and disabling existing hooks</figcaption></figure><p id="b106" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">Let&#x27;s change the first byte of the original to have an E9 opcode (jump)</p><figure class="pb pc pd pe pf mo mg mh paragraph-image"><div role="button" tabindex="0" class="pg ph fj pi bh pj"><div class="mg mh rx"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*hsHHmVR-9RFdzm6N1wJJnw.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*hsHHmVR-9RFdzm6N1wJJnw.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*hsHHmVR-9RFdzm6N1wJJnw.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*hsHHmVR-9RFdzm6N1wJJnw.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*hsHHmVR-9RFdzm6N1wJJnw.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*hsHHmVR-9RFdzm6N1wJJnw.png 1100w, https://miro.medium.com/v2/resize:fit:812/format:webp/1*hsHHmVR-9RFdzm6N1wJJnw.png 812w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 406px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*hsHHmVR-9RFdzm6N1wJJnw.png 640w, https://miro.medium.com/v2/resize:fit:720/1*hsHHmVR-9RFdzm6N1wJJnw.png 720w, https://miro.medium.com/v2/resize:fit:750/1*hsHHmVR-9RFdzm6N1wJJnw.png 750w, https://miro.medium.com/v2/resize:fit:786/1*hsHHmVR-9RFdzm6N1wJJnw.png 786w, https://miro.medium.com/v2/resize:fit:828/1*hsHHmVR-9RFdzm6N1wJJnw.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*hsHHmVR-9RFdzm6N1wJJnw.png 1100w, https://miro.medium.com/v2/resize:fit:812/1*hsHHmVR-9RFdzm6N1wJJnw.png 812w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 406px"/><img alt="" class="bh ln mp c" width="406" height="103" loading="lazy" role="presentation"/></picture></div></div><figcaption class="pk ff pl mg mh pm pn bf b bg z du">7. RapportGP.dll checking and disabling existing hooks</figcaption></figure><p id="b6c1" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">Now, if we will try to debug dynamically, we will be able to get to the last part of the code.</p><figure class="pb pc pd pe pf mo mg mh paragraph-image"><div role="button" tabindex="0" class="pg ph fj pi bh pj"><div class="mg mh ry"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*LoI-P9_M8_ipHkWJn9UcPQ.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*LoI-P9_M8_ipHkWJn9UcPQ.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*LoI-P9_M8_ipHkWJn9UcPQ.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*LoI-P9_M8_ipHkWJn9UcPQ.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*LoI-P9_M8_ipHkWJn9UcPQ.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*LoI-P9_M8_ipHkWJn9UcPQ.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LoI-P9_M8_ipHkWJn9UcPQ.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*LoI-P9_M8_ipHkWJn9UcPQ.png 640w, https://miro.medium.com/v2/resize:fit:720/1*LoI-P9_M8_ipHkWJn9UcPQ.png 720w, https://miro.medium.com/v2/resize:fit:750/1*LoI-P9_M8_ipHkWJn9UcPQ.png 750w, https://miro.medium.com/v2/resize:fit:786/1*LoI-P9_M8_ipHkWJn9UcPQ.png 786w, https://miro.medium.com/v2/resize:fit:828/1*LoI-P9_M8_ipHkWJn9UcPQ.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*LoI-P9_M8_ipHkWJn9UcPQ.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*LoI-P9_M8_ipHkWJn9UcPQ.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"/><img alt="" class="bh ln mp c" width="700" height="200" loading="lazy" role="presentation"/></picture></div></div><figcaption class="pk ff pl mg mh pm pn bf b bg z du">8. RapportGP.dll checking and disabling existing hooks</figcaption></figure><p id="62ba" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">After stepping over <em class="nr">memset</em>, we can see that the E9 byte no longer exists and the original function returned to its normal state.</p><figure class="pb pc pd pe pf mo mg mh paragraph-image"><div class="mg mh rz"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*p1JsnjdvH2Y7c7NARLx-BA.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*p1JsnjdvH2Y7c7NARLx-BA.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*p1JsnjdvH2Y7c7NARLx-BA.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*p1JsnjdvH2Y7c7NARLx-BA.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*p1JsnjdvH2Y7c7NARLx-BA.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*p1JsnjdvH2Y7c7NARLx-BA.png 1100w, https://miro.medium.com/v2/resize:fit:1120/format:webp/1*p1JsnjdvH2Y7c7NARLx-BA.png 1120w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 560px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*p1JsnjdvH2Y7c7NARLx-BA.png 640w, https://miro.medium.com/v2/resize:fit:720/1*p1JsnjdvH2Y7c7NARLx-BA.png 720w, https://miro.medium.com/v2/resize:fit:750/1*p1JsnjdvH2Y7c7NARLx-BA.png 750w, https://miro.medium.com/v2/resize:fit:786/1*p1JsnjdvH2Y7c7NARLx-BA.png 786w, https://miro.medium.com/v2/resize:fit:828/1*p1JsnjdvH2Y7c7NARLx-BA.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*p1JsnjdvH2Y7c7NARLx-BA.png 1100w, https://miro.medium.com/v2/resize:fit:1120/1*p1JsnjdvH2Y7c7NARLx-BA.png 1120w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 560px"/><img alt="" class="bh ln mp c" width="560" height="167" loading="lazy" role="presentation"/></picture></div><figcaption class="pk ff pl mg mh pm pn bf b bg z du">9. RapportGP.dll checking and disabling existing hooks</figcaption></figure><p id="5c0e" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">At a very high level, the process eventually looks like this:</p><figure class="pb pc pd pe pf mo mg mh paragraph-image"><div role="button" tabindex="0" class="pg ph fj pi bh pj"><div class="mg mh sa"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*g789hNfORqqlo6d63ynYfw.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*g789hNfORqqlo6d63ynYfw.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*g789hNfORqqlo6d63ynYfw.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*g789hNfORqqlo6d63ynYfw.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*g789hNfORqqlo6d63ynYfw.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*g789hNfORqqlo6d63ynYfw.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*g789hNfORqqlo6d63ynYfw.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*g789hNfORqqlo6d63ynYfw.png 640w, https://miro.medium.com/v2/resize:fit:720/1*g789hNfORqqlo6d63ynYfw.png 720w, https://miro.medium.com/v2/resize:fit:750/1*g789hNfORqqlo6d63ynYfw.png 750w, https://miro.medium.com/v2/resize:fit:786/1*g789hNfORqqlo6d63ynYfw.png 786w, https://miro.medium.com/v2/resize:fit:828/1*g789hNfORqqlo6d63ynYfw.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*g789hNfORqqlo6d63ynYfw.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*g789hNfORqqlo6d63ynYfw.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"/><img alt="" class="bh ln mp c" width="700" height="470" loading="lazy" role="presentation"/></picture></div></div><figcaption class="pk ff pl mg mh pm pn bf b bg z du">10. RapportGP.dll checking and disabling existing hooks</figcaption></figure><h2 id="1051" class="pp ny gu bf nz pq pr dy od ps pt ea oh nb pu pv pw nf px py pz nj qa qb qc qd bk">Setting the hooks</h2><p id="6d14" class="pw-post-body-paragraph mq mr gu ms b mt ov mv mw mx ow mz na nb ox nd ne nf oy nh ni nj oz nl nm nn gn bk">After checking that there are no other hooks, the malware turns to set its own hooks. The malware will have two kinds of hooks for different purposes.</p><h2 id="cf37" class="pp ny gu bf nz pq pr dy od ps pt ea oh nb pu pv pw nf px py pz nj qa qb qc qd bk">First hooks: Disable Exceptions</h2><p id="bb73" class="pw-post-body-paragraph mq mr gu ms b mt ov mv mw mx ow mz na nb ox nd ne nf oy nh ni nj oz nl nm nn gn bk">The malware will set a hook on the function <em class="nr">RaiseFailFastException</em> which is located in kernel32.dll and <em class="nr">api-ms-win-core-errorhandling-l1–1–2.dll</em>.</p><p id="9b2f" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">The function that will be triggered will be empty, therefore no exception will be triggered.</p><figure class="pb pc pd pe pf mo mg mh paragraph-image"><div role="button" tabindex="0" class="pg ph fj pi bh pj"><div class="mg mh sb"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*7Z4NZGATVjR8mjYDEA1pFg.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*7Z4NZGATVjR8mjYDEA1pFg.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*7Z4NZGATVjR8mjYDEA1pFg.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*7Z4NZGATVjR8mjYDEA1pFg.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*7Z4NZGATVjR8mjYDEA1pFg.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*7Z4NZGATVjR8mjYDEA1pFg.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*7Z4NZGATVjR8mjYDEA1pFg.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*7Z4NZGATVjR8mjYDEA1pFg.png 640w, https://miro.medium.com/v2/resize:fit:720/1*7Z4NZGATVjR8mjYDEA1pFg.png 720w, https://miro.medium.com/v2/resize:fit:750/1*7Z4NZGATVjR8mjYDEA1pFg.png 750w, https://miro.medium.com/v2/resize:fit:786/1*7Z4NZGATVjR8mjYDEA1pFg.png 786w, https://miro.medium.com/v2/resize:fit:828/1*7Z4NZGATVjR8mjYDEA1pFg.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*7Z4NZGATVjR8mjYDEA1pFg.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*7Z4NZGATVjR8mjYDEA1pFg.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"/><img alt="" class="bh ln mp c" width="700" height="135" loading="lazy" role="presentation"/></picture></div></div><figcaption class="pk ff pl mg mh pm pn bf b bg z du">RapportGP.dll hooks to disable exceptions</figcaption></figure><h2 id="dc43" class="pp ny gu bf nz pq pr dy od ps pt ea oh nb pu pv pw nf px py pz nj qa qb qc qd bk">Second hooks: Further code execution</h2><p id="c80b" class="pw-post-body-paragraph mq mr gu ms b mt ov mv mw mx ow mz na nb ox nd ne nf oy nh ni nj oz nl nm nn gn bk">The malware will use the same technique the bumblebee loader did. It will first get the addresses of the function <em class="nr">ZwMapViewOfSection</em>, <em class="nr">ZwOpenSection</em>, <em class="nr">ZwCreateSection</em>, <em class="nr">ZwOpenFile</em>, <em class="nr">ZwClose</em>, and <em class="nr">LdrLoadDll</em>.</p><figure class="pb pc pd pe pf mo mg mh paragraph-image"><div class="mg mh sc"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*Z4U14uBKuea70V_tfdkUAQ.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*Z4U14uBKuea70V_tfdkUAQ.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*Z4U14uBKuea70V_tfdkUAQ.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*Z4U14uBKuea70V_tfdkUAQ.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*Z4U14uBKuea70V_tfdkUAQ.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*Z4U14uBKuea70V_tfdkUAQ.png 1100w, https://miro.medium.com/v2/resize:fit:1272/format:webp/1*Z4U14uBKuea70V_tfdkUAQ.png 1272w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 636px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*Z4U14uBKuea70V_tfdkUAQ.png 640w, https://miro.medium.com/v2/resize:fit:720/1*Z4U14uBKuea70V_tfdkUAQ.png 720w, https://miro.medium.com/v2/resize:fit:750/1*Z4U14uBKuea70V_tfdkUAQ.png 750w, https://miro.medium.com/v2/resize:fit:786/1*Z4U14uBKuea70V_tfdkUAQ.png 786w, https://miro.medium.com/v2/resize:fit:828/1*Z4U14uBKuea70V_tfdkUAQ.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*Z4U14uBKuea70V_tfdkUAQ.png 1100w, https://miro.medium.com/v2/resize:fit:1272/1*Z4U14uBKuea70V_tfdkUAQ.png 1272w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 636px"/><img alt="" class="bh ln mp c" width="636" height="227" loading="lazy" role="presentation"/></picture></div><figcaption class="pk ff pl mg mh pm pn bf b bg z du">RapportGP.dll second hooks</figcaption></figure><p id="0c4f" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">And similar to the Bumblebee’s loader, it will first set the hook, and then will call <em class="nr">LdrLoadDll </em>which is the lower lever equivalent of <em class="nr">LoadLibrary</em> to load the module “<em class="nr">wups.dll</em>”, which will trigger the chain of events we already discussed in the Bumblebee loader part.</p><figure class="pb pc pd pe pf mo mg mh paragraph-image"><div class="mg mh sd"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*vVvPW9Wq8Qf_KShh9SNs_A.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*vVvPW9Wq8Qf_KShh9SNs_A.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*vVvPW9Wq8Qf_KShh9SNs_A.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*vVvPW9Wq8Qf_KShh9SNs_A.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*vVvPW9Wq8Qf_KShh9SNs_A.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*vVvPW9Wq8Qf_KShh9SNs_A.png 1100w, https://miro.medium.com/v2/resize:fit:938/format:webp/1*vVvPW9Wq8Qf_KShh9SNs_A.png 938w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 469px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*vVvPW9Wq8Qf_KShh9SNs_A.png 640w, https://miro.medium.com/v2/resize:fit:720/1*vVvPW9Wq8Qf_KShh9SNs_A.png 720w, https://miro.medium.com/v2/resize:fit:750/1*vVvPW9Wq8Qf_KShh9SNs_A.png 750w, https://miro.medium.com/v2/resize:fit:786/1*vVvPW9Wq8Qf_KShh9SNs_A.png 786w, https://miro.medium.com/v2/resize:fit:828/1*vVvPW9Wq8Qf_KShh9SNs_A.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*vVvPW9Wq8Qf_KShh9SNs_A.png 1100w, https://miro.medium.com/v2/resize:fit:938/1*vVvPW9Wq8Qf_KShh9SNs_A.png 938w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 469px"/><img alt="" class="bh ln mp c" width="469" height="349" loading="lazy" role="presentation"/></picture></div><figcaption class="pk ff pl mg mh pm pn bf b bg z du">RapportGP.dll second hooks</figcaption></figure><h2 id="f576" class="pp ny gu bf nz pq pr dy od ps pt ea oh nb pu pv pw nf px py pz nj qa qb qc qd bk">The Trickbot hooking engine</h2><p id="fce4" class="pw-post-body-paragraph mq mr gu ms b mt ov mv mw mx ow mz na nb ox nd ne nf oy nh ni nj oz nl nm nn gn bk">Although both hooks are doing completely different things, the hooks’ installation mechanism is the same. Interestingly, this mechanism is also the same as the web-inject module of Trickbot.</p><figure class="pb pc pd pe pf mo mg mh paragraph-image"><div role="button" tabindex="0" class="pg ph fj pi bh pj"><div class="mg mh se"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*uU9PGmrxM-miT4BCaZfUfA.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*uU9PGmrxM-miT4BCaZfUfA.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*uU9PGmrxM-miT4BCaZfUfA.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*uU9PGmrxM-miT4BCaZfUfA.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*uU9PGmrxM-miT4BCaZfUfA.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*uU9PGmrxM-miT4BCaZfUfA.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*uU9PGmrxM-miT4BCaZfUfA.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*uU9PGmrxM-miT4BCaZfUfA.png 640w, https://miro.medium.com/v2/resize:fit:720/1*uU9PGmrxM-miT4BCaZfUfA.png 720w, https://miro.medium.com/v2/resize:fit:750/1*uU9PGmrxM-miT4BCaZfUfA.png 750w, https://miro.medium.com/v2/resize:fit:786/1*uU9PGmrxM-miT4BCaZfUfA.png 786w, https://miro.medium.com/v2/resize:fit:828/1*uU9PGmrxM-miT4BCaZfUfA.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*uU9PGmrxM-miT4BCaZfUfA.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*uU9PGmrxM-miT4BCaZfUfA.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"/><img alt="" class="bh ln mp c" width="700" height="752" loading="lazy" role="presentation"/></picture></div></div><figcaption class="pk ff pl mg mh pm pn bf b bg z du">Bumblebee’s RapportGP.dll vs Trickbot’s web-inject module</figcaption></figure><p id="65b8" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">As with many ex-bankers that use hooking such as Panda, Trickbot, and Qbot, their hooking code is based on the Zeus leak, however, each of them has its flavor and changes and Trickbot is no different.<br/>In the Trickbot web-inject hooking mechanism, which has already been documented[8], when creating the inline hooking “trampoline” there is the following evasion technique:</p><ol class=""><li id="b64a" class="mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq bk">Trickbot writes 35 bytes of NOPS (0x90)</li><li id="aedf" class="mq mr gu ms b mt ns mv mw mx nt mz na nb nu nd ne nf nv nh ni nj nw nl nm nn no np nq bk">Add the traditional function prologue</li><li id="97b6" class="mq mr gu ms b mt ns mv mw mx nt mz na nb nu nd ne nf nv nh ni nj nw nl nm nn no np nq bk">Write the jump to the targeted function at the end of the NOPS</li></ol><figure class="pb pc pd pe pf mo mg mh paragraph-image"><div class="mg mh rz"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*7msFKF7_eDOEB9sQIIwmAw.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*7msFKF7_eDOEB9sQIIwmAw.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*7msFKF7_eDOEB9sQIIwmAw.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*7msFKF7_eDOEB9sQIIwmAw.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*7msFKF7_eDOEB9sQIIwmAw.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*7msFKF7_eDOEB9sQIIwmAw.png 1100w, https://miro.medium.com/v2/resize:fit:1120/format:webp/1*7msFKF7_eDOEB9sQIIwmAw.png 1120w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 560px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*7msFKF7_eDOEB9sQIIwmAw.png 640w, https://miro.medium.com/v2/resize:fit:720/1*7msFKF7_eDOEB9sQIIwmAw.png 720w, https://miro.medium.com/v2/resize:fit:750/1*7msFKF7_eDOEB9sQIIwmAw.png 750w, https://miro.medium.com/v2/resize:fit:786/1*7msFKF7_eDOEB9sQIIwmAw.png 786w, https://miro.medium.com/v2/resize:fit:828/1*7msFKF7_eDOEB9sQIIwmAw.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*7msFKF7_eDOEB9sQIIwmAw.png 1100w, https://miro.medium.com/v2/resize:fit:1120/1*7msFKF7_eDOEB9sQIIwmAw.png 1120w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 560px"/><img alt="" class="bh ln mp c" width="560" height="392" loading="lazy" role="presentation"/></picture></div><figcaption class="pk ff pl mg mh pm pn bf b bg z du">Trickbot’s web-inject module evasion technique</figcaption></figure><p id="6edf" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">As we debug Bumblebee, we notice it uses the same unique evasion as well (adjusted for the API calls it wants to hook). So for example when hooking the <em class="nr">ZwMapViewOfSection</em>, which instantiates a Syscall, it will look like this.</p><figure class="pb pc pd pe pf mo mg mh paragraph-image"><div class="mg mh sf"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*KkwvIZaCeCoY4rtZ9Yd0kA.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*KkwvIZaCeCoY4rtZ9Yd0kA.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*KkwvIZaCeCoY4rtZ9Yd0kA.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*KkwvIZaCeCoY4rtZ9Yd0kA.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*KkwvIZaCeCoY4rtZ9Yd0kA.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*KkwvIZaCeCoY4rtZ9Yd0kA.png 1100w, https://miro.medium.com/v2/resize:fit:1156/format:webp/1*KkwvIZaCeCoY4rtZ9Yd0kA.png 1156w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 578px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*KkwvIZaCeCoY4rtZ9Yd0kA.png 640w, https://miro.medium.com/v2/resize:fit:720/1*KkwvIZaCeCoY4rtZ9Yd0kA.png 720w, https://miro.medium.com/v2/resize:fit:750/1*KkwvIZaCeCoY4rtZ9Yd0kA.png 750w, https://miro.medium.com/v2/resize:fit:786/1*KkwvIZaCeCoY4rtZ9Yd0kA.png 786w, https://miro.medium.com/v2/resize:fit:828/1*KkwvIZaCeCoY4rtZ9Yd0kA.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*KkwvIZaCeCoY4rtZ9Yd0kA.png 1100w, https://miro.medium.com/v2/resize:fit:1156/1*KkwvIZaCeCoY4rtZ9Yd0kA.png 1156w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 578px"/><img alt="" class="bh ln mp c" width="578" height="365" loading="lazy" role="presentation"/></picture></div><figcaption class="pk ff pl mg mh pm pn bf b bg z du">Bumblebee’s RapportGP.dll evasion technique</figcaption></figure><p id="f954" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">And when targeting the user-mode functions <em class="nr">RaiseFailFastException</em>, it will look exactly like in Trickbot.</p><figure class="pb pc pd pe pf mo mg mh paragraph-image"><div class="mg mh sg"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*yxo3-VZ8jVAhWx5aEmdj8w.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*yxo3-VZ8jVAhWx5aEmdj8w.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*yxo3-VZ8jVAhWx5aEmdj8w.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*yxo3-VZ8jVAhWx5aEmdj8w.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*yxo3-VZ8jVAhWx5aEmdj8w.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*yxo3-VZ8jVAhWx5aEmdj8w.png 1100w, https://miro.medium.com/v2/resize:fit:758/format:webp/1*yxo3-VZ8jVAhWx5aEmdj8w.png 758w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 379px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*yxo3-VZ8jVAhWx5aEmdj8w.png 640w, https://miro.medium.com/v2/resize:fit:720/1*yxo3-VZ8jVAhWx5aEmdj8w.png 720w, https://miro.medium.com/v2/resize:fit:750/1*yxo3-VZ8jVAhWx5aEmdj8w.png 750w, https://miro.medium.com/v2/resize:fit:786/1*yxo3-VZ8jVAhWx5aEmdj8w.png 786w, https://miro.medium.com/v2/resize:fit:828/1*yxo3-VZ8jVAhWx5aEmdj8w.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*yxo3-VZ8jVAhWx5aEmdj8w.png 1100w, https://miro.medium.com/v2/resize:fit:758/1*yxo3-VZ8jVAhWx5aEmdj8w.png 758w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 379px"/><img alt="" class="bh ln mp c" width="379" height="323" loading="lazy" role="presentation"/></picture></div><figcaption class="pk ff pl mg mh pm pn bf b bg z du">Bumblebee’s RapportGP.dll evasion technique</figcaption></figure><h2 id="850f" class="pp ny gu bf nz pq pr dy od ps pt ea oh nb pu pv pw nf px py pz nj qa qb qc qd bk">Static differences and code evolution</h2><p id="8a57" class="pw-post-body-paragraph mq mr gu ms b mt ov mv mw mx ow mz na nb ox nd ne nf oy nh ni nj oz nl nm nn gn bk">When inspecting the entire code flow graph of the hook installation function, we can see a striking similarity between Bumblebee’s RapportGP.dll and Trickbot’s web-inject module.</p><figure class="pb pc pd pe pf mo mg mh paragraph-image"><div role="button" tabindex="0" class="pg ph fj pi bh pj"><div class="mg mh sh"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*OYKaTzNACrgb1FNEfhHpoA.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*OYKaTzNACrgb1FNEfhHpoA.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*OYKaTzNACrgb1FNEfhHpoA.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*OYKaTzNACrgb1FNEfhHpoA.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*OYKaTzNACrgb1FNEfhHpoA.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*OYKaTzNACrgb1FNEfhHpoA.png 1100w, https://miro.medium.com/v2/resize:fit:1116/format:webp/1*OYKaTzNACrgb1FNEfhHpoA.png 1116w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 558px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*OYKaTzNACrgb1FNEfhHpoA.png 640w, https://miro.medium.com/v2/resize:fit:720/1*OYKaTzNACrgb1FNEfhHpoA.png 720w, https://miro.medium.com/v2/resize:fit:750/1*OYKaTzNACrgb1FNEfhHpoA.png 750w, https://miro.medium.com/v2/resize:fit:786/1*OYKaTzNACrgb1FNEfhHpoA.png 786w, https://miro.medium.com/v2/resize:fit:828/1*OYKaTzNACrgb1FNEfhHpoA.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*OYKaTzNACrgb1FNEfhHpoA.png 1100w, https://miro.medium.com/v2/resize:fit:1116/1*OYKaTzNACrgb1FNEfhHpoA.png 1116w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 558px"/><img alt="" class="bh ln mp c" width="558" height="677" loading="lazy" role="presentation"/></picture></div></div><figcaption class="pk ff pl mg mh pm pn bf b bg z du">Bumblebee’s RapportGP.dll vs Trickbot’s web-inject module install hook functions</figcaption></figure><p id="0776" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">Interestingly, although the actual functionality is the same, we might think that statically everything is the same, even the sub-functions inside the hooking installation function. Funny enough, this is not the case.</p><p id="22b4" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">As mentioned above, in the hooking installation function, one function is responsible for doing checks and return size (Please see the image above).</p><ol class=""><li id="2e2d" class="mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn no np nq bk">In Trickbot its <em class="nr">sub_10001650</em></li><li id="18af" class="mq mr gu ms b mt ns mv mw mx nt mz na nb nu nd ne nf nv nh ni nj nw nl nm nn no np nq bk">In Bumblebee its <em class="nr">sub_10002870</em></li></ol><p id="1847" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">However, when inspecting their code and code flow statically, this is how they both look like</p><figure class="pb pc pd pe pf mo mg mh paragraph-image"><div role="button" tabindex="0" class="pg ph fj pi bh pj"><div class="mg mh si"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*RVAZwWcCWeEdRbT_8sYTjQ.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*RVAZwWcCWeEdRbT_8sYTjQ.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*RVAZwWcCWeEdRbT_8sYTjQ.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*RVAZwWcCWeEdRbT_8sYTjQ.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*RVAZwWcCWeEdRbT_8sYTjQ.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*RVAZwWcCWeEdRbT_8sYTjQ.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*RVAZwWcCWeEdRbT_8sYTjQ.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*RVAZwWcCWeEdRbT_8sYTjQ.png 640w, https://miro.medium.com/v2/resize:fit:720/1*RVAZwWcCWeEdRbT_8sYTjQ.png 720w, https://miro.medium.com/v2/resize:fit:750/1*RVAZwWcCWeEdRbT_8sYTjQ.png 750w, https://miro.medium.com/v2/resize:fit:786/1*RVAZwWcCWeEdRbT_8sYTjQ.png 786w, https://miro.medium.com/v2/resize:fit:828/1*RVAZwWcCWeEdRbT_8sYTjQ.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*RVAZwWcCWeEdRbT_8sYTjQ.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*RVAZwWcCWeEdRbT_8sYTjQ.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"/><img alt="" class="bh ln mp c" width="700" height="585" loading="lazy" role="presentation"/></picture></div></div><figcaption class="pk ff pl mg mh pm pn bf b bg z du">Bumblebee’s RapportGP.dll vs Trickbot’s web-inject module- same functionality, different flow</figcaption></figure><p id="c992" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">Obviously, in Bumblebee, the authors have decided to use Control-flow-flattening[9] to obfuscate the entire flow of the function. For those of you who are not familiar with this obfuscation technique, I strongly recommend the following video[10].</p><p id="f7c4" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">In addition, inside each of these functions (<em class="nr">sub_10001650 </em>in Trickbot, <em class="nr">sub_10002870 </em>in Bumblebee) there are 3 functions (one of them is <em class="nr">memset</em>), and the Control-flow-flattening concept continues in Bumblebee inside them as well. <br/>For example, here are another two functions that act the same dynamically:</p><figure class="pb pc pd pe pf mo mg mh paragraph-image"><div role="button" tabindex="0" class="pg ph fj pi bh pj"><div class="mg mh sj"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*fVkm0vcJQOLMBMH_VqslAQ.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*fVkm0vcJQOLMBMH_VqslAQ.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*fVkm0vcJQOLMBMH_VqslAQ.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*fVkm0vcJQOLMBMH_VqslAQ.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*fVkm0vcJQOLMBMH_VqslAQ.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*fVkm0vcJQOLMBMH_VqslAQ.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fVkm0vcJQOLMBMH_VqslAQ.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*fVkm0vcJQOLMBMH_VqslAQ.png 640w, https://miro.medium.com/v2/resize:fit:720/1*fVkm0vcJQOLMBMH_VqslAQ.png 720w, https://miro.medium.com/v2/resize:fit:750/1*fVkm0vcJQOLMBMH_VqslAQ.png 750w, https://miro.medium.com/v2/resize:fit:786/1*fVkm0vcJQOLMBMH_VqslAQ.png 786w, https://miro.medium.com/v2/resize:fit:828/1*fVkm0vcJQOLMBMH_VqslAQ.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*fVkm0vcJQOLMBMH_VqslAQ.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*fVkm0vcJQOLMBMH_VqslAQ.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"/><img alt="" class="bh ln mp c" width="700" height="497" loading="lazy" role="presentation"/></picture></div></div><figcaption class="pk ff pl mg mh pm pn bf b bg z du">Bumblebee’s RapportGP.dll vs Trickbot’s web-inject module- same functionality, different flow</figcaption></figure><p id="af40" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">When observing the two functions in Bindiff flow graphs, we could see some similarities.</p><figure class="pb pc pd pe pf mo mg mh paragraph-image"><div class="mg mh sk"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*l1QjmAg8dbf6F6hz8s2EJg.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*l1QjmAg8dbf6F6hz8s2EJg.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*l1QjmAg8dbf6F6hz8s2EJg.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*l1QjmAg8dbf6F6hz8s2EJg.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*l1QjmAg8dbf6F6hz8s2EJg.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*l1QjmAg8dbf6F6hz8s2EJg.png 1100w, https://miro.medium.com/v2/resize:fit:1382/format:webp/1*l1QjmAg8dbf6F6hz8s2EJg.png 1382w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 691px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*l1QjmAg8dbf6F6hz8s2EJg.png 640w, https://miro.medium.com/v2/resize:fit:720/1*l1QjmAg8dbf6F6hz8s2EJg.png 720w, https://miro.medium.com/v2/resize:fit:750/1*l1QjmAg8dbf6F6hz8s2EJg.png 750w, https://miro.medium.com/v2/resize:fit:786/1*l1QjmAg8dbf6F6hz8s2EJg.png 786w, https://miro.medium.com/v2/resize:fit:828/1*l1QjmAg8dbf6F6hz8s2EJg.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*l1QjmAg8dbf6F6hz8s2EJg.png 1100w, https://miro.medium.com/v2/resize:fit:1382/1*l1QjmAg8dbf6F6hz8s2EJg.png 1382w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 691px"/><img alt="" class="bh ln mp c" width="691" height="853" loading="lazy" role="presentation"/></picture></div><figcaption class="pk ff pl mg mh pm pn bf b bg z du">Bumblebee’s RapportGP.dll vs Trickbot’s web-inject module-Bindiff</figcaption></figure><h2 id="cb12" class="pp ny gu bf nz pq pr dy od ps pt ea oh nb pu pv pw nf px py pz nj qa qb qc qd bk">Additional similarities</h2><p id="8ac6" class="pw-post-body-paragraph mq mr gu ms b mt ov mv mw mx ow mz na nb ox nd ne nf oy nh ni nj oz nl nm nn gn bk">In both modules, there are other functions that are not completely identical by code, however, they serve the same functionality.</p><p id="3cac" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk"><strong class="ms gv">Example_1</strong></p><p id="2b38" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">Before entering the hooking functions, both Trickbot and Bumblebee attempt to use LoadLibrary and get the address of the function it wants to hook.</p><p id="eebd" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">The difference is that in Trickbot it explicitly writes “<em class="nr">Kernel32.dll</em>” and in Bumblebee it gets the DLL’s name from the caller function.</p><figure class="pb pc pd pe pf mo mg mh paragraph-image"><div role="button" tabindex="0" class="pg ph fj pi bh pj"><div class="mg mh sl"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*KifKc-C4FX_QfDQhKnTZEw.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*KifKc-C4FX_QfDQhKnTZEw.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*KifKc-C4FX_QfDQhKnTZEw.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*KifKc-C4FX_QfDQhKnTZEw.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*KifKc-C4FX_QfDQhKnTZEw.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*KifKc-C4FX_QfDQhKnTZEw.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*KifKc-C4FX_QfDQhKnTZEw.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*KifKc-C4FX_QfDQhKnTZEw.png 640w, https://miro.medium.com/v2/resize:fit:720/1*KifKc-C4FX_QfDQhKnTZEw.png 720w, https://miro.medium.com/v2/resize:fit:750/1*KifKc-C4FX_QfDQhKnTZEw.png 750w, https://miro.medium.com/v2/resize:fit:786/1*KifKc-C4FX_QfDQhKnTZEw.png 786w, https://miro.medium.com/v2/resize:fit:828/1*KifKc-C4FX_QfDQhKnTZEw.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*KifKc-C4FX_QfDQhKnTZEw.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*KifKc-C4FX_QfDQhKnTZEw.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"/><img alt="" class="bh ln mp c" width="700" height="538" loading="lazy" role="presentation"/></picture></div></div><figcaption class="pk ff pl mg mh pm pn bf b bg z du">Bumblebee’s RapportGP.dll vs Trickbot’s web-inject module- same functionality, a different approach</figcaption></figure><p id="4a7c" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk"><strong class="ms gv">Example_2</strong></p><p id="e3b4" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">The call for the hooking activity looks very similar as well</p><figure class="pb pc pd pe pf mo mg mh paragraph-image"><div class="mg mh sm"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*_AfcXXdiM9dKQgo36BvyfQ.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*_AfcXXdiM9dKQgo36BvyfQ.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*_AfcXXdiM9dKQgo36BvyfQ.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*_AfcXXdiM9dKQgo36BvyfQ.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*_AfcXXdiM9dKQgo36BvyfQ.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*_AfcXXdiM9dKQgo36BvyfQ.png 1100w, https://miro.medium.com/v2/resize:fit:1200/format:webp/1*_AfcXXdiM9dKQgo36BvyfQ.png 1200w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 600px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*_AfcXXdiM9dKQgo36BvyfQ.png 640w, https://miro.medium.com/v2/resize:fit:720/1*_AfcXXdiM9dKQgo36BvyfQ.png 720w, https://miro.medium.com/v2/resize:fit:750/1*_AfcXXdiM9dKQgo36BvyfQ.png 750w, https://miro.medium.com/v2/resize:fit:786/1*_AfcXXdiM9dKQgo36BvyfQ.png 786w, https://miro.medium.com/v2/resize:fit:828/1*_AfcXXdiM9dKQgo36BvyfQ.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*_AfcXXdiM9dKQgo36BvyfQ.png 1100w, https://miro.medium.com/v2/resize:fit:1200/1*_AfcXXdiM9dKQgo36BvyfQ.png 1200w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 600px"/><img alt="" class="bh ln mp c" width="600" height="417" loading="lazy" role="presentation"/></picture></div><figcaption class="pk ff pl mg mh pm pn bf b bg z du">Bumblebee’s RapportGP.dll vs Trickbot’s web-inject module</figcaption></figure><p id="1d16" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk"><strong class="ms gv">Example_3</strong></p><p id="c64c" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">Outside the hooking, the Bumblebee’s hooking module starts with getting the process handle and eventually duplicating a thread handle, whereas, the Trickbot’s module starts with getting the process handle and duplicating the token. Again, the same objective, in a different way.</p><h2 id="43f2" class="pp ny gu bf nz pq pr dy od ps pt ea oh nb pu pv pw nf px py pz nj qa qb qc qd bk">Customize flattened RC4</h2><p id="55cd" class="pw-post-body-paragraph mq mr gu ms b mt ov mv mw mx ow mz na nb ox nd ne nf oy nh ni nj oz nl nm nn gn bk">Another interesting activity lies inside the hooked <em class="nr">ZwMapViewOfSection </em>function. The hook appears to use a customize RC4 obfuscated with the Control-flow-flattening technique.</p><figure class="pb pc pd pe pf mo mg mh paragraph-image"><div class="mg mh rx"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*rWbRkKMEvNiHmgZV9FgRZw.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*rWbRkKMEvNiHmgZV9FgRZw.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*rWbRkKMEvNiHmgZV9FgRZw.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*rWbRkKMEvNiHmgZV9FgRZw.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*rWbRkKMEvNiHmgZV9FgRZw.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*rWbRkKMEvNiHmgZV9FgRZw.png 1100w, https://miro.medium.com/v2/resize:fit:812/format:webp/1*rWbRkKMEvNiHmgZV9FgRZw.png 812w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 406px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*rWbRkKMEvNiHmgZV9FgRZw.png 640w, https://miro.medium.com/v2/resize:fit:720/1*rWbRkKMEvNiHmgZV9FgRZw.png 720w, https://miro.medium.com/v2/resize:fit:750/1*rWbRkKMEvNiHmgZV9FgRZw.png 750w, https://miro.medium.com/v2/resize:fit:786/1*rWbRkKMEvNiHmgZV9FgRZw.png 786w, https://miro.medium.com/v2/resize:fit:828/1*rWbRkKMEvNiHmgZV9FgRZw.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*rWbRkKMEvNiHmgZV9FgRZw.png 1100w, https://miro.medium.com/v2/resize:fit:812/1*rWbRkKMEvNiHmgZV9FgRZw.png 812w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 406px"/><img alt="" class="bh ln mp c" width="406" height="435" loading="lazy" role="presentation"/></picture></div><figcaption class="pk ff pl mg mh pm pn bf b bg z du">Custom RC4 with CFF obfuscation</figcaption></figure><h2 id="9673" class="pp ny gu bf nz pq pr dy od ps pt ea oh nb pu pv pw nf px py pz nj qa qb qc qd bk">RapportGP.dll High-level summary</h2><p id="07e6" class="pw-post-body-paragraph mq mr gu ms b mt ov mv mw mx ow mz na nb ox nd ne nf oy nh ni nj oz nl nm nn gn bk">When trying to summarize the entire file behavior, it eventually is the following:</p><figure class="pb pc pd pe pf mo mg mh paragraph-image"><div role="button" tabindex="0" class="pg ph fj pi bh pj"><div class="mg mh sn"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*dnpp_KqVCIsBuQXKJnSD3A.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*dnpp_KqVCIsBuQXKJnSD3A.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*dnpp_KqVCIsBuQXKJnSD3A.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*dnpp_KqVCIsBuQXKJnSD3A.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*dnpp_KqVCIsBuQXKJnSD3A.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*dnpp_KqVCIsBuQXKJnSD3A.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*dnpp_KqVCIsBuQXKJnSD3A.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*dnpp_KqVCIsBuQXKJnSD3A.png 640w, https://miro.medium.com/v2/resize:fit:720/1*dnpp_KqVCIsBuQXKJnSD3A.png 720w, https://miro.medium.com/v2/resize:fit:750/1*dnpp_KqVCIsBuQXKJnSD3A.png 750w, https://miro.medium.com/v2/resize:fit:786/1*dnpp_KqVCIsBuQXKJnSD3A.png 786w, https://miro.medium.com/v2/resize:fit:828/1*dnpp_KqVCIsBuQXKJnSD3A.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*dnpp_KqVCIsBuQXKJnSD3A.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*dnpp_KqVCIsBuQXKJnSD3A.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"/><img alt="" class="bh ln mp c" width="700" height="1089" loading="lazy" role="presentation"/></picture></div></div><figcaption class="pk ff pl mg mh pm pn bf b bg z du">RapportGP.dll overall activity</figcaption></figure><h1 id="cc10" class="nx ny gu bf nz oa ob oc od oe of og oh oi oj ok ol om on oo op oq or os ot ou bk">Conclusion</h1><p id="ac22" class="pw-post-body-paragraph mq mr gu ms b mt ov mv mw mx ow mz na nb ox nd ne nf oy nh ni nj oz nl nm nn gn bk">The bumblebee malware is a very interesting piece of code, and to perform their objectives, the authors show a high level of creativity and innovation.<br/>The interesting similarities between the Bumblebee hooking DLL and the Trickbot’s web-inject DLL raise questions and speculations. <br/>On one hand, the similarities are not strong enough to deduce that the authors of Bumblebee and Trickbot are the same, on the other hand, it is not far-fetched to assume that the authors of Bumblebee have the source code of the Trickbot’s web-inject module.<br/>In any case, the authors took an already proven and working code and evolve it to be less detectable to AV products, and challenging to security researchers.</p><h1 id="4cb4" class="nx ny gu bf nz oa ob oc od oe of og oh oi oj ok ol om on oo op oq or os ot ou bk">References</h1><p id="831d" class="pw-post-body-paragraph mq mr gu ms b mt ov mv mw mx ow mz na nb ox nd ne nf oy nh ni nj oz nl nm nn gn bk">[1] <a class="af so" href="https://blog.google/threat-analysis-group/exposing-initial-access-broker-ties-conti/" rel="noopener ugc nofollow" target="_blank">https://blog.google/threat-analysis-group/exposing-initial-access-broker-ties-conti/</a></p><p id="d92a" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">[2] <a class="af so" href="https://twitter.com/Unit42_Intel/status/1512146449345171459" rel="noopener ugc nofollow" target="_blank">https://twitter.com/Unit42_Intel/status/1512146449345171459</a></p><p id="f732" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">[3] <a class="af so" href="https://www.cynet.com/orion-threat-alert-flight-of-the-bumblebee/" rel="noopener ugc nofollow" target="_blank">https://www.cynet.com/orion-threat-alert-flight-of-the-bumblebee/</a></p><p id="9bbd" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">[4] <a class="af so" href="https://github.com/hasherezade/pe-bear-releases" rel="noopener ugc nofollow" target="_blank">https://github.com/hasherezade/pe-bear-releases</a></p><p id="04e3" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">[5] <a class="af so" href="https://youtu.be/9efJ8_ukxlY?t=2" rel="noopener ugc nofollow" target="_blank">https://youtu.be/9efJ8_ukxlY?t=2</a></p><p id="155f" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">[6] <a class="af so" href="https://github.com/hasherezade/hollows_hunter" rel="noopener ugc nofollow" target="_blank">https://github.com/hasherezade/hollows_hunter</a></p><p id="da31" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">[7] <a class="af so" href="https://github.com/LordNoteworthy/al-khaser/tree/master/al-khaser" rel="noopener ugc nofollow" target="_blank">https://github.com/LordNoteworthy/al-khaser/tree/master/al-khaser</a></p><p id="abf1" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">[8] <a class="af so" href="https://www.sentinelone.com/labs/how-trickbot-malware-hooking-engine-targets-windows-10-browsers/" rel="noopener ugc nofollow" target="_blank">https://www.sentinelone.com/labs/how-trickbot-malware-hooking-engine-targets-windows-10-browsers/</a></p><p id="be7e" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">[9] <a class="af so" href="https://blog.jscrambler.com/jscrambler-101-control-flow-flattening" rel="noopener ugc nofollow" target="_blank">https://blog.jscrambler.com/jscrambler-101-control-flow-flattening</a></p><p id="aa12" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">[10] <a class="af so" href="https://youtu.be/SulC2l1Dvbo" rel="noopener ugc nofollow" target="_blank">https://youtu.be/SulC2l1Dvbo</a></p><h1 id="6a54" class="nx ny gu bf nz oa ob oc od oe of og oh oi oj ok ol om on oo op oq or os ot ou bk">IOC</h1><p id="0dad" class="pw-post-body-paragraph mq mr gu ms b mt ov mv mw mx ow mz na nb ox nd ne nf oy nh ni nj oz nl nm nn gn bk">bumblebee_dropper: 4a35fa2f0903f7ba73ac21564a5a0e2a25374e10</p><p id="5fa9" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">bumblebee_malware: 5dbb3bbc57653c348be7778628ed0ef11ffef35d</p><p id="42ca" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">bumblebee_rapportgp: 5c8f7465ba67138e58d3ca61e4346e31c2b799d8</p><p id="fdb7" class="pw-post-body-paragraph mq mr gu ms b mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk nl nm nn gn bk">Trickbot web-inject module: 0785D0C5600D9C096B75CC4465BE79D456F60594</p></div></div></div></div></section></div></div></article></div><div class="l"></div><footer class="sp sq sr ss st su sv sw sx ab q sy sz c"><div class="l ae"><div class="ab cb"><div class="ci bh fz ga gb gc"><div class="ab cp ta"><div class="ab q ke"><div class="tb l"><span class="l tc td te e d"><div class="ab q ke kf"><div class="pw-multi-vote-icon fj kg kh ki kj"><span><a class="af ag ah ai aj ak al am an ao ap aq ar as at" data-testid="footerClapButton" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Fp%2F686379311056&amp;operation=register&amp;redirect=https%3A%2F%2Felis531989.medium.com%2Fthe-chronicles-of-bumblebee-the-hook-the-bee-and-the-trickbot-connection-686379311056&amp;user=Eli+Salem&amp;userId=f375cbce3f63&amp;source=-----686379311056---------------------clap_footer-----------" rel="noopener follow"><div><div class="bm" aria-hidden="false"><div class="kk ao kl km kn ko am kp kq kr kj"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM13.916 3.953l1.523-2.112-1.184-.39zM8.589 1.84l1.522 2.112-.337-2.501zM18.523 18.92c-.86.86-1.75 1.246-2.62 1.33a6 6 0 0 0 .407-.372c2.388-2.389 2.86-4.951 1.399-7.623l-.912-1.603-.79-1.672c-.26-.56-.194-.98.203-1.288a.7.7 0 0 1 .546-.132c.283.046.546.231.728.5l2.363 4.157c.976 1.624 1.141 4.237-1.324 6.702m-10.999-.438L3.37 14.328a.828.828 0 0 1 .585-1.408.83.83 0 0 1 .585.242l2.158 2.157a.365.365 0 0 0 .516-.516l-2.157-2.158-1.449-1.449a.826.826 0 0 1 1.167-1.17l3.438 3.44a.363.363 0 0 0 .516 0 .364.364 0 0 0 0-.516L5.293 9.513l-.97-.97a.826.826 0 0 1 0-1.166.84.84 0 0 1 1.167 0l.97.968 3.437 3.436a.36.36 0 0 0 .517 0 .366.366 0 0 0 0-.516L6.977 7.83a.82.82 0 0 1-.241-.584.82.82 0 0 1 .824-.826c.219 0 .43.087.584.242l5.787 5.787a.366.366 0 0 0 .587-.415l-1.117-2.363c-.26-.56-.194-.98.204-1.289a.7.7 0 0 1 .546-.132c.283.046.545.232.727.501l2.193 3.86c1.302 2.38.883 4.59-1.277 6.75-1.156 1.156-2.602 1.627-4.19 1.367-1.418-.236-2.866-1.033-4.079-2.246M10.75 5.971l2.12 2.12c-.41.502-.465 1.17-.128 1.89l.22.465-3.523-3.523a.8.8 0 0 1-.097-.368c0-.22.086-.428.241-.584a.847.847 0 0 1 1.167 0m7.355 1.705c-.31-.461-.746-.758-1.23-.837a1.44 1.44 0 0 0-1.11.275c-.312.24-.505.543-.59.881a1.74 1.74 0 0 0-.906-.465 1.47 1.47 0 0 0-.82.106l-2.182-2.182a1.56 1.56 0 0 0-2.2 0 1.54 1.54 0 0 0-.396.701 1.56 1.56 0 0 0-2.21-.01 1.55 1.55 0 0 0-.416.753c-.624-.624-1.649-.624-2.237-.037a1.557 1.557 0 0 0 0 2.2c-.239.1-.501.238-.715.453a1.56 1.56 0 0 0 0 2.2l.516.515a1.556 1.556 0 0 0-.753 2.615L7.01 19c1.32 1.319 2.909 2.189 4.475 2.449q.482.08.971.08c.85 0 1.653-.198 2.393-.579.231.033.46.054.686.054 1.266 0 2.457-.52 3.505-1.567 2.763-2.763 2.552-5.734 1.439-7.586z" clip-rule="evenodd"></path></svg></div></div></div></a></span></div><div class="pw-multi-vote-count l ks kt ku kv kw kx ky"><p class="bf b dv z du"><span class="kz">--</span></p></div></div></span><span class="l h g f tf tg"><div class="ab q ke kf"><div class="pw-multi-vote-icon fj kg kh ki kj"><span><a class="af ag ah ai aj ak al am an ao ap aq ar as at" data-testid="footerClapButton" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Fp%2F686379311056&amp;operation=register&amp;redirect=https%3A%2F%2Felis531989.medium.com%2Fthe-chronicles-of-bumblebee-the-hook-the-bee-and-the-trickbot-connection-686379311056&amp;user=Eli+Salem&amp;userId=f375cbce3f63&amp;source=-----686379311056---------------------clap_footer-----------" rel="noopener follow"><div><div class="bm" aria-hidden="false"><div class="kk ao kl km kn ko am kp kq kr kj"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM13.916 3.953l1.523-2.112-1.184-.39zM8.589 1.84l1.522 2.112-.337-2.501zM18.523 18.92c-.86.86-1.75 1.246-2.62 1.33a6 6 0 0 0 .407-.372c2.388-2.389 2.86-4.951 1.399-7.623l-.912-1.603-.79-1.672c-.26-.56-.194-.98.203-1.288a.7.7 0 0 1 .546-.132c.283.046.546.231.728.5l2.363 4.157c.976 1.624 1.141 4.237-1.324 6.702m-10.999-.438L3.37 14.328a.828.828 0 0 1 .585-1.408.83.83 0 0 1 .585.242l2.158 2.157a.365.365 0 0 0 .516-.516l-2.157-2.158-1.449-1.449a.826.826 0 0 1 1.167-1.17l3.438 3.44a.363.363 0 0 0 .516 0 .364.364 0 0 0 0-.516L5.293 9.513l-.97-.97a.826.826 0 0 1 0-1.166.84.84 0 0 1 1.167 0l.97.968 3.437 3.436a.36.36 0 0 0 .517 0 .366.366 0 0 0 0-.516L6.977 7.83a.82.82 0 0 1-.241-.584.82.82 0 0 1 .824-.826c.219 0 .43.087.584.242l5.787 5.787a.366.366 0 0 0 .587-.415l-1.117-2.363c-.26-.56-.194-.98.204-1.289a.7.7 0 0 1 .546-.132c.283.046.545.232.727.501l2.193 3.86c1.302 2.38.883 4.59-1.277 6.75-1.156 1.156-2.602 1.627-4.19 1.367-1.418-.236-2.866-1.033-4.079-2.246M10.75 5.971l2.12 2.12c-.41.502-.465 1.17-.128 1.89l.22.465-3.523-3.523a.8.8 0 0 1-.097-.368c0-.22.086-.428.241-.584a.847.847 0 0 1 1.167 0m7.355 1.705c-.31-.461-.746-.758-1.23-.837a1.44 1.44 0 0 0-1.11.275c-.312.24-.505.543-.59.881a1.74 1.74 0 0 0-.906-.465 1.47 1.47 0 0 0-.82.106l-2.182-2.182a1.56 1.56 0 0 0-2.2 0 1.54 1.54 0 0 0-.396.701 1.56 1.56 0 0 0-2.21-.01 1.55 1.55 0 0 0-.416.753c-.624-.624-1.649-.624-2.237-.037a1.557 1.557 0 0 0 0 2.2c-.239.1-.501.238-.715.453a1.56 1.56 0 0 0 0 2.2l.516.515a1.556 1.556 0 0 0-.753 2.615L7.01 19c1.32 1.319 2.909 2.189 4.475 2.449q.482.08.971.08c.85 0 1.653-.198 2.393-.579.231.033.46.054.686.054 1.266 0 2.457-.52 3.505-1.567 2.763-2.763 2.552-5.734 1.439-7.586z" clip-rule="evenodd"></path></svg></div></div></div></a></span></div><div class="pw-multi-vote-count l ks kt ku kv kw kx ky"><p class="bf b dv z du"><span class="kz">--</span></p></div></div></span></div><div class="bq ab"><div><div class="bm" aria-hidden="false"><button class="ao kk la lb ab q fk lc ld" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="le"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"></path></svg></button></div></div></div></div><div class="ab q"><div class="th l is"><div><div class="bm" aria-hidden="false"><span><a class="af ag ah ai aj ak al am an ao ap aq ar as at" data-testid="footerBookmarkButton" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F686379311056&amp;operation=register&amp;redirect=https%3A%2F%2Felis531989.medium.com%2Fthe-chronicles-of-bumblebee-the-hook-the-bee-and-the-trickbot-connection-686379311056&amp;source=--------------------------bookmark_footer-----------" rel="noopener follow"><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="none" viewBox="0 0 25 25" class="du lg" aria-label="Add to list bookmark button"><path fill="currentColor" d="M18 2.5a.5.5 0 0 1 1 0V5h2.5a.5.5 0 0 1 0 1H19v2.5a.5.5 0 1 1-1 0V6h-2.5a.5.5 0 0 1 0-1H18zM7 7a1 1 0 0 1 1-1h3.5a.5.5 0 0 0 0-1H8a2 2 0 0 0-2 2v14a.5.5 0 0 0 .805.396L12.5 17l5.695 4.396A.5.5 0 0 0 19 21v-8.5a.5.5 0 0 0-1 0v7.485l-5.195-4.012a.5.5 0 0 0-.61 0L7 19.985z"></path></svg></a></span></div></div></div><div class="th l is"><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="footerSocialShareButton" class="af fk ah ai aj ak al lo an ao ap ex lp lq ld lr"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"></path></svg></button></div></div></div></div></div></div></div></div></div></footer><div class="ti tj tk tl tm l bx"><div class="ab cb"><div class="ci bh fz ga gb gc"><div class="cl ab tn cp"><div class="ab ia"><a rel="noopener follow" href="/?source=post_page-----686379311056--------------------------------"><div class="l to tp by tq ie"><div class="l fj"><img alt="Eli Salem" class="l fd by tr ts cx" src="https://miro.medium.com/v2/resize:fill:144:144/1*yYX7vWD9X65EM0PVIv9FOw.jpeg" width="72" height="72" loading="lazy"/><div class="if by l tr ts fs n ig ft"></div></div></div></a></div><div class="j i d"><div class="ab"><span><button class="bf b bg z ep tt eq er es et eu ev ew ex ey ez fa au fb fc fd bm fe ff">Follow</button></span><div class="dt l"><div><div><div class="bm" aria-hidden="false"><div class="l"><span><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Ffbeec447373f&amp;operation=register&amp;redirect=https%3A%2F%2Felis531989.medium.com%2Fthe-chronicles-of-bumblebee-the-hook-the-bee-and-the-trickbot-connection-686379311056&amp;newsletterV3=f375cbce3f63&amp;newsletterV3Id=fbeec447373f&amp;user=Eli+Salem&amp;userId=f375cbce3f63&amp;source=-----686379311056---------------------subscribe_user-----------" rel="noopener follow"><button class="bf b bg z tx am ty tz ua ub uc ud ue uf ew ex ey ez fa fb fc fd bm fe ff" aria-label="Subscribe"><svg xmlns="http://www.w3.org/2000/svg" width="38" height="38" fill="none" viewBox="0 0 38 38" class="tu tv tw"><rect width="0.5" height="6.5" x="26.25" y="9.25" rx="0.25"></rect><rect width="0.5" height="6.5" x="29.75" y="12.25" rx="0.25" transform="rotate(90 29.75 12.25)"></rect><path d="M19.5 12.5h-7a1 1 0 0 0-1 1v11a1 1 0 0 0 1 1h13a1 1 0 0 0 1-1v-5"></path><path d="M11.5 14.5 19 20l4-3"></path></svg></button></a></span></div></div></div></div></div></div></div></div><div class="ab cn cp"><div class="l"><div class="ab q"><a class="af ag ah ai aj ak al am an ao ap aq ar as at ab q" rel="noopener follow" href="/?source=post_page-----686379311056--------------------------------"><h2 class="pw-author-name bf ug uh ui uj bk"><span class="gn ix">Written by <!-- -->Eli Salem</span></h2></a></div><div class="uk ab"><div class="l is"><span class="pw-follower-count bf b bg z bk"><a class="af ag ah ai aj ak al am an ao ap aq ar il" rel="noopener follow" href="/followers?source=post_page-----686379311056--------------------------------">173 Followers</a></span></div></div><div class="ul l"><p class="bf b bg z bk"><span class="gn">Malware Researcher &amp; Threat Hunter</span></p></div></div><div class="h k"><div class="ab"><span><button class="bf b bg z ep tt eq er es et eu ev ew ex ey ez fa au fb fc fd bm fe ff">Follow</button></span><div class="dt l"><div><div><div class="bm" aria-hidden="false"><div class="l"><span><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2Ffbeec447373f&amp;operation=register&amp;redirect=https%3A%2F%2Felis531989.medium.com%2Fthe-chronicles-of-bumblebee-the-hook-the-bee-and-the-trickbot-connection-686379311056&amp;newsletterV3=f375cbce3f63&amp;newsletterV3Id=fbeec447373f&amp;user=Eli+Salem&amp;userId=f375cbce3f63&amp;source=-----686379311056---------------------subscribe_user-----------" rel="noopener follow"><button class="bf b bg z tx am ty tz ua ub uc ud ue uf ew ex ey ez fa fb fc fd bm fe ff" aria-label="Subscribe"><svg xmlns="http://www.w3.org/2000/svg" width="38" height="38" fill="none" viewBox="0 0 38 38" class="tu tv tw"><rect width="0.5" height="6.5" x="26.25" y="9.25" rx="0.25"></rect><rect width="0.5" height="6.5" x="29.75" y="12.25" rx="0.25" transform="rotate(90 29.75 12.25)"></rect><path d="M19.5 12.5h-7a1 1 0 0 0-1 1v11a1 1 0 0 0 1 1h13a1 1 0 0 0 1-1v-5"></path><path d="M11.5 14.5 19 20l4-3"></path></svg></button></a></span></div></div></div></div></div></div></div></div><div class="um bh un mj mk ml mm mn"></div></div></div><div class="h k j"><div class="um bh un uo"></div><div class="ab cb"><div class="ci bh fz ga gb gc"><div class="up ab ke iv"><div class="uq ur l"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://help.medium.com/hc/en-us?source=post_page-----686379311056--------------------------------" rel="noopener follow"><p class="bf b dv z du">Help</p></a></div><div class="uq ur l"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://medium.statuspage.io/?source=post_page-----686379311056--------------------------------" rel="noopener follow"><p class="bf b dv z du">Status</p></a></div><div class="uq ur l"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://medium.com/about?autoplay=1&amp;source=post_page-----686379311056--------------------------------" rel="noopener follow"><p class="bf b dv z du">About</p></a></div><div class="uq ur l"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=post_page-----686379311056--------------------------------" rel="noopener follow"><p class="bf b dv z du">Careers</p></a></div><div class="uq ur l"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="pressinquiries@medium.com?source=post_page-----686379311056--------------------------------" rel="noopener follow"><p class="bf b dv z du">Press</p></a></div><div class="uq ur l"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://blog.medium.com/?source=post_page-----686379311056--------------------------------" rel="noopener follow"><p class="bf b dv z du">Blog</p></a></div><div class="uq ur l"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----686379311056--------------------------------" rel="noopener follow"><p class="bf b dv z du">Privacy</p></a></div><div class="uq ur l"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----686379311056--------------------------------" rel="noopener follow"><p class="bf b dv z du">Terms</p></a></div><div class="uq ur l"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://speechify.com/medium?source=post_page-----686379311056--------------------------------" rel="noopener follow"><p class="bf b dv z du">Text to speech</p></a></div><div class="uq l"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://medium.com/business?source=post_page-----686379311056--------------------------------" rel="noopener follow"><p class="bf b dv z du">Teams</p></a></div></div></div></div></div></div></div></div></div></div><script>window.__BUILD_ID__="main-20241017-182126-a0128a89d2"</script><script>window.__GRAPHQL_URI__ = "https://elis531989.medium.com/_/graphql"</script><script>window.__PRELOADED_STATE__ = {"algolia":{"queries":{}},"cache":{"experimentGroupSet":true,"reason":"","group":"enabled","tags":["group-edgeCachePosts","post-686379311056","user-f375cbce3f63"],"serverVariantState":"44136fa355b3678a1146ad16f7e8649e94fb4fc21fe77e8310c060f61caaff8a","middlewareEnabled":true,"cacheStatus":"DYNAMIC","shouldUseCache":true,"vary":[],"lohpSummerUpsellEnabled":false,"publicationHierarchyEnabled":false},"client":{"hydrated":false,"isUs":false,"isNativeMedium":false,"isSafariMobile":false,"isSafari":false,"isFirefox":false,"routingEntity":{"type":"USER","id":"f375cbce3f63","explicit":true},"viewerIsBot":false},"debug":{"requestId":"cd5427ad-e01b-4ee1-b988-3455664c0ecc","hybridDevServices":[],"originalSpanCarrier":{"traceparent":"00-a0c3d9f1a1aee41530f9b31397e685b6-7af9e2e2cb3c73d8-01"}},"multiVote":{"clapsPerPost":{}},"navigation":{"branch":{"show":null,"hasRendered":null,"blockedByCTA":false},"hideGoogleOneTap":false,"hasRenderedAlternateUserBanner":null,"currentLocation":"https:\u002F\u002Felis531989.medium.com\u002Fthe-chronicles-of-bumblebee-the-hook-the-bee-and-the-trickbot-connection-686379311056","host":"elis531989.medium.com","hostname":"elis531989.medium.com","referrer":"","hasSetReferrer":false,"susiModal":{"step":null,"operation":"register"},"postRead":false,"partnerProgram":{"selectedCountryCode":null},"queryString":"","currentHash":""},"config":{"nodeEnv":"production","version":"main-20241017-182126-a0128a89d2","target":"production","productName":"Medium","publicUrl":"https:\u002F\u002Fcdn-client.medium.com\u002Flite","authDomain":"medium.com","authGoogleClientId":"216296035834-k1k6qe060s2tp2a2jam4ljdcms00sttg.apps.googleusercontent.com","favicon":"production","glyphUrl":"https:\u002F\u002Fglyph.medium.com","branchKey":"key_live_ofxXr2qTrrU9NqURK8ZwEhknBxiI6KBm","algolia":{"appId":"MQ57UUUQZ2","apiKeySearch":"394474ced050e3911ae2249ecc774921","indexPrefix":"medium_","host":"-dsn.algolia.net"},"recaptchaKey":"6Lfc37IUAAAAAKGGtC6rLS13R1Hrw_BqADfS1LRk","recaptcha3Key":"6Lf8R9wUAAAAABMI_85Wb8melS7Zj6ziuf99Yot5","recaptchaEnterpriseKeyId":"6Le-uGgpAAAAAPprRaokM8AKthQ9KNGdoxaGUvVp","datadog":{"applicationId":"6702d87d-a7e0-42fe-bbcb-95b469547ea0","clientToken":"pub853ea8d17ad6821d9f8f11861d23dfed","rumToken":"pubf9cc52896502b9413b68ba36fc0c7162","context":{"deployment":{"target":"production","tag":"main-20241017-182126-a0128a89d2","commit":"a0128a89d2d76bfa55b25492370b0bae4050224f"}},"datacenter":"us"},"googleAnalyticsCode":"G-7JY7T788PK","googlePay":{"apiVersion":"2","apiVersionMinor":"0","merchantId":"BCR2DN6TV7EMTGBM","merchantName":"Medium","instanceMerchantId":"13685562959212738550"},"applePay":{"version":3},"signInWallCustomDomainCollectionIds":["3a8144eabfe3","336d898217ee","61061eb0c96b","138adf9c44c","819cc2aaeee0"],"mediumMastodonDomainName":"me.dm","mediumOwnedAndOperatedCollectionIds":["8a9336e5bb4","b7e45b22fec3","193b68bd4fba","8d6b8a439e32","54c98c43354d","3f6ecf56618","d944778ce714","92d2092dc598","ae2a65f35510","1285ba81cada","544c7006046e","fc8964313712","40187e704f1c","88d9857e584e","7b6769f2748b","bcc38c8f6edf","cef6983b292","cb8577c9149e","444d13b52878","713d7dbc99b0","ef8e90590e66","191186aaafa0","55760f21cdc5","9dc80918cc93","bdc4052bbdba","8ccfed20cbb2"],"tierOneDomains":["medium.com","thebolditalic.com","arcdigital.media","towardsdatascience.com","uxdesign.cc","codeburst.io","psiloveyou.xyz","writingcooperative.com","entrepreneurshandbook.co","prototypr.io","betterhumans.coach.me","theascent.pub"],"topicsToFollow":["d61cf867d93f","8a146bc21b28","1eca0103fff3","4d562ee63426","aef1078a3ef5","e15e46793f8d","6158eb913466","55f1c20aba7a","3d18b94f6858","4861fee224fd","63c6f1f93ee","1d98b3a9a871","decb52b64abf","ae5d4995e225","830cded25262"],"topicToTagMappings":{"accessibility":"accessibility","addiction":"addiction","android-development":"android-development","art":"art","artificial-intelligence":"artificial-intelligence","astrology":"astrology","basic-income":"basic-income","beauty":"beauty","biotech":"biotech","blockchain":"blockchain","books":"books","business":"business","cannabis":"cannabis","cities":"cities","climate-change":"climate-change","comics":"comics","coronavirus":"coronavirus","creativity":"creativity","cryptocurrency":"cryptocurrency","culture":"culture","cybersecurity":"cybersecurity","data-science":"data-science","design":"design","digital-life":"digital-life","disability":"disability","economy":"economy","education":"education","equality":"equality","family":"family","feminism":"feminism","fiction":"fiction","film":"film","fitness":"fitness","food":"food","freelancing":"freelancing","future":"future","gadgets":"gadgets","gaming":"gaming","gun-control":"gun-control","health":"health","history":"history","humor":"humor","immigration":"immigration","ios-development":"ios-development","javascript":"javascript","justice":"justice","language":"language","leadership":"leadership","lgbtqia":"lgbtqia","lifestyle":"lifestyle","machine-learning":"machine-learning","makers":"makers","marketing":"marketing","math":"math","media":"media","mental-health":"mental-health","mindfulness":"mindfulness","money":"money","music":"music","neuroscience":"neuroscience","nonfiction":"nonfiction","outdoors":"outdoors","parenting":"parenting","pets":"pets","philosophy":"philosophy","photography":"photography","podcasts":"podcast","poetry":"poetry","politics":"politics","privacy":"privacy","product-management":"product-management","productivity":"productivity","programming":"programming","psychedelics":"psychedelics","psychology":"psychology","race":"race","relationships":"relationships","religion":"religion","remote-work":"remote-work","san-francisco":"san-francisco","science":"science","self":"self","self-driving-cars":"self-driving-cars","sexuality":"sexuality","social-media":"social-media","society":"society","software-engineering":"software-engineering","space":"space","spirituality":"spirituality","sports":"sports","startups":"startup","style":"style","technology":"technology","transportation":"transportation","travel":"travel","true-crime":"true-crime","tv":"tv","ux":"ux","venture-capital":"venture-capital","visual-design":"visual-design","work":"work","world":"world","writing":"writing"},"defaultImages":{"avatar":{"imageId":"1*dmbNkD5D-u45r44go_cf0g.png","height":150,"width":150},"orgLogo":{"imageId":"7*V1_7XP4snlmqrc_0Njontw.png","height":110,"width":500},"postLogo":{"imageId":"bd978bb536350a710e8efb012513429cabdc4c28700604261aeda246d0f980b7","height":810,"width":1440},"postPreviewImage":{"imageId":"1*hn4v1tCaJy7cWMyb0bpNpQ.png","height":386,"width":579}},"collectionStructuredData":{"8d6b8a439e32":{"name":"Elemental","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fcdn-images-1.medium.com\u002Fmax\u002F980\u002F1*9ygdqoKprhwuTVKUM0DLPA@2x.png","width":980,"height":159}}},"3f6ecf56618":{"name":"Forge","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fcdn-images-1.medium.com\u002Fmax\u002F596\u002F1*uULpIlImcO5TDuBZ6lm7Lg@2x.png","width":596,"height":183}}},"ae2a65f35510":{"name":"GEN","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fmiro.medium.com\u002Fmax\u002F264\u002F1*RdVZMdvfV3YiZTw6mX7yWA.png","width":264,"height":140}}},"88d9857e584e":{"name":"LEVEL","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fmiro.medium.com\u002Fmax\u002F540\u002F1*JqYMhNX6KNNb2UlqGqO2WQ.png","width":540,"height":108}}},"7b6769f2748b":{"name":"Marker","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fcdn-images-1.medium.com\u002Fmax\u002F383\u002F1*haCUs0wF6TgOOvfoY-jEoQ@2x.png","width":383,"height":92}}},"444d13b52878":{"name":"OneZero","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fmiro.medium.com\u002Fmax\u002F540\u002F1*cw32fIqCbRWzwJaoQw6BUg.png","width":540,"height":123}}},"8ccfed20cbb2":{"name":"Zora","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fmiro.medium.com\u002Fmax\u002F540\u002F1*tZUQqRcCCZDXjjiZ4bDvgQ.png","width":540,"height":106}}}},"embeddedPostIds":{"coronavirus":"cd3010f9d81f"},"sharedCdcMessaging":{"COVID_APPLICABLE_TAG_SLUGS":[],"COVID_APPLICABLE_TOPIC_NAMES":[],"COVID_APPLICABLE_TOPIC_NAMES_FOR_TOPIC_PAGE":[],"COVID_MESSAGES":{"tierA":{"text":"For more information on the novel coronavirus and Covid-19, visit cdc.gov.","markups":[{"start":66,"end":73,"href":"https:\u002F\u002Fwww.cdc.gov\u002Fcoronavirus\u002F2019-nCoV"}]},"tierB":{"text":"Anyone can publish on Medium per our Policies, but we don’t fact-check every story. For more info about the coronavirus, see cdc.gov.","markups":[{"start":37,"end":45,"href":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Fcategories\u002F201931128-Policies-Safety"},{"start":125,"end":132,"href":"https:\u002F\u002Fwww.cdc.gov\u002Fcoronavirus\u002F2019-nCoV"}]},"paywall":{"text":"This article has been made free for everyone, thanks to Medium Members. For more information on the novel coronavirus and Covid-19, visit cdc.gov.","markups":[{"start":56,"end":70,"href":"https:\u002F\u002Fmedium.com\u002Fmembership"},{"start":138,"end":145,"href":"https:\u002F\u002Fwww.cdc.gov\u002Fcoronavirus\u002F2019-nCoV"}]},"unbound":{"text":"This article is free for everyone, thanks to Medium Members. For more information on the novel coronavirus and Covid-19, visit cdc.gov.","markups":[{"start":45,"end":59,"href":"https:\u002F\u002Fmedium.com\u002Fmembership"},{"start":127,"end":134,"href":"https:\u002F\u002Fwww.cdc.gov\u002Fcoronavirus\u002F2019-nCoV"}]}},"COVID_BANNER_POST_ID_OVERRIDE_WHITELIST":["3b31a67bff4a"]},"sharedVoteMessaging":{"TAGS":["politics","election-2020","government","us-politics","election","2020-presidential-race","trump","donald-trump","democrats","republicans","congress","republican-party","democratic-party","biden","joe-biden","maga"],"TOPICS":["politics","election"],"MESSAGE":{"text":"Find out more about the U.S. election results here.","markups":[{"start":46,"end":50,"href":"https:\u002F\u002Fcookpolitical.com\u002F2020-national-popular-vote-tracker"}]},"EXCLUDE_POSTS":["397ef29e3ca5"]},"embedPostRules":[],"recircOptions":{"v1":{"limit":3},"v2":{"limit":8}},"braintreeClientKey":"production_zjkj96jm_m56f8fqpf7ngnrd4","braintree":{"enabled":true,"merchantId":"m56f8fqpf7ngnrd4","merchantAccountId":{"usd":"AMediumCorporation_instant","eur":"amediumcorporation_EUR","cad":"amediumcorporation_CAD"},"publicKey":"ds2nn34bg2z7j5gd","braintreeEnvironment":"production","dashboardUrl":"https:\u002F\u002Fwww.braintreegateway.com\u002Fmerchants","gracePeriodDurationInDays":14,"mediumMembershipPlanId":{"monthly":"ce105f8c57a3","monthlyV2":"e8a5e126-792b-4ee6-8fba-d574c1b02fc5","monthlyWithTrial":"d5ee3dbe3db8","monthlyPremium":"fa741a9b47a2","yearly":"a40ad4a43185","yearlyV2":"3815d7d6-b8ca-4224-9b8c-182f9047866e","yearlyStaff":"d74fb811198a","yearlyWithTrial":"b3bc7350e5c7","yearlyPremium":"e21bd2c12166","monthlyOneYearFree":"e6c0637a-2bad-4171-ab4f-3c268633d83c","monthly25PercentOffFirstYear":"235ecc62-0cdb-49ae-9378-726cd21c504b","monthly20PercentOffFirstYear":"ba518864-9c13-4a99-91ca-411bf0cac756","monthly15PercentOffFirstYear":"594c029b-9f89-43d5-88f8-8173af4e070e","monthly10PercentOffFirstYear":"c6c7bc9a-40f2-4b51-8126-e28511d5bdb0","monthlyForStudents":"629ebe51-da7d-41fd-8293-34cd2f2030a8","yearlyOneYearFree":"78ba7be9-0d9f-4ece-aa3e-b54b826f2bf1","yearly25PercentOffFirstYear":"2dbb010d-bb8f-4eeb-ad5c-a08509f42d34","yearly20PercentOffFirstYear":"47565488-435b-47f8-bf93-40d5fbe0ebc8","yearly15PercentOffFirstYear":"8259809b-0881-47d9-acf7-6c001c7f720f","yearly10PercentOffFirstYear":"9dd694fb-96e1-472c-8d9e-3c868d5c1506","yearlyForStudents":"e29345ef-ab1c-4234-95c5-70e50fe6bc23","monthlyCad":"p52orjkaceei","yearlyCad":"h4q9g2up9ktt"},"braintreeDiscountId":{"oneMonthFree":"MONTHS_FREE_01","threeMonthsFree":"MONTHS_FREE_03","sixMonthsFree":"MONTHS_FREE_06","fiftyPercentOffOneYear":"FIFTY_PERCENT_OFF_ONE_YEAR"},"3DSecureVersion":"2","defaultCurrency":"usd","providerPlanIdCurrency":{"4ycw":"usd","rz3b":"usd","3kqm":"usd","jzw6":"usd","c2q2":"usd","nnsw":"usd","q8qw":"usd","d9y6":"usd","fx7w":"cad","nwf2":"cad"}},"paypalClientId":"AXj1G4fotC2GE8KzWX9mSxCH1wmPE3nJglf4Z2ig_amnhvlMVX87otaq58niAg9iuLktVNF_1WCMnN7v","paypal":{"host":"https:\u002F\u002Fapi.paypal.com:443","clientMode":"production","serverMode":"live","webhookId":"4G466076A0294510S","monthlyPlan":{"planId":"P-9WR0658853113943TMU5FDQA","name":"Medium Membership (Monthly) with setup fee","description":"Unlimited access to the best and brightest stories on Medium. Membership billed monthly."},"yearlyPlan":{"planId":"P-7N8963881P8875835MU5JOPQ","name":"Medium Membership (Annual) with setup fee","description":"Unlimited access to the best and brightest stories on Medium. Membership billed annually."},"oneYearGift":{"name":"Medium Membership (1 Year, Digital Gift Code)","description":"Unlimited access to the best and brightest stories on Medium. Gift codes can be redeemed at medium.com\u002Fredeem.","price":"50.00","currency":"USD","sku":"membership-gift-1-yr"},"oldMonthlyPlan":{"planId":"P-96U02458LM656772MJZUVH2Y","name":"Medium Membership (Monthly)","description":"Unlimited access to the best and brightest stories on Medium. Membership billed monthly."},"oldYearlyPlan":{"planId":"P-59P80963JF186412JJZU3SMI","name":"Medium Membership (Annual)","description":"Unlimited access to the best and brightest stories on Medium. Membership billed annually."},"monthlyPlanWithTrial":{"planId":"P-66C21969LR178604GJPVKUKY","name":"Medium Membership (Monthly) with setup fee","description":"Unlimited access to the best and brightest stories on Medium. Membership billed monthly."},"yearlyPlanWithTrial":{"planId":"P-6XW32684EX226940VKCT2MFA","name":"Medium Membership (Annual) with setup fee","description":"Unlimited access to the best and brightest stories on Medium. Membership billed annually."},"oldMonthlyPlanNoSetupFee":{"planId":"P-4N046520HR188054PCJC7LJI","name":"Medium Membership (Monthly)","description":"Unlimited access to the best and brightest stories on Medium. Membership billed monthly."},"oldYearlyPlanNoSetupFee":{"planId":"P-7A4913502Y5181304CJEJMXQ","name":"Medium Membership (Annual)","description":"Unlimited access to the best and brightest stories on Medium. Membership billed annually."},"sdkUrl":"https:\u002F\u002Fwww.paypal.com\u002Fsdk\u002Fjs"},"stripePublishableKey":"pk_live_7FReX44VnNIInZwrIIx6ghjl","log":{"json":true,"level":"info"},"imageUploadMaxSizeMb":25,"staffPicks":{"title":"Staff Picks","catalogId":"c7bc6e1ee00f"}},"session":{"xsrf":""}}</script><script>window.__APOLLO_STATE__ = {"ROOT_QUERY":{"__typename":"Query","viewer":null,"collectionByDomainOrSlug({\"domainOrSlug\":\"elis531989.medium.com\"})":null,"postResult({\"id\":\"686379311056\"})":{"__ref":"Post:686379311056"}},"LinkedAccounts:f375cbce3f63":{"__typename":"LinkedAccounts","mastodon":null,"id":"f375cbce3f63"},"UserViewerEdge:userId:f375cbce3f63-viewerId:lo_59cbcb99d9c4":{"__typename":"UserViewerEdge","id":"userId:f375cbce3f63-viewerId:lo_59cbcb99d9c4","isFollowing":false,"isUser":false,"isMuting":false},"NewsletterV3:fbeec447373f":{"__typename":"NewsletterV3","id":"fbeec447373f","type":"NEWSLETTER_TYPE_AUTHOR","slug":"f375cbce3f63","name":"f375cbce3f63","collection":null,"user":{"__ref":"User:f375cbce3f63"}},"User:f375cbce3f63":{"__typename":"User","id":"f375cbce3f63","name":"Eli Salem","username":"elis531989","newsletterV3":{"__ref":"NewsletterV3:fbeec447373f"},"linkedAccounts":{"__ref":"LinkedAccounts:f375cbce3f63"},"isSuspended":false,"imageId":"1*yYX7vWD9X65EM0PVIv9FOw.jpeg","mediumMemberAt":0,"verifications":{"__typename":"VerifiedInfo","isBookAuthor":false},"socialStats":{"__typename":"SocialStats","followerCount":173},"customDomainState":{"__typename":"CustomDomainState","live":{"__typename":"CustomDomain","domain":"elis531989.medium.com"}},"hasSubdomain":true,"bio":"Malware Researcher & Threat Hunter","isPartnerProgramEnrolled":false,"viewerEdge":{"__ref":"UserViewerEdge:userId:f375cbce3f63-viewerId:lo_59cbcb99d9c4"},"viewerIsUser":false,"postSubscribeMembershipUpsellShownAt":0,"userPostCounts({\"includeResponsesCount\":true})":null,"membership":null,"allowNotes":true,"twitterScreenName":"elisalem9"},"Topic:d4e7f4144ac5":{"__typename":"Topic","slug":"cybersecurity","id":"d4e7f4144ac5","name":"Cybersecurity"},"Paragraph:e29948fdd6c_0":{"__typename":"Paragraph","id":"e29948fdd6c_0","name":"bd36","type":"H3","href":null,"layout":null,"metadata":null,"text":"The chronicles of Bumblebee: The Hook, the Bee, and the Trickbot connection","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*LglRPWDxARM11kMkI0pTqw.png":{"__typename":"ImageMetadata","id":"1*LglRPWDxARM11kMkI0pTqw.png","originalHeight":512,"originalWidth":487,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:e29948fdd6c_1":{"__typename":"Paragraph","id":"e29948fdd6c_1","name":"3cf5","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*LglRPWDxARM11kMkI0pTqw.png"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_2":{"__typename":"Paragraph","id":"e29948fdd6c_2","name":"5f70","type":"P","href":null,"layout":null,"metadata":null,"text":"In late March 2022, a new malware dubbed “Bumblebee” was discovered, and reported to be distributed in phishing campaigns containing ISO files which eventually drop DLL files that contained the Bumblebee malware itself.[1][3].\nThis malware deployment technique is not new, and several other malware has already been observed using it, most notably: BazarLoader, and IcedID[3]. Also, similar to the aforementioned malware, Bumblebee too was observed delivering the Cobalt-Strike framework.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_3":{"__typename":"Paragraph","id":"e29948fdd6c_3","name":"3470","type":"P","href":null,"layout":null,"metadata":null,"text":"From a threat research perspective, what makes this malware interesting is the fact that it was associated with the Conti ransomware group as one of the group's threat loaders[1].\nIn the past, the traditional loaders of Conti were Trickbot, Bazarloader, and Emotet, so it was quite intriguing to inspect this malware closely.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_4":{"__typename":"Paragraph","id":"e29948fdd6c_4","name":"fa68","type":"P","href":null,"layout":null,"metadata":null,"text":"In this article, I will present a code analysis of the Bumblebee malware, obviously, due to the malware's large size I will not cover everything, and will focus on the parts that I think are the most interesting in terms of capabilities.\nAlso, one of my favorite topics in malware research is the ways of malware to avoid detection, so I will put more emphasis on this subject as well.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_5":{"__typename":"Paragraph","id":"e29948fdd6c_5","name":"92ae","type":"P","href":null,"layout":null,"metadata":null,"text":"Lastly, I divided the entire article into three parts, the table of contents is the following:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_6":{"__typename":"Paragraph","id":"e29948fdd6c_6","name":"7161","type":"OLI","href":null,"layout":null,"metadata":null,"text":"PART 1: The hook- unpacking the bumblebee’s crypter\n- Unpacking mechanism\n- Enters the hook\n- Executing the code\n- Bumblebee dropper high-level summary","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"STRONG","start":0,"end":151,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":0,"end":151,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_7":{"__typename":"Paragraph","id":"e29948fdd6c_7","name":"ac45","type":"OLI","href":null,"layout":null,"metadata":null,"text":"PART 2: The bee- Investing the bumblebee’s payload\n- Stolen anti-analysis code\n- Searching for processes\n- Searching registry keys\n- Searching file paths\n- Executing processes\n- The little ones inside the flask: hiding additional DLLs","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"STRONG","start":0,"end":234,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":0,"end":234,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_8":{"__typename":"Paragraph","id":"e29948fdd6c_8","name":"5980","type":"OLI","href":null,"layout":null,"metadata":null,"text":"PART 3: The Trickbot connection- Investigating the hooking DLL\n- Check for existing hooks\n- Setting the hooks\n- First hooks: Disable exceptions\n- Second hooks: Further code execution\n- The Trickbot hooking engine\n- Static differences and code evolution\n- Additional similarities \n- Customize flattened RC4\n- RapportGP.dll high-level summary","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"STRONG","start":0,"end":340,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":0,"end":340,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_9":{"__typename":"Paragraph","id":"e29948fdd6c_9","name":"652c","type":"H3","href":null,"layout":null,"metadata":null,"text":"PART 1","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_10":{"__typename":"Paragraph","id":"e29948fdd6c_10","name":"02c4","type":"H3","href":null,"layout":null,"metadata":null,"text":"The Hook: Unpacking the bumblebee’s crypter","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_11":{"__typename":"Paragraph","id":"e29948fdd6c_11","name":"6a86","type":"P","href":null,"layout":null,"metadata":null,"text":"Hash: a9c8b7c411571700e6ea03e4e48ddb896a33e53e","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*67nk9n2x4g-LkjYOiLhRyw.png":{"__typename":"ImageMetadata","id":"1*67nk9n2x4g-LkjYOiLhRyw.png","originalHeight":513,"originalWidth":932,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:e29948fdd6c_12":{"__typename":"Paragraph","id":"e29948fdd6c_12","name":"4f6f","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*67nk9n2x4g-LkjYOiLhRyw.png"},"text":"Bumblebee dropper as seen in PEstudio","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_13":{"__typename":"Paragraph","id":"e29948fdd6c_13","name":"7df6","type":"P","href":null,"layout":null,"metadata":null,"text":"The initial dropper of Bumblebee is a 64bit file, with relatively high entropy which indicates a possibly obfuscated \\ encrypted content that will be decrypted in runtime.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_14":{"__typename":"Paragraph","id":"e29948fdd6c_14","name":"926c","type":"P","href":null,"layout":null,"metadata":null,"text":"The DLL itself contains two export functions: InternalJob and SetPath. Also, the file’s internal name appears to be “lodqcbw041xd9.dll”.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":117,"end":134,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*TGWaJwFGw4jY03O_GFv6BQ.png":{"__typename":"ImageMetadata","id":"1*TGWaJwFGw4jY03O_GFv6BQ.png","originalHeight":327,"originalWidth":467,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:e29948fdd6c_15":{"__typename":"Paragraph","id":"e29948fdd6c_15","name":"03e0","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*TGWaJwFGw4jY03O_GFv6BQ.png"},"text":"Bumblebee dropper exports and internal name in PE-Bear","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_16":{"__typename":"Paragraph","id":"e29948fdd6c_16","name":"7946","type":"H4","href":null,"layout":null,"metadata":null,"text":"Unpacking mechanism","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_17":{"__typename":"Paragraph","id":"e29948fdd6c_17","name":"43ea","type":"P","href":null,"layout":null,"metadata":null,"text":"Once we enter the loader’s main function, we see that it is unique, and does not look like any common crypters that can be found in Conti’s loaders (such as Emotet or Bazarloader).","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*p_n-hNxUH1wyonQBDZFyQA.png":{"__typename":"ImageMetadata","id":"1*p_n-hNxUH1wyonQBDZFyQA.png","originalHeight":405,"originalWidth":515,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:e29948fdd6c_18":{"__typename":"Paragraph","id":"e29948fdd6c_18","name":"a243","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*p_n-hNxUH1wyonQBDZFyQA.png"},"text":"Bumblebee loader\\crypter main","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_19":{"__typename":"Paragraph","id":"e29948fdd6c_19","name":"836d","type":"P","href":null,"layout":null,"metadata":null,"text":"As we open the loader in IDA, we see that the majority of the PE in the IDA navigator has the olive color which means unexplored bytes. This is common when there is some content in the PE that needs to be decrypted during runtime.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*WCKPhR_VCJoqYE2Z7Rn0Zw.png":{"__typename":"ImageMetadata","id":"1*WCKPhR_VCJoqYE2Z7Rn0Zw.png","originalHeight":170,"originalWidth":934,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:e29948fdd6c_20":{"__typename":"Paragraph","id":"e29948fdd6c_20","name":"8e1d","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*WCKPhR_VCJoqYE2Z7Rn0Zw.png"},"text":"Bumblebee loader unexplored bytes","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_21":{"__typename":"Paragraph","id":"e29948fdd6c_21","name":"bb31","type":"P","href":null,"layout":null,"metadata":null,"text":"Tip: During my analysis, I disabled the file’s ASLR to match the addresses in IDA and Xdbg, this is super helpful and saves a lot of time.\nTo do so, open the file in CFF explorer, and then:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"STRONG","start":0,"end":3,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_22":{"__typename":"Paragraph","id":"e29948fdd6c_22","name":"409f","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Click Optional Header","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_23":{"__typename":"Paragraph","id":"e29948fdd6c_23","name":"2dd3","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Go to DllCharacteristics","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_24":{"__typename":"Paragraph","id":"e29948fdd6c_24","name":"4b0d","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Remove the V from “DLL can move”","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*L_Uqy06ieJb1285FX3umRA.png":{"__typename":"ImageMetadata","id":"1*L_Uqy06ieJb1285FX3umRA.png","originalHeight":585,"originalWidth":803,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:e29948fdd6c_25":{"__typename":"Paragraph","id":"e29948fdd6c_25","name":"3b3c","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*L_Uqy06ieJb1285FX3umRA.png"},"text":"Disabling ASLR","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_26":{"__typename":"Paragraph","id":"e29948fdd6c_26","name":"6821","type":"P","href":null,"layout":null,"metadata":null,"text":"Next, we can see that the DllEntryPoint is an empty export function, so we will want to redirect our execution flow to one of the working export functions, for this case, we will choose “SetPath”.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_27":{"__typename":"Paragraph","id":"e29948fdd6c_27","name":"28d9","type":"P","href":null,"layout":null,"metadata":null,"text":"To redirect the flow, do the following:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_28":{"__typename":"Paragraph","id":"e29948fdd6c_28","name":"4630","type":"OLI","href":null,"layout":null,"metadata":null,"text":"In IDA \\ PE-Bear, copy the address of the required export function","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_29":{"__typename":"Paragraph","id":"e29948fdd6c_29","name":"ac36","type":"OLI","href":null,"layout":null,"metadata":null,"text":"In Xdbg, right click on RIP","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_30":{"__typename":"Paragraph","id":"e29948fdd6c_30","name":"a156","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Click on “Modify Value”","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_31":{"__typename":"Paragraph","id":"e29948fdd6c_31","name":"db1a","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Paste the address of the export function","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*H9PeDPeek-mIwadY0gWYRw.png":{"__typename":"ImageMetadata","id":"1*H9PeDPeek-mIwadY0gWYRw.png","originalHeight":791,"originalWidth":953,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:e29948fdd6c_32":{"__typename":"Paragraph","id":"e29948fdd6c_32","name":"0303","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*H9PeDPeek-mIwadY0gWYRw.png"},"text":"Changing the address","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_33":{"__typename":"Paragraph","id":"e29948fdd6c_33","name":"c1b7","type":"P","href":null,"layout":null,"metadata":null,"text":"After clicking OK we will find ourselves at the beginning of the export function. This trick can be used in any other malware the executed via designated export function","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*Xpc-4dF-1Oc3E8TRH0uaIw.png":{"__typename":"ImageMetadata","id":"1*Xpc-4dF-1Oc3E8TRH0uaIw.png","originalHeight":80,"originalWidth":682,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:e29948fdd6c_34":{"__typename":"Paragraph","id":"e29948fdd6c_34","name":"c08b","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*Xpc-4dF-1Oc3E8TRH0uaIw.png"},"text":"Bumblebee SetPath","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_35":{"__typename":"Paragraph","id":"e29948fdd6c_35","name":"363a","type":"P","href":null,"layout":null,"metadata":null,"text":"From a reverse engineer perspective, the crypter is an inconvenient binary to inspect, and there are not many “quick wins” we can gather just by looking at it, however, this crypter is unique in today's landscape so I will focus on the areas I found are the most interesting.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_36":{"__typename":"Paragraph","id":"e29948fdd6c_36","name":"8094","type":"P","href":null,"layout":null,"metadata":null,"text":"First, the crypter will start with a traditional unpacking activity, in the function sub_180003490 there are two other functions:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":85,"end":99,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_37":{"__typename":"Paragraph","id":"e29948fdd6c_37","name":"f7a9","type":"OLI","href":null,"layout":null,"metadata":null,"text":"sub_1800021D0 - which will allocate virtual memory using HeapAlloc (this function will happen multiple times during the crypter unpacking)","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":0,"end":14,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":57,"end":67,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_38":{"__typename":"Paragraph","id":"e29948fdd6c_38","name":"20d2","type":"OLI","href":null,"layout":null,"metadata":null,"text":"sub_1800029BC - Which gets an embedded content and writes it into the newly allocated memory","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":0,"end":14,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*ez9iDaOPzCmKL-M2HpyGLA.png":{"__typename":"ImageMetadata","id":"1*ez9iDaOPzCmKL-M2HpyGLA.png","originalHeight":569,"originalWidth":1362,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:e29948fdd6c_39":{"__typename":"Paragraph","id":"e29948fdd6c_39","name":"8863","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*ez9iDaOPzCmKL-M2HpyGLA.png"},"text":"Bumblebee loader\\crypter main","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_40":{"__typename":"Paragraph","id":"e29948fdd6c_40","name":"4fa2","type":"P","href":null,"layout":null,"metadata":null,"text":"Then, the function sub_180002FF4 will be executed to do the following:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":19,"end":33,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_41":{"__typename":"Paragraph","id":"e29948fdd6c_41","name":"36af","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Allocate new virtual memory using the same sub_1800021D0 function.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":43,"end":57,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_42":{"__typename":"Paragraph","id":"e29948fdd6c_42","name":"0934","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Manipulate the content from the first allocated buffer and write the output into the newly allocated memory","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*fxlEM6gpstWILmBJpNtLcg.png":{"__typename":"ImageMetadata","id":"1*fxlEM6gpstWILmBJpNtLcg.png","originalHeight":437,"originalWidth":1117,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:e29948fdd6c_43":{"__typename":"Paragraph","id":"e29948fdd6c_43","name":"3e8b","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*fxlEM6gpstWILmBJpNtLcg.png"},"text":"Bumblebee loader\\crypter main","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_44":{"__typename":"Paragraph","id":"e29948fdd6c_44","name":"817f","type":"P","href":null,"layout":null,"metadata":null,"text":"The next step will be the function sub_180004180, this function will do the following:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":35,"end":48,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_45":{"__typename":"Paragraph","id":"e29948fdd6c_45","name":"3495","type":"OLI","href":null,"layout":null,"metadata":null,"text":"It executes a function named sub_180001670 that will allocate multiple virtual memories using the already mentioned sub_1800021D0.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":29,"end":43,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":116,"end":129,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_46":{"__typename":"Paragraph","id":"e29948fdd6c_46","name":"976b","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Call the function named sub_180003CE that will use the virtual memory that was allocated in sub_180002FF4, do additional manipulations, and eventually writes an unpacked MZ into the last allocated buffer from the function sub_180001670.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":24,"end":37,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":92,"end":105,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":222,"end":235,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*o1sv_BFsuTZPXfTuLjarYA.png":{"__typename":"ImageMetadata","id":"1*o1sv_BFsuTZPXfTuLjarYA.png","originalHeight":340,"originalWidth":1099,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:e29948fdd6c_47":{"__typename":"Paragraph","id":"e29948fdd6c_47","name":"2a92","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*o1sv_BFsuTZPXfTuLjarYA.png"},"text":"Bumblebee loader\\crypter main","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_48":{"__typename":"Paragraph","id":"e29948fdd6c_48","name":"4ac2","type":"P","href":null,"layout":null,"metadata":null,"text":"When looking statically in the function sub_180003CE, the loop that will write the unpacked file will be the following:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":40,"end":52,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*8Sl8OTk6NSJX5kxlBb3Sqg.png":{"__typename":"ImageMetadata","id":"1*8Sl8OTk6NSJX5kxlBb3Sqg.png","originalHeight":79,"originalWidth":328,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:e29948fdd6c_49":{"__typename":"Paragraph","id":"e29948fdd6c_49","name":"b0b8","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*8Sl8OTk6NSJX5kxlBb3Sqg.png"},"text":"Bumblebee loader payload decryption","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_50":{"__typename":"Paragraph","id":"e29948fdd6c_50","name":"9b7b","type":"P","href":null,"layout":null,"metadata":null,"text":"And when observing dynamically, it will look like the following:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*-sjjkOn-yZM9jkfaYeFCBA.png":{"__typename":"ImageMetadata","id":"1*-sjjkOn-yZM9jkfaYeFCBA.png","originalHeight":468,"originalWidth":870,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:e29948fdd6c_51":{"__typename":"Paragraph","id":"e29948fdd6c_51","name":"6ae3","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*-sjjkOn-yZM9jkfaYeFCBA.png"},"text":"Bumblebee loader payload decryption","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_52":{"__typename":"Paragraph","id":"e29948fdd6c_52","name":"3bd9","type":"P","href":null,"layout":null,"metadata":null,"text":"In the end, we get an allocated memory with Read-Write permissions with an unpacked payload inside.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*V_sV8WKW7Gy_vjM57YO2tg.png":{"__typename":"ImageMetadata","id":"1*V_sV8WKW7Gy_vjM57YO2tg.png","originalHeight":525,"originalWidth":615,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:e29948fdd6c_53":{"__typename":"Paragraph","id":"e29948fdd6c_53","name":"c2ce","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*V_sV8WKW7Gy_vjM57YO2tg.png"},"text":"Bumblebee loader payload decrypted in process hacker","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_54":{"__typename":"Paragraph","id":"e29948fdd6c_54","name":"93a7","type":"P","href":null,"layout":null,"metadata":null,"text":"Until now, everything that is observed are things that are pretty much common in other loaders \\ crypters, however, we still have two unsolved questions:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_55":{"__typename":"Paragraph","id":"e29948fdd6c_55","name":"0f75","type":"OLI","href":null,"layout":null,"metadata":null,"text":"The code section of the payload does not have Execute permission, so it cant run.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_56":{"__typename":"Paragraph","id":"e29948fdd6c_56","name":"b9e7","type":"OLI","href":null,"layout":null,"metadata":null,"text":"What makes this loader special?","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_57":{"__typename":"Paragraph","id":"e29948fdd6c_57","name":"149f","type":"H4","href":null,"layout":null,"metadata":null,"text":"Enters the hook","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_58":{"__typename":"Paragraph","id":"e29948fdd6c_58","name":"154e","type":"P","href":null,"layout":null,"metadata":null,"text":"The loader will enter a function called sub_180001000, this function will create inline hooks[5] that will ignite the chain of events that will lead to the code execution.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":40,"end":53,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*D4yXs_AdtwMvRUR3QI6uEA.png":{"__typename":"ImageMetadata","id":"1*D4yXs_AdtwMvRUR3QI6uEA.png","originalHeight":364,"originalWidth":514,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:e29948fdd6c_59":{"__typename":"Paragraph","id":"e29948fdd6c_59","name":"7d6a","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*D4yXs_AdtwMvRUR3QI6uEA.png"},"text":"Bumblebee loader payload decryption","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_60":{"__typename":"Paragraph","id":"e29948fdd6c_60","name":"fcb5","type":"P","href":null,"layout":null,"metadata":null,"text":"As we enter, we notice something interesting, the loader assign functions to a memory address, then it will call another function named sub_100025EC.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":136,"end":148,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*HkI0q_bK8OpHPxgzc97nbA.png":{"__typename":"ImageMetadata","id":"1*HkI0q_bK8OpHPxgzc97nbA.png","originalHeight":122,"originalWidth":629,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:e29948fdd6c_61":{"__typename":"Paragraph","id":"e29948fdd6c_61","name":"aec9","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*HkI0q_bK8OpHPxgzc97nbA.png"},"text":"Assign functions to addresses","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_62":{"__typename":"Paragraph","id":"e29948fdd6c_62","name":"0e3f","type":"P","href":null,"layout":null,"metadata":null,"text":"This function will do the following:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_63":{"__typename":"Paragraph","id":"e29948fdd6c_63","name":"186d","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Get Ntdll handle with LoadLibrary","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":22,"end":33,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_64":{"__typename":"Paragraph","id":"e29948fdd6c_64","name":"0d61","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Get the address of NtOpenFile","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":19,"end":29,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_65":{"__typename":"Paragraph","id":"e29948fdd6c_65","name":"7c11","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Get the address of NtCreateSection","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":19,"end":34,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_66":{"__typename":"Paragraph","id":"e29948fdd6c_66","name":"aecd","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Get the address of NtMapViewOfSection","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":19,"end":37,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_67":{"__typename":"Paragraph","id":"e29948fdd6c_67","name":"156a","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Return the data","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*abc5_ZQVKRghtvRm_F3VFw.png":{"__typename":"ImageMetadata","id":"1*abc5_ZQVKRghtvRm_F3VFw.png","originalHeight":468,"originalWidth":500,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:e29948fdd6c_68":{"__typename":"Paragraph","id":"e29948fdd6c_68","name":"77b4","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*abc5_ZQVKRghtvRm_F3VFw.png"},"text":"Getting NT functions","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_69":{"__typename":"Paragraph","id":"e29948fdd6c_69","name":"6ac7","type":"P","href":null,"layout":null,"metadata":null,"text":"To observe it dynamically, we can just go to the debugger and step over the functions themselves.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*oVbmew3gnkSdrM2bF6pnfw.png":{"__typename":"ImageMetadata","id":"1*oVbmew3gnkSdrM2bF6pnfw.png","originalHeight":43,"originalWidth":833,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:e29948fdd6c_70":{"__typename":"Paragraph","id":"e29948fdd6c_70","name":"9c48","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*oVbmew3gnkSdrM2bF6pnfw.png"},"text":"Getting NT functions","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_71":{"__typename":"Paragraph","id":"e29948fdd6c_71","name":"3c73","type":"P","href":null,"layout":null,"metadata":null,"text":"After exiting sub_100025EC, our attention will go to a function named sub_1800037C4. This function will be responsible to install a hook in the aforementioned NT functions.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":14,"end":26,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":70,"end":83,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_72":{"__typename":"Paragraph","id":"e29948fdd6c_72","name":"bb67","type":"P","href":null,"layout":null,"metadata":null,"text":"It will do it in the following way:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_73":{"__typename":"Paragraph","id":"e29948fdd6c_73","name":"8eaf","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Call VirtualProtect to change the protection of the area it wants to write into to be writeable","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":5,"end":20,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_74":{"__typename":"Paragraph","id":"e29948fdd6c_74","name":"6ade","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Call sub_180002978 that will take as arguments:\n1. The function to write into \n2. The content it wants to write\n3. The size","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":5,"end":19,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_75":{"__typename":"Paragraph","id":"e29948fdd6c_75","name":"c8da","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Call VirtualProtect to change the protection again to not be writeable","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":5,"end":20,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*LtJSSlRWSzv6n4KlC64_Vw.png":{"__typename":"ImageMetadata","id":"1*LtJSSlRWSzv6n4KlC64_Vw.png","originalHeight":159,"originalWidth":537,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:e29948fdd6c_76":{"__typename":"Paragraph","id":"e29948fdd6c_76","name":"9a9c","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*LtJSSlRWSzv6n4KlC64_Vw.png"},"text":"Setting hook","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_77":{"__typename":"Paragraph","id":"e29948fdd6c_77","name":"6c30","type":"P","href":null,"layout":null,"metadata":null,"text":"Eventually, this activity will occur inside a loop to install the hooks in each of the NT functions. The hook that will be installed will be the functions that have been assigned to memory addresses at the beginning of the larger function.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_78":{"__typename":"Paragraph","id":"e29948fdd6c_78","name":"e963","type":"OLI","href":null,"layout":null,"metadata":null,"text":"sub_180001D4 for NtMapViewOfSection","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":0,"end":13,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_79":{"__typename":"Paragraph","id":"e29948fdd6c_79","name":"cb3c","type":"OLI","href":null,"layout":null,"metadata":null,"text":"sub_1800023D4 for NtOpenFile","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":0,"end":14,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_80":{"__typename":"Paragraph","id":"e29948fdd6c_80","name":"9c7a","type":"OLI","href":null,"layout":null,"metadata":null,"text":"sub_1800041EC for NtCreateSection","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":0,"end":14,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_81":{"__typename":"Paragraph","id":"e29948fdd6c_81","name":"fb1e","type":"P","href":null,"layout":null,"metadata":null,"text":"If we wanted to observe the changes dynamically we have two options, the first one is to just observe it in the debugger by step over sub_180002978","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":134,"end":147,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*0oQzk2MaBpQzacH7UTj9Xg.png":{"__typename":"ImageMetadata","id":"1*0oQzk2MaBpQzacH7UTj9Xg.png","originalHeight":236,"originalWidth":601,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:e29948fdd6c_82":{"__typename":"Paragraph","id":"e29948fdd6c_82","name":"20ed","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*0oQzk2MaBpQzacH7UTj9Xg.png"},"text":"Hooked NT functions","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_83":{"__typename":"Paragraph","id":"e29948fdd6c_83","name":"229e","type":"P","href":null,"layout":null,"metadata":null,"text":"Another option is to use the took Hollow hunter[6] with the “\u002Fhooks” as an argument. Then, we will have a .tag file from the hooked DLL (if found of course)","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*JtAazixTTL29gwv7mA7ztg.png":{"__typename":"ImageMetadata","id":"1*JtAazixTTL29gwv7mA7ztg.png","originalHeight":270,"originalWidth":471,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:e29948fdd6c_84":{"__typename":"Paragraph","id":"e29948fdd6c_84","name":"5fb0","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*JtAazixTTL29gwv7mA7ztg.png"},"text":"View hooks using hollow hunter","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_85":{"__typename":"Paragraph","id":"e29948fdd6c_85","name":"9c66","type":"P","href":null,"layout":null,"metadata":null,"text":"And when we open this file with a text editor we could see the indication of who are the hooked function, and where the hook itself lies.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*JtQYKv2fdneg60jXJhMaYg.png":{"__typename":"ImageMetadata","id":"1*JtQYKv2fdneg60jXJhMaYg.png","originalHeight":116,"originalWidth":1033,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:e29948fdd6c_86":{"__typename":"Paragraph","id":"e29948fdd6c_86","name":"e845","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*JtQYKv2fdneg60jXJhMaYg.png"},"text":"View hooks using hollow hunter","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_87":{"__typename":"Paragraph","id":"e29948fdd6c_87","name":"f9cc","type":"P","href":null,"layout":null,"metadata":null,"text":"To summarize the hooking procedure, it will look like this:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*A7PmIFpkFJ8o1_Ja9TsdxQ.png":{"__typename":"ImageMetadata","id":"1*A7PmIFpkFJ8o1_Ja9TsdxQ.png","originalHeight":480,"originalWidth":701,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:e29948fdd6c_88":{"__typename":"Paragraph","id":"e29948fdd6c_88","name":"44e2","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*A7PmIFpkFJ8o1_Ja9TsdxQ.png"},"text":"Bumblebee loader install hook mechanism","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_89":{"__typename":"Paragraph","id":"e29948fdd6c_89","name":"daaf","type":"H4","href":null,"layout":null,"metadata":null,"text":"Executing the code","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_90":{"__typename":"Paragraph","id":"e29948fdd6c_90","name":"1c9e","type":"P","href":null,"layout":null,"metadata":null,"text":"After we finish setting the hooks, we will head to the function sub_1800013A0","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":64,"end":77,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*iZkubghe8brKYhMA2mWnig.png":{"__typename":"ImageMetadata","id":"1*iZkubghe8brKYhMA2mWnig.png","originalHeight":356,"originalWidth":518,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:e29948fdd6c_91":{"__typename":"Paragraph","id":"e29948fdd6c_91","name":"ceeb","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*iZkubghe8brKYhMA2mWnig.png"},"text":"Bumblebee loader\\crypter main","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_92":{"__typename":"Paragraph","id":"e29948fdd6c_92","name":"0f95","type":"P","href":null,"layout":null,"metadata":null,"text":"This function will attempt to execute the DLL “GdiPlus.dll” using the API call LoadLibrary, with SetPath as an export function.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":47,"end":58,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":79,"end":90,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*0bEYpAPwPCTmasBBUythCA.png":{"__typename":"ImageMetadata","id":"1*0bEYpAPwPCTmasBBUythCA.png","originalHeight":90,"originalWidth":264,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:e29948fdd6c_93":{"__typename":"Paragraph","id":"e29948fdd6c_93","name":"614d","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*0bEYpAPwPCTmasBBUythCA.png"},"text":"LoadLibrary loading GdiPlus.dll","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*5QkNSYwF5TJBdsQtHCvyLA.png":{"__typename":"ImageMetadata","id":"1*5QkNSYwF5TJBdsQtHCvyLA.png","originalHeight":37,"originalWidth":547,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:e29948fdd6c_94":{"__typename":"Paragraph","id":"e29948fdd6c_94","name":"df1b","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*5QkNSYwF5TJBdsQtHCvyLA.png"},"text":"LoadLibrary loading GdiPlus.dll","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_95":{"__typename":"Paragraph","id":"e29948fdd6c_95","name":"2c07","type":"P","href":null,"layout":null,"metadata":null,"text":"Q: Why does the malware even want to use GdiPlus.dll? \nA: It doesn't. \nQ: So why the need to load it?\nA: Because it is not loaded (wait what?!)","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"STRONG","start":0,"end":1,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":55,"end":56,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":71,"end":72,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":102,"end":103,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":41,"end":52,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_96":{"__typename":"Paragraph","id":"e29948fdd6c_96","name":"2e9a","type":"P","href":null,"layout":null,"metadata":null,"text":"The malware will attempt to use some (and unique) custom unpacking:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_97":{"__typename":"Paragraph","id":"e29948fdd6c_97","name":"5fb2","type":"OLI","href":null,"layout":null,"metadata":null,"text":"When LoadLibrary loads a DLL file, it uses internally the hooked NT function as part of its internal activity.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":5,"end":17,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_98":{"__typename":"Paragraph","id":"e29948fdd6c_98","name":"5087","type":"OLI","href":null,"layout":null,"metadata":null,"text":"The malware chooses a DLL that is not loaded yet.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_99":{"__typename":"Paragraph","id":"e29948fdd6c_99","name":"72a7","type":"OLI","href":null,"layout":null,"metadata":null,"text":"NtOpenFile will get a file handle of GdiPlus.dll","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":0,"end":11,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":37,"end":48,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_100":{"__typename":"Paragraph","id":"e29948fdd6c_100","name":"bf8b","type":"OLI","href":null,"layout":null,"metadata":null,"text":"NtCreateSection will create a section for the file handle of GdiPlus.dll","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":0,"end":16,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":61,"end":72,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_101":{"__typename":"Paragraph","id":"e29948fdd6c_101","name":"a74c","type":"P","href":null,"layout":null,"metadata":null,"text":"However, here is when things become tricky, when the LoadLibrary will try to use MapViewOfSection to map the GdiPlus.dll section, the hook function of MapViewOfSection (sub_180001D4C) will do the following:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":53,"end":65,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":81,"end":98,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":109,"end":120,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":151,"end":168,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":169,"end":182,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_102":{"__typename":"Paragraph","id":"e29948fdd6c_102","name":"27ee","type":"OLI","href":null,"layout":null,"metadata":null,"text":"It will use CreateSection to create a new section with READ-WRITE-EXECUTE permissions, without any file handle to associate it with.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":12,"end":26,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_103":{"__typename":"Paragraph","id":"e29948fdd6c_103","name":"96a2","type":"OLI","href":null,"layout":null,"metadata":null,"text":"It will write the unpacked malicious content into this section","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_104":{"__typename":"Paragraph","id":"e29948fdd6c_104","name":"a56a","type":"OLI","href":null,"layout":null,"metadata":null,"text":"It returns NTSTATUS_SUCCESS to the LoadLibrary so it will seem to it as if GdiPlus.dll was mapped successfully.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":35,"end":47,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":75,"end":87,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*HYi8U-NZ5vmslw8CL5N67A.png":{"__typename":"ImageMetadata","id":"1*HYi8U-NZ5vmslw8CL5N67A.png","originalHeight":484,"originalWidth":877,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:e29948fdd6c_105":{"__typename":"Paragraph","id":"e29948fdd6c_105","name":"2d12","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*HYi8U-NZ5vmslw8CL5N67A.png"},"text":"Hooked NtMapViewOfSection mechanism","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_106":{"__typename":"Paragraph","id":"e29948fdd6c_106","name":"7a19","type":"P","href":null,"layout":null,"metadata":null,"text":"The result will be an unpacked bumblebee malware that resides in the RWX section and is associated with GdiPlus.dll. Interestingly, the GdiPlus.dll is considered a relocated DLL in Process hacker.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":104,"end":115,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":136,"end":147,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*0DswdV1ARzZAaXVoQG-7cg.png":{"__typename":"ImageMetadata","id":"1*0DswdV1ARzZAaXVoQG-7cg.png","originalHeight":477,"originalWidth":970,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:e29948fdd6c_107":{"__typename":"Paragraph","id":"e29948fdd6c_107","name":"1eaa","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*0DswdV1ARzZAaXVoQG-7cg.png"},"text":"Relocated module point to RWX section","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_108":{"__typename":"Paragraph","id":"e29948fdd6c_108","name":"c3bb","type":"H4","href":null,"layout":null,"metadata":null,"text":"Bumblebee dropper high lever summary","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_109":{"__typename":"Paragraph","id":"e29948fdd6c_109","name":"b356","type":"P","href":null,"layout":null,"metadata":null,"text":"If we want to look at all the dropper unpacking mechanism steps in a high-level overview and summarize them into three steps, it will look like this:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*ZyU_42T2Cnk4o5DAIQ62gQ.png":{"__typename":"ImageMetadata","id":"1*ZyU_42T2Cnk4o5DAIQ62gQ.png","originalHeight":812,"originalWidth":799,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:e29948fdd6c_110":{"__typename":"Paragraph","id":"e29948fdd6c_110","name":"768f","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*ZyU_42T2Cnk4o5DAIQ62gQ.png"},"text":"Bumblebee dropper overview","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_111":{"__typename":"Paragraph","id":"e29948fdd6c_111","name":"7885","type":"H3","href":null,"layout":null,"metadata":null,"text":"PART 2","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_112":{"__typename":"Paragraph","id":"e29948fdd6c_112","name":"bb98","type":"H3","href":null,"layout":null,"metadata":null,"text":"The bee: Investigating the bumblebee’s payload","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*i-pEV2hH9-qspahKip2m6g.png":{"__typename":"ImageMetadata","id":"1*i-pEV2hH9-qspahKip2m6g.png","originalHeight":514,"originalWidth":1035,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:e29948fdd6c_113":{"__typename":"Paragraph","id":"e29948fdd6c_113","name":"4662","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*i-pEV2hH9-qspahKip2m6g.png"},"text":"Unpacked Bumblebee payload","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_114":{"__typename":"Paragraph","id":"e29948fdd6c_114","name":"1b10","type":"P","href":null,"layout":null,"metadata":null,"text":"The unpacked malware is a large 64-bit file with quite high entropy. \nThis file appears to be the core component of the Bumblebee malware. It features many traditional capabilities we would expect from malware, such as internet communication, file manipulation, collecting user information, cryptography libraries, etc.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_115":{"__typename":"Paragraph","id":"e29948fdd6c_115","name":"ff91","type":"P","href":null,"layout":null,"metadata":null,"text":"In my article I will not cover this file as much because of scoping decisions, however, some interesting code parts to mention are:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_116":{"__typename":"Paragraph","id":"e29948fdd6c_116","name":"7d87","type":"H4","href":null,"layout":null,"metadata":null,"text":"Stolen anti-analysis code","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_117":{"__typename":"Paragraph","id":"e29948fdd6c_117","name":"284f","type":"P","href":null,"layout":null,"metadata":null,"text":"As with many malware, Bumblebee also has anti-analysis tricks, however, the majority of them are grouped in one large function. Also, During my observation, I notice that additional anti-analysis checks have been added as time goes by, which indicates a quick evolving malware or that the authors are still in the “testing the waters” phase.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_118":{"__typename":"Paragraph","id":"e29948fdd6c_118","name":"2116","type":"P","href":null,"layout":null,"metadata":null,"text":"In addition, this entire anti-analysis function code is taken from the GitHub page of the “al-khaser project”[7]. For good measure, I will show some examples.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_119":{"__typename":"Paragraph","id":"e29948fdd6c_119","name":"7b0d","type":"P","href":null,"layout":null,"metadata":null,"text":"Searching for processes","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"STRONG","start":0,"end":23,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_120":{"__typename":"Paragraph","id":"e29948fdd6c_120","name":"c6c0","type":"P","href":null,"layout":null,"metadata":null,"text":"The malware will search for multiple tools that are being used for dynamic and static malware analysis tools. The malware will iterate through the processes using CreateToolHelp32Snapshot.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":163,"end":187,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*n45plFDNoltaq-QobNbPHQ.png":{"__typename":"ImageMetadata","id":"1*n45plFDNoltaq-QobNbPHQ.png","originalHeight":523,"originalWidth":860,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:e29948fdd6c_121":{"__typename":"Paragraph","id":"e29948fdd6c_121","name":"6461","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*n45plFDNoltaq-QobNbPHQ.png"},"text":"Searching for processes in Bumblebee","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_122":{"__typename":"Paragraph","id":"e29948fdd6c_122","name":"ac77","type":"P","href":null,"layout":null,"metadata":null,"text":"As said, this code is the exact code found in the al-khaser project.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*_Zn_zaaTgHSPH_RiWbndtw.png":{"__typename":"ImageMetadata","id":"1*_Zn_zaaTgHSPH_RiWbndtw.png","originalHeight":672,"originalWidth":697,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:e29948fdd6c_123":{"__typename":"Paragraph","id":"e29948fdd6c_123","name":"0c38","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*_Zn_zaaTgHSPH_RiWbndtw.png"},"text":"al-khaser source code","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_124":{"__typename":"Paragraph","id":"e29948fdd6c_124","name":"bdd7","type":"P","href":null,"layout":null,"metadata":null,"text":"The malware also attempts to detect any kind of virtualization environment with the detection of their processes, it varies from Vmware to Vbox processes.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*NiQwFzicYMkiIqGB9D6nWQ.png":{"__typename":"ImageMetadata","id":"1*NiQwFzicYMkiIqGB9D6nWQ.png","originalHeight":167,"originalWidth":434,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:e29948fdd6c_125":{"__typename":"Paragraph","id":"e29948fdd6c_125","name":"b301","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*NiQwFzicYMkiIqGB9D6nWQ.png"},"text":"Searching for Vmware processes in Bumblebee","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_126":{"__typename":"Paragraph","id":"e29948fdd6c_126","name":"cbdd","type":"P","href":null,"layout":null,"metadata":null,"text":"Searching registry keys","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"STRONG","start":0,"end":23,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_127":{"__typename":"Paragraph","id":"e29948fdd6c_127","name":"55a5","type":"P","href":null,"layout":null,"metadata":null,"text":"The malware will attempt to search for designated registry keys that indicate any kind of virtual environment from multiple products.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*Tk4CAcfny5Dl78YqnNitbQ.png":{"__typename":"ImageMetadata","id":"1*Tk4CAcfny5Dl78YqnNitbQ.png","originalHeight":183,"originalWidth":494,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:e29948fdd6c_128":{"__typename":"Paragraph","id":"e29948fdd6c_128","name":"1595","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*Tk4CAcfny5Dl78YqnNitbQ.png"},"text":"Searching for Vmware registry key in Bumblebee","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_129":{"__typename":"Paragraph","id":"e29948fdd6c_129","name":"40f9","type":"P","href":null,"layout":null,"metadata":null,"text":"Searching file paths","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"STRONG","start":0,"end":20,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_130":{"__typename":"Paragraph","id":"e29948fdd6c_130","name":"22d8","type":"P","href":null,"layout":null,"metadata":null,"text":"The malware will search for file paths that can indicate any kind of virtual environment.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*QUnLfdtO5QNZxKJAXfOnKg.png":{"__typename":"ImageMetadata","id":"1*QUnLfdtO5QNZxKJAXfOnKg.png","originalHeight":361,"originalWidth":408,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:e29948fdd6c_131":{"__typename":"Paragraph","id":"e29948fdd6c_131","name":"26fc","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*QUnLfdtO5QNZxKJAXfOnKg.png"},"text":"Searching for VBOX files in Bumblebee","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_132":{"__typename":"Paragraph","id":"e29948fdd6c_132","name":"69da","type":"P","href":null,"layout":null,"metadata":null,"text":"At this point, it will be useless to continue writing the anti-analysis capabilities, so for those who want to see all, please visit the al-khaser project GitHub page.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_133":{"__typename":"Paragraph","id":"e29948fdd6c_133","name":"c9ea","type":"H4","href":null,"layout":null,"metadata":null,"text":"Executing processes","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_134":{"__typename":"Paragraph","id":"e29948fdd6c_134","name":"eb14","type":"P","href":null,"layout":null,"metadata":null,"text":"Among the malware, capabilities are to execute Rundll.exe to run the DLL with the InternalJob as an export function using Wscript.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*e8RiUM88-6bdfiKNa_kHqw.png":{"__typename":"ImageMetadata","id":"1*e8RiUM88-6bdfiKNa_kHqw.png","originalHeight":465,"originalWidth":520,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:e29948fdd6c_135":{"__typename":"Paragraph","id":"e29948fdd6c_135","name":"4d6f","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*e8RiUM88-6bdfiKNa_kHqw.png"},"text":"Executing Wscript","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_136":{"__typename":"Paragraph","id":"e29948fdd6c_136","name":"bb12","type":"P","href":null,"layout":null,"metadata":null,"text":"Also, the malware can use PowerShell to perform further activities","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*tD8HU7seJ4H28I0KxMejxg.png":{"__typename":"ImageMetadata","id":"1*tD8HU7seJ4H28I0KxMejxg.png","originalHeight":165,"originalWidth":414,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:e29948fdd6c_137":{"__typename":"Paragraph","id":"e29948fdd6c_137","name":"266a","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*tD8HU7seJ4H28I0KxMejxg.png"},"text":"Executing PowerShell","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_138":{"__typename":"Paragraph","id":"e29948fdd6c_138","name":"0cc7","type":"H4","href":null,"layout":null,"metadata":null,"text":"The little ones inside the flask","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_139":{"__typename":"Paragraph","id":"e29948fdd6c_139","name":"1831","type":"P","href":null,"layout":null,"metadata":null,"text":"One of the most interesting things about the Bumblebee core component is the fact that it contains two DLL files inside of him.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*yga8DcFVPDIL4tcK9eJ3eA.png":{"__typename":"ImageMetadata","id":"1*yga8DcFVPDIL4tcK9eJ3eA.png","originalHeight":518,"originalWidth":1064,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:e29948fdd6c_140":{"__typename":"Paragraph","id":"e29948fdd6c_140","name":"0d7a","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*yga8DcFVPDIL4tcK9eJ3eA.png"},"text":"Two hidden DLL files inside the unpacked Bumblebee","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_141":{"__typename":"Paragraph","id":"e29948fdd6c_141","name":"dd46","type":"P","href":null,"layout":null,"metadata":null,"text":"Both of these files have the same internal name RapportGP.dll (which is also used by the security company Trusteer)","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":48,"end":61,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*mLuUbODYgSbjitcpDWQ9BA.png":{"__typename":"ImageMetadata","id":"1*mLuUbODYgSbjitcpDWQ9BA.png","originalHeight":214,"originalWidth":391,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:e29948fdd6c_142":{"__typename":"Paragraph","id":"e29948fdd6c_142","name":"90c0","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*mLuUbODYgSbjitcpDWQ9BA.png"},"text":"Bumblebee hooking DLL aka RapportGP.dll","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_143":{"__typename":"Paragraph","id":"e29948fdd6c_143","name":"aec1","type":"P","href":null,"layout":null,"metadata":null,"text":"The two DLL files are completely identical except for the fact that one of them is 32-bit and the other is 64-bit.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_144":{"__typename":"Paragraph","id":"e29948fdd6c_144","name":"4017","type":"H3","href":null,"layout":null,"metadata":null,"text":"PART 3: The shadow of Trickbot- Investigating the hooking DLL","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_145":{"__typename":"Paragraph","id":"e29948fdd6c_145","name":"f21f","type":"P","href":null,"layout":null,"metadata":null,"text":"In the last part, I will investigate the RapportGP.dll, as said, there are two versions: 32\\64 bit, and for my analysis, I will focus only on the 32 bit.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":41,"end":54,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_146":{"__typename":"Paragraph","id":"e29948fdd6c_146","name":"bab6","type":"P","href":null,"layout":null,"metadata":null,"text":"The main concept behind RapportGP.dll is hooking, and the entire module’s mechanism is supporting this activity.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":24,"end":37,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_147":{"__typename":"Paragraph","id":"e29948fdd6c_147","name":"ac23","type":"H4","href":null,"layout":null,"metadata":null,"text":"Check for existing hooks","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_148":{"__typename":"Paragraph","id":"e29948fdd6c_148","name":"de3b","type":"P","href":null,"layout":null,"metadata":null,"text":"One of the first activities of the module occurs in a function named “sub_100060C0”, in general, this function will be responsible to check if there is any hooked function from a list of pre-determined functions.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":70,"end":82,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_149":{"__typename":"Paragraph","id":"e29948fdd6c_149","name":"300d","type":"P","href":null,"layout":null,"metadata":null,"text":"Inside sub_100060C0, the chain of events that leads to this is the following:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":7,"end":19,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_150":{"__typename":"Paragraph","id":"e29948fdd6c_150","name":"91c2","type":"OLI","href":null,"layout":null,"metadata":null,"text":"A handle to Ntdll.dll, Kernel32.dll, Kernelbase.dll, Advapi32.dll obtained","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":12,"end":21,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":23,"end":35,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":37,"end":51,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":53,"end":65,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_151":{"__typename":"Paragraph","id":"e29948fdd6c_151","name":"a3d7","type":"OLI","href":null,"layout":null,"metadata":null,"text":"The requested DLL’s path obtained","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_152":{"__typename":"Paragraph","id":"e29948fdd6c_152","name":"1c85","type":"OLI","href":null,"layout":null,"metadata":null,"text":"A call to the function sub_100059B0 was made to get a copy of NtProtectVirtualMemory that stored in the allocated memory","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":23,"end":40,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":62,"end":85,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_153":{"__typename":"Paragraph","id":"e29948fdd6c_153","name":"eb69","type":"OLI","href":null,"layout":null,"metadata":null,"text":"The arguments are sent to another function named sub_10005B90","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":49,"end":61,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*VO_v9EB-1WpWsducAwSJgg.png":{"__typename":"ImageMetadata","id":"1*VO_v9EB-1WpWsducAwSJgg.png","originalHeight":640,"originalWidth":841,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:e29948fdd6c_154":{"__typename":"Paragraph","id":"e29948fdd6c_154","name":"1cff","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*VO_v9EB-1WpWsducAwSJgg.png"},"text":"1. RapportGP.dll checking and disabling existing hooks","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_155":{"__typename":"Paragraph","id":"e29948fdd6c_155","name":"ce85","type":"P","href":null,"layout":null,"metadata":null,"text":"The functions it wants to check are:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_156":{"__typename":"Paragraph","id":"e29948fdd6c_156","name":"8a5b","type":"P","href":null,"layout":null,"metadata":null,"text":"In Ntdll.dll","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":3,"end":12,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*6t6pL0Zp3UgUWF80GtA4aA.png":{"__typename":"ImageMetadata","id":"1*6t6pL0Zp3UgUWF80GtA4aA.png","originalHeight":758,"originalWidth":534,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:e29948fdd6c_157":{"__typename":"Paragraph","id":"e29948fdd6c_157","name":"986e","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*6t6pL0Zp3UgUWF80GtA4aA.png"},"text":"RapportGP.dll list of Ntdll functions to check","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_158":{"__typename":"Paragraph","id":"e29948fdd6c_158","name":"ccf5","type":"P","href":null,"layout":null,"metadata":null,"text":"In Kernel32.dll","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":3,"end":15,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*tLWiS8gb0L2wY6a4BDPWMg.png":{"__typename":"ImageMetadata","id":"1*tLWiS8gb0L2wY6a4BDPWMg.png","originalHeight":305,"originalWidth":612,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:e29948fdd6c_159":{"__typename":"Paragraph","id":"e29948fdd6c_159","name":"c8ca","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*tLWiS8gb0L2wY6a4BDPWMg.png"},"text":"RapportGP.dll list of Kernel32 functions to check","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_160":{"__typename":"Paragraph","id":"e29948fdd6c_160","name":"fd31","type":"P","href":null,"layout":null,"metadata":null,"text":"In Kernelbase.dll","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":3,"end":17,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*XVsk7sYs7i5NhYP-IQFXrA.png":{"__typename":"ImageMetadata","id":"1*XVsk7sYs7i5NhYP-IQFXrA.png","originalHeight":397,"originalWidth":494,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:e29948fdd6c_161":{"__typename":"Paragraph","id":"e29948fdd6c_161","name":"fa76","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*XVsk7sYs7i5NhYP-IQFXrA.png"},"text":"RapportGP.dll list of Kernelbase functions to check","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_162":{"__typename":"Paragraph","id":"e29948fdd6c_162","name":"803c","type":"P","href":null,"layout":null,"metadata":null,"text":"In Advapi32.dll","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":3,"end":15,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*va9oRtRsoAF-CyYJ2SsRUw.png":{"__typename":"ImageMetadata","id":"1*va9oRtRsoAF-CyYJ2SsRUw.png","originalHeight":121,"originalWidth":453,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:e29948fdd6c_163":{"__typename":"Paragraph","id":"e29948fdd6c_163","name":"dd93","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*va9oRtRsoAF-CyYJ2SsRUw.png"},"text":"RapportGP.dll list of Advapi32 functions to check","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_164":{"__typename":"Paragraph","id":"e29948fdd6c_164","name":"aa37","type":"P","href":null,"layout":null,"metadata":null,"text":"In sub_10005B90, the module path of the requested DLL file will be mapped to memory and will be sent to an additional function named “sub_10005D40” that will deal with the actual checking.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":3,"end":15,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":134,"end":146,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*Wumujqc70Hw3MSm9HvwQCQ.png":{"__typename":"ImageMetadata","id":"1*Wumujqc70Hw3MSm9HvwQCQ.png","originalHeight":380,"originalWidth":787,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:e29948fdd6c_165":{"__typename":"Paragraph","id":"e29948fdd6c_165","name":"cdfc","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*Wumujqc70Hw3MSm9HvwQCQ.png"},"text":"2. RapportGP.dll checking and disabling existing hooks","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_166":{"__typename":"Paragraph","id":"e29948fdd6c_166","name":"2965","type":"P","href":null,"layout":null,"metadata":null,"text":"As for the checks themselves, it is quite simple:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_167":{"__typename":"Paragraph","id":"e29948fdd6c_167","name":"7f4e","type":"OLI","href":null,"layout":null,"metadata":null,"text":"The malware iterate through the export functions of the legitimate DLL file that was mapped to memory by the process when it loads.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_168":{"__typename":"Paragraph","id":"e29948fdd6c_168","name":"163e","type":"OLI","href":null,"layout":null,"metadata":null,"text":"The malware will check if the name is one of the function names it wants to check","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_169":{"__typename":"Paragraph","id":"e29948fdd6c_169","name":"99cf","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Once found, the malware calls sub_10001040 that checks for hooks evidence in the DLL that was mapped by the process loader","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":30,"end":43,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_170":{"__typename":"Paragraph","id":"e29948fdd6c_170","name":"3d47","type":"OLI","href":null,"layout":null,"metadata":null,"text":"The malware will do the same for the DLL that was mapped by the malware itself (in sub_10005B90).","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":83,"end":95,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_171":{"__typename":"Paragraph","id":"e29948fdd6c_171","name":"c9d4","type":"OLI","href":null,"layout":null,"metadata":null,"text":"If no hooks are found, it will continue to iterate","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*2efFqFPIHOq8TgyK9HOAnw.png":{"__typename":"ImageMetadata","id":"1*2efFqFPIHOq8TgyK9HOAnw.png","originalHeight":661,"originalWidth":780,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:e29948fdd6c_172":{"__typename":"Paragraph","id":"e29948fdd6c_172","name":"8ac0","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*2efFqFPIHOq8TgyK9HOAnw.png"},"text":"3. RapportGP.dll checking and disabling existing hooks","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_173":{"__typename":"Paragraph","id":"e29948fdd6c_173","name":"3ec3","type":"P","href":null,"layout":null,"metadata":null,"text":"And if there is an indication of hooks, the malware does the following","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_174":{"__typename":"Paragraph","id":"e29948fdd6c_174","name":"9413","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Get information about the original function","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_175":{"__typename":"Paragraph","id":"e29948fdd6c_175","name":"92e4","type":"OLI","href":null,"layout":null,"metadata":null,"text":"It will change the protection","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_176":{"__typename":"Paragraph","id":"e29948fdd6c_176","name":"2248","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Check if it's writable","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_177":{"__typename":"Paragraph","id":"e29948fdd6c_177","name":"dafc","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Write the content of the mapped function to the original function. In this way, it restores it to the state it should be if there are no hooks.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*ncFHLW8iQLTFZ8C2ZbEFKg.png":{"__typename":"ImageMetadata","id":"1*ncFHLW8iQLTFZ8C2ZbEFKg.png","originalHeight":364,"originalWidth":810,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:e29948fdd6c_178":{"__typename":"Paragraph","id":"e29948fdd6c_178","name":"42b8","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*ncFHLW8iQLTFZ8C2ZbEFKg.png"},"text":"4. RapportGP.dll checking and disabling existing hooks","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_179":{"__typename":"Paragraph","id":"e29948fdd6c_179","name":"c087","type":"P","href":null,"layout":null,"metadata":null,"text":"If we wanted to observe this activity dynamically, all we need to do is to change the bytes from the beginning of one of the functions the malware wants to check. For example, let's take NtCreateFile.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":187,"end":199,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_180":{"__typename":"Paragraph","id":"e29948fdd6c_180","name":"7d10","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Original function at 775222C0","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_181":{"__typename":"Paragraph","id":"e29948fdd6c_181","name":"f49f","type":"OLI","href":null,"layout":null,"metadata":null,"text":"The function that mapped by the malware at 02E022C0","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*Z38zAEFQ6guWL_PkqmZgtQ.png":{"__typename":"ImageMetadata","id":"1*Z38zAEFQ6guWL_PkqmZgtQ.png","originalHeight":270,"originalWidth":581,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:e29948fdd6c_182":{"__typename":"Paragraph","id":"e29948fdd6c_182","name":"4dff","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*Z38zAEFQ6guWL_PkqmZgtQ.png"},"text":"5. RapportGP.dll checking and disabling existing hooks","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_183":{"__typename":"Paragraph","id":"e29948fdd6c_183","name":"6e8c","type":"P","href":null,"layout":null,"metadata":null,"text":"When looking in the dump, we can see that their code is exactly the same","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*Ba-iAwvvHnaYx2GPXY-cWw.png":{"__typename":"ImageMetadata","id":"1*Ba-iAwvvHnaYx2GPXY-cWw.png","originalHeight":199,"originalWidth":405,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:e29948fdd6c_184":{"__typename":"Paragraph","id":"e29948fdd6c_184","name":"afa2","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*Ba-iAwvvHnaYx2GPXY-cWw.png"},"text":"6. RapportGP.dll checking and disabling existing hooks","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_185":{"__typename":"Paragraph","id":"e29948fdd6c_185","name":"b106","type":"P","href":null,"layout":null,"metadata":null,"text":"Let's change the first byte of the original to have an E9 opcode (jump)","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*hsHHmVR-9RFdzm6N1wJJnw.png":{"__typename":"ImageMetadata","id":"1*hsHHmVR-9RFdzm6N1wJJnw.png","originalHeight":102,"originalWidth":406,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:e29948fdd6c_186":{"__typename":"Paragraph","id":"e29948fdd6c_186","name":"99c1","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*hsHHmVR-9RFdzm6N1wJJnw.png"},"text":"7. RapportGP.dll checking and disabling existing hooks","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_187":{"__typename":"Paragraph","id":"e29948fdd6c_187","name":"b6c1","type":"P","href":null,"layout":null,"metadata":null,"text":"Now, if we will try to debug dynamically, we will be able to get to the last part of the code.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*LoI-P9_M8_ipHkWJn9UcPQ.png":{"__typename":"ImageMetadata","id":"1*LoI-P9_M8_ipHkWJn9UcPQ.png","originalHeight":257,"originalWidth":901,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:e29948fdd6c_188":{"__typename":"Paragraph","id":"e29948fdd6c_188","name":"bd13","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*LoI-P9_M8_ipHkWJn9UcPQ.png"},"text":"8. RapportGP.dll checking and disabling existing hooks","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_189":{"__typename":"Paragraph","id":"e29948fdd6c_189","name":"62ba","type":"P","href":null,"layout":null,"metadata":null,"text":"After stepping over memset, we can see that the E9 byte no longer exists and the original function returned to its normal state.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":20,"end":26,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*p1JsnjdvH2Y7c7NARLx-BA.png":{"__typename":"ImageMetadata","id":"1*p1JsnjdvH2Y7c7NARLx-BA.png","originalHeight":167,"originalWidth":560,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:e29948fdd6c_190":{"__typename":"Paragraph","id":"e29948fdd6c_190","name":"1b61","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*p1JsnjdvH2Y7c7NARLx-BA.png"},"text":"9. RapportGP.dll checking and disabling existing hooks","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_191":{"__typename":"Paragraph","id":"e29948fdd6c_191","name":"5c0e","type":"P","href":null,"layout":null,"metadata":null,"text":"At a very high level, the process eventually looks like this:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*g789hNfORqqlo6d63ynYfw.png":{"__typename":"ImageMetadata","id":"1*g789hNfORqqlo6d63ynYfw.png","originalHeight":506,"originalWidth":755,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:e29948fdd6c_192":{"__typename":"Paragraph","id":"e29948fdd6c_192","name":"60d1","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*g789hNfORqqlo6d63ynYfw.png"},"text":"10. RapportGP.dll checking and disabling existing hooks","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_193":{"__typename":"Paragraph","id":"e29948fdd6c_193","name":"1051","type":"H4","href":null,"layout":null,"metadata":null,"text":"Setting the hooks","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_194":{"__typename":"Paragraph","id":"e29948fdd6c_194","name":"6d14","type":"P","href":null,"layout":null,"metadata":null,"text":"After checking that there are no other hooks, the malware turns to set its own hooks. The malware will have two kinds of hooks for different purposes.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_195":{"__typename":"Paragraph","id":"e29948fdd6c_195","name":"cf37","type":"H4","href":null,"layout":null,"metadata":null,"text":"First hooks: Disable Exceptions","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_196":{"__typename":"Paragraph","id":"e29948fdd6c_196","name":"bb73","type":"P","href":null,"layout":null,"metadata":null,"text":"The malware will set a hook on the function RaiseFailFastException which is located in kernel32.dll and api-ms-win-core-errorhandling-l1–1–2.dll.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":44,"end":66,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":104,"end":144,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_197":{"__typename":"Paragraph","id":"e29948fdd6c_197","name":"9b2f","type":"P","href":null,"layout":null,"metadata":null,"text":"The function that will be triggered will be empty, therefore no exception will be triggered.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*7Z4NZGATVjR8mjYDEA1pFg.png":{"__typename":"ImageMetadata","id":"1*7Z4NZGATVjR8mjYDEA1pFg.png","originalHeight":191,"originalWidth":993,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:e29948fdd6c_198":{"__typename":"Paragraph","id":"e29948fdd6c_198","name":"3cf7","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*7Z4NZGATVjR8mjYDEA1pFg.png"},"text":"RapportGP.dll hooks to disable exceptions","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_199":{"__typename":"Paragraph","id":"e29948fdd6c_199","name":"dc43","type":"H4","href":null,"layout":null,"metadata":null,"text":"Second hooks: Further code execution","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_200":{"__typename":"Paragraph","id":"e29948fdd6c_200","name":"c80b","type":"P","href":null,"layout":null,"metadata":null,"text":"The malware will use the same technique the bumblebee loader did. It will first get the addresses of the function ZwMapViewOfSection, ZwOpenSection, ZwCreateSection, ZwOpenFile, ZwClose, and LdrLoadDll.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":114,"end":132,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":134,"end":147,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":149,"end":164,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":166,"end":176,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":178,"end":185,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":191,"end":201,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*Z4U14uBKuea70V_tfdkUAQ.png":{"__typename":"ImageMetadata","id":"1*Z4U14uBKuea70V_tfdkUAQ.png","originalHeight":227,"originalWidth":636,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:e29948fdd6c_201":{"__typename":"Paragraph","id":"e29948fdd6c_201","name":"5ec2","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*Z4U14uBKuea70V_tfdkUAQ.png"},"text":"RapportGP.dll second hooks","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_202":{"__typename":"Paragraph","id":"e29948fdd6c_202","name":"0c4f","type":"P","href":null,"layout":null,"metadata":null,"text":"And similar to the Bumblebee’s loader, it will first set the hook, and then will call LdrLoadDll which is the lower lever equivalent of LoadLibrary to load the module “wups.dll”, which will trigger the chain of events we already discussed in the Bumblebee loader part.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":86,"end":97,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":136,"end":147,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":168,"end":176,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*vVvPW9Wq8Qf_KShh9SNs_A.png":{"__typename":"ImageMetadata","id":"1*vVvPW9Wq8Qf_KShh9SNs_A.png","originalHeight":349,"originalWidth":469,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:e29948fdd6c_203":{"__typename":"Paragraph","id":"e29948fdd6c_203","name":"2b88","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*vVvPW9Wq8Qf_KShh9SNs_A.png"},"text":"RapportGP.dll second hooks","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_204":{"__typename":"Paragraph","id":"e29948fdd6c_204","name":"f576","type":"H4","href":null,"layout":null,"metadata":null,"text":"The Trickbot hooking engine","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_205":{"__typename":"Paragraph","id":"e29948fdd6c_205","name":"fce4","type":"P","href":null,"layout":null,"metadata":null,"text":"Although both hooks are doing completely different things, the hooks’ installation mechanism is the same. Interestingly, this mechanism is also the same as the web-inject module of Trickbot.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*uU9PGmrxM-miT4BCaZfUfA.png":{"__typename":"ImageMetadata","id":"1*uU9PGmrxM-miT4BCaZfUfA.png","originalHeight":941,"originalWidth":876,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:e29948fdd6c_206":{"__typename":"Paragraph","id":"e29948fdd6c_206","name":"c9d0","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*uU9PGmrxM-miT4BCaZfUfA.png"},"text":"Bumblebee’s RapportGP.dll vs Trickbot’s web-inject module","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_207":{"__typename":"Paragraph","id":"e29948fdd6c_207","name":"65b8","type":"P","href":null,"layout":null,"metadata":null,"text":"As with many ex-bankers that use hooking such as Panda, Trickbot, and Qbot, their hooking code is based on the Zeus leak, however, each of them has its flavor and changes and Trickbot is no different.\nIn the Trickbot web-inject hooking mechanism, which has already been documented[8], when creating the inline hooking “trampoline” there is the following evasion technique:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_208":{"__typename":"Paragraph","id":"e29948fdd6c_208","name":"b64a","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Trickbot writes 35 bytes of NOPS (0x90)","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_209":{"__typename":"Paragraph","id":"e29948fdd6c_209","name":"aedf","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Add the traditional function prologue","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_210":{"__typename":"Paragraph","id":"e29948fdd6c_210","name":"97b6","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Write the jump to the targeted function at the end of the NOPS","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*7msFKF7_eDOEB9sQIIwmAw.png":{"__typename":"ImageMetadata","id":"1*7msFKF7_eDOEB9sQIIwmAw.png","originalHeight":392,"originalWidth":560,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:e29948fdd6c_211":{"__typename":"Paragraph","id":"e29948fdd6c_211","name":"7237","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*7msFKF7_eDOEB9sQIIwmAw.png"},"text":"Trickbot’s web-inject module evasion technique","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_212":{"__typename":"Paragraph","id":"e29948fdd6c_212","name":"6edf","type":"P","href":null,"layout":null,"metadata":null,"text":"As we debug Bumblebee, we notice it uses the same unique evasion as well (adjusted for the API calls it wants to hook). So for example when hooking the ZwMapViewOfSection, which instantiates a Syscall, it will look like this.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":152,"end":170,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*KkwvIZaCeCoY4rtZ9Yd0kA.png":{"__typename":"ImageMetadata","id":"1*KkwvIZaCeCoY4rtZ9Yd0kA.png","originalHeight":365,"originalWidth":578,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:e29948fdd6c_213":{"__typename":"Paragraph","id":"e29948fdd6c_213","name":"4559","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*KkwvIZaCeCoY4rtZ9Yd0kA.png"},"text":"Bumblebee’s RapportGP.dll evasion technique","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_214":{"__typename":"Paragraph","id":"e29948fdd6c_214","name":"f954","type":"P","href":null,"layout":null,"metadata":null,"text":"And when targeting the user-mode functions RaiseFailFastException, it will look exactly like in Trickbot.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":43,"end":65,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*yxo3-VZ8jVAhWx5aEmdj8w.png":{"__typename":"ImageMetadata","id":"1*yxo3-VZ8jVAhWx5aEmdj8w.png","originalHeight":323,"originalWidth":379,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:e29948fdd6c_215":{"__typename":"Paragraph","id":"e29948fdd6c_215","name":"5efe","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*yxo3-VZ8jVAhWx5aEmdj8w.png"},"text":"Bumblebee’s RapportGP.dll evasion technique","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_216":{"__typename":"Paragraph","id":"e29948fdd6c_216","name":"850f","type":"H4","href":null,"layout":null,"metadata":null,"text":"Static differences and code evolution","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_217":{"__typename":"Paragraph","id":"e29948fdd6c_217","name":"8a57","type":"P","href":null,"layout":null,"metadata":null,"text":"When inspecting the entire code flow graph of the hook installation function, we can see a striking similarity between Bumblebee’s RapportGP.dll and Trickbot’s web-inject module.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*OYKaTzNACrgb1FNEfhHpoA.png":{"__typename":"ImageMetadata","id":"1*OYKaTzNACrgb1FNEfhHpoA.png","originalHeight":676,"originalWidth":558,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:e29948fdd6c_218":{"__typename":"Paragraph","id":"e29948fdd6c_218","name":"c1db","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*OYKaTzNACrgb1FNEfhHpoA.png"},"text":"Bumblebee’s RapportGP.dll vs Trickbot’s web-inject module install hook functions","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_219":{"__typename":"Paragraph","id":"e29948fdd6c_219","name":"0776","type":"P","href":null,"layout":null,"metadata":null,"text":"Interestingly, although the actual functionality is the same, we might think that statically everything is the same, even the sub-functions inside the hooking installation function. Funny enough, this is not the case.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_220":{"__typename":"Paragraph","id":"e29948fdd6c_220","name":"22b4","type":"P","href":null,"layout":null,"metadata":null,"text":"As mentioned above, in the hooking installation function, one function is responsible for doing checks and return size (Please see the image above).","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_221":{"__typename":"Paragraph","id":"e29948fdd6c_221","name":"2e2d","type":"OLI","href":null,"layout":null,"metadata":null,"text":"In Trickbot its sub_10001650","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":16,"end":28,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_222":{"__typename":"Paragraph","id":"e29948fdd6c_222","name":"18af","type":"OLI","href":null,"layout":null,"metadata":null,"text":"In Bumblebee its sub_10002870","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":17,"end":29,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_223":{"__typename":"Paragraph","id":"e29948fdd6c_223","name":"1847","type":"P","href":null,"layout":null,"metadata":null,"text":"However, when inspecting their code and code flow statically, this is how they both look like","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*RVAZwWcCWeEdRbT_8sYTjQ.png":{"__typename":"ImageMetadata","id":"1*RVAZwWcCWeEdRbT_8sYTjQ.png","originalHeight":649,"originalWidth":777,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:e29948fdd6c_224":{"__typename":"Paragraph","id":"e29948fdd6c_224","name":"0dbd","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*RVAZwWcCWeEdRbT_8sYTjQ.png"},"text":"Bumblebee’s RapportGP.dll vs Trickbot’s web-inject module- same functionality, different flow","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_225":{"__typename":"Paragraph","id":"e29948fdd6c_225","name":"c992","type":"P","href":null,"layout":null,"metadata":null,"text":"Obviously, in Bumblebee, the authors have decided to use Control-flow-flattening[9] to obfuscate the entire flow of the function. For those of you who are not familiar with this obfuscation technique, I strongly recommend the following video[10].","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_226":{"__typename":"Paragraph","id":"e29948fdd6c_226","name":"f7c4","type":"P","href":null,"layout":null,"metadata":null,"text":"In addition, inside each of these functions (sub_10001650 in Trickbot, sub_10002870 in Bumblebee) there are 3 functions (one of them is memset), and the Control-flow-flattening concept continues in Bumblebee inside them as well. \nFor example, here are another two functions that act the same dynamically:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":45,"end":58,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":71,"end":84,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":136,"end":142,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*fVkm0vcJQOLMBMH_VqslAQ.png":{"__typename":"ImageMetadata","id":"1*fVkm0vcJQOLMBMH_VqslAQ.png","originalHeight":581,"originalWidth":819,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:e29948fdd6c_227":{"__typename":"Paragraph","id":"e29948fdd6c_227","name":"412a","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*fVkm0vcJQOLMBMH_VqslAQ.png"},"text":"Bumblebee’s RapportGP.dll vs Trickbot’s web-inject module- same functionality, different flow","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_228":{"__typename":"Paragraph","id":"e29948fdd6c_228","name":"af40","type":"P","href":null,"layout":null,"metadata":null,"text":"When observing the two functions in Bindiff flow graphs, we could see some similarities.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*l1QjmAg8dbf6F6hz8s2EJg.png":{"__typename":"ImageMetadata","id":"1*l1QjmAg8dbf6F6hz8s2EJg.png","originalHeight":853,"originalWidth":691,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:e29948fdd6c_229":{"__typename":"Paragraph","id":"e29948fdd6c_229","name":"92d2","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*l1QjmAg8dbf6F6hz8s2EJg.png"},"text":"Bumblebee’s RapportGP.dll vs Trickbot’s web-inject module-Bindiff","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_230":{"__typename":"Paragraph","id":"e29948fdd6c_230","name":"cb12","type":"H4","href":null,"layout":null,"metadata":null,"text":"Additional similarities","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_231":{"__typename":"Paragraph","id":"e29948fdd6c_231","name":"8ac6","type":"P","href":null,"layout":null,"metadata":null,"text":"In both modules, there are other functions that are not completely identical by code, however, they serve the same functionality.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_232":{"__typename":"Paragraph","id":"e29948fdd6c_232","name":"3cac","type":"P","href":null,"layout":null,"metadata":null,"text":"Example_1","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"STRONG","start":0,"end":9,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_233":{"__typename":"Paragraph","id":"e29948fdd6c_233","name":"2b38","type":"P","href":null,"layout":null,"metadata":null,"text":"Before entering the hooking functions, both Trickbot and Bumblebee attempt to use LoadLibrary and get the address of the function it wants to hook.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_234":{"__typename":"Paragraph","id":"e29948fdd6c_234","name":"eebd","type":"P","href":null,"layout":null,"metadata":null,"text":"The difference is that in Trickbot it explicitly writes “Kernel32.dll” and in Bumblebee it gets the DLL’s name from the caller function.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":57,"end":69,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*KifKc-C4FX_QfDQhKnTZEw.png":{"__typename":"ImageMetadata","id":"1*KifKc-C4FX_QfDQhKnTZEw.png","originalHeight":667,"originalWidth":868,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:e29948fdd6c_235":{"__typename":"Paragraph","id":"e29948fdd6c_235","name":"9c37","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*KifKc-C4FX_QfDQhKnTZEw.png"},"text":"Bumblebee’s RapportGP.dll vs Trickbot’s web-inject module- same functionality, a different approach","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_236":{"__typename":"Paragraph","id":"e29948fdd6c_236","name":"4a7c","type":"P","href":null,"layout":null,"metadata":null,"text":"Example_2","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"STRONG","start":0,"end":9,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_237":{"__typename":"Paragraph","id":"e29948fdd6c_237","name":"e3b4","type":"P","href":null,"layout":null,"metadata":null,"text":"The call for the hooking activity looks very similar as well","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*_AfcXXdiM9dKQgo36BvyfQ.png":{"__typename":"ImageMetadata","id":"1*_AfcXXdiM9dKQgo36BvyfQ.png","originalHeight":417,"originalWidth":600,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:e29948fdd6c_238":{"__typename":"Paragraph","id":"e29948fdd6c_238","name":"359c","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*_AfcXXdiM9dKQgo36BvyfQ.png"},"text":"Bumblebee’s RapportGP.dll vs Trickbot’s web-inject module","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_239":{"__typename":"Paragraph","id":"e29948fdd6c_239","name":"1d16","type":"P","href":null,"layout":null,"metadata":null,"text":"Example_3","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"STRONG","start":0,"end":9,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_240":{"__typename":"Paragraph","id":"e29948fdd6c_240","name":"c64c","type":"P","href":null,"layout":null,"metadata":null,"text":"Outside the hooking, the Bumblebee’s hooking module starts with getting the process handle and eventually duplicating a thread handle, whereas, the Trickbot’s module starts with getting the process handle and duplicating the token. Again, the same objective, in a different way.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_241":{"__typename":"Paragraph","id":"e29948fdd6c_241","name":"43f2","type":"H4","href":null,"layout":null,"metadata":null,"text":"Customize flattened RC4","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_242":{"__typename":"Paragraph","id":"e29948fdd6c_242","name":"55cd","type":"P","href":null,"layout":null,"metadata":null,"text":"Another interesting activity lies inside the hooked ZwMapViewOfSection function. The hook appears to use a customize RC4 obfuscated with the Control-flow-flattening technique.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":52,"end":71,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*rWbRkKMEvNiHmgZV9FgRZw.png":{"__typename":"ImageMetadata","id":"1*rWbRkKMEvNiHmgZV9FgRZw.png","originalHeight":435,"originalWidth":406,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:e29948fdd6c_243":{"__typename":"Paragraph","id":"e29948fdd6c_243","name":"cf62","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*rWbRkKMEvNiHmgZV9FgRZw.png"},"text":"Custom RC4 with CFF obfuscation","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_244":{"__typename":"Paragraph","id":"e29948fdd6c_244","name":"9673","type":"H4","href":null,"layout":null,"metadata":null,"text":"RapportGP.dll High-level summary","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_245":{"__typename":"Paragraph","id":"e29948fdd6c_245","name":"07e6","type":"P","href":null,"layout":null,"metadata":null,"text":"When trying to summarize the entire file behavior, it eventually is the following:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*dnpp_KqVCIsBuQXKJnSD3A.png":{"__typename":"ImageMetadata","id":"1*dnpp_KqVCIsBuQXKJnSD3A.png","originalHeight":1188,"originalWidth":764,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:e29948fdd6c_246":{"__typename":"Paragraph","id":"e29948fdd6c_246","name":"a799","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*dnpp_KqVCIsBuQXKJnSD3A.png"},"text":"RapportGP.dll overall activity","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_247":{"__typename":"Paragraph","id":"e29948fdd6c_247","name":"cc10","type":"H3","href":null,"layout":null,"metadata":null,"text":"Conclusion","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_248":{"__typename":"Paragraph","id":"e29948fdd6c_248","name":"ac22","type":"P","href":null,"layout":null,"metadata":null,"text":"The bumblebee malware is a very interesting piece of code, and to perform their objectives, the authors show a high level of creativity and innovation.\nThe interesting similarities between the Bumblebee hooking DLL and the Trickbot’s web-inject DLL raise questions and speculations. \nOn one hand, the similarities are not strong enough to deduce that the authors of Bumblebee and Trickbot are the same, on the other hand, it is not far-fetched to assume that the authors of Bumblebee have the source code of the Trickbot’s web-inject module.\nIn any case, the authors took an already proven and working code and evolve it to be less detectable to AV products, and challenging to security researchers.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_249":{"__typename":"Paragraph","id":"e29948fdd6c_249","name":"4cb4","type":"H3","href":null,"layout":null,"metadata":null,"text":"References","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_250":{"__typename":"Paragraph","id":"e29948fdd6c_250","name":"831d","type":"P","href":null,"layout":null,"metadata":null,"text":"[1] https:\u002F\u002Fblog.google\u002Fthreat-analysis-group\u002Fexposing-initial-access-broker-ties-conti\u002F","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":4,"end":88,"href":"https:\u002F\u002Fblog.google\u002Fthreat-analysis-group\u002Fexposing-initial-access-broker-ties-conti\u002F","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_251":{"__typename":"Paragraph","id":"e29948fdd6c_251","name":"d92a","type":"P","href":null,"layout":null,"metadata":null,"text":"[2] https:\u002F\u002Ftwitter.com\u002FUnit42_Intel\u002Fstatus\u002F1512146449345171459","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":4,"end":63,"href":"https:\u002F\u002Ftwitter.com\u002FUnit42_Intel\u002Fstatus\u002F1512146449345171459","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_252":{"__typename":"Paragraph","id":"e29948fdd6c_252","name":"f732","type":"P","href":null,"layout":null,"metadata":null,"text":"[3] https:\u002F\u002Fwww.cynet.com\u002Forion-threat-alert-flight-of-the-bumblebee\u002F","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":4,"end":69,"href":"https:\u002F\u002Fwww.cynet.com\u002Forion-threat-alert-flight-of-the-bumblebee\u002F","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_253":{"__typename":"Paragraph","id":"e29948fdd6c_253","name":"9bbd","type":"P","href":null,"layout":null,"metadata":null,"text":"[4] https:\u002F\u002Fgithub.com\u002Fhasherezade\u002Fpe-bear-releases","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":4,"end":51,"href":"https:\u002F\u002Fgithub.com\u002Fhasherezade\u002Fpe-bear-releases","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_254":{"__typename":"Paragraph","id":"e29948fdd6c_254","name":"04e3","type":"P","href":null,"layout":null,"metadata":null,"text":"[5] https:\u002F\u002Fyoutu.be\u002F9efJ8_ukxlY?t=2","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":4,"end":36,"href":"https:\u002F\u002Fyoutu.be\u002F9efJ8_ukxlY?t=2","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_255":{"__typename":"Paragraph","id":"e29948fdd6c_255","name":"155f","type":"P","href":null,"layout":null,"metadata":null,"text":"[6] https:\u002F\u002Fgithub.com\u002Fhasherezade\u002Fhollows_hunter","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":4,"end":49,"href":"https:\u002F\u002Fgithub.com\u002Fhasherezade\u002Fhollows_hunter","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_256":{"__typename":"Paragraph","id":"e29948fdd6c_256","name":"da31","type":"P","href":null,"layout":null,"metadata":null,"text":"[7] https:\u002F\u002Fgithub.com\u002FLordNoteworthy\u002Fal-khaser\u002Ftree\u002Fmaster\u002Fal-khaser","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":4,"end":69,"href":"https:\u002F\u002Fgithub.com\u002FLordNoteworthy\u002Fal-khaser\u002Ftree\u002Fmaster\u002Fal-khaser","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_257":{"__typename":"Paragraph","id":"e29948fdd6c_257","name":"abf1","type":"P","href":null,"layout":null,"metadata":null,"text":"[8] https:\u002F\u002Fwww.sentinelone.com\u002Flabs\u002Fhow-trickbot-malware-hooking-engine-targets-windows-10-browsers\u002F","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":4,"end":101,"href":"https:\u002F\u002Fwww.sentinelone.com\u002Flabs\u002Fhow-trickbot-malware-hooking-engine-targets-windows-10-browsers\u002F","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_258":{"__typename":"Paragraph","id":"e29948fdd6c_258","name":"be7e","type":"P","href":null,"layout":null,"metadata":null,"text":"[9] https:\u002F\u002Fblog.jscrambler.com\u002Fjscrambler-101-control-flow-flattening","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":4,"end":70,"href":"https:\u002F\u002Fblog.jscrambler.com\u002Fjscrambler-101-control-flow-flattening","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_259":{"__typename":"Paragraph","id":"e29948fdd6c_259","name":"aa12","type":"P","href":null,"layout":null,"metadata":null,"text":"[10] https:\u002F\u002Fyoutu.be\u002FSulC2l1Dvbo","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":5,"end":33,"href":"https:\u002F\u002Fyoutu.be\u002FSulC2l1Dvbo","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_260":{"__typename":"Paragraph","id":"e29948fdd6c_260","name":"6a54","type":"H3","href":null,"layout":null,"metadata":null,"text":"IOC","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_261":{"__typename":"Paragraph","id":"e29948fdd6c_261","name":"0dad","type":"P","href":null,"layout":null,"metadata":null,"text":"bumblebee_dropper: 4a35fa2f0903f7ba73ac21564a5a0e2a25374e10","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_262":{"__typename":"Paragraph","id":"e29948fdd6c_262","name":"5fa9","type":"P","href":null,"layout":null,"metadata":null,"text":"bumblebee_malware: 5dbb3bbc57653c348be7778628ed0ef11ffef35d","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_263":{"__typename":"Paragraph","id":"e29948fdd6c_263","name":"42ca","type":"P","href":null,"layout":null,"metadata":null,"text":"bumblebee_rapportgp: 5c8f7465ba67138e58d3ca61e4346e31c2b799d8","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:e29948fdd6c_264":{"__typename":"Paragraph","id":"e29948fdd6c_264","name":"fdb7","type":"P","href":null,"layout":null,"metadata":null,"text":"Trickbot web-inject module: 0785D0C5600D9C096B75CC4465BE79D456F60594","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"PostViewerEdge:postId:686379311056-viewerId:lo_59cbcb99d9c4":{"__typename":"PostViewerEdge","shouldIndexPostForExternalSearch":true,"id":"postId:686379311056-viewerId:lo_59cbcb99d9c4"},"Post:686379311056":{"__typename":"Post","id":"686379311056","collection":null,"content({\"postMeteringOptions\":{}})":{"__typename":"PostContent","isLockedPreviewOnly":false,"bodyModel":{"__typename":"RichText","sections":[{"__typename":"Section","name":"ed3a","startIndex":0,"textLayout":null,"imageLayout":null,"backgroundImage":null,"videoLayout":null,"backgroundVideo":null}],"paragraphs":[{"__ref":"Paragraph:e29948fdd6c_0"},{"__ref":"Paragraph:e29948fdd6c_1"},{"__ref":"Paragraph:e29948fdd6c_2"},{"__ref":"Paragraph:e29948fdd6c_3"},{"__ref":"Paragraph:e29948fdd6c_4"},{"__ref":"Paragraph:e29948fdd6c_5"},{"__ref":"Paragraph:e29948fdd6c_6"},{"__ref":"Paragraph:e29948fdd6c_7"},{"__ref":"Paragraph:e29948fdd6c_8"},{"__ref":"Paragraph:e29948fdd6c_9"},{"__ref":"Paragraph:e29948fdd6c_10"},{"__ref":"Paragraph:e29948fdd6c_11"},{"__ref":"Paragraph:e29948fdd6c_12"},{"__ref":"Paragraph:e29948fdd6c_13"},{"__ref":"Paragraph:e29948fdd6c_14"},{"__ref":"Paragraph:e29948fdd6c_15"},{"__ref":"Paragraph:e29948fdd6c_16"},{"__ref":"Paragraph:e29948fdd6c_17"},{"__ref":"Paragraph:e29948fdd6c_18"},{"__ref":"Paragraph:e29948fdd6c_19"},{"__ref":"Paragraph:e29948fdd6c_20"},{"__ref":"Paragraph:e29948fdd6c_21"},{"__ref":"Paragraph:e29948fdd6c_22"},{"__ref":"Paragraph:e29948fdd6c_23"},{"__ref":"Paragraph:e29948fdd6c_24"},{"__ref":"Paragraph:e29948fdd6c_25"},{"__ref":"Paragraph:e29948fdd6c_26"},{"__ref":"Paragraph:e29948fdd6c_27"},{"__ref":"Paragraph:e29948fdd6c_28"},{"__ref":"Paragraph:e29948fdd6c_29"},{"__ref":"Paragraph:e29948fdd6c_30"},{"__ref":"Paragraph:e29948fdd6c_31"},{"__ref":"Paragraph:e29948fdd6c_32"},{"__ref":"Paragraph:e29948fdd6c_33"},{"__ref":"Paragraph:e29948fdd6c_34"},{"__ref":"Paragraph:e29948fdd6c_35"},{"__ref":"Paragraph:e29948fdd6c_36"},{"__ref":"Paragraph:e29948fdd6c_37"},{"__ref":"Paragraph:e29948fdd6c_38"},{"__ref":"Paragraph:e29948fdd6c_39"},{"__ref":"Paragraph:e29948fdd6c_40"},{"__ref":"Paragraph:e29948fdd6c_41"},{"__ref":"Paragraph:e29948fdd6c_42"},{"__ref":"Paragraph:e29948fdd6c_43"},{"__ref":"Paragraph:e29948fdd6c_44"},{"__ref":"Paragraph:e29948fdd6c_45"},{"__ref":"Paragraph:e29948fdd6c_46"},{"__ref":"Paragraph:e29948fdd6c_47"},{"__ref":"Paragraph:e29948fdd6c_48"},{"__ref":"Paragraph:e29948fdd6c_49"},{"__ref":"Paragraph:e29948fdd6c_50"},{"__ref":"Paragraph:e29948fdd6c_51"},{"__ref":"Paragraph:e29948fdd6c_52"},{"__ref":"Paragraph:e29948fdd6c_53"},{"__ref":"Paragraph:e29948fdd6c_54"},{"__ref":"Paragraph:e29948fdd6c_55"},{"__ref":"Paragraph:e29948fdd6c_56"},{"__ref":"Paragraph:e29948fdd6c_57"},{"__ref":"Paragraph:e29948fdd6c_58"},{"__ref":"Paragraph:e29948fdd6c_59"},{"__ref":"Paragraph:e29948fdd6c_60"},{"__ref":"Paragraph:e29948fdd6c_61"},{"__ref":"Paragraph:e29948fdd6c_62"},{"__ref":"Paragraph:e29948fdd6c_63"},{"__ref":"Paragraph:e29948fdd6c_64"},{"__ref":"Paragraph:e29948fdd6c_65"},{"__ref":"Paragraph:e29948fdd6c_66"},{"__ref":"Paragraph:e29948fdd6c_67"},{"__ref":"Paragraph:e29948fdd6c_68"},{"__ref":"Paragraph:e29948fdd6c_69"},{"__ref":"Paragraph:e29948fdd6c_70"},{"__ref":"Paragraph:e29948fdd6c_71"},{"__ref":"Paragraph:e29948fdd6c_72"},{"__ref":"Paragraph:e29948fdd6c_73"},{"__ref":"Paragraph:e29948fdd6c_74"},{"__ref":"Paragraph:e29948fdd6c_75"},{"__ref":"Paragraph:e29948fdd6c_76"},{"__ref":"Paragraph:e29948fdd6c_77"},{"__ref":"Paragraph:e29948fdd6c_78"},{"__ref":"Paragraph:e29948fdd6c_79"},{"__ref":"Paragraph:e29948fdd6c_80"},{"__ref":"Paragraph:e29948fdd6c_81"},{"__ref":"Paragraph:e29948fdd6c_82"},{"__ref":"Paragraph:e29948fdd6c_83"},{"__ref":"Paragraph:e29948fdd6c_84"},{"__ref":"Paragraph:e29948fdd6c_85"},{"__ref":"Paragraph:e29948fdd6c_86"},{"__ref":"Paragraph:e29948fdd6c_87"},{"__ref":"Paragraph:e29948fdd6c_88"},{"__ref":"Paragraph:e29948fdd6c_89"},{"__ref":"Paragraph:e29948fdd6c_90"},{"__ref":"Paragraph:e29948fdd6c_91"},{"__ref":"Paragraph:e29948fdd6c_92"},{"__ref":"Paragraph:e29948fdd6c_93"},{"__ref":"Paragraph:e29948fdd6c_94"},{"__ref":"Paragraph:e29948fdd6c_95"},{"__ref":"Paragraph:e29948fdd6c_96"},{"__ref":"Paragraph:e29948fdd6c_97"},{"__ref":"Paragraph:e29948fdd6c_98"},{"__ref":"Paragraph:e29948fdd6c_99"},{"__ref":"Paragraph:e29948fdd6c_100"},{"__ref":"Paragraph:e29948fdd6c_101"},{"__ref":"Paragraph:e29948fdd6c_102"},{"__ref":"Paragraph:e29948fdd6c_103"},{"__ref":"Paragraph:e29948fdd6c_104"},{"__ref":"Paragraph:e29948fdd6c_105"},{"__ref":"Paragraph:e29948fdd6c_106"},{"__ref":"Paragraph:e29948fdd6c_107"},{"__ref":"Paragraph:e29948fdd6c_108"},{"__ref":"Paragraph:e29948fdd6c_109"},{"__ref":"Paragraph:e29948fdd6c_110"},{"__ref":"Paragraph:e29948fdd6c_111"},{"__ref":"Paragraph:e29948fdd6c_112"},{"__ref":"Paragraph:e29948fdd6c_113"},{"__ref":"Paragraph:e29948fdd6c_114"},{"__ref":"Paragraph:e29948fdd6c_115"},{"__ref":"Paragraph:e29948fdd6c_116"},{"__ref":"Paragraph:e29948fdd6c_117"},{"__ref":"Paragraph:e29948fdd6c_118"},{"__ref":"Paragraph:e29948fdd6c_119"},{"__ref":"Paragraph:e29948fdd6c_120"},{"__ref":"Paragraph:e29948fdd6c_121"},{"__ref":"Paragraph:e29948fdd6c_122"},{"__ref":"Paragraph:e29948fdd6c_123"},{"__ref":"Paragraph:e29948fdd6c_124"},{"__ref":"Paragraph:e29948fdd6c_125"},{"__ref":"Paragraph:e29948fdd6c_126"},{"__ref":"Paragraph:e29948fdd6c_127"},{"__ref":"Paragraph:e29948fdd6c_128"},{"__ref":"Paragraph:e29948fdd6c_129"},{"__ref":"Paragraph:e29948fdd6c_130"},{"__ref":"Paragraph:e29948fdd6c_131"},{"__ref":"Paragraph:e29948fdd6c_132"},{"__ref":"Paragraph:e29948fdd6c_133"},{"__ref":"Paragraph:e29948fdd6c_134"},{"__ref":"Paragraph:e29948fdd6c_135"},{"__ref":"Paragraph:e29948fdd6c_136"},{"__ref":"Paragraph:e29948fdd6c_137"},{"__ref":"Paragraph:e29948fdd6c_138"},{"__ref":"Paragraph:e29948fdd6c_139"},{"__ref":"Paragraph:e29948fdd6c_140"},{"__ref":"Paragraph:e29948fdd6c_141"},{"__ref":"Paragraph:e29948fdd6c_142"},{"__ref":"Paragraph:e29948fdd6c_143"},{"__ref":"Paragraph:e29948fdd6c_144"},{"__ref":"Paragraph:e29948fdd6c_145"},{"__ref":"Paragraph:e29948fdd6c_146"},{"__ref":"Paragraph:e29948fdd6c_147"},{"__ref":"Paragraph:e29948fdd6c_148"},{"__ref":"Paragraph:e29948fdd6c_149"},{"__ref":"Paragraph:e29948fdd6c_150"},{"__ref":"Paragraph:e29948fdd6c_151"},{"__ref":"Paragraph:e29948fdd6c_152"},{"__ref":"Paragraph:e29948fdd6c_153"},{"__ref":"Paragraph:e29948fdd6c_154"},{"__ref":"Paragraph:e29948fdd6c_155"},{"__ref":"Paragraph:e29948fdd6c_156"},{"__ref":"Paragraph:e29948fdd6c_157"},{"__ref":"Paragraph:e29948fdd6c_158"},{"__ref":"Paragraph:e29948fdd6c_159"},{"__ref":"Paragraph:e29948fdd6c_160"},{"__ref":"Paragraph:e29948fdd6c_161"},{"__ref":"Paragraph:e29948fdd6c_162"},{"__ref":"Paragraph:e29948fdd6c_163"},{"__ref":"Paragraph:e29948fdd6c_164"},{"__ref":"Paragraph:e29948fdd6c_165"},{"__ref":"Paragraph:e29948fdd6c_166"},{"__ref":"Paragraph:e29948fdd6c_167"},{"__ref":"Paragraph:e29948fdd6c_168"},{"__ref":"Paragraph:e29948fdd6c_169"},{"__ref":"Paragraph:e29948fdd6c_170"},{"__ref":"Paragraph:e29948fdd6c_171"},{"__ref":"Paragraph:e29948fdd6c_172"},{"__ref":"Paragraph:e29948fdd6c_173"},{"__ref":"Paragraph:e29948fdd6c_174"},{"__ref":"Paragraph:e29948fdd6c_175"},{"__ref":"Paragraph:e29948fdd6c_176"},{"__ref":"Paragraph:e29948fdd6c_177"},{"__ref":"Paragraph:e29948fdd6c_178"},{"__ref":"Paragraph:e29948fdd6c_179"},{"__ref":"Paragraph:e29948fdd6c_180"},{"__ref":"Paragraph:e29948fdd6c_181"},{"__ref":"Paragraph:e29948fdd6c_182"},{"__ref":"Paragraph:e29948fdd6c_183"},{"__ref":"Paragraph:e29948fdd6c_184"},{"__ref":"Paragraph:e29948fdd6c_185"},{"__ref":"Paragraph:e29948fdd6c_186"},{"__ref":"Paragraph:e29948fdd6c_187"},{"__ref":"Paragraph:e29948fdd6c_188"},{"__ref":"Paragraph:e29948fdd6c_189"},{"__ref":"Paragraph:e29948fdd6c_190"},{"__ref":"Paragraph:e29948fdd6c_191"},{"__ref":"Paragraph:e29948fdd6c_192"},{"__ref":"Paragraph:e29948fdd6c_193"},{"__ref":"Paragraph:e29948fdd6c_194"},{"__ref":"Paragraph:e29948fdd6c_195"},{"__ref":"Paragraph:e29948fdd6c_196"},{"__ref":"Paragraph:e29948fdd6c_197"},{"__ref":"Paragraph:e29948fdd6c_198"},{"__ref":"Paragraph:e29948fdd6c_199"},{"__ref":"Paragraph:e29948fdd6c_200"},{"__ref":"Paragraph:e29948fdd6c_201"},{"__ref":"Paragraph:e29948fdd6c_202"},{"__ref":"Paragraph:e29948fdd6c_203"},{"__ref":"Paragraph:e29948fdd6c_204"},{"__ref":"Paragraph:e29948fdd6c_205"},{"__ref":"Paragraph:e29948fdd6c_206"},{"__ref":"Paragraph:e29948fdd6c_207"},{"__ref":"Paragraph:e29948fdd6c_208"},{"__ref":"Paragraph:e29948fdd6c_209"},{"__ref":"Paragraph:e29948fdd6c_210"},{"__ref":"Paragraph:e29948fdd6c_211"},{"__ref":"Paragraph:e29948fdd6c_212"},{"__ref":"Paragraph:e29948fdd6c_213"},{"__ref":"Paragraph:e29948fdd6c_214"},{"__ref":"Paragraph:e29948fdd6c_215"},{"__ref":"Paragraph:e29948fdd6c_216"},{"__ref":"Paragraph:e29948fdd6c_217"},{"__ref":"Paragraph:e29948fdd6c_218"},{"__ref":"Paragraph:e29948fdd6c_219"},{"__ref":"Paragraph:e29948fdd6c_220"},{"__ref":"Paragraph:e29948fdd6c_221"},{"__ref":"Paragraph:e29948fdd6c_222"},{"__ref":"Paragraph:e29948fdd6c_223"},{"__ref":"Paragraph:e29948fdd6c_224"},{"__ref":"Paragraph:e29948fdd6c_225"},{"__ref":"Paragraph:e29948fdd6c_226"},{"__ref":"Paragraph:e29948fdd6c_227"},{"__ref":"Paragraph:e29948fdd6c_228"},{"__ref":"Paragraph:e29948fdd6c_229"},{"__ref":"Paragraph:e29948fdd6c_230"},{"__ref":"Paragraph:e29948fdd6c_231"},{"__ref":"Paragraph:e29948fdd6c_232"},{"__ref":"Paragraph:e29948fdd6c_233"},{"__ref":"Paragraph:e29948fdd6c_234"},{"__ref":"Paragraph:e29948fdd6c_235"},{"__ref":"Paragraph:e29948fdd6c_236"},{"__ref":"Paragraph:e29948fdd6c_237"},{"__ref":"Paragraph:e29948fdd6c_238"},{"__ref":"Paragraph:e29948fdd6c_239"},{"__ref":"Paragraph:e29948fdd6c_240"},{"__ref":"Paragraph:e29948fdd6c_241"},{"__ref":"Paragraph:e29948fdd6c_242"},{"__ref":"Paragraph:e29948fdd6c_243"},{"__ref":"Paragraph:e29948fdd6c_244"},{"__ref":"Paragraph:e29948fdd6c_245"},{"__ref":"Paragraph:e29948fdd6c_246"},{"__ref":"Paragraph:e29948fdd6c_247"},{"__ref":"Paragraph:e29948fdd6c_248"},{"__ref":"Paragraph:e29948fdd6c_249"},{"__ref":"Paragraph:e29948fdd6c_250"},{"__ref":"Paragraph:e29948fdd6c_251"},{"__ref":"Paragraph:e29948fdd6c_252"},{"__ref":"Paragraph:e29948fdd6c_253"},{"__ref":"Paragraph:e29948fdd6c_254"},{"__ref":"Paragraph:e29948fdd6c_255"},{"__ref":"Paragraph:e29948fdd6c_256"},{"__ref":"Paragraph:e29948fdd6c_257"},{"__ref":"Paragraph:e29948fdd6c_258"},{"__ref":"Paragraph:e29948fdd6c_259"},{"__ref":"Paragraph:e29948fdd6c_260"},{"__ref":"Paragraph:e29948fdd6c_261"},{"__ref":"Paragraph:e29948fdd6c_262"},{"__ref":"Paragraph:e29948fdd6c_263"},{"__ref":"Paragraph:e29948fdd6c_264"}]},"validatedShareKey":"","shareKeyCreator":null},"creator":{"__ref":"User:f375cbce3f63"},"inResponseToEntityType":null,"isLocked":false,"isMarkedPaywallOnly":false,"lockedSource":"LOCKED_POST_SOURCE_NONE","mediumUrl":"https:\u002F\u002Felis531989.medium.com\u002Fthe-chronicles-of-bumblebee-the-hook-the-bee-and-the-trickbot-connection-686379311056","primaryTopic":{"__ref":"Topic:d4e7f4144ac5"},"topics":[{"__typename":"Topic","slug":"cybersecurity"}],"isPublished":true,"latestPublishedVersion":"e29948fdd6c","visibility":"PUBLIC","postResponses":{"__typename":"PostResponses","count":0},"clapCount":13,"allowResponses":true,"isLimitedState":false,"title":"The chronicles of Bumblebee: The Hook, the Bee, and the Trickbot connection","isSeries":false,"sequence":null,"uniqueSlug":"the-chronicles-of-bumblebee-the-hook-the-bee-and-the-trickbot-connection-686379311056","socialTitle":"","socialDek":"","canonicalUrl":"","metaDescription":"","latestPublishedAt":1651040967963,"readingTime":16.474528301886792,"previewContent":{"__typename":"PreviewContent","subtitle":"In late March 2022, a new malware dubbed “Bumblebee” was discovered, and reported to be distributed in phishing campaigns containing ISO…"},"previewImage":{"__ref":"ImageMetadata:1*LglRPWDxARM11kMkI0pTqw.png"},"isShortform":false,"seoTitle":"","firstPublishedAt":1651040967963,"updatedAt":1651284961022,"shortformType":"SHORTFORM_TYPE_LINK","seoDescription":"","viewerEdge":{"__ref":"PostViewerEdge:postId:686379311056-viewerId:lo_59cbcb99d9c4"},"isSuspended":false,"license":"ALL_RIGHTS_RESERVED","tags":[],"isNewsletter":false,"statusForCollection":null,"pendingCollection":null,"detectedLanguage":"en","wordCount":3266,"layerCake":3}}</script><script>window.__MIDDLEWARE_STATE__={"session":{"xsrf":""},"cache":{"cacheStatus":"HIT"}}</script><script src="https://cdn-client.medium.com/lite/static/js/manifest.7e50e797.js"></script><script src="https://cdn-client.medium.com/lite/static/js/9865.1496d74a.js"></script><script src="https://cdn-client.medium.com/lite/static/js/main.018e7ca9.js"></script><script src="https://cdn-client.medium.com/lite/static/js/instrumentation.d9108df7.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/reporting.ff22a7a5.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/5049.d1ead72d.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/4810.6318add7.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/6618.db187378.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/1386.6a7a21a1.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/9977.84e4bd5c.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/719.ae4dd3e0.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/5250.9f9e01d2.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/6349.b071a958.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/2648.26563adf.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/8393.826a25fb.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/1443.598cb8b2.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/3735.8c38ede2.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/5642.d10c9ba0.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/6546.cd03f950.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/6834.08de95de.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/1781.db373833.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/2420.0330d157.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/839.ca7937c2.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/7975.d195c6f1.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/2106.21ff89d3.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/7394.55c925ce.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/2961.00a48598.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/230.4d7a2738.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/4391.59acaed3.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/PostPage.MainContent.563d0db5.chunk.js"></script><script>window.main();</script><script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'8d7627ef5813cb60',t:'MTcyOTczMjk0OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body></html>