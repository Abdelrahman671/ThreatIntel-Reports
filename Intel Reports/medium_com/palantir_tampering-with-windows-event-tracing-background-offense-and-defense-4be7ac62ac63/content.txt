<!doctype html><html lang="en"><head><title data-rh="true">Tampering with Windows Event Tracing: Background, Offense, and Defense | by Palantir | Palantir Blog</title><meta data-rh="true" charset="utf-8"/><meta data-rh="true" name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1,maximum-scale=1"/><meta data-rh="true" name="theme-color" content="#000000"/><meta data-rh="true" name="twitter:app:name:iphone" content="Medium"/><meta data-rh="true" name="twitter:app:id:iphone" content="828256236"/><meta data-rh="true" property="al:ios:app_name" content="Medium"/><meta data-rh="true" property="al:ios:app_store_id" content="828256236"/><meta data-rh="true" property="al:android:package" content="com.medium.reader"/><meta data-rh="true" property="fb:app_id" content="542599432471018"/><meta data-rh="true" property="og:site_name" content="Medium"/><meta data-rh="true" property="og:type" content="article"/><meta data-rh="true" property="article:published_time" content="2019-02-28T00:49:16.122Z"/><meta data-rh="true" name="title" content="Tampering with Windows Event Tracing: Background, Offense, and Defense | by Palantir | Palantir Blog"/><meta data-rh="true" property="og:title" content="Tampering with Windows Event Tracing: Background, Offense, and Defense"/><meta data-rh="true" property="al:android:url" content="medium://p/4be7ac62ac63"/><meta data-rh="true" property="al:ios:url" content="medium://p/4be7ac62ac63"/><meta data-rh="true" property="al:android:app_name" content="Medium"/><meta data-rh="true" name="description" content="Event Tracing for Windows (ETW) is the mechanism Windows uses to trace and log system events. Attackers often clear event logs to cover their tracks. Though the act of clearing an event log itself…"/><meta data-rh="true" property="og:description" content="Event Tracing for Windows (ETW) is the mechanism Windows uses to trace and log system events. Attackers often clear event logs to cover…"/><meta data-rh="true" property="og:url" content="https://blog.palantir.com/tampering-with-windows-event-tracing-background-offense-and-defense-4be7ac62ac63"/><meta data-rh="true" property="al:web:url" content="https://blog.palantir.com/tampering-with-windows-event-tracing-background-offense-and-defense-4be7ac62ac63"/><meta data-rh="true" property="og:image" content="https://miro.medium.com/v2/resize:fit:1200/1*SMDAeNCTr6vY7N8oTjneiA.png"/><meta data-rh="true" property="article:author" content="https://palantir.medium.com"/><meta data-rh="true" name="author" content="Palantir"/><meta data-rh="true" name="robots" content="index,noarchive,follow,max-image-preview:large"/><meta data-rh="true" name="referrer" content="unsafe-url"/><meta data-rh="true" property="twitter:title" content="Tampering with Windows Event Tracing: Background, Offense, and Defense"/><meta data-rh="true" name="twitter:site" content="@palantirtech"/><meta data-rh="true" name="twitter:app:url:iphone" content="medium://p/4be7ac62ac63"/><meta data-rh="true" property="twitter:description" content="Event Tracing for Windows (ETW) is the mechanism Windows uses to trace and log system events. Attackers often clear event logs to cover…"/><meta data-rh="true" name="twitter:image:src" content="https://miro.medium.com/v2/resize:fit:1200/1*SMDAeNCTr6vY7N8oTjneiA.png"/><meta data-rh="true" name="twitter:card" content="summary_large_image"/><meta data-rh="true" name="twitter:label1" content="Reading time"/><meta data-rh="true" name="twitter:data1" content="13 min read"/><link data-rh="true" rel="icon" href="https://miro.medium.com/v2/5d8de952517e8160e40ef9841c781cdc14a5db313057fa3c3de41c6f5b494b19"/><link data-rh="true" rel="search" type="application/opensearchdescription+xml" title="Medium" href="/osd.xml"/><link data-rh="true" rel="apple-touch-icon" sizes="152x152" href="https://miro.medium.com/v2/resize:fill:304:304/10fd5c419ac61637245384e7099e131627900034828f4f386bdaa47a74eae156"/><link data-rh="true" rel="apple-touch-icon" sizes="120x120" href="https://miro.medium.com/v2/resize:fill:240:240/10fd5c419ac61637245384e7099e131627900034828f4f386bdaa47a74eae156"/><link data-rh="true" rel="apple-touch-icon" sizes="76x76" href="https://miro.medium.com/v2/resize:fill:152:152/10fd5c419ac61637245384e7099e131627900034828f4f386bdaa47a74eae156"/><link data-rh="true" rel="apple-touch-icon" sizes="60x60" href="https://miro.medium.com/v2/resize:fill:120:120/10fd5c419ac61637245384e7099e131627900034828f4f386bdaa47a74eae156"/><link data-rh="true" rel="mask-icon" href="https://miro.medium.com/v2/resize:fill:1000:1000/7*GAOKVe--MXbEJmV9230oOQ.png" color="#171717"/><link data-rh="true" id="glyph_preload_link" rel="preload" as="style" type="text/css" href="https://glyph.medium.com/css/unbound.css"/><link data-rh="true" id="glyph_link" rel="stylesheet" type="text/css" href="https://glyph.medium.com/css/unbound.css"/><link data-rh="true" rel="author" href="https://palantir.medium.com"/><link data-rh="true" rel="canonical" href="https://blog.palantir.com/tampering-with-windows-event-tracing-background-offense-and-defense-4be7ac62ac63"/><link data-rh="true" rel="alternate" href="android-app://com.medium.reader/https/medium.com/p/4be7ac62ac63"/><script data-rh="true" type="application/ld+json">{"@context":"http:\u002F\u002Fschema.org","@type":"NewsArticle","image":["https:\u002F\u002Fmiro.medium.com\u002Fv2\u002Fresize:fit:1200\u002F1*SMDAeNCTr6vY7N8oTjneiA.png"],"url":"https:\u002F\u002Fblog.palantir.com\u002Ftampering-with-windows-event-tracing-background-offense-and-defense-4be7ac62ac63","dateCreated":"2018-12-24T10:31:42.941Z","datePublished":"2018-12-24T10:31:42.941Z","dateModified":"2021-12-07T03:07:31.072Z","headline":"Tampering with Windows Event Tracing: Background, Offense, and Defense","name":"Tampering with Windows Event Tracing: Background, Offense, and Defense","description":"Event Tracing for Windows (ETW) is the mechanism Windows uses to trace and log system events. Attackers often clear event logs to cover their tracks. Though the act of clearing an event log itself…","identifier":"4be7ac62ac63","author":{"@type":"Person","name":"Palantir","url":"https:\u002F\u002Fpalantir.medium.com"},"creator":["Palantir"],"publisher":{"@type":"Organization","name":"Palantir Blog","url":"blog.palantir.com","logo":{"@type":"ImageObject","width":272,"height":60,"url":"https:\u002F\u002Fmiro.medium.com\u002Fv2\u002Fresize:fit:544\u002F7*V1_7XP4snlmqrc_0Njontw.png"}},"mainEntityOfPage":"https:\u002F\u002Fblog.palantir.com\u002Ftampering-with-windows-event-tracing-background-offense-and-defense-4be7ac62ac63"}</script><style type="text/css" data-fela-rehydration="563" data-fela-type="STATIC">html{box-sizing:border-box;-webkit-text-size-adjust:100%}*, *:before, *:after{box-sizing:inherit}body{margin:0;padding:0;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;color:rgba(0,0,0,0.8);position:relative;min-height:100vh}h1, h2, h3, h4, h5, h6, dl, dd, ol, ul, menu, figure, blockquote, p, pre, form{margin:0}menu, ol, ul{padding:0;list-style:none;list-style-image:none}main{display:block}a{color:inherit;text-decoration:none}a, button, input{-webkit-tap-highlight-color:transparent}img, svg{vertical-align:middle}button{background:transparent;overflow:visible}button, input, optgroup, select, textarea{margin:0}:root{--reach-tabs:1;--reach-menu-button:1}#speechify-root{font-family:Sohne, sans-serif}div[data-popper-reference-hidden="true"]{visibility:hidden;pointer-events:none}.grecaptcha-badge{visibility:hidden}
/*XCode style (c) Angel Garcia <angelgarcia.mail@gmail.com>*/.hljs {background: #fff;color: black;
}/* Gray DOCTYPE selectors like WebKit */
.xml .hljs-meta {color: #c0c0c0;
}.hljs-comment,
.hljs-quote {color: #007400;
}.hljs-tag,
.hljs-attribute,
.hljs-keyword,
.hljs-selector-tag,
.hljs-literal,
.hljs-name {color: #aa0d91;
}.hljs-variable,
.hljs-template-variable {color: #3F6E74;
}.hljs-code,
.hljs-string,
.hljs-meta .hljs-string {color: #c41a16;
}.hljs-regexp,
.hljs-link {color: #0E0EFF;
}.hljs-title,
.hljs-symbol,
.hljs-bullet,
.hljs-number {color: #1c00cf;
}.hljs-section,
.hljs-meta {color: #643820;
}.hljs-title.class_,
.hljs-class .hljs-title,
.hljs-type,
.hljs-built_in,
.hljs-params {color: #5c2699;
}.hljs-attr {color: #836C28;
}.hljs-subst {color: #000;
}.hljs-formula {background-color: #eee;font-style: italic;
}.hljs-addition {background-color: #baeeba;
}.hljs-deletion {background-color: #ffc8bd;
}.hljs-selector-id,
.hljs-selector-class {color: #9b703f;
}.hljs-doctag,
.hljs-strong {font-weight: bold;
}.hljs-emphasis {font-style: italic;
}
</style><style type="text/css" data-fela-rehydration="563" data-fela-type="KEYFRAME">@-webkit-keyframes k1{0%{opacity:0.8}50%{opacity:0.5}100%{opacity:0.8}}@-moz-keyframes k1{0%{opacity:0.8}50%{opacity:0.5}100%{opacity:0.8}}@keyframes k1{0%{opacity:0.8}50%{opacity:0.5}100%{opacity:0.8}}</style><style type="text/css" data-fela-rehydration="563" data-fela-type="RULE">.a{font-family:medium-content-sans-serif-font, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif}.b{font-weight:400}.c{background-color:rgba(255, 255, 255, 1)}.l{display:block}.m{position:sticky}.n{top:0}.o{z-index:500}.p{padding:0 24px}.q{align-items:center}.r{border-bottom:solid 1px #F2F2F2}.y{height:41px}.z{line-height:20px}.ab{display:flex}.ac{height:57px}.ae{flex:1 0 auto}.af{color:inherit}.ag{fill:inherit}.ah{font-size:inherit}.ai{border:inherit}.aj{font-family:inherit}.ak{letter-spacing:inherit}.al{font-weight:inherit}.am{padding:0}.an{margin:0}.ao{cursor:pointer}.ap:disabled{cursor:not-allowed}.aq:disabled{color:#6B6B6B}.ar:disabled{fill:#6B6B6B}.au{width:auto}.av path{fill:#242424}.aw{height:25px}.ax{margin-left:16px}.ay{border:none}.az{border-radius:20px}.ba{width:240px}.bb{background:#F9F9F9}.bc path{fill:#6B6B6B}.be{outline:none}.bf{font-family:sohne, "Helvetica Neue", Helvetica, Arial, sans-serif}.bg{font-size:14px}.bh{width:100%}.bi{padding:10px 20px 10px 0}.bj{background-color:transparent}.bk{color:#242424}.bl::placeholder{color:#6B6B6B}.bm{display:inline-block}.bn{margin-left:12px}.bo{margin-right:12px}.bp{border-radius:4px}.bq{margin-left:24px}.br{height:24px}.bx{background-color:#F9F9F9}.by{border-radius:50%}.bz{height:32px}.ca{width:32px}.cb{justify-content:center}.ch{max-width:680px}.ci{min-width:0}.cj{animation:k1 1.2s ease-in-out infinite}.ck{height:100vh}.cl{margin-bottom:16px}.cm{margin-top:48px}.cn{align-items:flex-start}.co{flex-direction:column}.cp{justify-content:space-between}.cq{margin-bottom:24px}.cw{width:80%}.cx{background-color:#F2F2F2}.dd{height:44px}.de{width:44px}.df{margin:auto 0}.dg{margin-bottom:4px}.dh{height:16px}.di{width:120px}.dj{width:80px}.dp{margin-bottom:8px}.dq{width:96%}.dr{width:98%}.ds{width:81%}.dt{margin-left:8px}.du{color:#6B6B6B}.dv{font-size:13px}.dw{height:100%}.ep{color:#FFFFFF}.eq{fill:#FFFFFF}.er{background:rgba(26, 137, 23, 1)}.es{border-color:rgba(26, 137, 23, 1)}.ew:disabled{cursor:inherit !important}.ex:disabled{opacity:0.3}.ey:disabled:hover{background:rgba(26, 137, 23, 1)}.ez:disabled:hover{border-color:rgba(26, 137, 23, 1)}.fa{border-radius:99em}.fb{border-width:1px}.fc{border-style:solid}.fd{box-sizing:border-box}.fe{text-decoration:none}.ff{text-align:center}.fi{margin-right:32px}.fj{position:relative}.fk{fill:#6B6B6B}.fn{background:transparent}.fo svg{margin-left:4px}.fp svg{fill:#6B6B6B}.fr{box-shadow:inset 0 0 0 1px rgba(0, 0, 0, 0.05)}.fs{position:absolute}.fz{margin:0 24px}.gd{background:rgba(255, 255, 255, 1)}.ge{border:1px solid #F2F2F2}.gf{box-shadow:0 1px 4px #F2F2F2}.gg{max-height:100vh}.gh{overflow-y:auto}.gi{left:0}.gj{top:calc(100vh + 100px)}.gk{bottom:calc(100vh + 100px)}.gl{width:10px}.gm{pointer-events:none}.gn{word-break:break-word}.go{word-wrap:break-word}.gp:after{display:block}.gq:after{content:""}.gr:after{clear:both}.gs{line-height:1.23}.gt{letter-spacing:0}.gu{font-style:normal}.gv{font-weight:700}.ia{align-items:baseline}.ib{width:48px}.ic{height:48px}.id{border:2px solid rgba(255, 255, 255, 1)}.ie{z-index:0}.if{box-shadow:none}.ig{border:1px solid rgba(0, 0, 0, 0.05)}.ih{margin-left:-12px}.ii{width:28px}.ij{height:28px}.ik{z-index:1}.il{width:24px}.im{margin-bottom:2px}.in{flex-wrap:nowrap}.io{font-size:16px}.ip{line-height:24px}.ir{margin:0 8px}.is{display:inline}.it{color:rgba(26, 137, 23, 1)}.iu{fill:rgba(26, 137, 23, 1)}.ix{flex:0 0 auto}.ja{flex-wrap:wrap}.jd{white-space:pre-wrap}.je{margin-right:4px}.jf{overflow:hidden}.jg{max-height:20px}.jh{text-overflow:ellipsis}.ji{display:-webkit-box}.jj{-webkit-line-clamp:1}.jk{-webkit-box-orient:vertical}.jl{word-break:break-all}.jn{padding-left:8px}.jo{padding-right:8px}.kp> *{flex-shrink:0}.kq{overflow-x:scroll}.kr::-webkit-scrollbar{display:none}.ks{scrollbar-width:none}.kt{-ms-overflow-style:none}.ku{width:74px}.kv{flex-direction:row}.kw{z-index:2}.kz{-webkit-user-select:none}.la{border:0}.lb{fill:rgba(117, 117, 117, 1)}.le{outline:0}.lf{user-select:none}.lg> svg{pointer-events:none}.lp{cursor:progress}.lq{margin-left:4px}.lr{margin-top:0px}.ls{opacity:1}.lt{padding:4px 0}.lw{width:16px}.ly{display:inline-flex}.me{max-width:100%}.mf{padding:8px 2px}.mg svg{color:#6B6B6B}.mx{margin-left:auto}.my{margin-right:auto}.mz{max-width:2262px}.nf{clear:both}.nh{cursor:zoom-in}.ni{z-index:auto}.nk{height:auto}.nl{line-height:1.58}.nm{letter-spacing:-0.004em}.nn{font-family:source-serif-pro, Georgia, Cambria, "Times New Roman", Times, serif}.oi{margin-bottom:-0.46em}.oj{text-decoration:underline}.ok{line-height:1.12}.ol{letter-spacing:-0.022em}.om{font-weight:600}.ph{margin-bottom:-0.28em}.pn{font-style:italic}.po{padding:2px 4px}.pp{font-size:75%}.pq> strong{font-family:inherit}.pr{font-family:source-code-pro, Menlo, Monaco, "Courier New", Courier, monospace}.ps{line-height:1.18}.qg{margin-bottom:-0.31em}.qm{overflow-x:auto}.qn{padding:20px}.qo{border-radius:0}.qp{background:#F2F2F2}.qq{margin-top:-0.09em}.qr{margin-bottom:-0.09em}.qs{min-width:fit-content}.qt{margin-top:0.91em}.qu{list-style-type:disc}.qv{margin-left:30px}.qw{padding-left:0px}.rc{max-width:624px}.rd{margin:auto}.re{padding-bottom:100%}.rf{height:0}.rg{margin-top:10px}.rh{max-width:728px}.rk{max-width:582px}.rl{max-width:458px}.rm{list-style-type:decimal}.rn{max-width:534px}.ro{margin-top:32px}.rp{margin-bottom:14px}.rq{padding-top:24px}.rr{padding-bottom:10px}.rs{background-color:#000000}.rt{height:3px}.ru{width:3px}.rv{margin-right:20px}.sb{margin-bottom:26px}.sc{margin-top:6px}.sd{margin-top:8px}.se{margin-right:8px}.sf{padding:8px 16px}.sg{border-radius:100px}.sh{transition:background 300ms ease}.sj{white-space:nowrap}.sk{border-top:none}.sq{height:52px}.sr{max-height:52px}.ss{box-sizing:content-box}.st{position:static}.sv{max-width:155px}.tg{align-items:flex-end}.th{width:76px}.ti{height:76px}.tj{border:2px solid #F9F9F9}.tk{height:72px}.tl{width:72px}.tm{margin-left:-16px}.tn{width:36px}.to{height:36px}.tp{color:rgba(255, 255, 255, 1)}.tq{fill:rgba(255, 255, 255, 1)}.tr{background:rgba(25, 25, 25, 1)}.ts{border-color:rgba(25, 25, 25, 1)}.tv:disabled{opacity:0.1}.tw:disabled:hover{background:rgba(25, 25, 25, 1)}.tx:disabled:hover{border-color:rgba(25, 25, 25, 1)}.ty{stroke:#F2F2F2}.tz{color:#F2F2F2}.ua{fill:#F2F2F2}.ub{border-color:#F2F2F2}.uh{font-weight:500}.ui{font-size:24px}.uj{line-height:30px}.uk{letter-spacing:-0.016em}.ul{margin-top:16px}.um{height:0px}.un{border-bottom:solid 1px #E5E5E5}.uo{margin-top:72px}.up{padding:24px 0}.uq{margin-bottom:0px}.ur{margin-right:16px}.as:hover:not(:disabled){color:rgba(25, 25, 25, 1)}.at:hover:not(:disabled){fill:rgba(25, 25, 25, 1)}.et:hover{background:rgba(15, 115, 12, 1)}.eu:hover{border-color:rgba(15, 115, 12, 1)}.ev:hover{cursor:pointer}.fl:hover{color:#242424}.fm:hover{fill:#242424}.fq:hover svg{fill:#242424}.ft:hover{background-color:rgba(0, 0, 0, 0.1)}.iq:hover{text-decoration:underline}.iv:hover:not(:disabled){color:rgba(15, 115, 12, 1)}.iw:hover:not(:disabled){fill:rgba(15, 115, 12, 1)}.ld:hover{fill:rgba(8, 8, 8, 1)}.lu:hover{fill:#000000}.lv:hover p{color:#000000}.lx:hover{color:#000000}.mh:hover svg{color:#000000}.si:hover{background-color:#F2F2F2}.tt:hover{background:#000000}.tu:hover{border-color:#242424}.uc:hover{background:#F2F2F2}.ud:hover{border-color:#F2F2F2}.ue:hover{cursor:wait}.uf:hover{color:#F2F2F2}.ug:hover{fill:#F2F2F2}.bd:focus-within path{fill:#242424}.lc:focus{fill:rgba(8, 8, 8, 1)}.mi:focus svg{color:#000000}.nj:focus{transform:scale(1.01)}.lh:active{border-style:none}</style><style type="text/css" data-fela-rehydration="563" data-fela-type="RULE" media="all and (min-width: 1080px)">.d{display:none}.bw{width:64px}.cg{margin:0 64px}.cv{height:48px}.dc{margin-bottom:52px}.do{margin-bottom:48px}.ef{font-size:14px}.eg{line-height:20px}.em{font-size:13px}.eo{padding:5px 12px}.fh{display:flex}.fy{margin-bottom:68px}.gc{max-width:680px}.hq{font-size:42px}.hr{margin-top:1.19em}.hs{margin-bottom:32px}.ht{line-height:52px}.hu{letter-spacing:-0.011em}.hz{align-items:center}.kb{border-top:solid 1px #F2F2F2}.kc{border-bottom:solid 1px #F2F2F2}.kd{margin:32px 0 0}.ke{padding:3px 8px}.kn> *{margin-right:24px}.ko> :last-child{margin-right:0}.lo{margin-top:0px}.md{margin:0}.ne{margin-top:40px}.oe{font-size:20px}.of{margin-top:2.14em}.og{line-height:32px}.oh{letter-spacing:-0.003em}.pd{font-size:24px}.pe{margin-top:1.95em}.pf{line-height:30px}.pg{letter-spacing:-0.016em}.pm{margin-top:0.94em}.qd{margin-top:1.72em}.qe{line-height:24px}.qf{letter-spacing:0}.ql{margin-top:56px}.rb{margin-top:1.14em}.sa{margin-top:1.25em}.sp{margin-bottom:88px}.ta{display:inline-block}.tf{padding-top:72px}</style><style type="text/css" data-fela-rehydration="563" data-fela-type="RULE" media="all and (max-width: 1079.98px)">.e{display:none}.ln{margin-top:0px}.ri{margin-left:auto}.rj{text-align:center}.sz{display:inline-block}</style><style type="text/css" data-fela-rehydration="563" data-fela-type="RULE" media="all and (max-width: 903.98px)">.f{display:none}.lm{margin-top:0px}.sy{display:inline-block}</style><style type="text/css" data-fela-rehydration="563" data-fela-type="RULE" media="all and (max-width: 727.98px)">.g{display:none}.lk{margin-top:0px}.ll{margin-right:0px}.sx{display:inline-block}</style><style type="text/css" data-fela-rehydration="563" data-fela-type="RULE" media="all and (max-width: 551.98px)">.h{display:none}.s{display:flex}.t{justify-content:space-between}.bs{width:24px}.cc{margin:0 24px}.cr{height:40px}.cy{margin-bottom:44px}.dk{margin-bottom:32px}.dx{font-size:13px}.dy{line-height:20px}.eh{padding:0px 8px 1px}.fu{margin-bottom:4px}.gw{font-size:32px}.gx{margin-top:1.01em}.gy{margin-bottom:24px}.gz{line-height:38px}.ha{letter-spacing:-0.014em}.hv{align-items:flex-start}.iy{flex-direction:column}.jb{margin-bottom:2px}.jp{margin:24px -24px 0}.jq{padding:0}.kf> *{margin-right:8px}.kg> :last-child{margin-right:24px}.kx{margin-left:0px}.li{margin-top:0px}.lj{margin-right:0px}.lz{margin:0}.mj{border:1px solid #F2F2F2}.mk{border-radius:99em}.ml{padding:0px 16px 0px 12px}.mm{height:38px}.mn{align-items:center}.mp svg{margin-right:8px}.na{margin-top:32px}.no{font-size:18px}.np{margin-top:1.56em}.nq{line-height:28px}.nr{letter-spacing:-0.003em}.on{font-size:20px}.oo{margin-top:1.2em}.op{line-height:24px}.oq{letter-spacing:0}.pi{margin-top:0.67em}.pt{font-size:16px}.pu{margin-top:1.23em}.qh{margin-top:40px}.qx{margin-top:1.34em}.rw{margin-top:0.93em}.sl{margin-bottom:80px}.sw{display:inline-block}.tb{padding-top:48px}.mo:hover{border-color:#E5E5E5}</style><style type="text/css" data-fela-rehydration="563" data-fela-type="RULE" media="all and (min-width: 904px) and (max-width: 1079.98px)">.i{display:none}.bv{width:64px}.cf{margin:0 64px}.cu{height:48px}.db{margin-bottom:52px}.dn{margin-bottom:48px}.ed{font-size:14px}.ee{line-height:20px}.ek{font-size:13px}.el{padding:5px 12px}.fg{display:flex}.fx{margin-bottom:68px}.gb{max-width:680px}.hl{font-size:42px}.hm{margin-top:1.19em}.hn{margin-bottom:32px}.ho{line-height:52px}.hp{letter-spacing:-0.011em}.hy{align-items:center}.jx{border-top:solid 1px #F2F2F2}.jy{border-bottom:solid 1px #F2F2F2}.jz{margin:32px 0 0}.ka{padding:3px 8px}.kl> *{margin-right:24px}.km> :last-child{margin-right:0}.mc{margin:0}.nd{margin-top:40px}.oa{font-size:20px}.ob{margin-top:2.14em}.oc{line-height:32px}.od{letter-spacing:-0.003em}.oz{font-size:24px}.pa{margin-top:1.95em}.pb{line-height:30px}.pc{letter-spacing:-0.016em}.pl{margin-top:0.94em}.qa{margin-top:1.72em}.qb{line-height:24px}.qc{letter-spacing:0}.qk{margin-top:56px}.ra{margin-top:1.14em}.rz{margin-top:1.25em}.so{margin-bottom:88px}.te{padding-top:72px}</style><style type="text/css" data-fela-rehydration="563" data-fela-type="RULE" media="all and (min-width: 728px) and (max-width: 903.98px)">.j{display:none}.w{display:flex}.x{justify-content:space-between}.bu{width:64px}.ce{margin:0 48px}.ct{height:48px}.da{margin-bottom:52px}.dm{margin-bottom:48px}.eb{font-size:13px}.ec{line-height:20px}.ej{padding:0px 8px 1px}.fw{margin-bottom:68px}.ga{max-width:680px}.hg{font-size:42px}.hh{margin-top:1.19em}.hi{margin-bottom:32px}.hj{line-height:52px}.hk{letter-spacing:-0.011em}.hx{align-items:center}.jt{border-top:solid 1px #F2F2F2}.ju{border-bottom:solid 1px #F2F2F2}.jv{margin:32px 0 0}.jw{padding:3px 8px}.kj> *{margin-right:24px}.kk> :last-child{margin-right:0}.mb{margin:0}.nc{margin-top:40px}.nw{font-size:20px}.nx{margin-top:2.14em}.ny{line-height:32px}.nz{letter-spacing:-0.003em}.ov{font-size:24px}.ow{margin-top:1.95em}.ox{line-height:30px}.oy{letter-spacing:-0.016em}.pk{margin-top:0.94em}.px{margin-top:1.72em}.py{line-height:24px}.pz{letter-spacing:0}.qj{margin-top:56px}.qz{margin-top:1.14em}.ry{margin-top:1.25em}.sn{margin-bottom:88px}.td{padding-top:72px}</style><style type="text/css" data-fela-rehydration="563" data-fela-type="RULE" media="all and (min-width: 552px) and (max-width: 727.98px)">.k{display:none}.u{display:flex}.v{justify-content:space-between}.bt{width:24px}.cd{margin:0 24px}.cs{height:40px}.cz{margin-bottom:44px}.dl{margin-bottom:32px}.dz{font-size:13px}.ea{line-height:20px}.ei{padding:0px 8px 1px}.fv{margin-bottom:4px}.hb{font-size:32px}.hc{margin-top:1.01em}.hd{margin-bottom:24px}.he{line-height:38px}.hf{letter-spacing:-0.014em}.hw{align-items:flex-start}.iz{flex-direction:column}.jc{margin-bottom:2px}.jr{margin:24px 0 0}.js{padding:0}.kh> *{margin-right:8px}.ki> :last-child{margin-right:8px}.ky{margin-left:0px}.ma{margin:0}.mq{border:1px solid #F2F2F2}.mr{border-radius:99em}.ms{padding:0px 16px 0px 12px}.mt{height:38px}.mu{align-items:center}.mw svg{margin-right:8px}.nb{margin-top:32px}.ns{font-size:18px}.nt{margin-top:1.56em}.nu{line-height:28px}.nv{letter-spacing:-0.003em}.or{font-size:20px}.os{margin-top:1.2em}.ot{line-height:24px}.ou{letter-spacing:0}.pj{margin-top:0.67em}.pv{font-size:16px}.pw{margin-top:1.23em}.qi{margin-top:40px}.qy{margin-top:1.34em}.rx{margin-top:0.93em}.sm{margin-bottom:80px}.tc{padding-top:48px}.mv:hover{border-color:#E5E5E5}</style><style type="text/css" data-fela-rehydration="563" data-fela-type="RULE" media="print">.su{display:none}</style><style type="text/css" data-fela-rehydration="563" data-fela-type="RULE" media="(orientation: landscape) and (max-width: 903.98px)">.jm{max-height:none}</style><style type="text/css" data-fela-rehydration="563" data-fela-type="RULE" media="(prefers-reduced-motion: no-preference)">.ng{transition:transform 300ms cubic-bezier(0.2, 0, 0.2, 1)}</style></head><body><div id="root"><div class="a b c"><div class="d e f g h i j k"></div><script>document.domain = document.domain;</script><div class="l c"><div class="l m n o c"><div class="p q r s t u v w x i d y z"><a class="du ag dv bf ak b am an ao ap aq ar as at s u w i d q dw z" href="https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F4be7ac62ac63&amp;%7Efeature=LoOpenInAppButton&amp;%7Echannel=ShowPostUnderCollection&amp;source=---top_nav_layout_nav----------------------------------" rel="noopener follow">Open in app<svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" fill="none" viewBox="0 0 10 10" class="dt"><path fill="currentColor" d="M.985 8.485a.375.375 0 1 0 .53.53zM8.75 1.25h.375A.375.375 0 0 0 8.75.875zM8.375 6.5a.375.375 0 1 0 .75 0zM3.5.875a.375.375 0 1 0 0 .75zm-1.985 8.14 7.5-7.5-.53-.53-7.5 7.5zm6.86-7.765V6.5h.75V1.25zM3.5 1.625h5.25v-.75H3.5z"></path></svg></a><div class="ab q"><p class="bf b dx dy dz ea eb ec ed ee ef eg du"><span><a class="bf b dx dy eh dz ea ei eb ec ej ek ee el em eg eo ep eq er es et eu ev ew ex ey ez fa fb fc fd bm fe ff" data-testid="headerSignUpButton" href="https://medium.com/m/signin?operation=register&amp;redirect=https%3A%2F%2Fblog.palantir.com%2Ftampering-with-windows-event-tracing-background-offense-and-defense-4be7ac62ac63&amp;source=post_page---top_nav_layout_nav-----------------------global_nav-----------" rel="noopener follow">Sign up</a></span></p><div class="ax l"><p class="bf b dx dy dz ea eb ec ed ee ef eg du"><span><a class="af ag ah ai aj ak al am an ao ap aq ar as at" data-testid="headerSignInButton" href="https://medium.com/m/signin?operation=login&amp;redirect=https%3A%2F%2Fblog.palantir.com%2Ftampering-with-windows-event-tracing-background-offense-and-defense-4be7ac62ac63&amp;source=post_page---top_nav_layout_nav-----------------------global_nav-----------" rel="noopener follow">Sign in</a></span></p></div></div></div><div class="p q r ab ac"><div class="ab q ae"><a class="af ag ah ai aj ak al am an ao ap aq ar as at ab" aria-label="Homepage" data-testid="headerMediumLogo" href="https://medium.com/?source=---top_nav_layout_nav----------------------------------" rel="noopener follow"><svg xmlns="http://www.w3.org/2000/svg" width="719" height="160" fill="none" viewBox="0 0 719 160" class="au av aw"><path fill="#242424" d="m174.104 9.734.215-.047V8.02H130.39L89.6 103.89 48.81 8.021H1.472v1.666l.212.047c8.018 1.81 12.09 4.509 12.09 14.242V137.93c0 9.734-4.087 12.433-12.106 14.243l-.212.047v1.671h32.118v-1.665l-.213-.048c-8.018-1.809-12.089-4.509-12.089-14.242V30.586l52.399 123.305h2.972l53.925-126.743V140.75c-.687 7.688-4.721 10.062-11.982 11.701l-.215.05v1.652h55.948v-1.652l-.215-.05c-7.269-1.639-11.4-4.013-12.087-11.701l-.037-116.774h.037c0-9.733 4.071-12.432 12.087-14.242m25.555 75.488c.915-20.474 8.268-35.252 20.606-35.507 3.806.063 6.998 1.312 9.479 3.714 5.272 5.118 7.751 15.812 7.368 31.793zm-.553 5.77h65.573v-.275c-.186-15.656-4.721-27.834-13.466-36.196-7.559-7.227-18.751-11.203-30.507-11.203h-.263c-6.101 0-13.584 1.48-18.909 4.16-6.061 2.807-11.407 7.003-15.855 12.511-7.161 8.874-11.499 20.866-12.554 34.343q-.05.606-.092 1.212a50 50 0 0 0-.065 1.151 85.807 85.807 0 0 0-.094 5.689c.71 30.524 17.198 54.917 46.483 54.917 25.705 0 40.675-18.791 44.407-44.013l-1.886-.664c-6.557 13.556-18.334 21.771-31.738 20.769-18.297-1.369-32.314-19.922-31.042-42.395m139.722 41.359c-2.151 5.101-6.639 7.908-12.653 7.908s-11.513-4.129-15.418-11.63c-4.197-8.053-6.405-19.436-6.405-32.92 0-28.067 8.729-46.22 22.24-46.22 5.657 0 10.111 2.807 12.236 7.704zm43.499 20.008c-8.019-1.897-12.089-4.722-12.089-14.951V1.309l-48.716 14.353v1.757l.299-.024c6.72-.543 11.278.386 13.925 2.83 2.072 1.915 3.082 4.853 3.082 8.987v18.66c-4.803-3.067-10.516-4.56-17.448-4.56-14.059 0-26.909 5.92-36.176 16.672-9.66 11.205-14.767 26.518-14.767 44.278-.003 31.72 15.612 53.039 38.851 53.039 13.595 0 24.533-7.449 29.54-20.013v16.865h43.711v-1.746zM424.1 19.819c0-9.904-7.468-17.374-17.375-17.374-9.859 0-17.573 7.632-17.573 17.374s7.721 17.374 17.573 17.374c9.907 0 17.375-7.47 17.375-17.374m11.499 132.546c-8.019-1.897-12.089-4.722-12.089-14.951h-.035V43.635l-43.714 12.551v1.705l.263.024c9.458.842 12.047 4.1 12.047 15.152v81.086h43.751v-1.746zm112.013 0c-8.018-1.897-12.089-4.722-12.089-14.951V43.635l-41.621 12.137v1.71l.246.026c7.733.813 9.967 4.257 9.967 15.36v59.279c-2.578 5.102-7.415 8.131-13.274 8.336-9.503 0-14.736-6.419-14.736-18.073V43.638l-43.714 12.55v1.703l.262.024c9.459.84 12.05 4.097 12.05 15.152v50.17a56.3 56.3 0 0 0 .91 10.444l.787 3.423c3.701 13.262 13.398 20.197 28.59 20.197 12.868 0 24.147-7.966 29.115-20.43v17.311h43.714v-1.747zm169.818 1.788v-1.749l-.213-.05c-8.7-2.006-12.089-5.789-12.089-13.49v-63.79c0-19.89-11.171-31.761-29.883-31.761-13.64 0-25.141 7.882-29.569 20.16-3.517-13.01-13.639-20.16-28.606-20.16-13.146 0-23.449 6.938-27.869 18.657V43.643L545.487 55.68v1.715l.263.024c9.345.829 12.047 4.181 12.047 14.95v81.784h40.787v-1.746l-.215-.053c-6.941-1.631-9.181-4.606-9.181-12.239V66.998c1.836-4.289 5.537-9.37 12.853-9.37 9.086 0 13.692 6.296 13.692 18.697v77.828h40.797v-1.746l-.215-.053c-6.94-1.631-9.18-4.606-9.18-12.239V75.066a42 42 0 0 0-.578-7.26c1.947-4.661 5.86-10.177 13.475-10.177 9.214 0 13.691 6.114 13.691 18.696v77.828z"></path></svg></a><div class="ax h"><div class="ab ay az ba bb q bc bd"><div class="bm" aria-hidden="false" aria-describedby="searchResults" aria-labelledby="searchResults"></div><div class="bn bo ab"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.092 11.06a6.95 6.95 0 1 1 13.9 0 6.95 6.95 0 0 1-13.9 0m6.95-8.05a8.05 8.05 0 1 0 5.13 14.26l3.75 3.75a.56.56 0 1 0 .79-.79l-3.73-3.73A8.05 8.05 0 0 0 11.042 3z" clip-rule="evenodd"></path></svg></div><input role="combobox" aria-controls="searchResults" aria-expanded="false" aria-label="search" data-testid="headerSearchInput" tabindex="0" class="ay be bf bg z bh bi bj bk bl" placeholder="Search" value=""/></div></div></div><div class="h k w fg fh"><div class="fi ab"><span><a class="af ag ah ai aj ak al am an ao ap aq ar as at" data-testid="headerWriteButton" href="https://medium.com/m/signin?operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2Fnew-story&amp;source=---top_nav_layout_nav-----------------------new_post_topnav-----------" rel="noopener follow"><div class="bf b bg z du fj fk ab q fl fm"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" aria-label="Write"><path fill="currentColor" d="M14 4a.5.5 0 0 0 0-1zm7 6a.5.5 0 0 0-1 0zm-7-7H4v1h10zM3 4v16h1V4zm1 17h16v-1H4zm17-1V10h-1v10zm-1 1a1 1 0 0 0 1-1h-1zM3 20a1 1 0 0 0 1 1v-1zM4 3a1 1 0 0 0-1 1h1z"></path><path stroke="currentColor" d="m17.5 4.5-8.458 8.458a.25.25 0 0 0-.06.098l-.824 2.47a.25.25 0 0 0 .316.316l2.47-.823a.25.25 0 0 0 .098-.06L19.5 6.5m-2-2 2.323-2.323a.25.25 0 0 1 .354 0l1.646 1.646a.25.25 0 0 1 0 .354L19.5 6.5m-2-2 2 2"></path></svg><div class="dt l">Write</div></div></a></span></div></div><div class="k j i d"><div class="fi ab"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" data-testid="headerSearchButton" href="https://medium.com/search?source=---top_nav_layout_nav----------------------------------" rel="noopener follow"><div class="bf b bg z du fj fk ab q fl fm"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" aria-label="Search"><path fill="currentColor" fill-rule="evenodd" d="M4.092 11.06a6.95 6.95 0 1 1 13.9 0 6.95 6.95 0 0 1-13.9 0m6.95-8.05a8.05 8.05 0 1 0 5.13 14.26l3.75 3.75a.56.56 0 1 0 .79-.79l-3.73-3.73A8.05 8.05 0 0 0 11.042 3z" clip-rule="evenodd"></path></svg></div></a></div></div><div class="fi h k j"><div class="ab q"><p class="bf b dx dy dz ea eb ec ed ee ef eg du"><span><a class="bf b dx dy eh dz ea ei eb ec ej ek ee el em eg eo ep eq er es et eu ev ew ex ey ez fa fb fc fd bm fe ff" data-testid="headerSignUpButton" href="https://medium.com/m/signin?operation=register&amp;redirect=https%3A%2F%2Fblog.palantir.com%2Ftampering-with-windows-event-tracing-background-offense-and-defense-4be7ac62ac63&amp;source=post_page---top_nav_layout_nav-----------------------global_nav-----------" rel="noopener follow">Sign up</a></span></p><div class="ax l"><p class="bf b dx dy dz ea eb ec ed ee ef eg du"><span><a class="af ag ah ai aj ak al am an ao ap aq ar as at" data-testid="headerSignInButton" href="https://medium.com/m/signin?operation=login&amp;redirect=https%3A%2F%2Fblog.palantir.com%2Ftampering-with-windows-event-tracing-background-offense-and-defense-4be7ac62ac63&amp;source=post_page---top_nav_layout_nav-----------------------global_nav-----------" rel="noopener follow">Sign in</a></span></p></div></div></div><div class="l" aria-hidden="false"><button class="ay fn am ab q ao fo fp fq" aria-label="user options menu" data-testid="headerUserIcon"><div class="l fj"><img alt="" class="l fd by bz ca cx" src="https://miro.medium.com/v2/resize:fill:64:64/1*dmbNkD5D-u45r44go_cf0g.png" width="32" height="32" loading="lazy" role="presentation"/><div class="fr by l bz ca fs n ay ft"></div></div></button></div></div></div><div class="l"><div class="fu fv fw fx fy l"><div class="ab cb"><div class="ci bh fz ga gb gc"></div></div><article><div class="l"><div class="l"><span class="l"></span><section><div><div class="fs gi gj gk gl gm"></div><div class="gn go gp gq gr"><div class="ab cb"><div class="ci bh fz ga gb gc"><div><h1 id="6a1f" class="pw-post-title gs gt gu bf gv gw gx gy gz ha hb hc hd he hf hg hh hi hj hk hl hm hn ho hp hq hr hs ht hu bk" data-testid="storyTitle">Tampering with Windows Event Tracing: Background, Offense, and Defense</h1><div><div class="speechify-ignore ab cp"><div class="speechify-ignore bh l"><div class="hv hw hx hy hz ab"><div><div class="ab ia"><a href="https://palantir.medium.com/?source=post_page-----4be7ac62ac63--------------------------------" rel="noopener follow"><div><div class="bm" aria-hidden="false"><div class="l ib ic by id ie"><div class="l fj"><img alt="Palantir" class="l fd by dd de cx" src="https://miro.medium.com/v2/resize:fill:88:88/1*yFp1VmXHPcrYrYrDNlD_7A.png" width="44" height="44" loading="lazy" data-testid="authorPhoto"/><div class="if by l dd de fs n ig ft"></div></div></div></div></div></a><a href="https://blog.palantir.com/?source=post_page-----4be7ac62ac63--------------------------------" rel="noopener  ugc nofollow"><div class="ih ab fj"><div><div class="bm" aria-hidden="false"><div class="l ii ij by id ik"><div class="l fj"><img alt="Palantir Blog" class="l fd by br il cx" src="https://miro.medium.com/v2/resize:fill:48:48/1*PbgkHC0TD-x4rvptc-w3jg.png" width="24" height="24" loading="lazy" data-testid="publicationPhoto"/><div class="if by l br il fs n ig ft"></div></div></div></div></div></div></a></div></div><div class="bn bh l"><div class="ab"><div style="flex:1"><span class="bf b bg z bk"><div class="im ab q"><div class="ab q in"><div class="ab q"><div><div class="bm" aria-hidden="false"><p class="bf b io ip bk"><a class="af ag ah ai aj ak al am an ao ap aq ar iq" data-testid="authorName" href="https://palantir.medium.com/?source=post_page-----4be7ac62ac63--------------------------------" rel="noopener follow">Palantir</a></p></div></div></div><span class="ir is" aria-hidden="true"><span class="bf b bg z du">·</span></span><p class="bf b io ip du"><span><a class="it iu ah ai aj ak al am an ao ap aq ar ex iv iw" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F1529195d9f13&amp;operation=register&amp;redirect=https%3A%2F%2Fblog.palantir.com%2Ftampering-with-windows-event-tracing-background-offense-and-defense-4be7ac62ac63&amp;user=Palantir&amp;userId=1529195d9f13&amp;source=post_page-1529195d9f13----4be7ac62ac63---------------------post_header-----------" rel="noopener follow">Follow</a></span></p></div></div></span></div></div><div class="l ix"><span class="bf b bg z du"><div class="ab cn iy iz ja"><div class="jb jc ab"><div class="bf b bg z du ab jd"><span class="je l ix">Published in</span><div><div class="l" aria-hidden="false"><a class="af ag ah ai aj ak al am an ao ap aq ar iq ab q" data-testid="publicationName" href="https://blog.palantir.com/?source=post_page-----4be7ac62ac63--------------------------------" rel="noopener  ugc nofollow"><p class="bf b bg z jf jg jh ji jj jk jl jm bk">Palantir Blog</p></a></div></div></div><div class="h k"><span class="ir is" aria-hidden="true"><span class="bf b bg z du">·</span></span></div></div><span class="bf b bg z du"><div class="ab ae"><span data-testid="storyReadTime">13 min read</span><div class="jn jo l" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bf b bg z du">·</span></span></div><span data-testid="storyPublishDate">Dec 24, 2018</span></div></span></div></span></div></div></div><div class="ab cp jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke"><div class="h k w fg fh q"><div class="ku l"><div class="ab q kv kw"><div class="pw-multi-vote-icon fj je kx ky kz"><span><a class="af ag ah ai aj ak al am an ao ap aq ar as at" data-testid="headerClapButton" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Fpalantir%2F4be7ac62ac63&amp;operation=register&amp;redirect=https%3A%2F%2Fblog.palantir.com%2Ftampering-with-windows-event-tracing-background-offense-and-defense-4be7ac62ac63&amp;user=Palantir&amp;userId=1529195d9f13&amp;source=-----4be7ac62ac63---------------------clap_footer-----------" rel="noopener follow"><div><div class="bm" aria-hidden="false"><div class="la ao lb lc ld le am lf lg lh kz"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM13.916 3.953l1.523-2.112-1.184-.39zM8.589 1.84l1.522 2.112-.337-2.501zM18.523 18.92c-.86.86-1.75 1.246-2.62 1.33a6 6 0 0 0 .407-.372c2.388-2.389 2.86-4.951 1.399-7.623l-.912-1.603-.79-1.672c-.26-.56-.194-.98.203-1.288a.7.7 0 0 1 .546-.132c.283.046.546.231.728.5l2.363 4.157c.976 1.624 1.141 4.237-1.324 6.702m-10.999-.438L3.37 14.328a.828.828 0 0 1 .585-1.408.83.83 0 0 1 .585.242l2.158 2.157a.365.365 0 0 0 .516-.516l-2.157-2.158-1.449-1.449a.826.826 0 0 1 1.167-1.17l3.438 3.44a.363.363 0 0 0 .516 0 .364.364 0 0 0 0-.516L5.293 9.513l-.97-.97a.826.826 0 0 1 0-1.166.84.84 0 0 1 1.167 0l.97.968 3.437 3.436a.36.36 0 0 0 .517 0 .366.366 0 0 0 0-.516L6.977 7.83a.82.82 0 0 1-.241-.584.82.82 0 0 1 .824-.826c.219 0 .43.087.584.242l5.787 5.787a.366.366 0 0 0 .587-.415l-1.117-2.363c-.26-.56-.194-.98.204-1.289a.7.7 0 0 1 .546-.132c.283.046.545.232.727.501l2.193 3.86c1.302 2.38.883 4.59-1.277 6.75-1.156 1.156-2.602 1.627-4.19 1.367-1.418-.236-2.866-1.033-4.079-2.246M10.75 5.971l2.12 2.12c-.41.502-.465 1.17-.128 1.89l.22.465-3.523-3.523a.8.8 0 0 1-.097-.368c0-.22.086-.428.241-.584a.847.847 0 0 1 1.167 0m7.355 1.705c-.31-.461-.746-.758-1.23-.837a1.44 1.44 0 0 0-1.11.275c-.312.24-.505.543-.59.881a1.74 1.74 0 0 0-.906-.465 1.47 1.47 0 0 0-.82.106l-2.182-2.182a1.56 1.56 0 0 0-2.2 0 1.54 1.54 0 0 0-.396.701 1.56 1.56 0 0 0-2.21-.01 1.55 1.55 0 0 0-.416.753c-.624-.624-1.649-.624-2.237-.037a1.557 1.557 0 0 0 0 2.2c-.239.1-.501.238-.715.453a1.56 1.56 0 0 0 0 2.2l.516.515a1.556 1.556 0 0 0-.753 2.615L7.01 19c1.32 1.319 2.909 2.189 4.475 2.449q.482.08.971.08c.85 0 1.653-.198 2.393-.579.231.033.46.054.686.054 1.266 0 2.457-.52 3.505-1.567 2.763-2.763 2.552-5.734 1.439-7.586z" clip-rule="evenodd"></path></svg></div></div></div></a></span></div><div class="pw-multi-vote-count l li lj lk ll lm ln lo"><p class="bf b dv z du"><span class="lp">--</span></p></div></div></div><div><div class="bm" aria-hidden="false"><button class="ao la ls lt ab q fk lu lv" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="lr"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"></path></svg><p class="bf b dv z du"><span class="pw-responses-count lq lr">1</span></p></button></div></div></div><div class="ab q kf kg kh ki kj kk kl km kn ko kp kq kr ks kt"><div class="lw k j i d"></div><div class="h k"><div><div class="bm" aria-hidden="false"><span><a class="af ag ah ai aj ak al am an ao ap aq ar as at" data-testid="headerBookmarkButton" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F4be7ac62ac63&amp;operation=register&amp;redirect=https%3A%2F%2Fblog.palantir.com%2Ftampering-with-windows-event-tracing-background-offense-and-defense-4be7ac62ac63&amp;source=-----4be7ac62ac63---------------------bookmark_footer-----------" rel="noopener follow"><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="none" viewBox="0 0 25 25" class="du lx" aria-label="Add to list bookmark button"><path fill="currentColor" d="M18 2.5a.5.5 0 0 1 1 0V5h2.5a.5.5 0 0 1 0 1H19v2.5a.5.5 0 1 1-1 0V6h-2.5a.5.5 0 0 1 0-1H18zM7 7a1 1 0 0 1 1-1h3.5a.5.5 0 0 0 0-1H8a2 2 0 0 0-2 2v14a.5.5 0 0 0 .805.396L12.5 17l5.695 4.396A.5.5 0 0 0 19 21v-8.5a.5.5 0 0 0-1 0v7.485l-5.195-4.012a.5.5 0 0 0-.61 0L7 19.985z"></path></svg></a></span></div></div></div><div class="fd ly cn"><div class="l ae"><div class="ab cb"><div class="lz ma mb mc md me ci bh"><div class="ab"><div class="bm bh" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="Listen" data-testid="audioPlayButton" class="af fk ah ai aj ak al mf an ao ap ex mg mh lv mi mj mk ml mm s mn mo mp mq mr ms mt u mu mv mw"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"></path></svg><div class="j i d"><p class="bf b bg z du">Listen</p></div></button></div></div></div></div></div></div></div></div><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="af fk ah ai aj ak al mf an ao ap ex mg mh lv mi mj mk ml mm s mn mo mp mq mr ms mt u mu mv mw"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"></path></svg><div class="j i d"><p class="bf b bg z du">Share</p></div></button></div></div></div></div></div></div></div></div></div><figure class="na nb nc nd ne nf mx my paragraph-image"><div role="button" tabindex="0" class="ng nh fj ni bh nj"><div class="mx my mz"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*SMDAeNCTr6vY7N8oTjneiA.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*SMDAeNCTr6vY7N8oTjneiA.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*SMDAeNCTr6vY7N8oTjneiA.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*SMDAeNCTr6vY7N8oTjneiA.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*SMDAeNCTr6vY7N8oTjneiA.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*SMDAeNCTr6vY7N8oTjneiA.png 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/1*SMDAeNCTr6vY7N8oTjneiA.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*SMDAeNCTr6vY7N8oTjneiA.png 640w, https://miro.medium.com/v2/resize:fit:720/1*SMDAeNCTr6vY7N8oTjneiA.png 720w, https://miro.medium.com/v2/resize:fit:750/1*SMDAeNCTr6vY7N8oTjneiA.png 750w, https://miro.medium.com/v2/resize:fit:786/1*SMDAeNCTr6vY7N8oTjneiA.png 786w, https://miro.medium.com/v2/resize:fit:828/1*SMDAeNCTr6vY7N8oTjneiA.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*SMDAeNCTr6vY7N8oTjneiA.png 1100w, https://miro.medium.com/v2/resize:fit:1400/1*SMDAeNCTr6vY7N8oTjneiA.png 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"/><img alt="" class="bh me nk c" width="700" height="598" loading="eager" role="presentation"/></picture></div></div></figure><p id="3467" class="pw-post-body-paragraph nl nm gu nn b no np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh oi gn bk"><a class="af oj" href="https://blogs.msdn.microsoft.com/ntdebugging/2009/08/27/part-1-etw-introduction-and-overview/" rel="noopener ugc nofollow" target="_blank">Event Tracing for Windows</a> (ETW) is the mechanism Windows uses to trace and log system events. Attackers often clear event logs to cover their tracks. Though the act of clearing an event log itself generates an event, attackers who know ETW well may take advantage of tampering opportunities to cease the flow of logging temporarily or even permanently, without generating any event log entries in the process.</p><p id="900b" class="pw-post-body-paragraph nl nm gu nn b no np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh oi gn bk">The Windows event log is the data source for many of the Palantir Critical Incident Response Team’s <a class="af oj" href="https://medium.com/palantir/alerting-and-detection-strategy-framework-52dc33722df2" rel="noopener">Alerting and Detection Strategies</a>, so familiarity with event log tampering tradecraft is foundational to our success. We continually evaluate our assumptions regarding the integrity of our event data sources, document our blind spots, and adjust our implementation. The goal of this blog post is to share our knowledge with the community by covering ETW background and basics, stealthy event log tampering techniques, and detection strategies.</p><h1 id="4f16" class="ok ol gu bf om on oo op oq or os ot ou ov ow ox oy oz pa pb pc pd pe pf pg ph bk">Introduction to ETW and event logging</h1><p id="76a0" class="pw-post-body-paragraph nl nm gu nn b no pi nq nr ns pj nu nv nw pk ny nz oa pl oc od oe pm og oh oi gn bk">The <a class="af oj" href="https://docs.microsoft.com/en-us/windows/desktop/etw/about-event-tracing" rel="noopener ugc nofollow" target="_blank">ETW architecture</a> differentiates between event <em class="pn">providers</em>, event <em class="pn">consumers</em>, and event <em class="pn">tracing sessions</em>. Tracing sessions are responsible for collecting events from providers and for relaying them to log files and consumers. Sessions are created and configured by <em class="pn">controllers</em> like the built-in <code class="cx po pp pq pr b">logman.exe</code> command line utility. Here are some useful commands for exploring existing trace sessions and their respective ETW providers; note that these must usually be executed from an elevated context.</p><h2 id="b1a4" class="ps ol gu bf om pt pu dy oq pv pw ea ou nw px py pz oa qa qb qc oe qd qe qf qg bk">List all running trace sessions</h2><pre class="qh qi qj qk ql qm pr qn qo ay qp bk"><span id="919b" class="ps ol gu pr b io qq qr l jd qs">&gt; <!-- -->logman query -ets</span><span id="88f3" class="ps ol gu pr b io qt qr l jd qs">Data Collector Set                Type    Status<br/>-------------------------------------------------<br/>Circular Kernel Context Logger    Trace   Running<br/>AppModel                          Trace   Running<br/>ScreenOnPowerStudyTraceSession    Trace   Running<br/>DiagLog                           Trace   Running<br/>EventLog-Application              Trace   Running<br/>EventLog-System                   Trace   Running<br/>LwtNetLog                         Trace   Running<br/>NtfsLog                           Trace   Running<br/>TileStore                         Trace   Running<br/>UBPM                              Trace   Running<br/>WdiContextLog                     Trace   Running<br/>WiFiSession                       Trace   Running<br/>UserNotPresentTraceSession        Trace   Running<br/>Diagtrack-Listener                Trace   Running<br/>MSDTC_TRACE_SESSION               Trace   Running<br/>WindowsUpdate_trace_log           Trace   Running</span></pre><h2 id="647f" class="ps ol gu bf om pt pu dy oq pv pw ea ou nw px py pz oa qa qb qc oe qd qe qf qg bk">List all providers that a trace session is subscribed to</h2><pre class="qh qi qj qk ql qm pr qn qo ay qp bk"><span id="09a8" class="ps ol gu pr b io qq qr l jd qs">&gt; <!-- -->logman query &quot;EventLog-Application&quot; -ets</span><span id="f182" class="ps ol gu pr b io qt qr l jd qs">Name:                 EventLog-Application<br/>Status:               Running<br/>Root Path:            %systemdrive%\PerfLogs\Admin<br/>Segment:              Off<br/>Schedules:            On<br/>Segment Max Size:     100 MB<br/> <br/>Name:                 EventLog-Application\EventLog-Application<br/>Type:                 Trace<br/>Append:               Off<br/>Circular:             Off<br/>Overwrite:            Off<br/>Buffer Size:          64<br/>Buffers Lost:         0<br/>Buffers Written:      242<br/>Buffer Flush Timer:   1<br/>Clock Type:           System<br/>File Mode:            Real-time<br/> <br/>Provider:<br/>Name:                 Microsoft-Windows-SenseIR<br/>Provider Guid:        {B6D775EF-1436-4FE6-BAD3-9E436319E218}<br/>Level:                255<br/>KeywordsAll:          0x0<br/>KeywordsAny:          0x8000000000000000 (Microsoft-Windows-SenseIR/Operational)<br/>Properties:           65<br/>Filter Type:          0<br/> <br/>Provider:<br/>Name:                 Microsoft-Windows-WDAG-Service<br/>Provider Guid:        {728B02D9-BF21-49F6-BE3F-91BC06F7467E}<br/>Level:                255<br/>KeywordsAll:          0x0<br/>KeywordsAny:          0x8000000000000000<br/>Properties:           65<br/>Filter Type:          0<br/> <br/>...<br/> <br/>Provider:<br/>Name:                 Microsoft-Windows-PowerShell<br/>Provider Guid:        {A0C1853B-5C40-4B15-8766-3CF1C58F985A}<br/>Level:                255<br/>KeywordsAll:          0x0<br/>KeywordsAny:          0x9000000000000000 (Microsoft-Windows-PowerShell/Operational,Microsoft-Windows-PowerShell/Admin)<br/>Properties:           65<br/>Filter Type:          0</span></pre><p id="0b63" class="pw-post-body-paragraph nl nm gu nn b no np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh oi gn bk">This command details the configuration of the trace session itself, followed by the configuration of each provider that the session is subscribed to, including the following parameters:</p><ul class=""><li id="9846" class="nl nm gu nn b no np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh oi qu qv qw bk"><strong class="nn gv">Name</strong>: The name of the provider. A provider only has a name if it has a <a class="af oj" href="https://docs.microsoft.com/en-us/windows/desktop/etw/writing-manifest-based-events" rel="noopener ugc nofollow" target="_blank">registered manifest</a>, but it always has a unique GUID.</li><li id="8dfd" class="nl nm gu nn b no qx nq nr ns qy nu nv nw qz ny nz oa ra oc od oe rb og oh oi qu qv qw bk"><strong class="nn gv">Provider GUID</strong>: The unique GUID for the provider. The GUID and/or name of a provider is useful when performing research or operations on a specific provider.</li><li id="3034" class="nl nm gu nn b no qx nq nr ns qy nu nv nw qz ny nz oa ra oc od oe rb og oh oi qu qv qw bk"><strong class="nn gv">Level</strong>: The logging level specified. Standard logging levels are: 0 — Log Always; 1 — Critical; 2 — Error; 3 — Warning; 4 — Informational; 5 — Verbose. Custom logging levels can also be defined, but levels 6–15 are reserved. More than one logging level can be captured by ORing respective levels; supplying 255 (0xFF) is the standard method of capturing all supported logging levels.</li><li id="cb70" class="nl nm gu nn b no qx nq nr ns qy nu nv nw qz ny nz oa ra oc od oe rb og oh oi qu qv qw bk"><strong class="nn gv">KeywordsAll</strong>: Keywords are used to filter specific categories of events. While logging level is used to filter by event verbosity/importance, keywords allow filtering by event category. A keyword corresponds to a specific bit value. <em class="pn">All</em> indicates that, for a given keyword matched by <code class="cx po pp pq pr b">KeywordsAny</code>, further filtering should be performed based on the specific bitmask in <code class="cx po pp pq pr b">KeywordsAll</code>. This field is often set to zero. More information on <em class="pn">All</em> vs. <em class="pn">Any</em> can be found <a class="af oj" href="https://docs.microsoft.com/en-us/windows/desktop/wes/defining-keywords-used-to-classify-types-of-events" rel="noopener ugc nofollow" target="_blank">here</a>.</li><li id="264d" class="nl nm gu nn b no qx nq nr ns qy nu nv nw qz ny nz oa ra oc od oe rb og oh oi qu qv qw bk"><strong class="nn gv">KeywordsAny</strong>: Enables filtering based on any combination of the keywords specified. This can be thought of as a logical OR where KeywordsAll is a subsequent application of a logical AND. The low 6 bytes refer to keywords specific to the provider. The high two bytes are reserved and defined in <code class="cx po pp pq pr b">WinMeta.xml</code> in the Windows SDK. For example, in event log-related trace sessions, you will see the high byte (specifically, the high nibble) set to a specific value. This corresponds to one or more event channels where the following channels are defined:</li></ul><pre class="qh qi qj qk ql qm pr qn qo ay qp bk"><span id="3e70" class="ps ol gu pr b io qq qr l jd qs">0x01 - Admin channel<br/>0x02 - Debug channel<br/>0x04 - Analytic channel<br/>0x08 - Operational channel</span></pre><ul class=""><li id="0c78" class="nl nm gu nn b no np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh oi qu qv qw bk"><strong class="nn gv">Properties</strong>: This refers to optional ETW properties that can be specified when writing the event. The following values are currently supported (more information <a class="af oj" href="https://docs.microsoft.com/en-us/windows/desktop/ETW/enable-trace-parameters" rel="noopener ugc nofollow" target="_blank">here</a>):</li></ul><pre class="qh qi qj qk ql qm pr qn qo ay qp bk"><span id="f8f4" class="ps ol gu pr b io qq qr l jd qs">0x001 - EVENT_ENABLE_PROPERTY_SID<br/>0x002 - EVENT_ENABLE_PROPERTY_TS_ID<br/>0x004 - EVENT_ENABLE_PROPERTY_STACK_TRACE<br/>0x008 - EVENT_ENABLE_PROPERTY_PSM_KEY<br/>0x010 - EVENT_ENABLE_PROPERTY_IGNORE_KEYWORD_0<br/>0x020 - EVENT_ENABLE_PROPERTY_PROVIDER_GROUP<br/>0x040 - EVENT_ENABLE_PROPERTY_ENABLE_KEYWORD_0<br/>0x080 - EVENT_ENABLE_PROPERTY_PROCESS_START_KEY<br/>0x100 - EVENT_ENABLE_PROPERTY_EVENT_KEY<br/>0x200 - EVENT_ENABLE_PROPERTY_EXCLUDE_INPRIVATE</span></pre><p id="85ea" class="pw-post-body-paragraph nl nm gu nn b no np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh oi gn bk">From a detection perspective, EVENT_ENABLE_PROPERTY_SID, EVENT_ENABLE_PROPERTY_TS_ID, EVENT_ENABLE_PROPERTY_PROCESS_START_KEY are valuable fields to collect. For example, EVENT_ENABLE_PROPERTY_PROCESS_START_KEY generates a value that uniquely identifies a process. Note that Process IDs are not unique identifiers for a process instance.</p><ul class=""><li id="998c" class="nl nm gu nn b no np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh oi qu qv qw bk"><strong class="nn gv">Filter Type</strong>: Providers can optionally choose to implement additional filtering; supported filters are <a class="af oj" href="https://docs.microsoft.com/en-us/windows/desktop/wes/defining-filters" rel="noopener ugc nofollow" target="_blank">defined in the provider manifest</a>. In practice, none of the built-in providers implement filters as confirmed by running <a class="af oj" href="https://docs.microsoft.com/en-us/windows/desktop/api/tdh/nf-tdh-tdhenumerateproviderfilters" rel="noopener ugc nofollow" target="_blank">TdhEnumerateProviderFilters</a> over all registered providers. There are some predefined filter types defined in <code class="cx po pp pq pr b">eventprov.h</code> (in the Windows SDK):</li></ul><pre class="qh qi qj qk ql qm pr qn qo ay qp bk"><span id="3f11" class="ps ol gu pr b io qq qr l jd qs">0x00000000 - EVENT_FILTER_TYPE_NONE<br/>0x80000000 - EVENT_FILTER_TYPE_SCHEMATIZED<br/>0x80000001 - EVENT_FILTER_TYPE_SYSTEM_FLAGS<br/>0x80000002 - EVENT_FILTER_TYPE_TRACEHANDLE<br/>0x80000004 - EVENT_FILTER_TYPE_PID<br/>0x80000008 - EVENT_FILTER_TYPE_EXECUTABLE_NAME<br/>0x80000010 - EVENT_FILTER_TYPE_PACKAGE_ID<br/>0x80000020 - EVENT_FILTER_TYPE_PACKAGE_APP_ID<br/>0x80000100 - EVENT_FILTER_TYPE_PAYLOAD<br/>0x80000200 - EVENT_FILTER_TYPE_EVENT_ID<br/>0x80000400 - EVENT_FILTER_TYPE_EVENT_NAME<br/>0x80001000 - EVENT_FILTER_TYPE_STACKWALK<br/>0x80002000 - EVENT_FILTER_TYPE_STACKWALK_NAME<br/>0x80004000 - EVENT_FILTER_TYPE_STACKWALK_LEVEL_KW</span></pre><h2 id="2627" class="ps ol gu bf om pt pu dy oq pv pw ea ou nw px py pz oa qa qb qc oe qd qe qf qg bk">Enumerating all registered ETW providers</h2><p id="5702" class="pw-post-body-paragraph nl nm gu nn b no pi nq nr ns pj nu nv nw pk ny nz oa pl oc od oe pm og oh oi gn bk">The <code class="cx po pp pq pr b">logman query providers </code>command lists all registered ETW providers, supplying their name and GUID. An ETW provider is registered if it has a binary manifest stored in the<br/> <code class="cx po pp pq pr b">HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\WINEVT\Publishers\{PROVIDER_GUID}</code> registry key. For example, the <code class="cx po pp pq pr b">Microsoft-Windows-PowerShell</code> provider has the following registry values:</p><figure class="qh qi qj qk ql nf mx my paragraph-image"><div class="mx my rc"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*x34GfTbt6kR-GkP7KAX-Nw.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*x34GfTbt6kR-GkP7KAX-Nw.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*x34GfTbt6kR-GkP7KAX-Nw.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*x34GfTbt6kR-GkP7KAX-Nw.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*x34GfTbt6kR-GkP7KAX-Nw.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*x34GfTbt6kR-GkP7KAX-Nw.png 1100w, https://miro.medium.com/v2/resize:fit:1248/format:webp/1*x34GfTbt6kR-GkP7KAX-Nw.png 1248w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 624px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*x34GfTbt6kR-GkP7KAX-Nw.png 640w, https://miro.medium.com/v2/resize:fit:720/1*x34GfTbt6kR-GkP7KAX-Nw.png 720w, https://miro.medium.com/v2/resize:fit:750/1*x34GfTbt6kR-GkP7KAX-Nw.png 750w, https://miro.medium.com/v2/resize:fit:786/1*x34GfTbt6kR-GkP7KAX-Nw.png 786w, https://miro.medium.com/v2/resize:fit:828/1*x34GfTbt6kR-GkP7KAX-Nw.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*x34GfTbt6kR-GkP7KAX-Nw.png 1100w, https://miro.medium.com/v2/resize:fit:1248/1*x34GfTbt6kR-GkP7KAX-Nw.png 1248w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 624px"/><img alt="" class="bh me nk c" width="624" height="115" loading="lazy" role="presentation"/></picture></div></figure><p id="43b0" class="pw-post-body-paragraph nl nm gu nn b no np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh oi gn bk">ETW and the event log know how to properly parse and display event information to a user based on binary-serialized information in the <code class="cx po pp pq pr b">WEVT_TEMPLATE</code> resource present in the binaries listed in the <code class="cx po pp pq pr b">ResourceFileName</code> registry value. This resource is a binary representation of an <a class="af oj" href="https://docs.microsoft.com/en-us/windows/desktop/wes/writing-an-instrumentation-manifest" rel="noopener ugc nofollow" target="_blank">instrumentation manifest</a> (i.e., the schema for an ETW provider). The binary structure of <code class="cx po pp pq pr b">WEVT_TEMPLATE</code> is <a class="af oj" href="https://github.com/libyal/libexe/blob/master/documentation/Executable%20(EXE)%20file%20format.asciidoc" rel="noopener ugc nofollow" target="_blank">under-documented</a>, but there are at least two tools available to assist in parsing and recovering event schema, <a class="af oj" href="https://github.com/lallousx86/WEPExplorer" rel="noopener ugc nofollow" target="_blank">WEPExplorer</a> and <a class="af oj" href="https://github.com/Microsoft/perfview" rel="noopener ugc nofollow" target="_blank">Perfview.</a></p><h2 id="45b4" class="ps ol gu bf om pt pu dy oq pv pw ea ou nw px py pz oa qa qb qc oe qd qe qf qg bk">Viewing an individual provider</h2><p id="be16" class="pw-post-body-paragraph nl nm gu nn b no pi nq nr ns pj nu nv nw pk ny nz oa pl oc od oe pm og oh oi gn bk">The <code class="cx po pp pq pr b">logman</code> tool prints basic information about a provider. For example:</p><figure class="qh qi qj qk ql nf"><div class="rd jf l fj"><div class="re rf l"></div></div></figure><p id="f3d4" class="pw-post-body-paragraph nl nm gu nn b no np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh oi gn bk">The listings shows supported keywords and logging values, as well as all processes that are registered to emit events via this provider. This output is useful for understanding how existing trace sessions filter on providers. It is also useful for initial discovery of potentially interesting information that could be gathered from via an ETW trace.</p><p id="87c7" class="pw-post-body-paragraph nl nm gu nn b no np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh oi gn bk">Notably, the PowerShell provider appears to support logging to the event log based on the existence of the reserved keywords in the high nibble of the defined keywords. Not all ETW providers are designed to be ingested into the event log; rather, many ETW providers are intended to be used solely for low-level tracing, debugging, and more recently-developed security telemetry purposes. For example, Windows Defender Advanced Threat Protection relies heavily upon ETW as a supplemental detection data source.</p><h2 id="8699" class="ps ol gu bf om pt pu dy oq pv pw ea ou nw px py pz oa qa qb qc oe qd qe qf qg bk">Viewing all providers that a specific process is sending events to</h2><p id="985f" class="pw-post-body-paragraph nl nm gu nn b no pi nq nr ns pj nu nv nw pk ny nz oa pl oc od oe pm og oh oi gn bk">Another method for discovering potentially interesting providers is to view all providers to which events are written from a specific process. For example, the following listing shows all providers relevant to <code class="cx po pp pq pr b">MsMpEng.exe</code> (the Windows Defender service, running as pid 5244 in this example):</p><figure class="qh qi qj qk ql nf"><div class="rd jf l fj"><div class="re rf l"></div></div></figure><p id="5e54" class="pw-post-body-paragraph nl nm gu nn b no np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh oi gn bk">Entries listed with GUID are providers lacking a manifest. They will typically be related to <a class="af oj" href="https://docs.microsoft.com/en-us/windows-hardware/drivers/devtest/wpp-software-tracing" rel="noopener ugc nofollow" target="_blank">WPP</a> or <a class="af oj" href="https://docs.microsoft.com/en-us/windows/desktop/tracelogging/trace-logging-portal" rel="noopener ugc nofollow" target="_blank">TraceLogging</a>, both of which are beyond the scope of this blog post. It is possible to retrieve provider names and event metadata for these providers types. For example, here are some of the resolved provider names from the unnamed providers above:</p><ul class=""><li id="1574" class="nl nm gu nn b no np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh oi qu qv qw bk">05F95EFE-7F75–49C7-A994–60A55CC09571<br/>Microsoft.Windows.Kernel.KernelBase</li><li id="a9a9" class="nl nm gu nn b no qx nq nr ns qy nu nv nw qz ny nz oa ra oc od oe rb og oh oi qu qv qw bk">072665FB-8953–5A85–931D-D06AEAB3D109<br/>Microsoft.Windows.ProcessLifetimeManage</li><li id="4bfe" class="nl nm gu nn b no qx nq nr ns qy nu nv nw qz ny nz oa ra oc od oe rb og oh oi qu qv qw bk">7AF898D7–7E0E-518D-5F96-B1E79239484C<br/>Microsoft.Windows.Defender</li></ul><h1 id="9421" class="ok ol gu bf om on oo op oq or os ot ou ov ow ox oy oz pa pb pc pd pe pf pg ph bk">Event provider internals</h1><p id="15ae" class="pw-post-body-paragraph nl nm gu nn b no pi nq nr ns pj nu nv nw pk ny nz oa pl oc od oe pm og oh oi gn bk">Looking at ETW-replated code snippets in built-in Windows binaries can help you understand how ETW events are constructed and how they surface in event logs. Below, we highlight two code samples, <code class="cx po pp pq pr b">System.Management.Automation.dll</code> (the core PowerShell assembly) and <code class="cx po pp pq pr b">amsi.dll</code>.</p><h2 id="8a0d" class="ps ol gu bf om pt pu dy oq pv pw ea ou nw px py pz oa qa qb qc oe qd qe qf qg bk">System.Management.Automation.dll event tracing</h2><p id="43af" class="pw-post-body-paragraph nl nm gu nn b no pi nq nr ns pj nu nv nw pk ny nz oa pl oc od oe pm og oh oi gn bk">One of the great security features of PowerShell version 5 is <a class="af oj" href="https://blogs.msdn.microsoft.com/powershell/2015/06/09/powershell-the-blue-team/" rel="noopener ugc nofollow" target="_blank">scriptblock autologging</a>; when enabled, script content is automatically logged to the Microsoft-Windows-PowerShell/Operational event log with event ID 4104 (warning level) if the scriptblock contains any <a class="af oj" href="https://github.com/PowerShell/PowerShell/blob/79f21b41de0de9b2f68a19ba1fdef0b98f3fb1cb/src/System.Management.Automation/engine/runtime/CompiledScriptBlock.cs#L1546-L1829" rel="noopener ugc nofollow" target="_blank">suspicious terms</a>. The following C# <a class="af oj" href="https://github.com/PowerShell/PowerShell/blob/c1e171622acb2917914fbc3fde69322b07863b3b/src/System.Management.Automation/engine/runtime/CompiledScriptBlock.cs#L1440-L1444" rel="noopener ugc nofollow" target="_blank">code</a> is executed to generate the event log:</p><figure class="qh qi qj qk ql nf"><div class="rd jf l fj"><div class="re rf l"></div></div><figcaption class="rg ff rh mx my ri rj bf b bg z du">From <a class="af oj" href="https://github.com/PowerShell/PowerShell/blob/c1e171622acb2917914fbc3fde69322b07863b3b/src/System.Management.Automation/engine/runtime/CompiledScriptBlock.cs#L1440-L1444" rel="noopener ugc nofollow" target="_blank">PowerShell</a></figcaption></figure><p id="d19e" class="pw-post-body-paragraph nl nm gu nn b no np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh oi gn bk">The <code class="cx po pp pq pr b">LogOperationalWarning</code> method is implemented as follows:</p><figure class="qh qi qj qk ql nf"><div class="rd jf l fj"><div class="re rf l"></div></div><figcaption class="rg ff rh mx my ri rj bf b bg z du">From <a class="af oj" href="https://github.com/PowerShell/PowerShell/blob/5d03e1653a7d518715fa3f00587cad6b5c78cc89/src/System.Management.Automation/utils/tracing/PSEtwLog.cs#L155-L158" rel="noopener ugc nofollow" target="_blank">PowerShell</a></figcaption></figure><p id="1df1" class="pw-post-body-paragraph nl nm gu nn b no np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh oi gn bk">The <code class="cx po pp pq pr b">WriteEvent</code> method is implemented as follows:</p><figure class="qh qi qj qk ql nf"><div class="rd jf l fj"><div class="re rf l"></div></div><figcaption class="rg ff rh mx my ri rj bf b bg z du">From <a class="af oj" href="https://github.com/PowerShell/PowerShell/blob/5d03e1653a7d518715fa3f00587cad6b5c78cc89/src/System.Management.Automation/utils/tracing/PSEtwLogProvider.cs#L269-L287" rel="noopener ugc nofollow" target="_blank">PowerShell</a></figcaption></figure><p id="a536" class="pw-post-body-paragraph nl nm gu nn b no np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh oi gn bk">Finally, the event information is marshaled and <a class="af oj" href="https://docs.microsoft.com/en-us/windows/desktop/api/evntprov/nf-evntprov-eventwritetransfer" rel="noopener ugc nofollow" target="_blank">EventWriteTransfer</a> is called, supplying the Microsoft-Windows-PowerShell provider with event data.</p><p id="849e" class="pw-post-body-paragraph nl nm gu nn b no np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh oi gn bk">The relevant data supplied to <code class="cx po pp pq pr b">EventWriteTransfer</code> is as follows:</p><ul class=""><li id="f372" class="nl nm gu nn b no np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh oi qu qv qw bk">Microsoft-Windows-PowerShell provider GUID: <code class="cx po pp pq pr b">{A0C1853B-5C40-4b15-8766-3CF1C58F985A}</code></li><li id="6feb" class="nl nm gu nn b no qx nq nr ns qy nu nv nw qz ny nz oa ra oc od oe rb og oh oi qu qv qw bk">Event ID: <code class="cx po pp pq pr b">PSEventId.ScriptBlock_Compile_Detail - 4104</code></li><li id="2516" class="nl nm gu nn b no qx nq nr ns qy nu nv nw qz ny nz oa ra oc od oe rb og oh oi qu qv qw bk">Channel value: <code class="cx po pp pq pr b">PSChannel.Operational - 16<br/></code>Again, the usage of a channel value indicates that the provider is intended to be used with the event log. The operational channel definition for the PowerShell ETW manifest can be seen <a class="af oj" href="https://github.com/PowerShell/PowerShell-Native/blob/master/src/PowerShell.Core.Instrumentation/PowerShell.Core.Instrumentation.man#L2194-L2202" rel="noopener ugc nofollow" target="_blank">here</a>. When an explicit channel value is not supplied, <a class="af oj" href="https://docs.microsoft.com/en-us/windows/desktop/wes/message-compiler--mc-exe-" rel="noopener ugc nofollow" target="_blank">Message Compiler</a> (<code class="cx po pp pq pr b">mc.exe</code>) will assign a default value starting at 16. Since the operational channel was defined first, it was assigned 16.</li><li id="3667" class="nl nm gu nn b no qx nq nr ns qy nu nv nw qz ny nz oa ra oc od oe rb og oh oi qu qv qw bk">Opcode value: <code class="cx po pp pq pr b">PSOpcode.Create - 15</code></li><li id="ccf0" class="nl nm gu nn b no qx nq nr ns qy nu nv nw qz ny nz oa ra oc od oe rb og oh oi qu qv qw bk">Logging level: <code class="cx po pp pq pr b">PSLevel.Warning - 3</code></li><li id="2ff7" class="nl nm gu nn b no qx nq nr ns qy nu nv nw qz ny nz oa ra oc od oe rb og oh oi qu qv qw bk">Task value: <code class="cx po pp pq pr b">PSTask.CommandStart - 102</code></li><li id="b21f" class="nl nm gu nn b no qx nq nr ns qy nu nv nw qz ny nz oa ra oc od oe rb og oh oi qu qv qw bk">Keyword value: <code class="cx po pp pq pr b">PSKeyword.UseAlwaysAnalytic - 0x4000000000000000<br/></code>This value is later translated to 0 as seen in the code block above. Normally, this event would not be logged but because the Application event log trace session specifies the <code class="cx po pp pq pr b">EVENT_ENABLE_PROPERTY_ENABLE_KEYWORD_0 Enable</code> flag for all of its providers which will log the event despite a keyword value not being specified.</li><li id="f7e7" class="nl nm gu nn b no qx nq nr ns qy nu nv nw qz ny nz oa ra oc od oe rb og oh oi qu qv qw bk">Event data: the scriptblock contents and event fields</li></ul><p id="af08" class="pw-post-body-paragraph nl nm gu nn b no np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh oi gn bk">Upon receiving the event from the PowerShell ETW provider, the event log service parses the binary <code class="cx po pp pq pr b">WEVT_TEMPLATE</code> schema (<a class="af oj" href="https://github.com/PowerShell/PowerShell-Native/blob/master/src/PowerShell.Core.Instrumentation/PowerShell.Core.Instrumentation.man" rel="noopener ugc nofollow" target="_blank">original XML schema</a>) and presents human-readable, parsed event properties/fields:</p><figure class="qh qi qj qk ql nf mx my paragraph-image"><div class="mx my rk"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*ORet99fS6ZXb925L0b8BVQ.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*ORet99fS6ZXb925L0b8BVQ.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*ORet99fS6ZXb925L0b8BVQ.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*ORet99fS6ZXb925L0b8BVQ.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*ORet99fS6ZXb925L0b8BVQ.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*ORet99fS6ZXb925L0b8BVQ.png 1100w, https://miro.medium.com/v2/resize:fit:1164/format:webp/1*ORet99fS6ZXb925L0b8BVQ.png 1164w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 582px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*ORet99fS6ZXb925L0b8BVQ.png 640w, https://miro.medium.com/v2/resize:fit:720/1*ORet99fS6ZXb925L0b8BVQ.png 720w, https://miro.medium.com/v2/resize:fit:750/1*ORet99fS6ZXb925L0b8BVQ.png 750w, https://miro.medium.com/v2/resize:fit:786/1*ORet99fS6ZXb925L0b8BVQ.png 786w, https://miro.medium.com/v2/resize:fit:828/1*ORet99fS6ZXb925L0b8BVQ.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*ORet99fS6ZXb925L0b8BVQ.png 1100w, https://miro.medium.com/v2/resize:fit:1164/1*ORet99fS6ZXb925L0b8BVQ.png 1164w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 582px"/><img alt="" class="bh me nk c" width="582" height="264" loading="lazy" role="presentation"/></picture></div></figure><h2 id="6875" class="ps ol gu bf om pt pu dy oq pv pw ea ou nw px py pz oa qa qb qc oe qd qe qf qg bk">amsi.dll event tracing</h2><p id="65ca" class="pw-post-body-paragraph nl nm gu nn b no pi nq nr ns pj nu nv nw pk ny nz oa pl oc od oe pm og oh oi gn bk">You may have observed that Windows 10 has an AMSI/Operational event log that is typically empty. To understand why events are not logged to this event log, you would first have to inspect how data is fed to the AMSI ETW provider (<code class="cx po pp pq pr b">Microsoft-Antimalware-Scan-Interface - {2A576B87-09A7-520E-C21A-4942F0271D67}</code>) and then observe how the Application event log trace session (<code class="cx po pp pq pr b">EventLog-Application</code>) subscribes to the AMSI ETW provider. Let’s start by looking at the provider registration in the Application event log. The following PowerShell cmdlet will supply us with this information:</p><pre class="qh qi qj qk ql qm pr qn qo ay qp bk"><span id="b42d" class="ps ol gu pr b io qq qr l jd qs">&gt; <!-- -->Get-EtwTraceProvider -SessionName EventLog-Application -Guid &#x27;{2A576B87-09A7-520E-C21A-4942F0271D67}&#x27;</span><span id="b2e1" class="ps ol gu pr b io qt qr l jd qs">SessionName     : EventLog-Application<br/>Guid            : {2A576B87-09A7-520E-C21A-4942F0271D67}<br/>Level           : 255<br/>MatchAnyKeyword : 0x8000000000000000<br/>MatchAllKeyword : 0x0<br/>EnableProperty  : {EVENT_ENABLE_PROPERTY_ENABLE_KEYWORD_0, EVENT_ENABLE_PROPERTY_SID}</span></pre><p id="4c5c" class="pw-post-body-paragraph nl nm gu nn b no np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh oi gn bk">The following properties should be noted:</p><ul class=""><li id="669b" class="nl nm gu nn b no np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh oi qu qv qw bk">Operational channel events (as indicated by <code class="cx po pp pq pr b">0x8000000000000000</code> in the MatchAnyKeyword value) are captured.</li><li id="0c54" class="nl nm gu nn b no qx nq nr ns qy nu nv nw qz ny nz oa ra oc od oe rb og oh oi qu qv qw bk">All logging levels are captured.</li><li id="5b7a" class="nl nm gu nn b no qx nq nr ns qy nu nv nw qz ny nz oa ra oc od oe rb og oh oi qu qv qw bk">Events should be captured even if an event keyword value is zero as indicated by the <code class="cx po pp pq pr b">EVENT_ENABLE_PROPERTY_ENABLE_KEYWORD_0</code> flag.</li></ul><p id="3407" class="pw-post-body-paragraph nl nm gu nn b no np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh oi gn bk">This information on its own does not explain why AMSI events are not logged, but it supplies needed context upon inspecting how <code class="cx po pp pq pr b">amsi.dll</code> writes events to ETW. By loading <code class="cx po pp pq pr b">amsi.dl</code> into IDA, we can see that there was a single call to the <code class="cx po pp pq pr b">EventWrite</code> function within the internal <code class="cx po pp pq pr b">CAmsiAntimalware::GenerateEtwEvent</code> function:</p><figure class="qh qi qj qk ql nf mx my paragraph-image"><div class="mx my rl"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*YTbNASnN_A5biCyAfqUljQ.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*YTbNASnN_A5biCyAfqUljQ.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*YTbNASnN_A5biCyAfqUljQ.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*YTbNASnN_A5biCyAfqUljQ.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*YTbNASnN_A5biCyAfqUljQ.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*YTbNASnN_A5biCyAfqUljQ.png 1100w, https://miro.medium.com/v2/resize:fit:916/format:webp/1*YTbNASnN_A5biCyAfqUljQ.png 916w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 458px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*YTbNASnN_A5biCyAfqUljQ.png 640w, https://miro.medium.com/v2/resize:fit:720/1*YTbNASnN_A5biCyAfqUljQ.png 720w, https://miro.medium.com/v2/resize:fit:750/1*YTbNASnN_A5biCyAfqUljQ.png 750w, https://miro.medium.com/v2/resize:fit:786/1*YTbNASnN_A5biCyAfqUljQ.png 786w, https://miro.medium.com/v2/resize:fit:828/1*YTbNASnN_A5biCyAfqUljQ.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*YTbNASnN_A5biCyAfqUljQ.png 1100w, https://miro.medium.com/v2/resize:fit:916/1*YTbNASnN_A5biCyAfqUljQ.png 916w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 458px"/><img alt="" class="bh me nk c" width="458" height="522" loading="lazy" role="presentation"/></picture></div></figure><p id="b297" class="pw-post-body-paragraph nl nm gu nn b no np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh oi gn bk">The relevant portion of the call to <code class="cx po pp pq pr b">EventWrite</code> is the <code class="cx po pp pq pr b">EventDescriptor</code> argument. Upon applying the <code class="cx po pp pq pr b">EVENT_DESCRIPTOR</code> structure type to <code class="cx po pp pq pr b">_AMSI_SCANBUFFER</code>, the following information was interpreted:</p><figure class="qh qi qj qk ql nf mx my paragraph-image"><div class="mx my rc"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*khNJj2-2qqDn9hruBL5bZg.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*khNJj2-2qqDn9hruBL5bZg.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*khNJj2-2qqDn9hruBL5bZg.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*khNJj2-2qqDn9hruBL5bZg.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*khNJj2-2qqDn9hruBL5bZg.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*khNJj2-2qqDn9hruBL5bZg.png 1100w, https://miro.medium.com/v2/resize:fit:1248/format:webp/1*khNJj2-2qqDn9hruBL5bZg.png 1248w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 624px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*khNJj2-2qqDn9hruBL5bZg.png 640w, https://miro.medium.com/v2/resize:fit:720/1*khNJj2-2qqDn9hruBL5bZg.png 720w, https://miro.medium.com/v2/resize:fit:750/1*khNJj2-2qqDn9hruBL5bZg.png 750w, https://miro.medium.com/v2/resize:fit:786/1*khNJj2-2qqDn9hruBL5bZg.png 786w, https://miro.medium.com/v2/resize:fit:828/1*khNJj2-2qqDn9hruBL5bZg.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*khNJj2-2qqDn9hruBL5bZg.png 1100w, https://miro.medium.com/v2/resize:fit:1248/1*khNJj2-2qqDn9hruBL5bZg.png 1248w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 624px"/><img alt="" class="bh me nk c" width="624" height="136" loading="lazy" role="presentation"/></picture></div></figure><p id="9705" class="pw-post-body-paragraph nl nm gu nn b no np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh oi gn bk">The <code class="cx po pp pq pr b">EVENT_DESCRIPTOR</code> context gives us the relevant information:</p><ul class=""><li id="09f9" class="nl nm gu nn b no np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh oi qu qv qw bk">Event ID: <code class="cx po pp pq pr b">1101 (0x44D)<br/></code>This events details can be extracted from a recovered manifest as seen <a class="af oj" href="https://gist.github.com/mattifestation/6b3bbbea56cfc01bbfed9f74d94db618#file-microsoft-antimalware-scan-interface-manifest-xml-L12-L25" rel="noopener ugc nofollow" target="_blank">here</a>.</li><li id="4938" class="nl nm gu nn b no qx nq nr ns qy nu nv nw qz ny nz oa ra oc od oe rb og oh oi qu qv qw bk">Channel: <code class="cx po pp pq pr b">16 (0x10)</code> referring to the operational event log channel</li><li id="4725" class="nl nm gu nn b no qx nq nr ns qy nu nv nw qz ny nz oa ra oc od oe rb og oh oi qu qv qw bk">Level: 4 (Informational)</li><li id="90ff" class="nl nm gu nn b no qx nq nr ns qy nu nv nw qz ny nz oa ra oc od oe rb og oh oi qu qv qw bk">Keyword: <code class="cx po pp pq pr b">0x8000000000000001</code> (AMSI/Operational OR Event1). These values are interpreted by running the <code class="cx po pp pq pr b">logman query providers Microsoft-Antimalware-Scan-Interface</code> command.</li></ul><p id="e9c0" class="pw-post-body-paragraph nl nm gu nn b no np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh oi gn bk">We now understand that 1101 events not logged to the Application event log because it only considers events where the keyword value matches 0x8000000000000000. In order to fix this issue and get events pumping into the event log, either the Application event log trace session would need to be modified (not recommended and requires SYSTEM privileges) or you could create your own persistent trace session (e.g., an <a class="af oj" href="https://docs.microsoft.com/en-us/windows/desktop/etw/configuring-and-starting-an-autologger-session" rel="noopener ugc nofollow" target="_blank">autologger</a>) to capture AMSI events in the event log. The following PowerShell script creates such a trace session:</p><pre class="qh qi qj qk ql qm pr qn qo ay qp bk"><span id="065a" class="ps ol gu pr b io qq qr l jd qs">$AutoLoggerGuid = &quot;{$((New-Guid).Guid)}&quot;<br/>New-AutologgerConfig -Name MyCustomAutoLogger -Guid $AutoLoggerGuid -Start Enabled<br/>Add-EtwTraceProvider -AutologgerName MyCustomAutoLogger -Guid &#x27;{2A576B87-09A7-520E-C21A-4942F0271D67}&#x27; -Level 0xff -MatchAnyKeyword 0x80000000000001 -Property 0x41</span></pre><p id="49a9" class="pw-post-body-paragraph nl nm gu nn b no np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh oi gn bk">After running the above command, reboot, and the AMSI event log will begin to populate.</p><figure class="qh qi qj qk ql nf mx my paragraph-image"><div class="mx my rc"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*zegstKi6t8mJlwFYr6wFlA.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*zegstKi6t8mJlwFYr6wFlA.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*zegstKi6t8mJlwFYr6wFlA.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*zegstKi6t8mJlwFYr6wFlA.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*zegstKi6t8mJlwFYr6wFlA.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*zegstKi6t8mJlwFYr6wFlA.png 1100w, https://miro.medium.com/v2/resize:fit:1248/format:webp/1*zegstKi6t8mJlwFYr6wFlA.png 1248w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 624px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*zegstKi6t8mJlwFYr6wFlA.png 640w, https://miro.medium.com/v2/resize:fit:720/1*zegstKi6t8mJlwFYr6wFlA.png 720w, https://miro.medium.com/v2/resize:fit:750/1*zegstKi6t8mJlwFYr6wFlA.png 750w, https://miro.medium.com/v2/resize:fit:786/1*zegstKi6t8mJlwFYr6wFlA.png 786w, https://miro.medium.com/v2/resize:fit:828/1*zegstKi6t8mJlwFYr6wFlA.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*zegstKi6t8mJlwFYr6wFlA.png 1100w, https://miro.medium.com/v2/resize:fit:1248/1*zegstKi6t8mJlwFYr6wFlA.png 1248w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 624px"/><img alt="" class="bh me nk c" width="624" height="473" loading="lazy" role="presentation"/></picture></div></figure><p id="8515" class="pw-post-body-paragraph nl nm gu nn b no np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh oi gn bk">Some additional reverse engineering showed that the <code class="cx po pp pq pr b">scanResult</code> field refers to the <a class="af oj" href="https://docs.microsoft.com/en-us/windows/desktop/api/amsi/ne-amsi-amsi_result" rel="noopener ugc nofollow" target="_blank">AMSI_RESULT</a> enum where, in this case, 32768 maps to <code class="cx po pp pq pr b">AMSI_RESULT_DETECTED</code>, indicating that the buffer (the Unicode encoded buffer in the content field) was determined to be malicious.</p><p id="3692" class="pw-post-body-paragraph nl nm gu nn b no np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh oi gn bk">Without knowledge of ETW internals, a defender would not have been able to determine that additional data sources (the AMSI log in this case) can be fed into the event log. One would have to resort to speculation as to how the AMSI event became to be misconfigured and whether or not the misconfiguration was intentional.</p><h1 id="c59f" class="ok ol gu bf om on oo op oq or os ot ou ov ow ox oy oz pa pb pc pd pe pf pg ph bk">ETW tampering techniques</h1><p id="2b75" class="pw-post-body-paragraph nl nm gu nn b no pi nq nr ns pj nu nv nw pk ny nz oa pl oc od oe pm og oh oi gn bk">If the goal of an attacker is to subvert event logging, ETW provides a stealthy mechanism to affect logging without itself generating an event log trail. Below is a non-exhaustive list of tampering techniques that an attacker can use to cut off the supply of events to a specific event log.</p><p id="1acf" class="pw-post-body-paragraph nl nm gu nn b no np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh oi gn bk">Tampering techniques can generally be broken down into two categories:</p><ol class=""><li id="43f9" class="nl nm gu nn b no np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh oi rm qv qw bk">Persistent, requiring reboot — i.e., a reboot must occur before the attack takes effect. Changes can be reverted, but would require another reboot. These attacks involve altering <a class="af oj" href="https://docs.microsoft.com/en-us/windows/desktop/etw/configuring-and-starting-an-autologger-session" rel="noopener ugc nofollow" target="_blank">autologger</a> settings — persistent ETW trace sessions with settings in the registry. There are more types of persistent attacks than ephemeral attacks, and they are usually more straightforward to detect.</li><li id="5bbd" class="nl nm gu nn b no qx nq nr ns qy nu nv nw qz ny nz oa ra oc od oe rb og oh oi rm qv qw bk">Ephemeral — i.e., where the attack can take place without a reboot.</li></ol><h2 id="e24f" class="ps ol gu bf om pt pu dy oq pv pw ea ou nw px py pz oa qa qb qc oe qd qe qf qg bk">Autologger provider removal</h2><p id="ed5c" class="pw-post-body-paragraph nl nm gu nn b no pi nq nr ns pj nu nv nw pk ny nz oa pl oc od oe pm og oh oi gn bk"><strong class="nn gv">Tampering category</strong>: Persistent, requiring reboot<br/><strong class="nn gv">Minimum permissions required</strong>: Administrator<br/><strong class="nn gv">Detection artifacts</strong>: Registry key deletion: <code class="cx po pp pq pr b">HKLM\SYSTEM\CurrentControlSet\Control\WMI\Autologger\AUTOLOGGER_NAME\{PROVIDER_GUID}</code><br/><br/><strong class="nn gv">Description</strong>: This technique involves the removal of a provider entry from a configured autologger. Removing a provider registration from an autologger will cause events to cease to flow to the respective trace session.<br/> <br/><strong class="nn gv">Example</strong>: The following PowerShell code disables Microsoft-Windows-PowerShell event logging:</p><pre class="qh qi qj qk ql qm pr qn qo ay qp bk"><span id="d85f" class="ps ol gu pr b io qq qr l jd qs">Remove-EtwTraceProvider -AutologgerName EventLog-Application -Guid &#x27;{A0C1853B-5C40-4B15-8766-3CF1C58F985A}&#x27;</span></pre><p id="a4df" class="pw-post-body-paragraph nl nm gu nn b no np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh oi gn bk">In the above example, <code class="cx po pp pq pr b">A0C1853B-5C40-4B15-8766-3CF1C58F985A</code> refers to the Microsoft-Windows-PowerShell ETW provider. This command will end up deleting the <code class="cx po pp pq pr b">HKLM\System\CurrentControlSet\Control\WMI\Autologger\EventLog-Application\{a0c1853b-5c40-4b15-8766-3cf1c58f985a}</code> registry key.</p><h2 id="29b9" class="ps ol gu bf om pt pu dy oq pv pw ea ou nw px py pz oa qa qb qc oe qd qe qf qg bk">Provider “Enable” property modification</h2><p id="8f0e" class="pw-post-body-paragraph nl nm gu nn b no pi nq nr ns pj nu nv nw pk ny nz oa pl oc od oe pm og oh oi gn bk"><strong class="nn gv">Tampering category</strong>: Persistent, requiring reboot<br/><strong class="nn gv">Minimum permissions required</strong>: Administrator<br/><strong class="nn gv">Detection artifacts</strong>: Registry value modification: <code class="cx po pp pq pr b">HKLM\SYSTEM\CurrentControlSet\Control\WMI\Autologger\AUTOLOGGER_NAME\{PROVIDER_GUID} - EnableProperty (REG_DWORD)</code><br/><br/><strong class="nn gv">Description</strong>: This technique involves alerting the <code class="cx po pp pq pr b">Enable</code> keyword of an autologger session. For example, by default, all ETW provider entries in the <code class="cx po pp pq pr b">EventLog-Application</code> autologger session are set to <code class="cx po pp pq pr b">0x41</code> which translates to <code class="cx po pp pq pr b">EVENT_ENABLE_PROPERTY_SID</code> and <code class="cx po pp pq pr b">EVENT_ENABLE_PROPERTY_ENABLE_KEYWORD_0</code>. <code class="cx po pp pq pr b">EVENT_ENABLE_PROPERTY_ENABLE_KEYWORD_0</code> is not documented; it specifies that any events generated for a provider should be logged even if the keyword value is set to 0. An attacker could swap out <code class="cx po pp pq pr b">EVENT_ENABLE_PROPERTY_ENABLE_KEYWORD_0</code> for <code class="cx po pp pq pr b">EVENT_ENABLE_PROPERTY_IGNORE_KEYWORD_0</code>, resulting in a value of <code class="cx po pp pq pr b">0x11</code>, which would result in all events where the keyword is 0 to not be logged. For example, PowerShell eventing supplies a 0 keyword value with its events, resulting in no logging to the PowerShell event log.<br/><br/><strong class="nn gv">Example</strong>: The following PowerShell code disables Microsoft-Windows-PowerShell event logging:</p><pre class="qh qi qj qk ql qm pr qn qo ay qp bk"><span id="f97c" class="ps ol gu pr b io qq qr l jd qs">Set-EtwTraceProvider -Guid &#x27;{A0C1853B-5C40-4B15-8766-3CF1C58F985A}&#x27; -AutologgerName &#x27;EventLog-Application&#x27; -Property 0x11</span></pre><p id="2d75" class="pw-post-body-paragraph nl nm gu nn b no np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh oi gn bk">In the above example, <code class="cx po pp pq pr b">A0C1853B-5C40-4B15-8766-3CF1C58F985A</code> refers to the Microsoft-Windows-PowerShell ETW provider. This command will end up setting <code class="cx po pp pq pr b">HKLM\System\CurrentControlSet\Control\WMI\Autologger\EventLog-Application\{a0c1853b-5c40-4b15-8766-3cf1c58f985a}\EnableProperty</code> to <code class="cx po pp pq pr b">0x11</code>. Upon rebooting, events will cease to be reported to the PowerShell event log.<br/> <br/>An attacker is not constrained to using just the <a class="af oj" href="https://docs.microsoft.com/en-us/powershell/module/eventtracmancmdlets/set-etwtraceprovider?view=win10-ps" rel="noopener ugc nofollow" target="_blank">Set-EtwTraceProvider</a> cmdlet to carry out this attack. An attacker could just modify the value directly in the registry. <code class="cx po pp pq pr b">Set-EtwTraceProvider</code> offers a convenient autologger configuration abstraction.<br/><br/><strong class="nn gv">Alternative detection artifacts/ideas</strong>: If possible, it is advisable to monitor for modifications of values within the <code class="cx po pp pq pr b">HKLM\SYSTEM\CurrentControlSet\Control\WMI\Autologger\AUTOLOGGER_NAME\{PROVIDER_GUID}</code> registry key. Note that modifying <code class="cx po pp pq pr b">EnableProperty</code> is just one specific example and that an attacker can alter ETW providers in other ways, too.</p><h2 id="8e57" class="ps ol gu bf om pt pu dy oq pv pw ea ou nw px py pz oa qa qb qc oe qd qe qf qg bk">ETW provider removal from a trace session</h2><p id="cc05" class="pw-post-body-paragraph nl nm gu nn b no pi nq nr ns pj nu nv nw pk ny nz oa pl oc od oe pm og oh oi gn bk"><strong class="nn gv">Tampering category</strong>: Ephemeral<br/><strong class="nn gv">Minimum permissions required</strong>: SYSTEM<br/><strong class="nn gv">Detection artifacts</strong>: Unfortunately, no file, registry, or event log artifacts are associated with this event. While the technique example below indicates that <code class="cx po pp pq pr b">logman.exe</code> was used to perform the attack, an attacker can obfuscate their techniques by using Win32 APIs directly, WMI, DCOM, PowerShell, etc.<br/> <br/><strong class="nn gv">Description</strong>: This technique involves removing an ETW provider from a trace session, cutting off its ability to supply a targeted event log with events until a reboot occurs, or until the attacker restores the provider. While an attacker must have SYSTEM privileges to perform this attack, it is unlikely that defenders will notice such an attack if they rely on event logs for threat detection.<br/> <br/><strong class="nn gv">Example</strong>: The following PowerShell code immediately disables Microsoft-Windows-PowerShell event logging until a reboot occurs or the attacker restores the ETW provider:</p><pre class="qh qi qj qk ql qm pr qn qo ay qp bk"><span id="e273" class="ps ol gu pr b io qq qr l jd qs">logman update trace EventLog-Application --p Microsoft-Windows-PowerShell -ets</span></pre><p id="e3c5" class="pw-post-body-paragraph nl nm gu nn b no np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh oi gn bk"><strong class="nn gv">Alternative detection artifacts/ideas</strong>:</p><ul class=""><li id="06e4" class="nl nm gu nn b no np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh oi qu qv qw bk">Event ID 12 within the Microsoft-Windows-Kernel-EventTracing/Analytic log indicates when a trace session is modified, but it doesn’t supply the provider name or GUID that was removed, so it would be difficult to confidently determine whether or not something suspicious occurred using this event.</li><li id="aefa" class="nl nm gu nn b no qx nq nr ns qy nu nv nw qz ny nz oa ra oc od oe rb og oh oi qu qv qw bk">There have been several references thus far to the ETW PowerShell cmdlets housed in the <code class="cx po pp pq pr b">EventTracingManagement</code> module, which itself is a CDXML-based module. This means that all the cmdlets in the <code class="cx po pp pq pr b">EventTracingManagement</code> are backed by WMI classes. For example, the <code class="cx po pp pq pr b">Get-EtwTraceProvider</code> cmdlet is backed by the <code class="cx po pp pq pr b">ROOT/Microsoft/Windows/EventTracingManagement:MSFT_EtwTraceProvider</code> class. Considering ETW providers can be represented in the form of WMI class instances, you could craft a permanent WMI event subscription that logs all provider removals from a specific trace session to the event log. <a class="af oj" href="https://gist.github.com/mattifestation/9f07e4ab0df84cfd176fe40db2d60aa8" rel="noopener ugc nofollow" target="_blank">This code sample</a> creates an <code class="cx po pp pq pr b">NtEventLogEventConsumer</code> instance that logs event ID 8 to the Application event log (source: WSH) any time a provider is removed from the Application event log trace session, <code class="cx po pp pq pr b">EventLog-Application</code>. The logged event looks like the following:</li></ul><figure class="qh qi qj qk ql nf mx my paragraph-image"><div class="mx my rn"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/1*6fkfDWJ2pSt7lOh1g77gmg.png 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/1*6fkfDWJ2pSt7lOh1g77gmg.png 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/1*6fkfDWJ2pSt7lOh1g77gmg.png 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/1*6fkfDWJ2pSt7lOh1g77gmg.png 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/1*6fkfDWJ2pSt7lOh1g77gmg.png 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/1*6fkfDWJ2pSt7lOh1g77gmg.png 1100w, https://miro.medium.com/v2/resize:fit:1068/format:webp/1*6fkfDWJ2pSt7lOh1g77gmg.png 1068w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 534px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/1*6fkfDWJ2pSt7lOh1g77gmg.png 640w, https://miro.medium.com/v2/resize:fit:720/1*6fkfDWJ2pSt7lOh1g77gmg.png 720w, https://miro.medium.com/v2/resize:fit:750/1*6fkfDWJ2pSt7lOh1g77gmg.png 750w, https://miro.medium.com/v2/resize:fit:786/1*6fkfDWJ2pSt7lOh1g77gmg.png 786w, https://miro.medium.com/v2/resize:fit:828/1*6fkfDWJ2pSt7lOh1g77gmg.png 828w, https://miro.medium.com/v2/resize:fit:1100/1*6fkfDWJ2pSt7lOh1g77gmg.png 1100w, https://miro.medium.com/v2/resize:fit:1068/1*6fkfDWJ2pSt7lOh1g77gmg.png 1068w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 534px"/><img alt="" class="bh me nk c" width="534" height="300" loading="lazy" role="presentation"/></picture></div></figure><ul class=""><li id="dd41" class="nl nm gu nn b no np nq nr ns nt nu nv nw nx ny nz oa ob oc od oe of og oh oi qu qv qw bk">The frequency at which providers are removed from Application event logs in large environments is not currently known. As as fallback, it is still advised to log the execution of <code class="cx po pp pq pr b">logman.exe</code>, <code class="cx po pp pq pr b">wpr.exe</code>, and PowerShell in your environment.</li></ul><h1 id="5c57" class="ok ol gu bf om on oo op oq or os ot ou ov ow ox oy oz pa pb pc pd pe pf pg ph bk">Conclusion</h1><p id="f4c1" class="pw-post-body-paragraph nl nm gu nn b no pi nq nr ns pj nu nv nw pk ny nz oa pl oc od oe pm og oh oi gn bk">Identifying blind spots and assumptions in Alerting and Detection Strategies is a crucial step in ensuring the resilience of detections. Since ETW is at the core of the event logging infrastructure, gaining an in-depth understanding of ETW tampering attacks is a valuable way to increase the integrity of security-related data sources.</p><h1 id="0c7b" class="ok ol gu bf om on oo op oq or os ot ou ov ow ox oy oz pa pb pc pd pe pf pg ph bk">Further Reading</h1><ul class=""><li id="858b" class="nl nm gu nn b no pi nq nr ns pj nu nv nw pk ny nz oa pl oc od oe pm og oh oi qu qv qw bk"><a class="af oj" href="https://blogs.msdn.microsoft.com/dcook/2015/09/30/etw-overview/" rel="noopener ugc nofollow" target="_blank">ETW — Overview</a></li><li id="58fa" class="nl nm gu nn b no qx nq nr ns qy nu nv nw qz ny nz oa ra oc od oe rb og oh oi qu qv qw bk"><a class="af oj" href="https://docs.microsoft.com/en-us/windows-hardware/test/weg/instrumenting-your-code-with-etw" rel="noopener ugc nofollow" target="_blank">Instrumenting Your Code with ETW</a></li><li id="4408" class="nl nm gu nn b no qx nq nr ns qy nu nv nw qz ny nz oa ra oc od oe rb og oh oi qu qv qw bk"><a class="af oj" href="https://www.codeproject.com/Articles/1190759/Event-Tracing-for-Windows-Reducing-Everest-to-Pike" rel="noopener ugc nofollow" target="_blank">Event Tracing for Windows: Reducing Everest to Pike’s Peak</a></li><li id="dfc8" class="nl nm gu nn b no qx nq nr ns qy nu nv nw qz ny nz oa ra oc od oe rb og oh oi qu qv qw bk"><a class="af oj" href="https://blogs.msdn.microsoft.com/seealso/2011/06/08/use-this-not-this-logging-event-tracing/" rel="noopener ugc nofollow" target="_blank">Use this not this: Logging / Event Tracing</a></li><li id="94aa" class="nl nm gu nn b no qx nq nr ns qy nu nv nw qz ny nz oa ra oc od oe rb og oh oi qu qv qw bk"><a class="af oj" href="https://docs.microsoft.com/en-us/windows/desktop/wes/writing-an-instrumentation-manifest" rel="noopener ugc nofollow" target="_blank">Writing an Instrumentation Manifest</a></li><li id="9be1" class="nl nm gu nn b no qx nq nr ns qy nu nv nw qz ny nz oa ra oc od oe rb og oh oi qu qv qw bk"><a class="af oj" href="https://docs.microsoft.com/en-us/windows/desktop/etw/event-tracing-functions" rel="noopener ugc nofollow" target="_blank">Event Tracing Functions</a></li><li id="1294" class="nl nm gu nn b no qx nq nr ns qy nu nv nw qz ny nz oa ra oc od oe rb og oh oi qu qv qw bk"><a class="af oj" href="https://docs.microsoft.com/en-us/windows/desktop/ETW/configuring-and-starting-an-autologger-session" rel="noopener ugc nofollow" target="_blank">Configuring and Starting an AutoLogger Session</a></li><li id="d342" class="nl nm gu nn b no qx nq nr ns qy nu nv nw qz ny nz oa ra oc od oe rb og oh oi qu qv qw bk"><a class="af oj" href="https://docs.microsoft.com/en-us/windows/desktop/etw/event-tracing-portal" rel="noopener ugc nofollow" target="_blank">Event Tracing</a></li><li id="6da2" class="nl nm gu nn b no qx nq nr ns qy nu nv nw qz ny nz oa ra oc od oe rb og oh oi qu qv qw bk"><a class="af oj" href="https://docs.microsoft.com/en-us/windows/desktop/tracelogging/trace-logging-portal" rel="noopener ugc nofollow" target="_blank">TraceLogging</a></li></ul></div></div></div><div class="ab cb ro rp rq rr" role="separator"><span class="rs by bm rt ru rv"></span><span class="rs by bm rt ru rv"></span><span class="rs by bm rt ru"></span></div><div class="gn go gp gq gr"><div class="ab cb"><div class="ci bh fz ga gb gc"><h1 id="19bb" class="ok ol gu bf om on rw op oq or rx ot ou ov ry ox oy oz rz pb pc pd sa pf pg ph bk">Authors</h1><p id="c3c9" class="pw-post-body-paragraph nl nm gu nn b no pi nq nr ns pj nu nv nw pk ny nz oa pl oc od oe pm og oh oi gn bk">Matt G.</p></div></div></div></div></section></div></div></article></div><div class="ab cb"><div class="ci bh fz ga gb gc"><div class="sb sc ab ja"><div class="sd ab"><a class="se ay am ao" href="https://medium.com/tag/palantirtech?source=post_page-----4be7ac62ac63--------------------------------" rel="noopener follow"><div class="sf fj cx sg ge sh si bf b bg z bk sj">Palantirtech</div></a></div><div class="sd ab"><a class="se ay am ao" href="https://medium.com/tag/infosec?source=post_page-----4be7ac62ac63--------------------------------" rel="noopener follow"><div class="sf fj cx sg ge sh si bf b bg z bk sj">Infosec</div></a></div><div class="sd ab"><a class="se ay am ao" href="https://medium.com/tag/windows?source=post_page-----4be7ac62ac63--------------------------------" rel="noopener follow"><div class="sf fj cx sg ge sh si bf b bg z bk sj">Windows</div></a></div><div class="sd ab"><a class="se ay am ao" href="https://medium.com/tag/incident-response?source=post_page-----4be7ac62ac63--------------------------------" rel="noopener follow"><div class="sf fj cx sg ge sh si bf b bg z bk sj">Incident Response</div></a></div><div class="sd ab"><a class="se ay am ao" href="https://medium.com/tag/cybersecurity?source=post_page-----4be7ac62ac63--------------------------------" rel="noopener follow"><div class="sf fj cx sg ge sh si bf b bg z bk sj">Cybersecurity</div></a></div></div></div></div><div class="l"></div><footer class="sk sl sm sn so sp sq sr ss ab q st ik c"><div class="l ae"><div class="ab cb"><div class="ci bh fz ga gb gc"><div class="ab cp su"><div class="ab q kv"><div class="sv l"><span class="l sw sx sy e d"><div class="ab q kv kw"><div class="pw-multi-vote-icon fj je kx ky kz"><span><a class="af ag ah ai aj ak al am an ao ap aq ar as at" data-testid="footerClapButton" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Fpalantir%2F4be7ac62ac63&amp;operation=register&amp;redirect=https%3A%2F%2Fblog.palantir.com%2Ftampering-with-windows-event-tracing-background-offense-and-defense-4be7ac62ac63&amp;user=Palantir&amp;userId=1529195d9f13&amp;source=-----4be7ac62ac63---------------------clap_footer-----------" rel="noopener follow"><div><div class="bm" aria-hidden="false"><div class="la ao lb lc ld le am lf lg lh kz"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM13.916 3.953l1.523-2.112-1.184-.39zM8.589 1.84l1.522 2.112-.337-2.501zM18.523 18.92c-.86.86-1.75 1.246-2.62 1.33a6 6 0 0 0 .407-.372c2.388-2.389 2.86-4.951 1.399-7.623l-.912-1.603-.79-1.672c-.26-.56-.194-.98.203-1.288a.7.7 0 0 1 .546-.132c.283.046.546.231.728.5l2.363 4.157c.976 1.624 1.141 4.237-1.324 6.702m-10.999-.438L3.37 14.328a.828.828 0 0 1 .585-1.408.83.83 0 0 1 .585.242l2.158 2.157a.365.365 0 0 0 .516-.516l-2.157-2.158-1.449-1.449a.826.826 0 0 1 1.167-1.17l3.438 3.44a.363.363 0 0 0 .516 0 .364.364 0 0 0 0-.516L5.293 9.513l-.97-.97a.826.826 0 0 1 0-1.166.84.84 0 0 1 1.167 0l.97.968 3.437 3.436a.36.36 0 0 0 .517 0 .366.366 0 0 0 0-.516L6.977 7.83a.82.82 0 0 1-.241-.584.82.82 0 0 1 .824-.826c.219 0 .43.087.584.242l5.787 5.787a.366.366 0 0 0 .587-.415l-1.117-2.363c-.26-.56-.194-.98.204-1.289a.7.7 0 0 1 .546-.132c.283.046.545.232.727.501l2.193 3.86c1.302 2.38.883 4.59-1.277 6.75-1.156 1.156-2.602 1.627-4.19 1.367-1.418-.236-2.866-1.033-4.079-2.246M10.75 5.971l2.12 2.12c-.41.502-.465 1.17-.128 1.89l.22.465-3.523-3.523a.8.8 0 0 1-.097-.368c0-.22.086-.428.241-.584a.847.847 0 0 1 1.167 0m7.355 1.705c-.31-.461-.746-.758-1.23-.837a1.44 1.44 0 0 0-1.11.275c-.312.24-.505.543-.59.881a1.74 1.74 0 0 0-.906-.465 1.47 1.47 0 0 0-.82.106l-2.182-2.182a1.56 1.56 0 0 0-2.2 0 1.54 1.54 0 0 0-.396.701 1.56 1.56 0 0 0-2.21-.01 1.55 1.55 0 0 0-.416.753c-.624-.624-1.649-.624-2.237-.037a1.557 1.557 0 0 0 0 2.2c-.239.1-.501.238-.715.453a1.56 1.56 0 0 0 0 2.2l.516.515a1.556 1.556 0 0 0-.753 2.615L7.01 19c1.32 1.319 2.909 2.189 4.475 2.449q.482.08.971.08c.85 0 1.653-.198 2.393-.579.231.033.46.054.686.054 1.266 0 2.457-.52 3.505-1.567 2.763-2.763 2.552-5.734 1.439-7.586z" clip-rule="evenodd"></path></svg></div></div></div></a></span></div><div class="pw-multi-vote-count l li lj lk ll lm ln lo"><p class="bf b dv z du"><span class="lp">--</span></p></div></div></span><span class="l h g f sz ta"><div class="ab q kv kw"><div class="pw-multi-vote-icon fj je kx ky kz"><span><a class="af ag ah ai aj ak al am an ao ap aq ar as at" data-testid="footerClapButton" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Fpalantir%2F4be7ac62ac63&amp;operation=register&amp;redirect=https%3A%2F%2Fblog.palantir.com%2Ftampering-with-windows-event-tracing-background-offense-and-defense-4be7ac62ac63&amp;user=Palantir&amp;userId=1529195d9f13&amp;source=-----4be7ac62ac63---------------------clap_footer-----------" rel="noopener follow"><div><div class="bm" aria-hidden="false"><div class="la ao lb lc ld le am lf lg lh kz"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM13.916 3.953l1.523-2.112-1.184-.39zM8.589 1.84l1.522 2.112-.337-2.501zM18.523 18.92c-.86.86-1.75 1.246-2.62 1.33a6 6 0 0 0 .407-.372c2.388-2.389 2.86-4.951 1.399-7.623l-.912-1.603-.79-1.672c-.26-.56-.194-.98.203-1.288a.7.7 0 0 1 .546-.132c.283.046.546.231.728.5l2.363 4.157c.976 1.624 1.141 4.237-1.324 6.702m-10.999-.438L3.37 14.328a.828.828 0 0 1 .585-1.408.83.83 0 0 1 .585.242l2.158 2.157a.365.365 0 0 0 .516-.516l-2.157-2.158-1.449-1.449a.826.826 0 0 1 1.167-1.17l3.438 3.44a.363.363 0 0 0 .516 0 .364.364 0 0 0 0-.516L5.293 9.513l-.97-.97a.826.826 0 0 1 0-1.166.84.84 0 0 1 1.167 0l.97.968 3.437 3.436a.36.36 0 0 0 .517 0 .366.366 0 0 0 0-.516L6.977 7.83a.82.82 0 0 1-.241-.584.82.82 0 0 1 .824-.826c.219 0 .43.087.584.242l5.787 5.787a.366.366 0 0 0 .587-.415l-1.117-2.363c-.26-.56-.194-.98.204-1.289a.7.7 0 0 1 .546-.132c.283.046.545.232.727.501l2.193 3.86c1.302 2.38.883 4.59-1.277 6.75-1.156 1.156-2.602 1.627-4.19 1.367-1.418-.236-2.866-1.033-4.079-2.246M10.75 5.971l2.12 2.12c-.41.502-.465 1.17-.128 1.89l.22.465-3.523-3.523a.8.8 0 0 1-.097-.368c0-.22.086-.428.241-.584a.847.847 0 0 1 1.167 0m7.355 1.705c-.31-.461-.746-.758-1.23-.837a1.44 1.44 0 0 0-1.11.275c-.312.24-.505.543-.59.881a1.74 1.74 0 0 0-.906-.465 1.47 1.47 0 0 0-.82.106l-2.182-2.182a1.56 1.56 0 0 0-2.2 0 1.54 1.54 0 0 0-.396.701 1.56 1.56 0 0 0-2.21-.01 1.55 1.55 0 0 0-.416.753c-.624-.624-1.649-.624-2.237-.037a1.557 1.557 0 0 0 0 2.2c-.239.1-.501.238-.715.453a1.56 1.56 0 0 0 0 2.2l.516.515a1.556 1.556 0 0 0-.753 2.615L7.01 19c1.32 1.319 2.909 2.189 4.475 2.449q.482.08.971.08c.85 0 1.653-.198 2.393-.579.231.033.46.054.686.054 1.266 0 2.457-.52 3.505-1.567 2.763-2.763 2.552-5.734 1.439-7.586z" clip-rule="evenodd"></path></svg></div></div></div></a></span></div><div class="pw-multi-vote-count l li lj lk ll lm ln lo"><p class="bf b dv z du"><span class="lp">--</span></p></div></div></span></div><div class="bq ab"><div><div class="bm" aria-hidden="false"><button class="ao la ls lt ab q fk lu lv" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="lr"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"></path></svg><p class="bf b bg z du"><span class="pw-responses-count lq lr">1</span></p></button></div></div></div></div><div class="ab q"><div class="rv l ix"><div><div class="bm" aria-hidden="false"><span><a class="af ag ah ai aj ak al am an ao ap aq ar as at" data-testid="footerBookmarkButton" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F4be7ac62ac63&amp;operation=register&amp;redirect=https%3A%2F%2Fblog.palantir.com%2Ftampering-with-windows-event-tracing-background-offense-and-defense-4be7ac62ac63&amp;source=--------------------------bookmark_footer-----------" rel="noopener follow"><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="none" viewBox="0 0 25 25" class="du lx" aria-label="Add to list bookmark button"><path fill="currentColor" d="M18 2.5a.5.5 0 0 1 1 0V5h2.5a.5.5 0 0 1 0 1H19v2.5a.5.5 0 1 1-1 0V6h-2.5a.5.5 0 0 1 0-1H18zM7 7a1 1 0 0 1 1-1h3.5a.5.5 0 0 0 0-1H8a2 2 0 0 0-2 2v14a.5.5 0 0 0 .805.396L12.5 17l5.695 4.396A.5.5 0 0 0 19 21v-8.5a.5.5 0 0 0-1 0v7.485l-5.195-4.012a.5.5 0 0 0-.61 0L7 19.985z"></path></svg></a></span></div></div></div><div class="rv l ix"><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="footerSocialShareButton" class="af fk ah ai aj ak al mf an ao ap ex mg mh lv mi"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"></path></svg></button></div></div></div></div></div></div></div></div></div></footer><div class="tb tc td te tf l bx"><div class="ab cb"><div class="ci bh fz ga gb gc"><div class="cl ab tg cp"><div class="ab ia"><a href="https://palantir.medium.com/?source=post_page-----4be7ac62ac63--------------------------------" rel="noopener follow"><div class="l th ti by tj ie"><div class="l fj"><img alt="Palantir" class="l fd by tk tl cx" src="https://miro.medium.com/v2/resize:fill:144:144/1*yFp1VmXHPcrYrYrDNlD_7A.png" width="72" height="72" loading="lazy"/><div class="if by l tk tl fs n ig ft"></div></div></div></a><a href="https://blog.palantir.com/?source=post_page-----4be7ac62ac63--------------------------------" rel="noopener follow"><div class="tm ab fj"><div><div class="bm" aria-hidden="false"><div class="l tn to by tj ik"><div class="l fj"><img alt="Palantir Blog" class="l fd by bz ca cx" src="https://miro.medium.com/v2/resize:fill:64:64/1*PbgkHC0TD-x4rvptc-w3jg.png" width="32" height="32" loading="lazy"/><div class="if by l bz ca fs n ig ft"></div></div></div></div></div></div></a></div><div class="j i d"><div class="ab"><span><a class="bf b bg z tp sf tq tr ts tt tu ev ew tv tw tx fa au fb fc fd bm fe ff" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F1529195d9f13&amp;operation=register&amp;redirect=https%3A%2F%2Fblog.palantir.com%2Ftampering-with-windows-event-tracing-background-offense-and-defense-4be7ac62ac63&amp;user=Palantir&amp;userId=1529195d9f13&amp;source=post_page-1529195d9f13----4be7ac62ac63---------------------follow_profile-----------" rel="noopener follow">Follow</a></span><div class="dt l"><div><div><div class="bm" aria-hidden="false"><div class="l"><span><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F558633e535cb&amp;operation=register&amp;redirect=https%3A%2F%2Fblog.palantir.com%2Ftampering-with-windows-event-tracing-background-offense-and-defense-4be7ac62ac63&amp;newsletterV3=1529195d9f13&amp;newsletterV3Id=558633e535cb&amp;user=Palantir&amp;userId=1529195d9f13&amp;source=-----4be7ac62ac63---------------------subscribe_user-----------" rel="noopener follow"><button class="bf b bg z tz am ua qp ub uc ud ue uf ug ew tv tw tx fa fb fc fd bm fe ff" aria-label="Subscribe"><svg xmlns="http://www.w3.org/2000/svg" width="38" height="38" fill="none" viewBox="0 0 38 38" class="ty to tn"><rect width="0.5" height="6.5" x="26.25" y="9.25" rx="0.25"></rect><rect width="0.5" height="6.5" x="29.75" y="12.25" rx="0.25" transform="rotate(90 29.75 12.25)"></rect><path d="M19.5 12.5h-7a1 1 0 0 0-1 1v11a1 1 0 0 0 1 1h13a1 1 0 0 0 1-1v-5"></path><path d="M11.5 14.5 19 20l4-3"></path></svg></button></a></span></div></div></div></div></div></div></div></div><div class="ab cn cp"><div class="l"><div class="ab q"><a class="af ag ah ai aj ak al am an ao ap aq ar as at ab q" href="https://palantir.medium.com/?source=post_page-----4be7ac62ac63--------------------------------" rel="noopener follow"><h2 class="pw-author-name bf uh ui uj uk bk"><span class="gn jo">Written by <!-- -->Palantir</span></h2></a></div><div class="sd ab"><div class="l ix"><span class="pw-follower-count bf b bg z bk"><a class="af ag ah ai aj ak al am an ao ap aq ar iq" href="https://palantir.medium.com/followers?source=post_page-----4be7ac62ac63--------------------------------" rel="noopener follow">12.1K Followers</a></span></div><div class="bf b bg z jf jg jh ab jj jk jl jm du jd"><span class="ir l" aria-hidden="true"><span class="bf b bg z du">·</span></span><span class="l ix">Editor for </span><div><div class="l" aria-hidden="false"><a class="af ag ah ai aj ak al am an ao ap aq ar iq ab q" href="https://blog.palantir.com/?source=post_page-----4be7ac62ac63--------------------------------" rel="noopener follow"><p class="bf b bg z jf jg jh ji jj jk jl jm bk">Palantir Blog</p></a></div></div></div></div><div class="ul l"></div></div><div class="h k"><div class="ab"><span><a class="bf b bg z tp sf tq tr ts tt tu ev ew tv tw tx fa au fb fc fd bm fe ff" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2F1529195d9f13&amp;operation=register&amp;redirect=https%3A%2F%2Fblog.palantir.com%2Ftampering-with-windows-event-tracing-background-offense-and-defense-4be7ac62ac63&amp;user=Palantir&amp;userId=1529195d9f13&amp;source=post_page-1529195d9f13----4be7ac62ac63---------------------follow_profile-----------" rel="noopener follow">Follow</a></span><div class="dt l"><div><div><div class="bm" aria-hidden="false"><div class="l"><span><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://medium.com/m/signin?actionUrl=%2F_%2Fapi%2Fsubscriptions%2Fnewsletters%2F558633e535cb&amp;operation=register&amp;redirect=https%3A%2F%2Fblog.palantir.com%2Ftampering-with-windows-event-tracing-background-offense-and-defense-4be7ac62ac63&amp;newsletterV3=1529195d9f13&amp;newsletterV3Id=558633e535cb&amp;user=Palantir&amp;userId=1529195d9f13&amp;source=-----4be7ac62ac63---------------------subscribe_user-----------" rel="noopener follow"><button class="bf b bg z tz am ua qp ub uc ud ue uf ug ew tv tw tx fa fb fc fd bm fe ff" aria-label="Subscribe"><svg xmlns="http://www.w3.org/2000/svg" width="38" height="38" fill="none" viewBox="0 0 38 38" class="ty to tn"><rect width="0.5" height="6.5" x="26.25" y="9.25" rx="0.25"></rect><rect width="0.5" height="6.5" x="29.75" y="12.25" rx="0.25" transform="rotate(90 29.75 12.25)"></rect><path d="M19.5 12.5h-7a1 1 0 0 0-1 1v11a1 1 0 0 0 1 1h13a1 1 0 0 0 1-1v-5"></path><path d="M11.5 14.5 19 20l4-3"></path></svg></button></a></span></div></div></div></div></div></div></div></div><div class="um bh un na nb nc nd ne"></div></div></div><div class="h k j"><div class="um bh un uo"></div><div class="ab cb"><div class="ci bh fz ga gb gc"><div class="up ab kv ja"><div class="uq ur l"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://help.medium.com/hc/en-us?source=post_page-----4be7ac62ac63--------------------------------" rel="noopener follow"><p class="bf b dv z du">Help</p></a></div><div class="uq ur l"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://medium.statuspage.io/?source=post_page-----4be7ac62ac63--------------------------------" rel="noopener follow"><p class="bf b dv z du">Status</p></a></div><div class="uq ur l"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://medium.com/about?autoplay=1&amp;source=post_page-----4be7ac62ac63--------------------------------" rel="noopener follow"><p class="bf b dv z du">About</p></a></div><div class="uq ur l"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=post_page-----4be7ac62ac63--------------------------------" rel="noopener follow"><p class="bf b dv z du">Careers</p></a></div><div class="uq ur l"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="pressinquiries@medium.com?source=post_page-----4be7ac62ac63--------------------------------" rel="noopener follow"><p class="bf b dv z du">Press</p></a></div><div class="uq ur l"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://blog.medium.com/?source=post_page-----4be7ac62ac63--------------------------------" rel="noopener follow"><p class="bf b dv z du">Blog</p></a></div><div class="uq ur l"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----4be7ac62ac63--------------------------------" rel="noopener follow"><p class="bf b dv z du">Privacy</p></a></div><div class="uq ur l"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----4be7ac62ac63--------------------------------" rel="noopener follow"><p class="bf b dv z du">Terms</p></a></div><div class="uq ur l"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://speechify.com/medium?source=post_page-----4be7ac62ac63--------------------------------" rel="noopener follow"><p class="bf b dv z du">Text to speech</p></a></div><div class="uq l"><a class="af ag ah ai aj ak al am an ao ap aq ar as at" href="https://medium.com/business?source=post_page-----4be7ac62ac63--------------------------------" rel="noopener follow"><p class="bf b dv z du">Teams</p></a></div></div></div></div></div></div></div></div></div></div><script>window.__BUILD_ID__="main-20241017-182126-a0128a89d2"</script><script>window.__GRAPHQL_URI__ = "https://blog.palantir.com/_/graphql"</script><script>window.__PRELOADED_STATE__ = {"algolia":{"queries":{}},"cache":{"experimentGroupSet":true,"reason":"This request is not using the cache middleware worker","group":"disabled","tags":["group-edgeCachePosts","post-4be7ac62ac63","user-1529195d9f13","collection-3c87dc14372f"],"serverVariantState":"","middlewareEnabled":false,"cacheStatus":"DYNAMIC","shouldUseCache":false,"vary":[],"lohpSummerUpsellEnabled":false,"publicationHierarchyEnabled":false},"client":{"hydrated":false,"isUs":false,"isNativeMedium":false,"isSafariMobile":false,"isSafari":false,"isFirefox":false,"routingEntity":{"type":"COLLECTION","id":"3c87dc14372f","explicit":true},"viewerIsBot":false},"debug":{"requestId":"8f5bf297-78f6-4d8a-bb2d-7c3f8c200d12","hybridDevServices":[],"originalSpanCarrier":{"traceparent":"00-50ad8634f0c9eaf2b283f9ff7c3e8278-eaa8f66affe8e50c-01"}},"multiVote":{"clapsPerPost":{}},"navigation":{"branch":{"show":null,"hasRendered":null,"blockedByCTA":false},"hideGoogleOneTap":false,"hasRenderedAlternateUserBanner":null,"currentLocation":"https:\u002F\u002Fblog.palantir.com\u002Ftampering-with-windows-event-tracing-background-offense-and-defense-4be7ac62ac63","host":"blog.palantir.com","hostname":"blog.palantir.com","referrer":"","hasSetReferrer":false,"susiModal":{"step":null,"operation":"register"},"postRead":false,"partnerProgram":{"selectedCountryCode":null}},"config":{"nodeEnv":"production","version":"main-20241017-182126-a0128a89d2","target":"production","productName":"Medium","publicUrl":"https:\u002F\u002Fcdn-client.medium.com\u002Flite","authDomain":"medium.com","authGoogleClientId":"216296035834-k1k6qe060s2tp2a2jam4ljdcms00sttg.apps.googleusercontent.com","favicon":"production","glyphUrl":"https:\u002F\u002Fglyph.medium.com","branchKey":"key_live_ofxXr2qTrrU9NqURK8ZwEhknBxiI6KBm","algolia":{"appId":"MQ57UUUQZ2","apiKeySearch":"394474ced050e3911ae2249ecc774921","indexPrefix":"medium_","host":"-dsn.algolia.net"},"recaptchaKey":"6Lfc37IUAAAAAKGGtC6rLS13R1Hrw_BqADfS1LRk","recaptcha3Key":"6Lf8R9wUAAAAABMI_85Wb8melS7Zj6ziuf99Yot5","recaptchaEnterpriseKeyId":"6Le-uGgpAAAAAPprRaokM8AKthQ9KNGdoxaGUvVp","datadog":{"applicationId":"6702d87d-a7e0-42fe-bbcb-95b469547ea0","clientToken":"pub853ea8d17ad6821d9f8f11861d23dfed","rumToken":"pubf9cc52896502b9413b68ba36fc0c7162","context":{"deployment":{"target":"production","tag":"main-20241017-182126-a0128a89d2","commit":"a0128a89d2d76bfa55b25492370b0bae4050224f"}},"datacenter":"us"},"googleAnalyticsCode":"G-7JY7T788PK","googlePay":{"apiVersion":"2","apiVersionMinor":"0","merchantId":"BCR2DN6TV7EMTGBM","merchantName":"Medium","instanceMerchantId":"13685562959212738550"},"applePay":{"version":3},"signInWallCustomDomainCollectionIds":["3a8144eabfe3","336d898217ee","61061eb0c96b","138adf9c44c","819cc2aaeee0"],"mediumMastodonDomainName":"me.dm","mediumOwnedAndOperatedCollectionIds":["8a9336e5bb4","b7e45b22fec3","193b68bd4fba","8d6b8a439e32","54c98c43354d","3f6ecf56618","d944778ce714","92d2092dc598","ae2a65f35510","1285ba81cada","544c7006046e","fc8964313712","40187e704f1c","88d9857e584e","7b6769f2748b","bcc38c8f6edf","cef6983b292","cb8577c9149e","444d13b52878","713d7dbc99b0","ef8e90590e66","191186aaafa0","55760f21cdc5","9dc80918cc93","bdc4052bbdba","8ccfed20cbb2"],"tierOneDomains":["medium.com","thebolditalic.com","arcdigital.media","towardsdatascience.com","uxdesign.cc","codeburst.io","psiloveyou.xyz","writingcooperative.com","entrepreneurshandbook.co","prototypr.io","betterhumans.coach.me","theascent.pub"],"topicsToFollow":["d61cf867d93f","8a146bc21b28","1eca0103fff3","4d562ee63426","aef1078a3ef5","e15e46793f8d","6158eb913466","55f1c20aba7a","3d18b94f6858","4861fee224fd","63c6f1f93ee","1d98b3a9a871","decb52b64abf","ae5d4995e225","830cded25262"],"topicToTagMappings":{"accessibility":"accessibility","addiction":"addiction","android-development":"android-development","art":"art","artificial-intelligence":"artificial-intelligence","astrology":"astrology","basic-income":"basic-income","beauty":"beauty","biotech":"biotech","blockchain":"blockchain","books":"books","business":"business","cannabis":"cannabis","cities":"cities","climate-change":"climate-change","comics":"comics","coronavirus":"coronavirus","creativity":"creativity","cryptocurrency":"cryptocurrency","culture":"culture","cybersecurity":"cybersecurity","data-science":"data-science","design":"design","digital-life":"digital-life","disability":"disability","economy":"economy","education":"education","equality":"equality","family":"family","feminism":"feminism","fiction":"fiction","film":"film","fitness":"fitness","food":"food","freelancing":"freelancing","future":"future","gadgets":"gadgets","gaming":"gaming","gun-control":"gun-control","health":"health","history":"history","humor":"humor","immigration":"immigration","ios-development":"ios-development","javascript":"javascript","justice":"justice","language":"language","leadership":"leadership","lgbtqia":"lgbtqia","lifestyle":"lifestyle","machine-learning":"machine-learning","makers":"makers","marketing":"marketing","math":"math","media":"media","mental-health":"mental-health","mindfulness":"mindfulness","money":"money","music":"music","neuroscience":"neuroscience","nonfiction":"nonfiction","outdoors":"outdoors","parenting":"parenting","pets":"pets","philosophy":"philosophy","photography":"photography","podcasts":"podcast","poetry":"poetry","politics":"politics","privacy":"privacy","product-management":"product-management","productivity":"productivity","programming":"programming","psychedelics":"psychedelics","psychology":"psychology","race":"race","relationships":"relationships","religion":"religion","remote-work":"remote-work","san-francisco":"san-francisco","science":"science","self":"self","self-driving-cars":"self-driving-cars","sexuality":"sexuality","social-media":"social-media","society":"society","software-engineering":"software-engineering","space":"space","spirituality":"spirituality","sports":"sports","startups":"startup","style":"style","technology":"technology","transportation":"transportation","travel":"travel","true-crime":"true-crime","tv":"tv","ux":"ux","venture-capital":"venture-capital","visual-design":"visual-design","work":"work","world":"world","writing":"writing"},"defaultImages":{"avatar":{"imageId":"1*dmbNkD5D-u45r44go_cf0g.png","height":150,"width":150},"orgLogo":{"imageId":"7*V1_7XP4snlmqrc_0Njontw.png","height":110,"width":500},"postLogo":{"imageId":"bd978bb536350a710e8efb012513429cabdc4c28700604261aeda246d0f980b7","height":810,"width":1440},"postPreviewImage":{"imageId":"1*hn4v1tCaJy7cWMyb0bpNpQ.png","height":386,"width":579}},"collectionStructuredData":{"8d6b8a439e32":{"name":"Elemental","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fcdn-images-1.medium.com\u002Fmax\u002F980\u002F1*9ygdqoKprhwuTVKUM0DLPA@2x.png","width":980,"height":159}}},"3f6ecf56618":{"name":"Forge","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fcdn-images-1.medium.com\u002Fmax\u002F596\u002F1*uULpIlImcO5TDuBZ6lm7Lg@2x.png","width":596,"height":183}}},"ae2a65f35510":{"name":"GEN","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fmiro.medium.com\u002Fmax\u002F264\u002F1*RdVZMdvfV3YiZTw6mX7yWA.png","width":264,"height":140}}},"88d9857e584e":{"name":"LEVEL","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fmiro.medium.com\u002Fmax\u002F540\u002F1*JqYMhNX6KNNb2UlqGqO2WQ.png","width":540,"height":108}}},"7b6769f2748b":{"name":"Marker","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fcdn-images-1.medium.com\u002Fmax\u002F383\u002F1*haCUs0wF6TgOOvfoY-jEoQ@2x.png","width":383,"height":92}}},"444d13b52878":{"name":"OneZero","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fmiro.medium.com\u002Fmax\u002F540\u002F1*cw32fIqCbRWzwJaoQw6BUg.png","width":540,"height":123}}},"8ccfed20cbb2":{"name":"Zora","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fmiro.medium.com\u002Fmax\u002F540\u002F1*tZUQqRcCCZDXjjiZ4bDvgQ.png","width":540,"height":106}}}},"embeddedPostIds":{"coronavirus":"cd3010f9d81f"},"sharedCdcMessaging":{"COVID_APPLICABLE_TAG_SLUGS":[],"COVID_APPLICABLE_TOPIC_NAMES":[],"COVID_APPLICABLE_TOPIC_NAMES_FOR_TOPIC_PAGE":[],"COVID_MESSAGES":{"tierA":{"text":"For more information on the novel coronavirus and Covid-19, visit cdc.gov.","markups":[{"start":66,"end":73,"href":"https:\u002F\u002Fwww.cdc.gov\u002Fcoronavirus\u002F2019-nCoV"}]},"tierB":{"text":"Anyone can publish on Medium per our Policies, but we don’t fact-check every story. For more info about the coronavirus, see cdc.gov.","markups":[{"start":37,"end":45,"href":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Fcategories\u002F201931128-Policies-Safety"},{"start":125,"end":132,"href":"https:\u002F\u002Fwww.cdc.gov\u002Fcoronavirus\u002F2019-nCoV"}]},"paywall":{"text":"This article has been made free for everyone, thanks to Medium Members. For more information on the novel coronavirus and Covid-19, visit cdc.gov.","markups":[{"start":56,"end":70,"href":"https:\u002F\u002Fmedium.com\u002Fmembership"},{"start":138,"end":145,"href":"https:\u002F\u002Fwww.cdc.gov\u002Fcoronavirus\u002F2019-nCoV"}]},"unbound":{"text":"This article is free for everyone, thanks to Medium Members. For more information on the novel coronavirus and Covid-19, visit cdc.gov.","markups":[{"start":45,"end":59,"href":"https:\u002F\u002Fmedium.com\u002Fmembership"},{"start":127,"end":134,"href":"https:\u002F\u002Fwww.cdc.gov\u002Fcoronavirus\u002F2019-nCoV"}]}},"COVID_BANNER_POST_ID_OVERRIDE_WHITELIST":["3b31a67bff4a"]},"sharedVoteMessaging":{"TAGS":["politics","election-2020","government","us-politics","election","2020-presidential-race","trump","donald-trump","democrats","republicans","congress","republican-party","democratic-party","biden","joe-biden","maga"],"TOPICS":["politics","election"],"MESSAGE":{"text":"Find out more about the U.S. election results here.","markups":[{"start":46,"end":50,"href":"https:\u002F\u002Fcookpolitical.com\u002F2020-national-popular-vote-tracker"}]},"EXCLUDE_POSTS":["397ef29e3ca5"]},"embedPostRules":[],"recircOptions":{"v1":{"limit":3},"v2":{"limit":8}},"braintreeClientKey":"production_zjkj96jm_m56f8fqpf7ngnrd4","braintree":{"enabled":true,"merchantId":"m56f8fqpf7ngnrd4","merchantAccountId":{"usd":"AMediumCorporation_instant","eur":"amediumcorporation_EUR","cad":"amediumcorporation_CAD"},"publicKey":"ds2nn34bg2z7j5gd","braintreeEnvironment":"production","dashboardUrl":"https:\u002F\u002Fwww.braintreegateway.com\u002Fmerchants","gracePeriodDurationInDays":14,"mediumMembershipPlanId":{"monthly":"ce105f8c57a3","monthlyV2":"e8a5e126-792b-4ee6-8fba-d574c1b02fc5","monthlyWithTrial":"d5ee3dbe3db8","monthlyPremium":"fa741a9b47a2","yearly":"a40ad4a43185","yearlyV2":"3815d7d6-b8ca-4224-9b8c-182f9047866e","yearlyStaff":"d74fb811198a","yearlyWithTrial":"b3bc7350e5c7","yearlyPremium":"e21bd2c12166","monthlyOneYearFree":"e6c0637a-2bad-4171-ab4f-3c268633d83c","monthly25PercentOffFirstYear":"235ecc62-0cdb-49ae-9378-726cd21c504b","monthly20PercentOffFirstYear":"ba518864-9c13-4a99-91ca-411bf0cac756","monthly15PercentOffFirstYear":"594c029b-9f89-43d5-88f8-8173af4e070e","monthly10PercentOffFirstYear":"c6c7bc9a-40f2-4b51-8126-e28511d5bdb0","monthlyForStudents":"629ebe51-da7d-41fd-8293-34cd2f2030a8","yearlyOneYearFree":"78ba7be9-0d9f-4ece-aa3e-b54b826f2bf1","yearly25PercentOffFirstYear":"2dbb010d-bb8f-4eeb-ad5c-a08509f42d34","yearly20PercentOffFirstYear":"47565488-435b-47f8-bf93-40d5fbe0ebc8","yearly15PercentOffFirstYear":"8259809b-0881-47d9-acf7-6c001c7f720f","yearly10PercentOffFirstYear":"9dd694fb-96e1-472c-8d9e-3c868d5c1506","yearlyForStudents":"e29345ef-ab1c-4234-95c5-70e50fe6bc23","monthlyCad":"p52orjkaceei","yearlyCad":"h4q9g2up9ktt"},"braintreeDiscountId":{"oneMonthFree":"MONTHS_FREE_01","threeMonthsFree":"MONTHS_FREE_03","sixMonthsFree":"MONTHS_FREE_06","fiftyPercentOffOneYear":"FIFTY_PERCENT_OFF_ONE_YEAR"},"3DSecureVersion":"2","defaultCurrency":"usd","providerPlanIdCurrency":{"4ycw":"usd","rz3b":"usd","3kqm":"usd","jzw6":"usd","c2q2":"usd","nnsw":"usd","q8qw":"usd","d9y6":"usd","fx7w":"cad","nwf2":"cad"}},"paypalClientId":"AXj1G4fotC2GE8KzWX9mSxCH1wmPE3nJglf4Z2ig_amnhvlMVX87otaq58niAg9iuLktVNF_1WCMnN7v","paypal":{"host":"https:\u002F\u002Fapi.paypal.com:443","clientMode":"production","serverMode":"live","webhookId":"4G466076A0294510S","monthlyPlan":{"planId":"P-9WR0658853113943TMU5FDQA","name":"Medium Membership (Monthly) with setup fee","description":"Unlimited access to the best and brightest stories on Medium. Membership billed monthly."},"yearlyPlan":{"planId":"P-7N8963881P8875835MU5JOPQ","name":"Medium Membership (Annual) with setup fee","description":"Unlimited access to the best and brightest stories on Medium. Membership billed annually."},"oneYearGift":{"name":"Medium Membership (1 Year, Digital Gift Code)","description":"Unlimited access to the best and brightest stories on Medium. Gift codes can be redeemed at medium.com\u002Fredeem.","price":"50.00","currency":"USD","sku":"membership-gift-1-yr"},"oldMonthlyPlan":{"planId":"P-96U02458LM656772MJZUVH2Y","name":"Medium Membership (Monthly)","description":"Unlimited access to the best and brightest stories on Medium. Membership billed monthly."},"oldYearlyPlan":{"planId":"P-59P80963JF186412JJZU3SMI","name":"Medium Membership (Annual)","description":"Unlimited access to the best and brightest stories on Medium. Membership billed annually."},"monthlyPlanWithTrial":{"planId":"P-66C21969LR178604GJPVKUKY","name":"Medium Membership (Monthly) with setup fee","description":"Unlimited access to the best and brightest stories on Medium. Membership billed monthly."},"yearlyPlanWithTrial":{"planId":"P-6XW32684EX226940VKCT2MFA","name":"Medium Membership (Annual) with setup fee","description":"Unlimited access to the best and brightest stories on Medium. Membership billed annually."},"oldMonthlyPlanNoSetupFee":{"planId":"P-4N046520HR188054PCJC7LJI","name":"Medium Membership (Monthly)","description":"Unlimited access to the best and brightest stories on Medium. Membership billed monthly."},"oldYearlyPlanNoSetupFee":{"planId":"P-7A4913502Y5181304CJEJMXQ","name":"Medium Membership (Annual)","description":"Unlimited access to the best and brightest stories on Medium. Membership billed annually."},"sdkUrl":"https:\u002F\u002Fwww.paypal.com\u002Fsdk\u002Fjs"},"stripePublishableKey":"pk_live_7FReX44VnNIInZwrIIx6ghjl","log":{"json":true,"level":"info"},"imageUploadMaxSizeMb":25,"staffPicks":{"title":"Staff Picks","catalogId":"c7bc6e1ee00f"}},"session":{"xsrf":""}}</script><script>window.__APOLLO_STATE__ = {"ROOT_QUERY":{"__typename":"Query","viewer":null,"variantFlags":[{"__typename":"VariantFlag","name":"enable_pp_v4","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_see_pronouns","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"allow_access","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"android_enable_editor_new_publishing_flow","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"can_send_tips_v0","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_footer_app_buttons","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"ios_enable_home_post_menu","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_aurora_pub_follower_page","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_lite_archive_page","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_updated_pub_recs_ui","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"android_enable_friend_links_creation","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"browsable_stream_config_bucket","valueType":{"__typename":"VariantFlagString","value":"curated-topics"}},{"__typename":"VariantFlag","name":"enable_sharer_validate_post_share_key","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_recirc_model","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_app_flirty_thirty","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_branch_io","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_iceland_forced_android","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_ios_easy_resubscribe","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"ios_iceland_nux","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"onboarding_tags_from_top_views","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_braintree_google_pay","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_braintree_trial_membership","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_moc_load_processor_first_story","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_braintree_client","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_rex_aggregator_v2","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_new_manage_membership_flow","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"disable_partner_program_enrollment","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_auto_follow_on_subscribe","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_lite_response_markup","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_ml_rank_rex_anno","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_switch_plan_premium_tier","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"android_enable_lists_v2","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_rex_reading_history","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_conversion_ranker_v2","valueType":{"__typename":"VariantFlagString","value":"control"}},{"__typename":"VariantFlag","name":"enable_import","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_tag_recs","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_recaptcha_enterprise","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_moc_load_processor_c","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"coronavirus_topic_recirc","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_creator_welcome_email","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_ios_offline_reading","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_rito_upstream_deadlines","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_seamless_social_sharing","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_deprecate_legacy_providers_v3","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_moc_load_processor_all_recs_surfaces","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_boost_nia_v01","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_ios_dynamic_paywall_programming","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_premium_tier_badge","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_update_topic_portals_wtf","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_android_verified_author","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_author_cards","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_ios_dynamic_paywall_aspiriational","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"signup_services","valueType":{"__typename":"VariantFlagString","value":"twitter,facebook,google,email,google-fastidv,google-one-tap,apple"}},{"__typename":"VariantFlag","name":"available_monthly_plan","valueType":{"__typename":"VariantFlagString","value":"60e220181034"}},{"__typename":"VariantFlag","name":"enable_google_webhook","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_pill_based_home_feed","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_eventstats_event_processing","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"ios_display_paywall_after_onboarding","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"ios_enable_friend_links_postpage_banners","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"rex_generator_max_candidates","valueType":{"__typename":"VariantFlagNumber"}},{"__typename":"VariantFlag","name":"enable_android_miro_v2","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_lite_server_upstream_deadlines","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"glyph_font_set","valueType":{"__typename":"VariantFlagString","value":"m2-unbound-source-serif-pro"}},{"__typename":"VariantFlag","name":"allow_test_auth","valueType":{"__typename":"VariantFlagString","value":"disallow"}},{"__typename":"VariantFlag","name":"android_enable_friend_links_postpage_banners","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"android_enable_topic_portals","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_configure_pronouns","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"ios_enable_verified_book_author","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_conversion_model_v2","valueType":{"__typename":"VariantFlagString","value":"group_2"}},{"__typename":"VariantFlag","name":"enable_susi_redesign_ios","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_tipping_v0_ios","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"android_enable_image_sharer","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_ios_autorefresh","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_mastodon_for_members","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"redefined_top_posts","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_braintree_apple_pay","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_maim_the_meter","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_newsletter_lo_flow_custom_domains","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_apple_webhook","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_speechify_ios","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_entities_to_follow_v2","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"limit_user_follows","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"allow_signup","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"available_monthly_premium_plan","valueType":{"__typename":"VariantFlagString","value":"12a660186432"}},{"__typename":"VariantFlag","name":"enable_automod","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_lite_continue_this_thread","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"android_rating_prompt_stories_read_threshold","valueType":{"__typename":"VariantFlagNumber"}},{"__typename":"VariantFlag","name":"enable_verifications_service","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"price_smoke_test_monthly","valueType":{"__typename":"VariantFlagString","value":""}},{"__typename":"VariantFlag","name":"available_annual_premium_plan","valueType":{"__typename":"VariantFlagString","value":"4a442ace1476"}},{"__typename":"VariantFlag","name":"enable_braintree_paypal","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_medium2_kbfd","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_susi_redesign_android","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_legacy_feed_in_iceland","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_new_stripe_customers","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_starspace","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"android_enable_syntax_highlight","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"reengagement_notification_duration","valueType":{"__typename":"VariantFlagNumber"}},{"__typename":"VariantFlag","name":"enable_braintree_webhook","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"textshots_userid","valueType":{"__typename":"VariantFlagString","value":""}},{"__typename":"VariantFlag","name":"android_two_hour_refresh","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"ios_remove_twitter_onboarding_step","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_indexeddb","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_lo_homepage","valueType":{"__typename":"VariantFlagString","value":"control"}},{"__typename":"VariantFlag","name":"enable_mastodon_for_members_username_selection","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"signin_services","valueType":{"__typename":"VariantFlagString","value":"twitter,facebook,google,email,google-fastidv,google-one-tap,apple"}},{"__typename":"VariantFlag","name":"enable_tick_landing_page","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_update_explore_wtf","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_group_gifting","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_tribute_landing_page","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"limit_post_referrers","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_braintree_integration","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_marketing_emails","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_explicit_signals_updated_post_previews","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"available_annual_plan","valueType":{"__typename":"VariantFlagString","value":"2c754bcc2995"}},{"__typename":"VariantFlag","name":"enable_android_offline_reading","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"ios_in_app_free_trial","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"skip_fs_cache_user_vals","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_intrinsic_automatic_actions","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_speechify_widget","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_simplified_digest_v2_b","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_diversification_rex","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"reader_fair_distribution_non_qp","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_cache_less_following_feed","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_recommended_publishers_query","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_lite_homepage","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_pp_country_expansion","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_pre_pp_v4","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_rex_new_push_notification_endpoint","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"mobile_custom_app_icon","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"can_receive_tips_v0","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_google_one_tap","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_android_dynamic_aspirational_paywall","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"ios_enable_friend_links_creation","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"price_smoke_test_yearly","valueType":{"__typename":"VariantFlagString","value":""}},{"__typename":"VariantFlag","name":"enable_premium_tier","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_sprig","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_apple_sign_in","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_explicit_signals","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_members_only_audio","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_sharer_create_post_share_key","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_tipping_v0_android","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_author_cards_byline","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_mastodon_avatar_upload","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"ios_social_share_sheet","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_android_dynamic_programming_paywall","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"enable_bg_post_post","valueType":{"__typename":"VariantFlagBoolean","value":true}},{"__typename":"VariantFlag","name":"ios_enable_lock_responses","valueType":{"__typename":"VariantFlagBoolean","value":true}}],"collectionByDomainOrSlug({\"domainOrSlug\":\"blog.palantir.com\"})":{"__ref":"Collection:3c87dc14372f"},"postResult({\"id\":\"4be7ac62ac63\"})":{"__ref":"Post:4be7ac62ac63"}},"ImageMetadata:":{"__typename":"ImageMetadata","id":"","originalWidth":0,"originalHeight":0},"Collection:3c87dc14372f":{"__typename":"Collection","id":"3c87dc14372f","favicon":{"__ref":"ImageMetadata:"},"customStyleSheet":null,"colorPalette":{"__typename":"ColorPalette","highlightSpectrum":{"__typename":"ColorSpectrum","backgroundColor":"#FFFFFFFF","colorPoints":[{"__typename":"ColorPoint","color":"#FFFFFFFF","point":0},{"__typename":"ColorPoint","color":"#FFE8F3E8","point":0.1},{"__typename":"ColorPoint","color":"#FFE8F3E8","point":0.2},{"__typename":"ColorPoint","color":"#FFD1E7D1","point":0.6},{"__typename":"ColorPoint","color":"#FFA3D0A2","point":1}]},"defaultBackgroundSpectrum":{"__typename":"ColorSpectrum","backgroundColor":"#FFFFFFFF","colorPoints":[{"__typename":"ColorPoint","color":"#FF1A8917","point":0},{"__typename":"ColorPoint","color":"#FF11800E","point":0.1},{"__typename":"ColorPoint","color":"#FF0F730C","point":0.2},{"__typename":"ColorPoint","color":"#FF095407","point":1}]},"tintBackgroundSpectrum":null},"googleAnalyticsId":null,"editors":[{"__typename":"CollectionMastheadUserItem","user":{"__ref":"User:1529195d9f13"}}],"name":"Palantir Blog","avatar":{"__ref":"ImageMetadata:1*PbgkHC0TD-x4rvptc-w3jg.png"},"domain":"blog.palantir.com","slug":"palantir","description":"Palantir Blog","subscriberCount":7580,"latestPostsConnection({\"paging\":{\"limit\":1}})":{"__typename":"PostConnection","posts":[{"__typename":"Post","title":"From Prototype to Production","latestPublishedAt":1729526845374}]},"viewerEdge":{"__ref":"CollectionViewerEdge:collectionId:3c87dc14372f-viewerId:lo_a4ef2eb89d94"},"twitterUsername":"palantirtech","facebookPageId":null,"logo":{"__ref":"ImageMetadata:"}},"User:1529195d9f13":{"__typename":"User","id":"1529195d9f13","name":"Palantir","username":"palantir","newsletterV3":{"__ref":"NewsletterV3:558633e535cb"},"linkedAccounts":{"__ref":"LinkedAccounts:1529195d9f13"},"isSuspended":false,"imageId":"1*yFp1VmXHPcrYrYrDNlD_7A.png","mediumMemberAt":1615385428000,"verifications":{"__typename":"VerifiedInfo","isBookAuthor":false},"socialStats":{"__typename":"SocialStats","followerCount":12116},"customDomainState":{"__typename":"CustomDomainState","live":{"__typename":"CustomDomain","domain":"palantir.medium.com"}},"hasSubdomain":true,"bio":"","isPartnerProgramEnrolled":false,"viewerEdge":{"__ref":"UserViewerEdge:userId:1529195d9f13-viewerId:lo_a4ef2eb89d94"},"viewerIsUser":false,"postSubscribeMembershipUpsellShownAt":0,"userPostCounts({\"includeResponsesCount\":true})":null,"membership":{"__ref":"Membership:af67aedc6639"},"allowNotes":true,"twitterScreenName":""},"ImageMetadata:1*PbgkHC0TD-x4rvptc-w3jg.png":{"__typename":"ImageMetadata","id":"1*PbgkHC0TD-x4rvptc-w3jg.png"},"LinkedAccounts:1529195d9f13":{"__typename":"LinkedAccounts","mastodon":null,"id":"1529195d9f13"},"UserViewerEdge:userId:1529195d9f13-viewerId:lo_a4ef2eb89d94":{"__typename":"UserViewerEdge","id":"userId:1529195d9f13-viewerId:lo_a4ef2eb89d94","isFollowing":false,"isUser":false,"isMuting":false},"NewsletterV3:558633e535cb":{"__typename":"NewsletterV3","id":"558633e535cb","type":"NEWSLETTER_TYPE_AUTHOR","slug":"1529195d9f13","name":"1529195d9f13","collection":null,"user":{"__ref":"User:1529195d9f13"}},"Membership:af67aedc6639":{"__typename":"Membership","tier":"MEMBER","id":"af67aedc6639"},"Paragraph:829a245ca4fd_0":{"__typename":"Paragraph","id":"829a245ca4fd_0","name":"6a1f","type":"H3","href":null,"layout":null,"metadata":null,"text":"Tampering with Windows Event Tracing: Background, Offense, and Defense","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*SMDAeNCTr6vY7N8oTjneiA.png":{"__typename":"ImageMetadata","id":"1*SMDAeNCTr6vY7N8oTjneiA.png","originalHeight":1932,"originalWidth":2262,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:829a245ca4fd_1":{"__typename":"Paragraph","id":"829a245ca4fd_1","name":"2785","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*SMDAeNCTr6vY7N8oTjneiA.png"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_2":{"__typename":"Paragraph","id":"829a245ca4fd_2","name":"3467","type":"P","href":null,"layout":null,"metadata":null,"text":"Event Tracing for Windows (ETW) is the mechanism Windows uses to trace and log system events. Attackers often clear event logs to cover their tracks. Though the act of clearing an event log itself generates an event, attackers who know ETW well may take advantage of tampering opportunities to cease the flow of logging temporarily or even permanently, without generating any event log entries in the process.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":0,"end":25,"href":"https:\u002F\u002Fblogs.msdn.microsoft.com\u002Fntdebugging\u002F2009\u002F08\u002F27\u002Fpart-1-etw-introduction-and-overview\u002F","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_3":{"__typename":"Paragraph","id":"829a245ca4fd_3","name":"900b","type":"P","href":null,"layout":null,"metadata":null,"text":"The Windows event log is the data source for many of the Palantir Critical Incident Response Team’s Alerting and Detection Strategies, so familiarity with event log tampering tradecraft is foundational to our success. We continually evaluate our assumptions regarding the integrity of our event data sources, document our blind spots, and adjust our implementation. The goal of this blog post is to share our knowledge with the community by covering ETW background and basics, stealthy event log tampering techniques, and detection strategies.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":100,"end":133,"href":"https:\u002F\u002Fmedium.com\u002Fpalantir\u002Falerting-and-detection-strategy-framework-52dc33722df2","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_4":{"__typename":"Paragraph","id":"829a245ca4fd_4","name":"4f16","type":"H3","href":null,"layout":null,"metadata":null,"text":"Introduction to ETW and event logging","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_5":{"__typename":"Paragraph","id":"829a245ca4fd_5","name":"76a0","type":"P","href":null,"layout":null,"metadata":null,"text":"The ETW architecture differentiates between event providers, event consumers, and event tracing sessions. Tracing sessions are responsible for collecting events from providers and for relaying them to log files and consumers. Sessions are created and configured by controllers like the built-in logman.exe command line utility. Here are some useful commands for exploring existing trace sessions and their respective ETW providers; note that these must usually be executed from an elevated context.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":295,"end":305,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":4,"end":20,"href":"https:\u002F\u002Fdocs.microsoft.com\u002Fen-us\u002Fwindows\u002Fdesktop\u002Fetw\u002Fabout-event-tracing","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":50,"end":59,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":67,"end":76,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":88,"end":104,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":265,"end":276,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_6":{"__typename":"Paragraph","id":"829a245ca4fd_6","name":"b1a4","type":"H4","href":null,"layout":null,"metadata":null,"text":"List all running trace sessions","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_7":{"__typename":"Paragraph","id":"829a245ca4fd_7","name":"919b","type":"PRE","href":null,"layout":null,"metadata":null,"text":"\u003E logman query -ets","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":2,"end":19,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_8":{"__typename":"Paragraph","id":"829a245ca4fd_8","name":"88f3","type":"PRE","href":null,"layout":null,"metadata":null,"text":"Data Collector Set                Type    Status\n-------------------------------------------------\nCircular Kernel Context Logger    Trace   Running\nAppModel                          Trace   Running\nScreenOnPowerStudyTraceSession    Trace   Running\nDiagLog                           Trace   Running\nEventLog-Application              Trace   Running\nEventLog-System                   Trace   Running\nLwtNetLog                         Trace   Running\nNtfsLog                           Trace   Running\nTileStore                         Trace   Running\nUBPM                              Trace   Running\nWdiContextLog                     Trace   Running\nWiFiSession                       Trace   Running\nUserNotPresentTraceSession        Trace   Running\nDiagtrack-Listener                Trace   Running\nMSDTC_TRACE_SESSION               Trace   Running\nWindowsUpdate_trace_log           Trace   Running","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_9":{"__typename":"Paragraph","id":"829a245ca4fd_9","name":"647f","type":"H4","href":null,"layout":null,"metadata":null,"text":"List all providers that a trace session is subscribed to","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_10":{"__typename":"Paragraph","id":"829a245ca4fd_10","name":"09a8","type":"PRE","href":null,"layout":null,"metadata":null,"text":"\u003E logman query \"EventLog-Application\" -ets","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":2,"end":42,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_11":{"__typename":"Paragraph","id":"829a245ca4fd_11","name":"f182","type":"PRE","href":null,"layout":null,"metadata":null,"text":"Name:                 EventLog-Application\nStatus:               Running\nRoot Path:            %systemdrive%\\PerfLogs\\Admin\nSegment:              Off\nSchedules:            On\nSegment Max Size:     100 MB\n \nName:                 EventLog-Application\\EventLog-Application\nType:                 Trace\nAppend:               Off\nCircular:             Off\nOverwrite:            Off\nBuffer Size:          64\nBuffers Lost:         0\nBuffers Written:      242\nBuffer Flush Timer:   1\nClock Type:           System\nFile Mode:            Real-time\n \nProvider:\nName:                 Microsoft-Windows-SenseIR\nProvider Guid:        {B6D775EF-1436-4FE6-BAD3-9E436319E218}\nLevel:                255\nKeywordsAll:          0x0\nKeywordsAny:          0x8000000000000000 (Microsoft-Windows-SenseIR\u002FOperational)\nProperties:           65\nFilter Type:          0\n \nProvider:\nName:                 Microsoft-Windows-WDAG-Service\nProvider Guid:        {728B02D9-BF21-49F6-BE3F-91BC06F7467E}\nLevel:                255\nKeywordsAll:          0x0\nKeywordsAny:          0x8000000000000000\nProperties:           65\nFilter Type:          0\n \n...\n \nProvider:\nName:                 Microsoft-Windows-PowerShell\nProvider Guid:        {A0C1853B-5C40-4B15-8766-3CF1C58F985A}\nLevel:                255\nKeywordsAll:          0x0\nKeywordsAny:          0x9000000000000000 (Microsoft-Windows-PowerShell\u002FOperational,Microsoft-Windows-PowerShell\u002FAdmin)\nProperties:           65\nFilter Type:          0","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_12":{"__typename":"Paragraph","id":"829a245ca4fd_12","name":"0b63","type":"P","href":null,"layout":null,"metadata":null,"text":"This command details the configuration of the trace session itself, followed by the configuration of each provider that the session is subscribed to, including the following parameters:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_13":{"__typename":"Paragraph","id":"829a245ca4fd_13","name":"9846","type":"ULI","href":null,"layout":null,"metadata":null,"text":"Name: The name of the provider. A provider only has a name if it has a registered manifest, but it always has a unique GUID.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":71,"end":90,"href":"https:\u002F\u002Fdocs.microsoft.com\u002Fen-us\u002Fwindows\u002Fdesktop\u002Fetw\u002Fwriting-manifest-based-events","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":0,"end":4,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_14":{"__typename":"Paragraph","id":"829a245ca4fd_14","name":"8dfd","type":"ULI","href":null,"layout":null,"metadata":null,"text":"Provider GUID: The unique GUID for the provider. The GUID and\u002For name of a provider is useful when performing research or operations on a specific provider.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"STRONG","start":0,"end":13,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_15":{"__typename":"Paragraph","id":"829a245ca4fd_15","name":"3034","type":"ULI","href":null,"layout":null,"metadata":null,"text":"Level: The logging level specified. Standard logging levels are: 0 — Log Always; 1 — Critical; 2 — Error; 3 — Warning; 4 — Informational; 5 — Verbose. Custom logging levels can also be defined, but levels 6–15 are reserved. More than one logging level can be captured by ORing respective levels; supplying 255 (0xFF) is the standard method of capturing all supported logging levels.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"STRONG","start":0,"end":5,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_16":{"__typename":"Paragraph","id":"829a245ca4fd_16","name":"cb70","type":"ULI","href":null,"layout":null,"metadata":null,"text":"KeywordsAll: Keywords are used to filter specific categories of events. While logging level is used to filter by event verbosity\u002Fimportance, keywords allow filtering by event category. A keyword corresponds to a specific bit value. All indicates that, for a given keyword matched by KeywordsAny, further filtering should be performed based on the specific bitmask in KeywordsAll. This field is often set to zero. More information on All vs. Any can be found here.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":283,"end":294,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":367,"end":378,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":458,"end":462,"href":"https:\u002F\u002Fdocs.microsoft.com\u002Fen-us\u002Fwindows\u002Fdesktop\u002Fwes\u002Fdefining-keywords-used-to-classify-types-of-events","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":0,"end":11,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":232,"end":235,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":433,"end":436,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":441,"end":444,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_17":{"__typename":"Paragraph","id":"829a245ca4fd_17","name":"264d","type":"ULI","href":null,"layout":null,"metadata":null,"text":"KeywordsAny: Enables filtering based on any combination of the keywords specified. This can be thought of as a logical OR where KeywordsAll is a subsequent application of a logical AND. The low 6 bytes refer to keywords specific to the provider. The high two bytes are reserved and defined in WinMeta.xml in the Windows SDK. For example, in event log-related trace sessions, you will see the high byte (specifically, the high nibble) set to a specific value. This corresponds to one or more event channels where the following channels are defined:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":293,"end":304,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":0,"end":11,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_18":{"__typename":"Paragraph","id":"829a245ca4fd_18","name":"3e70","type":"PRE","href":null,"layout":null,"metadata":null,"text":"0x01 - Admin channel\n0x02 - Debug channel\n0x04 - Analytic channel\n0x08 - Operational channel","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_19":{"__typename":"Paragraph","id":"829a245ca4fd_19","name":"0c78","type":"ULI","href":null,"layout":null,"metadata":null,"text":"Properties: This refers to optional ETW properties that can be specified when writing the event. The following values are currently supported (more information here):","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":160,"end":164,"href":"https:\u002F\u002Fdocs.microsoft.com\u002Fen-us\u002Fwindows\u002Fdesktop\u002FETW\u002Fenable-trace-parameters","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":0,"end":10,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_20":{"__typename":"Paragraph","id":"829a245ca4fd_20","name":"f8f4","type":"PRE","href":null,"layout":null,"metadata":null,"text":"0x001 - EVENT_ENABLE_PROPERTY_SID\n0x002 - EVENT_ENABLE_PROPERTY_TS_ID\n0x004 - EVENT_ENABLE_PROPERTY_STACK_TRACE\n0x008 - EVENT_ENABLE_PROPERTY_PSM_KEY\n0x010 - EVENT_ENABLE_PROPERTY_IGNORE_KEYWORD_0\n0x020 - EVENT_ENABLE_PROPERTY_PROVIDER_GROUP\n0x040 - EVENT_ENABLE_PROPERTY_ENABLE_KEYWORD_0\n0x080 - EVENT_ENABLE_PROPERTY_PROCESS_START_KEY\n0x100 - EVENT_ENABLE_PROPERTY_EVENT_KEY\n0x200 - EVENT_ENABLE_PROPERTY_EXCLUDE_INPRIVATE","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_21":{"__typename":"Paragraph","id":"829a245ca4fd_21","name":"85ea","type":"P","href":null,"layout":null,"metadata":null,"text":"From a detection perspective, EVENT_ENABLE_PROPERTY_SID, EVENT_ENABLE_PROPERTY_TS_ID, EVENT_ENABLE_PROPERTY_PROCESS_START_KEY are valuable fields to collect. For example, EVENT_ENABLE_PROPERTY_PROCESS_START_KEY generates a value that uniquely identifies a process. Note that Process IDs are not unique identifiers for a process instance.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_22":{"__typename":"Paragraph","id":"829a245ca4fd_22","name":"998c","type":"ULI","href":null,"layout":null,"metadata":null,"text":"Filter Type: Providers can optionally choose to implement additional filtering; supported filters are defined in the provider manifest. In practice, none of the built-in providers implement filters as confirmed by running TdhEnumerateProviderFilters over all registered providers. There are some predefined filter types defined in eventprov.h (in the Windows SDK):","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":331,"end":342,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":102,"end":134,"href":"https:\u002F\u002Fdocs.microsoft.com\u002Fen-us\u002Fwindows\u002Fdesktop\u002Fwes\u002Fdefining-filters","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":222,"end":249,"href":"https:\u002F\u002Fdocs.microsoft.com\u002Fen-us\u002Fwindows\u002Fdesktop\u002Fapi\u002Ftdh\u002Fnf-tdh-tdhenumerateproviderfilters","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":0,"end":11,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_23":{"__typename":"Paragraph","id":"829a245ca4fd_23","name":"3f11","type":"PRE","href":null,"layout":null,"metadata":null,"text":"0x00000000 - EVENT_FILTER_TYPE_NONE\n0x80000000 - EVENT_FILTER_TYPE_SCHEMATIZED\n0x80000001 - EVENT_FILTER_TYPE_SYSTEM_FLAGS\n0x80000002 - EVENT_FILTER_TYPE_TRACEHANDLE\n0x80000004 - EVENT_FILTER_TYPE_PID\n0x80000008 - EVENT_FILTER_TYPE_EXECUTABLE_NAME\n0x80000010 - EVENT_FILTER_TYPE_PACKAGE_ID\n0x80000020 - EVENT_FILTER_TYPE_PACKAGE_APP_ID\n0x80000100 - EVENT_FILTER_TYPE_PAYLOAD\n0x80000200 - EVENT_FILTER_TYPE_EVENT_ID\n0x80000400 - EVENT_FILTER_TYPE_EVENT_NAME\n0x80001000 - EVENT_FILTER_TYPE_STACKWALK\n0x80002000 - EVENT_FILTER_TYPE_STACKWALK_NAME\n0x80004000 - EVENT_FILTER_TYPE_STACKWALK_LEVEL_KW","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_24":{"__typename":"Paragraph","id":"829a245ca4fd_24","name":"2627","type":"H4","href":null,"layout":null,"metadata":null,"text":"Enumerating all registered ETW providers","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_25":{"__typename":"Paragraph","id":"829a245ca4fd_25","name":"5702","type":"P","href":null,"layout":null,"metadata":null,"text":"The logman query providers command lists all registered ETW providers, supplying their name and GUID. An ETW provider is registered if it has a binary manifest stored in the\n HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\WINEVT\\Publishers\\{PROVIDER_GUID} registry key. For example, the Microsoft-Windows-PowerShell provider has the following registry values:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":4,"end":27,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":175,"end":255,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":287,"end":315,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*x34GfTbt6kR-GkP7KAX-Nw.png":{"__typename":"ImageMetadata","id":"1*x34GfTbt6kR-GkP7KAX-Nw.png","originalHeight":115,"originalWidth":624,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:829a245ca4fd_26":{"__typename":"Paragraph","id":"829a245ca4fd_26","name":"8c18","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*x34GfTbt6kR-GkP7KAX-Nw.png"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_27":{"__typename":"Paragraph","id":"829a245ca4fd_27","name":"43b0","type":"P","href":null,"layout":null,"metadata":null,"text":"ETW and the event log know how to properly parse and display event information to a user based on binary-serialized information in the WEVT_TEMPLATE resource present in the binaries listed in the ResourceFileName registry value. This resource is a binary representation of an instrumentation manifest (i.e., the schema for an ETW provider). The binary structure of WEVT_TEMPLATE is under-documented, but there are at least two tools available to assist in parsing and recovering event schema, WEPExplorer and Perfview.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":135,"end":148,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":196,"end":212,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":365,"end":378,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":276,"end":300,"href":"https:\u002F\u002Fdocs.microsoft.com\u002Fen-us\u002Fwindows\u002Fdesktop\u002Fwes\u002Fwriting-an-instrumentation-manifest","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":382,"end":398,"href":"https:\u002F\u002Fgithub.com\u002Flibyal\u002Flibexe\u002Fblob\u002Fmaster\u002Fdocumentation\u002FExecutable%20(EXE)%20file%20format.asciidoc","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":493,"end":504,"href":"https:\u002F\u002Fgithub.com\u002Flallousx86\u002FWEPExplorer","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":509,"end":518,"href":"https:\u002F\u002Fgithub.com\u002FMicrosoft\u002Fperfview","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_28":{"__typename":"Paragraph","id":"829a245ca4fd_28","name":"45b4","type":"H4","href":null,"layout":null,"metadata":null,"text":"Viewing an individual provider","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_29":{"__typename":"Paragraph","id":"829a245ca4fd_29","name":"be16","type":"P","href":null,"layout":null,"metadata":null,"text":"The logman tool prints basic information about a provider. For example:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":4,"end":10,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"MediaResource:c715ff0987ec51e49f6d80764b951497":{"__typename":"MediaResource","id":"c715ff0987ec51e49f6d80764b951497","iframeSrc":"","iframeHeight":0,"iframeWidth":0,"title":"etw-view-provider"},"Paragraph:829a245ca4fd_30":{"__typename":"Paragraph","id":"829a245ca4fd_30","name":"fbaa","type":"IFRAME","href":null,"layout":"INSET_CENTER","metadata":null,"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":{"__typename":"Iframe","mediaResource":{"__ref":"MediaResource:c715ff0987ec51e49f6d80764b951497"}},"mixtapeMetadata":null},"Paragraph:829a245ca4fd_31":{"__typename":"Paragraph","id":"829a245ca4fd_31","name":"f3d4","type":"P","href":null,"layout":null,"metadata":null,"text":"The listings shows supported keywords and logging values, as well as all processes that are registered to emit events via this provider. This output is useful for understanding how existing trace sessions filter on providers. It is also useful for initial discovery of potentially interesting information that could be gathered from via an ETW trace.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_32":{"__typename":"Paragraph","id":"829a245ca4fd_32","name":"87c7","type":"P","href":null,"layout":null,"metadata":null,"text":"Notably, the PowerShell provider appears to support logging to the event log based on the existence of the reserved keywords in the high nibble of the defined keywords. Not all ETW providers are designed to be ingested into the event log; rather, many ETW providers are intended to be used solely for low-level tracing, debugging, and more recently-developed security telemetry purposes. For example, Windows Defender Advanced Threat Protection relies heavily upon ETW as a supplemental detection data source.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_33":{"__typename":"Paragraph","id":"829a245ca4fd_33","name":"8699","type":"H4","href":null,"layout":null,"metadata":null,"text":"Viewing all providers that a specific process is sending events to","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_34":{"__typename":"Paragraph","id":"829a245ca4fd_34","name":"985f","type":"P","href":null,"layout":null,"metadata":null,"text":"Another method for discovering potentially interesting providers is to view all providers to which events are written from a specific process. For example, the following listing shows all providers relevant to MsMpEng.exe (the Windows Defender service, running as pid 5244 in this example):","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":210,"end":221,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"MediaResource:e4120c75aa2faf5647145ea6ad3eeb87":{"__typename":"MediaResource","id":"e4120c75aa2faf5647145ea6ad3eeb87","iframeSrc":"","iframeHeight":0,"iframeWidth":0,"title":"etw-view-provider-for-event"},"Paragraph:829a245ca4fd_35":{"__typename":"Paragraph","id":"829a245ca4fd_35","name":"4174","type":"IFRAME","href":null,"layout":"INSET_CENTER","metadata":null,"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":{"__typename":"Iframe","mediaResource":{"__ref":"MediaResource:e4120c75aa2faf5647145ea6ad3eeb87"}},"mixtapeMetadata":null},"Paragraph:829a245ca4fd_36":{"__typename":"Paragraph","id":"829a245ca4fd_36","name":"5e54","type":"P","href":null,"layout":null,"metadata":null,"text":"Entries listed with GUID are providers lacking a manifest. They will typically be related to WPP or TraceLogging, both of which are beyond the scope of this blog post. It is possible to retrieve provider names and event metadata for these providers types. For example, here are some of the resolved provider names from the unnamed providers above:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":93,"end":96,"href":"https:\u002F\u002Fdocs.microsoft.com\u002Fen-us\u002Fwindows-hardware\u002Fdrivers\u002Fdevtest\u002Fwpp-software-tracing","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":100,"end":112,"href":"https:\u002F\u002Fdocs.microsoft.com\u002Fen-us\u002Fwindows\u002Fdesktop\u002Ftracelogging\u002Ftrace-logging-portal","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_37":{"__typename":"Paragraph","id":"829a245ca4fd_37","name":"1574","type":"ULI","href":null,"layout":null,"metadata":null,"text":"05F95EFE-7F75–49C7-A994–60A55CC09571\nMicrosoft.Windows.Kernel.KernelBase","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_38":{"__typename":"Paragraph","id":"829a245ca4fd_38","name":"a9a9","type":"ULI","href":null,"layout":null,"metadata":null,"text":"072665FB-8953–5A85–931D-D06AEAB3D109\nMicrosoft.Windows.ProcessLifetimeManage","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_39":{"__typename":"Paragraph","id":"829a245ca4fd_39","name":"4bfe","type":"ULI","href":null,"layout":null,"metadata":null,"text":"7AF898D7–7E0E-518D-5F96-B1E79239484C\nMicrosoft.Windows.Defender","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_40":{"__typename":"Paragraph","id":"829a245ca4fd_40","name":"9421","type":"H3","href":null,"layout":null,"metadata":null,"text":"Event provider internals","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_41":{"__typename":"Paragraph","id":"829a245ca4fd_41","name":"15ae","type":"P","href":null,"layout":null,"metadata":null,"text":"Looking at ETW-replated code snippets in built-in Windows binaries can help you understand how ETW events are constructed and how they surface in event logs. Below, we highlight two code samples, System.Management.Automation.dll (the core PowerShell assembly) and amsi.dll.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":196,"end":228,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":264,"end":272,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_42":{"__typename":"Paragraph","id":"829a245ca4fd_42","name":"8a0d","type":"H4","href":null,"layout":null,"metadata":null,"text":"System.Management.Automation.dll event tracing","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_43":{"__typename":"Paragraph","id":"829a245ca4fd_43","name":"43af","type":"P","href":null,"layout":null,"metadata":null,"text":"One of the great security features of PowerShell version 5 is scriptblock autologging; when enabled, script content is automatically logged to the Microsoft-Windows-PowerShell\u002FOperational event log with event ID 4104 (warning level) if the scriptblock contains any suspicious terms. The following C# code is executed to generate the event log:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":62,"end":85,"href":"https:\u002F\u002Fblogs.msdn.microsoft.com\u002Fpowershell\u002F2015\u002F06\u002F09\u002Fpowershell-the-blue-team\u002F","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":265,"end":281,"href":"https:\u002F\u002Fgithub.com\u002FPowerShell\u002FPowerShell\u002Fblob\u002F79f21b41de0de9b2f68a19ba1fdef0b98f3fb1cb\u002Fsrc\u002FSystem.Management.Automation\u002Fengine\u002Fruntime\u002FCompiledScriptBlock.cs#L1546-L1829","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":300,"end":304,"href":"https:\u002F\u002Fgithub.com\u002FPowerShell\u002FPowerShell\u002Fblob\u002Fc1e171622acb2917914fbc3fde69322b07863b3b\u002Fsrc\u002FSystem.Management.Automation\u002Fengine\u002Fruntime\u002FCompiledScriptBlock.cs#L1440-L1444","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"MediaResource:192cb37283cbec5e9d42c6ca6a5b8432":{"__typename":"MediaResource","id":"192cb37283cbec5e9d42c6ca6a5b8432","iframeSrc":"","iframeHeight":0,"iframeWidth":0,"title":"etw-generate-event.cs"},"Paragraph:829a245ca4fd_44":{"__typename":"Paragraph","id":"829a245ca4fd_44","name":"4f07","type":"IFRAME","href":null,"layout":"INSET_CENTER","metadata":null,"text":"From PowerShell","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":5,"end":15,"href":"https:\u002F\u002Fgithub.com\u002FPowerShell\u002FPowerShell\u002Fblob\u002Fc1e171622acb2917914fbc3fde69322b07863b3b\u002Fsrc\u002FSystem.Management.Automation\u002Fengine\u002Fruntime\u002FCompiledScriptBlock.cs#L1440-L1444","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":{"__typename":"Iframe","mediaResource":{"__ref":"MediaResource:192cb37283cbec5e9d42c6ca6a5b8432"}},"mixtapeMetadata":null},"Paragraph:829a245ca4fd_45":{"__typename":"Paragraph","id":"829a245ca4fd_45","name":"d19e","type":"P","href":null,"layout":null,"metadata":null,"text":"The LogOperationalWarning method is implemented as follows:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":4,"end":25,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"MediaResource:97d45e0a3a24e8aac2c695f503b09674":{"__typename":"MediaResource","id":"97d45e0a3a24e8aac2c695f503b09674","iframeSrc":"","iframeHeight":0,"iframeWidth":0,"title":"etw-log-warning.cs"},"Paragraph:829a245ca4fd_46":{"__typename":"Paragraph","id":"829a245ca4fd_46","name":"96c0","type":"IFRAME","href":null,"layout":"INSET_CENTER","metadata":null,"text":"From PowerShell","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":5,"end":15,"href":"https:\u002F\u002Fgithub.com\u002FPowerShell\u002FPowerShell\u002Fblob\u002F5d03e1653a7d518715fa3f00587cad6b5c78cc89\u002Fsrc\u002FSystem.Management.Automation\u002Futils\u002Ftracing\u002FPSEtwLog.cs#L155-L158","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":{"__typename":"Iframe","mediaResource":{"__ref":"MediaResource:97d45e0a3a24e8aac2c695f503b09674"}},"mixtapeMetadata":null},"Paragraph:829a245ca4fd_47":{"__typename":"Paragraph","id":"829a245ca4fd_47","name":"1df1","type":"P","href":null,"layout":null,"metadata":null,"text":"The WriteEvent method is implemented as follows:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":4,"end":14,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"MediaResource:00c8c44921bbdd4e687e4a627c321bbc":{"__typename":"MediaResource","id":"00c8c44921bbdd4e687e4a627c321bbc","iframeSrc":"","iframeHeight":0,"iframeWidth":0,"title":"etw-write-event.cs"},"Paragraph:829a245ca4fd_48":{"__typename":"Paragraph","id":"829a245ca4fd_48","name":"c841","type":"IFRAME","href":null,"layout":"INSET_CENTER","metadata":null,"text":"From PowerShell","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":5,"end":15,"href":"https:\u002F\u002Fgithub.com\u002FPowerShell\u002FPowerShell\u002Fblob\u002F5d03e1653a7d518715fa3f00587cad6b5c78cc89\u002Fsrc\u002FSystem.Management.Automation\u002Futils\u002Ftracing\u002FPSEtwLogProvider.cs#L269-L287","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":{"__typename":"Iframe","mediaResource":{"__ref":"MediaResource:00c8c44921bbdd4e687e4a627c321bbc"}},"mixtapeMetadata":null},"Paragraph:829a245ca4fd_49":{"__typename":"Paragraph","id":"829a245ca4fd_49","name":"a536","type":"P","href":null,"layout":null,"metadata":null,"text":"Finally, the event information is marshaled and EventWriteTransfer is called, supplying the Microsoft-Windows-PowerShell provider with event data.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":48,"end":66,"href":"https:\u002F\u002Fdocs.microsoft.com\u002Fen-us\u002Fwindows\u002Fdesktop\u002Fapi\u002Fevntprov\u002Fnf-evntprov-eventwritetransfer","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_50":{"__typename":"Paragraph","id":"829a245ca4fd_50","name":"849e","type":"P","href":null,"layout":null,"metadata":null,"text":"The relevant data supplied to EventWriteTransfer is as follows:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":30,"end":48,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_51":{"__typename":"Paragraph","id":"829a245ca4fd_51","name":"f372","type":"ULI","href":null,"layout":null,"metadata":null,"text":"Microsoft-Windows-PowerShell provider GUID: {A0C1853B-5C40-4b15-8766-3CF1C58F985A}","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":44,"end":82,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_52":{"__typename":"Paragraph","id":"829a245ca4fd_52","name":"6feb","type":"ULI","href":null,"layout":null,"metadata":null,"text":"Event ID: PSEventId.ScriptBlock_Compile_Detail - 4104","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":10,"end":53,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_53":{"__typename":"Paragraph","id":"829a245ca4fd_53","name":"2516","type":"ULI","href":null,"layout":null,"metadata":null,"text":"Channel value: PSChannel.Operational - 16\nAgain, the usage of a channel value indicates that the provider is intended to be used with the event log. The operational channel definition for the PowerShell ETW manifest can be seen here. When an explicit channel value is not supplied, Message Compiler (mc.exe) will assign a default value starting at 16. Since the operational channel was defined first, it was assigned 16.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":15,"end":42,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":300,"end":306,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":228,"end":232,"href":"https:\u002F\u002Fgithub.com\u002FPowerShell\u002FPowerShell-Native\u002Fblob\u002Fmaster\u002Fsrc\u002FPowerShell.Core.Instrumentation\u002FPowerShell.Core.Instrumentation.man#L2194-L2202","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":282,"end":298,"href":"https:\u002F\u002Fdocs.microsoft.com\u002Fen-us\u002Fwindows\u002Fdesktop\u002Fwes\u002Fmessage-compiler--mc-exe-","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_54":{"__typename":"Paragraph","id":"829a245ca4fd_54","name":"3667","type":"ULI","href":null,"layout":null,"metadata":null,"text":"Opcode value: PSOpcode.Create - 15","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":14,"end":34,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_55":{"__typename":"Paragraph","id":"829a245ca4fd_55","name":"ccf0","type":"ULI","href":null,"layout":null,"metadata":null,"text":"Logging level: PSLevel.Warning - 3","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":15,"end":34,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_56":{"__typename":"Paragraph","id":"829a245ca4fd_56","name":"2ff7","type":"ULI","href":null,"layout":null,"metadata":null,"text":"Task value: PSTask.CommandStart - 102","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":12,"end":37,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_57":{"__typename":"Paragraph","id":"829a245ca4fd_57","name":"b21f","type":"ULI","href":null,"layout":null,"metadata":null,"text":"Keyword value: PSKeyword.UseAlwaysAnalytic - 0x4000000000000000\nThis value is later translated to 0 as seen in the code block above. Normally, this event would not be logged but because the Application event log trace session specifies the EVENT_ENABLE_PROPERTY_ENABLE_KEYWORD_0 Enable flag for all of its providers which will log the event despite a keyword value not being specified.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":15,"end":64,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":240,"end":285,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_58":{"__typename":"Paragraph","id":"829a245ca4fd_58","name":"f7e7","type":"ULI","href":null,"layout":null,"metadata":null,"text":"Event data: the scriptblock contents and event fields","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_59":{"__typename":"Paragraph","id":"829a245ca4fd_59","name":"af08","type":"P","href":null,"layout":null,"metadata":null,"text":"Upon receiving the event from the PowerShell ETW provider, the event log service parses the binary WEVT_TEMPLATE schema (original XML schema) and presents human-readable, parsed event properties\u002Ffields:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":99,"end":112,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":121,"end":140,"href":"https:\u002F\u002Fgithub.com\u002FPowerShell\u002FPowerShell-Native\u002Fblob\u002Fmaster\u002Fsrc\u002FPowerShell.Core.Instrumentation\u002FPowerShell.Core.Instrumentation.man","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*ORet99fS6ZXb925L0b8BVQ.png":{"__typename":"ImageMetadata","id":"1*ORet99fS6ZXb925L0b8BVQ.png","originalHeight":264,"originalWidth":582,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:829a245ca4fd_60":{"__typename":"Paragraph","id":"829a245ca4fd_60","name":"62f9","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*ORet99fS6ZXb925L0b8BVQ.png"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_61":{"__typename":"Paragraph","id":"829a245ca4fd_61","name":"6875","type":"H4","href":null,"layout":null,"metadata":null,"text":"amsi.dll event tracing","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_62":{"__typename":"Paragraph","id":"829a245ca4fd_62","name":"65ca","type":"P","href":null,"layout":null,"metadata":null,"text":"You may have observed that Windows 10 has an AMSI\u002FOperational event log that is typically empty. To understand why events are not logged to this event log, you would first have to inspect how data is fed to the AMSI ETW provider (Microsoft-Antimalware-Scan-Interface - {2A576B87-09A7-520E-C21A-4942F0271D67}) and then observe how the Application event log trace session (EventLog-Application) subscribes to the AMSI ETW provider. Let’s start by looking at the provider registration in the Application event log. The following PowerShell cmdlet will supply us with this information:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":230,"end":307,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":371,"end":391,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_63":{"__typename":"Paragraph","id":"829a245ca4fd_63","name":"b42d","type":"PRE","href":null,"layout":null,"metadata":null,"text":"\u003E Get-EtwTraceProvider -SessionName EventLog-Application -Guid '{2A576B87-09A7-520E-C21A-4942F0271D67}'","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":2,"end":103,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_64":{"__typename":"Paragraph","id":"829a245ca4fd_64","name":"b2e1","type":"PRE","href":null,"layout":null,"metadata":null,"text":"SessionName     : EventLog-Application\nGuid            : {2A576B87-09A7-520E-C21A-4942F0271D67}\nLevel           : 255\nMatchAnyKeyword : 0x8000000000000000\nMatchAllKeyword : 0x0\nEnableProperty  : {EVENT_ENABLE_PROPERTY_ENABLE_KEYWORD_0, EVENT_ENABLE_PROPERTY_SID}","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_65":{"__typename":"Paragraph","id":"829a245ca4fd_65","name":"4c5c","type":"P","href":null,"layout":null,"metadata":null,"text":"The following properties should be noted:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_66":{"__typename":"Paragraph","id":"829a245ca4fd_66","name":"669b","type":"ULI","href":null,"layout":null,"metadata":null,"text":"Operational channel events (as indicated by 0x8000000000000000 in the MatchAnyKeyword value) are captured.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":44,"end":62,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_67":{"__typename":"Paragraph","id":"829a245ca4fd_67","name":"0c54","type":"ULI","href":null,"layout":null,"metadata":null,"text":"All logging levels are captured.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_68":{"__typename":"Paragraph","id":"829a245ca4fd_68","name":"5b7a","type":"ULI","href":null,"layout":null,"metadata":null,"text":"Events should be captured even if an event keyword value is zero as indicated by the EVENT_ENABLE_PROPERTY_ENABLE_KEYWORD_0 flag.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":85,"end":123,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_69":{"__typename":"Paragraph","id":"829a245ca4fd_69","name":"3407","type":"P","href":null,"layout":null,"metadata":null,"text":"This information on its own does not explain why AMSI events are not logged, but it supplies needed context upon inspecting how amsi.dll writes events to ETW. By loading amsi.dl into IDA, we can see that there was a single call to the EventWrite function within the internal CAmsiAntimalware::GenerateEtwEvent function:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":128,"end":136,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":170,"end":177,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":235,"end":245,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":275,"end":309,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*YTbNASnN_A5biCyAfqUljQ.png":{"__typename":"ImageMetadata","id":"1*YTbNASnN_A5biCyAfqUljQ.png","originalHeight":522,"originalWidth":458,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:829a245ca4fd_70":{"__typename":"Paragraph","id":"829a245ca4fd_70","name":"a93b","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*YTbNASnN_A5biCyAfqUljQ.png"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_71":{"__typename":"Paragraph","id":"829a245ca4fd_71","name":"b297","type":"P","href":null,"layout":null,"metadata":null,"text":"The relevant portion of the call to EventWrite is the EventDescriptor argument. Upon applying the EVENT_DESCRIPTOR structure type to _AMSI_SCANBUFFER, the following information was interpreted:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":36,"end":46,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":54,"end":69,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":98,"end":114,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":133,"end":149,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*khNJj2-2qqDn9hruBL5bZg.png":{"__typename":"ImageMetadata","id":"1*khNJj2-2qqDn9hruBL5bZg.png","originalHeight":136,"originalWidth":624,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:829a245ca4fd_72":{"__typename":"Paragraph","id":"829a245ca4fd_72","name":"ef01","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*khNJj2-2qqDn9hruBL5bZg.png"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_73":{"__typename":"Paragraph","id":"829a245ca4fd_73","name":"9705","type":"P","href":null,"layout":null,"metadata":null,"text":"The EVENT_DESCRIPTOR context gives us the relevant information:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":4,"end":20,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_74":{"__typename":"Paragraph","id":"829a245ca4fd_74","name":"09f9","type":"ULI","href":null,"layout":null,"metadata":null,"text":"Event ID: 1101 (0x44D)\nThis events details can be extracted from a recovered manifest as seen here.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":10,"end":23,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":94,"end":98,"href":"https:\u002F\u002Fgist.github.com\u002Fmattifestation\u002F6b3bbbea56cfc01bbfed9f74d94db618#file-microsoft-antimalware-scan-interface-manifest-xml-L12-L25","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_75":{"__typename":"Paragraph","id":"829a245ca4fd_75","name":"4938","type":"ULI","href":null,"layout":null,"metadata":null,"text":"Channel: 16 (0x10) referring to the operational event log channel","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":9,"end":18,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_76":{"__typename":"Paragraph","id":"829a245ca4fd_76","name":"4725","type":"ULI","href":null,"layout":null,"metadata":null,"text":"Level: 4 (Informational)","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_77":{"__typename":"Paragraph","id":"829a245ca4fd_77","name":"90ff","type":"ULI","href":null,"layout":null,"metadata":null,"text":"Keyword: 0x8000000000000001 (AMSI\u002FOperational OR Event1). These values are interpreted by running the logman query providers Microsoft-Antimalware-Scan-Interface command.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":9,"end":27,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":102,"end":161,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_78":{"__typename":"Paragraph","id":"829a245ca4fd_78","name":"e9c0","type":"P","href":null,"layout":null,"metadata":null,"text":"We now understand that 1101 events not logged to the Application event log because it only considers events where the keyword value matches 0x8000000000000000. In order to fix this issue and get events pumping into the event log, either the Application event log trace session would need to be modified (not recommended and requires SYSTEM privileges) or you could create your own persistent trace session (e.g., an autologger) to capture AMSI events in the event log. The following PowerShell script creates such a trace session:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":416,"end":426,"href":"https:\u002F\u002Fdocs.microsoft.com\u002Fen-us\u002Fwindows\u002Fdesktop\u002Fetw\u002Fconfiguring-and-starting-an-autologger-session","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_79":{"__typename":"Paragraph","id":"829a245ca4fd_79","name":"065a","type":"PRE","href":null,"layout":null,"metadata":null,"text":"$AutoLoggerGuid = \"{$((New-Guid).Guid)}\"\nNew-AutologgerConfig -Name MyCustomAutoLogger -Guid $AutoLoggerGuid -Start Enabled\nAdd-EtwTraceProvider -AutologgerName MyCustomAutoLogger -Guid '{2A576B87-09A7-520E-C21A-4942F0271D67}' -Level 0xff -MatchAnyKeyword 0x80000000000001 -Property 0x41","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_80":{"__typename":"Paragraph","id":"829a245ca4fd_80","name":"49a9","type":"P","href":null,"layout":null,"metadata":null,"text":"After running the above command, reboot, and the AMSI event log will begin to populate.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*zegstKi6t8mJlwFYr6wFlA.png":{"__typename":"ImageMetadata","id":"1*zegstKi6t8mJlwFYr6wFlA.png","originalHeight":473,"originalWidth":624,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:829a245ca4fd_81":{"__typename":"Paragraph","id":"829a245ca4fd_81","name":"690e","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*zegstKi6t8mJlwFYr6wFlA.png"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_82":{"__typename":"Paragraph","id":"829a245ca4fd_82","name":"8515","type":"P","href":null,"layout":null,"metadata":null,"text":"Some additional reverse engineering showed that the scanResult field refers to the AMSI_RESULT enum where, in this case, 32768 maps to AMSI_RESULT_DETECTED, indicating that the buffer (the Unicode encoded buffer in the content field) was determined to be malicious.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":52,"end":62,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":135,"end":155,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":83,"end":94,"href":"https:\u002F\u002Fdocs.microsoft.com\u002Fen-us\u002Fwindows\u002Fdesktop\u002Fapi\u002Famsi\u002Fne-amsi-amsi_result","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_83":{"__typename":"Paragraph","id":"829a245ca4fd_83","name":"3692","type":"P","href":null,"layout":null,"metadata":null,"text":"Without knowledge of ETW internals, a defender would not have been able to determine that additional data sources (the AMSI log in this case) can be fed into the event log. One would have to resort to speculation as to how the AMSI event became to be misconfigured and whether or not the misconfiguration was intentional.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_84":{"__typename":"Paragraph","id":"829a245ca4fd_84","name":"c59f","type":"H3","href":null,"layout":null,"metadata":null,"text":"ETW tampering techniques","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_85":{"__typename":"Paragraph","id":"829a245ca4fd_85","name":"2b75","type":"P","href":null,"layout":null,"metadata":null,"text":"If the goal of an attacker is to subvert event logging, ETW provides a stealthy mechanism to affect logging without itself generating an event log trail. Below is a non-exhaustive list of tampering techniques that an attacker can use to cut off the supply of events to a specific event log.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_86":{"__typename":"Paragraph","id":"829a245ca4fd_86","name":"1acf","type":"P","href":null,"layout":null,"metadata":null,"text":"Tampering techniques can generally be broken down into two categories:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_87":{"__typename":"Paragraph","id":"829a245ca4fd_87","name":"43f9","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Persistent, requiring reboot — i.e., a reboot must occur before the attack takes effect. Changes can be reverted, but would require another reboot. These attacks involve altering autologger settings — persistent ETW trace sessions with settings in the registry. There are more types of persistent attacks than ephemeral attacks, and they are usually more straightforward to detect.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":179,"end":189,"href":"https:\u002F\u002Fdocs.microsoft.com\u002Fen-us\u002Fwindows\u002Fdesktop\u002Fetw\u002Fconfiguring-and-starting-an-autologger-session","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_88":{"__typename":"Paragraph","id":"829a245ca4fd_88","name":"5bbd","type":"OLI","href":null,"layout":null,"metadata":null,"text":"Ephemeral — i.e., where the attack can take place without a reboot.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_89":{"__typename":"Paragraph","id":"829a245ca4fd_89","name":"e24f","type":"H4","href":null,"layout":null,"metadata":null,"text":"Autologger provider removal","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_90":{"__typename":"Paragraph","id":"829a245ca4fd_90","name":"ed5c","type":"P","href":null,"layout":null,"metadata":null,"text":"Tampering category: Persistent, requiring reboot\nMinimum permissions required: Administrator\nDetection artifacts: Registry key deletion: HKLM\\SYSTEM\\CurrentControlSet\\Control\\WMI\\Autologger\\AUTOLOGGER_NAME\\{PROVIDER_GUID}\n\nDescription: This technique involves the removal of a provider entry from a configured autologger. Removing a provider registration from an autologger will cause events to cease to flow to the respective trace session.\n \nExample: The following PowerShell code disables Microsoft-Windows-PowerShell event logging:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":137,"end":221,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":0,"end":18,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":49,"end":77,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":93,"end":112,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":223,"end":234,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":444,"end":451,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_91":{"__typename":"Paragraph","id":"829a245ca4fd_91","name":"d85f","type":"PRE","href":null,"layout":null,"metadata":null,"text":"Remove-EtwTraceProvider -AutologgerName EventLog-Application -Guid '{A0C1853B-5C40-4B15-8766-3CF1C58F985A}'","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_92":{"__typename":"Paragraph","id":"829a245ca4fd_92","name":"a4df","type":"P","href":null,"layout":null,"metadata":null,"text":"In the above example, A0C1853B-5C40-4B15-8766-3CF1C58F985A refers to the Microsoft-Windows-PowerShell ETW provider. This command will end up deleting the HKLM\\System\\CurrentControlSet\\Control\\WMI\\Autologger\\EventLog-Application\\{a0c1853b-5c40-4b15-8766-3cf1c58f985a} registry key.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":22,"end":58,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":154,"end":266,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_93":{"__typename":"Paragraph","id":"829a245ca4fd_93","name":"29b9","type":"H4","href":null,"layout":null,"metadata":null,"text":"Provider “Enable” property modification","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_94":{"__typename":"Paragraph","id":"829a245ca4fd_94","name":"8f0e","type":"P","href":null,"layout":null,"metadata":null,"text":"Tampering category: Persistent, requiring reboot\nMinimum permissions required: Administrator\nDetection artifacts: Registry value modification: HKLM\\SYSTEM\\CurrentControlSet\\Control\\WMI\\Autologger\\AUTOLOGGER_NAME\\{PROVIDER_GUID} - EnableProperty (REG_DWORD)\n\nDescription: This technique involves alerting the Enable keyword of an autologger session. For example, by default, all ETW provider entries in the EventLog-Application autologger session are set to 0x41 which translates to EVENT_ENABLE_PROPERTY_SID and EVENT_ENABLE_PROPERTY_ENABLE_KEYWORD_0. EVENT_ENABLE_PROPERTY_ENABLE_KEYWORD_0 is not documented; it specifies that any events generated for a provider should be logged even if the keyword value is set to 0. An attacker could swap out EVENT_ENABLE_PROPERTY_ENABLE_KEYWORD_0 for EVENT_ENABLE_PROPERTY_IGNORE_KEYWORD_0, resulting in a value of 0x11, which would result in all events where the keyword is 0 to not be logged. For example, PowerShell eventing supplies a 0 keyword value with its events, resulting in no logging to the PowerShell event log.\n\nExample: The following PowerShell code disables Microsoft-Windows-PowerShell event logging:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":143,"end":256,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":308,"end":314,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":406,"end":426,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":457,"end":461,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":482,"end":507,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":512,"end":550,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":552,"end":590,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":747,"end":785,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":790,"end":828,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":854,"end":858,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":0,"end":18,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":49,"end":77,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":93,"end":112,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":258,"end":269,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":1065,"end":1072,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_95":{"__typename":"Paragraph","id":"829a245ca4fd_95","name":"f97c","type":"PRE","href":null,"layout":null,"metadata":null,"text":"Set-EtwTraceProvider -Guid '{A0C1853B-5C40-4B15-8766-3CF1C58F985A}' -AutologgerName 'EventLog-Application' -Property 0x11","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_96":{"__typename":"Paragraph","id":"829a245ca4fd_96","name":"2d75","type":"P","href":null,"layout":null,"metadata":null,"text":"In the above example, A0C1853B-5C40-4B15-8766-3CF1C58F985A refers to the Microsoft-Windows-PowerShell ETW provider. This command will end up setting HKLM\\System\\CurrentControlSet\\Control\\WMI\\Autologger\\EventLog-Application\\{a0c1853b-5c40-4b15-8766-3cf1c58f985a}\\EnableProperty to 0x11. Upon rebooting, events will cease to be reported to the PowerShell event log.\n \nAn attacker is not constrained to using just the Set-EtwTraceProvider cmdlet to carry out this attack. An attacker could just modify the value directly in the registry. Set-EtwTraceProvider offers a convenient autologger configuration abstraction.\n\nAlternative detection artifacts\u002Fideas: If possible, it is advisable to monitor for modifications of values within the HKLM\\SYSTEM\\CurrentControlSet\\Control\\WMI\\Autologger\\AUTOLOGGER_NAME\\{PROVIDER_GUID} registry key. Note that modifying EnableProperty is just one specific example and that an attacker can alter ETW providers in other ways, too.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":22,"end":58,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":149,"end":276,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":280,"end":284,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":535,"end":555,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":733,"end":817,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":852,"end":866,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":415,"end":435,"href":"https:\u002F\u002Fdocs.microsoft.com\u002Fen-us\u002Fpowershell\u002Fmodule\u002Feventtracmancmdlets\u002Fset-etwtraceprovider?view=win10-ps","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":615,"end":652,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_97":{"__typename":"Paragraph","id":"829a245ca4fd_97","name":"8e57","type":"H4","href":null,"layout":null,"metadata":null,"text":"ETW provider removal from a trace session","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_98":{"__typename":"Paragraph","id":"829a245ca4fd_98","name":"cc05","type":"P","href":null,"layout":null,"metadata":null,"text":"Tampering category: Ephemeral\nMinimum permissions required: SYSTEM\nDetection artifacts: Unfortunately, no file, registry, or event log artifacts are associated with this event. While the technique example below indicates that logman.exe was used to perform the attack, an attacker can obfuscate their techniques by using Win32 APIs directly, WMI, DCOM, PowerShell, etc.\n \nDescription: This technique involves removing an ETW provider from a trace session, cutting off its ability to supply a targeted event log with events until a reboot occurs, or until the attacker restores the provider. While an attacker must have SYSTEM privileges to perform this attack, it is unlikely that defenders will notice such an attack if they rely on event logs for threat detection.\n \nExample: The following PowerShell code immediately disables Microsoft-Windows-PowerShell event logging until a reboot occurs or the attacker restores the ETW provider:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":226,"end":236,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":0,"end":18,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":30,"end":58,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":67,"end":86,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":372,"end":383,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":769,"end":776,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_99":{"__typename":"Paragraph","id":"829a245ca4fd_99","name":"e273","type":"PRE","href":null,"layout":null,"metadata":null,"text":"logman update trace EventLog-Application --p Microsoft-Windows-PowerShell -ets","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":0,"end":78,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_100":{"__typename":"Paragraph","id":"829a245ca4fd_100","name":"e3c5","type":"P","href":null,"layout":null,"metadata":null,"text":"Alternative detection artifacts\u002Fideas:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"STRONG","start":0,"end":37,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_101":{"__typename":"Paragraph","id":"829a245ca4fd_101","name":"06e4","type":"ULI","href":null,"layout":null,"metadata":null,"text":"Event ID 12 within the Microsoft-Windows-Kernel-EventTracing\u002FAnalytic log indicates when a trace session is modified, but it doesn’t supply the provider name or GUID that was removed, so it would be difficult to confidently determine whether or not something suspicious occurred using this event.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_102":{"__typename":"Paragraph","id":"829a245ca4fd_102","name":"aefa","type":"ULI","href":null,"layout":null,"metadata":null,"text":"There have been several references thus far to the ETW PowerShell cmdlets housed in the EventTracingManagement module, which itself is a CDXML-based module. This means that all the cmdlets in the EventTracingManagement are backed by WMI classes. For example, the Get-EtwTraceProvider cmdlet is backed by the ROOT\u002FMicrosoft\u002FWindows\u002FEventTracingManagement:MSFT_EtwTraceProvider class. Considering ETW providers can be represented in the form of WMI class instances, you could craft a permanent WMI event subscription that logs all provider removals from a specific trace session to the event log. This code sample creates an NtEventLogEventConsumer instance that logs event ID 8 to the Application event log (source: WSH) any time a provider is removed from the Application event log trace session, EventLog-Application. The logged event looks like the following:","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":88,"end":110,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":196,"end":218,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":263,"end":283,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":308,"end":375,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":623,"end":646,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":797,"end":817,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":595,"end":611,"href":"https:\u002F\u002Fgist.github.com\u002Fmattifestation\u002F9f07e4ab0df84cfd176fe40db2d60aa8","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:1*6fkfDWJ2pSt7lOh1g77gmg.png":{"__typename":"ImageMetadata","id":"1*6fkfDWJ2pSt7lOh1g77gmg.png","originalHeight":300,"originalWidth":534,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:829a245ca4fd_103":{"__typename":"Paragraph","id":"829a245ca4fd_103","name":"c79a","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:1*6fkfDWJ2pSt7lOh1g77gmg.png"},"text":"","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_104":{"__typename":"Paragraph","id":"829a245ca4fd_104","name":"dd41","type":"ULI","href":null,"layout":null,"metadata":null,"text":"The frequency at which providers are removed from Application event logs in large environments is not currently known. As as fallback, it is still advised to log the execution of logman.exe, wpr.exe, and PowerShell in your environment.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"CODE","start":179,"end":189,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"CODE","start":191,"end":198,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_105":{"__typename":"Paragraph","id":"829a245ca4fd_105","name":"5c57","type":"H3","href":null,"layout":null,"metadata":null,"text":"Conclusion","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_106":{"__typename":"Paragraph","id":"829a245ca4fd_106","name":"f4c1","type":"P","href":null,"layout":null,"metadata":null,"text":"Identifying blind spots and assumptions in Alerting and Detection Strategies is a crucial step in ensuring the resilience of detections. Since ETW is at the core of the event logging infrastructure, gaining an in-depth understanding of ETW tampering attacks is a valuable way to increase the integrity of security-related data sources.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_107":{"__typename":"Paragraph","id":"829a245ca4fd_107","name":"0c7b","type":"H3","href":null,"layout":null,"metadata":null,"text":"Further Reading","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_108":{"__typename":"Paragraph","id":"829a245ca4fd_108","name":"858b","type":"ULI","href":null,"layout":null,"metadata":null,"text":"ETW — Overview","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":0,"end":14,"href":"https:\u002F\u002Fblogs.msdn.microsoft.com\u002Fdcook\u002F2015\u002F09\u002F30\u002Fetw-overview\u002F","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_109":{"__typename":"Paragraph","id":"829a245ca4fd_109","name":"58fa","type":"ULI","href":null,"layout":null,"metadata":null,"text":"Instrumenting Your Code with ETW","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":0,"end":32,"href":"https:\u002F\u002Fdocs.microsoft.com\u002Fen-us\u002Fwindows-hardware\u002Ftest\u002Fweg\u002Finstrumenting-your-code-with-etw","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_110":{"__typename":"Paragraph","id":"829a245ca4fd_110","name":"4408","type":"ULI","href":null,"layout":null,"metadata":null,"text":"Event Tracing for Windows: Reducing Everest to Pike’s Peak","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":0,"end":58,"href":"https:\u002F\u002Fwww.codeproject.com\u002FArticles\u002F1190759\u002FEvent-Tracing-for-Windows-Reducing-Everest-to-Pike","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_111":{"__typename":"Paragraph","id":"829a245ca4fd_111","name":"dfc8","type":"ULI","href":null,"layout":null,"metadata":null,"text":"Use this not this: Logging \u002F Event Tracing","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":0,"end":42,"href":"https:\u002F\u002Fblogs.msdn.microsoft.com\u002Fseealso\u002F2011\u002F06\u002F08\u002Fuse-this-not-this-logging-event-tracing\u002F","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_112":{"__typename":"Paragraph","id":"829a245ca4fd_112","name":"94aa","type":"ULI","href":null,"layout":null,"metadata":null,"text":"Writing an Instrumentation Manifest","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":0,"end":35,"href":"https:\u002F\u002Fdocs.microsoft.com\u002Fen-us\u002Fwindows\u002Fdesktop\u002Fwes\u002Fwriting-an-instrumentation-manifest","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_113":{"__typename":"Paragraph","id":"829a245ca4fd_113","name":"9be1","type":"ULI","href":null,"layout":null,"metadata":null,"text":"Event Tracing Functions","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":0,"end":23,"href":"https:\u002F\u002Fdocs.microsoft.com\u002Fen-us\u002Fwindows\u002Fdesktop\u002Fetw\u002Fevent-tracing-functions","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_114":{"__typename":"Paragraph","id":"829a245ca4fd_114","name":"1294","type":"ULI","href":null,"layout":null,"metadata":null,"text":"Configuring and Starting an AutoLogger Session","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":0,"end":46,"href":"https:\u002F\u002Fdocs.microsoft.com\u002Fen-us\u002Fwindows\u002Fdesktop\u002FETW\u002Fconfiguring-and-starting-an-autologger-session","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_115":{"__typename":"Paragraph","id":"829a245ca4fd_115","name":"d342","type":"ULI","href":null,"layout":null,"metadata":null,"text":"Event Tracing","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":0,"end":13,"href":"https:\u002F\u002Fdocs.microsoft.com\u002Fen-us\u002Fwindows\u002Fdesktop\u002Fetw\u002Fevent-tracing-portal","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_116":{"__typename":"Paragraph","id":"829a245ca4fd_116","name":"6da2","type":"ULI","href":null,"layout":null,"metadata":null,"text":"TraceLogging","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":0,"end":12,"href":"https:\u002F\u002Fdocs.microsoft.com\u002Fen-us\u002Fwindows\u002Fdesktop\u002Ftracelogging\u002Ftrace-logging-portal","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_117":{"__typename":"Paragraph","id":"829a245ca4fd_117","name":"19bb","type":"H3","href":null,"layout":null,"metadata":null,"text":"Authors","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:829a245ca4fd_118":{"__typename":"Paragraph","id":"829a245ca4fd_118","name":"c3c9","type":"P","href":null,"layout":null,"metadata":null,"text":"Matt G.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"CollectionViewerEdge:collectionId:3c87dc14372f-viewerId:lo_a4ef2eb89d94":{"__typename":"CollectionViewerEdge","id":"collectionId:3c87dc14372f-viewerId:lo_a4ef2eb89d94","isEditor":false,"isMuting":false},"PostViewerEdge:postId:4be7ac62ac63-viewerId:lo_a4ef2eb89d94":{"__typename":"PostViewerEdge","shouldIndexPostForExternalSearch":true,"id":"postId:4be7ac62ac63-viewerId:lo_a4ef2eb89d94"},"Tag:palantirtech":{"__typename":"Tag","id":"palantirtech","displayTitle":"Palantirtech","normalizedTagSlug":"palantirtech"},"Tag:infosec":{"__typename":"Tag","id":"infosec","displayTitle":"Infosec","normalizedTagSlug":"infosec"},"Tag:windows":{"__typename":"Tag","id":"windows","displayTitle":"Windows","normalizedTagSlug":"windows"},"Tag:incident-response":{"__typename":"Tag","id":"incident-response","displayTitle":"Incident Response","normalizedTagSlug":"incident-response"},"Tag:cybersecurity":{"__typename":"Tag","id":"cybersecurity","displayTitle":"Cybersecurity","normalizedTagSlug":"cybersecurity"},"Post:4be7ac62ac63":{"__typename":"Post","id":"4be7ac62ac63","collection":{"__ref":"Collection:3c87dc14372f"},"content({\"postMeteringOptions\":{}})":{"__typename":"PostContent","isLockedPreviewOnly":false,"bodyModel":{"__typename":"RichText","sections":[{"__typename":"Section","name":"c052","startIndex":0,"textLayout":null,"imageLayout":null,"backgroundImage":null,"videoLayout":null,"backgroundVideo":null},{"__typename":"Section","name":"d7bf","startIndex":117,"textLayout":null,"imageLayout":null,"backgroundImage":null,"videoLayout":null,"backgroundVideo":null}],"paragraphs":[{"__ref":"Paragraph:829a245ca4fd_0"},{"__ref":"Paragraph:829a245ca4fd_1"},{"__ref":"Paragraph:829a245ca4fd_2"},{"__ref":"Paragraph:829a245ca4fd_3"},{"__ref":"Paragraph:829a245ca4fd_4"},{"__ref":"Paragraph:829a245ca4fd_5"},{"__ref":"Paragraph:829a245ca4fd_6"},{"__ref":"Paragraph:829a245ca4fd_7"},{"__ref":"Paragraph:829a245ca4fd_8"},{"__ref":"Paragraph:829a245ca4fd_9"},{"__ref":"Paragraph:829a245ca4fd_10"},{"__ref":"Paragraph:829a245ca4fd_11"},{"__ref":"Paragraph:829a245ca4fd_12"},{"__ref":"Paragraph:829a245ca4fd_13"},{"__ref":"Paragraph:829a245ca4fd_14"},{"__ref":"Paragraph:829a245ca4fd_15"},{"__ref":"Paragraph:829a245ca4fd_16"},{"__ref":"Paragraph:829a245ca4fd_17"},{"__ref":"Paragraph:829a245ca4fd_18"},{"__ref":"Paragraph:829a245ca4fd_19"},{"__ref":"Paragraph:829a245ca4fd_20"},{"__ref":"Paragraph:829a245ca4fd_21"},{"__ref":"Paragraph:829a245ca4fd_22"},{"__ref":"Paragraph:829a245ca4fd_23"},{"__ref":"Paragraph:829a245ca4fd_24"},{"__ref":"Paragraph:829a245ca4fd_25"},{"__ref":"Paragraph:829a245ca4fd_26"},{"__ref":"Paragraph:829a245ca4fd_27"},{"__ref":"Paragraph:829a245ca4fd_28"},{"__ref":"Paragraph:829a245ca4fd_29"},{"__ref":"Paragraph:829a245ca4fd_30"},{"__ref":"Paragraph:829a245ca4fd_31"},{"__ref":"Paragraph:829a245ca4fd_32"},{"__ref":"Paragraph:829a245ca4fd_33"},{"__ref":"Paragraph:829a245ca4fd_34"},{"__ref":"Paragraph:829a245ca4fd_35"},{"__ref":"Paragraph:829a245ca4fd_36"},{"__ref":"Paragraph:829a245ca4fd_37"},{"__ref":"Paragraph:829a245ca4fd_38"},{"__ref":"Paragraph:829a245ca4fd_39"},{"__ref":"Paragraph:829a245ca4fd_40"},{"__ref":"Paragraph:829a245ca4fd_41"},{"__ref":"Paragraph:829a245ca4fd_42"},{"__ref":"Paragraph:829a245ca4fd_43"},{"__ref":"Paragraph:829a245ca4fd_44"},{"__ref":"Paragraph:829a245ca4fd_45"},{"__ref":"Paragraph:829a245ca4fd_46"},{"__ref":"Paragraph:829a245ca4fd_47"},{"__ref":"Paragraph:829a245ca4fd_48"},{"__ref":"Paragraph:829a245ca4fd_49"},{"__ref":"Paragraph:829a245ca4fd_50"},{"__ref":"Paragraph:829a245ca4fd_51"},{"__ref":"Paragraph:829a245ca4fd_52"},{"__ref":"Paragraph:829a245ca4fd_53"},{"__ref":"Paragraph:829a245ca4fd_54"},{"__ref":"Paragraph:829a245ca4fd_55"},{"__ref":"Paragraph:829a245ca4fd_56"},{"__ref":"Paragraph:829a245ca4fd_57"},{"__ref":"Paragraph:829a245ca4fd_58"},{"__ref":"Paragraph:829a245ca4fd_59"},{"__ref":"Paragraph:829a245ca4fd_60"},{"__ref":"Paragraph:829a245ca4fd_61"},{"__ref":"Paragraph:829a245ca4fd_62"},{"__ref":"Paragraph:829a245ca4fd_63"},{"__ref":"Paragraph:829a245ca4fd_64"},{"__ref":"Paragraph:829a245ca4fd_65"},{"__ref":"Paragraph:829a245ca4fd_66"},{"__ref":"Paragraph:829a245ca4fd_67"},{"__ref":"Paragraph:829a245ca4fd_68"},{"__ref":"Paragraph:829a245ca4fd_69"},{"__ref":"Paragraph:829a245ca4fd_70"},{"__ref":"Paragraph:829a245ca4fd_71"},{"__ref":"Paragraph:829a245ca4fd_72"},{"__ref":"Paragraph:829a245ca4fd_73"},{"__ref":"Paragraph:829a245ca4fd_74"},{"__ref":"Paragraph:829a245ca4fd_75"},{"__ref":"Paragraph:829a245ca4fd_76"},{"__ref":"Paragraph:829a245ca4fd_77"},{"__ref":"Paragraph:829a245ca4fd_78"},{"__ref":"Paragraph:829a245ca4fd_79"},{"__ref":"Paragraph:829a245ca4fd_80"},{"__ref":"Paragraph:829a245ca4fd_81"},{"__ref":"Paragraph:829a245ca4fd_82"},{"__ref":"Paragraph:829a245ca4fd_83"},{"__ref":"Paragraph:829a245ca4fd_84"},{"__ref":"Paragraph:829a245ca4fd_85"},{"__ref":"Paragraph:829a245ca4fd_86"},{"__ref":"Paragraph:829a245ca4fd_87"},{"__ref":"Paragraph:829a245ca4fd_88"},{"__ref":"Paragraph:829a245ca4fd_89"},{"__ref":"Paragraph:829a245ca4fd_90"},{"__ref":"Paragraph:829a245ca4fd_91"},{"__ref":"Paragraph:829a245ca4fd_92"},{"__ref":"Paragraph:829a245ca4fd_93"},{"__ref":"Paragraph:829a245ca4fd_94"},{"__ref":"Paragraph:829a245ca4fd_95"},{"__ref":"Paragraph:829a245ca4fd_96"},{"__ref":"Paragraph:829a245ca4fd_97"},{"__ref":"Paragraph:829a245ca4fd_98"},{"__ref":"Paragraph:829a245ca4fd_99"},{"__ref":"Paragraph:829a245ca4fd_100"},{"__ref":"Paragraph:829a245ca4fd_101"},{"__ref":"Paragraph:829a245ca4fd_102"},{"__ref":"Paragraph:829a245ca4fd_103"},{"__ref":"Paragraph:829a245ca4fd_104"},{"__ref":"Paragraph:829a245ca4fd_105"},{"__ref":"Paragraph:829a245ca4fd_106"},{"__ref":"Paragraph:829a245ca4fd_107"},{"__ref":"Paragraph:829a245ca4fd_108"},{"__ref":"Paragraph:829a245ca4fd_109"},{"__ref":"Paragraph:829a245ca4fd_110"},{"__ref":"Paragraph:829a245ca4fd_111"},{"__ref":"Paragraph:829a245ca4fd_112"},{"__ref":"Paragraph:829a245ca4fd_113"},{"__ref":"Paragraph:829a245ca4fd_114"},{"__ref":"Paragraph:829a245ca4fd_115"},{"__ref":"Paragraph:829a245ca4fd_116"},{"__ref":"Paragraph:829a245ca4fd_117"},{"__ref":"Paragraph:829a245ca4fd_118"}]},"validatedShareKey":"","shareKeyCreator":null},"creator":{"__ref":"User:1529195d9f13"},"inResponseToEntityType":null,"isLocked":false,"isMarkedPaywallOnly":false,"lockedSource":"LOCKED_POST_SOURCE_NONE","mediumUrl":"https:\u002F\u002Fblog.palantir.com\u002Ftampering-with-windows-event-tracing-background-offense-and-defense-4be7ac62ac63","primaryTopic":null,"topics":[{"__typename":"Topic","slug":"programming"}],"isPublished":true,"latestPublishedVersion":"829a245ca4fd","visibility":"PUBLIC","postResponses":{"__typename":"PostResponses","count":1},"clapCount":208,"allowResponses":true,"isLimitedState":false,"title":"Tampering with Windows Event Tracing: Background, Offense, and Defense","isSeries":false,"sequence":null,"uniqueSlug":"tampering-with-windows-event-tracing-background-offense-and-defense-4be7ac62ac63","socialTitle":"","socialDek":"","canonicalUrl":"","metaDescription":"","latestPublishedAt":1551314956122,"readingTime":12.989622641509435,"previewContent":{"__typename":"PreviewContent","subtitle":"Event Tracing for Windows (ETW) is the mechanism Windows uses to trace and log system events. Attackers often clear event logs to cover…"},"previewImage":{"__ref":"ImageMetadata:1*SMDAeNCTr6vY7N8oTjneiA.png"},"isShortform":false,"seoTitle":"","firstPublishedAt":1545647502941,"updatedAt":1638846451072,"shortformType":"SHORTFORM_TYPE_LINK","seoDescription":"","viewerEdge":{"__ref":"PostViewerEdge:postId:4be7ac62ac63-viewerId:lo_a4ef2eb89d94"},"isSuspended":false,"license":"ALL_RIGHTS_RESERVED","tags":[{"__ref":"Tag:palantirtech"},{"__ref":"Tag:infosec"},{"__ref":"Tag:windows"},{"__ref":"Tag:incident-response"},{"__ref":"Tag:cybersecurity"}],"isNewsletter":false,"statusForCollection":"APPROVED","pendingCollection":null,"detectedLanguage":"en","wordCount":3164,"layerCake":4}}</script><script src="https://cdn-client.medium.com/lite/static/js/manifest.7e50e797.js"></script><script src="https://cdn-client.medium.com/lite/static/js/9865.1496d74a.js"></script><script src="https://cdn-client.medium.com/lite/static/js/main.018e7ca9.js"></script><script src="https://cdn-client.medium.com/lite/static/js/instrumentation.d9108df7.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/reporting.ff22a7a5.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/9120.5df29668.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/5049.d1ead72d.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/4810.6318add7.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/6618.db187378.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/1386.6a7a21a1.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/9977.84e4bd5c.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/719.ae4dd3e0.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/5250.9f9e01d2.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/6349.b071a958.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/2648.26563adf.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/8393.826a25fb.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/1443.598cb8b2.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/3735.8c38ede2.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/5642.d10c9ba0.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/6546.cd03f950.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/6834.08de95de.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/1781.db373833.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/2420.0330d157.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/839.ca7937c2.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/7975.d195c6f1.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/2106.21ff89d3.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/7394.55c925ce.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/2961.00a48598.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/230.4d7a2738.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/4391.59acaed3.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/PostPage.MainContent.563d0db5.chunk.js"></script><script>window.main();</script><script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'8d764cb27f62e123',t:'MTcyOTczNDQ1NC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body></html>