<!DOCTYPE html>
<html class='v2' dir='ltr' lang='en' xmlns='http://www.w3.org/1999/xhtml' xmlns:b='http://www.google.com/2005/gml/b' xmlns:data='http://www.google.com/2005/gml/data' xmlns:expr='http://www.google.com/2005/gml/expr'>
<head>
<link href='https://www.blogger.com/static/v1/widgets/3566091532-css_bundle_v2.css' rel='stylesheet' type='text/css'/>
<meta content='width=1100' name='viewport'/>
<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'/>
<meta content='blogger' name='generator'/>
<link href='https://googleprojectzero.blogspot.com/favicon.ico' rel='icon' type='image/x-icon'/>
<link href='https://googleprojectzero.blogspot.com/2024/12/the-windows-registry-adventure-5-regf.html' rel='canonical'/>
<link rel="alternate" type="application/atom+xml" title="Project Zero - Atom" href="https://googleprojectzero.blogspot.com/feeds/posts/default" />
<link rel="alternate" type="application/rss+xml" title="Project Zero - RSS" href="https://googleprojectzero.blogspot.com/feeds/posts/default?alt=rss" />
<link rel="service.post" type="application/atom+xml" title="Project Zero - Atom" href="https://www.blogger.com/feeds/4838136820032157985/posts/default" />

<link rel="alternate" type="application/atom+xml" title="Project Zero - Atom" href="https://googleprojectzero.blogspot.com/feeds/5470414558693895520/comments/default" />
<!--Can't find substitution for tag [blog.ieCssRetrofitLinks]-->
<link href='https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiQtJm0XNkozXGxjQnB9n1ka9OuxP7lrLSQN1KZF-Zc60Z06dBEz3AAA8aAYnmdrU4imLebCFvF6qXaE0h-uA_iXnuyAisG90JWawSAMPPaToLdXMGeC4FlyGz42FWkf1bPhJmwSez8Ot-DLI29n4jinIXswZ-LQoLyWX7PIKVF5EwkRoAXNUFYIdcCOwo/s1200/image8.png' rel='image_src'/>
<meta content='https://googleprojectzero.blogspot.com/2024/12/the-windows-registry-adventure-5-regf.html' property='og:url'/>
<meta content='The Windows Registry Adventure #5: The regf file format' property='og:title'/>
<meta content='    Posted by Mateusz Jurczyk, Google Project Zero     As previously mentioned in the second installment of the blog post series ( &quot;A brief ...' property='og:description'/>
<meta content='https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiQtJm0XNkozXGxjQnB9n1ka9OuxP7lrLSQN1KZF-Zc60Z06dBEz3AAA8aAYnmdrU4imLebCFvF6qXaE0h-uA_iXnuyAisG90JWawSAMPPaToLdXMGeC4FlyGz42FWkf1bPhJmwSez8Ot-DLI29n4jinIXswZ-LQoLyWX7PIKVF5EwkRoAXNUFYIdcCOwo/w1200-h630-p-k-no-nu/image8.png' property='og:image'/>
<title>Project Zero: The Windows Registry Adventure #5: The regf file format</title>
<style type='text/css'>@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;font-stretch:100%;font-display:swap;src:url(//fonts.gstatic.com/s/opensans/v40/memSYaGs126MiZpBA-UvWbX2vVnXBbObj2OVZyOOSr4dVJWUgsjZ0B4taVIGxA.woff2)format('woff2');unicode-range:U+0460-052F,U+1C80-1C8A,U+20B4,U+2DE0-2DFF,U+A640-A69F,U+FE2E-FE2F;}@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;font-stretch:100%;font-display:swap;src:url(//fonts.gstatic.com/s/opensans/v40/memSYaGs126MiZpBA-UvWbX2vVnXBbObj2OVZyOOSr4dVJWUgsjZ0B4kaVIGxA.woff2)format('woff2');unicode-range:U+0301,U+0400-045F,U+0490-0491,U+04B0-04B1,U+2116;}@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;font-stretch:100%;font-display:swap;src:url(//fonts.gstatic.com/s/opensans/v40/memSYaGs126MiZpBA-UvWbX2vVnXBbObj2OVZyOOSr4dVJWUgsjZ0B4saVIGxA.woff2)format('woff2');unicode-range:U+1F00-1FFF;}@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;font-stretch:100%;font-display:swap;src:url(//fonts.gstatic.com/s/opensans/v40/memSYaGs126MiZpBA-UvWbX2vVnXBbObj2OVZyOOSr4dVJWUgsjZ0B4jaVIGxA.woff2)format('woff2');unicode-range:U+0370-0377,U+037A-037F,U+0384-038A,U+038C,U+038E-03A1,U+03A3-03FF;}@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;font-stretch:100%;font-display:swap;src:url(//fonts.gstatic.com/s/opensans/v40/memSYaGs126MiZpBA-UvWbX2vVnXBbObj2OVZyOOSr4dVJWUgsjZ0B4iaVIGxA.woff2)format('woff2');unicode-range:U+0307-0308,U+0590-05FF,U+200C-2010,U+20AA,U+25CC,U+FB1D-FB4F;}@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;font-stretch:100%;font-display:swap;src:url(//fonts.gstatic.com/s/opensans/v40/memSYaGs126MiZpBA-UvWbX2vVnXBbObj2OVZyOOSr4dVJWUgsjZ0B5caVIGxA.woff2)format('woff2');unicode-range:U+0302-0303,U+0305,U+0307-0308,U+0310,U+0312,U+0315,U+031A,U+0326-0327,U+032C,U+032F-0330,U+0332-0333,U+0338,U+033A,U+0346,U+034D,U+0391-03A1,U+03A3-03A9,U+03B1-03C9,U+03D1,U+03D5-03D6,U+03F0-03F1,U+03F4-03F5,U+2016-2017,U+2034-2038,U+203C,U+2040,U+2043,U+2047,U+2050,U+2057,U+205F,U+2070-2071,U+2074-208E,U+2090-209C,U+20D0-20DC,U+20E1,U+20E5-20EF,U+2100-2112,U+2114-2115,U+2117-2121,U+2123-214F,U+2190,U+2192,U+2194-21AE,U+21B0-21E5,U+21F1-21F2,U+21F4-2211,U+2213-2214,U+2216-22FF,U+2308-230B,U+2310,U+2319,U+231C-2321,U+2336-237A,U+237C,U+2395,U+239B-23B7,U+23D0,U+23DC-23E1,U+2474-2475,U+25AF,U+25B3,U+25B7,U+25BD,U+25C1,U+25CA,U+25CC,U+25FB,U+266D-266F,U+27C0-27FF,U+2900-2AFF,U+2B0E-2B11,U+2B30-2B4C,U+2BFE,U+3030,U+FF5B,U+FF5D,U+1D400-1D7FF,U+1EE00-1EEFF;}@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;font-stretch:100%;font-display:swap;src:url(//fonts.gstatic.com/s/opensans/v40/memSYaGs126MiZpBA-UvWbX2vVnXBbObj2OVZyOOSr4dVJWUgsjZ0B5OaVIGxA.woff2)format('woff2');unicode-range:U+0001-000C,U+000E-001F,U+007F-009F,U+20DD-20E0,U+20E2-20E4,U+2150-218F,U+2190,U+2192,U+2194-2199,U+21AF,U+21E6-21F0,U+21F3,U+2218-2219,U+2299,U+22C4-22C6,U+2300-243F,U+2440-244A,U+2460-24FF,U+25A0-27BF,U+2800-28FF,U+2921-2922,U+2981,U+29BF,U+29EB,U+2B00-2BFF,U+4DC0-4DFF,U+FFF9-FFFB,U+10140-1018E,U+10190-1019C,U+101A0,U+101D0-101FD,U+102E0-102FB,U+10E60-10E7E,U+1D2C0-1D2D3,U+1D2E0-1D37F,U+1F000-1F0FF,U+1F100-1F1AD,U+1F1E6-1F1FF,U+1F30D-1F30F,U+1F315,U+1F31C,U+1F31E,U+1F320-1F32C,U+1F336,U+1F378,U+1F37D,U+1F382,U+1F393-1F39F,U+1F3A7-1F3A8,U+1F3AC-1F3AF,U+1F3C2,U+1F3C4-1F3C6,U+1F3CA-1F3CE,U+1F3D4-1F3E0,U+1F3ED,U+1F3F1-1F3F3,U+1F3F5-1F3F7,U+1F408,U+1F415,U+1F41F,U+1F426,U+1F43F,U+1F441-1F442,U+1F444,U+1F446-1F449,U+1F44C-1F44E,U+1F453,U+1F46A,U+1F47D,U+1F4A3,U+1F4B0,U+1F4B3,U+1F4B9,U+1F4BB,U+1F4BF,U+1F4C8-1F4CB,U+1F4D6,U+1F4DA,U+1F4DF,U+1F4E3-1F4E6,U+1F4EA-1F4ED,U+1F4F7,U+1F4F9-1F4FB,U+1F4FD-1F4FE,U+1F503,U+1F507-1F50B,U+1F50D,U+1F512-1F513,U+1F53E-1F54A,U+1F54F-1F5FA,U+1F610,U+1F650-1F67F,U+1F687,U+1F68D,U+1F691,U+1F694,U+1F698,U+1F6AD,U+1F6B2,U+1F6B9-1F6BA,U+1F6BC,U+1F6C6-1F6CF,U+1F6D3-1F6D7,U+1F6E0-1F6EA,U+1F6F0-1F6F3,U+1F6F7-1F6FC,U+1F700-1F7FF,U+1F800-1F80B,U+1F810-1F847,U+1F850-1F859,U+1F860-1F887,U+1F890-1F8AD,U+1F8B0-1F8BB,U+1F8C0-1F8C1,U+1F900-1F90B,U+1F93B,U+1F946,U+1F984,U+1F996,U+1F9E9,U+1FA00-1FA6F,U+1FA70-1FA7C,U+1FA80-1FA89,U+1FA8F-1FAC6,U+1FACE-1FADC,U+1FADF-1FAE9,U+1FAF0-1FAF8,U+1FB00-1FBFF;}@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;font-stretch:100%;font-display:swap;src:url(//fonts.gstatic.com/s/opensans/v40/memSYaGs126MiZpBA-UvWbX2vVnXBbObj2OVZyOOSr4dVJWUgsjZ0B4vaVIGxA.woff2)format('woff2');unicode-range:U+0102-0103,U+0110-0111,U+0128-0129,U+0168-0169,U+01A0-01A1,U+01AF-01B0,U+0300-0301,U+0303-0304,U+0308-0309,U+0323,U+0329,U+1EA0-1EF9,U+20AB;}@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;font-stretch:100%;font-display:swap;src:url(//fonts.gstatic.com/s/opensans/v40/memSYaGs126MiZpBA-UvWbX2vVnXBbObj2OVZyOOSr4dVJWUgsjZ0B4uaVIGxA.woff2)format('woff2');unicode-range:U+0100-02BA,U+02BD-02C5,U+02C7-02CC,U+02CE-02D7,U+02DD-02FF,U+0304,U+0308,U+0329,U+1D00-1DBF,U+1E00-1E9F,U+1EF2-1EFF,U+2020,U+20A0-20AB,U+20AD-20C0,U+2113,U+2C60-2C7F,U+A720-A7FF;}@font-face{font-family:'Open Sans';font-style:normal;font-weight:400;font-stretch:100%;font-display:swap;src:url(//fonts.gstatic.com/s/opensans/v40/memSYaGs126MiZpBA-UvWbX2vVnXBbObj2OVZyOOSr4dVJWUgsjZ0B4gaVI.woff2)format('woff2');unicode-range:U+0000-00FF,U+0131,U+0152-0153,U+02BB-02BC,U+02C6,U+02DA,U+02DC,U+0304,U+0308,U+0329,U+2000-206F,U+20AC,U+2122,U+2191,U+2193,U+2212,U+2215,U+FEFF,U+FFFD;}</style>
<style id='page-skin-1' type='text/css'><!--
/*
-----------------------------------------------
Blogger Template Style
Name:     Simple
Designer: Blogger
URL:      www.blogger.com
----------------------------------------------- */
/* Variable definitions
====================
<Variable name="keycolor" description="Main Color" type="color" default="#66bbdd"/>
<Group description="Page Text" selector="body">
<Variable name="body.font" description="Font" type="font"
default="normal normal 12px Arial, Tahoma, Helvetica, FreeSans, sans-serif"/>
<Variable name="body.text.color" description="Text Color" type="color" default="#222222"/>
</Group>
<Group description="Backgrounds" selector=".body-fauxcolumns-outer">
<Variable name="body.background.color" description="Outer Background" type="color" default="#66bbdd"/>
<Variable name="content.background.color" description="Main Background" type="color" default="#ffffff"/>
<Variable name="header.background.color" description="Header Background" type="color" default="transparent"/>
</Group>
<Group description="Links" selector=".main-outer">
<Variable name="link.color" description="Link Color" type="color" default="#2288bb"/>
<Variable name="link.visited.color" description="Visited Color" type="color" default="#888888"/>
<Variable name="link.hover.color" description="Hover Color" type="color" default="#33aaff"/>
</Group>
<Group description="Blog Title" selector=".header h1">
<Variable name="header.font" description="Font" type="font"
default="normal normal 60px Arial, Tahoma, Helvetica, FreeSans, sans-serif"/>
<Variable name="header.text.color" description="Title Color" type="color" default="#3399bb" />
</Group>
<Group description="Blog Description" selector=".header .description">
<Variable name="description.text.color" description="Description Color" type="color"
default="#777777" />
</Group>
<Group description="Tabs Text" selector=".tabs-inner .widget li a">
<Variable name="tabs.font" description="Font" type="font"
default="normal normal 14px Arial, Tahoma, Helvetica, FreeSans, sans-serif"/>
<Variable name="tabs.text.color" description="Text Color" type="color" default="#999999"/>
<Variable name="tabs.selected.text.color" description="Selected Color" type="color" default="#000000"/>
</Group>
<Group description="Tabs Background" selector=".tabs-outer .PageList">
<Variable name="tabs.background.color" description="Background Color" type="color" default="#f5f5f5"/>
<Variable name="tabs.selected.background.color" description="Selected Color" type="color" default="#eeeeee"/>
</Group>
<Group description="Post Title" selector="h3.post-title, .comments h4">
<Variable name="post.title.font" description="Font" type="font"
default="normal normal 22px Arial, Tahoma, Helvetica, FreeSans, sans-serif"/>
</Group>
<Group description="Date Header" selector=".date-header">
<Variable name="date.header.color" description="Text Color" type="color"
default="#000000"/>
<Variable name="date.header.background.color" description="Background Color" type="color"
default="transparent"/>
<Variable name="date.header.font" description="Text Font" type="font"
default="normal bold 11px Arial, Tahoma, Helvetica, FreeSans, sans-serif"/>
<Variable name="date.header.padding" description="Date Header Padding" type="string" default="inherit"/>
<Variable name="date.header.letterspacing" description="Date Header Letter Spacing" type="string" default="inherit"/>
<Variable name="date.header.margin" description="Date Header Margin" type="string" default="inherit"/>
</Group>
<Group description="Post Footer" selector=".post-footer">
<Variable name="post.footer.text.color" description="Text Color" type="color" default="#666666"/>
<Variable name="post.footer.background.color" description="Background Color" type="color"
default="#f9f9f9"/>
<Variable name="post.footer.border.color" description="Shadow Color" type="color" default="#eeeeee"/>
</Group>
<Group description="Gadgets" selector="h2">
<Variable name="widget.title.font" description="Title Font" type="font"
default="normal bold 11px Arial, Tahoma, Helvetica, FreeSans, sans-serif"/>
<Variable name="widget.title.text.color" description="Title Color" type="color" default="#000000"/>
<Variable name="widget.alternate.text.color" description="Alternate Color" type="color" default="#999999"/>
</Group>
<Group description="Images" selector=".main-inner">
<Variable name="image.background.color" description="Background Color" type="color" default="#ffffff"/>
<Variable name="image.border.color" description="Border Color" type="color" default="#eeeeee"/>
<Variable name="image.text.color" description="Caption Text Color" type="color" default="#000000"/>
</Group>
<Group description="Accents" selector=".content-inner">
<Variable name="body.rule.color" description="Separator Line Color" type="color" default="#eeeeee"/>
<Variable name="tabs.border.color" description="Tabs Border Color" type="color" default="transparent"/>
</Group>
<Variable name="body.background" description="Body Background" type="background"
color="#eeeeee" default="$(color) none repeat scroll top left"/>
<Variable name="body.background.override" description="Body Background Override" type="string" default=""/>
<Variable name="body.background.gradient.cap" description="Body Gradient Cap" type="url"
default="url(https://resources.blogblog.com/blogblog/data/1kt/simple/gradients_light.png)"/>
<Variable name="body.background.gradient.tile" description="Body Gradient Tile" type="url"
default="url(https://resources.blogblog.com/blogblog/data/1kt/simple/body_gradient_tile_light.png)"/>
<Variable name="content.background.color.selector" description="Content Background Color Selector" type="string" default=".content-inner"/>
<Variable name="content.padding" description="Content Padding" type="length" default="10px" min="0" max="100px"/>
<Variable name="content.padding.horizontal" description="Content Horizontal Padding" type="length" default="10px" min="0" max="100px"/>
<Variable name="content.shadow.spread" description="Content Shadow Spread" type="length" default="40px" min="0" max="100px"/>
<Variable name="content.shadow.spread.webkit" description="Content Shadow Spread (WebKit)" type="length" default="5px" min="0" max="100px"/>
<Variable name="content.shadow.spread.ie" description="Content Shadow Spread (IE)" type="length" default="10px" min="0" max="100px"/>
<Variable name="main.border.width" description="Main Border Width" type="length" default="0" min="0" max="10px"/>
<Variable name="header.background.gradient" description="Header Gradient" type="url" default="none"/>
<Variable name="header.shadow.offset.left" description="Header Shadow Offset Left" type="length" default="-1px" min="-50px" max="50px"/>
<Variable name="header.shadow.offset.top" description="Header Shadow Offset Top" type="length" default="-1px" min="-50px" max="50px"/>
<Variable name="header.shadow.spread" description="Header Shadow Spread" type="length" default="1px" min="0" max="100px"/>
<Variable name="header.padding" description="Header Padding" type="length" default="30px" min="0" max="100px"/>
<Variable name="header.border.size" description="Header Border Size" type="length" default="1px" min="0" max="10px"/>
<Variable name="header.bottom.border.size" description="Header Bottom Border Size" type="length" default="1px" min="0" max="10px"/>
<Variable name="header.border.horizontalsize" description="Header Horizontal Border Size" type="length" default="0" min="0" max="10px"/>
<Variable name="description.text.size" description="Description Text Size" type="string" default="140%"/>
<Variable name="tabs.margin.top" description="Tabs Margin Top" type="length" default="0" min="0" max="100px"/>
<Variable name="tabs.margin.side" description="Tabs Side Margin" type="length" default="30px" min="0" max="100px"/>
<Variable name="tabs.background.gradient" description="Tabs Background Gradient" type="url"
default="url(https://resources.blogblog.com/blogblog/data/1kt/simple/gradients_light.png)"/>
<Variable name="tabs.border.width" description="Tabs Border Width" type="length" default="1px" min="0" max="10px"/>
<Variable name="tabs.bevel.border.width" description="Tabs Bevel Border Width" type="length" default="1px" min="0" max="10px"/>
<Variable name="post.margin.bottom" description="Post Bottom Margin" type="length" default="25px" min="0" max="100px"/>
<Variable name="image.border.small.size" description="Image Border Small Size" type="length" default="2px" min="0" max="10px"/>
<Variable name="image.border.large.size" description="Image Border Large Size" type="length" default="5px" min="0" max="10px"/>
<Variable name="page.width.selector" description="Page Width Selector" type="string" default=".region-inner"/>
<Variable name="page.width" description="Page Width" type="string" default="auto"/>
<Variable name="main.section.margin" description="Main Section Margin" type="length" default="15px" min="0" max="100px"/>
<Variable name="main.padding" description="Main Padding" type="length" default="15px" min="0" max="100px"/>
<Variable name="main.padding.top" description="Main Padding Top" type="length" default="30px" min="0" max="100px"/>
<Variable name="main.padding.bottom" description="Main Padding Bottom" type="length" default="30px" min="0" max="100px"/>
<Variable name="paging.background"
color="#ffffff"
description="Background of blog paging area" type="background"
default="transparent none no-repeat scroll top center"/>
<Variable name="footer.bevel" description="Bevel border length of footer" type="length" default="0" min="0" max="10px"/>
<Variable name="mobile.background.overlay" description="Mobile Background Overlay" type="string"
default="transparent none repeat scroll top left"/>
<Variable name="mobile.background.size" description="Mobile Background Size" type="string" default="auto"/>
<Variable name="mobile.button.color" description="Mobile Button Color" type="color" default="#ffffff" />
<Variable name="startSide" description="Side where text starts in blog language" type="automatic" default="left"/>
<Variable name="endSide" description="Side where text ends in blog language" type="automatic" default="right"/>
*/
/* Content
----------------------------------------------- */
body {
font: normal normal 12px Open Sans;
color: #000000;
background: #eeeeee none repeat scroll top left;
padding: 0 0 0 0;
}
html body .region-inner {
min-width: 0;
max-width: 100%;
width: auto;
}
h2 {
font-size: 22px;
}
a:link {
text-decoration:none;
color: #2288bb;
}
a:visited {
text-decoration:none;
color: #888888;
}
a:hover {
text-decoration:underline;
color: #33aaff;
}
.body-fauxcolumn-outer .fauxcolumn-inner {
background: transparent none repeat scroll top left;
_background-image: none;
}
.body-fauxcolumn-outer .cap-top {
position: absolute;
z-index: 1;
height: 400px;
width: 100%;
}
.body-fauxcolumn-outer .cap-top .cap-left {
width: 100%;
background: transparent none repeat-x scroll top left;
_background-image: none;
}
.content-outer {
-moz-box-shadow: 0 0 0 rgba(0, 0, 0, .15);
-webkit-box-shadow: 0 0 0 rgba(0, 0, 0, .15);
-goog-ms-box-shadow: 0 0 0 #333333;
box-shadow: 0 0 0 rgba(0, 0, 0, .15);
margin-bottom: 1px;
}
.content-inner {
padding: 10px 40px;
}
.content-inner {
background-color: #ffffff;
}
/* Header
----------------------------------------------- */
.header-outer {
background: transparent none repeat-x scroll 0 -400px;
_background-image: none;
}
.Header h1 {
font: normal normal 40px Open Sans;
color: #000000;
text-shadow: 0 0 0 rgba(0, 0, 0, .2);
}
.Header h1 a {
color: #000000;
}
.Header .description {
font-size: 18px;
color: #000000;
}
.header-inner .Header .titlewrapper {
padding: 22px 0;
}
.header-inner .Header .descriptionwrapper {
padding: 0 0;
}
/* Tabs
----------------------------------------------- */
.tabs-inner .section:first-child {
border-top: 0 solid #dddddd;
}
.tabs-inner .section:first-child ul {
margin-top: -1px;
border-top: 1px solid #dddddd;
border-left: 1px solid #dddddd;
border-right: 1px solid #dddddd;
}
.tabs-inner .widget ul {
background: transparent none repeat-x scroll 0 -800px;
_background-image: none;
border-bottom: 1px solid #dddddd;
margin-top: 0;
margin-left: -30px;
margin-right: -30px;
}
.tabs-inner .widget li a {
display: inline-block;
padding: .6em 1em;
font: normal normal 12px Open Sans;
color: #000000;
border-left: 1px solid #ffffff;
border-right: 1px solid #dddddd;
}
.tabs-inner .widget li:first-child a {
border-left: none;
}
.tabs-inner .widget li.selected a, .tabs-inner .widget li a:hover {
color: #000000;
background-color: #eeeeee;
text-decoration: none;
}
/* Columns
----------------------------------------------- */
.main-outer {
border-top: 0 solid transparent;
}
.fauxcolumn-left-outer .fauxcolumn-inner {
border-right: 1px solid transparent;
}
.fauxcolumn-right-outer .fauxcolumn-inner {
border-left: 1px solid transparent;
}
/* Headings
----------------------------------------------- */
div.widget > h2,
div.widget h2.title {
margin: 0 0 1em 0;
font: normal bold 11px 'Trebuchet MS',Trebuchet,Verdana,sans-serif;
color: #000000;
}
/* Widgets
----------------------------------------------- */
.widget .zippy {
color: #999999;
text-shadow: 2px 2px 1px rgba(0, 0, 0, .1);
}
.widget .popular-posts ul {
list-style: none;
}
/* Posts
----------------------------------------------- */
h2.date-header {
font: normal bold 11px Arial, Tahoma, Helvetica, FreeSans, sans-serif;
}
.date-header span {
background-color: #bbbbbb;
color: #ffffff;
padding: 0.4em;
letter-spacing: 3px;
margin: inherit;
}
.main-inner {
padding-top: 35px;
padding-bottom: 65px;
}
.main-inner .column-center-inner {
padding: 0 0;
}
.main-inner .column-center-inner .section {
margin: 0 1em;
}
.post {
margin: 0 0 45px 0;
}
h3.post-title, .comments h4 {
font: normal normal 22px Open Sans;
margin: .75em 0 0;
}
.post-body {
font-size: 110%;
line-height: 1.4;
position: relative;
}
.post-body img, .post-body .tr-caption-container, .Profile img, .Image img,
.BlogList .item-thumbnail img {
padding: 2px;
background: #ffffff;
border: 1px solid #eeeeee;
-moz-box-shadow: 1px 1px 5px rgba(0, 0, 0, .1);
-webkit-box-shadow: 1px 1px 5px rgba(0, 0, 0, .1);
box-shadow: 1px 1px 5px rgba(0, 0, 0, .1);
}
.post-body img, .post-body .tr-caption-container {
padding: 5px;
}
.post-body .tr-caption-container {
color: #666666;
}
.post-body .tr-caption-container img {
padding: 0;
background: transparent;
border: none;
-moz-box-shadow: 0 0 0 rgba(0, 0, 0, .1);
-webkit-box-shadow: 0 0 0 rgba(0, 0, 0, .1);
box-shadow: 0 0 0 rgba(0, 0, 0, .1);
}
.post-header {
margin: 0 0 1.5em;
line-height: 1.6;
font-size: 90%;
}
.post-footer {
margin: 20px -2px 0;
padding: 5px 10px;
color: #666666;
background-color: #eeeeee;
border-bottom: 1px solid #eeeeee;
line-height: 1.6;
font-size: 90%;
}
#comments .comment-author {
padding-top: 1.5em;
border-top: 1px solid transparent;
background-position: 0 1.5em;
}
#comments .comment-author:first-child {
padding-top: 0;
border-top: none;
}
.avatar-image-container {
margin: .2em 0 0;
}
#comments .avatar-image-container img {
border: 1px solid #eeeeee;
}
/* Comments
----------------------------------------------- */
.comments .comments-content .icon.blog-author {
background-repeat: no-repeat;
background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEgAACxIB0t1+/AAAAAd0SU1FB9sLFwMeCjjhcOMAAAD+SURBVDjLtZSvTgNBEIe/WRRnm3U8RC1neQdsm1zSBIU9VVF1FkUguQQsD9ITmD7ECZIJSE4OZo9stoVjC/zc7ky+zH9hXwVwDpTAWWLrgS3QAe8AZgaAJI5zYAmc8r0G4AHYHQKVwII8PZrZFsBFkeRCABYiMh9BRUhnSkPTNCtVXYXURi1FpBDgArj8QU1eVXUzfnjv7yP7kwu1mYrkWlU33vs1QNu2qU8pwN0UpKoqokjWwCztrMuBhEhmh8bD5UDqur75asbcX0BGUB9/HAMB+r32hznJgXy2v0sGLBcyAJ1EK3LFcbo1s91JeLwAbwGYu7TP/3ZGfnXYPgAVNngtqatUNgAAAABJRU5ErkJggg==);
}
.comments .comments-content .loadmore a {
border-top: 1px solid #999999;
border-bottom: 1px solid #999999;
}
.comments .comment-thread.inline-thread {
background-color: #eeeeee;
}
.comments .continue {
border-top: 2px solid #999999;
}
/* Accents
---------------------------------------------- */
.section-columns td.columns-cell {
border-left: 1px solid transparent;
}
.blog-pager {
background: transparent url(//www.blogblog.com/1kt/simple/paging_dot.png) repeat-x scroll top center;
}
.blog-pager-older-link, .home-link,
.blog-pager-newer-link {
background-color: #ffffff;
padding: 5px;
}
.footer-outer {
border-top: 1px dashed #bbbbbb;
}
/* Mobile
----------------------------------------------- */
body.mobile  {
background-size: auto;
}
.mobile .body-fauxcolumn-outer {
background: transparent none repeat scroll top left;
}
.mobile .body-fauxcolumn-outer .cap-top {
background-size: 100% auto;
}
.mobile .content-outer {
-webkit-box-shadow: 0 0 3px rgba(0, 0, 0, .15);
box-shadow: 0 0 3px rgba(0, 0, 0, .15);
}
.mobile .tabs-inner .widget ul {
margin-left: 0;
margin-right: 0;
}
.mobile .post {
margin: 0;
}
.mobile .main-inner .column-center-inner .section {
margin: 0;
}
.mobile .date-header span {
padding: 0.1em 10px;
margin: 0 -10px;
}
.mobile h3.post-title {
margin: 0;
}
.mobile .blog-pager {
background: transparent none no-repeat scroll top center;
}
.mobile .footer-outer {
border-top: none;
}
.mobile .main-inner, .mobile .footer-inner {
background-color: #ffffff;
}
.mobile-index-contents {
color: #000000;
}
.mobile-link-button {
background-color: #2288bb;
}
.mobile-link-button a:link, .mobile-link-button a:visited {
color: #ffffff;
}
.mobile .tabs-inner .section:first-child {
border-top: none;
}
.mobile .tabs-inner .PageList .widget-content {
background-color: #eeeeee;
color: #000000;
border-top: 1px solid #dddddd;
border-bottom: 1px solid #dddddd;
}
.mobile .tabs-inner .PageList .widget-content .pagelist-arrow {
border-left: 1px solid #dddddd;
}

--></style>
<style id='template-skin-1' type='text/css'><!--
body {
min-width: 1120px;
}
.content-outer, .content-fauxcolumn-outer, .region-inner {
min-width: 1120px;
max-width: 1120px;
_width: 1120px;
}
.main-inner .columns {
padding-left: 0;
padding-right: 310px;
}
.main-inner .fauxcolumn-center-outer {
left: 0;
right: 310px;
/* IE6 does not respect left and right together */
_width: expression(this.parentNode.offsetWidth -
parseInt("0") -
parseInt("310px") + 'px');
}
.main-inner .fauxcolumn-left-outer {
width: 0;
}
.main-inner .fauxcolumn-right-outer {
width: 310px;
}
.main-inner .column-left-outer {
width: 0;
right: 100%;
margin-left: -0;
}
.main-inner .column-right-outer {
width: 310px;
margin-right: -310px;
}
#layout {
min-width: 0;
}
#layout .content-outer {
min-width: 0;
width: 800px;
}
#layout .region-inner {
min-width: 0;
width: auto;
}
body#layout div.add_widget {
padding: 8px;
}
body#layout div.add_widget a {
margin-left: 32px;
}
--></style>
<script type='text/javascript'>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
        ga('create', 'UA-240546891-1', 'auto', 'blogger');
        ga('blogger.send', 'pageview');
      </script>
<link href='https://www.blogger.com/dyn-css/authorization.css?targetBlogID=4838136820032157985&amp;zx=335eee85-76aa-45f9-8c9b-1fe835bda64e' media='none' onload='if(media!=&#39;all&#39;)media=&#39;all&#39;' rel='stylesheet'/><noscript><link href='https://www.blogger.com/dyn-css/authorization.css?targetBlogID=4838136820032157985&amp;zx=335eee85-76aa-45f9-8c9b-1fe835bda64e' rel='stylesheet'/></noscript>
<meta name='google-adsense-platform-account' content='ca-host-pub-1556223355139109'/>
<meta name='google-adsense-platform-domain' content='blogspot.com'/>

</head>
<body class='loading'>
<div class='navbar section' id='navbar' name='Navbar'><div class='widget Navbar' data-version='1' id='Navbar1'><script type="text/javascript">
    function setAttributeOnload(object, attribute, val) {
      if(window.addEventListener) {
        window.addEventListener('load',
          function(){ object[attribute] = val; }, false);
      } else {
        window.attachEvent('onload', function(){ object[attribute] = val; });
      }
    }
  </script>
<div id="navbar-iframe-container"></div>
<script type="text/javascript" src="https://apis.google.com/js/platform.js"></script>
<script type="text/javascript">
      gapi.load("gapi.iframes:gapi.iframes.style.bubble", function() {
        if (gapi.iframes && gapi.iframes.getContext) {
          gapi.iframes.getContext().openChild({
              url: 'https://www.blogger.com/navbar.g?targetBlogID\x3d4838136820032157985\x26blogName\x3dProject+Zero\x26publishMode\x3dPUBLISH_MODE_BLOGSPOT\x26navbarType\x3dLIGHT\x26layoutType\x3dLAYOUTS\x26searchRoot\x3dhttps://googleprojectzero.blogspot.com/search\x26blogLocale\x3den\x26v\x3d2\x26homepageUrl\x3dhttps://googleprojectzero.blogspot.com/\x26targetPostID\x3d5470414558693895520\x26blogPostOrPageUrl\x3dhttps://googleprojectzero.blogspot.com/2024/12/the-windows-registry-adventure-5-regf.html\x26vt\x3d-6932691580535619399',
              where: document.getElementById("navbar-iframe-container"),
              id: "navbar-iframe",
              messageHandlersFilter: gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER,
              messageHandlers: {
                'blogger-ping': function() {}
              }
          });
        }
      });
    </script><script type="text/javascript">
(function() {
var script = document.createElement('script');
script.type = 'text/javascript';
script.src = '//pagead2.googlesyndication.com/pagead/js/google_top_exp.js';
var head = document.getElementsByTagName('head')[0];
if (head) {
head.appendChild(script);
}})();
</script>
</div></div>
<div class='body-fauxcolumns'>
<div class='fauxcolumn-outer body-fauxcolumn-outer'>
<div class='cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left'>
<div class='fauxborder-right'></div>
<div class='fauxcolumn-inner'>
</div>
</div>
<div class='cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
</div>
<div class='content'>
<div class='content-fauxcolumns'>
<div class='fauxcolumn-outer content-fauxcolumn-outer'>
<div class='cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left'>
<div class='fauxborder-right'></div>
<div class='fauxcolumn-inner'>
</div>
</div>
<div class='cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
</div>
<div class='content-outer'>
<div class='content-cap-top cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left content-fauxborder-left'>
<div class='fauxborder-right content-fauxborder-right'></div>
<div class='content-inner'>
<header>
<div class='header-outer'>
<div class='header-cap-top cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left header-fauxborder-left'>
<div class='fauxborder-right header-fauxborder-right'></div>
<div class='region-inner header-inner'>
<div class='header section' id='header' name='Header'><div class='widget Header' data-version='1' id='Header1'>
<div id='header-inner'>
<div class='titlewrapper'>
<h1 class='title'>
<a href='https://googleprojectzero.blogspot.com/'>
Project Zero
</a>
</h1>
</div>
<div class='descriptionwrapper'>
<p class='description'><span>News and updates from the Project Zero team at Google</span></p>
</div>
</div>
</div></div>
</div>
</div>
<div class='header-cap-bottom cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
</header>
<div class='tabs-outer'>
<div class='tabs-cap-top cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left tabs-fauxborder-left'>
<div class='fauxborder-right tabs-fauxborder-right'></div>
<div class='region-inner tabs-inner'>
<div class='tabs no-items section' id='crosscol' name='Cross-Column'></div>
<div class='tabs no-items section' id='crosscol-overflow' name='Cross-Column 2'></div>
</div>
</div>
<div class='tabs-cap-bottom cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
<div class='main-outer'>
<div class='main-cap-top cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left main-fauxborder-left'>
<div class='fauxborder-right main-fauxborder-right'></div>
<div class='region-inner main-inner'>
<div class='columns fauxcolumns'>
<div class='fauxcolumn-outer fauxcolumn-center-outer'>
<div class='cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left'>
<div class='fauxborder-right'></div>
<div class='fauxcolumn-inner'>
</div>
</div>
<div class='cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
<div class='fauxcolumn-outer fauxcolumn-left-outer'>
<div class='cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left'>
<div class='fauxborder-right'></div>
<div class='fauxcolumn-inner'>
</div>
</div>
<div class='cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
<div class='fauxcolumn-outer fauxcolumn-right-outer'>
<div class='cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left'>
<div class='fauxborder-right'></div>
<div class='fauxcolumn-inner'>
</div>
</div>
<div class='cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
<!-- corrects IE6 width calculation -->
<div class='columns-inner'>
<div class='column-center-outer'>
<div class='column-center-inner'>
<div class='main section' id='main' name='Main'><div class='widget Blog' data-version='1' id='Blog1'>
<div class='blog-posts hfeed'>

          <div class="date-outer">
        
<h2 class='date-header'><span>Thursday, December 19, 2024</span></h2>

          <div class="date-posts">
        
<div class='post-outer'>
<div class='post hentry uncustomized-post-template' itemprop='blogPost' itemscope='itemscope' itemtype='http://schema.org/BlogPosting'>
<meta content='https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiQtJm0XNkozXGxjQnB9n1ka9OuxP7lrLSQN1KZF-Zc60Z06dBEz3AAA8aAYnmdrU4imLebCFvF6qXaE0h-uA_iXnuyAisG90JWawSAMPPaToLdXMGeC4FlyGz42FWkf1bPhJmwSez8Ot-DLI29n4jinIXswZ-LQoLyWX7PIKVF5EwkRoAXNUFYIdcCOwo/s1200/image8.png' itemprop='image_url'/>
<meta content='4838136820032157985' itemprop='blogId'/>
<meta content='5470414558693895520' itemprop='postId'/>
<a name='5470414558693895520'></a>
<h3 class='post-title entry-title' itemprop='name'>
The Windows Registry Adventure #5: The regf file format
</h3>
<div class='post-header'>
<div class='post-header-line-1'></div>
</div>
<div class='post-body entry-content' id='post-body-5470414558693895520' itemprop='description articleBody'>
<style type="text/css">@import url(https://themes.googleusercontent.com/fonts/css?kit=4mNYFHt_IKFsPe52toizHz0e5qzIIUg9OvSRGeMDk3I);.widget .post-body ul{padding: 0 0}ol.lst-kix_s8f9k49k9svk-8{list-style-type:none}ol.lst-kix_s8f9k49k9svk-7{list-style-type:none}ol.lst-kix_s8f9k49k9svk-6{list-style-type:none}ol.lst-kix_s8f9k49k9svk-5{list-style-type:none}ol.lst-kix_9i4egiire8k6-8.start{counter-reset:lst-ctn-kix_9i4egiire8k6-8 0}.lst-kix_82pihj16nguk-6>li:before{content:"\0025cf   "}.lst-kix_82pihj16nguk-4>li:before{content:"\0025cb   "}.lst-kix_82pihj16nguk-5>li:before{content:"\0025a0   "}.lst-kix_82pihj16nguk-3>li:before{content:"\0025cf   "}ul.lst-kix_2gqv10mkziv8-2{list-style-type:none}ul.lst-kix_2gqv10mkziv8-1{list-style-type:none}ul.lst-kix_2gqv10mkziv8-4{list-style-type:none}ul.lst-kix_2gqv10mkziv8-3{list-style-type:none}ul.lst-kix_2gqv10mkziv8-6{list-style-type:none}ul.lst-kix_2gqv10mkziv8-5{list-style-type:none}ol.lst-kix_s5xocqmkj8s9-4.start{counter-reset:lst-ctn-kix_s5xocqmkj8s9-4 0}ul.lst-kix_2gqv10mkziv8-8{list-style-type:none}ul.lst-kix_2gqv10mkziv8-7{list-style-type:none}ol.lst-kix_fvisx24ngp1u-4.start{counter-reset:lst-ctn-kix_fvisx24ngp1u-4 0}.lst-kix_82pihj16nguk-7>li:before{content:"\0025cb   "}ul.lst-kix_2gqv10mkziv8-0{list-style-type:none}.lst-kix_82pihj16nguk-8>li:before{content:"\0025a0   "}ol.lst-kix_s8f9k49k9svk-0{list-style-type:none}.lst-kix_s8f9k49k9svk-8>li{counter-increment:lst-ctn-kix_s8f9k49k9svk-8}.lst-kix_rs477lwege9r-5>li{counter-increment:lst-ctn-kix_rs477lwege9r-5}.lst-kix_9i4egiire8k6-4>li{counter-increment:lst-ctn-kix_9i4egiire8k6-4}ol.lst-kix_s8f9k49k9svk-4{list-style-type:none}ol.lst-kix_s8f9k49k9svk-3{list-style-type:none}ol.lst-kix_s8f9k49k9svk-2{list-style-type:none}ol.lst-kix_s8f9k49k9svk-1{list-style-type:none}.lst-kix_9iss8y571b2b-0>li:before{content:"\0025cf   "}ul.lst-kix_sxdyd6bfs1ox-6{list-style-type:none}ul.lst-kix_sxdyd6bfs1ox-7{list-style-type:none}.lst-kix_9iss8y571b2b-1>li:before{content:"\0025cb   "}ul.lst-kix_sxdyd6bfs1ox-8{list-style-type:none}.lst-kix_4ee45band27p-5>li:before{content:"\0025a0   "}.lst-kix_4ee45band27p-7>li:before{content:"\0025cb   "}ul.lst-kix_sxdyd6bfs1ox-2{list-style-type:none}ul.lst-kix_sxdyd6bfs1ox-3{list-style-type:none}ul.lst-kix_sxdyd6bfs1ox-4{list-style-type:none}.lst-kix_4ee45band27p-4>li:before{content:"\0025cb   "}.lst-kix_4ee45band27p-8>li:before{content:"\0025a0   "}ul.lst-kix_sxdyd6bfs1ox-5{list-style-type:none}.lst-kix_9iss8y571b2b-3>li:before{content:"\0025cf   "}ul.lst-kix_sxdyd6bfs1ox-0{list-style-type:none}ul.lst-kix_sxdyd6bfs1ox-1{list-style-type:none}.lst-kix_9iss8y571b2b-2>li:before{content:"\0025a0   "}.lst-kix_4ee45band27p-6>li:before{content:"\0025cf   "}.lst-kix_9iss8y571b2b-8>li:before{content:"\0025a0   "}.lst-kix_9iss8y571b2b-7>li:before{content:"\0025cb   "}.lst-kix_4ee45band27p-0>li:before{content:"\0025cf   "}.lst-kix_9iss8y571b2b-4>li:before{content:"\0025cb   "}.lst-kix_9iss8y571b2b-5>li:before{content:"\0025a0   "}.lst-kix_4ee45band27p-1>li:before{content:"\0025cb   "}.lst-kix_4ee45band27p-3>li:before{content:"\0025cf   "}.lst-kix_9iss8y571b2b-6>li:before{content:"\0025cf   "}.lst-kix_4ee45band27p-2>li:before{content:"\0025a0   "}.lst-kix_gsnrn3gksa0-6>li:before{content:"\0025cf   "}.lst-kix_82pihj16nguk-0>li:before{content:"" counter(lst-ctn-kix_82pihj16nguk-0,decimal) ". "}.lst-kix_82pihj16nguk-1>li:before{content:"\0025cb   "}.lst-kix_gsnrn3gksa0-4>li:before{content:"\0025cb   "}.lst-kix_gsnrn3gksa0-8>li:before{content:"\0025a0   "}ol.lst-kix_rs477lwege9r-1.start{counter-reset:lst-ctn-kix_rs477lwege9r-1 0}.lst-kix_82pihj16nguk-2>li:before{content:"\0025a0   "}.lst-kix_gsnrn3gksa0-3>li:before{content:"\0025cf   "}.lst-kix_gsnrn3gksa0-7>li:before{content:"\0025cb   "}ol.lst-kix_rs477lwege9r-8.start{counter-reset:lst-ctn-kix_rs477lwege9r-8 0}ol.lst-kix_s8f9k49k9svk-3.start{counter-reset:lst-ctn-kix_s8f9k49k9svk-3 0}.lst-kix_gsnrn3gksa0-5>li:before{content:"\0025a0   "}.lst-kix_fvisx24ngp1u-0>li{counter-increment:lst-ctn-kix_fvisx24ngp1u-0}.lst-kix_c8qgjiyn10ie-0>li:before{content:"\0025cf   "}.lst-kix_c8qgjiyn10ie-2>li:before{content:"\0025a0   "}.lst-kix_gsnrn3gksa0-0>li:before{content:"\0025cf   "}.lst-kix_c8qgjiyn10ie-1>li:before{content:"\0025cb   "}.lst-kix_gsnrn3gksa0-2>li:before{content:"\0025a0   "}.lst-kix_gsnrn3gksa0-1>li:before{content:"\0025cb   "}.lst-kix_88bs2bqozfm2-0>li:before{content:"\0025cf   "}.lst-kix_88bs2bqozfm2-2>li:before{content:"\0025a0   "}.lst-kix_c8qgjiyn10ie-5>li:before{content:"\0025a0   "}.lst-kix_sxdyd6bfs1ox-1>li:before{content:"\0025cb   "}.lst-kix_88bs2bqozfm2-4>li:before{content:"\0025cb   "}ol.lst-kix_s8f9k49k9svk-0.start{counter-reset:lst-ctn-kix_s8f9k49k9svk-0 0}.lst-kix_gvci0hu7yb6k-3>li:before{content:"\0025cf   "}ul.lst-kix_w06aeeqvjm56-3{list-style-type:none}.lst-kix_9i4egiire8k6-0>li{counter-increment:lst-ctn-kix_9i4egiire8k6-0}ul.lst-kix_w06aeeqvjm56-2{list-style-type:none}ul.lst-kix_w06aeeqvjm56-1{list-style-type:none}ul.lst-kix_w06aeeqvjm56-0{list-style-type:none}.lst-kix_c8qgjiyn10ie-3>li:before{content:"\0025cf   "}ul.lst-kix_w06aeeqvjm56-7{list-style-type:none}.lst-kix_88bs2bqozfm2-8>li:before{content:"\0025a0   "}ul.lst-kix_w06aeeqvjm56-6{list-style-type:none}ul.lst-kix_w06aeeqvjm56-5{list-style-type:none}.lst-kix_gvci0hu7yb6k-5>li:before{content:"\0025a0   "}.lst-kix_gvci0hu7yb6k-7>li:before{content:"\0025cb   "}ul.lst-kix_w06aeeqvjm56-4{list-style-type:none}.lst-kix_88bs2bqozfm2-6>li:before{content:"\0025cf   "}ul.lst-kix_w06aeeqvjm56-8{list-style-type:none}.lst-kix_9fzrrhqm4j52-6>li:before{content:"\0025cf   "}.lst-kix_sxdyd6bfs1ox-5>li:before{content:"\0025a0   "}.lst-kix_s8f9k49k9svk-7>li:before{content:"" counter(lst-ctn-kix_s8f9k49k9svk-7,lower-latin) ". "}ol.lst-kix_9i4egiire8k6-1.start{counter-reset:lst-ctn-kix_9i4egiire8k6-1 0}.lst-kix_c8qgjiyn10ie-7>li:before{content:"\0025cb   "}.lst-kix_9fzrrhqm4j52-8>li:before{content:"\0025a0   "}.lst-kix_sxdyd6bfs1ox-3>li:before{content:"\0025cf   "}.lst-kix_s8f9k49k9svk-3>li:before{content:"" counter(lst-ctn-kix_s8f9k49k9svk-3,decimal) ". "}ol.lst-kix_9i4egiire8k6-7{list-style-type:none}ol.lst-kix_9i4egiire8k6-8{list-style-type:none}ol.lst-kix_9i4egiire8k6-5{list-style-type:none}ol.lst-kix_9i4egiire8k6-6{list-style-type:none}ol.lst-kix_9i4egiire8k6-3{list-style-type:none}ol.lst-kix_9i4egiire8k6-4{list-style-type:none}ol.lst-kix_9i4egiire8k6-1{list-style-type:none}ol.lst-kix_9i4egiire8k6-2{list-style-type:none}ol.lst-kix_9i4egiire8k6-0{list-style-type:none}.lst-kix_s8f9k49k9svk-5>li:before{content:"" counter(lst-ctn-kix_s8f9k49k9svk-5,lower-roman) ". "}.lst-kix_9fzrrhqm4j52-4>li:before{content:"\0025cb   "}.lst-kix_sxdyd6bfs1ox-7>li:before{content:"\0025cb   "}.lst-kix_rs477lwege9r-2>li{counter-increment:lst-ctn-kix_rs477lwege9r-2}.lst-kix_9fzrrhqm4j52-2>li:before{content:"\0025a0   "}.lst-kix_gvci0hu7yb6k-1>li:before{content:"\0025cb   "}.lst-kix_s8f9k49k9svk-1>li:before{content:"" counter(lst-ctn-kix_s8f9k49k9svk-1,lower-latin) ". "}.lst-kix_9fzrrhqm4j52-0>li:before{content:"\0025cf   "}.lst-kix_9argrz9zfbv7-5>li:before{content:"\0025a0   "}.lst-kix_s40msnqz5os7-3>li:before{content:"\0025cf   "}.lst-kix_9argrz9zfbv7-3>li:before{content:"\0025cf   "}.lst-kix_9argrz9zfbv7-7>li:before{content:"\0025cb   "}.lst-kix_fvisx24ngp1u-4>li{counter-increment:lst-ctn-kix_fvisx24ngp1u-4}.lst-kix_s40msnqz5os7-7>li:before{content:"\0025cb   "}ol.lst-kix_9i4egiire8k6-3.start{counter-reset:lst-ctn-kix_9i4egiire8k6-3 0}.lst-kix_s40msnqz5os7-5>li:before{content:"\0025a0   "}.lst-kix_9argrz9zfbv7-1>li:before{content:"\0025cb   "}.lst-kix_si5ikxnlj1q7-7>li:before{content:"\0025cb   "}.lst-kix_s40msnqz5os7-1>li:before{content:"\0025cb   "}.lst-kix_rs477lwege9r-1>li{counter-increment:lst-ctn-kix_rs477lwege9r-1}.lst-kix_9i4egiire8k6-5>li{counter-increment:lst-ctn-kix_9i4egiire8k6-5}.lst-kix_s5xocqmkj8s9-1>li:before{content:"" counter(lst-ctn-kix_s5xocqmkj8s9-1,lower-latin) ". "}.lst-kix_s5xocqmkj8s9-3>li:before{content:"" counter(lst-ctn-kix_s5xocqmkj8s9-3,decimal) ". "}.lst-kix_si5ikxnlj1q7-1>li:before{content:"\0025cb   "}.lst-kix_si5ikxnlj1q7-3>li:before{content:"\0025cf   "}.lst-kix_s5xocqmkj8s9-7>li:before{content:"" counter(lst-ctn-kix_s5xocqmkj8s9-7,lower-latin) ". "}.lst-kix_si5ikxnlj1q7-5>li:before{content:"\0025a0   "}.lst-kix_s8f9k49k9svk-4>li{counter-increment:lst-ctn-kix_s8f9k49k9svk-4}ul.lst-kix_9iss8y571b2b-0{list-style-type:none}ul.lst-kix_9iss8y571b2b-3{list-style-type:none}ul.lst-kix_9iss8y571b2b-4{list-style-type:none}.lst-kix_30z58zep11nd-1>li:before{content:"\0025cb   "}ul.lst-kix_9iss8y571b2b-1{list-style-type:none}ul.lst-kix_9iss8y571b2b-2{list-style-type:none}ul.lst-kix_9iss8y571b2b-7{list-style-type:none}.lst-kix_s5xocqmkj8s9-2>li{counter-increment:lst-ctn-kix_s5xocqmkj8s9-2}ul.lst-kix_9iss8y571b2b-8{list-style-type:none}ul.lst-kix_9iss8y571b2b-5{list-style-type:none}ul.lst-kix_9iss8y571b2b-6{list-style-type:none}.lst-kix_s5xocqmkj8s9-5>li:before{content:"" counter(lst-ctn-kix_s5xocqmkj8s9-5,lower-roman) ". "}ol.lst-kix_9i4egiire8k6-5.start{counter-reset:lst-ctn-kix_9i4egiire8k6-5 0}ol.lst-kix_s8f9k49k9svk-7.start{counter-reset:lst-ctn-kix_s8f9k49k9svk-7 0}.lst-kix_3m5uvca0lm53-0>li:before{content:"\0025cf   "}.lst-kix_30z58zep11nd-4>li:before{content:"\0025cb   "}.lst-kix_30z58zep11nd-3>li:before{content:"\0025cf   "}.lst-kix_3m5uvca0lm53-4>li:before{content:"\0025cb   "}ol.lst-kix_rs477lwege9r-4.start{counter-reset:lst-ctn-kix_rs477lwege9r-4 0}.lst-kix_3m5uvca0lm53-1>li:before{content:"\0025cb   "}.lst-kix_3m5uvca0lm53-5>li:before{content:"\0025a0   "}.lst-kix_rs477lwege9r-6>li{counter-increment:lst-ctn-kix_rs477lwege9r-6}ol.lst-kix_fvisx24ngp1u-7.start{counter-reset:lst-ctn-kix_fvisx24ngp1u-7 0}.lst-kix_30z58zep11nd-8>li:before{content:"\0025a0   "}.lst-kix_30z58zep11nd-7>li:before{content:"\0025cb   "}ol.lst-kix_fvisx24ngp1u-1{list-style-type:none}ol.lst-kix_fvisx24ngp1u-0{list-style-type:none}ol.lst-kix_fvisx24ngp1u-3{list-style-type:none}ol.lst-kix_fvisx24ngp1u-2{list-style-type:none}ol.lst-kix_fvisx24ngp1u-1.start{counter-reset:lst-ctn-kix_fvisx24ngp1u-1 0}ol.lst-kix_fvisx24ngp1u-8{list-style-type:none}ul.lst-kix_2w36zq8cd80k-8{list-style-type:none}ol.lst-kix_fvisx24ngp1u-5{list-style-type:none}ol.lst-kix_s5xocqmkj8s9-7.start{counter-reset:lst-ctn-kix_s5xocqmkj8s9-7 0}ol.lst-kix_fvisx24ngp1u-4{list-style-type:none}.lst-kix_s5xocqmkj8s9-1>li{counter-increment:lst-ctn-kix_s5xocqmkj8s9-1}ol.lst-kix_fvisx24ngp1u-7{list-style-type:none}ol.lst-kix_fvisx24ngp1u-6{list-style-type:none}ol.lst-kix_s5xocqmkj8s9-1.start{counter-reset:lst-ctn-kix_s5xocqmkj8s9-1 0}.lst-kix_l7ahywf1ghkc-0>li:before{content:"\0025cf   "}ol.lst-kix_s8f9k49k9svk-1.start{counter-reset:lst-ctn-kix_s8f9k49k9svk-1 0}.lst-kix_l7ahywf1ghkc-1>li:before{content:"\0025cb   "}ol.lst-kix_s8f9k49k9svk-2.start{counter-reset:lst-ctn-kix_s8f9k49k9svk-2 0}.lst-kix_s8f9k49k9svk-5>li{counter-increment:lst-ctn-kix_s8f9k49k9svk-5}.lst-kix_9i4egiire8k6-3>li{counter-increment:lst-ctn-kix_9i4egiire8k6-3}ul.lst-kix_l7ahywf1ghkc-7{list-style-type:none}ul.lst-kix_l7ahywf1ghkc-8{list-style-type:none}ul.lst-kix_l7ahywf1ghkc-5{list-style-type:none}ul.lst-kix_l7ahywf1ghkc-6{list-style-type:none}ul.lst-kix_l7ahywf1ghkc-3{list-style-type:none}ul.lst-kix_l7ahywf1ghkc-4{list-style-type:none}ul.lst-kix_l7ahywf1ghkc-1{list-style-type:none}ul.lst-kix_l7ahywf1ghkc-2{list-style-type:none}.lst-kix_175jp61awd4f-2>li:before{content:"\0025a0   "}ul.lst-kix_l7ahywf1ghkc-0{list-style-type:none}ol.lst-kix_9i4egiire8k6-6.start{counter-reset:lst-ctn-kix_9i4egiire8k6-6 0}ul.lst-kix_9fzrrhqm4j52-6{list-style-type:none}.lst-kix_175jp61awd4f-3>li:before{content:"\0025cf   "}ul.lst-kix_9fzrrhqm4j52-5{list-style-type:none}ul.lst-kix_9fzrrhqm4j52-4{list-style-type:none}ul.lst-kix_88bs2bqozfm2-0{list-style-type:none}ol.lst-kix_fvisx24ngp1u-6.start{counter-reset:lst-ctn-kix_fvisx24ngp1u-6 0}ul.lst-kix_9fzrrhqm4j52-3{list-style-type:none}ul.lst-kix_9fzrrhqm4j52-2{list-style-type:none}ol.lst-kix_82pihj16nguk-0.start{counter-reset:lst-ctn-kix_82pihj16nguk-0 0}ul.lst-kix_9fzrrhqm4j52-1{list-style-type:none}ul.lst-kix_9fzrrhqm4j52-0{list-style-type:none}.lst-kix_175jp61awd4f-7>li:before{content:"\0025cb   "}ol.lst-kix_s5xocqmkj8s9-2.start{counter-reset:lst-ctn-kix_s5xocqmkj8s9-2 0}.lst-kix_175jp61awd4f-6>li:before{content:"\0025cf   "}ul.lst-kix_9argrz9zfbv7-7{list-style-type:none}ul.lst-kix_9argrz9zfbv7-6{list-style-type:none}ul.lst-kix_9argrz9zfbv7-8{list-style-type:none}ul.lst-kix_9argrz9zfbv7-3{list-style-type:none}ul.lst-kix_88bs2bqozfm2-6{list-style-type:none}ul.lst-kix_9argrz9zfbv7-2{list-style-type:none}ul.lst-kix_88bs2bqozfm2-5{list-style-type:none}ul.lst-kix_9argrz9zfbv7-5{list-style-type:none}ul.lst-kix_88bs2bqozfm2-8{list-style-type:none}ul.lst-kix_9argrz9zfbv7-4{list-style-type:none}ul.lst-kix_88bs2bqozfm2-7{list-style-type:none}ul.lst-kix_88bs2bqozfm2-2{list-style-type:none}ul.lst-kix_88bs2bqozfm2-1{list-style-type:none}ul.lst-kix_9argrz9zfbv7-1{list-style-type:none}ul.lst-kix_9fzrrhqm4j52-8{list-style-type:none}ul.lst-kix_88bs2bqozfm2-4{list-style-type:none}ul.lst-kix_9argrz9zfbv7-0{list-style-type:none}ul.lst-kix_9fzrrhqm4j52-7{list-style-type:none}ul.lst-kix_88bs2bqozfm2-3{list-style-type:none}ol.lst-kix_fvisx24ngp1u-0.start{counter-reset:lst-ctn-kix_fvisx24ngp1u-0 0}.lst-kix_s5xocqmkj8s9-6>li{counter-increment:lst-ctn-kix_s5xocqmkj8s9-6}.lst-kix_4ao7uanj5htj-0>li:before{content:"\0025cf   "}.lst-kix_88bs2bqozfm2-1>li:before{content:"\0025cb   "}.lst-kix_fvisx24ngp1u-7>li{counter-increment:lst-ctn-kix_fvisx24ngp1u-7}ol.lst-kix_s5xocqmkj8s9-8.start{counter-reset:lst-ctn-kix_s5xocqmkj8s9-8 0}.lst-kix_88bs2bqozfm2-5>li:before{content:"\0025a0   "}.lst-kix_s8f9k49k9svk-2>li{counter-increment:lst-ctn-kix_s8f9k49k9svk-2}.lst-kix_gvci0hu7yb6k-6>li:before{content:"\0025cf   "}.lst-kix_s8ghxl62e844-4>li:before{content:"\0025cb   "}.lst-kix_sxdyd6bfs1ox-6>li:before{content:"\0025cf   "}.lst-kix_iivgfpfdl0t3-3>li:before{content:"\0025cf   "}.lst-kix_s8ghxl62e844-0>li:before{content:"\0025cf   "}.lst-kix_s8f9k49k9svk-8>li:before{content:"" counter(lst-ctn-kix_s8f9k49k9svk-8,lower-roman) ". "}.lst-kix_c8qgjiyn10ie-6>li:before{content:"\0025cf   "}.lst-kix_9fzrrhqm4j52-7>li:before{content:"\0025cb   "}.lst-kix_sxdyd6bfs1ox-2>li:before{content:"\0025a0   "}.lst-kix_w06aeeqvjm56-2>li:before{content:"\0025a0   "}ol.lst-kix_s5xocqmkj8s9-5.start{counter-reset:lst-ctn-kix_s5xocqmkj8s9-5 0}ul.lst-kix_q9nppjnnwv68-1{list-style-type:none}.lst-kix_s8f9k49k9svk-4>li:before{content:"" counter(lst-ctn-kix_s8f9k49k9svk-4,lower-latin) ". "}ul.lst-kix_q9nppjnnwv68-0{list-style-type:none}ul.lst-kix_q9nppjnnwv68-3{list-style-type:none}ul.lst-kix_q9nppjnnwv68-2{list-style-type:none}.lst-kix_s8f9k49k9svk-0>li{counter-increment:lst-ctn-kix_s8f9k49k9svk-0}.lst-kix_q9nppjnnwv68-8>li:before{content:"\0025a0   "}ul.lst-kix_q9nppjnnwv68-8{list-style-type:none}.lst-kix_s5xocqmkj8s9-4>li{counter-increment:lst-ctn-kix_s5xocqmkj8s9-4}ul.lst-kix_q9nppjnnwv68-5{list-style-type:none}ul.lst-kix_q9nppjnnwv68-4{list-style-type:none}.lst-kix_w06aeeqvjm56-6>li:before{content:"\0025cf   "}ul.lst-kix_q9nppjnnwv68-7{list-style-type:none}ol.lst-kix_s8f9k49k9svk-8.start{counter-reset:lst-ctn-kix_s8f9k49k9svk-8 0}ul.lst-kix_q9nppjnnwv68-6{list-style-type:none}.lst-kix_iivgfpfdl0t3-7>li:before{content:"\0025cb   "}.lst-kix_2gqv10mkziv8-5>li:before{content:"\0025a0   "}.lst-kix_4ao7uanj5htj-8>li:before{content:"\0025a0   "}.lst-kix_9fzrrhqm4j52-3>li:before{content:"\0025cf   "}.lst-kix_9i4egiire8k6-1>li{counter-increment:lst-ctn-kix_9i4egiire8k6-1}ol.lst-kix_9i4egiire8k6-7.start{counter-reset:lst-ctn-kix_9i4egiire8k6-7 0}.lst-kix_q9nppjnnwv68-0>li:before{content:"\0025cf   "}.lst-kix_q9nppjnnwv68-4>li:before{content:"\0025cb   "}.lst-kix_2gqv10mkziv8-1>li:before{content:"\0025cb   "}ol.lst-kix_rs477lwege9r-3.start{counter-reset:lst-ctn-kix_rs477lwege9r-3 0}.lst-kix_gvci0hu7yb6k-2>li:before{content:"\0025a0   "}.lst-kix_s8ghxl62e844-8>li:before{content:"\0025a0   "}.lst-kix_s8f9k49k9svk-0>li:before{content:"" counter(lst-ctn-kix_s8f9k49k9svk-0,decimal) ". "}.lst-kix_4ao7uanj5htj-4>li:before{content:"\0025cb   "}ol.lst-kix_rs477lwege9r-6.start{counter-reset:lst-ctn-kix_rs477lwege9r-6 0}.lst-kix_anetktcl8su5-7>li:before{content:"\0025cb   "}.lst-kix_9argrz9zfbv7-6>li:before{content:"\0025cf   "}.lst-kix_s40msnqz5os7-4>li:before{content:"\0025cb   "}.lst-kix_pvxkc5ur63o3-1>li:before{content:"\0025cb   "}.lst-kix_fvisx24ngp1u-4>li:before{content:"" counter(lst-ctn-kix_fvisx24ngp1u-4,lower-latin) ". "}.lst-kix_fvisx24ngp1u-8>li:before{content:"" counter(lst-ctn-kix_fvisx24ngp1u-8,lower-roman) ". "}.lst-kix_9i4egiire8k6-2>li:before{content:"" counter(lst-ctn-kix_9i4egiire8k6-2,lower-roman) ". "}.lst-kix_9i4egiire8k6-6>li:before{content:"" counter(lst-ctn-kix_9i4egiire8k6-6,decimal) ". "}.lst-kix_l7ahywf1ghkc-4>li:before{content:"\0025cb   "}.lst-kix_anetktcl8su5-3>li:before{content:"\0025cf   "}ul.lst-kix_2w36zq8cd80k-4{list-style-type:none}ul.lst-kix_2w36zq8cd80k-5{list-style-type:none}ol.lst-kix_s8f9k49k9svk-5.start{counter-reset:lst-ctn-kix_s8f9k49k9svk-5 0}ul.lst-kix_2w36zq8cd80k-6{list-style-type:none}ol.lst-kix_rs477lwege9r-5.start{counter-reset:lst-ctn-kix_rs477lwege9r-5 0}ul.lst-kix_2w36zq8cd80k-7{list-style-type:none}ul.lst-kix_2w36zq8cd80k-0{list-style-type:none}ul.lst-kix_2w36zq8cd80k-1{list-style-type:none}ul.lst-kix_2w36zq8cd80k-2{list-style-type:none}ul.lst-kix_2w36zq8cd80k-3{list-style-type:none}.lst-kix_9argrz9zfbv7-2>li:before{content:"\0025a0   "}.lst-kix_s40msnqz5os7-0>li:before{content:"\0025cf   "}.lst-kix_l7ahywf1ghkc-8>li:before{content:"\0025a0   "}ol.lst-kix_fvisx24ngp1u-2.start{counter-reset:lst-ctn-kix_fvisx24ngp1u-2 0}.lst-kix_si5ikxnlj1q7-8>li:before{content:"\0025a0   "}.lst-kix_3m5uvca0lm53-8>li:before{content:"\0025a0   "}.lst-kix_9i4egiire8k6-8>li{counter-increment:lst-ctn-kix_9i4egiire8k6-8}.lst-kix_rs477lwege9r-4>li{counter-increment:lst-ctn-kix_rs477lwege9r-4}.lst-kix_s5xocqmkj8s9-0>li:before{content:"" counter(lst-ctn-kix_s5xocqmkj8s9-0,decimal) ". "}.lst-kix_s5xocqmkj8s9-8>li:before{content:"" counter(lst-ctn-kix_s5xocqmkj8s9-8,lower-roman) ". "}.lst-kix_si5ikxnlj1q7-4>li:before{content:"\0025cb   "}ol.lst-kix_fvisx24ngp1u-3.start{counter-reset:lst-ctn-kix_fvisx24ngp1u-3 0}.lst-kix_s8f9k49k9svk-7>li{counter-increment:lst-ctn-kix_s8f9k49k9svk-7}.lst-kix_fvisx24ngp1u-0>li:before{content:"" counter(lst-ctn-kix_fvisx24ngp1u-0,decimal) ". "}ol.lst-kix_s5xocqmkj8s9-6.start{counter-reset:lst-ctn-kix_s5xocqmkj8s9-6 0}ol.lst-kix_s8f9k49k9svk-6.start{counter-reset:lst-ctn-kix_s8f9k49k9svk-6 0}.lst-kix_s40msnqz5os7-8>li:before{content:"\0025a0   "}.lst-kix_pvxkc5ur63o3-5>li:before{content:"\0025a0   "}.lst-kix_30z58zep11nd-0>li:before{content:"\0025cf   "}.lst-kix_s5xocqmkj8s9-4>li:before{content:"" counter(lst-ctn-kix_s5xocqmkj8s9-4,lower-latin) ". "}.lst-kix_si5ikxnlj1q7-0>li:before{content:"\0025cf   "}.lst-kix_rs477lwege9r-1>li:before{content:"" counter(lst-ctn-kix_rs477lwege9r-1,lower-latin) ". "}ul.lst-kix_gvci0hu7yb6k-1{list-style-type:none}ul.lst-kix_gvci0hu7yb6k-0{list-style-type:none}.lst-kix_rs477lwege9r-0>li:before{content:"" counter(lst-ctn-kix_rs477lwege9r-0,decimal) ". "}.lst-kix_rs477lwege9r-2>li:before{content:"" counter(lst-ctn-kix_rs477lwege9r-2,lower-roman) ". "}ul.lst-kix_gvci0hu7yb6k-3{list-style-type:none}ul.lst-kix_gvci0hu7yb6k-2{list-style-type:none}.lst-kix_rs477lwege9r-3>li:before{content:"" counter(lst-ctn-kix_rs477lwege9r-3,decimal) ". "}.lst-kix_rs477lwege9r-5>li:before{content:"" counter(lst-ctn-kix_rs477lwege9r-5,lower-roman) ". "}.lst-kix_9i4egiire8k6-6>li{counter-increment:lst-ctn-kix_9i4egiire8k6-6}ul.lst-kix_175jp61awd4f-0{list-style-type:none}.lst-kix_rs477lwege9r-4>li:before{content:"" counter(lst-ctn-kix_rs477lwege9r-4,lower-latin) ". "}.lst-kix_rs477lwege9r-6>li:before{content:"" counter(lst-ctn-kix_rs477lwege9r-6,decimal) ". "}ol.lst-kix_s8f9k49k9svk-4.start{counter-reset:lst-ctn-kix_s8f9k49k9svk-4 0}ul.lst-kix_175jp61awd4f-6{list-style-type:none}.lst-kix_qst1zha6rauh-8>li:before{content:"\0025a0   "}ul.lst-kix_175jp61awd4f-5{list-style-type:none}ul.lst-kix_175jp61awd4f-8{list-style-type:none}.lst-kix_qst1zha6rauh-7>li:before{content:"\0025cb   "}ul.lst-kix_175jp61awd4f-7{list-style-type:none}ul.lst-kix_175jp61awd4f-2{list-style-type:none}ul.lst-kix_175jp61awd4f-1{list-style-type:none}.lst-kix_gi12qwmrr5vl-8>li:before{content:"\0025a0   "}ul.lst-kix_175jp61awd4f-4{list-style-type:none}ul.lst-kix_gi12qwmrr5vl-1{list-style-type:none}ul.lst-kix_175jp61awd4f-3{list-style-type:none}ul.lst-kix_gi12qwmrr5vl-0{list-style-type:none}ul.lst-kix_gi12qwmrr5vl-3{list-style-type:none}ul.lst-kix_gi12qwmrr5vl-2{list-style-type:none}.lst-kix_gi12qwmrr5vl-6>li:before{content:"\0025cf   "}.lst-kix_gi12qwmrr5vl-7>li:before{content:"\0025cb   "}ul.lst-kix_gvci0hu7yb6k-8{list-style-type:none}ul.lst-kix_gi12qwmrr5vl-5{list-style-type:none}ul.lst-kix_gi12qwmrr5vl-4{list-style-type:none}.lst-kix_qst1zha6rauh-5>li:before{content:"\0025a0   "}ul.lst-kix_gi12qwmrr5vl-7{list-style-type:none}ul.lst-kix_gvci0hu7yb6k-5{list-style-type:none}.lst-kix_gi12qwmrr5vl-5>li:before{content:"\0025a0   "}ul.lst-kix_gi12qwmrr5vl-6{list-style-type:none}.lst-kix_s5xocqmkj8s9-0>li{counter-increment:lst-ctn-kix_s5xocqmkj8s9-0}ol.lst-kix_rs477lwege9r-7.start{counter-reset:lst-ctn-kix_rs477lwege9r-7 0}ul.lst-kix_gvci0hu7yb6k-4{list-style-type:none}ul.lst-kix_gvci0hu7yb6k-7{list-style-type:none}ul.lst-kix_gi12qwmrr5vl-8{list-style-type:none}.lst-kix_qst1zha6rauh-6>li:before{content:"\0025cf   "}ul.lst-kix_gvci0hu7yb6k-6{list-style-type:none}.lst-kix_2w36zq8cd80k-1>li:before{content:"\0025cb   "}ul.lst-kix_iivgfpfdl0t3-0{list-style-type:none}ul.lst-kix_3m5uvca0lm53-4{list-style-type:none}.lst-kix_gi12qwmrr5vl-3>li:before{content:"\0025cf   "}ul.lst-kix_3m5uvca0lm53-5{list-style-type:none}ul.lst-kix_anetktcl8su5-8{list-style-type:none}ul.lst-kix_3m5uvca0lm53-6{list-style-type:none}.lst-kix_qst1zha6rauh-1>li:before{content:"\0025cb   "}ul.lst-kix_3m5uvca0lm53-7{list-style-type:none}ul.lst-kix_iivgfpfdl0t3-4{list-style-type:none}ul.lst-kix_c8qgjiyn10ie-8{list-style-type:none}ul.lst-kix_3m5uvca0lm53-8{list-style-type:none}ul.lst-kix_iivgfpfdl0t3-3{list-style-type:none}.lst-kix_gi12qwmrr5vl-4>li:before{content:"\0025cb   "}ul.lst-kix_c8qgjiyn10ie-7{list-style-type:none}.lst-kix_2w36zq8cd80k-2>li:before{content:"\0025a0   "}ul.lst-kix_iivgfpfdl0t3-2{list-style-type:none}.lst-kix_gi12qwmrr5vl-0>li:before{content:"\0025cf   "}ul.lst-kix_iivgfpfdl0t3-1{list-style-type:none}.lst-kix_qst1zha6rauh-0>li:before{content:"\0025cf   "}.lst-kix_qst1zha6rauh-4>li:before{content:"\0025cb   "}.lst-kix_fvisx24ngp1u-2>li{counter-increment:lst-ctn-kix_fvisx24ngp1u-2}.lst-kix_qst1zha6rauh-3>li:before{content:"\0025cf   "}.lst-kix_2w36zq8cd80k-7>li:before{content:"\0025cb   "}.lst-kix_gi12qwmrr5vl-1>li:before{content:"\0025cb   "}ul.lst-kix_3m5uvca0lm53-0{list-style-type:none}ul.lst-kix_3m5uvca0lm53-1{list-style-type:none}.lst-kix_2w36zq8cd80k-0>li:before{content:"\0025cf   "}.lst-kix_2w36zq8cd80k-8>li:before{content:"\0025a0   "}.lst-kix_gi12qwmrr5vl-2>li:before{content:"\0025a0   "}ul.lst-kix_3m5uvca0lm53-2{list-style-type:none}ol.lst-kix_82pihj16nguk-0{list-style-type:none}.lst-kix_qst1zha6rauh-2>li:before{content:"\0025a0   "}ul.lst-kix_3m5uvca0lm53-3{list-style-type:none}.lst-kix_rs477lwege9r-8>li:before{content:"" counter(lst-ctn-kix_rs477lwege9r-8,lower-roman) ". "}.lst-kix_rs477lwege9r-7>li:before{content:"" counter(lst-ctn-kix_rs477lwege9r-7,lower-latin) ". "}.lst-kix_2w36zq8cd80k-6>li:before{content:"\0025cf   "}.lst-kix_2w36zq8cd80k-5>li:before{content:"\0025a0   "}ul.lst-kix_anetktcl8su5-1{list-style-type:none}ul.lst-kix_anetktcl8su5-0{list-style-type:none}ul.lst-kix_anetktcl8su5-3{list-style-type:none}ul.lst-kix_anetktcl8su5-2{list-style-type:none}.lst-kix_2w36zq8cd80k-3>li:before{content:"\0025cf   "}ul.lst-kix_anetktcl8su5-5{list-style-type:none}ul.lst-kix_anetktcl8su5-4{list-style-type:none}.lst-kix_2w36zq8cd80k-4>li:before{content:"\0025cb   "}ul.lst-kix_anetktcl8su5-7{list-style-type:none}ul.lst-kix_anetktcl8su5-6{list-style-type:none}ol.lst-kix_s5xocqmkj8s9-3.start{counter-reset:lst-ctn-kix_s5xocqmkj8s9-3 0}ol.lst-kix_rs477lwege9r-2.start{counter-reset:lst-ctn-kix_rs477lwege9r-2 0}ol.lst-kix_fvisx24ngp1u-5.start{counter-reset:lst-ctn-kix_fvisx24ngp1u-5 0}.lst-kix_ne238lfomw56-8>li:before{content:"\0025a0   "}.lst-kix_ne238lfomw56-7>li:before{content:"\0025cb   "}.lst-kix_ne238lfomw56-6>li:before{content:"\0025cf   "}ul.lst-kix_iivgfpfdl0t3-8{list-style-type:none}ul.lst-kix_iivgfpfdl0t3-7{list-style-type:none}ul.lst-kix_iivgfpfdl0t3-6{list-style-type:none}ul.lst-kix_iivgfpfdl0t3-5{list-style-type:none}.lst-kix_s8f9k49k9svk-6>li{counter-increment:lst-ctn-kix_s8f9k49k9svk-6}.lst-kix_rs477lwege9r-3>li{counter-increment:lst-ctn-kix_rs477lwege9r-3}.lst-kix_ne238lfomw56-0>li:before{content:"\0025cf   "}.lst-kix_ne238lfomw56-1>li:before{content:"\0025cb   "}.lst-kix_ne238lfomw56-2>li:before{content:"\0025a0   "}.lst-kix_ne238lfomw56-4>li:before{content:"\0025cb   "}.lst-kix_ne238lfomw56-3>li:before{content:"\0025cf   "}.lst-kix_ne238lfomw56-5>li:before{content:"\0025a0   "}.lst-kix_fvisx24ngp1u-6>li{counter-increment:lst-ctn-kix_fvisx24ngp1u-6}.lst-kix_iivgfpfdl0t3-0>li:before{content:"\0025cf   "}ol.lst-kix_rs477lwege9r-0.start{counter-reset:lst-ctn-kix_rs477lwege9r-0 0}.lst-kix_iivgfpfdl0t3-4>li:before{content:"\0025cb   "}ul.lst-kix_s40msnqz5os7-0{list-style-type:none}.lst-kix_4ao7uanj5htj-1>li:before{content:"\0025cb   "}.lst-kix_s8ghxl62e844-5>li:before{content:"\0025a0   "}.lst-kix_s8ghxl62e844-3>li:before{content:"\0025cf   "}.lst-kix_s5xocqmkj8s9-7>li{counter-increment:lst-ctn-kix_s5xocqmkj8s9-7}.lst-kix_s8ghxl62e844-1>li:before{content:"\0025cb   "}.lst-kix_s8f9k49k9svk-3>li{counter-increment:lst-ctn-kix_s8f9k49k9svk-3}.lst-kix_iivgfpfdl0t3-2>li:before{content:"\0025a0   "}.lst-kix_rs477lwege9r-0>li{counter-increment:lst-ctn-kix_rs477lwege9r-0}.lst-kix_w06aeeqvjm56-3>li:before{content:"\0025cf   "}.lst-kix_w06aeeqvjm56-5>li:before{content:"\0025a0   "}ol.lst-kix_fvisx24ngp1u-8.start{counter-reset:lst-ctn-kix_fvisx24ngp1u-8 0}.lst-kix_q9nppjnnwv68-5>li:before{content:"\0025a0   "}.lst-kix_q9nppjnnwv68-7>li:before{content:"\0025cb   "}.lst-kix_fvisx24ngp1u-5>li{counter-increment:lst-ctn-kix_fvisx24ngp1u-5}ol.lst-kix_9i4egiire8k6-4.start{counter-reset:lst-ctn-kix_9i4egiire8k6-4 0}.lst-kix_2gqv10mkziv8-6>li:before{content:"\0025cf   "}.lst-kix_4ao7uanj5htj-7>li:before{content:"\0025cb   "}.lst-kix_iivgfpfdl0t3-6>li:before{content:"\0025cf   "}.lst-kix_iivgfpfdl0t3-8>li:before{content:"\0025a0   "}.lst-kix_q9nppjnnwv68-1>li:before{content:"\0025cb   "}.lst-kix_q9nppjnnwv68-3>li:before{content:"\0025cf   "}.lst-kix_w06aeeqvjm56-7>li:before{content:"\0025cb   "}.lst-kix_s8ghxl62e844-7>li:before{content:"\0025cb   "}.lst-kix_2gqv10mkziv8-4>li:before{content:"\0025cb   "}.lst-kix_4ao7uanj5htj-3>li:before{content:"\0025cf   "}.lst-kix_4ao7uanj5htj-5>li:before{content:"\0025a0   "}.lst-kix_2gqv10mkziv8-2>li:before{content:"\0025a0   "}.lst-kix_fvisx24ngp1u-7>li:before{content:"" counter(lst-ctn-kix_fvisx24ngp1u-7,lower-latin) ". "}.lst-kix_9i4egiire8k6-1>li:before{content:"" counter(lst-ctn-kix_9i4egiire8k6-1,lower-latin) ". "}.lst-kix_9i4egiire8k6-3>li:before{content:"" counter(lst-ctn-kix_9i4egiire8k6-3,decimal) ". "}.lst-kix_anetktcl8su5-6>li:before{content:"\0025cf   "}.lst-kix_l7ahywf1ghkc-3>li:before{content:"\0025cf   "}.lst-kix_l7ahywf1ghkc-7>li:before{content:"\0025cb   "}.lst-kix_pvxkc5ur63o3-2>li:before{content:"\0025a0   "}ul.lst-kix_4ee45band27p-8{list-style-type:none}.lst-kix_anetktcl8su5-4>li:before{content:"\0025cb   "}ul.lst-kix_4ee45band27p-7{list-style-type:none}.lst-kix_fvisx24ngp1u-3>li:before{content:"" counter(lst-ctn-kix_fvisx24ngp1u-3,decimal) ". "}ul.lst-kix_4ee45band27p-6{list-style-type:none}ul.lst-kix_4ee45band27p-5{list-style-type:none}.lst-kix_9i4egiire8k6-7>li:before{content:"" counter(lst-ctn-kix_9i4egiire8k6-7,lower-latin) ". "}ul.lst-kix_4ee45band27p-4{list-style-type:none}ul.lst-kix_4ee45band27p-3{list-style-type:none}.lst-kix_fvisx24ngp1u-1>li:before{content:"" counter(lst-ctn-kix_fvisx24ngp1u-1,lower-latin) ". "}ul.lst-kix_4ee45band27p-2{list-style-type:none}.lst-kix_l7ahywf1ghkc-5>li:before{content:"\0025a0   "}ul.lst-kix_4ee45band27p-1{list-style-type:none}.lst-kix_pvxkc5ur63o3-0>li:before{content:"\0025cf   "}.lst-kix_pvxkc5ur63o3-8>li:before{content:"\0025a0   "}ul.lst-kix_4ee45band27p-0{list-style-type:none}ol.lst-kix_s5xocqmkj8s9-0.start{counter-reset:lst-ctn-kix_s5xocqmkj8s9-0 0}.lst-kix_anetktcl8su5-0>li:before{content:"\0025cf   "}.lst-kix_anetktcl8su5-2>li:before{content:"\0025a0   "}.lst-kix_2gqv10mkziv8-8>li:before{content:"\0025a0   "}ul.lst-kix_c8qgjiyn10ie-4{list-style-type:none}ul.lst-kix_c8qgjiyn10ie-3{list-style-type:none}ul.lst-kix_c8qgjiyn10ie-6{list-style-type:none}ul.lst-kix_c8qgjiyn10ie-5{list-style-type:none}ul.lst-kix_c8qgjiyn10ie-0{list-style-type:none}.lst-kix_fvisx24ngp1u-5>li:before{content:"" counter(lst-ctn-kix_fvisx24ngp1u-5,lower-roman) ". "}ul.lst-kix_c8qgjiyn10ie-2{list-style-type:none}ul.lst-kix_c8qgjiyn10ie-1{list-style-type:none}.lst-kix_w06aeeqvjm56-1>li:before{content:"\0025cb   "}ul.lst-kix_gsnrn3gksa0-5{list-style-type:none}ul.lst-kix_gsnrn3gksa0-4{list-style-type:none}ul.lst-kix_gsnrn3gksa0-7{list-style-type:none}ul.lst-kix_gsnrn3gksa0-6{list-style-type:none}.lst-kix_rs477lwege9r-7>li{counter-increment:lst-ctn-kix_rs477lwege9r-7}ul.lst-kix_gsnrn3gksa0-1{list-style-type:none}ul.lst-kix_gsnrn3gksa0-0{list-style-type:none}ul.lst-kix_gsnrn3gksa0-3{list-style-type:none}ul.lst-kix_gsnrn3gksa0-2{list-style-type:none}.lst-kix_3m5uvca0lm53-7>li:before{content:"\0025cb   "}ul.lst-kix_gsnrn3gksa0-8{list-style-type:none}ul.lst-kix_s40msnqz5os7-4{list-style-type:none}ul.lst-kix_s40msnqz5os7-3{list-style-type:none}ul.lst-kix_s40msnqz5os7-2{list-style-type:none}ol.lst-kix_9i4egiire8k6-2.start{counter-reset:lst-ctn-kix_9i4egiire8k6-2 0}ul.lst-kix_s40msnqz5os7-1{list-style-type:none}ul.lst-kix_s40msnqz5os7-8{list-style-type:none}ul.lst-kix_s40msnqz5os7-7{list-style-type:none}ul.lst-kix_s40msnqz5os7-6{list-style-type:none}.lst-kix_pvxkc5ur63o3-6>li:before{content:"\0025cf   "}ul.lst-kix_s40msnqz5os7-5{list-style-type:none}ul.lst-kix_30z58zep11nd-2{list-style-type:none}ul.lst-kix_30z58zep11nd-3{list-style-type:none}ul.lst-kix_30z58zep11nd-4{list-style-type:none}ul.lst-kix_30z58zep11nd-5{list-style-type:none}.lst-kix_9i4egiire8k6-5>li:before{content:"" counter(lst-ctn-kix_9i4egiire8k6-5,lower-roman) ". "}.lst-kix_s5xocqmkj8s9-8>li{counter-increment:lst-ctn-kix_s5xocqmkj8s9-8}ul.lst-kix_30z58zep11nd-0{list-style-type:none}ul.lst-kix_30z58zep11nd-1{list-style-type:none}.lst-kix_pvxkc5ur63o3-4>li:before{content:"\0025cb   "}ol.lst-kix_s5xocqmkj8s9-0{list-style-type:none}ol.lst-kix_s5xocqmkj8s9-1{list-style-type:none}ul.lst-kix_30z58zep11nd-6{list-style-type:none}ol.lst-kix_s5xocqmkj8s9-4{list-style-type:none}ul.lst-kix_30z58zep11nd-7{list-style-type:none}ol.lst-kix_s5xocqmkj8s9-5{list-style-type:none}ul.lst-kix_30z58zep11nd-8{list-style-type:none}ol.lst-kix_s5xocqmkj8s9-2{list-style-type:none}ol.lst-kix_s5xocqmkj8s9-3{list-style-type:none}ol.lst-kix_s5xocqmkj8s9-8{list-style-type:none}ol.lst-kix_s5xocqmkj8s9-6{list-style-type:none}ol.lst-kix_s5xocqmkj8s9-7{list-style-type:none}.lst-kix_3m5uvca0lm53-3>li:before{content:"\0025cf   "}.lst-kix_3m5uvca0lm53-2>li:before{content:"\0025a0   "}ul.lst-kix_4ao7uanj5htj-0{list-style-type:none}.lst-kix_30z58zep11nd-5>li:before{content:"\0025a0   "}ul.lst-kix_4ao7uanj5htj-2{list-style-type:none}ul.lst-kix_4ao7uanj5htj-1{list-style-type:none}.lst-kix_30z58zep11nd-6>li:before{content:"\0025cf   "}ul.lst-kix_4ao7uanj5htj-4{list-style-type:none}ul.lst-kix_4ao7uanj5htj-3{list-style-type:none}ul.lst-kix_4ao7uanj5htj-6{list-style-type:none}ul.lst-kix_4ao7uanj5htj-5{list-style-type:none}.lst-kix_fvisx24ngp1u-1>li{counter-increment:lst-ctn-kix_fvisx24ngp1u-1}ul.lst-kix_4ao7uanj5htj-8{list-style-type:none}ul.lst-kix_4ao7uanj5htj-7{list-style-type:none}ul.lst-kix_s8ghxl62e844-8{list-style-type:none}ul.lst-kix_s8ghxl62e844-7{list-style-type:none}.lst-kix_l7ahywf1ghkc-2>li:before{content:"\0025a0   "}ul.lst-kix_s8ghxl62e844-6{list-style-type:none}ul.lst-kix_s8ghxl62e844-5{list-style-type:none}ul.lst-kix_s8ghxl62e844-4{list-style-type:none}ul.lst-kix_s8ghxl62e844-3{list-style-type:none}ul.lst-kix_s8ghxl62e844-2{list-style-type:none}.lst-kix_9i4egiire8k6-7>li{counter-increment:lst-ctn-kix_9i4egiire8k6-7}ul.lst-kix_s8ghxl62e844-1{list-style-type:none}ul.lst-kix_s8ghxl62e844-0{list-style-type:none}.lst-kix_rs477lwege9r-8>li{counter-increment:lst-ctn-kix_rs477lwege9r-8}.lst-kix_anetktcl8su5-8>li:before{content:"\0025a0   "}ul.lst-kix_si5ikxnlj1q7-4{list-style-type:none}ul.lst-kix_si5ikxnlj1q7-3{list-style-type:none}ul.lst-kix_si5ikxnlj1q7-6{list-style-type:none}ul.lst-kix_si5ikxnlj1q7-5{list-style-type:none}ul.lst-kix_si5ikxnlj1q7-0{list-style-type:none}.lst-kix_2gqv10mkziv8-0>li:before{content:"\0025cf   "}.lst-kix_s5xocqmkj8s9-3>li{counter-increment:lst-ctn-kix_s5xocqmkj8s9-3}ul.lst-kix_si5ikxnlj1q7-2{list-style-type:none}ul.lst-kix_si5ikxnlj1q7-1{list-style-type:none}ol.lst-kix_9i4egiire8k6-0.start{counter-reset:lst-ctn-kix_9i4egiire8k6-0 0}ul.lst-kix_si5ikxnlj1q7-8{list-style-type:none}ul.lst-kix_si5ikxnlj1q7-7{list-style-type:none}.lst-kix_175jp61awd4f-0>li:before{content:"\0025cf   "}.lst-kix_175jp61awd4f-1>li:before{content:"\0025cb   "}.lst-kix_175jp61awd4f-4>li:before{content:"\0025cb   "}.lst-kix_175jp61awd4f-5>li:before{content:"\0025a0   "}ol.lst-kix_rs477lwege9r-4{list-style-type:none}.lst-kix_fvisx24ngp1u-3>li{counter-increment:lst-ctn-kix_fvisx24ngp1u-3}ol.lst-kix_rs477lwege9r-3{list-style-type:none}ol.lst-kix_rs477lwege9r-2{list-style-type:none}ol.lst-kix_rs477lwege9r-1{list-style-type:none}ol.lst-kix_rs477lwege9r-8{list-style-type:none}ol.lst-kix_rs477lwege9r-7{list-style-type:none}ol.lst-kix_rs477lwege9r-6{list-style-type:none}ol.lst-kix_rs477lwege9r-5{list-style-type:none}.lst-kix_175jp61awd4f-8>li:before{content:"\0025a0   "}ol.lst-kix_rs477lwege9r-0{list-style-type:none}ul.lst-kix_ne238lfomw56-2{list-style-type:none}ul.lst-kix_ne238lfomw56-1{list-style-type:none}ul.lst-kix_ne238lfomw56-4{list-style-type:none}ul.lst-kix_ne238lfomw56-3{list-style-type:none}.lst-kix_c8qgjiyn10ie-8>li:before{content:"\0025a0   "}ul.lst-kix_ne238lfomw56-6{list-style-type:none}ul.lst-kix_ne238lfomw56-5{list-style-type:none}.lst-kix_4ao7uanj5htj-2>li:before{content:"\0025a0   "}ul.lst-kix_ne238lfomw56-8{list-style-type:none}ul.lst-kix_ne238lfomw56-7{list-style-type:none}.lst-kix_88bs2bqozfm2-3>li:before{content:"\0025cf   "}.lst-kix_c8qgjiyn10ie-4>li:before{content:"\0025cb   "}.lst-kix_sxdyd6bfs1ox-0>li:before{content:"\0025cf   "}.lst-kix_gvci0hu7yb6k-4>li:before{content:"\0025cb   "}.lst-kix_iivgfpfdl0t3-5>li:before{content:"\0025a0   "}.lst-kix_s8ghxl62e844-6>li:before{content:"\0025cf   "}.lst-kix_88bs2bqozfm2-7>li:before{content:"\0025cb   "}.lst-kix_sxdyd6bfs1ox-4>li:before{content:"\0025cb   "}.lst-kix_gvci0hu7yb6k-8>li:before{content:"\0025a0   "}.lst-kix_iivgfpfdl0t3-1>li:before{content:"\0025cb   "}.lst-kix_s8ghxl62e844-2>li:before{content:"\0025a0   "}ul.lst-kix_qst1zha6rauh-6{list-style-type:none}.lst-kix_fvisx24ngp1u-8>li{counter-increment:lst-ctn-kix_fvisx24ngp1u-8}ul.lst-kix_qst1zha6rauh-5{list-style-type:none}.lst-kix_s8f9k49k9svk-2>li:before{content:"" counter(lst-ctn-kix_s8f9k49k9svk-2,lower-roman) ". "}.lst-kix_s8f9k49k9svk-6>li:before{content:"" counter(lst-ctn-kix_s8f9k49k9svk-6,decimal) ". "}.lst-kix_w06aeeqvjm56-4>li:before{content:"\0025cb   "}ul.lst-kix_qst1zha6rauh-8{list-style-type:none}.lst-kix_82pihj16nguk-0>li{counter-increment:lst-ctn-kix_82pihj16nguk-0}ul.lst-kix_qst1zha6rauh-7{list-style-type:none}ul.lst-kix_qst1zha6rauh-2{list-style-type:none}ul.lst-kix_qst1zha6rauh-1{list-style-type:none}ul.lst-kix_qst1zha6rauh-4{list-style-type:none}ul.lst-kix_qst1zha6rauh-3{list-style-type:none}.lst-kix_9fzrrhqm4j52-5>li:before{content:"\0025a0   "}.lst-kix_sxdyd6bfs1ox-8>li:before{content:"\0025a0   "}.lst-kix_2gqv10mkziv8-7>li:before{content:"\0025cb   "}ul.lst-kix_qst1zha6rauh-0{list-style-type:none}.lst-kix_q9nppjnnwv68-6>li:before{content:"\0025cf   "}.lst-kix_9fzrrhqm4j52-1>li:before{content:"\0025cb   "}.lst-kix_4ao7uanj5htj-6>li:before{content:"\0025cf   "}.lst-kix_w06aeeqvjm56-8>li:before{content:"\0025a0   "}.lst-kix_2gqv10mkziv8-3>li:before{content:"\0025cf   "}.lst-kix_gvci0hu7yb6k-0>li:before{content:"\0025cf   "}ul.lst-kix_ne238lfomw56-0{list-style-type:none}.lst-kix_q9nppjnnwv68-2>li:before{content:"\0025a0   "}ul.lst-kix_82pihj16nguk-6{list-style-type:none}.lst-kix_l7ahywf1ghkc-6>li:before{content:"\0025cf   "}.lst-kix_fvisx24ngp1u-6>li:before{content:"" counter(lst-ctn-kix_fvisx24ngp1u-6,decimal) ". "}ul.lst-kix_82pihj16nguk-7{list-style-type:none}.lst-kix_9argrz9zfbv7-4>li:before{content:"\0025cb   "}.lst-kix_s40msnqz5os7-2>li:before{content:"\0025a0   "}ul.lst-kix_82pihj16nguk-4{list-style-type:none}.lst-kix_pvxkc5ur63o3-3>li:before{content:"\0025cf   "}ul.lst-kix_82pihj16nguk-5{list-style-type:none}ul.lst-kix_82pihj16nguk-2{list-style-type:none}ul.lst-kix_82pihj16nguk-3{list-style-type:none}.lst-kix_anetktcl8su5-5>li:before{content:"\0025a0   "}ul.lst-kix_82pihj16nguk-1{list-style-type:none}.lst-kix_fvisx24ngp1u-2>li:before{content:"" counter(lst-ctn-kix_fvisx24ngp1u-2,lower-roman) ". "}.lst-kix_s40msnqz5os7-6>li:before{content:"\0025cf   "}.lst-kix_pvxkc5ur63o3-7>li:before{content:"\0025cb   "}.lst-kix_9i4egiire8k6-0>li:before{content:"" counter(lst-ctn-kix_9i4egiire8k6-0,decimal) ". "}.lst-kix_9i4egiire8k6-8>li:before{content:"" counter(lst-ctn-kix_9i4egiire8k6-8,lower-roman) ". "}.lst-kix_anetktcl8su5-1>li:before{content:"\0025cb   "}.lst-kix_9argrz9zfbv7-0>li:before{content:"\0025cf   "}ul.lst-kix_82pihj16nguk-8{list-style-type:none}.lst-kix_9i4egiire8k6-2>li{counter-increment:lst-ctn-kix_9i4egiire8k6-2}ul.lst-kix_pvxkc5ur63o3-8{list-style-type:none}.lst-kix_w06aeeqvjm56-0>li:before{content:"\0025cf   "}.lst-kix_s5xocqmkj8s9-2>li:before{content:"" counter(lst-ctn-kix_s5xocqmkj8s9-2,lower-roman) ". "}.lst-kix_si5ikxnlj1q7-2>li:before{content:"\0025a0   "}.lst-kix_si5ikxnlj1q7-6>li:before{content:"\0025cf   "}.lst-kix_3m5uvca0lm53-6>li:before{content:"\0025cf   "}li.li-bullet-0:before{margin-left:-18pt;white-space:nowrap;display:inline-block;min-width:18pt}.lst-kix_30z58zep11nd-2>li:before{content:"\0025a0   "}.lst-kix_s8f9k49k9svk-1>li{counter-increment:lst-ctn-kix_s8f9k49k9svk-1}.lst-kix_s5xocqmkj8s9-6>li:before{content:"" counter(lst-ctn-kix_s5xocqmkj8s9-6,decimal) ". "}ul.lst-kix_pvxkc5ur63o3-3{list-style-type:none}ul.lst-kix_pvxkc5ur63o3-2{list-style-type:none}ul.lst-kix_pvxkc5ur63o3-1{list-style-type:none}.lst-kix_9argrz9zfbv7-8>li:before{content:"\0025a0   "}ul.lst-kix_pvxkc5ur63o3-0{list-style-type:none}ul.lst-kix_pvxkc5ur63o3-7{list-style-type:none}ul.lst-kix_pvxkc5ur63o3-6{list-style-type:none}ul.lst-kix_pvxkc5ur63o3-5{list-style-type:none}.lst-kix_s5xocqmkj8s9-5>li{counter-increment:lst-ctn-kix_s5xocqmkj8s9-5}.lst-kix_9i4egiire8k6-4>li:before{content:"" counter(lst-ctn-kix_9i4egiire8k6-4,lower-latin) ". "}ul.lst-kix_pvxkc5ur63o3-4{list-style-type:none}ol{margin:0;padding:0}table td,table th{padding:0}.MvcjwGOuIU-c27{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;background-color:#d9d9d9;border-left-style:solid;border-bottom-width:1pt;width:239.2pt;border-top-color:#000000;border-bottom-style:solid}.MvcjwGOuIU-c62{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:2.2pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:dotted;background-color:#b6d7a8;border-left-style:solid;border-bottom-width:1pt;width:210.8pt;border-top-color:#000000;border-bottom-style:solid}.MvcjwGOuIU-c56{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;background-color:#b6d7a8;border-left-style:solid;border-bottom-width:1pt;width:54.8pt;border-top-color:#000000;border-bottom-style:solid}.MvcjwGOuIU-c48{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:middle;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;background-color:#d9ead3;border-left-style:solid;border-bottom-width:1pt;width:488.2pt;border-top-color:#000000;border-bottom-style:solid}.MvcjwGOuIU-c44{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;background-color:#d9d9d9;border-left-style:solid;border-bottom-width:1pt;width:56.2pt;border-top-color:#000000;border-bottom-style:solid}.MvcjwGOuIU-c46{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:middle;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;background-color:#d9d9d9;border-left-style:solid;border-bottom-width:1pt;width:159.8pt;border-top-color:#000000;border-bottom-style:solid}.MvcjwGOuIU-c77{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:middle;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:488.2pt;border-top-color:#000000;border-bottom-style:solid}.MvcjwGOuIU-c66{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:middle;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:237.8pt;border-top-color:#000000;border-bottom-style:solid}.MvcjwGOuIU-c75{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:2.2pt;width:55.5pt;border-top-color:#000000;border-bottom-style:dotted}.MvcjwGOuIU-c73{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:172.5pt;border-top-color:#000000;border-bottom-style:solid}.MvcjwGOuIU-c23{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:260pt;border-top-color:#000000;border-bottom-style:solid}.MvcjwGOuIU-c65{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:2.2pt;width:151.5pt;border-top-color:#000000;border-bottom-style:dotted}.MvcjwGOuIU-c30{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:440.2pt;border-top-color:#000000;border-bottom-style:solid}.MvcjwGOuIU-c85{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:112.5pt;border-top-color:#000000;border-bottom-style:solid}.MvcjwGOuIU-c69{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:2.2pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:dotted;border-left-style:solid;border-bottom-width:1pt;width:55.5pt;border-top-color:#000000;border-bottom-style:solid}.MvcjwGOuIU-c76{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:2.2pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:dotted;border-left-style:solid;border-bottom-width:1pt;width:151.5pt;border-top-color:#000000;border-bottom-style:solid}.MvcjwGOuIU-c33{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:70.5pt;border-top-color:#000000;border-bottom-style:solid}.MvcjwGOuIU-c89{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:2.2pt;width:54.8pt;border-top-color:#000000;border-bottom-style:dotted}.MvcjwGOuIU-c61{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:middle;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:112.5pt;border-top-color:#000000;border-bottom-style:solid}.MvcjwGOuIU-c25{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:middle;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:250.5pt;border-top-color:#000000;border-bottom-style:solid}.MvcjwGOuIU-c87{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:2.2pt;width:210.8pt;border-top-color:#000000;border-bottom-style:dotted}.MvcjwGOuIU-c67{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:55.5pt;border-top-color:#000000;border-bottom-style:solid}.MvcjwGOuIU-c39{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:401.2pt;border-top-color:#000000;border-bottom-style:solid}.MvcjwGOuIU-c47{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:239.2pt;border-top-color:#000000;border-bottom-style:solid}.MvcjwGOuIU-c52{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:56.2pt;border-top-color:#000000;border-bottom-style:solid}.MvcjwGOuIU-c74{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:535.5pt;border-top-color:#000000;border-bottom-style:solid}.MvcjwGOuIU-c82{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:2.2pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:dotted;border-left-style:solid;border-bottom-width:1pt;width:54.8pt;border-top-color:#000000;border-bottom-style:solid}.MvcjwGOuIU-c58{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:210.8pt;border-top-color:#000000;border-bottom-style:solid}.MvcjwGOuIU-c68{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:475.5pt;border-top-color:#000000;border-bottom-style:solid}.MvcjwGOuIU-c42{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:243.8pt;border-top-color:#000000;border-bottom-style:solid}.MvcjwGOuIU-c79{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:54.8pt;border-top-color:#000000;border-bottom-style:solid}.MvcjwGOuIU-c37{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:408.8pt;border-top-color:#000000;border-bottom-style:solid}.MvcjwGOuIU-c35{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:100%;border-top-color:#000000;border-bottom-style:solid}.MvcjwGOuIU-c34{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:137.2pt;border-top-color:#000000;border-bottom-style:solid}.MvcjwGOuIU-c43{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:56.2pt;border-top-color:#000000;border-bottom-style:solid}.MvcjwGOuIU-c55{border-right-style:solid;padding:5pt 5pt 5pt 5pt;border-bottom-color:#000000;border-top-width:1pt;border-right-width:1pt;border-left-color:#000000;vertical-align:top;border-right-color:#000000;border-left-width:1pt;border-top-style:solid;border-left-style:solid;border-bottom-width:1pt;width:151.5pt;border-top-color:#000000;border-bottom-style:solid}.MvcjwGOuIU-c0{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial";font-style:normal}.MvcjwGOuIU-c6{margin-block-start:0;margin-block-end:0;padding-top:12pt;padding-bottom:4pt;line-height:1.5;page-break-after:avoid;orphans:2;widows:2;text-align:left}.MvcjwGOuIU-c5{padding-top:0pt;padding-bottom:0pt;line-height:1.5;orphans:2;widows:2;text-align:left}.MvcjwGOuIU-c13{color:#000000;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial"}.MvcjwGOuIU-c31{color:#666666;font-weight:400;text-decoration:none;vertical-align:baseline;font-size:11pt;font-family:"Arial"}.MvcjwGOuIU-c70{padding-top:18pt;padding-bottom:6pt;line-height:1.5;page-break-after:avoid;text-align:left}.MvcjwGOuIU-c80{background-color:#ffffff;color:#999999;font-weight:400;font-size:10.5pt;font-family:"Arial"}.MvcjwGOuIU-c18{padding-top:14pt;padding-bottom:4pt;line-height:1.5;page-break-after:avoid;text-align:left}.MvcjwGOuIU-c57{padding-top:16pt;padding-bottom:4pt;line-height:1.5;page-break-after:avoid;text-align:left}.MvcjwGOuIU-c9{color:#000000;text-decoration:none;vertical-align:baseline;font-style:normal}.MvcjwGOuIU-c54{color:#434343;font-weight:400;font-size:14pt;font-family:"Arial"}.MvcjwGOuIU-c28{border-spacing:0;border-collapse:collapse;margin-right:auto}.MvcjwGOuIU-c24{padding-top:0pt;padding-bottom:0pt;line-height:1.0;text-align:left}.MvcjwGOuIU-c71{padding-top:0pt;padding-bottom:0pt;line-height:1.5;text-align:center}.MvcjwGOuIU-c88{border-spacing:0;border-collapse:collapse;margin-right:auto}.MvcjwGOuIU-c1{font-size:9pt;font-family:"Roboto Mono";color:#188038;font-weight:400}.MvcjwGOuIU-c2{padding-top:0pt;padding-bottom:0pt;line-height:1.5;text-align:left}.MvcjwGOuIU-c21{padding-top:0pt;padding-bottom:0pt;line-height:1.0;text-align:center}.MvcjwGOuIU-c19{color:#666666;font-weight:400;font-size:12pt;font-family:"Arial"}.MvcjwGOuIU-c8{text-decoration-skip-ink:none;-webkit-text-decoration-skip:none;color:#1155cc;text-decoration:underline}.MvcjwGOuIU-c3{orphans:2;widows:2;height:11pt}.MvcjwGOuIU-c14{font-weight:700;font-size:11pt;font-family:"Arial"}.MvcjwGOuIU-c7{font-size:9pt;font-weight:400;font-family:"Roboto Mono"}.MvcjwGOuIU-c17{text-decoration:none;vertical-align:baseline;font-style:normal}.MvcjwGOuIU-c20{background-color:#ffffff;color:#161616;font-size:10.5pt}.MvcjwGOuIU-c40{font-weight:400;font-size:16pt;font-family:"Arial"}.MvcjwGOuIU-c29{margin-left:180pt;padding-left:0pt}.MvcjwGOuIU-c26{margin-left:72pt;padding-left:0pt}.MvcjwGOuIU-c38{margin-left:108pt;padding-left:0pt}.MvcjwGOuIU-c50{margin-left:144pt;padding-left:0pt}.MvcjwGOuIU-c16{margin-left:36pt;padding-left:0pt}.MvcjwGOuIU-c22{font-weight:400;font-family:Consolas,"Courier New"}.MvcjwGOuIU-c84{max-width:468pt;padding:72pt 72pt 72pt 72pt}.MvcjwGOuIU-c12{orphans:2;widows:2}.MvcjwGOuIU-c51{color:#1f2328;font-size:12pt}.MvcjwGOuIU-c60{margin-left:216pt;padding-left:0pt}.MvcjwGOuIU-c72{height:23.4pt}.MvcjwGOuIU-c78{background-color:#fff2cc}.MvcjwGOuIU-c83{background-color:#ffffff}.MvcjwGOuIU-c41{vertical-align:super}.MvcjwGOuIU-c36{font-style:normal}.MvcjwGOuIU-c11{height:11pt}.MvcjwGOuIU-c59{background-color:#d9ead3}.MvcjwGOuIU-c53{background-color:#f4cccc}.MvcjwGOuIU-c32{font-size:9pt}.MvcjwGOuIU-c64{background-color:#d9d9d9}.MvcjwGOuIU-c86{color:#999999}.MvcjwGOuIU-c45{height:21pt}.MvcjwGOuIU-c15{font-weight:700}.MvcjwGOuIU-c63{background-color:#b6d7a8}.MvcjwGOuIU-c10{font-style:italic}.MvcjwGOuIU-c49{color:#37474f}.MvcjwGOuIU-c81{height:21.6pt}.MvcjwGOuIU-c4{height:0pt}.title{padding-top:0pt;color:#000000;font-size:26pt;padding-bottom:3pt;font-family:"Arial";line-height:1.5;page-break-after:avoid;orphans:2;widows:2;text-align:left}.subtitle{padding-top:0pt;color:#666666;font-size:15pt;padding-bottom:16pt;font-family:"Arial";line-height:1.5;page-break-after:avoid;orphans:2;widows:2;text-align:left}li{color:#000000;font-size:11pt;font-family:"Arial"}p{margin:0;color:#000000;font-size:11pt;font-family:"Arial"}h1{padding-top:20pt;color:#000000;font-size:20pt;padding-bottom:6pt;font-family:"Arial";line-height:1.5;page-break-after:avoid;orphans:2;widows:2;text-align:left}h2{padding-top:18pt;color:#000000;font-size:16pt;padding-bottom:6pt;font-family:"Arial";line-height:1.5;page-break-after:avoid;orphans:2;widows:2;text-align:left}h3{padding-top:16pt;color:#434343;font-size:14pt;padding-bottom:4pt;font-family:"Arial";line-height:1.5;page-break-after:avoid;orphans:2;widows:2;text-align:left}h4{padding-top:14pt;color:#666666;font-size:12pt;padding-bottom:4pt;font-family:"Arial";line-height:1.5;page-break-after:avoid;orphans:2;widows:2;text-align:left}h5{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.5;page-break-after:avoid;orphans:2;widows:2;text-align:left}h6{padding-top:12pt;color:#666666;font-size:11pt;padding-bottom:4pt;font-family:"Arial";line-height:1.5;page-break-after:avoid;font-style:italic;orphans:2;widows:2;text-align:left}</style></head><body class="c83 c84 doc-content"><div>
 <p class="MvcjwGOuIU-c5 MvcjwGOuIU-c11"><span class="MvcjwGOuIU-c0"></span></p></div>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c86">Posted by Mateusz Jurczyk, Google Project Zero</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span>As previously mentioned in the second installment of the blog post series (</span><span class="MvcjwGOuIU-c8"><a href="https://googleprojectzero.blogspot.com/2024/04/the-windows-registry-adventure-2.html">&quot;A brief history of the feature&quot;</a></span><span>), the binary format used to encode registry hives from Windows NT 3.1 up to the modern Windows 11 is called </span><span class="MvcjwGOuIU-c0">regf. In a way, it is quite special, because it represents a registry subtree simultaneously on disk and in memory, as opposed to most other common file formats. Documents, images, videos, etc. are generally designed to store data efficiently on disk, and they are subsequently parsed to and from different in-memory representations whenever they are read or written. This seems only natural, as offline storage and RAM come with different constraints and requirements. On disk, it is important that the data is packed as tightly as possible, while in memory, easy and efficient random access is typically prioritized. The regf format aims to bypass the reparsing step &ndash; likely to optimize the memory/disk synchronization process &ndash; and reconcile the two types of data encodings into a single one that is both relatively compact and easy to operate on at the same time. This explains, for instance, why hives don&#39;t natively support compression (but the clients are of course free to store compressed data in the registry). This unique approach comes with its own set of challenges, and has been a contributing factor in a number of historical vulnerabilities.</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span>Throughout the 30 years of the format&#39;s existence, Microsoft has never released its official specification. However, the data layout of all of the building blocks making up a hive (file header, bin headers, cell structures) are effectively public through the PDB symbols for the Windows kernel image (ntoskrnl.exe) available on the </span><span class="MvcjwGOuIU-c8"><a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/debugger/microsoft-public-symbols">Microsoft Symbol Server</a></span><span>. Furthermore, the Windows Internals book series also includes a section that delves into the specifics of the regf format (named </span><span class="MvcjwGOuIU-c10">Hive structure</span><span>). Lastly, forensics experts have long expressed interest in the format for analysis purposes, resulting in the creation of several unofficial specifications based on reverse engineering, experimentation and deduction. These sources have been listed in my earlier </span><span class="MvcjwGOuIU-c8"><a href="https://googleprojectzero.blogspot.com/2024/06/the-windows-registry-adventure-3.html">Learning resources</a></span><span>&nbsp;blog post; the two most extensive specifications of this kind can be found </span><span class="MvcjwGOuIU-c8"><a href="https://github.com/libyal/libregf/blob/main/documentation/Windows%2520NT%2520Registry%2520File%2520(REGF)%2520format.asciidoc">here</a></span><span>&nbsp;and </span><span class="MvcjwGOuIU-c8"><a href="https://github.com/msuhanov/regf/blob/master/Windows%2520registry%2520file%2520format%2520specification.md">here</a></span><span class="MvcjwGOuIU-c0">. The intent of this post is not to repeat the information compiled in the existing resources, but rather to highlight specific parts of the format that have major relevance to security, or provide some extra context where I found it missing. A deep understanding of the low-level regf format will prove invaluable in grasping many of the higher-level concepts in the registry, as well as the technical details of software bugs discussed in future blog posts.</span></p><h2 class="MvcjwGOuIU-c70 MvcjwGOuIU-c12" id="h.q4886tcewkdo"><span class="MvcjwGOuIU-c9 MvcjwGOuIU-c40">The hive structure: header, bins and cells</span></h2>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span>On the lowest level, data in hives is organized in chunks of 4 KiB (0x1000 bytes), incidentally the size of a standard memory page in the x86 architecture. The first 4 KiB always correspond to the header (also called the </span><span class="MvcjwGOuIU-c10">base block</span><span>), followed by one or more </span><span class="MvcjwGOuIU-c10">bins</span><span class="MvcjwGOuIU-c0">, each being a multiple of 4 KiB in length. The header specifies general information about the hive (signature, version, etc.), while bins are an abstraction layer designed to enable the fragmentation of hive mappings in virtual memory &ndash; more on that later.</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span>Each bin starts with a 32-byte (0x20) header, followed by one or more </span><span class="MvcjwGOuIU-c10">cells</span><span class="MvcjwGOuIU-c0">&nbsp;that completely fill the bin. A cell is the smallest unit of data in a hive that has a specific purpose (e.g. describes a key, value, security descriptor, and so on). The data of a cell is preceded by a 32-bit integer specifying its size, which must be a multiple of eight (i.e. its three least significant bits are clear), and is either in the free or allocated state. A free (unused) cell is indicated by a positive size, and an allocated cell is indicated by a negative one. For example, a free cell of 32 bytes has a length marker of 0x00000020, while an active cell of 128 bytes has its size encoded as 0xFFFFFF80. This visibly demonstrates the hybrid on-disk / in-memory nature of the hive format as opposed to other classic formats, which don&#39;t intentionally leave large chunks of unused space in the files.</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">The overall file structure is illustrated in the diagram below:</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiQtJm0XNkozXGxjQnB9n1ka9OuxP7lrLSQN1KZF-Zc60Z06dBEz3AAA8aAYnmdrU4imLebCFvF6qXaE0h-uA_iXnuyAisG90JWawSAMPPaToLdXMGeC4FlyGz42FWkf1bPhJmwSez8Ot-DLI29n4jinIXswZ-LQoLyWX7PIKVF5EwkRoAXNUFYIdcCOwo/s1999/image8.png" style="display: block; padding: 1em 0;text-align: center;"><img alt="Pictoral representation of the overall file structure" border="0" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiQtJm0XNkozXGxjQnB9n1ka9OuxP7lrLSQN1KZF-Zc60Z06dBEz3AAA8aAYnmdrU4imLebCFvF6qXaE0h-uA_iXnuyAisG90JWawSAMPPaToLdXMGeC4FlyGz42FWkf1bPhJmwSez8Ot-DLI29n4jinIXswZ-LQoLyWX7PIKVF5EwkRoAXNUFYIdcCOwo/s1200/image8.png" style="max-height: 750px; max-width: 600px;" title="Pictoral representation of the overall file structure" /></a></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">In the Windows kernel, internal functions responsible for handling these low-level hive objects (base block, bins, cells) have names starting with &quot;Hv&quot;, for example HvCheckHive, HvpAllocateBin or HvpViewMapCleanup. This part of the registry codebase is crucial as it forms the foundation of the registry logic, enabling the Configuration Manager to easily allocate, free, and access hive cells without concerning itself with the technical details of memory management. It is also a place with significant potential for optimizations, such as the incremental logging added in Windows 8.1, or section-based registry introduced in Windows 10 April 2018 Update (RS4). Both of these mechanisms are well described in the Windows Internals 7 (Part 2) book.</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span>While integral to the correct functioning of the registry, hive management does not constitute a very large part of the overall registry-related codebase. In my analysis of the registry code growth shown in blog post #2, I counted 100,007 decompiled lines of code corresponding to this subsystem in Windows 11 kernel build 10.0.22621.2134. Out of these, only 10,407 or around 10.4% correspond to hive memory management. This is also reflected in my findings: out of the 52 CVEs assigned by Microsoft, only two of them were directly related to a Hv* function implementation &ndash; </span><span class="MvcjwGOuIU-c8"><a href="https://project-zero.issues.chromium.org/issues/42451463">CVE-2022-37988</a></span><span>, a logic bug in HvReallocateCell leading to memory </span><span>corruption,</span><span>&nbsp;and </span><span class="MvcjwGOuIU-c8"><a href="https://project-zero.issues.chromium.org/issues/42451731">CVE-2024-43452</a></span><span class="MvcjwGOuIU-c0">, a double-fetch while loading hives from remote network shares. This is not to say that there aren&#39;t more bugs in this mechanism, but their quantity is likely proportional to its size relative to the rest of the registry-related code.</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">Let&#39;s now have a closer look at how each of the basic objects in the hive are encoded and what information they store, starting with the base block.</span></p><h3 class="MvcjwGOuIU-c57 MvcjwGOuIU-c12" id="h.2aivd8b843r"><span class="MvcjwGOuIU-c54 MvcjwGOuIU-c17">Base block</span></h3>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">The base block is represented by a structure called _HBASE_BLOCK in the Windows Kernel, and its layout can be displayed in WinDbg:</span></p>
 <p class="MvcjwGOuIU-c5 MvcjwGOuIU-c11"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c5"><span></span><span class="MvcjwGOuIU-c1">0:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">kd&gt;</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">dt</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">_HBASE_BLOCK</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1">nt!_HBASE_BLOCK</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x000</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Signature</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Uint4B</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x004</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Sequence1</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Uint4B</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x008</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Sequence2</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Uint4B</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x00c</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">TimeStamp</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">_LARGE_INTEGER</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x014</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Major</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Uint4B</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x018</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Minor</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Uint4B</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x01c</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Type</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Uint4B</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x020</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Format</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Uint4B</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x024</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">RootCell</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Uint4B</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x028</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Length</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Uint4B</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x02c</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Cluster</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Uint4B</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x030</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">FileName</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">[64]</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">UChar</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x070</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">RmId</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">_GUID</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x080</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">LogId</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">_GUID</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x090</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Flags</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Uint4B</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x094</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">TmId</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">_GUID</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x0a4</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">GuidSignature</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Uint4B</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x0a8</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">LastReorganizeTime</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Uint8B</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x0b0</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Reserved1</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">[83]</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Uint4B</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x1fc</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">CheckSum</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Uint4B</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x200</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Reserved2</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">[882]</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Uint4B</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0xfc8</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">ThawTmId</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">_GUID</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0xfd8</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">ThawRmId</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">_GUID</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0xfe8</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">ThawLogId</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">_GUID</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0xff8</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">BootType</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Uint4B</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0xffc</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">BootRecover</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Uint4B</span></p>
 <br/>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">The first thing that stands out is the fact that even though the base block is 4096-bytes long, it only really stores around 236 bytes of meaningful data, and the rest (the Reserved1 and Reserved2 arrays) are filled with zeros. For a detailed description of each field, I encourage you to refer to the two unofficial regf specifications mentioned earlier. In the sections below, I share additional thoughts on the usage and relevance of some of the most interesting header members.</span></p><h4 class="MvcjwGOuIU-c18 MvcjwGOuIU-c12" id="h.hfgb3akvp2w6"><span class="MvcjwGOuIU-c19 MvcjwGOuIU-c17">Sequence1, Sequence2</span></h4>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span>These 32-bit numbers are updated by the kernel during registry write operations to keep track of the consistency state of the hive. If the two values are equal during loading, the hive is in a &quot;clean&quot; state and doesn&#39;t require any kind of recovery. If they differ, this indicates that not all pending changes have been fully committed to the primary hive file, and additional modifications must be applied based on the accompanying .LOG/.LOG1/.LOG2 files. From a security point of view, manually controlling these fields may be useful in ensuring that the log recovery logic (</span><span>HvAnalyzeLogFiles</span><span>, HvpPerformLogFileRecovery and related functions) gets executed by the kernel. This is what I did when crafting the proof-of-concept files for </span><span class="MvcjwGOuIU-c8"><a href="https://project-zero.issues.chromium.org/issues/42451598">CVE-2023-35386</a></span><span>&nbsp;and </span><span class="MvcjwGOuIU-c8"><a href="https://project-zero.issues.chromium.org/issues/42451600">CVE-2023-38154</a></span><span class="MvcjwGOuIU-c0">.</span></p><h4 class="MvcjwGOuIU-c18 MvcjwGOuIU-c12" id="h.jk8scvefffm6"><span class="MvcjwGOuIU-c19 MvcjwGOuIU-c17">Major, Minor</span></h4>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">These are some of the most consequential fields in the header: they represent the major and minor version of the hive. The only valid major version is 1, while the minor version has been historically an integer between 0 and 6. Here is an overview of the different 1.x versions in existence:</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p><table class="MvcjwGOuIU-c28"><tr class="MvcjwGOuIU-c4"><td class="MvcjwGOuIU-c67 MvcjwGOuIU-c64" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c21"><span class="MvcjwGOuIU-c9 MvcjwGOuIU-c14">Version</span></p></td><td class="MvcjwGOuIU-c64 MvcjwGOuIU-c79" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c21"><span class="MvcjwGOuIU-c9 MvcjwGOuIU-c14">Year</span></p></td><td class="MvcjwGOuIU-c58 MvcjwGOuIU-c64" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c24"><span class="MvcjwGOuIU-c9 MvcjwGOuIU-c14">Introduced in</span></p></td><td class="MvcjwGOuIU-c55 MvcjwGOuIU-c64" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c24"><span class="MvcjwGOuIU-c9 MvcjwGOuIU-c14">New features</span></p></td></tr><tr class="MvcjwGOuIU-c72"><td class="MvcjwGOuIU-c53 MvcjwGOuIU-c67" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c21"><span class="MvcjwGOuIU-c0">1.0</span></p></td><td class="MvcjwGOuIU-c79 MvcjwGOuIU-c53" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c21"><span class="MvcjwGOuIU-c0">1992</span></p></td><td class="MvcjwGOuIU-c58 MvcjwGOuIU-c53" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c24"><span class="MvcjwGOuIU-c0">Windows NT 3.1 Pre-Release</span></p></td><td class="MvcjwGOuIU-c55 MvcjwGOuIU-c53" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c24"><span class="MvcjwGOuIU-c0">Initial format</span></p></td></tr><tr class="MvcjwGOuIU-c72"><td class="MvcjwGOuIU-c67 MvcjwGOuIU-c53" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c21"><span class="MvcjwGOuIU-c0">1.1</span></p></td><td class="MvcjwGOuIU-c79 MvcjwGOuIU-c53" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c21"><span class="MvcjwGOuIU-c0">1993</span></p></td><td class="MvcjwGOuIU-c53 MvcjwGOuIU-c58" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c24"><span class="MvcjwGOuIU-c0">Windows NT 3.1</span></p></td><td class="MvcjwGOuIU-c53 MvcjwGOuIU-c55" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c24 MvcjwGOuIU-c11"><span class="MvcjwGOuIU-c0"></span></p></td></tr><tr class="MvcjwGOuIU-c72"><td class="MvcjwGOuIU-c53 MvcjwGOuIU-c75" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c21"><span class="MvcjwGOuIU-c0">1.2</span></p></td><td class="MvcjwGOuIU-c53 MvcjwGOuIU-c89" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c21"><span class="MvcjwGOuIU-c0">1994</span></p></td><td class="MvcjwGOuIU-c53 MvcjwGOuIU-c87" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c24"><span class="MvcjwGOuIU-c0">Windows NT 3.5</span></p></td><td class="MvcjwGOuIU-c53 MvcjwGOuIU-c65" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c24"><span class="MvcjwGOuIU-c0">Predefined keys</span></p></td></tr><tr class="MvcjwGOuIU-c4"><td class="MvcjwGOuIU-c63 MvcjwGOuIU-c69" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c21"><span class="MvcjwGOuIU-c0">1.3</span></p></td><td class="MvcjwGOuIU-c63 MvcjwGOuIU-c82" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c21"><span class="MvcjwGOuIU-c0">1995</span></p></td><td class="MvcjwGOuIU-c62" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c24"><span class="MvcjwGOuIU-c0">Windows NT 4.0</span></p></td><td class="MvcjwGOuIU-c63 MvcjwGOuIU-c76" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c24"><span class="MvcjwGOuIU-c0">Fast leaves</span></p></td></tr><tr class="MvcjwGOuIU-c4"><td class="MvcjwGOuIU-c67 MvcjwGOuIU-c59" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c21"><span class="MvcjwGOuIU-c0">1.4</span></p></td><td class="MvcjwGOuIU-c79 MvcjwGOuIU-c59" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c21"><span class="MvcjwGOuIU-c0">2000</span></p></td><td class="MvcjwGOuIU-c58 MvcjwGOuIU-c59" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c24"><span class="MvcjwGOuIU-c0">Windows Whistler Beta 1</span></p></td><td class="MvcjwGOuIU-c55 MvcjwGOuIU-c59" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c24"><span class="MvcjwGOuIU-c0">Big value support</span></p></td></tr><tr class="MvcjwGOuIU-c4"><td class="MvcjwGOuIU-c67 MvcjwGOuIU-c63" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c21"><span class="MvcjwGOuIU-c0">1.5</span></p></td><td class="MvcjwGOuIU-c56" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c21"><span class="MvcjwGOuIU-c0">2001</span></p></td><td class="MvcjwGOuIU-c58 MvcjwGOuIU-c63" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c24"><span class="MvcjwGOuIU-c0">Windows XP</span></p></td><td class="MvcjwGOuIU-c55 MvcjwGOuIU-c63" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c24"><span class="MvcjwGOuIU-c0">Hash leaves</span></p></td></tr><tr class="MvcjwGOuIU-c81"><td class="MvcjwGOuIU-c67 MvcjwGOuIU-c63" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c21"><span class="MvcjwGOuIU-c0">1.6</span></p></td><td class="MvcjwGOuIU-c56" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c21"><span class="MvcjwGOuIU-c0">2016</span></p></td><td class="MvcjwGOuIU-c58 MvcjwGOuIU-c63" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c24"><span class="MvcjwGOuIU-c0">Windows 10 Anniversary Update</span></p></td><td class="MvcjwGOuIU-c55 MvcjwGOuIU-c63" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c24"><span class="MvcjwGOuIU-c0">Layered keys</span></p></td></tr></table>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">The later versions draw extensively on the earlier ones both conceptually and in terms of the actual implementation &ndash; there are non-trivial portions of code in Windows NT 3.1 Beta that are used to this day in the latest Windows 11. But when it comes to pure binary compatibility, versions 1.0 to 1.2 differ too much from the newer ones and have long been considered obsolete. This leaves us with versions &ge; 1.3, which are all cross-compatible and can be used freely on the current systems. Within this group, version 1.4 was an intermediate step in the development of the format, observed only in beta releases of Windows XP (codenamed Whistler). The other three are all in active use, and can be found in a default installation of Windows 10 and 11:</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p><ul style="padding: 0;" class="lst-kix_si5ikxnlj1q7-0 start"><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c15">1.3:</span><span class="MvcjwGOuIU-c0">&nbsp;encodes volatile hives (the root hive, HKLM\HARDWARE), the BCD hive (HKLM\BCD00000000), the user classes hives (HKU\&lt;SID&gt;_Classes), and some application hives (backed by settings.dat).</span></li><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c15">1.5:</span><span class="MvcjwGOuIU-c0">&nbsp;encodes a majority of the system hives in HKLM (SYSTEM, SOFTWARE, SECURITY, SAM, DRIVERS), all user hives (HKU\&lt;SID&gt;), and most application hives (backed by ActivationStore.dat).</span></li><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c15">1.6:</span><span class="MvcjwGOuIU-c0">&nbsp;encodes all differencing hives, i.e. hives used by processes running inside Application and Server Silos, mounted under \Registry\WC.</span></li></ul>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span>It is worth noting that the hive version is supposed to be indicative of the features used inside; for example, only hives with versions &ge;1.4 should use big values (values longer than 1 MiB), only hives with versions &ge;1.5 should use hash leaves, etc. However, this is not actually enforced when loading a hive, and newer features being used in older hives will work completely fine. This behavior may become a problem if any part of the registry code makes any assumptions about the structure of the hive based solely on its version. One example of such a vulnerability was </span><span class="MvcjwGOuIU-c8"><a href="https://project-zero.issues.chromium.org/issues/42451465">CVE-2022-38037</a></span><span class="MvcjwGOuIU-c0">, caused by the fact that the CmpSplitLeaf kernel function determined the format of a subkey list based on the hive version and not the binary representation of the list itself. In general, when writing a registry-specific fuzzer, it might be a good idea to flip the minor version between 3-6 to increase the chances of hitting some interesting corner cases related to version handling.</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span>As a last note, the version number is internally converted to a single 32-bit integer stored in the _HHIVE.Version structure member using the following formula: </span><span class="MvcjwGOuIU-c22">Minor+(Major*0x1000)-0x1000</span><span class="MvcjwGOuIU-c0">. In the typical case where the major version is 1, the last two components cancel each other out, e.g. version 1.5 becomes simply &quot;5&quot;. This would be fine, if not for the fact that a major version of 0 is also allowed by HvpGetHiveHeader, in which case the minor version can be any value greater or equal to 3. Furthermore, if the kernel enters the header recovery path (because the hive header is corrupted and needs to be recovered from a .LOG file), then one can set the major/minor fields to completely arbitrary values and they will be accepted, as HvAnalyzeLogFiles doesn&#39;t perform the same strict checks that HvpGetHiveHeader does. Consequently, it becomes possible to spoof the version saved in _HHIVE.Version and have it take virtually any value in the 32-bit range, but I haven&#39;t found any security implications of this behavior, and I&#39;m sharing it simply as a curiosity.</span></p><h4 class="MvcjwGOuIU-c18 MvcjwGOuIU-c12" id="h.81bw5djzdikw"><span class="MvcjwGOuIU-c19 MvcjwGOuIU-c17">RootCell</span></h4>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">This is the cell index (offset in the hive file) of the root key, which marks a starting point for the Configuration Manager to parse the hive tree. The root cell is special in many respects: it is the only one in a hive that doesn&#39;t have a parent, it cannot be deleted or renamed, its name is unused (it is instead referenced by the name of its mount point), and its security descriptor is treated as the head of the security descriptor linked list. While the RootCell member itself has not been directly involved in any bugs I am aware of, it is worth keeping its special properties in mind when doing registry security research.</span></p><h4 class="MvcjwGOuIU-c18 MvcjwGOuIU-c12" id="h.ya5jqounbowf"><span class="MvcjwGOuIU-c19 MvcjwGOuIU-c17">Length</span></h4>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">Specifies the cumulative size of all bins in the hive, i.e. its file size minus 4096 (the size of the header). It is limited to 0x7FFFE000, which reflects the ~2 GiB capacity of the hive stable storage (the part of the hive that resides on disk). Combined with another ~2 GiB of volatile space (in-memory hive data that gets erased on reboot), we get a total maximum size of around 4 GiB when both types of storage space are completely maxed out. Incidentally, that&#39;s the same range as a single 32-bit cell index can address.</span></p><h4 class="MvcjwGOuIU-c18 MvcjwGOuIU-c12" id="h.c3a4a2cpx36f"><span class="MvcjwGOuIU-c19 MvcjwGOuIU-c17">Flags</span></h4>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span>There are currently only two supported hive flags: 0x1, which indicates whether there are any pending transactions involving the hive, and 0x2, which expresses whether the hive is </span><span class="MvcjwGOuIU-c10">differencing</span><span class="MvcjwGOuIU-c0">&nbsp;and contains layered keys or not. The latter flag is typically set when the hive version is 1.6.</span></p><h4 class="MvcjwGOuIU-c18 MvcjwGOuIU-c12" id="h.15r83x5qhryb"><span class="MvcjwGOuIU-c19 MvcjwGOuIU-c17">LastReorganizeTime</span></h4>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span>In order to address the problem of accumulating fragmentation over time, Windows 8.1 introduced a new mechanism to both shrink and optimize hives during load called </span><span class="MvcjwGOuIU-c10">reorganization</span><span class="MvcjwGOuIU-c0">. It happens automatically if the last reorganization took place more than seven days ago and the fragmentation rate of the hive is greater than 1 MiB. Reorganization achieves its goals by starting off with an empty hive and copying all existing keys recursively, taking into account which ones have been used during boot, during system runtime, and not at all since the last reorganization. The end result is that the hive becomes more packed, thanks to the elimination of free cells taking up unnecessary space, and more efficient to operate on, because the &quot;hot&quot; keys are grouped closer together.</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">As the name suggests, the LastReorganizeTime member stores the timestamp of the last time a successful reorganization took place. From an attacker&#39;s perspective, it can be adjusted to control the behavior of the internal CmpReorganizeHive function and deterministically trigger the reorganization or skip it, depending on the desired end result. In addition to indicating a timestamp, the LastReorganizeTime field may also be equal to one of two special marker values: 0x1 to have the hive unconditionally reorganized on the next load, and 0x2 to clear the access bits on all the keys in the hive, i.e. reset the key usage information that has been collected so far.</span></p><h4 class="MvcjwGOuIU-c18 MvcjwGOuIU-c12" id="h.uxpkiftvp4qy"><span class="MvcjwGOuIU-c19 MvcjwGOuIU-c17">CheckSum</span></h4>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">The CheckSum field at offset 0x1FC stores the checksum of the first 508 bytes of the header (i.e. all data prior to this field), and is simply a 32-bit XOR of the header data treated as a series of 127 consecutive DWORDs. If the computed value is equal to 0xFFFFFFFF (-1), then the checksum is set to 0xFFFFFFFE (-2), and if the computed value is 0x0, then the checksum is 0x1. This means that 0 (all bits clear) and -1 (all bits set) are never valid checksum values. If you wish to examine the kernel implementation of the algorithm, you can find it in the internal HvpHeaderCheckSum function.</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">The checksum is particularly important when making changes to existing hives, either for experimentation or during fuzzing. If any data within the first 508 bytes of the file is modified, the checksum needs to be adjusted accordingly. Otherwise, the system will reject the file early in the loading process with the STATUS_REGISTRY_CORRUPT error code, and none of the deeper code paths will be exercised. Therefore, fixing up the checksum is the bare minimum a hive fuzzer should do to maximize its chances of success.</span></p><h4 class="MvcjwGOuIU-c18 MvcjwGOuIU-c12" id="h.a53oehli1bab"><span class="MvcjwGOuIU-c19 MvcjwGOuIU-c17">Other fields</span></h4>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span>There are several other pieces of information in the header that carry some value, more so in the context of digital forensics and incident response than strictly low-level system security. For example, &quot;Signature&quot; identifies the file as a regf hive and may make it easier to identify the format in raw memory/disk dumps, while &quot;TimeStamp&quot; indicates the last time the hive has been written to, which can be critical for establishing a timeline of events during an investigation. Furthermore, the </span><span class="MvcjwGOuIU-c8"><a href="https://learn.microsoft.com/en-us/windows/win32/devnotes/offline-registry-library-portal">Offline Registry Library</a></span><span class="MvcjwGOuIU-c0">&nbsp;(offreg.dll) leaves further traces in the generated hive files: a 4-byte &quot;OfRg&quot; identifier at offset 0xB0 (nominally the Reserved1 field) and a serialization timestamp at offset 0x200 (nominally Reserved2). For more information about the meaning and usefulness of each part of the header, please refer to one of the unofficial format specifications.</span></p><h3 class="MvcjwGOuIU-c57 MvcjwGOuIU-c12" id="h.1ct9gr1fo2i7"><span class="MvcjwGOuIU-c54 MvcjwGOuIU-c17">Bins</span></h3>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">Bins in registry hives are a simple organizational concept used to split a potentially large hive into smaller chunks that can be mapped in memory independently of each other. Each of them starts with a 32-byte _HBIN structure:</span></p>
 <p class="MvcjwGOuIU-c5 MvcjwGOuIU-c11"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c5"><span></span><span class="MvcjwGOuIU-c1">0:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">kd&gt;</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">dt</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">_HBIN</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1">nt!_HBIN</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x000</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Signature</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Uint4B</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x004</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">FileOffset</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Uint4B</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x008</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Size</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Uint4B</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x00c</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Reserved1</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">[2]</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Uint4B</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x014</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">TimeStamp</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">_LARGE_INTEGER</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x01c</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Spare</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Uint4B</span></p>
 <br/>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">The four meaningful fields here are the four-byte signature (&quot;hbin&quot;), offset of the bin in the file, size of the bin, and a timestamp. Among them, the signature is a constant, the file size is sanitized early in the hive process and effectively also a constant, and the timestamp is not security-relevant. This leaves us with the size as the most interesting part of the header. The only constraints for it is that it must be a multiple of 0x1000, and the sum of the offset and size must not exceed the total length of the hive (_HBASE_BLOCK.Length). At runtime, bins are allocated as the smallest 4 KiB-aligned regions that fit a cell of the requested size, so in practice, they typically end up being between 4-16 KiB in size, but they may organically be as long as 1 MiB. While longer bins cannot be produced by the Windows kernel, there is nothing preventing a specially crafted hive from being loaded in the system with a bin of ~2 GiB in size, the maximum length of a hive as a whole. This behavior doesn&#39;t seem to have any direct security implications, but more generally, it is a great example of how the hive states written by Windows are a strictly smaller subset of the set of states accepted as valid during loading:</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgYqh3EsSpb1OQE4B1Z9wJu72kGwf9ucWfyBv7Ydmo3lvQcR9-IGjcLYjeCl4AcC_8Ng9gsCCXKs6gtDparNcaqGlDfuZqkS5OEpkAWqhCwwPpTTLcCi5oi-BsBnzHGAzh_Q4pkzjCrauCEHvz9y1f-6KVaFdVZyp_D58CZIVy8ZL13Uv5LRj7Jytc_qao/s720/image14.png" style="display: block; padding: 1em 0;text-align: center;"><img alt="Image showing that the states written by the kernel are a subset of states accepted by the hive loader" border="0" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgYqh3EsSpb1OQE4B1Z9wJu72kGwf9ucWfyBv7Ydmo3lvQcR9-IGjcLYjeCl4AcC_8Ng9gsCCXKs6gtDparNcaqGlDfuZqkS5OEpkAWqhCwwPpTTLcCi5oi-BsBnzHGAzh_Q4pkzjCrauCEHvz9y1f-6KVaFdVZyp_D58CZIVy8ZL13Uv5LRj7Jytc_qao/s720/image14.png" style="max-height: 750px; max-width: 600px;" title="Image showing that the states written by the kernel are a subset of states accepted by the hive loader" width="50%" /></a></span></p>
 <h3 class="MvcjwGOuIU-c57 MvcjwGOuIU-c12" id="h.yfgt6zsua46j"><span class="MvcjwGOuIU-c54 MvcjwGOuIU-c17">Cells</span></h3>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">Cells are the smallest unit of data in registry hives &ndash; they&#39;re continuous buffers of arbitrary lengths. They do not have a dedicated header structure like _HBASE_BLOCK or _HBIN, but instead, each cell simply consists of a signed 32-bit size marker followed by the cell&#39;s data. The size field is subject to the following constraints:</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p><ul style="padding: 0;" class="lst-kix_w06aeeqvjm56-0 start"><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c0">A cell may be in one of two states &ndash; allocated and free &ndash; as indicated by the sign of the size value. Positive values are used for free cells, and negative ones for allocated cells.</span></li><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c0">The size value accounts for the four bytes occupied by itself.</span></li><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c0">The size value must be a multiple of 8 (i.e. have its three lowest bits set to zero). If a cell with size non-divisible by 8 is allocated at runtime, it is aligned up to the next multiple of 8, potentially leading to some unused padding bytes at the end of the cell.</span></li><li style="margin-left: 46pt;" class="c2 c12 c16 li-bullet-0"><span class="MvcjwGOuIU-c0">The sum of all consecutive cells in a bin must be equal to the length of the bin. In other words, the bin header followed by tightly packed cells (with no gaps) completely fill the bin space. If the hive loader detects that this is not the case, it forcefully fixes it by creating a single free cell spanning from the failing point up to the end of the bin. This invariant must subsequently hold for the entire time the hive is loaded in the system.</span></li></ul>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">If cells remind you of heap allocations requested via malloc or HeapAlloc, it is not just your impression. There are many parallels to be drawn between hive cells and heap buffers: both can be allocated and freed, have arbitrary sizes and store a mixture of well-formatted structures and free-form user data. However, there are some significant differences too: heap implementations have evolved to include anti-exploitation mitigations like layout randomization, heap cookies for metadata protection, double-free detection and miscellaneous other consistency checks. On the other hand, hives have none of that: the allocation logic is fully deterministic and doesn&#39;t involve any randomness, there is no metadata protection, and generally little to no runtime checks. This is likely caused by the fact that heap chunks have been targets of memory corruption for many decades, whereas the registry was designed with the assumption that once loaded, the hive structure is always internally consistent and intra-hive memory corruption may never occur. This makes the exploitation of certain registry bugs particularly convenient and reliable, as I will demonstrate in future blog posts.</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span>Like a typical memory allocator interface, cells have </span><span class="MvcjwGOuIU-c10">alloc</span><span>, </span><span class="MvcjwGOuIU-c10">realloc</span><span>, and </span><span class="MvcjwGOuIU-c10">free</span><span>&nbsp;functions. Specifically, the internal routines responsible for these tasks in the Windows kernel are </span><span class="MvcjwGOuIU-c15">HvAllocateCell</span><span>, </span><span class="MvcjwGOuIU-c15">HvReallocateCell </span><span>and </span><span class="MvcjwGOuIU-c15">HvFreeCell</span><span>, and reverse-engineering them allowed me to uncover some helpful insights. For instance, I have found that HvAllocateCell and HvReallocateCell reject allocation sizes larger than 1 MiB, and for requests above 16 KiB, they round the size up to the next power of two. Meanwhile, HvFreeCell performs coalescing of free cells, so there should never be two adjacent free cells in an organically created hive. These are some further examples of behavior that is guaranteed </span><span class="MvcjwGOuIU-c10">on output</span><span>, but not enforced </span><span class="MvcjwGOuIU-c10">on input</span><span>. This is a prevalent pattern in the Windows registry, and I found it useful to keep track of such primitives in my research, even if they didn&#39;t seem particularly useful at the time. Thanks to this, I have discovered at least three security bugs closely related to this phenomenon, including one in the interactions between HvReallocateCell and its callers (</span><span class="MvcjwGOuIU-c8"><a href="https://project-zero.issues.chromium.org/issues/42451463">CVE-2022-37988</a></span><span>).</span></p><h3 class="MvcjwGOuIU-c57 MvcjwGOuIU-c12" id="h.reg0gy58lqpa"><span class="MvcjwGOuIU-c54 MvcjwGOuIU-c17">Cell indexes</span></h3>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">If we equate cells to heap buffers in user-mode applications, then cell indexes would be pointers. Cells rely on these indexes to interrelate within the registry&#39;s complex structure. For example, keys reference security descriptors (to control access), their parent key (to navigate the hierarchy), and optionally the list of subkeys and list of values (to organize data). The list of values references specific value records, which in turn reference the actual data backing cells, and so on. This intricate web of relationships is no different from any semi-complex object in a C/C++ program, where pointers link various data structures.</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">On disk, cell indexes are nothing special: they are simply 32-bit offsets from the start of the hive data (after the 0x1000 byte header), which is a typical way of implementing cross-object references in most file formats. However, it&#39;s important to note that a cell index must point to the beginning of a cell (not inside it or in the bin header), and the cell must be in the allocated state &ndash; otherwise, the index is considered invalid. So when implementing a read-only regf parser operating on the hive as a contiguous memory block, translating cell indexes is as simple as adding them to the starting address of the hive in memory.</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span>When a hive is loaded in Windows, the management of cell indexes becomes more complex. Hives at rest have a maximum size of 2 GiB, and all of their data is considered stable (persistently stored). On the other hand, an active hive also gains an additional 2 GiB of volatile storage, used for temporary keys and values that reside only in memory. These temporary entries exist only while the hive is loaded (or until the system is shut down) and can be created by calling </span><span class="MvcjwGOuIU-c8"><a href="https://learn.microsoft.com/en-us/windows/win32/api/winreg/nf-winreg-regcreatekeyexw">RegCreateKeyEx</a></span><span>&nbsp;with the </span><span class="MvcjwGOuIU-c8"><a href="https://learn.microsoft.com/en-us/windows/win32/api/winreg/nf-winreg-regcreatekeyexw%23reg_option_volatile">REG_OPTION_VOLATILE</a></span><span>&nbsp;flag, which designates the key as temporary. To distinguish between these two storage spaces in a cell index, the highest bit serves as an indicator: 0x0 for stable space and 0x1 for the volatile one, resulting in large index values (greater than 0x80000000) that readily identify volatile cells.</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span>But an even bigger complication stems from the fact that hives can shrink and grow at runtime, so it is largely impractical to have them mapped as a single block of memory. To efficiently handle modifications to the registry, Windows maps hives in smaller chunks, which makes the previous method of translating cell indexes obsolete, and necessitates a more sophisticated solution. The answer to the problem are </span><span class="MvcjwGOuIU-c10">cell maps</span><span>&nbsp;&ndash; pagetable-like structures that divide the 32-bit hive address space into smaller, nested layers, indexed by the respective 1, 10, 9, and 12-bit parts of the 32-bit cell index. Cell maps in the Windows kernel utilize a hierarchical structure consisting of storage arrays, directories, tables, and leaf entries, all defined within the ntoskrnl.exe PDB symbols (the relevant structures are _DUAL, _HMAP_DIRECTORY, _HMAP_TABLE and _HMAP_ENTRY). The layout of cell indexes and cell maps is illustrated in the diagram below, based on a similar diagram in the Windows Internals book, which itself draws from Mark Russinovich&#39;s 1999 article, </span><span class="MvcjwGOuIU-c8"><a href="https://learn.microsoft.com/en-us/previous-versions//cc750583(v%3Dtechnet.10)">Inside the Registry</a></span><span class="MvcjwGOuIU-c0">:</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgCnLfjamN3weVknLoBRSdhrrgxg4incqp0IIvqzjmymKwz39z3wptwKxQYyEpW8Lj15493Nx9sdrcZype51AqDczO8_RJWZEgHNRKoWSA7CXuN70U8_SHvieNxsPbuf6k2L_z10A17wPTxcqr7TqLfAzHfmtKNgEuTRkeiJT_2NPuw5DD6DVWvw_TbSNg/s1999/image11.png" style="display: block; padding: 1em 0;text-align: center;"><img alt="Cell Index Image" border="0" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgCnLfjamN3weVknLoBRSdhrrgxg4incqp0IIvqzjmymKwz39z3wptwKxQYyEpW8Lj15493Nx9sdrcZype51AqDczO8_RJWZEgHNRKoWSA7CXuN70U8_SHvieNxsPbuf6k2L_z10A17wPTxcqr7TqLfAzHfmtKNgEuTRkeiJT_2NPuw5DD6DVWvw_TbSNg/s1200/image11.png" style="max-height: 750px; max-width: 600px;" title="Cell Index Image" /></a></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span>Cell indexes play a central role in core registry operations, such as creating, reading, updating, and deleting keys and values. The internal kernel function responsible for traversing the cell map and translating cell indexes into virtual addresses is </span><span class="MvcjwGOuIU-c15">HvpGetCellPaged</span><span class="MvcjwGOuIU-c0">. In normal conditions, the indexes stay within the bounds of the storage space size (_HHIVE.Storage[x].Length), so HvpGetCellPaged assumes their validity and doesn&#39;t perform any additional bounds checking. However, certain memory corruption vulnerabilities may allow attackers to manipulate these cell indexes at runtime. Crucially, I discovered that out-of-bounds cell indexes can serve as a powerful primitive for exploit development, enabling the construction of proof-of-concept exploits that achieve local elevation of privileges. I will elaborate further on this in future exploit-focused blog posts.</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span>As a last note, the special marker of -1 (0xFFFFFFFF) is used to represent non-existent cells, and can be found in cell indexes pointing at optional data that doesn&#39;t exist &ndash; basically a hive equivalent of a NULL pointer. The internal name for the constant in the Windows kernel is HCELL_NIL, and under normal circumstances, it should never be passed directly to HvpGetCellPaged. Doing so without guaranteeing that the cell index is valid first would constitute a bug in the Windows kernel (for example, see </span><span class="MvcjwGOuIU-c8"><a href="https://project-zero.issues.chromium.org/issues/42451589">CVE-2023-35357</a></span><span>&nbsp;or </span><span class="MvcjwGOuIU-c8"><a href="https://project-zero.issues.chromium.org/issues/42451590">CVE-2023-35358</a></span><span>).</span></p><h2 class="MvcjwGOuIU-c12 MvcjwGOuIU-c70" id="h.gwhjtxntum31"><span class="MvcjwGOuIU-c9 MvcjwGOuIU-c40">Cell types</span></h2>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span>Now that we have familiarized ourselves with the low-level structure of hives that facilitates their efficient management in memory, let&#39;s go a little further and learn about the types of information stored </span><span>in</span><span class="MvcjwGOuIU-c10">&nbsp;</span><span class="MvcjwGOuIU-c0">the cells. These are the objects that actually define the registry tree and all of its properties: keys, values, security descriptors, etc. The first subsection provides a general overview of the various cell types found within a hive and the relations between them. The second one goes into the intricate details of their format and usage within the Windows kernel, uncovering obscure implementation details rarely documented elsewhere.</span></p><h3 class="MvcjwGOuIU-c57 MvcjwGOuIU-c12" id="h.u8pc9eopt3no"><span class="MvcjwGOuIU-c54 MvcjwGOuIU-c17">Overview of cell types</span></h3>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">Registry hives utilize only seven distinct cell types to represent the various data structures within the registry, as outlined below:</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p><ol class="lst-kix_9i4egiire8k6-0 start" start="1"><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c15">Key Node:</span><span class="MvcjwGOuIU-c0">&nbsp;Represents a single registry key and its associated metadata. It is defined by the _CM_KEY_NODE structure and contains references to other cells, including its parent key, security descriptor, class data (optional), and lists of subkeys (stable and volatile) and values (optional).</span></li><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c15">Subkey Index:</span><span class="MvcjwGOuIU-c0">&nbsp;A variable-length list of key node cell indexes, representing the subkeys of a specific key. For performance reasons, there are four variations of subkey indexes: index leaf, fast leaf, hash leaf, and root index. All are represented by the _CM_KEY_INDEX structure.</span></li><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c15">Security Descriptor:</span><span>&nbsp;Defines access control information for one or more keys, specifically a security descriptor in a self-relative format. Represented by the </span><span>_CM_KEY_SECURITY</span><span>&nbsp;structure, it is the only cell type that can be referenced from multiple key nodes and is therefore reference-counted. It also contains links to the next and previous security descriptors in the hive.</span></li><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c15">Key Value:</span><span>&nbsp;Defines a single value associated with a key, including its name, type, data length, and a reference to the cell </span><span>containing the actual data. It is represented by the _CM_KEY_VALUE structure.</span></li><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c15">Big Data:</span><span>&nbsp;Used to store value data exceeding 16,344 bytes (~16 KiB) in hive versions 1.4 and later. The data is divided into chunks of up to 16 KiB each, allowing for values approaching 1 GiB. Th</span><span>e _CM_BIG_DATA structure represents this cell type, containing the number of chunks and a reference to the list of chunk cells.</span></li><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c15">Value List and Chunk List Cells:</span><span class="MvcjwGOuIU-c0">&nbsp;These cells are simple arrays of 32-bit cell indexes. They are used to store lists of values associated with a key and lists of chunks for large value data.</span></li><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c15">Data Cells:</span><span class="MvcjwGOuIU-c0">&nbsp;These cells store the raw data associated with keys and values. They hold the optional class data for a key, the complete data for small values (up to 1 MiB in older hives, ~16 KiB in newer hives), and the individual chunks of large values.</span></li></ol>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">The diagram below illustrates the relationships between these cell types:</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj9sBOCJ5Wjme99GVbzbKzraCQRVqsJmcNVPeiPTJcQ4N_PipfueQfUEsb3Sfswy0BnxXQuM9iWvq4cjc0A28rJR_Jv5XJ9g99Yszsd8zATyoszpsfWwFCV127-5eNmYAO3V5Atj_pMul6xIMwk6Cm_t6dka6Uyq3xNmCkNa4ok7laVo8kdNXUEE4w_rJc/s1999/image6.png" style="display: block; padding: 1em 0;text-align: center;"><img alt="Diagram illustrating the relationships between these cell types" border="0" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj9sBOCJ5Wjme99GVbzbKzraCQRVqsJmcNVPeiPTJcQ4N_PipfueQfUEsb3Sfswy0BnxXQuM9iWvq4cjc0A28rJR_Jv5XJ9g99Yszsd8zATyoszpsfWwFCV127-5eNmYAO3V5Atj_pMul6xIMwk6Cm_t6dka6Uyq3xNmCkNa4ok7laVo8kdNXUEE4w_rJc/s1200/image6.png" style="max-height: 750px; max-width: 600px;" title="Diagram illustrating the relationships between these cell types" /></a></span></p><h3 class="MvcjwGOuIU-c12 MvcjwGOuIU-c57" id="h.9ct0kf63yhfw"><span class="MvcjwGOuIU-c17 MvcjwGOuIU-c54">Deep dive into each cell type</span></h3>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">Now that we know the general purpose of each cell type, it&#39;s a good time to dig a little deeper into each of them. This lets us explore both their implementation details, as well as the spirit behind these objects and how they interact with each other in a real-life environment. I have tried my best to avoid repeating the existing unofficial specifications and instead only focus on the security-relevant and sparsely documented aspects of the format, but if any redundant information makes it into this section, please bear with me. &#128578;</span></p><h4 class="MvcjwGOuIU-c12 MvcjwGOuIU-c18" id="h.91eb799dfqpv"><span class="MvcjwGOuIU-c17 MvcjwGOuIU-c19">Key nodes</span></h4>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">As keys are the most important part of the registry, key nodes are the most important and complex of all cell types. When dumped in WinDbg, the layout of the _CM_KEY_NODE structure is as follows:</span></p>
 <p class="MvcjwGOuIU-c5 MvcjwGOuIU-c11"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c5"><span></span><span class="MvcjwGOuIU-c1">0:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">kd&gt;</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">dt</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">_CM_KEY_NODE</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">/r</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1">nt!_CM_KEY_NODE</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x000</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Signature</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Uint2B</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x002</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Flags</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Uint2B</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x004</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">LastWriteTime</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">_LARGE_INTEGER</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x00c</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">AccessBits</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">UChar</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x00d</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">LayerSemantics</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Pos</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">0,</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">2</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Bits</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x00d</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Spare1</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Pos</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">2,</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">5</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Bits</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x00d</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">InheritClass</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Pos</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">7,</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">1</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Bit</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x00e</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Spare2</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Uint2B</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x010</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Parent</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Uint4B</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x014</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">SubKeyCounts</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">[2]</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Uint4B</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x01c</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">SubKeyLists</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">[2]</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Uint4B</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x024</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">ValueList</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">_CHILD_LIST</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">+0x000</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Count</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Uint4B</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">+0x004</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">List</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Uint4B</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x01c</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">ChildHiveReference</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">_CM_KEY_REFERENCE</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">+0x000</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">KeyCell</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Uint4B</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">+0x008</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">KeyHive</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Ptr64</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">_HHIVE</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x02c</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Security</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Uint4B</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x030</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Class</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Uint4B</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x034</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">MaxNameLen</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Pos</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">0,</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">16</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Bits</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x034</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">UserFlags</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Pos</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">16,</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">4</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Bits</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x034</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">VirtControlFlags</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Pos</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">20,</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">4</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Bits</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x034</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Debug</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Pos</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">24,</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">8</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Bits</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x038</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">MaxClassLen</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Uint4B</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x03c</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">MaxValueNameLen</span><span class="MvcjwGOuIU-c7">&nbsp; </span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Uint4B</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x040</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">MaxValueDataLen</span><span class="MvcjwGOuIU-c7">&nbsp; </span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Uint4B</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x044</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">WorkVar</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Uint4B</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x048</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">NameLength</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Uint2B</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x04a</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">ClassLength</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Uint2B</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x04c</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Name</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">[1]</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Wchar</span></p>
 <br/>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">In the following subsections, each member is discussed in more detail.</span></p><h5 class="MvcjwGOuIU-c6" id="h.gd0w0pnn3tb7"><span class="MvcjwGOuIU-c31 MvcjwGOuIU-c36">Signature</span></h5>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">This field always stores the special value 0x6B6E, which translates to &#39;nk&#39; when written in little-endian. It exists for informational purposes only, and isn&#39;t used for anything meaningful in the code after the initial sanitization during load.</span></p><h5 class="MvcjwGOuIU-c6" id="h.j7ze5ahyvb63"><span class="MvcjwGOuIU-c31 MvcjwGOuIU-c36">Flags</span></h5>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">This is a highly interesting and security-relevant field, as it indicates the role of the key in the hive, and clarifies how certain parts of the key node are formatted. The present and historical flags are presented in the table below together with their names and descriptions:</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p><table class="MvcjwGOuIU-c28"><tr class="MvcjwGOuIU-c4"><td class="MvcjwGOuIU-c33 MvcjwGOuIU-c64" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c24"><span class="MvcjwGOuIU-c9 MvcjwGOuIU-c14">Mask</span></p></td><td class="MvcjwGOuIU-c34 MvcjwGOuIU-c64" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c24"><span class="MvcjwGOuIU-c9 MvcjwGOuIU-c14">Name</span></p></td><td class="MvcjwGOuIU-c30 MvcjwGOuIU-c64" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c24"><span class="MvcjwGOuIU-c9 MvcjwGOuIU-c14">Description</span></p></td></tr><tr class="MvcjwGOuIU-c4"><td class="MvcjwGOuIU-c33" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">0x0001</span></p></td><td class="MvcjwGOuIU-c34" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">KEY_VOLATILE</span></p></td><td class="MvcjwGOuIU-c30" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c15 MvcjwGOuIU-c10">(Deprecated)</span><span class="MvcjwGOuIU-c0">&nbsp;The flag used to indicate that the key and all its subkeys were volatile, but it is obsolete now and hasn&#39;t been used in several decades. Information about the key stable/volatile state can be inferred from the highest bit of the key&#39;s cell index.</span></p></td></tr><tr class="MvcjwGOuIU-c4"><td class="MvcjwGOuIU-c33" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">0x0002</span></p></td><td class="MvcjwGOuIU-c34" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">KEY_HIVE_EXIT</span></p></td><td class="MvcjwGOuIU-c30" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">Indicates that the key is the mount point of another registry hive. These special mount points are used to facilitate attaching new registry hives to the global registry view starting at \Registry in a live system. Exit nodes only ever exist in memory, so hives on disk mustn&#39;t have the flag set. More on the subject of mount points and exit nodes can be found in the next section, &quot;Link nodes&quot;.</span></p></td></tr><tr class="MvcjwGOuIU-c4"><td class="MvcjwGOuIU-c33" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">0x0004</span></p></td><td class="MvcjwGOuIU-c34" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">KEY_HIVE_ENTRY</span></p></td><td class="MvcjwGOuIU-c30" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span>Indicates that the given key is the </span><span class="MvcjwGOuIU-c10">entry</span><span class="MvcjwGOuIU-c0">&nbsp;to a hive, or in other words, the root of a hive. The flag must be set on the root key of each hive, and mustn&#39;t be set on any other nested keys. A hive entry key cannot be a symbolic link (KEY_SYM_LINK mustn&#39;t be set).</span></p></td></tr><tr class="MvcjwGOuIU-c4"><td class="MvcjwGOuIU-c33" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">0x0008</span></p></td><td class="MvcjwGOuIU-c34" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">KEY_NO_DELETE</span></p></td><td class="MvcjwGOuIU-c30" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">Indicates that the key cannot be deleted: any attempt to do so will return the error code STATUS_CANNOT_DELETE. This flag is always set on hive exit and hive entry keys, but is not allowed for any other keys.</span></p></td></tr><tr class="MvcjwGOuIU-c4"><td class="MvcjwGOuIU-c33" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">0x0010</span></p></td><td class="MvcjwGOuIU-c34" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">KEY_SYM_LINK</span></p></td><td class="MvcjwGOuIU-c30" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span>Indicates that the key is a symbolic link, which has been created by specifying the REG_OPTION_CREATE_LINK flag in the </span><span class="MvcjwGOuIU-c8"><a href="https://learn.microsoft.com/en-us/windows/win32/api/winreg/nf-winreg-regcreatekeyexw">RegCreateKeyEx</a></span><span class="MvcjwGOuIU-c0">&nbsp;call. They are freely accessible and don&#39;t come with many restrictions: every key other than a hive exit/entry key can be a symbolic link. However, they are required to adhere to additional structural requirements: they may only contain up to one value, and that value must be of type REG_LINK (6), named &quot;SymbolicLinkValue&quot;, and a maximum of 65534 bytes long (32767 wide characters).</span></p></td></tr><tr class="MvcjwGOuIU-c4"><td class="MvcjwGOuIU-c33" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">0x0020</span></p></td><td class="MvcjwGOuIU-c34" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">KEY_COMP_NAME</span></p></td><td class="MvcjwGOuIU-c30" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">Indicates that the name of the key consists of ASCII characters only, and thus it has been &quot;compressed&quot; to fit two 8-bit characters in each of the 16-bit wide characters of _CM_KEY_NODE.Name. This optimization aims to save storage space and memory, especially as a great majority of keys have simple, alphanumeric names. This flag can be set on virtually every key in the registry, and indeed, it is by far the most commonly used one.</span></p></td></tr><tr class="MvcjwGOuIU-c4"><td class="MvcjwGOuIU-c33" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">0x0040</span></p></td><td class="MvcjwGOuIU-c34" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">KEY_PREDEF_HANDLE</span></p></td><td class="MvcjwGOuIU-c30" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c15 MvcjwGOuIU-c10">(Deprecated)</span><span>&nbsp;The flag used to indicate that the key was a &quot;predefined-handle key&quot;, which was a special kind of a symbolic link. The name refers to </span><span class="MvcjwGOuIU-c8"><a href="https://learn.microsoft.com/en-us/windows/win32/sysinfo/predefined-keys">Predefined Keys</a></span><span>, a set of top-level keys such as HKLM or HKCU recognized by the Win32 API. Keys with the KEY_PREDEF_HANDLE flag set allowed the system to redirect certain keys to chosen 32-bit HKEY pseudo-handles, and were specifically introduced in Windows NT 3.5 in 1994 for the purpose of redirecting two system keys related to </span><span class="MvcjwGOuIU-c8"><a href="https://learn.microsoft.com/en-us/windows/win32/perfctrs/using-the-registry-functions-to-consume-counter-data">reading performance data through the registry</a></span><span class="MvcjwGOuIU-c0">:</span></p><ul style="padding: 0;" class="lst-kix_88bs2bqozfm2-0 start"><li style="margin-left: 46pt;" class="c2 c16 li-bullet-0"><span class="MvcjwGOuIU-c0">HKLM\Software\Microsoft\Windows NT\CurrentVersion\Perflib\009 &rarr; HKEY_PERFORMANCE_TEXT</span></li><li style="margin-left: 46pt;" class="c2 c16 li-bullet-0"><span class="MvcjwGOuIU-c0">HKLM\Software\Microsoft\Windows NT\CurrentVersion\Perflib\CurrentLanguage &rarr; HKEY_PERFORMANCE_NLSTEXT</span></li></ul>
 <p class="MvcjwGOuIU-c2"><span>Contrary to regular symbolic links, predefined keys re-purposed parts of the key node structure (specifically the value list length) to store the link destination, instead of using higher-level features of the format (such as the &quot;SymbolicLinkValue&quot; which is otherwise a perfectly normal value associated with a key). Such a change in semantics required a significant amount of special handling of predefined keys, which were not supposed to be operated on other than being opened. This, in turn, led to a number of security vulnerabilities related to the feature. For a detailed case study of one of them, CVE-2023-35633, see my </span><span class="MvcjwGOuIU-c8"><a href="https://j00ru.vexillium.org/talks/confidence-windows-registry-deja-vu-the-return-of-confused-deputies/">Windows Registry Deja Vu: The Return of Confused Deputies</a></span><span class="MvcjwGOuIU-c0">&nbsp;talk from CONFidence 2024.</span></p>
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">As recently as 2023, all keys other than hive roots could be predefined keys, provided that they had been manually crafted in a binary controlled hive, because there was otherwise no supported way to create them via API. As a consequence of my reports, the feature was deprecated completely in July 2023 for Windows 10 1607+ and 11, and in December 2023 for older systems. At the time of this writing, the only two predefined keys left in existence are the original &quot;009&quot; and &quot;CurrentLanguage&quot; ones, and all other such keys are transparently converted to normal keys during hive load.</span></p></td></tr></table>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span>Furthermore, there are also three flags related to </span><span class="MvcjwGOuIU-c8"><a href="https://learn.microsoft.com/en-us/windows/win32/sysinfo/registry-virtualization">Registry Virtualization</a></span><span class="MvcjwGOuIU-c0">, which was introduced in Windows Vista and is supported up to and including Windows 11:</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p><table class="MvcjwGOuIU-c28"><tr class="MvcjwGOuIU-c4"><td class="MvcjwGOuIU-c33 MvcjwGOuIU-c64" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c24"><span class="MvcjwGOuIU-c9 MvcjwGOuIU-c14">Mask</span></p></td><td class="MvcjwGOuIU-c34 MvcjwGOuIU-c64" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c24"><span class="MvcjwGOuIU-c9 MvcjwGOuIU-c14">Name</span></p></td><td class="MvcjwGOuIU-c30 MvcjwGOuIU-c64" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c24"><span class="MvcjwGOuIU-c9 MvcjwGOuIU-c14">Description</span></p></td></tr><tr class="MvcjwGOuIU-c4"><td class="MvcjwGOuIU-c33" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">0x0080</span></p></td><td class="MvcjwGOuIU-c34" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">VirtualSource</span></p></td><td class="MvcjwGOuIU-c30" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">Indicates that the key has been subject to virtualization, i.e. that it has a counterpart in the virtual store subtree. It is typically set on keys inside HKLM\Software which have been attempted to be opened with write access by a program running as a non-administrator.</span></p></td></tr><tr class="MvcjwGOuIU-c4"><td class="MvcjwGOuIU-c33" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">0x0100</span></p></td><td class="MvcjwGOuIU-c34" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">VirtualTarget</span></p></td><td class="MvcjwGOuIU-c30" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">Indicates that the key is a virtual replica of a key in a global system hive that has been subject to virtualization. It is typically set on keys inside HKU\&lt;SID&gt;_Classes\VirtualStore that have been created as a result of virtualization. It can only be set if VirtualStore (0x200) is set on the key, too.</span></p></td></tr><tr class="MvcjwGOuIU-c4"><td class="MvcjwGOuIU-c33" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">0x0200</span></p></td><td class="MvcjwGOuIU-c34" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">VirtualStore</span></p></td><td class="MvcjwGOuIU-c30" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span>Indicates that the key is part of the virtual store registry subtree, typically HKU\&lt;SID&gt;_Classes\VirtualStore and its subkeys. It means that new virtualization targets may be created inside the key, but it itself isn&#39;t necessarily a virtual key (unless the VirtualTarget flag is also set</span><span class="MvcjwGOuIU-c0">).</span></p></td></tr></table>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span>As we can see, the purpose of these flags is to keep track of the virtualization state of each key. Given that they express the internal state</span><span>&nbsp;of the key and are intended to be modified by the kernel only, there doesn&#39;t seem to be a good reason to allow user-mode clients to modify the flags on demand. But in practice, unprivileged users have a lot of control over them: programs may arbitrarily set them in hives loaded from disk that they control (app hives and the user hive), and they may also set and clear them at runtime with the NtSetInformationKey(KeySetVirtualizationInformation) system call, as long as they are granted KEY_SET_VALUE access to the key. This makes it effectively possible to &quot;spoof&quot; virtual source/target/store keys, and opens up all of the registry virtualization code for potential abuse by unprivileged users. This has led to the discovery of multiple bugs directly related to virtualization: </span><span class="MvcjwGOuIU-c8"><a href="https://project-zero.issues.chromium.org/issues/42451263">CVE-2015-0073</a></span><span>&nbsp;and </span><span class="MvcjwGOuIU-c8"><a href="https://project-zero.issues.chromium.org/issues/42450862">CVE-2019-0881</a></span><span>&nbsp;by James Forshaw, and </span><span class="MvcjwGOuIU-c8"><a href="https://project-zero.issues.chromium.org/issues?q%3Did:(42451475%2520%257C%252042451502%2520%257C%252042451512%2520%257C%252042451515%2520%257C%252042451516%2520%257C%252042451527%2520%257C%252042451589%2520%257C%252042451627)">several more</a></span><span>&nbsp;as part of my recent research.</span></p><h5 class="MvcjwGOuIU-c6" id="h.xyaluvd02svg"><span class="MvcjwGOuIU-c31 MvcjwGOuIU-c36">LastWriteTime</span></h5>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span>This is yet another timestamp, in this case tracked on a key-granularity level. I assume it may be an interesting artifact for purposes of digital forensics, but otherwise it doesn&#39;t seem particularly security-relevant. One thing of note is that this information is very easy to query at runtime, as it is returned by the </span><span class="MvcjwGOuIU-c8"><a href="https://learn.microsoft.com/en-us/windows/win32/api/winreg/nf-winreg-regqueryinfokeyw">RegQueryInfoKey</a></span><span>&nbsp;API, and is also a part of the output structures of numerous </span><span class="MvcjwGOuIU-c8"><a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/wdm/ne-wdm-_key_information_class">key information classes</a></span><span class="MvcjwGOuIU-c0">&nbsp;that can be queried via the NtQueryKey system call.</span></p><h5 class="MvcjwGOuIU-c6" id="h.z38qve8esj1q"><span class="MvcjwGOuIU-c31 MvcjwGOuIU-c36">AccessBits</span></h5>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span>While theoretically an 8-bit field, this is effectively a 2-bit bitmask introduced in Windows 8 as part of the </span><span class="MvcjwGOuIU-c10">hive reorganization</span><span class="MvcjwGOuIU-c0">&nbsp;logic described earlier. It tracks the system phase(s) in which the key has been accessed: 0x0 if not accessed at all, 0x1 if accessed during boot, and 0x2 if accessed during normal system operation. This information is then used during reorganization to allocate key nodes with similar access bits close together.</span></p><h5 class="MvcjwGOuIU-c6" id="h.erwac4a7wmu8"><span class="MvcjwGOuIU-c31 MvcjwGOuIU-c36">LayerSemantics</span></h5>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span>This member is a 2-bit enum, used exclusively in hive version 1.6, which corresponds to </span><span class="MvcjwGOuIU-c10">differencing hives</span><span>&nbsp;(also known as </span><span class="MvcjwGOuIU-c10">delta hives</span><span class="MvcjwGOuIU-c0">). Differencing hives are closely related to containerization support, and their purpose is to be overlaid on another hive in the system rather than being mounted as a standalone hive. For this reason, every key in a differencing hive is in one of four states, which indicate how the key should be interpreted in relation to the keys below it (i.e. the corresponding keys in lower-layer hives).</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">These four states are:</span></p><ul style="padding: 0;" class="lst-kix_gvci0hu7yb6k-0 start"><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span>Merge-Backed (0): the properties of the key are meant to be </span><span class="MvcjwGOuIU-c10">merged</span><span class="MvcjwGOuIU-c0">&nbsp;with the properties of the underlying keys in the key stack.</span></li><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c0">Tombstone (1): the key is deleted at the current level, so none of the keys below it should be considered.</span></li><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c0">Supersede-Local (2): the properties of the key fully supersede any state in the key stack below it: only values associated with that level (and any upper layers) are visible to the user.</span></li><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span>Supersede-Tree (3): same as Supersede-Local, but it applies to the key itself </span><span class="MvcjwGOuIU-c15">and</span><span class="MvcjwGOuIU-c0">&nbsp;recursively to all of its subkeys.</span></li></ul>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span>There is also an additional, implicit state called Merge-Unbacked, used to describe keys that don&#39;t exist in a hive at a given level, and so they simply </span><span class="MvcjwGOuIU-c10">fall through</span><span>&nbsp;to the state represented by keys in the lower layers. Overall, layer semantics play a crucial role in the functionality of layered keys and differencing hives, and their correct handling in the registry implementation is paramount to system security and stability. Unfortunately, the feature is too complex to thoroughly discuss here, but there are some excellent resources on the subject: Microsoft&#39;s </span><span class="MvcjwGOuIU-c8"><a href="https://patents.google.com/patent/US20170279678A1/en">Containerized Configuration</a></span><span>&nbsp;(US20170279678A1) patent, Maxim Suhanov&#39;s </span><span class="MvcjwGOuIU-c8"><a href="https://dfir.ru/2020/08/15/containerized-registry-hives-in-windows/">Containerized registry hives in Windows</a></span><span>&nbsp;blog post, and the &quot;Registry virtualization&quot; section in Chapter 10 of the </span><span>Windows Internals 7 (Part 2) book.</span></p><h5 class="MvcjwGOuIU-c6" id="h.rwwt0whi7zk"><span class="MvcjwGOuIU-c31 MvcjwGOuIU-c36">InheritClass</span></h5>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">This bit is also related to layered keys, and it indicates whether the key inherits the class value from its counterparts lower in the key stack, or defines its own (or lack thereof).</span></p><h5 class="MvcjwGOuIU-c6" id="h.mhrruzem097e"><span class="MvcjwGOuIU-c31 MvcjwGOuIU-c36">Parent</span></h5>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span>The field identifies the key node that acts as this key&#39;s parent within the registry&#39;s hierarchical structure. Except for root keys, which exist at the topmost level of a hive, every key must have a valid Parent field. This index plays a vital role in navigating the registry and modifying key relationships. For example, it&#39;s essential for determining a key&#39;s full path or ensuring correct alphabetical order when renaming a key within its parent&#39;s subkey list.</span></p><h5 class="MvcjwGOuIU-c6" id="h.uzk1l7jt1mqd"><span class="MvcjwGOuIU-c31 MvcjwGOuIU-c36">SubKeyCounts</span></h5>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">This two-element array of DWORDs stores the number of the key&#39;s stable and volatile subkeys, respectively. Even though the integers are 32 bits wide, the actual number of subkeys is limited by the upper bound of all keys in a hive in a specific storage space, which is roughly 2 GiB (storage space size) &divide; 84 bytes (minimum key node size) &asymp; 25.5 million keys.</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span>The data in this field is somewhat redundant, as the same information is also stored in the subkey indexes themselves. Nevertheless, the cached numbers stored directly in the key node make it possible to efficiently query the numbers of subkeys with API such as </span><span class="MvcjwGOuIU-c8"><a href="https://learn.microsoft.com/en-us/windows/win32/api/winreg/nf-winreg-regqueryinfokeya">RegQueryInfoKey</a></span><span class="MvcjwGOuIU-c0">. The kernel does its best to keep the two copies of the information in sync, and any discrepancies between them may lead to memory corruption vulnerabilities.</span></p><h5 class="MvcjwGOuIU-c6" id="h.4ye7pxjg5ush"><span class="MvcjwGOuIU-c31 MvcjwGOuIU-c36">SubKeyLists</span></h5>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">This is another two-element array, which complements the previous SubKeyCounts member by providing cell indexes to the corresponding subkey lists for each storage type. The format of these lists is discussed in detail in the &quot;Subkey indexes&quot; section below; for now, it&#39;s only important to know that if SubKeyCounts[x] &gt; 0, then SubKeyLists[x] is expected to be a valid cell index, otherwise it should be equal to HCELL_NIL (-1). Furthermore, because the volatile space is a strictly in-memory concept that doesn&#39;t exist on disk, newly loaded hives are always expected to have SubKeyCounts[1] set to 0 and SubKeyLists[1] set to HCELL_NIL.</span></p><h5 class="MvcjwGOuIU-c6" id="h.mrpnk6kgjhx"><span class="MvcjwGOuIU-c31 MvcjwGOuIU-c36">ValueList</span></h5>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">This is a structure of type _CHILD_LIST, which consists of two 32-bit integers: the number of values associated with the key, and a cell index of the actual value list. Here, there is no distinction between stable and volatile values: for any given key, the values always inherit the storage type of the key, so either all of them are stable, or all of them are volatile. Similarly to subkey lists, though, if ValueList.Count is 0, then ValueList.List must be HCELL_NIL.</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">As mentioned earlier, this field also had a second meaning if the key was a predefined key: in that case, ValueList.Count contained an arbitrary value with the highest bit set, which indicated the top-level HKEY to redirect to, and ValueList.List was completely unused and could contain arbitrary data. As you can imagine, whenever an internal system function started to use such a value list with the assumption it was a normal key, it would operate on an inadequately huge count and an invalid cell index, wrecking havoc in the kernel. Thankfully, this is no longer a possibility due to the deprecation of predefined keys in 2023.</span></p><h5 class="MvcjwGOuIU-c6" id="h.899fhvgzgrpu"><span class="MvcjwGOuIU-c31 MvcjwGOuIU-c36">ChildHiveReference</span></h5>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span>You may have noticed that ChildHiveReference is part of a union, as it resides at the same offset as the SubKeyLists member (offset 0x1C). It is a special object that is used to implement hive mounting under the \Registry tree, and is unique to keys that have the KEY_HIVE_EXIT flag set (i.e. exit nodes). It is only ever used in memory, and is therefore not applicable to regular hives stored on disk. Its two fields specify the root key of the mounted hive, as a pair of a kernel pointer to the _HHIVE descriptor structure and the cell index of the root key. This breaks the fundamental invariant that hives are self contained and don&#39;t store any virtual address pointers, only cell indexes. It is the only exception to the rule, and only because it is a necessary hack/workaround to implement a feature that </span><span>hives</span><span class="MvcjwGOuIU-c0">&nbsp;normally don&#39;t support: attaching one hive to another in the global system view. </span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">The field and its usage are discussed in more detail in the &quot;Link nodes&quot; section below.</span></p><h5 class="MvcjwGOuIU-c6" id="h.3j72imy8jww5"><span class="MvcjwGOuIU-c31 MvcjwGOuIU-c36">Security</span></h5>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">This is the cell index of the security descriptor cell corresponding to the key. It is a mandatory field for every type of key in the registry (symbolic links, previously predefined keys etc.), with the only exception being system-managed exit nodes. For every key that has an invalid security descriptor during hive load (e.g. set to HCELL_NIL or just an invalid cell index), it is automatically fixed up to inherit the security descriptor of its parent key. If the root key of a hive has invalid security, the whole hive is rejected with the STATUS_REGISTRY_CORRUPT error code.</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">The security descriptor cell always has the same storage type as the key(s) that it is associated with. So for example, if there are two keys in a hive with the same security properties, one in the stable and the other in the volatile space, then they will reference two different stable/volatile security cells with equivalent data.</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span>For obvious reasons, the correct handling of this field is crucial to overall system security. In the course of my research, I have discovered </span><span class="MvcjwGOuIU-c8"><a href="https://project-zero.issues.chromium.org/issues?q%3Did:(42451423%2520%257C%252042451425%2520%257C%252042451427%2520%257C%252042451516%2520%257C%252042451552%2520%257C%252042451596%2520%257C%252042451592%2520%257C%252042451601%2520%257C%252042451625)">9 vulnerabilities</a></span><span>&nbsp;directly involving the handling of security descriptors, and a further 4 reported to Microsoft outside of the tracker (WinRegLowSeverityBugs </span><span class="MvcjwGOuIU-c8"><a href="https://github.com/googleprojectzero/p0tools/tree/master/WinRegLowSeverityBugs/Reports/01_Key_node_Security_OOB_read">#1</a></span><span>, </span><span class="MvcjwGOuIU-c8"><a href="https://github.com/googleprojectzero/p0tools/tree/master/WinRegLowSeverityBugs/Reports/10_CmpKeySecurityIncrementReferenceCount_zero_refcount_crash">#10</a></span><span>, </span><span class="MvcjwGOuIU-c8"><a href="https://github.com/googleprojectzero/p0tools/tree/master/WinRegLowSeverityBugs/Reports/13_CmpLightWeightPrepareSetSecDescUoW_security_list_confusion">#13</a></span><span>, </span><span class="MvcjwGOuIU-c8"><a href="https://github.com/googleprojectzero/p0tools/tree/master/WinRegLowSeverityBugs/Reports/20_App_hive_security_inconsistencies">#20</a></span><span class="MvcjwGOuIU-c0">). They generally didn&#39;t have much to do with the &nbsp;_CM_KEY_NODE.Security field specifically, but rather the formatting of the security cells and higher-level logic related to them:</span></p><ul style="padding: 0;" class="lst-kix_q9nppjnnwv68-0 start"><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c0">Binary formatting of the SECURITY_DESCRIPTOR_RELATIVE structure</span></li><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c0">Maintaining the consistency of the doubly-linked list of security descriptors in the hive</span></li><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c0">Reference counting security descriptors when operating on keys</span></li><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c0">Enforcing proper access checks when opening and creating keys</span></li></ul>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span>Overall, this is probably the most interesting field in the structure from a security research perspective.</span></p><h5 class="MvcjwGOuIU-c6" id="h.dyhqzn7btv2w"><span class="MvcjwGOuIU-c31 MvcjwGOuIU-c36">Class and ClassLength</span></h5>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span>In technical terms, a key class is an optional, immutable blob of 1-65535 bytes associated with a key. It can only be set once, during the creation of a key, through the lpClass argument of the </span><span class="MvcjwGOuIU-c8"><a href="https://learn.microsoft.com/en-us/windows/win32/api/winreg/nf-winreg-regcreatekeyexw">RegCreateKeyExW</a></span><span>&nbsp;API (or the equivalent Class parameter of the NtCreateKey system call). It can be then queried with functions such as </span><span class="MvcjwGOuIU-c8"><a href="https://learn.microsoft.com/en-us/windows/win32/api/winreg/nf-winreg-regqueryinfokeyw">RegQueryInfoKey</a></span><span class="MvcjwGOuIU-c0">, but cannot be modified without deleting and re-creating the key. If the class exists, then the ClassLength field is set accordingly, and Class is a cell index that points to its backing buffer. Otherwise, ClassLength is set to 0 and Class is HCELL_NIL (-1).</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span>Conceptually, a class can be viewed as an extra, hidden value of a key, existing alongside the normal value list. It is not displayed anywhere in the Regedit GUI, but if it exists for a given key, it can be retrieved by using the &quot;Export&quot; option in Regedit to save the key to a .txt file, which also exports the class data. It has existed since the earliest version 1.0 of the regf format &ndash; perhaps as a way to store the &quot;type&quot; of a key similar to how every value has a defined type. Today, it seems to be a mostly obsolete mechanism that doesn&#39;t see much use; even Raymond Chen wrote in his </span><span class="MvcjwGOuIU-c8"><a href="https://devblogs.microsoft.com/oldnewthing/20090204-00/?p%3D19263">What is the terminology for describing the various parts of the registry?</a></span><span class="MvcjwGOuIU-c0">&nbsp;blog in 2009:</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p><table class="MvcjwGOuIU-c28"><tr class="MvcjwGOuIU-c4"><td class="MvcjwGOuIU-c35" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c24"><span class="MvcjwGOuIU-c15">Bonus chatter</span><span>:</span><span>&nbsp;There&rsquo;s also this thing called a </span><span class="MvcjwGOuIU-c10">class</span><span class="MvcjwGOuIU-c0">. I have no idea what it&rsquo;s for, so don&rsquo;t ask.</span></p></td></tr></table>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">When I ran a quick scan of the Windows 11 registry, I found the following unique strings being used at least once as a key class:</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p><ul style="padding: 0;" class="lst-kix_l7ahywf1ghkc-0 start"><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c0">&quot;DynDRootClass&quot;</span></li><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c0">&quot;GenericClass&quot;</span></li><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c0">&quot;Network ComputerName&quot;</span></li><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c0">&quot;REG_SZ&quot;</span></li><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c0">&quot;Shell&quot;</span></li></ul>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span>The </span><span class="MvcjwGOuIU-c8"><a href="https://github.com/libyal/libregf/blob/main/documentation/Windows%2520NT%2520Registry%2520File%2520(REGF)%2520format.asciidoc">Windows NT Registry File (REGF) format specification</a></span><span>&nbsp;lists several other values that have been observed in the past, such as &quot;activeds.dll &quot;, &quot;Cygwin&quot;, &quot;OS2SS&quot; or &quot;TCPMon&quot;. It is worth noting that the class was also used to store the encryption keys for the now-deprecated SAM database encryption mechanism known as </span><span class="MvcjwGOuIU-c8"><a href="https://moyix.blogspot.com/2008/02/syskey-and-sam.html">SysKey</a></span><span class="MvcjwGOuIU-c0">. Overall, due to its simplistic nature, key classes are not particularly security-relevant, but may be of interest in the context of obfuscation and hiding data, as they are easily accessible and yet a largely overlooked part of the registry.</span></p><h5 class="MvcjwGOuIU-c6" id="h.7gz2pgsorsij"><span class="MvcjwGOuIU-c31 MvcjwGOuIU-c36">MaxNameLen, MaxClassLen, MaxValueNameLen and MaxValueDataLen</span></h5>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">These four fields store cached information about the maximum lengths of several properties of the key or its subkeys:</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p><ul style="padding: 0;" class="lst-kix_175jp61awd4f-0 start"><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c15">MaxNameLen:</span><span class="MvcjwGOuIU-c0">&nbsp;the maximum length of a subkey&#39;s name,</span></li><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c15">MaxClassLen:</span><span class="MvcjwGOuIU-c0">&nbsp;the maximum length of a subkey&#39;s class information,</span></li><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c15">MaxValueNameLen:</span><span class="MvcjwGOuIU-c0">&nbsp;the maximum length of a value name associated with the key,</span></li><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c15">MaxValueDataLen:</span><span class="MvcjwGOuIU-c0">&nbsp;the maximum length of a value data associated with the key.</span></li></ul>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span>The presumed purpose of these members is to facilitate a quick lookup of the per-key limits, such that when a client application wants to enumerate/query subkeys or values, it can simply allocate a single buffer guaranteed to accommodate every possible key name, value name, etc. And so, their exact values can be retrieved with the </span><span class="MvcjwGOuIU-c8"><a href="https://learn.microsoft.com/en-us/windows/win32/api/winreg/nf-winreg-regqueryinfokeyw">RegQueryInfoKey</a></span><span class="MvcjwGOuIU-c0">&nbsp;API via the lpcbMaxSubKeyLen, lpcbMaxClassLen, lpcbMaxValueNameLen and lpcbMaxValueLen arguments.</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">Although querying these limits seems convenient, there are some caveats that are important to keep in mind:</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p><ul style="padding: 0;" class="lst-kix_4ao7uanj5htj-0 start"><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c0">The fields are intended to represent the lower bound of the number of bytes required to store the given property, but not necessarily to be optimal (i.e. to be the smallest sufficient length). For example, when a key with formerly the longest name is deleted, the MaxNameLen field of the parent is not updated with the value of the second-largest length, as that would require the lengthy process of iterating through all of the subkeys again. Therefore, relying on those values may incur some unwanted memory overhead.</span></li><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c0">When operating on registry keys that are globally visible in the registry tree, it is possible that a race condition with another application causes one of the maxima to change in between the RegQueryInfoKey call and the actual data query. To address this, applications should include fallback logic to allocate more memory in the rare case when the obtained maximum proves insufficient.</span></li><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span>To add to the previous point, after having reverse-engineered and reviewed most of the Configuration Manager code, it is my instinct that these fields continue to be supported throughout the development of new registry features (e.g. differencing hives), but it is mostly on a best-effort basis. For example, during hive load, only MaxValueNameLen and MaxValueDataLen are enforced to have the correct values, while MaxNameLen and MaxClassLen remain unchecked. For this reason, I would personally not rely on the consistency of those values for the security of any client code, and would treat them more as a guidance/supplementary information than the sole source of truth about the key limits.</span></li></ul><h5 class="MvcjwGOuIU-c6" id="h.gq5esafaale9"><span class="MvcjwGOuIU-c31 MvcjwGOuIU-c36">UserFlags</span></h5>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span>This is a field whose name, offset and function (so basically every aspect) has been subject to change over the years. Its current form has existed since Windows Vista, and occupies bits 20-23 of MaxNameLen, which had been previously a 32-bit integer, but was later reduced to 16 bits to make room for these extra flags. In theory, its name may suggest that this member is meant to store user-defined data, but in practice, Microsoft developers quickly found their own use for the bitmask: storing flags related to the </span><span class="MvcjwGOuIU-c8"><a href="https://learn.microsoft.com/en-us/windows/win32/winprog64/registry-reflection">Registry Reflection</a></span><span>&nbsp;mechanism for providing interoperability between 32-bit and 64-bit applications. You can read more about the meaning of each specific flag </span><span class="MvcjwGOuIU-c8"><a href="https://github.com/msuhanov/regf/blob/master/Windows%2520registry%2520file%2520format%2520specification.md%23user-flags">here</a></span><span>, but in short, this was where reflection-specific configuration was internally saved by API functions such as </span><span class="MvcjwGOuIU-c8"><a href="https://learn.microsoft.com/en-us/windows/win32/api/winreg/nf-winreg-regenablereflectionkey">RegEnableReflectionKey</a></span><span>&nbsp;and </span><span class="MvcjwGOuIU-c8"><a href="https://learn.microsoft.com/en-us/windows/win32/api/winreg/nf-winreg-regdisablereflectionkey">RegDisableReflectionKey</a></span><span>, and retrieved by </span><span class="MvcjwGOuIU-c8"><a href="https://learn.microsoft.com/en-us/windows/win32/api/winreg/nf-winreg-regqueryreflectionkey">RegQueryReflectionKey</a></span><span class="MvcjwGOuIU-c0">.</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span>However, this specific use seems to have been short-lived, as Registry Reflection </span><span class="MvcjwGOuIU-c8"><a href="https://learn.microsoft.com/en-us/windows/win32/win7appqual/removal-of-windows-registry-reflection">was soon deprecated</a></span><span class="MvcjwGOuIU-c0">&nbsp;in Windows 7. Since then, it could indeed be considered as four extra bits of user-controlled storage per key, accessible for reading via NtQueryKey(KeyFlagsInformation) and for writing via NtSetInformationKey(KeyWow64FlagsInformation). Beyond being interesting for historical reasons, the field doesn&#39;t play any important role in security.</span></p><h5 class="MvcjwGOuIU-c6" id="h.m7cl4gtrghsz"><span class="MvcjwGOuIU-c31 MvcjwGOuIU-c36">VirtControlFlags</span></h5>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">This field is another one introduced around Windows XP SP3 / Windows Vista that took over some of the space from MaxNameLen. It is related to Registry Virtualization and takes up four bits in the _CM_KEY_NODE structure definition, but there are only three flags that it can really store:</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p><table class="MvcjwGOuIU-c28"><tr class="MvcjwGOuIU-c4"><td class="MvcjwGOuIU-c43 MvcjwGOuIU-c64" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c24"><span class="MvcjwGOuIU-c9 MvcjwGOuIU-c14">Mask</span></p></td><td class="MvcjwGOuIU-c23 MvcjwGOuIU-c64" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c24"><span class="MvcjwGOuIU-c9 MvcjwGOuIU-c14">Name</span></p></td><td class="MvcjwGOuIU-c39 MvcjwGOuIU-c64" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c24"><span class="MvcjwGOuIU-c9 MvcjwGOuIU-c14">Description</span></p></td></tr><tr class="MvcjwGOuIU-c4"><td class="MvcjwGOuIU-c43" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">0x1</span></p></td><td class="MvcjwGOuIU-c23" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">REG_KEY_DONT_VIRTUALIZE</span></p></td><td class="MvcjwGOuIU-c39" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span>Disables virtualization for the specific key.</span></p></td></tr><tr class="MvcjwGOuIU-c4"><td class="MvcjwGOuIU-c43" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">0x2</span></p></td><td class="MvcjwGOuIU-c23" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c51">REG_KEY_DONT_SILENT_FAIL</span></p></td><td class="MvcjwGOuIU-c39" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">Prevents the system from re-opening a virtualized key with MAXIMUM_ACCESS if the initial Open operation with the desired access rights has failed.</span></p></td></tr><tr class="MvcjwGOuIU-c4"><td class="MvcjwGOuIU-c43" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">0x4</span></p></td><td class="MvcjwGOuIU-c23" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c51 MvcjwGOuIU-c83">REG_KEY_RECURSE_FLAG</span></p></td><td class="MvcjwGOuIU-c39" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">Causes new subkeys of the key to inherit its virtualization-related configuration.</span></p></td></tr></table>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">The flags are not sanitized in any way during hive load and so may be set to arbitrary values. They can also be modified programmatically by using the NtSetInformationKey(KeySetVirtualizationInformation) system call, or even from the Windows command line, by using the REG FLAGS command:</span></p>
 <p class="MvcjwGOuIU-c5 MvcjwGOuIU-c11"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c5"><span></span><span class="MvcjwGOuIU-c1">C:\&gt;reg</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">flags</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">/?</span></p>
 <p class="MvcjwGOuIU-c5 MvcjwGOuIU-c11"><span class="MvcjwGOuIU-c9 MvcjwGOuIU-c7"></span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1">REG</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">FLAGS</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">KeyName</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">[QUERY</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">|</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">SET</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">[DONT_VIRTUALIZE]</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">[DONT_SILENT_FAIL]</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">[RECURSE_FLAG]]</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">[/reg:32</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">|</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">/reg:64]</span></p>
 <p class="MvcjwGOuIU-c5 MvcjwGOuIU-c11"><span class="MvcjwGOuIU-c9 MvcjwGOuIU-c7"></span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; </span><span class="MvcjwGOuIU-c1">Keyname</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">&quot;HKLM\Software&quot;[\SubKey]</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">(Restricted</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">to</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">these</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">keys</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">on</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">local</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">machine</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">only).</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">SubKey</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">The</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">full</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">name</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">of</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">a</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">registry</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">key</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">under</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">HKLM\Software.</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; </span><span class="MvcjwGOuIU-c1">DONT_VIRTUALIZE</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">DONT_SILENT_FAIL</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">RECURSE_FLAG</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">Used</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">with</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">SET;</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">flags</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">specified</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">on</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">the</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">command</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">line</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">will</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">be</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">set,</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">while</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">those</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">not</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">specified</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">will</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">be</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">cleared.</span></p>
 <p class="MvcjwGOuIU-c5 MvcjwGOuIU-c11"><span class="MvcjwGOuIU-c9 MvcjwGOuIU-c7"></span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; </span><span class="MvcjwGOuIU-c1">/reg:32</span><span class="MvcjwGOuIU-c7">&nbsp; </span><span class="MvcjwGOuIU-c1">Specifies</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">the</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">key</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">should</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">be</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">accessed</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">using</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">the</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">32-bit</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">registry</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">view.</span></p>
 <p class="MvcjwGOuIU-c5 MvcjwGOuIU-c11"><span class="MvcjwGOuIU-c9 MvcjwGOuIU-c7"></span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; </span><span class="MvcjwGOuIU-c1">/reg:64</span><span class="MvcjwGOuIU-c7">&nbsp; </span><span class="MvcjwGOuIU-c1">Specifies</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">the</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">key</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">should</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">be</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">accessed</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">using</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">the</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">64-bit</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">registry</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">view.</span></p>
 <br/>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span>More information about these flags can be found in the documentation of the </span><span class="MvcjwGOuIU-c8"><a href="https://learn.microsoft.com/en-us/windows/win32/devnotes/orsetvirtualflags">ORSetVirtualFlags</a></span><span class="MvcjwGOuIU-c0">&nbsp;API function, a part of the Offline Registry Library. In the context of registry security research, I haven&#39;t found them particularly interesting &ndash; the other virtualization-related flags in the &quot;Flags&quot; field have proved to be much more useful in that regard.</span></p><h5 class="MvcjwGOuIU-c6" id="h.8n4biur37sx7"><span class="MvcjwGOuIU-c31 MvcjwGOuIU-c36">Debug</span></h5>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">In Debug/Checked builds of Windows, it used to be possible to have the kernel trigger a breakpoint when performing a specific operation on a specific registry key. To enable the option, an administrator would have to set the &nbsp;HKLM\System\CurrentControlSet\Control\Session Manager\Configuration Manager\RegDebugBreaksEnabled value to 1, which would propagate to the global kernel CmpRegDebugBreakEnabled variable. Then, the &quot;Debug&quot; field of each key would store a bitmask indicating which subset of eight possible operations should be interrupted for the given key:</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p><table class="MvcjwGOuIU-c88"><tr class="MvcjwGOuIU-c4"><td class="MvcjwGOuIU-c44" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c24"><span class="MvcjwGOuIU-c9 MvcjwGOuIU-c14">Mask</span></p></td><td class="MvcjwGOuIU-c42 MvcjwGOuIU-c64" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c24"><span class="MvcjwGOuIU-c9 MvcjwGOuIU-c14">Name</span></p></td></tr><tr class="MvcjwGOuIU-c4"><td class="MvcjwGOuIU-c52" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">0x01</span></p></td><td class="MvcjwGOuIU-c42" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">BREAK_ON_OPEN</span></p></td></tr><tr class="MvcjwGOuIU-c4"><td class="MvcjwGOuIU-c52" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">0x02</span></p></td><td class="MvcjwGOuIU-c42" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">BREAK_ON_DELETE</span></p></td></tr><tr class="MvcjwGOuIU-c4"><td class="MvcjwGOuIU-c52" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">0x04</span></p></td><td class="MvcjwGOuIU-c42" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">BREAK_ON_SECURITY_CHANGE</span></p></td></tr><tr class="MvcjwGOuIU-c4"><td class="MvcjwGOuIU-c52" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">0x08</span></p></td><td class="MvcjwGOuIU-c42" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">BREAK_ON_CREATE_SUBKEY</span></p></td></tr><tr class="MvcjwGOuIU-c4"><td class="MvcjwGOuIU-c52" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">0x10</span></p></td><td class="MvcjwGOuIU-c42" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">BREAK_ON_DELETE_SUBKEY</span></p></td></tr><tr class="MvcjwGOuIU-c4"><td class="MvcjwGOuIU-c52" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">0x20</span></p></td><td class="MvcjwGOuIU-c42" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">BREAK_ON_SET_VALUE</span></p></td></tr><tr class="MvcjwGOuIU-c4"><td class="MvcjwGOuIU-c52" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">0x40</span></p></td><td class="MvcjwGOuIU-c42" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">BREAK_ON_DELETE_VALUE</span></p></td></tr><tr class="MvcjwGOuIU-c4"><td class="MvcjwGOuIU-c52" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">0x80</span></p></td><td class="MvcjwGOuIU-c42" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">BREAK_ON_KEY_VIRTUALIZE</span></p></td></tr></table>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">Whenever a breakpoint was triggered by this mechanism, the kernel would also print out a corresponding message for the attached debugger, for instance:</span></p>
 <p class="MvcjwGOuIU-c5 MvcjwGOuIU-c11"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c5"><span></span><span class="MvcjwGOuIU-c7 MvcjwGOuIU-c49">DbgPrint(</span><span class="MvcjwGOuIU-c1">&quot;\n\n Current process is deleting a key tagged as BREAK ON DELETE&quot;</span><span class="MvcjwGOuIU-c7 MvcjwGOuIU-c49">);</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7 MvcjwGOuIU-c49">DbgPrint(</span><span class="MvcjwGOuIU-c1">&quot; or deleting a subkey under a key tagged as BREAK_ON_DELETE_SUBKEY\n&quot;</span><span class="MvcjwGOuIU-c7 MvcjwGOuIU-c49">);</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7 MvcjwGOuIU-c49">DbgPrint(</span><span class="MvcjwGOuIU-c1">&quot;\nPlease type the following in the debugger window: !reg kcb %p\n\n\n&quot;</span><span class="MvcjwGOuIU-c7 MvcjwGOuIU-c49">,</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c7 MvcjwGOuIU-c49">Kcb);</span></p>
 <br/>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">Now that the Debug/Checked builds have been discontinued &ndash; or at least not released publicly anymore for the latest versions of Windows 10/11 &ndash; the &quot;Debug&quot; field is just an unused byte in the key node structure.</span></p><h5 class="MvcjwGOuIU-c6" id="h.9fyc95ng2h6z"><span class="MvcjwGOuIU-c31 MvcjwGOuIU-c36">WorkVar</span></h5>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span>According to an unofficial format specification, WorkVar used to be an internal-use member meant to be only ever accessed by the kernel in order to optimize key lookups. The last version of Windows where WorkVar was still in active use was Windows 2000; since Windows XP, </span><span>it has</span><span class="MvcjwGOuIU-c0">&nbsp;simply been another four bytes of unused memory in the key node data layout.</span></p><h5 class="MvcjwGOuIU-c6" id="h.ewarh9zb3ijo"><span class="MvcjwGOuIU-c31 MvcjwGOuIU-c36">NameLength and Name</span></h5>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">The combination of these two fields specifies the name of the key: NameLength indicates the length of the string in bytes, and Name is an inline, variable-length buffer at the end of the structure that stores the name itself. There are a number of considerations and consistency requirements related to registry key names, enforced when loading a hive and later at runtime:</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p><ul style="padding: 0;" class="lst-kix_anetktcl8su5-0 start"><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c15">Compression:</span><span>&nbsp;I</span><span class="MvcjwGOuIU-c0">f the KEY_COMP_NAME (0x20) flag is clear in _CM_KEY_NODE.Flags, the name is formatted as a wide string of 16-bit characters. If it is set, which is the common scenario, then &quot;Name&quot; represents a more tightly packed ASCII string of 8-bit characters. Considering that a majority of keys in the registry are alphanumeric, this optimization saves a non-trivial amount of memory and disk space. It is interesting to note that it is still possible to load a hive with a non-optimally formatted key name (non-compressed ASCII string), but such a key node would never be generated by Windows itself.</span></li><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c15">Length:</span><span>&nbsp;The key name mustn&#39;t be empty (i.e. it should be at least one character long), and it cannot exceed 256 characters in length (even though </span><span class="MvcjwGOuIU-c8"><a href="https://learn.microsoft.com/en-us/windows/win32/sysinfo/registry-element-size-limits">Registry element size limits</a></span><span>&nbsp;incorrectly </span><span>claims</span><span>&nbsp;that the limit is 255). The NameLength field value is expressed in bytes, so it must be between 1-256 for compressed names, and 2-512 for wide strings (and divisible by two). Up until October 2022, this limit </span><span class="MvcjwGOuIU-c8"><a href="https://project-zero.issues.chromium.org/issues/42451478">was not correctly enforced</a></span><span class="MvcjwGOuIU-c0">, making it possible to load hives with key names up to 1040 characters, which would then be mishandled or outright rejected by other parts of the registry code.</span></li><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c15">Charset:</span><span>&nbsp;All characters in the 0x0000 &ndash; 0xFFFF range are allowed in a key name with the exception of backslash (&#39;\&#39;, 0x005C). The backslash is singled out because it plays a special role in the registry, separating distinct elements of the registry paths. Since the kernel must always be able to distinguish parts of key names from the separator, a decision was made to exclude this one character from the key name charset, similar to how backslashes are not allowed in file names. Furthermore, there is a second minor requirement that the key name must not start with a null character, but it may be present at any other position in the name (this only started to be properly enforced in NtRenameKey after the fix for </span><span class="MvcjwGOuIU-c8"><a href="https://github.com/googleprojectzero/p0tools/tree/master/WinRegLowSeverityBugs/Reports/13_CmpLightWeightPrepareSetSecDescUoW_security_list_confusion">CVE-2024-26178</a></span><span>&nbsp;in March 2024). Overall, this means that key names aren&#39;t truly textual strings </span><span>in the conventional sense of the word: they don&#39;t use a terminator, and may contain all sorts of non-printable characters. It would be more appropriate to think of them as binary blobs used to reference registry keys, which doesn&#39;t have any consequences for the kernel, as it universally uses the UNICODE_STRING structure that includes both the length and the backing buffer of the string anyway. But if a potentially malicious program were to create a key with an unusual name (e.g. including a null character), it could prove difficult for an administrator to operate on it with the built-in registry utilities (reg.exe, Regedit), or even with third-party tools that use the high-level API (such as </span><span class="MvcjwGOuIU-c8"><a href="https://learn.microsoft.com/en-us/windows/win32/api/winreg/nf-winreg-regopenkeyexa">RegOpenKeyEx</a></span><span class="MvcjwGOuIU-c0">). In such cases, it might be required to use specialized tools that interact with the Windows registry directly through the system call interface as the only way to examine/modify such keys.</span></li><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c15">Uniqueness:</span><span>&nbsp;One of the most important invariants of the Windows registry implementation is the uniqueness of key names: there may be only one key with a specific path, or in other words, for every key, there mustn&#39;t be any duplicates in the list of its subkeys. Given that registry key names are case-insensitive, any two names are always compared in their uppercase form to determine if they are equal or not. This uniqueness requirement is enforced both during hive load and subsequent operations, and failure to do it correctly could lead to both logic bugs and memory corruption. For some examples of the potential outcomes of allowing duplicate key names in registry, see Maxim Suhanov&#39;s </span><span class="MvcjwGOuIU-c8"><a href="https://dfir.ru/2021/10/15/the-uppercased-hell/">The uppercased hell</a></span><span>&nbsp;blog or my </span><span class="MvcjwGOuIU-c8"><a href="https://project-zero.issues.chromium.org/issues/42451527">CVE-2023-21748</a></span><span>&nbsp;/ </span><span class="MvcjwGOuIU-c8"><a href="https://project-zero.issues.chromium.org/issues/42451549">CVE-2023-23420</a></span><span class="MvcjwGOuIU-c0">&nbsp;bug reports.</span></li></ul>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">Another intriguing aspect of the key names are the names associated with the root keys of default system hives. In general, every registry key in Windows is referenced by its name specified in the key node, except for root keys, which are known by the name of their mount points. As a result, the &quot;real&quot; underlying names of root keys are never visible to users or applications, but they are nevertheless present in the hive file as a mandatory part of every key node, and could be potentially used to learn something about how these fundamental system hives (SOFTWARE, SYSTEM etc.) are generated.</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">I have examined hives from various Windows versions ranging from Windows NT 3.1 to Windows 11, and arrived at the following list of per-version root key names:</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p><table class="MvcjwGOuIU-c28"><tr class="MvcjwGOuIU-c4"><td class="MvcjwGOuIU-c73 MvcjwGOuIU-c64" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c24"><span class="MvcjwGOuIU-c9 MvcjwGOuIU-c14">Version</span></p></td><td class="MvcjwGOuIU-c64 MvcjwGOuIU-c68" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c24"><span class="MvcjwGOuIU-c9 MvcjwGOuIU-c14">Root key name</span></p></td></tr><tr class="MvcjwGOuIU-c4"><td class="MvcjwGOuIU-c73" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">NT 3.1 - NT 4.0</span></p></td><td class="MvcjwGOuIU-c68" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">Same as the hive name (e.g., &quot;SYSTEM&quot;)</span></p></td></tr><tr class="MvcjwGOuIU-c4"><td class="MvcjwGOuIU-c73" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">2000 - XP</span></p></td><td class="MvcjwGOuIU-c68" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">$$$PROTO.HIV</span></p></td></tr><tr class="MvcjwGOuIU-c4"><td class="MvcjwGOuIU-c73" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">Vista - 7</span></p></td><td class="MvcjwGOuIU-c68" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span>CMI-CreateHive{</span><span class="MvcjwGOuIU-c10">RANDOM GUID</span><span class="MvcjwGOuIU-c0">}</span></p></td></tr><tr class="MvcjwGOuIU-c4"><td class="MvcjwGOuIU-c73" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">8</span></p></td><td class="MvcjwGOuIU-c68" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">CsiTool-CreateHive-{00000000-0000-0000-0000-000000000000}</span></p></td></tr><tr class="MvcjwGOuIU-c4"><td class="MvcjwGOuIU-c73" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">10 - 11</span></p></td><td class="MvcjwGOuIU-c68" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">ROOT</span></p></td></tr></table>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span>In early NT versions, the root key name simply mirrored the hive&#39;s file name. In Windows 2000 and XP, the name stemmed from the fact that system hives were created during system installation by temporarily creating the tree root under \Registry\Machine\SYSTEM\$$$PROTO.HIV, pre-initializing it with the default data for the given hive, and saving it to a file with an API like </span><span class="MvcjwGOuIU-c8"><a href="https://learn.microsoft.com/en-us/windows/win32/api/winreg/nf-winreg-regsavekeyexw">RegSaveKeyEx</a></span><span class="MvcjwGOuIU-c0">.</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span>In Windows 10 and 11, the name is simply &quot;ROOT&quot;, which, along with the &quot;OfRg&quot; magic bytes at offset 0xB0 in the file header, hints that the hives are created with the </span><span>Offline Registry Library</span><span class="MvcjwGOuIU-c0">. This leaves versions between Windows Vista and Windows 8 as the big unknown: neither &quot;CMI-CreateHive&quot; nor &quot;CsiTool-CreateHive&quot; sound particularly familiar, and I haven&#39;t been able to find any information about them in any public resources. It is probably safe to assume that these strings are indicative of some internal Microsoft tooling that was used to generate hives for these systems, but not much is known beyond it. Nevertheless, I find it fascinating that such little tidbits of information can be found in obscure corners of file formats. You never know when some other missing part of the puzzle becomes known publicly, making it possible to finally connect the dots and see the bigger picture, sometimes years or decades after the initial release of the software.</span></p><h4 class="MvcjwGOuIU-c18 MvcjwGOuIU-c12" id="h.dp8c8odflm45"><span class="MvcjwGOuIU-c19 MvcjwGOuIU-c17">Link nodes</span></h4>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">As mentioned above, link nodes are a special type of key node designed to facilitate the mounting of arbitrary hives from disk into the global registry view. They are managed by the Windows kernel and only ever exist in memory. They are represented by the _CM_KEY_NODE structure, but with the following differences compared to regular keys:</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p><ul style="padding: 0;" class="lst-kix_c8qgjiyn10ie-0 start"><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c0">The Signature field is set to 0x6B6C (&#39;lk&#39;) instead of 0x6B6E (&#39;nk&#39;),</span></li><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c0">The KEY_HIVE_EXIT (0x0002) flag is set in Flags,</span></li><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c0">The key doesn&#39;t have any of the standard key properties, such as the security descriptor, class, subkeys or values. The only cell reference it contains is to its parent cell, which is one of \Registry\A, \Registry\Machine, \Registry\User or \Registry\WC.</span></li><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c0">Instead of the SubKeyLists member at offset 0x1C, the link node uses the ChildHiveReference field of type _CM_KEY_REFERENCE, which stores a kernel-mode pointer to the destination hive descriptor (_HHIVE*), and the cell index of the root key within that hive.</span></li></ul>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">So, whenever you see a hive root key (e.g. any key within HKLM or HKCU), you are actually looking at a pair of a link node (also known as exit node) + root key (a.k.a. entry node &ndash; these terms are used interchangeably). The mount point assumes the key name of the link node (so that it is easily enumerable with the existing kernel logic), and all of the characteristics of the entry node. This is illustrated in the following diagram, where the key marked in red is the link node of the SYSTEM hive, and the green one is the root key:</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEh3oiXe3jfIDS0CKONQWJn0FeAugieby2gy41fGxDBO_dDqYh13EduspE8cuBTKWOikQfdPR7GodX7__1sUQIlqpsObXgtp_ucQenLFPZB1qf7Yoxy6EiIK8WzFa6IkDsBbHGhc5fRnFFtf0SSunqUPto67Kl73AD6pczCRNbjXbgvGNqhcRhcFR8iNFGk/s1999/image10.png" style="display: block; padding: 1em 0;text-align: center;"><img alt="Diagrammatic illustration and visual representation of the paragraph above" border="0" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEh3oiXe3jfIDS0CKONQWJn0FeAugieby2gy41fGxDBO_dDqYh13EduspE8cuBTKWOikQfdPR7GodX7__1sUQIlqpsObXgtp_ucQenLFPZB1qf7Yoxy6EiIK8WzFa6IkDsBbHGhc5fRnFFtf0SSunqUPto67Kl73AD6pczCRNbjXbgvGNqhcRhcFR8iNFGk/s1200/image10.png" style="max-height: 750px; max-width: 600px;" title="Diagrammatic illustration and visual representation of the paragraph above" /></a></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">The existence of link nodes seems to be very little known and scarcely documented in public resources, which is likely caused by the fact that the Windows kernel makes them virtually invisible, and not just for users and high-level API clients, but even for administrators and kernel driver developers. The way the registry tree traversing code is structured, whenever it encounters a link node, it always makes sure to skip over it and reference the corresponding entry node. This means that it is impossible to open or otherwise observe the link node itself from the context of user-mode, but if we put in some effort, we should be able to see it in WinDbg attached as a kernel debugger. We can approach the link node from two sides: either try to find it top-down starting from the master hive, or by locating a key in a mounted hive and traversing the registry tree upwards.</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">In this post, we will proceed with the first idea and enumerate the keys within \Registry\Machine (i.e. HKLM):</span></p>
 <p class="MvcjwGOuIU-c5 MvcjwGOuIU-c11"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c5"><span></span><span class="MvcjwGOuIU-c1">0:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">kd&gt;</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">!reg</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">querykey</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">\registry\machine</span></p>
 <p class="MvcjwGOuIU-c5 MvcjwGOuIU-c11"><span class="MvcjwGOuIU-c9 MvcjwGOuIU-c7"></span></p>
 <p class="MvcjwGOuIU-c5 MvcjwGOuIU-c11"><span class="MvcjwGOuIU-c9 MvcjwGOuIU-c7"></span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1">Found</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">KCB</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">=</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">ffff800f88ad96e0</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">::</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">\REGISTRY\MACHINE</span></p>
 <p class="MvcjwGOuIU-c5 MvcjwGOuIU-c11"><span class="MvcjwGOuIU-c9 MvcjwGOuIU-c7"></span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1">Hive</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">ffff800f88a88000</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1">KeyNode</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">ffff800f88ada16c</span></p>
 <p class="MvcjwGOuIU-c5 MvcjwGOuIU-c11"><span class="MvcjwGOuIU-c9 MvcjwGOuIU-c7"></span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1">[SubKeyAddr]</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">[SubKeyName]</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1">ffff800f88ada44c</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">BCD00000000</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1">ffff800f88ada3cc</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">HARDWARE</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1">ffff800f88ada59c</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">SAM</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1">ffff800f88ada504</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">SECURITY</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1">ffff800f88ada374</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">SOFTWARE</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1">ffff800f88ada31c</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">SYSTEM</span></p>
 <p class="MvcjwGOuIU-c5 MvcjwGOuIU-c11"><span class="MvcjwGOuIU-c9 MvcjwGOuIU-c7"></span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Use</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">&#39;!reg</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">keyinfo</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">ffff800f88a88000</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">&lt;SubKeyAddr&gt;&#39;</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">to</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">dump</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">the</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">subkey</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">details</span></p>
 <p class="MvcjwGOuIU-c5 MvcjwGOuIU-c11"><span class="MvcjwGOuIU-c9 MvcjwGOuIU-c7"></span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1">[ValueType]</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">[ValueName]</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">[ValueData]</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1">REG_DWORD</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">ServiceLastKnownStatus</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">2</span></p>
 <br/>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">Here, we can see all the system hive mount points together with their corresponding link node addresses. In case of normal, stable keys, these would be user-mode addresses within the address space of the Registry process, but since the master hive is a volatile one, all of its structures are stored on the kernel pools. We can then use a command such as !reg knode to query any of the specific subkeys, e.g. SYSTEM:</span></p>
 <p class="MvcjwGOuIU-c5 MvcjwGOuIU-c11"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c5"><span></span><span class="MvcjwGOuIU-c1">0:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">kd&gt;</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">!reg</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">knode</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">ffff800f88ada31c</span></p>
 <p class="MvcjwGOuIU-c5 MvcjwGOuIU-c11"><span class="MvcjwGOuIU-c9 MvcjwGOuIU-c7"></span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1">Signature:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">CM_LINK_NODE_SIGNATURE</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">(kl)</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1">Name</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">SYSTEM</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1">ParentCell</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">0x168</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1">Security</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">0xffffffff</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">[cell</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">index]</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1">Class</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">0xffffffff</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">[cell</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">index]</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1">Flags</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">0x2a</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1">MaxNameLen</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">0x0</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1">MaxClassLen</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">0x0</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1">MaxValueNameLen</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">0x0</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1">MaxValueDataLen</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">0x0</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1">LastWriteTime</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">0x</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">1db2b94:0xe031a530</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1">SubKeyCount[Stable</span><span class="MvcjwGOuIU-c7">&nbsp; </span><span class="MvcjwGOuIU-c1">]:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">0x0</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1">SubKeyLists[Stable</span><span class="MvcjwGOuIU-c7">&nbsp; </span><span class="MvcjwGOuIU-c1">]:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">0x20</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1">SubKeyCount[Volatile]:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">0x0</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1">SubKeyLists[Volatile]:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">0xffffffff</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1">ValueList.Count</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">0x88a8e000</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1">ValueList.List</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">0xffff800f</span></p>
 <br/>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">As expected, the key node has the special link node signature (&#39;kl&#39;), and the 0x2 flag set within the 0x2a Flags bitmask (the other two flags set are KEY_NO_DELETE and KEY_COMP_NAME). The command gets a little confused, because it expects to operate on a regular key node and display its subkey/value counts and lists, but as mentioned above, this space is taken up by the _CM_KEY_REFERENCE structure in the link node. If we line up the offsets correctly, we can decode that the exit node points at cell index 0x20 in hive 0xffff800f88a8e000, which is consistent with the outcome of displaying the structure data directly:</span></p>
 <p class="MvcjwGOuIU-c5 MvcjwGOuIU-c11"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c5"><span></span><span class="MvcjwGOuIU-c1">0:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">kd&gt;</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">dx</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">-id</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">0,0,ffffbd044acf6040</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">-r1</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">(*((ntkrnlmp!_CM_KEY_REFERENCE</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">*)0xffff800f88ada338))</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1">(*((ntkrnlmp!_CM_KEY_REFERENCE</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">*)0xffff800f88ada338))</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">[Type:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">_CM_KEY_REFERENCE]</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">[+0x000]</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">KeyCell</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">0x20</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">[Type:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">unsigned</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">long]</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">[+0x008]</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">KeyHive</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">0xffff800f88a8e000</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">[Type:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">_HHIVE</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">*]</span></p>
 <br/>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">We can now translate this information into the cell&#39;s virtual address, and take a peek into it with !reg knode and !reg keyinfo:</span></p>
 <p class="MvcjwGOuIU-c5 MvcjwGOuIU-c11"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c5"><span></span><span class="MvcjwGOuIU-c1">0:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">kd&gt;</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">!reg</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">cellindex</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">0xffff800f88a8e000</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">0x20</span></p>
 <p class="MvcjwGOuIU-c5 MvcjwGOuIU-c11"><span class="MvcjwGOuIU-c9 MvcjwGOuIU-c7"></span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1">Map</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">=</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">ffff800f88adc000</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Type</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">=</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">0</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Table</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">=</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">0</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Block</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">=</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">0</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Offset</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">=</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">20</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1">MapTable</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">=</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">ffff800f88ade000</span><span class="MvcjwGOuIU-c9 MvcjwGOuIU-c7">&nbsp;</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1">MapEntry</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">=</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">ffff800f88ade000</span><span class="MvcjwGOuIU-c9 MvcjwGOuIU-c7">&nbsp;</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1">BinAddress</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">=</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">ffff800f896e8009,</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">BlockOffset</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">=</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">0000000000000000</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1">BlockAddress</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">=</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">ffff800f896e8000</span><span class="MvcjwGOuIU-c9 MvcjwGOuIU-c7">&nbsp;</span></p>
 <p class="MvcjwGOuIU-c5 MvcjwGOuIU-c11"><span class="MvcjwGOuIU-c9 MvcjwGOuIU-c7"></span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1">pcell:</span><span class="MvcjwGOuIU-c7">&nbsp; </span><span class="MvcjwGOuIU-c1 MvcjwGOuIU-c17">ffff800f896e8024</span></p>
 <p class="MvcjwGOuIU-c5 MvcjwGOuIU-c11"><span class="MvcjwGOuIU-c1 MvcjwGOuIU-c17"></span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1">0:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">kd&gt;</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">!reg</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">knode</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">ffff800f896e8024</span></p>
 <p class="MvcjwGOuIU-c5 MvcjwGOuIU-c11"><span class="MvcjwGOuIU-c9 MvcjwGOuIU-c7"></span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1">Signature:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">CM_KEY_NODE_SIGNATURE</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">(kn)</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1">Name</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">ROOT</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1">ParentCell</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">0x318</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1">Security</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">0x78</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">[cell</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">index]</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1">Class</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">0xffffffff</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">[cell</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">index]</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1">Flags</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">0x2c</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1">MaxNameLen</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">0x26</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1">MaxClassLen</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">0x0</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1">MaxValueNameLen</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">0x0</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1">MaxValueDataLen</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">0x0</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1">LastWriteTime</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">0x</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1 MvcjwGOuIU-c17">1db2b94:0xe031a530</span></p>
 <p class="MvcjwGOuIU-c5 MvcjwGOuIU-c11"><span class="MvcjwGOuIU-c1 MvcjwGOuIU-c17"></span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1 MvcjwGOuIU-c17">0: kd&gt; !reg keyinfo 0xffff800f88a8e000 ffff800f896e8024</span></p>
 <p class="MvcjwGOuIU-c5 MvcjwGOuIU-c11"><span class="MvcjwGOuIU-c1 MvcjwGOuIU-c17"></span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1 MvcjwGOuIU-c17">KeyPath &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\REGISTRY\MACHINE\SYSTEM</span></p>
 <p class="MvcjwGOuIU-c5 MvcjwGOuIU-c11"><span class="MvcjwGOuIU-c1 MvcjwGOuIU-c17"></span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1 MvcjwGOuIU-c17">[SubKeyAddr] &nbsp; &nbsp; &nbsp; &nbsp; [SubKeyName]</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1 MvcjwGOuIU-c17">ffff800f896e8174 &nbsp; &nbsp; ActivationBroker</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1 MvcjwGOuIU-c17">ffff800f896e964c &nbsp; &nbsp; ControlSet001</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1 MvcjwGOuIU-c17">ffff800f89f0e8a4 &nbsp; &nbsp; DriverDatabase</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1 MvcjwGOuIU-c17">ffff800f89f999c4 &nbsp; &nbsp; HardwareConfig</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1 MvcjwGOuIU-c17">ffff800f89f9a314 &nbsp; &nbsp; Input</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1 MvcjwGOuIU-c17">ffff800f89f9a3dc &nbsp; &nbsp; Keyboard Layout</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1 MvcjwGOuIU-c17">ffff800f89f9a43c &nbsp; &nbsp; Maps</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1 MvcjwGOuIU-c17">ffff800f89f9a674 &nbsp; &nbsp; MountedDevices</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1 MvcjwGOuIU-c17">ffff800f89f9ab64 &nbsp; &nbsp; ResourceManager</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1 MvcjwGOuIU-c17">ffff800f89f9abc4 &nbsp; &nbsp; ResourcePolicyStore</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1 MvcjwGOuIU-c17">ffff800f89f9ac2c &nbsp; &nbsp; RNG</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1 MvcjwGOuIU-c17">ffff800f89f9addc &nbsp; &nbsp; Select</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1 MvcjwGOuIU-c17">ffff800f89f9aed4 &nbsp; &nbsp; Setup</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1 MvcjwGOuIU-c17">ffff800f89f9b7d4 &nbsp; &nbsp; Software</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1 MvcjwGOuIU-c17">ffff800f89f9d1f4 &nbsp; &nbsp; State</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1 MvcjwGOuIU-c17">ffff800f89f9d24c &nbsp; &nbsp; WaaS</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1 MvcjwGOuIU-c17">ffff800f89fabc8c &nbsp; &nbsp; WPA</span></p>
 <p class="MvcjwGOuIU-c5 MvcjwGOuIU-c11"><span class="MvcjwGOuIU-c1 MvcjwGOuIU-c17"></span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1 MvcjwGOuIU-c17">[SubKeyAddr] &nbsp; &nbsp; &nbsp; &nbsp; [VolatileSubKeyName]</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1 MvcjwGOuIU-c17">ffff800f88b91024 &nbsp; &nbsp; CurrentControlSet</span></p>
 <p class="MvcjwGOuIU-c5 MvcjwGOuIU-c11"><span class="MvcjwGOuIU-c1 MvcjwGOuIU-c17"></span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1 MvcjwGOuIU-c17">&nbsp;Use &#39;!reg keyinfo ffff800f88a8e000 &lt;SubKeyAddr&gt;&#39; to dump the subkey details</span></p>
 <p class="MvcjwGOuIU-c5 MvcjwGOuIU-c11"><span class="MvcjwGOuIU-c1 MvcjwGOuIU-c17"></span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1 MvcjwGOuIU-c17">[ValueType] &nbsp; &nbsp; &nbsp; &nbsp; [ValueName] &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; [ValueData]</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1 MvcjwGOuIU-c17">&nbsp;Key has no Values</span></p>
 <br/>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">We have indeed ended up at the root key of the SYSTEM hive, which has a standard key node signature (&#39;nk&#39;), the predefined &quot;ROOT&quot; name, a valid security descriptor, a list of subkeys, and so on.</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span>Overall, link nodes are an interesting implementation detail of the registry that are worth keeping in mind. However, considering their relative simplicity and the fact that they are hidden away even from very low-level mechanisms like </span><span class="MvcjwGOuIU-c8"><a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/wdm/nf-wdm-cmregistercallbackex">Registry Callbacks</a></span><span>, they are of limited significance to system security. The lone vulnerability I found related to them, </span><span class="MvcjwGOuIU-c8"><a href="https://project-zero.issues.chromium.org/issues/42451505">CVE-2023-21747</a></span><span>, resulted in a use-after-free due to improper cleanup of the exit node when faced with an out-of-memory condition.</span></p><h4 class="MvcjwGOuIU-c18 MvcjwGOuIU-c12" id="h.5k32wcyndw01"><span class="MvcjwGOuIU-c19 MvcjwGOuIU-c17">Subkey indexes</span></h4>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">Operations performed on subkey lists are some of the most common ones &ndash; they are involved whenever a key is opened, created, deleted, renamed or enumerated, which constitutes a majority of actions involving the registry at runtime. It is for this reason that subkey lists have seen the most evolution throughout the subsequent versions of the regf format. As the interface was getting adopted by more and more applications in Windows NT and later systems, Microsoft developers could collect data on the typical usage patterns and devise adequate optimizations to speed these operations up. In this section, we will have a deeper look into how subkey indexes are formatted in the hives, and how the different types of operations affect them.</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">By way of introduction, subkey indexes are data structures storing lists of descendant keys relative to a parent key, referenced through the _CM_KEY_NODE.SubKeyLists[...] cell indexes. During hive load, the value at index 0 of the array may either be a subkey index, or HCELL_NIL if there are no subkeys; index 1 must always be equal to HCELL_NIL, as by definition there are no volatile subkeys on disk. The high-level concept behind the subkey index is that it is a linear list of key node cell indexes, which must efficiently support the following operations (from most to least commonly used, in my subjective opinion):</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p><ol class="lst-kix_s8f9k49k9svk-0 start" start="1"><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c0">Finding a key by name,</span></li><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c0">Finding a key by index on the list,</span></li><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c0">Adding a new key to the list,</span></li><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c0">Deleting a key from the list.</span></li></ol>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">Regardless of the underlying representation of the list, it is always stored in a lexicographical order, reducing the lookup-by-name time from linear to logarithmic by using binary search. Let&#39;s now look into the specific structures used in registry hives to implement this functionality.</span></p><h5 class="MvcjwGOuIU-c6" id="h.lhykk1vk3ji7"><span class="MvcjwGOuIU-c31 MvcjwGOuIU-c36">Index leaves</span></h5>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">Index leaves are the most basic type of a subkey list, which has been supported since the first iteration of the regf format and consists of just three members: the signature (0x696C, &#39;li&#39;), number of entries (16-bit), and an inline, variable-length list of the cell indexes. The corresponding Windows kernel structure is _CM_KEY_INDEX:</span></p>
 <p class="MvcjwGOuIU-c5 MvcjwGOuIU-c11"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c5"><span></span><span class="MvcjwGOuIU-c1">0:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">kd&gt;</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">dt</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">_CM_KEY_INDEX</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1">nt!_CM_KEY_INDEX</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x000</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Signature</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Uint2B</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x002</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Count</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Uint2B</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x004</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">List</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">[1]</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Uint4B</span></p>
 <br/>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">Given the Count field range, the index leaf can store up to 65535 subkeys. It is the most compact one in terms of disk/memory consumption, but it provides somewhat poor cache locality, because every key referenced during the lookup must be accessed in memory in order to read its name from _CM_KEY_NODE.Name. Nevertheless, index leaves are still commonly used in all versions of Windows up to this day.</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">As an example, let&#39;s consider a key with five subkeys named &quot;wombat&quot;, &quot;&#128002;&quot;, &quot;HIPPO&quot;, &quot;ant&quot;, and &quot;ocelot&quot;. An index leaf of such a key could look like this:</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjP6HTqFmlJWUcQw8x4ApSJkCj3ffelx8GBKKVMlXnQhKdWAsGBAKD8vKpHjiA3JS0GvOv9aqOc4r78CUbOKhyphenhyphenJ0ToMevio52XIou94wWK6jahtxS8IShyphenhyphenX63QzpBOXDFIA1m9yDRY1vkglHGXqT4TiiPjX5korMRt6-mg_27y7OuOwNgnaCF0XHLjPcUY/s1999/image3.png" style="display: block; padding: 1em 0;text-align: center;"><img alt="Diagram showing a key with five subkeys, as described in the sentence preceding this image" border="0" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjP6HTqFmlJWUcQw8x4ApSJkCj3ffelx8GBKKVMlXnQhKdWAsGBAKD8vKpHjiA3JS0GvOv9aqOc4r78CUbOKhyphenhyphenJ0ToMevio52XIou94wWK6jahtxS8IShyphenhyphenX63QzpBOXDFIA1m9yDRY1vkglHGXqT4TiiPjX5korMRt6-mg_27y7OuOwNgnaCF0XHLjPcUY/s1200/image3.png" style="max-height: 750px; max-width: 600px;" title="Diagram showing a key with five subkeys, as described in the sentence preceding this image" /></a></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span>This illustrates that entries in the list are indeed stored in a sorted manner, and in a case-insensitive way &ndash; &quot;ant&quot; goes before &quot;HIPPO&quot; even though &#39;H&#39; (0x48) &lt; &#39;a&#39; (0x61). However, this logic applies to comparisons only, and otherwise the letter casing specified during key creation is preserved and visible to registry users. Finally, the unicode ox symbol is placed last on the list, because it is encoded as U+D83D U+DC02, and 0xD83D is greater than any of the ASCII characters in the other names.</span></p><h5 class="MvcjwGOuIU-c6" id="h.f209cg94s4q"><span class="MvcjwGOuIU-c31 MvcjwGOuIU-c36">Fast leaves</span></h5>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">Fast leaves are slightly younger than subkey indexes, introduced in regf version 1.3 in 1995 (Windows NT 4.0). As hive versions 1.2 and below have been long obsolete, that means that fast leaves are universally supported in every modern version of Windows at the time of this writing. As the name suggests, they are meant to be faster than their predecessors, by including up to four initial characters of each subkey in the list as a &quot;hint&quot; next to the cell index of the key. This allows the kernel to execute the first four iterations of the string comparison loop using data only from the fast leaf and without referring to the corresponding node, which addresses the aforementioned issue of poor cache locality in index leaves. We expect this optimization to be effective in most real-life scenarios, as most keys consist of ASCII-only characters and differ from each other within the first four symbols.</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">The specific logic of generating the 32-bit hint from a string can be found in the internal CmpGenerateFastLeafHintForUnicodeString kernel function, but is boils down to the following steps:</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p><ol class="lst-kix_fvisx24ngp1u-0 start" start="1"><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c0">Set the initial hint variable to 0</span></li><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c0">In a loop of min(4, length) iterations:</span></li></ol><ol class="lst-kix_fvisx24ngp1u-1 start" start="1"><li style="margin-left: 46pt;" class="c2 c26 c12 li-bullet-0"><span class="MvcjwGOuIU-c0">If the n-th character is greater than 0xFF, break</span></li><li style="margin-left: 46pt;" class="c2 c26 c12 li-bullet-0"><span class="MvcjwGOuIU-c0">Otherwise add the character (with its original case) to the hint</span></li></ol><ol class="lst-kix_fvisx24ngp1u-0" start="3"><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c0">Return the hint to the caller</span></li></ol>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">For example, the hint for &quot;ant&quot; is &quot;ant\0&quot;, the hint for &quot;HIPPO&quot; is &quot;HIPP&quot;, and the hint for &quot;&#128002;&quot; is &quot;\0\0\0\0&quot; (the first character is non-ASCII, so the whole hint is simply zero).</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">When it comes to the structure layout of the fast leaf, it is basically the same as the index leaf, but it has a different signature (&#39;lf&#39;) and twice as many entries in the List array due to the addition of hints. There doesn&#39;t seem to be any structure definition corresponding specifically to fast leaves in the public symbols, which either means that the structure is a non-public one, or it is also accessed via _CM_KEY_INDEX in the source code, but through references such as Index.List[2*n] instead of Index.List[n]. An illustration of a fast leaf containing the five example subkeys is shown below:</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjR21S8gOfvMWCmn3wA9caP05aHsplcoyJ0OcsyK6ZibKgAIn8wciEdZ_Me4VkWBt2a_RiDkHk9LVKzTMSnN_3UTOSsHiwcs7AkXuCMXGQqkHZs1wlDTe-b2dAEWh_EQBjm2Zf8oT85pwnnyGIFmnSu8N-LOP47in47a6LYxx2zU0s6lx8dowpA0d1uIl8/s1999/image4.png" style="display: block; padding: 1em 0;text-align: center;"><img alt="Fast Leaf diagram containing the five example subkeys" border="0" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjR21S8gOfvMWCmn3wA9caP05aHsplcoyJ0OcsyK6ZibKgAIn8wciEdZ_Me4VkWBt2a_RiDkHk9LVKzTMSnN_3UTOSsHiwcs7AkXuCMXGQqkHZs1wlDTe-b2dAEWh_EQBjm2Zf8oT85pwnnyGIFmnSu8N-LOP47in47a6LYxx2zU0s6lx8dowpA0d1uIl8/s1200/image4.png" style="max-height: 750px; max-width: 600px;" title="Fast Leaf diagram containing the five example subkeys" /></a></span></p><h5 class="MvcjwGOuIU-c6" id="h.r2ulqn81rnxs"><span class="MvcjwGOuIU-c31 MvcjwGOuIU-c36">Hash leaves</span></h5>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">Hash leaves are the third and last (for now) iteration of the subkey index format, introduced in Windows XP in 2001 (regf version 1.5). They have exactly the same data layout as fast leaves, but are characterized by the &#39;lh&#39; signature, and the 32-bit hint is a simple hash of the entire string instead of an inline representation of the first four characters. The specific hashing algorithm is implemented in the internal CmpHashUnicodeComponent function, and can be summarized with the following steps:</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p><ol class="lst-kix_rs477lwege9r-0 start" start="1"><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c0">Start with a hash equal to 0</span></li><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c0">For every character in the string:</span></li></ol><ol class="lst-kix_rs477lwege9r-1 start" start="1"><li style="margin-left: 46pt;" class="c2 c26 c12 li-bullet-0"><span class="MvcjwGOuIU-c0">Hash = (Uppercase(Character) + 37 * Hash) % 0x100000000</span></li></ol><ol class="lst-kix_rs477lwege9r-0" start="3"><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c0">Return the hash to the caller</span></li></ol>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">The main benefit of this approach is that it works equally well with ASCII and non-ASCII strings, and it covers the entire name and not just a prefix, further limiting the number of necessary references to the subkey nodes during key lookup. However, you may notice that a full-string hash isn&#39;t really compatible with the concept of binary search, and indeed, whenever a hash leaf is used, the kernel performs a linear search instead of a binary one, as can be seen in the corresponding CmpFindSubKeyByHashWithStatus function. In theory, this could lead to iterating through 65535 keys (the maximum number of entries in a hash leaf), but in practice, the kernel makes sure that a hash leaf is never longer than 1012 elements. This is okay for performance, because when more subkeys are associated with a key, a second-level data structure comes into play (the root index, see the next section), and that one is always traversed with a binary search. Overall, it seems possible that the cache friendliness of the hash leaf makes up for its theoretically worse lookup complexity, especially in the average case.</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">A corresponding diagram of a hash leaf data layout is shown below:</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjSJ-jlTLvArbHK0iIrfnYUFm0rFVw3APRQuN8TYOVhUPhUEFNPHbOik1OgSb5VjWWwM79gJf4CUHQKZCrz8nPdMjFUgTNs2N1kT3xFcIeBLo9dd0UHSMTd1WDiS0Qk5OAeDK_GANlMrx4yeTMVP7JaJmY1OQtHI3_SXMEdCfNw0JLbBaA12eeamo6_4HM/s1999/image15.png" style="display: block; padding: 1em 0;text-align: center;"><img alt="Image showing hash leaf data layout as described above" border="0" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjSJ-jlTLvArbHK0iIrfnYUFm0rFVw3APRQuN8TYOVhUPhUEFNPHbOik1OgSb5VjWWwM79gJf4CUHQKZCrz8nPdMjFUgTNs2N1kT3xFcIeBLo9dd0UHSMTd1WDiS0Qk5OAeDK_GANlMrx4yeTMVP7JaJmY1OQtHI3_SXMEdCfNw0JLbBaA12eeamo6_4HM/s1200/image15.png" style="max-height: 750px; max-width: 600px;" title="Image showing hash leaf data layout as described above" /></a></span></p><h5 class="MvcjwGOuIU-c6" id="h.qzriz5zhg5yz"><span class="MvcjwGOuIU-c31 MvcjwGOuIU-c36">Root indexes</span></h5>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span>Each key in the registry can potentially have many thousands of subkeys, but having them stored in one very long list (such as a single index, fast or hash leaf) could lead to poor performance for some operations. For example, whenever a new key is inserted into the alphabetically sorted list, the portion of the list </span><span class="MvcjwGOuIU-c10">after</span><span class="MvcjwGOuIU-c0">&nbsp;the new key has to be moved in memory to make room for the new item. Similar CPU-heavy situations could arise when extending the dynamically sized array in the hive, and potentially having to copy its entire contents to a new cell if the existing one doesn&#39;t have any free space behind it. In the worst case scenario, this would have a complexity of O(n) per operation, which is too slow for such an important system mechanism as the Windows registry.</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span>It is likely for this reason that whenever the subkey list becomes longer than 1012 elements for the first time, a second-level index called the </span><span class="MvcjwGOuIU-c10">root index</span><span class="MvcjwGOuIU-c0">&nbsp;is inserted into the data structure. This has the goal of splitting a single long list into several shorter ones, which are easier to manage in memory. Root indexes cannot be nested or referenced recursively by one another: a subkey list may either be non-existent, a single leaf-type list, or a single root index pointing at leaf-type lists (in other words, the list may be 0, 1 or 2 levels deep).</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">The root index has existed for as long as the index leaves have: since the very first regf version 1.0 in Windows NT 3.1 Pre-Release. It also has the same layout represented by the _CM_KEY_INDEX structure, which consists of a signature (&#39;ri&#39; in this case), a 16-bit count and an array of cell indexes pointing at leaf-type lists, without any additional hints. An example diagram of a two-level subkey index containing five keys is shown below:</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjWjDioDrxKadIbSrn48slGPbLJVi4YcOls62a4ruBHalts-KBFnJOO4NyUEqdtze-EyWCtBdrJSMrbaPNx0E3O1s2d3hWqbYV_6pwjmIW-rctVdnfn6dbIdEo7hyPjPr2yePJOtA6xOA2D_v_BPVVEnH-M2AMaKhrMtrTZBF4UWywvboQURcrYKNXWfAQ/s1999/image13.png" style="display: block; padding: 1em 0;text-align: center;"><img alt="An image showing an example diagram of a two-level subkey index containing five keys" border="0" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjWjDioDrxKadIbSrn48slGPbLJVi4YcOls62a4ruBHalts-KBFnJOO4NyUEqdtze-EyWCtBdrJSMrbaPNx0E3O1s2d3hWqbYV_6pwjmIW-rctVdnfn6dbIdEo7hyPjPr2yePJOtA6xOA2D_v_BPVVEnH-M2AMaKhrMtrTZBF4UWywvboQURcrYKNXWfAQ/s1200/image13.png" style="max-height: 750px; max-width: 600px;" title="An image showing an example diagram of a two-level subkey index containing five keys" /></a></span></p><h5 class="MvcjwGOuIU-c6" id="h.ntqwzflppmk9"><span class="MvcjwGOuIU-c31 MvcjwGOuIU-c36">Fundamental subkey list consistency requirements</span></h5>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">There is a set of some very basic format consistency requirements concerning subkey indexes, which must be always met for any active hive in the system, regardless of whether it has been loaded from disk or created from scratch at runtime. These are the minimum set of rules for this data structure to be considered as &quot;valid&quot;, and they are tightly connected to the memory safety guarantees of the kernel functions that operate on them. They are as follows:</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p><ul style="padding: 0;" class="lst-kix_9fzrrhqm4j52-0 start"><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c0">The signature of each subkey list cell must be correctly set to its corresponding type, one of &#39;li&#39;, &#39;lf&#39;, &#39;lh&#39; or &#39;ri&#39;.</span></li><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c0">The size of the cell must be greater or equal to the number of bytes required to store all of the elements in the &quot;List&quot; array, according to the value of the &quot;Count&quot; member.</span></li><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c0">A subkey list cell may never be empty, i.e. _CM_KEY_INDEX.Count mustn&#39;t be zero (whenever it becomes zero, it should be freed and un-referenced in any of the other hive cells).</span></li><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c0">The number of subkeys cached in the key node (_CM_KEY_NODE.SubKeyCounts[x]) must be equal to the number of subkeys defined in the subkey index (i.e. the sum of _CM_KEY_INDEX.Count of its index leaves).</span></li><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c0">The cell indexes stored in _CM_KEY_NODE.SubKeyLists[x] must either be HCELL_NIL (if SubKeyCounts[x] is zero), or point to a root index or one of the three leaf types. Additionally, SubKeyCounts[1] must be zero and SubKeyLists[1] must be HCELL_NIL on hive load.</span></li><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c0">All cell indexes stored in a root index must point at valid leaf indexes.</span></li><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c0">All cell indexes stored in leaf indexes must point at valid key nodes.</span></li><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c0">All hints specified in the fast leaves and hash leaves must be consistent with the names of their corresponding keys.</span></li><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span>The overall subkey list must be sorted lexicographically, i.e. the name of each n+1</span><span class="MvcjwGOuIU-c41">th</span><span>&nbsp;subkey must be strictly greater than the name of the n</span><span class="MvcjwGOuIU-c41">th</span><span class="MvcjwGOuIU-c0">&nbsp;subkey. This also entails that there mustn&#39;t be any duplicates in the subkey list, neither with regards to the cell index or the subkey name.</span></li></ul>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span>Notably, there are also some constraints that seem very natural, but are in fact </span><span class="MvcjwGOuIU-c15">not</span><span class="MvcjwGOuIU-c0">&nbsp;enforced by the Windows kernel:</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p><ul style="padding: 0;" class="lst-kix_ne238lfomw56-0 start"><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c0">There is no requirement that the format of a leaf-type index must be consistent with the version of the hive: instead, every one of li/lf/lh types are accepted for every hive version 1.3 &ndash; 1.6. The most glaring example of this behavior is that hash leaves are allowed in hive versions 1.3 and 1.4, even though they were historically only introduced in version 1.5 of the format.</span></li><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c0">There is no requirement that all the leaf indexes referenced by a root index are all of the same type. In fact, a single subkey list may consist of an arbitrary combination of index leaves, fast leaves and hash leaves, and the kernel must handle such situations gracefully.</span></li><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c0">Beyond the fact that none of the actively used subkey indexes may be empty, there are no limitations with regards to how the subkeys are laid out in the data structure. For example, the existence of a root index doesn&#39;t automatically indicate that there are many subkeys on the list: there may as well be a single root index, pointing to a single leaf, containing a single subkey. It is also allowed for several leafs being part of a single root index to have wildly different counts, with some single-digit ones coexisting with others around the 64K mark. The kernel doesn&#39;t ensure any advanced &quot;balancing&quot; of the subkey index by default &ndash; it does split large leafs into smaller ones, but only while adding a new subkey, and not during the loading of an existing hive.</span></li></ul>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span>Three examples of kernel vulnerabilities that were directly related to the handling of subkey lists are: </span><span class="MvcjwGOuIU-c8"><a href="https://project-zero.issues.chromium.org/issues/42451449">CVE-2022-37956</a></span><span>&nbsp;(integer overflows in registry subkey lists leading to memory corruption), </span><span class="MvcjwGOuIU-c8"><a href="https://project-zero.issues.chromium.org/issues/42451465">CVE-2022-38037</a></span><span>&nbsp;(memory corruption due to type confusion of subkey index leaves in registry hives) and </span><span class="MvcjwGOuIU-c8"><a href="https://project-zero.issues.chromium.org/issues/42451661">CVE-2024-26182</a></span><span>&nbsp;(subkey list use-after-free due to mishandling of partial success in CmpAddSubKeyEx). I personally find the first one (CVE-2022-37956) particularly interesting, because the hive memory corruption could be triggered with the right sequence of API calls, or even just command-line reg.exe tool invocations. Granted that the number of required operations was quite high (around 66 million), but it still goes to show that being intimately familiar with the inner workings of the target software may open new avenues of exploitation that would otherwise not be available. For a detailed explanation of the subkey list management logic, see the next section.</span></p><h5 class="MvcjwGOuIU-c6" id="h.ef3jra69re3b"><span class="MvcjwGOuIU-c31 MvcjwGOuIU-c36">Internal Windows logic of handling subkey lists</span></h5>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span>On top of the requirements and restrictions imposed by the regf format itself, there are some further characteristics of most registry hives found on real systems, caused by some decisions implemented in the logic of the Windows kernel. The most important thing to note is that, as mentioned above, the kernel operates on any subkey list </span><span class="MvcjwGOuIU-c10">lazily</span><span class="MvcjwGOuIU-c0">, only when there is a need to do so due to a key being added/deleted in the registry. Therefore, a weirdly formatted (but adhering to the bare regf requirements) subkey index will remain in this state after loading, for as long as a client application doesn&#39;t decide to change it.</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">Most of the relevant high-level logic of handling subkey lists takes place when adding new keys, and is illustrated in the flow chart below:</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgK4FzEO7DB1fgLZ96e54QiXFtGiXuQIuXZDq6WCo-MSWWPBmYF70XVTr4iDGRx9YVhQhpEvcVC5fbBzWjjMPTMl9HFYaBvO5bVgLvps6cFhOSi-6GjyAh21FZkfMTWHOrPBS813mxVaguSBeOVejinIUwG_zyqzo89apHwtN8d8QMso2zluEw0kfA6gq4/s1999/image12.png" style="display: block; padding: 1em 0;text-align: center;"><img alt="Complex flow chart describing the high-level logic handling of the subkey lists when ading new keys" border="0" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgK4FzEO7DB1fgLZ96e54QiXFtGiXuQIuXZDq6WCo-MSWWPBmYF70XVTr4iDGRx9YVhQhpEvcVC5fbBzWjjMPTMl9HFYaBvO5bVgLvps6cFhOSi-6GjyAh21FZkfMTWHOrPBS813mxVaguSBeOVejinIUwG_zyqzo89apHwtN8d8QMso2zluEw0kfA6gq4/s1200/image12.png" style="max-height: 750px; max-width: 600px;" title="Complex flow chart describing the high-level logic handling of the subkey lists when ading new keys" /></a></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">The general high-level function that implements the above logic in the Windows kernel is CmpAddSubKeyEx, which then calls a few helper routines with mostly self-descriptive names: CmpAddSubKeyToList, CmpSelectLeaf, CmpSplitLeaf and CmpAddToLeaf. Compared to addition, the process of deleting a key from the list is very straightforward, and is achieved by removing it from the respective leaf index, freeing the leaf if it was the last remaining element, and freeing the root index if it was present and the freed leaf was its last remaining element. There are no special steps being taken other than the strictly necessary ones to implement the functionality.</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">Given the above, we can conclude that registry hives created organically by Windows generally adhere to the following set of extra rules:</span></p><ul style="padding: 0;" class="lst-kix_9iss8y571b2b-0 start"><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c0">The leaf types being used are in line with the version of the hive: index and fast leaves for versions &le;1.4, and hash leaves for versions &ge;1.5.</span></li><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c0">All leaves within a single index root have the same type.</span></li><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c0">Index leaves never contain more than 1012 elements.</span></li><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c0">Once a root index is created for a key, it is never downgraded back to a single leaf index other than through the deletion of all subkeys, and creating a new one starting from an empty subkey list.</span></li></ul><h4 class="MvcjwGOuIU-c18 MvcjwGOuIU-c12" id="h.dkhewrmaf4ey"><span class="MvcjwGOuIU-c19 MvcjwGOuIU-c17">Security descriptors</span></h4>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">Security descriptors play a central role in enforcing access control to the information stored in the registry. Their significance is apparent through the fact that they are the only mandatory property of registry keys, as opposed to classes, values and subkeys which are all optional. At the same time, large groups of keys typically share the same security settings, so it would make little sense to store a separate copy of the data for every one of them. For example, in a default installation of Windows 11, the SOFTWARE hive includes around 250,000 keys but only around 500 unique security descriptors. This is why they are the only type of cell in the hive that can be associated with multiple keys at the same time. By only storing a single instance of each unique descriptor in the hive, the system saves significant disk and memory space. However, this efficiency requires careful management of each descriptor&#39;s usage through reference counting, which ensures they can be safely freed when no longer needed.</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">When loading a hive, the kernel enumerates all of its security descriptors without having to traverse the entire key tree first. In order to make this possible, security descriptors in the stable space are organized into a doubly-linked list, starting at the descriptor of the root key. Internal consistency of this list is mandatory &ndash; if any inconsistencies are found, it is reset to become a single-entry list with just the root security descriptor and nothing else. If the root security descriptor itself is corrupted, the hive is deemed to be in an unrecoverable state and rejected completely.</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span>While traversing the global list, the kernel also verifies that the binary encoding of the security descriptors is valid and safe to pass to internal security-related functions later in time. In the hives, descriptors are formatted as self-contained blobs of bytes adhering to the SECURITY_DESCRIPTOR_RELATIVE structure layout. Compared to other hive cells (key nodes etc.), the internal format of security cells is relatively complex: it is variable in size and contains multiple sub-structures (SIDs, ACLs, ACEs), length indicators and internal offsets. To detect any potential corruption early, the </span><span class="MvcjwGOuIU-c8"><a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/wdm/nf-wdm-rtlvalidrelativesecuritydescriptor">RtlValidRelativeSecurityDescriptor</a></span><span class="MvcjwGOuIU-c0">&nbsp;function must succeed for every descriptor in a newly loaded hive, otherwise the previously discussed fallback logic takes place.</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">The last step in the security descriptor validation process is to make sure that the reference counts specified in the hive are equal to the actual number of references from registry keys. This is achieved by re-counting the references when traversing the key tree structure of the hive, and later checking if the values found in _CM_KEY_SECURITY.ReferenceCount are in line with the regenerated counts. If the two values are unequal, the refcount in the security cell is adjusted to reflect the correct number of references. This is critical for system security, because operating on an invalid refcount &ndash; especially an inadequately small one &ndash; may directly lead to exploitable memory corruption conditions.</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">Some examples of historical vulnerabilities related to the three fundamental aspects of security descriptor consistency are as follows:</span></p><ul style="padding: 0;" class="lst-kix_iivgfpfdl0t3-0 start"><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c15">Linked list consistency:</span><span>&nbsp;</span><span class="MvcjwGOuIU-c8"><a href="https://project-zero.issues.chromium.org/issues/42451425">CVE-2022-34708</a></span><span>, </span><span class="MvcjwGOuIU-c8"><a href="https://github.com/googleprojectzero/p0tools/tree/master/WinRegLowSeverityBugs/Reports/13_CmpLightWeightPrepareSetSecDescUoW_security_list_confusion">CVE-2024-26178</a></span></li><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c15">Security descriptor binary format validity:</span><span>&nbsp;</span><span class="MvcjwGOuIU-c8"><a href="https://project-zero.issues.chromium.org/issues/42451427">CVE-2022-35768</a></span></li><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c15">Reference counting:</span><span>&nbsp;</span><span class="MvcjwGOuIU-c8"><a href="https://project-zero.issues.chromium.org/issues/42451423">CVE-2022-34707</a></span><span>, </span><span class="MvcjwGOuIU-c8"><a href="https://project-zero.issues.chromium.org/issues/42451552">CVE-2023-28248</a></span><span>, </span><span class="MvcjwGOuIU-c8"><a href="https://project-zero.issues.chromium.org/issues/42451596">CVE-2023-35356</a></span><span>, </span><span class="MvcjwGOuIU-c8"><a href="https://project-zero.issues.chromium.org/issues/42451592">CVE-2023-35382</a></span><span>, </span><span class="MvcjwGOuIU-c8"><a href="https://project-zero.issues.chromium.org/issues/42451601">CVE-2023-38139</a></span></li></ul>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">A high-level illustration of a security descriptor linked list consisting of three elements is shown in the diagram below:</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjqTXWpBsQlSXs9DvSD8-xRXOpsZxH_n6U8a_qWbDBZE1mshkUwtD5b0x9OvxGTBtOR3mP6b6Xl0qRqRFtQ_3YFMC2ma6agYAicSzefN-iMcJOUS0keIdBbyYrGZoy144hS0vBLjBY3AJIfnZ-P6EP5fk2uMHKfRXzj7cnb4-dQCpiQcjb1hbVxWPG7W7U/s1999/image1.png" style="display: block; padding: 1em 0;text-align: center;"><img alt="A high-level illustration of a security descriptor linked list consisting of three elements" border="0" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjqTXWpBsQlSXs9DvSD8-xRXOpsZxH_n6U8a_qWbDBZE1mshkUwtD5b0x9OvxGTBtOR3mP6b6Xl0qRqRFtQ_3YFMC2ma6agYAicSzefN-iMcJOUS0keIdBbyYrGZoy144hS0vBLjBY3AJIfnZ-P6EP5fk2uMHKfRXzj7cnb4-dQCpiQcjb1hbVxWPG7W7U/s1200/image1.png" style="max-height: 750px; max-width: 600px;" title="A high-level illustration of a security descriptor linked list consisting of three elements" /></a></span></p><h5 class="MvcjwGOuIU-c6" id="h.r9p9c8l63o18"><span class="MvcjwGOuIU-c31 MvcjwGOuIU-c36">Security cell format</span></h5>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">Let&#39;s now have a look at the specific layout of the security cells. They are represented by the _CM_KEY_SECURITY structure, whose definition is shown in the WinDbg format below:</span></p>
 <p class="MvcjwGOuIU-c5 MvcjwGOuIU-c11"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c5"><span></span><span class="MvcjwGOuIU-c1">0:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">kd&gt;</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">dt</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">_CM_KEY_SECURITY</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1">nt!_CM_KEY_SECURITY</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x000</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Signature</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Uint2B</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x002</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Reserved</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Uint2B</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x004</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Flink</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Uint4B</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x008</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Blink</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Uint4B</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x00c</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">ReferenceCount</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Uint4B</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x010</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">DescriptorLength</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Uint4B</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x014</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Descriptor</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">_SECURITY_DESCRIPTOR_RELATIVE</span></p>
 <br/>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">Each of its fields is discussed in more detail in the following subsections.</span></p><h6 class="MvcjwGOuIU-c6" id="h.mfy9mbjgevi6"><span class="MvcjwGOuIU-c10 MvcjwGOuIU-c31">Signature</span></h6>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">The magic bytes of this cell type, equal to 0x6B73 (&#39;sk&#39;). It exists for informational purposes only, but isn&#39;t used for anything at runtime &ndash; it isn&#39;t even verified on hive load, and can therefore be anything in a binary-controlled hive.</span></p><h6 class="MvcjwGOuIU-c6" id="h.dwoz22ke8el2"><span class="MvcjwGOuIU-c31 MvcjwGOuIU-c10">Reserved</span></h6>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c0">An unused field that may contain arbitrary data; never accessed by the kernel.</span></p><h6 class="MvcjwGOuIU-c6" id="h.l1kufiaunyw7"><span class="MvcjwGOuIU-c31 MvcjwGOuIU-c10">Flink and Blink</span></h6>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">As discussed earlier, these are the forward and backward links in the security descriptor list. They must always be kept in a valid state. In a single-element list, Flink/Blink point at themselves &ndash; that is, at the security descriptor they are both part of.</span></p><h6 class="MvcjwGOuIU-c6" id="h.8x3wal5fuqxs"><span class="MvcjwGOuIU-c31 MvcjwGOuIU-c10">ReferenceCount</span></h6>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">This single field was arguably responsible for the most registry-related vulnerabilities out of all of the hive structures. It is a 32-bit unsigned integer that expresses the number of objects that actively rely on this security descriptor, which mostly means the key nodes associated with it, but not only. Whenever this member gets out of sync with the real number of references, it may lead to serious memory corruption primitives, so it is very important that the kernel ensures its correct value both on hive load and during any subsequent operations. The two prevalent risks are that:</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p><ul style="padding: 0;" class="lst-kix_s8ghxl62e844-0 start"><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c15">The refcount gets too small:</span><span class="MvcjwGOuIU-c0">&nbsp;when this happens, it is possible that the cell gets freed while some objects still hold active references to it. This leads to a straightforward use-after-free scenario, and in my experience, it is easily exploitable by a local attacker.</span></li><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c15">The refcount gets too large:</span><span>&nbsp;this situation doesn&#39;t immediately lead to memory corruption, but let&#39;s remember that the structure member has a limited, 32-bit width. If an attacker were able to indiscriminately increment the counter without real references to back it up, they could eventually get it to the maximum uint32 value, 0xFFFFFFFF. For many years, the Windows kernel hasn&#39;t implemented any protection against registry refcount integer overflows, so another incrementation of the field after 0xFFFFFFFF would wrap it back to zero, which brings us to the previous scenario of an inadequately small count. However, following some bug reports and discussions, Microsoft has gradually added overflow protection in the relevant, internal functions, starting in April 2023 and eventually </span><span>landing the last missing check in November 2024</span><span class="MvcjwGOuIU-c0">. Thanks to this effort, I believe that as I am writing this, security descriptor refcount leaks should no longer be an exploitable condition.</span></li></ul>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span>Under most circumstances, the value of the refcount is somewhere between 1 and ~24.4 million (the maximum number of keys in a hive given the space constraints). However, it is interesting to note that it might be legitimately set to a greater value. Consider the following: immediately after loading a hive, all security </span><span>refcounts</span><span>&nbsp;are exactly equal to the number of keys associated with them. But, key nodes globally visible in the registry tree are not the only ones that can reference security cells; there may be also keys that have been created in the scope of a transaction and not committed yet, as well as pending, transacted operations of changing the security properties of a key (marked by the UoWAddThisKey and UoWSetSecurityDescriptor enums of type UoWActionType). They too may increase the refcount value beyond what would normally be possible with just regular, non-transacted keys. This phenomenon has been discussed in detail in the </span><span class="MvcjwGOuIU-c8"><a href="https://project-zero.issues.chromium.org/issues/42451732">CVE-2024-43641</a></span><span class="MvcjwGOuIU-c0">&nbsp;bug report.</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">Overall, reference counts are of great importance to system security, and every registry operation that involves it deserves a thorough security assessment.</span></p><h6 class="MvcjwGOuIU-c6" id="h.5rhr08m9my8b"><span class="MvcjwGOuIU-c31 MvcjwGOuIU-c10">DescriptorLength</span></h6>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span>This is the length of the security descriptor data (i.e. the size of the Descriptor array) expressed in bytes. It&#39;s worth noting that the format doesn&#39;t force it to be the </span><span class="MvcjwGOuIU-c10">minimum</span><span class="MvcjwGOuIU-c0">&nbsp;length sufficient to store the binary blob. This means that the overall cell length must be greater than DescriptorLength + 20 (i.e. the declared length of the descriptor plus the _CM_KEY_SECURITY header), and in turn DescriptorLength must be greater than the actual size of the descriptor. Both cases of the cell size or the DescriptorLength having non-optimal values are accepted by the kernel, and the extra bytes are ignored.</span></p><h6 class="MvcjwGOuIU-c6" id="h.xcmzwshz9wih"><span class="MvcjwGOuIU-c31 MvcjwGOuIU-c10">Descriptor</span></h6>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span>This variable-length array stores the actual security descriptor in the form of the SECURITY_DESCRIPTOR_RELATIVE structure. It doesn&#39;t necessarily have to be formatted in the most natural way, and the only requirement is that it successfully passes the </span><span class="MvcjwGOuIU-c8"><a href="https://learn.microsoft.com/en-us/windows-hardware/drivers/ddi/wdm/nf-wdm-rtlvalidrelativesecuritydescriptor">RtlValidRelativeSecurityDescriptor</a></span><span>&nbsp;check</span><span>&nbsp;with the RequiredInformation argument set to zero. This means, for example, that the Owner/Group/Sacl/Dacl components may be spread out in memory and have gaps in between them, or conversely, that their representations may overlap. This was one of the main contributing factors in </span><span class="MvcjwGOuIU-c8"><a href="https://project-zero.issues.chromium.org/issues/42451427">CVE-2022-35768</a></span><span class="MvcjwGOuIU-c0">, but the fix was to more accurately calculate the length of irregularly-encoded descriptors, and the freedom to structure them in non-standard ways has remained. It is even possible to use a completely empty descriptor without any owner or access control entries, and such a construct will be acknowledged by the system, too.</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">Another somewhat interesting fact is that security descriptors are meant to be deduplicated, so naturally whenever a user assigns a security descriptor that already exists in the hive, it is simply reused and its reference count is incremented. However, again, the format (or rather its canonical implementation in Windows) doesn&#39;t force the uniqueness requirement upon the security descriptors in hives loaded from disk. So, even though they would be never created by the OS itself, multiple identical copies of a descriptor are allowed in specially crafted hives and may co-exist without (seemingly) causing any issues for the kernel.</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span>The access rights defined by the security descriptors are based on permissions specific to the registry and its operations, so there is an access mask dedicated to creating keys (KEY_CREATE_SUB_KEY), reading values (KEY_QUERY_VALUE), writing values (KEY_SET_VALUE), and so on. They all have self-descriptive names and are well-documented in </span><span class="MvcjwGOuIU-c8"><a href="https://learn.microsoft.com/en-us/windows/win32/sysinfo/registry-key-security-and-access-rights">Registry Key Security and Access Rights</a></span><span>, so we won&#39;t spend more time discussing them here.</span></p><h5 class="MvcjwGOuIU-c6" id="h.bfgfaqbruhk4"><span class="MvcjwGOuIU-c31 MvcjwGOuIU-c36">Security descriptors of volatile keys</span></h5>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span>Similarly to every other property of a registry key, the storage type of a security descriptor always matches the type of its associated key(s). This means that a stable key will always use a stable descriptor, and a volatile key &ndash; a volatile descriptor. It is the only &quot;exception&quot; to the rule that security descriptors are deduplicated and unique within the scope of the hive. If there are two keys with identical security settings but different storage types, they will reference two distinct security descriptor cells via their _CM_KEY_NODE.Security fields, one with the highest bit set and the other with the bit clear. The </span><span>descriptors</span><span class="MvcjwGOuIU-c0">&nbsp;stored on both sides are subject to the same rules with regards to reference counting, allocating and freeing.</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">Furthermore, we have previously discussed how all security descriptors in a hive are connected in one global doubly-linked list, but this only applies to the descriptors in the stable space. The functionality is needed so that the descriptors can be enumerated by the kernel when loading a hive from disk, and since volatile descriptors are in-memory only and disappear together with their corresponding keys on hive unload or a system shutdown, there is no need to link them together. The internal CmpInsertSecurityCellList function takes this into account, and points the Flink/Blink fields at themselves, making each volatile descriptor a single-entry list in order to keep it compatible with the list linking/unlinking code. This behavior is illustrated in the diagram below, with two volatile security descriptors each being in their own pseudo-list:</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjFvU_lKPXAXNcaDpkFMhxssobFSIMemew9rQ21RFY-nGjVmKns8vvv60C6dKpxixMtkHG6l_Macrlpck03gUskUCkfq4b-yEXDog6a3gQeP4KhT0vnfmk7SDLoFLVBthjzkH-RiZ7OY5O5YXuTACqGv32p8gbs8zo9cQKD-w2pG6DMmI3ornrG9z9xDLU/s1999/image9.png" style="display: block; padding: 1em 0;text-align: center;"><img alt="Diagram described in the paragraph above, showing two security descripitors capybara and sloth" border="0" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjFvU_lKPXAXNcaDpkFMhxssobFSIMemew9rQ21RFY-nGjVmKns8vvv60C6dKpxixMtkHG6l_Macrlpck03gUskUCkfq4b-yEXDog6a3gQeP4KhT0vnfmk7SDLoFLVBthjzkH-RiZ7OY5O5YXuTACqGv32p8gbs8zo9cQKD-w2pG6DMmI3ornrG9z9xDLU/s1200/image9.png" style="max-height: 750px; max-width: 600px;" title="Diagram described in the paragraph above, showing two security descripitors capybara and sloth" /></a></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span>This slight quirk is the reason why the ability to create stable keys under volatile ones, which should normally not be possible, may be an exploitable condition with security impact. For details, see the &quot;Creation of stable subkeys under volatile keys&quot; section in the </span><span class="MvcjwGOuIU-c8"><a href="https://project-zero.issues.chromium.org/issues/42451512">CVE-2023-21748</a></span><span>&nbsp;bug report, or the </span><span class="MvcjwGOuIU-c8"><a href="https://github.com/googleprojectzero/p0tools/tree/master/WinRegLowSeverityBugs/Reports/04_Transacted_stable_under_volatile_keys">CVE-2024-26173</a></span><span class="MvcjwGOuIU-c0">&nbsp;bug report.</span></p><h5 class="MvcjwGOuIU-c6" id="h.y8671eqji3r0"><span class="MvcjwGOuIU-c31 MvcjwGOuIU-c36">Security descriptors in app hives</span></h5>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span>In normal registry hives, there are no artificial restrictions with regards to security descriptors. There may be an arbitrary number of them, and they may contain any type of settings the user wishes, as long as they have binary control over the hive file and/or the existing security descriptors grant them the access to change them to whatever they want. However, there are some limitations concerning security descriptors in application hives, as documented in the MSDN page of the </span><span class="MvcjwGOuIU-c8"><a href="https://learn.microsoft.com/en-us/windows/win32/api/winreg/nf-winreg-regloadappkeya">RegLoadAppKeyA</a></span><span class="MvcjwGOuIU-c0">&nbsp;function:</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p><table class="MvcjwGOuIU-c28"><tr class="MvcjwGOuIU-c4"><td class="MvcjwGOuIU-c35" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c10">All keys inside the hive must have the same security descriptor, otherwise the function will fail. This security descriptor must grant the caller the access specified by the samDesired parameter or the function will fail. You cannot use the RegSetKeySecurity function on any key inside the hive.</span></p></td></tr></table>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c10 MvcjwGOuIU-c13"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span>The intent behind the quote seems to be that the security settings within an app hive should be uniform and immutable; that is, remain identical to their initial state at hive creation, and consistent across all keys. There is indeed some truth to the documentation, as trying to change the security of a key within an app hive with </span><span class="MvcjwGOuIU-c8"><a href="https://learn.microsoft.com/en-us/windows/win32/api/winreg/nf-winreg-regsetkeysecurity">RegSetKeySecurity</a></span><span>, or to create a new key with a custom descriptor both result in a failure with STATUS_ACCESS_DENIED. However, the part about all keys having the same security descriptor is not actually enforced, and a user can freely load an app hive with any number of different security descriptors associated with the keys. This was reported to Microsoft as </span><span class="MvcjwGOuIU-c8"><a href="https://github.com/googleprojectzero/p0tools/tree/master/WinRegLowSeverityBugs/Reports/20_App_hive_security_inconsistencies">WinRegLowSeverityBugs issue #20</a></span><span>, but wasn&#39;t deemed severe enough to be addressed in a security bulletin (which I agree with), so for now, it remains an interesting discrepancy between the documentation and implementation.</span></p><h4 class="MvcjwGOuIU-c18 MvcjwGOuIU-c12" id="h.qvnu3wyx38ie"><span class="MvcjwGOuIU-c19 MvcjwGOuIU-c17">Key values and value lists</span></h4>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">While keys allow software to create a data organization hierarchy, values are the means of actually storing the data. Each value is associated with one specific key, and is characterized by the following properties:</span></p><ul style="padding: 0;" class="lst-kix_qst1zha6rauh-0 start"><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c0">Name</span></li><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c0">Type</span></li><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c0">Data</span></li></ul>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">In general, values are much simpler than keys. To begin with, they are not a full-fledged object in the NT Object Manager sense: you cannot open a handle to a value, and thus you may only access them through the handle of its associated key and its name. They also don&#39;t have dedicated security descriptors, so a client with a key handle with the KEY_QUERY_VALUE access can enumerate and read all values of the key, and the KEY_SET_VALUE rights allows the caller to create/modify/delete all values within a key. For these reasons, values are best thought of as elaborate attributes of a key, not as an independent entity. </span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">There is no fixed limit on the number of values associated with a key other than the available hive space, which places the number at around 67 million (0x80000000 &divide; 0x20, the hive space divided by the minimum value cell size). The value list format is also not as optimized as the subkey index is: it is a linear, single-level list with just the raw value cell indexes, without any additional metadata like a header or hints. The list is not sorted either, and their order is defined by when they were added to the key. Finally, value name uniqueness is guaranteed on output, but not enforced on input: it is possible to load a specially crafted hive with several values with the same name, and contrary to duplicate keys, this doesn&#39;t seem to pose any fundamental problems for the registry implementation.</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">A high-level overview of the hive cells related to a key&#39;s value list is shown below:</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEi-kkqHETa7hxjybGBjyP5n8vSsLqW5_62Y5wh6_0TumJfzZ02N3o3EJplOm34WUH2Aosppu38CHWJxaTZ4HWdpcivVAbr7Y60kmawVkTEQaZ47oRr3MuW-3TNhi_9EkySX5d8fBCQQvAGtQIkTpBgSFt8dMCaMKnAaZb160I1epSQtF7oJZeCXBwbLLnI/s1999/image2.png" style="display: block; padding: 1em 0;text-align: center;"><img alt="Diagram showing the high-level overview of the hive cells related to a key&#39;s value list" border="0" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEi-kkqHETa7hxjybGBjyP5n8vSsLqW5_62Y5wh6_0TumJfzZ02N3o3EJplOm34WUH2Aosppu38CHWJxaTZ4HWdpcivVAbr7Y60kmawVkTEQaZ47oRr3MuW-3TNhi_9EkySX5d8fBCQQvAGtQIkTpBgSFt8dMCaMKnAaZb160I1epSQtF7oJZeCXBwbLLnI/s1200/image2.png" style="max-height: 750px; max-width: 600px;" title="Diagram showing the high-level overview of the hive cells related to a key&#39;s value list" /></a></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">In the next section, we will examine the internal layout and semantics of the _CM_KEY_VALUE structure, which describes each unique value in the registry.</span></p><h5 class="MvcjwGOuIU-c6" id="h.md1n4l1tdhgp"><span class="MvcjwGOuIU-c31 MvcjwGOuIU-c36">The key value cell</span></h5>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">As usual, we can print out the structure definition in WinDbg:</span></p>
 <p class="MvcjwGOuIU-c5 MvcjwGOuIU-c11"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c5"><span></span><span class="MvcjwGOuIU-c1">0:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">kd&gt;</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">dt</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">_CM_KEY_VALUE</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1">nt!_CM_KEY_VALUE</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x000</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Signature</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Uint2B</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x002</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">NameLength</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Uint2B</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x004</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">DataLength</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Uint4B</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x008</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Data</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Uint4B</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x00c</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Type</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Uint4B</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x010</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Flags</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Uint2B</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x012</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Spare</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Uint2B</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x014</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Name</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">[1]</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Wchar</span></p>
 <br/>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">Let&#39;s examine each field more closely.</span></p><h6 class="MvcjwGOuIU-c6" id="h.ig8smlupo50p"><span class="MvcjwGOuIU-c31 MvcjwGOuIU-c10">Signature</span></h6>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">It identifies the cell as a key value, and must be equal to 0x6B76 (&#39;vk&#39;). It is verified during hive load, but isn&#39;t used for anything else later on.</span></p><h6 class="MvcjwGOuIU-c6" id="h.6xxe04et4aif"><span class="MvcjwGOuIU-c31 MvcjwGOuIU-c10">NameLength and Name</span></h6>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">The combination of these two fields specifies the name of the value: NameLength indicates the length of the string in bytes, and Name is an inline, variable-length buffer that stores the name itself. Let&#39;s consider the same criteria of the name that we have previously discussed in the context of registry keys:</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p><ul style="padding: 0;" class="lst-kix_30z58zep11nd-0 start"><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c15">Compression:</span><span class="MvcjwGOuIU-c0">&nbsp;Similarly to keys, value names may be compressed if the VALUE_COMP_NAME (0x1) flag is set in _CM_KEY_VALUE.Flags. In that case, the string is stored as 8-bit ASCII characters, otherwise the normal wide-character encoding is used.</span></li><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c15">Length:</span><span>&nbsp;The length of the name can be between 0 and </span><span class="MvcjwGOuIU-c8"><a href="https://learn.microsoft.com/en-us/windows/win32/sysinfo/registry-element-size-limits">16,383</a></span><span>&nbsp;characters. A length of zero indicates an alias for the value displayed by Regedit as &quot;(Default)&quot;, a remnant of the design from Windows 3.1 where data was assigned directly to keys. As a sidenote, the correct enforcement of the upper limit was only introduced in October 2022 as a fix for </span><span class="MvcjwGOuIU-c8"><a href="https://project-zero.issues.chromium.org/issues/42451478">CVE-2022-37991</a></span><span class="MvcjwGOuIU-c0">.</span></li><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c15">Charset:</span><span>&nbsp;All characters in the 0x0000 &ndash; 0xFFFF range are allowed in a value name, with no exceptions. Since values are not part of the same namespace as keys, this even includes backslashes. The only constraint is that if the corresponding key is a symbolic link, then the value must be named &quot;SymbolicLinkValue&quot;, as it has a special meaning and stores the link&#39;s target path. An example of a bug related to sanitizing value names was </span><span class="MvcjwGOuIU-c8"><a href="https://github.com/googleprojectzero/p0tools/tree/master/WinRegLowSeverityBugs/Reports/02_SymbolicLinkValue_OOB_read">CVE-2024-26176</a></span><span class="MvcjwGOuIU-c0">.</span></li><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c15">Uniqueness:</span><span class="MvcjwGOuIU-c0">&nbsp;Value name uniqueness is not enforced on input, but it is maintained by the kernel at runtime on a best-effort basis. That means that whenever setting a value, the system will always try to reuse an existing one with the same name before creating a new one. Similarly to keys, value lookup is performed in a case-insensitive manner, but the original casing is preserved and visible to the clients.</span></li></ul><h6 class="MvcjwGOuIU-c6" id="h.ykcjw0toop99"><span class="MvcjwGOuIU-c31 MvcjwGOuIU-c10">DataLength</span></h6>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">Specifies the length of the data stored in the value. The various ranges of the 32-bit space that the field can fall into are explained below:</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p><table class="MvcjwGOuIU-c28"><tr class="MvcjwGOuIU-c4"><td class="MvcjwGOuIU-c46" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c9 MvcjwGOuIU-c14">DataLength</span></p></td><td class="MvcjwGOuIU-c66 MvcjwGOuIU-c64" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c9 MvcjwGOuIU-c14">Hive versions &lt; 1.4</span></p></td><td class="MvcjwGOuIU-c25 MvcjwGOuIU-c64" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c9 MvcjwGOuIU-c14">Hive versions &ge; 1.4</span></p></td></tr><tr class="MvcjwGOuIU-c45"><td class="MvcjwGOuIU-c46" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">0x0</span></p></td><td class="MvcjwGOuIU-c48" colspan="2" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">Empty value, `Data` must be set to HCELL_NIL.</span></p></td></tr><tr class="MvcjwGOuIU-c45"><td class="MvcjwGOuIU-c46" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">0x1 &ndash; 0x3FD8</span></p></td><td class="MvcjwGOuIU-c48" colspan="2" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">Data stored directly in a backing cell pointed to by `Data`.</span></p></td></tr><tr class="MvcjwGOuIU-c45"><td class="MvcjwGOuIU-c46" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">0x3FD9 &ndash; 0xFFFFC</span></p></td><td class="MvcjwGOuIU-c59 MvcjwGOuIU-c66" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">Data stored directly in a backing cell pointed to by `Data`.</span></p></td><td class="MvcjwGOuIU-c25 MvcjwGOuIU-c59" colspan="1" rowspan="2">
 <p class="MvcjwGOuIU-c2"><span>Data split into 16344-byte chunks and saved in a </span><span class="MvcjwGOuIU-c10">big data</span><span class="MvcjwGOuIU-c0">&nbsp;object pointed to by `Data`.</span></p></td></tr><tr class="MvcjwGOuIU-c45"><td class="MvcjwGOuIU-c46" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">0xFFFFD &ndash; 0x3FD7C028</span></p></td><td class="MvcjwGOuIU-c66 MvcjwGOuIU-c53" colspan="1" rowspan="2">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">Invalid.</span></p></td></tr><tr class="MvcjwGOuIU-c45"><td class="MvcjwGOuIU-c46" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">0x3FD7C029 &ndash; 0x7FFFF000</span></p></td><td class="MvcjwGOuIU-c25 MvcjwGOuIU-c78" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span>Not accepted on input due to a 16-bit integer overflow in </span><span class="MvcjwGOuIU-c8"><a href="https://github.com/googleprojectzero/p0tools/tree/master/WinRegLowSeverityBugs/Reports/16_Registry_value_big_data_count_overflow">the </a></span><span class="MvcjwGOuIU-c8"><a href="https://github.com/googleprojectzero/p0tools/tree/master/WinRegLowSeverityBugs/Reports/16_Registry_value_big_data_count_overflow">big data chunk count</a></span><span class="MvcjwGOuIU-c0">. Feasible to set at runtime, but the saved data will be truncated due to the same bug / design limitation.</span></p></td></tr><tr class="MvcjwGOuIU-c45"><td class="MvcjwGOuIU-c46" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">0x7FFFF001 &ndash; 0x7FFFFFFF</span></p></td><td class="MvcjwGOuIU-c53 MvcjwGOuIU-c77" colspan="2" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">Invalid</span></p></td></tr><tr class="MvcjwGOuIU-c45"><td class="MvcjwGOuIU-c46" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">0x80000000 &ndash; 0x80000004</span></p></td><td class="MvcjwGOuIU-c48" colspan="2" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span>Between 0&ndash;4 bytes stored </span><span class="MvcjwGOuIU-c0">inline in the `Data` field.</span></p></td></tr><tr class="MvcjwGOuIU-c45"><td class="MvcjwGOuIU-c46" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">0x80000005 &ndash; 0xFFFFFFFF</span></p></td><td class="MvcjwGOuIU-c77 MvcjwGOuIU-c53" colspan="2" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">Invalid.</span></p></td></tr></table><h6 class="MvcjwGOuIU-c6" id="h.kbn4sli8fhs4"><span class="MvcjwGOuIU-c31 MvcjwGOuIU-c10">Data</span></h6>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">Responsible for storing or pointing to the data associated with the value. To summarize the table above, it can be in one or four states, depending on the data length and hive version:</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p><ol class="lst-kix_s5xocqmkj8s9-0 start" start="1"><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c15">Empty</span><span class="MvcjwGOuIU-c0">&nbsp;&ndash; equal to HCELL_NIL, if DataLength is 0.</span></li><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c15">Inline</span><span class="MvcjwGOuIU-c0">&nbsp;&ndash; stores up to four bytes in the Data member of the value cell itself, as indicated by DataLength &amp; 0x7FFFFFFF, if the highest bit of DataLength is set. As a side effect, an empty value can be represented in two ways: either as DataLength=0 or DataLength=0x80000000.</span></li><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c15">Raw data</span><span class="MvcjwGOuIU-c0">&nbsp;&ndash; points to a raw backing cell if Hive.Version &lt; 1.4 or DataLength &le; 0x3FD8.</span></li><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c15">Big data</span><span>&nbsp;&ndash; points to a big data structure introduced in hive version 1.4, which is capable of storing 0xFFFF &times; 0x3FD8 = 0x3FD7C028 bytes (a little under 1 GiB). More on big data cells in the section below.</span></li></ol><h6 class="MvcjwGOuIU-c6" id="h.a7cz3askjvhz"><span class="MvcjwGOuIU-c31 MvcjwGOuIU-c10">Type</span></h6>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span>This field is supposed to store one of the </span><span class="MvcjwGOuIU-c8"><a href="https://learn.microsoft.com/en-us/windows/win32/sysinfo/registry-value-types">supported value types</a></span><span class="MvcjwGOuIU-c0">, such as REG_DWORD, REG_BINARY, etc. We&#39;ll omit a thorough discussion of the official types, as we feel they are already well documented and understood. From a strictly technical point of view, though, it&#39;s important to note that the type is simply a hint, an extra piece of metadata that is available to a registry client with the intended purpose of indicating the nature of the value. However, Windows provides no guarantees with regards to the consistency between the value type and its data. For instance, a REG_DWORD value doesn&#39;t have to be four-bytes long (even though it conventionally is), a REG_SZ unicode string can have an odd length, and so on. Any client application that operates on user-controlled data from the registry should always check the specific properties it relies on, instead of unconditionally trusting the value type.</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span>Beyond this flexibility in data interpretation, there&#39;s another aspect of the Type field to consider: its potential for misuse due to its 32-bit width. The kernel generally doesn&#39;t perform any verification that its numerical value is one of the small, predefined enums (other than to ensure REG_LINK for symbolic links and REG_NONE for tombstone values), so it is possible to set it to any arbitrary 32-bit value, and have it returned in exactly the same form by system APIs such as </span><span class="MvcjwGOuIU-c8"><a href="https://learn.microsoft.com/en-us/windows/win32/api/winreg/nf-winreg-regqueryvalueexw">RegQueryValueEx</a></span><span class="MvcjwGOuIU-c0">. If a program or driver happens to use the value type returned by the system as a direct index into an array without any prior bounds checking, this could lead to out-of-bounds reads or memory corruption. In some sense, it would probably be safest for the most critical/privileged software in the system (e.g. antivirus engines) not to use the value type at all, or only within a very limited scope.</span></p><h6 class="MvcjwGOuIU-c6" id="h.57g7ripdeb6h"><span class="MvcjwGOuIU-c31 MvcjwGOuIU-c10">Flags</span></h6>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">There are currently two supported flags that can be set on registry values:</span></p><ul style="padding: 0;" class="lst-kix_gsnrn3gksa0-0 start"><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c0">VALUE_COMP_NAME (0x1) &ndash; equivalent to KEY_COMP_NAME, indicates that the value name representation is a tightly packed string of ASCII characters.</span></li><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c0">VALUE_TOMBSTONE (0x2) &ndash; used exclusively in differencing hives (version 1.6) to indicate that a value with the given name has been explicitly deleted and doesn&#39;t exist on this key layer. It requires that the value type is REG_NONE and it doesn&#39;t contain any data. It is equivalent to the Tombstone (1) property of a key set in the LayerSemantics field of a key node.</span></li></ul><h6 class="MvcjwGOuIU-c6" id="h.4d7kkqnufxf0"><span class="MvcjwGOuIU-c31 MvcjwGOuIU-c10">Spare</span></h6>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">Unused member, never accessed by the kernel.</span></p><h5 class="MvcjwGOuIU-c6" id="h.80v5kzs0iedx"><span class="MvcjwGOuIU-c31 MvcjwGOuIU-c36">Big data value storage</span></h5>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span>Prior to hive version 1.4, the maximum length of a value in the registry was 1 MB, which was directly related to the maximum length of the single backing cell that would store the raw data. This limitation is documented in the </span><span class="MvcjwGOuIU-c8"><a href="https://learn.microsoft.com/en-us/windows/win32/sysinfo/registry-element-size-limits">Registry element size limits</a></span><span class="MvcjwGOuIU-c0">&nbsp;article:</span></p>
 <p class="MvcjwGOuIU-c5 MvcjwGOuIU-c11"><span class="MvcjwGOuIU-c0"></span></p><table class="MvcjwGOuIU-c28"><tr class="MvcjwGOuIU-c4"><td class="MvcjwGOuIU-c85" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c24"><span class="MvcjwGOuIU-c9 MvcjwGOuIU-c14">Registry element</span></p></td><td class="MvcjwGOuIU-c74" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c24"><span class="MvcjwGOuIU-c9 MvcjwGOuIU-c14">Size limit</span></p></td></tr><tr class="MvcjwGOuIU-c4"><td class="MvcjwGOuIU-c61" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c24"><span class="MvcjwGOuIU-c0">Value</span></p></td><td class="MvcjwGOuIU-c74" colspan="1" rowspan="1"><ul style="padding: 0;" class="lst-kix_3m5uvca0lm53-0 start"><li style="margin-left: 46pt;" class="c2 c16 li-bullet-0"><span class="MvcjwGOuIU-c20">Available memory (latest format) </span><span class="MvcjwGOuIU-c17 MvcjwGOuIU-c80">[editor&#39;s note: this is not fully accurate]</span></li><li style="margin-left: 46pt;" class="c2 c16 li-bullet-0"><span class="MvcjwGOuIU-c20">1 MB (standard format)</span></li></ul></td></tr></table>
 <p class="MvcjwGOuIU-c5 MvcjwGOuIU-c11"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span>Here, &quot;standard format&quot; refers to regf v1.3. On some level, 1 MB could be considered a reasonable limit, as the registry was not designed to serve as storage for large quantities of data &ndash; at least not initially. One example of a public resource which vocalized this design decision was the old </span><span class="MvcjwGOuIU-c8"><a href="https://learn.microsoft.com/en-us/troubleshoot/windows-server/performance/windows-registry-advanced-users">Windows registry information for advanced users</a></span><span class="MvcjwGOuIU-c0">&nbsp;article from around 2002-2003, which stated:</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p><table class="MvcjwGOuIU-c28"><tr class="MvcjwGOuIU-c4"><td class="MvcjwGOuIU-c35" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c24"><span class="MvcjwGOuIU-c13 MvcjwGOuIU-c10">Long values (more than 2,048 bytes) must be stored as files with the file names stored in the registry.</span></p></td></tr></table>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">Nevertheless, it seems that at some point during the development of Windows XP, Microsoft decided to provide the registry clients with the ability to store larger chunks of data, not bound by the somewhat arbitrary limits of the regf format. In order to facilitate this use case, a new cell type was added, called the &quot;big data&quot;. Conceptually, it is simply a means of dividing one long data blob into smaller portions of 16344 bytes, each stored in a separate cell. It replaces the single backing cell with a _CM_BIG_DATA structure defined as follows:</span></p>
 <p class="MvcjwGOuIU-c5 MvcjwGOuIU-c11"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c5"><span></span><span class="MvcjwGOuIU-c1">0:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">kd&gt;</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">dt</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">_CM_BIG_DATA</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c1">nt!_CM_BIG_DATA</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x000</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Signature</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Uint2B</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x002</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Count</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Uint2B</span></p>
 <p class="MvcjwGOuIU-c5"><span class="MvcjwGOuIU-c7">&nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">+0x004</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">List</span><span class="MvcjwGOuIU-c7">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="MvcjwGOuIU-c1">:</span><span class="MvcjwGOuIU-c7">&nbsp;</span><span class="MvcjwGOuIU-c1">Uint4B</span></p>
 <br/>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span>The signature is set to 0x6264 (&#39;db&#39;) and verified on hive load, but otherwise not used. The count represents the number of 16344-byte chunks making up the overall value, and is generally supposed to be set to an integer between 2&ndash;65535. Otherwise, if it was set to 0, that would mean that the value is empty so the big data object shouldn&#39;t be present at all. If it was equal to 1, a direct backing buffer should have been used instead, so such a construct would also be invalid. Neither zero nor one are thus accepted by the hive loader, but it is technically possible to set these values at runtime by abusing the aforementioned </span><span class="MvcjwGOuIU-c8"><a href="https://github.com/googleprojectzero/p0tools/tree/master/WinRegLowSeverityBugs/Reports/16_Registry_value_big_data_count_overflow">integer overflow bug</a></span><span class="MvcjwGOuIU-c0">. We haven&#39;t found any security impact of this behavior other than it being a correctness error, though.</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">The last element of the structure, List, is a cell index to a basic array of cell indexes making up the value chunks. Its format is equivalent to that of the value list, which also stores just the HCELL_INDEX values without any headers or additional information. Furthermore, every chunk other than the last one must contain exactly 16344 bytes. If the length of the overall value is not divisible by 16344, the final chunk contains the remaining 1&ndash;16343 bytes. The layout of the big data object and its associated cells is shown in the diagram below:</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEg6SwYri6hkJBoHs5op8qe6mhTYZeVJwH3JnfR3CexiLYMaOE4RbS6EXJNNzysF4f1gs3trpBnid1DTs2UqKIKGj08qppMdJ-eJ7duiFbeC1ASIBYP1PuMi3-XHPCJACC5i093_R141BIAnnXlhGusKX3IXYHgUFIyTuDggoE8oUTFxtFIcuRHde-aaFvM/s1999/image7.png" style="display: block; padding: 1em 0;text-align: center;"><img alt="The layout of the big data object and its associated cells" border="0" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEg6SwYri6hkJBoHs5op8qe6mhTYZeVJwH3JnfR3CexiLYMaOE4RbS6EXJNNzysF4f1gs3trpBnid1DTs2UqKIKGj08qppMdJ-eJ7duiFbeC1ASIBYP1PuMi3-XHPCJACC5i093_R141BIAnnXlhGusKX3IXYHgUFIyTuDggoE8oUTFxtFIcuRHde-aaFvM/s1200/image7.png" style="max-height: 750px; max-width: 600px;" title="The layout of the big data object and its associated cells" /></a></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">This concludes the part about the internal format of registry hives.</span></p><h2 class="MvcjwGOuIU-c70 MvcjwGOuIU-c12" id="h.88panob3c0bs"><span class="MvcjwGOuIU-c9 MvcjwGOuIU-c40">The hive loading and sanitization process</span></h2>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span>The hive loading process implemented by the NtLoadKey* </span><span>family</span><span class="MvcjwGOuIU-c0">&nbsp;of system calls is a long and complex operation. It involves opening the hive file, loading it in memory, verifying its integrity, optionally recovering state from transactional log files, allocating any related kernel objects, attaching the hive to the global registry tree, and optionally opening a handle to the hive root and returning it to the caller. In this blog post, we are particularly interested in the hive sanitization part. Understanding this portion of the registry code is like consulting the official specification &ndash; or even better, as the code doesn&#39;t lie and is essentially the ground truth of what is and isn&#39;t accepted as valid data. Furthermore, it provides us with a number of hints as to which properties of the format are imperative to the correct functioning of the database, and which ones are more conventional, and don&#39;t have any serious consequences even if broken. The goal of this section is to discuss the overall control flow of loading a hive and performing the initial pass of sanitization. By documenting which internal routines are responsible for which checks, we hope to make it easier for other security researchers to navigate the hive loading code, providing a good starting point for their own investigations.</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">The registry, as a logical structure, is built on top of several lower-layer abstractions, each of which has a number of invariants that must hold in order for the hive to be considered valid, and in order for operations being performed on the hive to be safe. This is illustrated in the pyramid below, with the most foundational requirements placed at the bottom, and the increasingly more general aspects of hive integrity towards the top:</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEibUVk499wc-Yte1DVLfmcUQYhsQvy6ARBfLsri3Jiov3hZkY5WLsOqMoqkhMcBZkYJsLuKCaDm8eiamtml4qFL3FbrngHqpXVPwFhPXpwaDI5qYh9EHHIdJ0qc2XfCD6IFgOxIeHgsyKMWSuslXaajrOKuJ-GEnc-rzgQb0ohZKfOTAXHjfthXSEHlrCE/s5663/loading_pyramid.png" style="display: block; padding: 1em 0;text-align: center;"><img alt="Diagram in the shape of a pyramid, with five levels. The base level showing the hive header, bin and cell layout consistency, and the top level showing Correctness of global hive properties, with all levels described below this image with examples " border="0" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEibUVk499wc-Yte1DVLfmcUQYhsQvy6ARBfLsri3Jiov3hZkY5WLsOqMoqkhMcBZkYJsLuKCaDm8eiamtml4qFL3FbrngHqpXVPwFhPXpwaDI5qYh9EHHIdJ0qc2XfCD6IFgOxIeHgsyKMWSuslXaajrOKuJ-GEnc-rzgQb0ohZKfOTAXHjfthXSEHlrCE/s5663/loading_pyramid.png" style="max-height: 750px; max-width: 600px;" title="Diagram in the shape of a pyramid, with five levels. The base level showing the hive header, bin and cell layout consistency, and the top level showing Correctness of global hive properties, with all levels described below this image with examples " /></a></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">Let&#39;s consider some examples of validity checks at each level, starting with the most fundamental ones:</span></p>
<p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
<ol class="lst-kix_82pihj16nguk-0 start" start="1">
  <li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0">
    <span class="MvcjwGOuIU-c9 MvcjwGOuIU-c14">Hive header, bin and cell layout consistency</span>
    <ul class="lst-kix_82pihj16nguk-1 start">
      <li style="margin-left: 46pt;" class="c2 c26 c12 li-bullet-0">
        <span class="MvcjwGOuIU-c0">Validity of the hive version, length, root cell index, flags in the header.</span>
      </li>
      <li style="margin-left: 46pt;" class="c2 c26 c12 li-bullet-0">
        <span class="MvcjwGOuIU-c0">Existence of at least one bin in the hive.</span>
      </li>
      <li style="margin-left: 46pt;" class="c2 c26 c12 li-bullet-0">
        <span class="MvcjwGOuIU-c0">Validity of each bin&#39;s header, particularly the file offset and size.</span>
      </li>
      <li style="margin-left: 46pt;" class="c2 c26 c12 li-bullet-0">
        <span class="MvcjwGOuIU-c0">Validity of cells: aligned to eight bytes, within the bounds of the bin, completely filling out the bin.</span>
      </li>
    </ul>
  </li>
  <li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0">
    <span class="MvcjwGOuIU-c9 MvcjwGOuIU-c14">Intra-cell consistency</span>
    <ul class="lst-kix_82pihj16nguk-1 start">
      <li style="margin-left: 46pt;" class="c2 c26 c12 li-bullet-0">
        <span class="MvcjwGOuIU-c0">Sufficient size of each cell with regards to the data it stores: at least the minimum size for the cell type (e.g. 0x4e for the key node), plus adequate to any variable-length internal arrays, such as the key name or value name.</span>
      </li>
      <li style="margin-left: 46pt;" class="c2 c26 c12 li-bullet-0">
        <span class="MvcjwGOuIU-c0">Correct signatures being set for every kind of cell depending on its function.</span>
      </li>
      <li style="margin-left: 46pt;" class="c2 c26 c12 li-bullet-0">
        <span class="MvcjwGOuIU-c0">Valid combinations of flags being set in key nodes and values.</span>
      </li>
      <li style="margin-left: 46pt;" class="c2 c26 c12 li-bullet-0">
        <span class="MvcjwGOuIU-c0">Strings (key names, value names) adhering to the format requirements regarding minimum and maximum lengths, charset, etc.</span>
      </li>
    </ul>
  </li>
  <li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0">
    <span class="MvcjwGOuIU-c15">Inter-cell consistency</span>
    <ul class="lst-kix_82pihj16nguk-1 start">
      <li style="margin-left: 46pt;" class="c2 c26 c12 li-bullet-0">
        <span class="MvcjwGOuIU-c0">Valid references to cells in cell indexes, and each allocated cell only being used for one specific purpose.</span>
      </li>
      <li style="margin-left: 46pt;" class="c2 c26 c12 li-bullet-0">
        <span class="MvcjwGOuIU-c0">Consistency between copies of redundant data in separate cells: e.g. _CM_KEY_NODE.SubKeyCounts[...] vs. the length of the subkey index.</span>
      </li>
      <li style="margin-left: 46pt;" class="c2 c26 c12 li-bullet-0">
        <span class="MvcjwGOuIU-c0">Consistency between length markers in one cell vs. the amount of data stored in the corresponding backing buffer (e.g. _CM_KEY_VALUE.DataLength vs. length of the data stored in the raw data cell / big data cell).</span>
      </li>
      <li style="margin-left: 46pt;" class="c2 c26 c12 li-bullet-0">
        <span class="MvcjwGOuIU-c0">Correct hints in subkey indexes (fast leaves, hash leaves).</span>
      </li>
      <li style="margin-left: 46pt;" class="c2 c26 c12 li-bullet-0">
        <span class="MvcjwGOuIU-c0">Correct reference counts in the security descriptors.</span>
      </li>
    </ul>
  </li>
  <li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0">
    <span class="MvcjwGOuIU-c9 MvcjwGOuIU-c14">Structural correctness of high-level constructs</span>
    <ul class="lst-kix_82pihj16nguk-1 start">
      <li style="margin-left: 46pt;" class="c2 c26 c12 li-bullet-0">
        <span class="MvcjwGOuIU-c0">Consistency of the linked list of security descriptors.</span>
      </li>
      <li style="margin-left: 46pt;" class="c2 c26 c12 li-bullet-0">
        <span class="MvcjwGOuIU-c0">Subkeys being laid out in a lexicographical order in all subkey indexes.</span>
      </li>
      <li style="margin-left: 46pt;" class="c2 c26 c12 li-bullet-0">
        <span class="MvcjwGOuIU-c0">Symbolic link keys having a single value named &quot;SymbolicLinkValue&quot; of type REG_LINK.</span>
      </li>
      <li style="margin-left: 46pt;" class="c2 c26 c12 li-bullet-0">
        <span>Subkeys in the stable space always having a non-volatile parent.</span>
      </li>
    </ul>
  </li>
  <li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0">
    <span class="MvcjwGOuIU-c9 MvcjwGOuIU-c14">Correctness of global hive properties</span>
    <ul class="lst-kix_82pihj16nguk-1 start">
      <li style="margin-left: 46pt;" class="c2 c26 c12 li-bullet-0">
        <span>Each hive always containing at least one key (the root key) and at least one security descriptor.</span>
      </li>
      <li style="margin-left: 46pt;" class="c2 c12 c26 li-bullet-0">
        <span class="MvcjwGOuIU-c0">Only the root of the hive, and no other key having the KEY_HIVE_ENTRY flag set.</span>
      </li>
      <li style="margin-left: 46pt;" class="c2 c26 c12 li-bullet-0">
        <span>The depth of the hive&#39;s tree structure being a maximum of 512 levels.</span>
      </li>
    </ul>
  </li>
</ol>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">As we can see, there are a variety of constraints that require verification when loading a hive, with the more abstract ones relying on the lower-layer ones to be confirmed first. It explains why the process is by far the most complex operation one can perform on the registry, spanning across thousands of lines of code and dozens of functions. To better illustrate this process, I&#39;ve outlined the most important hive validation functions below, indented to show their hierarchical relationships as they execute in the kernel:</span></p>
<p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <ul style="padding: 0;" class="lst-kix_pvxkc5ur63o3-0 start">
  <li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0">
    <span class="MvcjwGOuIU-c0">NtLoadKey* &rarr; CmLoadDifferencingKey &rarr; CmLoad(App)Key</span>
    <ul class="lst-kix_pvxkc5ur63o3-1 start">
      <li style="margin-left: 46pt;" class="c2 c26 c12 li-bullet-0">
        <span class="MvcjwGOuIU-c0">CmpCmdHiveOpen &rarr; CmpInitHiveFromFile &rarr; CmpCreateHive</span>
        <ul class="lst-kix_pvxkc5ur63o3-2 start">
          <li style="margin-left: 46pt;" class="c2 c12 c38 li-bullet-0">
            <span class="MvcjwGOuIU-c0">HvHiveStartFileBacked &rarr; HvLoadHive</span>
            <ul style="padding: 0;" class="lst-kix_pvxkc5ur63o3-3 start">
              <li style="margin-left: 46pt;" class="c2 c50 c12 li-bullet-0">
                <span class="MvcjwGOuIU-c0">HvpGetHiveHeader</span>
              </li>
              <li style="margin-left: 46pt;" class="c2 c50 c12 li-bullet-0">
                <span class="MvcjwGOuIU-c0">HvAnalyzeLogFiles</span>
              </li>
              <li style="margin-left: 46pt;" class="c2 c12 c50 li-bullet-0">
                <span class="MvcjwGOuIU-c0">HvpPerformLogFileRecovery</span>
              </li>
              <li style="margin-left: 46pt;" class="c2 c50 c12 li-bullet-0">
                <span class="MvcjwGOuIU-c0">HvpRemapAndEnlistHiveBins</span>
                <ul class="lst-kix_pvxkc5ur63o3-4 start">
                  <li style="margin-left: 46pt;" class="c2 c29 c12 li-bullet-0">
                    <span class="MvcjwGOuIU-c0">HvpValidateLoadedBin</span>
                  </li>
                  <li style="margin-left: 46pt;" class="c2 c29 c12 li-bullet-0">
                    <span class="MvcjwGOuIU-c0">HvpEnlistFreeCells</span>
                  </li>
                </ul>
              </li>
            </ul>
          </li>
          <li style="margin-left: 46pt;" class="c2 c38 c12 li-bullet-0">
            <span class="MvcjwGOuIU-c0">CmCheckRegistry</span>
            <ul style="padding: 0;" class="lst-kix_2w36zq8cd80k-3 start">
              <li style="margin-left: 46pt;" class="c2 c50 c12 li-bullet-0">
                <span class="MvcjwGOuIU-c0">HvCheckHive</span>
                <ul class="lst-kix_2w36zq8cd80k-4 start">
                  <li style="margin-left: 46pt;" class="c2 c29 c12 li-bullet-0">
                    <span class="MvcjwGOuIU-c0">HvCheckBin</span>
                  </li>
                </ul>
              </li>
              <li style="margin-left: 46pt;" class="c2 c50 c12 li-bullet-0">
                <span class="MvcjwGOuIU-c0">CmpValidateHiveSecurityDescriptors</span>
              </li>
              <li style="margin-left: 46pt;" class="c2 c50 c12 li-bullet-0">
                <span class="MvcjwGOuIU-c0">CmpCheckRegistry2</span>
                <ul class="lst-kix_2w36zq8cd80k-4 start">
                  <li style="margin-left: 46pt;" class="c2 c12 c29 li-bullet-0">
                    <span class="MvcjwGOuIU-c0">CmpCheckKey</span>
                    <ul class="lst-kix_2w36zq8cd80k-5 start">
                      <li style="margin-left: 46pt;" class="c2 c12 c60 li-bullet-0">
                        <span class="MvcjwGOuIU-c0">CmpCheckValueList</span>
                      </li>
                      <li style="margin-left: 46pt;" class="c2 c12 c60 li-bullet-0">
                        <span class="MvcjwGOuIU-c0">CmpCheckLeaf</span>
                      </li>
                    </ul>
                  </li>
                  <li style="margin-left: 46pt;" class="c2 c29 c12 li-bullet-0">
                    <span class="MvcjwGOuIU-c0">CmpCheckLexicographicalOrder</span>
                  </li>
                  <li style="margin-left: 46pt;" class="c2 c29 c12 li-bullet-0">
                    <span class="MvcjwGOuIU-c0">CmpCheckAndFixSecurityCellsRefcount</span>
                  </li>
                </ul>
              </li>
            </ul>
          </li>
        </ul>
      </li>
      <li style="margin-left: 46pt;" class="c2 c26 c12 li-bullet-0">
        <span class="MvcjwGOuIU-c0">CmpLoadKeyCommon</span>
        <ul style="padding: 0;" class="lst-kix_2w36zq8cd80k-2 start">
          <li style="margin-left: 46pt;" class="c2 c38 c12 li-bullet-0">
            <span class="MvcjwGOuIU-c0">CmpLinkHiveToMaster</span>
            <ul style="padding: 0;" class="lst-kix_2w36zq8cd80k-3 start">
              <li style="margin-left: 46pt;" class="c2 c50 c12 li-bullet-0">
                <span class="MvcjwGOuIU-c0">ObOpenObjectByName &rarr; ... &lt;NT Object Manager&gt; ... &rarr; CmpParseKey &rarr; CmpDoParseKey</span>
                <ul class="lst-kix_2w36zq8cd80k-4 start">
                  <li style="margin-left: 46pt;" class="c2 c29 c12 li-bullet-0">
                    <span class="MvcjwGOuIU-c0">CmpUpdateHiveRootCellFlags</span>
                  </li>
                </ul>
              </li>
            </ul>
          </li>
        </ul>
      </li>
    </ul>
  </li>
</ul>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">Here is a short summary of each of the above functions, according to my own analysis and understanding:</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p><table class="MvcjwGOuIU-c28"><tr class="MvcjwGOuIU-c4"><td class="MvcjwGOuIU-c27" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c9 MvcjwGOuIU-c14">Function name(s)</span></p></td><td class="MvcjwGOuIU-c37 MvcjwGOuIU-c64" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c9 MvcjwGOuIU-c14">Description</span></p></td></tr><tr class="MvcjwGOuIU-c4"><td class="MvcjwGOuIU-c47" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">NtLoadKey*</span></p></td><td class="MvcjwGOuIU-c37" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span>The four syscall entry points for loading registry hives, as discussed in the </span><span class="MvcjwGOuIU-c8"><a href="https://googleprojectzero.blogspot.com/2024/10/the-windows-registry-adventure-4-hives.html">previous post</a></span><span class="MvcjwGOuIU-c0">: NtLoadKey, NtLoadKey2, NtLoadKeyEx, NtLoadKey3.</span></p></td></tr><tr class="MvcjwGOuIU-c4"><td class="MvcjwGOuIU-c47" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">CmLoadDifferencingKey</span></p></td><td class="MvcjwGOuIU-c37" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">A generic function for loading hives &ndash; not just differencing ones but every kind, contrary to what the name might suggest. Other than the syscall handlers, it is also called by VrpPreLoadKey and VrpLoadDifferencingHive, which are parts of the VRegDriver. It is responsible for sanitizing the input flags, checking the privileges of the caller, calling registry callbacks, invoking specialized functions to actually load the hive, and opening a handle to the root of the hive if the caller requested it.</span></p></td></tr><tr class="MvcjwGOuIU-c4"><td class="MvcjwGOuIU-c47" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">CmLoadKey,<br>CmLoadAppKey</span></p></td><td class="MvcjwGOuIU-c37" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">Functions implementing the core functionality of loading normal and app hives, respectively. They are responsible for coordinating lower-layer loading functions, resolving any conflicts related to the hive file / registry mount path, and inserting the hive-related objects into the corresponding kernel data structures. In terms of opening and validating the binary hive representation, they are virtually equivalent.</span></p></td></tr><tr class="MvcjwGOuIU-c4"><td class="MvcjwGOuIU-c47" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">CmpCmdHiveOpen,<br>CmpInitHiveFromFile,<br>CmpCreateHive</span></p></td><td class="MvcjwGOuIU-c37" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">Functions dedicated to opening the hive file on disk, loading it in memory, validating its integrity and allocating the internal kernel structures (_CMHIVE and other objects representing the hive).</span></p></td></tr><tr class="MvcjwGOuIU-c4"><td class="MvcjwGOuIU-c47" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">HvHiveStartFileBacked,<br>HvLoadHive</span></p></td><td class="MvcjwGOuIU-c37" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">Common functions for loading and sanitizing the hive on the level of header, bins and cells (the lowest level of the pyramid). </span></p></td></tr><tr class="MvcjwGOuIU-c4"><td class="MvcjwGOuIU-c47" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">HvpGetHiveHeader</span></p></td><td class="MvcjwGOuIU-c37" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">Reads and validates the hive header, trying to determine if it is valid or corrupted, and whether the header or hive data need to be recovered from a log file.</span></p></td></tr><tr class="MvcjwGOuIU-c4"><td class="MvcjwGOuIU-c47" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">HvAnalyzeLogFiles,<br>HvpPerformLogFileRecovery</span></p></td><td class="MvcjwGOuIU-c37" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">Two most important functions related to data recovery from log files: the first one determines which of the two files (.LOG1/LOG2) to use, and the second one actually applies the log file entries to the hive mapping in memory.</span></p></td></tr><tr class="MvcjwGOuIU-c4"><td class="MvcjwGOuIU-c47" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">HvpRemapAndEnlistHiveBins,<br>HvpValidateLoadedBin,<br>HvpEnlistFreeCells</span></p></td><td class="MvcjwGOuIU-c37" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">Functions responsible for re-mapping the hive after log file recovery, in order to ensure that every bin is mapped as a continuous block of memory. During the process, the validity of all bins and the layout of their cells is verified.</span></p></td></tr><tr class="MvcjwGOuIU-c4"><td class="MvcjwGOuIU-c47" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">CmCheckRegistry</span></p></td><td class="MvcjwGOuIU-c37" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">A generic function encompassing the verification of levels &ge; 2 of the pyramid, i.e. everything about the hive that defines its logical structure and is not related to memory management. If any self-healing occurs during the process, the function restarts its logic, so it may potentially take multiple iterations before a corrupted hive is fixed up and accepted as valid.</span></p></td></tr><tr class="MvcjwGOuIU-c4"><td class="MvcjwGOuIU-c47" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">HvCheckHive,<br>HvCheckBin</span></p></td><td class="MvcjwGOuIU-c37" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">Two functions responsible for validating the bin headers and layout of their cells. As you may have noticed, this part of their functionality is redundant with HvpValidateLoadedBin and HvpEnlistFreeCells. The difference is that the earlier functions are used to cache information about the positions of free cells in the hive, to optimize the allocation process later on. On the other hand, the underlying purpose of HvCheckHive and HvCheckBin is to generate a bitmap object (RTL_BITMAP) that indicates the positions of allocated cells, in order to ensure the validity of cell indexes when sanitizing the hive, and to make sure that every cell is only used for a single purpose in the hive.</span></p>
 <p class="MvcjwGOuIU-c2"><span>As a side note, there is an </span><span class="MvcjwGOuIU-c8"><a href="https://github.com/googleprojectzero/p0tools/tree/master/WinRegLowSeverityBugs/Reports/18_HvCheckBin_incorrect_return_value">amusing bug</a></span><span class="MvcjwGOuIU-c0">&nbsp;in HvCheckBin related to verifying cell size correctness, but it seems to be non-exploitable precisely because the same sanitization is correctly performed earlier in HvpEnlistFreeCells.</span></p></td></tr><tr class="MvcjwGOuIU-c4"><td class="MvcjwGOuIU-c47" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">CmpValidateHiveSecurityDescriptors</span></p></td><td class="MvcjwGOuIU-c37" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">The function traverses the linked list of security descriptor cells, and verifies its consistency (the correctness of the Flink/Blink indexes) and the validity of the security descriptor blobs. At the same time, it also caches information about the descriptors in internal kernel structures, so that they can be quickly looked up when verifying the _CM_KEY_NODE.Security fields, and later at system run time.</span></p></td></tr><tr class="MvcjwGOuIU-c4"><td class="MvcjwGOuIU-c47" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">CmpCheckRegistry2</span></p></td><td class="MvcjwGOuIU-c37" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">A function responsible for performing a single attempt at validating the entire key structure. There are several possible return codes:</span></p><ul style="padding: 0;" class="lst-kix_2gqv10mkziv8-0 start"><li style="margin-left: 46pt;" class="c2 c16 li-bullet-0"><span class="MvcjwGOuIU-c0">STATUS_SUCCESS if the hive validation passes without problems,</span></li><li style="margin-left: 46pt;" class="c2 c16 li-bullet-0"><span class="MvcjwGOuIU-c0">STATUS_REGISTRY_HIVE_RECOVERED if minor corruption was encountered, but it was successfully fixed in-place,</span></li><li style="margin-left: 46pt;" class="c2 c16 li-bullet-0"><span class="MvcjwGOuIU-c0">STATUS_RETRY if a badly corrupted key was encountered and removed from its parent&#39;s subkey index. This causes CmCheckRegistry to restart the validation process from scratch.</span></li><li style="margin-left: 46pt;" class="c2 c16 li-bullet-0"><span class="MvcjwGOuIU-c0">STATUS_REGISTRY_CORRUPT if the hive was found to be corrupted beyond repair.</span></li><li style="margin-left: 46pt;" class="c2 c16 li-bullet-0"><span class="MvcjwGOuIU-c0">Other problem-specific error codes such as STATUS_NO_LOG_SPACE or STATUS_INSUFFICIENT_RESOURCES, which cause the loading process to be aborted.</span></li></ul></td></tr><tr class="MvcjwGOuIU-c4"><td class="MvcjwGOuIU-c47" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">CmpCheckKey</span></p></td><td class="MvcjwGOuIU-c37" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">This is the central function in the hive sanitization process, with more than a thousand lines of code in decompiled output, and likely just as many in the original source code. It essentially checks the validity of all fields within a specific key node, and also orchestrates the validation of the value list and subkey index associated with the key. If there was one function I would recommend analyzing to better understand the regf format, it would be this one.</span></p></td></tr><tr class="MvcjwGOuIU-c4"><td class="MvcjwGOuIU-c47" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">CmpCheckValueList</span></p></td><td class="MvcjwGOuIU-c37" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">Checks the consistency of a value list, each of the value cells on the list, and their backing buffers / big data objects.</span></p></td></tr><tr class="MvcjwGOuIU-c4"><td class="MvcjwGOuIU-c47" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">CmpCheckLeaf</span></p></td><td class="MvcjwGOuIU-c37" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">Validates a specific leaf subkey index, i.e. one of &#39;li&#39;, &#39;lf&#39;, &#39;lh&#39;. This includes checking the cell size, signature, validity of the subkey cell indexes and their hint values.</span></p></td></tr><tr class="MvcjwGOuIU-c4"><td class="MvcjwGOuIU-c47" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">CmpCheckLexicographicalOrder</span></p></td><td class="MvcjwGOuIU-c37" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span>Compares</span><span class="MvcjwGOuIU-c0">&nbsp;the name of two consecutive subkeys to determine if the second one is lexicographically greater than the first, in order to ensure the right sorting of a subkey index.</span></p></td></tr><tr class="MvcjwGOuIU-c4"><td class="MvcjwGOuIU-c47" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">CmpCheckAndFixSecurityCellsRefcount</span></p></td><td class="MvcjwGOuIU-c37" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span>Iterates over all security descriptors in the hive, compares their refcounts loaded from disk with the values independently re-calculated while sanitizing the key tree, and corrects them if they are unequal. Since November 2024, it also frees any unused security descriptors with the reference count set to zero (they had been previously allowed, as described in </span><span class="MvcjwGOuIU-c8"><a href="https://github.com/googleprojectzero/p0tools/tree/master/WinRegLowSeverityBugs/Reports/10_CmpKeySecurityIncrementReferenceCount_zero_refcount_crash">WinRegLowSeverityBugs issue #10</a></span><span class="MvcjwGOuIU-c0">).</span></p></td></tr><tr class="MvcjwGOuIU-c4"><td class="MvcjwGOuIU-c47" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">CmpUpdateHiveRootCellFlags</span></p></td><td class="MvcjwGOuIU-c37" colspan="1" rowspan="1">
 <p class="MvcjwGOuIU-c2"><span class="MvcjwGOuIU-c0">The function makes sure that the root key of the hive has the KEY_NO_DELETE and KEY_HIVE_ENTRY flags set. Interestingly, these flags are the only aspect of the regf format that is not enforced directly while loading the hive (in CmpCheckKey), but only at a later stage when the hive is being mounted in the global registry view.</span></p></td></tr></table><h3 class="MvcjwGOuIU-c57 MvcjwGOuIU-c12" id="h.wnqw3dpo3d9p"><span class="MvcjwGOuIU-c54 MvcjwGOuIU-c17">Self-healing properties</span></h3>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">The Windows implementation of the registry has the unique property that it is self-healing: the system tries very hard to successfully load a hive even if it&#39;s partially corrupted. My guess is that the reason for this design was to make the mechanism resilient against random data corruption on disk, as failure to load a system hive early during start-up would make Windows unusable. Perhaps it was decided that it was a better tradeoff to forcefully remove the broken parts of the file, with the hope that they would be automatically re-created later at run time, or that they weren&#39;t very important to begin with and the system/applications could continue to function correctly without them. And even if not, giving the user a chance to troubleshoot the problem or recover their data would still be a better outcome than bricking the machine completely.</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">Consequently, whenever an error is detected by the hive loading logic, it is handled in one of several ways, depending on the nature of the problem:</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p><ul style="padding: 0;" class="lst-kix_4ee45band27p-0 start"><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c15">Bin recreation:</span><span class="MvcjwGOuIU-c0">&nbsp;if HvpValidateLoadedBin indicates that any part of a bin header is corrupted, then HvpRemapAndEnlistHiveBins re-initializes it from scratch, and declares it as 4096 bytes long (regardless of the previous length).</span></li><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c15">Cell recreation:</span><span class="MvcjwGOuIU-c0">&nbsp;if HvpEnlistFreeCells detects a cell with an invalid length, it converts it to a single free cell spanning from the current offset until the end of the bin, potentially erasing any other data/cells previously residing in that region.</span></li><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c15">Small, direct fix:</span><span class="MvcjwGOuIU-c0">&nbsp;if a single field within a key node is found to have an invalid state, and the good/expected state is known to the kernel, the problem gets fixed by directly overwriting the old value with the correct one. Examples include cell signatures and mandatory/illegal flags.</span></li><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c15">Single value deletion:</span><span class="MvcjwGOuIU-c0">&nbsp;if any inconsistencies are found in a value cell or its associated data cell(s), the specific value is removed from the key&#39;s value list.</span></li><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c15">Deletion of entire value list:</span><span class="MvcjwGOuIU-c0">&nbsp;if the descriptor of a value list (i.e. its cell index or length) are invalid, or if a symbolic link contains more than one value, the entire value list of the key is cleared.</span></li><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c15">Single key deletion:</span><span class="MvcjwGOuIU-c0">&nbsp;if an irrecoverable problem is found within a key node (e.g. invalid cell index, invalid cell length, invalid name), then it is removed from its parent&#39;s subkey index, and the key tree validation process is restarted from scratch.</span></li><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c15">Deletion of entire subkey index:</span><span class="MvcjwGOuIU-c0">&nbsp;if any irrecoverable problem is found in a subkey index, it is deleted, and the subkey list of its associated key is cleared.</span></li><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c15">Security descriptor list reset:</span><span class="MvcjwGOuIU-c0">&nbsp;if any errors are detected in the list of security descriptors (bad Flink/Blink indexes or invalid binary format), the set of descriptors in the hive is reduced to the single root descriptor, which will then be inherited by all the keys in the hive.</span></li><li style="margin-left: 46pt;" class="c2 c16 c12 li-bullet-0"><span class="MvcjwGOuIU-c15">Rejection of entire hive:</span><span class="MvcjwGOuIU-c0">&nbsp;if any issues are found with the fundamental parts of the regf format or its properties (heavily corrupted header, missing bins, invalid root key, invalid root security descriptor), the loading of the hive is completely aborted.</span></li></ul>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span class="MvcjwGOuIU-c0">As we can see, Windows implements a very defensive strategy and always attempts to either fix the corrupted data, or isolate the damage by deleting the affected object while preserving the overall hive integrity. Only when these repair attempts are exhausted does the kernel abort the loading process and return an error. This resilience can lead to situations where a freshly loaded hive is already in a &quot;dirty&quot; state, requiring the system to immediately flush its self-applied corrections to disk to maintain consistency.</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span>One particularly interesting bug related to the self-healing process was </span><span class="MvcjwGOuIU-c8"><a href="https://project-zero.issues.chromium.org/issues/42451601">CVE-2023-38139</a></span><span>. To reproduce the issue, the self-healing</span><span>&nbsp;logic would have to be triggered a large number of times (in the case of my PoC, 65535 times) in order to cause a 32-bit integer overflow of a security descriptor refcount, and later a UAF condition. I have also abused the behavior to demonstrate </span><span class="MvcjwGOuIU-c8"><a href="https://github.com/googleprojectzero/p0tools/tree/master/WinRegLowSeverityBugs/Reports/13_CmpLightWeightPrepareSetSecDescUoW_security_list_confusion">WinRegLowSeverityBugs #13</a></span><span class="MvcjwGOuIU-c0">, in which a key with an empty name would be removed during load, freeing up a reference to a security descriptor and resulting in the refcount being equal to zero upon loading. Overall, the self-healing property of the registry is not the most critical, but one that I find quite fascinating and certainly worth keeping in mind as part of one&#39;s toolbox when researching this subsystem.</span></p><h2 class="MvcjwGOuIU-c70 MvcjwGOuIU-c12" id="h.pj4welz7cmm3"><span class="MvcjwGOuIU-c9 MvcjwGOuIU-c40">Conclusion</span></h2>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span>Congratulations on reaching the end!</span><span>&nbsp;This post aimed to systematically explore the inner workings of the regf format, focusing on the hard requirements enforced by Windows</span><span class="MvcjwGOuIU-c0">. Due to my role and interests, I looked at the format from a strictly security-oriented angle rather than digital forensics, which is the context in which registry hives are typically considered. Hopefully, this deep dive clarifies some of the intricacies of the hive format and complements existing unofficial documentation.</span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c3"><span class="MvcjwGOuIU-c0"></span></p>
 <p class="MvcjwGOuIU-c2 MvcjwGOuIU-c12"><span>Keep in mind that hives store their data in the regf files on disk, but Windows also creates multiple auxiliary kernel objects for managing and caching this data once loaded. The next post in the series will discuss these various objects, their relationships, lifecycle, and, naturally, their impact on system security. Stay tuned!</span></p>
<div style='clear: both;'></div>
</div>
<div class='post-footer'>
<div class='post-footer-line post-footer-line-1'>
<span class='post-author vcard'>
Posted by
<span class='fn' itemprop='author' itemscope='itemscope' itemtype='http://schema.org/Person'>
<meta content='https://www.blogger.com/profile/08975904405228580347' itemprop='url'/>
<a class='g-profile' href='https://www.blogger.com/profile/08975904405228580347' rel='author' title='author profile'>
<span itemprop='name'>Google Project Zero</span>
</a>
</span>
</span>
<span class='post-timestamp'>
at
<meta content='https://googleprojectzero.blogspot.com/2024/12/the-windows-registry-adventure-5-regf.html' itemprop='url'/>
<a class='timestamp-link' href='https://googleprojectzero.blogspot.com/2024/12/the-windows-registry-adventure-5-regf.html' rel='bookmark' title='permanent link'><abbr class='published' itemprop='datePublished' title='2024-12-19T11:03:00-08:00'>11:03&#8239;AM</abbr></a>
</span>
<span class='post-comment-link'>
</span>
<span class='post-icons'>
<span class='item-control blog-admin pid-1053444070'>
<a href='https://www.blogger.com/post-edit.g?blogID=4838136820032157985&postID=5470414558693895520&from=pencil' title='Edit Post'>
<img alt='' class='icon-action' height='18' src='https://resources.blogblog.com/img/icon18_edit_allbkg.gif' width='18'/>
</a>
</span>
</span>
<div class='post-share-buttons goog-inline-block'>
<a class='goog-inline-block share-button sb-email' href='https://www.blogger.com/share-post.g?blogID=4838136820032157985&postID=5470414558693895520&target=email' target='_blank' title='Email This'><span class='share-button-link-text'>Email This</span></a><a class='goog-inline-block share-button sb-blog' href='https://www.blogger.com/share-post.g?blogID=4838136820032157985&postID=5470414558693895520&target=blog' onclick='window.open(this.href, "_blank", "height=270,width=475"); return false;' target='_blank' title='BlogThis!'><span class='share-button-link-text'>BlogThis!</span></a><a class='goog-inline-block share-button sb-twitter' href='https://www.blogger.com/share-post.g?blogID=4838136820032157985&postID=5470414558693895520&target=twitter' target='_blank' title='Share to X'><span class='share-button-link-text'>Share to X</span></a><a class='goog-inline-block share-button sb-facebook' href='https://www.blogger.com/share-post.g?blogID=4838136820032157985&postID=5470414558693895520&target=facebook' onclick='window.open(this.href, "_blank", "height=430,width=640"); return false;' target='_blank' title='Share to Facebook'><span class='share-button-link-text'>Share to Facebook</span></a><a class='goog-inline-block share-button sb-pinterest' href='https://www.blogger.com/share-post.g?blogID=4838136820032157985&postID=5470414558693895520&target=pinterest' target='_blank' title='Share to Pinterest'><span class='share-button-link-text'>Share to Pinterest</span></a>
</div>
</div>
<div class='post-footer-line post-footer-line-2'>
<span class='post-labels'>
</span>
</div>
<div class='post-footer-line post-footer-line-3'>
<span class='post-location'>
</span>
</div>
</div>
</div>
<div class='comments' id='comments'>
<a name='comments'></a>
<h4>No comments:</h4>
<div id='Blog1_comments-block-wrapper'>
<dl class='avatar-comment-indent' id='comments-block'>
</dl>
</div>
<p class='comment-footer'>
<div class='comment-form'>
<a name='comment-form'></a>
<h4 id='comment-post-message'>Post a Comment</h4>
<p>
</p>
<a href='https://www.blogger.com/comment/frame/4838136820032157985?po=5470414558693895520&hl=en' id='comment-editor-src'></a>
<iframe allowtransparency='true' class='blogger-iframe-colorize blogger-comment-from-post' frameborder='0' height='410px' id='comment-editor' name='comment-editor' src='' width='100%'></iframe>
<script src='https://www.blogger.com/static/v1/jsbin/2315299244-comment_from_post_iframe.js' type='text/javascript'></script>
<script type='text/java                   '>
      BLOG_CMT_createIframe('https://www.blogger.com/rpc_relay.html');
    </script>
</div>
</p>
</div>
</div>

        </div></div>
      
</div>
<div class='blog-pager' id='blog-pager'>
<span id='blog-pager-older-link'>
<a class='blog-pager-older-link' href='https://googleprojectzero.blogspot.com/2024/12/qualcomm-dsp-driver-unexpectedly-excavating-exploit.html' id='Blog1_blog-pager-older-link' title='Older Post'>Older Post</a>
</span>
<a class='home-link' href='https://googleprojectzero.blogspot.com/'>Home</a>
</div>
<div class='clear'></div>
<div class='post-feeds'>
<div class='feed-links'>
Subscribe to:
<a class='feed-link' href='https://googleprojectzero.blogspot.com/feeds/5470414558693895520/comments/default' target='_blank' type='application/atom+xml'>Post Comments (Atom)</a>
</div>
</div>
</div></div>
</div>
</div>
<div class='column-left-outer'>
<div class='column-left-inner'>
<aside>
</aside>
</div>
</div>
<div class='column-right-outer'>
<div class='column-right-inner'>
<aside>
<div class='sidebar section' id='sidebar-right-1'><div class='widget BlogSearch' data-version='1' id='BlogSearch1'>
<h2 class='title'>Search This Blog</h2>
<div class='widget-content'>
<div id='BlogSearch1_form'>
<form action='https://googleprojectzero.blogspot.com/search' class='gsc-search-box' target='_top'>
<table cellpadding='0' cellspacing='0' class='gsc-search-box'>
<tbody>
<tr>
<td class='gsc-input'>
<input autocomplete='off' class='gsc-input' name='q' size='10' title='search' type='text' value=''/>
</td>
<td class='gsc-search-button'>
<input class='gsc-search-button' title='search' type='submit' value='Search'/>
</td>
</tr>
</tbody>
</table>
</form>
</div>
</div>
<div class='clear'></div>
</div><div class='widget PageList' data-version='1' id='PageList1'>
<h2>Pages</h2>
<div class='widget-content'>
<ul>
<li>
<a href='https://googleprojectzero.blogspot.com/p/about-project-zero.html'>About Project Zero</a>
</li>
<li>
<a href='https://googleprojectzero.blogspot.com/p/working-at-project-zero.html'>Working at Project Zero</a>
</li>
<li>
<a href='https://googleprojectzero.blogspot.com/p/0day.html'>0day "In the Wild"</a>
</li>
<li>
<a href='https://googleprojectzero.github.io/0days-in-the-wild/rca.html'>0day Exploit Root Cause Analyses</a>
</li>
<li>
<a href='https://googleprojectzero.blogspot.com/p/vulnerability-disclosure-faq.html'>Vulnerability Disclosure FAQ</a>
</li>
</ul>
<div class='clear'></div>
</div>
</div><div class='widget BlogArchive' data-version='1' id='BlogArchive1'>
<h2>Archives</h2>
<div class='widget-content'>
<div id='ArchiveList'>
<div id='BlogArchive1_ArchiveList'>
<ul class='hierarchy'>
<li class='archivedate expanded'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy toggle-open'>

        &#9660;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2024/'>
2024
</a>
<span class='post-count' dir='ltr'>(12)</span>
<ul class='hierarchy'>
<li class='archivedate expanded'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy toggle-open'>

        &#9660;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2024/12/'>
December
</a>
<span class='post-count' dir='ltr'>(3)</span>
<ul class='posts'>
<li><a href='https://googleprojectzero.blogspot.com/2024/12/the-windows-registry-adventure-5-regf.html'>The Windows Registry Adventure #5: The regf file f...</a></li>
<li><a href='https://googleprojectzero.blogspot.com/2024/12/qualcomm-dsp-driver-unexpectedly-excavating-exploit.html'>The Qualcomm DSP Driver - Unexpectedly Excavating ...</a></li>
<li><a href='https://googleprojectzero.blogspot.com/2024/12/windows-tooling-updates-oleviewnet.html'>Windows Tooling Updates: OleView.NET</a></li>
</ul>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2024/11/'>
November
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2024/10/'>
October
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2024/06/'>
June
</a>
<span class='post-count' dir='ltr'>(3)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2024/04/'>
April
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2023/'>
2023
</a>
<span class='post-count' dir='ltr'>(11)</span>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2023/11/'>
November
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2023/10/'>
October
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2023/09/'>
September
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2023/08/'>
August
</a>
<span class='post-count' dir='ltr'>(4)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2023/04/'>
April
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2023/03/'>
March
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2023/01/'>
January
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2022/'>
2022
</a>
<span class='post-count' dir='ltr'>(17)</span>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2022/12/'>
December
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2022/11/'>
November
</a>
<span class='post-count' dir='ltr'>(3)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2022/10/'>
October
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2022/08/'>
August
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2022/06/'>
June
</a>
<span class='post-count' dir='ltr'>(3)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2022/05/'>
May
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2022/04/'>
April
</a>
<span class='post-count' dir='ltr'>(3)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2022/03/'>
March
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2022/02/'>
February
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2022/01/'>
January
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2021/'>
2021
</a>
<span class='post-count' dir='ltr'>(24)</span>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2021/12/'>
December
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2021/10/'>
October
</a>
<span class='post-count' dir='ltr'>(3)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2021/09/'>
September
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2021/08/'>
August
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2021/06/'>
June
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2021/05/'>
May
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2021/04/'>
April
</a>
<span class='post-count' dir='ltr'>(3)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2021/03/'>
March
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2021/02/'>
February
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2021/01/'>
January
</a>
<span class='post-count' dir='ltr'>(10)</span>
</li>
</ul>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2020/'>
2020
</a>
<span class='post-count' dir='ltr'>(36)</span>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2020/12/'>
December
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2020/11/'>
November
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2020/10/'>
October
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2020/09/'>
September
</a>
<span class='post-count' dir='ltr'>(4)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2020/08/'>
August
</a>
<span class='post-count' dir='ltr'>(5)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2020/07/'>
July
</a>
<span class='post-count' dir='ltr'>(8)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2020/06/'>
June
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2020/04/'>
April
</a>
<span class='post-count' dir='ltr'>(3)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2020/02/'>
February
</a>
<span class='post-count' dir='ltr'>(4)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2020/01/'>
January
</a>
<span class='post-count' dir='ltr'>(5)</span>
</li>
</ul>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2019/'>
2019
</a>
<span class='post-count' dir='ltr'>(27)</span>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2019/12/'>
December
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2019/11/'>
November
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2019/10/'>
October
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2019/09/'>
September
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2019/08/'>
August
</a>
<span class='post-count' dir='ltr'>(11)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2019/05/'>
May
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2019/04/'>
April
</a>
<span class='post-count' dir='ltr'>(3)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2019/03/'>
March
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2019/02/'>
February
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2019/01/'>
January
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2018/'>
2018
</a>
<span class='post-count' dir='ltr'>(22)</span>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2018/12/'>
December
</a>
<span class='post-count' dir='ltr'>(7)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2018/11/'>
November
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2018/10/'>
October
</a>
<span class='post-count' dir='ltr'>(4)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2018/09/'>
September
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2018/08/'>
August
</a>
<span class='post-count' dir='ltr'>(3)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2018/07/'>
July
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2018/06/'>
June
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2018/05/'>
May
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2018/04/'>
April
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2018/01/'>
January
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2017/'>
2017
</a>
<span class='post-count' dir='ltr'>(19)</span>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2017/12/'>
December
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2017/10/'>
October
</a>
<span class='post-count' dir='ltr'>(3)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2017/09/'>
September
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2017/08/'>
August
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2017/07/'>
July
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2017/05/'>
May
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2017/04/'>
April
</a>
<span class='post-count' dir='ltr'>(6)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2017/03/'>
March
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2017/02/'>
February
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2016/'>
2016
</a>
<span class='post-count' dir='ltr'>(17)</span>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2016/12/'>
December
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2016/11/'>
November
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2016/10/'>
October
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2016/09/'>
September
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2016/08/'>
August
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2016/07/'>
July
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2016/06/'>
June
</a>
<span class='post-count' dir='ltr'>(3)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2016/03/'>
March
</a>
<span class='post-count' dir='ltr'>(3)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2016/02/'>
February
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2016/01/'>
January
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2015/'>
2015
</a>
<span class='post-count' dir='ltr'>(33)</span>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2015/12/'>
December
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2015/11/'>
November
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2015/10/'>
October
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2015/09/'>
September
</a>
<span class='post-count' dir='ltr'>(4)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2015/08/'>
August
</a>
<span class='post-count' dir='ltr'>(6)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2015/07/'>
July
</a>
<span class='post-count' dir='ltr'>(5)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2015/06/'>
June
</a>
<span class='post-count' dir='ltr'>(4)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2015/05/'>
May
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2015/04/'>
April
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2015/03/'>
March
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2015/02/'>
February
</a>
<span class='post-count' dir='ltr'>(3)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2015/01/'>
January
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2014/'>
2014
</a>
<span class='post-count' dir='ltr'>(11)</span>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2014/12/'>
December
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2014/11/'>
November
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2014/10/'>
October
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2014/09/'>
September
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2014/08/'>
August
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://googleprojectzero.blogspot.com/2014/07/'>
July
</a>
<span class='post-count' dir='ltr'>(3)</span>
</li>
</ul>
</li>
</ul>
</div>
</div>
<script type='text/javascript'>
//<![CDATA[
(function(){
  let archive_list = document.getElementById('ArchiveList');
  if (archive_list == null) return;
  let cur_year = archive_list.querySelector('.post-count-link').innerText.trim() - 0;
  let last_year = 2014;
  let elements = [];
  const MONTHS = ',Jan,Feb,Mar,Apr,May,Jun,Jul,Aug,Sep,Oct,Nov,Dec'.split(',');

  let parent = document.getElementById('ArchiveList');
  while (parent.childNodes.length) parent.removeChild(parent.childNodes[0]);

  function fetch_next_year() {
    let url = 'https://googleprojectzero.blogspot.com/?action=getTitles&widgetId=BlogArchive1&widgetType=BlogArchive&responseType=js&path=https%3A%2F%2Fgoogleprojectzero.blogspot.com%2F'+cur_year;
    fetch(url).then(resp => {
      if (!resp.ok) {
        console.log('http error');
        return;
      }
      resp.text().then(text => {
        let scope = {
          _WidgetManager: {
            _HandleControllerResult: (name, method, results) => {
              elements.push(document.createElement('hr'));
              let year_header = document.createElement('div');
              year_header.appendChild(document.createTextNode(cur_year));
              year_header.style.fontSize = 'large';
              elements.push(year_header);

              let list = document.createElement('ul');
              elements.push(list);

              for (let obj of results.posts) {
                let link_parts = obj.url.split('/');
                let year = link_parts[3];
                let month = link_parts[4];

                let el = document.createElement(/*'div'*/'li');
                el.style.listStyleType = 'square';
                el.style.listStylePosition = 'inside';
                let link = document.createElement('a');
                el.appendChild(link);
                link.appendChild(document.createTextNode(obj.title));
                link.href = obj.url;
                let date_trailer = document.createElement('span');
                el.appendChild(date_trailer);
                //date_trailer.appendChild(document.createTextNode(' ('+year+'-'+month+')'));
                date_trailer.appendChild(document.createTextNode(' ('+MONTHS[parseInt(month, 10)]+')'));
                //date_trailer.style.textAlign = 'right';
                //elements.push(el);
                list.appendChild(el);
              }
            }
          }
        };
        with (scope) { eval(text); }
        if (cur_year == last_year) {
          finish();
        } else {
          cur_year--;
          fetch_next_year();
        }
      });
    });
  }
  fetch_next_year();
  function finish() {
    for (let obj of elements) {
      parent.appendChild(obj);
    }
    console.log(elements);
  }
})();
//]]>
</script>
<div class='clear'></div>
</div>
</div></div>
<table border='0' cellpadding='0' cellspacing='0' class='section-columns columns-2'>
<tbody>
<tr>
<td class='first columns-cell'>
<div class='sidebar no-items section' id='sidebar-right-2-1'></div>
</td>
<td class='columns-cell'>
<div class='sidebar no-items section' id='sidebar-right-2-2'></div>
</td>
</tr>
</tbody>
</table>
<div class='sidebar no-items section' id='sidebar-right-3'></div>
</aside>
</div>
</div>
</div>
<div style='clear: both'></div>
<!-- columns -->
</div>
<!-- main -->
</div>
</div>
<div class='main-cap-bottom cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
<footer>
<div class='footer-outer'>
<div class='footer-cap-top cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left footer-fauxborder-left'>
<div class='fauxborder-right footer-fauxborder-right'></div>
<div class='region-inner footer-inner'>
<div class='foot no-items section' id='footer-1'></div>
<table border='0' cellpadding='0' cellspacing='0' class='section-columns columns-2'>
<tbody>
<tr>
<td class='first columns-cell'>
<div class='foot no-items section' id='footer-2-1'></div>
</td>
<td class='columns-cell'>
<div class='foot no-items section' id='footer-2-2'></div>
</td>
</tr>
</tbody>
</table>
<!-- outside of the include in order to lock Attribution widget -->
<div class='foot section' id='footer-3' name='Footer'><div class='widget Attribution' data-version='1' id='Attribution1'>
<div class='widget-content' style='text-align: center;'>
Powered by <a href='https://www.blogger.com' target='_blank'>Blogger</a>.
</div>
<div class='clear'></div>
</div></div>
</div>
</div>
<div class='footer-cap-bottom cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
</footer>
<!-- content -->
</div>
</div>
<div class='content-cap-bottom cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
</div>
<script type='text/javascript'>
    window.setTimeout(function() {
        document.body.className = document.body.className.replace('loading', '');
      }, 10);
  </script>

<script type="text/javascript" src="https://www.blogger.com/static/v1/widgets/745881458-widgets.js"></script>
<script type='text/javascript'>
window['__wavt'] = 'AOuZoY6TXAJVwA0Ktof3eEa0VbNWMytv2A:1735155085079';_WidgetManager._Init('//www.blogger.com/rearrange?blogID\x3d4838136820032157985','//googleprojectzero.blogspot.com/2024/12/the-windows-registry-adventure-5-regf.html','4838136820032157985');
_WidgetManager._SetDataContext([{'name': 'blog', 'data': {'blogId': '4838136820032157985', 'title': 'Project Zero', 'url': 'https://googleprojectzero.blogspot.com/2024/12/the-windows-registry-adventure-5-regf.html', 'canonicalUrl': 'https://googleprojectzero.blogspot.com/2024/12/the-windows-registry-adventure-5-regf.html', 'homepageUrl': 'https://googleprojectzero.blogspot.com/', 'searchUrl': 'https://googleprojectzero.blogspot.com/search', 'canonicalHomepageUrl': 'https://googleprojectzero.blogspot.com/', 'blogspotFaviconUrl': 'https://googleprojectzero.blogspot.com/favicon.ico', 'bloggerUrl': 'https://www.blogger.com', 'hasCustomDomain': false, 'httpsEnabled': true, 'enabledCommentProfileImages': true, 'gPlusViewType': 'FILTERED_POSTMOD', 'adultContent': false, 'analyticsAccountNumber': 'UA-240546891-1', 'encoding': 'UTF-8', 'locale': 'en', 'localeUnderscoreDelimited': 'en', 'languageDirection': 'ltr', 'isPrivate': false, 'isMobile': false, 'isMobileRequest': false, 'mobileClass': '', 'isPrivateBlog': false, 'isDynamicViewsAvailable': true, 'feedLinks': '\x3clink rel\x3d\x22alternate\x22 type\x3d\x22application/atom+xml\x22 title\x3d\x22Project Zero - Atom\x22 href\x3d\x22https://googleprojectzero.blogspot.com/feeds/posts/default\x22 /\x3e\n\x3clink rel\x3d\x22alternate\x22 type\x3d\x22application/rss+xml\x22 title\x3d\x22Project Zero - RSS\x22 href\x3d\x22https://googleprojectzero.blogspot.com/feeds/posts/default?alt\x3drss\x22 /\x3e\n\x3clink rel\x3d\x22service.post\x22 type\x3d\x22application/atom+xml\x22 title\x3d\x22Project Zero - Atom\x22 href\x3d\x22https://www.blogger.com/feeds/4838136820032157985/posts/default\x22 /\x3e\n\n\x3clink rel\x3d\x22alternate\x22 type\x3d\x22application/atom+xml\x22 title\x3d\x22Project Zero - Atom\x22 href\x3d\x22https://googleprojectzero.blogspot.com/feeds/5470414558693895520/comments/default\x22 /\x3e\n', 'meTag': '', 'adsenseHostId': 'ca-host-pub-1556223355139109', 'adsenseHasAds': false, 'adsenseAutoAds': false, 'boqCommentIframeForm': true, 'loginRedirectParam': '', 'view': '', 'dynamicViewsCommentsSrc': '//www.blogblog.com/dynamicviews/4224c15c4e7c9321/js/comments.js', 'dynamicViewsScriptSrc': '//www.blogblog.com/dynamicviews/361ce9cf7a112c52', 'plusOneApiSrc': 'https://apis.google.com/js/platform.js', 'disableGComments': true, 'interstitialAccepted': false, 'sharing': {'platforms': [{'name': 'Get link', 'key': 'link', 'shareMessage': 'Get link', 'target': ''}, {'name': 'Facebook', 'key': 'facebook', 'shareMessage': 'Share to Facebook', 'target': 'facebook'}, {'name': 'BlogThis!', 'key': 'blogThis', 'shareMessage': 'BlogThis!', 'target': 'blog'}, {'name': 'X', 'key': 'twitter', 'shareMessage': 'Share to X', 'target': 'twitter'}, {'name': 'Pinterest', 'key': 'pinterest', 'shareMessage': 'Share to Pinterest', 'target': 'pinterest'}, {'name': 'Email', 'key': 'email', 'shareMessage': 'Email', 'target': 'email'}], 'disableGooglePlus': true, 'googlePlusShareButtonWidth': 0, 'googlePlusBootstrap': '\x3cscript type\x3d\x22text/javascript\x22\x3ewindow.___gcfg \x3d {\x27lang\x27: \x27en\x27};\x3c/script\x3e'}, 'hasCustomJumpLinkMessage': false, 'jumpLinkMessage': 'Read more', 'pageType': 'item', 'postId': '5470414558693895520', 'postImageThumbnailUrl': 'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiQtJm0XNkozXGxjQnB9n1ka9OuxP7lrLSQN1KZF-Zc60Z06dBEz3AAA8aAYnmdrU4imLebCFvF6qXaE0h-uA_iXnuyAisG90JWawSAMPPaToLdXMGeC4FlyGz42FWkf1bPhJmwSez8Ot-DLI29n4jinIXswZ-LQoLyWX7PIKVF5EwkRoAXNUFYIdcCOwo/s72-c/image8.png', 'postImageUrl': 'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiQtJm0XNkozXGxjQnB9n1ka9OuxP7lrLSQN1KZF-Zc60Z06dBEz3AAA8aAYnmdrU4imLebCFvF6qXaE0h-uA_iXnuyAisG90JWawSAMPPaToLdXMGeC4FlyGz42FWkf1bPhJmwSez8Ot-DLI29n4jinIXswZ-LQoLyWX7PIKVF5EwkRoAXNUFYIdcCOwo/s1200/image8.png', 'pageName': 'The Windows Registry Adventure #5: The regf file format', 'pageTitle': 'Project Zero: The Windows Registry Adventure #5: The regf file format'}}, {'name': 'features', 'data': {}}, {'name': 'messages', 'data': {'edit': 'Edit', 'linkCopiedToClipboard': 'Link copied to clipboard!', 'ok': 'Ok', 'postLink': 'Post Link'}}, {'name': 'template', 'data': {'name': 'custom', 'localizedName': 'Custom', 'isResponsive': false, 'isAlternateRendering': false, 'isCustom': true}}, {'name': 'view', 'data': {'classic': {'name': 'classic', 'url': '?view\x3dclassic'}, 'flipcard': {'name': 'flipcard', 'url': '?view\x3dflipcard'}, 'magazine': {'name': 'magazine', 'url': '?view\x3dmagazine'}, 'mosaic': {'name': 'mosaic', 'url': '?view\x3dmosaic'}, 'sidebar': {'name': 'sidebar', 'url': '?view\x3dsidebar'}, 'snapshot': {'name': 'snapshot', 'url': '?view\x3dsnapshot'}, 'timeslide': {'name': 'timeslide', 'url': '?view\x3dtimeslide'}, 'isMobile': false, 'title': 'The Windows Registry Adventure #5: The regf file format', 'description': '    Posted by Mateusz Jurczyk, Google Project Zero     As previously mentioned in the second installment of the blog post series ( \x22A brief ...', 'featuredImage': 'https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiQtJm0XNkozXGxjQnB9n1ka9OuxP7lrLSQN1KZF-Zc60Z06dBEz3AAA8aAYnmdrU4imLebCFvF6qXaE0h-uA_iXnuyAisG90JWawSAMPPaToLdXMGeC4FlyGz42FWkf1bPhJmwSez8Ot-DLI29n4jinIXswZ-LQoLyWX7PIKVF5EwkRoAXNUFYIdcCOwo/s1200/image8.png', 'url': 'https://googleprojectzero.blogspot.com/2024/12/the-windows-registry-adventure-5-regf.html', 'type': 'item', 'isSingleItem': true, 'isMultipleItems': false, 'isError': false, 'isPage': false, 'isPost': true, 'isHomepage': false, 'isArchive': false, 'isLabelSearch': false, 'postId': 5470414558693895520}}]);
_WidgetManager._RegisterWidget('_NavbarView', new _WidgetInfo('Navbar1', 'navbar', document.getElementById('Navbar1'), {}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_HeaderView', new _WidgetInfo('Header1', 'header', document.getElementById('Header1'), {}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_BlogView', new _WidgetInfo('Blog1', 'main', document.getElementById('Blog1'), {'cmtInteractionsEnabled': false, 'lightboxEnabled': true, 'lightboxModuleUrl': 'https://www.blogger.com/static/v1/jsbin/3846405171-lbx.js', 'lightboxCssUrl': 'https://www.blogger.com/static/v1/v-css/1964470060-lightbox_bundle.css'}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_BlogSearchView', new _WidgetInfo('BlogSearch1', 'sidebar-right-1', document.getElementById('BlogSearch1'), {}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_PageListView', new _WidgetInfo('PageList1', 'sidebar-right-1', document.getElementById('PageList1'), {'title': 'Pages', 'links': [{'isCurrentPage': false, 'href': 'https://googleprojectzero.blogspot.com/p/about-project-zero.html', 'id': '4384467920505278144', 'title': 'About Project Zero'}, {'isCurrentPage': false, 'href': 'https://googleprojectzero.blogspot.com/p/working-at-project-zero.html', 'id': '2459334498880008057', 'title': 'Working at Project Zero'}, {'isCurrentPage': false, 'href': 'https://googleprojectzero.blogspot.com/p/0day.html', 'id': '3414239791814532209', 'title': '0day \x22In the Wild\x22'}, {'isCurrentPage': false, 'href': 'https://googleprojectzero.github.io/0days-in-the-wild/rca.html', 'title': '0day Exploit Root Cause Analyses'}, {'isCurrentPage': false, 'href': 'https://googleprojectzero.blogspot.com/p/vulnerability-disclosure-faq.html', 'id': '2935252455704572784', 'title': 'Vulnerability Disclosure FAQ'}], 'mobile': false, 'showPlaceholder': true, 'hasCurrentPage': false}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_BlogArchiveView', new _WidgetInfo('BlogArchive1', 'sidebar-right-1', document.getElementById('BlogArchive1'), {'languageDirection': 'ltr', 'loadingMessage': 'Loading\x26hellip;'}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_AttributionView', new _WidgetInfo('Attribution1', 'footer-3', document.getElementById('Attribution1'), {}, 'displayModeFull'));
</script>
</body>
</html>