<!doctype html>
<html lang="en">

<head>
    <title>Covert Channels and Poor Decisions: The Tale of DNSMessenger</title>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://blog.talosintelligence.com/assets/css/bootstrap.min.css?v=d7eb88ed59">

    <link rel="stylesheet" href="https://blog.talosintelligence.com/assets/css/navigation.css?v=d7eb88ed59">
    <link rel="stylesheet" href="https://blog.talosintelligence.com/assets/css/footer.css?v=d7eb88ed59">

    <link rel="stylesheet" href="https://blog.talosintelligence.com/assets/css/pagination.css?v=d7eb88ed59">

    <link rel="stylesheet" href="https://blog.talosintelligence.com/assets/css/banners.css?v=d7eb88ed59">

    <link rel="stylesheet" href="https://blog.talosintelligence.com/assets/css/style.css?v=d7eb88ed59">

    <link rel="stylesheet" href="https://blog.talosintelligence.com/assets/css/prism.css?v=d7eb88ed59">
    <link rel="stylesheet" href="https://blog.talosintelligence.com/assets/css/prism-vsc-dark-plus.css?v=d7eb88ed59">
    <link rel="stylesheet" href="https://blog.talosintelligence.com/assets/css/prism-talos.css?v=d7eb88ed59">

    <link rel="stylesheet" href="https://blog.talosintelligence.com/assets/css/landing-page.css?v=d7eb88ed59">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;1,100;1,300;1,400&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Fira+Mono:wght@400;500&family=Roboto:ital,wght@0,100;0,300;0,400;0,500;1,100;1,300;1,400&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/ghost-theme-utils@latest/dist/css/style.min.css" rel="stylesheet">


    <link rel="icon" href="https://blog.talosintelligence.com/content/images/size/w256h256/2022/07/talos_o_square.png" type="image/png">
    <link rel="canonical" href="https://blog.talosintelligence.com/dnsmessenger/">
    <meta name="referrer" content="no-referrer-when-downgrade">
    
    <meta property="og:site_name" content="Cisco Talos Blog">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Covert Channels and Poor Decisions: The Tale of DNSMessenger">
    <meta property="og:description" content="This post was authored by Edmund Brumaghin and Colin Grady


Executive Summary

The Domain Name System (DNS) is one of the most commonly used Internet application protocols on corporate networks. It is responsible for providing name resolution so that network resources can be accessed by name, rather than requiring users">
    <meta property="og:url" content="https://blog.talosintelligence.com/dnsmessenger/">
    <meta property="og:image" content="https://blog.talosintelligence.com/content/images/-7hWV9xRNXZo/WLhLSyBq3QI/AAAAAAAAAOY/4Pgf_p65HXoKREdOIFevGcwcbPnfTzF_ACLcB/w1200-h630-p-k-no-nu/image10.jpg">
    <meta property="article:published_time" content="2017-03-02T17:11:00.000Z">
    <meta property="article:modified_time" content="2022-11-15T17:22:43.000Z">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Covert Channels and Poor Decisions: The Tale of DNSMessenger">
    <meta name="twitter:description" content="This post was authored by Edmund Brumaghin and Colin Grady


Executive Summary

The Domain Name System (DNS) is one of the most commonly used Internet application protocols on corporate networks. It is responsible for providing name resolution so that network resources can be accessed by name, rather than requiring users">
    <meta name="twitter:url" content="https://blog.talosintelligence.com/dnsmessenger/">
    <meta name="twitter:image" content="https://blog.talosintelligence.com/content/images/2022/11/image14-4.png">
    <meta name="twitter:label1" content="Written by">
    <meta name="twitter:data1" content="Edmund Brumaghin">
    <meta name="twitter:site" content="@TalosSecurity">
    <meta property="og:image:width" content="600">
    <meta property="og:image:height" content="314">
    
    <script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "Article",
    "publisher": {
        "@type": "Organization",
        "name": "Cisco Talos Blog",
        "url": "https://blog.talosintelligence.com/",
        "logo": {
            "@type": "ImageObject",
            "url": "https://blog.talosintelligence.com/content/images/2022/11/TalosBrand_ukraine.svg"
        }
    },
    "author": {
        "@type": "Person",
        "name": "Edmund Brumaghin",
        "url": "https://blog.talosintelligence.com/author/edmund-brumaghin/",
        "sameAs": []
    },
    "headline": "Covert Channels and Poor Decisions: The Tale of DNSMessenger",
    "url": "https://blog.talosintelligence.com/dnsmessenger/",
    "datePublished": "2017-03-02T17:11:00.000Z",
    "dateModified": "2022-11-15T17:22:43.000Z",
    "image": {
        "@type": "ImageObject",
        "url": "https://blog.talosintelligence.com/content/images/2022/11/image14-4.png",
        "width": 1001,
        "height": 501
    },
    "description": "This post was authored by Edmund Brumaghin and Colin Grady\n\n\nExecutive Summary\n\nThe Domain Name System (DNS) is one of the most commonly used Internet application protocols on corporate networks. It is responsible for providing name resolution so that network resources can be accessed by name, rather than requiring users to memorize IP addresses. While many organizations implement strict egress filtering as it pertains to web traffic, firewall rules, etc. many have less stringent controls in pla",
    "mainEntityOfPage": "https://blog.talosintelligence.com/dnsmessenger/"
}
    </script>

    <meta name="generator" content="Ghost 5.97">
    <link rel="alternate" type="application/rss+xml" title="Cisco Talos Blog" href="https://blog.talosintelligence.com/rss/">
    
    <script defer src="https://cdn.jsdelivr.net/ghost/sodo-search@~1.3/umd/sodo-search.min.js" data-key="4ffb0139d74ada998f4b141e4d" data-styles="https://cdn.jsdelivr.net/ghost/sodo-search@~1.3/umd/main.css" data-sodo-search="https://cisco-talos-blog.ghost.io/" data-locale="en" crossorigin="anonymous"></script>
    
    <link href="https://blog.talosintelligence.com/webmentions/receive/" rel="webmention">
    <script defer src="/public/cards.min.js?v=d7eb88ed59"></script><style>:root {--ghost-accent-color: #006db6;}</style>
    <link rel="stylesheet" type="text/css" href="/public/cards.min.css?v=d7eb88ed59">
    <style type='text/css'>
    img[src*="icon_check_white.svg"] { width: 20px; margin-left: 0px; margin-right: auto; }
    
    #ghost-portal-root { display: none; }
</style>
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-F45RVJG3BK"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-F45RVJG3BK');
</script>
</head>

<body class="post-template">

    <div id="mobile-page-header" class="desktop-hide">
    <h1>Cisco Talos Blog</h1>
</div>

<nav id="nav">
    <input id="nav-trigger" class="nav-trigger" type="checkbox"/>
    <label for="nav-trigger">
        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="22px" height="16px" viewBox="0 0 22 16">
            <g id="menu-icon">
                <path fill="#FFFFFF" d="M20.5,3h-19C0.672,3,0,2.329,0,1.5S0.672,0,1.5,0h19C21.328,0,22,0.671,22,1.5S21.328,3,20.5,3z"></path>
                <path fill="#FFFFFF" d="M20.5,9.5h-19C0.672,9.5,0,8.828,0,8c0-0.829,0.672-1.5,1.5-1.5h19C21.328,6.5,22,7.171,22,8   C22,8.828,21.328,9.5,20.5,9.5z"></path>
                <path fill="#FFFFFF" d="M20.5,16h-19C0.672,16,0,15.328,0,14.5S0.672,13,1.5,13h19c0.828,0,1.5,0.672,1.5,1.5S21.328,16,20.5,16z"></path>
            </g>
        </svg>
    </label>
    <div id="top-nav-bar">
    </div>

    <div id="navigation">
        <div class="navigation-logos-wrapper">
            <div id="talos-logo-wrapper">
                <a class="navbar-brand" href="https://talosintelligence.com">
                </a>
            </div>
        </div>
        <div class="navigation-links-wrapper">
            <ul class="main-nav-list">
                <li class="nav-item">
                    <div class="primary-link-wrapper">
                        <a class="primary_nav_link" href="https://talosintelligence.com/reputation">
                            <div class="mobile-nav-icon"><!-- Generator: Adobe Illustrator 24.2.1, SVG Export Plug-In . SVG Version: 6.00 Build 0)  --><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Layer_1" x="0px" y="0px" viewBox="0 0 20 20" height="20px" width="20px" style="enable-background:new 0 0 20 20;" xml:space="preserve">
                            <style type="text/css">
                                .white{fill:#FFFFFF;}
                            </style>
                            <g>
                                <path class="white" d="M19.5,9.5h-1.1c-0.3-4.2-3.6-7.6-7.8-7.8V0.5C10.5,0.2,10.3,0,10,0l0,0C9.7,0,9.5,0.2,9.5,0.5l0,0v1.1   C5.3,1.9,1.9,5.3,1.6,9.5H0.5C0.2,9.5,0,9.7,0,10s0.2,0.5,0.5,0.5l0,0h1.1c0.3,4.2,3.6,7.6,7.8,7.8v1.1c0,0.3,0.2,0.5,0.5,0.5l0,0   c0.3,0,0.5-0.2,0.5-0.5l0,0v-1.1c4.2-0.3,7.6-3.6,7.8-7.8h1.1c0.3,0,0.5-0.2,0.5-0.5C20,9.7,19.8,9.5,19.5,9.5 M16.6,10.5h0.7   c-0.3,3.6-3.2,6.5-6.8,6.8v-0.8c0-0.3-0.2-0.5-0.5-0.5l0,0c-0.3,0-0.5,0.2-0.5,0.5v0.8C5.8,17,3,14.2,2.7,10.5h0.8   C3.8,10.5,4,10.3,4,10S3.8,9.5,3.5,9.5l0,0H2.7C3,5.8,5.8,3,9.5,2.7v0.8C9.5,3.7,9.7,4,10,4l0,0c0.3,0,0.5-0.2,0.5-0.5V2.7   C14.2,3,17,5.8,17.3,9.5h-0.7c-0.3,0-0.5,0.2-0.5,0.5C16.1,10.3,16.3,10.5,16.6,10.5L16.6,10.5"></path>
                                                            <circle class="white" cx="10" cy="10" r="3.2"></circle>
                            </g>
                            </svg>
                            </div>
                            <span class="top-nav-link-text">
                                Intelligence Center
                            </span>
                        </a>
                    </div>
                    <input class="sub-nav-trigger" id="intelligence-sub-trigger" type="checkbox">
                    <label class="sub-nav-trigger-label" for="intelligence-sub-trigger">
                        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="48.167px" height="47.75px" viewBox="0 0 48.167 47.75">
                            <circle opacity="0.4" fill="none" stroke="#FFFFFF" stroke-miterlimit="10" cx="24.083" cy="23.875" r="22"></circle>
                            <g>
                                <circle fill="#FFFFFF" cx="24.083" cy="16.068" r="2.496"></circle>
                                <circle fill="#FFFFFF" cx="24.083" cy="23.875" r="2.496"></circle>
                                <circle fill="#FFFFFF" cx="24.083" cy="31.682" r="2.496"></circle>
                            </g>
                        </svg>

                    </label>
                    <ul class="sub-nav sub-nav-single-list">
                        <li class="desktop-hide">
                            <a class="mobile_nav_link" href="https://talosintelligence.com/reputation"><h1>Intelligence Center</h1>
                            </a></li>
                        <li class="desktop-hide">
                            <label class="subnav-back-button" for="intelligence-sub-trigger">BACK</label>
                        </li>
                        <li><a class="secondary_nav_link" href="https://talosintelligence.com/reputation_center">Intelligence Search</a></li>
                        <li><a class="secondary_nav_link" href="https://talosintelligence.com/reputation_center/email_rep">Email &amp; Spam Trends</a></li>
                    </ul>
                    <div class="desktop-hide subnav-overlay"><!-- Generator: Adobe Illustrator 24.2.1, SVG Export Plug-In . SVG Version: 6.00 Build 0)  --><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Layer_1" x="0px" y="0px" viewBox="0 0 20 20" height="20px" width="20px" style="enable-background:new 0 0 20 20;" xml:space="preserve">
                        <style type="text/css">
                            .white{fill:#FFFFFF;}
                        </style>
                                                <g>
                            <path class="white" d="M19.5,9.5h-1.1c-0.3-4.2-3.6-7.6-7.8-7.8V0.5C10.5,0.2,10.3,0,10,0l0,0C9.7,0,9.5,0.2,9.5,0.5l0,0v1.1   C5.3,1.9,1.9,5.3,1.6,9.5H0.5C0.2,9.5,0,9.7,0,10s0.2,0.5,0.5,0.5l0,0h1.1c0.3,4.2,3.6,7.6,7.8,7.8v1.1c0,0.3,0.2,0.5,0.5,0.5l0,0   c0.3,0,0.5-0.2,0.5-0.5l0,0v-1.1c4.2-0.3,7.6-3.6,7.8-7.8h1.1c0.3,0,0.5-0.2,0.5-0.5C20,9.7,19.8,9.5,19.5,9.5 M16.6,10.5h0.7   c-0.3,3.6-3.2,6.5-6.8,6.8v-0.8c0-0.3-0.2-0.5-0.5-0.5l0,0c-0.3,0-0.5,0.2-0.5,0.5v0.8C5.8,17,3,14.2,2.7,10.5h0.8   C3.8,10.5,4,10.3,4,10S3.8,9.5,3.5,9.5l0,0H2.7C3,5.8,5.8,3,9.5,2.7v0.8C9.5,3.7,9.7,4,10,4l0,0c0.3,0,0.5-0.2,0.5-0.5V2.7   C14.2,3,17,5.8,17.3,9.5h-0.7c-0.3,0-0.5,0.2-0.5,0.5C16.1,10.3,16.3,10.5,16.6,10.5L16.6,10.5"></path>
                                                    <circle class="white" cx="10" cy="10" r="3.2"></circle>
                        </g>
                        </svg>
                    </div>
                </li>
                <li class="nav-item">
                    <div class="primary-link-wrapper">
                        <a class="primary_nav_link" href="https://talosintelligence.com/vulnerability_info"><div class="mobile-nav-icon"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="26px" height="20px" viewBox="0 0 26 20">
                            <g id="vuln-icon" class="nav-icon">
                                <path fill="#FFFFFF" d="M24.256,18.49L13.872,0.503C13.692,0.192,13.36,0,13,0c-0.359,0-0.692,0.192-0.872,0.503L1.744,18.49  c-0.18,0.312-0.18,0.695,0,1.006C1.924,19.809,2.257,20,2.616,20h20.769c0.359,0,0.691-0.191,0.871-0.504  C24.436,19.186,24.436,18.803,24.256,18.49 M14.268,18.215h-2.533v-1.85h2.533V18.215z M14.268,15.441h-2.533L10.89,6.515h4.222  L14.268,15.441z"></path>
                            </g>
                        </svg>
                        </div>
                            <span class="top-nav-link-text">
                            Vulnerability Research
                            </span>
                        </a></div>
                    <input class="sub-nav-trigger" id="vuln-sub-trigger" type="checkbox">
                    <label class="sub-nav-trigger-label" for="vuln-sub-trigger">
                        <div class="mobile-nav-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="48.167px" height="47.75px" viewBox="0 0 48.167 47.75">
                            <circle opacity="0.4" fill="none" stroke="#FFFFFF" stroke-miterlimit="10" cx="24.083" cy="23.875" r="22"></circle>
                            <g>
                                <circle fill="#FFFFFF" cx="24.083" cy="16.068" r="2.496"></circle>
                                <circle fill="#FFFFFF" cx="24.083" cy="23.875" r="2.496"></circle>
                                <circle fill="#FFFFFF" cx="24.083" cy="31.682" r="2.496"></circle>
                            </g>
                        </svg>
                        </div>
                    </label>
                    <ul class="sub-nav sub-nav-single-list">
                        <li class="desktop-hide">
                            <a href="https://talosintelligence.com/vulnerability_info"><h1>Vulnerability Information</h1>
                            </a></li>
                        <li class="desktop-hide">
                            <label class="subnav-back-button" for="vuln-sub-trigger">BACK</label>
                        </li>
                        <li><a class="vulnerabilty-info-nav-link" href="https://talosintelligence.com/vulnerability_reports">Vulnerability Reports</a></li>
                        <li><a class="vulnerabilty-info-nav-link" href="https://talosintelligence.com/ms_advisories">Microsoft Advisories</a></li>
                    </ul>
                    <div class="desktop-hide subnav-overlay">
                        <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="26px" height="20px" viewBox="0 0 26 20">
                        <g id="vuln-icon" class="nav-icon">
                            <path fill="#FFFFFF" d="M24.256,18.49L13.872,0.503C13.692,0.192,13.36,0,13,0c-0.359,0-0.692,0.192-0.872,0.503L1.744,18.49  c-0.18,0.312-0.18,0.695,0,1.006C1.924,19.809,2.257,20,2.616,20h20.769c0.359,0,0.691-0.191,0.871-0.504  C24.436,19.186,24.436,18.803,24.256,18.49 M14.268,18.215h-2.533v-1.85h2.533V18.215z M14.268,15.441h-2.533L10.89,6.515h4.222  L14.268,15.441z"></path>
                        </g>
                        </svg>
                    </div>
                </li>
                <li class="nav-item">
                    <a class="primary_nav_link" href="https://talosintelligence.com/incident_response">
                        <div class="mobile-nav-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="111.588" height="148.311" viewBox="0 0 111.588 148.311">
                            <path d="M1.181,128.446v15.7a4.167,4.167,0,0,0,4.167,4.167h100.9a4.167,4.167,0,0,0,4.167-4.167v-15.7a4.167,4.167,0,0,0-4.167-4.167H5.348a4.167,4.167,0,0,0-4.167,4.166M55.8,63.109a3.277,3.277,0,1,1,0,6.553c-10.344,0-20.755,8.578-20.755,18.57a3.277,3.277,0,1,1-6.554,0C28.489,73.947,41.93,63.109,55.8,63.109Zm0-12.016c-21.787,0-39.325,17.81-39.325,39.937v26.7H95.122V91.03c0-22.128-17.537-39.937-39.324-39.937m52.365-38.3a3.291,3.291,0,0,0-2.254,1.024L88.432,31.294a3.283,3.283,0,0,0,4.642,4.644l17.478-17.479a3.278,3.278,0,0,0-2.389-5.666m-105.138,0a3.276,3.276,0,0,0-1.98,5.666L18.522,35.938a3.283,3.283,0,0,0,4.643-4.644L5.687,13.817A3.255,3.255,0,0,0,3.025,12.793ZM55.389.026a3.276,3.276,0,0,0-2.867,3.345V19.642a3.277,3.277,0,1,0,6.554,0V3.371A3.283,3.283,0,0,0,55.389.026Z" fill="#fff"></path>
                            </svg>
                        </div>
                        <span class="top-nav-link-text">
                        Incident Response
                        </span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="primary_nav_link" href="https://blog.talosintelligence.com">
                        <div class="mobile-nav-icon">
                        <!-- Generator: Adobe Illustrator 16.0.0, SVG Export Plug-In . SVG Version: 6.00 Build 0)  --><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Layer_1" x="0px" y="0px" width="260px" height="296.5px" viewBox="0 0 260 296.5" enable-background="new 0 0 260 296.5" xml:space="preserve">
                        <path fill="#FFFFFF" d="M243.586,42.404h-14.448c-0.943-4.513-3.143-8.813-6.616-12.33L201.793,9.098  c-4.7-4.757-10.972-7.377-17.66-7.377c-6.578,0-12.777,2.547-17.457,7.173l-33.875,33.511H17.586c-6.6,0-12,5.399-12,12V226.28  c0,6.6,5.4,12,12,12H153.83l84.21,56.278l-27.448-56.278h32.994c6.6,0,12-5.4,12-12V54.404  C255.586,47.804,250.186,42.404,243.586,42.404z M214.662,48.045c-0.01,0.2-0.021,0.399-0.044,0.599  c-0.008,0.069-0.021,0.139-0.031,0.207c-0.046,0.345-0.113,0.688-0.196,1.026c-0.034,0.137-0.063,0.273-0.103,0.408  c-0.039,0.135-0.087,0.267-0.133,0.399c-0.051,0.151-0.102,0.302-0.16,0.45c-0.049,0.126-0.105,0.249-0.16,0.373  c-0.068,0.153-0.139,0.307-0.216,0.457c-0.059,0.116-0.12,0.23-0.184,0.345c-0.088,0.157-0.181,0.312-0.278,0.465  c-0.065,0.104-0.13,0.206-0.2,0.308c-0.115,0.168-0.239,0.33-0.366,0.492c-0.064,0.081-0.124,0.165-0.19,0.244  c-0.199,0.238-0.409,0.472-0.635,0.694L82.458,182.308l-47.932,12.871l13.427-47.74L177.223,19.561  c1.917-1.895,4.414-2.84,6.911-2.84c2.534,0,5.068,0.975,6.99,2.92l20.726,20.974c0.545,0.552,1.002,1.156,1.39,1.79  c0.574,0.938,0.975,1.951,1.206,2.993c0.004,0.021,0.01,0.04,0.014,0.06c0.049,0.226,0.086,0.453,0.119,0.682  c0.008,0.06,0.017,0.118,0.024,0.178c0.026,0.211,0.045,0.424,0.058,0.636c0.004,0.077,0.007,0.153,0.009,0.23  c0.007,0.203,0.011,0.407,0.005,0.61C214.673,47.877,214.666,47.961,214.662,48.045z"></path>
                        </svg>
                    </div>
                        <span class="top-nav-link-text">Blog</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a class="primary_nav_link" href="https://support.talosintelligence.com">
                        <div class="mobile-nav-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" width="26px" height="20px" viewBox="0 0 123.17 159.292">
                            <path d="M61.59,0,0,17.069v85.32c0,23.472,61.59,56.9,61.59,56.9s61.58-36.288,61.58-56.9V17.069Zm-.433,149.746C38.314,136.662,8.128,114.3,8.128,102.389V23.239l53.029-14.7Z" fill="#fff"></path>
                        </svg>
                        </div>
                        <span class="top-nav-link-text">Support</span>
                    </a>
                </li>
            </ul>


<!--                <li class="nav-item desktop-hide">-->
<!--                    <button class="search-button" data-ghost-search><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg> <span>Search Blog</span></button>-->
<!--                </li>-->

            <ul class="secondary-nav-list">
                <div class="more-desktop-link">
                    <div class="more-link-wrapper">
                        <span class="more-nav-link">
                            <div class="desktop-nav-icon more-menu-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="22px" height="16px" viewBox="0 0 22 16">
                                <g id="menu-icon">
                                    <path fill="#FFFFFF" d="M20.5,3h-19C0.672,3,0,2.329,0,1.5S0.672,0,1.5,0h19C21.328,0,22,0.671,22,1.5S21.328,3,20.5,3z"></path>
                                    <path fill="#FFFFFF" d="M20.5,9.5h-19C0.672,9.5,0,8.828,0,8c0-0.829,0.672-1.5,1.5-1.5h19C21.328,6.5,22,7.171,22,8   C22,8.828,21.328,9.5,20.5,9.5z"></path>
                                    <path fill="#FFFFFF" d="M20.5,16h-19C0.672,16,0,15.328,0,14.5S0.672,13,1.5,13h19c0.828,0,1.5,0.672,1.5,1.5S21.328,16,20.5,16z"></path>
                                </g>
                                </svg>
                            </div>
                            <span class="top-nav-link-text top-nav-more-text">
                            More
                            </span>
                        </span>
                    </div>
                </div>
                <li class="nav-item more-text-link">
                    <div class="more-link-wrapper more-link-wrapper-mobile">
                        <span class="more-nav-link">
                            <div class="mobile-nav-icon"><!-- Generator: Adobe Illustrator 24.2.1, SVG Export Plug-In . SVG Version: 6.00 Build 0)  --><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Layer_1" x="0px" y="0px" viewBox="0 0 20 20" style="enable-background:new 0 0 20 20;" width="25px" height="25px" xml:space="preserve">
                                <style type="text/css">
                                    .white{fill:#FFFFFF;}
                                </style>
                                <path class="white" d="M19.4,17.1c0,0.1-0.1,0-0.2,0c0,0-1.3-0.9-2-1.4c-0.2-0.1-0.5-0.1-0.6,0.1c-0.3,0.3-0.6,0.8-0.9,1.3  c-0.1,0.2-0.1,0.5,0.1,0.6l2,1.5c0.1,0,0,0.1,0.1,0.2c0,0.1,0,0.1-0.1,0.2c-1.2,0.5-2.6,0.2-3.5-0.7c-0.8-0.9-1-2-0.7-3.1L4.5,6.5  c-1,0.3-2.3,0-3-0.9c-0.8-0.9-1.1-1.7-1-2.7c0-0.1,0-0.1,0.1-0.2c0.1,0,0.2,0.1,0.2,0.1l2,1.5C3,4.4,3.3,4.5,3.4,4.2  c0,0,0.5-0.8,0.9-1.3c0.1-0.2,0.1-0.5-0.1-0.6L2.3,0.9c-0.1,0,0-0.1-0.1-0.3c0-0.1,0-0.1,0.1-0.2C3.5-0.1,5,0.2,5.8,1.1  c0.8,0.9,1,2,0.7,3.1l9.1,9.3c1-0.3,2.3,0,3,0.9c0.7,0.7,0.9,1.5,0.9,2.5C19.5,16.9,19.5,17,19.4,17.1z"></path>
                                </svg>
                            </div>
                            <span class="top-nav-link-text top-nav-more-text">
                            Security Resources
                            </span>
                        </span>
                    </div>
                    <input class="sub-nav-trigger" id="security-resources-sub-trigger" type="checkbox">
                    <label class="sub-nav-trigger-label" for="security-resources-sub-trigger">
                        <div class="mobile-nav-icon"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="48.167px" height="47.75px" viewBox="0 0 48.167 47.75">
                            <circle opacity="0.4" fill="none" stroke="#FFFFFF" stroke-miterlimit="10" cx="24.083" cy="23.875" r="22"></circle>
                            <g>
                                <circle fill="#FFFFFF" cx="24.083" cy="16.068" r="2.496"></circle>
                                <circle fill="#FFFFFF" cx="24.083" cy="23.875" r="2.496"></circle>
                                <circle fill="#FFFFFF" cx="24.083" cy="31.682" r="2.496"></circle>
                            </g>
                        </svg>
                        </div>
                    </label>
                    <div class="sub-nav sub-nav-multiple-list sub-nav-multiple-list-left">
                        <div class="sub-nav-multiple-wrapper">
                            <div class="sub-nav-list-top-of-mobile-wrapper">
                                <h1 class="sub-nav-list-header sub-nav-list-top-of-mobile">Security Resources</h1>
                                <ul class="sub-nav-list">
                                    <li class="desktop-hide">
                                        <label class="subnav-back-button" for="security-resources-sub-trigger">BACK</label>
                                    </li>
                                </ul>
                            </div>
                            <div class="sub-nav-list-item-wrapper">
                                <span class="sub-nav-desktop-header uppercase">Security Resources</span>
                                <ul class="sub-nav-list">
                                    <li>
                                        <a href="https://talosintelligence.com/software"><span>Open Source Security Tools</span>
                                        </a></li>
                                    <li>
                                        <a href="https://talosintelligence.com/categories"><span>Intelligence Categories Reference</span>
                                        </a></li>
                                    <li>
                                        <a href="https://talosintelligence.com/secure-endpoint-naming"><span>Secure Endpoint Naming Reference</span>
                                        </a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="desktop-hide subnav-overlay"><!-- Generator: Adobe Illustrator 24.2.1, SVG Export Plug-In . SVG Version: 6.00 Build 0)  --><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Layer_1" x="0px" y="0px" viewBox="0 0 20 20" style="enable-background:new 0 0 20 20;" width="25px" height="25px" xml:space="preserve">
                        <style type="text/css">
                            .white{fill:#FFFFFF;}
                        </style>
                                                <path class="white" d="M19.4,17.1c0,0.1-0.1,0-0.2,0c0,0-1.3-0.9-2-1.4c-0.2-0.1-0.5-0.1-0.6,0.1c-0.3,0.3-0.6,0.8-0.9,1.3  c-0.1,0.2-0.1,0.5,0.1,0.6l2,1.5c0.1,0,0,0.1,0.1,0.2c0,0.1,0,0.1-0.1,0.2c-1.2,0.5-2.6,0.2-3.5-0.7c-0.8-0.9-1-2-0.7-3.1L4.5,6.5  c-1,0.3-2.3,0-3-0.9c-0.8-0.9-1.1-1.7-1-2.7c0-0.1,0-0.1,0.1-0.2c0.1,0,0.2,0.1,0.2,0.1l2,1.5C3,4.4,3.3,4.5,3.4,4.2  c0,0,0.5-0.8,0.9-1.3c0.1-0.2,0.1-0.5-0.1-0.6L2.3,0.9c-0.1,0,0-0.1-0.1-0.3c0-0.1,0-0.1,0.1-0.2C3.5-0.1,5,0.2,5.8,1.1  c0.8,0.9,1,2,0.7,3.1l9.1,9.3c1-0.3,2.3,0,3,0.9c0.7,0.7,0.9,1.5,0.9,2.5C19.5,16.9,19.5,17,19.4,17.1z"></path>
                        </svg>
                    </div>
                </li>
                <li class="nav-item">
                    <div class="more-link-wrapper more-link-wrapper-mobile">
                        <span class="more-nav-link">
                            <div class="mobile-nav-icon"><!-- Generator: Adobe Illustrator 24.2.1, SVG Export Plug-In . SVG Version: 6.00 Build 0)  --><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Layer_1" x="0px" y="0px" viewBox="0 0 20 20" width="25px" height="25px" style="enable-background:new 0 0 20 20;" xml:space="preserve">
                                <style type="text/css">
                                    .sticoncomment{fill-rule:evenodd;clip-rule:evenodd;fill:#FFFFFF;}
                                </style>
                                <path class="sticoncomment" d="M13.6,7.1H6.4c-0.3,0-0.6-0.3-0.6-0.6c0-0.3,0.3-0.6,0.6-0.6l7.2,0c0.3,0,0.6,0.3,0.6,0.6  C14.2,6.8,13.9,7.1,13.6,7.1L13.6,7.1z M13.6,9.4H6.4c-0.3,0-0.6-0.3-0.6-0.6s0.3-0.6,0.6-0.6l7.2,0c0.3,0,0.6,0.3,0.6,0.6  C14.2,9.2,13.9,9.4,13.6,9.4L13.6,9.4z M11.5,11.7H6.4c-0.3,0-0.6-0.3-0.6-0.6c0-0.3,0.3-0.6,0.6-0.6h5.1c0.3,0,0.6,0.3,0.6,0.6  C12.1,11.5,11.8,11.7,11.5,11.7z M15.8,3H4.2C3.5,3,3,3.5,3,4.2V17l2.8-2.3h10c0.6,0,1.2-0.5,1.2-1.2V4.2C17,3.5,16.5,3,15.8,3  L15.8,3z"></path>
                                </svg>
                            </div>
                            <span class="top-nav-link-text top-nav-more-text">
                            Media
                            </span>
                        </span>
                    </div>
                    <input class="sub-nav-trigger" id="media-sub-trigger" type="checkbox">
                    <label class="sub-nav-trigger-label" for="media-sub-trigger">
                        <div class="mobile-nav-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="48.167px" height="47.75px" viewBox="0 0 48.167 47.75">
                            <circle opacity="0.4" fill="none" stroke="#FFFFFF" stroke-miterlimit="10" cx="24.083" cy="23.875" r="22"></circle>
                            <g>
                                <circle fill="#FFFFFF" cx="24.083" cy="16.068" r="2.496"></circle>
                                <circle fill="#FFFFFF" cx="24.083" cy="23.875" r="2.496"></circle>
                                <circle fill="#FFFFFF" cx="24.083" cy="31.682" r="2.496"></circle>
                            </g>
                            </svg>
                        </div>
                    </label>
                    <div class="sub-nav sub-nav-multiple-list sub-nav-multiple-list-middle">
                        <div class="sub-nav-multiple-wrapper">
                            <div class="sub-nav-list-top-of-mobile-wrapper">
                                <h1 class="sub-nav-list-header sub-nav-list-top-of-mobile">Media</h1>
                                <ul class="sub-nav-list">
                                    <li class="desktop-hide">
                                        <label class="subnav-back-button" for="media-sub-trigger">BACK</label>
                                    </li>
                                </ul>
                            </div>
                            <div class="sub-nav-list-item-wrapper">
                                <span class="sub-nav-desktop-header uppercase">Media</span>
                                <ul class="sub-nav-list">
                                    <li>
                                        <a href="https://blog.talosintelligence.com"><span>Talos Intelligence Blog</span>
                                        </a></li>
                                    <li>
                                        <a href="https://blog.talosintelligence.com/category/threat-source-newsletter/"><span>Threat Source Newsletter</span>
                                        </a></li>
                                    <li>
                                        <a href="https://talosintelligence.com/podcasts/shows/beers_with_talos"><span>Beers with Talos Podcast</span>
                                        </a></li>
                                    <li>
                                        <a href="https://talosintelligence.com/podcasts/shows/talos_takes"><span>Talos Takes Podcast</span>
                                        </a></li>
                                    <li>
                                        <a target="_blank" href="https://www.youtube.com/channel/UCPZ1DtzQkStYBSG3GTNoyfg/featured"><span>Talos Videos</span>
                                        </a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="desktop-hide subnav-overlay"><!-- Generator: Adobe Illustrator 24.2.1, SVG Export Plug-In . SVG Version: 6.00 Build 0)  --><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" version="1.1" id="Layer_1" x="0px" y="0px" viewBox="0 0 20 20" width="25px" height="25px" style="enable-background:new 0 0 20 20;" xml:space="preserve">
                        <style type="text/css">
                            .sticoncomment{fill-rule:evenodd;clip-rule:evenodd;fill:#FFFFFF;}
                        </style>
                        <path class="sticoncomment" d="M13.6,7.1H6.4c-0.3,0-0.6-0.3-0.6-0.6c0-0.3,0.3-0.6,0.6-0.6l7.2,0c0.3,0,0.6,0.3,0.6,0.6  C14.2,6.8,13.9,7.1,13.6,7.1L13.6,7.1z M13.6,9.4H6.4c-0.3,0-0.6-0.3-0.6-0.6s0.3-0.6,0.6-0.6l7.2,0c0.3,0,0.6,0.3,0.6,0.6  C14.2,9.2,13.9,9.4,13.6,9.4L13.6,9.4z M11.5,11.7H6.4c-0.3,0-0.6-0.3-0.6-0.6c0-0.3,0.3-0.6,0.6-0.6h5.1c0.3,0,0.6,0.3,0.6,0.6  C12.1,11.5,11.8,11.7,11.5,11.7z M15.8,3H4.2C3.5,3,3,3.5,3,4.2V17l2.8-2.3h10c0.6,0,1.2-0.5,1.2-1.2V4.2C17,3.5,16.5,3,15.8,3  L15.8,3z"></path>
                        </svg>
                    </div>
                </li>
                <li class="nav-item">
                    <div class="more-link-wrapper more-link-wrapper-mobile">
                        <span class="more-nav-link">
                            <div class="mobile-nav-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="25px" height="25px" viewBox="0 0 55 55">
                                <g>
                                    <g class="mobile-nav-home">
                                        <path fill-rule="evenodd" clip-rule="evenodd" fill="#FFFFFF" d="M45.201,12.343c0.378,0.48,0.758,0.925,1.096,1.401    c2.975,4.207,4.543,8.876,4.494,14.044c-0.05,5.452-1.643,10.386-5.186,14.593c-3.484,4.133-7.929,6.73-13.182,7.895    c-6.313,1.398-12.216,0.275-17.695-3.131c-0.441-0.273-0.847-0.6-1.266-0.904c-0.11-0.078-0.208-0.174-0.337-0.287    c0.127-0.141,0.246-0.27,0.366-0.398c0.887-0.949,1.765-1.904,2.663-2.844c0.114-0.119,0.321-0.217,0.485-0.217    c3.658-0.006,7.318,0,10.975,0.008c3.458,0.006,6.913,0.02,10.369,0.02c0.957,0,1.871-0.193,2.62-0.844    c0.797-0.693,1.157-1.596,1.157-2.643c0.001-7.533,0.003-15.067-0.005-22.601c-0.002-0.309,0.088-0.524,0.3-0.743    C43.098,14.598,44.127,13.49,45.201,12.343"></path>
                                        <path fill-rule="evenodd" clip-rule="evenodd" fill="#FFFFFF" d="M41.402,8.822c-0.99,1.027-1.994,2.021-2.935,3.072    c-0.312,0.35-0.616,0.416-1.036,0.415c-6.98-0.009-13.957-0.007-20.938-0.007c-2.039,0-3.561,1.514-3.561,3.557    c0,6.504,0.002,13.008,0.006,19.512c0.002,0.973,0.011,1.943,0.004,2.914c0,0.133-0.04,0.301-0.127,0.393    c-1.069,1.162-2.15,2.314-3.229,3.469c-0.021,0.023-0.052,0.039-0.109,0.08c-0.159-0.188-0.323-0.369-0.471-0.562    c-2.535-3.348-4.119-7.102-4.605-11.268c-0.61-5.229,0.194-10.229,2.835-14.839c2.669-4.664,6.655-7.805,11.618-9.75    c3.205-1.257,6.533-1.852,9.977-1.621c4.478,0.298,8.553,1.754,12.227,4.325c0.101,0.072,0.197,0.151,0.291,0.229    C41.364,8.755,41.374,8.778,41.402,8.822"></path>
                                        <path fill-rule="evenodd" clip-rule="evenodd" fill="#FFFFFF" d="M39.799,12.47c0.873-0.911,1.749-1.829,2.676-2.797    c0.605,0.564,1.195,1.112,1.816,1.691c-0.941,0.985-1.817,1.903-2.703,2.83c-0.276-0.339-0.511-0.688-0.807-0.975    C40.492,12.941,40.145,12.728,39.799,12.47"></path>
                                        <path fill-rule="evenodd" clip-rule="evenodd" fill="#FFFFFF" d="M10.35,43.279c0.969-1.016,1.885-1.977,2.76-2.893    c0.213,0.369,0.376,0.762,0.639,1.072c0.265,0.312,0.627,0.539,0.98,0.832c-0.853,0.891-1.713,1.791-2.624,2.746    C11.513,44.445,10.939,43.869,10.35,43.279"></path>
                                    </g>
                                </g>
                                </svg>
                            </div>
                            <span class="top-nav-link-text top-nav-more-text">
                            Company
                            </span>
                        </span>
                    </div>
                    <input class="sub-nav-trigger" id="company-sub-trigger" type="checkbox">
                    <label class="sub-nav-trigger-label" for="company-sub-trigger">
                        <div class="mobile-nav-icon">
                            <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="48.167px" height="47.75px" viewBox="0 0 48.167 47.75">
                            <circle opacity="0.4" fill="none" stroke="#FFFFFF" stroke-miterlimit="10" cx="24.083" cy="23.875" r="22"></circle>
                            <g>
                                <circle fill="#FFFFFF" cx="24.083" cy="16.068" r="2.496"></circle>
                                <circle fill="#FFFFFF" cx="24.083" cy="23.875" r="2.496"></circle>
                                <circle fill="#FFFFFF" cx="24.083" cy="31.682" r="2.496"></circle>
                            </g>
                        </svg>
                        </div>
                    </label>
                    <div class="sub-nav sub-nav-multiple-list sub-nav-multiple-list-right">
                        <div class="sub-nav-multiple-wrapper">
                            <div class="sub-nav-list-top-of-mobile-wrapper">
                                <h1 class="sub-nav-list-header sub-nav-list-top-of-mobile">Company</h1>
                                <ul class="sub-nav-list">
                                    <li class="desktop-hide">
                                        <label class="subnav-back-button" for="company-sub-trigger">BACK</label>
                                    </li>
                                </ul>
                            </div>
                            <div class="sub-nav-list-item-wrapper">
                                <span class="sub-nav-desktop-header uppercase">Company</span>
                                <ul class="sub-nav-list">
                                    <li>
                                        <a href="https://talosintelligence.com/about"><span>About Talos</span>
                                        </a></li>
                                    <li>
                                        <a href="https://talosintelligence.com/careers"><span>Careers</span>
                                        </a></li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="desktop-hide subnav-overlay"><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="25px" height="25px" viewBox="0 0 55 55">
                        <g>
                            <g class="mobile-nav-home">
                                <path fill-rule="evenodd" clip-rule="evenodd" fill="#FFFFFF" d="M45.201,12.343c0.378,0.48,0.758,0.925,1.096,1.401    c2.975,4.207,4.543,8.876,4.494,14.044c-0.05,5.452-1.643,10.386-5.186,14.593c-3.484,4.133-7.929,6.73-13.182,7.895    c-6.313,1.398-12.216,0.275-17.695-3.131c-0.441-0.273-0.847-0.6-1.266-0.904c-0.11-0.078-0.208-0.174-0.337-0.287    c0.127-0.141,0.246-0.27,0.366-0.398c0.887-0.949,1.765-1.904,2.663-2.844c0.114-0.119,0.321-0.217,0.485-0.217    c3.658-0.006,7.318,0,10.975,0.008c3.458,0.006,6.913,0.02,10.369,0.02c0.957,0,1.871-0.193,2.62-0.844    c0.797-0.693,1.157-1.596,1.157-2.643c0.001-7.533,0.003-15.067-0.005-22.601c-0.002-0.309,0.088-0.524,0.3-0.743    C43.098,14.598,44.127,13.49,45.201,12.343"></path>
                                <path fill-rule="evenodd" clip-rule="evenodd" fill="#FFFFFF" d="M41.402,8.822c-0.99,1.027-1.994,2.021-2.935,3.072    c-0.312,0.35-0.616,0.416-1.036,0.415c-6.98-0.009-13.957-0.007-20.938-0.007c-2.039,0-3.561,1.514-3.561,3.557    c0,6.504,0.002,13.008,0.006,19.512c0.002,0.973,0.011,1.943,0.004,2.914c0,0.133-0.04,0.301-0.127,0.393    c-1.069,1.162-2.15,2.314-3.229,3.469c-0.021,0.023-0.052,0.039-0.109,0.08c-0.159-0.188-0.323-0.369-0.471-0.562    c-2.535-3.348-4.119-7.102-4.605-11.268c-0.61-5.229,0.194-10.229,2.835-14.839c2.669-4.664,6.655-7.805,11.618-9.75    c3.205-1.257,6.533-1.852,9.977-1.621c4.478,0.298,8.553,1.754,12.227,4.325c0.101,0.072,0.197,0.151,0.291,0.229    C41.364,8.755,41.374,8.778,41.402,8.822"></path>
                                <path fill-rule="evenodd" clip-rule="evenodd" fill="#FFFFFF" d="M39.799,12.47c0.873-0.911,1.749-1.829,2.676-2.797    c0.605,0.564,1.195,1.112,1.816,1.691c-0.941,0.985-1.817,1.903-2.703,2.83c-0.276-0.339-0.511-0.688-0.807-0.975    C40.492,12.941,40.145,12.728,39.799,12.47"></path>
                                <path fill-rule="evenodd" clip-rule="evenodd" fill="#FFFFFF" d="M10.35,43.279c0.969-1.016,1.885-1.977,2.76-2.893    c0.213,0.369,0.376,0.762,0.639,1.072c0.265,0.312,0.627,0.539,0.98,0.832c-0.853,0.891-1.713,1.791-2.624,2.746    C11.513,44.445,10.939,43.869,10.35,43.279"></path>
                            </g>
                        </g>
                    </svg>
                    </div>
                </li>
            </ul>
            <div class="nav-search-wrapper">
                <button class="search-button" data-ghost-search>
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path></svg>
                </button>
            </div>
        </div>



    </div>
</nav>

    

    <main id="site-main">
        <div class="container-fluid">
            <div class="row main-content-row">
                <div class="col">
                    <div class="post-full-content">
                        
<article class="post ">
        <div class="feature-image-wrapper my-5">
            <figure>
                <img src="/content/images/2022/11/image14-4.png" alt="" class="img-fluid" />
            </figure>
        </div>

    <h1 class="text-center">Covert Channels and Poor Decisions: The Tale of DNSMessenger</h1>

    <div class="text-center m-1">
        <div class="post-author">
            <span>By </span>
                <a href="https://blog.talosintelligence.com/author/edmund-brumaghin/">Edmund Brumaghin</a>
        </div>

        <br/>
        <time class="post-datetime" datetime="March 2, 2017 12:11">
            Thursday, March 2, 2017 12:11
        </time>

        <div class="m-3">
        </div>
    </div>

    <section class="post-content-wrapper mt-5">
        <div class="post-content">
            <p><i>This post was authored by <a href="https://www.blogger.com/profile/10442669663667294759">Edmund Brumaghin</a> and <a href="https://twitter.com/colingrady">Colin Grady</a></i></p><h2 id="executive-summary">Executive Summary </h2><p>The Domain Name System (DNS) is one of the most commonly used Internet application protocols on corporate networks. It is responsible for providing name resolution so that network resources can be accessed by name, rather than requiring users to memorize IP addresses. While many organizations implement strict egress filtering as it pertains to web traffic, firewall rules, etc. many have less stringent controls in place to protect against DNS based threats. Attackers have recognized this and commonly encapsulate different network protocols within DNS to evade security devices.</p><p>Typically this use of DNS is related to the exfiltration of information. Talos recently analyzed an interesting malware sample that made use of DNS TXT record queries and responses to create a bidirectional Command and Control (C2) channel. This allows the attacker to use DNS communications to submit new commands to be run on infected machines and return the results of the command execution to the attacker. This is an extremely uncommon and evasive way of administering a RAT. The use of multiple stages of Powershell with various stages being completely fileless indicates an attacker who has taken significant measures to avoid detection.</p><p>Ironically, the author of the malware called SourceFire out in the malware code itself shortly after we released Cisco Umbrella, a security product specifically designed to protect organizations from DNS and web based threats as described <a href="https://umbrella.cisco.com/products/features">here</a>.</p><h2 id="details">Details </h2><p>What initially drew our interest to this particular malware sample was a <a href="https://twitter.com/Simpo13/status/835139608153362433">tweet</a> published by security researcher on Twitter (thanks <a href="https://twitter.com/simpo13">simpo</a>!) regarding a Powershell script that he was analyzing that contained the base64 encoded string 'SourceFireSux'. Interestingly enough, Sourcefire was the only security vendor directly referenced in the Powershell script. We searched for the base64 encoded value 'UwBvAHUAcgBjAGUARgBpAHIAZQBTAHUAeAA=' which was referenced in the tweet, and were able to identify a sample that had been uploaded to the public malware analysis sandbox, <a href="https://www.hybrid-analysis.com/sample/f9e54609f1f4136da71dbab8f57c2e68e84bcdc32a58cc12ad5f86334ac0eacf?environmentId%3D100">Hybrid Analysis</a>. Additionally, when we searched for the decoded string value we found a single search engine result that pointed to a Pastebin <a href="http://pastebin.com/idy8yeW8">page</a>. The hash listed in the Pastebin led us to a malicious Word document that had also been uploaded to a public sandbox. The Word document initiated the same multiple-stage infection process as the file from the Hybrid Analysis report we previously discovered and allowed us to reconstruct a more complete infection process. Analyzing our telemetry data, we were ultimately able to identify additional samples, which are listed in the Indicators of Compromise section of this post.</p><p>As a security vendor, we know that we are doing something right when malware authors begin to specifically reference us within their malware. Naturally we decided to take a closer look at this particular sample.</p><figure class="kg-card kg-image-card"><img src="https://blog.talosintelligence.com/content/images/2022/11/image11-1.jpg" class="kg-image" alt loading="lazy" width="600" height="600" srcset="https://blog.talosintelligence.com/content/images/2022/11/image11-1.jpg 600w"></figure><p>In this particular case, we began by analyzing the Powershell file that had been incorrectly submitted to the public sandbox as a VBScript file, which we are now referring to as 'Stage 3'. It turns out the string referenced earlier is used as a mutex, as you can see in the deobfuscated Powershell below in Figure 1.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.talosintelligence.com/content/images/2022/11/image7-7.png" class="kg-image" alt loading="lazy" width="940" height="195" srcset="https://blog.talosintelligence.com/content/images/size/w600/2022/11/image7-7.png 600w, https://blog.talosintelligence.com/content/images/2022/11/image7-7.png 940w" sizes="(min-width: 720px) 720px"><figcaption><b>Figure 1: Mutex Creation</b></figcaption></figure><h3 id="stage-1-malicious-word-document">Stage 1 Malicious Word Document </h3><p>As previously mentioned, we identified the source of this infection chain, which was a malicious Microsoft Word document that was delivered to the victim via a phishing email message. Interestingly, the Word document was made to appear as if it were associated with a secure email service that is secured by McAfee. This is likely an effective way to increase the odds of the victim opening the file and enabling macros as McAfee is a well known security vendor and likely immediately trusted by the victim. The document informs the user that it is secured and instructs the user to enable content.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.talosintelligence.com/content/images/2022/11/image17-2.png" class="kg-image" alt loading="lazy" width="641" height="480" srcset="https://blog.talosintelligence.com/content/images/size/w600/2022/11/image17-2.png 600w, https://blog.talosintelligence.com/content/images/2022/11/image17-2.png 641w"><figcaption><b>Figure 2: Malicious Word Document&nbsp;</b></figcaption></figure><p>The document uses the Document_Open() function to call another VBA function. The called function sets a long string that defines a Powershell command and includes the code to be executed. The command is then executed using the Windows Management Interface (WMI) Win32_Process object using the Create method.</p><p>The code that is passed to Powershell via the command line is mostly Base64 encoded and compressed using gzip, with a small portion at the end that is not encoded which is then used to unpack the code and pass it to the Invoke-Expression Powershell cmdlet (IEX) for execution. This allows the code to be executed without ever requiring it to be written to the filesystem of the infected system. Overall, this is pretty typical for malicious Word documents that we see being distributed in the wild. We noted that while there is a VBA stream that references a download from Pastebin, the samples we analyzed did not appear to make use of this functionality.</p><p>We also observed that the AV detection on this particular sample was fairly low (6/54) and that ClamAV was able to successfully detect this particular sample.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.talosintelligence.com/content/images/2022/11/image13-4.png" class="kg-image" alt loading="lazy" width="980" height="667" srcset="https://blog.talosintelligence.com/content/images/size/w600/2022/11/image13-4.png 600w, https://blog.talosintelligence.com/content/images/2022/11/image13-4.png 980w" sizes="(min-width: 720px) 720px"><figcaption><b>Figure 3: VirusTotal Results</b></figcaption></figure><h3 id="stage-2-powershell">Stage 2 Powershell </h3><p>The execution of the Powershell that is passed to IEX by the Stage 1 Word document is where we begin to observe several interesting activities occurring on an infected system. A function at the end of the Powershell script described in Stage 1 defines the actions for Stage 2 as well as characteristics related to Stage 3.The code in Stage 2 has been obfuscated, and we will refer to the main function used by this stage as 'pre_logic' as the main function used by Stage 3 is referenced as 'logic'.</p><p>The 'pre_logic' function present in this stage supports two switches. One is used to determine whether or not to achieve persistence for the next stage of the infection process on the target system. If persistence is selected the other switch defines whether or not the Stage 3 code should be executed once it is staged.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.talosintelligence.com/content/images/2022/11/image12-4.png" class="kg-image" alt loading="lazy" width="717" height="219" srcset="https://blog.talosintelligence.com/content/images/size/w600/2022/11/image12-4.png 600w, https://blog.talosintelligence.com/content/images/2022/11/image12-4.png 717w"><figcaption><b>Figure 4: Deobfuscated 'pre-logic' Function</b>&nbsp;</figcaption></figure><p>In addition to these two switches, the 'pre_logic' function also supports four parameters which are subsequently passed to the 'logic' function in the next stage of the infection process. These parameters are used to determine what subdomains to use when sending DNS TXT record queries in the next stage of the infection process.</p><p>The function then unpacks the Powershell that will be used during the next (Stage 3) stage from a base64 encoded blob located within the Powershell script itself. It also defines some of the code which will be used later, including the function call and parameters to use when executing the next stage of the infection.</p><p>If the option to achieve persistence was selected when the 'pre_logic' function was called, the function will then query the infected system to determine how to best achieve persistence. Depending on the access rights of the user account within which the malware is operating, the malware will then query registry paths that are commonly used by malware to achieve persistence.</p><p>If operating under an account with Administrator access to the system the script will query and set:</p><ul><li>$reg_win_path: "HKLM:Software\Microsoft\Windows\CurrentVersion"</li><li>$reg_run_path: "HKLM:Software\Microsoft\Windows\CurrentVersion\Run\"  </li></ul><p>If operating under a normal user account, the script will query and set:</p><ul><li>$reg_win_path: "HKCU:Software\Microsoft\Windows"</li><li>$reg_run_path: "HKCU:Software\Microsoft\Windows\CurrentVersion\Run\"</li></ul><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.talosintelligence.com/content/images/2022/11/image2-7.png" class="kg-image" alt loading="lazy" width="1184" height="238" srcset="https://blog.talosintelligence.com/content/images/size/w600/2022/11/image2-7.png 600w, https://blog.talosintelligence.com/content/images/size/w1000/2022/11/image2-7.png 1000w, https://blog.talosintelligence.com/content/images/2022/11/image2-7.png 1184w" sizes="(min-width: 720px) 720px"><figcaption><b>Figure 5: Registry Activity</b>&nbsp;</figcaption></figure><p>The script then determines the version of Powershell that is being used on the infected system. If the infected system is using Powershell 3.0 or later, the decoded Stage 3 payload is written to an Alternate Data Stream (ADS) located at '%PROGRAMDATA%\Windows\' and named 'kernel32.dll'.</p><p>If the system is running an earlier version of Powershell, the Stage 3 payload is encoded and written to the registry location dictated by the assignment of $reg_win_path earlier with the key name of 'kernel32'. The code to unpack and execute the Stage 3 payload is also later written to the registry location of $reg_win_path with the key name of 'Part'.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.talosintelligence.com/content/images/2022/11/image19-1.png" class="kg-image" alt loading="lazy" width="1107" height="201" srcset="https://blog.talosintelligence.com/content/images/size/w600/2022/11/image19-1.png 600w, https://blog.talosintelligence.com/content/images/size/w1000/2022/11/image19-1.png 1000w, https://blog.talosintelligence.com/content/images/2022/11/image19-1.png 1107w" sizes="(min-width: 720px) 720px"><figcaption><b>Figure 6: PS Check &amp; Persistence</b>&nbsp;</figcaption></figure><p>Once this has completed, the script will again check to determine the access level of the user running the malware. If the malware has been executed with Administrator permissions, the WMI event subscriptions for '_eventFilter', 'CommandLineEventConsumer', and '_filtertoconsumerbinding' will be removed from the infected system. The malware then establishes its own permanent WMI event subscription, filtered for 'Win32_LogonSession' events and tied to 'CommandLineEventConsumer'. This is what is used to read and execute the Stage 3 payload that was previously stored in the ADS whenever a new logon session is created on the infected system. This is essentially the WMI equivalent of a registry-based run key from a persistence perspective. The Stage 3 malware is by default set to run 'onidle' after 30 minutes. If the switch associated with the execution of Stage 3 was passed to the 'pre_logic' function at the beginning of this stage, the Stage 3 payload will then be executed immediately.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.talosintelligence.com/content/images/2022/11/image6-7.png" class="kg-image" alt loading="lazy" width="1354" height="318" srcset="https://blog.talosintelligence.com/content/images/size/w600/2022/11/image6-7.png 600w, https://blog.talosintelligence.com/content/images/size/w1000/2022/11/image6-7.png 1000w, https://blog.talosintelligence.com/content/images/2022/11/image6-7.png 1354w" sizes="(min-width: 720px) 720px"><figcaption><b>Figure 7: Persistence Mechanism</b>&nbsp;</figcaption></figure><p>As seen above, the malware also creates a Scheduled Task on the infected system named "kernel32" which is associated with the Stage 3 payload that was stored in the ADS or registry depending on the version of powershell running on the infected system. In analyzing other samples associated with this campaign, we observed that the scheduled task may change across samples.</p><h3 id="stage-3-powershell">Stage 3 Powershell </h3><p>The Stage 3 powershell that is executed by Stage 2 of this infection process was obfuscated primarily through the use of obtuse function and variable names (e.g. ${script:/==\/\/\/==\__/==} instead of $domains). Base64 string encoding was also present throughout the script. Once we deobfuscated it, we found that the script contained a large array of hard coded domain names, with one of them being randomly selected and used for subsequent DNS queries. It is important to note that while the Powershell scripts for stages 3 and 4 contain two arrays of domains, the first array is only used if a failure condition is reached while the sample is using the second array.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.talosintelligence.com/content/images/2022/11/image22.png" class="kg-image" alt loading="lazy" width="1024" height="160" srcset="https://blog.talosintelligence.com/content/images/size/w600/2022/11/image22.png 600w, https://blog.talosintelligence.com/content/images/size/w1000/2022/11/image22.png 1000w, https://blog.talosintelligence.com/content/images/2022/11/image22.png 1024w" sizes="(min-width: 720px) 720px"><figcaption><b>Figure 8: Stage 3 Domain List</b></figcaption></figure><p> The 'logic' function present within this Powershell script randomly selects a C2 domain from the second array in the script and uses this domain to perform an initial lookup. If the result of the initial DNS TXT record request is empty or in the case the lookup fails, the 'do_lookup' function is then called and randomly selects a domain from the first array in the script. Interestingly, the domains used by the 'do_lookup' function did not appear to have active 'www' or 'mail' TXT records.</p><p>The script also uses specific subdomains which are combined with the domains and used for the initial DNS TXT record queries performed by the malware. The malware uses the contents of the TXT record in the response to these queries to determine what action to take next. For instance, the first subdomain is 'www' and a query response with a TXT record containing 'www' will instruct the script to proceed. Other actions that may be taken are 'idle' and 'stop'.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.talosintelligence.com/content/images/2022/11/image10-5.png" class="kg-image" alt loading="lazy" width="559" height="495"><figcaption><b>Figure 9: Stage 3 Command Processing</b>&nbsp;</figcaption></figure><p>Once the initial DNS response is received by the malware, it then iterates to the next subdomain which is 'mail'. The malware uses this domain in another DNS TXT record query to attempt to retrieve the Stage 4 payload associated with this infection process. The response to this DNS request results in the transmission of the fourth stage malware, stored within the TXT record as displayed in Figures 10 and 11. Due to the size of the Stage 4 payload, DNS makes use of TCP for this transaction.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.talosintelligence.com/content/images/2022/11/image16-1.png" class="kg-image" alt loading="lazy" width="1636" height="422" srcset="https://blog.talosintelligence.com/content/images/size/w600/2022/11/image16-1.png 600w, https://blog.talosintelligence.com/content/images/size/w1000/2022/11/image16-1.png 1000w, https://blog.talosintelligence.com/content/images/size/w1600/2022/11/image16-1.png 1600w, https://blog.talosintelligence.com/content/images/2022/11/image16-1.png 1636w" sizes="(min-width: 720px) 720px"><figcaption><b>Figure 10: Response Containing Stage 4 Payload</b>&nbsp;</figcaption></figure><p>Another view showing the Wireshark interpretation of the DNS protocol and packet payload is below.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.talosintelligence.com/content/images/2022/11/image9-6.png" class="kg-image" alt loading="lazy" width="1744" height="664" srcset="https://blog.talosintelligence.com/content/images/size/w600/2022/11/image9-6.png 600w, https://blog.talosintelligence.com/content/images/size/w1000/2022/11/image9-6.png 1000w, https://blog.talosintelligence.com/content/images/size/w1600/2022/11/image9-6.png 1600w, https://blog.talosintelligence.com/content/images/2022/11/image9-6.png 1744w" sizes="(min-width: 720px) 720px"><figcaption><b>Figure 11: Alternate View of Stage 4 Payload</b></figcaption></figure><p> The code associated with this fourth stage is then cleaned and passed into the Invoke-Expression Powershell cmdlet (IEX) and executed within the context of the third stage process. The fourth stage payload is not autonomous and simply attempting to execute the fourth payload itself will fail, as it relies upon a decode function present within the third stage Powershell script.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.talosintelligence.com/content/images/2022/11/image4-9.png" class="kg-image" alt loading="lazy" width="775" height="143" srcset="https://blog.talosintelligence.com/content/images/size/w600/2022/11/image4-9.png 600w, https://blog.talosintelligence.com/content/images/2022/11/image4-9.png 775w" sizes="(min-width: 720px) 720px"><figcaption><b>Figure 12: Stage 3 Decode Function</b>&nbsp;</figcaption></figure><p>This function is responsible for a couple of different operations. It takes the code received in the DNS query response and defines a string variable which contains the code. It then calls the decode function from the third stage and passes the decoded string into IEX to further extend the Powershell environment. Once this is complete, it then calls a function in the newly extended environment to execute the fourth stage code along with specific parameters. These parameters include the fourth stage C2 domain to use as well as the program to execute which in this case is the Windows Command Line Processor (cmd.exe). This is interesting because it results in the fourth stage payload never actually being written to the filesystem of the infected system. <br></p><h3 id="stage-4-powershell">Stage 4 Powershell </h3><p>As described above, the Stage 4 Powershell payload is decoded by the 'dec' function present within Stage 3. At the end of the Stage 4 payload is a call to the 'cotte' function, present in the decoded Stage 4 code, which provides additional parameters including the C2 domain to use as well as the program to execute (cmd.exe). When the function executes cmd.exe it redirects STDIN, STDOUT, and STDERR to allow the payload to read from and write to the command line processor.</p><p>The domain provided to the function call is then used to generate the DNS queries used for the main C2 operations. Just like in the Stage 3 Powershell script, the Stage 4 payload also contains two arrays of hard coded domains, but this stage only appears to make use of the second array.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.talosintelligence.com/content/images/2022/11/image22-1.png" class="kg-image" alt loading="lazy" width="1024" height="160" srcset="https://blog.talosintelligence.com/content/images/size/w600/2022/11/image22-1.png 600w, https://blog.talosintelligence.com/content/images/size/w1000/2022/11/image22-1.png 1000w, https://blog.talosintelligence.com/content/images/2022/11/image22-1.png 1024w" sizes="(min-width: 720px) 720px"><figcaption><b>Figure 13: Stage 4 Domain List</b>&nbsp;</figcaption></figure><p>Every 301st DNS response from main C2 server, the sample sends a separate DNS TXT resolution request to a domain taken from the array described above using the Get-Random cmdlet. This secondary C2 request is to determine whether the malware should continue to run on the infected system. Similar to what we saw with the Stage 3 Powershell script, this request is made to the 'web' subdomain of the secondary C2 domain.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.talosintelligence.com/content/images/2022/11/image21-1.png" class="kg-image" alt loading="lazy" width="488" height="32"><figcaption><b>Figure 14: Stage 4 Secondary C2 Domain Generation</b>&nbsp;</figcaption></figure><p>If the secondary C2 server returns a TXT record that contains the string 'stop', the malware will cease operations.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.talosintelligence.com/content/images/2022/11/image5-8.png" class="kg-image" alt loading="lazy" width="228" height="173"><figcaption><b>Figure 15: Stage 4 Stop Command</b>&nbsp;</figcaption></figure><p>The main C2 channel itself is established through the transmission of a "SYN" message from the infected system to the main C2 server.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.talosintelligence.com/content/images/2022/11/image1-7.png" class="kg-image" alt loading="lazy" width="440" height="468"><figcaption><b>Figure 16: Example Stage 4 'SYN' Message Response</b>&nbsp;</figcaption></figure><p>Once this is completed, the STDOUT and STDERR output that was captured from the Windows Command Line processor earlier in Stage 4 is transmitted using a "MSG" message. This allows the attacker to send commands to be executed directly by the Command Processor and receive the output of those commands all using DNS TXT requests and responses. This communication is described in greater detail in the following section. Below is the DNS analysis and contents of the query request send from an infected system to the C2 server.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.talosintelligence.com/content/images/2022/11/image20-1.png" class="kg-image" alt loading="lazy" width="1272" height="281" srcset="https://blog.talosintelligence.com/content/images/size/w600/2022/11/image20-1.png 600w, https://blog.talosintelligence.com/content/images/size/w1000/2022/11/image20-1.png 1000w, https://blog.talosintelligence.com/content/images/2022/11/image20-1.png 1272w" sizes="(min-width: 720px) 720px"><figcaption><b>Figure 17: Example 'MSG' Message</b></figcaption></figure><p> The query domain structure is obfuscated. If we take the DNS request query and run it through a decoding function, we can clearly see that it is the output of the Windows Command Line Processor being sent to the C2 server.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.talosintelligence.com/content/images/2022/11/image14-3.png" class="kg-image" alt loading="lazy" width="798" height="258" srcset="https://blog.talosintelligence.com/content/images/size/w600/2022/11/image14-3.png 600w, https://blog.talosintelligence.com/content/images/2022/11/image14-3.png 798w" sizes="(min-width: 720px) 720px"><figcaption><b>Figure 18: Decoded TXT Request</b>&nbsp;</figcaption></figure><p>This clearly illustrates the establishment of an interactive C2 channel that can be used to execute system commands as well as receive the output of those commands.<br></p><h3 id="command-and-control-c2-communications">Command and Control (C2) Communications </h3><p>The C2 domains associated with the infection chain from the malicious Word document were initially registered on 2017-02-08. The domains associated with the Powershell sample that we analyzed from Hybrid Analysis were initially registered on 2017-02-18. Several of the domains were registered by a registrant account using the following email address:</p><p>valeriy[.]pagosyan[@]yandex[.]com</p><p>The remaining domains were registered using the NameCheap proxy registration service.</p><p>According to data available within Umbrella, the majority of DNS activity related to the domains used by the powershell sample appears to have occurred between 2017-02-22 and 2017-02-25. There was less activity associated with the other identified sample, with most occurring on 2017-02-11.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.talosintelligence.com/content/images/2022/11/image23.png" class="kg-image" alt loading="lazy" width="1271" height="223" srcset="https://blog.talosintelligence.com/content/images/size/w600/2022/11/image23.png 600w, https://blog.talosintelligence.com/content/images/size/w1000/2022/11/image23.png 1000w, https://blog.talosintelligence.com/content/images/2022/11/image23.png 1271w" sizes="(min-width: 720px) 720px"><figcaption><b>Figure 19: Sample DNS Traffic Graph</b></figcaption></figure><p>All C2 communications associated with this malware are performed using DNS TXT queries and responses. The interactive 'MSG' queries require the successful establishment of a C2 communications channel via the use of the prerequisite 'SYN' query. The messages consist of the following elements:</p><p>$session_id - A four digit number that is initially generated by infected machines. It never changes and is included in all subsequent DNS queries and responses.</p><p>$sequence_num - A four digit number that is initially generated by infected machines. It changes periodically during C2 communications and the new value must be included in the next query.</p><p>$acknowledgement_num - A four digit number that is set by the response to the 'SYN' message. This value does not appear to change and must be included in all subsequent 'MSG' queries.</p><p>Bytes 5 and 6 of the DNS queries and responses determine the message type and can be any of the following values:</p><p>00 - 'SYN' message</p><p>01 - 'MSG' message</p><p>02 - 'FIN' message</p><p>The 'MSG' queries which are used to send commands to execute and return the output of the executed commands are hex-encoded and use a dot separator after every 30 bytes.</p><p>The following diagram illustrates the overall flow of the C2 communications. Note that during C2, there may be several 'MSG' queries and responses depending on what the attacker is attempting to execute on an infected host.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.talosintelligence.com/content/images/2022/11/image15.jpg" class="kg-image" alt loading="lazy" width="1514" height="840" srcset="https://blog.talosintelligence.com/content/images/size/w600/2022/11/image15.jpg 600w, https://blog.talosintelligence.com/content/images/size/w1000/2022/11/image15.jpg 1000w, https://blog.talosintelligence.com/content/images/2022/11/image15.jpg 1514w" sizes="(min-width: 720px) 720px"><figcaption><b>Figure 20: C2 Traffic Flow</b>&nbsp;</figcaption></figure><p>Below is a diagram illustrating how the different messages and associated responses are formed.</p><figure class="kg-card kg-image-card kg-card-hascaption"><img src="https://blog.talosintelligence.com/content/images/2022/11/image3.jpg" class="kg-image" alt loading="lazy" width="1514" height="774" srcset="https://blog.talosintelligence.com/content/images/size/w600/2022/11/image3.jpg 600w, https://blog.talosintelligence.com/content/images/size/w1000/2022/11/image3.jpg 1000w, https://blog.talosintelligence.com/content/images/2022/11/image3.jpg 1514w" sizes="(min-width: 720px) 720px"><figcaption><b>Figure 21: C2 Message Structure</b>&nbsp;</figcaption></figure><h2 id="conclusion">Conclusion </h2><p>This malware sample is a great example of the length attackers are willing to go to stay undetected while operating within the environments that they are targeting. It also illustrates the importance that in addition to inspecting and filtering network protocols such as HTTP/HTTPS, SMTP/POP3, etc. DNS traffic within corporate networks should also be considered a channel that an attacker can use to implement a fully functional, bidirectional C2 infrastructure. <a href="https://umbrella.cisco.com/">Cisco Umbrella</a> is a product that can be used specifically for this purpose. In addition to stopping this particular attack, DNS monitoring and filtering can also disrupt a large portion of overall malware infections, as the over 90% of malware makes use of the DNS network protocol at some stage of the infection or post-infection process.</p><h2 id="coverage">Coverage </h2><p>Additional ways our customers can detect and block this threat are listed below.</p><figure class="kg-card kg-image-card"><img src="https://blog.talosintelligence.com/content/images/-q2jqm71SdFM/WJi8NQ52BLI/AAAAAAAAAoI/9WNNRbCO6ssb8t2MviylAu1WLeSqSYbqwCLcB/s1600/image08.png" class="kg-image" alt loading="lazy"></figure><p>Advanced Malware Protection (<a href="http://www.cisco.com/c/en/us/support/security/amp-firepower-software-license/tsd-products-support-series-home.html">AMP</a>) is ideally suited to prevent the execution of the malware used by these threat actors.</p><p><a href="http://www.cisco.com/c/en/us/products/security/cloud-web-security/index.html">CWS</a> or<a href="http://www.cisco.com/c/en/us/products/security/web-security-appliance/index.html">WSA</a> web scanning prevents access to malicious websites and detects malware used in these attacks.</p><p><a href="http://www.cisco.com/c/en/us/products/security/email-security-appliance/index.html">Email Security</a> can block malicious emails sent by threat actors as part of their campaign.</p><p>The Network Security protection of<a href="http://www.cisco.com/c/en/us/products/security/intrusion-prevention-system-ips/index.html">IPS</a>and<a href="http://www.cisco.com/c/en/us/products/security/asa-next-generation-firewall-services/index.html">NGFW</a> have up-to-date signatures to detect malicious network activity by threat actors.</p><p><a href="http://www.cisco.com/c/en/us/solutions/enterprise-networks/amp-threat-grid/index.html">AMP Threat Grid</a> helps identify malicious binaries and build protection into all Cisco Security products.</p><p><a href="https://umbrella.cisco.com/">Umbrella</a> prevents DNS resolution of the domains associated with malicious activity.</p><h2 id="indicators-of-compromise-ioc-">Indicators of Compromise (IOC) </h2><p>Below are indicators of compromise that can be used to identify the attack described in this post.</p><h3 id="hashes-">Hashes:</h3><p>f9e54609f1f4136da71dbab8f57c2e68e84bcdc32a58cc12ad5f86334ac0eacf (SHA256)<br>f82baa39ba44d9b356eb5d904917ad36446083f29dced8c5b34454955da89174 (SHA256)<br>340795d1f2c2bdab1f2382188a7b5c838e0a79d3f059d2db9eb274b0205f6981 (SHA256)<br>7f0a314f15a6f20ca6dced545fbc9ef8c1634f9ff8eb736deab73e46ae131458 (SHA256)<br>be5f4bfa35fc1b350d38d8ddc8e88d2dd357b84f254318b1f3b07160c3900750 (SHA256)<br>9b955d9d7f62d405da9cf05425c9b6dd3738ce09160c8a75d396a6de229d9dd7 (SHA256)<br>fd6e7fc11a325c498d73cf683ecbe90ddbf0e1ae1d540b811012bd6980eed882 (SHA256)<br>6bf9d311ed16e059f9538b4c24c836cf421cf5c0c1f756fdfdeb9e1792ada8ba (SHA256)</p><h3 id="c2-domains-">C2 Domains: </h3><p>algew[.]me<br>aloqd[.]pw<br>bpee[.]pw<br>bvyv[.]club<br>bwuk[.]club<br>cgqy[.]us<br>cihr[.]site<br>ckwl[.]pw<br>cnmah[.]pw<br>coec[.]club<br>cuuo[.]us<br>daskd[.]me<br>dbxa[.]pw<br>dlex[.]pw<br>doof[.]pw<br>dtxf[.]pw<br>dvso[.]pw<br>dyiud[.]com<br>eady[.]club<br>enuv[.]club<br>eter[.]pw<br>fbjz[.]pw<br>fhyi[.]club<br>futh[.]pw<br>gjcu[.]pw<br>gjuc[.]pw<br>gnoa[.]pw<br>grij[.]us<br>gxhp[.]top<br>hvzr[.]info<br>idjb[.]us<br>ihrs[.]pw<br>jimw[.]club<br>jomp[.]site<br>jxhv[.]site<br>kjke[.]pw<br>kshv[.]site<br>kwoe[.]us<br>ldzp[.]pw<br>lhlv[.]club<br>lnoy[.]site<br>lvrm[.]pw<br>lvxf[.]pw<br>mewt[.]us<br>mfka[.]pw<br>mjet[.]pw<br>mjut[.]pw<br>mvze[.]pw<br>mxfg[.]pw<br>nroq[.]pw<br>nwrr[.]pw<br>nxpu[.]site<br>oaax[.]site<br>odwf[.]pw<br>odyr[.]us<br>okiq[.]pw<br>oknz[.]club<br>ooep[.]pw<br>ooyh[.]us<br>otzd[.]pw<br>oxrp[.]info<br>oyaw[.]club<br>pafk[.]us<br>palj[.]us<br>pbbk[.]us<br>ppdx[.]pw<br>pvze[.]club<br>qefg[.]info<br>qlpa[.]club<br>qznm[.]pw<br>reld[.]info<br>rnkj[.]pw<br>rzzc[.]pw<br>sgvt[.]pw<br>soru[.]pw<br>swio[.]pw<br>tijm[.]pw<br>tsrs[.]pw<br>turp[.]pw<br>ueox[.]club<br>ufyb[.]club<br>utca[.]site<br>vdfe[.]site<br>vjro[.]club<br>vkpo[.]us<br>vpua[.]pw<br>vqba[.]info<br>vwcq[.]us<br>vxqt[.]us<br>vxwy[.]pw<br>wfsv[.]us<br>wqiy[.]info<br>wvzu[.]pw<br>xhqd[.]pw<br>yamd[.]pw<br>yedq[.]pw<br>yqox[.]pw<br>ysxy[.]pw<br>zcnt[.]pw<br>zdqp[.]pw<br>zjav[.]us<br>zjvz[.]pw<br>zmyo[.]club<br>zody[.]pw<br>zugh[.]us<br>cspg[.]pw</p>
        </div>
    </section>
    <div class="social-media-wrapper">
    <h5>Share this post</h5>
    <ul class="social-media-share-list">
        <li>
            <a class="share-facebook" title="Share this on Facebook" data-text="Covert Channels and Poor Decisions: The Tale of DNSMessenger" data-href="https://blog.talosintelligence.com/dnsmessenger/" rel="nofollow" target="_blank" href="https://www.facebook.com/sharer.php?u=https://blog.talosintelligence.com/dnsmessenger/"></a>
        </li>
        <li>
            <a class="share-x" title="Post This" data-text="Covert Channels and Poor Decisions: The Tale of DNSMessenger" data-href="https://blog.talosintelligence.com/dnsmessenger/" rel="nofollow" target="_blank" href="https://x.com/share?url=https://blog.talosintelligence.com/dnsmessenger/"></a>
        </li>
        <li>
            <a class="share-linkedin" title="Share this on LinkedIn" data-text="Covert Channels and Poor Decisions: The Tale of DNSMessenger" data-href="https://blog.talosintelligence.com/dnsmessenger/" rel="nofollow" target="_blank" href="https://www.linkedin.com/sharing/share-offsite/?url=https://blog.talosintelligence.com/dnsmessenger/"></a>
        </li>
        <li>
            <a class="share-reddit" title="Reddit This" data-text="Covert Channels and Poor Decisions: The Tale of DNSMessenger" data-href="https://blog.talosintelligence.com/dnsmessenger/" rel="nofollow" target="_blank" href="https://www.reddit/submit?url=https://blog.talosintelligence.com/dnsmessenger/"></a>
        </li>
        <li>
            <a class="share-email" title="Email This" href="mailto:?body=Covert Channels and Poor Decisions: The Tale of DNSMessengerhttps://blog.talosintelligence.com/dnsmessenger/"></a>
        </li>
    </ul>
</div></article>
                    </div>
                </div>
                <div class="col-lg alt-layout-row-dk sidebar" id="side-bar">
                </div>
            </div>
        </div>
    </main>


    <footer id="footer">
    <div class="row footer_nav_wrapper">
        <div class="col-xl-10 col-12">
            <div class="multi-col-list-wrapper">
                <ul class="footer-parent-list">
                    <li class="footer-links-group">
                        <ul>
                            <li>
                                <h6>Intelligence Center</h6>
                            </li>
                            <li><a href="https://talosintelligence.com/reputation_center">Intelligence Search</a></li>
                            <li><a href="https://talosintelligence.com/reputation_center/email_rep">Email &amp; Spam Trends</a></li>
                        </ul>
                    </li>
                    <li class="footer-links-group">
                        <ul>
                            <li>
                                <h6>Vulnerability Research</h6>
                            </li>
                            <li><a href="https://talosintelligence.com/vulnerability_info">Vulnerability Reports</a></li>
                            <li><a href="https://talosintelligence.com/ms_advisories">Microsoft Advisories</a></li>
                        </ul>
                    </li>
                    <li class="footer-links-group">
                        <ul>
                            <li>
                                <h6>Incident Response</h6>
                            </li>
                            <li>
                                <a href="https://talosintelligence.com/incident_response">Talos IR Capabilities</a></li>
                            <li>
                                <a href="https://talosintelligence.com/incident_response">Emergency Support</a>
                            </li>

                        </ul>
                    </li>
                    <li class="footer-links-group">
                        <ul>
                            <li>
                                <h6>Security Resources</h6>
                            </li>
                            <li><a href="https://talosintelligence.com/software">Open Source Security Tools</a></li>
                            <li><a href="https://talosintelligence.com/categories">Intelligence Categories Reference</a></li>
                            <li><a href="https://talosintelligence.com/secure-endpoint-naming">Secure Endpoint Naming Reference</a></li>
                        </ul>
                    </li>
                    <li class="footer-links-group">
                        <ul>
                            <li>
                                <h6>Media</h6>
                            </li>
                            <li><a href="https://blog.talosintelligence.com">Talos Intelligence Blog</a></li>
                            <li><a href="https://blog.talosintelligence.com/category/threat-source-newsletter/">Threat Source Newsletter</a></li>
                            <li><a href="https://talosintelligence.com/podcasts/shows/beers_with_talos">Beers with Talos Podcast</a></li>
                            <li><a href="https://talosintelligence.com/podcasts/shows/talos_takes">Talos Takes Podcast</a></li>
                            <li><a target="_blank" href="https://www.youtube.com/channel/UCPZ1DtzQkStYBSG3GTNoyfg/featured">Talos Videos</a></li>
                        </ul>
                    </li>
                    <li class="footer-links-group">
                        <ul>
                            <li>
                                <h6>Support</h6>
                            </li>
                            <li><a href="https://support.talosintelligence.com">Support Documentation</a></li>
                        </ul>
                    </li>
                    <li class="footer-links-group">
                        <ul>
                            <li>
                                <h6>Company</h6>
                            </li>
                            <li><a href="https://talosintelligence.com/about">About Talos</a></li>
                            <li><a href="https://talosintelligence.com/careers">Careers</a></li>
                            <li><a target="_blank" href="https://www.cisco.com/c/en/us/products/security/product-listing.html">Cisco Security</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
        <div class="col-xl-2 col-12 connect_social">
            <div class="connect-footer-section-wrapper">
                <h6>Follow us</h6>
                <ul>
                    <li>
                        <a target="_blank" href="https://x.com/talossecurity"><div class="footer-media-icon" id="footer-media-icon-x"></div>
                        </a></li>
                    <li>
                        <a target="_blank" href="https://www.youtube.com/channel/UCPZ1DtzQkStYBSG3GTNoyfg/featured"><div class="footer-media-icon" id="footer-media-icon-youtube"></div>
                        </a></li>
                    <li>
                        <a target="_blank" href="https://www.linkedin.com/company/cisco-talos-intelligence-group/"><div class="footer-media-icon" id="footer-media-icon-linkedin"></div>
                        </a></li>
                </ul>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col-12 footer_corporate">
            <a target="_blank" href="http://tools.cisco.com/security/center/home.x"><img alt="Cisco" src="../assets/images/logo_cisco_white.svg">
            </a><p class="copyright">
            ©
            2024
            Cisco Systems, Inc. and/or its affiliates. All rights
            reserved. View our
            <a target="_blank" class="underline" href="http://www.cisco.com/web/siteassets/legal/privacy_full.html">Privacy Policy.</a>
        </p>
        </div>
    </div>
</footer>
    


<!-- jQuery first, then Popper.js, then Bootstrap JS -->
<script src="https://blog.talosintelligence.com/assets/js/jquery-3.6.0.min.js?v=d7eb88ed59"></script>
<script src="https://blog.talosintelligence.com/assets/js/popper.min.js?v=d7eb88ed59"></script>
<script src="https://blog.talosintelligence.com/assets/js/bootstrap.bundle.min.js?v=d7eb88ed59"></script>
<script src="https://blog.talosintelligence.com/assets/js/date.js?v=d7eb88ed59"></script>
<script src="https://blog.talosintelligence.com/assets/js/prism.js?v=d7eb88ed59"></script>
<script src="https://cdn.jsdelivr.net/npm/ghost-theme-utils@latest/dist/js/ghost-theme-utils.min.js" async defer></script>


</body>

</html>