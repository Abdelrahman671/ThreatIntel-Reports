<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<!--[if IE 7 ]><html class="ie7"> <![endif]-->
<!--[if IE 8 ]><html class="ie8"> <![endif]-->
<html lang="en-US"><head>

        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />        
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <link rel="canonical" href="http://www.ampliasecurity.com/wcefaq.html" /> 
<meta name="keywords" lang="en" xml:lang="en" content="Amplia Security, amplia security, information security professional services, WCE, Windows Credentials Editor" /> 
<meta name="description" content="Amplia Security, Information Security Professional Services" /> 
<meta name="author" content="ampliasecurity.com" /> 
<meta name="robots" content="index,follow,all" /> 
<meta name="Revisit" content="7 days" /> 
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
        <meta charset="utf-8">
        <title>Amplia Security - Research - WCE FAQ</title>
        <link rel="shortcut icon" href="/favicon.ico"/>
        
        <link rel="stylesheet" href="/libs/fontello/css/fontello.css">
        <!--[if IE 7]><link rel="stylesheet" href="/libs/fontello/css/fontello-ie7.css"><![endif]-->
        <link rel="stylesheet" href="/libs/font-awesome/css/font-awesome.min.css">
        
         <link href="/assets/css/bootstrap.min.css" rel="stylesheet">      
        <link rel="stylesheet" type="text/css" href="/assets/css/style.css" media="all" />
         
        <!--[if lt IE 9]><script src="/libs/html5.js"></script><![endif]-->
        <!--[if IE 7]><link rel="stylesheet" href="/assets/css/ie7-style.css"><![endif]-->
        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="/libs/html5shiv.min.js"></script>
      <script src="/libs/respond.min.js"></script>
    <![endif]-->
	<script>
                $('.carousel').carousel()
    </script>
    
    <!-- BEGIN GOOGLE ANALYTICS -->
    <!--<script type="text/javascript"> 
 
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-90739-6']);
  _gaq.push(['_trackPageview']);
 
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
 
</script>-->
     <!-- END GOOGLE ANALYTICS -->
    
        
    </head>
    <body style="padding-top:89px;">

        <nav id="menuheader" class="navbar navbar-default navbar-fixed-top" role="navigation">
            
            <div class="tw-logo-bg"></div>
          <div class="container">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
              <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
              </button>
              <a class="navbar-brand col-xs-6 col-md-12 backlogo" href="#"><img id="logo" src="/assets/images/logo-amplia_security.png" style="width:200px" alt="Amplia Security"/></a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
              <ul class="nav navbar-nav">
                <li><a href="/index.html">HOME</a></li>
                <li class="dropdown clearfix">
                  <a href="/services.html" class="dropdown-toggle" data-toggle="dropdown" onclick="window.location.href='/services.html'">SERVICES <span class="caret"></span></a>
                  <ul class="dropdown-menu" role="menu">
                    <div class="drop-container">
                        <li class="col-md-4 col-sm-4"><a href="/services/web-application-penetration-test.html">Web Application Penetration Testing</a></li>
                        <li class="col-md-4 col-sm-4"><a href="/services/network-penetration-test.html">Network Penetration Testing</a></li>
                        <li class="col-md-4 col-sm-4"><a href="/services/client-side-penetration-test.html">Client-Side Penetration Testing</a></li>
                        <li class="col-md-4 col-sm-4"><a href="/services.html">Wireless Penetration Testing</a></li>
                        <li class="col-md-4 col-sm-4"><a href="/services.html">Software Penetration Testing</a></li>
                        <li class="col-md-4 col-sm-4" class="col-md-4"><a href="/services.html">Appliance Penetration Testing</a></li>
                        <li class="col-md-4 col-sm-4"><a href="/services.html">Web Service Penetration Testing</a></li>
                        <li class="col-md-4 col-sm-4" class="col-md-4"><a href="/services.html">Software Security Assessments</a></li>
                        <li class="col-md-4 col-sm-4"><a href="/services.html">Source Code Review</a></li>
                    </div>
                  </ul>
                </li>
                <li  class="active"><a href="/research.html">RESEARCH</a></li>
                <li><a href="/aboutus.html">ABOUT US</a></li>
                <li><a href="/contact.html">CONTACT</a></li>
                <li><a href="/blog">BLOG</a></li>
                <li><a href="/newsandevents.html">NEWS</a></li>
              </ul>
            </div><!-- /.navbar-collapse -->
          </div><!-- /.container-fluid -->
      
        </nav>

        <!--FIN MENÃ-->

        <!--COMIENZO SECCION SLIDE-->
                <div id="carousel-example-generic" class="carousel slide" data-ride="carousel">
                  <!-- Indicators 
                  <ol class="carousel-indicators">
                    <li data-target="#carousel-example-generic" data-slide-to="0" class="active"></li>
                    <li data-target="#carousel-example-generic" data-slide-to="1"></li>
                  </ol>-->

                  <!-- Wrapper for slides -->
                  <div class="carousel-inner">
                    <div class="item active">
                      <img src="/assets/images/background.png" alt="background">
                    </div>
                    <!--
                    <div class="item">
                      <img src="/assets/images/background.png" alt="background">
                      <div class="carousel-caption">
                        CAROUSEL CAPTION 02
                      </div>
                    </div>-->
                  </div>

                  <!-- Controls 
                  <a class="left carousel-control" href="#carousel-example-generic" role="button" data-slide="prev">
                    <span class="glyphicon glyphicon-chevron-left"></span>
                  </a>
                  <a class="right carousel-control" href="#carousel-example-generic" role="button" data-slide="next">
                    <span class="glyphicon glyphicon-chevron-right"></span>
                  </a>-->
                </div> 
        <!--FIN SECCION SLIDE-->
        <section id="main-aplia">
            <div id="page">
                <!--COMIENZO DE ABOUTUS-->
                <div class="row-container light " style="background-attachment:scroll;background-repeat:repeat;background-position:left top;">
                    <div class="container">
                        <div class="row">
                            <div class="col-md-12 ">
                                <div class="tw-title-container">
                                    <div><a style="color:gray;font-size:10px" href="http://www.ampliasecurity.com">Home</a> &raquo; <a style="color:gray;font-size:10px" href="http://www.ampliasecurity.com/research/">Research</a> &raquo; <a style="color:gray;font-size:10px" href="http://www.ampliasecurity.com/research/wcefaq.html">WCE FAQ</style></a></div>
                                </br>
                                <!-- SOCIAL -->
                                <div>
<!-- Place this tag where you want the +1 button to render -->
<g:plusone size="medium"></g:plusone>

<!-- Place this tag after the last plusone tag -->
<script type="text/javascript">
  (function() {
    var po = document.createElement('script'); po.type = 'text/javascript'; po.async = true;
    po.src = 'https://apis.google.com/js/plusone.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(po, s);
  })();
</script>
<!--<a href="http://twitter.com/share" class="twitter-share-button" data-text="Windows Credentials Editor (WCE) FAQ" data-count="horizontal">Tweet</a><script type="text/javascript" src="http://platform.twitter.com/widgets.js"></script>-->
<a href="https://twitter.com/share" class="twitter-share-button" data-url="http://www.ampliasecurity.com/research/wcefaq.html" data-text="Windows Credentials Editor (WCE) FAQ" data-hashtags="wce">Tweet</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0];if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src="//platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
<script type="text/javascript" src="http://platform.linkedin.com/in.js"></script><script type="in/share" data-url="http://www.ampliasecurity.com/research/wcefaq.html" data-counter="right"></script>
</div>
                                <!-- END SOCIAL -->
                                    <h3 class="tw-title">Windows Credentials Editor (WCE) F.A.Q.</h3>
                                    <span class="tw-title-border"></span>
                                </div>
                                
                                <div class="row-fluid">
					<div class="recent_news_content">
                        </br>
<!-- BEGINNING OF FAQ -->
<a href=#whatiswce>What is WCE?</a></br>
<a href=#curversion>What is the current version of WCE?</a></br>
<a href=#whoshoulduseit>Who should use WCE?</a></br>
<a href=#supportedoses>What Operating Systems does WCE support?</a></br>
<a href=#thisisnotcachedump>Is WCE like cachedump?</a></br>
<a href=#thisisnotpwdump>Is WCE like pwdump?</a></br>
<a href=#notlikecain>Is WCE like Cain & Abel?</a></br>
<a href=#moreinfowce>Where can I find more information about how WCE works?</a></br>
<a href=#postwceinfo>Where can I find information on how to use WCE on a pentest?</a></br>
<a href=#privs>What privileges do I need to run WCE?</a></br>
<a href=#listntlm>How do I list NTLM credentials in memory?</a></br>
<a href=#curntlm>How do I change my current NTLM credentials?</a></br>
<a href=#newntlm>How do I create a new logon session and launch a program with new NTLM credentials?</a></br>
<a href=#genntlm>How can I generate NTLM hashes with WCE? (for testing purposes)</a></br>
<a href=#safemode>What is 'safe mode'?</a></br>
<a href=#outtofile>How can I write hashes obtained by WCE to a file?</a></br>
<a href=#digestauth>How can I dump logon cleartext passwords with WCE?</a></br>
<a href=#preventcleartextpwddump>How can I prevent WCE dumping my logon password in cleartext?</a></br>
<a href=#avoiddetection>WCE is detected by the antivirus/HIPS. what can I do to avoid detection?</a></br>
<a href="#whatislsasrvaddr">What is GETLSASRVADDR.EXE?</a></br>
<a href="#whengetlsa">When should I use GETLSASRVADDR.EXE?</a></br>
<a href="#getlsasrvaddr">I can't get GETLSASRVADDR.EXE to work. What's the problem?</a></br>
<a href="#pshtoolkit">Who's the author of WCE? Is he also the author of the PSH Toolkit?</a></br>
<a href="#betterthanpsh">How is WCE better than the PSH Toolkit?</a></br>
</br>
</br>
<a name=whatiswce></a><h5 style="color:#006DA1;"><b>What is WCE?</b></h5>
<p >Windows Credentials Editor (WCE) is a security tool that allows to list Windows logon sessions and add, change, list and delete associated credentials (e.g.: LM/NT hashes, Kerberos tickets and cleartext passwords).</br>
</br>
The tool allows users to:
<ul>
<li>- Perform Pass-the-Hash on Windows</li>
<li>- 'Steal' NTLM credentials from memory (with and <b>without</b> code injection)</li>
<li>- 'Steal' Kerberos Tickets from Windows machines</li>
<li>- Use the 'stolen' kerberos Tickets on other Windows or Unix machines to gain access to systems and services</li>
<li>- Dump cleartext passwords stored by Windows authentication packages</li>
</ul>
</br>
<p>WCE is a security tool widely used by security professionals to assess the security of Windows networks via Penetration Testing.</p>
</p>

<a name=curversion></a><h5 style="color:#006DA1;"><b>What is the current version?</b></h5>
<p>The current version of WCE 32bit is v1.42beta; you can download it <a href="http://www.ampliasecurity.com/research/wce_v1_42beta_x32.zip" style="color:#00447B;">here</a> and the current version of WCE 64bit is v1.42beta; you can download it <a href="http://www.ampliasecurity.com/research/wce_v1_42beta_x64.zip" style="color:#00447B;">here</a>. Since version 1.4beta there is also a "Universal Binary" which runs on both 32bit and 64bit platforms; you can download it <a href="http://www.ampliasecurity.com/research/wce_v1_41beta_universal.zip" style="color:#00447B;">here</a>.
</p>

<a name=whoshoulduseit></a><h5 style="color:#006DA1;"><b>Who should use WCE?</b></h5>
<p>WCE is aimed at security professionals and penetration testers. It is basically a post-exploitation tool to 'steal' and reuse NTLM hashes, Kerberos tickets and plaintext passwords which can then be used to compromise other machines. Under certain circumstances, WCE can allow you to compromise the whole Windows domain after compromising only one server or workstation.</br>
</p>

<a name=supportedoses></a><h5 style="color:#006DA1;"><b>What Operating Systems does WCE support?</b></h5>
<p>WCE supports Windows XP, Windows 2003, Vista, Windows 7 and Windows 2008 (all SPs, 32bit and 64bit versions).
</p>

<a name=thisisnotcachedump></a><h5 style="color:#006DA1;"><b>Is WCE like cachedump?</b></h5>
<p>NO. Cachedump obtains NTLM credentials from the Windows Credentials Cache (aka logon cache, logon information cache, etc).<br>
    This cache can be disabled and it is very often disabled by network/domain/windows administrators (see <a href="http://support.microsoft.com/kb/172931" style="color:#00447B;">http://support.microsoft.com/kb/172931</a>).</br>
WCE will be able to steal credentials even when this cache is disabled.</br>
WCE obtains NTLM credentials from memory, which are used by the system to perform SSO; it uses a series of techniques the author of WCE developed and published some years ago.</br></br>
Also, cachedump does not allow you to perform Pass-the-hash, nor does it allow you to 'steal' and reuse Kerberos tickets.</br>
</p>

<a name=thisisnotpwdump></a><h5 style="color:#006DA1;"><b>Is WCE like pwdump?</b></h5>
<p>
NO. Pwdump dumps NTLM credentials from the local SAM. WCE dumps credentials from memory; which are used by the system to perform SSO; it uses a series of techniques the author of WCE developed and published some years ago.</br>
This is one of the reasons why you may be able to compromise the whole Windows domain after compromising a regular server; NTLM credentials stored in memory and obtained by WCE could have been left there, for example, by Domain Administrators that connected to the server using RDP. In this scenario, pwdump will only allow you to obtain the NTLM credentials of the local SAM, that will probably be useless, since the server is not the domain controller.</br>
<!--<p>Another interesting thing is the following: nowadays, Windows systems do not store the LM hash of the password because this hash is very weak and can be easily 'reverted' to obtain the plaintext password. If you use pwdump, since it dumps the NTLM credentials from the SAM, it will not obtain the LM hash because it is not stored there. However, by default on Windows systems, WCE will dump the LM hash, because it is stored in memory, even when it is not stored in the SAM.</p>-->
Also, pwdump does not allow you to perform Pass-the-hash, nor does it allow you to 'steal' and reuse Kerberos tickets.<br>
</p>

<a name=notlikecain></a><h5 style="color:#006DA1;"><b>Is WCE like Cain & Abel?</b></h5>
<p>
No. WCE and Cain&Abel are two different tools with different functionality. In fact, Cain&Abel does not implement any of the functionality implemented by WCE, for example:</br></br>
* It does not implement Pass-the-Hash natively in Windows</br>
* It does not dump NTLM hashes stored in memory (it dumps local and remote SAMs, which is <b>not</b> the same thing. For more information read <a href="http://www.ampliasecurity.com/research/wce12_uba_ampliasecurity_eng.pdf" style="color:#00447B;">Post-Exploitation with WCE</a>)</br>
* It does not implement Pass-the-Ticket for Kerberos</br>
* It does not dump cleartext logon passwords stored in memory</br>
* etc.</br>
</br>
This does not imply WCE is a <i>better</i> tool, Cain&Abel also implements many things WCE does not, they are just different tools with different functionality. You should use both!</br>

</p>

<a name=moreinfowce></a><h5 style="color:#006DA1;"><b>Where can I find more information about how WCE works?</b></h5>
<p>"WCE Internals" presentation. RootedCon 2011; Madrid, Spain. <a href="http://www.ampliasecurity.com/research/WCE_Internals_RootedCon2011_ampliasecurity.pdf" style="color:#00447B;">(download)</a>
</p>


<a name=postwceinfo></a><h5 style="color:#006DA1;"><b>Where can I find information on how to use WCE on a pentest?</b></h5></a>
<p>"Post-Exploitation with WCE" presentation, UBA 2011 - Spanish <a href="http://www.ampliasecurity.com/research/wce12_uba_ampliasecurity_spa.pdf" style="color:#00447B;">(download)</a> - English <a href="http://www.ampliasecurity.com/research/wce12_uba_ampliasecurity_eng.pdf" style="color:#00447B;">(download)</a>
</p>


<a name=privs></a><h5 style="color:#006DA1;"><b>What privileges do I need to run WCE?</b></h5>
<p>You need local administrator privileges to run WCE and be able to steal
NTLM credentials from memory. This is a post-exploitation tool.</br>
You also need local administrator privileges to perform Pass-The-Hash (change your current NTLM credentials, or launch a new program in a new Windows logon session with the NTLM credentials specified).
</p>


<a name=listntlm></a><h5 style="color:#006DA1;"><b>How do I list NTLM credentials in memory?</b></h5>
<p>
    By default, WCE lists NTLM credentials in memory, no need to specify any options.</br>
For example:</br>
<p style="text-align: left;color: white; background-color: rgb(0, 0, 17); font-size: smaller; line-height: 12pt; padding-left: 1em; padding-bottom: 1em; padding-top: 1em; font-family: verdana;">
C:\Users\test&gt;wce.exe</br>
WCE v1.2 (Windows Credentials Editor) - (c) 2010,2011 Amplia Security - by Hernan Ochoa (hernan@ampliasecurity.com)<br>
Use -h for help.</br></br>

theuser:amplialabs:01FC5A6BE7BC6929AAD3B435B51404EE:0CB6948805F797BF2A82807973B89537
</br></br>
C:\Users\test&gt;</br>
</p> 
</br>
<p>In this case, only one user/credential set is listed. If there are more in memory, more will be displayed.</p>
</p>


<a name=curntlm></a><h5 style="color:#006DA1;"><b>How do I change my current NTLM credentials?</b></h5>
<p>
wce.exe -s &lt;username&gt;:&lt;domain&gt;:&lt;lmhash&gt;:&lt;nthash&gt;<br>

For example:
<p style="text-align: left;color: white; background-color: rgb(0, 0, 17); font-size: smaller; line-height: 12pt; padding-left: 1em; padding-bottom: 1em; padding-top: 1em; font-family: verdana;">
<br>C:\Users\test&gt;wce.exe -s testuser:amplialabs:01FC5A6BE7BC6929AAD3B435B51404EE:0CB6948805F797BF2A82807973B89537<br></br>
WCE v1.2 (Windows Credentials Editor) - (c) 2010,2011 Amplia Security - by Hernan Ochoa (hernan@ampliasecurity.com)<br>
Use -h for help.</br>
</br>
Changing NTLM credentials of current logon session (00024E1Bh) to:</br>
Username: testuser</br>
domain: amplialabs</br>
LMHash: 01FC5A6BE7BC6929AAD3B435B51404EE</br>

NTHash: 0CB6948805F797BF2A82807973B89537</br>
NTLM credentials successfully changed!</br>
</br></br>
C:\Users\test&gt;
</br>
</p>
</p>


<a name=newntlm></a><h5 style="color:#006DA1;"><b>How do I create a new logon session and launch a program with new NTLM credentials?</b></h5>
<p>
wce.exe -s &lt;username&gt;:&lt;domain&gt;:&lt;lmhash&gt;:&lt;nthash&gt; -c &lt;program&gt;</br>

For example:
<p style="text-align: left;color: white; background-color: rgb(0, 0, 17); font-size: smaller; line-height: 12pt; padding-left: 1em; padding-bottom: 1em; padding-top: 1em; font-family: verdana;">
<br>C:\Users\test&gt;wce.exe -s testuser:amplialabs:01FC5A6BE7BC6929AAD3B435B51404EE:0CB6948805F797BF2A82807973B89537 -c cmd.exe</br></br>
WCE v1.2 (Windows Credentials Editor) - (c) 2010,2011 Amplia Security - by Hernan Ochoa (hernan@ampliasecurity.com)</br>
Use -h for help.</br>
</br>
Changing NTLM credentials of new logon session (000118914h) to:</br>
Username: testuser</br>
domain: amplialabs</br>
LMHash: 01FC5A6BE7BC6929AAD3B435B51404EE</br>

NTHash: 0CB6948805F797BF2A82807973B89537</br>
NTLM credentials successfully changed!</br>
</br></br>
C:\Users\test&gt;
</br>
</p>
<p>At this point, a new cmd.exe instance will be launched and network connections using NTLM initiated from that instance will use the NTLM credentials specified. Of course, you can run any program,
not just cmd.exe.
</br></br>
This is feature is very useful, because you can do many tests and do Pass-the-Hash with many different users without having to change your current Windows logon session and credentials.
</p>
</p>


<a name=genntlm></a><h5 style="color:#006DA1;"><b>How can I generate NTLM hashes with WCE? (for testing purposes)</b></h5>
<p>
wce.exe -g &lt;cleartext password&gt;</br>
For example:
<p style="text-align: left;color: white; background-color: rgb(0, 0, 17); font-size: smaller; line-height: 12pt; padding-left: 1em; padding-bottom: 1em; padding-top: 1em; font-family: verdana;">
<br>C:\Users\test&gt;wce.exe -g mypassword</br></br>
WCE v1.2 (Windows Credentials Editor) - (c) 2010,2011 Amplia Security - by Hernan Ochoa (hernan@ampliasecurity.com)<br>
Use -h for help.</br>
</br>
Password:    mypassword</br>
Hashes:      74AC99CA40DED420DC1A73E6CEA67EC5:A991AE45AA987A1A48C8BDC1209FF0E7</br>
</br></br>
C:\Users\test&gt;</br>
</p> 
<p>
While testing WCE, and other things,  it is very common to have the need to generate LM and NT hashes from a password. This can be done using the '-g' parameter as shown above.
</p>
</p>

<a name=safemode></a><h5 style="color:#006DA1;"><b>What is 'safe mode'?</b></h5>
<p>
WCE is the first and only tool that can read NTLM credentials stored by Windows in memory <b>without</b> injecting code. WCE is able to locate and understand the undocumented structures used by Windows to store the credentials, find encryption keys and decrypt credentials <b>just by reading</b> the system's memory.
</br></br>
This technique is very very safe (after all, the tool is just reading memory; thus the name 'safe mode') and tries to ensure that the system where WCE is executed will not crash. This is extremely important if you are a penetration tester and want to run WCE without risking a server crash.
</br></br>
WCE will automatically attempt to use this technique first when obtaining NTLM credentials from memory; however it will also automatically attempt code injection if the first technique failed.
</br></br>
For this reason, if you want tu ensure WCE will <b>only</b> attempt to obtain NTLM credentials by reading memory (without code injection), you can use the <b>-f</b> switch (Force 'safe mode').
</br></br>
Example:</br>
<p style="text-align: left;color: white; background-color: rgb(0, 0, 17); font-size: smaller; line-height: 12pt; padding-left: 1em; padding-bottom: 1em; padding-top: 1em; font-family: verdana;">

</br>C:\Users\test&gt;wce.exe -f</br>
WCE v1.2 (Windows Credentials Editor) - (c) 2010,2011 Amplia Security - by Hernan Ochoa (hernan@ampliasecurity.com)</br>
Use -h for help.</br>
</br>
theuser:amplialabs:01FC5A6BE7BC6929AAD3B435B51404EE:0CB6948805F797BF2A82807973B89537
</br></br>
C:\Users\test&gt;</br>
</p>
<p>
Having said that, you use the tool under your own risk; no guarantee is given.
</p>
</p>

<a name=outtofile></a><h5 style="color:#006DA1;"><b>How can I write hashes obtained by WCE to a file?</b></h5>
<p>
Use the -o switch. For example:
</br>
<p style="text-align: left;color: white; background-color: rgb(0, 0, 17); font-size: smaller; line-height: 12pt; padding-left: 1em; padding-bottom: 1em; padding-top: 1em; font-family: verdana;">
C:\&gt;wce -o output.txt</br>
WCE v1.2 (Windows Credentials Editor) - (c) 2010,2011 Amplia Security - by Hernan Ochoa (hernan@ampliasecurity.com)</br>
Use -h for help.</br>
</br>
C:\&gt;type output.txt</br>
test:AMPLIALABS:01020304050607080900010203040506:98971234567865019812734576890102<br>

C:\&gt;</br>
</p>
</p>
<a name=digestauth></a><h5 style="color:#006DA1;"><b>How can I dump logon cleartext passwords with WCE?</b></h5>
<p>
The <i>-w</i> switch can be used to dump logon passwords stored in cleartext by the <i>Windows Digest Authentication package</i>. For example:
</p>
<p style="text-align: left;color: white; background-color: rgb(0, 0, 17); font-size: smaller; line-height: 12pt; padding-left: 1em; padding-bottom: 1em; padding-top: 1em; font-family: verdana;">
C:\>wce -w</br>
WCE v1.3beta (Windows Credentials Editor) - (c) 2010,2011,2012 Amplia Security - by Hernan Ochoa (hernan@ampliasecurity com)</br>
Use -h for help.</br>
</br></br>
test\MYDOMAIN:mypass1234</br>
NETWORK SERVICE\WORKGROUP:test</br>
</p>
<p>
<a href="http://www.youtube.com/watch?v=tJ0VJVrhwTE&ap=%2526fmt%3d22">This</a> video shows the use of the </i>-w</i> switch in a Windows 2008 Server (watch in 720p for best quality).
</p>
</p>
<a name="preventcleartextpwddump"></a><h5 style="color:#006DA1;"><b>How can I prevent WCE dumping my logon password in cleartext?</b></h5>
<p>
When you login into a Windows system; your cleartext password is handed over to all the Security Packages installed on the system. This includes the NTLM security package (msv1_0.dll) the Kerberos security package (kerberos.dll), the Digest Authentication Security Package (wdigest.dll) etc. These packages take the cleartext password and basically do what they desire with it. For example,  the NTLM security package generates and stores in memory the NTLM hashes discarding the cleartext password, and the Digest Authentication package stores in memory the cleartext password encrypted. The techniques invented by WCE precisely consist in extracting from these packages these credentials stored in memory.
</p>
<p>
For this reason, one of the ways to prevent WCE dumping your cleartext login password and other credentials is to avoid loading the Security Packages from which WCE retrieves them.</br></br>
These are defined in registry at the following location:</br>
    </br>
HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Control\Lsa\Security Packages
</br></br>
You will find there a list similar to the following: 
</br></br>
kerberos</br>
msv1_0</br>
schannel</br>
wdigest</br>
tspkg</br>
pku2u</br>
</br>
You can remove an item from the list and (after rebooting) Windows will not load the corresponding Security Package.</br> </br>
For example, you can remove <i>wdigest</i> and <i>tspkg</i> and WCE will not be able to dump the cleartext password stored by these packages simply because they will not be loaded anymore.
</br></br>
Although this works, keep in mind that you may encounter problems if your environment uses one of the security packages removed; you will need to test how this affects you specifically. Also, removing fundamental security packages like msv_1_0 can have catastrophic consequences, so apply this technique at your own risk.
</p>


<a name=avoiddetection></a><h5 style="color:#006DA1;"><b>WCE is detected by the antivirus/HIPS. what can I do to avoid detection?</b></h5>
<p>
Use a <i>PE Packer</i>, for example <a href="http://upx.sourceforge.net" style="color:#00447B;">UPX</a>. If <i>UPX does</i> not do the trick, try other <i>PE Packers</i>, there are many out there. Also, since you need administrator privileges to run <i>WCE</i>, try disabling the AV/HIPS before running WCE...
</br>
</p>

<a name=whatislsasrvaddr></a><h5 style="color:#006DA1;"><b>What is GETLSASRVADDR.EXE?</b></h5>
<p>
<i>GETLSASRVADDR.exe</i> is a tool (included with WCE) that can be used to obtain automatically the needed addresses for WCE to be able to read logon sessions and NTLM credentials from memory (without code injection) when WCE is not able to do it by itself out-of-the-box.
</br></br>
Addresses obtained can then be used with WCE using the -A switch.
</br>
This tool requires the DLLs <i>symsrv.dll</i> and <i>dbghelp.dll</i> available from the <i>"Debugging Tools for Windows"</i> package.
</p>

<a name=whengetlsa></a><h5 style="color:#006DA1;"><b>When should I use GETLSASRVADDR.EXE?</b></h5>
<p>
Basically, you should use <i>GETLSASRVADDR.exe</i> when you want to use <a href="#safemode">'safe mode'</a> to extract hashes from memory on a system where out-of-the-box WCE is unable to make it work.
</br></br>
<i>GETLSASRVADDR.exe</i> will give you the information WCE needs to get 'safe mode' working.
</p>

<a name=getlsasrvaddr></a><h5 style="color:#006DA1;"><b>I can't get GETLSASRVADDR.EXE to work. What's the problem?</b></h5>
<p>
The most common source of problems is that you are missing the DLL files <i>symsrv.dll</i> and <i>dbghelp.dll</i> available from the "Debugging Tools For Windows" package.</br></br>
This is most likely the case if you are getting the following error message:</br></br>
<i>
Connecting to Microsoft.com symbol server...please wait..</br>

Error: cannot find symsrv.dll</br>
Error: Cannot obtain addresses</br>
</i>
</br></br>
Read the presentation <a href="http://www.ampliasecurity.com/research/WCE_Internals_RootedCon2011_ampliasecurity.pdf" style="color:#00447B;">WCE Internals</a> for an explanation on why these DLLs are required.<br>
The tool <i>getlsasrvaddr.exe</i> is meant to be used in the attacker's machine, and not in compromised machines; so this requirement should not be an issue.
</br></br>
Another common issue is having UAC enabled and not being able to access <i>c:\windows\system32\lsasrv.dll</i>. In this case, just copy <i>lsasrv.dll</i> to another directory and try again.
</p>

<a name=pshtoolkit></a><h5 style="color:#006DA1;"><b>Who's the author of WCE? Is he also the author of the PSH Toolkit?</b></h5>
<p>The author of WCE is Hernan Ochoa (hernan [ at ] ampliasecurity.com); and yes, he is also the author of the now defunct Pass-The-Hash Toolkit.
</p>


<a name=betterthanpsh></a><h5 style="color:#006DA1;"><b>How is WCE better than the PSH Toolkit?</b></h5>
<p>The Pass-The-Hash (PSH) Toolkit does not work anymore. It does not support
newer updates for Windows XP and 2003; and it does NOT support Windows 7 and 2008 at all.</br></br>
WCE is basically a complete rewrite form scratch, it uses new techniques and does automagically lots of things to make its use easier and to make it work automatically in more platforms. It also works perfectly with all Windows versions, including Windows 7 and 2008; and it is the only tool that is able to read credentials just by reading memory; which is very important to penetration testers, since this means the chances of crashing a server when using WCE are almost zero (although neither the author nor Amplia Security guarantees this in any way; you use the tool at your own risk).</br></br>
Also, the PSH Toolkit does not allow you to 'steal' and reuse Kerberos tickets.</br>

(Note: remember the author of WCE is also the author of the PSH Toolkit).</br></br>
</p>

</div>     
<!-- END OF FAQ -->
					</div>
					</br>

                                   </br>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!--FIN ABOUTUS-->

                </div>
            </div>
        </section>
        <footer id="footer">
            <div class="container">
                <div class="row">
                    <div class="col-md-3 col-1">
                        <aside id="contactinfo-2">
                            <div class="tw-widget-title-container">
                                <h3 class="widget-title">SERVICES</h3>
                                <span class="tw-title-border"></span>
                            </div>
                            <div class="contact-info-widget">
                                <ul>
                                    <li>
                                        <a href="/services/web-application-penetration-test.html"><div>Web Application Penetration Testing</div></a>
                                    </li>
                                    <li>
                                        <a href="/services/network-penetration-test.html"><div>Network Penetration Testing</div></a>
                                    </li>
                                    <li>
                                        <a href="/services/client-side-penetration-test.html"><div>Client-Side Penetration Testing</div></a>
                                    </li>
                                    <li>
                                        <a href="/services.html"><div>Wireless Penetration Testing</div></a>
                                    </li>
                                    <li>
                                        <a href="/services.html"><div>Software Penetration Testing</div></a>
                                    </li>
                                    <li>
                                        <a href="/services.html"><div>Appliance Penetration Testing</div></a>
                                    </li>
                                    <li>
                                        <a href="/services.html"><div>Web Service Penetration Testing</div></a>
                                    </li>
                                    <li>
                                        <a href="/services.html"><div>Software Security Assessments</div></a>
                                    </li>
                                    <li>
                                        <a href="/services.html"><div>Source Code Reviews</div></a>
                                    </li>
                                </ul>
                            </div>
                        </aside>
                    </div>
                    <div class="col-md-3 col-2">
                        <aside id="contactinfo-2">
                            <div class="tw-widget-title-container">
                                <h3 class="widget-title">MOST DOWNLOADED</h3>
                                <span class="tw-title-border"></span>
                            </div>
                            <div class="contact-info-widget">
                                <ul>
                                    <li>
                                        <a href="http://www.ampliasecurity.com/research/wce_v1_41beta_universal.zip"><div>WCE v1.41beta (Universal)</div></a>
                                    </li>
                                    <li>
                                        <a href="http://www.ampliasecurity.com/research/wce_v1_42beta_x64.zip"><div>WCE v1.42beta 64bit</div></a>
                                    </li>
                                    <li>
                                        <a href="http://www.ampliasecurity.com/research/wce_v1_42beta_x32.zip"><div>WCE v1.42beta 32bit</div></a>
                                    </li>
                                    <li>
                                        <a href="http://www.ampliasecurity.com/research/wce12_uba_ampliasecurity_eng.pdf"><div>Post-Exploitation with WCE</div></a>
                                    </li>
                                    <li>
                                        <a href="http://www.ampliasecurity.com/research/aspx_po_chotext_attack.rb"><div>ASP.NET Padding oracle Attack POC exploit (MS10-070)</div></a>
                                    </li>
                                    <li>
                                        <a href="http://www.ampliasecurity.com/research/aspx_ad_chotext_attack.rb"><div>ASP.NET Auto-Decryptor File Download PoC Exploit (MS10-070)</div></a>
                                    </li>
                                    <!--<li>
                                        <a href=""><div>Download PoC exploit (MS10-070)</div></a>
                                    </li>-->
                                </ul>
                            </div>
                        </aside>
                    </div>
                    <div class="col-md-3 col-3">
                        <aside id="contactinfo-2">
                            <div class="tw-widget-title-container">
                                <h3 class="widget-title">MOST READ</h3>
                                <span class="tw-title-border"></span>
                            </div>
                            <div class="contact-info-widget">
                                <ul>
                                    <li>
                                        <a href="http://www.ampliasecurity.com/research/wcefaq.html"><div>WCE F.A.Q.</div></a>
                                    </li>
                                    <li>
                                        <a href="http://www.ampliasecurity.com/blog/2014/09/24/exploiting_bash_remote_code_execution_vulnerability_CVE-2014-6271/"><div>Exploiting BASH Remote Code Execution Vulnerability (CVE-2014-6271)</div></a>
                                    </li>
                                    <li>
                                        <a href="http://www.ampliasecurity.com/blog/2013/01/10/java_7_update_10_0-day_vulnerability_CVE-2013-0422/"><div>Java 7 Update 10 0-Day Vulnerability (CVE-2013-0422)</div></a>
                                    </li>
                                    <!--<li>
                                        <a href="#"><div>(CVE-2013-0422)</div></a>
                                    </li>-->
                                    <li>
                                        <a href="http://www.ampliasecurity.com/blog/2010/09/28/a_padding_oracle_attack_implemented_in_javascript/"><div>A Padding Oracle Attack Implemented in Javascript</div></a>
                                    </li>
                                </ul>
                            </div>
                        </aside>
                    </div>
                    <div class="col-md-3 col-4">
                        <aside id="contactinfo-2">
                            <div class="tw-widget-title-container">
                                <h3 class="widget-title">MOST WATCHED</h3>
                                <span class="tw-title-border"></span>
                            </div>
                            <div class="contact-info-widget">
                                <ul>
                                    <li>
                                        <a href="http://www.youtube.com/watch?v=PLnvKsYJwiM"><div>Exploiting BASH Remote Code Execution Vulnerability (CVE-2014-6271)</div></a>
                                    </li>
                                    <li>
                                        <a href="http://youtu.be/Mg5iUjOpusE?hd=1"><div>Exploiting MySQL Authentication Bypass Vulnerability (CVE-2012-2122)</div></a>
                                    </li>
                                    <li>
                                        <a href="http://youtu.be/YGCSJEZ7kPk?hd=1"><div>Exploiting Apache Struts ExceptionDelegator Vulnerability (CVE-2012-0391)</div></a>
                                    </li>
                                    <li>
                                        <a href="http://www.youtube.com/ampliasecurity#p/u/0/2jvmT5lmIIM"><div>ASP.NET Padding Oracle attack PoC exploit video</div></a>
                                    </li>
                                    <li>
                                        <a href="http://www.youtube.com/ampliasecurity#p/u/1/asRpCcVhnuI"><div>Using GTT to download files from an isolated Citrix environment</div></a>
                                    </li>
                                </ul>
                            </div>
                        </aside>
                    </div>
                </div>
            </div>
            <div id="bottom">
                <div class="container">
                    <div class="row foot-amplia">
                        <div class="col-xs-12 col-sm-6">
                            <p class="copyright">
                                Â© Copyright 2022 by Amplia Security. All Rights Reserved
                            </p>
                        </div>
                        <div class="col-xs-12 col-sm-6 footer-amplia" style="float:right;">
                            <a href="mailto:info@ampliasecurity.com"><i class="tw-font-awesome fa fa-envelope redes  circle" style="background-color:#84A7C6;"></i></a>
                            <a href="http://www.twitter.com/ampliasecurity"><i class="tw-font-awesome fa fa-twitter redes circle" style="background-color:#178DB4;"></i></a>
                            <a href="http://www.ampliasecurity.com/rss.html"><i class="tw-font-awesome fa fa-rss redes circle" style="background-color:#CD6A00;"></i></a>
                            <a href="http://www.youtube.com/user/AmpliaSecurity/videos"><i class="tw-font-awesome fa fa-youtube redes circle" style="background-color:#C2332C;"></i></a>
                        </div>
                    </div>
                </div>
            </div>
        </footer>
        <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="/libs/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="/assets/js/bootstrap.min.js"></script>
    <!-- Site Functionalities -->
    <script src="/assets/js/amplia.js"></script>
    </body>
</html>
