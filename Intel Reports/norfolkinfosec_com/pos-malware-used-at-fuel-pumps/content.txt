<!DOCTYPE html>
<html lang="en-US">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="profile" href="http://gmpg.org/xfn/11">
<link rel="pingback" href="https://norfolkinfosec.com/xmlrpc.php">


<title>POS Malware Used at Fuel Pumps &#8211; One Night in Norfolk</title>
<meta name='robots' content='max-image-preview:large' />
	<style>img:is([sizes="auto" i], [sizes^="auto," i]) { contain-intrinsic-size: 3000px 1500px }</style>
	<link rel="alternate" type="application/rss+xml" title="One Night in Norfolk &raquo; Feed" href="https://norfolkinfosec.com/feed/" />
<link rel="alternate" type="application/rss+xml" title="One Night in Norfolk &raquo; Comments Feed" href="https://norfolkinfosec.com/comments/feed/" />
<link rel="alternate" type="application/rss+xml" title="One Night in Norfolk &raquo; POS Malware Used at Fuel Pumps Comments Feed" href="https://norfolkinfosec.com/pos-malware-used-at-fuel-pumps/feed/" />
<script type="text/javascript">
/* <![CDATA[ */
window._wpemojiSettings = {"baseUrl":"https:\/\/s.w.org\/images\/core\/emoji\/15.0.3\/72x72\/","ext":".png","svgUrl":"https:\/\/s.w.org\/images\/core\/emoji\/15.0.3\/svg\/","svgExt":".svg","source":{"concatemoji":"https:\/\/norfolkinfosec.com\/wp-includes\/js\/wp-emoji-release.min.js?ver=6.7.1"}};
/*! This file is auto-generated */
!function(i,n){var o,s,e;function c(e){try{var t={supportTests:e,timestamp:(new Date).valueOf()};sessionStorage.setItem(o,JSON.stringify(t))}catch(e){}}function p(e,t,n){e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillText(t,0,0);var t=new Uint32Array(e.getImageData(0,0,e.canvas.width,e.canvas.height).data),r=(e.clearRect(0,0,e.canvas.width,e.canvas.height),e.fillText(n,0,0),new Uint32Array(e.getImageData(0,0,e.canvas.width,e.canvas.height).data));return t.every(function(e,t){return e===r[t]})}function u(e,t,n){switch(t){case"flag":return n(e,"\ud83c\udff3\ufe0f\u200d\u26a7\ufe0f","\ud83c\udff3\ufe0f\u200b\u26a7\ufe0f")?!1:!n(e,"\ud83c\uddfa\ud83c\uddf3","\ud83c\uddfa\u200b\ud83c\uddf3")&&!n(e,"\ud83c\udff4\udb40\udc67\udb40\udc62\udb40\udc65\udb40\udc6e\udb40\udc67\udb40\udc7f","\ud83c\udff4\u200b\udb40\udc67\u200b\udb40\udc62\u200b\udb40\udc65\u200b\udb40\udc6e\u200b\udb40\udc67\u200b\udb40\udc7f");case"emoji":return!n(e,"\ud83d\udc26\u200d\u2b1b","\ud83d\udc26\u200b\u2b1b")}return!1}function f(e,t,n){var r="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope?new OffscreenCanvas(300,150):i.createElement("canvas"),a=r.getContext("2d",{willReadFrequently:!0}),o=(a.textBaseline="top",a.font="600 32px Arial",{});return e.forEach(function(e){o[e]=t(a,e,n)}),o}function t(e){var t=i.createElement("script");t.src=e,t.defer=!0,i.head.appendChild(t)}"undefined"!=typeof Promise&&(o="wpEmojiSettingsSupports",s=["flag","emoji"],n.supports={everything:!0,everythingExceptFlag:!0},e=new Promise(function(e){i.addEventListener("DOMContentLoaded",e,{once:!0})}),new Promise(function(t){var n=function(){try{var e=JSON.parse(sessionStorage.getItem(o));if("object"==typeof e&&"number"==typeof e.timestamp&&(new Date).valueOf()<e.timestamp+604800&&"object"==typeof e.supportTests)return e.supportTests}catch(e){}return null}();if(!n){if("undefined"!=typeof Worker&&"undefined"!=typeof OffscreenCanvas&&"undefined"!=typeof URL&&URL.createObjectURL&&"undefined"!=typeof Blob)try{var e="postMessage("+f.toString()+"("+[JSON.stringify(s),u.toString(),p.toString()].join(",")+"));",r=new Blob([e],{type:"text/javascript"}),a=new Worker(URL.createObjectURL(r),{name:"wpTestEmojiSupports"});return void(a.onmessage=function(e){c(n=e.data),a.terminate(),t(n)})}catch(e){}c(n=f(s,u,p))}t(n)}).then(function(e){for(var t in e)n.supports[t]=e[t],n.supports.everything=n.supports.everything&&n.supports[t],"flag"!==t&&(n.supports.everythingExceptFlag=n.supports.everythingExceptFlag&&n.supports[t]);n.supports.everythingExceptFlag=n.supports.everythingExceptFlag&&!n.supports.flag,n.DOMReady=!1,n.readyCallback=function(){n.DOMReady=!0}}).then(function(){return e}).then(function(){var e;n.supports.everything||(n.readyCallback(),(e=n.source||{}).concatemoji?t(e.concatemoji):e.wpemoji&&e.twemoji&&(t(e.twemoji),t(e.wpemoji)))}))}((window,document),window._wpemojiSettings);
/* ]]> */
</script>
<style id='wp-emoji-styles-inline-css' type='text/css'>

	img.wp-smiley, img.emoji {
		display: inline !important;
		border: none !important;
		box-shadow: none !important;
		height: 1em !important;
		width: 1em !important;
		margin: 0 0.07em !important;
		vertical-align: -0.1em !important;
		background: none !important;
		padding: 0 !important;
	}
</style>
<link rel='stylesheet' id='wp-block-library-css' href='https://norfolkinfosec.com/wp-includes/css/dist/block-library/style.min.css?ver=6.7.1' type='text/css' media='all' />
<style id='classic-theme-styles-inline-css' type='text/css'>
/*! This file is auto-generated */
.wp-block-button__link{color:#fff;background-color:#32373c;border-radius:9999px;box-shadow:none;text-decoration:none;padding:calc(.667em + 2px) calc(1.333em + 2px);font-size:1.125em}.wp-block-file__button{background:#32373c;color:#fff;text-decoration:none}
</style>
<style id='global-styles-inline-css' type='text/css'>
:root{--wp--preset--aspect-ratio--square: 1;--wp--preset--aspect-ratio--4-3: 4/3;--wp--preset--aspect-ratio--3-4: 3/4;--wp--preset--aspect-ratio--3-2: 3/2;--wp--preset--aspect-ratio--2-3: 2/3;--wp--preset--aspect-ratio--16-9: 16/9;--wp--preset--aspect-ratio--9-16: 9/16;--wp--preset--color--black: #000000;--wp--preset--color--cyan-bluish-gray: #abb8c3;--wp--preset--color--white: #ffffff;--wp--preset--color--pale-pink: #f78da7;--wp--preset--color--vivid-red: #cf2e2e;--wp--preset--color--luminous-vivid-orange: #ff6900;--wp--preset--color--luminous-vivid-amber: #fcb900;--wp--preset--color--light-green-cyan: #7bdcb5;--wp--preset--color--vivid-green-cyan: #00d084;--wp--preset--color--pale-cyan-blue: #8ed1fc;--wp--preset--color--vivid-cyan-blue: #0693e3;--wp--preset--color--vivid-purple: #9b51e0;--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple: linear-gradient(135deg,rgba(6,147,227,1) 0%,rgb(155,81,224) 100%);--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan: linear-gradient(135deg,rgb(122,220,180) 0%,rgb(0,208,130) 100%);--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange: linear-gradient(135deg,rgba(252,185,0,1) 0%,rgba(255,105,0,1) 100%);--wp--preset--gradient--luminous-vivid-orange-to-vivid-red: linear-gradient(135deg,rgba(255,105,0,1) 0%,rgb(207,46,46) 100%);--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray: linear-gradient(135deg,rgb(238,238,238) 0%,rgb(169,184,195) 100%);--wp--preset--gradient--cool-to-warm-spectrum: linear-gradient(135deg,rgb(74,234,220) 0%,rgb(151,120,209) 20%,rgb(207,42,186) 40%,rgb(238,44,130) 60%,rgb(251,105,98) 80%,rgb(254,248,76) 100%);--wp--preset--gradient--blush-light-purple: linear-gradient(135deg,rgb(255,206,236) 0%,rgb(152,150,240) 100%);--wp--preset--gradient--blush-bordeaux: linear-gradient(135deg,rgb(254,205,165) 0%,rgb(254,45,45) 50%,rgb(107,0,62) 100%);--wp--preset--gradient--luminous-dusk: linear-gradient(135deg,rgb(255,203,112) 0%,rgb(199,81,192) 50%,rgb(65,88,208) 100%);--wp--preset--gradient--pale-ocean: linear-gradient(135deg,rgb(255,245,203) 0%,rgb(182,227,212) 50%,rgb(51,167,181) 100%);--wp--preset--gradient--electric-grass: linear-gradient(135deg,rgb(202,248,128) 0%,rgb(113,206,126) 100%);--wp--preset--gradient--midnight: linear-gradient(135deg,rgb(2,3,129) 0%,rgb(40,116,252) 100%);--wp--preset--font-size--small: 13px;--wp--preset--font-size--medium: 20px;--wp--preset--font-size--large: 36px;--wp--preset--font-size--x-large: 42px;--wp--preset--spacing--20: 0.44rem;--wp--preset--spacing--30: 0.67rem;--wp--preset--spacing--40: 1rem;--wp--preset--spacing--50: 1.5rem;--wp--preset--spacing--60: 2.25rem;--wp--preset--spacing--70: 3.38rem;--wp--preset--spacing--80: 5.06rem;--wp--preset--shadow--natural: 6px 6px 9px rgba(0, 0, 0, 0.2);--wp--preset--shadow--deep: 12px 12px 50px rgba(0, 0, 0, 0.4);--wp--preset--shadow--sharp: 6px 6px 0px rgba(0, 0, 0, 0.2);--wp--preset--shadow--outlined: 6px 6px 0px -3px rgba(255, 255, 255, 1), 6px 6px rgba(0, 0, 0, 1);--wp--preset--shadow--crisp: 6px 6px 0px rgba(0, 0, 0, 1);}:where(.is-layout-flex){gap: 0.5em;}:where(.is-layout-grid){gap: 0.5em;}body .is-layout-flex{display: flex;}.is-layout-flex{flex-wrap: wrap;align-items: center;}.is-layout-flex > :is(*, div){margin: 0;}body .is-layout-grid{display: grid;}.is-layout-grid > :is(*, div){margin: 0;}:where(.wp-block-columns.is-layout-flex){gap: 2em;}:where(.wp-block-columns.is-layout-grid){gap: 2em;}:where(.wp-block-post-template.is-layout-flex){gap: 1.25em;}:where(.wp-block-post-template.is-layout-grid){gap: 1.25em;}.has-black-color{color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-color{color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-color{color: var(--wp--preset--color--white) !important;}.has-pale-pink-color{color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-color{color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-color{color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-color{color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-color{color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-color{color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-color{color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-color{color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-color{color: var(--wp--preset--color--vivid-purple) !important;}.has-black-background-color{background-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-background-color{background-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-background-color{background-color: var(--wp--preset--color--white) !important;}.has-pale-pink-background-color{background-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-background-color{background-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-background-color{background-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-background-color{background-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-background-color{background-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-background-color{background-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-background-color{background-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-background-color{background-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-background-color{background-color: var(--wp--preset--color--vivid-purple) !important;}.has-black-border-color{border-color: var(--wp--preset--color--black) !important;}.has-cyan-bluish-gray-border-color{border-color: var(--wp--preset--color--cyan-bluish-gray) !important;}.has-white-border-color{border-color: var(--wp--preset--color--white) !important;}.has-pale-pink-border-color{border-color: var(--wp--preset--color--pale-pink) !important;}.has-vivid-red-border-color{border-color: var(--wp--preset--color--vivid-red) !important;}.has-luminous-vivid-orange-border-color{border-color: var(--wp--preset--color--luminous-vivid-orange) !important;}.has-luminous-vivid-amber-border-color{border-color: var(--wp--preset--color--luminous-vivid-amber) !important;}.has-light-green-cyan-border-color{border-color: var(--wp--preset--color--light-green-cyan) !important;}.has-vivid-green-cyan-border-color{border-color: var(--wp--preset--color--vivid-green-cyan) !important;}.has-pale-cyan-blue-border-color{border-color: var(--wp--preset--color--pale-cyan-blue) !important;}.has-vivid-cyan-blue-border-color{border-color: var(--wp--preset--color--vivid-cyan-blue) !important;}.has-vivid-purple-border-color{border-color: var(--wp--preset--color--vivid-purple) !important;}.has-vivid-cyan-blue-to-vivid-purple-gradient-background{background: var(--wp--preset--gradient--vivid-cyan-blue-to-vivid-purple) !important;}.has-light-green-cyan-to-vivid-green-cyan-gradient-background{background: var(--wp--preset--gradient--light-green-cyan-to-vivid-green-cyan) !important;}.has-luminous-vivid-amber-to-luminous-vivid-orange-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-amber-to-luminous-vivid-orange) !important;}.has-luminous-vivid-orange-to-vivid-red-gradient-background{background: var(--wp--preset--gradient--luminous-vivid-orange-to-vivid-red) !important;}.has-very-light-gray-to-cyan-bluish-gray-gradient-background{background: var(--wp--preset--gradient--very-light-gray-to-cyan-bluish-gray) !important;}.has-cool-to-warm-spectrum-gradient-background{background: var(--wp--preset--gradient--cool-to-warm-spectrum) !important;}.has-blush-light-purple-gradient-background{background: var(--wp--preset--gradient--blush-light-purple) !important;}.has-blush-bordeaux-gradient-background{background: var(--wp--preset--gradient--blush-bordeaux) !important;}.has-luminous-dusk-gradient-background{background: var(--wp--preset--gradient--luminous-dusk) !important;}.has-pale-ocean-gradient-background{background: var(--wp--preset--gradient--pale-ocean) !important;}.has-electric-grass-gradient-background{background: var(--wp--preset--gradient--electric-grass) !important;}.has-midnight-gradient-background{background: var(--wp--preset--gradient--midnight) !important;}.has-small-font-size{font-size: var(--wp--preset--font-size--small) !important;}.has-medium-font-size{font-size: var(--wp--preset--font-size--medium) !important;}.has-large-font-size{font-size: var(--wp--preset--font-size--large) !important;}.has-x-large-font-size{font-size: var(--wp--preset--font-size--x-large) !important;}
:where(.wp-block-post-template.is-layout-flex){gap: 1.25em;}:where(.wp-block-post-template.is-layout-grid){gap: 1.25em;}
:where(.wp-block-columns.is-layout-flex){gap: 2em;}:where(.wp-block-columns.is-layout-grid){gap: 2em;}
:root :where(.wp-block-pullquote){font-size: 1.5em;line-height: 1.6;}
</style>
<link rel='stylesheet' id='coral-dark-style-css' href='https://norfolkinfosec.com/wp-content/themes/coral-dark/style.css?ver=6.7.1' type='text/css' media='all' />
<style id='coral-dark-style-inline-css' type='text/css'>
h1.site-title, h3.site-title { font-family: Arial, Helvetica, sans-serif;}
		
		body, button, input, select, textarea {	font-size: 12px;}
		h1.site-title, h3.site-title {
			margin-top: 25px; 
			font-size: 30px; 
		}
		h1.site-title a,
		h1.site-title a:visited,
		h1.site-title a:hover,
		h1.site-title a:active,
		h1.site-title a:focus,
		h3.site-title a,
		h3.site-title a:visited,
		h3.site-title a:hover,
		h3.site-title a:active,
		h3.site-title a:focus {
			color: #eeeeee !important;
		}
		
		h2.site-description, h4.site-description {
			margin-top: 5px;
			font-size: 14px;
			color: #999999;
		}
		.custom-logo {max-height: 100px;}
		@media screen and (min-width: 768px) {
			.main-navigation {margin-top: 15px;}
			#search1 {margin-top: 42px;}
			#social1 {margin-top: 47px;}
		}
	
</style>
<script type="text/javascript" src="https://norfolkinfosec.com/wp-includes/js/jquery/jquery.min.js?ver=3.7.1" id="jquery-core-js"></script>
<script type="text/javascript" src="https://norfolkinfosec.com/wp-includes/js/jquery/jquery-migrate.min.js?ver=3.4.1" id="jquery-migrate-js"></script>
<script type="text/javascript" src="https://norfolkinfosec.com/wp-content/themes/coral-dark/js/jquery.nivo.slider.pack.js?ver=3.2" id="nivo-slider-js"></script>
<link rel="https://api.w.org/" href="https://norfolkinfosec.com/wp-json/" /><link rel="alternate" title="JSON" type="application/json" href="https://norfolkinfosec.com/wp-json/wp/v2/posts/293" /><link rel="EditURI" type="application/rsd+xml" title="RSD" href="https://norfolkinfosec.com/xmlrpc.php?rsd" />
<meta name="generator" content="WordPress 6.7.1" />
<link rel="canonical" href="https://norfolkinfosec.com/pos-malware-used-at-fuel-pumps/" />
<link rel='shortlink' href='https://norfolkinfosec.com/?p=293' />
<link rel="alternate" title="oEmbed (JSON)" type="application/json+oembed" href="https://norfolkinfosec.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fnorfolkinfosec.com%2Fpos-malware-used-at-fuel-pumps%2F" />
<link rel="alternate" title="oEmbed (XML)" type="text/xml+oembed" href="https://norfolkinfosec.com/wp-json/oembed/1.0/embed?url=https%3A%2F%2Fnorfolkinfosec.com%2Fpos-malware-used-at-fuel-pumps%2F&#038;format=xml" />
		<style type="text/css" id="wp-custom-css">
			.wp-block-table td { font-size: 12pt; }		</style>
		</head>

<body class="post-template-default single single-post postid-293 single-format-standard wp-embed-responsive">
<div id="page" class="hfeed site">
	<a class="skip-link screen-reader-text" href="#content">Skip to content</a>

	<header id="masthead" class="site-header grid-container" role="banner">
		<div class="site-branding egrid  grid-35 tablet-grid-35 mobile-grid-100">
												<h3 class="site-title"><a href="https://norfolkinfosec.com/" rel="home">One Night in Norfolk</a></h3>
					<h4 class="site-description">Reverse Engineering and Malware Analysis</h4>
					
							
		</div><!-- .site-branding -->
		<div id="headerright" class="grid-parent egrid  grid-65 tablet-grid-65 mobile-grid-100">
			
			<div id="social1" class="egrid  grid-60 tablet-grid-60 mobile-grid-100">
							</div>
			
			<div id="search1" class="search  grid-40 tablet-grid-40 mobile-grid-100">
				<div class="search-container">
<form role="search" method="get" class="search-form" action="https://norfolkinfosec.com/">
	<fieldset>
		<input type="search" class="search-field" placeholder="Search..." value="" name="s" title="Search for:" />
		<input type="submit" class="search-submit" value="" />
	</fieldset>
</form>
</div>			</div>
		</div>

		<nav id="site-navigation" class="main-navigation egrid grid-100 tablet-grid-100 mobile-grid-100" role="navigation">
			<i id="menu-button" class="fa fa-bars collapsed"><span>  Menu</span></i>
			<div class="menu-primary-menu-container"><ul id="main-menu" class="sm sm-clean collapsed"><li id="menu-item-15" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-15"><a href="https://norfolkinfosec.com">Home</a></li>
<li id="menu-item-69" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-69"><a href="https://norfolkinfosec.com/contact/">Contact Me</a></li>
<li id="menu-item-266" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-266"><a href="https://norfolkinfosec.com/pretzels/">Pretzels</a></li>
<li id="menu-item-373" class="menu-item menu-item-type-post_type menu-item-object-page menu-item-373"><a href="https://norfolkinfosec.com/presentations/">Presentations</a></li>
</ul></div>		</nav><!-- #site-navigation -->
	</header><!-- #masthead -->

		
<!-- breadcrumbs from Yoast or NavXT plugins -->
		
	<div id="content" class="site-content grid-container">

	<div id="primary" class="content-area egrid  grid-85 tablet-grid-85 mobile-grid-100 push-15 tablet-push-15">
		<main id="main" class="site-main" role="main">

		
			
<article id="post-293" class="post-293 post type-post status-publish format-standard hentry category-uncategorized tag-pos-malware">
	<header class="entry-header">
		<h1 class="entry-title">POS Malware Used at Fuel Pumps</h1>
		<div class="entry-meta">
			<span class="posted-on"><a href="https://norfolkinfosec.com/pos-malware-used-at-fuel-pumps/" rel="bookmark"><time class="entry-date published" datetime="2019-12-23T08:21:58+00:00">December 23, 2019</time><time class="updated" datetime="2019-12-23T14:13:54+00:00">December 23, 2019</time></a></span><span class="byline"> <span class="author vcard"><a class="url fn n" href="https://norfolkinfosec.com/author/norfolkadmin/">norfolk</a></span></span>		</div><!-- .entry-meta -->
	</header><!-- .entry-header -->

	<div class="entry-content">
		
		
<p style="font-size:12px" class="has-text-align-left">In December 2019, <a href="https://usa.visa.com/dam/VCOM/global/support-legal/documents/cybercrime-groups-targeting-fuel-dispenser-merchants.pdf">VISA Security released a bulletin</a> detailing multiple incidents in which threat actors targeted point of sale systems used at fuel dispensing companies with malware designed to parse out credit card numbers from these systems. This blog post examines a file, 19d38325f715f623bd4b6e819a150cde, associated with the first of three listed incidents in that bulletin. <br><br>There are several notable characteristics regarding this malware, including a unique way for the threat actors to terminate the tool.</p>



<span id="more-293"></span>



<p style="font-size:12px" class="has-text-align-left">MD5: 19d38325f715f623bd4b6e819a150cde<br>SHA1: 81c4a8cf8c0da1c590377b37ed5cff8771560a3d<br>SHA256: 7a207137e7b234e680116aa071f049c8472e4fb5990a38dab264d0a4cde126df<br><br>The file appears to be a variant of the Grateful/Framework POS family. While this variant (via a similar file, 0EB7AC6D2D99D702ECC8B86FF90B0AAC) <a href="https://www.vkremez.com/2017/12/lets-learn-reversing-grateful-point-of.html">are described elsewhere</a>, this blog is currently unable to replicate or identify the data exfiltration method detailed in external posts. This method appears statically in strings in similar &#8211; but larger &#8211; samples, suggesting that it may have actually been removed for certain variants. If that is the case, it would also imply that the threat actors exifiltrated the data through other malware or tools, which would be consistent with some <a href="https://malware.news/t/x-force-iris-identifies-fin6-activity-on-pos-networks/22509">vendor observations</a>. Further discussion around this point and the discrepancies in reported functionality around these hashes can be found in a later section.<br><br>The file contains two exports:<br>  &#8211; workerInstance (main functionality)<br>  &#8211; debugPoint (enters a sleep loop)<br><br>The workerInstance export is used to launch the main functionality of the malware. In addition, the malware also expects to receive a file path as an argument. When this export is called, the malware creates a mutex named &#8220;Global.Ms.ThreadPooling.MyAppSingleInstance&#8221; and then collects local data about the infected workstation. This data is written to the filepath specified at runtime. </p>



<div class="wp-block-image"><figure class="aligncenter size-large"><img fetchpriority="high" decoding="async" width="784" height="547" src="https://norfolkinfosec.com/wp-content/uploads/2019/12/pic_1.png" alt="" class="wp-image-294" srcset="https://norfolkinfosec.com/wp-content/uploads/2019/12/pic_1.png 784w, https://norfolkinfosec.com/wp-content/uploads/2019/12/pic_1-300x209.png 300w, https://norfolkinfosec.com/wp-content/uploads/2019/12/pic_1-768x536.png 768w, https://norfolkinfosec.com/wp-content/uploads/2019/12/pic_1-210x147.png 210w" sizes="(max-width: 784px) 100vw, 784px" /></figure></div>



<div class="wp-block-image"><figure class="aligncenter size-large"><img decoding="async" width="878" height="902" src="https://norfolkinfosec.com/wp-content/uploads/2019/12/pic_2.png" alt="" class="wp-image-295" srcset="https://norfolkinfosec.com/wp-content/uploads/2019/12/pic_2.png 878w, https://norfolkinfosec.com/wp-content/uploads/2019/12/pic_2-292x300.png 292w, https://norfolkinfosec.com/wp-content/uploads/2019/12/pic_2-768x789.png 768w, https://norfolkinfosec.com/wp-content/uploads/2019/12/pic_2-204x210.png 204w" sizes="(max-width: 878px) 100vw, 878px" /></figure></div>



<p style="font-size:12px" class="has-text-align-left">The malware runs four threads:<br><br>   &#8211; Thread 1: Enters memory scraping loop<br>   &#8211; Thread 2: Enters memory scraping loop<br>   &#8211; Thread 3: Checks length of process to be scraped. Process must be > 4 characters.<br>   &#8211; Thread 4: Terminates the malware if a &#8220;stopper&#8221; file is found in the working directory<br><br>Of these, <strong>Thread 4</strong> is among the most novel and allows the threat actors to terminate the malware. The malware takes the filename &#8220;memscrp.stp&#8221; and appends it to a string containing the working directory of the DLL. The malware will then use the CreateFile API to try to access a file with the name at this location. It then performs a comparison: <br><br>1) If the CreateFile call generated an error (i.e. the file was not present at the time of the check), EAX is zeroed out and the routine sleeps for sixty seconds before trying again. <br><br>2) If this call does <em>not</em> generate an error (i.e. the file exists), the malware uses the MoveFile API call to add a .stopped extension to this file and then terminates.<br><br>This workflow is shown below.</p>



<figure class="wp-block-image size-large"><img decoding="async" width="869" height="925" src="https://norfolkinfosec.com/wp-content/uploads/2019/12/pic_3.png" alt="" class="wp-image-296" srcset="https://norfolkinfosec.com/wp-content/uploads/2019/12/pic_3.png 869w, https://norfolkinfosec.com/wp-content/uploads/2019/12/pic_3-282x300.png 282w, https://norfolkinfosec.com/wp-content/uploads/2019/12/pic_3-768x817.png 768w, https://norfolkinfosec.com/wp-content/uploads/2019/12/pic_3-197x210.png 197w" sizes="(max-width: 869px) 100vw, 869px" /></figure>



<p style="font-size:12px">The advantages to this are unclear; however, one possibility is that this approach allows the threat actors to terminate the malware without the need for command and control implementation. <br><br><span style="text-decoration: underline;">Memory Scraping Threads</span><br><br>As noted in <a href="https://www.vkremez.com/2017/12/lets-learn-reversing-grateful-point-of.html">another blog post</a>, this malware forgoes more targeted scraping (in which specific BINs are selected) in favor of a broader collection. The threat actors&#8217; scraping logic is not yet fully understood; however, several characteristics of credit card track data do appear, including the common &#8220;=&#8221; and &#8220;^&#8221; separators:</p>



<div class="wp-block-image"><figure class="aligncenter size-large"><img loading="lazy" decoding="async" width="387" height="415" src="https://norfolkinfosec.com/wp-content/uploads/2019/12/pic4.png" alt="" class="wp-image-298" srcset="https://norfolkinfosec.com/wp-content/uploads/2019/12/pic4.png 387w, https://norfolkinfosec.com/wp-content/uploads/2019/12/pic4-280x300.png 280w, https://norfolkinfosec.com/wp-content/uploads/2019/12/pic4-196x210.png 196w" sizes="auto, (max-width: 387px) 100vw, 387px" /></figure></div>



<p style="font-size:12px">The scraping threads use the ReadProcessMemory API call to run data from all of the processes on the infected system. Unlike previously documented samples, no apparent whitelisting was present in the malware during static analysis, and during dynamic runs of the malware the scraper searched for data without discretion. The comparison logic in the image above takes place within the &#8220;Possible_Parsing&#8221; function boxed in blue at the bottom right of the image below:</p>



<figure class="wp-block-image size-large"><img loading="lazy" decoding="async" width="862" height="971" src="https://norfolkinfosec.com/wp-content/uploads/2019/12/pic5.png" alt="" class="wp-image-299" srcset="https://norfolkinfosec.com/wp-content/uploads/2019/12/pic5.png 862w, https://norfolkinfosec.com/wp-content/uploads/2019/12/pic5-266x300.png 266w, https://norfolkinfosec.com/wp-content/uploads/2019/12/pic5-768x865.png 768w, https://norfolkinfosec.com/wp-content/uploads/2019/12/pic5-186x210.png 186w" sizes="auto, (max-width: 862px) 100vw, 862px" /></figure>



<p style="font-size:12px">At this stage, this blog <strong><span style="text-decoration: underline;">has not</span></strong> identified where this data is stored or how it is transmitted. While some variants of this file have C2 functionality via DNS requests (a previously known and documented feature), such features appear absent from the file analyzed here and reported by VISA. This blog also performed a dynamic comparison between a known DNS variant and the file analyzed here using test data. The DNS variant immediately began communicating with external servers (including a public IP checker and the C2 server) and eventually attempted to transmit scraped test data over the DNS protocol. The file analyzed in this blog post did not perform these tasks. <br><br>A static comparison of both variants, with a focus on the DNS variant&#8217;s C2 server, shows that both files have nearly identical code leading to where this server is referenced in the DNS version and where one would expect it to be referenced in the non-DNS version:</p>



<div class="wp-block-image"><figure class="aligncenter size-large"><img loading="lazy" decoding="async" width="549" height="1024" src="https://norfolkinfosec.com/wp-content/uploads/2019/12/DNS_Compare_Trace-549x1024.png" alt="" class="wp-image-303" srcset="https://norfolkinfosec.com/wp-content/uploads/2019/12/DNS_Compare_Trace-549x1024.png 549w, https://norfolkinfosec.com/wp-content/uploads/2019/12/DNS_Compare_Trace-161x300.png 161w, https://norfolkinfosec.com/wp-content/uploads/2019/12/DNS_Compare_Trace-113x210.png 113w, https://norfolkinfosec.com/wp-content/uploads/2019/12/DNS_Compare_Trace.png 628w" sizes="auto, (max-width: 549px) 100vw, 549px" /><figcaption><strong>This code workflow is nearly identical in both variants</strong></figcaption></figure></div>



<p style="font-size:12px">However, examining this location (boxed in orange above) shows that several functions are not present in the non-DNS version. Most importantly, none of the functions in this location contain code matching the routine with the C2 reference in the DNS version: </p>



<figure class="wp-block-image size-large"><img loading="lazy" decoding="async" width="998" height="839" src="https://norfolkinfosec.com/wp-content/uploads/2019/12/DNS_Compare.png" alt="" class="wp-image-304" srcset="https://norfolkinfosec.com/wp-content/uploads/2019/12/DNS_Compare.png 998w, https://norfolkinfosec.com/wp-content/uploads/2019/12/DNS_Compare-300x252.png 300w, https://norfolkinfosec.com/wp-content/uploads/2019/12/DNS_Compare-768x646.png 768w, https://norfolkinfosec.com/wp-content/uploads/2019/12/DNS_Compare-210x177.png 210w" sizes="auto, (max-width: 980px) 100vw, 980px" /><figcaption><strong>The DNS variant (top left) contains additional functionality not present in the non-DNS variant</strong></figcaption></figure>



<p style="font-size:12px">If these features have been removed, this blog postulates that either a file saving mechanism exists but has not yet been identified, or an additional file is used to run the DLL and collect data.<br><br><span style="text-decoration: underline;">Additional Variants</span><br><br>As noted above, there are other variants of this scraper. A VirusTotal pivot on the workerInstance export identifies eight total samples, with varying compile times. Of these samples, some feature DNS exfiltration capabilities and others do not:<br><br><em>Non-DNS</em><br>   32ccf851b0b81252aa2bfdf2e8b416cb Compilation Timestamp: 2018-12-10 20:06:42 (27KB)<br>   0eb7ac6d2d99d702ecc8b86ff90b0aac Compilation Timestamp: 2019-04-11 13:26:51 (27kB)<br>   576039d7cb54b749af5ed3d3558ee296 Compilation Timestamp: 2018-11-07 11:56:06 (25KB)<br>   19d38325f715f623bd4b6e819a150cde Compilation Timestamp:  2018-12-10 20:07:02 (23KB) (blog version)<br>    <br><em>DNS</em> <br>   0576380f93f49279491177d96d84ad7e Compilation Timestamp: 2018-11-27 20:06:19 (89Kb)<br>   353b0df3a9efce2d32f6097cab8fffc3 Compilation Timestamp: 2018-11-27 20:06:44 (46KB)<br>   128f75f8c80d65d416c740a6d4c1591e Compilation Timestamp: 2018-11-27 20:06:19(44KB)<br>   4ed6cc403d5ea6abae458ba6f43ad4f3 Compilation Timestamp: 2018-11-27 20:06:44 (42KB)<br>   <br>Interestingly, the DNS variants were all compiled within a minute of each other. While two files share the same timestamp (and perhaps are the same file, dumped from memory or disk differently), there are still three unique timestamps from this set. In addition, these files are noticeably larger than the apparent non-DNS version. With one exception, these files also have compilation timestamps predating the non-DNS versions, although this data set might not be complete given the limitations in VirusTotal&#8217;s search range (although none of the DNS versions with this data query had compilation timestamps beyond 2018). <br><br>One possible explanation is that the threat actor shifted away from DNS exfiltration in favor of a quiet collection or the use of an external tool. Another possibility is that the tool is shared across multiple threat actors with different operational behaviors. The short window of compilation timestamps for the DNS samples could represent different builds for multiple simultaneous targets, threat actor testing, or a more benign explanation. <br><br>The DNS versions all use &#8220;ns.akamai1811.com&#8221; as their C2.</p>



<p style="font-size:12px"></p>



<p style="font-size:12px"><br></p>
			</div><!-- .entry-content -->

	<footer class="entry-footer">
		<span class="update">Updated: <a href="https://norfolkinfosec.com/pos-malware-used-at-fuel-pumps/" rel="bookmark"><time class="published updated" datetime="2019-12-23T14:13:54+00:00">December 23, 2019</time></a></span><br><span class="tags-links">Tags: <a href="https://norfolkinfosec.com/tag/pos-malware/" rel="tag">POS malware</a></span>	</footer><!-- .entry-footer -->
</article><!-- #post-## -->
						
	<nav class="navigation post-navigation" aria-label="Post navigation">
		<h2 class="screen-reader-text">Post navigation</h2>
		<div class="nav-links"><div class="nav-previous"><a href="https://norfolkinfosec.com/another-lazarus-injector/" rel="prev">Previous post</a></div><div class="nav-next"><a href="https://norfolkinfosec.com/fuel-pumps-ii-poslurp-b/" rel="next">Next post</a></div></div>
	</nav>
			
		
		</main><!-- #main -->
	</div><!-- #primary -->


<div id="secondary" class="widget-area egrid  grid-15 tablet-grid-15 mobile-grid-100 pull-85 tablet-pull-85" role="complementary">
</div><!-- #secondary -->

	</div><!-- #content -->

	<footer id="colophon" class="site-footer grid-container" role="contentinfo">
		<div class="grid-100 tablet-grid-100 mobile-grid-100"><div class="sepline2"></div></div>
		<div class="egrid  grid-70 tablet-grid-70 mobile-grid-100" id="footer-widget-copyright">
					</div>
		<div class=" grid-30 tablet-grid-30 mobile-grid-100">
			<a id="designer" class="alignright" href="https://www.coralthemes.com/product/coral-dark-wordpress-theme/">Free dark wordpress theme</a>
		</div>
		
	</footer><!-- #colophon -->
</div><!-- #page -->

<script type="text/javascript" src="https://norfolkinfosec.com/wp-content/themes/coral-dark/js/jquery.smartmenus.min.js?ver=0.9.7" id="smartmenus-js"></script>
<script type="text/javascript" src="https://norfolkinfosec.com/wp-content/themes/coral-dark/js/skip-link-focus-fix.js?ver=20130115" id="coral-dark-skip-link-focus-fix-js"></script>
<script type="text/javascript" id="coral-dark-script-js-extra">
/* <![CDATA[ */
var nivoSliderParams = {"effect":"fade","animspeed":"500","pausetime":"5000"};
/* ]]> */
</script>
<script type="text/javascript" src="https://norfolkinfosec.com/wp-content/themes/coral-dark/js/functions.js?ver=20160427" id="coral-dark-script-js"></script>

</body>
</html>
