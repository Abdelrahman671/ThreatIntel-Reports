<!DOCTYPE html>
<title>An Overhead View of the Royal Road | @nao_sec</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta content="nao-sec.org" property="og:title" />
<meta content="article" property="og:type" />
<meta content="https://nao-sec.org/2020/01/an-overhead-view-of-the-royal-road.html" property="og:url" />
<meta content="nao-sec.org" property="og:site_name" />
<meta content="An Overhead View of the Royal Road - @nao_sec" property="og:description" />
<meta content="https://nao-sec.org/assets/icon.png" name="twitter:image:src" />
<meta content="@nao_sec" name="twitter:site" />
<meta content="summary" name="twitter:card" />
<meta content="nao-sec.org" name="twitter:title" />
<meta content="https://nao-sec.org/assets/icon.png" property="og:image" />
<meta name="description" content="Abstract Several targeted attack groups share the tools used in the attack and are reported to be doing similar attacks. Attack tools are also shared in atta...">
<meta name="author" content="nao_sec">
<meta name="generator" content="Jekyll v3.10.0">
<link rel="canonical" href="https://nao-sec.org/2020/01/an-overhead-view-of-the-royal-road.html">
<link rel="stylesheet" href="/assets/css/index.css">
<link rel="stylesheet" href="/assets/css/classes.css">
<link rel="stylesheet" href="/assets/css/default.css">
<link rel="alternate" type="application/atom+xml" href="/feed.xml" title="nao_sec" />




<body class="light">

<header>
  <div id="head-wrap">
    <div id="head-row">
      <h1><a href="/" class="brand"><img src="/assets/logo.png" class="logo" />nao_sec</a></h1>
    </div>
    <div id="head-row">
      <nav><a href="/">Home</a><a href="/archive">Archive</a><a href="/about">About</a></nav>
      <nav><a class="icon" href="/cdn-cgi/l/email-protection#d7beb9b1b897b9b6b8faa4b2b4f9b8a5b0"><svg><use xlink:href="/assets/fontawesome/icons.svg#envelope"></use></svg></a><a class="icon" href="https://twitter.com/nao_sec"><svg><use xlink:href="/assets/fontawesome/icons.svg#twitter"></use></svg></a><a class="icon" href="https://infosec.exchange/@nao_sec"><svg><use xlink:href="/assets/fontawesome/icons.svg#mastodon"></use></svg></a><a class="icon" href="https://github.com/nao-sec"><svg><use xlink:href="/assets/fontawesome/icons.svg#github"></use></svg></a><a class="icon" href="/feed.xml"><svg><use xlink:href="/assets/fontawesome/icons.svg#rss"></use></svg></a></nav>    
    </div>
  </div>
</header>

<article>
  <header><h1><a href="/2020/01/an-overhead-view-of-the-royal-road.html">An Overhead View of the Royal Road</a></h1>
    <time datetime="2020-01-29T15:00:00+00:00">2020-01-29</time>
  </header>
<h2 id="abstract">Abstract</h2>
<p>Several targeted attack groups share the tools used in the attack and are reported to be doing similar attacks. Attack tools are also shared in attacks targeting Japanese organizations, for example, Tick. Tick may use a tool called Royal Road RTF Weaponizer. And Royal Road is used by targeted attack groups such as Goblin Panda and Temp.Trident that is suspected of being involved in China.</p>

<p>In this blog, we will focus on the Royal Road, and introduce the features of the tool, such as the outline of the tool, its behavior, and the exploited vulnerability. Next, the targeted attack groups that use the Royal Road are listed, and each attack case is shown in detail. We have collected over 100 malicious documents from 2018 and investigated malware that is deployed and downloaded from there. Even in groups using the same Royal Road, we attributed them based on the target country/organization, the technique used for the attack, the malware executed, etc.</p>

<p>There are a wide variety of countries/organizations targeted for attack, mainly in Asia. Such information has been published by researchers all over the world, but it’s not widely known that Royal Road is used in Tick attacks targeting Japanese organizations. Attacks using Royal Road are still active in 2019. Share analysis results of malicious documents and malware based on the cases we observed. Other targeted attack groups may be related to Royal Road. We introduce the attack cases of these attack groups and show their relevance.</p>

<p>Finally, we show the hunting technique using the characteristics of RTF files using Royal Road and the techniques that are preferred by targeted attack groups that use them. This blog will help researchers who are researching and analyzing targeted attacks and CSIRT/SOC members to understand the attacks and take countermeasures.</p>

<h2 id="summary">Summary</h2>
<h3 id="royal-road">Royal Road</h3>
<p>Royal Road is RTF weaponizer that named by Anomali. Sometimes called “8.t RTF exploit builder”. This tool is not OSS, However it’s shared between multiple actors.</p>

<p>We define the RTFs generated by RoyalRoad is supposed to satisfy the following two conditions:</p>
<ol>
  <li>Exploit the vulnerability in the Equation Editor</li>
  <li>Have an object named 8.t in the RTF</li>
</ol>

<p>Royal Road behaves as follows.</p>

<ol>
  <li>
    <p>RTF create a file (8.t) using ActiveX Control “Package” when opening a document</p>
  </li>
  <li>All Vulnerabilities used by exploit coed are based on Equation Editor.
    <ul>
      <li>CVE-2017-11882</li>
      <li>CVE-2018-0798</li>
      <li>CVE-2018-0802</li>
    </ul>
  </li>
  <li>It decode 8.t, execute malware, dll-sideloading, etc</li>
</ol>

<p><img src="https://nao-sec.org/assets/2020-01-30/behavior.png" alt="" /></p>

<p>Classification v1-v5 defined by Proofpoint and Anomali published at VB2019. We are doing more research about RTF Object. RTF analysis showed that there was a special byte sequence immediately before the shellcode. We called that an object pattern. 8.t encoding is not distinguished by version. It’s considered an actor distinction rather than a tool distinction.</p>

<p>About v3, RTF including 8.t could not be found in our survey, so we define this as RoyalRoad-related, not RoyalRoad.</p>

<p>New version definitions for v6 and later. The object string has changed a little since v5, but it is basically the same. v7 has a very different object string. v7 object pattern is same as v4-v6, but part ofobject data exists randomly.</p>

<p><img src="https://nao-sec.org/assets/2020-01-30/version.png" alt="" /></p>

<h3 id="for-attribution">For attribution</h3>
<ul>
  <li>Time
    <ul>
      <li>submission to public service</li>
      <li>RTF creation</li>
    </ul>
  </li>
  <li>Target country
    <ul>
      <li>decoy file language</li>
    </ul>
  </li>
  <li>RTF characteristics
    <ul>
      <li>Object strings</li>
      <li>Object patterns</li>
      <li>Package patterns</li>
      <li>Object name, Path</li>
    </ul>
  </li>
  <li>Payload encoding patterns</li>
  <li>Dropped file name</li>
  <li>Malware execution techniques
    <ul>
      <li>T1137 (Office Application Startup)</li>
      <li>T1073 (DLL Side-Loading)</li>
    </ul>
  </li>
  <li>Final payload (malware family)</li>
</ul>

<h3 id="actors">Actors</h3>
<p>Here are the actors that have been confirmed to use RoyalRoad. It is considered that China’s involvement is suspected.</p>

<p><img src="https://nao-sec.org/assets/2020-01-30/actor1.png" alt="" />
<img src="https://nao-sec.org/assets/2020-01-30/actor2.png" alt="" /></p>

<p>These are tables summarizing each actor’s characteristics. We categorize these actors into three groups.</p>

<p><img src="https://nao-sec.org/assets/2020-01-30/actor_details.png" alt="" /></p>

<h3 id="group">Group</h3>
<ul>
  <li>Group-A is Conimes, Periscope and Rancor.</li>
  <li>Group-B is Trident, Tick, TA428 and Tonto.</li>
  <li>Group-C is something else we don’t know.</li>
</ul>

<p><img src="https://nao-sec.org/assets/2020-01-30/group.png" alt="" /></p>

<p>Group-A is targeting Southeast Asia. Periscope and Conimes ware active at the same time and share the same techniques. Conimes and Rancor ware also active at the same time and share some techniques. We believe these groups are close and may share tools and insights.</p>

<p><img src="https://nao-sec.org/assets/2020-01-30/groupA.png" alt="" /></p>

<p>Group-B is including Trident, Tick, TA428 and Tonto. These are actors targeting East Asia, especially Russia, Korea and Japan. Tick, TA428 and Tonto may use the same technique. Especially Tick and Tonto are very similar. We believe that Group-B actors are very close and share techniques and insights.</p>

<p><img src="https://nao-sec.org/assets/2020-01-30/groupB.png" alt="" /></p>

<h3 id="wrap-up">Wrap-up</h3>
<p>The RTF file created using the Royal Road exploits a vulnerability in the equation editor. The RTF file has a various of characteristics that help with attribution.
There are many actors who use Royal Road. We can divide them into three groups and suppose connections between actors.</p>

<h3 id="appendix">Appendix</h3>
<h4 id="appendix-1-ioc">Appendix-1: IOC</h4>
<ul>
  <li><a href="https://nao-sec.org/jsac2020_ioc.html">https://nao-sec.org/jsac2020_ioc.html</a></li>
</ul>

<h4 id="appendix-2-tool">Appendix-2: Tool</h4>
<ul>
  <li><a href="https://github.com/nao-sec/rr_decoder">rr_decoder</a></li>
  <li><a href="https://github.com/nao-sec/yara_rules">Yara Rules</a></li>
</ul>

<hr />

<p>Full report is here: <a href="https://github.com/nao-sec/materials/raw/master/JSAC%2BCPRCon2020/An_Overhead_View_of_the_Royal_Road.pdf">[PDF (EN)]</a></p>

  
  
</article>


<footer>
  <a class="gray" href="/2021/01/royal-road-redive.html">« Royal Road! Re:Dive</a>
  <a class="gray" href="/2019/12/say-hello-to-bottle-exploit-kit.html">Say hello to Bottle Exploit Kit targeting Japan »</a>
</footer>



<script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script></body>